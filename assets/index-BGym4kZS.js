var fC=Object.defineProperty;var pC=(n,t,o)=>t in n?fC(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o;var jh=(n,t,o)=>pC(n,typeof t!="symbol"?t+"":t,o);function _mergeNamespaces(n,t){for(var o=0;o<t.length;o++){const r=t[o];if(typeof r!="string"&&!Array.isArray(r)){for(const u in r)if(u!=="default"&&!(u in n)){const d=Object.getOwnPropertyDescriptor(r,u);d&&Object.defineProperty(n,u,d.get?d:{enumerable:!0,get:()=>r[u]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const C of d.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&r(C)}).observe(document,{childList:!0,subtree:!0});function o(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(u){if(u.ep)return;u.ep=!0;const d=o(u);fetch(u.href,d)}})();function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function o(r,u,d){var C=null;if(d!==void 0&&(C=""+d),u.key!==void 0&&(C=""+u.key),"key"in u){d={};for(var I in u)I!=="key"&&(d[I]=u[I])}else d=u;return u=d.ref,{$$typeof:n,type:r,key:C,ref:u!==void 0?u:null,props:d}}return reactJsxRuntime_production.Fragment=t,reactJsxRuntime_production.jsx=o,reactJsxRuntime_production.jsxs=o,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),C=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),A=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),B=Symbol.iterator;function Z(ge){return ge===null||typeof ge!="object"?null:(ge=B&&ge[B]||ge["@@iterator"],typeof ge=="function"?ge:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,Y={};function J(ge,de,ve){this.props=ge,this.context=de,this.refs=Y,this.updater=ve||w}J.prototype.isReactComponent={},J.prototype.setState=function(ge,de){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,de,"setState")},J.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};function T(){}T.prototype=J.prototype;function L(ge,de,ve){this.props=ge,this.context=de,this.refs=Y,this.updater=ve||w}var z=L.prototype=new T;z.constructor=L,V(z,J.prototype),z.isPureReactComponent=!0;var K=Array.isArray,P={H:null,A:null,T:null,S:null},$=Object.prototype.hasOwnProperty;function ie(ge,de,ve,le,Ae,Xe){return ve=Xe.ref,{$$typeof:n,type:ge,key:de,ref:ve!==void 0?ve:null,props:Xe}}function ne(ge,de){return ie(ge.type,de,void 0,void 0,void 0,ge.props)}function ee(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===n}function se(ge){var de={"=":"=0",":":"=2"};return"$"+ge.replace(/[=:]/g,function(ve){return de[ve]})}var re=/\/+/g;function ce(ge,de){return typeof ge=="object"&&ge!==null&&ge.key!=null?se(""+ge.key):de.toString(36)}function ue(){}function ye(ge){switch(ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason;default:switch(typeof ge.status=="string"?ge.then(ue,ue):(ge.status="pending",ge.then(function(de){ge.status==="pending"&&(ge.status="fulfilled",ge.value=de)},function(de){ge.status==="pending"&&(ge.status="rejected",ge.reason=de)})),ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason}}throw ge}function Se(ge,de,ve,le,Ae){var Xe=typeof ge;(Xe==="undefined"||Xe==="boolean")&&(ge=null);var Te=!1;if(ge===null)Te=!0;else switch(Xe){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(ge.$$typeof){case n:case t:Te=!0;break;case G:return Te=ge._init,Se(Te(ge._payload),de,ve,le,Ae)}}if(Te)return Ae=Ae(ge),Te=le===""?"."+ce(ge,0):le,K(Ae)?(ve="",Te!=null&&(ve=Te.replace(re,"$&/")+"/"),Se(Ae,de,ve,"",function(dt){return dt})):Ae!=null&&(ee(Ae)&&(Ae=ne(Ae,ve+(Ae.key==null||ge&&ge.key===Ae.key?"":(""+Ae.key).replace(re,"$&/")+"/")+Te)),de.push(Ae)),1;Te=0;var Ne=le===""?".":le+":";if(K(ge))for(var We=0;We<ge.length;We++)le=ge[We],Xe=Ne+ce(le,We),Te+=Se(le,de,ve,Xe,Ae);else if(We=Z(ge),typeof We=="function")for(ge=We.call(ge),We=0;!(le=ge.next()).done;)le=le.value,Xe=Ne+ce(le,We++),Te+=Se(le,de,ve,Xe,Ae);else if(Xe==="object"){if(typeof ge.then=="function")return Se(ye(ge),de,ve,le,Ae);throw de=String(ge),Error("Objects are not valid as a React child (found: "+(de==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":de)+"). If you meant to render a collection of children, use an array instead.")}return Te}function Ce(ge,de,ve){if(ge==null)return ge;var le=[],Ae=0;return Se(ge,le,"","",function(Xe){return de.call(ve,Xe,Ae++)}),le}function Ze(ge){if(ge._status===-1){var de=ge._result;de=de(),de.then(function(ve){(ge._status===0||ge._status===-1)&&(ge._status=1,ge._result=ve)},function(ve){(ge._status===0||ge._status===-1)&&(ge._status=2,ge._result=ve)}),ge._status===-1&&(ge._status=0,ge._result=de)}if(ge._status===1)return ge._result.default;throw ge._result}var Be=typeof reportError=="function"?reportError:function(ge){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var de=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ge=="object"&&ge!==null&&typeof ge.message=="string"?String(ge.message):String(ge),error:ge});if(!window.dispatchEvent(de))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ge);return}console.error(ge)};function xe(){}return react_production.Children={map:Ce,forEach:function(ge,de,ve){Ce(ge,function(){de.apply(this,arguments)},ve)},count:function(ge){var de=0;return Ce(ge,function(){de++}),de},toArray:function(ge){return Ce(ge,function(de){return de})||[]},only:function(ge){if(!ee(ge))throw Error("React.Children.only expected to receive a single React element child.");return ge}},react_production.Component=J,react_production.Fragment=o,react_production.Profiler=u,react_production.PureComponent=L,react_production.StrictMode=r,react_production.Suspense=f,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,react_production.act=function(){throw Error("act(...) is not supported in production builds of React.")},react_production.cache=function(ge){return function(){return ge.apply(null,arguments)}},react_production.cloneElement=function(ge,de,ve){if(ge==null)throw Error("The argument must be a React element, but you passed "+ge+".");var le=V({},ge.props),Ae=ge.key,Xe=void 0;if(de!=null)for(Te in de.ref!==void 0&&(Xe=void 0),de.key!==void 0&&(Ae=""+de.key),de)!$.call(de,Te)||Te==="key"||Te==="__self"||Te==="__source"||Te==="ref"&&de.ref===void 0||(le[Te]=de[Te]);var Te=arguments.length-2;if(Te===1)le.children=ve;else if(1<Te){for(var Ne=Array(Te),We=0;We<Te;We++)Ne[We]=arguments[We+2];le.children=Ne}return ie(ge.type,Ae,void 0,void 0,Xe,le)},react_production.createContext=function(ge){return ge={$$typeof:C,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null},ge.Provider=ge,ge.Consumer={$$typeof:d,_context:ge},ge},react_production.createElement=function(ge,de,ve){var le,Ae={},Xe=null;if(de!=null)for(le in de.key!==void 0&&(Xe=""+de.key),de)$.call(de,le)&&le!=="key"&&le!=="__self"&&le!=="__source"&&(Ae[le]=de[le]);var Te=arguments.length-2;if(Te===1)Ae.children=ve;else if(1<Te){for(var Ne=Array(Te),We=0;We<Te;We++)Ne[We]=arguments[We+2];Ae.children=Ne}if(ge&&ge.defaultProps)for(le in Te=ge.defaultProps,Te)Ae[le]===void 0&&(Ae[le]=Te[le]);return ie(ge,Xe,void 0,void 0,null,Ae)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(ge){return{$$typeof:I,render:ge}},react_production.isValidElement=ee,react_production.lazy=function(ge){return{$$typeof:G,_payload:{_status:-1,_result:ge},_init:Ze}},react_production.memo=function(ge,de){return{$$typeof:A,type:ge,compare:de===void 0?null:de}},react_production.startTransition=function(ge){var de=P.T,ve={};P.T=ve;try{var le=ge(),Ae=P.S;Ae!==null&&Ae(ve,le),typeof le=="object"&&le!==null&&typeof le.then=="function"&&le.then(xe,Be)}catch(Xe){Be(Xe)}finally{P.T=de}},react_production.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},react_production.use=function(ge){return P.H.use(ge)},react_production.useActionState=function(ge,de,ve){return P.H.useActionState(ge,de,ve)},react_production.useCallback=function(ge,de){return P.H.useCallback(ge,de)},react_production.useContext=function(ge){return P.H.useContext(ge)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(ge,de){return P.H.useDeferredValue(ge,de)},react_production.useEffect=function(ge,de){return P.H.useEffect(ge,de)},react_production.useId=function(){return P.H.useId()},react_production.useImperativeHandle=function(ge,de,ve){return P.H.useImperativeHandle(ge,de,ve)},react_production.useInsertionEffect=function(ge,de){return P.H.useInsertionEffect(ge,de)},react_production.useLayoutEffect=function(ge,de){return P.H.useLayoutEffect(ge,de)},react_production.useMemo=function(ge,de){return P.H.useMemo(ge,de)},react_production.useOptimistic=function(ge,de){return P.H.useOptimistic(ge,de)},react_production.useReducer=function(ge,de,ve){return P.H.useReducer(ge,de,ve)},react_production.useRef=function(ge){return P.H.useRef(ge)},react_production.useState=function(ge){return P.H.useState(ge)},react_production.useSyncExternalStore=function(ge,de,ve){return P.H.useSyncExternalStore(ge,de,ve)},react_production.useTransition=function(){return P.H.useTransition()},react_production.version="19.0.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,function(n){function t(Ce,Ze){var Be=Ce.length;Ce.push(Ze);e:for(;0<Be;){var xe=Be-1>>>1,ge=Ce[xe];if(0<u(ge,Ze))Ce[xe]=Ze,Ce[Be]=ge,Be=xe;else break e}}function o(Ce){return Ce.length===0?null:Ce[0]}function r(Ce){if(Ce.length===0)return null;var Ze=Ce[0],Be=Ce.pop();if(Be!==Ze){Ce[0]=Be;e:for(var xe=0,ge=Ce.length,de=ge>>>1;xe<de;){var ve=2*(xe+1)-1,le=Ce[ve],Ae=ve+1,Xe=Ce[Ae];if(0>u(le,Be))Ae<ge&&0>u(Xe,le)?(Ce[xe]=Xe,Ce[Ae]=Be,xe=Ae):(Ce[xe]=le,Ce[ve]=Be,xe=ve);else if(Ae<ge&&0>u(Xe,Be))Ce[xe]=Xe,Ce[Ae]=Be,xe=Ae;else break e}}return Ze}function u(Ce,Ze){var Be=Ce.sortIndex-Ze.sortIndex;return Be!==0?Be:Ce.id-Ze.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var C=Date,I=C.now();n.unstable_now=function(){return C.now()-I}}var f=[],A=[],G=1,B=null,Z=3,w=!1,V=!1,Y=!1,J=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function z(Ce){for(var Ze=o(A);Ze!==null;){if(Ze.callback===null)r(A);else if(Ze.startTime<=Ce)r(A),Ze.sortIndex=Ze.expirationTime,t(f,Ze);else break;Ze=o(A)}}function K(Ce){if(Y=!1,z(Ce),!V)if(o(f)!==null)V=!0,ye();else{var Ze=o(A);Ze!==null&&Se(K,Ze.startTime-Ce)}}var P=!1,$=-1,ie=5,ne=-1;function ee(){return!(n.unstable_now()-ne<ie)}function se(){if(P){var Ce=n.unstable_now();ne=Ce;var Ze=!0;try{e:{V=!1,Y&&(Y=!1,T($),$=-1),w=!0;var Be=Z;try{t:{for(z(Ce),B=o(f);B!==null&&!(B.expirationTime>Ce&&ee());){var xe=B.callback;if(typeof xe=="function"){B.callback=null,Z=B.priorityLevel;var ge=xe(B.expirationTime<=Ce);if(Ce=n.unstable_now(),typeof ge=="function"){B.callback=ge,z(Ce),Ze=!0;break t}B===o(f)&&r(f),z(Ce)}else r(f);B=o(f)}if(B!==null)Ze=!0;else{var de=o(A);de!==null&&Se(K,de.startTime-Ce),Ze=!1}}break e}finally{B=null,Z=Be,w=!1}Ze=void 0}}finally{Ze?re():P=!1}}}var re;if(typeof L=="function")re=function(){L(se)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,ue=ce.port2;ce.port1.onmessage=se,re=function(){ue.postMessage(null)}}else re=function(){J(se,0)};function ye(){P||(P=!0,re())}function Se(Ce,Ze){$=J(function(){Ce(n.unstable_now())},Ze)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){V||w||(V=!0,ye())},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ie=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return Z},n.unstable_getFirstCallbackNode=function(){return o(f)},n.unstable_next=function(Ce){switch(Z){case 1:case 2:case 3:var Ze=3;break;default:Ze=Z}var Be=Z;Z=Ze;try{return Ce()}finally{Z=Be}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,Ze){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Be=Z;Z=Ce;try{return Ze()}finally{Z=Be}},n.unstable_scheduleCallback=function(Ce,Ze,Be){var xe=n.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?xe+Be:xe):Be=xe,Ce){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Be+ge,Ce={id:G++,callback:Ze,priorityLevel:Ce,startTime:Be,expirationTime:ge,sortIndex:-1},Be>xe?(Ce.sortIndex=Be,t(A,Ce),o(f)===null&&Ce===o(A)&&(Y?(T($),$=-1):Y=!0,Se(K,Be-xe))):(Ce.sortIndex=ge,t(f,Ce),V||w||(V=!0,ye())),Ce},n.unstable_shouldYield=ee,n.unstable_wrapCallback=function(Ce){var Ze=Z;return function(){var Be=Z;Z=Ze;try{return Ce.apply(this,arguments)}finally{Z=Be}}}}(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var n=requireReact();function t(f){var A="https://react.dev/errors/"+f;if(1<arguments.length){A+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)A+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+f+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var r={d:{f:o,r:function(){throw Error(t(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},u=Symbol.for("react.portal");function d(f,A,G){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:B==null?null:""+B,children:f,containerInfo:A,implementation:G}}var C=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function I(f,A){if(f==="font")return"";if(typeof A=="string")return A==="use-credentials"?A:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,reactDom_production.createPortal=function(f,A){var G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!A||A.nodeType!==1&&A.nodeType!==9&&A.nodeType!==11)throw Error(t(299));return d(f,A,null,G)},reactDom_production.flushSync=function(f){var A=C.T,G=r.p;try{if(C.T=null,r.p=2,f)return f()}finally{C.T=A,r.p=G,r.d.f()}},reactDom_production.preconnect=function(f,A){typeof f=="string"&&(A?(A=A.crossOrigin,A=typeof A=="string"?A==="use-credentials"?A:"":void 0):A=null,r.d.C(f,A))},reactDom_production.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},reactDom_production.preinit=function(f,A){if(typeof f=="string"&&A&&typeof A.as=="string"){var G=A.as,B=I(G,A.crossOrigin),Z=typeof A.integrity=="string"?A.integrity:void 0,w=typeof A.fetchPriority=="string"?A.fetchPriority:void 0;G==="style"?r.d.S(f,typeof A.precedence=="string"?A.precedence:void 0,{crossOrigin:B,integrity:Z,fetchPriority:w}):G==="script"&&r.d.X(f,{crossOrigin:B,integrity:Z,fetchPriority:w,nonce:typeof A.nonce=="string"?A.nonce:void 0})}},reactDom_production.preinitModule=function(f,A){if(typeof f=="string")if(typeof A=="object"&&A!==null){if(A.as==null||A.as==="script"){var G=I(A.as,A.crossOrigin);r.d.M(f,{crossOrigin:G,integrity:typeof A.integrity=="string"?A.integrity:void 0,nonce:typeof A.nonce=="string"?A.nonce:void 0})}}else A==null&&r.d.M(f)},reactDom_production.preload=function(f,A){if(typeof f=="string"&&typeof A=="object"&&A!==null&&typeof A.as=="string"){var G=A.as,B=I(G,A.crossOrigin);r.d.L(f,G,{crossOrigin:B,integrity:typeof A.integrity=="string"?A.integrity:void 0,nonce:typeof A.nonce=="string"?A.nonce:void 0,type:typeof A.type=="string"?A.type:void 0,fetchPriority:typeof A.fetchPriority=="string"?A.fetchPriority:void 0,referrerPolicy:typeof A.referrerPolicy=="string"?A.referrerPolicy:void 0,imageSrcSet:typeof A.imageSrcSet=="string"?A.imageSrcSet:void 0,imageSizes:typeof A.imageSizes=="string"?A.imageSizes:void 0,media:typeof A.media=="string"?A.media:void 0})}},reactDom_production.preloadModule=function(f,A){if(typeof f=="string")if(A){var G=I(A.as,A.crossOrigin);r.d.m(f,{as:typeof A.as=="string"&&A.as!=="script"?A.as:void 0,crossOrigin:G,integrity:typeof A.integrity=="string"?A.integrity:void 0})}else r.d.m(f)},reactDom_production.requestFormReset=function(f){r.d.r(f)},reactDom_production.unstable_batchedUpdates=function(f,A){return f(A)},reactDom_production.useFormState=function(f,A,G){return C.H.useFormState(f,A,G)},reactDom_production.useFormStatus=function(){return C.H.useHostTransitionStatus()},reactDom_production.version="19.0.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var n=requireScheduler(),t=requireReact(),o=requireReactDom();function r(y){var S="https://react.dev/errors/"+y;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var N=2;N<arguments.length;N++)S+="&args[]="+encodeURIComponent(arguments[N])}return"Minified React error #"+y+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(y){return!(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)}var d=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),I=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),Z=Symbol.for("react.consumer"),w=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),z=Symbol.for("react.offscreen"),K=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function $(y){return y===null||typeof y!="object"?null:(y=P&&y[P]||y["@@iterator"],typeof y=="function"?y:null)}var ie=Symbol.for("react.client.reference");function ne(y){if(y==null)return null;if(typeof y=="function")return y.$$typeof===ie?null:y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case f:return"Fragment";case I:return"Portal";case G:return"Profiler";case A:return"StrictMode";case Y:return"Suspense";case J:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case w:return(y.displayName||"Context")+".Provider";case Z:return(y._context.displayName||"Context")+".Consumer";case V:var S=y.render;return y=y.displayName,y||(y=S.displayName||S.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case T:return S=y.displayName||null,S!==null?S:ne(y.type)||"Memo";case L:S=y._payload,y=y._init;try{return ne(y(S))}catch{}}return null}var ee=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=Object.assign,re,ce;function ue(y){if(re===void 0)try{throw Error()}catch(N){var S=N.stack.trim().match(/\n( *(at )?)/);re=S&&S[1]||"",ce=-1<N.stack.indexOf(`
    at`)?" (<anonymous>)":-1<N.stack.indexOf("@")?"@unknown:0:0":""}return`
`+re+y+ce}var ye=!1;function Se(y,S){if(!y||ye)return"";ye=!0;var N=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var H={DetermineComponentFrameRoot:function(){try{if(S){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch(lt){var et=lt}Reflect.construct(y,[],mt)}else{try{mt.call()}catch(lt){et=lt}y.call(mt.prototype)}}else{try{throw Error()}catch(lt){et=lt}(mt=y())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch(lt){if(lt&&et&&typeof lt.stack=="string")return[lt.stack,et.stack]}return[null,null]}};H.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var O=Object.getOwnPropertyDescriptor(H.DetermineComponentFrameRoot,"name");O&&O.configurable&&Object.defineProperty(H.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Q=H.DetermineComponentFrameRoot(),ae=Q[0],fe=Q[1];if(ae&&fe){var Re=ae.split(`
`),Je=fe.split(`
`);for(O=H=0;H<Re.length&&!Re[H].includes("DetermineComponentFrameRoot");)H++;for(;O<Je.length&&!Je[O].includes("DetermineComponentFrameRoot");)O++;if(H===Re.length||O===Je.length)for(H=Re.length-1,O=Je.length-1;1<=H&&0<=O&&Re[H]!==Je[O];)O--;for(;1<=H&&0<=O;H--,O--)if(Re[H]!==Je[O]){if(H!==1||O!==1)do if(H--,O--,0>O||Re[H]!==Je[O]){var ut=`
`+Re[H].replace(" at new "," at ");return y.displayName&&ut.includes("<anonymous>")&&(ut=ut.replace("<anonymous>",y.displayName)),ut}while(1<=H&&0<=O);break}}}finally{ye=!1,Error.prepareStackTrace=N}return(N=y?y.displayName||y.name:"")?ue(N):""}function Ce(y){switch(y.tag){case 26:case 27:case 5:return ue(y.type);case 16:return ue("Lazy");case 13:return ue("Suspense");case 19:return ue("SuspenseList");case 0:case 15:return y=Se(y.type,!1),y;case 11:return y=Se(y.type.render,!1),y;case 1:return y=Se(y.type,!0),y;default:return""}}function Ze(y){try{var S="";do S+=Ce(y),y=y.return;while(y);return S}catch(N){return`
Error generating stack: `+N.message+`
`+N.stack}}function Be(y){var S=y,N=y;if(y.alternate)for(;S.return;)S=S.return;else{y=S;do S=y,(S.flags&4098)!==0&&(N=S.return),y=S.return;while(y)}return S.tag===3?N:null}function xe(y){if(y.tag===13){var S=y.memoizedState;if(S===null&&(y=y.alternate,y!==null&&(S=y.memoizedState)),S!==null)return S.dehydrated}return null}function ge(y){if(Be(y)!==y)throw Error(r(188))}function de(y){var S=y.alternate;if(!S){if(S=Be(y),S===null)throw Error(r(188));return S!==y?null:y}for(var N=y,H=S;;){var O=N.return;if(O===null)break;var Q=O.alternate;if(Q===null){if(H=O.return,H!==null){N=H;continue}break}if(O.child===Q.child){for(Q=O.child;Q;){if(Q===N)return ge(O),y;if(Q===H)return ge(O),S;Q=Q.sibling}throw Error(r(188))}if(N.return!==H.return)N=O,H=Q;else{for(var ae=!1,fe=O.child;fe;){if(fe===N){ae=!0,N=O,H=Q;break}if(fe===H){ae=!0,H=O,N=Q;break}fe=fe.sibling}if(!ae){for(fe=Q.child;fe;){if(fe===N){ae=!0,N=Q,H=O;break}if(fe===H){ae=!0,H=Q,N=O;break}fe=fe.sibling}if(!ae)throw Error(r(189))}}if(N.alternate!==H)throw Error(r(190))}if(N.tag!==3)throw Error(r(188));return N.stateNode.current===N?y:S}function ve(y){var S=y.tag;if(S===5||S===26||S===27||S===6)return y;for(y=y.child;y!==null;){if(S=ve(y),S!==null)return S;y=y.sibling}return null}var le=Array.isArray,Ae=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Xe={pending:!1,data:null,method:null,action:null},Te=[],Ne=-1;function We(y){return{current:y}}function dt(y){0>Ne||(y.current=Te[Ne],Te[Ne]=null,Ne--)}function nt(y,S){Ne++,Te[Ne]=y.current,y.current=S}var Rt=We(null),Qe=We(null),Oe=We(null),be=We(null);function yt(y,S){switch(nt(Oe,S),nt(Qe,y),nt(Rt,null),y=S.nodeType,y){case 9:case 11:S=(S=S.documentElement)&&(S=S.namespaceURI)?ld(S):0;break;default:if(y=y===8?S.parentNode:S,S=y.tagName,y=y.namespaceURI)y=ld(y),S=cd(y,S);else switch(S){case"svg":S=1;break;case"math":S=2;break;default:S=0}}dt(Rt),nt(Rt,S)}function st(){dt(Rt),dt(Qe),dt(Oe)}function Gt(y){y.memoizedState!==null&&nt(be,y);var S=Rt.current,N=cd(S,y.type);S!==N&&(nt(Qe,y),nt(Rt,N))}function rt(y){Qe.current===y&&(dt(Rt),dt(Qe)),be.current===y&&(dt(be),Yg._currentValue=Xe)}var Yt=Object.prototype.hasOwnProperty,Xt=n.unstable_scheduleCallback,Ge=n.unstable_cancelCallback,he=n.unstable_shouldYield,ke=n.unstable_requestPaint,it=n.unstable_now,ht=n.unstable_getCurrentPriorityLevel,He=n.unstable_ImmediatePriority,ot=n.unstable_UserBlockingPriority,Zt=n.unstable_NormalPriority,wt=n.unstable_LowPriority,Et=n.unstable_IdlePriority,De=n.log,ct=n.unstable_setDisableYieldValue,ft=null,At=null;function Ct(y){if(At&&typeof At.onCommitFiberRoot=="function")try{At.onCommitFiberRoot(ft,y,void 0,(y.current.flags&128)===128)}catch{}}function me(y){if(typeof De=="function"&&ct(y),At&&typeof At.setStrictMode=="function")try{At.setStrictMode(ft,y)}catch{}}var Ee=Math.clz32?Math.clz32:Bt,_e=Math.log,Me=Math.LN2;function Bt(y){return y>>>=0,y===0?32:31-(_e(y)/Me|0)|0}var qe=128,at=4194304;function bt(y){var S=y&42;if(S!==0)return S;switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return y&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return y}}function _t(y,S){var N=y.pendingLanes;if(N===0)return 0;var H=0,O=y.suspendedLanes,Q=y.pingedLanes,ae=y.warmLanes;y=y.finishedLanes!==0;var fe=N&134217727;return fe!==0?(N=fe&~O,N!==0?H=bt(N):(Q&=fe,Q!==0?H=bt(Q):y||(ae=fe&~ae,ae!==0&&(H=bt(ae))))):(fe=N&~O,fe!==0?H=bt(fe):Q!==0?H=bt(Q):y||(ae=N&~ae,ae!==0&&(H=bt(ae)))),H===0?0:S!==0&&S!==H&&(S&O)===0&&(O=H&-H,ae=S&-S,O>=ae||O===32&&(ae&4194176)!==0)?S:H}function Tt(y,S){return(y.pendingLanes&~(y.suspendedLanes&~y.pingedLanes)&S)===0}function si(y,S){switch(y){case 1:case 2:case 4:case 8:return S+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bi(){var y=qe;return qe<<=1,(qe&4194176)===0&&(qe=128),y}function ii(){var y=at;return at<<=1,(at&62914560)===0&&(at=4194304),y}function ci(y){for(var S=[],N=0;31>N;N++)S.push(y);return S}function Zi(y,S){y.pendingLanes|=S,S!==268435456&&(y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0)}function Gn(y,S,N,H,O,Q){var ae=y.pendingLanes;y.pendingLanes=N,y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0,y.expiredLanes&=N,y.entangledLanes&=N,y.errorRecoveryDisabledLanes&=N,y.shellSuspendCounter=0;var fe=y.entanglements,Re=y.expirationTimes,Je=y.hiddenUpdates;for(N=ae&~N;0<N;){var ut=31-Ee(N),mt=1<<ut;fe[ut]=0,Re[ut]=-1;var et=Je[ut];if(et!==null)for(Je[ut]=null,ut=0;ut<et.length;ut++){var lt=et[ut];lt!==null&&(lt.lane&=-536870913)}N&=~mt}H!==0&&Ys(y,H,0),Q!==0&&O===0&&y.tag!==0&&(y.suspendedLanes|=Q&~(ae&~S))}function Ys(y,S,N){y.pendingLanes|=S,y.suspendedLanes&=~S;var H=31-Ee(S);y.entangledLanes|=S,y.entanglements[H]=y.entanglements[H]|1073741824|N&4194218}function An(y,S){var N=y.entangledLanes|=S;for(y=y.entanglements;N;){var H=31-Ee(N),O=1<<H;O&S|y[H]&S&&(y[H]|=S),N&=~O}}function vn(y){return y&=-y,2<y?8<y?(y&134217727)!==0?32:268435456:8:2}function Nn(){var y=Ae.p;return y!==0?y:(y=window.event,y===void 0?32:Zd(y.type))}function ns(y,S){var N=Ae.p;try{return Ae.p=y,S()}finally{Ae.p=N}}var Yi=Math.random().toString(36).slice(2),Ti="__reactFiber$"+Yi,Qt="__reactProps$"+Yi,Ts="__reactContainer$"+Yi,Oo="__reactEvents$"+Yi,Nl="__reactListeners$"+Yi,Vl="__reactHandles$"+Yi,Wl="__reactResources$"+Yi,Io="__reactMarker$"+Yi;function wr(y){delete y[Ti],delete y[Qt],delete y[Oo],delete y[Nl],delete y[Vl]}function Js(y){var S=y[Ti];if(S)return S;for(var N=y.parentNode;N;){if(S=N[Ts]||N[Ti]){if(N=S.alternate,S.child!==null||N!==null&&N.child!==null)for(y=hd(y);y!==null;){if(N=y[Ti])return N;y=hd(y)}return S}y=N,N=y.parentNode}return null}function Ie(y){if(y=y[Ti]||y[Ts]){var S=y.tag;if(S===5||S===6||S===13||S===26||S===27||S===3)return y}return null}function Ve(y){var S=y.tag;if(S===5||S===26||S===27||S===6)return y.stateNode;throw Error(r(33))}function $e(y){var S=y[Wl];return S||(S=y[Wl]={hoistableStyles:new Map,hoistableScripts:new Map}),S}function Pe(y){y[Io]=!0}var Le=new Set,pt={};function Mt(y,S){Vt(y,S),Vt(y+"Capture",S)}function Vt(y,S){for(pt[y]=S,y=0;y<S.length;y++)Le.add(S[y])}var Nt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ot={},zt={};function di(y){return Yt.call(zt,y)?!0:Yt.call(Ot,y)?!1:Dt.test(y)?zt[y]=!0:(Ot[y]=!0,!1)}function Ci(y,S,N){if(di(S))if(N===null)y.removeAttribute(S);else{switch(typeof N){case"undefined":case"function":case"symbol":y.removeAttribute(S);return;case"boolean":var H=S.toLowerCase().slice(0,5);if(H!=="data-"&&H!=="aria-"){y.removeAttribute(S);return}}y.setAttribute(S,""+N)}}function Ji(y,S,N){if(N===null)y.removeAttribute(S);else{switch(typeof N){case"undefined":case"function":case"symbol":case"boolean":y.removeAttribute(S);return}y.setAttribute(S,""+N)}}function Ai(y,S,N,H){if(H===null)y.removeAttribute(N);else{switch(typeof H){case"undefined":case"function":case"symbol":case"boolean":y.removeAttribute(N);return}y.setAttributeNS(S,N,""+H)}}function jt(y){switch(typeof y){case"bigint":case"boolean":case"number":case"string":case"undefined":return y;case"object":return y;default:return""}}function Ft(y){var S=y.type;return(y=y.nodeName)&&y.toLowerCase()==="input"&&(S==="checkbox"||S==="radio")}function cn(y){var S=Ft(y)?"checked":"value",N=Object.getOwnPropertyDescriptor(y.constructor.prototype,S),H=""+y[S];if(!y.hasOwnProperty(S)&&typeof N<"u"&&typeof N.get=="function"&&typeof N.set=="function"){var O=N.get,Q=N.set;return Object.defineProperty(y,S,{configurable:!0,get:function(){return O.call(this)},set:function(ae){H=""+ae,Q.call(this,ae)}}),Object.defineProperty(y,S,{enumerable:N.enumerable}),{getValue:function(){return H},setValue:function(ae){H=""+ae},stopTracking:function(){y._valueTracker=null,delete y[S]}}}}function Ii(y){y._valueTracker||(y._valueTracker=cn(y))}function kn(y){if(!y)return!1;var S=y._valueTracker;if(!S)return!0;var N=S.getValue(),H="";return y&&(H=Ft(y)?y.checked?"true":"false":y.value),y=H,y!==N?(S.setValue(y),!0):!1}function Cs(y){if(y=y||(typeof document<"u"?document:void 0),typeof y>"u")return null;try{return y.activeElement||y.body}catch{return y.body}}var Vn=/[\n"\\]/g;function mn(y){return y.replace(Vn,function(S){return"\\"+S.charCodeAt(0).toString(16)+" "})}function xi(y,S,N,H,O,Q,ae,fe){y.name="",ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?y.type=ae:y.removeAttribute("type"),S!=null?ae==="number"?(S===0&&y.value===""||y.value!=S)&&(y.value=""+jt(S)):y.value!==""+jt(S)&&(y.value=""+jt(S)):ae!=="submit"&&ae!=="reset"||y.removeAttribute("value"),S!=null?xn(y,ae,jt(S)):N!=null?xn(y,ae,jt(N)):H!=null&&y.removeAttribute("value"),O==null&&Q!=null&&(y.defaultChecked=!!Q),O!=null&&(y.checked=O&&typeof O!="function"&&typeof O!="symbol"),fe!=null&&typeof fe!="function"&&typeof fe!="symbol"&&typeof fe!="boolean"?y.name=""+jt(fe):y.removeAttribute("name")}function Wn(y,S,N,H,O,Q,ae,fe){if(Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(y.type=Q),S!=null||N!=null){if(!(Q!=="submit"&&Q!=="reset"||S!=null))return;N=N!=null?""+jt(N):"",S=S!=null?""+jt(S):N,fe||S===y.value||(y.value=S),y.defaultValue=S}H=H??O,H=typeof H!="function"&&typeof H!="symbol"&&!!H,y.checked=fe?y.checked:!!H,y.defaultChecked=!!H,ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(y.name=ae)}function xn(y,S,N){S==="number"&&Cs(y.ownerDocument)===y||y.defaultValue===""+N||(y.defaultValue=""+N)}function Qi(y,S,N,H){if(y=y.options,S){S={};for(var O=0;O<N.length;O++)S["$"+N[O]]=!0;for(N=0;N<y.length;N++)O=S.hasOwnProperty("$"+y[N].value),y[N].selected!==O&&(y[N].selected=O),O&&H&&(y[N].defaultSelected=!0)}else{for(N=""+jt(N),S=null,O=0;O<y.length;O++){if(y[O].value===N){y[O].selected=!0,H&&(y[O].defaultSelected=!0);return}S!==null||y[O].disabled||(S=y[O])}S!==null&&(S.selected=!0)}}function Bn(y,S,N){if(S!=null&&(S=""+jt(S),S!==y.value&&(y.value=S),N==null)){y.defaultValue!==S&&(y.defaultValue=S);return}y.defaultValue=N!=null?""+jt(N):""}function Hs(y,S,N,H){if(S==null){if(H!=null){if(N!=null)throw Error(r(92));if(le(H)){if(1<H.length)throw Error(r(93));H=H[0]}N=H}N==null&&(N=""),S=N}N=jt(S),y.defaultValue=N,H=y.textContent,H===N&&H!==""&&H!==null&&(y.value=H)}function Pn(y,S){if(S){var N=y.firstChild;if(N&&N===y.lastChild&&N.nodeType===3){N.nodeValue=S;return}}y.textContent=S}var El=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ka(y,S,N){var H=S.indexOf("--")===0;N==null||typeof N=="boolean"||N===""?H?y.setProperty(S,""):S==="float"?y.cssFloat="":y[S]="":H?y.setProperty(S,N):typeof N!="number"||N===0||El.has(S)?S==="float"?y.cssFloat=N:y[S]=(""+N).trim():y[S]=N+"px"}function _c(y,S,N){if(S!=null&&typeof S!="object")throw Error(r(62));if(y=y.style,N!=null){for(var H in N)!N.hasOwnProperty(H)||S!=null&&S.hasOwnProperty(H)||(H.indexOf("--")===0?y.setProperty(H,""):H==="float"?y.cssFloat="":y[H]="");for(var O in S)H=S[O],S.hasOwnProperty(O)&&N[O]!==H&&ka(y,O,H)}else for(var Q in S)S.hasOwnProperty(Q)&&ka(y,Q,S[Q])}function Pa(y){if(y.indexOf("-")===-1)return!1;switch(y){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Fg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Da(y){return Fg.test(""+y)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":y}var Yl=null;function Oa(y){return y=y.target||y.srcElement||window,y.correspondingUseElement&&(y=y.correspondingUseElement),y.nodeType===3?y.parentNode:y}var Mr=null,Nr=null;function Tl(y){var S=Ie(y);if(S&&(y=S.stateNode)){var N=y[Qt]||null;e:switch(y=S.stateNode,S.type){case"input":if(xi(y,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name),S=N.name,N.type==="radio"&&S!=null){for(N=y;N.parentNode;)N=N.parentNode;for(N=N.querySelectorAll('input[name="'+mn(""+S)+'"][type="radio"]'),S=0;S<N.length;S++){var H=N[S];if(H!==y&&H.form===y.form){var O=H[Qt]||null;if(!O)throw Error(r(90));xi(H,O.value,O.defaultValue,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name)}}for(S=0;S<N.length;S++)H=N[S],H.form===y.form&&kn(H)}break e;case"textarea":Bn(y,N.value,N.defaultValue);break e;case"select":S=N.value,S!=null&&Qi(y,!!N.multiple,S,!1)}}}var Jl=!1;function wc(y,S,N){if(Jl)return y(S,N);Jl=!0;try{var H=y(S);return H}finally{if(Jl=!1,(Mr!==null||Nr!==null)&&(ta(),Mr&&(S=Mr,y=Nr,Nr=Mr=null,Tl(S),y)))for(S=0;S<y.length;S++)Tl(y[S])}}function oa(y,S){var N=y.stateNode;if(N===null)return null;var H=N[Qt]||null;if(H===null)return null;N=H[S];e:switch(S){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(H=!H.disabled)||(y=y.type,H=!(y==="button"||y==="input"||y==="select"||y==="textarea")),y=!H;break e;default:y=!1}if(y)return null;if(N&&typeof N!="function")throw Error(r(231,S,typeof N));return N}var Ua=!1;if(Nt)try{var ra={};Object.defineProperty(ra,"passive",{get:function(){Ua=!0}}),window.addEventListener("test",ra,ra),window.removeEventListener("test",ra,ra)}catch{Ua=!1}var fo=null,Mc=null,Hl=null;function Nc(){if(Hl)return Hl;var y,S=Mc,N=S.length,H,O="value"in fo?fo.value:fo.textContent,Q=O.length;for(y=0;y<N&&S[y]===O[y];y++);var ae=N-y;for(H=1;H<=ae&&S[N-H]===O[Q-H];H++);return Hl=O.slice(y,1<H?1-H:void 0)}function Uo(y){var S=y.keyCode;return"charCode"in y?(y=y.charCode,y===0&&S===13&&(y=13)):y=S,y===10&&(y=13),32<=y||y===13?y:0}function aa(){return!0}function $a(){return!1}function Dn(y){function S(N,H,O,Q,ae){this._reactName=N,this._targetInst=O,this.type=H,this.nativeEvent=Q,this.target=ae,this.currentTarget=null;for(var fe in y)y.hasOwnProperty(fe)&&(N=y[fe],this[fe]=N?N(Q):Q[fe]);return this.isDefaultPrevented=(Q.defaultPrevented!=null?Q.defaultPrevented:Q.returnValue===!1)?aa:$a,this.isPropagationStopped=$a,this}return se(S.prototype,{preventDefault:function(){this.defaultPrevented=!0;var N=this.nativeEvent;N&&(N.preventDefault?N.preventDefault():typeof N.returnValue!="unknown"&&(N.returnValue=!1),this.isDefaultPrevented=aa)},stopPropagation:function(){var N=this.nativeEvent;N&&(N.stopPropagation?N.stopPropagation():typeof N.cancelBubble!="unknown"&&(N.cancelBubble=!0),this.isPropagationStopped=aa)},persist:function(){},isPersistent:aa}),S}var $o={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(y){return y.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},la=Dn($o),ca=se({},$o,{view:0,detail:0}),Kg=Dn(ca),po,ga,ua,ha=se({},ca,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ja,button:0,buttons:0,relatedTarget:function(y){return y.relatedTarget===void 0?y.fromElement===y.srcElement?y.toElement:y.fromElement:y.relatedTarget},movementX:function(y){return"movementX"in y?y.movementX:(y!==ua&&(ua&&y.type==="mousemove"?(po=y.screenX-ua.screenX,ga=y.screenY-ua.screenY):ga=po=0,ua=y),po)},movementY:function(y){return"movementY"in y?y.movementY:ga}}),Vc=Dn(ha),kg=se({},ha,{dataTransfer:0}),ph=Dn(kg),Rn=se({},ca,{relatedTarget:0}),Ll=Dn(Rn),Pg=se({},$o,{animationName:0,elapsedTime:0,pseudoElement:0}),Dg=Dn(Pg),Og=se({},$o,{clipboardData:function(y){return"clipboardData"in y?y.clipboardData:window.clipboardData}}),Ug=Dn(Og),Qa=se({},$o,{data:0}),zl=Dn(Qa),$g={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wc(y){var S=this.nativeEvent;return S.getModifierState?S.getModifierState(y):(y=jg[y])?!!S[y]:!1}function ja(){return Wc}var qg=se({},ca,{key:function(y){if(y.key){var S=$g[y.key]||y.key;if(S!=="Unidentified")return S}return y.type==="keypress"?(y=Uo(y),y===13?"Enter":String.fromCharCode(y)):y.type==="keydown"||y.type==="keyup"?Qg[y.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ja,charCode:function(y){return y.type==="keypress"?Uo(y):0},keyCode:function(y){return y.type==="keydown"||y.type==="keyup"?y.keyCode:0},which:function(y){return y.type==="keypress"?Uo(y):y.type==="keydown"||y.type==="keyup"?y.keyCode:0}}),Ec=Dn(qg),Yc=se({},ha,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fl=Dn(Yc),eu=se({},ca,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ja}),Tc=Dn(eu),tu=se({},$o,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ao=Dn(tu),Jc=se({},ha,{deltaX:function(y){return"deltaX"in y?y.deltaX:"wheelDeltaX"in y?-y.wheelDeltaX:0},deltaY:function(y){return"deltaY"in y?y.deltaY:"wheelDeltaY"in y?-y.wheelDeltaY:"wheelDelta"in y?-y.wheelDelta:0},deltaZ:0,deltaMode:0}),Ah=Dn(Jc),iu=se({},$o,{newState:0,oldState:0}),Qo=Dn(iu),mo=[9,13,27,32],qa=Nt&&"CompositionEvent"in window,Vr=null;Nt&&"documentMode"in document&&(Vr=document.documentMode);var el=Nt&&"TextEvent"in window&&!Vr,tl=Nt&&(!qa||Vr&&8<Vr&&11>=Vr),jo=" ",_n=!1;function il(y,S){switch(y){case"keyup":return mo.indexOf(S.keyCode)!==-1;case"keydown":return S.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hc(y){return y=y.detail,typeof y=="object"&&"data"in y?y.data:null}var qo=!1;function nl(y,S){switch(y){case"compositionend":return Hc(S);case"keypress":return S.which!==32?null:(_n=!0,jo);case"textInput":return y=S.data,y===jo&&_n?null:y;default:return null}}function Lc(y,S){if(qo)return y==="compositionend"||!qa&&il(y,S)?(y=Nc(),Hl=Mc=fo=null,qo=!1,y):null;switch(y){case"paste":return null;case"keypress":if(!(S.ctrlKey||S.altKey||S.metaKey)||S.ctrlKey&&S.altKey){if(S.char&&1<S.char.length)return S.char;if(S.which)return String.fromCharCode(S.which)}return null;case"compositionend":return tl&&S.locale!=="ko"?null:S.data;default:return null}}var Kl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zc(y){var S=y&&y.nodeName&&y.nodeName.toLowerCase();return S==="input"?!!Kl[y.type]:S==="textarea"}function ss(y,S,N,H){Mr?Nr?Nr.push(H):Nr=[H]:Mr=H,S=ih(S,"onChange"),0<S.length&&(N=new la("onChange","change",null,N,H),y.push({event:N,listeners:S}))}var da=null,Wr=null;function nu(y){nd(y,0)}function sl(y){var S=Ve(y);if(kn(S))return y}function kl(y,S){if(y==="change")return S}var Pl=!1;if(Nt){var Dl;if(Nt){var Ca="oninput"in document;if(!Ca){var Ia=document.createElement("div");Ia.setAttribute("oninput","return;"),Ca=typeof Ia.oninput=="function"}Dl=Ca}else Dl=!1;Pl=Dl&&(!document.documentMode||9<document.documentMode)}function Pi(){da&&(da.detachEvent("onpropertychange",su),Wr=da=null)}function su(y){if(y.propertyName==="value"&&sl(Wr)){var S=[];ss(S,Wr,y,Oa(y)),wc(nu,S)}}function mh(y,S,N){y==="focusin"?(Pi(),da=S,Wr=N,da.attachEvent("onpropertychange",su)):y==="focusout"&&Pi()}function ou(y){if(y==="selectionchange"||y==="keyup"||y==="keydown")return sl(Wr)}function ol(y,S){if(y==="click")return sl(S)}function er(y,S){if(y==="input"||y==="change")return sl(S)}function ru(y,S){return y===S&&(y!==0||1/y===1/S)||y!==y&&S!==S}var os=typeof Object.is=="function"?Object.is:ru;function Ls(y,S){if(os(y,S))return!0;if(typeof y!="object"||y===null||typeof S!="object"||S===null)return!1;var N=Object.keys(y),H=Object.keys(S);if(N.length!==H.length)return!1;for(H=0;H<N.length;H++){var O=N[H];if(!Yt.call(S,O)||!os(y[O],S[O]))return!1}return!0}function rs(y){for(;y&&y.firstChild;)y=y.firstChild;return y}function Fc(y,S){var N=rs(y);y=0;for(var H;N;){if(N.nodeType===3){if(H=y+N.textContent.length,y<=S&&H>=S)return{node:N,offset:S-y};y=H}e:{for(;N;){if(N.nextSibling){N=N.nextSibling;break e}N=N.parentNode}N=void 0}N=rs(N)}}function Kc(y,S){return y&&S?y===S?!0:y&&y.nodeType===3?!1:S&&S.nodeType===3?Kc(y,S.parentNode):"contains"in y?y.contains(S):y.compareDocumentPosition?!!(y.compareDocumentPosition(S)&16):!1:!1}function kc(y){y=y!=null&&y.ownerDocument!=null&&y.ownerDocument.defaultView!=null?y.ownerDocument.defaultView:window;for(var S=Cs(y.document);S instanceof y.HTMLIFrameElement;){try{var N=typeof S.contentWindow.location.href=="string"}catch{N=!1}if(N)y=S.contentWindow;else break;S=Cs(y.document)}return S}function rl(y){var S=y&&y.nodeName&&y.nodeName.toLowerCase();return S&&(S==="input"&&(y.type==="text"||y.type==="search"||y.type==="tel"||y.type==="url"||y.type==="password")||S==="textarea"||y.contentEditable==="true")}function Pc(y,S){var N=kc(S);S=y.focusedElem;var H=y.selectionRange;if(N!==S&&S&&S.ownerDocument&&Kc(S.ownerDocument.documentElement,S)){if(H!==null&&rl(S)){if(y=H.start,N=H.end,N===void 0&&(N=y),"selectionStart"in S)S.selectionStart=y,S.selectionEnd=Math.min(N,S.value.length);else if(N=(y=S.ownerDocument||document)&&y.defaultView||window,N.getSelection){N=N.getSelection();var O=S.textContent.length,Q=Math.min(H.start,O);H=H.end===void 0?Q:Math.min(H.end,O),!N.extend&&Q>H&&(O=H,H=Q,Q=O),O=Fc(S,Q);var ae=Fc(S,H);O&&ae&&(N.rangeCount!==1||N.anchorNode!==O.node||N.anchorOffset!==O.offset||N.focusNode!==ae.node||N.focusOffset!==ae.offset)&&(y=y.createRange(),y.setStart(O.node,O.offset),N.removeAllRanges(),Q>H?(N.addRange(y),N.extend(ae.node,ae.offset)):(y.setEnd(ae.node,ae.offset),N.addRange(y)))}}for(y=[],N=S;N=N.parentNode;)N.nodeType===1&&y.push({element:N,left:N.scrollLeft,top:N.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<y.length;S++)N=y[S],N.element.scrollLeft=N.left,N.element.scrollTop=N.top}}var Ol=Nt&&"documentMode"in document&&11>=document.documentMode,Er=null,Dc=null,fa=null,Ul=!1;function vs(y,S,N){var H=N.window===N?N.document:N.nodeType===9?N:N.ownerDocument;Ul||Er==null||Er!==Cs(H)||(H=Er,"selectionStart"in H&&rl(H)?H={start:H.selectionStart,end:H.selectionEnd}:(H=(H.ownerDocument&&H.ownerDocument.defaultView||window).getSelection(),H={anchorNode:H.anchorNode,anchorOffset:H.anchorOffset,focusNode:H.focusNode,focusOffset:H.focusOffset}),fa&&Ls(fa,H)||(fa=H,H=ih(Dc,"onSelect"),0<H.length&&(S=new la("onSelect","select",null,S,N),y.push({event:S,listeners:H}),S.target=Er)))}function bo(y,S){var N={};return N[y.toLowerCase()]=S.toLowerCase(),N["Webkit"+y]="webkit"+S,N["Moz"+y]="moz"+S,N}var Yr={animationend:bo("Animation","AnimationEnd"),animationiteration:bo("Animation","AnimationIteration"),animationstart:bo("Animation","AnimationStart"),transitionrun:bo("Transition","TransitionRun"),transitionstart:bo("Transition","TransitionStart"),transitioncancel:bo("Transition","TransitionCancel"),transitionend:bo("Transition","TransitionEnd")},Oc={},$l={};Nt&&($l=document.createElement("div").style,"AnimationEvent"in window||(delete Yr.animationend.animation,delete Yr.animationiteration.animation,delete Yr.animationstart.animation),"TransitionEvent"in window||delete Yr.transitionend.transition);function gn(y){if(Oc[y])return Oc[y];if(!Yr[y])return y;var S=Yr[y],N;for(N in S)if(S.hasOwnProperty(N)&&N in $l)return Oc[y]=S[N];return y}var Uc=gn("animationend"),as=gn("animationiteration"),$c=gn("animationstart"),yo=gn("transitionrun"),pa=gn("transitionstart"),tr=gn("transitioncancel"),Ql=gn("transitionend"),jl=new Map,Go="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Bs(y,S){jl.set(y,S),Mt(S,[y])}var wn=[],js=0,vo=0;function al(){for(var y=js,S=vo=js=0;S<y;){var N=wn[S];wn[S++]=null;var H=wn[S];wn[S++]=null;var O=wn[S];wn[S++]=null;var Q=wn[S];if(wn[S++]=null,H!==null&&O!==null){var ae=H.pending;ae===null?O.next=O:(O.next=ae.next,ae.next=O),H.pending=O}Q!==0&&cl(N,O,Q)}}function ll(y,S,N,H){wn[js++]=y,wn[js++]=S,wn[js++]=N,wn[js++]=H,vo|=H,y.lanes|=H,y=y.alternate,y!==null&&(y.lanes|=H)}function Tr(y,S,N,H){return ll(y,S,N,H),gl(y)}function Bo(y,S){return ll(y,null,null,S),gl(y)}function cl(y,S,N){y.lanes|=N;var H=y.alternate;H!==null&&(H.lanes|=N);for(var O=!1,Q=y.return;Q!==null;)Q.childLanes|=N,H=Q.alternate,H!==null&&(H.childLanes|=N),Q.tag===22&&(y=Q.stateNode,y===null||y._visibility&1||(O=!0)),y=Q,Q=Q.return;O&&S!==null&&y.tag===3&&(Q=y.stateNode,O=31-Ee(N),Q=Q.hiddenUpdates,y=Q[O],y===null?Q[O]=[S]:y.push(S),S.lane=N|536870912)}function gl(y){if(50<Vs)throw Vs=0,ko=null,Error(r(185));for(var S=y.return;S!==null;)y=S,S=y.return;return y.tag===3?y.stateNode:null}var ir={},ql=new WeakMap;function ls(y,S){if(typeof y=="object"&&y!==null){var N=ql.get(y);return N!==void 0?N:(S={value:y,source:S,stack:Ze(S)},ql.set(y,S),S)}return{value:y,source:S,stack:Ze(S)}}var Jr=[],nr=0,En=null,ul=0,Hi=[],Is=0,So=null,qs=1,Xo="";function On(y,S){Jr[nr++]=ul,Jr[nr++]=En,En=y,ul=S}function Qc(y,S,N){Hi[Is++]=qs,Hi[Is++]=Xo,Hi[Is++]=So,So=y;var H=qs;y=Xo;var O=32-Ee(H)-1;H&=~(1<<O),N+=1;var Q=32-Ee(S)+O;if(30<Q){var ae=O-O%5;Q=(H&(1<<ae)-1).toString(32),H>>=ae,O-=ae,qs=1<<32-Ee(S)+O|N<<O|H,Xo=Q+y}else qs=1<<Q|N<<O|H,Xo=y}function hl(y){y.return!==null&&(On(y,1),Qc(y,1,0))}function sr(y){for(;y===En;)En=Jr[--nr],Jr[nr]=null,ul=Jr[--nr],Jr[nr]=null;for(;y===So;)So=Hi[--Is],Hi[Is]=null,Xo=Hi[--Is],Hi[Is]=null,qs=Hi[--Is],Hi[Is]=null}var Yn=null,Sn=null,mi=!1,Ss=null,Xs=!1,dl=Error(r(519));function Hr(y){var S=Error(r(418,""));throw eo(ls(S,y)),dl}function au(y){var S=y.stateNode,N=y.type,H=y.memoizedProps;switch(S[Ti]=y,S[Qt]=H,N){case"dialog":yi("cancel",S),yi("close",S);break;case"iframe":case"object":case"embed":yi("load",S);break;case"video":case"audio":for(N=0;N<Mg.length;N++)yi(Mg[N],S);break;case"source":yi("error",S);break;case"img":case"image":case"link":yi("error",S),yi("load",S);break;case"details":yi("toggle",S);break;case"input":yi("invalid",S),Wn(S,H.value,H.defaultValue,H.checked,H.defaultChecked,H.type,H.name,!0),Ii(S);break;case"select":yi("invalid",S);break;case"textarea":yi("invalid",S),Hs(S,H.value,H.defaultValue,H.children),Ii(S)}N=H.children,typeof N!="string"&&typeof N!="number"&&typeof N!="bigint"||S.textContent===""+N||H.suppressHydrationWarning===!0||ad(S.textContent,N)?(H.popover!=null&&(yi("beforetoggle",S),yi("toggle",S)),H.onScroll!=null&&yi("scroll",S),H.onScrollEnd!=null&&yi("scrollend",S),H.onClick!=null&&(S.onclick=nh),S=!0):S=!1,S||Hr(y)}function lu(y){for(Yn=y.return;Yn;)switch(Yn.tag){case 3:case 27:Xs=!0;return;case 5:case 13:Xs=!1;return;default:Yn=Yn.return}}function Aa(y){if(y!==Yn)return!1;if(!mi)return lu(y),mi=!0,!1;var S=!1,N;if((N=y.tag!==3&&y.tag!==27)&&((N=y.tag===5)&&(N=y.type,N=!(N!=="form"&&N!=="button")||Jh(y.type,y.memoizedProps)),N=!N),N&&(S=!0),S&&Sn&&Hr(y),lu(y),y.tag===13){if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));e:{for(y=y.nextSibling,S=0;y;){if(y.nodeType===8)if(N=y.data,N==="/$"){if(S===0){Sn=Do(y.nextSibling);break e}S--}else N!=="$"&&N!=="$!"&&N!=="$?"||S++;y=y.nextSibling}Sn=null}}else Sn=Yn?Do(y.stateNode.nextSibling):null;return!0}function ma(){Sn=Yn=null,mi=!1}function eo(y){Ss===null?Ss=[y]:Ss.push(y)}var or=Error(r(460)),qc=Error(r(474)),ec={then:function(){}};function cu(y){return y=y.status,y==="fulfilled"||y==="rejected"}function Cl(){}function rr(y,S,N){switch(N=y[N],N===void 0?y.push(S):N!==S&&(S.then(Cl,Cl),S=N),S.status){case"fulfilled":return S.value;case"rejected":throw y=S.reason,y===or?Error(r(483)):y;default:if(typeof S.status=="string")S.then(Cl,Cl);else{if(y=Mi,y!==null&&100<y.shellSuspendCounter)throw Error(r(482));y=S,y.status="pending",y.then(function(H){if(S.status==="pending"){var O=S;O.status="fulfilled",O.value=H}},function(H){if(S.status==="pending"){var O=S;O.status="rejected",O.reason=H}})}switch(S.status){case"fulfilled":return S.value;case"rejected":throw y=S.reason,y===or?Error(r(483)):y}throw ba=S,or}}var ba=null;function Si(){if(ba===null)throw Error(r(459));var y=ba;return ba=null,y}var ar=null,Il=0;function fl(y){var S=Il;return Il+=1,ar===null&&(ar=[]),rr(ar,y,S)}function pl(y,S){S=S.props.ref,y.ref=S!==void 0?S:null}function tc(y,S){throw S.$$typeof===d?Error(r(525)):(y=Object.prototype.toString.call(S),Error(r(31,y==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":y)))}function gu(y){var S=y._init;return S(y._payload)}function uu(y){function S(Fe,Ye){if(y){var Ue=Fe.deletions;Ue===null?(Fe.deletions=[Ye],Fe.flags|=16):Ue.push(Ye)}}function N(Fe,Ye){if(!y)return null;for(;Ye!==null;)S(Fe,Ye),Ye=Ye.sibling;return null}function H(Fe){for(var Ye=new Map;Fe!==null;)Fe.key!==null?Ye.set(Fe.key,Fe):Ye.set(Fe.index,Fe),Fe=Fe.sibling;return Ye}function O(Fe,Ye){return Fe=jn(Fe,Ye),Fe.index=0,Fe.sibling=null,Fe}function Q(Fe,Ye,Ue){return Fe.index=Ue,y?(Ue=Fe.alternate,Ue!==null?(Ue=Ue.index,Ue<Ye?(Fe.flags|=33554434,Ye):Ue):(Fe.flags|=33554434,Ye)):(Fe.flags|=1048576,Ye)}function ae(Fe){return y&&Fe.alternate===null&&(Fe.flags|=33554434),Fe}function fe(Fe,Ye,Ue,It){return Ye===null||Ye.tag!==6?(Ye=Cn(Ue,Fe.mode,It),Ye.return=Fe,Ye):(Ye=O(Ye,Ue),Ye.return=Fe,Ye)}function Re(Fe,Ye,Ue,It){var Jt=Ue.type;return Jt===f?ut(Fe,Ye,Ue.props.children,It,Ue.key):Ye!==null&&(Ye.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===L&&gu(Jt)===Ye.type)?(Ye=O(Ye,Ue.props),pl(Ye,Ue),Ye.return=Fe,Ye):(Ye=Wa(Ue.type,Ue.key,Ue.props,null,Fe.mode,It),pl(Ye,Ue),Ye.return=Fe,Ye)}function Je(Fe,Ye,Ue,It){return Ye===null||Ye.tag!==4||Ye.stateNode.containerInfo!==Ue.containerInfo||Ye.stateNode.implementation!==Ue.implementation?(Ye=Rl(Ue,Fe.mode,It),Ye.return=Fe,Ye):(Ye=O(Ye,Ue.children||[]),Ye.return=Fe,Ye)}function ut(Fe,Ye,Ue,It,Jt){return Ye===null||Ye.tag!==7?(Ye=Xr(Ue,Fe.mode,It,Jt),Ye.return=Fe,Ye):(Ye=O(Ye,Ue),Ye.return=Fe,Ye)}function mt(Fe,Ye,Ue){if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint")return Ye=Cn(""+Ye,Fe.mode,Ue),Ye.return=Fe,Ye;if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case C:return Ue=Wa(Ye.type,Ye.key,Ye.props,null,Fe.mode,Ue),pl(Ue,Ye),Ue.return=Fe,Ue;case I:return Ye=Rl(Ye,Fe.mode,Ue),Ye.return=Fe,Ye;case L:var It=Ye._init;return Ye=It(Ye._payload),mt(Fe,Ye,Ue)}if(le(Ye)||$(Ye))return Ye=Xr(Ye,Fe.mode,Ue,null),Ye.return=Fe,Ye;if(typeof Ye.then=="function")return mt(Fe,fl(Ye),Ue);if(Ye.$$typeof===w)return mt(Fe,Ac(Fe,Ye),Ue);tc(Fe,Ye)}return null}function et(Fe,Ye,Ue,It){var Jt=Ye!==null?Ye.key:null;if(typeof Ue=="string"&&Ue!==""||typeof Ue=="number"||typeof Ue=="bigint")return Jt!==null?null:fe(Fe,Ye,""+Ue,It);if(typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case C:return Ue.key===Jt?Re(Fe,Ye,Ue,It):null;case I:return Ue.key===Jt?Je(Fe,Ye,Ue,It):null;case L:return Jt=Ue._init,Ue=Jt(Ue._payload),et(Fe,Ye,Ue,It)}if(le(Ue)||$(Ue))return Jt!==null?null:ut(Fe,Ye,Ue,It,null);if(typeof Ue.then=="function")return et(Fe,Ye,fl(Ue),It);if(Ue.$$typeof===w)return et(Fe,Ye,Ac(Fe,Ue),It);tc(Fe,Ue)}return null}function lt(Fe,Ye,Ue,It,Jt){if(typeof It=="string"&&It!==""||typeof It=="number"||typeof It=="bigint")return Fe=Fe.get(Ue)||null,fe(Ye,Fe,""+It,Jt);if(typeof It=="object"&&It!==null){switch(It.$$typeof){case C:return Fe=Fe.get(It.key===null?Ue:It.key)||null,Re(Ye,Fe,It,Jt);case I:return Fe=Fe.get(It.key===null?Ue:It.key)||null,Je(Ye,Fe,It,Jt);case L:var pi=It._init;return It=pi(It._payload),lt(Fe,Ye,Ue,It,Jt)}if(le(It)||$(It))return Fe=Fe.get(Ue)||null,ut(Ye,Fe,It,Jt,null);if(typeof It.then=="function")return lt(Fe,Ye,Ue,fl(It),Jt);if(It.$$typeof===w)return lt(Fe,Ye,Ue,Ac(Ye,It),Jt);tc(Ye,It)}return null}function Lt(Fe,Ye,Ue,It){for(var Jt=null,pi=null,Kt=Ye,$t=Ye=0,Kn=null;Kt!==null&&$t<Ue.length;$t++){Kt.index>$t?(Kn=Kt,Kt=null):Kn=Kt.sibling;var Xi=et(Fe,Kt,Ue[$t],It);if(Xi===null){Kt===null&&(Kt=Kn);break}y&&Kt&&Xi.alternate===null&&S(Fe,Kt),Ye=Q(Xi,Ye,$t),pi===null?Jt=Xi:pi.sibling=Xi,pi=Xi,Kt=Kn}if($t===Ue.length)return N(Fe,Kt),mi&&On(Fe,$t),Jt;if(Kt===null){for(;$t<Ue.length;$t++)Kt=mt(Fe,Ue[$t],It),Kt!==null&&(Ye=Q(Kt,Ye,$t),pi===null?Jt=Kt:pi.sibling=Kt,pi=Kt);return mi&&On(Fe,$t),Jt}for(Kt=H(Kt);$t<Ue.length;$t++)Kn=lt(Kt,Fe,$t,Ue[$t],It),Kn!==null&&(y&&Kn.alternate!==null&&Kt.delete(Kn.key===null?$t:Kn.key),Ye=Q(Kn,Ye,$t),pi===null?Jt=Kn:pi.sibling=Kn,pi=Kn);return y&&Kt.forEach(function(Ka){return S(Fe,Ka)}),mi&&On(Fe,$t),Jt}function ni(Fe,Ye,Ue,It){if(Ue==null)throw Error(r(151));for(var Jt=null,pi=null,Kt=Ye,$t=Ye=0,Kn=null,Xi=Ue.next();Kt!==null&&!Xi.done;$t++,Xi=Ue.next()){Kt.index>$t?(Kn=Kt,Kt=null):Kn=Kt.sibling;var Ka=et(Fe,Kt,Xi.value,It);if(Ka===null){Kt===null&&(Kt=Kn);break}y&&Kt&&Ka.alternate===null&&S(Fe,Kt),Ye=Q(Ka,Ye,$t),pi===null?Jt=Ka:pi.sibling=Ka,pi=Ka,Kt=Kn}if(Xi.done)return N(Fe,Kt),mi&&On(Fe,$t),Jt;if(Kt===null){for(;!Xi.done;$t++,Xi=Ue.next())Xi=mt(Fe,Xi.value,It),Xi!==null&&(Ye=Q(Xi,Ye,$t),pi===null?Jt=Xi:pi.sibling=Xi,pi=Xi);return mi&&On(Fe,$t),Jt}for(Kt=H(Kt);!Xi.done;$t++,Xi=Ue.next())Xi=lt(Kt,Fe,$t,Xi.value,It),Xi!==null&&(y&&Xi.alternate!==null&&Kt.delete(Xi.key===null?$t:Xi.key),Ye=Q(Xi,Ye,$t),pi===null?Jt=Xi:pi.sibling=Xi,pi=Xi);return y&&Kt.forEach(function(IC){return S(Fe,IC)}),mi&&On(Fe,$t),Jt}function pn(Fe,Ye,Ue,It){if(typeof Ue=="object"&&Ue!==null&&Ue.type===f&&Ue.key===null&&(Ue=Ue.props.children),typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case C:e:{for(var Jt=Ue.key;Ye!==null;){if(Ye.key===Jt){if(Jt=Ue.type,Jt===f){if(Ye.tag===7){N(Fe,Ye.sibling),It=O(Ye,Ue.props.children),It.return=Fe,Fe=It;break e}}else if(Ye.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===L&&gu(Jt)===Ye.type){N(Fe,Ye.sibling),It=O(Ye,Ue.props),pl(It,Ue),It.return=Fe,Fe=It;break e}N(Fe,Ye);break}else S(Fe,Ye);Ye=Ye.sibling}Ue.type===f?(It=Xr(Ue.props.children,Fe.mode,It,Ue.key),It.return=Fe,Fe=It):(It=Wa(Ue.type,Ue.key,Ue.props,null,Fe.mode,It),pl(It,Ue),It.return=Fe,Fe=It)}return ae(Fe);case I:e:{for(Jt=Ue.key;Ye!==null;){if(Ye.key===Jt)if(Ye.tag===4&&Ye.stateNode.containerInfo===Ue.containerInfo&&Ye.stateNode.implementation===Ue.implementation){N(Fe,Ye.sibling),It=O(Ye,Ue.children||[]),It.return=Fe,Fe=It;break e}else{N(Fe,Ye);break}else S(Fe,Ye);Ye=Ye.sibling}It=Rl(Ue,Fe.mode,It),It.return=Fe,Fe=It}return ae(Fe);case L:return Jt=Ue._init,Ue=Jt(Ue._payload),pn(Fe,Ye,Ue,It)}if(le(Ue))return Lt(Fe,Ye,Ue,It);if($(Ue)){if(Jt=$(Ue),typeof Jt!="function")throw Error(r(150));return Ue=Jt.call(Ue),ni(Fe,Ye,Ue,It)}if(typeof Ue.then=="function")return pn(Fe,Ye,fl(Ue),It);if(Ue.$$typeof===w)return pn(Fe,Ye,Ac(Fe,Ue),It);tc(Fe,Ue)}return typeof Ue=="string"&&Ue!==""||typeof Ue=="number"||typeof Ue=="bigint"?(Ue=""+Ue,Ye!==null&&Ye.tag===6?(N(Fe,Ye.sibling),It=O(Ye,Ue),It.return=Fe,Fe=It):(N(Fe,Ye),It=Cn(Ue,Fe.mode,It),It.return=Fe,Fe=It),ae(Fe)):N(Fe,Ye)}return function(Fe,Ye,Ue,It){try{Il=0;var Jt=pn(Fe,Ye,Ue,It);return ar=null,Jt}catch(Kt){if(Kt===or)throw Kt;var pi=an(29,Kt,null,Fe.mode);return pi.lanes=It,pi.return=Fe,pi}finally{}}}var Zo=uu(!0),xo=uu(!1),Lr=We(null),zr=We(0);function lr(y,S){y=Ko,nt(zr,y),nt(Lr,S),Ko=y|S.baseLanes}function ic(){nt(zr,Ko),nt(Lr,Lr.current)}function Al(){Ko=zr.current,dt(Lr),dt(zr)}var cs=We(null),to=null;function Ro(y){var S=y.alternate;nt(un,un.current&1),nt(cs,y),to===null&&(S===null||Lr.current!==null||S.memoizedState!==null)&&(to=y)}function eg(y){if(y.tag===22){if(nt(un,un.current),nt(cs,y),to===null){var S=y.alternate;S!==null&&S.memoizedState!==null&&(to=y)}}else _o()}function _o(){nt(un,un.current),nt(cs,cs.current)}function io(y){dt(cs),to===y&&(to=null),dt(un)}var un=We(0);function ya(y){for(var S=y;S!==null;){if(S.tag===13){var N=S.memoizedState;if(N!==null&&(N=N.dehydrated,N===null||N.data==="$?"||N.data==="$!"))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===y)break;for(;S.sibling===null;){if(S.return===null||S.return===y)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var gi=typeof AbortController<"u"?AbortController:function(){var y=[],S=this.signal={aborted:!1,addEventListener:function(N,H){y.push(H)}};this.abort=function(){S.aborted=!0,y.forEach(function(N){return N()})}},bh=n.unstable_scheduleCallback,fs=n.unstable_NormalPriority,en={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function tg(){return{controller:new gi,data:new Map,refCount:0}}function cr(y){y.refCount--,y.refCount===0&&bh(fs,function(){y.controller.abort()})}var no=null,gr=0,Fr=0,ur=null;function yh(y,S){if(no===null){var N=no=[];gr=0,Fr=_h(),ur={status:"pending",value:void 0,then:function(H){N.push(H)}}}return gr++,S.then(ig,ig),S}function ig(){if(--gr===0&&no!==null){ur!==null&&(ur.status="fulfilled");var y=no;no=null,Fr=0,ur=null;for(var S=0;S<y.length;S++)(0,y[S])()}}function hr(y,S){var N=[],H={status:"pending",value:null,reason:null,then:function(O){N.push(O)}};return y.then(function(){H.status="fulfilled",H.value=S;for(var O=0;O<N.length;O++)(0,N[O])(S)},function(O){for(H.status="rejected",H.reason=O,O=0;O<N.length;O++)(0,N[O])(void 0)}),H}var nc=ee.S;ee.S=function(y,S){typeof S=="object"&&S!==null&&typeof S.then=="function"&&yh(y,S),nc!==null&&nc(y,S)};var wo=We(null);function ml(){var y=wo.current;return y!==null?y:Mi.pooledCache}function Ga(y,S){S===null?nt(wo,wo.current):nt(wo,S.pool)}function Mo(){var y=ml();return y===null?null:{parent:en._currentValue,pool:y}}var No=0,oi=null,Ri=null,hn=null,Ut=!1,dr=!1,Cr=!1,va=0,Ir=0,Ba=null,Gh=0;function ji(){throw Error(r(321))}function Kr(y,S){if(S===null)return!1;for(var N=0;N<S.length&&N<y.length;N++)if(!os(y[N],S[N]))return!1;return!0}function ng(y,S,N,H,O,Q){return No=Q,oi=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,ee.H=y===null||y.memoizedState===null?pr:Wo,Cr=!1,Q=N(H,O),Cr=!1,dr&&(Q=du(S,N,H,O)),hu(y),Q}function hu(y){ee.H=oo;var S=Ri!==null&&Ri.next!==null;if(No=0,hn=Ri=oi=null,Ut=!1,Ir=0,Ba=null,S)throw Error(r(300));y===null||bn||(y=y.dependencies,y!==null&&Ra(y)&&(bn=!0))}function du(y,S,N,H){oi=y;var O=0;do{if(dr&&(Ba=null),Ir=0,dr=!1,25<=O)throw Error(r(301));if(O+=1,hn=Ri=null,y.updateQueue!=null){var Q=y.updateQueue;Q.lastEffect=null,Q.events=null,Q.stores=null,Q.memoCache!=null&&(Q.memoCache.index=0)}ee.H=Dr,Q=S(N,H)}while(dr);return Q}function vh(){var y=ee.H,S=y.useState()[0];return S=typeof S.then=="function"?yl(S):S,y=y.useState()[0],(Ri!==null?Ri.memoizedState:null)!==y&&(oi.flags|=1024),S}function sg(){var y=va!==0;return va=0,y}function bl(y,S,N){S.updateQueue=y.updateQueue,S.flags&=-2053,y.lanes&=~N}function sc(y){if(Ut){for(y=y.memoizedState;y!==null;){var S=y.queue;S!==null&&(S.pending=null),y=y.next}Ut=!1}No=0,hn=Ri=oi=null,dr=!1,Ir=va=0,Ba=null}function Mn(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hn===null?oi.memoizedState=hn=y:hn=hn.next=y,hn}function tn(){if(Ri===null){var y=oi.alternate;y=y!==null?y.memoizedState:null}else y=Ri.next;var S=hn===null?oi.memoizedState:hn.next;if(S!==null)hn=S,Ri=y;else{if(y===null)throw oi.alternate===null?Error(r(467)):Error(r(310));Ri=y,y={memoizedState:Ri.memoizedState,baseState:Ri.baseState,baseQueue:Ri.baseQueue,queue:Ri.queue,next:null},hn===null?oi.memoizedState=hn=y:hn=hn.next=y}return hn}var oc;oc=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function yl(y){var S=Ir;return Ir+=1,Ba===null&&(Ba=[]),y=rr(Ba,y,S),S=oi,(hn===null?S.memoizedState:hn.next)===null&&(S=S.alternate,ee.H=S===null||S.memoizedState===null?pr:Wo),y}function Sa(y){if(y!==null&&typeof y=="object"){if(typeof y.then=="function")return yl(y);if(y.$$typeof===w)return Tn(y)}throw Error(r(438,String(y)))}function zs(y){var S=null,N=oi.updateQueue;if(N!==null&&(S=N.memoCache),S==null){var H=oi.alternate;H!==null&&(H=H.updateQueue,H!==null&&(H=H.memoCache,H!=null&&(S={data:H.data.map(function(O){return O.slice()}),index:0})))}if(S==null&&(S={data:[],index:0}),N===null&&(N=oc(),oi.updateQueue=N),N.memoCache=S,N=S.data[S.index],N===void 0)for(N=S.data[S.index]=Array(y),H=0;H<y;H++)N[H]=K;return S.index++,N}function Di(y,S){return typeof S=="function"?S(y):S}function Fs(y){var S=tn();return gs(S,Ri,y)}function gs(y,S,N){var H=y.queue;if(H===null)throw Error(r(311));H.lastRenderedReducer=N;var O=y.baseQueue,Q=H.pending;if(Q!==null){if(O!==null){var ae=O.next;O.next=Q.next,Q.next=ae}S.baseQueue=O=Q,H.pending=null}if(Q=y.baseState,O===null)y.memoizedState=Q;else{S=O.next;var fe=ae=null,Re=null,Je=S,ut=!1;do{var mt=Je.lane&-536870913;if(mt!==Je.lane?(kt&mt)===mt:(No&mt)===mt){var et=Je.revertLane;if(et===0)Re!==null&&(Re=Re.next={lane:0,revertLane:0,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null}),mt===Fr&&(ut=!0);else if((No&et)===et){Je=Je.next,et===Fr&&(ut=!0);continue}else mt={lane:0,revertLane:Je.revertLane,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null},Re===null?(fe=Re=mt,ae=Q):Re=Re.next=mt,oi.lanes|=et,$s|=et;mt=Je.action,Cr&&N(Q,mt),Q=Je.hasEagerState?Je.eagerState:N(Q,mt)}else et={lane:mt,revertLane:Je.revertLane,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null},Re===null?(fe=Re=et,ae=Q):Re=Re.next=et,oi.lanes|=mt,$s|=mt;Je=Je.next}while(Je!==null&&Je!==S);if(Re===null?ae=Q:Re.next=fe,!os(Q,y.memoizedState)&&(bn=!0,ut&&(N=ur,N!==null)))throw N;y.memoizedState=Q,y.baseState=ae,y.baseQueue=Re,H.lastRenderedState=Q}return O===null&&(H.lanes=0),[y.memoizedState,H.dispatch]}function rc(y){var S=tn(),N=S.queue;if(N===null)throw Error(r(311));N.lastRenderedReducer=y;var H=N.dispatch,O=N.pending,Q=S.memoizedState;if(O!==null){N.pending=null;var ae=O=O.next;do Q=y(Q,ae.action),ae=ae.next;while(ae!==O);os(Q,S.memoizedState)||(bn=!0),S.memoizedState=Q,S.baseQueue===null&&(S.baseState=Q),N.lastRenderedState=Q}return[Q,H]}function Cu(y,S,N){var H=oi,O=tn(),Q=mi;if(Q){if(N===void 0)throw Error(r(407));N=N()}else N=S();var ae=!os((Ri||O).memoizedState,N);if(ae&&(O.memoizedState=N,bn=!0),O=O.queue,lg(Iu.bind(null,H,O,y),[y]),O.getSnapshot!==S||ae||hn!==null&&hn.memoizedState.tag&1){if(H.flags|=2048,so(9,fr.bind(null,H,O,N,S),{destroy:void 0},null),Mi===null)throw Error(r(349));Q||(No&60)!==0||Un(H,S,N)}return N}function Un(y,S,N){y.flags|=16384,y={getSnapshot:S,value:N},S=oi.updateQueue,S===null?(S=oc(),oi.updateQueue=S,S.stores=[y]):(N=S.stores,N===null?S.stores=[y]:N.push(y))}function fr(y,S,N,H){S.value=N,S.getSnapshot=H,fu(S)&&pu(y)}function Iu(y,S,N){return N(function(){fu(S)&&pu(y)})}function fu(y){var S=y.getSnapshot;y=y.value;try{var N=S();return!os(y,N)}catch{return!0}}function pu(y){var S=Bo(y,2);S!==null&&fn(S,y,2)}function og(y){var S=Mn();if(typeof y=="function"){var N=y;if(y=N(),Cr){me(!0);try{N()}finally{me(!1)}}}return S.memoizedState=S.baseState=y,S.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Di,lastRenderedState:y},S}function rg(y,S,N,H){return y.baseState=N,gs(y,Ri,typeof H=="function"?H:Di)}function Bh(y,S,N,H,O){if(uc(y))throw Error(r(485));if(y=S.action,y!==null){var Q={payload:O,action:y,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ae){Q.listeners.push(ae)}};ee.T!==null?N(!0):Q.isTransition=!1,H(Q),N=S.pending,N===null?(Q.next=S.pending=Q,ag(S,Q)):(Q.next=N.next,S.pending=N.next=Q)}}function ag(y,S){var N=S.action,H=S.payload,O=y.state;if(S.isTransition){var Q=ee.T,ae={};ee.T=ae;try{var fe=N(O,H),Re=ee.S;Re!==null&&Re(ae,fe),Au(y,S,fe)}catch(Je){Vo(y,S,Je)}finally{ee.T=Q}}else try{Q=N(O,H),Au(y,S,Q)}catch(Je){Vo(y,S,Je)}}function Au(y,S,N){N!==null&&typeof N=="object"&&typeof N.then=="function"?N.then(function(H){kr(y,S,H)},function(H){return Vo(y,S,H)}):kr(y,S,N)}function kr(y,S,N){S.status="fulfilled",S.value=N,mu(S),y.state=N,S=y.pending,S!==null&&(N=S.next,N===S?y.pending=null:(N=N.next,S.next=N,ag(y,N)))}function Vo(y,S,N){var H=y.pending;if(y.pending=null,H!==null){H=H.next;do S.status="rejected",S.reason=N,mu(S),S=S.next;while(S!==H)}y.action=null}function mu(y){y=y.listeners;for(var S=0;S<y.length;S++)(0,y[S])()}function bu(y,S){return S}function yu(y,S){if(mi){var N=Mi.formState;if(N!==null){e:{var H=oi;if(mi){if(Sn){t:{for(var O=Sn,Q=Xs;O.nodeType!==8;){if(!Q){O=null;break t}if(O=Do(O.nextSibling),O===null){O=null;break t}}Q=O.data,O=Q==="F!"||Q==="F"?O:null}if(O){Sn=Do(O.nextSibling),H=O.data==="F!";break e}}Hr(H)}H=!1}H&&(S=N[0])}}return N=Mn(),N.memoizedState=N.baseState=S,H={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bu,lastRenderedState:S},N.queue=H,N=hg.bind(null,oi,H),H.dispatch=N,H=og(!1),Q=Gl.bind(null,oi,!1,H.queue),H=Mn(),O={state:S,dispatch:null,action:y,pending:null},H.queue=O,N=Bh.bind(null,oi,O,Q,N),O.dispatch=N,H.memoizedState=y,[S,N,!1]}function Xa(y){var S=tn();return Gu(S,Ri,y)}function Gu(y,S,N){S=gs(y,S,bu)[0],y=Fs(Di)[0],S=typeof S=="object"&&S!==null&&typeof S.then=="function"?yl(S):S;var H=tn(),O=H.queue,Q=O.dispatch;return N!==H.memoizedState&&(oi.flags|=2048,so(9,Sh.bind(null,O,N),{destroy:void 0},null)),[S,Q,y]}function Sh(y,S){y.action=S}function vu(y){var S=tn(),N=Ri;if(N!==null)return Gu(S,N,y);tn(),S=S.memoizedState,N=tn();var H=N.queue.dispatch;return N.memoizedState=y,[S,H,!1]}function so(y,S,N,H){return y={tag:y,create:S,inst:N,deps:H,next:null},S=oi.updateQueue,S===null&&(S=oc(),oi.updateQueue=S),N=S.lastEffect,N===null?S.lastEffect=y.next=y:(H=N.next,N.next=y,y.next=H,S.lastEffect=y),y}function Bu(){return tn().memoizedState}function ac(y,S,N,H){var O=Mn();oi.flags|=y,O.memoizedState=so(1|S,N,{destroy:void 0},H===void 0?null:H)}function lc(y,S,N,H){var O=tn();H=H===void 0?null:H;var Q=O.memoizedState.inst;Ri!==null&&H!==null&&Kr(H,Ri.memoizedState.deps)?O.memoizedState=so(S,N,Q,H):(oi.flags|=y,O.memoizedState=so(1|S,N,Q,H))}function Su(y,S){ac(8390656,8,y,S)}function lg(y,S){lc(2048,8,y,S)}function Xu(y,S){return lc(4,2,y,S)}function Zu(y,S){return lc(4,4,y,S)}function xu(y,S){if(typeof S=="function"){y=y();var N=S(y);return function(){typeof N=="function"?N():S(null)}}if(S!=null)return y=y(),S.current=y,function(){S.current=null}}function Ru(y,S,N){N=N!=null?N.concat([y]):null,lc(4,4,xu.bind(null,S,y),N)}function cg(){}function _u(y,S){var N=tn();S=S===void 0?null:S;var H=N.memoizedState;return S!==null&&Kr(S,H[1])?H[0]:(N.memoizedState=[y,S],y)}function wu(y,S){var N=tn();S=S===void 0?null:S;var H=N.memoizedState;if(S!==null&&Kr(S,H[1]))return H[0];if(H=y(),Cr){me(!0);try{y()}finally{me(!1)}}return N.memoizedState=[H,S],H}function cc(y,S,N){return N===void 0||(No&1073741824)!==0?y.memoizedState=S:(y.memoizedState=N,y=ys(),oi.lanes|=y,$s|=y,N)}function Mu(y,S,N,H){return os(N,S)?N:Lr.current!==null?(y=cc(y,N,H),os(y,S)||(bn=!0),y):(No&42)===0?(bn=!0,y.memoizedState=N):(y=ys(),oi.lanes|=y,$s|=y,S)}function Nu(y,S,N,H,O){var Q=Ae.p;Ae.p=Q!==0&&8>Q?Q:8;var ae=ee.T,fe={};ee.T=fe,Gl(y,!1,S,N);try{var Re=O(),Je=ee.S;if(Je!==null&&Je(fe,Re),Re!==null&&typeof Re=="object"&&typeof Re.then=="function"){var ut=hr(Re,H);Pr(y,S,ut,es(y))}else Pr(y,S,H,es(y))}catch(mt){Pr(y,S,{then:function(){},status:"rejected",reason:mt},es())}finally{Ae.p=Q,ee.T=ae}}function Xh(){}function gg(y,S,N,H){if(y.tag!==5)throw Error(r(476));var O=Vu(y).queue;Nu(y,O,S,Xe,N===null?Xh:function(){return Wu(y),N(H)})}function Vu(y){var S=y.memoizedState;if(S!==null)return S;S={memoizedState:Xe,baseState:Xe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Di,lastRenderedState:Xe},next:null};var N={};return S.next={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Di,lastRenderedState:N},next:null},y.memoizedState=S,y=y.alternate,y!==null&&(y.memoizedState=S),S}function Wu(y){var S=Vu(y).next.queue;Pr(y,S,{},es())}function gc(){return Tn(Yg)}function ug(){return tn().memoizedState}function Eu(){return tn().memoizedState}function Yu(y){for(var S=y.return;S!==null;){switch(S.tag){case 24:case 3:var N=es();y=ms(N);var H=bs(S,y,N);H!==null&&(fn(H,S,N),br(H,S,N)),S={cache:tg()},y.payload=S;return}S=S.return}}function Tu(y,S,N){var H=es();N={lane:H,revertLane:0,action:N,hasEagerState:!1,eagerState:null,next:null},uc(y)?Ju(S,N):(N=Tr(y,S,N,H),N!==null&&(fn(N,y,H),Hu(N,S,H)))}function hg(y,S,N){var H=es();Pr(y,S,N,H)}function Pr(y,S,N,H){var O={lane:H,revertLane:0,action:N,hasEagerState:!1,eagerState:null,next:null};if(uc(y))Ju(S,O);else{var Q=y.alternate;if(y.lanes===0&&(Q===null||Q.lanes===0)&&(Q=S.lastRenderedReducer,Q!==null))try{var ae=S.lastRenderedState,fe=Q(ae,N);if(O.hasEagerState=!0,O.eagerState=fe,os(fe,ae))return ll(y,S,O,0),Mi===null&&al(),!1}catch{}finally{}if(N=Tr(y,S,O,H),N!==null)return fn(N,y,H),Hu(N,S,H),!0}return!1}function Gl(y,S,N,H){if(H={lane:2,revertLane:_h(),action:H,hasEagerState:!1,eagerState:null,next:null},uc(y)){if(S)throw Error(r(479))}else S=Tr(y,N,H,2),S!==null&&fn(S,y,2)}function uc(y){var S=y.alternate;return y===oi||S!==null&&S===oi}function Ju(y,S){dr=Ut=!0;var N=y.pending;N===null?S.next=S:(S.next=N.next,N.next=S),y.pending=S}function Hu(y,S,N){if((N&4194176)!==0){var H=S.lanes;H&=y.pendingLanes,N|=H,S.lanes=N,An(y,N)}}var oo={readContext:Tn,use:Sa,useCallback:ji,useContext:ji,useEffect:ji,useImperativeHandle:ji,useLayoutEffect:ji,useInsertionEffect:ji,useMemo:ji,useReducer:ji,useRef:ji,useState:ji,useDebugValue:ji,useDeferredValue:ji,useTransition:ji,useSyncExternalStore:ji,useId:ji};oo.useCacheRefresh=ji,oo.useMemoCache=ji,oo.useHostTransitionStatus=ji,oo.useFormState=ji,oo.useActionState=ji,oo.useOptimistic=ji;var pr={readContext:Tn,use:Sa,useCallback:function(y,S){return Mn().memoizedState=[y,S===void 0?null:S],y},useContext:Tn,useEffect:Su,useImperativeHandle:function(y,S,N){N=N!=null?N.concat([y]):null,ac(4194308,4,xu.bind(null,S,y),N)},useLayoutEffect:function(y,S){return ac(4194308,4,y,S)},useInsertionEffect:function(y,S){ac(4,2,y,S)},useMemo:function(y,S){var N=Mn();S=S===void 0?null:S;var H=y();if(Cr){me(!0);try{y()}finally{me(!1)}}return N.memoizedState=[H,S],H},useReducer:function(y,S,N){var H=Mn();if(N!==void 0){var O=N(S);if(Cr){me(!0);try{N(S)}finally{me(!1)}}}else O=S;return H.memoizedState=H.baseState=O,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:O},H.queue=y,y=y.dispatch=Tu.bind(null,oi,y),[H.memoizedState,y]},useRef:function(y){var S=Mn();return y={current:y},S.memoizedState=y},useState:function(y){y=og(y);var S=y.queue,N=hg.bind(null,oi,S);return S.dispatch=N,[y.memoizedState,N]},useDebugValue:cg,useDeferredValue:function(y,S){var N=Mn();return cc(N,y,S)},useTransition:function(){var y=og(!1);return y=Nu.bind(null,oi,y.queue,!0,!1),Mn().memoizedState=y,[!1,y]},useSyncExternalStore:function(y,S,N){var H=oi,O=Mn();if(mi){if(N===void 0)throw Error(r(407));N=N()}else{if(N=S(),Mi===null)throw Error(r(349));(kt&60)!==0||Un(H,S,N)}O.memoizedState=N;var Q={value:N,getSnapshot:S};return O.queue=Q,Su(Iu.bind(null,H,Q,y),[y]),H.flags|=2048,so(9,fr.bind(null,H,Q,N,S),{destroy:void 0},null),N},useId:function(){var y=Mn(),S=Mi.identifierPrefix;if(mi){var N=Xo,H=qs;N=(H&~(1<<32-Ee(H)-1)).toString(32)+N,S=":"+S+"R"+N,N=va++,0<N&&(S+="H"+N.toString(32)),S+=":"}else N=Gh++,S=":"+S+"r"+N.toString(32)+":";return y.memoizedState=S},useCacheRefresh:function(){return Mn().memoizedState=Yu.bind(null,oi)}};pr.useMemoCache=zs,pr.useHostTransitionStatus=gc,pr.useFormState=yu,pr.useActionState=yu,pr.useOptimistic=function(y){var S=Mn();S.memoizedState=S.baseState=y;var N={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return S.queue=N,S=Gl.bind(null,oi,!0,N),N.dispatch=S,[y,S]};var Wo={readContext:Tn,use:Sa,useCallback:_u,useContext:Tn,useEffect:lg,useImperativeHandle:Ru,useInsertionEffect:Xu,useLayoutEffect:Zu,useMemo:wu,useReducer:Fs,useRef:Bu,useState:function(){return Fs(Di)},useDebugValue:cg,useDeferredValue:function(y,S){var N=tn();return Mu(N,Ri.memoizedState,y,S)},useTransition:function(){var y=Fs(Di)[0],S=tn().memoizedState;return[typeof y=="boolean"?y:yl(y),S]},useSyncExternalStore:Cu,useId:ug};Wo.useCacheRefresh=Eu,Wo.useMemoCache=zs,Wo.useHostTransitionStatus=gc,Wo.useFormState=Xa,Wo.useActionState=Xa,Wo.useOptimistic=function(y,S){var N=tn();return rg(N,Ri,y,S)};var Dr={readContext:Tn,use:Sa,useCallback:_u,useContext:Tn,useEffect:lg,useImperativeHandle:Ru,useInsertionEffect:Xu,useLayoutEffect:Zu,useMemo:wu,useReducer:rc,useRef:Bu,useState:function(){return rc(Di)},useDebugValue:cg,useDeferredValue:function(y,S){var N=tn();return Ri===null?cc(N,y,S):Mu(N,Ri.memoizedState,y,S)},useTransition:function(){var y=rc(Di)[0],S=tn().memoizedState;return[typeof y=="boolean"?y:yl(y),S]},useSyncExternalStore:Cu,useId:ug};Dr.useCacheRefresh=Eu,Dr.useMemoCache=zs,Dr.useHostTransitionStatus=gc,Dr.useFormState=vu,Dr.useActionState=vu,Dr.useOptimistic=function(y,S){var N=tn();return Ri!==null?rg(N,Ri,y,S):(N.baseState=y,[y,N.queue.dispatch])};function dg(y,S,N,H){S=y.memoizedState,N=N(H,S),N=N==null?S:se({},S,N),y.memoizedState=N,y.lanes===0&&(y.updateQueue.baseState=N)}var Cg={isMounted:function(y){return(y=y._reactInternals)?Be(y)===y:!1},enqueueSetState:function(y,S,N){y=y._reactInternals;var H=es(),O=ms(H);O.payload=S,N!=null&&(O.callback=N),S=bs(y,O,H),S!==null&&(fn(S,y,H),br(S,y,H))},enqueueReplaceState:function(y,S,N){y=y._reactInternals;var H=es(),O=ms(H);O.tag=1,O.payload=S,N!=null&&(O.callback=N),S=bs(y,O,H),S!==null&&(fn(S,y,H),br(S,y,H))},enqueueForceUpdate:function(y,S){y=y._reactInternals;var N=es(),H=ms(N);H.tag=2,S!=null&&(H.callback=S),S=bs(y,H,N),S!==null&&(fn(S,y,N),br(S,y,N))}};function Lu(y,S,N,H,O,Q,ae){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(H,Q,ae):S.prototype&&S.prototype.isPureReactComponent?!Ls(N,H)||!Ls(O,Q):!0}function zu(y,S,N,H){y=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(N,H),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(N,H),S.state!==y&&Cg.enqueueReplaceState(S,S.state,null)}function Or(y,S){var N=S;if("ref"in S){N={};for(var H in S)H!=="ref"&&(N[H]=S[H])}if(y=y.defaultProps){N===S&&(N=se({},N));for(var O in y)N[O]===void 0&&(N[O]=y[O])}return N}var hc=typeof reportError=="function"?reportError:function(y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var S=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof y=="object"&&y!==null&&typeof y.message=="string"?String(y.message):String(y),error:y});if(!window.dispatchEvent(S))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",y);return}console.error(y)};function Fu(y){hc(y)}function Ku(y){console.error(y)}function ku(y){hc(y)}function dc(y,S){try{var N=y.onUncaughtError;N(S.value,{componentStack:S.stack})}catch(H){setTimeout(function(){throw H})}}function Pu(y,S,N){try{var H=y.onCaughtError;H(N.value,{componentStack:N.stack,errorBoundary:S.tag===1?S.stateNode:null})}catch(O){setTimeout(function(){throw O})}}function Ig(y,S,N){return N=ms(N),N.tag=3,N.payload={element:null},N.callback=function(){dc(y,S)},N}function fg(y){return y=ms(y),y.tag=3,y}function Du(y,S,N,H){var O=N.type.getDerivedStateFromError;if(typeof O=="function"){var Q=H.value;y.payload=function(){return O(Q)},y.callback=function(){Pu(S,N,H)}}var ae=N.stateNode;ae!==null&&typeof ae.componentDidCatch=="function"&&(y.callback=function(){Pu(S,N,H),typeof O!="function"&&(In===null?In=new Set([this]):In.add(this));var fe=H.stack;this.componentDidCatch(H.value,{componentStack:fe!==null?fe:""})})}function Zh(y,S,N,H,O){if(N.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){if(S=N.alternate,S!==null&&Bl(S,N,O,!0),N=cs.current,N!==null){switch(N.tag){case 13:return to===null?Ml():N.alternate===null&&ki===0&&(ki=3),N.flags&=-257,N.flags|=65536,N.lanes=O,H===ec?N.flags|=16384:(S=N.updateQueue,S===null?N.updateQueue=new Set([H]):S.add(H),ti(y,H,O)),!1;case 22:return N.flags|=65536,H===ec?N.flags|=16384:(S=N.updateQueue,S===null?(S={transitions:null,markerInstances:null,retryQueue:new Set([H])},N.updateQueue=S):(N=S.retryQueue,N===null?S.retryQueue=new Set([H]):N.add(H)),ti(y,H,O)),!1}throw Error(r(435,N.tag))}return ti(y,H,O),Ml(),!1}if(mi)return S=cs.current,S!==null?((S.flags&65536)===0&&(S.flags|=256),S.flags|=65536,S.lanes=O,H!==dl&&(y=Error(r(422),{cause:H}),eo(ls(y,N)))):(H!==dl&&(S=Error(r(423),{cause:H}),eo(ls(S,N))),y=y.current.alternate,y.flags|=65536,O&=-O,y.lanes|=O,H=ls(H,N),O=Ig(y.stateNode,H,O),wa(y,O),ki!==4&&(ki=2)),!1;var Q=Error(r(520),{cause:H});if(Q=ls(Q,N),wl===null?wl=[Q]:wl.push(Q),ki!==4&&(ki=2),S===null)return!0;H=ls(H,N),N=S;do{switch(N.tag){case 3:return N.flags|=65536,y=O&-O,N.lanes|=y,y=Ig(N.stateNode,H,y),wa(N,y),!1;case 1:if(S=N.type,Q=N.stateNode,(N.flags&128)===0&&(typeof S.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(In===null||!In.has(Q))))return N.flags|=65536,O&=-O,N.lanes|=O,O=fg(O),Du(O,y,N,H),wa(N,O),!1}N=N.return}while(N!==null);return!1}var ps=Error(r(461)),bn=!1;function yn(y,S,N,H){S.child=y===null?xo(S,null,N,H):Zo(S,y.child,N,H)}function pg(y,S,N,H,O){N=N.render;var Q=S.ref;if("ref"in H){var ae={};for(var fe in H)fe!=="ref"&&(ae[fe]=H[fe])}else ae=H;return $r(S),H=ng(y,S,N,ae,Q,O),fe=sg(),y!==null&&!bn?(bl(y,S,O),nn(y,S,O)):(mi&&fe&&hl(S),S.flags|=1,yn(y,S,H,O),S.child)}function Ag(y,S,N,H,O){if(y===null){var Q=N.type;return typeof Q=="function"&&!zo(Q)&&Q.defaultProps===void 0&&N.compare===null?(S.tag=15,S.type=Q,mg(y,S,Q,H,O)):(y=Wa(N.type,null,H,S,S.mode,O),y.ref=S.ref,y.return=S,S.child=y)}if(Q=y.child,!Xg(y,O)){var ae=Q.memoizedProps;if(N=N.compare,N=N!==null?N:Ls,N(ae,H)&&y.ref===S.ref)return nn(y,S,O)}return S.flags|=1,y=jn(Q,H),y.ref=S.ref,y.return=S,S.child=y}function mg(y,S,N,H,O){if(y!==null){var Q=y.memoizedProps;if(Ls(Q,H)&&y.ref===S.ref)if(bn=!1,S.pendingProps=H=Q,Xg(y,O))(y.flags&131072)!==0&&(bn=!0);else return S.lanes=y.lanes,nn(y,S,O)}return yg(y,S,N,H,O)}function Ou(y,S,N){var H=S.pendingProps,O=H.children,Q=(S.stateNode._pendingVisibility&2)!==0,ae=y!==null?y.memoizedState:null;if(Za(y,S),H.mode==="hidden"||Q){if((S.flags&128)!==0){if(H=ae!==null?ae.baseLanes|N:N,y!==null){for(O=S.child=y.child,Q=0;O!==null;)Q=Q|O.lanes|O.childLanes,O=O.sibling;S.childLanes=Q&~H}else S.childLanes=0,S.child=null;return bg(y,S,H,N)}if((N&536870912)!==0)S.memoizedState={baseLanes:0,cachePool:null},y!==null&&Ga(S,ae!==null?ae.cachePool:null),ae!==null?lr(S,ae):ic(),eg(S);else return S.lanes=S.childLanes=536870912,bg(y,S,ae!==null?ae.baseLanes|N:N,N)}else ae!==null?(Ga(S,ae.cachePool),lr(S,ae),_o(),S.memoizedState=null):(y!==null&&Ga(S,null),ic(),_o());return yn(y,S,O,N),S.child}function bg(y,S,N,H){var O=ml();return O=O===null?null:{parent:en._currentValue,pool:O},S.memoizedState={baseLanes:N,cachePool:O},y!==null&&Ga(S,null),ic(),eg(S),y!==null&&Bl(y,S,H,!0),null}function Za(y,S){var N=S.ref;if(N===null)y!==null&&y.ref!==null&&(S.flags|=2097664);else{if(typeof N!="function"&&typeof N!="object")throw Error(r(284));(y===null||y.ref!==N)&&(S.flags|=2097664)}}function yg(y,S,N,H,O){return $r(S),N=ng(y,S,N,H,void 0,O),H=sg(),y!==null&&!bn?(bl(y,S,O),nn(y,S,O)):(mi&&H&&hl(S),S.flags|=1,yn(y,S,N,O),S.child)}function Uu(y,S,N,H,O,Q){return $r(S),S.updateQueue=null,N=du(S,H,N,O),hu(y),H=sg(),y!==null&&!bn?(bl(y,S,Q),nn(y,S,Q)):(mi&&H&&hl(S),S.flags|=1,yn(y,S,N,Q),S.child)}function $u(y,S,N,H,O){if($r(S),S.stateNode===null){var Q=ir,ae=N.contextType;typeof ae=="object"&&ae!==null&&(Q=Tn(ae)),Q=new N(H,Q),S.memoizedState=Q.state!==null&&Q.state!==void 0?Q.state:null,Q.updater=Cg,S.stateNode=Q,Q._reactInternals=S,Q=S.stateNode,Q.props=H,Q.state=S.memoizedState,Q.refs={},$n(S),ae=N.contextType,Q.context=typeof ae=="object"&&ae!==null?Tn(ae):ir,Q.state=S.memoizedState,ae=N.getDerivedStateFromProps,typeof ae=="function"&&(dg(S,N,ae,H),Q.state=S.memoizedState),typeof N.getDerivedStateFromProps=="function"||typeof Q.getSnapshotBeforeUpdate=="function"||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(ae=Q.state,typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount(),ae!==Q.state&&Cg.enqueueReplaceState(Q,Q.state,null),ks(S,H,Q,O),Jn(),Q.state=S.memoizedState),typeof Q.componentDidMount=="function"&&(S.flags|=4194308),H=!0}else if(y===null){Q=S.stateNode;var fe=S.memoizedProps,Re=Or(N,fe);Q.props=Re;var Je=Q.context,ut=N.contextType;ae=ir,typeof ut=="object"&&ut!==null&&(ae=Tn(ut));var mt=N.getDerivedStateFromProps;ut=typeof mt=="function"||typeof Q.getSnapshotBeforeUpdate=="function",fe=S.pendingProps!==fe,ut||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(fe||Je!==ae)&&zu(S,Q,H,ae),dn=!1;var et=S.memoizedState;Q.state=et,ks(S,H,Q,O),Jn(),Je=S.memoizedState,fe||et!==Je||dn?(typeof mt=="function"&&(dg(S,N,mt,H),Je=S.memoizedState),(Re=dn||Lu(S,N,Re,H,et,Je,ae))?(ut||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=H,S.memoizedState=Je),Q.props=H,Q.state=Je,Q.context=ae,H=Re):(typeof Q.componentDidMount=="function"&&(S.flags|=4194308),H=!1)}else{Q=S.stateNode,mc(y,S),ae=S.memoizedProps,ut=Or(N,ae),Q.props=ut,mt=S.pendingProps,et=Q.context,Je=N.contextType,Re=ir,typeof Je=="object"&&Je!==null&&(Re=Tn(Je)),fe=N.getDerivedStateFromProps,(Je=typeof fe=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(ae!==mt||et!==Re)&&zu(S,Q,H,Re),dn=!1,et=S.memoizedState,Q.state=et,ks(S,H,Q,O),Jn();var lt=S.memoizedState;ae!==mt||et!==lt||dn||y!==null&&y.dependencies!==null&&Ra(y.dependencies)?(typeof fe=="function"&&(dg(S,N,fe,H),lt=S.memoizedState),(ut=dn||Lu(S,N,ut,H,et,lt,Re)||y!==null&&y.dependencies!==null&&Ra(y.dependencies))?(Je||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(H,lt,Re),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(H,lt,Re)),typeof Q.componentDidUpdate=="function"&&(S.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Q.componentDidUpdate!="function"||ae===y.memoizedProps&&et===y.memoizedState||(S.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ae===y.memoizedProps&&et===y.memoizedState||(S.flags|=1024),S.memoizedProps=H,S.memoizedState=lt),Q.props=H,Q.state=lt,Q.context=Re,H=ut):(typeof Q.componentDidUpdate!="function"||ae===y.memoizedProps&&et===y.memoizedState||(S.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ae===y.memoizedProps&&et===y.memoizedState||(S.flags|=1024),H=!1)}return Q=H,Za(y,S),H=(S.flags&128)!==0,Q||H?(Q=S.stateNode,N=H&&typeof N.getDerivedStateFromError!="function"?null:Q.render(),S.flags|=1,y!==null&&H?(S.child=Zo(S,y.child,null,O),S.child=Zo(S,null,N,O)):yn(y,S,N,O),S.memoizedState=Q.state,y=S.child):y=nn(y,S,O),y}function Gg(y,S,N,H){return ma(),S.flags|=256,yn(y,S,N,H),S.child}var vg={dehydrated:null,treeContext:null,retryLane:0};function Xn(y){return{baseLanes:y,cachePool:Mo()}}function Cc(y,S,N){return y=y!==null?y.childLanes&~N:0,S&&(y|=qn),y}function Qu(y,S,N){var H=S.pendingProps,O=!1,Q=(S.flags&128)!==0,ae;if((ae=Q)||(ae=y!==null&&y.memoizedState===null?!1:(un.current&2)!==0),ae&&(O=!0,S.flags&=-129),ae=(S.flags&32)!==0,S.flags&=-33,y===null){if(mi){if(O?Ro(S):_o(),mi){var fe=Sn,Re;if(Re=fe){e:{for(Re=fe,fe=Xs;Re.nodeType!==8;){if(!fe){fe=null;break e}if(Re=Do(Re.nextSibling),Re===null){fe=null;break e}}fe=Re}fe!==null?(S.memoizedState={dehydrated:fe,treeContext:So!==null?{id:qs,overflow:Xo}:null,retryLane:536870912},Re=an(18,null,null,0),Re.stateNode=fe,Re.return=S,S.child=Re,Yn=S,Sn=null,Re=!0):Re=!1}Re||Hr(S)}if(fe=S.memoizedState,fe!==null&&(fe=fe.dehydrated,fe!==null))return fe.data==="$!"?S.lanes=16:S.lanes=536870912,null;io(S)}return fe=H.children,H=H.fallback,O?(_o(),O=S.mode,fe=Sg({mode:"hidden",children:fe},O),H=Xr(H,O,N,null),fe.return=S,H.return=S,fe.sibling=H,S.child=fe,O=S.child,O.memoizedState=Xn(N),O.childLanes=Cc(y,ae,N),S.memoizedState=vg,H):(Ro(S),Bg(S,fe))}if(Re=y.memoizedState,Re!==null&&(fe=Re.dehydrated,fe!==null)){if(Q)S.flags&256?(Ro(S),S.flags&=-257,S=Ic(y,S,N)):S.memoizedState!==null?(_o(),S.child=y.child,S.flags|=128,S=null):(_o(),O=H.fallback,fe=S.mode,H=Sg({mode:"visible",children:H.children},fe),O=Xr(O,fe,N,null),O.flags|=2,H.return=S,O.return=S,H.sibling=O,S.child=H,Zo(S,y.child,null,N),H=S.child,H.memoizedState=Xn(N),H.childLanes=Cc(y,ae,N),S.memoizedState=vg,S=O);else if(Ro(S),fe.data==="$!"){if(ae=fe.nextSibling&&fe.nextSibling.dataset,ae)var Je=ae.dgst;ae=Je,H=Error(r(419)),H.stack="",H.digest=ae,eo({value:H,source:null,stack:null}),S=Ic(y,S,N)}else if(bn||Bl(y,S,N,!1),ae=(N&y.childLanes)!==0,bn||ae){if(ae=Mi,ae!==null){if(H=N&-N,(H&42)!==0)H=1;else switch(H){case 2:H=1;break;case 8:H=4;break;case 32:H=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:H=64;break;case 268435456:H=134217728;break;default:H=0}if(H=(H&(ae.suspendedLanes|N))!==0?0:H,H!==0&&H!==Re.retryLane)throw Re.retryLane=H,Bo(y,H),fn(ae,y,H),ps}fe.data==="$?"||Ml(),S=Ic(y,S,N)}else fe.data==="$?"?(S.flags|=128,S.child=y.child,S=na.bind(null,y),fe._reactRetry=S,S=null):(y=Re.treeContext,Sn=Do(fe.nextSibling),Yn=S,mi=!0,Ss=null,Xs=!1,y!==null&&(Hi[Is++]=qs,Hi[Is++]=Xo,Hi[Is++]=So,qs=y.id,Xo=y.overflow,So=S),S=Bg(S,H.children),S.flags|=4096);return S}return O?(_o(),O=H.fallback,fe=S.mode,Re=y.child,Je=Re.sibling,H=jn(Re,{mode:"hidden",children:H.children}),H.subtreeFlags=Re.subtreeFlags&31457280,Je!==null?O=jn(Je,O):(O=Xr(O,fe,N,null),O.flags|=2),O.return=S,H.return=S,H.sibling=O,S.child=H,H=O,O=S.child,fe=y.child.memoizedState,fe===null?fe=Xn(N):(Re=fe.cachePool,Re!==null?(Je=en._currentValue,Re=Re.parent!==Je?{parent:Je,pool:Je}:Re):Re=Mo(),fe={baseLanes:fe.baseLanes|N,cachePool:Re}),O.memoizedState=fe,O.childLanes=Cc(y,ae,N),S.memoizedState=vg,H):(Ro(S),N=y.child,y=N.sibling,N=jn(N,{mode:"visible",children:H.children}),N.return=S,N.sibling=null,y!==null&&(ae=S.deletions,ae===null?(S.deletions=[y],S.flags|=16):ae.push(y)),S.child=N,S.memoizedState=null,N)}function Bg(y,S){return S=Sg({mode:"visible",children:S},y.mode),S.return=y,y.child=S}function Sg(y,S){return xg(y,S,0,null)}function Ic(y,S,N){return Zo(S,y.child,null,N),y=Bg(S,S.pendingProps.children),y.flags|=2,S.memoizedState=null,y}function fc(y,S,N){y.lanes|=S;var H=y.alternate;H!==null&&(H.lanes|=S),As(y.return,S,N)}function Ar(y,S,N,H,O){var Q=y.memoizedState;Q===null?y.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:H,tail:N,tailMode:O}:(Q.isBackwards=S,Q.rendering=null,Q.renderingStartTime=0,Q.last=H,Q.tail=N,Q.tailMode=O)}function Ur(y,S,N){var H=S.pendingProps,O=H.revealOrder,Q=H.tail;if(yn(y,S,H.children,N),H=un.current,(H&2)!==0)H=H&1|2,S.flags|=128;else{if(y!==null&&(y.flags&128)!==0)e:for(y=S.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&fc(y,N,S);else if(y.tag===19)fc(y,N,S);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===S)break e;for(;y.sibling===null;){if(y.return===null||y.return===S)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}H&=1}switch(nt(un,H),O){case"forwards":for(N=S.child,O=null;N!==null;)y=N.alternate,y!==null&&ya(y)===null&&(O=N),N=N.sibling;N=O,N===null?(O=S.child,S.child=null):(O=N.sibling,N.sibling=null),Ar(S,!1,O,N,Q);break;case"backwards":for(N=null,O=S.child,S.child=null;O!==null;){if(y=O.alternate,y!==null&&ya(y)===null){S.child=O;break}y=O.sibling,O.sibling=N,N=O,O=y}Ar(S,!0,N,null,Q);break;case"together":Ar(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function nn(y,S,N){if(y!==null&&(S.dependencies=y.dependencies),$s|=S.lanes,(N&S.childLanes)===0)if(y!==null){if(Bl(y,S,N,!1),(N&S.childLanes)===0)return null}else return null;if(y!==null&&S.child!==y.child)throw Error(r(153));if(S.child!==null){for(y=S.child,N=jn(y,y.pendingProps),S.child=N,N.return=S;y.sibling!==null;)y=y.sibling,N=N.sibling=jn(y,y.pendingProps),N.return=S;N.sibling=null}return S.child}function Xg(y,S){return(y.lanes&S)!==0?!0:(y=y.dependencies,!!(y!==null&&Ra(y)))}function xh(y,S,N){switch(S.tag){case 3:yt(S,S.stateNode.containerInfo),mr(S,en,y.memoizedState.cache),ma();break;case 27:case 5:Gt(S);break;case 4:yt(S,S.stateNode.containerInfo);break;case 10:mr(S,S.type,S.memoizedProps.value);break;case 13:var H=S.memoizedState;if(H!==null)return H.dehydrated!==null?(Ro(S),S.flags|=128,null):(N&S.child.childLanes)!==0?Qu(y,S,N):(Ro(S),y=nn(y,S,N),y!==null?y.sibling:null);Ro(S);break;case 19:var O=(y.flags&128)!==0;if(H=(N&S.childLanes)!==0,H||(Bl(y,S,N,!1),H=(N&S.childLanes)!==0),O){if(H)return Ur(y,S,N);S.flags|=128}if(O=S.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),nt(un,un.current),H)break;return null;case 22:case 23:return S.lanes=0,Ou(y,S,N);case 24:mr(S,en,y.memoizedState.cache)}return nn(y,S,N)}function vl(y,S,N){if(y!==null)if(y.memoizedProps!==S.pendingProps)bn=!0;else{if(!Xg(y,N)&&(S.flags&128)===0)return bn=!1,xh(y,S,N);bn=(y.flags&131072)!==0}else bn=!1,mi&&(S.flags&1048576)!==0&&Qc(S,ul,S.index);switch(S.lanes=0,S.tag){case 16:e:{y=S.pendingProps;var H=S.elementType,O=H._init;if(H=O(H._payload),S.type=H,typeof H=="function")zo(H)?(y=Or(H,y),S.tag=1,S=$u(null,S,H,y,N)):(S.tag=0,S=yg(null,S,H,y,N));else{if(H!=null){if(O=H.$$typeof,O===V){S.tag=11,S=pg(null,S,H,y,N);break e}else if(O===T){S.tag=14,S=Ag(null,S,H,y,N);break e}}throw S=ne(H)||H,Error(r(306,S,""))}}return S;case 0:return yg(y,S,S.type,S.pendingProps,N);case 1:return H=S.type,O=Or(H,S.pendingProps),$u(y,S,H,O,N);case 3:e:{if(yt(S,S.stateNode.containerInfo),y===null)throw Error(r(387));var Q=S.pendingProps;O=S.memoizedState,H=O.element,mc(y,S),ks(S,Q,null,N);var ae=S.memoizedState;if(Q=ae.cache,mr(S,en,Q),Q!==O.cache&&pc(S,[en],N,!0),Jn(),Q=ae.element,O.isDehydrated)if(O={element:Q,isDehydrated:!1,cache:ae.cache},S.updateQueue.baseState=O,S.memoizedState=O,S.flags&256){S=Gg(y,S,Q,N);break e}else if(Q!==H){H=ls(Error(r(424)),S),eo(H),S=Gg(y,S,Q,N);break e}else for(Sn=Do(S.stateNode.containerInfo.firstChild),Yn=S,mi=!0,Ss=null,Xs=!0,N=xo(S,null,Q,N),S.child=N;N;)N.flags=N.flags&-3|4096,N=N.sibling;else{if(ma(),Q===H){S=nn(y,S,N);break e}yn(y,S,Q,N)}S=S.child}return S;case 26:return Za(y,S),y===null?(N=fd(S.type,null,S.pendingProps,null))?S.memoizedState=N:mi||(N=S.type,y=S.pendingProps,H=sh(Oe.current).createElement(N),H[Ti]=S,H[Qt]=y,ts(H,N,y),Pe(H),S.stateNode=H):S.memoizedState=fd(S.type,y.memoizedProps,S.pendingProps,y.memoizedState),null;case 27:return Gt(S),y===null&&mi&&(H=S.stateNode=dd(S.type,S.pendingProps,Oe.current),Yn=S,Xs=!0,Sn=Do(H.firstChild)),H=S.pendingProps.children,y!==null||mi?yn(y,S,H,N):S.child=Zo(S,null,H,N),Za(y,S),S.child;case 5:return y===null&&mi&&((O=H=Sn)&&(H=kd(H,S.type,S.pendingProps,Xs),H!==null?(S.stateNode=H,Yn=S,Sn=Do(H.firstChild),Xs=!1,O=!0):O=!1),O||Hr(S)),Gt(S),O=S.type,Q=S.pendingProps,ae=y!==null?y.memoizedProps:null,H=Q.children,Jh(O,Q)?H=null:ae!==null&&Jh(O,ae)&&(S.flags|=32),S.memoizedState!==null&&(O=ng(y,S,vh,null,null,N),Yg._currentValue=O),Za(y,S),yn(y,S,H,N),S.child;case 6:return y===null&&mi&&((y=N=Sn)&&(N=Pd(N,S.pendingProps,Xs),N!==null?(S.stateNode=N,Yn=S,Sn=null,y=!0):y=!1),y||Hr(S)),null;case 13:return Qu(y,S,N);case 4:return yt(S,S.stateNode.containerInfo),H=S.pendingProps,y===null?S.child=Zo(S,null,H,N):yn(y,S,H,N),S.child;case 11:return pg(y,S,S.type,S.pendingProps,N);case 7:return yn(y,S,S.pendingProps,N),S.child;case 8:return yn(y,S,S.pendingProps.children,N),S.child;case 12:return yn(y,S,S.pendingProps.children,N),S.child;case 10:return H=S.pendingProps,mr(S,S.type,H.value),yn(y,S,H.children,N),S.child;case 9:return O=S.type._context,H=S.pendingProps.children,$r(S),O=Tn(O),H=H(O),S.flags|=1,yn(y,S,H,N),S.child;case 14:return Ag(y,S,S.type,S.pendingProps,N);case 15:return mg(y,S,S.type,S.pendingProps,N);case 19:return Ur(y,S,N);case 22:return Ou(y,S,N);case 24:return $r(S),H=Tn(en),y===null?(O=ml(),O===null&&(O=Mi,Q=tg(),O.pooledCache=Q,Q.refCount++,Q!==null&&(O.pooledCacheLanes|=N),O=Q),S.memoizedState={parent:H,cache:O},$n(S),mr(S,en,O)):((y.lanes&N)!==0&&(mc(y,S),ks(S,null,null,N),Jn()),O=y.memoizedState,Q=S.memoizedState,O.parent!==H?(O={parent:H,cache:H},S.memoizedState=O,S.lanes===0&&(S.memoizedState=S.updateQueue.baseState=O),mr(S,en,H)):(H=Q.cache,mr(S,en,H),H!==O.cache&&pc(S,[en],N,!0))),yn(y,S,S.pendingProps.children,N),S.child;case 29:throw S.pendingProps}throw Error(r(156,S.tag))}var xa=We(null),ro=null,Ks=null;function mr(y,S,N){nt(xa,S._currentValue),S._currentValue=N}function Eo(y){y._currentValue=xa.current,dt(xa)}function As(y,S,N){for(;y!==null;){var H=y.alternate;if((y.childLanes&S)!==S?(y.childLanes|=S,H!==null&&(H.childLanes|=S)):H!==null&&(H.childLanes&S)!==S&&(H.childLanes|=S),y===N)break;y=y.return}}function pc(y,S,N,H){var O=y.child;for(O!==null&&(O.return=y);O!==null;){var Q=O.dependencies;if(Q!==null){var ae=O.child;Q=Q.firstContext;e:for(;Q!==null;){var fe=Q;Q=O;for(var Re=0;Re<S.length;Re++)if(fe.context===S[Re]){Q.lanes|=N,fe=Q.alternate,fe!==null&&(fe.lanes|=N),As(Q.return,N,y),H||(ae=null);break e}Q=fe.next}}else if(O.tag===18){if(ae=O.return,ae===null)throw Error(r(341));ae.lanes|=N,Q=ae.alternate,Q!==null&&(Q.lanes|=N),As(ae,N,y),ae=null}else ae=O.child;if(ae!==null)ae.return=O;else for(ae=O;ae!==null;){if(ae===y){ae=null;break}if(O=ae.sibling,O!==null){O.return=ae.return,ae=O;break}ae=ae.return}O=ae}}function Bl(y,S,N,H){y=null;for(var O=S,Q=!1;O!==null;){if(!Q){if((O.flags&524288)!==0)Q=!0;else if((O.flags&262144)!==0)break}if(O.tag===10){var ae=O.alternate;if(ae===null)throw Error(r(387));if(ae=ae.memoizedProps,ae!==null){var fe=O.type;os(O.pendingProps.value,ae.value)||(y!==null?y.push(fe):y=[fe])}}else if(O===be.current){if(ae=O.alternate,ae===null)throw Error(r(387));ae.memoizedState.memoizedState!==O.memoizedState.memoizedState&&(y!==null?y.push(Yg):y=[Yg])}O=O.return}y!==null&&pc(S,y,N,H),S.flags|=262144}function Ra(y){for(y=y.firstContext;y!==null;){if(!os(y.context._currentValue,y.memoizedValue))return!0;y=y.next}return!1}function $r(y){ro=y,Ks=null,y=y.dependencies,y!==null&&(y.firstContext=null)}function Tn(y){return _a(ro,y)}function Ac(y,S){return ro===null&&$r(y),_a(y,S)}function _a(y,S){var N=S._currentValue;if(S={context:S,memoizedValue:N,next:null},Ks===null){if(y===null)throw Error(r(308));Ks=S,y.dependencies={lanes:0,firstContext:S},y.flags|=524288}else Ks=Ks.next=S;return N}var dn=!1;function $n(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mc(y,S){y=y.updateQueue,S.updateQueue===y&&(S.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,callbacks:null})}function ms(y){return{lane:y,tag:0,payload:null,callback:null,next:null}}function bs(y,S,N){var H=y.updateQueue;if(H===null)return null;if(H=H.shared,(ei&2)!==0){var O=H.pending;return O===null?S.next=S:(S.next=O.next,O.next=S),H.pending=S,S=gl(y),cl(y,null,N),S}return ll(y,H,S,N),gl(y)}function br(y,S,N){if(S=S.updateQueue,S!==null&&(S=S.shared,(N&4194176)!==0)){var H=S.lanes;H&=y.pendingLanes,N|=H,S.lanes=N,An(y,N)}}function wa(y,S){var N=y.updateQueue,H=y.alternate;if(H!==null&&(H=H.updateQueue,N===H)){var O=null,Q=null;if(N=N.firstBaseUpdate,N!==null){do{var ae={lane:N.lane,tag:N.tag,payload:N.payload,callback:null,next:null};Q===null?O=Q=ae:Q=Q.next=ae,N=N.next}while(N!==null);Q===null?O=Q=S:Q=Q.next=S}else O=Q=S;N={baseState:H.baseState,firstBaseUpdate:O,lastBaseUpdate:Q,shared:H.shared,callbacks:H.callbacks},y.updateQueue=N;return}y=N.lastBaseUpdate,y===null?N.firstBaseUpdate=S:y.next=S,N.lastBaseUpdate=S}var us=!1;function Jn(){if(us){var y=ur;if(y!==null)throw y}}function ks(y,S,N,H){us=!1;var O=y.updateQueue;dn=!1;var Q=O.firstBaseUpdate,ae=O.lastBaseUpdate,fe=O.shared.pending;if(fe!==null){O.shared.pending=null;var Re=fe,Je=Re.next;Re.next=null,ae===null?Q=Je:ae.next=Je,ae=Re;var ut=y.alternate;ut!==null&&(ut=ut.updateQueue,fe=ut.lastBaseUpdate,fe!==ae&&(fe===null?ut.firstBaseUpdate=Je:fe.next=Je,ut.lastBaseUpdate=Re))}if(Q!==null){var mt=O.baseState;ae=0,ut=Je=Re=null,fe=Q;do{var et=fe.lane&-536870913,lt=et!==fe.lane;if(lt?(kt&et)===et:(H&et)===et){et!==0&&et===Fr&&(us=!0),ut!==null&&(ut=ut.next={lane:0,tag:fe.tag,payload:fe.payload,callback:null,next:null});e:{var Lt=y,ni=fe;et=S;var pn=N;switch(ni.tag){case 1:if(Lt=ni.payload,typeof Lt=="function"){mt=Lt.call(pn,mt,et);break e}mt=Lt;break e;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=ni.payload,et=typeof Lt=="function"?Lt.call(pn,mt,et):Lt,et==null)break e;mt=se({},mt,et);break e;case 2:dn=!0}}et=fe.callback,et!==null&&(y.flags|=64,lt&&(y.flags|=8192),lt=O.callbacks,lt===null?O.callbacks=[et]:lt.push(et))}else lt={lane:et,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null},ut===null?(Je=ut=lt,Re=mt):ut=ut.next=lt,ae|=et;if(fe=fe.next,fe===null){if(fe=O.shared.pending,fe===null)break;lt=fe,fe=lt.next,lt.next=null,O.lastBaseUpdate=lt,O.shared.pending=null}}while(!0);ut===null&&(Re=mt),O.baseState=Re,O.firstBaseUpdate=Je,O.lastBaseUpdate=ut,Q===null&&(O.shared.lanes=0),$s|=ae,y.lanes=ae,y.memoizedState=mt}}function ao(y,S){if(typeof y!="function")throw Error(r(191,y));y.call(S)}function lo(y,S){var N=y.callbacks;if(N!==null)for(y.callbacks=null,y=0;y<N.length;y++)ao(N[y],S)}function sn(y,S){try{var N=S.updateQueue,H=N!==null?N.lastEffect:null;if(H!==null){var O=H.next;N=O;do{if((N.tag&y)===y){H=void 0;var Q=N.create,ae=N.inst;H=Q(),ae.destroy=H}N=N.next}while(N!==O)}}catch(fe){St(S,S.return,fe)}}function Zs(y,S,N){try{var H=S.updateQueue,O=H!==null?H.lastEffect:null;if(O!==null){var Q=O.next;H=Q;do{if((H.tag&y)===y){var ae=H.inst,fe=ae.destroy;if(fe!==void 0){ae.destroy=void 0,O=S;var Re=N;try{fe()}catch(Je){St(O,Re,Je)}}}H=H.next}while(H!==Q)}}catch(Je){St(S,S.return,Je)}}function Yo(y){var S=y.updateQueue;if(S!==null){var N=y.stateNode;try{lo(S,N)}catch(H){St(y,y.return,H)}}}function Sl(y,S,N){N.props=Or(y.type,y.memoizedProps),N.state=y.memoizedState;try{N.componentWillUnmount()}catch(H){St(y,S,H)}}function on(y,S){try{var N=y.ref;if(N!==null){var H=y.stateNode;switch(y.tag){case 26:case 27:case 5:var O=H;break;default:O=H}typeof N=="function"?y.refCleanup=N(O):N.current=O}}catch(Q){St(y,S,Q)}}function wi(y,S){var N=y.ref,H=y.refCleanup;if(N!==null)if(typeof H=="function")try{H()}catch(O){St(y,S,O)}finally{y.refCleanup=null,y=y.alternate,y!=null&&(y.refCleanup=null)}else if(typeof N=="function")try{N(null)}catch(O){St(y,S,O)}else N.current=null}function bi(y){var S=y.type,N=y.memoizedProps,H=y.stateNode;try{e:switch(S){case"button":case"input":case"select":case"textarea":N.autoFocus&&H.focus();break e;case"img":N.src?H.src=N.src:N.srcSet&&(H.srcset=N.srcSet)}}catch(O){St(y,y.return,O)}}function xs(y,S,N){try{var H=y.stateNode;Hd(H,y.type,N,S),H[Qt]=S}catch(O){St(y,y.return,O)}}function Ps(y){return y.tag===5||y.tag===3||y.tag===26||y.tag===27||y.tag===4}function Xl(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||Ps(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==27&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function hs(y,S,N){var H=y.tag;if(H===5||H===6)y=y.stateNode,S?N.nodeType===8?N.parentNode.insertBefore(y,S):N.insertBefore(y,S):(N.nodeType===8?(S=N.parentNode,S.insertBefore(y,N)):(S=N,S.appendChild(y)),N=N._reactRootContainer,N!=null||S.onclick!==null||(S.onclick=nh));else if(H!==4&&H!==27&&(y=y.child,y!==null))for(hs(y,S,N),y=y.sibling;y!==null;)hs(y,S,N),y=y.sibling}function To(y,S,N){var H=y.tag;if(H===5||H===6)y=y.stateNode,S?N.insertBefore(y,S):N.appendChild(y);else if(H!==4&&H!==27&&(y=y.child,y!==null))for(To(y,S,N),y=y.sibling;y!==null;)To(y,S,N),y=y.sibling}var Ds=!1,Fi=!1,yr=!1,bc=typeof WeakSet=="function"?WeakSet:Set,rn=null,yc=!1;function Ma(y,S){if(y=y.containerInfo,Yh=gh,y=kc(y),rl(y)){if("selectionStart"in y)var N={start:y.selectionStart,end:y.selectionEnd};else e:{N=(N=y.ownerDocument)&&N.defaultView||window;var H=N.getSelection&&N.getSelection();if(H&&H.rangeCount!==0){N=H.anchorNode;var O=H.anchorOffset,Q=H.focusNode;H=H.focusOffset;try{N.nodeType,Q.nodeType}catch{N=null;break e}var ae=0,fe=-1,Re=-1,Je=0,ut=0,mt=y,et=null;t:for(;;){for(var lt;mt!==N||O!==0&&mt.nodeType!==3||(fe=ae+O),mt!==Q||H!==0&&mt.nodeType!==3||(Re=ae+H),mt.nodeType===3&&(ae+=mt.nodeValue.length),(lt=mt.firstChild)!==null;)et=mt,mt=lt;for(;;){if(mt===y)break t;if(et===N&&++Je===O&&(fe=ae),et===Q&&++ut===H&&(Re=ae),(lt=mt.nextSibling)!==null)break;mt=et,et=mt.parentNode}mt=lt}N=fe===-1||Re===-1?null:{start:fe,end:Re}}else N=null}N=N||{start:0,end:0}}else N=null;for(Th={focusedElem:y,selectionRange:N},gh=!1,rn=S;rn!==null;)if(S=rn,y=S.child,(S.subtreeFlags&1028)!==0&&y!==null)y.return=S,rn=y;else for(;rn!==null;){switch(S=rn,Q=S.alternate,y=S.flags,S.tag){case 0:break;case 11:case 15:break;case 1:if((y&1024)!==0&&Q!==null){y=void 0,N=S,O=Q.memoizedProps,Q=Q.memoizedState,H=N.stateNode;try{var Lt=Or(N.type,O,N.elementType===N.type);y=H.getSnapshotBeforeUpdate(Lt,Q),H.__reactInternalSnapshotBeforeUpdate=y}catch(ni){St(N,N.return,ni)}}break;case 3:if((y&1024)!==0){if(y=S.stateNode.containerInfo,N=y.nodeType,N===9)zh(y);else if(N===1)switch(y.nodeName){case"HEAD":case"HTML":case"BODY":zh(y);break;default:y.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((y&1024)!==0)throw Error(r(163))}if(y=S.sibling,y!==null){y.return=S.return,rn=y;break}rn=S.return}return Lt=yc,yc=!1,Lt}function Na(y,S,N){var H=N.flags;switch(N.tag){case 0:case 11:case 15:co(y,N),H&4&&sn(5,N);break;case 1:if(co(y,N),H&4)if(y=N.stateNode,S===null)try{y.componentDidMount()}catch(fe){St(N,N.return,fe)}else{var O=Or(N.type,S.memoizedProps);S=S.memoizedState;try{y.componentDidUpdate(O,S,y.__reactInternalSnapshotBeforeUpdate)}catch(fe){St(N,N.return,fe)}}H&64&&Yo(N),H&512&&on(N,N.return);break;case 3:if(co(y,N),H&64&&(H=N.updateQueue,H!==null)){if(y=null,N.child!==null)switch(N.child.tag){case 27:case 5:y=N.child.stateNode;break;case 1:y=N.child.stateNode}try{lo(H,y)}catch(fe){St(N,N.return,fe)}}break;case 26:co(y,N),H&512&&on(N,N.return);break;case 27:case 5:co(y,N),S===null&&H&4&&bi(N),H&512&&on(N,N.return);break;case 12:co(y,N);break;case 13:co(y,N),H&4&&ju(y,N);break;case 22:if(O=N.memoizedState!==null||Ds,!O){S=S!==null&&S.memoizedState!==null||Fi;var Q=Ds,ae=Fi;Ds=O,(Fi=S)&&!ae?Us(y,N,(N.subtreeFlags&8772)!==0):co(y,N),Ds=Q,Fi=ae}H&512&&(N.memoizedProps.mode==="manual"?on(N,N.return):wi(N,N.return));break;default:co(y,N)}}function Gc(y){var S=y.alternate;S!==null&&(y.alternate=null,Gc(S)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(S=y.stateNode,S!==null&&wr(S)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}var Ki=null,Zn=!1;function Hn(y,S,N){for(N=N.child;N!==null;)vc(y,S,N),N=N.sibling}function vc(y,S,N){if(At&&typeof At.onCommitFiberUnmount=="function")try{At.onCommitFiberUnmount(ft,N)}catch{}switch(N.tag){case 26:Fi||wi(N,S),Hn(y,S,N),N.memoizedState?N.memoizedState.count--:N.stateNode&&(N=N.stateNode,N.parentNode.removeChild(N));break;case 27:Fi||wi(N,S);var H=Ki,O=Zn;for(Ki=N.stateNode,Hn(y,S,N),N=N.stateNode,S=N.attributes;S.length;)N.removeAttributeNode(S[0]);wr(N),Ki=H,Zn=O;break;case 5:Fi||wi(N,S);case 6:O=Ki;var Q=Zn;if(Ki=null,Hn(y,S,N),Ki=O,Zn=Q,Ki!==null)if(Zn)try{y=Ki,H=N.stateNode,y.nodeType===8?y.parentNode.removeChild(H):y.removeChild(H)}catch(ae){St(N,S,ae)}else try{Ki.removeChild(N.stateNode)}catch(ae){St(N,S,ae)}break;case 18:Ki!==null&&(Zn?(S=Ki,N=N.stateNode,S.nodeType===8?Lh(S.parentNode,N):S.nodeType===1&&Lh(S,N),Lg(S)):Lh(Ki,N.stateNode));break;case 4:H=Ki,O=Zn,Ki=N.stateNode.containerInfo,Zn=!0,Hn(y,S,N),Ki=H,Zn=O;break;case 0:case 11:case 14:case 15:Fi||Zs(2,N,S),Fi||Zs(4,N,S),Hn(y,S,N);break;case 1:Fi||(wi(N,S),H=N.stateNode,typeof H.componentWillUnmount=="function"&&Sl(N,S,H)),Hn(y,S,N);break;case 21:Hn(y,S,N);break;case 22:Fi||wi(N,S),Fi=(H=Fi)||N.memoizedState!==null,Hn(y,S,N),Fi=H;break;default:Hn(y,S,N)}}function ju(y,S){if(S.memoizedState===null&&(y=S.alternate,y!==null&&(y=y.memoizedState,y!==null&&(y=y.dehydrated,y!==null))))try{Lg(y)}catch(N){St(S,S.return,N)}}function Zl(y){switch(y.tag){case 13:case 19:var S=y.stateNode;return S===null&&(S=y.stateNode=new bc),S;case 22:return y=y.stateNode,S=y._retryCache,S===null&&(S=y._retryCache=new bc),S;default:throw Error(r(435,y.tag))}}function xl(y,S){var N=Zl(y);S.forEach(function(H){var O=je.bind(null,y,H);N.has(H)||(N.add(H),H.then(O,O))})}function Qn(y,S){var N=S.deletions;if(N!==null)for(var H=0;H<N.length;H++){var O=N[H],Q=y,ae=S,fe=ae;e:for(;fe!==null;){switch(fe.tag){case 27:case 5:Ki=fe.stateNode,Zn=!1;break e;case 3:Ki=fe.stateNode.containerInfo,Zn=!0;break e;case 4:Ki=fe.stateNode.containerInfo,Zn=!0;break e}fe=fe.return}if(Ki===null)throw Error(r(160));vc(Q,ae,O),Ki=null,Zn=!1,Q=O.alternate,Q!==null&&(Q.return=null),O.return=null}if(S.subtreeFlags&13878)for(S=S.child;S!==null;)Qr(S,y),S=S.sibling}var Ln=null;function Qr(y,S){var N=y.alternate,H=y.flags;switch(y.tag){case 0:case 11:case 14:case 15:Qn(S,y),zn(y),H&4&&(Zs(3,y,y.return),sn(3,y),Zs(5,y,y.return));break;case 1:Qn(S,y),zn(y),H&512&&(Fi||N===null||wi(N,N.return)),H&64&&Ds&&(y=y.updateQueue,y!==null&&(H=y.callbacks,H!==null&&(N=y.shared.hiddenCallbacks,y.shared.hiddenCallbacks=N===null?H:N.concat(H))));break;case 26:var O=Ln;if(Qn(S,y),zn(y),H&512&&(Fi||N===null||wi(N,N.return)),H&4){var Q=N!==null?N.memoizedState:null;if(H=y.memoizedState,N===null)if(H===null)if(y.stateNode===null){e:{H=y.type,N=y.memoizedProps,O=O.ownerDocument||O;t:switch(H){case"title":Q=O.getElementsByTagName("title")[0],(!Q||Q[Io]||Q[Ti]||Q.namespaceURI==="http://www.w3.org/2000/svg"||Q.hasAttribute("itemprop"))&&(Q=O.createElement(H),O.head.insertBefore(Q,O.querySelector("head > title"))),ts(Q,H,N),Q[Ti]=y,Pe(Q),H=Q;break e;case"link":var ae=md("link","href",O).get(H+(N.href||""));if(ae){for(var fe=0;fe<ae.length;fe++)if(Q=ae[fe],Q.getAttribute("href")===(N.href==null?null:N.href)&&Q.getAttribute("rel")===(N.rel==null?null:N.rel)&&Q.getAttribute("title")===(N.title==null?null:N.title)&&Q.getAttribute("crossorigin")===(N.crossOrigin==null?null:N.crossOrigin)){ae.splice(fe,1);break t}}Q=O.createElement(H),ts(Q,H,N),O.head.appendChild(Q);break;case"meta":if(ae=md("meta","content",O).get(H+(N.content||""))){for(fe=0;fe<ae.length;fe++)if(Q=ae[fe],Q.getAttribute("content")===(N.content==null?null:""+N.content)&&Q.getAttribute("name")===(N.name==null?null:N.name)&&Q.getAttribute("property")===(N.property==null?null:N.property)&&Q.getAttribute("http-equiv")===(N.httpEquiv==null?null:N.httpEquiv)&&Q.getAttribute("charset")===(N.charSet==null?null:N.charSet)){ae.splice(fe,1);break t}}Q=O.createElement(H),ts(Q,H,N),O.head.appendChild(Q);break;default:throw Error(r(468,H))}Q[Ti]=y,Pe(Q),H=Q}y.stateNode=H}else bd(O,y.type,y.stateNode);else y.stateNode=Ad(O,H,y.memoizedProps);else Q!==H?(Q===null?N.stateNode!==null&&(N=N.stateNode,N.parentNode.removeChild(N)):Q.count--,H===null?bd(O,y.type,y.stateNode):Ad(O,H,y.memoizedProps)):H===null&&y.stateNode!==null&&xs(y,y.memoizedProps,N.memoizedProps)}break;case 27:if(H&4&&y.alternate===null){O=y.stateNode,Q=y.memoizedProps;try{for(var Re=O.firstChild;Re;){var Je=Re.nextSibling,ut=Re.nodeName;Re[Io]||ut==="HEAD"||ut==="BODY"||ut==="SCRIPT"||ut==="STYLE"||ut==="LINK"&&Re.rel.toLowerCase()==="stylesheet"||O.removeChild(Re),Re=Je}for(var mt=y.type,et=O.attributes;et.length;)O.removeAttributeNode(et[0]);ts(O,mt,Q),O[Ti]=y,O[Qt]=Q}catch(Lt){St(y,y.return,Lt)}}case 5:if(Qn(S,y),zn(y),H&512&&(Fi||N===null||wi(N,N.return)),y.flags&32){O=y.stateNode;try{Pn(O,"")}catch(Lt){St(y,y.return,Lt)}}H&4&&y.stateNode!=null&&(O=y.memoizedProps,xs(y,O,N!==null?N.memoizedProps:O)),H&1024&&(yr=!0);break;case 6:if(Qn(S,y),zn(y),H&4){if(y.stateNode===null)throw Error(r(162));H=y.memoizedProps,N=y.stateNode;try{N.nodeValue=H}catch(Lt){St(y,y.return,Lt)}}break;case 3:if(ah=null,O=Ln,Ln=oh(S.containerInfo),Qn(S,y),Ln=O,zn(y),H&4&&N!==null&&N.memoizedState.isDehydrated)try{Lg(S.containerInfo)}catch(Lt){St(y,y.return,Lt)}yr&&(yr=!1,Gr(y));break;case 4:H=Ln,Ln=oh(y.stateNode.containerInfo),Qn(S,y),zn(y),Ln=H;break;case 12:Qn(S,y),zn(y);break;case 13:Qn(S,y),zn(y),y.child.flags&8192&&y.memoizedState!==null!=(N!==null&&N.memoizedState!==null)&&(ri=it()),H&4&&(H=y.updateQueue,H!==null&&(y.updateQueue=null,xl(y,H)));break;case 22:if(H&512&&(Fi||N===null||wi(N,N.return)),Re=y.memoizedState!==null,Je=N!==null&&N.memoizedState!==null,ut=Ds,mt=Fi,Ds=ut||Re,Fi=mt||Je,Qn(S,y),Fi=mt,Ds=ut,zn(y),S=y.stateNode,S._current=y,S._visibility&=-3,S._visibility|=S._pendingVisibility&2,H&8192&&(S._visibility=Re?S._visibility&-2:S._visibility|1,Re&&(S=Ds||Fi,N===null||Je||S||Os(y)),y.memoizedProps===null||y.memoizedProps.mode!=="manual"))e:for(N=null,S=y;;){if(S.tag===5||S.tag===26||S.tag===27){if(N===null){Je=N=S;try{if(O=Je.stateNode,Re)Q=O.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none";else{ae=Je.stateNode,fe=Je.memoizedProps.style;var lt=fe!=null&&fe.hasOwnProperty("display")?fe.display:null;ae.style.display=lt==null||typeof lt=="boolean"?"":(""+lt).trim()}}catch(Lt){St(Je,Je.return,Lt)}}}else if(S.tag===6){if(N===null){Je=S;try{Je.stateNode.nodeValue=Re?"":Je.memoizedProps}catch(Lt){St(Je,Je.return,Lt)}}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===y)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===y)break e;for(;S.sibling===null;){if(S.return===null||S.return===y)break e;N===S&&(N=null),S=S.return}N===S&&(N=null),S.sibling.return=S.return,S=S.sibling}H&4&&(H=y.updateQueue,H!==null&&(N=H.retryQueue,N!==null&&(H.retryQueue=null,xl(y,N))));break;case 19:Qn(S,y),zn(y),H&4&&(H=y.updateQueue,H!==null&&(y.updateQueue=null,xl(y,H)));break;case 21:break;default:Qn(S,y),zn(y)}}function zn(y){var S=y.flags;if(S&2){try{if(y.tag!==27){e:{for(var N=y.return;N!==null;){if(Ps(N)){var H=N;break e}N=N.return}throw Error(r(160))}switch(H.tag){case 27:var O=H.stateNode,Q=Xl(y);To(y,Q,O);break;case 5:var ae=H.stateNode;H.flags&32&&(Pn(ae,""),H.flags&=-33);var fe=Xl(y);To(y,fe,ae);break;case 3:case 4:var Re=H.stateNode.containerInfo,Je=Xl(y);hs(y,Je,Re);break;default:throw Error(r(161))}}}catch(ut){St(y,y.return,ut)}y.flags&=-3}S&4096&&(y.flags&=-4097)}function Gr(y){if(y.subtreeFlags&1024)for(y=y.child;y!==null;){var S=y;Gr(S),S.tag===5&&S.flags&1024&&S.stateNode.reset(),y=y.sibling}}function co(y,S){if(S.subtreeFlags&8772)for(S=S.child;S!==null;)Na(y,S.alternate,S),S=S.sibling}function Os(y){for(y=y.child;y!==null;){var S=y;switch(S.tag){case 0:case 11:case 14:case 15:Zs(4,S,S.return),Os(S);break;case 1:wi(S,S.return);var N=S.stateNode;typeof N.componentWillUnmount=="function"&&Sl(S,S.return,N),Os(S);break;case 26:case 27:case 5:wi(S,S.return),Os(S);break;case 22:wi(S,S.return),S.memoizedState===null&&Os(S);break;default:Os(S)}y=y.sibling}}function Us(y,S,N){for(N=N&&(S.subtreeFlags&8772)!==0,S=S.child;S!==null;){var H=S.alternate,O=y,Q=S,ae=Q.flags;switch(Q.tag){case 0:case 11:case 15:Us(O,Q,N),sn(4,Q);break;case 1:if(Us(O,Q,N),H=Q,O=H.stateNode,typeof O.componentDidMount=="function")try{O.componentDidMount()}catch(Je){St(H,H.return,Je)}if(H=Q,O=H.updateQueue,O!==null){var fe=H.stateNode;try{var Re=O.shared.hiddenCallbacks;if(Re!==null)for(O.shared.hiddenCallbacks=null,O=0;O<Re.length;O++)ao(Re[O],fe)}catch(Je){St(H,H.return,Je)}}N&&ae&64&&Yo(Q),on(Q,Q.return);break;case 26:case 27:case 5:Us(O,Q,N),N&&H===null&&ae&4&&bi(Q),on(Q,Q.return);break;case 12:Us(O,Q,N);break;case 13:Us(O,Q,N),N&&ae&4&&ju(O,Q);break;case 22:Q.memoizedState===null&&Us(O,Q,N),on(Q,Q.return);break;default:Us(O,Q,N)}S=S.sibling}}function ds(y,S){var N=null;y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(N=y.memoizedState.cachePool.pool),y=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(y=S.memoizedState.cachePool.pool),y!==N&&(y!=null&&y.refCount++,N!=null&&cr(N))}function Rs(y,S){y=null,S.alternate!==null&&(y=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==y&&(S.refCount++,y!=null&&cr(y))}function Li(y,S,N,H){if(S.subtreeFlags&10256)for(S=S.child;S!==null;)Jo(y,S,N,H),S=S.sibling}function Jo(y,S,N,H){var O=S.flags;switch(S.tag){case 0:case 11:case 15:Li(y,S,N,H),O&2048&&sn(9,S);break;case 3:Li(y,S,N,H),O&2048&&(y=null,S.alternate!==null&&(y=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==y&&(S.refCount++,y!=null&&cr(y)));break;case 12:if(O&2048){Li(y,S,N,H),y=S.stateNode;try{var Q=S.memoizedProps,ae=Q.id,fe=Q.onPostCommit;typeof fe=="function"&&fe(ae,S.alternate===null?"mount":"update",y.passiveEffectDuration,-0)}catch(Re){St(S,S.return,Re)}}else Li(y,S,N,H);break;case 23:break;case 22:Q=S.stateNode,S.memoizedState!==null?Q._visibility&4?Li(y,S,N,H):Gi(y,S):Q._visibility&4?Li(y,S,N,H):(Q._visibility|=4,qt(y,S,N,H,(S.subtreeFlags&10256)!==0)),O&2048&&ds(S.alternate,S);break;case 24:Li(y,S,N,H),O&2048&&Rs(S.alternate,S);break;default:Li(y,S,N,H)}}function qt(y,S,N,H,O){for(O=O&&(S.subtreeFlags&10256)!==0,S=S.child;S!==null;){var Q=y,ae=S,fe=N,Re=H,Je=ae.flags;switch(ae.tag){case 0:case 11:case 15:qt(Q,ae,fe,Re,O),sn(8,ae);break;case 23:break;case 22:var ut=ae.stateNode;ae.memoizedState!==null?ut._visibility&4?qt(Q,ae,fe,Re,O):Gi(Q,ae):(ut._visibility|=4,qt(Q,ae,fe,Re,O)),O&&Je&2048&&ds(ae.alternate,ae);break;case 24:qt(Q,ae,fe,Re,O),O&&Je&2048&&Rs(ae.alternate,ae);break;default:qt(Q,ae,fe,Re,O)}S=S.sibling}}function Gi(y,S){if(S.subtreeFlags&10256)for(S=S.child;S!==null;){var N=y,H=S,O=H.flags;switch(H.tag){case 22:Gi(N,H),O&2048&&ds(H.alternate,H);break;case 24:Gi(N,H),O&2048&&Rs(H.alternate,H);break;default:Gi(N,H)}S=S.sibling}}var Oi=8192;function Ho(y){if(y.subtreeFlags&Oi)for(y=y.child;y!==null;)jr(y),y=y.sibling}function jr(y){switch(y.tag){case 26:Ho(y),y.flags&Oi&&y.memoizedState!==null&&oC(Ln,y.memoizedState,y.memoizedProps);break;case 5:Ho(y);break;case 3:case 4:var S=Ln;Ln=oh(y.stateNode.containerInfo),Ho(y),Ln=S;break;case 22:y.memoizedState===null&&(S=y.alternate,S!==null&&S.memoizedState!==null?(S=Oi,Oi=16777216,Ho(y),Oi=S):Ho(y));break;default:Ho(y)}}function vr(y){var S=y.alternate;if(S!==null&&(y=S.child,y!==null)){S.child=null;do S=y.sibling,y.sibling=null,y=S;while(y!==null)}}function Br(y){var S=y.deletions;if((y.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var H=S[N];rn=H,qu(H,y)}vr(y)}if(y.subtreeFlags&10256)for(y=y.child;y!==null;)Va(y),y=y.sibling}function Va(y){switch(y.tag){case 0:case 11:case 15:Br(y),y.flags&2048&&Zs(9,y,y.return);break;case 3:Br(y);break;case 12:Br(y);break;case 22:var S=y.stateNode;y.memoizedState!==null&&S._visibility&4&&(y.return===null||y.return.tag!==13)?(S._visibility&=-5,Lo(y)):Br(y);break;default:Br(y)}}function Lo(y){var S=y.deletions;if((y.flags&16)!==0){if(S!==null)for(var N=0;N<S.length;N++){var H=S[N];rn=H,qu(H,y)}vr(y)}for(y=y.child;y!==null;){switch(S=y,S.tag){case 0:case 11:case 15:Zs(8,S,S.return),Lo(S);break;case 22:N=S.stateNode,N._visibility&4&&(N._visibility&=-5,Lo(S));break;default:Lo(S)}y=y.sibling}}function qu(y,S){for(;rn!==null;){var N=rn;switch(N.tag){case 0:case 11:case 15:Zs(8,N,S);break;case 23:case 22:if(N.memoizedState!==null&&N.memoizedState.cachePool!==null){var H=N.memoizedState.cachePool.pool;H!=null&&H.refCount++}break;case 24:cr(N.memoizedState.cache)}if(H=N.child,H!==null)H.return=N,rn=H;else e:for(N=y;rn!==null;){H=rn;var O=H.sibling,Q=H.return;if(Gc(H),H===N){rn=null;break e}if(O!==null){O.return=Q,rn=O;break e}rn=Q}}}function Zg(y,S,N,H){this.tag=y,this.key=N,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=H,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function an(y,S,N,H){return new Zg(y,S,N,H)}function zo(y){return y=y.prototype,!(!y||!y.isReactComponent)}function jn(y,S){var N=y.alternate;return N===null?(N=an(y.tag,S,y.key,y.mode),N.elementType=y.elementType,N.type=y.type,N.stateNode=y.stateNode,N.alternate=y,y.alternate=N):(N.pendingProps=S,N.type=y.type,N.flags=0,N.subtreeFlags=0,N.deletions=null),N.flags=y.flags&31457280,N.childLanes=y.childLanes,N.lanes=y.lanes,N.child=y.child,N.memoizedProps=y.memoizedProps,N.memoizedState=y.memoizedState,N.updateQueue=y.updateQueue,S=y.dependencies,N.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},N.sibling=y.sibling,N.index=y.index,N.ref=y.ref,N.refCleanup=y.refCleanup,N}function Sr(y,S){y.flags&=31457282;var N=y.alternate;return N===null?(y.childLanes=0,y.lanes=S,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=N.childLanes,y.lanes=N.lanes,y.child=N.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=N.memoizedProps,y.memoizedState=N.memoizedState,y.updateQueue=N.updateQueue,y.type=N.type,S=N.dependencies,y.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),y}function Wa(y,S,N,H,O,Q){var ae=0;if(H=y,typeof y=="function")zo(y)&&(ae=1);else if(typeof y=="string")ae=nC(y,N,Rt.current)?26:y==="html"||y==="head"||y==="body"?27:5;else e:switch(y){case f:return Xr(N.children,O,Q,S);case A:ae=8,O|=24;break;case G:return y=an(12,N,S,O|2),y.elementType=G,y.lanes=Q,y;case Y:return y=an(13,N,S,O),y.elementType=Y,y.lanes=Q,y;case J:return y=an(19,N,S,O),y.elementType=J,y.lanes=Q,y;case z:return xg(N,O,Q,S);default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case B:case w:ae=10;break e;case Z:ae=9;break e;case V:ae=11;break e;case T:ae=14;break e;case L:ae=16,H=null;break e}ae=29,N=Error(r(130,y===null?"null":typeof y,"")),H=null}return S=an(ae,N,S,O),S.elementType=y,S.type=H,S.lanes=Q,S}function Xr(y,S,N,H){return y=an(7,y,H,S),y.lanes=N,y}function xg(y,S,N,H){y=an(22,y,H,S),y.elementType=z,y.lanes=N;var O={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var Q=O._current;if(Q===null)throw Error(r(456));if((O._pendingVisibility&2)===0){var ae=Bo(Q,2);ae!==null&&(O._pendingVisibility|=2,fn(ae,Q,2))}},attach:function(){var Q=O._current;if(Q===null)throw Error(r(456));if((O._pendingVisibility&2)!==0){var ae=Bo(Q,2);ae!==null&&(O._pendingVisibility&=-3,fn(ae,Q,2))}}};return y.stateNode=O,y}function Cn(y,S,N){return y=an(6,y,null,S),y.lanes=N,y}function Rl(y,S,N){return S=an(4,y.children!==null?y.children:[],y.key,S),S.lanes=N,S.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},S}function _s(y){y.flags|=4}function Zr(y,S){if(S.type!=="stylesheet"||(S.state.loading&4)!==0)y.flags&=-16777217;else if(y.flags|=16777216,!yd(S)){if(S=cs.current,S!==null&&((kt&4194176)===kt?to!==null:(kt&62914560)!==kt&&(kt&536870912)===0||S!==to))throw ba=ec,qc;y.flags|=8192}}function ws(y,S){S!==null&&(y.flags|=4),y.flags&16384&&(S=y.tag!==22?ii():536870912,y.lanes|=S,uo|=S)}function _l(y,S){if(!mi)switch(y.tailMode){case"hidden":S=y.tail;for(var N=null;S!==null;)S.alternate!==null&&(N=S),S=S.sibling;N===null?y.tail=null:N.sibling=null;break;case"collapsed":N=y.tail;for(var H=null;N!==null;)N.alternate!==null&&(H=N),N=N.sibling;H===null?S||y.tail===null?y.tail=null:y.tail.sibling=null:H.sibling=null}}function $i(y){var S=y.alternate!==null&&y.alternate.child===y.child,N=0,H=0;if(S)for(var O=y.child;O!==null;)N|=O.lanes|O.childLanes,H|=O.subtreeFlags&31457280,H|=O.flags&31457280,O.return=y,O=O.sibling;else for(O=y.child;O!==null;)N|=O.lanes|O.childLanes,H|=O.subtreeFlags,H|=O.flags,O.return=y,O=O.sibling;return y.subtreeFlags|=H,y.childLanes=N,S}function Rh(y,S,N){var H=S.pendingProps;switch(sr(S),S.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $i(S),null;case 1:return $i(S),null;case 3:return N=S.stateNode,H=null,y!==null&&(H=y.memoizedState.cache),S.memoizedState.cache!==H&&(S.flags|=2048),Eo(en),st(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(y===null||y.child===null)&&(Aa(S)?_s(S):y===null||y.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Ss!==null&&(Ws(Ss),Ss=null))),$i(S),null;case 26:return N=S.memoizedState,y===null?(_s(S),N!==null?($i(S),Zr(S,N)):($i(S),S.flags&=-16777217)):N?N!==y.memoizedState?(_s(S),$i(S),Zr(S,N)):($i(S),S.flags&=-16777217):(y.memoizedProps!==H&&_s(S),$i(S),S.flags&=-16777217),null;case 27:rt(S),N=Oe.current;var O=S.type;if(y!==null&&S.stateNode!=null)y.memoizedProps!==H&&_s(S);else{if(!H){if(S.stateNode===null)throw Error(r(166));return $i(S),null}y=Rt.current,Aa(S)?au(S):(y=dd(O,H,N),S.stateNode=y,_s(S))}return $i(S),null;case 5:if(rt(S),N=S.type,y!==null&&S.stateNode!=null)y.memoizedProps!==H&&_s(S);else{if(!H){if(S.stateNode===null)throw Error(r(166));return $i(S),null}if(y=Rt.current,Aa(S))au(S);else{switch(O=sh(Oe.current),y){case 1:y=O.createElementNS("http://www.w3.org/2000/svg",N);break;case 2:y=O.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;default:switch(N){case"svg":y=O.createElementNS("http://www.w3.org/2000/svg",N);break;case"math":y=O.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;case"script":y=O.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof H.is=="string"?O.createElement("select",{is:H.is}):O.createElement("select"),H.multiple?y.multiple=!0:H.size&&(y.size=H.size);break;default:y=typeof H.is=="string"?O.createElement(N,{is:H.is}):O.createElement(N)}}y[Ti]=S,y[Qt]=H;e:for(O=S.child;O!==null;){if(O.tag===5||O.tag===6)y.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===S)break e;for(;O.sibling===null;){if(O.return===null||O.return===S)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}S.stateNode=y;e:switch(ts(y,N,H),N){case"button":case"input":case"select":case"textarea":y=!!H.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&_s(S)}}return $i(S),S.flags&=-16777217,null;case 6:if(y&&S.stateNode!=null)y.memoizedProps!==H&&_s(S);else{if(typeof H!="string"&&S.stateNode===null)throw Error(r(166));if(y=Oe.current,Aa(S)){if(y=S.stateNode,N=S.memoizedProps,H=null,O=Yn,O!==null)switch(O.tag){case 27:case 5:H=O.memoizedProps}y[Ti]=S,y=!!(y.nodeValue===N||H!==null&&H.suppressHydrationWarning===!0||ad(y.nodeValue,N)),y||Hr(S)}else y=sh(y).createTextNode(H),y[Ti]=S,S.stateNode=y}return $i(S),null;case 13:if(H=S.memoizedState,y===null||y.memoizedState!==null&&y.memoizedState.dehydrated!==null){if(O=Aa(S),H!==null&&H.dehydrated!==null){if(y===null){if(!O)throw Error(r(318));if(O=S.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(r(317));O[Ti]=S}else ma(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;$i(S),O=!1}else Ss!==null&&(Ws(Ss),Ss=null),O=!0;if(!O)return S.flags&256?(io(S),S):(io(S),null)}if(io(S),(S.flags&128)!==0)return S.lanes=N,S;if(N=H!==null,y=y!==null&&y.memoizedState!==null,N){H=S.child,O=null,H.alternate!==null&&H.alternate.memoizedState!==null&&H.alternate.memoizedState.cachePool!==null&&(O=H.alternate.memoizedState.cachePool.pool);var Q=null;H.memoizedState!==null&&H.memoizedState.cachePool!==null&&(Q=H.memoizedState.cachePool.pool),Q!==O&&(H.flags|=2048)}return N!==y&&N&&(S.child.flags|=8192),ws(S,S.updateQueue),$i(S),null;case 4:return st(),y===null&&Vh(S.stateNode.containerInfo),$i(S),null;case 10:return Eo(S.type),$i(S),null;case 19:if(dt(un),O=S.memoizedState,O===null)return $i(S),null;if(H=(S.flags&128)!==0,Q=O.rendering,Q===null)if(H)_l(O,!1);else{if(ki!==0||y!==null&&(y.flags&128)!==0)for(y=S.child;y!==null;){if(Q=ya(y),Q!==null){for(S.flags|=128,_l(O,!1),y=Q.updateQueue,S.updateQueue=y,ws(S,y),S.subtreeFlags=0,y=N,N=S.child;N!==null;)Sr(N,y),N=N.sibling;return nt(un,un.current&1|2),S.child}y=y.sibling}O.tail!==null&&it()>hi&&(S.flags|=128,H=!0,_l(O,!1),S.lanes=4194304)}else{if(!H)if(y=ya(Q),y!==null){if(S.flags|=128,H=!0,y=y.updateQueue,S.updateQueue=y,ws(S,y),_l(O,!0),O.tail===null&&O.tailMode==="hidden"&&!Q.alternate&&!mi)return $i(S),null}else 2*it()-O.renderingStartTime>hi&&N!==536870912&&(S.flags|=128,H=!0,_l(O,!1),S.lanes=4194304);O.isBackwards?(Q.sibling=S.child,S.child=Q):(y=O.last,y!==null?y.sibling=Q:S.child=Q,O.last=Q)}return O.tail!==null?(S=O.tail,O.rendering=S,O.tail=S.sibling,O.renderingStartTime=it(),S.sibling=null,y=un.current,nt(un,H?y&1|2:y&1),S):($i(S),null);case 22:case 23:return io(S),Al(),H=S.memoizedState!==null,y!==null?y.memoizedState!==null!==H&&(S.flags|=8192):H&&(S.flags|=8192),H?(N&536870912)!==0&&(S.flags&128)===0&&($i(S),S.subtreeFlags&6&&(S.flags|=8192)):$i(S),N=S.updateQueue,N!==null&&ws(S,N.retryQueue),N=null,y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(N=y.memoizedState.cachePool.pool),H=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(H=S.memoizedState.cachePool.pool),H!==N&&(S.flags|=2048),y!==null&&dt(wo),null;case 24:return N=null,y!==null&&(N=y.memoizedState.cache),S.memoizedState.cache!==N&&(S.flags|=2048),Eo(en),$i(S),null;case 25:return null}throw Error(r(156,S.tag))}function qi(y,S){switch(sr(S),S.tag){case 1:return y=S.flags,y&65536?(S.flags=y&-65537|128,S):null;case 3:return Eo(en),st(),y=S.flags,(y&65536)!==0&&(y&128)===0?(S.flags=y&-65537|128,S):null;case 26:case 27:case 5:return rt(S),null;case 13:if(io(S),y=S.memoizedState,y!==null&&y.dehydrated!==null){if(S.alternate===null)throw Error(r(340));ma()}return y=S.flags,y&65536?(S.flags=y&-65537|128,S):null;case 19:return dt(un),null;case 4:return st(),null;case 10:return Eo(S.type),null;case 22:case 23:return io(S),Al(),y!==null&&dt(wo),y=S.flags,y&65536?(S.flags=y&-65537|128,S):null;case 24:return Eo(en),null;case 25:return null;default:return null}}function Rg(y,S){switch(sr(S),S.tag){case 3:Eo(en),st();break;case 26:case 27:case 5:rt(S);break;case 4:st();break;case 13:io(S);break;case 19:dt(un);break;case 10:Eo(S.type);break;case 22:case 23:io(S),Al(),y!==null&&dt(wo);break;case 24:Eo(en)}}var qr={getCacheForType:function(y){var S=Tn(en),N=S.data.get(y);return N===void 0&&(N=y(),S.data.set(y,N)),N}},Fo=typeof WeakMap=="function"?WeakMap:Map,ei=0,Mi=null,ai=null,kt=0,Wi=0,vi=null,ln=!1,Fn=!1,xr=!1,Ko=0,ki=0,$s=0,go=0,Ea=0,qn=0,uo=0,wl=null,ui=null,Ni=!1,ri=0,hi=1/0,_i=null,In=null,Ms=!1,Ns=null,ea=0,Qs=0,Ui=null,Vs=0,ko=null;function es(){if((ei&2)!==0&&kt!==0)return kt&-kt;if(ee.T!==null){var y=Fr;return y!==0?y:_h()}return Nn()}function ys(){qn===0&&(qn=(kt&536870912)===0||mi?Bi():536870912);var y=cs.current;return y!==null&&(y.flags|=32),qn}function fn(y,S,N){(y===Mi&&Wi===2||y.cancelPendingCommit!==null)&&(Po(y,0),Gs(y,kt,qn,!1)),Zi(y,N),((ei&2)===0||y!==Mi)&&(y===Mi&&((ei&2)===0&&(go|=N),ki===4&&Gs(y,kt,qn,!1)),Ei(y))}function Ya(y,S,N){if((ei&6)!==0)throw Error(r(327));var H=!N&&(S&60)===0&&(S&y.expiredLanes)===0||Tt(y,S),O=H?_(y,S):ia(y,S,!0),Q=H;do{if(O===0){Fn&&!H&&Gs(y,S,0,!1);break}else if(O===6)Gs(y,S,0,!ln);else{if(N=y.current.alternate,Q&&!_g(N)){O=ia(y,S,!1),Q=!1;continue}if(O===2){if(Q=S,y.errorRecoveryDisabledLanes&Q)var ae=0;else ae=y.pendingLanes&-536870913,ae=ae!==0?ae:ae&536870912?536870912:0;if(ae!==0){S=ae;e:{var fe=y;O=wl;var Re=fe.current.memoizedState.isDehydrated;if(Re&&(Po(fe,ae).flags|=256),ae=ia(fe,ae,!1),ae!==2){if(xr&&!Re){fe.errorRecoveryDisabledLanes|=Q,go|=Q,O=4;break e}Q=ui,ui=O,Q!==null&&Ws(Q)}O=ae}if(Q=!1,O!==2)continue}}if(O===1){Po(y,0),Gs(y,S,0,!0);break}e:{switch(H=y,O){case 0:case 1:throw Error(r(345));case 4:if((S&4194176)===S){Gs(H,S,qn,!ln);break e}break;case 2:ui=null;break;case 3:case 5:break;default:throw Error(r(329))}if(H.finishedWork=N,H.finishedLanes=S,(S&62914560)===S&&(Q=ri+300-it(),10<Q)){if(Gs(H,S,qn,!ln),_t(H,0)!==0)break e;H.timeoutHandle=gd(Bc.bind(null,H,N,ui,_i,Ni,S,qn,go,uo,ln,2,-0,0),Q);break e}Bc(H,N,ui,_i,Ni,S,qn,go,uo,ln,0,-0,0)}}break}while(!0);Ei(y)}function Ws(y){ui===null?ui=y:ui.push.apply(ui,y)}function Bc(y,S,N,H,O,Q,ae,fe,Re,Je,ut,mt,et){var lt=S.subtreeFlags;if((lt&8192||(lt&16785408)===16785408)&&(Eg={stylesheets:null,count:0,unsuspend:sC},jr(S),S=rC(),S!==null)){y.cancelPendingCommit=S(we.bind(null,y,N,H,O,ae,fe,Re,1,mt,et)),Gs(y,Q,ae,!Je);return}we(y,N,H,O,ae,fe,Re,ut,mt,et)}function _g(y){for(var S=y;;){var N=S.tag;if((N===0||N===11||N===15)&&S.flags&16384&&(N=S.updateQueue,N!==null&&(N=N.stores,N!==null)))for(var H=0;H<N.length;H++){var O=N[H],Q=O.getSnapshot;O=O.value;try{if(!os(Q(),O))return!1}catch{return!1}}if(N=S.child,S.subtreeFlags&16384&&N!==null)N.return=S,S=N;else{if(S===y)break;for(;S.sibling===null;){if(S.return===null||S.return===y)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Gs(y,S,N,H){S&=~Ea,S&=~go,y.suspendedLanes|=S,y.pingedLanes&=~S,H&&(y.warmLanes|=S),H=y.expirationTimes;for(var O=S;0<O;){var Q=31-Ee(O),ae=1<<Q;H[Q]=-1,O&=~ae}N!==0&&Ys(y,N,S)}function ta(){return(ei&6)===0?(fi(0),!1):!0}function ho(){if(ai!==null){if(Wi===0)var y=ai.return;else y=ai,Ks=ro=null,sc(y),ar=null,Il=0,y=ai;for(;y!==null;)Rg(y.alternate,y),y=y.return;ai=null}}function Po(y,S){y.finishedWork=null,y.finishedLanes=0;var N=y.timeoutHandle;N!==-1&&(y.timeoutHandle=-1,zd(N)),N=y.cancelPendingCommit,N!==null&&(y.cancelPendingCommit=null,N()),ho(),Mi=y,ai=N=jn(y.current,null),kt=S,Wi=0,vi=null,ln=!1,Fn=Tt(y,S),xr=!1,uo=qn=Ea=go=$s=ki=0,ui=wl=null,Ni=!1,(S&8)!==0&&(S|=S&32);var H=y.entangledLanes;if(H!==0)for(y=y.entanglements,H&=S;0<H;){var O=31-Ee(H),Q=1<<O;S|=y[O],H&=~Q}return Ko=S,al(),N}function Rr(y,S){oi=null,ee.H=oo,S===or?(S=Si(),Wi=3):S===qc?(S=Si(),Wi=4):Wi=S===ps?8:S!==null&&typeof S=="object"&&typeof S.then=="function"?6:1,vi=S,ai===null&&(ki=1,dc(y,ls(S,y.current)))}function Ta(){var y=ee.H;return ee.H=oo,y===null?oo:y}function Sc(){var y=ee.A;return ee.A=qr,y}function Ml(){ki=4,ln||(kt&4194176)!==kt&&cs.current!==null||(Fn=!0),($s&134217727)===0&&(go&134217727)===0||Mi===null||Gs(Mi,kt,qn,!1)}function ia(y,S,N){var H=ei;ei|=2;var O=Ta(),Q=Sc();(Mi!==y||kt!==S)&&(_i=null,Po(y,S)),S=!1;var ae=ki;e:do try{if(Wi!==0&&ai!==null){var fe=ai,Re=vi;switch(Wi){case 8:ho(),ae=6;break e;case 3:case 2:case 6:cs.current===null&&(S=!0);var Je=Wi;if(Wi=0,vi=null,te(y,fe,Re,Je),N&&Fn){ae=0;break e}break;default:Je=Wi,Wi=0,vi=null,te(y,fe,Re,Je)}}wg(),ae=ki;break}catch(ut){Rr(y,ut)}while(!0);return S&&y.shellSuspendCounter++,Ks=ro=null,ei=H,ee.H=O,ee.A=Q,ai===null&&(Mi=null,kt=0,al()),ae}function wg(){for(;ai!==null;)F(ai)}function _(y,S){var N=ei;ei|=2;var H=Ta(),O=Sc();Mi!==y||kt!==S?(_i=null,hi=it()+500,Po(y,S)):Fn=Tt(y,S);e:do try{if(Wi!==0&&ai!==null){S=ai;var Q=vi;t:switch(Wi){case 1:Wi=0,vi=null,te(y,S,Q,1);break;case 2:if(cu(Q)){Wi=0,vi=null,U(S);break}S=function(){Wi===2&&Mi===y&&(Wi=7),Ei(y)},Q.then(S,S);break e;case 3:Wi=7;break e;case 4:Wi=5;break e;case 7:cu(Q)?(Wi=0,vi=null,U(S)):(Wi=0,vi=null,te(y,S,Q,7));break;case 5:var ae=null;switch(ai.tag){case 26:ae=ai.memoizedState;case 5:case 27:var fe=ai;if(!ae||yd(ae)){Wi=0,vi=null;var Re=fe.sibling;if(Re!==null)ai=Re;else{var Je=fe.return;Je!==null?(ai=Je,oe(Je)):ai=null}break t}}Wi=0,vi=null,te(y,S,Q,5);break;case 6:Wi=0,vi=null,te(y,S,Q,6);break;case 8:ho(),ki=6;break e;default:throw Error(r(462))}}M();break}catch(ut){Rr(y,ut)}while(!0);return Ks=ro=null,ee.H=H,ee.A=O,ei=N,ai!==null?0:(Mi=null,kt=0,al(),ki)}function M(){for(;ai!==null&&!he();)F(ai)}function F(y){var S=vl(y.alternate,y,Ko);y.memoizedProps=y.pendingProps,S===null?oe(y):ai=S}function U(y){var S=y,N=S.alternate;switch(S.tag){case 15:case 0:S=Uu(N,S,S.pendingProps,S.type,void 0,kt);break;case 11:S=Uu(N,S,S.pendingProps,S.type.render,S.ref,kt);break;case 5:sc(S);default:Rg(N,S),S=ai=Sr(S,Ko),S=vl(N,S,Ko)}y.memoizedProps=y.pendingProps,S===null?oe(y):ai=S}function te(y,S,N,H){Ks=ro=null,sc(S),ar=null,Il=0;var O=S.return;try{if(Zh(y,O,S,N,kt)){ki=1,dc(y,ls(N,y.current)),ai=null;return}}catch(Q){if(O!==null)throw ai=O,Q;ki=1,dc(y,ls(N,y.current)),ai=null;return}S.flags&32768?(mi||H===1?y=!0:Fn||(kt&536870912)!==0?y=!1:(ln=y=!0,(H===2||H===3||H===6)&&(H=cs.current,H!==null&&H.tag===13&&(H.flags|=16384))),pe(S,y)):oe(S)}function oe(y){var S=y;do{if((S.flags&32768)!==0){pe(S,ln);return}y=S.return;var N=Rh(S.alternate,S,Ko);if(N!==null){ai=N;return}if(S=S.sibling,S!==null){ai=S;return}ai=S=y}while(S!==null);ki===0&&(ki=5)}function pe(y,S){do{var N=qi(y.alternate,y);if(N!==null){N.flags&=32767,ai=N;return}if(N=y.return,N!==null&&(N.flags|=32768,N.subtreeFlags=0,N.deletions=null),!S&&(y=y.sibling,y!==null)){ai=y;return}ai=y=N}while(y!==null);ki=6,ai=null}function we(y,S,N,H,O,Q,ae,fe,Re,Je){var ut=ee.T,mt=Ae.p;try{Ae.p=2,ee.T=null,Ke(y,S,N,H,mt,O,Q,ae,fe,Re,Je)}finally{ee.T=ut,Ae.p=mt}}function Ke(y,S,N,H,O,Q,ae,fe){do xt();while(Ns!==null);if((ei&6)!==0)throw Error(r(327));var Re=y.finishedWork;if(H=y.finishedLanes,Re===null)return null;if(y.finishedWork=null,y.finishedLanes=0,Re===y.current)throw Error(r(177));y.callbackNode=null,y.callbackPriority=0,y.cancelPendingCommit=null;var Je=Re.lanes|Re.childLanes;if(Je|=vo,Gn(y,H,Je,Q,ae,fe),y===Mi&&(ai=Mi=null,kt=0),(Re.subtreeFlags&10256)===0&&(Re.flags&10256)===0||Ms||(Ms=!0,Qs=Je,Ui=N,ze(Zt,function(){return xt(),null})),N=(Re.flags&15990)!==0,(Re.subtreeFlags&15990)!==0||N?(N=ee.T,ee.T=null,Q=Ae.p,Ae.p=2,ae=ei,ei|=4,Ma(y,Re),Qr(Re,y),Pc(Th,y.containerInfo),gh=!!Yh,Th=Yh=null,y.current=Re,Na(y,Re.alternate,Re),ke(),ei=ae,Ae.p=Q,ee.T=N):y.current=Re,Ms?(Ms=!1,Ns=y,ea=H):gt(y,Je),Je=y.pendingLanes,Je===0&&(In=null),Ct(Re.stateNode),Ei(y),S!==null)for(O=y.onRecoverableError,Re=0;Re<S.length;Re++)Je=S[Re],O(Je.value,{componentStack:Je.stack});return(ea&3)!==0&&xt(),Je=y.pendingLanes,(H&4194218)!==0&&(Je&42)!==0?y===ko?Vs++:(Vs=0,ko=y):Vs=0,fi(0),null}function gt(y,S){(y.pooledCacheLanes&=S)===0&&(S=y.pooledCache,S!=null&&(y.pooledCache=null,cr(S)))}function xt(){if(Ns!==null){var y=Ns,S=Qs;Qs=0;var N=vn(ea),H=ee.T,O=Ae.p;try{if(Ae.p=32>N?32:N,ee.T=null,Ns===null)var Q=!1;else{N=Ui,Ui=null;var ae=Ns,fe=ea;if(Ns=null,ea=0,(ei&6)!==0)throw Error(r(331));var Re=ei;if(ei|=4,Va(ae.current),Jo(ae,ae.current,fe,N),ei=Re,fi(0,!1),At&&typeof At.onPostCommitFiberRoot=="function")try{At.onPostCommitFiberRoot(ft,ae)}catch{}Q=!0}return Q}finally{Ae.p=O,ee.T=H,gt(y,S)}}return!1}function Wt(y,S,N){S=ls(N,S),S=Ig(y.stateNode,S,2),y=bs(y,S,2),y!==null&&(Zi(y,2),Ei(y))}function St(y,S,N){if(y.tag===3)Wt(y,y,N);else for(;S!==null;){if(S.tag===3){Wt(S,y,N);break}else if(S.tag===1){var H=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof H.componentDidCatch=="function"&&(In===null||!In.has(H))){y=ls(N,y),N=fg(2),H=bs(S,N,2),H!==null&&(Du(N,H,S,y),Zi(H,2),Ei(H));break}}S=S.return}}function ti(y,S,N){var H=y.pingCache;if(H===null){H=y.pingCache=new Fo;var O=new Set;H.set(S,O)}else O=H.get(S),O===void 0&&(O=new Set,H.set(S,O));O.has(N)||(xr=!0,O.add(N),y=Es.bind(null,y,S,N),S.then(y,y))}function Es(y,S,N){var H=y.pingCache;H!==null&&H.delete(S),y.pingedLanes|=y.suspendedLanes&N,y.warmLanes&=~N,Mi===y&&(kt&N)===N&&(ki===4||ki===3&&(kt&62914560)===kt&&300>it()-ri?(ei&2)===0&&Po(y,0):Ea|=N,uo===kt&&(uo=0)),Ei(y)}function Ja(y,S){S===0&&(S=ii()),y=Bo(y,S),y!==null&&(Zi(y,S),Ei(y))}function na(y){var S=y.memoizedState,N=0;S!==null&&(N=S.retryLane),Ja(y,N)}function je(y,S){var N=0;switch(y.tag){case 13:var H=y.stateNode,O=y.memoizedState;O!==null&&(N=O.retryLane);break;case 19:H=y.stateNode;break;case 22:H=y.stateNode._retryCache;break;default:throw Error(r(314))}H!==null&&H.delete(S),Ja(y,N)}function ze(y,S){return Xt(y,S)}var tt=null,vt=null,Ht=!1,Vi=!1,Pt=!1,li=0;function Ei(y){y!==vt&&y.next===null&&(vt===null?tt=vt=y:vt=vt.next=y),Vi=!0,Ht||(Ht=!0,Nd(_r))}function fi(y,S){if(!Pt&&Vi){Pt=!0;do for(var N=!1,H=tt;H!==null;){if(y!==0){var O=H.pendingLanes;if(O===0)var Q=0;else{var ae=H.suspendedLanes,fe=H.pingedLanes;Q=(1<<31-Ee(42|y)+1)-1,Q&=O&~(ae&~fe),Q=Q&201326677?Q&201326677|1:Q?Q|2:0}Q!==0&&(N=!0,ed(H,Q))}else Q=kt,Q=_t(H,H===Mi?Q:0),(Q&3)===0||Tt(H,Q)||(N=!0,ed(H,Q));H=H.next}while(N);Pt=!1}}function _r(){Vi=Ht=!1;var y=0;li!==0&&(Ld()&&(y=li),li=0);for(var S=it(),N=null,H=tt;H!==null;){var O=H.next,Q=eh(H,S);Q===0?(H.next=null,N===null?tt=O:N.next=O,O===null&&(vt=N)):(N=H,(y!==0||(Q&3)!==0)&&(Vi=!0)),H=O}fi(y)}function eh(y,S){for(var N=y.suspendedLanes,H=y.pingedLanes,O=y.expirationTimes,Q=y.pendingLanes&-62914561;0<Q;){var ae=31-Ee(Q),fe=1<<ae,Re=O[ae];Re===-1?((fe&N)===0||(fe&H)!==0)&&(O[ae]=si(fe,S)):Re<=S&&(y.expiredLanes|=fe),Q&=~fe}if(S=Mi,N=kt,N=_t(y,y===S?N:0),H=y.callbackNode,N===0||y===S&&Wi===2||y.cancelPendingCommit!==null)return H!==null&&H!==null&&Ge(H),y.callbackNode=null,y.callbackPriority=0;if((N&3)===0||Tt(y,N)){if(S=N&-N,S===y.callbackPriority)return S;switch(H!==null&&Ge(H),vn(N)){case 2:case 8:N=ot;break;case 32:N=Zt;break;case 268435456:N=Et;break;default:N=Zt}return H=qh.bind(null,y),N=Xt(N,H),y.callbackPriority=S,y.callbackNode=N,S}return H!==null&&H!==null&&Ge(H),y.callbackPriority=2,y.callbackNode=null,2}function qh(y,S){var N=y.callbackNode;if(xt()&&y.callbackNode!==N)return null;var H=kt;return H=_t(y,y===Mi?H:0),H===0?null:(Ya(y,H,S),eh(y,it()),y.callbackNode!=null&&y.callbackNode===N?qh.bind(null,y):null)}function ed(y,S){if(xt())return null;Ya(y,S,!0)}function Nd(y){Fd(function(){(ei&6)!==0?Xt(He,y):y()})}function _h(){return li===0&&(li=Bi()),li}function td(y){return y==null||typeof y=="symbol"||typeof y=="boolean"?null:typeof y=="function"?y:Da(""+y)}function id(y,S){var N=S.ownerDocument.createElement("input");return N.name=S.name,N.value=S.value,y.id&&N.setAttribute("form",y.id),S.parentNode.insertBefore(N,S),y=new FormData(y),N.parentNode.removeChild(N),y}function Vd(y,S,N,H,O){if(S==="submit"&&N&&N.stateNode===O){var Q=td((O[Qt]||null).action),ae=H.submitter;ae&&(S=(S=ae[Qt]||null)?td(S.formAction):ae.getAttribute("formAction"),S!==null&&(Q=S,ae=null));var fe=new la("action","action",null,H,O);y.push({event:fe,listeners:[{instance:null,listener:function(){if(H.defaultPrevented){if(li!==0){var Re=ae?id(O,ae):new FormData(O);gg(N,{pending:!0,data:Re,method:O.method,action:Q},null,Re)}}else typeof Q=="function"&&(fe.preventDefault(),Re=ae?id(O,ae):new FormData(O),gg(N,{pending:!0,data:Re,method:O.method,action:Q},Q,Re))},currentTarget:O}]})}}for(var wh=0;wh<Go.length;wh++){var Mh=Go[wh],Wd=Mh.toLowerCase(),Ed=Mh[0].toUpperCase()+Mh.slice(1);Bs(Wd,"on"+Ed)}Bs(Uc,"onAnimationEnd"),Bs(as,"onAnimationIteration"),Bs($c,"onAnimationStart"),Bs("dblclick","onDoubleClick"),Bs("focusin","onFocus"),Bs("focusout","onBlur"),Bs(yo,"onTransitionRun"),Bs(pa,"onTransitionStart"),Bs(tr,"onTransitionCancel"),Bs(Ql,"onTransitionEnd"),Vt("onMouseEnter",["mouseout","mouseover"]),Vt("onMouseLeave",["mouseout","mouseover"]),Vt("onPointerEnter",["pointerout","pointerover"]),Vt("onPointerLeave",["pointerout","pointerover"]),Mt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Mt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Mt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Mt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Mt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Mt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mg));function nd(y,S){S=(S&4)!==0;for(var N=0;N<y.length;N++){var H=y[N],O=H.event;H=H.listeners;e:{var Q=void 0;if(S)for(var ae=H.length-1;0<=ae;ae--){var fe=H[ae],Re=fe.instance,Je=fe.currentTarget;if(fe=fe.listener,Re!==Q&&O.isPropagationStopped())break e;Q=fe,O.currentTarget=Je;try{Q(O)}catch(ut){hc(ut)}O.currentTarget=null,Q=Re}else for(ae=0;ae<H.length;ae++){if(fe=H[ae],Re=fe.instance,Je=fe.currentTarget,fe=fe.listener,Re!==Q&&O.isPropagationStopped())break e;Q=fe,O.currentTarget=Je;try{Q(O)}catch(ut){hc(ut)}O.currentTarget=null,Q=Re}}}}function yi(y,S){var N=S[Oo];N===void 0&&(N=S[Oo]=new Set);var H=y+"__bubble";N.has(H)||(sd(S,y,2,!1),N.add(H))}function Nh(y,S,N){var H=0;S&&(H|=4),sd(N,y,H,S)}var th="_reactListening"+Math.random().toString(36).slice(2);function Vh(y){if(!y[th]){y[th]=!0,Le.forEach(function(N){N!=="selectionchange"&&(Yd.has(N)||Nh(N,!1,y),Nh(N,!0,y))});var S=y.nodeType===9?y:y.ownerDocument;S===null||S[th]||(S[th]=!0,Nh("selectionchange",!1,S))}}function sd(y,S,N,H){switch(Zd(S)){case 2:var O=cC;break;case 8:O=gC;break;default:O=Dh}N=O.bind(null,S,N,y),O=void 0,!Ua||S!=="touchstart"&&S!=="touchmove"&&S!=="wheel"||(O=!0),H?O!==void 0?y.addEventListener(S,N,{capture:!0,passive:O}):y.addEventListener(S,N,!0):O!==void 0?y.addEventListener(S,N,{passive:O}):y.addEventListener(S,N,!1)}function Wh(y,S,N,H,O){var Q=H;if((S&1)===0&&(S&2)===0&&H!==null)e:for(;;){if(H===null)return;var ae=H.tag;if(ae===3||ae===4){var fe=H.stateNode.containerInfo;if(fe===O||fe.nodeType===8&&fe.parentNode===O)break;if(ae===4)for(ae=H.return;ae!==null;){var Re=ae.tag;if((Re===3||Re===4)&&(Re=ae.stateNode.containerInfo,Re===O||Re.nodeType===8&&Re.parentNode===O))return;ae=ae.return}for(;fe!==null;){if(ae=Js(fe),ae===null)return;if(Re=ae.tag,Re===5||Re===6||Re===26||Re===27){H=Q=ae;continue e}fe=fe.parentNode}}H=H.return}wc(function(){var Je=Q,ut=Oa(N),mt=[];e:{var et=jl.get(y);if(et!==void 0){var lt=la,Lt=y;switch(y){case"keypress":if(Uo(N)===0)break e;case"keydown":case"keyup":lt=Ec;break;case"focusin":Lt="focus",lt=Ll;break;case"focusout":Lt="blur",lt=Ll;break;case"beforeblur":case"afterblur":lt=Ll;break;case"click":if(N.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":lt=Vc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":lt=ph;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":lt=Tc;break;case Uc:case as:case $c:lt=Dg;break;case Ql:lt=Ao;break;case"scroll":case"scrollend":lt=Kg;break;case"wheel":lt=Ah;break;case"copy":case"cut":case"paste":lt=Ug;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":lt=Fl;break;case"toggle":case"beforetoggle":lt=Qo}var ni=(S&4)!==0,pn=!ni&&(y==="scroll"||y==="scrollend"),Fe=ni?et!==null?et+"Capture":null:et;ni=[];for(var Ye=Je,Ue;Ye!==null;){var It=Ye;if(Ue=It.stateNode,It=It.tag,It!==5&&It!==26&&It!==27||Ue===null||Fe===null||(It=oa(Ye,Fe),It!=null&&ni.push(Ng(Ye,It,Ue))),pn)break;Ye=Ye.return}0<ni.length&&(et=new lt(et,Lt,null,N,ut),mt.push({event:et,listeners:ni}))}}if((S&7)===0){e:{if(et=y==="mouseover"||y==="pointerover",lt=y==="mouseout"||y==="pointerout",et&&N!==Yl&&(Lt=N.relatedTarget||N.fromElement)&&(Js(Lt)||Lt[Ts]))break e;if((lt||et)&&(et=ut.window===ut?ut:(et=ut.ownerDocument)?et.defaultView||et.parentWindow:window,lt?(Lt=N.relatedTarget||N.toElement,lt=Je,Lt=Lt?Js(Lt):null,Lt!==null&&(pn=Be(Lt),ni=Lt.tag,Lt!==pn||ni!==5&&ni!==27&&ni!==6)&&(Lt=null)):(lt=null,Lt=Je),lt!==Lt)){if(ni=Vc,It="onMouseLeave",Fe="onMouseEnter",Ye="mouse",(y==="pointerout"||y==="pointerover")&&(ni=Fl,It="onPointerLeave",Fe="onPointerEnter",Ye="pointer"),pn=lt==null?et:Ve(lt),Ue=Lt==null?et:Ve(Lt),et=new ni(It,Ye+"leave",lt,N,ut),et.target=pn,et.relatedTarget=Ue,It=null,Js(ut)===Je&&(ni=new ni(Fe,Ye+"enter",Lt,N,ut),ni.target=Ue,ni.relatedTarget=pn,It=ni),pn=It,lt&&Lt)t:{for(ni=lt,Fe=Lt,Ye=0,Ue=ni;Ue;Ue=Xc(Ue))Ye++;for(Ue=0,It=Fe;It;It=Xc(It))Ue++;for(;0<Ye-Ue;)ni=Xc(ni),Ye--;for(;0<Ue-Ye;)Fe=Xc(Fe),Ue--;for(;Ye--;){if(ni===Fe||Fe!==null&&ni===Fe.alternate)break t;ni=Xc(ni),Fe=Xc(Fe)}ni=null}else ni=null;lt!==null&&od(mt,et,lt,ni,!1),Lt!==null&&pn!==null&&od(mt,pn,Lt,ni,!0)}}e:{if(et=Je?Ve(Je):window,lt=et.nodeName&&et.nodeName.toLowerCase(),lt==="select"||lt==="input"&&et.type==="file")var Jt=kl;else if(zc(et))if(Pl)Jt=er;else{Jt=ou;var pi=mh}else lt=et.nodeName,!lt||lt.toLowerCase()!=="input"||et.type!=="checkbox"&&et.type!=="radio"?Je&&Pa(Je.elementType)&&(Jt=kl):Jt=ol;if(Jt&&(Jt=Jt(y,Je))){ss(mt,Jt,N,ut);break e}pi&&pi(y,et,Je),y==="focusout"&&Je&&et.type==="number"&&Je.memoizedProps.value!=null&&xn(et,"number",et.value)}switch(pi=Je?Ve(Je):window,y){case"focusin":(zc(pi)||pi.contentEditable==="true")&&(Er=pi,Dc=Je,fa=null);break;case"focusout":fa=Dc=Er=null;break;case"mousedown":Ul=!0;break;case"contextmenu":case"mouseup":case"dragend":Ul=!1,vs(mt,N,ut);break;case"selectionchange":if(Ol)break;case"keydown":case"keyup":vs(mt,N,ut)}var Kt;if(qa)e:{switch(y){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else qo?il(y,N)&&($t="onCompositionEnd"):y==="keydown"&&N.keyCode===229&&($t="onCompositionStart");$t&&(tl&&N.locale!=="ko"&&(qo||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&qo&&(Kt=Nc()):(fo=ut,Mc="value"in fo?fo.value:fo.textContent,qo=!0)),pi=ih(Je,$t),0<pi.length&&($t=new zl($t,y,null,N,ut),mt.push({event:$t,listeners:pi}),Kt?$t.data=Kt:(Kt=Hc(N),Kt!==null&&($t.data=Kt)))),(Kt=el?nl(y,N):Lc(y,N))&&($t=ih(Je,"onBeforeInput"),0<$t.length&&(pi=new zl("onBeforeInput","beforeinput",null,N,ut),mt.push({event:pi,listeners:$t}),pi.data=Kt)),Vd(mt,y,Je,N,ut)}nd(mt,S)})}function Ng(y,S,N){return{instance:y,listener:S,currentTarget:N}}function ih(y,S){for(var N=S+"Capture",H=[];y!==null;){var O=y,Q=O.stateNode;O=O.tag,O!==5&&O!==26&&O!==27||Q===null||(O=oa(y,N),O!=null&&H.unshift(Ng(y,O,Q)),O=oa(y,S),O!=null&&H.push(Ng(y,O,Q))),y=y.return}return H}function Xc(y){if(y===null)return null;do y=y.return;while(y&&y.tag!==5&&y.tag!==27);return y||null}function od(y,S,N,H,O){for(var Q=S._reactName,ae=[];N!==null&&N!==H;){var fe=N,Re=fe.alternate,Je=fe.stateNode;if(fe=fe.tag,Re!==null&&Re===H)break;fe!==5&&fe!==26&&fe!==27||Je===null||(Re=Je,O?(Je=oa(N,Q),Je!=null&&ae.unshift(Ng(N,Je,Re))):O||(Je=oa(N,Q),Je!=null&&ae.push(Ng(N,Je,Re)))),N=N.return}ae.length!==0&&y.push({event:S,listeners:ae})}var Td=/\r\n?/g,Jd=/\u0000|\uFFFD/g;function rd(y){return(typeof y=="string"?y:""+y).replace(Td,`
`).replace(Jd,"")}function ad(y,S){return S=rd(S),rd(y)===S}function nh(){}function zi(y,S,N,H,O,Q){switch(N){case"children":typeof H=="string"?S==="body"||S==="textarea"&&H===""||Pn(y,H):(typeof H=="number"||typeof H=="bigint")&&S!=="body"&&Pn(y,""+H);break;case"className":Ji(y,"class",H);break;case"tabIndex":Ji(y,"tabindex",H);break;case"dir":case"role":case"viewBox":case"width":case"height":Ji(y,N,H);break;case"style":_c(y,H,Q);break;case"data":if(S!=="object"){Ji(y,"data",H);break}case"src":case"href":if(H===""&&(S!=="a"||N!=="href")){y.removeAttribute(N);break}if(H==null||typeof H=="function"||typeof H=="symbol"||typeof H=="boolean"){y.removeAttribute(N);break}H=Da(""+H),y.setAttribute(N,H);break;case"action":case"formAction":if(typeof H=="function"){y.setAttribute(N,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof Q=="function"&&(N==="formAction"?(S!=="input"&&zi(y,S,"name",O.name,O,null),zi(y,S,"formEncType",O.formEncType,O,null),zi(y,S,"formMethod",O.formMethod,O,null),zi(y,S,"formTarget",O.formTarget,O,null)):(zi(y,S,"encType",O.encType,O,null),zi(y,S,"method",O.method,O,null),zi(y,S,"target",O.target,O,null)));if(H==null||typeof H=="symbol"||typeof H=="boolean"){y.removeAttribute(N);break}H=Da(""+H),y.setAttribute(N,H);break;case"onClick":H!=null&&(y.onclick=nh);break;case"onScroll":H!=null&&yi("scroll",y);break;case"onScrollEnd":H!=null&&yi("scrollend",y);break;case"dangerouslySetInnerHTML":if(H!=null){if(typeof H!="object"||!("__html"in H))throw Error(r(61));if(N=H.__html,N!=null){if(O.children!=null)throw Error(r(60));y.innerHTML=N}}break;case"multiple":y.multiple=H&&typeof H!="function"&&typeof H!="symbol";break;case"muted":y.muted=H&&typeof H!="function"&&typeof H!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(H==null||typeof H=="function"||typeof H=="boolean"||typeof H=="symbol"){y.removeAttribute("xlink:href");break}N=Da(""+H),y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",N);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":H!=null&&typeof H!="function"&&typeof H!="symbol"?y.setAttribute(N,""+H):y.removeAttribute(N);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":H&&typeof H!="function"&&typeof H!="symbol"?y.setAttribute(N,""):y.removeAttribute(N);break;case"capture":case"download":H===!0?y.setAttribute(N,""):H!==!1&&H!=null&&typeof H!="function"&&typeof H!="symbol"?y.setAttribute(N,H):y.removeAttribute(N);break;case"cols":case"rows":case"size":case"span":H!=null&&typeof H!="function"&&typeof H!="symbol"&&!isNaN(H)&&1<=H?y.setAttribute(N,H):y.removeAttribute(N);break;case"rowSpan":case"start":H==null||typeof H=="function"||typeof H=="symbol"||isNaN(H)?y.removeAttribute(N):y.setAttribute(N,H);break;case"popover":yi("beforetoggle",y),yi("toggle",y),Ci(y,"popover",H);break;case"xlinkActuate":Ai(y,"http://www.w3.org/1999/xlink","xlink:actuate",H);break;case"xlinkArcrole":Ai(y,"http://www.w3.org/1999/xlink","xlink:arcrole",H);break;case"xlinkRole":Ai(y,"http://www.w3.org/1999/xlink","xlink:role",H);break;case"xlinkShow":Ai(y,"http://www.w3.org/1999/xlink","xlink:show",H);break;case"xlinkTitle":Ai(y,"http://www.w3.org/1999/xlink","xlink:title",H);break;case"xlinkType":Ai(y,"http://www.w3.org/1999/xlink","xlink:type",H);break;case"xmlBase":Ai(y,"http://www.w3.org/XML/1998/namespace","xml:base",H);break;case"xmlLang":Ai(y,"http://www.w3.org/XML/1998/namespace","xml:lang",H);break;case"xmlSpace":Ai(y,"http://www.w3.org/XML/1998/namespace","xml:space",H);break;case"is":Ci(y,"is",H);break;case"innerText":case"textContent":break;default:(!(2<N.length)||N[0]!=="o"&&N[0]!=="O"||N[1]!=="n"&&N[1]!=="N")&&(N=zg.get(N)||N,Ci(y,N,H))}}function Eh(y,S,N,H,O,Q){switch(N){case"style":_c(y,H,Q);break;case"dangerouslySetInnerHTML":if(H!=null){if(typeof H!="object"||!("__html"in H))throw Error(r(61));if(N=H.__html,N!=null){if(O.children!=null)throw Error(r(60));y.innerHTML=N}}break;case"children":typeof H=="string"?Pn(y,H):(typeof H=="number"||typeof H=="bigint")&&Pn(y,""+H);break;case"onScroll":H!=null&&yi("scroll",y);break;case"onScrollEnd":H!=null&&yi("scrollend",y);break;case"onClick":H!=null&&(y.onclick=nh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!pt.hasOwnProperty(N))e:{if(N[0]==="o"&&N[1]==="n"&&(O=N.endsWith("Capture"),S=N.slice(2,O?N.length-7:void 0),Q=y[Qt]||null,Q=Q!=null?Q[N]:null,typeof Q=="function"&&y.removeEventListener(S,Q,O),typeof H=="function")){typeof Q!="function"&&Q!==null&&(N in y?y[N]=null:y.hasAttribute(N)&&y.removeAttribute(N)),y.addEventListener(S,H,O);break e}N in y?y[N]=H:H===!0?y.setAttribute(N,""):Ci(y,N,H)}}}function ts(y,S,N){switch(S){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yi("error",y),yi("load",y);var H=!1,O=!1,Q;for(Q in N)if(N.hasOwnProperty(Q)){var ae=N[Q];if(ae!=null)switch(Q){case"src":H=!0;break;case"srcSet":O=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,S));default:zi(y,S,Q,ae,N,null)}}O&&zi(y,S,"srcSet",N.srcSet,N,null),H&&zi(y,S,"src",N.src,N,null);return;case"input":yi("invalid",y);var fe=Q=ae=O=null,Re=null,Je=null;for(H in N)if(N.hasOwnProperty(H)){var ut=N[H];if(ut!=null)switch(H){case"name":O=ut;break;case"type":ae=ut;break;case"checked":Re=ut;break;case"defaultChecked":Je=ut;break;case"value":Q=ut;break;case"defaultValue":fe=ut;break;case"children":case"dangerouslySetInnerHTML":if(ut!=null)throw Error(r(137,S));break;default:zi(y,S,H,ut,N,null)}}Wn(y,Q,fe,Re,Je,ae,O,!1),Ii(y);return;case"select":yi("invalid",y),H=ae=Q=null;for(O in N)if(N.hasOwnProperty(O)&&(fe=N[O],fe!=null))switch(O){case"value":Q=fe;break;case"defaultValue":ae=fe;break;case"multiple":H=fe;default:zi(y,S,O,fe,N,null)}S=Q,N=ae,y.multiple=!!H,S!=null?Qi(y,!!H,S,!1):N!=null&&Qi(y,!!H,N,!0);return;case"textarea":yi("invalid",y),Q=O=H=null;for(ae in N)if(N.hasOwnProperty(ae)&&(fe=N[ae],fe!=null))switch(ae){case"value":H=fe;break;case"defaultValue":O=fe;break;case"children":Q=fe;break;case"dangerouslySetInnerHTML":if(fe!=null)throw Error(r(91));break;default:zi(y,S,ae,fe,N,null)}Hs(y,H,O,Q),Ii(y);return;case"option":for(Re in N)if(N.hasOwnProperty(Re)&&(H=N[Re],H!=null))switch(Re){case"selected":y.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:zi(y,S,Re,H,N,null)}return;case"dialog":yi("cancel",y),yi("close",y);break;case"iframe":case"object":yi("load",y);break;case"video":case"audio":for(H=0;H<Mg.length;H++)yi(Mg[H],y);break;case"image":yi("error",y),yi("load",y);break;case"details":yi("toggle",y);break;case"embed":case"source":case"link":yi("error",y),yi("load",y);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Je in N)if(N.hasOwnProperty(Je)&&(H=N[Je],H!=null))switch(Je){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,S));default:zi(y,S,Je,H,N,null)}return;default:if(Pa(S)){for(ut in N)N.hasOwnProperty(ut)&&(H=N[ut],H!==void 0&&Eh(y,S,ut,H,N,void 0));return}}for(fe in N)N.hasOwnProperty(fe)&&(H=N[fe],H!=null&&zi(y,S,fe,H,N,null))}function Hd(y,S,N,H){switch(S){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var O=null,Q=null,ae=null,fe=null,Re=null,Je=null,ut=null;for(lt in N){var mt=N[lt];if(N.hasOwnProperty(lt)&&mt!=null)switch(lt){case"checked":break;case"value":break;case"defaultValue":Re=mt;default:H.hasOwnProperty(lt)||zi(y,S,lt,null,H,mt)}}for(var et in H){var lt=H[et];if(mt=N[et],H.hasOwnProperty(et)&&(lt!=null||mt!=null))switch(et){case"type":Q=lt;break;case"name":O=lt;break;case"checked":Je=lt;break;case"defaultChecked":ut=lt;break;case"value":ae=lt;break;case"defaultValue":fe=lt;break;case"children":case"dangerouslySetInnerHTML":if(lt!=null)throw Error(r(137,S));break;default:lt!==mt&&zi(y,S,et,lt,H,mt)}}xi(y,ae,fe,Re,Je,ut,Q,O);return;case"select":lt=ae=fe=et=null;for(Q in N)if(Re=N[Q],N.hasOwnProperty(Q)&&Re!=null)switch(Q){case"value":break;case"multiple":lt=Re;default:H.hasOwnProperty(Q)||zi(y,S,Q,null,H,Re)}for(O in H)if(Q=H[O],Re=N[O],H.hasOwnProperty(O)&&(Q!=null||Re!=null))switch(O){case"value":et=Q;break;case"defaultValue":fe=Q;break;case"multiple":ae=Q;default:Q!==Re&&zi(y,S,O,Q,H,Re)}S=fe,N=ae,H=lt,et!=null?Qi(y,!!N,et,!1):!!H!=!!N&&(S!=null?Qi(y,!!N,S,!0):Qi(y,!!N,N?[]:"",!1));return;case"textarea":lt=et=null;for(fe in N)if(O=N[fe],N.hasOwnProperty(fe)&&O!=null&&!H.hasOwnProperty(fe))switch(fe){case"value":break;case"children":break;default:zi(y,S,fe,null,H,O)}for(ae in H)if(O=H[ae],Q=N[ae],H.hasOwnProperty(ae)&&(O!=null||Q!=null))switch(ae){case"value":et=O;break;case"defaultValue":lt=O;break;case"children":break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(r(91));break;default:O!==Q&&zi(y,S,ae,O,H,Q)}Bn(y,et,lt);return;case"option":for(var Lt in N)if(et=N[Lt],N.hasOwnProperty(Lt)&&et!=null&&!H.hasOwnProperty(Lt))switch(Lt){case"selected":y.selected=!1;break;default:zi(y,S,Lt,null,H,et)}for(Re in H)if(et=H[Re],lt=N[Re],H.hasOwnProperty(Re)&&et!==lt&&(et!=null||lt!=null))switch(Re){case"selected":y.selected=et&&typeof et!="function"&&typeof et!="symbol";break;default:zi(y,S,Re,et,H,lt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ni in N)et=N[ni],N.hasOwnProperty(ni)&&et!=null&&!H.hasOwnProperty(ni)&&zi(y,S,ni,null,H,et);for(Je in H)if(et=H[Je],lt=N[Je],H.hasOwnProperty(Je)&&et!==lt&&(et!=null||lt!=null))switch(Je){case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(r(137,S));break;default:zi(y,S,Je,et,H,lt)}return;default:if(Pa(S)){for(var pn in N)et=N[pn],N.hasOwnProperty(pn)&&et!==void 0&&!H.hasOwnProperty(pn)&&Eh(y,S,pn,void 0,H,et);for(ut in H)et=H[ut],lt=N[ut],!H.hasOwnProperty(ut)||et===lt||et===void 0&&lt===void 0||Eh(y,S,ut,et,H,lt);return}}for(var Fe in N)et=N[Fe],N.hasOwnProperty(Fe)&&et!=null&&!H.hasOwnProperty(Fe)&&zi(y,S,Fe,null,H,et);for(mt in H)et=H[mt],lt=N[mt],!H.hasOwnProperty(mt)||et===lt||et==null&&lt==null||zi(y,S,mt,et,H,lt)}var Yh=null,Th=null;function sh(y){return y.nodeType===9?y:y.ownerDocument}function ld(y){switch(y){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cd(y,S){if(y===0)switch(S){case"svg":return 1;case"math":return 2;default:return 0}return y===1&&S==="foreignObject"?0:y}function Jh(y,S){return y==="textarea"||y==="noscript"||typeof S.children=="string"||typeof S.children=="number"||typeof S.children=="bigint"||typeof S.dangerouslySetInnerHTML=="object"&&S.dangerouslySetInnerHTML!==null&&S.dangerouslySetInnerHTML.__html!=null}var Hh=null;function Ld(){var y=window.event;return y&&y.type==="popstate"?y===Hh?!1:(Hh=y,!0):(Hh=null,!1)}var gd=typeof setTimeout=="function"?setTimeout:void 0,zd=typeof clearTimeout=="function"?clearTimeout:void 0,ud=typeof Promise=="function"?Promise:void 0,Fd=typeof queueMicrotask=="function"?queueMicrotask:typeof ud<"u"?function(y){return ud.resolve(null).then(y).catch(Kd)}:gd;function Kd(y){setTimeout(function(){throw y})}function Lh(y,S){var N=S,H=0;do{var O=N.nextSibling;if(y.removeChild(N),O&&O.nodeType===8)if(N=O.data,N==="/$"){if(H===0){y.removeChild(O),Lg(S);return}H--}else N!=="$"&&N!=="$?"&&N!=="$!"||H++;N=O}while(N);Lg(S)}function zh(y){var S=y.firstChild;for(S&&S.nodeType===10&&(S=S.nextSibling);S;){var N=S;switch(S=S.nextSibling,N.nodeName){case"HTML":case"HEAD":case"BODY":zh(N),wr(N);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(N.rel.toLowerCase()==="stylesheet")continue}y.removeChild(N)}}function kd(y,S,N,H){for(;y.nodeType===1;){var O=N;if(y.nodeName.toLowerCase()!==S.toLowerCase()){if(!H&&(y.nodeName!=="INPUT"||y.type!=="hidden"))break}else if(H){if(!y[Io])switch(S){case"meta":if(!y.hasAttribute("itemprop"))break;return y;case"link":if(Q=y.getAttribute("rel"),Q==="stylesheet"&&y.hasAttribute("data-precedence"))break;if(Q!==O.rel||y.getAttribute("href")!==(O.href==null?null:O.href)||y.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin)||y.getAttribute("title")!==(O.title==null?null:O.title))break;return y;case"style":if(y.hasAttribute("data-precedence"))break;return y;case"script":if(Q=y.getAttribute("src"),(Q!==(O.src==null?null:O.src)||y.getAttribute("type")!==(O.type==null?null:O.type)||y.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin))&&Q&&y.hasAttribute("async")&&!y.hasAttribute("itemprop"))break;return y;default:return y}}else if(S==="input"&&y.type==="hidden"){var Q=O.name==null?null:""+O.name;if(O.type==="hidden"&&y.getAttribute("name")===Q)return y}else return y;if(y=Do(y.nextSibling),y===null)break}return null}function Pd(y,S,N){if(S==="")return null;for(;y.nodeType!==3;)if((y.nodeType!==1||y.nodeName!=="INPUT"||y.type!=="hidden")&&!N||(y=Do(y.nextSibling),y===null))return null;return y}function Do(y){for(;y!=null;y=y.nextSibling){var S=y.nodeType;if(S===1||S===3)break;if(S===8){if(S=y.data,S==="$"||S==="$!"||S==="$?"||S==="F!"||S==="F")break;if(S==="/$")return null}}return y}function hd(y){y=y.previousSibling;for(var S=0;y;){if(y.nodeType===8){var N=y.data;if(N==="$"||N==="$!"||N==="$?"){if(S===0)return y;S--}else N==="/$"&&S++}y=y.previousSibling}return null}function dd(y,S,N){switch(S=sh(N),y){case"html":if(y=S.documentElement,!y)throw Error(r(452));return y;case"head":if(y=S.head,!y)throw Error(r(453));return y;case"body":if(y=S.body,!y)throw Error(r(454));return y;default:throw Error(r(451))}}var Co=new Map,Cd=new Set;function oh(y){return typeof y.getRootNode=="function"?y.getRootNode():y.ownerDocument}var sa=Ae.d;Ae.d={f:Dd,r:Od,D:Ud,C:$d,L:Qd,m:jd,X:eC,S:qd,M:tC};function Dd(){var y=sa.f(),S=ta();return y||S}function Od(y){var S=Ie(y);S!==null&&S.tag===5&&S.type==="form"?Wu(S):sa.r(y)}var Zc=typeof document>"u"?null:document;function Id(y,S,N){var H=Zc;if(H&&typeof S=="string"&&S){var O=mn(S);O='link[rel="'+y+'"][href="'+O+'"]',typeof N=="string"&&(O+='[crossorigin="'+N+'"]'),Cd.has(O)||(Cd.add(O),y={rel:y,crossOrigin:N,href:S},H.querySelector(O)===null&&(S=H.createElement("link"),ts(S,"link",y),Pe(S),H.head.appendChild(S)))}}function Ud(y){sa.D(y),Id("dns-prefetch",y,null)}function $d(y,S){sa.C(y,S),Id("preconnect",y,S)}function Qd(y,S,N){sa.L(y,S,N);var H=Zc;if(H&&y&&S){var O='link[rel="preload"][as="'+mn(S)+'"]';S==="image"&&N&&N.imageSrcSet?(O+='[imagesrcset="'+mn(N.imageSrcSet)+'"]',typeof N.imageSizes=="string"&&(O+='[imagesizes="'+mn(N.imageSizes)+'"]')):O+='[href="'+mn(y)+'"]';var Q=O;switch(S){case"style":Q=xc(y);break;case"script":Q=Rc(y)}Co.has(Q)||(y=se({rel:"preload",href:S==="image"&&N&&N.imageSrcSet?void 0:y,as:S},N),Co.set(Q,y),H.querySelector(O)!==null||S==="style"&&H.querySelector(Vg(Q))||S==="script"&&H.querySelector(Wg(Q))||(S=H.createElement("link"),ts(S,"link",y),Pe(S),H.head.appendChild(S)))}}function jd(y,S){sa.m(y,S);var N=Zc;if(N&&y){var H=S&&typeof S.as=="string"?S.as:"script",O='link[rel="modulepreload"][as="'+mn(H)+'"][href="'+mn(y)+'"]',Q=O;switch(H){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":Q=Rc(y)}if(!Co.has(Q)&&(y=se({rel:"modulepreload",href:y},S),Co.set(Q,y),N.querySelector(O)===null)){switch(H){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(N.querySelector(Wg(Q)))return}H=N.createElement("link"),ts(H,"link",y),Pe(H),N.head.appendChild(H)}}}function qd(y,S,N){sa.S(y,S,N);var H=Zc;if(H&&y){var O=$e(H).hoistableStyles,Q=xc(y);S=S||"default";var ae=O.get(Q);if(!ae){var fe={loading:0,preload:null};if(ae=H.querySelector(Vg(Q)))fe.loading=5;else{y=se({rel:"stylesheet",href:y,"data-precedence":S},N),(N=Co.get(Q))&&Fh(y,N);var Re=ae=H.createElement("link");Pe(Re),ts(Re,"link",y),Re._p=new Promise(function(Je,ut){Re.onload=Je,Re.onerror=ut}),Re.addEventListener("load",function(){fe.loading|=1}),Re.addEventListener("error",function(){fe.loading|=2}),fe.loading|=4,rh(ae,S,H)}ae={type:"stylesheet",instance:ae,count:1,state:fe},O.set(Q,ae)}}}function eC(y,S){sa.X(y,S);var N=Zc;if(N&&y){var H=$e(N).hoistableScripts,O=Rc(y),Q=H.get(O);Q||(Q=N.querySelector(Wg(O)),Q||(y=se({src:y,async:!0},S),(S=Co.get(O))&&Kh(y,S),Q=N.createElement("script"),Pe(Q),ts(Q,"link",y),N.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},H.set(O,Q))}}function tC(y,S){sa.M(y,S);var N=Zc;if(N&&y){var H=$e(N).hoistableScripts,O=Rc(y),Q=H.get(O);Q||(Q=N.querySelector(Wg(O)),Q||(y=se({src:y,async:!0,type:"module"},S),(S=Co.get(O))&&Kh(y,S),Q=N.createElement("script"),Pe(Q),ts(Q,"link",y),N.head.appendChild(Q)),Q={type:"script",instance:Q,count:1,state:null},H.set(O,Q))}}function fd(y,S,N,H){var O=(O=Oe.current)?oh(O):null;if(!O)throw Error(r(446));switch(y){case"meta":case"title":return null;case"style":return typeof N.precedence=="string"&&typeof N.href=="string"?(S=xc(N.href),N=$e(O).hoistableStyles,H=N.get(S),H||(H={type:"style",instance:null,count:0,state:null},N.set(S,H)),H):{type:"void",instance:null,count:0,state:null};case"link":if(N.rel==="stylesheet"&&typeof N.href=="string"&&typeof N.precedence=="string"){y=xc(N.href);var Q=$e(O).hoistableStyles,ae=Q.get(y);if(ae||(O=O.ownerDocument||O,ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},Q.set(y,ae),(Q=O.querySelector(Vg(y)))&&!Q._p&&(ae.instance=Q,ae.state.loading=5),Co.has(y)||(N={rel:"preload",as:"style",href:N.href,crossOrigin:N.crossOrigin,integrity:N.integrity,media:N.media,hrefLang:N.hrefLang,referrerPolicy:N.referrerPolicy},Co.set(y,N),Q||iC(O,y,N,ae.state))),S&&H===null)throw Error(r(528,""));return ae}if(S&&H!==null)throw Error(r(529,""));return null;case"script":return S=N.async,N=N.src,typeof N=="string"&&S&&typeof S!="function"&&typeof S!="symbol"?(S=Rc(N),N=$e(O).hoistableScripts,H=N.get(S),H||(H={type:"script",instance:null,count:0,state:null},N.set(S,H)),H):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,y))}}function xc(y){return'href="'+mn(y)+'"'}function Vg(y){return'link[rel="stylesheet"]['+y+"]"}function pd(y){return se({},y,{"data-precedence":y.precedence,precedence:null})}function iC(y,S,N,H){y.querySelector('link[rel="preload"][as="style"]['+S+"]")?H.loading=1:(S=y.createElement("link"),H.preload=S,S.addEventListener("load",function(){return H.loading|=1}),S.addEventListener("error",function(){return H.loading|=2}),ts(S,"link",N),Pe(S),y.head.appendChild(S))}function Rc(y){return'[src="'+mn(y)+'"]'}function Wg(y){return"script[async]"+y}function Ad(y,S,N){if(S.count++,S.instance===null)switch(S.type){case"style":var H=y.querySelector('style[data-href~="'+mn(N.href)+'"]');if(H)return S.instance=H,Pe(H),H;var O=se({},N,{"data-href":N.href,"data-precedence":N.precedence,href:null,precedence:null});return H=(y.ownerDocument||y).createElement("style"),Pe(H),ts(H,"style",O),rh(H,N.precedence,y),S.instance=H;case"stylesheet":O=xc(N.href);var Q=y.querySelector(Vg(O));if(Q)return S.state.loading|=4,S.instance=Q,Pe(Q),Q;H=pd(N),(O=Co.get(O))&&Fh(H,O),Q=(y.ownerDocument||y).createElement("link"),Pe(Q);var ae=Q;return ae._p=new Promise(function(fe,Re){ae.onload=fe,ae.onerror=Re}),ts(Q,"link",H),S.state.loading|=4,rh(Q,N.precedence,y),S.instance=Q;case"script":return Q=Rc(N.src),(O=y.querySelector(Wg(Q)))?(S.instance=O,Pe(O),O):(H=N,(O=Co.get(Q))&&(H=se({},N),Kh(H,O)),y=y.ownerDocument||y,O=y.createElement("script"),Pe(O),ts(O,"link",H),y.head.appendChild(O),S.instance=O);case"void":return null;default:throw Error(r(443,S.type))}else S.type==="stylesheet"&&(S.state.loading&4)===0&&(H=S.instance,S.state.loading|=4,rh(H,N.precedence,y));return S.instance}function rh(y,S,N){for(var H=N.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),O=H.length?H[H.length-1]:null,Q=O,ae=0;ae<H.length;ae++){var fe=H[ae];if(fe.dataset.precedence===S)Q=fe;else if(Q!==O)break}Q?Q.parentNode.insertBefore(y,Q.nextSibling):(S=N.nodeType===9?N.head:N,S.insertBefore(y,S.firstChild))}function Fh(y,S){y.crossOrigin==null&&(y.crossOrigin=S.crossOrigin),y.referrerPolicy==null&&(y.referrerPolicy=S.referrerPolicy),y.title==null&&(y.title=S.title)}function Kh(y,S){y.crossOrigin==null&&(y.crossOrigin=S.crossOrigin),y.referrerPolicy==null&&(y.referrerPolicy=S.referrerPolicy),y.integrity==null&&(y.integrity=S.integrity)}var ah=null;function md(y,S,N){if(ah===null){var H=new Map,O=ah=new Map;O.set(N,H)}else O=ah,H=O.get(N),H||(H=new Map,O.set(N,H));if(H.has(y))return H;for(H.set(y,null),N=N.getElementsByTagName(y),O=0;O<N.length;O++){var Q=N[O];if(!(Q[Io]||Q[Ti]||y==="link"&&Q.getAttribute("rel")==="stylesheet")&&Q.namespaceURI!=="http://www.w3.org/2000/svg"){var ae=Q.getAttribute(S)||"";ae=y+ae;var fe=H.get(ae);fe?fe.push(Q):H.set(ae,[Q])}}return H}function bd(y,S,N){y=y.ownerDocument||y,y.head.insertBefore(N,S==="title"?y.querySelector("head > title"):null)}function nC(y,S,N){if(N===1||S.itemProp!=null)return!1;switch(y){case"meta":case"title":return!0;case"style":if(typeof S.precedence!="string"||typeof S.href!="string"||S.href==="")break;return!0;case"link":if(typeof S.rel!="string"||typeof S.href!="string"||S.href===""||S.onLoad||S.onError)break;switch(S.rel){case"stylesheet":return y=S.disabled,typeof S.precedence=="string"&&y==null;default:return!0}case"script":if(S.async&&typeof S.async!="function"&&typeof S.async!="symbol"&&!S.onLoad&&!S.onError&&S.src&&typeof S.src=="string")return!0}return!1}function yd(y){return!(y.type==="stylesheet"&&(y.state.loading&3)===0)}var Eg=null;function sC(){}function oC(y,S,N){if(Eg===null)throw Error(r(475));var H=Eg;if(S.type==="stylesheet"&&(typeof N.media!="string"||matchMedia(N.media).matches!==!1)&&(S.state.loading&4)===0){if(S.instance===null){var O=xc(N.href),Q=y.querySelector(Vg(O));if(Q){y=Q._p,y!==null&&typeof y=="object"&&typeof y.then=="function"&&(H.count++,H=lh.bind(H),y.then(H,H)),S.state.loading|=4,S.instance=Q,Pe(Q);return}Q=y.ownerDocument||y,N=pd(N),(O=Co.get(O))&&Fh(N,O),Q=Q.createElement("link"),Pe(Q);var ae=Q;ae._p=new Promise(function(fe,Re){ae.onload=fe,ae.onerror=Re}),ts(Q,"link",N),S.instance=Q}H.stylesheets===null&&(H.stylesheets=new Map),H.stylesheets.set(S,y),(y=S.state.preload)&&(S.state.loading&3)===0&&(H.count++,S=lh.bind(H),y.addEventListener("load",S),y.addEventListener("error",S))}}function rC(){if(Eg===null)throw Error(r(475));var y=Eg;return y.stylesheets&&y.count===0&&kh(y,y.stylesheets),0<y.count?function(S){var N=setTimeout(function(){if(y.stylesheets&&kh(y,y.stylesheets),y.unsuspend){var H=y.unsuspend;y.unsuspend=null,H()}},6e4);return y.unsuspend=S,function(){y.unsuspend=null,clearTimeout(N)}}:null}function lh(){if(this.count--,this.count===0){if(this.stylesheets)kh(this,this.stylesheets);else if(this.unsuspend){var y=this.unsuspend;this.unsuspend=null,y()}}}var ch=null;function kh(y,S){y.stylesheets=null,y.unsuspend!==null&&(y.count++,ch=new Map,S.forEach(aC,y),ch=null,lh.call(y))}function aC(y,S){if(!(S.state.loading&4)){var N=ch.get(y);if(N)var H=N.get(null);else{N=new Map,ch.set(y,N);for(var O=y.querySelectorAll("link[data-precedence],style[data-precedence]"),Q=0;Q<O.length;Q++){var ae=O[Q];(ae.nodeName==="LINK"||ae.getAttribute("media")!=="not all")&&(N.set(ae.dataset.precedence,ae),H=ae)}H&&N.set(null,H)}O=S.instance,ae=O.getAttribute("data-precedence"),Q=N.get(ae)||H,Q===H&&N.set(null,O),N.set(ae,O),this.count++,H=lh.bind(this),O.addEventListener("load",H),O.addEventListener("error",H),Q?Q.parentNode.insertBefore(O,Q.nextSibling):(y=y.nodeType===9?y.head:y,y.insertBefore(O,y.firstChild)),S.state.loading|=4}}var Yg={$$typeof:w,Provider:null,Consumer:null,_currentValue:Xe,_currentValue2:Xe,_threadCount:0};function lC(y,S,N,H,O,Q,ae,fe){this.tag=1,this.containerInfo=y,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ci(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ci(0),this.hiddenUpdates=ci(null),this.identifierPrefix=H,this.onUncaughtError=O,this.onCaughtError=Q,this.onRecoverableError=ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=fe,this.incompleteTransitions=new Map}function Gd(y,S,N,H,O,Q,ae,fe,Re,Je,ut,mt){return y=new lC(y,S,N,ae,fe,Re,Je,mt),S=1,Q===!0&&(S|=24),Q=an(3,null,null,S),y.current=Q,Q.stateNode=y,S=tg(),S.refCount++,y.pooledCache=S,S.refCount++,Q.memoizedState={element:H,isDehydrated:N,cache:S},$n(Q),y}function vd(y){return y?(y=ir,y):ir}function Bd(y,S,N,H,O,Q){O=vd(O),H.context===null?H.context=O:H.pendingContext=O,H=ms(S),H.payload={element:N},Q=Q===void 0?null:Q,Q!==null&&(H.callback=Q),N=bs(y,H,S),N!==null&&(fn(N,y,S),br(N,y,S))}function Sd(y,S){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var N=y.retryLane;y.retryLane=N!==0&&N<S?N:S}}function Ph(y,S){Sd(y,S),(y=y.alternate)&&Sd(y,S)}function Xd(y){if(y.tag===13){var S=Bo(y,67108864);S!==null&&fn(S,y,67108864),Ph(y,67108864)}}var gh=!0;function cC(y,S,N,H){var O=ee.T;ee.T=null;var Q=Ae.p;try{Ae.p=2,Dh(y,S,N,H)}finally{Ae.p=Q,ee.T=O}}function gC(y,S,N,H){var O=ee.T;ee.T=null;var Q=Ae.p;try{Ae.p=8,Dh(y,S,N,H)}finally{Ae.p=Q,ee.T=O}}function Dh(y,S,N,H){if(gh){var O=Oh(H);if(O===null)Wh(y,S,H,uh,N),xd(y,H);else if(hC(O,y,S,N,H))H.stopPropagation();else if(xd(y,H),S&4&&-1<uC.indexOf(y)){for(;O!==null;){var Q=Ie(O);if(Q!==null)switch(Q.tag){case 3:if(Q=Q.stateNode,Q.current.memoizedState.isDehydrated){var ae=bt(Q.pendingLanes);if(ae!==0){var fe=Q;for(fe.pendingLanes|=2,fe.entangledLanes|=2;ae;){var Re=1<<31-Ee(ae);fe.entanglements[1]|=Re,ae&=~Re}Ei(Q),(ei&6)===0&&(hi=it()+500,fi(0))}}break;case 13:fe=Bo(Q,2),fe!==null&&fn(fe,Q,2),ta(),Ph(Q,2)}if(Q=Oh(H),Q===null&&Wh(y,S,H,uh,N),Q===O)break;O=Q}O!==null&&H.stopPropagation()}else Wh(y,S,H,null,N)}}function Oh(y){return y=Oa(y),Uh(y)}var uh=null;function Uh(y){if(uh=null,y=Js(y),y!==null){var S=Be(y);if(S===null)y=null;else{var N=S.tag;if(N===13){if(y=xe(S),y!==null)return y;y=null}else if(N===3){if(S.stateNode.current.memoizedState.isDehydrated)return S.tag===3?S.stateNode.containerInfo:null;y=null}else S!==y&&(y=null)}}return uh=y,null}function Zd(y){switch(y){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ht()){case He:return 2;case ot:return 8;case Zt:case wt:return 32;case Et:return 268435456;default:return 32}default:return 32}}var $h=!1,Ha=null,La=null,za=null,Tg=new Map,Jg=new Map,Fa=[],uC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xd(y,S){switch(y){case"focusin":case"focusout":Ha=null;break;case"dragenter":case"dragleave":La=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":Tg.delete(S.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jg.delete(S.pointerId)}}function Hg(y,S,N,H,O,Q){return y===null||y.nativeEvent!==Q?(y={blockedOn:S,domEventName:N,eventSystemFlags:H,nativeEvent:Q,targetContainers:[O]},S!==null&&(S=Ie(S),S!==null&&Xd(S)),y):(y.eventSystemFlags|=H,S=y.targetContainers,O!==null&&S.indexOf(O)===-1&&S.push(O),y)}function hC(y,S,N,H,O){switch(S){case"focusin":return Ha=Hg(Ha,y,S,N,H,O),!0;case"dragenter":return La=Hg(La,y,S,N,H,O),!0;case"mouseover":return za=Hg(za,y,S,N,H,O),!0;case"pointerover":var Q=O.pointerId;return Tg.set(Q,Hg(Tg.get(Q)||null,y,S,N,H,O)),!0;case"gotpointercapture":return Q=O.pointerId,Jg.set(Q,Hg(Jg.get(Q)||null,y,S,N,H,O)),!0}return!1}function Rd(y){var S=Js(y.target);if(S!==null){var N=Be(S);if(N!==null){if(S=N.tag,S===13){if(S=xe(N),S!==null){y.blockedOn=S,ns(y.priority,function(){if(N.tag===13){var H=es(),O=Bo(N,H);O!==null&&fn(O,N,H),Ph(N,H)}});return}}else if(S===3&&N.stateNode.current.memoizedState.isDehydrated){y.blockedOn=N.tag===3?N.stateNode.containerInfo:null;return}}}y.blockedOn=null}function hh(y){if(y.blockedOn!==null)return!1;for(var S=y.targetContainers;0<S.length;){var N=Oh(y.nativeEvent);if(N===null){N=y.nativeEvent;var H=new N.constructor(N.type,N);Yl=H,N.target.dispatchEvent(H),Yl=null}else return S=Ie(N),S!==null&&Xd(S),y.blockedOn=N,!1;S.shift()}return!0}function _d(y,S,N){hh(y)&&N.delete(S)}function dC(){$h=!1,Ha!==null&&hh(Ha)&&(Ha=null),La!==null&&hh(La)&&(La=null),za!==null&&hh(za)&&(za=null),Tg.forEach(_d),Jg.forEach(_d)}function dh(y,S){y.blockedOn===S&&(y.blockedOn=null,$h||($h=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,dC)))}var Ch=null;function wd(y){Ch!==y&&(Ch=y,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Ch===y&&(Ch=null);for(var S=0;S<y.length;S+=3){var N=y[S],H=y[S+1],O=y[S+2];if(typeof H!="function"){if(Uh(H||N)===null)continue;break}var Q=Ie(N);Q!==null&&(y.splice(S,3),S-=3,gg(Q,{pending:!0,data:O,method:N.method,action:H},H,O))}}))}function Lg(y){function S(Re){return dh(Re,y)}Ha!==null&&dh(Ha,y),La!==null&&dh(La,y),za!==null&&dh(za,y),Tg.forEach(S),Jg.forEach(S);for(var N=0;N<Fa.length;N++){var H=Fa[N];H.blockedOn===y&&(H.blockedOn=null)}for(;0<Fa.length&&(N=Fa[0],N.blockedOn===null);)Rd(N),N.blockedOn===null&&Fa.shift();if(N=(y.ownerDocument||y).$$reactFormReplay,N!=null)for(H=0;H<N.length;H+=3){var O=N[H],Q=N[H+1],ae=O[Qt]||null;if(typeof Q=="function")ae||wd(N);else if(ae){var fe=null;if(Q&&Q.hasAttribute("formAction")){if(O=Q,ae=Q[Qt]||null)fe=ae.formAction;else if(Uh(O)!==null)continue}else fe=ae.action;typeof fe=="function"?N[H+1]=fe:(N.splice(H,3),H-=3),wd(N)}}}function Qh(y){this._internalRoot=y}Ih.prototype.render=Qh.prototype.render=function(y){var S=this._internalRoot;if(S===null)throw Error(r(409));var N=S.current,H=es();Bd(N,H,y,S,null,null)},Ih.prototype.unmount=Qh.prototype.unmount=function(){var y=this._internalRoot;if(y!==null){this._internalRoot=null;var S=y.containerInfo;y.tag===0&&xt(),Bd(y.current,2,null,y,null,null),ta(),S[Ts]=null}};function Ih(y){this._internalRoot=y}Ih.prototype.unstable_scheduleHydration=function(y){if(y){var S=Nn();y={blockedOn:null,target:y,priority:S};for(var N=0;N<Fa.length&&S!==0&&S<Fa[N].priority;N++);Fa.splice(N,0,y),N===0&&Rd(y)}};var Md=t.version;if(Md!=="19.0.0")throw Error(r(527,Md,"19.0.0"));Ae.findDOMNode=function(y){var S=y._reactInternals;if(S===void 0)throw typeof y.render=="function"?Error(r(188)):(y=Object.keys(y).join(","),Error(r(268,y)));return y=de(S),y=y!==null?ve(y):null,y=y===null?null:y.stateNode,y};var CC={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:ee,findFiberByHostInstance:Js,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fh.isDisabled&&fh.supportsFiber)try{ft=fh.inject(CC),At=fh}catch{}}return reactDomClient_production.createRoot=function(y,S){if(!u(y))throw Error(r(299));var N=!1,H="",O=Fu,Q=Ku,ae=ku,fe=null;return S!=null&&(S.unstable_strictMode===!0&&(N=!0),S.identifierPrefix!==void 0&&(H=S.identifierPrefix),S.onUncaughtError!==void 0&&(O=S.onUncaughtError),S.onCaughtError!==void 0&&(Q=S.onCaughtError),S.onRecoverableError!==void 0&&(ae=S.onRecoverableError),S.unstable_transitionCallbacks!==void 0&&(fe=S.unstable_transitionCallbacks)),S=Gd(y,1,!1,null,null,N,H,O,Q,ae,fe,null),y[Ts]=S.current,Vh(y.nodeType===8?y.parentNode:y),new Qh(S)},reactDomClient_production.hydrateRoot=function(y,S,N){if(!u(y))throw Error(r(299));var H=!1,O="",Q=Fu,ae=Ku,fe=ku,Re=null,Je=null;return N!=null&&(N.unstable_strictMode===!0&&(H=!0),N.identifierPrefix!==void 0&&(O=N.identifierPrefix),N.onUncaughtError!==void 0&&(Q=N.onUncaughtError),N.onCaughtError!==void 0&&(ae=N.onCaughtError),N.onRecoverableError!==void 0&&(fe=N.onRecoverableError),N.unstable_transitionCallbacks!==void 0&&(Re=N.unstable_transitionCallbacks),N.formState!==void 0&&(Je=N.formState)),S=Gd(y,1,!0,S,N??null,H,O,Q,ae,fe,Re,Je),S.context=vd(null),N=S.current,H=es(),O=ms(H),O.callback=null,bs(N,O,H),S.current.lanes=H,Zi(S,H),Ei(S),y[Ts]=S.current,Vh(y),new Ih(S)},reactDomClient_production.version="19.0.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const{createElement,createContext,forwardRef,useCallback,useContext,useEffect,useImperativeHandle,useLayoutEffect,useMemo,useRef,useState}=React$1,useId=React$1[`useId${Math.random()}`.slice(0,5)],useLayoutEffect_do_not_use_directly=useLayoutEffect,PanelGroupContext=createContext(null);PanelGroupContext.displayName="PanelGroupContext";const useIsomorphicLayoutEffect$1=useLayoutEffect_do_not_use_directly,wrappedUseId=typeof useId=="function"?useId:()=>null;let counter=0;function useUniqueId(n=null){const t=wrappedUseId(),o=useRef(n||t||null);return o.current===null&&(o.current=""+counter++),n??o.current}function PanelWithForwardedRef({children:n,className:t="",collapsedSize:o,collapsible:r,defaultSize:u,forwardedRef:d,id:C,maxSize:I,minSize:f,onCollapse:A,onExpand:G,onResize:B,order:Z,style:w,tagName:V="div",...Y}){const J=useContext(PanelGroupContext);if(J===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:T,expandPanel:L,getPanelSize:z,getPanelStyle:K,groupId:P,isPanelCollapsed:$,reevaluatePanelConstraints:ie,registerPanel:ne,resizePanel:ee,unregisterPanel:se}=J,re=useUniqueId(C),ce=useRef({callbacks:{onCollapse:A,onExpand:G,onResize:B},constraints:{collapsedSize:o,collapsible:r,defaultSize:u,maxSize:I,minSize:f},id:re,idIsFromProps:C!==void 0,order:Z});useRef({didLogMissingDefaultSizeWarning:!1}),useIsomorphicLayoutEffect$1(()=>{const{callbacks:ye,constraints:Se}=ce.current,Ce={...Se};ce.current.id=re,ce.current.idIsFromProps=C!==void 0,ce.current.order=Z,ye.onCollapse=A,ye.onExpand=G,ye.onResize=B,Se.collapsedSize=o,Se.collapsible=r,Se.defaultSize=u,Se.maxSize=I,Se.minSize=f,(Ce.collapsedSize!==Se.collapsedSize||Ce.collapsible!==Se.collapsible||Ce.maxSize!==Se.maxSize||Ce.minSize!==Se.minSize)&&ie(ce.current,Ce)}),useIsomorphicLayoutEffect$1(()=>{const ye=ce.current;return ne(ye),()=>{se(ye)}},[Z,re,ne,se]),useImperativeHandle(d,()=>({collapse:()=>{T(ce.current)},expand:ye=>{L(ce.current,ye)},getId(){return re},getSize(){return z(ce.current)},isCollapsed(){return $(ce.current)},isExpanded(){return!$(ce.current)},resize:ye=>{ee(ce.current,ye)}}),[T,L,z,$,re,ee]);const ue=K(ce.current,u);return createElement(V,{...Y,children:n,className:t,id:C,style:{...ue,...w},"data-panel":"","data-panel-collapsible":r||void 0,"data-panel-group-id":P,"data-panel-id":re,"data-panel-size":parseFloat(""+ue.flexGrow).toFixed(1)})}const Panel=forwardRef((n,t)=>createElement(PanelWithForwardedRef,{...n,forwardedRef:t}));PanelWithForwardedRef.displayName="Panel";Panel.displayName="forwardRef(Panel)";let currentCursorStyle=null,styleElement=null;function getCursorStyle(n,t){if(t){const o=(t&EXCEEDED_HORIZONTAL_MIN)!==0,r=(t&EXCEEDED_HORIZONTAL_MAX)!==0,u=(t&EXCEEDED_VERTICAL_MIN)!==0,d=(t&EXCEEDED_VERTICAL_MAX)!==0;if(o)return u?"se-resize":d?"ne-resize":"e-resize";if(r)return u?"sw-resize":d?"nw-resize":"w-resize";if(u)return"s-resize";if(d)return"n-resize"}switch(n){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function resetGlobalCursorStyle(){styleElement!==null&&(document.head.removeChild(styleElement),currentCursorStyle=null,styleElement=null)}function setGlobalCursorStyle(n,t){const o=getCursorStyle(n,t);currentCursorStyle!==o&&(currentCursorStyle=o,styleElement===null&&(styleElement=document.createElement("style"),document.head.appendChild(styleElement)),styleElement.innerHTML=`*{cursor: ${o}!important;}`)}function isKeyDown(n){return n.type==="keydown"}function isPointerEvent(n){return n.type.startsWith("pointer")}function isMouseEvent(n){return n.type.startsWith("mouse")}function getResizeEventCoordinates(n){if(isPointerEvent(n)){if(n.isPrimary)return{x:n.clientX,y:n.clientY}}else if(isMouseEvent(n))return{x:n.clientX,y:n.clientY};return{x:1/0,y:1/0}}function getInputType(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function intersects$1(n,t,o){return n.x<t.x+t.width&&n.x+n.width>t.x&&n.y<t.y+t.height&&n.y+n.height>t.y}function compare(n,t){if(n===t)throw new Error("Cannot compare node with itself");const o={a:get_ancestors(n),b:get_ancestors(t)};let r;for(;o.a.at(-1)===o.b.at(-1);)n=o.a.pop(),t=o.b.pop(),r=n;assert(r,"Stacking order can only be calculated for elements with a common ancestor");const u={a:get_z_index(find_stacking_context(o.a)),b:get_z_index(find_stacking_context(o.b))};if(u.a===u.b){const d=r.childNodes,C={a:o.a.at(-1),b:o.b.at(-1)};let I=d.length;for(;I--;){const f=d[I];if(f===C.a)return 1;if(f===C.b)return-1}}return Math.sign(u.a-u.b)}const props=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function is_flex_item(n){var t;const o=getComputedStyle((t=get_parent(n))!==null&&t!==void 0?t:n).display;return o==="flex"||o==="inline-flex"}function creates_stacking_context(n){const t=getComputedStyle(n);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||is_flex_item(n))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||props.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function find_stacking_context(n){let t=n.length;for(;t--;){const o=n[t];if(assert(o,"Missing node"),creates_stacking_context(o))return o}return null}function get_z_index(n){return n&&Number(getComputedStyle(n).zIndex)||0}function get_ancestors(n){const t=[];for(;n;)t.push(n),n=get_parent(n);return t}function get_parent(n){const{parentNode:t}=n;return t&&t instanceof ShadowRoot?t.host:t}const EXCEEDED_HORIZONTAL_MIN=1,EXCEEDED_HORIZONTAL_MAX=2,EXCEEDED_VERTICAL_MIN=4,EXCEEDED_VERTICAL_MAX=8,isCoarsePointer=getInputType()==="coarse";let intersectingHandles=[],isPointerDown=!1,ownerDocumentCounts=new Map,panelConstraintFlags=new Map;const registeredResizeHandlers=new Set;function registerResizeHandle(n,t,o,r,u){var d;const{ownerDocument:C}=t,I={direction:o,element:t,hitAreaMargins:r,setResizeHandlerState:u},f=(d=ownerDocumentCounts.get(C))!==null&&d!==void 0?d:0;return ownerDocumentCounts.set(C,f+1),registeredResizeHandlers.add(I),updateListeners(),function(){var G;panelConstraintFlags.delete(n),registeredResizeHandlers.delete(I);const B=(G=ownerDocumentCounts.get(C))!==null&&G!==void 0?G:1;if(ownerDocumentCounts.set(C,B-1),updateListeners(),B===1&&ownerDocumentCounts.delete(C),intersectingHandles.includes(I)){const Z=intersectingHandles.indexOf(I);Z>=0&&intersectingHandles.splice(Z,1),updateCursor(),u("up",!0,null)}}}function handlePointerDown(n){const{target:t}=n,{x:o,y:r}=getResizeEventCoordinates(n);isPointerDown=!0,recalculateIntersectingHandles({target:t,x:o,y:r}),updateListeners(),intersectingHandles.length>0&&(updateResizeHandlerStates("down",n),n.preventDefault(),n.stopPropagation())}function handlePointerMove(n){const{x:t,y:o}=getResizeEventCoordinates(n);if(isPointerDown&&n.buttons===0&&(isPointerDown=!1,updateResizeHandlerStates("up",n)),!isPointerDown){const{target:r}=n;recalculateIntersectingHandles({target:r,x:t,y:o})}updateResizeHandlerStates("move",n),updateCursor(),intersectingHandles.length>0&&n.preventDefault()}function handlePointerUp(n){const{target:t}=n,{x:o,y:r}=getResizeEventCoordinates(n);panelConstraintFlags.clear(),isPointerDown=!1,intersectingHandles.length>0&&n.preventDefault(),updateResizeHandlerStates("up",n),recalculateIntersectingHandles({target:t,x:o,y:r}),updateCursor(),updateListeners()}function recalculateIntersectingHandles({target:n,x:t,y:o}){intersectingHandles.splice(0);let r=null;(n instanceof HTMLElement||n instanceof SVGElement)&&(r=n),registeredResizeHandlers.forEach(u=>{const{element:d,hitAreaMargins:C}=u,I=d.getBoundingClientRect(),{bottom:f,left:A,right:G,top:B}=I,Z=isCoarsePointer?C.coarse:C.fine;if(t>=A-Z&&t<=G+Z&&o>=B-Z&&o<=f+Z){if(r!==null&&document.contains(r)&&d!==r&&!d.contains(r)&&!r.contains(d)&&compare(r,d)>0){let V=r,Y=!1;for(;V&&!V.contains(d);){if(intersects$1(V.getBoundingClientRect(),I)){Y=!0;break}V=V.parentElement}if(Y)return}intersectingHandles.push(u)}})}function reportConstraintsViolation(n,t){panelConstraintFlags.set(n,t)}function updateCursor(){let n=!1,t=!1;intersectingHandles.forEach(r=>{const{direction:u}=r;u==="horizontal"?n=!0:t=!0});let o=0;panelConstraintFlags.forEach(r=>{o|=r}),n&&t?setGlobalCursorStyle("intersection",o):n?setGlobalCursorStyle("horizontal",o):t?setGlobalCursorStyle("vertical",o):resetGlobalCursorStyle()}function updateListeners(){ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;o.removeEventListener("contextmenu",handlePointerUp),o.removeEventListener("pointerdown",handlePointerDown),o.removeEventListener("pointerleave",handlePointerMove),o.removeEventListener("pointermove",handlePointerMove)}),window.removeEventListener("pointerup",handlePointerUp),window.removeEventListener("pointercancel",handlePointerUp),registeredResizeHandlers.size>0&&(isPointerDown?(intersectingHandles.length>0&&ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;n>0&&(o.addEventListener("contextmenu",handlePointerUp),o.addEventListener("pointerleave",handlePointerMove),o.addEventListener("pointermove",handlePointerMove))}),window.addEventListener("pointerup",handlePointerUp),window.addEventListener("pointercancel",handlePointerUp)):ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;n>0&&(o.addEventListener("pointerdown",handlePointerDown,{capture:!0}),o.addEventListener("pointermove",handlePointerMove))}))}function updateResizeHandlerStates(n,t){registeredResizeHandlers.forEach(o=>{const{setResizeHandlerState:r}=o,u=intersectingHandles.includes(o);r(n,u,t)})}function useForceUpdate(){const[n,t]=useState(0);return useCallback(()=>t(o=>o+1),[])}function assert(n,t){if(!n)throw console.error(t),Error(t)}const PRECISION=10;function fuzzyCompareNumbers(n,t,o=PRECISION){return n.toFixed(o)===t.toFixed(o)?0:n>t?1:-1}function fuzzyNumbersEqual$1(n,t,o=PRECISION){return fuzzyCompareNumbers(n,t,o)===0}function fuzzyNumbersEqual(n,t,o){return fuzzyCompareNumbers(n,t,o)===0}function fuzzyLayoutsEqual(n,t,o){if(n.length!==t.length)return!1;for(let r=0;r<n.length;r++){const u=n[r],d=t[r];if(!fuzzyNumbersEqual(u,d,o))return!1}return!0}function resizePanel({panelConstraints:n,panelIndex:t,size:o}){const r=n[t];assert(r!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:u=0,collapsible:d,maxSize:C=100,minSize:I=0}=r;if(fuzzyCompareNumbers(o,I)<0)if(d){const f=(u+I)/2;fuzzyCompareNumbers(o,f)<0?o=u:o=I}else o=I;return o=Math.min(C,o),o=parseFloat(o.toFixed(PRECISION)),o}function adjustLayoutByDelta({delta:n,initialLayout:t,panelConstraints:o,pivotIndices:r,prevLayout:u,trigger:d}){if(fuzzyNumbersEqual(n,0))return t;const C=[...t],[I,f]=r;assert(I!=null,"Invalid first pivot index"),assert(f!=null,"Invalid second pivot index");let A=0;if(d==="keyboard"){{const B=n<0?f:I,Z=o[B];assert(Z,`Panel constraints not found for index ${B}`);const{collapsedSize:w=0,collapsible:V,minSize:Y=0}=Z;if(V){const J=t[B];if(assert(J!=null,`Previous layout not found for panel index ${B}`),fuzzyNumbersEqual(J,w)){const T=Y-J;fuzzyCompareNumbers(T,Math.abs(n))>0&&(n=n<0?0-T:T)}}}{const B=n<0?I:f,Z=o[B];assert(Z,`No panel constraints found for index ${B}`);const{collapsedSize:w=0,collapsible:V,minSize:Y=0}=Z;if(V){const J=t[B];if(assert(J!=null,`Previous layout not found for panel index ${B}`),fuzzyNumbersEqual(J,Y)){const T=J-w;fuzzyCompareNumbers(T,Math.abs(n))>0&&(n=n<0?0-T:T)}}}}{const B=n<0?1:-1;let Z=n<0?f:I,w=0;for(;;){const Y=t[Z];assert(Y!=null,`Previous layout not found for panel index ${Z}`);const T=resizePanel({panelConstraints:o,panelIndex:Z,size:100})-Y;if(w+=T,Z+=B,Z<0||Z>=o.length)break}const V=Math.min(Math.abs(n),Math.abs(w));n=n<0?0-V:V}{let Z=n<0?I:f;for(;Z>=0&&Z<o.length;){const w=Math.abs(n)-Math.abs(A),V=t[Z];assert(V!=null,`Previous layout not found for panel index ${Z}`);const Y=V-w,J=resizePanel({panelConstraints:o,panelIndex:Z,size:Y});if(!fuzzyNumbersEqual(V,J)&&(A+=V-J,C[Z]=J,A.toPrecision(3).localeCompare(Math.abs(n).toPrecision(3),void 0,{numeric:!0})>=0))break;n<0?Z--:Z++}}if(fuzzyLayoutsEqual(u,C))return u;{const B=n<0?f:I,Z=t[B];assert(Z!=null,`Previous layout not found for panel index ${B}`);const w=Z+A,V=resizePanel({panelConstraints:o,panelIndex:B,size:w});if(C[B]=V,!fuzzyNumbersEqual(V,w)){let Y=w-V,T=n<0?f:I;for(;T>=0&&T<o.length;){const L=C[T];assert(L!=null,`Previous layout not found for panel index ${T}`);const z=L+Y,K=resizePanel({panelConstraints:o,panelIndex:T,size:z});if(fuzzyNumbersEqual(L,K)||(Y-=K-L,C[T]=K),fuzzyNumbersEqual(Y,0))break;n>0?T--:T++}}}const G=C.reduce((B,Z)=>Z+B,0);return fuzzyNumbersEqual(G,100)?C:u}function calculateAriaValues({layout:n,panelsArray:t,pivotIndices:o}){let r=0,u=100,d=0,C=0;const I=o[0];assert(I!=null,"No pivot index found"),t.forEach((B,Z)=>{const{constraints:w}=B,{maxSize:V=100,minSize:Y=0}=w;Z===I?(r=Y,u=V):(d+=Y,C+=V)});const f=Math.min(u,100-d),A=Math.max(r,100-C),G=n[I];return{valueMax:f,valueMin:A,valueNow:G}}function getResizeHandleElementsForGroup(n,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${n}"]`))}function getResizeHandleElementIndex(n,t,o=document){const u=getResizeHandleElementsForGroup(n,o).findIndex(d=>d.getAttribute("data-panel-resize-handle-id")===t);return u??null}function determinePivotIndices(n,t,o){const r=getResizeHandleElementIndex(n,t,o);return r!=null?[r,r+1]:[-1,-1]}function getPanelGroupElement(n,t=document){var o;if(t instanceof HTMLElement&&(t==null||(o=t.dataset)===null||o===void 0?void 0:o.panelGroupId)==n)return t;const r=t.querySelector(`[data-panel-group][data-panel-group-id="${n}"]`);return r||null}function getResizeHandleElement(n,t=document){const o=t.querySelector(`[data-panel-resize-handle-id="${n}"]`);return o||null}function getResizeHandlePanelIds(n,t,o,r=document){var u,d,C,I;const f=getResizeHandleElement(t,r),A=getResizeHandleElementsForGroup(n,r),G=f?A.indexOf(f):-1,B=(u=(d=o[G])===null||d===void 0?void 0:d.id)!==null&&u!==void 0?u:null,Z=(C=(I=o[G+1])===null||I===void 0?void 0:I.id)!==null&&C!==void 0?C:null;return[B,Z]}function useWindowSplitterPanelGroupBehavior({committedValuesRef:n,eagerValuesRef:t,groupId:o,layout:r,panelDataArray:u,panelGroupElement:d,setLayout:C}){useRef({didWarnAboutMissingResizeHandle:!1}),useIsomorphicLayoutEffect$1(()=>{if(!d)return;const I=getResizeHandleElementsForGroup(o,d);for(let f=0;f<u.length-1;f++){const{valueMax:A,valueMin:G,valueNow:B}=calculateAriaValues({layout:r,panelsArray:u,pivotIndices:[f,f+1]}),Z=I[f];if(Z!=null){const w=u[f];assert(w,`No panel data found for index "${f}"`),Z.setAttribute("aria-controls",w.id),Z.setAttribute("aria-valuemax",""+Math.round(A)),Z.setAttribute("aria-valuemin",""+Math.round(G)),Z.setAttribute("aria-valuenow",B!=null?""+Math.round(B):"")}}return()=>{I.forEach((f,A)=>{f.removeAttribute("aria-controls"),f.removeAttribute("aria-valuemax"),f.removeAttribute("aria-valuemin"),f.removeAttribute("aria-valuenow")})}},[o,r,u,d]),useEffect(()=>{if(!d)return;const I=t.current;assert(I,"Eager values not found");const{panelDataArray:f}=I,A=getPanelGroupElement(o,d);assert(A!=null,`No group found for id "${o}"`);const G=getResizeHandleElementsForGroup(o,d);assert(G,`No resize handles found for group id "${o}"`);const B=G.map(Z=>{const w=Z.getAttribute("data-panel-resize-handle-id");assert(w,"Resize handle element has no handle id attribute");const[V,Y]=getResizeHandlePanelIds(o,w,f,d);if(V==null||Y==null)return()=>{};const J=T=>{if(!T.defaultPrevented)switch(T.key){case"Enter":{T.preventDefault();const L=f.findIndex(z=>z.id===V);if(L>=0){const z=f[L];assert(z,`No panel data found for index ${L}`);const K=r[L],{collapsedSize:P=0,collapsible:$,minSize:ie=0}=z.constraints;if(K!=null&&$){const ne=adjustLayoutByDelta({delta:fuzzyNumbersEqual(K,P)?ie-P:P-K,initialLayout:r,panelConstraints:f.map(ee=>ee.constraints),pivotIndices:determinePivotIndices(o,w,d),prevLayout:r,trigger:"keyboard"});r!==ne&&C(ne)}}break}}};return Z.addEventListener("keydown",J),()=>{Z.removeEventListener("keydown",J)}});return()=>{B.forEach(Z=>Z())}},[d,n,t,o,r,u,C])}function areEqual(n,t){if(n.length!==t.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==t[o])return!1;return!0}function getResizeEventCursorPosition(n,t){const o=n==="horizontal",{x:r,y:u}=getResizeEventCoordinates(t);return o?r:u}function calculateDragOffsetPercentage(n,t,o,r,u){const d=o==="horizontal",C=getResizeHandleElement(t,u);assert(C,`No resize handle element found for id "${t}"`);const I=C.getAttribute("data-panel-group-id");assert(I,"Resize handle element has no group id attribute");let{initialCursorPosition:f}=r;const A=getResizeEventCursorPosition(o,n),G=getPanelGroupElement(I,u);assert(G,`No group element found for id "${I}"`);const B=G.getBoundingClientRect(),Z=d?B.width:B.height;return(A-f)/Z*100}function calculateDeltaPercentage(n,t,o,r,u,d){if(isKeyDown(n)){const C=o==="horizontal";let I=0;n.shiftKey?I=100:u!=null?I=u:I=10;let f=0;switch(n.key){case"ArrowDown":f=C?0:I;break;case"ArrowLeft":f=C?-I:0;break;case"ArrowRight":f=C?I:0;break;case"ArrowUp":f=C?0:-I;break;case"End":f=100;break;case"Home":f=-100;break}return f}else return r==null?0:calculateDragOffsetPercentage(n,t,o,r,d)}function calculateUnsafeDefaultLayout({panelDataArray:n}){const t=Array(n.length),o=n.map(d=>d.constraints);let r=0,u=100;for(let d=0;d<n.length;d++){const C=o[d];assert(C,`Panel constraints not found for index ${d}`);const{defaultSize:I}=C;I!=null&&(r++,t[d]=I,u-=I)}for(let d=0;d<n.length;d++){const C=o[d];assert(C,`Panel constraints not found for index ${d}`);const{defaultSize:I}=C;if(I!=null)continue;const f=n.length-r,A=u/f;r++,t[d]=A,u-=A}return t}function callPanelCallbacks(n,t,o){t.forEach((r,u)=>{const d=n[u];assert(d,`Panel data not found for index ${u}`);const{callbacks:C,constraints:I,id:f}=d,{collapsedSize:A=0,collapsible:G}=I,B=o[f];if(B==null||r!==B){o[f]=r;const{onCollapse:Z,onExpand:w,onResize:V}=C;V&&V(r,B),G&&(Z||w)&&(w&&(B==null||fuzzyNumbersEqual$1(B,A))&&!fuzzyNumbersEqual$1(r,A)&&w(),Z&&(B==null||!fuzzyNumbersEqual$1(B,A))&&fuzzyNumbersEqual$1(r,A)&&Z())}})}function compareLayouts(n,t){if(n.length!==t.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!=t[o])return!1;return!0}function computePanelFlexBoxStyle({defaultSize:n,dragState:t,layout:o,panelData:r,panelIndex:u,precision:d=3}){const C=o[u];let I;return C==null?I=n!=null?n.toPrecision(d):"1":r.length===1?I="1":I=C.toPrecision(d),{flexBasis:0,flexGrow:I,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function debounce(n,t=10){let o=null;return(...u)=>{o!==null&&clearTimeout(o),o=setTimeout(()=>{n(...u)},t)}}function initializeDefaultStorage(n){try{if(typeof localStorage<"u")n.getItem=t=>localStorage.getItem(t),n.setItem=(t,o)=>{localStorage.setItem(t,o)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),n.getItem=()=>null,n.setItem=()=>{}}}function getPanelGroupKey(n){return`react-resizable-panels:${n}`}function getPanelKey(n){return n.map(t=>{const{constraints:o,id:r,idIsFromProps:u,order:d}=t;return u?r:d?`${d}:${JSON.stringify(o)}`:JSON.stringify(o)}).sort((t,o)=>t.localeCompare(o)).join(",")}function loadSerializedPanelGroupState(n,t){try{const o=getPanelGroupKey(n),r=t.getItem(o);if(r){const u=JSON.parse(r);if(typeof u=="object"&&u!=null)return u}}catch{}return null}function loadPanelGroupState(n,t,o){var r,u;const d=(r=loadSerializedPanelGroupState(n,o))!==null&&r!==void 0?r:{},C=getPanelKey(t);return(u=d[C])!==null&&u!==void 0?u:null}function savePanelGroupState(n,t,o,r,u){var d;const C=getPanelGroupKey(n),I=getPanelKey(t),f=(d=loadSerializedPanelGroupState(n,u))!==null&&d!==void 0?d:{};f[I]={expandToSizes:Object.fromEntries(o.entries()),layout:r};try{u.setItem(C,JSON.stringify(f))}catch(A){console.error(A)}}function validatePanelGroupLayout({layout:n,panelConstraints:t}){const o=[...n],r=o.reduce((d,C)=>d+C,0);if(o.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${o.map(d=>`${d}%`).join(", ")}`);if(!fuzzyNumbersEqual(r,100)&&o.length>0)for(let d=0;d<t.length;d++){const C=o[d];assert(C!=null,`No layout data found for index ${d}`);const I=100/r*C;o[d]=I}let u=0;for(let d=0;d<t.length;d++){const C=o[d];assert(C!=null,`No layout data found for index ${d}`);const I=resizePanel({panelConstraints:t,panelIndex:d,size:C});C!=I&&(u+=C-I,o[d]=I)}if(!fuzzyNumbersEqual(u,0))for(let d=0;d<t.length;d++){const C=o[d];assert(C!=null,`No layout data found for index ${d}`);const I=C+u,f=resizePanel({panelConstraints:t,panelIndex:d,size:I});if(C!==f&&(u-=f-C,o[d]=f,fuzzyNumbersEqual(u,0)))break}return o}const LOCAL_STORAGE_DEBOUNCE_INTERVAL=100,defaultStorage={getItem:n=>(initializeDefaultStorage(defaultStorage),defaultStorage.getItem(n)),setItem:(n,t)=>{initializeDefaultStorage(defaultStorage),defaultStorage.setItem(n,t)}},debounceMap={};function PanelGroupWithForwardedRef({autoSaveId:n=null,children:t,className:o="",direction:r,forwardedRef:u,id:d=null,onLayout:C=null,keyboardResizeBy:I=null,storage:f=defaultStorage,style:A,tagName:G="div",...B}){const Z=useUniqueId(d),w=useRef(null),[V,Y]=useState(null),[J,T]=useState([]),L=useForceUpdate(),z=useRef({}),K=useRef(new Map),P=useRef(0),$=useRef({autoSaveId:n,direction:r,dragState:V,id:Z,keyboardResizeBy:I,onLayout:C,storage:f}),ie=useRef({layout:J,panelDataArray:[],panelDataArrayChanged:!1});useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),useImperativeHandle(u,()=>({getId:()=>$.current.id,getLayout:()=>{const{layout:le}=ie.current;return le},setLayout:le=>{const{onLayout:Ae}=$.current,{layout:Xe,panelDataArray:Te}=ie.current,Ne=validatePanelGroupLayout({layout:le,panelConstraints:Te.map(We=>We.constraints)});areEqual(Xe,Ne)||(T(Ne),ie.current.layout=Ne,Ae&&Ae(Ne),callPanelCallbacks(Te,Ne,z.current))}}),[]),useIsomorphicLayoutEffect$1(()=>{$.current.autoSaveId=n,$.current.direction=r,$.current.dragState=V,$.current.id=Z,$.current.onLayout=C,$.current.storage=f}),useWindowSplitterPanelGroupBehavior({committedValuesRef:$,eagerValuesRef:ie,groupId:Z,layout:J,panelDataArray:ie.current.panelDataArray,setLayout:T,panelGroupElement:w.current}),useEffect(()=>{const{panelDataArray:le}=ie.current;if(n){if(J.length===0||J.length!==le.length)return;let Ae=debounceMap[n];Ae==null&&(Ae=debounce(savePanelGroupState,LOCAL_STORAGE_DEBOUNCE_INTERVAL),debounceMap[n]=Ae);const Xe=[...le],Te=new Map(K.current);Ae(n,Xe,Te,J,f)}},[n,J,f]),useEffect(()=>{});const ne=useCallback(le=>{const{onLayout:Ae}=$.current,{layout:Xe,panelDataArray:Te}=ie.current;if(le.constraints.collapsible){const Ne=Te.map(Rt=>Rt.constraints),{collapsedSize:We=0,panelSize:dt,pivotIndices:nt}=panelDataHelper(Te,le,Xe);if(assert(dt!=null,`Panel size not found for panel "${le.id}"`),!fuzzyNumbersEqual$1(dt,We)){K.current.set(le.id,dt);const Qe=findPanelDataIndex(Te,le)===Te.length-1?dt-We:We-dt,Oe=adjustLayoutByDelta({delta:Qe,initialLayout:Xe,panelConstraints:Ne,pivotIndices:nt,prevLayout:Xe,trigger:"imperative-api"});compareLayouts(Xe,Oe)||(T(Oe),ie.current.layout=Oe,Ae&&Ae(Oe),callPanelCallbacks(Te,Oe,z.current))}}},[]),ee=useCallback((le,Ae)=>{const{onLayout:Xe}=$.current,{layout:Te,panelDataArray:Ne}=ie.current;if(le.constraints.collapsible){const We=Ne.map(be=>be.constraints),{collapsedSize:dt=0,panelSize:nt=0,minSize:Rt=0,pivotIndices:Qe}=panelDataHelper(Ne,le,Te),Oe=Ae??Rt;if(fuzzyNumbersEqual$1(nt,dt)){const be=K.current.get(le.id),yt=be!=null&&be>=Oe?be:Oe,Gt=findPanelDataIndex(Ne,le)===Ne.length-1?nt-yt:yt-nt,rt=adjustLayoutByDelta({delta:Gt,initialLayout:Te,panelConstraints:We,pivotIndices:Qe,prevLayout:Te,trigger:"imperative-api"});compareLayouts(Te,rt)||(T(rt),ie.current.layout=rt,Xe&&Xe(rt),callPanelCallbacks(Ne,rt,z.current))}}},[]),se=useCallback(le=>{const{layout:Ae,panelDataArray:Xe}=ie.current,{panelSize:Te}=panelDataHelper(Xe,le,Ae);return assert(Te!=null,`Panel size not found for panel "${le.id}"`),Te},[]),re=useCallback((le,Ae)=>{const{panelDataArray:Xe}=ie.current,Te=findPanelDataIndex(Xe,le);return computePanelFlexBoxStyle({defaultSize:Ae,dragState:V,layout:J,panelData:Xe,panelIndex:Te})},[V,J]),ce=useCallback(le=>{const{layout:Ae,panelDataArray:Xe}=ie.current,{collapsedSize:Te=0,collapsible:Ne,panelSize:We}=panelDataHelper(Xe,le,Ae);return assert(We!=null,`Panel size not found for panel "${le.id}"`),Ne===!0&&fuzzyNumbersEqual$1(We,Te)},[]),ue=useCallback(le=>{const{layout:Ae,panelDataArray:Xe}=ie.current,{collapsedSize:Te=0,collapsible:Ne,panelSize:We}=panelDataHelper(Xe,le,Ae);return assert(We!=null,`Panel size not found for panel "${le.id}"`),!Ne||fuzzyCompareNumbers(We,Te)>0},[]),ye=useCallback(le=>{const{panelDataArray:Ae}=ie.current;Ae.push(le),Ae.sort((Xe,Te)=>{const Ne=Xe.order,We=Te.order;return Ne==null&&We==null?0:Ne==null?-1:We==null?1:Ne-We}),ie.current.panelDataArrayChanged=!0,L()},[L]);useIsomorphicLayoutEffect$1(()=>{if(ie.current.panelDataArrayChanged){ie.current.panelDataArrayChanged=!1;const{autoSaveId:le,onLayout:Ae,storage:Xe}=$.current,{layout:Te,panelDataArray:Ne}=ie.current;let We=null;if(le){const nt=loadPanelGroupState(le,Ne,Xe);nt&&(K.current=new Map(Object.entries(nt.expandToSizes)),We=nt.layout)}We==null&&(We=calculateUnsafeDefaultLayout({panelDataArray:Ne}));const dt=validatePanelGroupLayout({layout:We,panelConstraints:Ne.map(nt=>nt.constraints)});areEqual(Te,dt)||(T(dt),ie.current.layout=dt,Ae&&Ae(dt),callPanelCallbacks(Ne,dt,z.current))}}),useIsomorphicLayoutEffect$1(()=>{const le=ie.current;return()=>{le.layout=[]}},[]);const Se=useCallback(le=>{let Ae=!1;const Xe=w.current;return Xe&&window.getComputedStyle(Xe,null).getPropertyValue("direction")==="rtl"&&(Ae=!0),function(Ne){Ne.preventDefault();const We=w.current;if(!We)return()=>null;const{direction:dt,dragState:nt,id:Rt,keyboardResizeBy:Qe,onLayout:Oe}=$.current,{layout:be,panelDataArray:yt}=ie.current,{initialLayout:st}=nt??{},Gt=determinePivotIndices(Rt,le,We);let rt=calculateDeltaPercentage(Ne,le,dt,nt,Qe,We);const Yt=dt==="horizontal";Yt&&Ae&&(rt=-rt);const Xt=yt.map(ke=>ke.constraints),Ge=adjustLayoutByDelta({delta:rt,initialLayout:st??be,panelConstraints:Xt,pivotIndices:Gt,prevLayout:be,trigger:isKeyDown(Ne)?"keyboard":"mouse-or-touch"}),he=!compareLayouts(be,Ge);(isPointerEvent(Ne)||isMouseEvent(Ne))&&P.current!=rt&&(P.current=rt,!he&&rt!==0?Yt?reportConstraintsViolation(le,rt<0?EXCEEDED_HORIZONTAL_MIN:EXCEEDED_HORIZONTAL_MAX):reportConstraintsViolation(le,rt<0?EXCEEDED_VERTICAL_MIN:EXCEEDED_VERTICAL_MAX):reportConstraintsViolation(le,0)),he&&(T(Ge),ie.current.layout=Ge,Oe&&Oe(Ge),callPanelCallbacks(yt,Ge,z.current))}},[]),Ce=useCallback((le,Ae)=>{const{onLayout:Xe}=$.current,{layout:Te,panelDataArray:Ne}=ie.current,We=Ne.map(be=>be.constraints),{panelSize:dt,pivotIndices:nt}=panelDataHelper(Ne,le,Te);assert(dt!=null,`Panel size not found for panel "${le.id}"`);const Qe=findPanelDataIndex(Ne,le)===Ne.length-1?dt-Ae:Ae-dt,Oe=adjustLayoutByDelta({delta:Qe,initialLayout:Te,panelConstraints:We,pivotIndices:nt,prevLayout:Te,trigger:"imperative-api"});compareLayouts(Te,Oe)||(T(Oe),ie.current.layout=Oe,Xe&&Xe(Oe),callPanelCallbacks(Ne,Oe,z.current))},[]),Ze=useCallback((le,Ae)=>{const{layout:Xe,panelDataArray:Te}=ie.current,{collapsedSize:Ne=0,collapsible:We}=Ae,{collapsedSize:dt=0,collapsible:nt,maxSize:Rt=100,minSize:Qe=0}=le.constraints,{panelSize:Oe}=panelDataHelper(Te,le,Xe);Oe!=null&&(We&&nt&&fuzzyNumbersEqual$1(Oe,Ne)?fuzzyNumbersEqual$1(Ne,dt)||Ce(le,dt):Oe<Qe?Ce(le,Qe):Oe>Rt&&Ce(le,Rt))},[Ce]),Be=useCallback((le,Ae)=>{const{direction:Xe}=$.current,{layout:Te}=ie.current;if(!w.current)return;const Ne=getResizeHandleElement(le,w.current);assert(Ne,`Drag handle element not found for id "${le}"`);const We=getResizeEventCursorPosition(Xe,Ae);Y({dragHandleId:le,dragHandleRect:Ne.getBoundingClientRect(),initialCursorPosition:We,initialLayout:Te})},[]),xe=useCallback(()=>{Y(null)},[]),ge=useCallback(le=>{const{panelDataArray:Ae}=ie.current,Xe=findPanelDataIndex(Ae,le);Xe>=0&&(Ae.splice(Xe,1),delete z.current[le.id],ie.current.panelDataArrayChanged=!0,L())},[L]),de=useMemo(()=>({collapsePanel:ne,direction:r,dragState:V,expandPanel:ee,getPanelSize:se,getPanelStyle:re,groupId:Z,isPanelCollapsed:ce,isPanelExpanded:ue,reevaluatePanelConstraints:Ze,registerPanel:ye,registerResizeHandle:Se,resizePanel:Ce,startDragging:Be,stopDragging:xe,unregisterPanel:ge,panelGroupElement:w.current}),[ne,V,r,ee,se,re,Z,ce,ue,Ze,ye,Se,Ce,Be,xe,ge]),ve={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return createElement(PanelGroupContext.Provider,{value:de},createElement(G,{...B,children:t,className:o,id:d,ref:w,style:{...ve,...A},"data-panel-group":"","data-panel-group-direction":r,"data-panel-group-id":Z}))}const PanelGroup=forwardRef((n,t)=>createElement(PanelGroupWithForwardedRef,{...n,forwardedRef:t}));PanelGroupWithForwardedRef.displayName="PanelGroup";PanelGroup.displayName="forwardRef(PanelGroup)";function findPanelDataIndex(n,t){return n.findIndex(o=>o===t||o.id===t.id)}function panelDataHelper(n,t,o){const r=findPanelDataIndex(n,t),d=r===n.length-1?[r-1,r]:[r,r+1],C=o[r];return{...t.constraints,panelSize:C,pivotIndices:d}}function useWindowSplitterResizeHandlerBehavior({disabled:n,handleId:t,resizeHandler:o,panelGroupElement:r}){useEffect(()=>{if(n||o==null||r==null)return;const u=getResizeHandleElement(t,r);if(u==null)return;const d=C=>{if(!C.defaultPrevented)switch(C.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{C.preventDefault(),o(C);break}case"F6":{C.preventDefault();const I=u.getAttribute("data-panel-group-id");assert(I,`No group element found for id "${I}"`);const f=getResizeHandleElementsForGroup(I,r),A=getResizeHandleElementIndex(I,t,r);assert(A!==null,`No resize element found for id "${t}"`);const G=C.shiftKey?A>0?A-1:f.length-1:A+1<f.length?A+1:0;f[G].focus();break}}};return u.addEventListener("keydown",d),()=>{u.removeEventListener("keydown",d)}},[r,n,t,o])}function PanelResizeHandle({children:n=null,className:t="",disabled:o=!1,hitAreaMargins:r,id:u,onBlur:d,onDragging:C,onFocus:I,style:f={},tabIndex:A=0,tagName:G="div",...B}){var Z,w;const V=useRef(null),Y=useRef({onDragging:C});useEffect(()=>{Y.current.onDragging=C});const J=useContext(PanelGroupContext);if(J===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:T,groupId:L,registerResizeHandle:z,startDragging:K,stopDragging:P,panelGroupElement:$}=J,ie=useUniqueId(u),[ne,ee]=useState("inactive"),[se,re]=useState(!1),[ce,ue]=useState(null),ye=useRef({state:ne});useIsomorphicLayoutEffect$1(()=>{ye.current.state=ne}),useEffect(()=>{if(o)ue(null);else{const Be=z(ie);ue(()=>Be)}},[o,ie,z]);const Se=(Z=r==null?void 0:r.coarse)!==null&&Z!==void 0?Z:15,Ce=(w=r==null?void 0:r.fine)!==null&&w!==void 0?w:5;return useEffect(()=>{if(o||ce==null)return;const Be=V.current;return assert(Be,"Element ref not attached"),registerResizeHandle(ie,Be,T,{coarse:Se,fine:Ce},(ge,de,ve)=>{if(de)switch(ge){case"down":{ee("drag"),assert(ve,'Expected event to be defined for "down" action'),K(ie,ve);const{onDragging:le}=Y.current;le&&le(!0);break}case"move":{const{state:le}=ye.current;le!=="drag"&&ee("hover"),assert(ve,'Expected event to be defined for "move" action'),ce(ve);break}case"up":{ee("hover"),P();const{onDragging:le}=Y.current;le&&le(!1);break}}else ee("inactive")})},[Se,T,o,Ce,z,ie,ce,K,P]),useWindowSplitterResizeHandlerBehavior({disabled:o,handleId:ie,resizeHandler:ce,panelGroupElement:$}),createElement(G,{...B,children:n,className:t,id:u,onBlur:()=>{re(!1),d==null||d()},onFocus:()=>{re(!0),I==null||I()},ref:V,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...f},tabIndex:A,"data-panel-group-direction":T,"data-panel-group-id":L,"data-resize-handle":"","data-resize-handle-active":ne==="drag"?"pointer":se?"keyboard":void 0,"data-resize-handle-state":ne,"data-panel-resize-handle-enabled":!o,"data-panel-resize-handle-id":ie})}PanelResizeHandle.displayName="PanelResizeHandle";/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="174",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,TimestampQuery={COMPUTE:"compute",RENDER:"render"};let EventDispatcher$1=class{addEventListener(t,o){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(o)===-1&&r[t].push(o)}hasEventListener(t,o){const r=this._listeners;return r===void 0?!1:r[t]!==void 0&&r[t].indexOf(o)!==-1}removeEventListener(t,o){const r=this._listeners;if(r===void 0)return;const u=r[t];if(u!==void 0){const d=u.indexOf(o);d!==-1&&u.splice(d,1)}}dispatchEvent(t){const o=this._listeners;if(o===void 0)return;const r=o[t.type];if(r!==void 0){t.target=this;const u=r.slice(0);for(let d=0,C=u.length;d<C;d++)u[d].call(this,t);t.target=null}}};const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,o=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[o&63|128]+_lut[o>>8&255]+"-"+_lut[o>>16&255]+_lut[o>>24&255]+_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]).toLowerCase()}function clamp(n,t,o){return Math.max(t,Math.min(o,n))}function euclideanModulo(n,t){return(n%t+t)%t}function mapLinear(n,t,o,r,u){return r+(n-t)*(u-r)/(o-t)}function inverseLerp(n,t,o){return n!==t?(o-n)/(t-n):0}function lerp(n,t,o){return(1-o)*n+o*t}function damp(n,t,o,r){return lerp(n,t,1-Math.exp(-o*r))}function pingpong(n,t=1){return t-Math.abs(euclideanModulo(n,t*2)-t)}function smoothstep(n,t,o){return n<=t?0:n>=o?1:(n=(n-t)/(o-t),n*n*(3-2*n))}function smootherstep(n,t,o){return n<=t?0:n>=o?1:(n=(n-t)/(o-t),n*n*n*(n*(n*6-15)+10))}function randInt(n,t){return n+Math.floor(Math.random()*(t-n+1))}function randFloat(n,t){return n+Math.random()*(t-n)}function randFloatSpread(n){return n*(.5-Math.random())}function seededRandom(n){n!==void 0&&(_seed=n);let t=_seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function degToRad(n){return n*DEG2RAD}function radToDeg(n){return n*RAD2DEG}function isPowerOfTwo(n){return(n&n-1)===0&&n!==0}function ceilPowerOfTwo(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function floorPowerOfTwo(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function setQuaternionFromProperEuler(n,t,o,r,u){const d=Math.cos,C=Math.sin,I=d(o/2),f=C(o/2),A=d((t+r)/2),G=C((t+r)/2),B=d((t-r)/2),Z=C((t-r)/2),w=d((r-t)/2),V=C((r-t)/2);switch(u){case"XYX":n.set(I*G,f*B,f*Z,I*A);break;case"YZY":n.set(f*Z,I*G,f*B,I*A);break;case"ZXZ":n.set(f*B,f*Z,I*G,I*A);break;case"XZX":n.set(I*G,f*V,f*w,I*A);break;case"YXY":n.set(f*w,I*G,f*V,I*A);break;case"ZYZ":n.set(f*V,f*w,I*G,I*A);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+u)}}function denormalize(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function normalize(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(t=0,o=0){Vector2.prototype.isVector2=!0,this.x=t,this.y=o}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,o){return this.x=t,this.y=o,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const o=this.x,r=this.y,u=t.elements;return this.x=u[0]*o+u[3]*r+u[6],this.y=u[1]*o+u[4]*r+u[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,o){return this.x=clamp(this.x,t.x,o.x),this.y=clamp(this.y,t.y,o.y),this}clampScalar(t,o){return this.x=clamp(this.x,t,o),this.y=clamp(this.y,t,o),this}clampLength(t,o){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const o=Math.sqrt(this.lengthSq()*t.lengthSq());if(o===0)return Math.PI/2;const r=this.dot(t)/o;return Math.acos(clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const o=this.x-t.x,r=this.y-t.y;return o*o+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this}lerpVectors(t,o,r){return this.x=t.x+(o.x-t.x)*r,this.y=t.y+(o.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this}rotateAround(t,o){const r=Math.cos(o),u=Math.sin(o),d=this.x-t.x,C=this.y-t.y;return this.x=d*r-C*u+t.x,this.y=d*u+C*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(t,o,r,u,d,C,I,f,A){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,o,r,u,d,C,I,f,A)}set(t,o,r,u,d,C,I,f,A){const G=this.elements;return G[0]=t,G[1]=u,G[2]=I,G[3]=o,G[4]=d,G[5]=f,G[6]=r,G[7]=C,G[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const o=this.elements,r=t.elements;return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[8]=r[8],this}extractBasis(t,o,r){return t.setFromMatrix3Column(this,0),o.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const o=t.elements;return this.set(o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,o){const r=t.elements,u=o.elements,d=this.elements,C=r[0],I=r[3],f=r[6],A=r[1],G=r[4],B=r[7],Z=r[2],w=r[5],V=r[8],Y=u[0],J=u[3],T=u[6],L=u[1],z=u[4],K=u[7],P=u[2],$=u[5],ie=u[8];return d[0]=C*Y+I*L+f*P,d[3]=C*J+I*z+f*$,d[6]=C*T+I*K+f*ie,d[1]=A*Y+G*L+B*P,d[4]=A*J+G*z+B*$,d[7]=A*T+G*K+B*ie,d[2]=Z*Y+w*L+V*P,d[5]=Z*J+w*z+V*$,d[8]=Z*T+w*K+V*ie,this}multiplyScalar(t){const o=this.elements;return o[0]*=t,o[3]*=t,o[6]*=t,o[1]*=t,o[4]*=t,o[7]*=t,o[2]*=t,o[5]*=t,o[8]*=t,this}determinant(){const t=this.elements,o=t[0],r=t[1],u=t[2],d=t[3],C=t[4],I=t[5],f=t[6],A=t[7],G=t[8];return o*C*G-o*I*A-r*d*G+r*I*f+u*d*A-u*C*f}invert(){const t=this.elements,o=t[0],r=t[1],u=t[2],d=t[3],C=t[4],I=t[5],f=t[6],A=t[7],G=t[8],B=G*C-I*A,Z=I*f-G*d,w=A*d-C*f,V=o*B+r*Z+u*w;if(V===0)return this.set(0,0,0,0,0,0,0,0,0);const Y=1/V;return t[0]=B*Y,t[1]=(u*A-G*r)*Y,t[2]=(I*r-u*C)*Y,t[3]=Z*Y,t[4]=(G*o-u*f)*Y,t[5]=(u*d-I*o)*Y,t[6]=w*Y,t[7]=(r*f-A*o)*Y,t[8]=(C*o-r*d)*Y,this}transpose(){let t;const o=this.elements;return t=o[1],o[1]=o[3],o[3]=t,t=o[2],o[2]=o[6],o[6]=t,t=o[5],o[5]=o[7],o[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const o=this.elements;return t[0]=o[0],t[1]=o[3],t[2]=o[6],t[3]=o[1],t[4]=o[4],t[5]=o[7],t[6]=o[2],t[7]=o[5],t[8]=o[8],this}setUvTransform(t,o,r,u,d,C,I){const f=Math.cos(d),A=Math.sin(d);return this.set(r*f,r*A,-r*(f*C+A*I)+C+t,-u*A,u*f,-u*(-A*C+f*I)+I+o,0,0,1),this}scale(t,o){return this.premultiply(_m3.makeScale(t,o)),this}rotate(t){return this.premultiply(_m3.makeRotation(-t)),this}translate(t,o){return this.premultiply(_m3.makeTranslation(t,o)),this}makeTranslation(t,o){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,o,0,0,1),this}makeRotation(t){const o=Math.cos(t),r=Math.sin(t);return this.set(o,-r,0,r,o,0,0,0,1),this}makeScale(t,o){return this.set(t,0,0,0,o,0,0,0,1),this}equals(t){const o=this.elements,r=t.elements;for(let u=0;u<9;u++)if(o[u]!==r[u])return!1;return!0}fromArray(t,o=0){for(let r=0;r<9;r++)this.elements[r]=t[r+o];return this}toArray(t=[],o=0){const r=this.elements;return t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3],t[o+4]=r[4],t[o+5]=r[5],t[o+6]=r[6],t[o+7]=r[7],t[o+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(n,t){return new TYPED_ARRAYS[n](t)}function createElementNS(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function createCanvasElement(){const n=createElementNS("canvas");return n.style.display="block",n}const _cache={};function warnOnce(n){n in _cache||(_cache[n]=!0,console.warn(n))}function probeAsync(n,t,o){return new Promise(function(r,u){function d(){switch(n.clientWaitSync(t,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:u();break;case n.TIMEOUT_EXPIRED:setTimeout(d,o);break;default:r()}}setTimeout(d,o)})}function toNormalizedProjectionMatrix(n){const t=n.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function toReversedProjectionMatrix(n){const t=n.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const n={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(u,d,C){return this.enabled===!1||d===C||!d||!C||(this.spaces[d].transfer===SRGBTransfer&&(u.r=SRGBToLinear(u.r),u.g=SRGBToLinear(u.g),u.b=SRGBToLinear(u.b)),this.spaces[d].primaries!==this.spaces[C].primaries&&(u.applyMatrix3(this.spaces[d].toXYZ),u.applyMatrix3(this.spaces[C].fromXYZ)),this.spaces[C].transfer===SRGBTransfer&&(u.r=LinearToSRGB(u.r),u.g=LinearToSRGB(u.g),u.b=LinearToSRGB(u.b))),u},fromWorkingColorSpace:function(u,d){return this.convert(u,this.workingColorSpace,d)},toWorkingColorSpace:function(u,d){return this.convert(u,d,this.workingColorSpace)},getPrimaries:function(u){return this.spaces[u].primaries},getTransfer:function(u){return u===NoColorSpace?LinearTransfer:this.spaces[u].transfer},getLuminanceCoefficients:function(u,d=this.workingColorSpace){return u.fromArray(this.spaces[d].luminanceCoefficients)},define:function(u){Object.assign(this.spaces,u)},_getMatrix:function(u,d,C){return u.copy(this.spaces[d].toXYZ).multiply(this.spaces[C].fromXYZ)},_getDrawingBufferColorSpace:function(u){return this.spaces[u].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(u=this.workingColorSpace){return this.spaces[u].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],o=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[LinearSRGBColorSpace]:{primaries:t,whitePoint:r,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:o,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:t,whitePoint:r,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:o,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),n}const ColorManagement=createColorManagement();function SRGBToLinear(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function LinearToSRGB(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let o;if(t instanceof HTMLCanvasElement)o=t;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=t.width,_canvas.height=t.height;const r=_canvas.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),o=_canvas}return o.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const o=createElementNS("canvas");o.width=t.width,o.height=t.height;const r=o.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const u=r.getImageData(0,0,t.width,t.height),d=u.data;for(let C=0;C<d.length;C++)d[C]=SRGBToLinear(d[C]/255)*255;return r.putImageData(u,0,0),o}else if(t.data){const o=t.data.slice(0);for(let r=0;r<o.length;r++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[r]=Math.floor(SRGBToLinear(o[r]/255)*255):o[r]=SRGBToLinear(o[r]);return{data:o,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let _sourceId=0;class Source{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const o=t===void 0||typeof t=="string";if(!o&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},u=this.data;if(u!==null){let d;if(Array.isArray(u)){d=[];for(let C=0,I=u.length;C<I;C++)u[C].isDataTexture?d.push(serializeImage(u[C].image)):d.push(serializeImage(u[C]))}else d=serializeImage(u);r.url=d}return o||(t.images[this.uuid]=r),r}}function serializeImage(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?ImageUtils.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher$1{constructor(t=Texture.DEFAULT_IMAGE,o=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,u=ClampToEdgeWrapping,d=LinearFilter,C=LinearMipmapLinearFilter,I=RGBAFormat,f=UnsignedByteType,A=Texture.DEFAULT_ANISOTROPY,G=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(t),this.mipmaps=[],this.mapping=o,this.channel=0,this.wrapS=r,this.wrapT=u,this.magFilter=d,this.minFilter=C,this.anisotropy=A,this.format=I,this.internalFormat=null,this.type=f,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=G,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const o=t===void 0||typeof t=="string";if(!o&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),o||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(t=0,o=0,r=0,u=1){Vector4.prototype.isVector4=!0,this.x=t,this.y=o,this.z=r,this.w=u}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,o,r,u){return this.x=t,this.y=o,this.z=r,this.w=u,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;case 3:this.w=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this.z=t.z+o.z,this.w=t.w+o.w,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this.z+=t.z*o,this.w+=t.w*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this.z=t.z-o.z,this.w=t.w-o.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const o=this.x,r=this.y,u=this.z,d=this.w,C=t.elements;return this.x=C[0]*o+C[4]*r+C[8]*u+C[12]*d,this.y=C[1]*o+C[5]*r+C[9]*u+C[13]*d,this.z=C[2]*o+C[6]*r+C[10]*u+C[14]*d,this.w=C[3]*o+C[7]*r+C[11]*u+C[15]*d,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const o=Math.sqrt(1-t.w*t.w);return o<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/o,this.y=t.y/o,this.z=t.z/o),this}setAxisAngleFromRotationMatrix(t){let o,r,u,d;const f=t.elements,A=f[0],G=f[4],B=f[8],Z=f[1],w=f[5],V=f[9],Y=f[2],J=f[6],T=f[10];if(Math.abs(G-Z)<.01&&Math.abs(B-Y)<.01&&Math.abs(V-J)<.01){if(Math.abs(G+Z)<.1&&Math.abs(B+Y)<.1&&Math.abs(V+J)<.1&&Math.abs(A+w+T-3)<.1)return this.set(1,0,0,0),this;o=Math.PI;const z=(A+1)/2,K=(w+1)/2,P=(T+1)/2,$=(G+Z)/4,ie=(B+Y)/4,ne=(V+J)/4;return z>K&&z>P?z<.01?(r=0,u=.707106781,d=.707106781):(r=Math.sqrt(z),u=$/r,d=ie/r):K>P?K<.01?(r=.707106781,u=0,d=.707106781):(u=Math.sqrt(K),r=$/u,d=ne/u):P<.01?(r=.707106781,u=.707106781,d=0):(d=Math.sqrt(P),r=ie/d,u=ne/d),this.set(r,u,d,o),this}let L=Math.sqrt((J-V)*(J-V)+(B-Y)*(B-Y)+(Z-G)*(Z-G));return Math.abs(L)<.001&&(L=1),this.x=(J-V)/L,this.y=(B-Y)/L,this.z=(Z-G)/L,this.w=Math.acos((A+w+T-1)/2),this}setFromMatrixPosition(t){const o=t.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this.w=o[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,o){return this.x=clamp(this.x,t.x,o.x),this.y=clamp(this.y,t.y,o.y),this.z=clamp(this.z,t.z,o.z),this.w=clamp(this.w,t.w,o.w),this}clampScalar(t,o){return this.x=clamp(this.x,t,o),this.y=clamp(this.y,t,o),this.z=clamp(this.z,t,o),this.w=clamp(this.w,t,o),this}clampLength(t,o){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this.z+=(t.z-this.z)*o,this.w+=(t.w-this.w)*o,this}lerpVectors(t,o,r){return this.x=t.x+(o.x-t.x)*r,this.y=t.y+(o.y-t.y)*r,this.z=t.z+(o.z-t.z)*r,this.w=t.w+(o.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this.z=t[o+2],this.w=t[o+3],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,t[o+3]=this.w,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this.z=t.getZ(o),this.w=t.getW(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher$1{constructor(t=1,o=1,r={}){super(),this.isRenderTarget=!0,this.width=t,this.height=o,this.depth=1,this.scissor=new Vector4(0,0,t,o),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,o);const u={width:t,height:o,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const d=new Texture(u,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);d.flipY=!1,d.generateMipmaps=r.generateMipmaps,d.internalFormat=r.internalFormat,this.textures=[];const C=r.count;for(let I=0;I<C;I++)this.textures[I]=d.clone(),this.textures[I].isRenderTargetTexture=!0,this.textures[I].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,o,r=1){if(this.width!==t||this.height!==o||this.depth!==r){this.width=t,this.height=o,this.depth=r;for(let u=0,d=this.textures.length;u<d;u++)this.textures[u].image.width=t,this.textures[u].image.height=o,this.textures[u].image.depth=r;this.dispose()}this.viewport.set(0,0,t,o),this.scissor.set(0,0,t,o)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let o=0,r=t.textures.length;o<r;o++){this.textures[o]=t.textures[o].clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;const u=Object.assign({},t.textures[o].image);this.textures[o].source=new Source(u)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(t=1,o=1,r={}){super(t,o,r),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(t=null,o=1,r=1,u=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:o,height:r,depth:u},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(t=1,o=1,r=1,u={}){super(t,o,u),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new DataArrayTexture(null,t,o,r),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(t=null,o=1,r=1,u=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:o,height:r,depth:u},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(t=1,o=1,r=1,u={}){super(t,o,u),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Data3DTexture(null,t,o,r),this.texture.isRenderTargetTexture=!0}}let Quaternion$2=class{constructor(t=0,o=0,r=0,u=1){this.isQuaternion=!0,this._x=t,this._y=o,this._z=r,this._w=u}static slerpFlat(t,o,r,u,d,C,I){let f=r[u+0],A=r[u+1],G=r[u+2],B=r[u+3];const Z=d[C+0],w=d[C+1],V=d[C+2],Y=d[C+3];if(I===0){t[o+0]=f,t[o+1]=A,t[o+2]=G,t[o+3]=B;return}if(I===1){t[o+0]=Z,t[o+1]=w,t[o+2]=V,t[o+3]=Y;return}if(B!==Y||f!==Z||A!==w||G!==V){let J=1-I;const T=f*Z+A*w+G*V+B*Y,L=T>=0?1:-1,z=1-T*T;if(z>Number.EPSILON){const P=Math.sqrt(z),$=Math.atan2(P,T*L);J=Math.sin(J*$)/P,I=Math.sin(I*$)/P}const K=I*L;if(f=f*J+Z*K,A=A*J+w*K,G=G*J+V*K,B=B*J+Y*K,J===1-I){const P=1/Math.sqrt(f*f+A*A+G*G+B*B);f*=P,A*=P,G*=P,B*=P}}t[o]=f,t[o+1]=A,t[o+2]=G,t[o+3]=B}static multiplyQuaternionsFlat(t,o,r,u,d,C){const I=r[u],f=r[u+1],A=r[u+2],G=r[u+3],B=d[C],Z=d[C+1],w=d[C+2],V=d[C+3];return t[o]=I*V+G*B+f*w-A*Z,t[o+1]=f*V+G*Z+A*B-I*w,t[o+2]=A*V+G*w+I*Z-f*B,t[o+3]=G*V-I*B-f*Z-A*w,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,o,r,u){return this._x=t,this._y=o,this._z=r,this._w=u,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,o=!0){const r=t._x,u=t._y,d=t._z,C=t._order,I=Math.cos,f=Math.sin,A=I(r/2),G=I(u/2),B=I(d/2),Z=f(r/2),w=f(u/2),V=f(d/2);switch(C){case"XYZ":this._x=Z*G*B+A*w*V,this._y=A*w*B-Z*G*V,this._z=A*G*V+Z*w*B,this._w=A*G*B-Z*w*V;break;case"YXZ":this._x=Z*G*B+A*w*V,this._y=A*w*B-Z*G*V,this._z=A*G*V-Z*w*B,this._w=A*G*B+Z*w*V;break;case"ZXY":this._x=Z*G*B-A*w*V,this._y=A*w*B+Z*G*V,this._z=A*G*V+Z*w*B,this._w=A*G*B-Z*w*V;break;case"ZYX":this._x=Z*G*B-A*w*V,this._y=A*w*B+Z*G*V,this._z=A*G*V-Z*w*B,this._w=A*G*B+Z*w*V;break;case"YZX":this._x=Z*G*B+A*w*V,this._y=A*w*B+Z*G*V,this._z=A*G*V-Z*w*B,this._w=A*G*B-Z*w*V;break;case"XZY":this._x=Z*G*B-A*w*V,this._y=A*w*B-Z*G*V,this._z=A*G*V+Z*w*B,this._w=A*G*B+Z*w*V;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+C)}return o===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,o){const r=o/2,u=Math.sin(r);return this._x=t.x*u,this._y=t.y*u,this._z=t.z*u,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const o=t.elements,r=o[0],u=o[4],d=o[8],C=o[1],I=o[5],f=o[9],A=o[2],G=o[6],B=o[10],Z=r+I+B;if(Z>0){const w=.5/Math.sqrt(Z+1);this._w=.25/w,this._x=(G-f)*w,this._y=(d-A)*w,this._z=(C-u)*w}else if(r>I&&r>B){const w=2*Math.sqrt(1+r-I-B);this._w=(G-f)/w,this._x=.25*w,this._y=(u+C)/w,this._z=(d+A)/w}else if(I>B){const w=2*Math.sqrt(1+I-r-B);this._w=(d-A)/w,this._x=(u+C)/w,this._y=.25*w,this._z=(f+G)/w}else{const w=2*Math.sqrt(1+B-r-I);this._w=(C-u)/w,this._x=(d+A)/w,this._y=(f+G)/w,this._z=.25*w}return this._onChangeCallback(),this}setFromUnitVectors(t,o){let r=t.dot(o)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*o.z-t.z*o.y,this._y=t.z*o.x-t.x*o.z,this._z=t.x*o.y-t.y*o.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp(this.dot(t),-1,1)))}rotateTowards(t,o){const r=this.angleTo(t);if(r===0)return this;const u=Math.min(1,o/r);return this.slerp(t,u),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,o){const r=t._x,u=t._y,d=t._z,C=t._w,I=o._x,f=o._y,A=o._z,G=o._w;return this._x=r*G+C*I+u*A-d*f,this._y=u*G+C*f+d*I-r*A,this._z=d*G+C*A+r*f-u*I,this._w=C*G-r*I-u*f-d*A,this._onChangeCallback(),this}slerp(t,o){if(o===0)return this;if(o===1)return this.copy(t);const r=this._x,u=this._y,d=this._z,C=this._w;let I=C*t._w+r*t._x+u*t._y+d*t._z;if(I<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,I=-I):this.copy(t),I>=1)return this._w=C,this._x=r,this._y=u,this._z=d,this;const f=1-I*I;if(f<=Number.EPSILON){const w=1-o;return this._w=w*C+o*this._w,this._x=w*r+o*this._x,this._y=w*u+o*this._y,this._z=w*d+o*this._z,this.normalize(),this}const A=Math.sqrt(f),G=Math.atan2(A,I),B=Math.sin((1-o)*G)/A,Z=Math.sin(o*G)/A;return this._w=C*B+this._w*Z,this._x=r*B+this._x*Z,this._y=u*B+this._y*Z,this._z=d*B+this._z*Z,this._onChangeCallback(),this}slerpQuaternions(t,o,r){return this.copy(t).slerp(o,r)}random(){const t=2*Math.PI*Math.random(),o=2*Math.PI*Math.random(),r=Math.random(),u=Math.sqrt(1-r),d=Math.sqrt(r);return this.set(u*Math.sin(t),u*Math.cos(t),d*Math.sin(o),d*Math.cos(o))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,o=0){return this._x=t[o],this._y=t[o+1],this._z=t[o+2],this._w=t[o+3],this._onChangeCallback(),this}toArray(t=[],o=0){return t[o]=this._x,t[o+1]=this._y,t[o+2]=this._z,t[o+3]=this._w,t}fromBufferAttribute(t,o){return this._x=t.getX(o),this._y=t.getY(o),this._z=t.getZ(o),this._w=t.getW(o),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Vector3{constructor(t=0,o=0,r=0){Vector3.prototype.isVector3=!0,this.x=t,this.y=o,this.z=r}set(t,o,r){return r===void 0&&(r=this.z),this.x=t,this.y=o,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this.z=t.z+o.z,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this.z+=t.z*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this.z=t.z-o.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,o){return this.x=t.x*o.x,this.y=t.y*o.y,this.z=t.z*o.z,this}applyEuler(t){return this.applyQuaternion(_quaternion$4.setFromEuler(t))}applyAxisAngle(t,o){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(t,o))}applyMatrix3(t){const o=this.x,r=this.y,u=this.z,d=t.elements;return this.x=d[0]*o+d[3]*r+d[6]*u,this.y=d[1]*o+d[4]*r+d[7]*u,this.z=d[2]*o+d[5]*r+d[8]*u,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const o=this.x,r=this.y,u=this.z,d=t.elements,C=1/(d[3]*o+d[7]*r+d[11]*u+d[15]);return this.x=(d[0]*o+d[4]*r+d[8]*u+d[12])*C,this.y=(d[1]*o+d[5]*r+d[9]*u+d[13])*C,this.z=(d[2]*o+d[6]*r+d[10]*u+d[14])*C,this}applyQuaternion(t){const o=this.x,r=this.y,u=this.z,d=t.x,C=t.y,I=t.z,f=t.w,A=2*(C*u-I*r),G=2*(I*o-d*u),B=2*(d*r-C*o);return this.x=o+f*A+C*B-I*G,this.y=r+f*G+I*A-d*B,this.z=u+f*B+d*G-C*A,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const o=this.x,r=this.y,u=this.z,d=t.elements;return this.x=d[0]*o+d[4]*r+d[8]*u,this.y=d[1]*o+d[5]*r+d[9]*u,this.z=d[2]*o+d[6]*r+d[10]*u,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,o){return this.x=clamp(this.x,t.x,o.x),this.y=clamp(this.y,t.y,o.y),this.z=clamp(this.z,t.z,o.z),this}clampScalar(t,o){return this.x=clamp(this.x,t,o),this.y=clamp(this.y,t,o),this.z=clamp(this.z,t,o),this}clampLength(t,o){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this.z+=(t.z-this.z)*o,this}lerpVectors(t,o,r){return this.x=t.x+(o.x-t.x)*r,this.y=t.y+(o.y-t.y)*r,this.z=t.z+(o.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,o){const r=t.x,u=t.y,d=t.z,C=o.x,I=o.y,f=o.z;return this.x=u*f-d*I,this.y=d*C-r*f,this.z=r*I-u*C,this}projectOnVector(t){const o=t.lengthSq();if(o===0)return this.set(0,0,0);const r=t.dot(this)/o;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return _vector$c.copy(this).projectOnVector(t),this.sub(_vector$c)}reflect(t){return this.sub(_vector$c.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const o=Math.sqrt(this.lengthSq()*t.lengthSq());if(o===0)return Math.PI/2;const r=this.dot(t)/o;return Math.acos(clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const o=this.x-t.x,r=this.y-t.y,u=this.z-t.z;return o*o+r*r+u*u}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,o,r){const u=Math.sin(o)*t;return this.x=u*Math.sin(r),this.y=Math.cos(o)*t,this.z=u*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,o,r){return this.x=t*Math.sin(o),this.y=r,this.z=t*Math.cos(o),this}setFromMatrixPosition(t){const o=t.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this}setFromMatrixScale(t){const o=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),u=this.setFromMatrixColumn(t,2).length();return this.x=o,this.y=r,this.z=u,this}setFromMatrixColumn(t,o){return this.fromArray(t.elements,o*4)}setFromMatrix3Column(t,o){return this.fromArray(t.elements,o*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this.z=t[o+2],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this.z=t.getZ(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,o=Math.random()*2-1,r=Math.sqrt(1-o*o);return this.x=r*Math.cos(t),this.y=o,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new Vector3,_quaternion$4=new Quaternion$2;class Box3{constructor(t=new Vector3(1/0,1/0,1/0),o=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=o}set(t,o){return this.min.copy(t),this.max.copy(o),this}setFromArray(t){this.makeEmpty();for(let o=0,r=t.length;o<r;o+=3)this.expandByPoint(_vector$b.fromArray(t,o));return this}setFromBufferAttribute(t){this.makeEmpty();for(let o=0,r=t.count;o<r;o++)this.expandByPoint(_vector$b.fromBufferAttribute(t,o));return this}setFromPoints(t){this.makeEmpty();for(let o=0,r=t.length;o<r;o++)this.expandByPoint(t[o]);return this}setFromCenterAndSize(t,o){const r=_vector$b.copy(o).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,o=!1){return this.makeEmpty(),this.expandByObject(t,o)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,o=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const d=r.getAttribute("position");if(o===!0&&d!==void 0&&t.isInstancedMesh!==!0)for(let C=0,I=d.count;C<I;C++)t.isMesh===!0?t.getVertexPosition(C,_vector$b):_vector$b.fromBufferAttribute(d,C),_vector$b.applyMatrix4(t.matrixWorld),this.expandByPoint(_vector$b);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),_box$4.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),_box$4.copy(r.boundingBox)),_box$4.applyMatrix4(t.matrixWorld),this.union(_box$4)}const u=t.children;for(let d=0,C=u.length;d<C;d++)this.expandByObject(u[d],o);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,o){return o.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,_vector$b),_vector$b.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let o,r;return t.normal.x>0?(o=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(o=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(o+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(o+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(o+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(o+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),o<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(t.a,_center),_v1$7.subVectors(t.b,_center),_v2$4.subVectors(t.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let o=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(o,_v0$2,_v1$7,_v2$4,_extents)||(o=[1,0,0,0,1,0,0,0,1],!satForAxes(o,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),o=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(o,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(t,o){return o.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$b).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(_vector$b).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(n,t,o,r,u){for(let d=0,C=n.length-3;d<=C;d+=3){_testAxis.fromArray(n,d);const I=u.x*Math.abs(_testAxis.x)+u.y*Math.abs(_testAxis.y)+u.z*Math.abs(_testAxis.z),f=t.dot(_testAxis),A=o.dot(_testAxis),G=r.dot(_testAxis);if(Math.max(-Math.max(f,A,G),Math.min(f,A,G))>I)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(t=new Vector3,o=-1){this.isSphere=!0,this.center=t,this.radius=o}set(t,o){return this.center.copy(t),this.radius=o,this}setFromPoints(t,o){const r=this.center;o!==void 0?r.copy(o):_box$3.setFromPoints(t).getCenter(r);let u=0;for(let d=0,C=t.length;d<C;d++)u=Math.max(u,r.distanceToSquared(t[d]));return this.radius=Math.sqrt(u),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const o=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=o*o}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,o){const r=this.center.distanceToSquared(t);return o.copy(t),r>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;_v1$6.subVectors(t,this.center);const o=_v1$6.lengthSq();if(o>this.radius*this.radius){const r=Math.sqrt(o),u=(r-this.radius)*.5;this.center.addScaledVector(_v1$6,u/r),this.radius+=u}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(_v2$3.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(_v1$6.copy(t.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(t.center).sub(_v2$3))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$2=class{constructor(t=new Vector3,o=new Vector3(0,0,-1)){this.origin=t,this.direction=o}set(t,o){return this.origin.copy(t),this.direction.copy(o),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,o){return o.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$a)),this}closestPointToPoint(t,o){o.subVectors(t,this.origin);const r=o.dot(this.direction);return r<0?o.copy(this.origin):o.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const o=_vector$a.subVectors(t,this.origin).dot(this.direction);return o<0?this.origin.distanceToSquared(t):(_vector$a.copy(this.origin).addScaledVector(this.direction,o),_vector$a.distanceToSquared(t))}distanceSqToSegment(t,o,r,u){_segCenter.copy(t).add(o).multiplyScalar(.5),_segDir.copy(o).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const d=t.distanceTo(o)*.5,C=-this.direction.dot(_segDir),I=_diff.dot(this.direction),f=-_diff.dot(_segDir),A=_diff.lengthSq(),G=Math.abs(1-C*C);let B,Z,w,V;if(G>0)if(B=C*f-I,Z=C*I-f,V=d*G,B>=0)if(Z>=-V)if(Z<=V){const Y=1/G;B*=Y,Z*=Y,w=B*(B+C*Z+2*I)+Z*(C*B+Z+2*f)+A}else Z=d,B=Math.max(0,-(C*Z+I)),w=-B*B+Z*(Z+2*f)+A;else Z=-d,B=Math.max(0,-(C*Z+I)),w=-B*B+Z*(Z+2*f)+A;else Z<=-V?(B=Math.max(0,-(-C*d+I)),Z=B>0?-d:Math.min(Math.max(-d,-f),d),w=-B*B+Z*(Z+2*f)+A):Z<=V?(B=0,Z=Math.min(Math.max(-d,-f),d),w=Z*(Z+2*f)+A):(B=Math.max(0,-(C*d+I)),Z=B>0?d:Math.min(Math.max(-d,-f),d),w=-B*B+Z*(Z+2*f)+A);else Z=C>0?-d:d,B=Math.max(0,-(C*Z+I)),w=-B*B+Z*(Z+2*f)+A;return r&&r.copy(this.origin).addScaledVector(this.direction,B),u&&u.copy(_segCenter).addScaledVector(_segDir,Z),w}intersectSphere(t,o){_vector$a.subVectors(t.center,this.origin);const r=_vector$a.dot(this.direction),u=_vector$a.dot(_vector$a)-r*r,d=t.radius*t.radius;if(u>d)return null;const C=Math.sqrt(d-u),I=r-C,f=r+C;return f<0?null:I<0?this.at(f,o):this.at(I,o)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const o=t.normal.dot(this.direction);if(o===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/o;return r>=0?r:null}intersectPlane(t,o){const r=this.distanceToPlane(t);return r===null?null:this.at(r,o)}intersectsPlane(t){const o=t.distanceToPoint(this.origin);return o===0||t.normal.dot(this.direction)*o<0}intersectBox(t,o){let r,u,d,C,I,f;const A=1/this.direction.x,G=1/this.direction.y,B=1/this.direction.z,Z=this.origin;return A>=0?(r=(t.min.x-Z.x)*A,u=(t.max.x-Z.x)*A):(r=(t.max.x-Z.x)*A,u=(t.min.x-Z.x)*A),G>=0?(d=(t.min.y-Z.y)*G,C=(t.max.y-Z.y)*G):(d=(t.max.y-Z.y)*G,C=(t.min.y-Z.y)*G),r>C||d>u||((d>r||isNaN(r))&&(r=d),(C<u||isNaN(u))&&(u=C),B>=0?(I=(t.min.z-Z.z)*B,f=(t.max.z-Z.z)*B):(I=(t.max.z-Z.z)*B,f=(t.min.z-Z.z)*B),r>f||I>u)||((I>r||r!==r)&&(r=I),(f<u||u!==u)&&(u=f),u<0)?null:this.at(r>=0?r:u,o)}intersectsBox(t){return this.intersectBox(t,_vector$a)!==null}intersectTriangle(t,o,r,u,d){_edge1.subVectors(o,t),_edge2.subVectors(r,t),_normal$1.crossVectors(_edge1,_edge2);let C=this.direction.dot(_normal$1),I;if(C>0){if(u)return null;I=1}else if(C<0)I=-1,C=-C;else return null;_diff.subVectors(this.origin,t);const f=I*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(f<0)return null;const A=I*this.direction.dot(_edge1.cross(_diff));if(A<0||f+A>C)return null;const G=-I*_diff.dot(_normal$1);return G<0?null:this.at(G/C,d)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J)}set(t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J){const T=this.elements;return T[0]=t,T[4]=o,T[8]=r,T[12]=u,T[1]=d,T[5]=C,T[9]=I,T[13]=f,T[2]=A,T[6]=G,T[10]=B,T[14]=Z,T[3]=w,T[7]=V,T[11]=Y,T[15]=J,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(t){const o=this.elements,r=t.elements;return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],this}copyPosition(t){const o=this.elements,r=t.elements;return o[12]=r[12],o[13]=r[13],o[14]=r[14],this}setFromMatrix3(t){const o=t.elements;return this.set(o[0],o[3],o[6],0,o[1],o[4],o[7],0,o[2],o[5],o[8],0,0,0,0,1),this}extractBasis(t,o,r){return t.setFromMatrixColumn(this,0),o.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,o,r){return this.set(t.x,o.x,r.x,0,t.y,o.y,r.y,0,t.z,o.z,r.z,0,0,0,0,1),this}extractRotation(t){const o=this.elements,r=t.elements,u=1/_v1$5.setFromMatrixColumn(t,0).length(),d=1/_v1$5.setFromMatrixColumn(t,1).length(),C=1/_v1$5.setFromMatrixColumn(t,2).length();return o[0]=r[0]*u,o[1]=r[1]*u,o[2]=r[2]*u,o[3]=0,o[4]=r[4]*d,o[5]=r[5]*d,o[6]=r[6]*d,o[7]=0,o[8]=r[8]*C,o[9]=r[9]*C,o[10]=r[10]*C,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromEuler(t){const o=this.elements,r=t.x,u=t.y,d=t.z,C=Math.cos(r),I=Math.sin(r),f=Math.cos(u),A=Math.sin(u),G=Math.cos(d),B=Math.sin(d);if(t.order==="XYZ"){const Z=C*G,w=C*B,V=I*G,Y=I*B;o[0]=f*G,o[4]=-f*B,o[8]=A,o[1]=w+V*A,o[5]=Z-Y*A,o[9]=-I*f,o[2]=Y-Z*A,o[6]=V+w*A,o[10]=C*f}else if(t.order==="YXZ"){const Z=f*G,w=f*B,V=A*G,Y=A*B;o[0]=Z+Y*I,o[4]=V*I-w,o[8]=C*A,o[1]=C*B,o[5]=C*G,o[9]=-I,o[2]=w*I-V,o[6]=Y+Z*I,o[10]=C*f}else if(t.order==="ZXY"){const Z=f*G,w=f*B,V=A*G,Y=A*B;o[0]=Z-Y*I,o[4]=-C*B,o[8]=V+w*I,o[1]=w+V*I,o[5]=C*G,o[9]=Y-Z*I,o[2]=-C*A,o[6]=I,o[10]=C*f}else if(t.order==="ZYX"){const Z=C*G,w=C*B,V=I*G,Y=I*B;o[0]=f*G,o[4]=V*A-w,o[8]=Z*A+Y,o[1]=f*B,o[5]=Y*A+Z,o[9]=w*A-V,o[2]=-A,o[6]=I*f,o[10]=C*f}else if(t.order==="YZX"){const Z=C*f,w=C*A,V=I*f,Y=I*A;o[0]=f*G,o[4]=Y-Z*B,o[8]=V*B+w,o[1]=B,o[5]=C*G,o[9]=-I*G,o[2]=-A*G,o[6]=w*B+V,o[10]=Z-Y*B}else if(t.order==="XZY"){const Z=C*f,w=C*A,V=I*f,Y=I*A;o[0]=f*G,o[4]=-B,o[8]=A*G,o[1]=Z*B+Y,o[5]=C*G,o[9]=w*B-V,o[2]=V*B-w,o[6]=I*G,o[10]=Y*B+Z}return o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,o,r){const u=this.elements;return _z.subVectors(t,o),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),_x.lengthSq()===0&&(Math.abs(r.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),u[0]=_x.x,u[4]=_y.x,u[8]=_z.x,u[1]=_x.y,u[5]=_y.y,u[9]=_z.y,u[2]=_x.z,u[6]=_y.z,u[10]=_z.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,o){const r=t.elements,u=o.elements,d=this.elements,C=r[0],I=r[4],f=r[8],A=r[12],G=r[1],B=r[5],Z=r[9],w=r[13],V=r[2],Y=r[6],J=r[10],T=r[14],L=r[3],z=r[7],K=r[11],P=r[15],$=u[0],ie=u[4],ne=u[8],ee=u[12],se=u[1],re=u[5],ce=u[9],ue=u[13],ye=u[2],Se=u[6],Ce=u[10],Ze=u[14],Be=u[3],xe=u[7],ge=u[11],de=u[15];return d[0]=C*$+I*se+f*ye+A*Be,d[4]=C*ie+I*re+f*Se+A*xe,d[8]=C*ne+I*ce+f*Ce+A*ge,d[12]=C*ee+I*ue+f*Ze+A*de,d[1]=G*$+B*se+Z*ye+w*Be,d[5]=G*ie+B*re+Z*Se+w*xe,d[9]=G*ne+B*ce+Z*Ce+w*ge,d[13]=G*ee+B*ue+Z*Ze+w*de,d[2]=V*$+Y*se+J*ye+T*Be,d[6]=V*ie+Y*re+J*Se+T*xe,d[10]=V*ne+Y*ce+J*Ce+T*ge,d[14]=V*ee+Y*ue+J*Ze+T*de,d[3]=L*$+z*se+K*ye+P*Be,d[7]=L*ie+z*re+K*Se+P*xe,d[11]=L*ne+z*ce+K*Ce+P*ge,d[15]=L*ee+z*ue+K*Ze+P*de,this}multiplyScalar(t){const o=this.elements;return o[0]*=t,o[4]*=t,o[8]*=t,o[12]*=t,o[1]*=t,o[5]*=t,o[9]*=t,o[13]*=t,o[2]*=t,o[6]*=t,o[10]*=t,o[14]*=t,o[3]*=t,o[7]*=t,o[11]*=t,o[15]*=t,this}determinant(){const t=this.elements,o=t[0],r=t[4],u=t[8],d=t[12],C=t[1],I=t[5],f=t[9],A=t[13],G=t[2],B=t[6],Z=t[10],w=t[14],V=t[3],Y=t[7],J=t[11],T=t[15];return V*(+d*f*B-u*A*B-d*I*Z+r*A*Z+u*I*w-r*f*w)+Y*(+o*f*w-o*A*Z+d*C*Z-u*C*w+u*A*G-d*f*G)+J*(+o*A*B-o*I*w-d*C*B+r*C*w+d*I*G-r*A*G)+T*(-u*I*G-o*f*B+o*I*Z+u*C*B-r*C*Z+r*f*G)}transpose(){const t=this.elements;let o;return o=t[1],t[1]=t[4],t[4]=o,o=t[2],t[2]=t[8],t[8]=o,o=t[6],t[6]=t[9],t[9]=o,o=t[3],t[3]=t[12],t[12]=o,o=t[7],t[7]=t[13],t[13]=o,o=t[11],t[11]=t[14],t[14]=o,this}setPosition(t,o,r){const u=this.elements;return t.isVector3?(u[12]=t.x,u[13]=t.y,u[14]=t.z):(u[12]=t,u[13]=o,u[14]=r),this}invert(){const t=this.elements,o=t[0],r=t[1],u=t[2],d=t[3],C=t[4],I=t[5],f=t[6],A=t[7],G=t[8],B=t[9],Z=t[10],w=t[11],V=t[12],Y=t[13],J=t[14],T=t[15],L=B*J*A-Y*Z*A+Y*f*w-I*J*w-B*f*T+I*Z*T,z=V*Z*A-G*J*A-V*f*w+C*J*w+G*f*T-C*Z*T,K=G*Y*A-V*B*A+V*I*w-C*Y*w-G*I*T+C*B*T,P=V*B*f-G*Y*f-V*I*Z+C*Y*Z+G*I*J-C*B*J,$=o*L+r*z+u*K+d*P;if($===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ie=1/$;return t[0]=L*ie,t[1]=(Y*Z*d-B*J*d-Y*u*w+r*J*w+B*u*T-r*Z*T)*ie,t[2]=(I*J*d-Y*f*d+Y*u*A-r*J*A-I*u*T+r*f*T)*ie,t[3]=(B*f*d-I*Z*d-B*u*A+r*Z*A+I*u*w-r*f*w)*ie,t[4]=z*ie,t[5]=(G*J*d-V*Z*d+V*u*w-o*J*w-G*u*T+o*Z*T)*ie,t[6]=(V*f*d-C*J*d-V*u*A+o*J*A+C*u*T-o*f*T)*ie,t[7]=(C*Z*d-G*f*d+G*u*A-o*Z*A-C*u*w+o*f*w)*ie,t[8]=K*ie,t[9]=(V*B*d-G*Y*d-V*r*w+o*Y*w+G*r*T-o*B*T)*ie,t[10]=(C*Y*d-V*I*d+V*r*A-o*Y*A-C*r*T+o*I*T)*ie,t[11]=(G*I*d-C*B*d-G*r*A+o*B*A+C*r*w-o*I*w)*ie,t[12]=P*ie,t[13]=(G*Y*u-V*B*u+V*r*Z-o*Y*Z-G*r*J+o*B*J)*ie,t[14]=(V*I*u-C*Y*u-V*r*f+o*Y*f+C*r*J-o*I*J)*ie,t[15]=(C*B*u-G*I*u+G*r*f-o*B*f-C*r*Z+o*I*Z)*ie,this}scale(t){const o=this.elements,r=t.x,u=t.y,d=t.z;return o[0]*=r,o[4]*=u,o[8]*=d,o[1]*=r,o[5]*=u,o[9]*=d,o[2]*=r,o[6]*=u,o[10]*=d,o[3]*=r,o[7]*=u,o[11]*=d,this}getMaxScaleOnAxis(){const t=this.elements,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],u=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(o,r,u))}makeTranslation(t,o,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,o,0,0,1,r,0,0,0,1),this}makeRotationX(t){const o=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,o,-r,0,0,r,o,0,0,0,0,1),this}makeRotationY(t){const o=Math.cos(t),r=Math.sin(t);return this.set(o,0,r,0,0,1,0,0,-r,0,o,0,0,0,0,1),this}makeRotationZ(t){const o=Math.cos(t),r=Math.sin(t);return this.set(o,-r,0,0,r,o,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,o){const r=Math.cos(o),u=Math.sin(o),d=1-r,C=t.x,I=t.y,f=t.z,A=d*C,G=d*I;return this.set(A*C+r,A*I-u*f,A*f+u*I,0,A*I+u*f,G*I+r,G*f-u*C,0,A*f-u*I,G*f+u*C,d*f*f+r,0,0,0,0,1),this}makeScale(t,o,r){return this.set(t,0,0,0,0,o,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,o,r,u,d,C){return this.set(1,r,d,0,t,1,C,0,o,u,1,0,0,0,0,1),this}compose(t,o,r){const u=this.elements,d=o._x,C=o._y,I=o._z,f=o._w,A=d+d,G=C+C,B=I+I,Z=d*A,w=d*G,V=d*B,Y=C*G,J=C*B,T=I*B,L=f*A,z=f*G,K=f*B,P=r.x,$=r.y,ie=r.z;return u[0]=(1-(Y+T))*P,u[1]=(w+K)*P,u[2]=(V-z)*P,u[3]=0,u[4]=(w-K)*$,u[5]=(1-(Z+T))*$,u[6]=(J+L)*$,u[7]=0,u[8]=(V+z)*ie,u[9]=(J-L)*ie,u[10]=(1-(Z+Y))*ie,u[11]=0,u[12]=t.x,u[13]=t.y,u[14]=t.z,u[15]=1,this}decompose(t,o,r){const u=this.elements;let d=_v1$5.set(u[0],u[1],u[2]).length();const C=_v1$5.set(u[4],u[5],u[6]).length(),I=_v1$5.set(u[8],u[9],u[10]).length();this.determinant()<0&&(d=-d),t.x=u[12],t.y=u[13],t.z=u[14],_m1$2.copy(this);const A=1/d,G=1/C,B=1/I;return _m1$2.elements[0]*=A,_m1$2.elements[1]*=A,_m1$2.elements[2]*=A,_m1$2.elements[4]*=G,_m1$2.elements[5]*=G,_m1$2.elements[6]*=G,_m1$2.elements[8]*=B,_m1$2.elements[9]*=B,_m1$2.elements[10]*=B,o.setFromRotationMatrix(_m1$2),r.x=d,r.y=C,r.z=I,this}makePerspective(t,o,r,u,d,C,I=WebGLCoordinateSystem){const f=this.elements,A=2*d/(o-t),G=2*d/(r-u),B=(o+t)/(o-t),Z=(r+u)/(r-u);let w,V;if(I===WebGLCoordinateSystem)w=-(C+d)/(C-d),V=-2*C*d/(C-d);else if(I===WebGPUCoordinateSystem)w=-C/(C-d),V=-C*d/(C-d);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+I);return f[0]=A,f[4]=0,f[8]=B,f[12]=0,f[1]=0,f[5]=G,f[9]=Z,f[13]=0,f[2]=0,f[6]=0,f[10]=w,f[14]=V,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(t,o,r,u,d,C,I=WebGLCoordinateSystem){const f=this.elements,A=1/(o-t),G=1/(r-u),B=1/(C-d),Z=(o+t)*A,w=(r+u)*G;let V,Y;if(I===WebGLCoordinateSystem)V=(C+d)*B,Y=-2*B;else if(I===WebGPUCoordinateSystem)V=d*B,Y=-1*B;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+I);return f[0]=2*A,f[4]=0,f[8]=0,f[12]=-Z,f[1]=0,f[5]=2*G,f[9]=0,f[13]=-w,f[2]=0,f[6]=0,f[10]=Y,f[14]=-V,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(t){const o=this.elements,r=t.elements;for(let u=0;u<16;u++)if(o[u]!==r[u])return!1;return!0}fromArray(t,o=0){for(let r=0;r<16;r++)this.elements[r]=t[r+o];return this}toArray(t=[],o=0){const r=this.elements;return t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3],t[o+4]=r[4],t[o+5]=r[5],t[o+6]=r[6],t[o+7]=r[7],t[o+8]=r[8],t[o+9]=r[9],t[o+10]=r[10],t[o+11]=r[11],t[o+12]=r[12],t[o+13]=r[13],t[o+14]=r[14],t[o+15]=r[15],t}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion$2;class Euler{constructor(t=0,o=0,r=0,u=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=o,this._z=r,this._order=u}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,o,r,u=this._order){return this._x=t,this._y=o,this._z=r,this._order=u,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,o=this._order,r=!0){const u=t.elements,d=u[0],C=u[4],I=u[8],f=u[1],A=u[5],G=u[9],B=u[2],Z=u[6],w=u[10];switch(o){case"XYZ":this._y=Math.asin(clamp(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(-G,w),this._z=Math.atan2(-C,d)):(this._x=Math.atan2(Z,A),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(G,-1,1)),Math.abs(G)<.9999999?(this._y=Math.atan2(I,w),this._z=Math.atan2(f,A)):(this._y=Math.atan2(-B,d),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(Z,-1,1)),Math.abs(Z)<.9999999?(this._y=Math.atan2(-B,w),this._z=Math.atan2(-C,A)):(this._y=0,this._z=Math.atan2(f,d));break;case"ZYX":this._y=Math.asin(-clamp(B,-1,1)),Math.abs(B)<.9999999?(this._x=Math.atan2(Z,w),this._z=Math.atan2(f,d)):(this._x=0,this._z=Math.atan2(-C,A));break;case"YZX":this._z=Math.asin(clamp(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-G,A),this._y=Math.atan2(-B,d)):(this._x=0,this._y=Math.atan2(I,w));break;case"XZY":this._z=Math.asin(-clamp(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(Z,A),this._y=Math.atan2(I,d)):(this._x=Math.atan2(-G,w),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+o)}return this._order=o,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,o,r){return _matrix$2.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix$2,o,r)}setFromVector3(t,o=this._order){return this.set(t.x,t.y,t.z,o)}reorder(t){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],o=0){return t[o]=this._x,t[o+1]=this._y,t[o+2]=this._z,t[o+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$2,_m1$1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$2,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher$1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const t=new Vector3,o=new Euler,r=new Quaternion$2,u=new Vector3(1,1,1);function d(){r.setFromEuler(o,!1)}function C(){o.setFromQuaternion(r,void 0,!1)}o._onChange(d),r._onChange(C),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:o},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:u},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,o){this.quaternion.setFromAxisAngle(t,o)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,o){return _q1.setFromAxisAngle(t,o),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(t,o){return _q1.setFromAxisAngle(t,o),this.quaternion.premultiply(_q1),this}rotateX(t){return this.rotateOnAxis(_xAxis,t)}rotateY(t){return this.rotateOnAxis(_yAxis,t)}rotateZ(t){return this.rotateOnAxis(_zAxis,t)}translateOnAxis(t,o){return _v1$4.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(o)),this}translateX(t){return this.translateOnAxis(_xAxis,t)}translateY(t){return this.translateOnAxis(_yAxis,t)}translateZ(t){return this.translateOnAxis(_zAxis,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(_m1$1$1.copy(this.matrixWorld).invert())}lookAt(t,o,r){t.isVector3?_target.copy(t):_target.set(t,o,r);const u=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1$1.lookAt(_position$3,_target,this.up):_m1$1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1$1),u&&(_m1$1$1.extractRotation(u.matrixWorld),_q1.setFromRotationMatrix(_m1$1$1),this.quaternion.premultiply(_q1.invert()))}add(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.add(arguments[o]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const o=this.children.indexOf(t);return o!==-1&&(t.parent=null,this.children.splice(o,1),t.dispatchEvent(_removedEvent),_childremovedEvent.child=t,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),_m1$1$1.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),_m1$1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1$1),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,o){if(this[t]===o)return this;for(let r=0,u=this.children.length;r<u;r++){const C=this.children[r].getObjectByProperty(t,o);if(C!==void 0)return C}}getObjectsByProperty(t,o,r=[]){this[t]===o&&r.push(this);const u=this.children;for(let d=0,C=u.length;d<C;d++)u[d].getObjectsByProperty(t,o,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,t,_scale$2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const o=this.matrixWorld.elements;return t.set(o[8],o[9],o[10]).normalize()}raycast(){}traverse(t){t(this);const o=this.children;for(let r=0,u=o.length;r<u;r++)o[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const o=this.children;for(let r=0,u=o.length;r<u;r++)o[r].traverseVisible(t)}traverseAncestors(t){const o=this.parent;o!==null&&(t(o),o.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const o=this.children;for(let r=0,u=o.length;r<u;r++)o[r].updateMatrixWorld(t)}updateWorldMatrix(t,o){const r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),o===!0){const u=this.children;for(let d=0,C=u.length;d<C;d++)u[d].updateWorldMatrix(!1,!0)}}toJSON(t){const o=t===void 0||typeof t=="string",r={};o&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const u={};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.castShadow===!0&&(u.castShadow=!0),this.receiveShadow===!0&&(u.receiveShadow=!0),this.visible===!1&&(u.visible=!1),this.frustumCulled===!1&&(u.frustumCulled=!1),this.renderOrder!==0&&(u.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(u.userData=this.userData),u.layers=this.layers.mask,u.matrix=this.matrix.toArray(),u.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(u.matrixAutoUpdate=!1),this.isInstancedMesh&&(u.type="InstancedMesh",u.count=this.count,u.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(u.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(u.type="BatchedMesh",u.perObjectFrustumCulled=this.perObjectFrustumCulled,u.sortObjects=this.sortObjects,u.drawRanges=this._drawRanges,u.reservedRanges=this._reservedRanges,u.visibility=this._visibility,u.active=this._active,u.bounds=this._bounds.map(I=>({boxInitialized:I.boxInitialized,boxMin:I.box.min.toArray(),boxMax:I.box.max.toArray(),sphereInitialized:I.sphereInitialized,sphereRadius:I.sphere.radius,sphereCenter:I.sphere.center.toArray()})),u.maxInstanceCount=this._maxInstanceCount,u.maxVertexCount=this._maxVertexCount,u.maxIndexCount=this._maxIndexCount,u.geometryInitialized=this._geometryInitialized,u.geometryCount=this._geometryCount,u.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(u.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(u.boundingSphere={center:u.boundingSphere.center.toArray(),radius:u.boundingSphere.radius}),this.boundingBox!==null&&(u.boundingBox={min:u.boundingBox.min.toArray(),max:u.boundingBox.max.toArray()}));function d(I,f){return I[f.uuid]===void 0&&(I[f.uuid]=f.toJSON(t)),f.uuid}if(this.isScene)this.background&&(this.background.isColor?u.background=this.background.toJSON():this.background.isTexture&&(u.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(u.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){u.geometry=d(t.geometries,this.geometry);const I=this.geometry.parameters;if(I!==void 0&&I.shapes!==void 0){const f=I.shapes;if(Array.isArray(f))for(let A=0,G=f.length;A<G;A++){const B=f[A];d(t.shapes,B)}else d(t.shapes,f)}}if(this.isSkinnedMesh&&(u.bindMode=this.bindMode,u.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(d(t.skeletons,this.skeleton),u.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const I=[];for(let f=0,A=this.material.length;f<A;f++)I.push(d(t.materials,this.material[f]));u.material=I}else u.material=d(t.materials,this.material);if(this.children.length>0){u.children=[];for(let I=0;I<this.children.length;I++)u.children.push(this.children[I].toJSON(t).object)}if(this.animations.length>0){u.animations=[];for(let I=0;I<this.animations.length;I++){const f=this.animations[I];u.animations.push(d(t.animations,f))}}if(o){const I=C(t.geometries),f=C(t.materials),A=C(t.textures),G=C(t.images),B=C(t.shapes),Z=C(t.skeletons),w=C(t.animations),V=C(t.nodes);I.length>0&&(r.geometries=I),f.length>0&&(r.materials=f),A.length>0&&(r.textures=A),G.length>0&&(r.images=G),B.length>0&&(r.shapes=B),Z.length>0&&(r.skeletons=Z),w.length>0&&(r.animations=w),V.length>0&&(r.nodes=V)}return r.object=u,r;function C(I){const f=[];for(const A in I){const G=I[A];delete G.metadata,f.push(G)}return f}}clone(t){return new this.constructor().copy(this,t)}copy(t,o=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),o===!0)for(let r=0;r<t.children.length;r++){const u=t.children[r];this.add(u.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$2=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;class Triangle{constructor(t=new Vector3,o=new Vector3,r=new Vector3){this.a=t,this.b=o,this.c=r}static getNormal(t,o,r,u){u.subVectors(r,o),_v0$1.subVectors(t,o),u.cross(_v0$1);const d=u.lengthSq();return d>0?u.multiplyScalar(1/Math.sqrt(d)):u.set(0,0,0)}static getBarycoord(t,o,r,u,d){_v0$1.subVectors(u,o),_v1$3.subVectors(r,o),_v2$2.subVectors(t,o);const C=_v0$1.dot(_v0$1),I=_v0$1.dot(_v1$3),f=_v0$1.dot(_v2$2),A=_v1$3.dot(_v1$3),G=_v1$3.dot(_v2$2),B=C*A-I*I;if(B===0)return d.set(0,0,0),null;const Z=1/B,w=(A*f-I*G)*Z,V=(C*G-I*f)*Z;return d.set(1-w-V,V,w)}static containsPoint(t,o,r,u){return this.getBarycoord(t,o,r,u,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(t,o,r,u,d,C,I,f){return this.getBarycoord(t,o,r,u,_v3$2)===null?(f.x=0,f.y=0,"z"in f&&(f.z=0),"w"in f&&(f.w=0),null):(f.setScalar(0),f.addScaledVector(d,_v3$2.x),f.addScaledVector(C,_v3$2.y),f.addScaledVector(I,_v3$2.z),f)}static getInterpolatedAttribute(t,o,r,u,d,C){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(t,o),_v41.fromBufferAttribute(t,r),_v42.fromBufferAttribute(t,u),C.setScalar(0),C.addScaledVector(_v40,d.x),C.addScaledVector(_v41,d.y),C.addScaledVector(_v42,d.z),C}static isFrontFacing(t,o,r,u){return _v0$1.subVectors(r,o),_v1$3.subVectors(t,o),_v0$1.cross(_v1$3).dot(u)<0}set(t,o,r){return this.a.copy(t),this.b.copy(o),this.c.copy(r),this}setFromPointsAndIndices(t,o,r,u){return this.a.copy(t[o]),this.b.copy(t[r]),this.c.copy(t[u]),this}setFromAttributeAndIndices(t,o,r,u){return this.a.fromBufferAttribute(t,o),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,u),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,o){return Triangle.getBarycoord(t,this.a,this.b,this.c,o)}getInterpolation(t,o,r,u,d){return Triangle.getInterpolation(t,this.a,this.b,this.c,o,r,u,d)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,o){const r=this.a,u=this.b,d=this.c;let C,I;_vab.subVectors(u,r),_vac.subVectors(d,r),_vap.subVectors(t,r);const f=_vab.dot(_vap),A=_vac.dot(_vap);if(f<=0&&A<=0)return o.copy(r);_vbp.subVectors(t,u);const G=_vab.dot(_vbp),B=_vac.dot(_vbp);if(G>=0&&B<=G)return o.copy(u);const Z=f*B-G*A;if(Z<=0&&f>=0&&G<=0)return C=f/(f-G),o.copy(r).addScaledVector(_vab,C);_vcp.subVectors(t,d);const w=_vab.dot(_vcp),V=_vac.dot(_vcp);if(V>=0&&w<=V)return o.copy(d);const Y=w*A-f*V;if(Y<=0&&A>=0&&V<=0)return I=A/(A-V),o.copy(r).addScaledVector(_vac,I);const J=G*V-w*B;if(J<=0&&B-G>=0&&w-V>=0)return _vbc.subVectors(d,u),I=(B-G)/(B-G+(w-V)),o.copy(u).addScaledVector(_vbc,I);const T=1/(J+Y+Z);return C=Y*T,I=Z*T,o.copy(r).addScaledVector(_vab,C).addScaledVector(_vac,I)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(n,t,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?n+(t-n)*6*o:o<1/2?t:o<2/3?n+(t-n)*6*(2/3-o):n}class Color{constructor(t,o,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,o,r)}set(t,o,r){if(o===void 0&&r===void 0){const u=t;u&&u.isColor?this.copy(u):typeof u=="number"?this.setHex(u):typeof u=="string"&&this.setStyle(u)}else this.setRGB(t,o,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,o=SRGBColorSpace){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ColorManagement.toWorkingColorSpace(this,o),this}setRGB(t,o,r,u=ColorManagement.workingColorSpace){return this.r=t,this.g=o,this.b=r,ColorManagement.toWorkingColorSpace(this,u),this}setHSL(t,o,r,u=ColorManagement.workingColorSpace){if(t=euclideanModulo(t,1),o=clamp(o,0,1),r=clamp(r,0,1),o===0)this.r=this.g=this.b=r;else{const d=r<=.5?r*(1+o):r+o-r*o,C=2*r-d;this.r=hue2rgb(C,d,t+1/3),this.g=hue2rgb(C,d,t),this.b=hue2rgb(C,d,t-1/3)}return ColorManagement.toWorkingColorSpace(this,u),this}setStyle(t,o=SRGBColorSpace){function r(d){d!==void 0&&parseFloat(d)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let u;if(u=/^(\w+)\(([^\)]*)\)/.exec(t)){let d;const C=u[1],I=u[2];switch(C){case"rgb":case"rgba":if(d=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return r(d[4]),this.setRGB(Math.min(255,parseInt(d[1],10))/255,Math.min(255,parseInt(d[2],10))/255,Math.min(255,parseInt(d[3],10))/255,o);if(d=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return r(d[4]),this.setRGB(Math.min(100,parseInt(d[1],10))/100,Math.min(100,parseInt(d[2],10))/100,Math.min(100,parseInt(d[3],10))/100,o);break;case"hsl":case"hsla":if(d=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return r(d[4]),this.setHSL(parseFloat(d[1])/360,parseFloat(d[2])/100,parseFloat(d[3])/100,o);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(u=/^\#([A-Fa-f\d]+)$/.exec(t)){const d=u[1],C=d.length;if(C===3)return this.setRGB(parseInt(d.charAt(0),16)/15,parseInt(d.charAt(1),16)/15,parseInt(d.charAt(2),16)/15,o);if(C===6)return this.setHex(parseInt(d,16),o);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,o);return this}setColorName(t,o=SRGBColorSpace){const r=_colorKeywords[t.toLowerCase()];return r!==void 0?this.setHex(r,o):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(t=SRGBColorSpace){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,o=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),o);const r=_color.r,u=_color.g,d=_color.b,C=Math.max(r,u,d),I=Math.min(r,u,d);let f,A;const G=(I+C)/2;if(I===C)f=0,A=0;else{const B=C-I;switch(A=G<=.5?B/(C+I):B/(2-C-I),C){case r:f=(u-d)/B+(u<d?6:0);break;case u:f=(d-r)/B+2;break;case d:f=(r-u)/B+4;break}f/=6}return t.h=f,t.s=A,t.l=G,t}getRGB(t,o=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),o),t.r=_color.r,t.g=_color.g,t.b=_color.b,t}getStyle(t=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const o=_color.r,r=_color.g,u=_color.b;return t!==SRGBColorSpace?`color(${t} ${o.toFixed(3)} ${r.toFixed(3)} ${u.toFixed(3)})`:`rgb(${Math.round(o*255)},${Math.round(r*255)},${Math.round(u*255)})`}offsetHSL(t,o,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+t,_hslA.s+o,_hslA.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,o){return this.r=t.r+o.r,this.g=t.g+o.g,this.b=t.b+o.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,o){return this.r+=(t.r-this.r)*o,this.g+=(t.g-this.g)*o,this.b+=(t.b-this.b)*o,this}lerpColors(t,o,r){return this.r=t.r+(o.r-t.r)*r,this.g=t.g+(o.g-t.g)*r,this.b=t.b+(o.b-t.b)*r,this}lerpHSL(t,o){this.getHSL(_hslA),t.getHSL(_hslB);const r=lerp(_hslA.h,_hslB.h,o),u=lerp(_hslA.s,_hslB.s,o),d=lerp(_hslA.l,_hslB.l,o);return this.setHSL(r,u,d),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const o=this.r,r=this.g,u=this.b,d=t.elements;return this.r=d[0]*o+d[3]*r+d[6]*u,this.g=d[1]*o+d[4]*r+d[7]*u,this.b=d[2]*o+d[5]*r+d[8]*u,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,o=0){return this.r=t[o],this.g=t[o+1],this.b=t[o+2],this}toArray(t=[],o=0){return t[o]=this.r,t[o+1]=this.g,t[o+2]=this.b,t}fromBufferAttribute(t,o){return this.r=t.getX(o),this.g=t.getY(o),this.b=t.getZ(o),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher$1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const o in t){const r=t[o];if(r===void 0){console.warn(`THREE.Material: parameter '${o}' has value of undefined.`);continue}const u=this[o];if(u===void 0){console.warn(`THREE.Material: '${o}' is not a property of THREE.${this.type}.`);continue}u&&u.isColor?u.set(r):u&&u.isVector3&&r&&r.isVector3?u.copy(r):this[o]=r}}toJSON(t){const o=t===void 0||typeof t=="string";o&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(r.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(r.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function u(d){const C=[];for(const I in d){const f=d[I];delete f.metadata,C.push(f)}return C}if(o){const d=u(t.textures),C=u(t.images);d.length>0&&(r.textures=d),C.length>0&&(r.images=C)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const o=t.clippingPlanes;let r=null;if(o!==null){const u=o.length;r=new Array(u);for(let d=0;d!==u;++d)r[d]=o[d].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _tables=_generateTables();function _generateTables(){const n=new ArrayBuffer(4),t=new Float32Array(n),o=new Uint32Array(n),r=new Uint32Array(512),u=new Uint32Array(512);for(let f=0;f<256;++f){const A=f-127;A<-27?(r[f]=0,r[f|256]=32768,u[f]=24,u[f|256]=24):A<-14?(r[f]=1024>>-A-14,r[f|256]=1024>>-A-14|32768,u[f]=-A-1,u[f|256]=-A-1):A<=15?(r[f]=A+15<<10,r[f|256]=A+15<<10|32768,u[f]=13,u[f|256]=13):A<128?(r[f]=31744,r[f|256]=64512,u[f]=24,u[f|256]=24):(r[f]=31744,r[f|256]=64512,u[f]=13,u[f|256]=13)}const d=new Uint32Array(2048),C=new Uint32Array(64),I=new Uint32Array(64);for(let f=1;f<1024;++f){let A=f<<13,G=0;for(;(A&8388608)===0;)A<<=1,G-=8388608;A&=-8388609,G+=947912704,d[f]=A|G}for(let f=1024;f<2048;++f)d[f]=939524096+(f-1024<<13);for(let f=1;f<31;++f)C[f]=f<<23;C[31]=1199570944,C[32]=2147483648;for(let f=33;f<63;++f)C[f]=2147483648+(f-32<<23);C[63]=3347054592;for(let f=1;f<64;++f)f!==32&&(I[f]=1024);return{floatView:t,uint32View:o,baseTable:r,shiftTable:u,mantissaTable:d,exponentTable:C,offsetTable:I}}function toHalfFloat(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=clamp(n,-65504,65504),_tables.floatView[0]=n;const t=_tables.uint32View[0],o=t>>23&511;return _tables.baseTable[o]+((t&8388607)>>_tables.shiftTable[o])}function fromHalfFloat(n){const t=n>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[t]+(n&1023)]+_tables.exponentTable[t],_tables.floatView[0]}class DataUtils{static toHalfFloat(t){return toHalfFloat(t)}static fromHalfFloat(t){return fromHalfFloat(t)}}const _vector$9=new Vector3,_vector2$1=new Vector2;let _id$2=0;class BufferAttribute{constructor(t,o,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=t,this.itemSize=o,this.count=t!==void 0?t.length/o:0,this.normalized=r,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,o){this.updateRanges.push({start:t,count:o})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,o,r){t*=this.itemSize,r*=o.itemSize;for(let u=0,d=this.itemSize;u<d;u++)this.array[t+u]=o.array[r+u];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let o=0,r=this.count;o<r;o++)_vector2$1.fromBufferAttribute(this,o),_vector2$1.applyMatrix3(t),this.setXY(o,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let o=0,r=this.count;o<r;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyMatrix3(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(t){for(let o=0,r=this.count;o<r;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyMatrix4(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(t){for(let o=0,r=this.count;o<r;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyNormalMatrix(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(t){for(let o=0,r=this.count;o<r;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.transformDirection(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(t,o=0){return this.array.set(t,o),this}getComponent(t,o){let r=this.array[t*this.itemSize+o];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(t,o,r){return this.normalized&&(r=normalize(r,this.array)),this.array[t*this.itemSize+o]=r,this}getX(t){let o=this.array[t*this.itemSize];return this.normalized&&(o=denormalize(o,this.array)),o}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize]=o,this}getY(t){let o=this.array[t*this.itemSize+1];return this.normalized&&(o=denormalize(o,this.array)),o}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+1]=o,this}getZ(t){let o=this.array[t*this.itemSize+2];return this.normalized&&(o=denormalize(o,this.array)),o}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+2]=o,this}getW(t){let o=this.array[t*this.itemSize+3];return this.normalized&&(o=denormalize(o,this.array)),o}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+3]=o,this}setXY(t,o,r){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array)),this.array[t+0]=o,this.array[t+1]=r,this}setXYZ(t,o,r,u){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array)),this.array[t+0]=o,this.array[t+1]=r,this.array[t+2]=u,this}setXYZW(t,o,r,u,d){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.array[t+0]=o,this.array[t+1]=r,this.array[t+2]=u,this.array[t+3]=d,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==StaticDrawUsage&&(t.usage=this.usage),t}}class Int8BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Int8Array(t),o,r)}}class Uint8BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Uint8Array(t),o,r)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Uint8ClampedArray(t),o,r)}}class Int16BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Int16Array(t),o,r)}}class Uint16BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Uint16Array(t),o,r)}}class Int32BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Int32Array(t),o,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Uint32Array(t),o,r)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Uint16Array(t),o,r),this.isFloat16BufferAttribute=!0}getX(t){let o=fromHalfFloat(this.array[t*this.itemSize]);return this.normalized&&(o=denormalize(o,this.array)),o}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize]=toHalfFloat(o),this}getY(t){let o=fromHalfFloat(this.array[t*this.itemSize+1]);return this.normalized&&(o=denormalize(o,this.array)),o}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+1]=toHalfFloat(o),this}getZ(t){let o=fromHalfFloat(this.array[t*this.itemSize+2]);return this.normalized&&(o=denormalize(o,this.array)),o}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+2]=toHalfFloat(o),this}getW(t){let o=fromHalfFloat(this.array[t*this.itemSize+3]);return this.normalized&&(o=denormalize(o,this.array)),o}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+3]=toHalfFloat(o),this}setXY(t,o,r){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(r),this}setXYZ(t,o,r,u){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(r),this.array[t+2]=toHalfFloat(u),this}setXYZW(t,o,r,u,d){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(r),this.array[t+2]=toHalfFloat(u),this.array[t+3]=toHalfFloat(d),this}}class Float32BufferAttribute extends BufferAttribute{constructor(t,o,r){super(new Float32Array(t),o,r)}}let _id$1=0;const _m1$3=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher$1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayNeedsUint32(t)?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,o){return this.attributes[t]=o,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,o,r=0){this.groups.push({start:t,count:o,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,o){this.drawRange.start=t,this.drawRange.count=o}applyMatrix4(t){const o=this.attributes.position;o!==void 0&&(o.applyMatrix4(t),o.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const d=new Matrix3().getNormalMatrix(t);r.applyNormalMatrix(d),r.needsUpdate=!0}const u=this.attributes.tangent;return u!==void 0&&(u.transformDirection(t),u.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return _m1$3.makeRotationFromQuaternion(t),this.applyMatrix4(_m1$3),this}rotateX(t){return _m1$3.makeRotationX(t),this.applyMatrix4(_m1$3),this}rotateY(t){return _m1$3.makeRotationY(t),this.applyMatrix4(_m1$3),this}rotateZ(t){return _m1$3.makeRotationZ(t),this.applyMatrix4(_m1$3),this}translate(t,o,r){return _m1$3.makeTranslation(t,o,r),this.applyMatrix4(_m1$3),this}scale(t,o,r){return _m1$3.makeScale(t,o,r),this.applyMatrix4(_m1$3),this}lookAt(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(t){const o=this.getAttribute("position");if(o===void 0){const r=[];for(let u=0,d=t.length;u<d;u++){const C=t[u];r.push(C.x,C.y,C.z||0)}this.setAttribute("position",new Float32BufferAttribute(r,3))}else{const r=Math.min(t.length,o.count);for(let u=0;u<r;u++){const d=t[u];o.setXYZ(u,d.x,d.y,d.z||0)}t.length>o.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),o.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const t=this.attributes.position,o=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),o)for(let r=0,u=o.length;r<u;r++){const d=o[r];_box$2.setFromBufferAttribute(d),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const t=this.attributes.position,o=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(t){const r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(t),o)for(let d=0,C=o.length;d<C;d++){const I=o[d];_boxMorphTargets.setFromBufferAttribute(I),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(r);let u=0;for(let d=0,C=t.count;d<C;d++)_vector$8.fromBufferAttribute(t,d),u=Math.max(u,r.distanceToSquared(_vector$8));if(o)for(let d=0,C=o.length;d<C;d++){const I=o[d],f=this.morphTargetsRelative;for(let A=0,G=I.count;A<G;A++)_vector$8.fromBufferAttribute(I,A),f&&(_offset.fromBufferAttribute(t,A),_vector$8.add(_offset)),u=Math.max(u,r.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,o=this.attributes;if(t===null||o.position===void 0||o.normal===void 0||o.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=o.position,u=o.normal,d=o.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*r.count),4));const C=this.getAttribute("tangent"),I=[],f=[];for(let ne=0;ne<r.count;ne++)I[ne]=new Vector3,f[ne]=new Vector3;const A=new Vector3,G=new Vector3,B=new Vector3,Z=new Vector2,w=new Vector2,V=new Vector2,Y=new Vector3,J=new Vector3;function T(ne,ee,se){A.fromBufferAttribute(r,ne),G.fromBufferAttribute(r,ee),B.fromBufferAttribute(r,se),Z.fromBufferAttribute(d,ne),w.fromBufferAttribute(d,ee),V.fromBufferAttribute(d,se),G.sub(A),B.sub(A),w.sub(Z),V.sub(Z);const re=1/(w.x*V.y-V.x*w.y);isFinite(re)&&(Y.copy(G).multiplyScalar(V.y).addScaledVector(B,-w.y).multiplyScalar(re),J.copy(B).multiplyScalar(w.x).addScaledVector(G,-V.x).multiplyScalar(re),I[ne].add(Y),I[ee].add(Y),I[se].add(Y),f[ne].add(J),f[ee].add(J),f[se].add(J))}let L=this.groups;L.length===0&&(L=[{start:0,count:t.count}]);for(let ne=0,ee=L.length;ne<ee;++ne){const se=L[ne],re=se.start,ce=se.count;for(let ue=re,ye=re+ce;ue<ye;ue+=3)T(t.getX(ue+0),t.getX(ue+1),t.getX(ue+2))}const z=new Vector3,K=new Vector3,P=new Vector3,$=new Vector3;function ie(ne){P.fromBufferAttribute(u,ne),$.copy(P);const ee=I[ne];z.copy(ee),z.sub(P.multiplyScalar(P.dot(ee))).normalize(),K.crossVectors($,ee);const re=K.dot(f[ne])<0?-1:1;C.setXYZW(ne,z.x,z.y,z.z,re)}for(let ne=0,ee=L.length;ne<ee;++ne){const se=L[ne],re=se.start,ce=se.count;for(let ue=re,ye=re+ce;ue<ye;ue+=3)ie(t.getX(ue+0)),ie(t.getX(ue+1)),ie(t.getX(ue+2))}}computeVertexNormals(){const t=this.index,o=this.getAttribute("position");if(o!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new BufferAttribute(new Float32Array(o.count*3),3),this.setAttribute("normal",r);else for(let Z=0,w=r.count;Z<w;Z++)r.setXYZ(Z,0,0,0);const u=new Vector3,d=new Vector3,C=new Vector3,I=new Vector3,f=new Vector3,A=new Vector3,G=new Vector3,B=new Vector3;if(t)for(let Z=0,w=t.count;Z<w;Z+=3){const V=t.getX(Z+0),Y=t.getX(Z+1),J=t.getX(Z+2);u.fromBufferAttribute(o,V),d.fromBufferAttribute(o,Y),C.fromBufferAttribute(o,J),G.subVectors(C,d),B.subVectors(u,d),G.cross(B),I.fromBufferAttribute(r,V),f.fromBufferAttribute(r,Y),A.fromBufferAttribute(r,J),I.add(G),f.add(G),A.add(G),r.setXYZ(V,I.x,I.y,I.z),r.setXYZ(Y,f.x,f.y,f.z),r.setXYZ(J,A.x,A.y,A.z)}else for(let Z=0,w=o.count;Z<w;Z+=3)u.fromBufferAttribute(o,Z+0),d.fromBufferAttribute(o,Z+1),C.fromBufferAttribute(o,Z+2),G.subVectors(C,d),B.subVectors(u,d),G.cross(B),r.setXYZ(Z+0,G.x,G.y,G.z),r.setXYZ(Z+1,G.x,G.y,G.z),r.setXYZ(Z+2,G.x,G.y,G.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let o=0,r=t.count;o<r;o++)_vector$8.fromBufferAttribute(t,o),_vector$8.normalize(),t.setXYZ(o,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function t(I,f){const A=I.array,G=I.itemSize,B=I.normalized,Z=new A.constructor(f.length*G);let w=0,V=0;for(let Y=0,J=f.length;Y<J;Y++){I.isInterleavedBufferAttribute?w=f[Y]*I.data.stride+I.offset:w=f[Y]*G;for(let T=0;T<G;T++)Z[V++]=A[w++]}return new BufferAttribute(Z,G,B)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const o=new BufferGeometry,r=this.index.array,u=this.attributes;for(const I in u){const f=u[I],A=t(f,r);o.setAttribute(I,A)}const d=this.morphAttributes;for(const I in d){const f=[],A=d[I];for(let G=0,B=A.length;G<B;G++){const Z=A[G],w=t(Z,r);f.push(w)}o.morphAttributes[I]=f}o.morphTargetsRelative=this.morphTargetsRelative;const C=this.groups;for(let I=0,f=C.length;I<f;I++){const A=C[I];o.addGroup(A.start,A.count,A.materialIndex)}return o}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const f=this.parameters;for(const A in f)f[A]!==void 0&&(t[A]=f[A]);return t}t.data={attributes:{}};const o=this.index;o!==null&&(t.data.index={type:o.array.constructor.name,array:Array.prototype.slice.call(o.array)});const r=this.attributes;for(const f in r){const A=r[f];t.data.attributes[f]=A.toJSON(t.data)}const u={};let d=!1;for(const f in this.morphAttributes){const A=this.morphAttributes[f],G=[];for(let B=0,Z=A.length;B<Z;B++){const w=A[B];G.push(w.toJSON(t.data))}G.length>0&&(u[f]=G,d=!0)}d&&(t.data.morphAttributes=u,t.data.morphTargetsRelative=this.morphTargetsRelative);const C=this.groups;C.length>0&&(t.data.groups=JSON.parse(JSON.stringify(C)));const I=this.boundingSphere;return I!==null&&(t.data.boundingSphere={center:I.center.toArray(),radius:I.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const o={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(o));const u=t.attributes;for(const A in u){const G=u[A];this.setAttribute(A,G.clone(o))}const d=t.morphAttributes;for(const A in d){const G=[],B=d[A];for(let Z=0,w=B.length;Z<w;Z++)G.push(B[Z].clone(o));this.morphAttributes[A]=G}this.morphTargetsRelative=t.morphTargetsRelative;const C=t.groups;for(let A=0,G=C.length;A<G;A++){const B=C[A];this.addGroup(B.start,B.count,B.materialIndex)}const I=t.boundingBox;I!==null&&(this.boundingBox=I.clone());const f=t.boundingSphere;return f!==null&&(this.boundingSphere=f.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$2,_sphere$6=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,o=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,r=Object.keys(o);if(r.length>0){const u=o[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,C=u.length;d<C;d++){const I=u[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=d}}}}getVertexPosition(t,o){const r=this.geometry,u=r.attributes.position,d=r.morphAttributes.position,C=r.morphTargetsRelative;o.fromBufferAttribute(u,t);const I=this.morphTargetInfluences;if(d&&I){_morphA.set(0,0,0);for(let f=0,A=d.length;f<A;f++){const G=I[f],B=d[f];G!==0&&(_tempA.fromBufferAttribute(B,t),C?_morphA.addScaledVector(_tempA,G):_morphA.addScaledVector(_tempA.sub(o),G))}o.add(_morphA)}return o}raycast(t,o){const r=this.geometry,u=this.material,d=this.matrixWorld;u!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$6.copy(r.boundingSphere),_sphere$6.applyMatrix4(d),_ray$3.copy(t.ray).recast(t.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(t.far-t.near)**2))&&(_inverseMatrix$3.copy(d).invert(),_ray$3.copy(t.ray).applyMatrix4(_inverseMatrix$3),!(r.boundingBox!==null&&_ray$3.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,o,_ray$3)))}_computeIntersections(t,o,r){let u;const d=this.geometry,C=this.material,I=d.index,f=d.attributes.position,A=d.attributes.uv,G=d.attributes.uv1,B=d.attributes.normal,Z=d.groups,w=d.drawRange;if(I!==null)if(Array.isArray(C))for(let V=0,Y=Z.length;V<Y;V++){const J=Z[V],T=C[J.materialIndex],L=Math.max(J.start,w.start),z=Math.min(I.count,Math.min(J.start+J.count,w.start+w.count));for(let K=L,P=z;K<P;K+=3){const $=I.getX(K),ie=I.getX(K+1),ne=I.getX(K+2);u=checkGeometryIntersection(this,T,t,r,A,G,B,$,ie,ne),u&&(u.faceIndex=Math.floor(K/3),u.face.materialIndex=J.materialIndex,o.push(u))}}else{const V=Math.max(0,w.start),Y=Math.min(I.count,w.start+w.count);for(let J=V,T=Y;J<T;J+=3){const L=I.getX(J),z=I.getX(J+1),K=I.getX(J+2);u=checkGeometryIntersection(this,C,t,r,A,G,B,L,z,K),u&&(u.faceIndex=Math.floor(J/3),o.push(u))}}else if(f!==void 0)if(Array.isArray(C))for(let V=0,Y=Z.length;V<Y;V++){const J=Z[V],T=C[J.materialIndex],L=Math.max(J.start,w.start),z=Math.min(f.count,Math.min(J.start+J.count,w.start+w.count));for(let K=L,P=z;K<P;K+=3){const $=K,ie=K+1,ne=K+2;u=checkGeometryIntersection(this,T,t,r,A,G,B,$,ie,ne),u&&(u.faceIndex=Math.floor(K/3),u.face.materialIndex=J.materialIndex,o.push(u))}}else{const V=Math.max(0,w.start),Y=Math.min(f.count,w.start+w.count);for(let J=V,T=Y;J<T;J+=3){const L=J,z=J+1,K=J+2;u=checkGeometryIntersection(this,C,t,r,A,G,B,L,z,K),u&&(u.faceIndex=Math.floor(J/3),o.push(u))}}}}function checkIntersection$1(n,t,o,r,u,d,C,I){let f;if(t.side===BackSide?f=r.intersectTriangle(C,d,u,!0,I):f=r.intersectTriangle(u,d,C,t.side===FrontSide,I),f===null)return null;_intersectionPointWorld.copy(I),_intersectionPointWorld.applyMatrix4(n.matrixWorld);const A=o.ray.origin.distanceTo(_intersectionPointWorld);return A<o.near||A>o.far?null:{distance:A,point:_intersectionPointWorld.clone(),object:n}}function checkGeometryIntersection(n,t,o,r,u,d,C,I,f,A){n.getVertexPosition(I,_vA$1),n.getVertexPosition(f,_vB$1),n.getVertexPosition(A,_vC$1);const G=checkIntersection$1(n,t,o,r,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(G){const B=new Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,B),u&&(G.uv=Triangle.getInterpolatedAttribute(u,I,f,A,B,new Vector2)),d&&(G.uv1=Triangle.getInterpolatedAttribute(d,I,f,A,B,new Vector2)),C&&(G.normal=Triangle.getInterpolatedAttribute(C,I,f,A,B,new Vector3),G.normal.dot(r.direction)>0&&G.normal.multiplyScalar(-1));const Z={a:I,b:f,c:A,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,Z.normal),G.face=Z,G.barycoord=B}return G}class BoxGeometry extends BufferGeometry{constructor(t=1,o=1,r=1,u=1,d=1,C=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:o,depth:r,widthSegments:u,heightSegments:d,depthSegments:C};const I=this;u=Math.floor(u),d=Math.floor(d),C=Math.floor(C);const f=[],A=[],G=[],B=[];let Z=0,w=0;V("z","y","x",-1,-1,r,o,t,C,d,0),V("z","y","x",1,-1,r,o,-t,C,d,1),V("x","z","y",1,1,t,r,o,u,C,2),V("x","z","y",1,-1,t,r,-o,u,C,3),V("x","y","z",1,-1,t,o,r,u,d,4),V("x","y","z",-1,-1,t,o,-r,u,d,5),this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(G,3)),this.setAttribute("uv",new Float32BufferAttribute(B,2));function V(Y,J,T,L,z,K,P,$,ie,ne,ee){const se=K/ie,re=P/ne,ce=K/2,ue=P/2,ye=$/2,Se=ie+1,Ce=ne+1;let Ze=0,Be=0;const xe=new Vector3;for(let ge=0;ge<Ce;ge++){const de=ge*re-ue;for(let ve=0;ve<Se;ve++){const le=ve*se-ce;xe[Y]=le*L,xe[J]=de*z,xe[T]=ye,A.push(xe.x,xe.y,xe.z),xe[Y]=0,xe[J]=0,xe[T]=$>0?1:-1,G.push(xe.x,xe.y,xe.z),B.push(ve/ie),B.push(1-ge/ne),Ze+=1}}for(let ge=0;ge<ne;ge++)for(let de=0;de<ie;de++){const ve=Z+de+Se*ge,le=Z+de+Se*(ge+1),Ae=Z+(de+1)+Se*(ge+1),Xe=Z+(de+1)+Se*ge;f.push(ve,le,Xe),f.push(le,Ae,Xe),Be+=6}I.addGroup(w,Be,ee),w+=Be,Z+=Ze}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(n){const t={};for(const o in n){t[o]={};for(const r in n[o]){const u=n[o][r];u&&(u.isColor||u.isMatrix3||u.isMatrix4||u.isVector2||u.isVector3||u.isVector4||u.isTexture||u.isQuaternion)?u.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[o][r]=null):t[o][r]=u.clone():Array.isArray(u)?t[o][r]=u.slice():t[o][r]=u}}return t}function mergeUniforms(n){const t={};for(let o=0;o<n.length;o++){const r=cloneUniforms(n[o]);for(const u in r)t[u]=r[u]}return t}function cloneUniformsGroups(n){const t=[];for(let o=0;o<n.length;o++)t.push(n[o].clone());return t}function getUnlitUniformColorSpace(n){const t=n.getRenderTarget();return t===null?n.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.uniformsGroups=cloneUniformsGroups(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const o=super.toJSON(t);o.glslVersion=this.glslVersion,o.uniforms={};for(const u in this.uniforms){const C=this.uniforms[u].value;C&&C.isTexture?o.uniforms[u]={type:"t",value:C.toJSON(t).uuid}:C&&C.isColor?o.uniforms[u]={type:"c",value:C.getHex()}:C&&C.isVector2?o.uniforms[u]={type:"v2",value:C.toArray()}:C&&C.isVector3?o.uniforms[u]={type:"v3",value:C.toArray()}:C&&C.isVector4?o.uniforms[u]={type:"v4",value:C.toArray()}:C&&C.isMatrix3?o.uniforms[u]={type:"m3",value:C.toArray()}:C&&C.isMatrix4?o.uniforms[u]={type:"m4",value:C.toArray()}:o.uniforms[u]={value:C}}Object.keys(this.defines).length>0&&(o.defines=this.defines),o.vertexShader=this.vertexShader,o.fragmentShader=this.fragmentShader,o.lights=this.lights,o.clipping=this.clipping;const r={};for(const u in this.extensions)this.extensions[u]===!0&&(r[u]=!0);return Object.keys(r).length>0&&(o.extensions=r),o}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(t,o){return super.copy(t,o),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,o){super.updateWorldMatrix(t,o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(t=50,o=1,r=.1,u=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=u,this.focus=10,this.aspect=o,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,o){return super.copy(t,o),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const o=.5*this.getFilmHeight()/t;this.fov=RAD2DEG*2*Math.atan(o),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,o,r){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),o.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z)}getViewSize(t,o){return this.getViewBounds(t,_minTarget,_maxTarget),o.subVectors(_maxTarget,_minTarget)}setViewOffset(t,o,r,u,d,C){this.aspect=t/o,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=o,this.view.offsetX=r,this.view.offsetY=u,this.view.width=d,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let o=t*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,r=2*o,u=this.aspect*r,d=-.5*u;const C=this.view;if(this.view!==null&&this.view.enabled){const f=C.fullWidth,A=C.fullHeight;d+=C.offsetX*u/f,o-=C.offsetY*r/A,u*=C.width/f,r*=C.height/A}const I=this.filmOffset;I!==0&&(d+=t*I/this.getFilmWidth()),this.projectionMatrix.makePerspective(d,d+u,o,o-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const o=super.toJSON(t);return o.object.fov=this.fov,o.object.zoom=this.zoom,o.object.near=this.near,o.object.far=this.far,o.object.focus=this.focus,o.object.aspect=this.aspect,this.view!==null&&(o.object.view=Object.assign({},this.view)),o.object.filmGauge=this.filmGauge,o.object.filmOffset=this.filmOffset,o}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(t,o,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const u=new PerspectiveCamera(fov,aspect,t,o);u.layers=this.layers,this.add(u);const d=new PerspectiveCamera(fov,aspect,t,o);d.layers=this.layers,this.add(d);const C=new PerspectiveCamera(fov,aspect,t,o);C.layers=this.layers,this.add(C);const I=new PerspectiveCamera(fov,aspect,t,o);I.layers=this.layers,this.add(I);const f=new PerspectiveCamera(fov,aspect,t,o);f.layers=this.layers,this.add(f);const A=new PerspectiveCamera(fov,aspect,t,o);A.layers=this.layers,this.add(A)}updateCoordinateSystem(){const t=this.coordinateSystem,o=this.children.concat(),[r,u,d,C,I,f]=o;for(const A of o)this.remove(A);if(t===WebGLCoordinateSystem)r.up.set(0,1,0),r.lookAt(1,0,0),u.up.set(0,1,0),u.lookAt(-1,0,0),d.up.set(0,0,-1),d.lookAt(0,1,0),C.up.set(0,0,1),C.lookAt(0,-1,0),I.up.set(0,1,0),I.lookAt(0,0,1),f.up.set(0,1,0),f.lookAt(0,0,-1);else if(t===WebGPUCoordinateSystem)r.up.set(0,-1,0),r.lookAt(-1,0,0),u.up.set(0,-1,0),u.lookAt(1,0,0),d.up.set(0,0,1),d.lookAt(0,1,0),C.up.set(0,0,-1),C.lookAt(0,-1,0),I.up.set(0,-1,0),I.lookAt(0,0,1),f.up.set(0,-1,0),f.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const A of o)this.add(A),A.updateMatrixWorld()}update(t,o){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:u}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[d,C,I,f,A,G]=this.children,B=t.getRenderTarget(),Z=t.getActiveCubeFace(),w=t.getActiveMipmapLevel(),V=t.xr.enabled;t.xr.enabled=!1;const Y=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,u),t.render(o,d),t.setRenderTarget(r,1,u),t.render(o,C),t.setRenderTarget(r,2,u),t.render(o,I),t.setRenderTarget(r,3,u),t.render(o,f),t.setRenderTarget(r,4,u),t.render(o,A),r.texture.generateMipmaps=Y,t.setRenderTarget(r,5,u),t.render(o,G),t.setRenderTarget(B,Z,w),t.xr.enabled=V,r.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(t,o,r,u,d,C,I,f,A,G){t=t!==void 0?t:[],o=o!==void 0?o:CubeReflectionMapping,super(t,o,r,u,d,C,I,f,A,G),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t=1,o={}){super(t,t,o),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},u=[r,r,r,r,r,r];this.texture=new CubeTexture(u,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=o.generateMipmaps!==void 0?o.generateMipmaps:!1,this.texture.minFilter=o.minFilter!==void 0?o.minFilter:LinearFilter}fromEquirectangularTexture(t,o){this.texture.type=o.type,this.texture.colorSpace=o.colorSpace,this.texture.generateMipmaps=o.generateMipmaps,this.texture.minFilter=o.minFilter,this.texture.magFilter=o.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},u=new BoxGeometry(5,5,5),d=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending});d.uniforms.tEquirect.value=o;const C=new Mesh(u,d),I=o.minFilter;return o.minFilter===LinearMipmapLinearFilter&&(o.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,C),o.minFilter=I,C.geometry.dispose(),C.material.dispose(),this}clear(t,o,r,u){const d=t.getRenderTarget();for(let C=0;C<6;C++)t.setRenderTarget(this,C),t.clear(o,r,u);t.setRenderTarget(d)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const o=this._hand;if(o)for(const r of t.hand.values())this._getHandJoint(o,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,o,r){let u=null,d=null,C=null;const I=this._targetRay,f=this._grip,A=this._hand;if(t&&o.session.visibilityState!=="visible-blurred"){if(A&&t.hand){C=!0;for(const Y of t.hand.values()){const J=o.getJointPose(Y,r),T=this._getHandJoint(A,Y);J!==null&&(T.matrix.fromArray(J.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),T.matrixWorldNeedsUpdate=!0,T.jointRadius=J.radius),T.visible=J!==null}const G=A.joints["index-finger-tip"],B=A.joints["thumb-tip"],Z=G.position.distanceTo(B.position),w=.02,V=.005;A.inputState.pinching&&Z>w+V?(A.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!A.inputState.pinching&&Z<=w-V&&(A.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else f!==null&&t.gripSpace&&(d=o.getPose(t.gripSpace,r),d!==null&&(f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,d.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(d.linearVelocity)):f.hasLinearVelocity=!1,d.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(d.angularVelocity)):f.hasAngularVelocity=!1));I!==null&&(u=o.getPose(t.targetRaySpace,r),u===null&&d!==null&&(u=d),u!==null&&(I.matrix.fromArray(u.transform.matrix),I.matrix.decompose(I.position,I.rotation,I.scale),I.matrixWorldNeedsUpdate=!0,u.linearVelocity?(I.hasLinearVelocity=!0,I.linearVelocity.copy(u.linearVelocity)):I.hasLinearVelocity=!1,u.angularVelocity?(I.hasAngularVelocity=!0,I.angularVelocity.copy(u.angularVelocity)):I.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return I!==null&&(I.visible=u!==null),f!==null&&(f.visible=d!==null),A!==null&&(A.visible=C!==null),this}_getHandJoint(t,o){if(t.joints[o.jointName]===void 0){const r=new Group;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[o.jointName]=r,t.add(r)}return t.joints[o.jointName]}}class FogExp2{constructor(t,o=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(t),this.density=o}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,o=1,r=1e3){this.isFog=!0,this.name="",this.color=new Color(t),this.near=o,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,o){return super.copy(t,o),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const o=super.toJSON(t);return this.fog!==null&&(o.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(o.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(o.object.backgroundIntensity=this.backgroundIntensity),o.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(o.object.environmentIntensity=this.environmentIntensity),o.object.environmentRotation=this.environmentRotation.toArray(),o}}class InterleavedBuffer{constructor(t,o){this.isInterleavedBuffer=!0,this.array=t,this.stride=o,this.count=t!==void 0?t.length/o:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,o){this.updateRanges.push({start:t,count:o})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,o,r){t*=this.stride,r*=o.stride;for(let u=0,d=this.stride;u<d;u++)this.array[t+u]=o.array[r+u];return this}set(t,o=0){return this.array.set(t,o),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const o=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(o,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new Vector3;class InterleavedBufferAttribute{constructor(t,o,r,u=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=o,this.offset=r,this.normalized=u}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let o=0,r=this.data.count;o<r;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.applyMatrix4(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(t){for(let o=0,r=this.count;o<r;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.applyNormalMatrix(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(t){for(let o=0,r=this.count;o<r;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.transformDirection(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(t,o){let r=this.array[t*this.data.stride+this.offset+o];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(t,o,r){return this.normalized&&(r=normalize(r,this.array)),this.data.array[t*this.data.stride+this.offset+o]=r,this}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset]=o,this}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+1]=o,this}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+2]=o,this}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+3]=o,this}getX(t){let o=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(o=denormalize(o,this.array)),o}getY(t){let o=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(o=denormalize(o,this.array)),o}getZ(t){let o=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(o=denormalize(o,this.array)),o}getW(t){let o=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(o=denormalize(o,this.array)),o}setXY(t,o,r){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=r,this}setXYZ(t,o,r,u){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=r,this.data.array[t+2]=u,this}setXYZW(t,o,r,u,d){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),r=normalize(r,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=r,this.data.array[t+2]=u,this.data.array[t+3]=d,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const o=[];for(let r=0;r<this.count;r++){const u=r*this.data.stride+this.offset;for(let d=0;d<this.itemSize;d++)o.push(this.data.array[u+d])}return new BufferAttribute(new this.array.constructor(o),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const o=[];for(let r=0;r<this.count;r++){const u=r*this.data.stride+this.offset;for(let d=0;d<this.itemSize;d++)o.push(this.data.array[u+d])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:o,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(t=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const o=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new InterleavedBuffer(o,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(r,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(r,2,3,!1))}this.geometry=_geometry,this.material=t,this.center=new Vector2(.5,.5)}raycast(t,o){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const r=this.material.rotation;let u,d;r!==0&&(d=Math.cos(r),u=Math.sin(r));const C=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,C,_worldScale,u,d),transformVertex(_vB.set(.5,-.5,0),_mvPosition,C,_worldScale,u,d),transformVertex(_vC.set(.5,.5,0),_mvPosition,C,_worldScale,u,d),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let I=t.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(I===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,C,_worldScale,u,d),_uvB.set(0,1),I=t.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),I===null))return;const f=t.ray.origin.distanceTo(_intersectPoint);f<t.near||f>t.far||o.push({distance:f,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(t,o){return super.copy(t,o),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function transformVertex(n,t,o,r,u,d){_alignedPosition.subVectors(n,o).addScalar(.5).multiply(r),u!==void 0?(_rotatedPosition.x=d*_alignedPosition.x-u*_alignedPosition.y,_rotatedPosition.y=u*_alignedPosition.x+d*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),n.copy(t),n.x+=_rotatedPosition.x,n.y+=_rotatedPosition.y,n.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const o=t.levels;for(let r=0,u=o.length;r<u;r++){const d=o[r];this.addLevel(d.object.clone(),d.distance,d.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,o=0,r=0){o=Math.abs(o);const u=this.levels;let d;for(d=0;d<u.length&&!(o<u[d].distance);d++);return u.splice(d,0,{distance:o,hysteresis:r,object:t}),this.add(t),this}removeLevel(t){const o=this.levels;for(let r=0;r<o.length;r++)if(o[r].distance===t){const u=o.splice(r,1);return this.remove(u[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const o=this.levels;if(o.length>0){let r,u;for(r=1,u=o.length;r<u;r++){let d=o[r].distance;if(o[r].object.visible&&(d-=d*o[r].hysteresis),t<d)break}return o[r-1].object}return null}raycast(t,o){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const u=t.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(u).raycast(t,o)}}update(t){const o=this.levels;if(o.length>1){_v1$2.setFromMatrixPosition(t.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const r=_v1$2.distanceTo(_v2$1)/t.zoom;o[0].object.visible=!0;let u,d;for(u=1,d=o.length;u<d;u++){let C=o[u].distance;if(o[u].object.visible&&(C-=C*o[u].hysteresis),r>=C)o[u-1].object.visible=!1,o[u].object.visible=!0;else break}for(this._currentLevel=u-1;u<d;u++)o[u].object.visible=!1}}toJSON(t){const o=super.toJSON(t);this.autoUpdate===!1&&(o.object.autoUpdate=!1),o.object.levels=[];const r=this.levels;for(let u=0,d=r.length;u<d;u++){const C=r[u];o.object.levels.push({object:C.object.uuid,distance:C.distance,hysteresis:C.hysteresis})}return o}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$5=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray$2;class SkinnedMesh extends Mesh{constructor(t,o){super(t,o),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const o=t.getAttribute("position");for(let r=0;r<o.count;r++)this.getVertexPosition(r,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const o=t.getAttribute("position");for(let r=0;r<o.count;r++)this.getVertexPosition(r,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(t,o){return super.copy(t,o),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,o){const r=this.material,u=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(u),t.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(u).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,o,_ray$2)))}getVertexPosition(t,o){return super.getVertexPosition(t,o),this.applyBoneTransform(t,o),o}bind(t,o){this.skeleton=t,o===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),o=this.matrixWorld),this.bindMatrix.copy(o),this.bindMatrixInverse.copy(o).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,o=this.geometry.attributes.skinWeight;for(let r=0,u=o.count;r<u;r++){t.fromBufferAttribute(o,r);const d=1/t.manhattanLength();d!==1/0?t.multiplyScalar(d):t.set(1,0,0,0),o.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,o){const r=this.skeleton,u=this.geometry;_skinIndex.fromBufferAttribute(u.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(u.attributes.skinWeight,t),_basePosition.copy(o).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(let d=0;d<4;d++){const C=_skinWeight.getComponent(d);if(C!==0){const I=_skinIndex.getComponent(d);_matrix4.multiplyMatrices(r.bones[I].matrixWorld,r.boneInverses[I]),o.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),C)}}return o.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(t=null,o=1,r=1,u,d,C,I,f,A=NearestFilter,G=NearestFilter,B,Z){super(null,C,I,f,A,G,u,d,B,Z),this.isDataTexture=!0,this.image={data:t,width:o,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(t=[],o=[]){this.uuid=generateUUID(),this.bones=t.slice(0),this.boneInverses=o,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,o=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),o.length===0)this.calculateInverses();else if(t.length!==o.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,u=this.bones.length;r<u;r++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,o=this.bones.length;t<o;t++){const r=new Matrix4;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,o=this.bones.length;t<o;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,o=this.bones.length;t<o;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,o=this.boneInverses,r=this.boneMatrices,u=this.boneTexture;for(let d=0,C=t.length;d<C;d++){const I=t[d]?t[d].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(I,o[d]),_offsetMatrix.toArray(r,d*16)}u!==null&&(u.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const o=new Float32Array(t*t*4);o.set(this.boneMatrices);const r=new DataTexture(o,t,t,RGBAFormat,FloatType);return r.needsUpdate=!0,this.boneMatrices=o,this.boneTexture=r,this}getBoneByName(t){for(let o=0,r=this.bones.length;o<r;o++){const u=this.bones[o];if(u.name===t)return u}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,o){this.uuid=t.uuid;for(let r=0,u=t.bones.length;r<u;r++){const d=t.bones[r];let C=o[d];C===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",d),C=new Bone),this.bones.push(C),this.boneInverses.push(new Matrix4().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const o=this.bones,r=this.boneInverses;for(let u=0,d=o.length;u<d;u++){const C=o[u];t.bones.push(C.uuid);const I=r[u];t.boneInverses.push(I.toArray())}return t}}class InstancedBufferAttribute extends BufferAttribute{constructor(t,o,r,u=1){super(t,o,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=u}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere;class InstancedMesh extends Mesh{constructor(t,o,r){super(t,o),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let u=0;u<r;u++)this.setMatrixAt(u,_identity)}computeBoundingBox(){const t=this.geometry,o=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<o;r++)this.getMatrixAt(r,_instanceLocalMatrix),_box3.copy(t.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const t=this.geometry,o=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<o;r++)this.getMatrixAt(r,_instanceLocalMatrix),_sphere$4.copy(t.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(t,o){return super.copy(t,o),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,o){o.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,o){o.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,o){const r=o.morphTargetInfluences,u=this.morphTexture.source.data.data,d=r.length+1,C=t*d+1;for(let I=0;I<r.length;I++)r[I]=u[C+I]}raycast(t,o){const r=this.matrixWorld,u=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(r),t.ray.intersectsSphere(_sphere$4)!==!1))for(let d=0;d<u;d++){this.getMatrixAt(d,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(t,_instanceIntersects);for(let C=0,I=_instanceIntersects.length;C<I;C++){const f=_instanceIntersects[C];f.instanceId=d,f.object=this,o.push(f)}_instanceIntersects.length=0}}setColorAt(t,o){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),o.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,o){o.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,o){const r=o.morphTargetInfluences,u=r.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(u*this.count),u,this.count,RedFormat,FloatType));const d=this.morphTexture.source.data.data;let C=0;for(let A=0;A<r.length;A++)C+=r[A];const I=this.geometry.morphTargetsRelative?1:1-C,f=u*t;d[f]=I,d.set(r,f+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;let Plane$1=class{constructor(t=new Vector3(1,0,0),o=0){this.isPlane=!0,this.normal=t,this.constant=o}set(t,o){return this.normal.copy(t),this.constant=o,this}setComponents(t,o,r,u){return this.normal.set(t,o,r),this.constant=u,this}setFromNormalAndCoplanarPoint(t,o){return this.normal.copy(t),this.constant=-o.dot(this.normal),this}setFromCoplanarPoints(t,o,r){const u=_vector1.subVectors(r,o).cross(_vector2.subVectors(t,o)).normalize();return this.setFromNormalAndCoplanarPoint(u,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,o){return o.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,o){const r=t.delta(_vector1),u=this.normal.dot(r);if(u===0)return this.distanceToPoint(t.start)===0?o.copy(t.start):null;const d=-(t.start.dot(this.normal)+this.constant)/u;return d<0||d>1?null:o.copy(t.start).addScaledVector(r,d)}intersectsLine(t){const o=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return o<0&&r>0||r<0&&o>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,o){const r=o||_normalMatrix.getNormalMatrix(t),u=this.coplanarPoint(_vector1).applyMatrix4(t),d=this.normal.applyMatrix3(r).normalize();return this.constant=-u.dot(d),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}};const _sphere$3=new Sphere,_vector$6=new Vector3;class Frustum{constructor(t=new Plane$1,o=new Plane$1,r=new Plane$1,u=new Plane$1,d=new Plane$1,C=new Plane$1){this.planes=[t,o,r,u,d,C]}set(t,o,r,u,d,C){const I=this.planes;return I[0].copy(t),I[1].copy(o),I[2].copy(r),I[3].copy(u),I[4].copy(d),I[5].copy(C),this}copy(t){const o=this.planes;for(let r=0;r<6;r++)o[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,o=WebGLCoordinateSystem){const r=this.planes,u=t.elements,d=u[0],C=u[1],I=u[2],f=u[3],A=u[4],G=u[5],B=u[6],Z=u[7],w=u[8],V=u[9],Y=u[10],J=u[11],T=u[12],L=u[13],z=u[14],K=u[15];if(r[0].setComponents(f-d,Z-A,J-w,K-T).normalize(),r[1].setComponents(f+d,Z+A,J+w,K+T).normalize(),r[2].setComponents(f+C,Z+G,J+V,K+L).normalize(),r[3].setComponents(f-C,Z-G,J-V,K-L).normalize(),r[4].setComponents(f-I,Z-B,J-Y,K-z).normalize(),o===WebGLCoordinateSystem)r[5].setComponents(f+I,Z+B,J+Y,K+z).normalize();else if(o===WebGPUCoordinateSystem)r[5].setComponents(I,B,Y,z).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+o);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$3.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const o=t.geometry;o.boundingSphere===null&&o.computeBoundingSphere(),_sphere$3.copy(o.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(t){return _sphere$3.center.set(0,0,0),_sphere$3.radius=.7071067811865476,_sphere$3.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(t){const o=this.planes,r=t.center,u=-t.radius;for(let d=0;d<6;d++)if(o[d].distanceToPoint(r)<u)return!1;return!0}intersectsBox(t){const o=this.planes;for(let r=0;r<6;r++){const u=o[r];if(_vector$6.x=u.normal.x>0?t.max.x:t.min.x,_vector$6.y=u.normal.y>0?t.max.y:t.min.y,_vector$6.z=u.normal.z>0?t.max.z:t.min.z,u.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(t){const o=this.planes;for(let r=0;r<6;r++)if(o[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ascIdSort(n,t){return n-t}function sortOpaque(n,t){return n.z-t.z}function sortTransparent(n,t){return t.z-n.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,o,r,u){const d=this.pool,C=this.list;this.index>=d.length&&d.push({start:-1,count:-1,z:-1,index:-1});const I=d[this.index];C.push(I),this.index++,I.start=t,I.count=o,I.z=r,I.index=u}reset(){this.list.length=0,this.index=0}}const _matrix$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum=new Frustum,_box$1=new Box3,_sphere$2=new Sphere,_vector$5=new Vector3,_forward=new Vector3,_temp=new Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(n,t,o=0){const r=t.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==t.array.constructor){const u=n.count;for(let d=0;d<u;d++)for(let C=0;C<r;C++)t.setComponent(d+o,C,n.getComponent(d,C))}else t.array.set(n.array,o*r);t.needsUpdate=!0}function copyArrayContents(n,t){if(n.constructor!==t.constructor){const o=Math.min(n.length,t.length);for(let r=0;r<o;r++)t[r]=n[r]}else{const o=Math.min(n.length,t.length);t.set(new n.constructor(n.buffer,0,o))}}class BatchedMesh extends Mesh{constructor(t,o,r=o*2,u){super(new BufferGeometry,u),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=o,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const o=new Float32Array(t*t*4),r=new DataTexture(o,t,t,RGBAFormat,FloatType);this._matricesTexture=r}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const o=new Uint32Array(t*t),r=new DataTexture(o,t,t,RedIntegerFormat,UnsignedIntType);this._indirectTexture=r}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const o=new Float32Array(t*t*4).fill(1),r=new DataTexture(o,t,t,RGBAFormat,FloatType);r.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=r}_initializeGeometry(t){const o=this.geometry,r=this._maxVertexCount,u=this._maxIndexCount;if(this._geometryInitialized===!1){for(const d in t.attributes){const C=t.getAttribute(d),{array:I,itemSize:f,normalized:A}=C,G=new I.constructor(r*f),B=new BufferAttribute(G,f,A);o.setAttribute(d,B)}if(t.getIndex()!==null){const d=r>65535?new Uint32Array(u):new Uint16Array(u);o.setIndex(new BufferAttribute(d,1))}this._geometryInitialized=!0}}_validateGeometry(t){const o=this.geometry;if(!!t.getIndex()!=!!o.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in o.attributes){if(!t.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const u=t.getAttribute(r),d=o.getAttribute(r);if(u.itemSize!==d.itemSize||u.normalized!==d.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const o=this._instanceInfo;if(t<0||t>=o.length||o[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const o=this._geometryInfo;if(t<0||t>=o.length||o[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const t=this.boundingBox,o=this._instanceInfo;t.makeEmpty();for(let r=0,u=o.length;r<u;r++){if(o[r].active===!1)continue;const d=o[r].geometryIndex;this.getMatrixAt(r,_matrix$1),this.getBoundingBoxAt(d,_box$1).applyMatrix4(_matrix$1),t.union(_box$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const t=this.boundingSphere,o=this._instanceInfo;t.makeEmpty();for(let r=0,u=o.length;r<u;r++){if(o[r].active===!1)continue;const d=o[r].geometryIndex;this.getMatrixAt(r,_matrix$1),this.getBoundingSphereAt(d,_sphere$2).applyMatrix4(_matrix$1),t.union(_sphere$2)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:t};let u=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),u=this._availableInstanceIds.shift(),this._instanceInfo[u]=r):(u=this._instanceInfo.length,this._instanceInfo.push(r));const d=this._matricesTexture;_matrix$1.identity().toArray(d.image.data,u*16),d.needsUpdate=!0;const C=this._colorsTexture;return C&&(_whiteColor.toArray(C.image.data,u*4),C.needsUpdate=!0),this._visibilityChanged=!0,u}addGeometry(t,o=-1,r=-1){this._initializeGeometry(t),this._validateGeometry(t);const u={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},d=this._geometryInfo;u.vertexStart=this._nextVertexStart,u.reservedVertexCount=o===-1?t.getAttribute("position").count:o;const C=t.getIndex();if(C!==null&&(u.indexStart=this._nextIndexStart,u.reservedIndexCount=r===-1?C.count:r),u.indexStart!==-1&&u.indexStart+u.reservedIndexCount>this._maxIndexCount||u.vertexStart+u.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let f;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),f=this._availableGeometryIds.shift(),d[f]=u):(f=this._geometryCount,this._geometryCount++,d.push(u)),this.setGeometryAt(f,t),this._nextIndexStart=u.indexStart+u.reservedIndexCount,this._nextVertexStart=u.vertexStart+u.reservedVertexCount,f}setGeometryAt(t,o){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(o);const r=this.geometry,u=r.getIndex()!==null,d=r.getIndex(),C=o.getIndex(),I=this._geometryInfo[t];if(u&&C.count>I.reservedIndexCount||o.attributes.position.count>I.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const f=I.vertexStart,A=I.reservedVertexCount;I.vertexCount=o.getAttribute("position").count;for(const G in r.attributes){const B=o.getAttribute(G),Z=r.getAttribute(G);copyAttributeData(B,Z,f);const w=B.itemSize;for(let V=B.count,Y=A;V<Y;V++){const J=f+V;for(let T=0;T<w;T++)Z.setComponent(J,T,0)}Z.needsUpdate=!0,Z.addUpdateRange(f*w,A*w)}if(u){const G=I.indexStart,B=I.reservedIndexCount;I.indexCount=o.getIndex().count;for(let Z=0;Z<C.count;Z++)d.setX(G+Z,f+C.getX(Z));for(let Z=C.count,w=B;Z<w;Z++)d.setX(G+Z,f);d.needsUpdate=!0,d.addUpdateRange(G,I.reservedIndexCount)}return I.start=u?I.indexStart:I.vertexStart,I.count=u?I.indexCount:I.vertexCount,I.boundingBox=null,o.boundingBox!==null&&(I.boundingBox=o.boundingBox.clone()),I.boundingSphere=null,o.boundingSphere!==null&&(I.boundingSphere=o.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const o=this._geometryInfo;if(t>=o.length||o[t].active===!1)return this;const r=this._instanceInfo;for(let u=0,d=r.length;u<d;u++)r[u].active&&r[u].geometryIndex===t&&this.deleteInstance(u);return o[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,o=0;const r=this._geometryInfo,u=r.map((C,I)=>I).sort((C,I)=>r[C].vertexStart-r[I].vertexStart),d=this.geometry;for(let C=0,I=r.length;C<I;C++){const f=u[C],A=r[f];if(A.active!==!1){if(d.index!==null){if(A.indexStart!==o){const{indexStart:G,vertexStart:B,reservedIndexCount:Z}=A,w=d.index,V=w.array,Y=t-B;for(let J=G;J<G+Z;J++)V[J]=V[J]+Y;w.array.copyWithin(o,G,G+Z),w.addUpdateRange(o,Z),A.indexStart=o}o+=A.reservedIndexCount}if(A.vertexStart!==t){const{vertexStart:G,reservedVertexCount:B}=A,Z=d.attributes;for(const w in Z){const V=Z[w],{array:Y,itemSize:J}=V;Y.copyWithin(t*J,G*J,(G+B)*J),V.addUpdateRange(t*J,B*J)}A.vertexStart=t}t+=A.reservedVertexCount,A.start=d.index?A.indexStart:A.vertexStart,this._nextIndexStart=d.index?A.indexStart+A.reservedIndexCount:0,this._nextVertexStart=A.vertexStart+A.reservedVertexCount}}return this}getBoundingBoxAt(t,o){if(t>=this._geometryCount)return null;const r=this.geometry,u=this._geometryInfo[t];if(u.boundingBox===null){const d=new Box3,C=r.index,I=r.attributes.position;for(let f=u.start,A=u.start+u.count;f<A;f++){let G=f;C&&(G=C.getX(G)),d.expandByPoint(_vector$5.fromBufferAttribute(I,G))}u.boundingBox=d}return o.copy(u.boundingBox),o}getBoundingSphereAt(t,o){if(t>=this._geometryCount)return null;const r=this.geometry,u=this._geometryInfo[t];if(u.boundingSphere===null){const d=new Sphere;this.getBoundingBoxAt(t,_box$1),_box$1.getCenter(d.center);const C=r.index,I=r.attributes.position;let f=0;for(let A=u.start,G=u.start+u.count;A<G;A++){let B=A;C&&(B=C.getX(B)),_vector$5.fromBufferAttribute(I,B),f=Math.max(f,d.center.distanceToSquared(_vector$5))}d.radius=Math.sqrt(f),u.boundingSphere=d}return o.copy(u.boundingSphere),o}setMatrixAt(t,o){this.validateInstanceId(t);const r=this._matricesTexture,u=this._matricesTexture.image.data;return o.toArray(u,t*16),r.needsUpdate=!0,this}getMatrixAt(t,o){return this.validateInstanceId(t),o.fromArray(this._matricesTexture.image.data,t*16)}setColorAt(t,o){return this.validateInstanceId(t),this._colorsTexture===null&&this._initColorsTexture(),o.toArray(this._colorsTexture.image.data,t*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,o){return this.validateInstanceId(t),o.fromArray(this._colorsTexture.image.data,t*4)}setVisibleAt(t,o){return this.validateInstanceId(t),this._instanceInfo[t].visible===o?this:(this._instanceInfo[t].visible=o,this._visibilityChanged=!0,this)}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,o){return this.validateInstanceId(t),this.validateGeometryId(o),this._instanceInfo[t].geometryIndex=o,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,o={}){this.validateGeometryId(t);const r=this._geometryInfo[t];return o.vertexStart=r.vertexStart,o.vertexCount=r.vertexCount,o.reservedVertexCount=r.reservedVertexCount,o.indexStart=r.indexStart,o.indexCount=r.indexCount,o.reservedIndexCount=r.reservedIndexCount,o.start=r.start,o.count=r.count,o}setInstanceCount(t){const o=this._availableInstanceIds,r=this._instanceInfo;for(o.sort(ascIdSort);o[o.length-1]===r.length;)r.pop(),o.pop();if(t<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const u=new Int32Array(t),d=new Int32Array(t);copyArrayContents(this._multiDrawCounts,u),copyArrayContents(this._multiDrawStarts,d),this._multiDrawCounts=u,this._multiDrawStarts=d,this._maxInstanceCount=t;const C=this._indirectTexture,I=this._matricesTexture,f=this._colorsTexture;C.dispose(),this._initIndirectTexture(),copyArrayContents(C.image.data,this._indirectTexture.image.data),I.dispose(),this._initMatricesTexture(),copyArrayContents(I.image.data,this._matricesTexture.image.data),f&&(f.dispose(),this._initColorsTexture(),copyArrayContents(f.image.data,this._colorsTexture.image.data))}setGeometrySize(t,o){const r=[...this._geometryInfo].filter(I=>I.active);if(Math.max(...r.map(I=>I.vertexStart+I.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${o}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(f=>f.indexStart+f.reservedIndexCount))>o)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${o}. Cannot shrink further.`);const d=this.geometry;d.dispose(),this._maxVertexCount=t,this._maxIndexCount=o,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(d));const C=this.geometry;d.index&&copyArrayContents(d.index.array,C.index.array);for(const I in d.attributes)copyArrayContents(d.attributes[I].array,C.attributes[I].array)}raycast(t,o){const r=this._instanceInfo,u=this._geometryInfo,d=this.matrixWorld,C=this.geometry;_mesh.material=this.material,_mesh.geometry.index=C.index,_mesh.geometry.attributes=C.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere);for(let I=0,f=r.length;I<f;I++){if(!r[I].visible||!r[I].active)continue;const A=r[I].geometryIndex,G=u[A];_mesh.geometry.setDrawRange(G.start,G.count),this.getMatrixAt(I,_mesh.matrixWorld).premultiply(d),this.getBoundingBoxAt(A,_mesh.geometry.boundingBox),this.getBoundingSphereAt(A,_mesh.geometry.boundingSphere),_mesh.raycast(t,_batchIntersects);for(let B=0,Z=_batchIntersects.length;B<Z;B++){const w=_batchIntersects[B];w.object=this,w.batchId=I,o.push(w)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox!==null?o.boundingBox.clone():null,boundingSphere:o.boundingSphere!==null?o.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(o=>({...o})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,o,r,u,d){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const C=u.getIndex(),I=C===null?1:C.array.BYTES_PER_ELEMENT,f=this._instanceInfo,A=this._multiDrawStarts,G=this._multiDrawCounts,B=this._geometryInfo,Z=this.perObjectFrustumCulled,w=this._indirectTexture,V=w.image.data;Z&&(_matrix$1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_matrix$1,t.coordinateSystem));let Y=0;if(this.sortObjects){_matrix$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(r.matrixWorld).applyMatrix4(_matrix$1),_forward.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(_matrix$1);for(let L=0,z=f.length;L<z;L++)if(f[L].visible&&f[L].active){const K=f[L].geometryIndex;this.getMatrixAt(L,_matrix$1),this.getBoundingSphereAt(K,_sphere$2).applyMatrix4(_matrix$1);let P=!1;if(Z&&(P=!_frustum.intersectsSphere(_sphere$2)),!P){const $=B[K],ie=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push($.start,$.count,ie,L)}}const J=_renderList.list,T=this.customSort;T===null?J.sort(d.transparent?sortTransparent:sortOpaque):T.call(this,J,r);for(let L=0,z=J.length;L<z;L++){const K=J[L];A[Y]=K.start*I,G[Y]=K.count,V[Y]=K.index,Y++}_renderList.reset()}else for(let J=0,T=f.length;J<T;J++)if(f[J].visible&&f[J].active){const L=f[J].geometryIndex;let z=!1;if(Z&&(this.getMatrixAt(J,_matrix$1),this.getBoundingSphereAt(L,_sphere$2).applyMatrix4(_matrix$1),z=!_frustum.intersectsSphere(_sphere$2)),!z){const K=B[L];A[Y]=K.start*I,G[Y]=K.count,V[Y]=J,Y++}}w.needsUpdate=!0,this._multiDrawCount=Y,this._visibilityChanged=!1}onBeforeShadow(t,o,r,u,d,C){this.onBeforeRender(t,null,u,d,C)}}class LineBasicMaterial extends Material{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _vStart=new Vector3,_vEnd=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$2,_sphere$1=new Sphere,_intersectPointOnRay=new Vector3,_intersectPointOnSegment=new Vector3;class Line extends Object3D{constructor(t=new BufferGeometry,o=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const o=t.attributes.position,r=[0];for(let u=1,d=o.count;u<d;u++)_vStart.fromBufferAttribute(o,u-1),_vEnd.fromBufferAttribute(o,u),r[u]=r[u-1],r[u]+=_vStart.distanceTo(_vEnd);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,o){const r=this.geometry,u=this.matrixWorld,d=t.params.Line.threshold,C=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$1.copy(r.boundingSphere),_sphere$1.applyMatrix4(u),_sphere$1.radius+=d,t.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(u).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const I=d/((this.scale.x+this.scale.y+this.scale.z)/3),f=I*I,A=this.isLineSegments?2:1,G=r.index,Z=r.attributes.position;if(G!==null){const w=Math.max(0,C.start),V=Math.min(G.count,C.start+C.count);for(let Y=w,J=V-1;Y<J;Y+=A){const T=G.getX(Y),L=G.getX(Y+1),z=checkIntersection(this,t,_ray$1,f,T,L,Y);z&&o.push(z)}if(this.isLineLoop){const Y=G.getX(V-1),J=G.getX(w),T=checkIntersection(this,t,_ray$1,f,Y,J,V-1);T&&o.push(T)}}else{const w=Math.max(0,C.start),V=Math.min(Z.count,C.start+C.count);for(let Y=w,J=V-1;Y<J;Y+=A){const T=checkIntersection(this,t,_ray$1,f,Y,Y+1,Y);T&&o.push(T)}if(this.isLineLoop){const Y=checkIntersection(this,t,_ray$1,f,V-1,w,V-1);Y&&o.push(Y)}}}updateMorphTargets(){const o=this.geometry.morphAttributes,r=Object.keys(o);if(r.length>0){const u=o[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,C=u.length;d<C;d++){const I=u[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=d}}}}}function checkIntersection(n,t,o,r,u,d,C){const I=n.geometry.attributes.position;if(_vStart.fromBufferAttribute(I,u),_vEnd.fromBufferAttribute(I,d),o.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>r)return;_intersectPointOnRay.applyMatrix4(n.matrixWorld);const A=t.ray.origin.distanceTo(_intersectPointOnRay);if(!(A<t.near||A>t.far))return{distance:A,point:_intersectPointOnSegment.clone().applyMatrix4(n.matrixWorld),index:C,face:null,faceIndex:null,barycoord:null,object:n}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(t,o){super(t,o),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const o=t.attributes.position,r=[];for(let u=0,d=o.count;u<d;u+=2)_start.fromBufferAttribute(o,u),_end.fromBufferAttribute(o,u+1),r[u]=u===0?0:r[u-1],r[u+1]=r[u]+_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(t,o){super(t,o),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const _inverseMatrix=new Matrix4,_ray$4=new Ray$2,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,o=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,o){const r=this.geometry,u=this.matrixWorld,d=t.params.Points.threshold,C=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(u),_sphere.radius+=d,t.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(u).invert(),_ray$4.copy(t.ray).applyMatrix4(_inverseMatrix);const I=d/((this.scale.x+this.scale.y+this.scale.z)/3),f=I*I,A=r.index,B=r.attributes.position;if(A!==null){const Z=Math.max(0,C.start),w=Math.min(A.count,C.start+C.count);for(let V=Z,Y=w;V<Y;V++){const J=A.getX(V);_position$2.fromBufferAttribute(B,J),testPoint(_position$2,J,f,u,t,o,this)}}else{const Z=Math.max(0,C.start),w=Math.min(B.count,C.start+C.count);for(let V=Z,Y=w;V<Y;V++)_position$2.fromBufferAttribute(B,V),testPoint(_position$2,V,f,u,t,o,this)}}updateMorphTargets(){const o=this.geometry.morphAttributes,r=Object.keys(o);if(r.length>0){const u=o[r[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,C=u.length;d<C;d++){const I=u[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=d}}}}}function testPoint(n,t,o,r,u,d,C){const I=_ray$4.distanceSqToPoint(n);if(I<o){const f=new Vector3;_ray$4.closestPointToPoint(n,f),f.applyMatrix4(r);const A=u.ray.origin.distanceTo(f);if(A<u.near||A>u.far)return;d.push({distance:A,distanceToRay:Math.sqrt(I),point:f,index:t,face:null,faceIndex:null,barycoord:null,object:C})}}class VideoTexture extends Texture{constructor(t,o,r,u,d,C,I,f,A){super(t,o,r,u,d,C,I,f,A),this.isVideoTexture=!0,this.minFilter=C!==void 0?C:LinearFilter,this.magFilter=d!==void 0?d:LinearFilter,this.generateMipmaps=!1;const G=this;function B(){G.needsUpdate=!0,t.requestVideoFrameCallback(B)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(B)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class VideoFrameTexture extends VideoTexture{constructor(t,o,r,u,d,C,I,f){super({},t,o,r,u,d,C,I,f),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class FramebufferTexture extends Texture{constructor(t,o){super({width:t,height:o}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(t,o,r,u,d,C,I,f,A,G,B,Z){super(null,C,I,f,A,G,u,d,B,Z),this.isCompressedTexture=!0,this.image={width:o,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(t,o,r,u,d,C){super(t,o,r,d,C),this.isCompressedArrayTexture=!0,this.image.depth=u,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(t,o,r){super(void 0,t[0].width,t[0].height,o,r,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class CanvasTexture extends Texture{constructor(t,o,r,u,d,C,I,f,A){super(t,o,r,u,d,C,I,f,A),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(t,o,r,u,d,C,I,f,A,G=DepthFormat){if(G!==DepthFormat&&G!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&G===DepthFormat&&(r=UnsignedIntType),r===void 0&&G===DepthStencilFormat&&(r=UnsignedInt248Type),super(null,u,d,C,I,f,G,r,A),this.isDepthTexture=!0,this.image={width:t,height:o},this.magFilter=I!==void 0?I:NearestFilter,this.minFilter=f!==void 0?f:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Source(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const o=super.toJSON(t);return this.compareFunction!==null&&(o.compareFunction=this.compareFunction),o}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,o){const r=this.getUtoTmapping(t);return this.getPoint(r,o)}getPoints(t=5){const o=[];for(let r=0;r<=t;r++)o.push(this.getPoint(r/t));return o}getSpacedPoints(t=5){const o=[];for(let r=0;r<=t;r++)o.push(this.getPointAt(r/t));return o}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const o=[];let r,u=this.getPoint(0),d=0;o.push(0);for(let C=1;C<=t;C++)r=this.getPoint(C/t),d+=r.distanceTo(u),o.push(d),u=r;return this.cacheArcLengths=o,o}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,o=null){const r=this.getLengths();let u=0;const d=r.length;let C;o?C=o:C=t*r[d-1];let I=0,f=d-1,A;for(;I<=f;)if(u=Math.floor(I+(f-I)/2),A=r[u]-C,A<0)I=u+1;else if(A>0)f=u-1;else{f=u;break}if(u=f,r[u]===C)return u/(d-1);const G=r[u],Z=r[u+1]-G,w=(C-G)/Z;return(u+w)/(d-1)}getTangent(t,o){let u=t-1e-4,d=t+1e-4;u<0&&(u=0),d>1&&(d=1);const C=this.getPoint(u),I=this.getPoint(d),f=o||(C.isVector2?new Vector2:new Vector3);return f.copy(I).sub(C).normalize(),f}getTangentAt(t,o){const r=this.getUtoTmapping(t);return this.getTangent(r,o)}computeFrenetFrames(t,o=!1){const r=new Vector3,u=[],d=[],C=[],I=new Vector3,f=new Matrix4;for(let w=0;w<=t;w++){const V=w/t;u[w]=this.getTangentAt(V,new Vector3)}d[0]=new Vector3,C[0]=new Vector3;let A=Number.MAX_VALUE;const G=Math.abs(u[0].x),B=Math.abs(u[0].y),Z=Math.abs(u[0].z);G<=A&&(A=G,r.set(1,0,0)),B<=A&&(A=B,r.set(0,1,0)),Z<=A&&r.set(0,0,1),I.crossVectors(u[0],r).normalize(),d[0].crossVectors(u[0],I),C[0].crossVectors(u[0],d[0]);for(let w=1;w<=t;w++){if(d[w]=d[w-1].clone(),C[w]=C[w-1].clone(),I.crossVectors(u[w-1],u[w]),I.length()>Number.EPSILON){I.normalize();const V=Math.acos(clamp(u[w-1].dot(u[w]),-1,1));d[w].applyMatrix4(f.makeRotationAxis(I,V))}C[w].crossVectors(u[w],d[w])}if(o===!0){let w=Math.acos(clamp(d[0].dot(d[t]),-1,1));w/=t,u[0].dot(I.crossVectors(d[0],d[t]))>0&&(w=-w);for(let V=1;V<=t;V++)d[V].applyMatrix4(f.makeRotationAxis(u[V],w*V)),C[V].crossVectors(u[V],d[V])}return{tangents:u,normals:d,binormals:C}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,o=0,r=1,u=1,d=0,C=Math.PI*2,I=!1,f=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=o,this.xRadius=r,this.yRadius=u,this.aStartAngle=d,this.aEndAngle=C,this.aClockwise=I,this.aRotation=f}getPoint(t,o=new Vector2){const r=o,u=Math.PI*2;let d=this.aEndAngle-this.aStartAngle;const C=Math.abs(d)<Number.EPSILON;for(;d<0;)d+=u;for(;d>u;)d-=u;d<Number.EPSILON&&(C?d=0:d=u),this.aClockwise===!0&&!C&&(d===u?d=-u:d=d-u);const I=this.aStartAngle+t*d;let f=this.aX+this.xRadius*Math.cos(I),A=this.aY+this.yRadius*Math.sin(I);if(this.aRotation!==0){const G=Math.cos(this.aRotation),B=Math.sin(this.aRotation),Z=f-this.aX,w=A-this.aY;f=Z*G-w*B+this.aX,A=Z*B+w*G+this.aY}return r.set(f,A)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(t,o,r,u,d,C){super(t,o,r,r,u,d,C),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let n=0,t=0,o=0,r=0;function u(d,C,I,f){n=d,t=I,o=-3*d+3*C-2*I-f,r=2*d-2*C+I+f}return{initCatmullRom:function(d,C,I,f,A){u(C,I,A*(I-d),A*(f-C))},initNonuniformCatmullRom:function(d,C,I,f,A,G,B){let Z=(C-d)/A-(I-d)/(A+G)+(I-C)/G,w=(I-C)/G-(f-C)/(G+B)+(f-I)/B;Z*=G,w*=G,u(C,I,Z,w)},calc:function(d){const C=d*d,I=C*d;return n+t*d+o*C+r*I}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],o=!1,r="centripetal",u=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=o,this.curveType=r,this.tension=u}getPoint(t,o=new Vector3){const r=o,u=this.points,d=u.length,C=(d-(this.closed?0:1))*t;let I=Math.floor(C),f=C-I;this.closed?I+=I>0?0:(Math.floor(Math.abs(I)/d)+1)*d:f===0&&I===d-1&&(I=d-2,f=1);let A,G;this.closed||I>0?A=u[(I-1)%d]:(tmp.subVectors(u[0],u[1]).add(u[0]),A=tmp);const B=u[I%d],Z=u[(I+1)%d];if(this.closed||I+2<d?G=u[(I+2)%d]:(tmp.subVectors(u[d-1],u[d-2]).add(u[d-1]),G=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const w=this.curveType==="chordal"?.5:.25;let V=Math.pow(A.distanceToSquared(B),w),Y=Math.pow(B.distanceToSquared(Z),w),J=Math.pow(Z.distanceToSquared(G),w);Y<1e-4&&(Y=1),V<1e-4&&(V=Y),J<1e-4&&(J=Y),px.initNonuniformCatmullRom(A.x,B.x,Z.x,G.x,V,Y,J),py.initNonuniformCatmullRom(A.y,B.y,Z.y,G.y,V,Y,J),pz.initNonuniformCatmullRom(A.z,B.z,Z.z,G.z,V,Y,J)}else this.curveType==="catmullrom"&&(px.initCatmullRom(A.x,B.x,Z.x,G.x,this.tension),py.initCatmullRom(A.y,B.y,Z.y,G.y,this.tension),pz.initCatmullRom(A.z,B.z,Z.z,G.z,this.tension));return r.set(px.calc(f),py.calc(f),pz.calc(f)),r}copy(t){super.copy(t),this.points=[];for(let o=0,r=t.points.length;o<r;o++){const u=t.points[o];this.points.push(u.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let o=0,r=this.points.length;o<r;o++){const u=this.points[o];t.points.push(u.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let o=0,r=t.points.length;o<r;o++){const u=t.points[o];this.points.push(new Vector3().fromArray(u))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function CatmullRom(n,t,o,r,u){const d=(r-t)*.5,C=(u-o)*.5,I=n*n,f=n*I;return(2*o-2*r+d+C)*f+(-3*o+3*r-2*d-C)*I+d*n+o}function QuadraticBezierP0(n,t){const o=1-n;return o*o*t}function QuadraticBezierP1(n,t){return 2*(1-n)*n*t}function QuadraticBezierP2(n,t){return n*n*t}function QuadraticBezier(n,t,o,r){return QuadraticBezierP0(n,t)+QuadraticBezierP1(n,o)+QuadraticBezierP2(n,r)}function CubicBezierP0(n,t){const o=1-n;return o*o*o*t}function CubicBezierP1(n,t){const o=1-n;return 3*o*o*n*t}function CubicBezierP2(n,t){return 3*(1-n)*n*n*t}function CubicBezierP3(n,t){return n*n*n*t}function CubicBezier(n,t,o,r,u){return CubicBezierP0(n,t)+CubicBezierP1(n,o)+CubicBezierP2(n,r)+CubicBezierP3(n,u)}class CubicBezierCurve extends Curve{constructor(t=new Vector2,o=new Vector2,r=new Vector2,u=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=o,this.v2=r,this.v3=u}getPoint(t,o=new Vector2){const r=o,u=this.v0,d=this.v1,C=this.v2,I=this.v3;return r.set(CubicBezier(t,u.x,d.x,C.x,I.x),CubicBezier(t,u.y,d.y,C.y,I.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class CubicBezierCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3,r=new Vector3,u=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=o,this.v2=r,this.v3=u}getPoint(t,o=new Vector3){const r=o,u=this.v0,d=this.v1,C=this.v2,I=this.v3;return r.set(CubicBezier(t,u.x,d.x,C.x,I.x),CubicBezier(t,u.y,d.y,C.y,I.y),CubicBezier(t,u.z,d.z,C.z,I.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class LineCurve extends Curve{constructor(t=new Vector2,o=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=o}getPoint(t,o=new Vector2){const r=o;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,o){return this.getPoint(t,o)}getTangent(t,o=new Vector2){return o.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,o){return this.getTangent(t,o)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class LineCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=o}getPoint(t,o=new Vector3){const r=o;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,o){return this.getPoint(t,o)}getTangent(t,o=new Vector3){return o.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,o){return this.getTangent(t,o)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,o=new Vector2,r=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=o,this.v2=r}getPoint(t,o=new Vector2){const r=o,u=this.v0,d=this.v1,C=this.v2;return r.set(QuadraticBezier(t,u.x,d.x,C.x),QuadraticBezier(t,u.y,d.y,C.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3,r=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=o,this.v2=r}getPoint(t,o=new Vector3){const r=o,u=this.v0,d=this.v1,C=this.v2;return r.set(QuadraticBezier(t,u.x,d.x,C.x),QuadraticBezier(t,u.y,d.y,C.y),QuadraticBezier(t,u.z,d.z,C.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class SplineCurve extends Curve{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,o=new Vector2){const r=o,u=this.points,d=(u.length-1)*t,C=Math.floor(d),I=d-C,f=u[C===0?C:C-1],A=u[C],G=u[C>u.length-2?u.length-1:C+1],B=u[C>u.length-3?u.length-1:C+2];return r.set(CatmullRom(I,f.x,A.x,G.x,B.x),CatmullRom(I,f.y,A.y,G.y,B.y)),r}copy(t){super.copy(t),this.points=[];for(let o=0,r=t.points.length;o<r;o++){const u=t.points[o];this.points.push(u.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let o=0,r=this.points.length;o<r;o++){const u=this.points[o];t.points.push(u.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let o=0,r=t.points.length;o<r;o++){const u=t.points[o];this.points.push(new Vector2().fromArray(u))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(o)){const r=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves[r](o,t))}return this}getPoint(t,o){const r=t*this.getLength(),u=this.getCurveLengths();let d=0;for(;d<u.length;){if(u[d]>=r){const C=u[d]-r,I=this.curves[d],f=I.getLength(),A=f===0?0:1-C/f;return I.getPointAt(A,o)}d++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let o=0;for(let r=0,u=this.curves.length;r<u;r++)o+=this.curves[r].getLength(),t.push(o);return this.cacheLengths=t,t}getSpacedPoints(t=40){const o=[];for(let r=0;r<=t;r++)o.push(this.getPoint(r/t));return this.autoClose&&o.push(o[0]),o}getPoints(t=12){const o=[];let r;for(let u=0,d=this.curves;u<d.length;u++){const C=d[u],I=C.isEllipseCurve?t*2:C.isLineCurve||C.isLineCurve3?1:C.isSplineCurve?t*C.points.length:t,f=C.getPoints(I);for(let A=0;A<f.length;A++){const G=f[A];r&&r.equals(G)||(o.push(G),r=G)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}copy(t){super.copy(t),this.curves=[];for(let o=0,r=t.curves.length;o<r;o++){const u=t.curves[o];this.curves.push(u.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let o=0,r=this.curves.length;o<r;o++){const u=this.curves[o];t.curves.push(u.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let o=0,r=t.curves.length;o<r;o++){const u=t.curves[o];this.curves.push(new Curves[u.type]().fromJSON(u))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let o=1,r=t.length;o<r;o++)this.lineTo(t[o].x,t[o].y);return this}moveTo(t,o){return this.currentPoint.set(t,o),this}lineTo(t,o){const r=new LineCurve(this.currentPoint.clone(),new Vector2(t,o));return this.curves.push(r),this.currentPoint.set(t,o),this}quadraticCurveTo(t,o,r,u){const d=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,o),new Vector2(r,u));return this.curves.push(d),this.currentPoint.set(r,u),this}bezierCurveTo(t,o,r,u,d,C){const I=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,o),new Vector2(r,u),new Vector2(d,C));return this.curves.push(I),this.currentPoint.set(d,C),this}splineThru(t){const o=[this.currentPoint.clone()].concat(t),r=new SplineCurve(o);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,o,r,u,d,C){const I=this.currentPoint.x,f=this.currentPoint.y;return this.absarc(t+I,o+f,r,u,d,C),this}absarc(t,o,r,u,d,C){return this.absellipse(t,o,r,r,u,d,C),this}ellipse(t,o,r,u,d,C,I,f){const A=this.currentPoint.x,G=this.currentPoint.y;return this.absellipse(t+A,o+G,r,u,d,C,I,f),this}absellipse(t,o,r,u,d,C,I,f){const A=new EllipseCurve(t,o,r,u,d,C,I,f);if(this.curves.length>0){const B=A.getPoint(0);B.equals(this.currentPoint)||this.lineTo(B.x,B.y)}this.curves.push(A);const G=A.getPoint(1);return this.currentPoint.copy(G),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(t=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],o=12,r=0,u=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:o,phiStart:r,phiLength:u},o=Math.floor(o),u=clamp(u,0,Math.PI*2);const d=[],C=[],I=[],f=[],A=[],G=1/o,B=new Vector3,Z=new Vector2,w=new Vector3,V=new Vector3,Y=new Vector3;let J=0,T=0;for(let L=0;L<=t.length-1;L++)switch(L){case 0:J=t[L+1].x-t[L].x,T=t[L+1].y-t[L].y,w.x=T*1,w.y=-J,w.z=T*0,Y.copy(w),w.normalize(),f.push(w.x,w.y,w.z);break;case t.length-1:f.push(Y.x,Y.y,Y.z);break;default:J=t[L+1].x-t[L].x,T=t[L+1].y-t[L].y,w.x=T*1,w.y=-J,w.z=T*0,V.copy(w),w.x+=Y.x,w.y+=Y.y,w.z+=Y.z,w.normalize(),f.push(w.x,w.y,w.z),Y.copy(V)}for(let L=0;L<=o;L++){const z=r+L*G*u,K=Math.sin(z),P=Math.cos(z);for(let $=0;$<=t.length-1;$++){B.x=t[$].x*K,B.y=t[$].y,B.z=t[$].x*P,C.push(B.x,B.y,B.z),Z.x=L/o,Z.y=$/(t.length-1),I.push(Z.x,Z.y);const ie=f[3*$+0]*K,ne=f[3*$+1],ee=f[3*$+0]*P;A.push(ie,ne,ee)}}for(let L=0;L<o;L++)for(let z=0;z<t.length-1;z++){const K=z+L*t.length,P=K,$=K+t.length,ie=K+t.length+1,ne=K+1;d.push(P,$,ne),d.push(ie,ne,$)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(C,3)),this.setAttribute("uv",new Float32BufferAttribute(I,2)),this.setAttribute("normal",new Float32BufferAttribute(A,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new LatheGeometry(t.points,t.segments,t.phiStart,t.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(t=1,o=1,r=4,u=8){const d=new Path;d.absarc(0,-o/2,t,Math.PI*1.5,0),d.absarc(0,o/2,t,0,Math.PI*.5),super(d.getPoints(r),u),this.type="CapsuleGeometry",this.parameters={radius:t,length:o,capSegments:r,radialSegments:u}}static fromJSON(t){return new CapsuleGeometry(t.radius,t.length,t.capSegments,t.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(t=1,o=32,r=0,u=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:o,thetaStart:r,thetaLength:u},o=Math.max(3,o);const d=[],C=[],I=[],f=[],A=new Vector3,G=new Vector2;C.push(0,0,0),I.push(0,0,1),f.push(.5,.5);for(let B=0,Z=3;B<=o;B++,Z+=3){const w=r+B/o*u;A.x=t*Math.cos(w),A.y=t*Math.sin(w),C.push(A.x,A.y,A.z),I.push(0,0,1),G.x=(C[Z]/t+1)/2,G.y=(C[Z+1]/t+1)/2,f.push(G.x,G.y)}for(let B=1;B<=o;B++)d.push(B,B+1,0);this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(C,3)),this.setAttribute("normal",new Float32BufferAttribute(I,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CircleGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(t=1,o=1,r=1,u=32,d=1,C=!1,I=0,f=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:o,height:r,radialSegments:u,heightSegments:d,openEnded:C,thetaStart:I,thetaLength:f};const A=this;u=Math.floor(u),d=Math.floor(d);const G=[],B=[],Z=[],w=[];let V=0;const Y=[],J=r/2;let T=0;L(),C===!1&&(t>0&&z(!0),o>0&&z(!1)),this.setIndex(G),this.setAttribute("position",new Float32BufferAttribute(B,3)),this.setAttribute("normal",new Float32BufferAttribute(Z,3)),this.setAttribute("uv",new Float32BufferAttribute(w,2));function L(){const K=new Vector3,P=new Vector3;let $=0;const ie=(o-t)/r;for(let ne=0;ne<=d;ne++){const ee=[],se=ne/d,re=se*(o-t)+t;for(let ce=0;ce<=u;ce++){const ue=ce/u,ye=ue*f+I,Se=Math.sin(ye),Ce=Math.cos(ye);P.x=re*Se,P.y=-se*r+J,P.z=re*Ce,B.push(P.x,P.y,P.z),K.set(Se,ie,Ce).normalize(),Z.push(K.x,K.y,K.z),w.push(ue,1-se),ee.push(V++)}Y.push(ee)}for(let ne=0;ne<u;ne++)for(let ee=0;ee<d;ee++){const se=Y[ee][ne],re=Y[ee+1][ne],ce=Y[ee+1][ne+1],ue=Y[ee][ne+1];(t>0||ee!==0)&&(G.push(se,re,ue),$+=3),(o>0||ee!==d-1)&&(G.push(re,ce,ue),$+=3)}A.addGroup(T,$,0),T+=$}function z(K){const P=V,$=new Vector2,ie=new Vector3;let ne=0;const ee=K===!0?t:o,se=K===!0?1:-1;for(let ce=1;ce<=u;ce++)B.push(0,J*se,0),Z.push(0,se,0),w.push(.5,.5),V++;const re=V;for(let ce=0;ce<=u;ce++){const ye=ce/u*f+I,Se=Math.cos(ye),Ce=Math.sin(ye);ie.x=ee*Ce,ie.y=J*se,ie.z=ee*Se,B.push(ie.x,ie.y,ie.z),Z.push(0,se,0),$.x=Se*.5+.5,$.y=Ce*.5*se+.5,w.push($.x,$.y),V++}for(let ce=0;ce<u;ce++){const ue=P+ce,ye=re+ce;K===!0?G.push(ye,ye+1,ue):G.push(ye+1,ye,ue),ne+=3}A.addGroup(T,ne,K===!0?1:2),T+=ne}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(t=1,o=1,r=32,u=1,d=!1,C=0,I=Math.PI*2){super(0,t,o,r,u,d,C,I),this.type="ConeGeometry",this.parameters={radius:t,height:o,radialSegments:r,heightSegments:u,openEnded:d,thetaStart:C,thetaLength:I}}static fromJSON(t){return new ConeGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(t=[],o=[],r=1,u=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:o,radius:r,detail:u};const d=[],C=[];I(u),A(r),G(),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(d.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(C,2)),u===0?this.computeVertexNormals():this.normalizeNormals();function I(L){const z=new Vector3,K=new Vector3,P=new Vector3;for(let $=0;$<o.length;$+=3)w(o[$+0],z),w(o[$+1],K),w(o[$+2],P),f(z,K,P,L)}function f(L,z,K,P){const $=P+1,ie=[];for(let ne=0;ne<=$;ne++){ie[ne]=[];const ee=L.clone().lerp(K,ne/$),se=z.clone().lerp(K,ne/$),re=$-ne;for(let ce=0;ce<=re;ce++)ce===0&&ne===$?ie[ne][ce]=ee:ie[ne][ce]=ee.clone().lerp(se,ce/re)}for(let ne=0;ne<$;ne++)for(let ee=0;ee<2*($-ne)-1;ee++){const se=Math.floor(ee/2);ee%2===0?(Z(ie[ne][se+1]),Z(ie[ne+1][se]),Z(ie[ne][se])):(Z(ie[ne][se+1]),Z(ie[ne+1][se+1]),Z(ie[ne+1][se]))}}function A(L){const z=new Vector3;for(let K=0;K<d.length;K+=3)z.x=d[K+0],z.y=d[K+1],z.z=d[K+2],z.normalize().multiplyScalar(L),d[K+0]=z.x,d[K+1]=z.y,d[K+2]=z.z}function G(){const L=new Vector3;for(let z=0;z<d.length;z+=3){L.x=d[z+0],L.y=d[z+1],L.z=d[z+2];const K=J(L)/2/Math.PI+.5,P=T(L)/Math.PI+.5;C.push(K,1-P)}V(),B()}function B(){for(let L=0;L<C.length;L+=6){const z=C[L+0],K=C[L+2],P=C[L+4],$=Math.max(z,K,P),ie=Math.min(z,K,P);$>.9&&ie<.1&&(z<.2&&(C[L+0]+=1),K<.2&&(C[L+2]+=1),P<.2&&(C[L+4]+=1))}}function Z(L){d.push(L.x,L.y,L.z)}function w(L,z){const K=L*3;z.x=t[K+0],z.y=t[K+1],z.z=t[K+2]}function V(){const L=new Vector3,z=new Vector3,K=new Vector3,P=new Vector3,$=new Vector2,ie=new Vector2,ne=new Vector2;for(let ee=0,se=0;ee<d.length;ee+=9,se+=6){L.set(d[ee+0],d[ee+1],d[ee+2]),z.set(d[ee+3],d[ee+4],d[ee+5]),K.set(d[ee+6],d[ee+7],d[ee+8]),$.set(C[se+0],C[se+1]),ie.set(C[se+2],C[se+3]),ne.set(C[se+4],C[se+5]),P.copy(L).add(z).add(K).divideScalar(3);const re=J(P);Y($,se+0,L,re),Y(ie,se+2,z,re),Y(ne,se+4,K,re)}}function Y(L,z,K,P){P<0&&L.x===1&&(C[z]=L.x-1),K.x===0&&K.z===0&&(C[z]=P/2/Math.PI+.5)}function J(L){return Math.atan2(L.z,-L.x)}function T(L){return Math.atan2(-L.y,Math.sqrt(L.x*L.x+L.z*L.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PolyhedronGeometry(t.vertices,t.indices,t.radius,t.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const r=(1+Math.sqrt(5))/2,u=1/r,d=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-u,-r,0,-u,r,0,u,-r,0,u,r,-u,-r,0,-u,r,0,u,-r,0,u,r,0,-r,0,-u,r,0,-u,-r,0,u,r,0,u],C=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(d,C,t,o),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new DodecahedronGeometry(t.radius,t.detail)}}const _v0$3=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t=null,o=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:o},t!==null){const u=Math.pow(10,4),d=Math.cos(DEG2RAD*o),C=t.getIndex(),I=t.getAttribute("position"),f=C?C.count:I.count,A=[0,0,0],G=["a","b","c"],B=new Array(3),Z={},w=[];for(let V=0;V<f;V+=3){C?(A[0]=C.getX(V),A[1]=C.getX(V+1),A[2]=C.getX(V+2)):(A[0]=V,A[1]=V+1,A[2]=V+2);const{a:Y,b:J,c:T}=_triangle;if(Y.fromBufferAttribute(I,A[0]),J.fromBufferAttribute(I,A[1]),T.fromBufferAttribute(I,A[2]),_triangle.getNormal(_normal),B[0]=`${Math.round(Y.x*u)},${Math.round(Y.y*u)},${Math.round(Y.z*u)}`,B[1]=`${Math.round(J.x*u)},${Math.round(J.y*u)},${Math.round(J.z*u)}`,B[2]=`${Math.round(T.x*u)},${Math.round(T.y*u)},${Math.round(T.z*u)}`,!(B[0]===B[1]||B[1]===B[2]||B[2]===B[0]))for(let L=0;L<3;L++){const z=(L+1)%3,K=B[L],P=B[z],$=_triangle[G[L]],ie=_triangle[G[z]],ne=`${K}_${P}`,ee=`${P}_${K}`;ee in Z&&Z[ee]?(_normal.dot(Z[ee].normal)<=d&&(w.push($.x,$.y,$.z),w.push(ie.x,ie.y,ie.z)),Z[ee]=null):ne in Z||(Z[ne]={index0:A[L],index1:A[z],normal:_normal.clone()})}}for(const V in Z)if(Z[V]){const{index0:Y,index1:J}=Z[V];_v0$3.fromBufferAttribute(I,Y),_v1$1.fromBufferAttribute(I,J),w.push(_v0$3.x,_v0$3.y,_v0$3.z),w.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(w,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}let Shape$2=class extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const o=[];for(let r=0,u=this.holes.length;r<u;r++)o[r]=this.holes[r].getPoints(t);return o}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let o=0,r=t.holes.length;o<r;o++){const u=t.holes[o];this.holes.push(u.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let o=0,r=this.holes.length;o<r;o++){const u=this.holes[o];t.holes.push(u.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let o=0,r=t.holes.length;o<r;o++){const u=t.holes[o];this.holes.push(new Path().fromJSON(u))}return this}};class Earcut{static triangulate(t,o,r=2){const u=o&&o.length,d=u?o[0]*r:t.length;let C=linkedList(t,0,d,r,!0);const I=[];if(!C||C.next===C.prev)return I;let f,A,G,B,Z,w,V;if(u&&(C=eliminateHoles(t,o,C,r)),t.length>80*r){f=G=t[0],A=B=t[1];for(let Y=r;Y<d;Y+=r)Z=t[Y],w=t[Y+1],Z<f&&(f=Z),w<A&&(A=w),Z>G&&(G=Z),w>B&&(B=w);V=Math.max(G-f,B-A),V=V!==0?32767/V:0}return earcutLinked(C,I,r,f,A,V,0),I}}function linkedList(n,t,o,r,u){let d,C;if(u===signedArea(n,t,o,r)>0)for(d=t;d<o;d+=r)C=insertNode(d,n[d],n[d+1],C);else for(d=o-r;d>=t;d-=r)C=insertNode(d,n[d],n[d+1],C);return C&&equals(C,C.next)&&(removeNode(C),C=C.next),C}function filterPoints(n,t){if(!n)return n;t||(t=n);let o=n,r;do if(r=!1,!o.steiner&&(equals(o,o.next)||area(o.prev,o,o.next)===0)){if(removeNode(o),o=t=o.prev,o===o.next)break;r=!0}else o=o.next;while(r||o!==t);return t}function earcutLinked(n,t,o,r,u,d,C){if(!n)return;!C&&d&&indexCurve(n,r,u,d);let I=n,f,A;for(;n.prev!==n.next;){if(f=n.prev,A=n.next,d?isEarHashed(n,r,u,d):isEar(n)){t.push(f.i/o|0),t.push(n.i/o|0),t.push(A.i/o|0),removeNode(n),n=A.next,I=A.next;continue}if(n=A,n===I){C?C===1?(n=cureLocalIntersections(filterPoints(n),t,o),earcutLinked(n,t,o,r,u,d,2)):C===2&&splitEarcut(n,t,o,r,u,d):earcutLinked(filterPoints(n),t,o,r,u,d,1);break}}}function isEar(n){const t=n.prev,o=n,r=n.next;if(area(t,o,r)>=0)return!1;const u=t.x,d=o.x,C=r.x,I=t.y,f=o.y,A=r.y,G=u<d?u<C?u:C:d<C?d:C,B=I<f?I<A?I:A:f<A?f:A,Z=u>d?u>C?u:C:d>C?d:C,w=I>f?I>A?I:A:f>A?f:A;let V=r.next;for(;V!==t;){if(V.x>=G&&V.x<=Z&&V.y>=B&&V.y<=w&&pointInTriangle(u,I,d,f,C,A,V.x,V.y)&&area(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function isEarHashed(n,t,o,r){const u=n.prev,d=n,C=n.next;if(area(u,d,C)>=0)return!1;const I=u.x,f=d.x,A=C.x,G=u.y,B=d.y,Z=C.y,w=I<f?I<A?I:A:f<A?f:A,V=G<B?G<Z?G:Z:B<Z?B:Z,Y=I>f?I>A?I:A:f>A?f:A,J=G>B?G>Z?G:Z:B>Z?B:Z,T=zOrder(w,V,t,o,r),L=zOrder(Y,J,t,o,r);let z=n.prevZ,K=n.nextZ;for(;z&&z.z>=T&&K&&K.z<=L;){if(z.x>=w&&z.x<=Y&&z.y>=V&&z.y<=J&&z!==u&&z!==C&&pointInTriangle(I,G,f,B,A,Z,z.x,z.y)&&area(z.prev,z,z.next)>=0||(z=z.prevZ,K.x>=w&&K.x<=Y&&K.y>=V&&K.y<=J&&K!==u&&K!==C&&pointInTriangle(I,G,f,B,A,Z,K.x,K.y)&&area(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;z&&z.z>=T;){if(z.x>=w&&z.x<=Y&&z.y>=V&&z.y<=J&&z!==u&&z!==C&&pointInTriangle(I,G,f,B,A,Z,z.x,z.y)&&area(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;K&&K.z<=L;){if(K.x>=w&&K.x<=Y&&K.y>=V&&K.y<=J&&K!==u&&K!==C&&pointInTriangle(I,G,f,B,A,Z,K.x,K.y)&&area(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function cureLocalIntersections(n,t,o){let r=n;do{const u=r.prev,d=r.next.next;!equals(u,d)&&intersects(u,r,r.next,d)&&locallyInside(u,d)&&locallyInside(d,u)&&(t.push(u.i/o|0),t.push(r.i/o|0),t.push(d.i/o|0),removeNode(r),removeNode(r.next),r=n=d),r=r.next}while(r!==n);return filterPoints(r)}function splitEarcut(n,t,o,r,u,d){let C=n;do{let I=C.next.next;for(;I!==C.prev;){if(C.i!==I.i&&isValidDiagonal(C,I)){let f=splitPolygon(C,I);C=filterPoints(C,C.next),f=filterPoints(f,f.next),earcutLinked(C,t,o,r,u,d,0),earcutLinked(f,t,o,r,u,d,0);return}I=I.next}C=C.next}while(C!==n)}function eliminateHoles(n,t,o,r){const u=[];let d,C,I,f,A;for(d=0,C=t.length;d<C;d++)I=t[d]*r,f=d<C-1?t[d+1]*r:n.length,A=linkedList(n,I,f,r,!1),A===A.next&&(A.steiner=!0),u.push(getLeftmost(A));for(u.sort(compareX),d=0;d<u.length;d++)o=eliminateHole(u[d],o);return o}function compareX(n,t){return n.x-t.x}function eliminateHole(n,t){const o=findHoleBridge(n,t);if(!o)return t;const r=splitPolygon(o,n);return filterPoints(r,r.next),filterPoints(o,o.next)}function findHoleBridge(n,t){let o=t,r=-1/0,u;const d=n.x,C=n.y;do{if(C<=o.y&&C>=o.next.y&&o.next.y!==o.y){const Z=o.x+(C-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(Z<=d&&Z>r&&(r=Z,u=o.x<o.next.x?o:o.next,Z===d))return u}o=o.next}while(o!==t);if(!u)return null;const I=u,f=u.x,A=u.y;let G=1/0,B;o=u;do d>=o.x&&o.x>=f&&d!==o.x&&pointInTriangle(C<A?d:r,C,f,A,C<A?r:d,C,o.x,o.y)&&(B=Math.abs(C-o.y)/(d-o.x),locallyInside(o,n)&&(B<G||B===G&&(o.x>u.x||o.x===u.x&&sectorContainsSector(u,o)))&&(u=o,G=B)),o=o.next;while(o!==I);return u}function sectorContainsSector(n,t){return area(n.prev,n,t.prev)<0&&area(t.next,n,n.next)<0}function indexCurve(n,t,o,r){let u=n;do u.z===0&&(u.z=zOrder(u.x,u.y,t,o,r)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next;while(u!==n);u.prevZ.nextZ=null,u.prevZ=null,sortLinked(u)}function sortLinked(n){let t,o,r,u,d,C,I,f,A=1;do{for(o=n,n=null,d=null,C=0;o;){for(C++,r=o,I=0,t=0;t<A&&(I++,r=r.nextZ,!!r);t++);for(f=A;I>0||f>0&&r;)I!==0&&(f===0||!r||o.z<=r.z)?(u=o,o=o.nextZ,I--):(u=r,r=r.nextZ,f--),d?d.nextZ=u:n=u,u.prevZ=d,d=u;o=r}d.nextZ=null,A*=2}while(C>1);return n}function zOrder(n,t,o,r,u){return n=(n-o)*u|0,t=(t-r)*u|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function getLeftmost(n){let t=n,o=n;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==n);return o}function pointInTriangle(n,t,o,r,u,d,C,I){return(u-C)*(t-I)>=(n-C)*(d-I)&&(n-C)*(r-I)>=(o-C)*(t-I)&&(o-C)*(d-I)>=(u-C)*(r-I)}function isValidDiagonal(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!intersectsPolygon(n,t)&&(locallyInside(n,t)&&locallyInside(t,n)&&middleInside(n,t)&&(area(n.prev,n,t.prev)||area(n,t.prev,t))||equals(n,t)&&area(n.prev,n,n.next)>0&&area(t.prev,t,t.next)>0)}function area(n,t,o){return(t.y-n.y)*(o.x-t.x)-(t.x-n.x)*(o.y-t.y)}function equals(n,t){return n.x===t.x&&n.y===t.y}function intersects(n,t,o,r){const u=sign(area(n,t,o)),d=sign(area(n,t,r)),C=sign(area(o,r,n)),I=sign(area(o,r,t));return!!(u!==d&&C!==I||u===0&&onSegment(n,o,t)||d===0&&onSegment(n,r,t)||C===0&&onSegment(o,n,r)||I===0&&onSegment(o,t,r))}function onSegment(n,t,o){return t.x<=Math.max(n.x,o.x)&&t.x>=Math.min(n.x,o.x)&&t.y<=Math.max(n.y,o.y)&&t.y>=Math.min(n.y,o.y)}function sign(n){return n>0?1:n<0?-1:0}function intersectsPolygon(n,t){let o=n;do{if(o.i!==n.i&&o.next.i!==n.i&&o.i!==t.i&&o.next.i!==t.i&&intersects(o,o.next,n,t))return!0;o=o.next}while(o!==n);return!1}function locallyInside(n,t){return area(n.prev,n,n.next)<0?area(n,t,n.next)>=0&&area(n,n.prev,t)>=0:area(n,t,n.prev)<0||area(n,n.next,t)<0}function middleInside(n,t){let o=n,r=!1;const u=(n.x+t.x)/2,d=(n.y+t.y)/2;do o.y>d!=o.next.y>d&&o.next.y!==o.y&&u<(o.next.x-o.x)*(d-o.y)/(o.next.y-o.y)+o.x&&(r=!r),o=o.next;while(o!==n);return r}function splitPolygon(n,t){const o=new Node(n.i,n.x,n.y),r=new Node(t.i,t.x,t.y),u=n.next,d=t.prev;return n.next=t,t.prev=n,o.next=u,u.prev=o,r.next=o,o.prev=r,d.next=r,r.prev=d,r}function insertNode(n,t,o,r){const u=new Node(n,t,o);return r?(u.next=r.next,u.prev=r,r.next.prev=u,r.next=u):(u.prev=u,u.next=u),u}function removeNode(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Node(n,t,o){this.i=n,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(n,t,o,r){let u=0;for(let d=t,C=o-r;d<o;d+=r)u+=(n[C]-n[d])*(n[d+1]+n[C+1]),C=d;return u}class ShapeUtils{static area(t){const o=t.length;let r=0;for(let u=o-1,d=0;d<o;u=d++)r+=t[u].x*t[d].y-t[d].x*t[u].y;return r*.5}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,o){const r=[],u=[],d=[];removeDupEndPts(t),addContour(r,t);let C=t.length;o.forEach(removeDupEndPts);for(let f=0;f<o.length;f++)u.push(C),C+=o[f].length,addContour(r,o[f]);const I=Earcut.triangulate(r,u);for(let f=0;f<I.length;f+=3)d.push(I.slice(f,f+3));return d}}function removeDupEndPts(n){const t=n.length;t>2&&n[t-1].equals(n[0])&&n.pop()}function addContour(n,t){for(let o=0;o<t.length;o++)n.push(t[o].x),n.push(t[o].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t=new Shape$2([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),o={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:o},t=Array.isArray(t)?t:[t];const r=this,u=[],d=[];for(let I=0,f=t.length;I<f;I++){const A=t[I];C(A)}this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2)),this.computeVertexNormals();function C(I){const f=[],A=o.curveSegments!==void 0?o.curveSegments:12,G=o.steps!==void 0?o.steps:1,B=o.depth!==void 0?o.depth:1;let Z=o.bevelEnabled!==void 0?o.bevelEnabled:!0,w=o.bevelThickness!==void 0?o.bevelThickness:.2,V=o.bevelSize!==void 0?o.bevelSize:w-.1,Y=o.bevelOffset!==void 0?o.bevelOffset:0,J=o.bevelSegments!==void 0?o.bevelSegments:3;const T=o.extrudePath,L=o.UVGenerator!==void 0?o.UVGenerator:WorldUVGenerator;let z,K=!1,P,$,ie,ne;T&&(z=T.getSpacedPoints(G),K=!0,Z=!1,P=T.computeFrenetFrames(G,!1),$=new Vector3,ie=new Vector3,ne=new Vector3),Z||(J=0,w=0,V=0,Y=0);const ee=I.extractPoints(A);let se=ee.shape;const re=ee.holes;if(!ShapeUtils.isClockWise(se)){se=se.reverse();for(let Qe=0,Oe=re.length;Qe<Oe;Qe++){const be=re[Qe];ShapeUtils.isClockWise(be)&&(re[Qe]=be.reverse())}}const ue=ShapeUtils.triangulateShape(se,re),ye=se;for(let Qe=0,Oe=re.length;Qe<Oe;Qe++){const be=re[Qe];se=se.concat(be)}function Se(Qe,Oe,be){return Oe||console.error("THREE.ExtrudeGeometry: vec does not exist"),Qe.clone().addScaledVector(Oe,be)}const Ce=se.length,Ze=ue.length;function Be(Qe,Oe,be){let yt,st,Gt;const rt=Qe.x-Oe.x,Yt=Qe.y-Oe.y,Xt=be.x-Qe.x,Ge=be.y-Qe.y,he=rt*rt+Yt*Yt,ke=rt*Ge-Yt*Xt;if(Math.abs(ke)>Number.EPSILON){const it=Math.sqrt(he),ht=Math.sqrt(Xt*Xt+Ge*Ge),He=Oe.x-Yt/it,ot=Oe.y+rt/it,Zt=be.x-Ge/ht,wt=be.y+Xt/ht,Et=((Zt-He)*Ge-(wt-ot)*Xt)/(rt*Ge-Yt*Xt);yt=He+rt*Et-Qe.x,st=ot+Yt*Et-Qe.y;const De=yt*yt+st*st;if(De<=2)return new Vector2(yt,st);Gt=Math.sqrt(De/2)}else{let it=!1;rt>Number.EPSILON?Xt>Number.EPSILON&&(it=!0):rt<-Number.EPSILON?Xt<-Number.EPSILON&&(it=!0):Math.sign(Yt)===Math.sign(Ge)&&(it=!0),it?(yt=-Yt,st=rt,Gt=Math.sqrt(he)):(yt=rt,st=Yt,Gt=Math.sqrt(he/2))}return new Vector2(yt/Gt,st/Gt)}const xe=[];for(let Qe=0,Oe=ye.length,be=Oe-1,yt=Qe+1;Qe<Oe;Qe++,be++,yt++)be===Oe&&(be=0),yt===Oe&&(yt=0),xe[Qe]=Be(ye[Qe],ye[be],ye[yt]);const ge=[];let de,ve=xe.concat();for(let Qe=0,Oe=re.length;Qe<Oe;Qe++){const be=re[Qe];de=[];for(let yt=0,st=be.length,Gt=st-1,rt=yt+1;yt<st;yt++,Gt++,rt++)Gt===st&&(Gt=0),rt===st&&(rt=0),de[yt]=Be(be[yt],be[Gt],be[rt]);ge.push(de),ve=ve.concat(de)}for(let Qe=0;Qe<J;Qe++){const Oe=Qe/J,be=w*Math.cos(Oe*Math.PI/2),yt=V*Math.sin(Oe*Math.PI/2)+Y;for(let st=0,Gt=ye.length;st<Gt;st++){const rt=Se(ye[st],xe[st],yt);Ne(rt.x,rt.y,-be)}for(let st=0,Gt=re.length;st<Gt;st++){const rt=re[st];de=ge[st];for(let Yt=0,Xt=rt.length;Yt<Xt;Yt++){const Ge=Se(rt[Yt],de[Yt],yt);Ne(Ge.x,Ge.y,-be)}}}const le=V+Y;for(let Qe=0;Qe<Ce;Qe++){const Oe=Z?Se(se[Qe],ve[Qe],le):se[Qe];K?(ie.copy(P.normals[0]).multiplyScalar(Oe.x),$.copy(P.binormals[0]).multiplyScalar(Oe.y),ne.copy(z[0]).add(ie).add($),Ne(ne.x,ne.y,ne.z)):Ne(Oe.x,Oe.y,0)}for(let Qe=1;Qe<=G;Qe++)for(let Oe=0;Oe<Ce;Oe++){const be=Z?Se(se[Oe],ve[Oe],le):se[Oe];K?(ie.copy(P.normals[Qe]).multiplyScalar(be.x),$.copy(P.binormals[Qe]).multiplyScalar(be.y),ne.copy(z[Qe]).add(ie).add($),Ne(ne.x,ne.y,ne.z)):Ne(be.x,be.y,B/G*Qe)}for(let Qe=J-1;Qe>=0;Qe--){const Oe=Qe/J,be=w*Math.cos(Oe*Math.PI/2),yt=V*Math.sin(Oe*Math.PI/2)+Y;for(let st=0,Gt=ye.length;st<Gt;st++){const rt=Se(ye[st],xe[st],yt);Ne(rt.x,rt.y,B+be)}for(let st=0,Gt=re.length;st<Gt;st++){const rt=re[st];de=ge[st];for(let Yt=0,Xt=rt.length;Yt<Xt;Yt++){const Ge=Se(rt[Yt],de[Yt],yt);K?Ne(Ge.x,Ge.y+z[G-1].y,z[G-1].x+be):Ne(Ge.x,Ge.y,B+be)}}}Ae(),Xe();function Ae(){const Qe=u.length/3;if(Z){let Oe=0,be=Ce*Oe;for(let yt=0;yt<Ze;yt++){const st=ue[yt];We(st[2]+be,st[1]+be,st[0]+be)}Oe=G+J*2,be=Ce*Oe;for(let yt=0;yt<Ze;yt++){const st=ue[yt];We(st[0]+be,st[1]+be,st[2]+be)}}else{for(let Oe=0;Oe<Ze;Oe++){const be=ue[Oe];We(be[2],be[1],be[0])}for(let Oe=0;Oe<Ze;Oe++){const be=ue[Oe];We(be[0]+Ce*G,be[1]+Ce*G,be[2]+Ce*G)}}r.addGroup(Qe,u.length/3-Qe,0)}function Xe(){const Qe=u.length/3;let Oe=0;Te(ye,Oe),Oe+=ye.length;for(let be=0,yt=re.length;be<yt;be++){const st=re[be];Te(st,Oe),Oe+=st.length}r.addGroup(Qe,u.length/3-Qe,1)}function Te(Qe,Oe){let be=Qe.length;for(;--be>=0;){const yt=be;let st=be-1;st<0&&(st=Qe.length-1);for(let Gt=0,rt=G+J*2;Gt<rt;Gt++){const Yt=Ce*Gt,Xt=Ce*(Gt+1),Ge=Oe+yt+Yt,he=Oe+st+Yt,ke=Oe+st+Xt,it=Oe+yt+Xt;dt(Ge,he,ke,it)}}}function Ne(Qe,Oe,be){f.push(Qe),f.push(Oe),f.push(be)}function We(Qe,Oe,be){nt(Qe),nt(Oe),nt(be);const yt=u.length/3,st=L.generateTopUV(r,u,yt-3,yt-2,yt-1);Rt(st[0]),Rt(st[1]),Rt(st[2])}function dt(Qe,Oe,be,yt){nt(Qe),nt(Oe),nt(yt),nt(Oe),nt(be),nt(yt);const st=u.length/3,Gt=L.generateSideWallUV(r,u,st-6,st-3,st-2,st-1);Rt(Gt[0]),Rt(Gt[1]),Rt(Gt[3]),Rt(Gt[1]),Rt(Gt[2]),Rt(Gt[3])}function nt(Qe){u.push(f[Qe*3+0]),u.push(f[Qe*3+1]),u.push(f[Qe*3+2])}function Rt(Qe){d.push(Qe.x),d.push(Qe.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),o=this.parameters.shapes,r=this.parameters.options;return toJSON$1(o,r,t)}static fromJSON(t,o){const r=[];for(let d=0,C=t.shapes.length;d<C;d++){const I=o[t.shapes[d]];r.push(I)}const u=t.options.extrudePath;return u!==void 0&&(t.options.extrudePath=new Curves[u.type]().fromJSON(u)),new ExtrudeGeometry(r,t.options)}}const WorldUVGenerator={generateTopUV:function(n,t,o,r,u){const d=t[o*3],C=t[o*3+1],I=t[r*3],f=t[r*3+1],A=t[u*3],G=t[u*3+1];return[new Vector2(d,C),new Vector2(I,f),new Vector2(A,G)]},generateSideWallUV:function(n,t,o,r,u,d){const C=t[o*3],I=t[o*3+1],f=t[o*3+2],A=t[r*3],G=t[r*3+1],B=t[r*3+2],Z=t[u*3],w=t[u*3+1],V=t[u*3+2],Y=t[d*3],J=t[d*3+1],T=t[d*3+2];return Math.abs(I-G)<Math.abs(C-A)?[new Vector2(C,1-f),new Vector2(A,1-B),new Vector2(Z,1-V),new Vector2(Y,1-T)]:[new Vector2(I,1-f),new Vector2(G,1-B),new Vector2(w,1-V),new Vector2(J,1-T)]}};function toJSON$1(n,t,o){if(o.shapes=[],Array.isArray(n))for(let r=0,u=n.length;r<u;r++){const d=n[r];o.shapes.push(d.uuid)}else o.shapes.push(n.uuid);return o.options=Object.assign({},t),t.extrudePath!==void 0&&(o.options.extrudePath=t.extrudePath.toJSON()),o}class IcosahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const r=(1+Math.sqrt(5))/2,u=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],d=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(u,d,t,o),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new IcosahedronGeometry(t.radius,t.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],u=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,u,t,o),this.type="OctahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new OctahedronGeometry(t.radius,t.detail)}}class PlaneGeometry extends BufferGeometry{constructor(t=1,o=1,r=1,u=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:o,widthSegments:r,heightSegments:u};const d=t/2,C=o/2,I=Math.floor(r),f=Math.floor(u),A=I+1,G=f+1,B=t/I,Z=o/f,w=[],V=[],Y=[],J=[];for(let T=0;T<G;T++){const L=T*Z-C;for(let z=0;z<A;z++){const K=z*B-d;V.push(K,-L,0),Y.push(0,0,1),J.push(z/I),J.push(1-T/f)}}for(let T=0;T<f;T++)for(let L=0;L<I;L++){const z=L+A*T,K=L+A*(T+1),P=L+1+A*(T+1),$=L+1+A*T;w.push(z,K,$),w.push(K,P,$)}this.setIndex(w),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(Y,3)),this.setAttribute("uv",new Float32BufferAttribute(J,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(t=.5,o=1,r=32,u=1,d=0,C=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:o,thetaSegments:r,phiSegments:u,thetaStart:d,thetaLength:C},r=Math.max(3,r),u=Math.max(1,u);const I=[],f=[],A=[],G=[];let B=t;const Z=(o-t)/u,w=new Vector3,V=new Vector2;for(let Y=0;Y<=u;Y++){for(let J=0;J<=r;J++){const T=d+J/r*C;w.x=B*Math.cos(T),w.y=B*Math.sin(T),f.push(w.x,w.y,w.z),A.push(0,0,1),V.x=(w.x/o+1)/2,V.y=(w.y/o+1)/2,G.push(V.x,V.y)}B+=Z}for(let Y=0;Y<u;Y++){const J=Y*(r+1);for(let T=0;T<r;T++){const L=T+J,z=L,K=L+r+1,P=L+r+2,$=L+1;I.push(z,K,$),I.push(K,P,$)}}this.setIndex(I),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(A,3)),this.setAttribute("uv",new Float32BufferAttribute(G,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new RingGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape$2([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),o=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:o};const r=[],u=[],d=[],C=[];let I=0,f=0;if(Array.isArray(t)===!1)A(t);else for(let G=0;G<t.length;G++)A(t[G]),this.addGroup(I,f,G),I+=f,f=0;this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(C,2));function A(G){const B=u.length/3,Z=G.extractPoints(o);let w=Z.shape;const V=Z.holes;ShapeUtils.isClockWise(w)===!1&&(w=w.reverse());for(let J=0,T=V.length;J<T;J++){const L=V[J];ShapeUtils.isClockWise(L)===!0&&(V[J]=L.reverse())}const Y=ShapeUtils.triangulateShape(w,V);for(let J=0,T=V.length;J<T;J++){const L=V[J];w=w.concat(L)}for(let J=0,T=w.length;J<T;J++){const L=w[J];u.push(L.x,L.y,0),d.push(0,0,1),C.push(L.x,L.y)}for(let J=0,T=Y.length;J<T;J++){const L=Y[J],z=L[0]+B,K=L[1]+B,P=L[2]+B;r.push(z,K,P),f+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),o=this.parameters.shapes;return toJSON(o,t)}static fromJSON(t,o){const r=[];for(let u=0,d=t.shapes.length;u<d;u++){const C=o[t.shapes[u]];r.push(C)}return new ShapeGeometry(r,t.curveSegments)}}function toJSON(n,t){if(t.shapes=[],Array.isArray(n))for(let o=0,r=n.length;o<r;o++){const u=n[o];t.shapes.push(u.uuid)}else t.shapes.push(n.uuid);return t}class SphereGeometry extends BufferGeometry{constructor(t=1,o=32,r=16,u=0,d=Math.PI*2,C=0,I=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:o,heightSegments:r,phiStart:u,phiLength:d,thetaStart:C,thetaLength:I},o=Math.max(3,Math.floor(o)),r=Math.max(2,Math.floor(r));const f=Math.min(C+I,Math.PI);let A=0;const G=[],B=new Vector3,Z=new Vector3,w=[],V=[],Y=[],J=[];for(let T=0;T<=r;T++){const L=[],z=T/r;let K=0;T===0&&C===0?K=.5/o:T===r&&f===Math.PI&&(K=-.5/o);for(let P=0;P<=o;P++){const $=P/o;B.x=-t*Math.cos(u+$*d)*Math.sin(C+z*I),B.y=t*Math.cos(C+z*I),B.z=t*Math.sin(u+$*d)*Math.sin(C+z*I),V.push(B.x,B.y,B.z),Z.copy(B).normalize(),Y.push(Z.x,Z.y,Z.z),J.push($+K,1-z),L.push(A++)}G.push(L)}for(let T=0;T<r;T++)for(let L=0;L<o;L++){const z=G[T][L+1],K=G[T][L],P=G[T+1][L],$=G[T+1][L+1];(T!==0||C>0)&&w.push(z,K,$),(T!==r-1||f<Math.PI)&&w.push(K,P,$)}this.setIndex(w),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(Y,3)),this.setAttribute("uv",new Float32BufferAttribute(J,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],u=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,u,t,o),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new TetrahedronGeometry(t.radius,t.detail)}}class TorusGeometry extends BufferGeometry{constructor(t=1,o=.4,r=12,u=48,d=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:o,radialSegments:r,tubularSegments:u,arc:d},r=Math.floor(r),u=Math.floor(u);const C=[],I=[],f=[],A=[],G=new Vector3,B=new Vector3,Z=new Vector3;for(let w=0;w<=r;w++)for(let V=0;V<=u;V++){const Y=V/u*d,J=w/r*Math.PI*2;B.x=(t+o*Math.cos(J))*Math.cos(Y),B.y=(t+o*Math.cos(J))*Math.sin(Y),B.z=o*Math.sin(J),I.push(B.x,B.y,B.z),G.x=t*Math.cos(Y),G.y=t*Math.sin(Y),Z.subVectors(B,G).normalize(),f.push(Z.x,Z.y,Z.z),A.push(V/u),A.push(w/r)}for(let w=1;w<=r;w++)for(let V=1;V<=u;V++){const Y=(u+1)*w+V-1,J=(u+1)*(w-1)+V-1,T=(u+1)*(w-1)+V,L=(u+1)*w+V;C.push(Y,J,L),C.push(J,T,L)}this.setIndex(C),this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(A,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(t=1,o=.4,r=64,u=8,d=2,C=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:o,tubularSegments:r,radialSegments:u,p:d,q:C},r=Math.floor(r),u=Math.floor(u);const I=[],f=[],A=[],G=[],B=new Vector3,Z=new Vector3,w=new Vector3,V=new Vector3,Y=new Vector3,J=new Vector3,T=new Vector3;for(let z=0;z<=r;++z){const K=z/r*d*Math.PI*2;L(K,d,C,t,w),L(K+.01,d,C,t,V),J.subVectors(V,w),T.addVectors(V,w),Y.crossVectors(J,T),T.crossVectors(Y,J),Y.normalize(),T.normalize();for(let P=0;P<=u;++P){const $=P/u*Math.PI*2,ie=-o*Math.cos($),ne=o*Math.sin($);B.x=w.x+(ie*T.x+ne*Y.x),B.y=w.y+(ie*T.y+ne*Y.y),B.z=w.z+(ie*T.z+ne*Y.z),f.push(B.x,B.y,B.z),Z.subVectors(B,w).normalize(),A.push(Z.x,Z.y,Z.z),G.push(z/r),G.push(P/u)}}for(let z=1;z<=r;z++)for(let K=1;K<=u;K++){const P=(u+1)*(z-1)+(K-1),$=(u+1)*z+(K-1),ie=(u+1)*z+K,ne=(u+1)*(z-1)+K;I.push(P,$,ne),I.push($,ie,ne)}this.setIndex(I),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(A,3)),this.setAttribute("uv",new Float32BufferAttribute(G,2));function L(z,K,P,$,ie){const ne=Math.cos(z),ee=Math.sin(z),se=P/K*z,re=Math.cos(se);ie.x=$*(2+re)*.5*ne,ie.y=$*(2+re)*ee*.5,ie.z=$*Math.sin(se)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusKnotGeometry(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class TubeGeometry extends BufferGeometry{constructor(t=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),o=64,r=1,u=8,d=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:o,radius:r,radialSegments:u,closed:d};const C=t.computeFrenetFrames(o,d);this.tangents=C.tangents,this.normals=C.normals,this.binormals=C.binormals;const I=new Vector3,f=new Vector3,A=new Vector2;let G=new Vector3;const B=[],Z=[],w=[],V=[];Y(),this.setIndex(V),this.setAttribute("position",new Float32BufferAttribute(B,3)),this.setAttribute("normal",new Float32BufferAttribute(Z,3)),this.setAttribute("uv",new Float32BufferAttribute(w,2));function Y(){for(let z=0;z<o;z++)J(z);J(d===!1?o:0),L(),T()}function J(z){G=t.getPointAt(z/o,G);const K=C.normals[z],P=C.binormals[z];for(let $=0;$<=u;$++){const ie=$/u*Math.PI*2,ne=Math.sin(ie),ee=-Math.cos(ie);f.x=ee*K.x+ne*P.x,f.y=ee*K.y+ne*P.y,f.z=ee*K.z+ne*P.z,f.normalize(),Z.push(f.x,f.y,f.z),I.x=G.x+r*f.x,I.y=G.y+r*f.y,I.z=G.z+r*f.z,B.push(I.x,I.y,I.z)}}function T(){for(let z=1;z<=o;z++)for(let K=1;K<=u;K++){const P=(u+1)*(z-1)+(K-1),$=(u+1)*z+(K-1),ie=(u+1)*z+K,ne=(u+1)*(z-1)+K;V.push(P,$,ne),V.push($,ie,ne)}}function L(){for(let z=0;z<=o;z++)for(let K=0;K<=u;K++)A.x=z/o,A.y=K/u,w.push(A.x,A.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new TubeGeometry(new Curves[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class WireframeGeometry extends BufferGeometry{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const o=[],r=new Set,u=new Vector3,d=new Vector3;if(t.index!==null){const C=t.attributes.position,I=t.index;let f=t.groups;f.length===0&&(f=[{start:0,count:I.count,materialIndex:0}]);for(let A=0,G=f.length;A<G;++A){const B=f[A],Z=B.start,w=B.count;for(let V=Z,Y=Z+w;V<Y;V+=3)for(let J=0;J<3;J++){const T=I.getX(V+J),L=I.getX(V+(J+1)%3);u.fromBufferAttribute(C,T),d.fromBufferAttribute(C,L),isUniqueEdge(u,d,r)===!0&&(o.push(u.x,u.y,u.z),o.push(d.x,d.y,d.z))}}}else{const C=t.attributes.position;for(let I=0,f=C.count/3;I<f;I++)for(let A=0;A<3;A++){const G=3*I+A,B=3*I+(A+1)%3;u.fromBufferAttribute(C,G),d.fromBufferAttribute(C,B),isUniqueEdge(u,d,r)===!0&&(o.push(u.x,u.y,u.z),o.push(d.x,d.y,d.z))}}this.setAttribute("position",new Float32BufferAttribute(o,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function isUniqueEdge(n,t,o){const r=`${n.x},${n.y},${n.z}-${t.x},${t.y},${t.z}`,u=`${t.x},${t.y},${t.z}-${n.x},${n.y},${n.z}`;return o.has(r)===!0||o.has(u)===!0?!1:(o.add(r),o.add(u),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(o){this.ior=(1+.4*o)/(1-.4*o)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshToonMaterial extends Material{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class MeshNormalMaterial extends Material{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class MeshLambertMaterial extends Material{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshDepthMaterial extends Material{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function convertArray(n,t,o){return!n||!o&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function isTypedArray(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function getKeyframeOrder(n){function t(u,d){return n[u]-n[d]}const o=n.length,r=new Array(o);for(let u=0;u!==o;++u)r[u]=u;return r.sort(t),r}function sortedArray(n,t,o){const r=n.length,u=new n.constructor(r);for(let d=0,C=0;C!==r;++d){const I=o[d]*t;for(let f=0;f!==t;++f)u[C++]=n[I+f]}return u}function flattenJSON(n,t,o,r){let u=1,d=n[0];for(;d!==void 0&&d[r]===void 0;)d=n[u++];if(d===void 0)return;let C=d[r];if(C!==void 0)if(Array.isArray(C))do C=d[r],C!==void 0&&(t.push(d.time),o.push(...C)),d=n[u++];while(d!==void 0);else if(C.toArray!==void 0)do C=d[r],C!==void 0&&(t.push(d.time),C.toArray(o,o.length)),d=n[u++];while(d!==void 0);else do C=d[r],C!==void 0&&(t.push(d.time),o.push(C)),d=n[u++];while(d!==void 0)}function subclip(n,t,o,r,u=30){const d=n.clone();d.name=t;const C=[];for(let f=0;f<d.tracks.length;++f){const A=d.tracks[f],G=A.getValueSize(),B=[],Z=[];for(let w=0;w<A.times.length;++w){const V=A.times[w]*u;if(!(V<o||V>=r)){B.push(A.times[w]);for(let Y=0;Y<G;++Y)Z.push(A.values[w*G+Y])}}B.length!==0&&(A.times=convertArray(B,A.times.constructor),A.values=convertArray(Z,A.values.constructor),C.push(A))}d.tracks=C;let I=1/0;for(let f=0;f<d.tracks.length;++f)I>d.tracks[f].times[0]&&(I=d.tracks[f].times[0]);for(let f=0;f<d.tracks.length;++f)d.tracks[f].shift(-1*I);return d.resetDuration(),d}function makeClipAdditive(n,t=0,o=n,r=30){r<=0&&(r=30);const u=o.tracks.length,d=t/r;for(let C=0;C<u;++C){const I=o.tracks[C],f=I.ValueTypeName;if(f==="bool"||f==="string")continue;const A=n.tracks.find(function(T){return T.name===I.name&&T.ValueTypeName===f});if(A===void 0)continue;let G=0;const B=I.getValueSize();I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(G=B/3);let Z=0;const w=A.getValueSize();A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Z=w/3);const V=I.times.length-1;let Y;if(d<=I.times[0]){const T=G,L=B-G;Y=I.values.slice(T,L)}else if(d>=I.times[V]){const T=V*B+G,L=T+B-G;Y=I.values.slice(T,L)}else{const T=I.createInterpolant(),L=G,z=B-G;T.evaluate(d),Y=T.resultBuffer.slice(L,z)}f==="quaternion"&&new Quaternion$2().fromArray(Y).normalize().conjugate().toArray(Y);const J=A.times.length;for(let T=0;T<J;++T){const L=T*w+Z;if(f==="quaternion")Quaternion$2.multiplyQuaternionsFlat(A.values,L,Y,0,A.values,L);else{const z=w-Z*2;for(let K=0;K<z;++K)A.values[L+K]-=Y[K]}}}return n.blendMode=AdditiveAnimationBlendMode,n}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(t,o,r,u){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=u!==void 0?u:new o.constructor(r),this.sampleValues=o,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const o=this.parameterPositions;let r=this._cachedIndex,u=o[r],d=o[r-1];e:{t:{let C;i:{n:if(!(t<u)){for(let I=r+2;;){if(u===void 0){if(t<d)break n;return r=o.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===I)break;if(d=u,u=o[++r],t<u)break t}C=o.length;break i}if(!(t>=d)){const I=o[1];t<I&&(r=2,d=I);for(let f=r-2;;){if(d===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===f)break;if(u=d,d=o[--r-1],t>=d)break t}C=r,r=0;break i}break e}for(;r<C;){const I=r+C>>>1;t<o[I]?C=I:r=I+1}if(u=o[r],d=o[r-1],d===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(u===void 0)return r=o.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,d,u)}return this.interpolate_(r,d,t,u)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const o=this.resultBuffer,r=this.sampleValues,u=this.valueSize,d=t*u;for(let C=0;C!==u;++C)o[C]=r[d+C];return o}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(t,o,r,u){super(t,o,r,u),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(t,o,r){const u=this.parameterPositions;let d=t-2,C=t+1,I=u[d],f=u[C];if(I===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:d=t,I=2*o-r;break;case WrapAroundEnding:d=u.length-2,I=o+u[d]-u[d+1];break;default:d=t,I=r}if(f===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:C=t,f=2*r-o;break;case WrapAroundEnding:C=1,f=r+u[1]-u[0];break;default:C=t-1,f=o}const A=(r-o)*.5,G=this.valueSize;this._weightPrev=A/(o-I),this._weightNext=A/(f-r),this._offsetPrev=d*G,this._offsetNext=C*G}interpolate_(t,o,r,u){const d=this.resultBuffer,C=this.sampleValues,I=this.valueSize,f=t*I,A=f-I,G=this._offsetPrev,B=this._offsetNext,Z=this._weightPrev,w=this._weightNext,V=(r-o)/(u-o),Y=V*V,J=Y*V,T=-Z*J+2*Z*Y-Z*V,L=(1+Z)*J+(-1.5-2*Z)*Y+(-.5+Z)*V+1,z=(-1-w)*J+(1.5+w)*Y+.5*V,K=w*J-w*Y;for(let P=0;P!==I;++P)d[P]=T*C[G+P]+L*C[A+P]+z*C[f+P]+K*C[B+P];return d}}class LinearInterpolant extends Interpolant{constructor(t,o,r,u){super(t,o,r,u)}interpolate_(t,o,r,u){const d=this.resultBuffer,C=this.sampleValues,I=this.valueSize,f=t*I,A=f-I,G=(r-o)/(u-o),B=1-G;for(let Z=0;Z!==I;++Z)d[Z]=C[A+Z]*B+C[f+Z]*G;return d}}class DiscreteInterpolant extends Interpolant{constructor(t,o,r,u){super(t,o,r,u)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,o,r,u){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(o===void 0||o.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=convertArray(o,this.TimeBufferType),this.values=convertArray(r,this.ValueBufferType),this.setInterpolation(u||this.DefaultInterpolation)}static toJSON(t){const o=t.constructor;let r;if(o.toJSON!==this.toJSON)r=o.toJSON(t);else{r={name:t.name,times:convertArray(t.times,Array),values:convertArray(t.values,Array)};const u=t.getInterpolation();u!==t.DefaultInterpolation&&(r.interpolation=u)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let o;switch(t){case InterpolateDiscrete:o=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:o=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:o=this.InterpolantFactoryMethodSmooth;break}if(o===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=o,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const o=this.times;for(let r=0,u=o.length;r!==u;++r)o[r]+=t}return this}scale(t){if(t!==1){const o=this.times;for(let r=0,u=o.length;r!==u;++r)o[r]*=t}return this}trim(t,o){const r=this.times,u=r.length;let d=0,C=u-1;for(;d!==u&&r[d]<t;)++d;for(;C!==-1&&r[C]>o;)--C;if(++C,d!==0||C!==u){d>=C&&(C=Math.max(C,1),d=C-1);const I=this.getValueSize();this.times=r.slice(d,C),this.values=this.values.slice(d*I,C*I)}return this}validate(){let t=!0;const o=this.getValueSize();o-Math.floor(o)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,u=this.values,d=r.length;d===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let C=null;for(let I=0;I!==d;I++){const f=r[I];if(typeof f=="number"&&isNaN(f)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,I,f),t=!1;break}if(C!==null&&C>f){console.error("THREE.KeyframeTrack: Out of order keys.",this,I,f,C),t=!1;break}C=f}if(u!==void 0&&isTypedArray(u))for(let I=0,f=u.length;I!==f;++I){const A=u[I];if(isNaN(A)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,I,A),t=!1;break}}return t}optimize(){const t=this.times.slice(),o=this.values.slice(),r=this.getValueSize(),u=this.getInterpolation()===InterpolateSmooth,d=t.length-1;let C=1;for(let I=1;I<d;++I){let f=!1;const A=t[I],G=t[I+1];if(A!==G&&(I!==1||A!==t[0]))if(u)f=!0;else{const B=I*r,Z=B-r,w=B+r;for(let V=0;V!==r;++V){const Y=o[B+V];if(Y!==o[Z+V]||Y!==o[w+V]){f=!0;break}}}if(f){if(I!==C){t[C]=t[I];const B=I*r,Z=C*r;for(let w=0;w!==r;++w)o[Z+w]=o[B+w]}++C}}if(d>0){t[C]=t[d];for(let I=d*r,f=C*r,A=0;A!==r;++A)o[f+A]=o[I+A];++C}return C!==t.length?(this.times=t.slice(0,C),this.values=o.slice(0,C*r)):(this.times=t,this.values=o),this}clone(){const t=this.times.slice(),o=this.values.slice(),r=this.constructor,u=new r(this.name,t,o);return u.createInterpolant=this.createInterpolant,u}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(t,o,r){super(t,o,r)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,o,r,u){super(t,o,r,u)}interpolate_(t,o,r,u){const d=this.resultBuffer,C=this.sampleValues,I=this.valueSize,f=(r-o)/(u-o);let A=t*I;for(let G=A+I;A!==G;A+=4)Quaternion$2.slerpFlat(d,0,C,A-I,C,A,f);return d}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(t,o,r){super(t,o,r)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t="",o=-1,r=[],u=NormalAnimationBlendMode){this.name=t,this.tracks=r,this.duration=o,this.blendMode=u,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const o=[],r=t.tracks,u=1/(t.fps||1);for(let C=0,I=r.length;C!==I;++C)o.push(parseKeyframeTrack(r[C]).scale(u));const d=new this(t.name,t.duration,o,t.blendMode);return d.uuid=t.uuid,d}static toJSON(t){const o=[],r=t.tracks,u={name:t.name,duration:t.duration,tracks:o,uuid:t.uuid,blendMode:t.blendMode};for(let d=0,C=r.length;d!==C;++d)o.push(KeyframeTrack.toJSON(r[d]));return u}static CreateFromMorphTargetSequence(t,o,r,u){const d=o.length,C=[];for(let I=0;I<d;I++){let f=[],A=[];f.push((I+d-1)%d,I,(I+1)%d),A.push(0,1,0);const G=getKeyframeOrder(f);f=sortedArray(f,1,G),A=sortedArray(A,1,G),!u&&f[0]===0&&(f.push(d),A.push(A[0])),C.push(new NumberKeyframeTrack(".morphTargetInfluences["+o[I].name+"]",f,A).scale(1/r))}return new this(t,-1,C)}static findByName(t,o){let r=t;if(!Array.isArray(t)){const u=t;r=u.geometry&&u.geometry.animations||u.animations}for(let u=0;u<r.length;u++)if(r[u].name===o)return r[u];return null}static CreateClipsFromMorphTargetSequences(t,o,r){const u={},d=/^([\w-]*?)([\d]+)$/;for(let I=0,f=t.length;I<f;I++){const A=t[I],G=A.name.match(d);if(G&&G.length>1){const B=G[1];let Z=u[B];Z||(u[B]=Z=[]),Z.push(A)}}const C=[];for(const I in u)C.push(this.CreateFromMorphTargetSequence(I,u[I],o,r));return C}static parseAnimation(t,o){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(B,Z,w,V,Y){if(w.length!==0){const J=[],T=[];flattenJSON(w,J,T,V),J.length!==0&&Y.push(new B(Z,J,T))}},u=[],d=t.name||"default",C=t.fps||30,I=t.blendMode;let f=t.length||-1;const A=t.hierarchy||[];for(let B=0;B<A.length;B++){const Z=A[B].keys;if(!(!Z||Z.length===0))if(Z[0].morphTargets){const w={};let V;for(V=0;V<Z.length;V++)if(Z[V].morphTargets)for(let Y=0;Y<Z[V].morphTargets.length;Y++)w[Z[V].morphTargets[Y]]=-1;for(const Y in w){const J=[],T=[];for(let L=0;L!==Z[V].morphTargets.length;++L){const z=Z[V];J.push(z.time),T.push(z.morphTarget===Y?1:0)}u.push(new NumberKeyframeTrack(".morphTargetInfluence["+Y+"]",J,T))}f=w.length*C}else{const w=".bones["+o[B].name+"]";r(VectorKeyframeTrack,w+".position",Z,"pos",u),r(QuaternionKeyframeTrack,w+".quaternion",Z,"rot",u),r(VectorKeyframeTrack,w+".scale",Z,"scl",u)}}return u.length===0?null:new this(d,f,u,I)}resetDuration(){const t=this.tracks;let o=0;for(let r=0,u=t.length;r!==u;++r){const d=this.tracks[r];o=Math.max(o,d.times[d.times.length-1])}return this.duration=o,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let o=0;o<this.tracks.length;o++)t=t&&this.tracks[o].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let o=0;o<this.tracks.length;o++)t.push(this.tracks[o].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function parseKeyframeTrack(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(n.type);if(n.times===void 0){const o=[],r=[];flattenJSON(n.keys,o,r,"value"),n.times=o,n.values=r}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Cache={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class LoadingManager{constructor(t,o,r){const u=this;let d=!1,C=0,I=0,f;const A=[];this.onStart=void 0,this.onLoad=t,this.onProgress=o,this.onError=r,this.itemStart=function(G){I++,d===!1&&u.onStart!==void 0&&u.onStart(G,C,I),d=!0},this.itemEnd=function(G){C++,u.onProgress!==void 0&&u.onProgress(G,C,I),C===I&&(d=!1,u.onLoad!==void 0&&u.onLoad())},this.itemError=function(G){u.onError!==void 0&&u.onError(G)},this.resolveURL=function(G){return f?f(G):G},this.setURLModifier=function(G){return f=G,this},this.addHandler=function(G,B){return A.push(G,B),this},this.removeHandler=function(G){const B=A.indexOf(G);return B!==-1&&A.splice(B,2),this},this.getHandler=function(G){for(let B=0,Z=A.length;B<Z;B+=2){const w=A[B],V=A[B+1];if(w.global&&(w.lastIndex=0),w.test(G))return V}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(t){this.manager=t!==void 0?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,o){const r=this;return new Promise(function(u,d){r.load(t,u,o,d)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(t,o){super(t),this.response=o}}class FileLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const d=Cache.get(t);if(d!==void 0)return this.manager.itemStart(t),setTimeout(()=>{o&&o(d),this.manager.itemEnd(t)},0),d;if(loading[t]!==void 0){loading[t].push({onLoad:o,onProgress:r,onError:u});return}loading[t]=[],loading[t].push({onLoad:o,onProgress:r,onError:u});const C=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),I=this.mimeType,f=this.responseType;fetch(C).then(A=>{if(A.status===200||A.status===0){if(A.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||A.body===void 0||A.body.getReader===void 0)return A;const G=loading[t],B=A.body.getReader(),Z=A.headers.get("X-File-Size")||A.headers.get("Content-Length"),w=Z?parseInt(Z):0,V=w!==0;let Y=0;const J=new ReadableStream({start(T){L();function L(){B.read().then(({done:z,value:K})=>{if(z)T.close();else{Y+=K.byteLength;const P=new ProgressEvent("progress",{lengthComputable:V,loaded:Y,total:w});for(let $=0,ie=G.length;$<ie;$++){const ne=G[$];ne.onProgress&&ne.onProgress(P)}T.enqueue(K),L()}},z=>{T.error(z)})}}});return new Response(J)}else throw new HttpError(`fetch for "${A.url}" responded with ${A.status}: ${A.statusText}`,A)}).then(A=>{switch(f){case"arraybuffer":return A.arrayBuffer();case"blob":return A.blob();case"document":return A.text().then(G=>new DOMParser().parseFromString(G,I));case"json":return A.json();default:if(I===void 0)return A.text();{const B=/charset="?([^;"\s]*)"?/i.exec(I),Z=B&&B[1]?B[1].toLowerCase():void 0,w=new TextDecoder(Z);return A.arrayBuffer().then(V=>w.decode(V))}}}).then(A=>{Cache.add(t,A);const G=loading[t];delete loading[t];for(let B=0,Z=G.length;B<Z;B++){const w=G[B];w.onLoad&&w.onLoad(A)}}).catch(A=>{const G=loading[t];if(G===void 0)throw this.manager.itemError(t),A;delete loading[t];for(let B=0,Z=G.length;B<Z;B++){const w=G[B];w.onError&&w.onError(A)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class AnimationLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=new FileLoader(this.manager);C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(t,function(I){try{o(d.parse(JSON.parse(I)))}catch(f){u?u(f):console.error(f),d.manager.itemError(t)}},r,u)}parse(t){const o=[];for(let r=0;r<t.length;r++){const u=AnimationClip.parse(t[r]);o.push(u)}return o}}class CompressedTextureLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=[],I=new CompressedTexture,f=new FileLoader(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(d.withCredentials);let A=0;function G(B){f.load(t[B],function(Z){const w=d.parse(Z,!0);C[B]={width:w.width,height:w.height,format:w.format,mipmaps:w.mipmaps},A+=1,A===6&&(w.mipmapCount===1&&(I.minFilter=LinearFilter),I.image=C,I.format=w.format,I.needsUpdate=!0,o&&o(I))},r,u)}if(Array.isArray(t))for(let B=0,Z=t.length;B<Z;++B)G(B);else f.load(t,function(B){const Z=d.parse(B,!0);if(Z.isCubemap){const w=Z.mipmaps.length/Z.mipmapCount;for(let V=0;V<w;V++){C[V]={mipmaps:[]};for(let Y=0;Y<Z.mipmapCount;Y++)C[V].mipmaps.push(Z.mipmaps[V*Z.mipmapCount+Y]),C[V].format=Z.format,C[V].width=Z.width,C[V].height=Z.height}I.image=C}else I.image.width=Z.width,I.image.height=Z.height,I.mipmaps=Z.mipmaps;Z.mipmapCount===1&&(I.minFilter=LinearFilter),I.format=Z.format,I.needsUpdate=!0,o&&o(I)},r,u);return I}}class ImageLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const d=this,C=Cache.get(t);if(C!==void 0)return d.manager.itemStart(t),setTimeout(function(){o&&o(C),d.manager.itemEnd(t)},0),C;const I=createElementNS("img");function f(){G(),Cache.add(t,this),o&&o(this),d.manager.itemEnd(t)}function A(B){G(),u&&u(B),d.manager.itemError(t),d.manager.itemEnd(t)}function G(){I.removeEventListener("load",f,!1),I.removeEventListener("error",A,!1)}return I.addEventListener("load",f,!1),I.addEventListener("error",A,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(I.crossOrigin=this.crossOrigin),d.manager.itemStart(t),I.src=t,I}}class CubeTextureLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=new CubeTexture;d.colorSpace=SRGBColorSpace;const C=new ImageLoader(this.manager);C.setCrossOrigin(this.crossOrigin),C.setPath(this.path);let I=0;function f(A){C.load(t[A],function(G){d.images[A]=G,I++,I===6&&(d.needsUpdate=!0,o&&o(d))},void 0,u)}for(let A=0;A<t.length;++A)f(A);return d}}class DataTextureLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=new DataTexture,I=new FileLoader(this.manager);return I.setResponseType("arraybuffer"),I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(d.withCredentials),I.load(t,function(f){let A;try{A=d.parse(f)}catch(G){if(u!==void 0)u(G);else{console.error(G);return}}A.image!==void 0?C.image=A.image:A.data!==void 0&&(C.image.width=A.width,C.image.height=A.height,C.image.data=A.data),C.wrapS=A.wrapS!==void 0?A.wrapS:ClampToEdgeWrapping,C.wrapT=A.wrapT!==void 0?A.wrapT:ClampToEdgeWrapping,C.magFilter=A.magFilter!==void 0?A.magFilter:LinearFilter,C.minFilter=A.minFilter!==void 0?A.minFilter:LinearFilter,C.anisotropy=A.anisotropy!==void 0?A.anisotropy:1,A.colorSpace!==void 0&&(C.colorSpace=A.colorSpace),A.flipY!==void 0&&(C.flipY=A.flipY),A.format!==void 0&&(C.format=A.format),A.type!==void 0&&(C.type=A.type),A.mipmaps!==void 0&&(C.mipmaps=A.mipmaps,C.minFilter=LinearMipmapLinearFilter),A.mipmapCount===1&&(C.minFilter=LinearFilter),A.generateMipmaps!==void 0&&(C.generateMipmaps=A.generateMipmaps),C.needsUpdate=!0,o&&o(C,A)},r,u),C}}class TextureLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=new Texture,C=new ImageLoader(this.manager);return C.setCrossOrigin(this.crossOrigin),C.setPath(this.path),C.load(t,function(I){d.image=I,d.needsUpdate=!0,o!==void 0&&o(d)},r,u),d}}class Light extends Object3D{constructor(t,o=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(t),this.intensity=o}dispose(){}copy(t,o){return super.copy(t,o),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const o=super.toJSON(t);return o.object.color=this.color.getHex(),o.object.intensity=this.intensity,this.groundColor!==void 0&&(o.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(o.object.distance=this.distance),this.angle!==void 0&&(o.object.angle=this.angle),this.decay!==void 0&&(o.object.decay=this.decay),this.penumbra!==void 0&&(o.object.penumbra=this.penumbra),this.shadow!==void 0&&(o.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(o.object.target=this.target.uuid),o}}class HemisphereLight extends Light{constructor(t,o,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(o)}copy(t,o){return super.copy(t,o),this.groundColor.copy(t.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const o=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(t.matrixWorld),o.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(t.target.matrixWorld),o.lookAt(_lookTarget$1),o.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(_projScreenMatrix$1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const o=this.camera,r=RAD2DEG*2*t.angle*this.focus,u=this.mapSize.width/this.mapSize.height,d=t.distance||o.far;(r!==o.fov||u!==o.aspect||d!==o.far)&&(o.fov=r,o.aspect=u,o.far=d,o.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class SpotLight extends Light{constructor(t,o,r=0,u=Math.PI/3,d=0,C=2){super(t,o),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=u,this.penumbra=d,this.decay=C,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,o){return super.copy(t,o),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(t,o=0){const r=this.camera,u=this.matrix,d=t.distance||r.far;d!==r.far&&(r.far=d,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(t.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[o]),r.up.copy(this._cubeUps[o]),r.lookAt(_lookTarget),r.updateMatrixWorld(),u.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(t,o,r=0,u=2){super(t,o),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=u,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,o){return super.copy(t,o),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(t=-1,o=1,r=1,u=-1,d=.1,C=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=o,this.top=r,this.bottom=u,this.near=d,this.far=C,this.updateProjectionMatrix()}copy(t,o){return super.copy(t,o),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,o,r,u,d,C){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=o,this.view.offsetX=r,this.view.offsetY=u,this.view.width=d,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),o=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,u=(this.top+this.bottom)/2;let d=r-t,C=r+t,I=u+o,f=u-o;if(this.view!==null&&this.view.enabled){const A=(this.right-this.left)/this.view.fullWidth/this.zoom,G=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d+=A*this.view.offsetX,C=d+A*this.view.width,I-=G*this.view.offsetY,f=I-G*this.view.height}this.projectionMatrix.makeOrthographic(d,C,I,f,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const o=super.toJSON(t);return o.object.zoom=this.zoom,o.object.left=this.left,o.object.right=this.right,o.object.top=this.top,o.object.bottom=this.bottom,o.object.near=this.near,o.object.far=this.far,this.view!==null&&(o.object.view=Object.assign({},this.view)),o}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(t,o){super(t,o),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class AmbientLight extends Light{constructor(t,o){super(t,o),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(t,o,r=10,u=10){super(t,o),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=u}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const o=super.toJSON(t);return o.object.width=this.width,o.object.height=this.height,o}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let o=0;o<9;o++)this.coefficients[o].copy(t[o]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,o){const r=t.x,u=t.y,d=t.z,C=this.coefficients;return o.copy(C[0]).multiplyScalar(.282095),o.addScaledVector(C[1],.488603*u),o.addScaledVector(C[2],.488603*d),o.addScaledVector(C[3],.488603*r),o.addScaledVector(C[4],1.092548*(r*u)),o.addScaledVector(C[5],1.092548*(u*d)),o.addScaledVector(C[6],.315392*(3*d*d-1)),o.addScaledVector(C[7],1.092548*(r*d)),o.addScaledVector(C[8],.546274*(r*r-u*u)),o}getIrradianceAt(t,o){const r=t.x,u=t.y,d=t.z,C=this.coefficients;return o.copy(C[0]).multiplyScalar(.886227),o.addScaledVector(C[1],2*.511664*u),o.addScaledVector(C[2],2*.511664*d),o.addScaledVector(C[3],2*.511664*r),o.addScaledVector(C[4],2*.429043*r*u),o.addScaledVector(C[5],2*.429043*u*d),o.addScaledVector(C[6],.743125*d*d-.247708),o.addScaledVector(C[7],2*.429043*r*d),o.addScaledVector(C[8],.429043*(r*r-u*u)),o}add(t){for(let o=0;o<9;o++)this.coefficients[o].add(t.coefficients[o]);return this}addScaledSH(t,o){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],o);return this}scale(t){for(let o=0;o<9;o++)this.coefficients[o].multiplyScalar(t);return this}lerp(t,o){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],o);return this}equals(t){for(let o=0;o<9;o++)if(!this.coefficients[o].equals(t.coefficients[o]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,o=0){const r=this.coefficients;for(let u=0;u<9;u++)r[u].fromArray(t,o+u*3);return this}toArray(t=[],o=0){const r=this.coefficients;for(let u=0;u<9;u++)r[u].toArray(t,o+u*3);return t}static getBasisAt(t,o){const r=t.x,u=t.y,d=t.z;o[0]=.282095,o[1]=.488603*u,o[2]=.488603*d,o[3]=.488603*r,o[4]=1.092548*r*u,o[5]=1.092548*u*d,o[6]=.315392*(3*d*d-1),o[7]=1.092548*r*d,o[8]=.546274*(r*r-u*u)}}class LightProbe extends Light{constructor(t=new SphericalHarmonics3,o=1){super(void 0,o),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const o=super.toJSON(t);return o.object.sh=this.sh.toArray(),o}}class MaterialLoader extends Loader{constructor(t){super(t),this.textures={}}load(t,o,r,u){const d=this,C=new FileLoader(d.manager);C.setPath(d.path),C.setRequestHeader(d.requestHeader),C.setWithCredentials(d.withCredentials),C.load(t,function(I){try{o(d.parse(JSON.parse(I)))}catch(f){u?u(f):console.error(f),d.manager.itemError(t)}},r,u)}parse(t){const o=this.textures;function r(d){return o[d]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",d),o[d]}const u=this.createMaterialFromType(t.type);if(t.uuid!==void 0&&(u.uuid=t.uuid),t.name!==void 0&&(u.name=t.name),t.color!==void 0&&u.color!==void 0&&u.color.setHex(t.color),t.roughness!==void 0&&(u.roughness=t.roughness),t.metalness!==void 0&&(u.metalness=t.metalness),t.sheen!==void 0&&(u.sheen=t.sheen),t.sheenColor!==void 0&&(u.sheenColor=new Color().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(u.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&u.emissive!==void 0&&u.emissive.setHex(t.emissive),t.specular!==void 0&&u.specular!==void 0&&u.specular.setHex(t.specular),t.specularIntensity!==void 0&&(u.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&u.specularColor!==void 0&&u.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(u.shininess=t.shininess),t.clearcoat!==void 0&&(u.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(u.dispersion=t.dispersion),t.iridescence!==void 0&&(u.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(u.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(u.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(u.transmission=t.transmission),t.thickness!==void 0&&(u.thickness=t.thickness),t.attenuationDistance!==void 0&&(u.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&u.attenuationColor!==void 0&&u.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(u.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(u.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(u.fog=t.fog),t.flatShading!==void 0&&(u.flatShading=t.flatShading),t.blending!==void 0&&(u.blending=t.blending),t.combine!==void 0&&(u.combine=t.combine),t.side!==void 0&&(u.side=t.side),t.shadowSide!==void 0&&(u.shadowSide=t.shadowSide),t.opacity!==void 0&&(u.opacity=t.opacity),t.transparent!==void 0&&(u.transparent=t.transparent),t.alphaTest!==void 0&&(u.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(u.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(u.depthFunc=t.depthFunc),t.depthTest!==void 0&&(u.depthTest=t.depthTest),t.depthWrite!==void 0&&(u.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(u.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(u.blendSrc=t.blendSrc),t.blendDst!==void 0&&(u.blendDst=t.blendDst),t.blendEquation!==void 0&&(u.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(u.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(u.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(u.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&u.blendColor!==void 0&&u.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(u.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(u.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(u.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(u.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(u.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(u.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(u.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(u.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(u.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(u.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(u.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(u.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(u.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(u.rotation=t.rotation),t.linewidth!==void 0&&(u.linewidth=t.linewidth),t.dashSize!==void 0&&(u.dashSize=t.dashSize),t.gapSize!==void 0&&(u.gapSize=t.gapSize),t.scale!==void 0&&(u.scale=t.scale),t.polygonOffset!==void 0&&(u.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(u.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(u.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(u.dithering=t.dithering),t.alphaToCoverage!==void 0&&(u.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(u.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(u.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(u.visible=t.visible),t.toneMapped!==void 0&&(u.toneMapped=t.toneMapped),t.userData!==void 0&&(u.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?u.vertexColors=t.vertexColors>0:u.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const d in t.uniforms){const C=t.uniforms[d];switch(u.uniforms[d]={},C.type){case"t":u.uniforms[d].value=r(C.value);break;case"c":u.uniforms[d].value=new Color().setHex(C.value);break;case"v2":u.uniforms[d].value=new Vector2().fromArray(C.value);break;case"v3":u.uniforms[d].value=new Vector3().fromArray(C.value);break;case"v4":u.uniforms[d].value=new Vector4().fromArray(C.value);break;case"m3":u.uniforms[d].value=new Matrix3().fromArray(C.value);break;case"m4":u.uniforms[d].value=new Matrix4().fromArray(C.value);break;default:u.uniforms[d].value=C.value}}if(t.defines!==void 0&&(u.defines=t.defines),t.vertexShader!==void 0&&(u.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(u.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(u.glslVersion=t.glslVersion),t.extensions!==void 0)for(const d in t.extensions)u.extensions[d]=t.extensions[d];if(t.lights!==void 0&&(u.lights=t.lights),t.clipping!==void 0&&(u.clipping=t.clipping),t.size!==void 0&&(u.size=t.size),t.sizeAttenuation!==void 0&&(u.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(u.map=r(t.map)),t.matcap!==void 0&&(u.matcap=r(t.matcap)),t.alphaMap!==void 0&&(u.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(u.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(u.bumpScale=t.bumpScale),t.normalMap!==void 0&&(u.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(u.normalMapType=t.normalMapType),t.normalScale!==void 0){let d=t.normalScale;Array.isArray(d)===!1&&(d=[d,d]),u.normalScale=new Vector2().fromArray(d)}return t.displacementMap!==void 0&&(u.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(u.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(u.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(u.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(u.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(u.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(u.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(u.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(u.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(u.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(u.envMap=r(t.envMap)),t.envMapRotation!==void 0&&u.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(u.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(u.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(u.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(u.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(u.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(u.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(u.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(u.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(u.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(u.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(u.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(u.clearcoatNormalScale=new Vector2().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(u.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(u.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(u.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(u.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(u.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(u.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(u.sheenRoughnessMap=r(t.sheenRoughnessMap)),u}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return MaterialLoader.createMaterialFromType(t)}static createMaterialFromType(t){const o={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new o[t]}}class LoaderUtils{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let o="";for(let r=0,u=t.length;r<u;r++)o+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(o))}catch{return o}}static extractUrlBase(t){const o=t.lastIndexOf("/");return o===-1?"./":t.slice(0,o+1)}static resolveURL(t,o){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(o)&&/^\//.test(t)&&(o=o.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:o+t)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class BufferGeometryLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=new FileLoader(d.manager);C.setPath(d.path),C.setRequestHeader(d.requestHeader),C.setWithCredentials(d.withCredentials),C.load(t,function(I){try{o(d.parse(JSON.parse(I)))}catch(f){u?u(f):console.error(f),d.manager.itemError(t)}},r,u)}parse(t){const o={},r={};function u(w,V){if(o[V]!==void 0)return o[V];const J=w.interleavedBuffers[V],T=d(w,J.buffer),L=getTypedArray(J.type,T),z=new InterleavedBuffer(L,J.stride);return z.uuid=J.uuid,o[V]=z,z}function d(w,V){if(r[V]!==void 0)return r[V];const J=w.arrayBuffers[V],T=new Uint32Array(J).buffer;return r[V]=T,T}const C=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,I=t.data.index;if(I!==void 0){const w=getTypedArray(I.type,I.array);C.setIndex(new BufferAttribute(w,1))}const f=t.data.attributes;for(const w in f){const V=f[w];let Y;if(V.isInterleavedBufferAttribute){const J=u(t.data,V.data);Y=new InterleavedBufferAttribute(J,V.itemSize,V.offset,V.normalized)}else{const J=getTypedArray(V.type,V.array),T=V.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;Y=new T(J,V.itemSize,V.normalized)}V.name!==void 0&&(Y.name=V.name),V.usage!==void 0&&Y.setUsage(V.usage),C.setAttribute(w,Y)}const A=t.data.morphAttributes;if(A)for(const w in A){const V=A[w],Y=[];for(let J=0,T=V.length;J<T;J++){const L=V[J];let z;if(L.isInterleavedBufferAttribute){const K=u(t.data,L.data);z=new InterleavedBufferAttribute(K,L.itemSize,L.offset,L.normalized)}else{const K=getTypedArray(L.type,L.array);z=new BufferAttribute(K,L.itemSize,L.normalized)}L.name!==void 0&&(z.name=L.name),Y.push(z)}C.morphAttributes[w]=Y}t.data.morphTargetsRelative&&(C.morphTargetsRelative=!0);const B=t.data.groups||t.data.drawcalls||t.data.offsets;if(B!==void 0)for(let w=0,V=B.length;w!==V;++w){const Y=B[w];C.addGroup(Y.start,Y.count,Y.materialIndex)}const Z=t.data.boundingSphere;if(Z!==void 0){const w=new Vector3;Z.center!==void 0&&w.fromArray(Z.center),C.boundingSphere=new Sphere(w,Z.radius)}return t.name&&(C.name=t.name),t.userData&&(C.userData=t.userData),C}}class ObjectLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=this.path===""?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||C;const I=new FileLoader(this.manager);I.setPath(this.path),I.setRequestHeader(this.requestHeader),I.setWithCredentials(this.withCredentials),I.load(t,function(f){let A=null;try{A=JSON.parse(f)}catch(B){u!==void 0&&u(B),console.error("THREE:ObjectLoader: Can't parse "+t+".",B.message);return}const G=A.metadata;if(G===void 0||G.type===void 0||G.type.toLowerCase()==="geometry"){u!==void 0&&u(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}d.parse(A,o)},r,u)}async loadAsync(t,o){const r=this,u=this.path===""?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||u;const d=new FileLoader(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials);const C=await d.loadAsync(t,o),I=JSON.parse(C),f=I.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(I)}parse(t,o){const r=this.parseAnimations(t.animations),u=this.parseShapes(t.shapes),d=this.parseGeometries(t.geometries,u),C=this.parseImages(t.images,function(){o!==void 0&&o(A)}),I=this.parseTextures(t.textures,C),f=this.parseMaterials(t.materials,I),A=this.parseObject(t.object,d,f,I,r),G=this.parseSkeletons(t.skeletons,A);if(this.bindSkeletons(A,G),this.bindLightTargets(A),o!==void 0){let B=!1;for(const Z in C)if(C[Z].data instanceof HTMLImageElement){B=!0;break}B===!1&&o(A)}return A}async parseAsync(t){const o=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),u=this.parseGeometries(t.geometries,r),d=await this.parseImagesAsync(t.images),C=this.parseTextures(t.textures,d),I=this.parseMaterials(t.materials,C),f=this.parseObject(t.object,u,I,C,o),A=this.parseSkeletons(t.skeletons,f);return this.bindSkeletons(f,A),this.bindLightTargets(f),f}parseShapes(t){const o={};if(t!==void 0)for(let r=0,u=t.length;r<u;r++){const d=new Shape$2().fromJSON(t[r]);o[d.uuid]=d}return o}parseSkeletons(t,o){const r={},u={};if(o.traverse(function(d){d.isBone&&(u[d.uuid]=d)}),t!==void 0)for(let d=0,C=t.length;d<C;d++){const I=new Skeleton().fromJSON(t[d],u);r[I.uuid]=I}return r}parseGeometries(t,o){const r={};if(t!==void 0){const u=new BufferGeometryLoader;for(let d=0,C=t.length;d<C;d++){let I;const f=t[d];switch(f.type){case"BufferGeometry":case"InstancedBufferGeometry":I=u.parse(f);break;default:f.type in Geometries?I=Geometries[f.type].fromJSON(f,o):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${f.type}"`)}I.uuid=f.uuid,f.name!==void 0&&(I.name=f.name),f.userData!==void 0&&(I.userData=f.userData),r[f.uuid]=I}}return r}parseMaterials(t,o){const r={},u={};if(t!==void 0){const d=new MaterialLoader;d.setTextures(o);for(let C=0,I=t.length;C<I;C++){const f=t[C];r[f.uuid]===void 0&&(r[f.uuid]=d.parse(f)),u[f.uuid]=r[f.uuid]}}return u}parseAnimations(t){const o={};if(t!==void 0)for(let r=0;r<t.length;r++){const u=t[r],d=AnimationClip.parse(u);o[d.uuid]=d}return o}parseImages(t,o){const r=this,u={};let d;function C(f){return r.manager.itemStart(f),d.load(f,function(){r.manager.itemEnd(f)},void 0,function(){r.manager.itemError(f),r.manager.itemEnd(f)})}function I(f){if(typeof f=="string"){const A=f,G=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(A)?A:r.resourcePath+A;return C(G)}else return f.data?{data:getTypedArray(f.type,f.data),width:f.width,height:f.height}:null}if(t!==void 0&&t.length>0){const f=new LoadingManager(o);d=new ImageLoader(f),d.setCrossOrigin(this.crossOrigin);for(let A=0,G=t.length;A<G;A++){const B=t[A],Z=B.url;if(Array.isArray(Z)){const w=[];for(let V=0,Y=Z.length;V<Y;V++){const J=Z[V],T=I(J);T!==null&&(T instanceof HTMLImageElement?w.push(T):w.push(new DataTexture(T.data,T.width,T.height)))}u[B.uuid]=new Source(w)}else{const w=I(B.url);u[B.uuid]=new Source(w)}}}return u}async parseImagesAsync(t){const o=this,r={};let u;async function d(C){if(typeof C=="string"){const I=C,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(I)?I:o.resourcePath+I;return await u.loadAsync(f)}else return C.data?{data:getTypedArray(C.type,C.data),width:C.width,height:C.height}:null}if(t!==void 0&&t.length>0){u=new ImageLoader(this.manager),u.setCrossOrigin(this.crossOrigin);for(let C=0,I=t.length;C<I;C++){const f=t[C],A=f.url;if(Array.isArray(A)){const G=[];for(let B=0,Z=A.length;B<Z;B++){const w=A[B],V=await d(w);V!==null&&(V instanceof HTMLImageElement?G.push(V):G.push(new DataTexture(V.data,V.width,V.height)))}r[f.uuid]=new Source(G)}else{const G=await d(f.url);r[f.uuid]=new Source(G)}}}return r}parseTextures(t,o){function r(d,C){return typeof d=="number"?d:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",d),C[d])}const u={};if(t!==void 0)for(let d=0,C=t.length;d<C;d++){const I=t[d];I.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',I.uuid),o[I.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",I.image);const f=o[I.image],A=f.data;let G;Array.isArray(A)?(G=new CubeTexture,A.length===6&&(G.needsUpdate=!0)):(A&&A.data?G=new DataTexture:G=new Texture,A&&(G.needsUpdate=!0)),G.source=f,G.uuid=I.uuid,I.name!==void 0&&(G.name=I.name),I.mapping!==void 0&&(G.mapping=r(I.mapping,TEXTURE_MAPPING)),I.channel!==void 0&&(G.channel=I.channel),I.offset!==void 0&&G.offset.fromArray(I.offset),I.repeat!==void 0&&G.repeat.fromArray(I.repeat),I.center!==void 0&&G.center.fromArray(I.center),I.rotation!==void 0&&(G.rotation=I.rotation),I.wrap!==void 0&&(G.wrapS=r(I.wrap[0],TEXTURE_WRAPPING),G.wrapT=r(I.wrap[1],TEXTURE_WRAPPING)),I.format!==void 0&&(G.format=I.format),I.internalFormat!==void 0&&(G.internalFormat=I.internalFormat),I.type!==void 0&&(G.type=I.type),I.colorSpace!==void 0&&(G.colorSpace=I.colorSpace),I.minFilter!==void 0&&(G.minFilter=r(I.minFilter,TEXTURE_FILTER)),I.magFilter!==void 0&&(G.magFilter=r(I.magFilter,TEXTURE_FILTER)),I.anisotropy!==void 0&&(G.anisotropy=I.anisotropy),I.flipY!==void 0&&(G.flipY=I.flipY),I.generateMipmaps!==void 0&&(G.generateMipmaps=I.generateMipmaps),I.premultiplyAlpha!==void 0&&(G.premultiplyAlpha=I.premultiplyAlpha),I.unpackAlignment!==void 0&&(G.unpackAlignment=I.unpackAlignment),I.compareFunction!==void 0&&(G.compareFunction=I.compareFunction),I.userData!==void 0&&(G.userData=I.userData),u[I.uuid]=G}return u}parseObject(t,o,r,u,d){let C;function I(Z){return o[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Z),o[Z]}function f(Z){if(Z!==void 0){if(Array.isArray(Z)){const w=[];for(let V=0,Y=Z.length;V<Y;V++){const J=Z[V];r[J]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",J),w.push(r[J])}return w}return r[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Z),r[Z]}}function A(Z){return u[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Z),u[Z]}let G,B;switch(t.type){case"Scene":C=new Scene,t.background!==void 0&&(Number.isInteger(t.background)?C.background=new Color(t.background):C.background=A(t.background)),t.environment!==void 0&&(C.environment=A(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?C.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(C.fog=new FogExp2(t.fog.color,t.fog.density)),t.fog.name!==""&&(C.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(C.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(C.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&C.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(C.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&C.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":C=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(C.focus=t.focus),t.zoom!==void 0&&(C.zoom=t.zoom),t.filmGauge!==void 0&&(C.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(C.filmOffset=t.filmOffset),t.view!==void 0&&(C.view=Object.assign({},t.view));break;case"OrthographicCamera":C=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(C.zoom=t.zoom),t.view!==void 0&&(C.view=Object.assign({},t.view));break;case"AmbientLight":C=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":C=new DirectionalLight(t.color,t.intensity),C.target=t.target||"";break;case"PointLight":C=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":C=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":C=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),C.target=t.target||"";break;case"HemisphereLight":C=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":C=new LightProbe().fromJSON(t);break;case"SkinnedMesh":G=I(t.geometry),B=f(t.material),C=new SkinnedMesh(G,B),t.bindMode!==void 0&&(C.bindMode=t.bindMode),t.bindMatrix!==void 0&&C.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(C.skeleton=t.skeleton);break;case"Mesh":G=I(t.geometry),B=f(t.material),C=new Mesh(G,B);break;case"InstancedMesh":G=I(t.geometry),B=f(t.material);const Z=t.count,w=t.instanceMatrix,V=t.instanceColor;C=new InstancedMesh(G,B,Z),C.instanceMatrix=new InstancedBufferAttribute(new Float32Array(w.array),16),V!==void 0&&(C.instanceColor=new InstancedBufferAttribute(new Float32Array(V.array),V.itemSize));break;case"BatchedMesh":G=I(t.geometry),B=f(t.material),C=new BatchedMesh(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,B),C.geometry=G,C.perObjectFrustumCulled=t.perObjectFrustumCulled,C.sortObjects=t.sortObjects,C._drawRanges=t.drawRanges,C._reservedRanges=t.reservedRanges,C._visibility=t.visibility,C._active=t.active,C._bounds=t.bounds.map(Y=>{const J=new Box3;J.min.fromArray(Y.boxMin),J.max.fromArray(Y.boxMax);const T=new Sphere;return T.radius=Y.sphereRadius,T.center.fromArray(Y.sphereCenter),{boxInitialized:Y.boxInitialized,box:J,sphereInitialized:Y.sphereInitialized,sphere:T}}),C._maxInstanceCount=t.maxInstanceCount,C._maxVertexCount=t.maxVertexCount,C._maxIndexCount=t.maxIndexCount,C._geometryInitialized=t.geometryInitialized,C._geometryCount=t.geometryCount,C._matricesTexture=A(t.matricesTexture.uuid),t.colorsTexture!==void 0&&(C._colorsTexture=A(t.colorsTexture.uuid));break;case"LOD":C=new LOD;break;case"Line":C=new Line(I(t.geometry),f(t.material));break;case"LineLoop":C=new LineLoop(I(t.geometry),f(t.material));break;case"LineSegments":C=new LineSegments(I(t.geometry),f(t.material));break;case"PointCloud":case"Points":C=new Points(I(t.geometry),f(t.material));break;case"Sprite":C=new Sprite(f(t.material));break;case"Group":C=new Group;break;case"Bone":C=new Bone;break;default:C=new Object3D}if(C.uuid=t.uuid,t.name!==void 0&&(C.name=t.name),t.matrix!==void 0?(C.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(C.matrixAutoUpdate=t.matrixAutoUpdate),C.matrixAutoUpdate&&C.matrix.decompose(C.position,C.quaternion,C.scale)):(t.position!==void 0&&C.position.fromArray(t.position),t.rotation!==void 0&&C.rotation.fromArray(t.rotation),t.quaternion!==void 0&&C.quaternion.fromArray(t.quaternion),t.scale!==void 0&&C.scale.fromArray(t.scale)),t.up!==void 0&&C.up.fromArray(t.up),t.castShadow!==void 0&&(C.castShadow=t.castShadow),t.receiveShadow!==void 0&&(C.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(C.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(C.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(C.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(C.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&C.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(C.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(C.visible=t.visible),t.frustumCulled!==void 0&&(C.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(C.renderOrder=t.renderOrder),t.userData!==void 0&&(C.userData=t.userData),t.layers!==void 0&&(C.layers.mask=t.layers),t.children!==void 0){const Z=t.children;for(let w=0;w<Z.length;w++)C.add(this.parseObject(Z[w],o,r,u,d))}if(t.animations!==void 0){const Z=t.animations;for(let w=0;w<Z.length;w++){const V=Z[w];C.animations.push(d[V])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(C.autoUpdate=t.autoUpdate);const Z=t.levels;for(let w=0;w<Z.length;w++){const V=Z[w],Y=C.getObjectByProperty("uuid",V.object);Y!==void 0&&C.addLevel(Y,V.distance,V.hysteresis)}}return C}bindSkeletons(t,o){Object.keys(o).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const u=o[r.skeleton];u===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(u,r.bindMatrix)}})}bindLightTargets(t){t.traverse(function(o){if(o.isDirectionalLight||o.isSpotLight){const r=o.target,u=t.getObjectByProperty("uuid",r);u!==void 0?o.target=u:o.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,o,r,u){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const d=this,C=Cache.get(t);if(C!==void 0){if(d.manager.itemStart(t),C.then){C.then(A=>{o&&o(A),d.manager.itemEnd(t)}).catch(A=>{u&&u(A)});return}return setTimeout(function(){o&&o(C),d.manager.itemEnd(t)},0),C}const I={};I.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",I.headers=this.requestHeader;const f=fetch(t,I).then(function(A){return A.blob()}).then(function(A){return createImageBitmap(A,Object.assign(d.options,{colorSpaceConversion:"none"}))}).then(function(A){return Cache.add(t,A),o&&o(A),d.manager.itemEnd(t),A}).catch(function(A){u&&u(A),Cache.remove(t),d.manager.itemError(t),d.manager.itemEnd(t)});Cache.add(t,f),d.manager.itemStart(t)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(t){_context=t}}class AudioLoader extends Loader{constructor(t){super(t)}load(t,o,r,u){const d=this,C=new FileLoader(this.manager);C.setResponseType("arraybuffer"),C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(t,function(f){try{const A=f.slice(0);AudioContext.getContext().decodeAudioData(A,function(B){o(B)}).catch(I)}catch(A){I(A)}},r,u);function I(f){u?u(f):console.error(f),d.manager.itemError(t)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const o=this._cache;if(o.focus!==t.focus||o.fov!==t.fov||o.aspect!==t.aspect*this.aspect||o.near!==t.near||o.far!==t.far||o.zoom!==t.zoom||o.eyeSep!==this.eyeSep){o.focus=t.focus,o.fov=t.fov,o.aspect=t.aspect*this.aspect,o.near=t.near,o.far=t.far,o.zoom=t.zoom,o.eyeSep=this.eyeSep,_projectionMatrix.copy(t.projectionMatrix);const u=o.eyeSep/2,d=u*o.near/o.focus,C=o.near*Math.tan(DEG2RAD*o.fov*.5)/o.zoom;let I,f;_eyeLeft.elements[12]=-u,_eyeRight.elements[12]=u,I=-C*o.aspect+d,f=C*o.aspect+d,_projectionMatrix.elements[0]=2*o.near/(f-I),_projectionMatrix.elements[8]=(f+I)/(f-I),this.cameraL.projectionMatrix.copy(_projectionMatrix),I=-C*o.aspect-d,f=C*o.aspect-d,_projectionMatrix.elements[0]=2*o.near/(f-I),_projectionMatrix.elements[8]=(f+I)/(f-I),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t,this.index=0}}class Clock{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const o=now();t=(o-this.oldTime)/1e3,this.oldTime=o,this.elapsedTime+=t}return t}}function now(){return performance.now()}const _position$1=new Vector3,_quaternion$1=new Quaternion$2,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const o=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),o.positionX){const u=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(_position$1.x,u),o.positionY.linearRampToValueAtTime(_position$1.y,u),o.positionZ.linearRampToValueAtTime(_position$1.z,u),o.forwardX.linearRampToValueAtTime(_orientation$1.x,u),o.forwardY.linearRampToValueAtTime(_orientation$1.y,u),o.forwardZ.linearRampToValueAtTime(_orientation$1.z,u),o.upX.linearRampToValueAtTime(r.x,u),o.upY.linearRampToValueAtTime(r.y,u),o.upZ.linearRampToValueAtTime(r.z,u)}else o.setPosition(_position$1.x,_position$1.y,_position$1.z),o.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,r.x,r.y,r.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const o=this.context.createBufferSource();return o.buffer=this.buffer,o.loop=this.loop,o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.onended=this.onEnded.bind(this),o.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=o,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(t=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,o=this.filters.length;t<o;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,o=this.filters.length;t<o;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,o){return super.copy(t,o),t.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const _position=new Vector3,_quaternion=new Quaternion$2,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,o,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=o,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const o=this.panner;if(o.positionX){const r=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(_position.x,r),o.positionY.linearRampToValueAtTime(_position.y,r),o.positionZ.linearRampToValueAtTime(_position.z,r),o.orientationX.linearRampToValueAtTime(_orientation.x,r),o.orientationY.linearRampToValueAtTime(_orientation.y,r),o.orientationZ.linearRampToValueAtTime(_orientation.z,r)}else o.setPosition(_position.x,_position.y,_position.z),o.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(t,o=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=o,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const o=this.getFrequencyData();for(let r=0;r<o.length;r++)t+=o[r];return t/o.length}}class PropertyMixer{constructor(t,o,r){this.binding=t,this.valueSize=r;let u,d,C;switch(o){case"quaternion":u=this._slerp,d=this._slerpAdditive,C=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":u=this._select,d=this._select,C=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:u=this._lerp,d=this._lerpAdditive,C=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=u,this._mixBufferRegionAdditive=d,this._setIdentity=C,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,o){const r=this.buffer,u=this.valueSize,d=t*u+u;let C=this.cumulativeWeight;if(C===0){for(let I=0;I!==u;++I)r[d+I]=r[I];C=o}else{C+=o;const I=o/C;this._mixBufferRegion(r,d,0,I,u)}this.cumulativeWeight=C}accumulateAdditive(t){const o=this.buffer,r=this.valueSize,u=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(o,u,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const o=this.valueSize,r=this.buffer,u=t*o+o,d=this.cumulativeWeight,C=this.cumulativeWeightAdditive,I=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,d<1){const f=o*this._origIndex;this._mixBufferRegion(r,u,f,1-d,o)}C>0&&this._mixBufferRegionAdditive(r,u,this._addIndex*o,1,o);for(let f=o,A=o+o;f!==A;++f)if(r[f]!==r[f+o]){I.setValue(r,u);break}}saveOriginalState(){const t=this.binding,o=this.buffer,r=this.valueSize,u=r*this._origIndex;t.getValue(o,u);for(let d=r,C=u;d!==C;++d)o[d]=o[u+d%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,o=t+this.valueSize;for(let r=t;r<o;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,o=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[o+r]=this.buffer[t+r]}_select(t,o,r,u,d){if(u>=.5)for(let C=0;C!==d;++C)t[o+C]=t[r+C]}_slerp(t,o,r,u){Quaternion$2.slerpFlat(t,o,t,o,t,r,u)}_slerpAdditive(t,o,r,u,d){const C=this._workIndex*d;Quaternion$2.multiplyQuaternionsFlat(t,C,t,o,t,r),Quaternion$2.slerpFlat(t,o,t,o,t,C,u)}_lerp(t,o,r,u,d){const C=1-u;for(let I=0;I!==d;++I){const f=o+I;t[f]=t[f]*C+t[r+I]*u}}_lerpAdditive(t,o,r,u,d){for(let C=0;C!==d;++C){const I=o+C;t[I]=t[I]+t[r+C]*u}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(t,o,r){const u=r||PropertyBinding.parseTrackName(o);this._targetGroup=t,this._bindings=t.subscribe_(o,u)}getValue(t,o){this.bind();const r=this._targetGroup.nCachedObjects_,u=this._bindings[r];u!==void 0&&u.getValue(t,o)}setValue(t,o){const r=this._bindings;for(let u=this._targetGroup.nCachedObjects_,d=r.length;u!==d;++u)r[u].setValue(t,o)}bind(){const t=this._bindings;for(let o=this._targetGroup.nCachedObjects_,r=t.length;o!==r;++o)t[o].bind()}unbind(){const t=this._bindings;for(let o=this._targetGroup.nCachedObjects_,r=t.length;o!==r;++o)t[o].unbind()}}class PropertyBinding{constructor(t,o,r){this.path=o,this.parsedPath=r||PropertyBinding.parseTrackName(o),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,o,r){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,o,r):new PropertyBinding(t,o,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(t){const o=_trackRe.exec(t);if(o===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:o[2],objectName:o[3],objectIndex:o[4],propertyName:o[5],propertyIndex:o[6]},u=r.nodeName&&r.nodeName.lastIndexOf(".");if(u!==void 0&&u!==-1){const d=r.nodeName.substring(u+1);_supportedObjectNames.indexOf(d)!==-1&&(r.nodeName=r.nodeName.substring(0,u),r.objectName=d)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,o){if(o===void 0||o===""||o==="."||o===-1||o===t.name||o===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(o);if(r!==void 0)return r}if(t.children){const r=function(d){for(let C=0;C<d.length;C++){const I=d[C];if(I.name===o||I.uuid===o)return I;const f=r(I.children);if(f)return f}return null},u=r(t.children);if(u)return u}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,o){t[o]=this.targetObject[this.propertyName]}_getValue_array(t,o){const r=this.resolvedProperty;for(let u=0,d=r.length;u!==d;++u)t[o++]=r[u]}_getValue_arrayElement(t,o){t[o]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,o){this.resolvedProperty.toArray(t,o)}_setValue_direct(t,o){this.targetObject[this.propertyName]=t[o]}_setValue_direct_setNeedsUpdate(t,o){this.targetObject[this.propertyName]=t[o],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,o){this.targetObject[this.propertyName]=t[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,o){const r=this.resolvedProperty;for(let u=0,d=r.length;u!==d;++u)r[u]=t[o++]}_setValue_array_setNeedsUpdate(t,o){const r=this.resolvedProperty;for(let u=0,d=r.length;u!==d;++u)r[u]=t[o++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,o){const r=this.resolvedProperty;for(let u=0,d=r.length;u!==d;++u)r[u]=t[o++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,o){this.resolvedProperty[this.propertyIndex]=t[o]}_setValue_arrayElement_setNeedsUpdate(t,o){this.resolvedProperty[this.propertyIndex]=t[o],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,o){this.resolvedProperty[this.propertyIndex]=t[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,o){this.resolvedProperty.fromArray(t,o)}_setValue_fromArray_setNeedsUpdate(t,o){this.resolvedProperty.fromArray(t,o),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,o){this.resolvedProperty.fromArray(t,o),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,o){this.bind(),this.getValue(t,o)}_setValue_unbound(t,o){this.bind(),this.setValue(t,o)}bind(){let t=this.node;const o=this.parsedPath,r=o.objectName,u=o.propertyName;let d=o.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,o.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let A=o.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let G=0;G<t.length;G++)if(t[G].name===A){A=G;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(A!==void 0){if(t[A]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[A]}}const C=t[u];if(C===void 0){const A=o.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+A+"."+u+" but it wasn't found.",t);return}let I=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?I=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(I=this.Versioning.MatrixWorldNeedsUpdate);let f=this.BindingType.Direct;if(d!==void 0){if(u==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[d]!==void 0&&(d=t.morphTargetDictionary[d])}f=this.BindingType.ArrayElement,this.resolvedProperty=C,this.propertyIndex=d}else C.fromArray!==void 0&&C.toArray!==void 0?(f=this.BindingType.HasFromToArray,this.resolvedProperty=C):Array.isArray(C)?(f=this.BindingType.EntireArray,this.resolvedProperty=C):this.propertyName=u;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][I]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,u=arguments.length;r!==u;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const o=this;this.stats={objects:{get total(){return o._objects.length},get inUse(){return this.total-o.nCachedObjects_}},get bindingsPerObject(){return o._bindings.length}}}add(){const t=this._objects,o=this._indicesByUUID,r=this._paths,u=this._parsedPaths,d=this._bindings,C=d.length;let I,f=t.length,A=this.nCachedObjects_;for(let G=0,B=arguments.length;G!==B;++G){const Z=arguments[G],w=Z.uuid;let V=o[w];if(V===void 0){V=f++,o[w]=V,t.push(Z);for(let Y=0,J=C;Y!==J;++Y)d[Y].push(new PropertyBinding(Z,r[Y],u[Y]))}else if(V<A){I=t[V];const Y=--A,J=t[Y];o[J.uuid]=V,t[V]=J,o[w]=Y,t[Y]=Z;for(let T=0,L=C;T!==L;++T){const z=d[T],K=z[Y];let P=z[V];z[V]=K,P===void 0&&(P=new PropertyBinding(Z,r[T],u[T])),z[Y]=P}}else t[V]!==I&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=A}remove(){const t=this._objects,o=this._indicesByUUID,r=this._bindings,u=r.length;let d=this.nCachedObjects_;for(let C=0,I=arguments.length;C!==I;++C){const f=arguments[C],A=f.uuid,G=o[A];if(G!==void 0&&G>=d){const B=d++,Z=t[B];o[Z.uuid]=G,t[G]=Z,o[A]=B,t[B]=f;for(let w=0,V=u;w!==V;++w){const Y=r[w],J=Y[B],T=Y[G];Y[G]=J,Y[B]=T}}}this.nCachedObjects_=d}uncache(){const t=this._objects,o=this._indicesByUUID,r=this._bindings,u=r.length;let d=this.nCachedObjects_,C=t.length;for(let I=0,f=arguments.length;I!==f;++I){const A=arguments[I],G=A.uuid,B=o[G];if(B!==void 0)if(delete o[G],B<d){const Z=--d,w=t[Z],V=--C,Y=t[V];o[w.uuid]=B,t[B]=w,o[Y.uuid]=Z,t[Z]=Y,t.pop();for(let J=0,T=u;J!==T;++J){const L=r[J],z=L[Z],K=L[V];L[B]=z,L[Z]=K,L.pop()}}else{const Z=--C,w=t[Z];Z>0&&(o[w.uuid]=B),t[B]=w,t.pop();for(let V=0,Y=u;V!==Y;++V){const J=r[V];J[B]=J[Z],J.pop()}}}this.nCachedObjects_=d}subscribe_(t,o){const r=this._bindingsIndicesByPath;let u=r[t];const d=this._bindings;if(u!==void 0)return d[u];const C=this._paths,I=this._parsedPaths,f=this._objects,A=f.length,G=this.nCachedObjects_,B=new Array(A);u=d.length,r[t]=u,C.push(t),I.push(o),d.push(B);for(let Z=G,w=f.length;Z!==w;++Z){const V=f[Z];B[Z]=new PropertyBinding(V,t,o)}return B}unsubscribe_(t){const o=this._bindingsIndicesByPath,r=o[t];if(r!==void 0){const u=this._paths,d=this._parsedPaths,C=this._bindings,I=C.length-1,f=C[I],A=t[I];o[A]=r,C[r]=f,C.pop(),d[r]=d[I],d.pop(),u[r]=u[I],u.pop()}}}class AnimationAction{constructor(t,o,r=null,u=o.blendMode){this._mixer=t,this._clip=o,this._localRoot=r,this.blendMode=u;const d=o.tracks,C=d.length,I=new Array(C),f={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let A=0;A!==C;++A){const G=d[A].createInterpolant(null);I[A]=G,G.settings=f}this._interpolantSettings=f,this._interpolants=I,this._propertyBindings=new Array(C),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,o){return this.loop=t,this.repetitions=o,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,o,r){if(t.fadeOut(o),this.fadeIn(o),r){const u=this._clip.duration,d=t._clip.duration,C=d/u,I=u/d;t.warp(1,C,o),this.warp(I,1,o)}return this}crossFadeTo(t,o,r){return t.crossFadeFrom(this,o,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,o,r){const u=this._mixer,d=u.time,C=this.timeScale;let I=this._timeScaleInterpolant;I===null&&(I=u._lendControlInterpolant(),this._timeScaleInterpolant=I);const f=I.parameterPositions,A=I.sampleValues;return f[0]=d,f[1]=d+r,A[0]=t/C,A[1]=o/C,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,o,r,u){if(!this.enabled){this._updateWeight(t);return}const d=this._startTime;if(d!==null){const f=(t-d)*r;f<0||r===0?o=0:(this._startTime=null,o=r*f)}o*=this._updateTimeScale(t);const C=this._updateTime(o),I=this._updateWeight(t);if(I>0){const f=this._interpolants,A=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let G=0,B=f.length;G!==B;++G)f[G].evaluate(C),A[G].accumulateAdditive(I);break;case NormalAnimationBlendMode:default:for(let G=0,B=f.length;G!==B;++G)f[G].evaluate(C),A[G].accumulate(u,I)}}}_updateWeight(t){let o=0;if(this.enabled){o=this.weight;const r=this._weightInterpolant;if(r!==null){const u=r.evaluate(t)[0];o*=u,t>r.parameterPositions[1]&&(this.stopFading(),u===0&&(this.enabled=!1))}}return this._effectiveWeight=o,o}_updateTimeScale(t){let o=0;if(!this.paused){o=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const u=r.evaluate(t)[0];o*=u,t>r.parameterPositions[1]&&(this.stopWarping(),o===0?this.paused=!0:this.timeScale=o)}}return this._effectiveTimeScale=o,o}_updateTime(t){const o=this._clip.duration,r=this.loop;let u=this.time+t,d=this._loopCount;const C=r===LoopPingPong;if(t===0)return d===-1?u:C&&(d&1)===1?o-u:u;if(r===LoopOnce){d===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(u>=o)u=o;else if(u<0)u=0;else{this.time=u;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=u,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(d===-1&&(t>=0?(d=0,this._setEndings(!0,this.repetitions===0,C)):this._setEndings(this.repetitions===0,!0,C)),u>=o||u<0){const I=Math.floor(u/o);u-=o*I,d+=Math.abs(I);const f=this.repetitions-d;if(f<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,u=t>0?o:0,this.time=u,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(f===1){const A=t<0;this._setEndings(A,!A,C)}else this._setEndings(!1,!1,C);this._loopCount=d,this.time=u,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:I})}}else this.time=u;if(C&&(d&1)===1)return o-u}return u}_setEndings(t,o,r){const u=this._interpolantSettings;r?(u.endingStart=ZeroSlopeEnding,u.endingEnd=ZeroSlopeEnding):(t?u.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:u.endingStart=WrapAroundEnding,o?u.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:u.endingEnd=WrapAroundEnding)}_scheduleFading(t,o,r){const u=this._mixer,d=u.time;let C=this._weightInterpolant;C===null&&(C=u._lendControlInterpolant(),this._weightInterpolant=C);const I=C.parameterPositions,f=C.sampleValues;return I[0]=d,f[0]=o,I[1]=d+t,f[1]=r,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher$1{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,o){const r=t._localRoot||this._root,u=t._clip.tracks,d=u.length,C=t._propertyBindings,I=t._interpolants,f=r.uuid,A=this._bindingsByRootAndName;let G=A[f];G===void 0&&(G={},A[f]=G);for(let B=0;B!==d;++B){const Z=u[B],w=Z.name;let V=G[w];if(V!==void 0)++V.referenceCount,C[B]=V;else{if(V=C[B],V!==void 0){V._cacheIndex===null&&(++V.referenceCount,this._addInactiveBinding(V,f,w));continue}const Y=o&&o._propertyBindings[B].binding.parsedPath;V=new PropertyMixer(PropertyBinding.create(r,w,Y),Z.ValueTypeName,Z.getValueSize()),++V.referenceCount,this._addInactiveBinding(V,f,w),C[B]=V}I[B].resultBuffer=V.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,u=t._clip.uuid,d=this._actionsByClip[u];this._bindAction(t,d&&d.knownActions[0]),this._addInactiveAction(t,u,r)}const o=t._propertyBindings;for(let r=0,u=o.length;r!==u;++r){const d=o[r];d.useCount++===0&&(this._lendBinding(d),d.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const o=t._propertyBindings;for(let r=0,u=o.length;r!==u;++r){const d=o[r];--d.useCount===0&&(d.restoreOriginalState(),this._takeBackBinding(d))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const o=t._cacheIndex;return o!==null&&o<this._nActiveActions}_addInactiveAction(t,o,r){const u=this._actions,d=this._actionsByClip;let C=d[o];if(C===void 0)C={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,d[o]=C;else{const I=C.knownActions;t._byClipCacheIndex=I.length,I.push(t)}t._cacheIndex=u.length,u.push(t),C.actionByRoot[r]=t}_removeInactiveAction(t){const o=this._actions,r=o[o.length-1],u=t._cacheIndex;r._cacheIndex=u,o[u]=r,o.pop(),t._cacheIndex=null;const d=t._clip.uuid,C=this._actionsByClip,I=C[d],f=I.knownActions,A=f[f.length-1],G=t._byClipCacheIndex;A._byClipCacheIndex=G,f[G]=A,f.pop(),t._byClipCacheIndex=null;const B=I.actionByRoot,Z=(t._localRoot||this._root).uuid;delete B[Z],f.length===0&&delete C[d],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const o=t._propertyBindings;for(let r=0,u=o.length;r!==u;++r){const d=o[r];--d.referenceCount===0&&this._removeInactiveBinding(d)}}_lendAction(t){const o=this._actions,r=t._cacheIndex,u=this._nActiveActions++,d=o[u];t._cacheIndex=u,o[u]=t,d._cacheIndex=r,o[r]=d}_takeBackAction(t){const o=this._actions,r=t._cacheIndex,u=--this._nActiveActions,d=o[u];t._cacheIndex=u,o[u]=t,d._cacheIndex=r,o[r]=d}_addInactiveBinding(t,o,r){const u=this._bindingsByRootAndName,d=this._bindings;let C=u[o];C===void 0&&(C={},u[o]=C),C[r]=t,t._cacheIndex=d.length,d.push(t)}_removeInactiveBinding(t){const o=this._bindings,r=t.binding,u=r.rootNode.uuid,d=r.path,C=this._bindingsByRootAndName,I=C[u],f=o[o.length-1],A=t._cacheIndex;f._cacheIndex=A,o[A]=f,o.pop(),delete I[d],Object.keys(I).length===0&&delete C[u]}_lendBinding(t){const o=this._bindings,r=t._cacheIndex,u=this._nActiveBindings++,d=o[u];t._cacheIndex=u,o[u]=t,d._cacheIndex=r,o[r]=d}_takeBackBinding(t){const o=this._bindings,r=t._cacheIndex,u=--this._nActiveBindings,d=o[u];t._cacheIndex=u,o[u]=t,d._cacheIndex=r,o[r]=d}_lendControlInterpolant(){const t=this._controlInterpolants,o=this._nActiveControlInterpolants++;let r=t[o];return r===void 0&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),r.__cacheIndex=o,t[o]=r),r}_takeBackControlInterpolant(t){const o=this._controlInterpolants,r=t.__cacheIndex,u=--this._nActiveControlInterpolants,d=o[u];t.__cacheIndex=u,o[u]=t,d.__cacheIndex=r,o[r]=d}clipAction(t,o,r){const u=o||this._root,d=u.uuid;let C=typeof t=="string"?AnimationClip.findByName(u,t):t;const I=C!==null?C.uuid:t,f=this._actionsByClip[I];let A=null;if(r===void 0&&(C!==null?r=C.blendMode:r=NormalAnimationBlendMode),f!==void 0){const B=f.actionByRoot[d];if(B!==void 0&&B.blendMode===r)return B;A=f.knownActions[0],C===null&&(C=A._clip)}if(C===null)return null;const G=new AnimationAction(this,C,o,r);return this._bindAction(G,A),this._addInactiveAction(G,I,d),G}existingAction(t,o){const r=o||this._root,u=r.uuid,d=typeof t=="string"?AnimationClip.findByName(r,t):t,C=d?d.uuid:t,I=this._actionsByClip[C];return I!==void 0&&I.actionByRoot[u]||null}stopAllAction(){const t=this._actions,o=this._nActiveActions;for(let r=o-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const o=this._actions,r=this._nActiveActions,u=this.time+=t,d=Math.sign(t),C=this._accuIndex^=1;for(let A=0;A!==r;++A)o[A]._update(u,t,d,C);const I=this._bindings,f=this._nActiveBindings;for(let A=0;A!==f;++A)I[A].apply(C);return this}setTime(t){this.time=0;for(let o=0;o<this._actions.length;o++)this._actions[o].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const o=this._actions,r=t.uuid,u=this._actionsByClip,d=u[r];if(d!==void 0){const C=d.knownActions;for(let I=0,f=C.length;I!==f;++I){const A=C[I];this._deactivateAction(A);const G=A._cacheIndex,B=o[o.length-1];A._cacheIndex=null,A._byClipCacheIndex=null,B._cacheIndex=G,o[G]=B,o.pop(),this._removeInactiveBindingsForAction(A)}delete u[r]}}uncacheRoot(t){const o=t.uuid,r=this._actionsByClip;for(const C in r){const I=r[C].actionByRoot,f=I[o];f!==void 0&&(this._deactivateAction(f),this._removeInactiveAction(f))}const u=this._bindingsByRootAndName,d=u[o];if(d!==void 0)for(const C in d){const I=d[C];I.restoreOriginalState(),this._removeInactiveBinding(I)}}uncacheAction(t,o){const r=this.existingAction(t,o);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class RenderTarget3D extends RenderTarget{constructor(t=1,o=1,r=1,u={}){super(t,o,u),this.isRenderTarget3D=!0,this.depth=r,this.texture=new Data3DTexture(null,t,o,r),this.texture.isRenderTargetTexture=!0}}class RenderTargetArray extends RenderTarget{constructor(t=1,o=1,r=1,u={}){super(t,o,u),this.isRenderTargetArray=!0,this.depth=r,this.texture=new DataArrayTexture(null,t,o,r),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(t){this.value=t}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id$3=0;class UniformsGroup extends EventDispatcher$1{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id$3++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const o=this.uniforms.indexOf(t);return o!==-1&&this.uniforms.splice(o,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const o=t.uniforms;this.uniforms.length=0;for(let r=0,u=o.length;r<u;r++){const d=Array.isArray(o[r])?o[r]:[o[r]];for(let C=0;C<d.length;C++)this.uniforms.push(d[C].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,o,r=1){super(t,o),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const o=super.clone(t);return o.meshPerAttribute=this.meshPerAttribute,o}toJSON(t){const o=super.toJSON(t);return o.isInstancedInterleavedBuffer=!0,o.meshPerAttribute=this.meshPerAttribute,o}}class GLBufferAttribute{constructor(t,o,r,u,d){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=o,this.itemSize=r,this.elementSize=u,this.count=d,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,o){return this.type=t,this.elementSize=o,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const _matrix=new Matrix4;class Raycaster{constructor(t,o,r=0,u=1/0){this.ray=new Ray$2(t,o),this.near=r,this.far=u,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,o){this.ray.set(t,o)}setFromCamera(t,o){o.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(o.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(o).sub(this.ray.origin).normalize(),this.camera=o):o.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(o.near+o.far)/(o.near-o.far)).unproject(o),this.ray.direction.set(0,0,-1).transformDirection(o.matrixWorld),this.camera=o):console.error("THREE.Raycaster: Unsupported camera type: "+o.type)}setFromXRController(t){return _matrix.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix),this}intersectObject(t,o=!0,r=[]){return intersect$2(t,this,r,o),r.sort(ascSort),r}intersectObjects(t,o=!0,r=[]){for(let u=0,d=t.length;u<d;u++)intersect$2(t[u],this,r,o);return r.sort(ascSort),r}}function ascSort(n,t){return n.distance-t.distance}function intersect$2(n,t,o,r){let u=!0;if(n.layers.test(t.layers)&&n.raycast(t,o)===!1&&(u=!1),u===!0&&r===!0){const d=n.children;for(let C=0,I=d.length;C<I;C++)intersect$2(d[C],t,o,!0)}}class Spherical{constructor(t=1,o=0,r=0){this.radius=t,this.phi=o,this.theta=r}set(t,o,r){return this.radius=t,this.phi=o,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=clamp(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,o,r){return this.radius=Math.sqrt(t*t+o*o+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(clamp(o/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(t=1,o=0,r=0){this.radius=t,this.theta=o,this.y=r}set(t,o,r){return this.radius=t,this.theta=o,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,o,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=o,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(t,o,r,u){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,o,r,u)}identity(){return this.set(1,0,0,1),this}fromArray(t,o=0){for(let r=0;r<4;r++)this.elements[r]=t[r+o];return this}set(t,o,r,u){const d=this.elements;return d[0]=t,d[2]=o,d[1]=r,d[3]=u,this}}const _vector$4=new Vector2;class Box2{constructor(t=new Vector2(1/0,1/0),o=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=o}set(t,o){return this.min.copy(t),this.max.copy(o),this}setFromPoints(t){this.makeEmpty();for(let o=0,r=t.length;o<r;o++)this.expandByPoint(t[o]);return this}setFromCenterAndSize(t,o){const r=_vector$4.copy(o).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,o){return o.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,o){return o.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$4).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(t=new Vector3,o=new Vector3){this.start=t,this.end=o}set(t,o){return this.start.copy(t),this.end.copy(o),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,o){return this.delta(o).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,o){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const r=_startEnd.dot(_startEnd);let d=_startEnd.dot(_startP)/r;return o&&(d=clamp(d,0,1)),d}closestPointToPoint(t,o,r){const u=this.closestPointToPointParameter(t,o);return this.delta(r).multiplyScalar(u).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(t,o){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=o,this.type="SpotLightHelper";const r=new BufferGeometry,u=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let C=0,I=1,f=32;C<f;C++,I++){const A=C/f*Math.PI*2,G=I/f*Math.PI*2;u.push(Math.cos(A),Math.sin(A),1,Math.cos(G),Math.sin(G),1)}r.setAttribute("position",new Float32BufferAttribute(u,3));const d=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,d),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,o=t*Math.tan(this.light.angle);this.cone.scale.set(o,o,t),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const o=getBoneList(t),r=new BufferGeometry,u=[],d=[],C=new Color(0,0,1),I=new Color(0,1,0);for(let A=0;A<o.length;A++){const G=o[A];G.parent&&G.parent.isBone&&(u.push(0,0,0),u.push(0,0,0),d.push(C.r,C.g,C.b),d.push(I.r,I.g,I.b))}r.setAttribute("position",new Float32BufferAttribute(u,3)),r.setAttribute("color",new Float32BufferAttribute(d,3));const f=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,f),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=o,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const o=this.bones,r=this.geometry,u=r.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let d=0,C=0;d<o.length;d++){const I=o[d];I.parent&&I.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,I.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),u.setXYZ(C,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,I.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),u.setXYZ(C+1,_vector$2.x,_vector$2.y,_vector$2.z),C+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(n){const t=[];n.isBone===!0&&t.push(n);for(let o=0;o<n.children.length;o++)t.push(...getBoneList(n.children[o]));return t}class PointLightHelper extends Mesh{constructor(t,o,r){const u=new SphereGeometry(o,4,2),d=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(u,d),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(t,o,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const u=new OctahedronGeometry(o);u.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const d=u.getAttribute("position"),C=new Float32Array(d.count*3);u.setAttribute("color",new BufferAttribute(C,3)),this.add(new Mesh(u,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const o=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let r=0,u=o.count;r<u;r++){const d=r<u/2?_color1:_color2;o.setXYZ(r,d.r,d.g,d.b)}o.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,o=10,r=4473924,u=8947848){r=new Color(r),u=new Color(u);const d=o/2,C=t/o,I=t/2,f=[],A=[];for(let Z=0,w=0,V=-I;Z<=o;Z++,V+=C){f.push(-I,0,V,I,0,V),f.push(V,0,-I,V,0,I);const Y=Z===d?r:u;Y.toArray(A,w),w+=3,Y.toArray(A,w),w+=3,Y.toArray(A,w),w+=3,Y.toArray(A,w),w+=3}const G=new BufferGeometry;G.setAttribute("position",new Float32BufferAttribute(f,3)),G.setAttribute("color",new Float32BufferAttribute(A,3));const B=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(G,B),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(t=10,o=16,r=8,u=64,d=4473924,C=8947848){d=new Color(d),C=new Color(C);const I=[],f=[];if(o>1)for(let B=0;B<o;B++){const Z=B/o*(Math.PI*2),w=Math.sin(Z)*t,V=Math.cos(Z)*t;I.push(0,0,0),I.push(w,0,V);const Y=B&1?d:C;f.push(Y.r,Y.g,Y.b),f.push(Y.r,Y.g,Y.b)}for(let B=0;B<r;B++){const Z=B&1?d:C,w=t-t/r*B;for(let V=0;V<u;V++){let Y=V/u*(Math.PI*2),J=Math.sin(Y)*w,T=Math.cos(Y)*w;I.push(J,0,T),f.push(Z.r,Z.g,Z.b),Y=(V+1)/u*(Math.PI*2),J=Math.sin(Y)*w,T=Math.cos(Y)*w,I.push(J,0,T),f.push(Z.r,Z.g,Z.b)}}const A=new BufferGeometry;A.setAttribute("position",new Float32BufferAttribute(I,3)),A.setAttribute("color",new Float32BufferAttribute(f,3));const G=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(A,G),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,o,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",o===void 0&&(o=1);let u=new BufferGeometry;u.setAttribute("position",new Float32BufferAttribute([-o,o,0,o,o,0,o,-o,0,-o,-o,0,-o,o,0],3));const d=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(u,d),this.add(this.lightPlane),u=new BufferGeometry,u.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(u,d),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(t){const o=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),u=[],d=[],C={};I("n1","n2"),I("n2","n4"),I("n4","n3"),I("n3","n1"),I("f1","f2"),I("f2","f4"),I("f4","f3"),I("f3","f1"),I("n1","f1"),I("n2","f2"),I("n3","f3"),I("n4","f4"),I("p","n1"),I("p","n2"),I("p","n3"),I("p","n4"),I("u1","u2"),I("u2","u3"),I("u3","u1"),I("c","t"),I("p","c"),I("cn1","cn2"),I("cn3","cn4"),I("cf1","cf2"),I("cf3","cf4");function I(V,Y){f(V),f(Y)}function f(V){u.push(0,0,0),d.push(0,0,0),C[V]===void 0&&(C[V]=[]),C[V].push(u.length/3-1)}o.setAttribute("position",new Float32BufferAttribute(u,3)),o.setAttribute("color",new Float32BufferAttribute(d,3)),super(o,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=C,this.update();const A=new Color(16755200),G=new Color(16711680),B=new Color(43775),Z=new Color(16777215),w=new Color(3355443);this.setColors(A,G,B,Z,w)}setColors(t,o,r,u,d){const I=this.geometry.getAttribute("color");I.setXYZ(0,t.r,t.g,t.b),I.setXYZ(1,t.r,t.g,t.b),I.setXYZ(2,t.r,t.g,t.b),I.setXYZ(3,t.r,t.g,t.b),I.setXYZ(4,t.r,t.g,t.b),I.setXYZ(5,t.r,t.g,t.b),I.setXYZ(6,t.r,t.g,t.b),I.setXYZ(7,t.r,t.g,t.b),I.setXYZ(8,t.r,t.g,t.b),I.setXYZ(9,t.r,t.g,t.b),I.setXYZ(10,t.r,t.g,t.b),I.setXYZ(11,t.r,t.g,t.b),I.setXYZ(12,t.r,t.g,t.b),I.setXYZ(13,t.r,t.g,t.b),I.setXYZ(14,t.r,t.g,t.b),I.setXYZ(15,t.r,t.g,t.b),I.setXYZ(16,t.r,t.g,t.b),I.setXYZ(17,t.r,t.g,t.b),I.setXYZ(18,t.r,t.g,t.b),I.setXYZ(19,t.r,t.g,t.b),I.setXYZ(20,t.r,t.g,t.b),I.setXYZ(21,t.r,t.g,t.b),I.setXYZ(22,t.r,t.g,t.b),I.setXYZ(23,t.r,t.g,t.b),I.setXYZ(24,o.r,o.g,o.b),I.setXYZ(25,o.r,o.g,o.b),I.setXYZ(26,o.r,o.g,o.b),I.setXYZ(27,o.r,o.g,o.b),I.setXYZ(28,o.r,o.g,o.b),I.setXYZ(29,o.r,o.g,o.b),I.setXYZ(30,o.r,o.g,o.b),I.setXYZ(31,o.r,o.g,o.b),I.setXYZ(32,r.r,r.g,r.b),I.setXYZ(33,r.r,r.g,r.b),I.setXYZ(34,r.r,r.g,r.b),I.setXYZ(35,r.r,r.g,r.b),I.setXYZ(36,r.r,r.g,r.b),I.setXYZ(37,r.r,r.g,r.b),I.setXYZ(38,u.r,u.g,u.b),I.setXYZ(39,u.r,u.g,u.b),I.setXYZ(40,d.r,d.g,d.b),I.setXYZ(41,d.r,d.g,d.b),I.setXYZ(42,d.r,d.g,d.b),I.setXYZ(43,d.r,d.g,d.b),I.setXYZ(44,d.r,d.g,d.b),I.setXYZ(45,d.r,d.g,d.b),I.setXYZ(46,d.r,d.g,d.b),I.setXYZ(47,d.r,d.g,d.b),I.setXYZ(48,d.r,d.g,d.b),I.setXYZ(49,d.r,d.g,d.b),I.needsUpdate=!0}update(){const t=this.geometry,o=this.pointMap,r=1,u=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const d=this.camera.coordinateSystem===WebGLCoordinateSystem?-1:0;setPoint("c",o,t,_camera,0,0,d),setPoint("t",o,t,_camera,0,0,1),setPoint("n1",o,t,_camera,-1,-1,d),setPoint("n2",o,t,_camera,r,-1,d),setPoint("n3",o,t,_camera,-1,u,d),setPoint("n4",o,t,_camera,r,u,d),setPoint("f1",o,t,_camera,-1,-1,1),setPoint("f2",o,t,_camera,r,-1,1),setPoint("f3",o,t,_camera,-1,u,1),setPoint("f4",o,t,_camera,r,u,1),setPoint("u1",o,t,_camera,r*.7,u*1.1,d),setPoint("u2",o,t,_camera,-1*.7,u*1.1,d),setPoint("u3",o,t,_camera,0,u*2,d),setPoint("cf1",o,t,_camera,-1,0,1),setPoint("cf2",o,t,_camera,r,0,1),setPoint("cf3",o,t,_camera,0,-1,1),setPoint("cf4",o,t,_camera,0,u,1),setPoint("cn1",o,t,_camera,-1,0,d),setPoint("cn2",o,t,_camera,r,0,d),setPoint("cn3",o,t,_camera,0,-1,d),setPoint("cn4",o,t,_camera,0,u,d),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(n,t,o,r,u,d,C){_vector.set(u,d,C).unproject(r);const I=t[n];if(I!==void 0){const f=o.getAttribute("position");for(let A=0,G=I.length;A<G;A++)f.setXYZ(I[A],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(t,o=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),u=new Float32Array(8*3),d=new BufferGeometry;d.setIndex(new BufferAttribute(r,1)),d.setAttribute("position",new BufferAttribute(u,3)),super(d,new LineBasicMaterial({color:o,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const t=_box.min,o=_box.max,r=this.geometry.attributes.position,u=r.array;u[0]=o.x,u[1]=o.y,u[2]=o.z,u[3]=t.x,u[4]=o.y,u[5]=o.z,u[6]=t.x,u[7]=t.y,u[8]=o.z,u[9]=o.x,u[10]=t.y,u[11]=o.z,u[12]=o.x,u[13]=o.y,u[14]=t.z,u[15]=t.x,u[16]=o.y,u[17]=t.z,u[18]=t.x,u[19]=t.y,u[20]=t.z,u[21]=o.x,u[22]=t.y,u[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,o){return super.copy(t,o),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(t,o=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),u=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],d=new BufferGeometry;d.setIndex(new BufferAttribute(r,1)),d.setAttribute("position",new Float32BufferAttribute(u,3)),super(d,new LineBasicMaterial({color:o,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const o=this.box;o.isEmpty()||(o.getCenter(this.position),o.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(t,o=1,r=16776960){const u=r,d=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],C=new BufferGeometry;C.setAttribute("position",new Float32BufferAttribute(d,3)),C.computeBoundingSphere(),super(C,new LineBasicMaterial({color:u,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=o;const I=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],f=new BufferGeometry;f.setAttribute("position",new Float32BufferAttribute(I,3)),f.computeBoundingSphere(),this.add(new Mesh(f,new MeshBasicMaterial({color:u,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(t=new Vector3(0,0,1),o=new Vector3(0,0,0),r=1,u=16776960,d=r*.2,C=d*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(o),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:u,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:u,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,d,C)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();const o=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,o)}}setLength(t,o=t*.2,r=o*.2){this.line.scale.set(1,Math.max(1e-4,t-o),1),this.line.updateMatrix(),this.cone.scale.set(r,o,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(t=1){const o=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],u=new BufferGeometry;u.setAttribute("position",new Float32BufferAttribute(o,3)),u.setAttribute("color",new Float32BufferAttribute(r,3));const d=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(u,d),this.type="AxesHelper"}setColors(t,o,r){const u=new Color,d=this.geometry.attributes.color.array;return u.set(t),u.toArray(d,0),u.toArray(d,3),u.set(o),u.toArray(d,6),u.toArray(d,9),u.set(r),u.toArray(d,12),u.toArray(d,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(t,o){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,o),this}lineTo(t,o){return this.currentPath.lineTo(t,o),this}quadraticCurveTo(t,o,r,u){return this.currentPath.quadraticCurveTo(t,o,r,u),this}bezierCurveTo(t,o,r,u,d,C){return this.currentPath.bezierCurveTo(t,o,r,u,d,C),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function o(T){const L=[];for(let z=0,K=T.length;z<K;z++){const P=T[z],$=new Shape$2;$.curves=P.curves,L.push($)}return L}function r(T,L){const z=L.length;let K=!1;for(let P=z-1,$=0;$<z;P=$++){let ie=L[P],ne=L[$],ee=ne.x-ie.x,se=ne.y-ie.y;if(Math.abs(se)>Number.EPSILON){if(se<0&&(ie=L[$],ee=-ee,ne=L[P],se=-se),T.y<ie.y||T.y>ne.y)continue;if(T.y===ie.y){if(T.x===ie.x)return!0}else{const re=se*(T.x-ie.x)-ee*(T.y-ie.y);if(re===0)return!0;if(re<0)continue;K=!K}}else{if(T.y!==ie.y)continue;if(ne.x<=T.x&&T.x<=ie.x||ie.x<=T.x&&T.x<=ne.x)return!0}}return K}const u=ShapeUtils.isClockWise,d=this.subPaths;if(d.length===0)return[];let C,I,f;const A=[];if(d.length===1)return I=d[0],f=new Shape$2,f.curves=I.curves,A.push(f),A;let G=!u(d[0].getPoints());G=t?!G:G;const B=[],Z=[];let w=[],V=0,Y;Z[V]=void 0,w[V]=[];for(let T=0,L=d.length;T<L;T++)I=d[T],Y=I.getPoints(),C=u(Y),C=t?!C:C,C?(!G&&Z[V]&&V++,Z[V]={s:new Shape$2,p:Y},Z[V].s.curves=I.curves,G&&V++,w[V]=[]):w[V].push({h:I,p:Y[0]});if(!Z[0])return o(d);if(Z.length>1){let T=!1,L=0;for(let z=0,K=Z.length;z<K;z++)B[z]=[];for(let z=0,K=Z.length;z<K;z++){const P=w[z];for(let $=0;$<P.length;$++){const ie=P[$];let ne=!0;for(let ee=0;ee<Z.length;ee++)r(ie.p,Z[ee].p)&&(z!==ee&&L++,ne?(ne=!1,B[ee].push(ie)):T=!0);ne&&B[z].push(ie)}}L>0&&T===!1&&(w=B)}let J;for(let T=0,L=Z.length;T<L;T++){f=Z[T].s,A.push(f),J=w[T];for(let z=0,K=J.length;z<K;z++)f.holes.push(J[z].h)}return A}}class Controls extends EventDispatcher$1{constructor(t,o=null){super(),this.object=t,this.domElement=o,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function contain(n,t){const o=n.image&&n.image.width?n.image.width/n.image.height:1;return o>t?(n.repeat.x=1,n.repeat.y=o/t,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=t/o,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function cover(n,t){const o=n.image&&n.image.width?n.image.width/n.image.height:1;return o>t?(n.repeat.x=t/o,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=o/t,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function fill(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function getByteLength(n,t,o,r){const u=getTextureTypeByteLength(r);switch(o){case AlphaFormat:return n*t;case LuminanceFormat:return n*t;case LuminanceAlphaFormat:return n*t*2;case RedFormat:return n*t/u.components*u.byteLength;case RedIntegerFormat:return n*t/u.components*u.byteLength;case RGFormat:return n*t*2/u.components*u.byteLength;case RGIntegerFormat:return n*t*2/u.components*u.byteLength;case RGBFormat:return n*t*3/u.components*u.byteLength;case RGBAFormat:return n*t*4/u.components*u.byteLength;case RGBAIntegerFormat:return n*t*4/u.components*u.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(n,16)*Math.max(t,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(n,8)*Math.max(t,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((n+4)/5)*Math.floor((t+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((n+4)/5)*Math.floor((t+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((n+5)/6)*Math.floor((t+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((n+5)/6)*Math.floor((t+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((n+7)/8)*Math.floor((t+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((n+7)/8)*Math.floor((t+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((n+7)/8)*Math.floor((t+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((n+9)/10)*Math.floor((t+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((n+9)/10)*Math.floor((t+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((n+9)/10)*Math.floor((t+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((n+9)/10)*Math.floor((t+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((n+11)/12)*Math.floor((t+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((n+11)/12)*Math.floor((t+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(n/4)*Math.ceil(t/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(n/4)*Math.ceil(t/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(n/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${o} format.`)}function getTextureTypeByteLength(n){switch(n){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class TextureUtils{static contain(t,o){return contain(t,o)}static cover(t,o){return cover(t,o)}static fill(t){return fill(t)}static getByteLength(t,o,r,u){return getByteLength(t,o,r,u)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function WebGLAnimation(){let n=null,t=!1,o=null,r=null;function u(d,C){o(d,C),r=n.requestAnimationFrame(u)}return{start:function(){t!==!0&&o!==null&&(r=n.requestAnimationFrame(u),t=!0)},stop:function(){n.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(d){o=d},setContext:function(d){n=d}}}function WebGLAttributes(n){const t=new WeakMap;function o(I,f){const A=I.array,G=I.usage,B=A.byteLength,Z=n.createBuffer();n.bindBuffer(f,Z),n.bufferData(f,A,G),I.onUploadCallback();let w;if(A instanceof Float32Array)w=n.FLOAT;else if(A instanceof Uint16Array)I.isFloat16BufferAttribute?w=n.HALF_FLOAT:w=n.UNSIGNED_SHORT;else if(A instanceof Int16Array)w=n.SHORT;else if(A instanceof Uint32Array)w=n.UNSIGNED_INT;else if(A instanceof Int32Array)w=n.INT;else if(A instanceof Int8Array)w=n.BYTE;else if(A instanceof Uint8Array)w=n.UNSIGNED_BYTE;else if(A instanceof Uint8ClampedArray)w=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+A);return{buffer:Z,type:w,bytesPerElement:A.BYTES_PER_ELEMENT,version:I.version,size:B}}function r(I,f,A){const G=f.array,B=f.updateRanges;if(n.bindBuffer(A,I),B.length===0)n.bufferSubData(A,0,G);else{B.sort((w,V)=>w.start-V.start);let Z=0;for(let w=1;w<B.length;w++){const V=B[Z],Y=B[w];Y.start<=V.start+V.count+1?V.count=Math.max(V.count,Y.start+Y.count-V.start):(++Z,B[Z]=Y)}B.length=Z+1;for(let w=0,V=B.length;w<V;w++){const Y=B[w];n.bufferSubData(A,Y.start*G.BYTES_PER_ELEMENT,G,Y.start,Y.count)}f.clearUpdateRanges()}f.onUploadCallback()}function u(I){return I.isInterleavedBufferAttribute&&(I=I.data),t.get(I)}function d(I){I.isInterleavedBufferAttribute&&(I=I.data);const f=t.get(I);f&&(n.deleteBuffer(f.buffer),t.delete(I))}function C(I,f){if(I.isInterleavedBufferAttribute&&(I=I.data),I.isGLBufferAttribute){const G=t.get(I);(!G||G.version<I.version)&&t.set(I,{buffer:I.buffer,type:I.type,bytesPerElement:I.elementSize,version:I.version});return}const A=t.get(I);if(A===void 0)t.set(I,o(I,f));else if(A.version<I.version){if(A.size!==I.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(A.buffer,I,f),A.version=I.version}}return{get:u,remove:d,update:C}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(n,t,o,r,u,d,C){const I=new Color(0);let f=d===!0?0:1,A,G,B=null,Z=0,w=null;function V(z){let K=z.isScene===!0?z.background:null;return K&&K.isTexture&&(K=(z.backgroundBlurriness>0?o:t).get(K)),K}function Y(z){let K=!1;const P=V(z);P===null?T(I,f):P&&P.isColor&&(T(P,1),K=!0);const $=n.xr.getEnvironmentBlendMode();$==="additive"?r.buffers.color.setClear(0,0,0,1,C):$==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,C),(n.autoClear||K)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function J(z,K){const P=V(K);P&&(P.isCubeTexture||P.mapping===CubeUVReflectionMapping)?(G===void 0&&(G=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function($,ie,ne){this.matrixWorld.copyPosition(ne.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(G)),_e1$1.copy(K.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,P.isCubeTexture&&P.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),G.material.uniforms.envMap.value=P,G.material.uniforms.flipEnvMap.value=P.isCubeTexture&&P.isRenderTargetTexture===!1?-1:1,G.material.uniforms.backgroundBlurriness.value=K.backgroundBlurriness,G.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,G.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),G.material.toneMapped=ColorManagement.getTransfer(P.colorSpace)!==SRGBTransfer,(B!==P||Z!==P.version||w!==n.toneMapping)&&(G.material.needsUpdate=!0,B=P,Z=P.version,w=n.toneMapping),G.layers.enableAll(),z.unshift(G,G.geometry,G.material,0,0,null)):P&&P.isTexture&&(A===void 0&&(A=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),Object.defineProperty(A.material,"map",{get:function(){return this.uniforms.t2D.value}}),u.update(A)),A.material.uniforms.t2D.value=P,A.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,A.material.toneMapped=ColorManagement.getTransfer(P.colorSpace)!==SRGBTransfer,P.matrixAutoUpdate===!0&&P.updateMatrix(),A.material.uniforms.uvTransform.value.copy(P.matrix),(B!==P||Z!==P.version||w!==n.toneMapping)&&(A.material.needsUpdate=!0,B=P,Z=P.version,w=n.toneMapping),A.layers.enableAll(),z.unshift(A,A.geometry,A.material,0,0,null))}function T(z,K){z.getRGB(_rgb,getUnlitUniformColorSpace(n)),r.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,K,C)}function L(){G!==void 0&&(G.geometry.dispose(),G.material.dispose(),G=void 0),A!==void 0&&(A.geometry.dispose(),A.material.dispose(),A=void 0)}return{getClearColor:function(){return I},setClearColor:function(z,K=1){I.set(z),f=K,T(I,f)},getClearAlpha:function(){return f},setClearAlpha:function(z){f=z,T(I,f)},render:Y,addToRenderList:J,dispose:L}}function WebGLBindingStates(n,t){const o=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},u=Z(null);let d=u,C=!1;function I(se,re,ce,ue,ye){let Se=!1;const Ce=B(ue,ce,re);d!==Ce&&(d=Ce,A(d.object)),Se=w(se,ue,ce,ye),Se&&V(se,ue,ce,ye),ye!==null&&t.update(ye,n.ELEMENT_ARRAY_BUFFER),(Se||C)&&(C=!1,K(se,re,ce,ue),ye!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(ye).buffer))}function f(){return n.createVertexArray()}function A(se){return n.bindVertexArray(se)}function G(se){return n.deleteVertexArray(se)}function B(se,re,ce){const ue=ce.wireframe===!0;let ye=r[se.id];ye===void 0&&(ye={},r[se.id]=ye);let Se=ye[re.id];Se===void 0&&(Se={},ye[re.id]=Se);let Ce=Se[ue];return Ce===void 0&&(Ce=Z(f()),Se[ue]=Ce),Ce}function Z(se){const re=[],ce=[],ue=[];for(let ye=0;ye<o;ye++)re[ye]=0,ce[ye]=0,ue[ye]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:re,enabledAttributes:ce,attributeDivisors:ue,object:se,attributes:{},index:null}}function w(se,re,ce,ue){const ye=d.attributes,Se=re.attributes;let Ce=0;const Ze=ce.getAttributes();for(const Be in Ze)if(Ze[Be].location>=0){const ge=ye[Be];let de=Se[Be];if(de===void 0&&(Be==="instanceMatrix"&&se.instanceMatrix&&(de=se.instanceMatrix),Be==="instanceColor"&&se.instanceColor&&(de=se.instanceColor)),ge===void 0||ge.attribute!==de||de&&ge.data!==de.data)return!0;Ce++}return d.attributesNum!==Ce||d.index!==ue}function V(se,re,ce,ue){const ye={},Se=re.attributes;let Ce=0;const Ze=ce.getAttributes();for(const Be in Ze)if(Ze[Be].location>=0){let ge=Se[Be];ge===void 0&&(Be==="instanceMatrix"&&se.instanceMatrix&&(ge=se.instanceMatrix),Be==="instanceColor"&&se.instanceColor&&(ge=se.instanceColor));const de={};de.attribute=ge,ge&&ge.data&&(de.data=ge.data),ye[Be]=de,Ce++}d.attributes=ye,d.attributesNum=Ce,d.index=ue}function Y(){const se=d.newAttributes;for(let re=0,ce=se.length;re<ce;re++)se[re]=0}function J(se){T(se,0)}function T(se,re){const ce=d.newAttributes,ue=d.enabledAttributes,ye=d.attributeDivisors;ce[se]=1,ue[se]===0&&(n.enableVertexAttribArray(se),ue[se]=1),ye[se]!==re&&(n.vertexAttribDivisor(se,re),ye[se]=re)}function L(){const se=d.newAttributes,re=d.enabledAttributes;for(let ce=0,ue=re.length;ce<ue;ce++)re[ce]!==se[ce]&&(n.disableVertexAttribArray(ce),re[ce]=0)}function z(se,re,ce,ue,ye,Se,Ce){Ce===!0?n.vertexAttribIPointer(se,re,ce,ye,Se):n.vertexAttribPointer(se,re,ce,ue,ye,Se)}function K(se,re,ce,ue){Y();const ye=ue.attributes,Se=ce.getAttributes(),Ce=re.defaultAttributeValues;for(const Ze in Se){const Be=Se[Ze];if(Be.location>=0){let xe=ye[Ze];if(xe===void 0&&(Ze==="instanceMatrix"&&se.instanceMatrix&&(xe=se.instanceMatrix),Ze==="instanceColor"&&se.instanceColor&&(xe=se.instanceColor)),xe!==void 0){const ge=xe.normalized,de=xe.itemSize,ve=t.get(xe);if(ve===void 0)continue;const le=ve.buffer,Ae=ve.type,Xe=ve.bytesPerElement,Te=Ae===n.INT||Ae===n.UNSIGNED_INT||xe.gpuType===IntType;if(xe.isInterleavedBufferAttribute){const Ne=xe.data,We=Ne.stride,dt=xe.offset;if(Ne.isInstancedInterleavedBuffer){for(let nt=0;nt<Be.locationSize;nt++)T(Be.location+nt,Ne.meshPerAttribute);se.isInstancedMesh!==!0&&ue._maxInstanceCount===void 0&&(ue._maxInstanceCount=Ne.meshPerAttribute*Ne.count)}else for(let nt=0;nt<Be.locationSize;nt++)J(Be.location+nt);n.bindBuffer(n.ARRAY_BUFFER,le);for(let nt=0;nt<Be.locationSize;nt++)z(Be.location+nt,de/Be.locationSize,Ae,ge,We*Xe,(dt+de/Be.locationSize*nt)*Xe,Te)}else{if(xe.isInstancedBufferAttribute){for(let Ne=0;Ne<Be.locationSize;Ne++)T(Be.location+Ne,xe.meshPerAttribute);se.isInstancedMesh!==!0&&ue._maxInstanceCount===void 0&&(ue._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Ne=0;Ne<Be.locationSize;Ne++)J(Be.location+Ne);n.bindBuffer(n.ARRAY_BUFFER,le);for(let Ne=0;Ne<Be.locationSize;Ne++)z(Be.location+Ne,de/Be.locationSize,Ae,ge,de*Xe,de/Be.locationSize*Ne*Xe,Te)}}else if(Ce!==void 0){const ge=Ce[Ze];if(ge!==void 0)switch(ge.length){case 2:n.vertexAttrib2fv(Be.location,ge);break;case 3:n.vertexAttrib3fv(Be.location,ge);break;case 4:n.vertexAttrib4fv(Be.location,ge);break;default:n.vertexAttrib1fv(Be.location,ge)}}}}L()}function P(){ne();for(const se in r){const re=r[se];for(const ce in re){const ue=re[ce];for(const ye in ue)G(ue[ye].object),delete ue[ye];delete re[ce]}delete r[se]}}function $(se){if(r[se.id]===void 0)return;const re=r[se.id];for(const ce in re){const ue=re[ce];for(const ye in ue)G(ue[ye].object),delete ue[ye];delete re[ce]}delete r[se.id]}function ie(se){for(const re in r){const ce=r[re];if(ce[se.id]===void 0)continue;const ue=ce[se.id];for(const ye in ue)G(ue[ye].object),delete ue[ye];delete ce[se.id]}}function ne(){ee(),C=!0,d!==u&&(d=u,A(d.object))}function ee(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:I,reset:ne,resetDefaultState:ee,dispose:P,releaseStatesOfGeometry:$,releaseStatesOfProgram:ie,initAttributes:Y,enableAttribute:J,disableUnusedAttributes:L}}function WebGLBufferRenderer(n,t,o){let r;function u(A){r=A}function d(A,G){n.drawArrays(r,A,G),o.update(G,r,1)}function C(A,G,B){B!==0&&(n.drawArraysInstanced(r,A,G,B),o.update(G,r,B))}function I(A,G,B){if(B===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,A,0,G,0,B);let w=0;for(let V=0;V<B;V++)w+=G[V];o.update(w,r,1)}function f(A,G,B,Z){if(B===0)return;const w=t.get("WEBGL_multi_draw");if(w===null)for(let V=0;V<A.length;V++)C(A[V],G[V],Z[V]);else{w.multiDrawArraysInstancedWEBGL(r,A,0,G,0,Z,0,B);let V=0;for(let Y=0;Y<B;Y++)V+=G[Y]*Z[Y];o.update(V,r,1)}}this.setMode=u,this.render=d,this.renderInstances=C,this.renderMultiDraw=I,this.renderMultiDrawInstances=f}function WebGLCapabilities(n,t,o,r){let u;function d(){if(u!==void 0)return u;if(t.has("EXT_texture_filter_anisotropic")===!0){const ie=t.get("EXT_texture_filter_anisotropic");u=n.getParameter(ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else u=0;return u}function C(ie){return!(ie!==RGBAFormat&&r.convert(ie)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function I(ie){const ne=ie===HalfFloatType&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(ie!==UnsignedByteType&&r.convert(ie)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&ie!==FloatType&&!ne)}function f(ie){if(ie==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";ie="mediump"}return ie==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let A=o.precision!==void 0?o.precision:"highp";const G=f(A);G!==A&&(console.warn("THREE.WebGLRenderer:",A,"not supported, using",G,"instead."),A=G);const B=o.logarithmicDepthBuffer===!0,Z=o.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),w=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),V=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Y=n.getParameter(n.MAX_TEXTURE_SIZE),J=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),T=n.getParameter(n.MAX_VERTEX_ATTRIBS),L=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),z=n.getParameter(n.MAX_VARYING_VECTORS),K=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),P=V>0,$=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:d,getMaxPrecision:f,textureFormatReadable:C,textureTypeReadable:I,precision:A,logarithmicDepthBuffer:B,reverseDepthBuffer:Z,maxTextures:w,maxVertexTextures:V,maxTextureSize:Y,maxCubemapSize:J,maxAttributes:T,maxVertexUniforms:L,maxVaryings:z,maxFragmentUniforms:K,vertexTextures:P,maxSamples:$}}function WebGLClipping(n){const t=this;let o=null,r=0,u=!1,d=!1;const C=new Plane$1,I=new Matrix3,f={value:null,needsUpdate:!1};this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(B,Z){const w=B.length!==0||Z||r!==0||u;return u=Z,r=B.length,w},this.beginShadows=function(){d=!0,G(null)},this.endShadows=function(){d=!1},this.setGlobalState=function(B,Z){o=G(B,Z,0)},this.setState=function(B,Z,w){const V=B.clippingPlanes,Y=B.clipIntersection,J=B.clipShadows,T=n.get(B);if(!u||V===null||V.length===0||d&&!J)d?G(null):A();else{const L=d?0:r,z=L*4;let K=T.clippingState||null;f.value=K,K=G(V,Z,z,w);for(let P=0;P!==z;++P)K[P]=o[P];T.clippingState=K,this.numIntersection=Y?this.numPlanes:0,this.numPlanes+=L}};function A(){f.value!==o&&(f.value=o,f.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function G(B,Z,w,V){const Y=B!==null?B.length:0;let J=null;if(Y!==0){if(J=f.value,V!==!0||J===null){const T=w+Y*4,L=Z.matrixWorldInverse;I.getNormalMatrix(L),(J===null||J.length<T)&&(J=new Float32Array(T));for(let z=0,K=w;z!==Y;++z,K+=4)C.copy(B[z]).applyMatrix4(L,I),C.normal.toArray(J,K),J[K+3]=C.constant}f.value=J,f.needsUpdate=!0}return t.numPlanes=Y,t.numIntersection=0,J}}function WebGLCubeMaps(n){let t=new WeakMap;function o(C,I){return I===EquirectangularReflectionMapping?C.mapping=CubeReflectionMapping:I===EquirectangularRefractionMapping&&(C.mapping=CubeRefractionMapping),C}function r(C){if(C&&C.isTexture){const I=C.mapping;if(I===EquirectangularReflectionMapping||I===EquirectangularRefractionMapping)if(t.has(C)){const f=t.get(C).texture;return o(f,C.mapping)}else{const f=C.image;if(f&&f.height>0){const A=new WebGLCubeRenderTarget(f.height);return A.fromEquirectangularTexture(n,C),t.set(C,A),C.addEventListener("dispose",u),o(A.texture,C.mapping)}else return null}}return C}function u(C){const I=C.target;I.removeEventListener("dispose",u);const f=t.get(I);f!==void 0&&(t.delete(I),f.dispose())}function d(){t=new WeakMap}return{get:r,dispose:d}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1)],_origin=new Vector3;class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,o=0,r=.1,u=100,d={}){const{size:C=256,position:I=_origin}=d;_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(C);const f=this._allocateTargets();return f.depthBuffer=!0,this._sceneToCubeUV(t,r,u,f,I),o>0&&this._blur(f,0,0,o),this._applyPMREM(f),this._cleanup(f),f}fromEquirectangular(t,o=null){return this._fromTexture(t,o)}fromCubemap(t,o=null){return this._fromTexture(t,o)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t,o){t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=o||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),o=4*this._cubeSize,r={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},u=_createRenderTarget(t,o,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(t,o,r);const{_lodMax:d}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(d)),this._blurMaterial=_getBlurShader(d,t,o)}return u}_compileMaterial(t){const o=new Mesh(this._lodPlanes[0],t);this._renderer.compile(o,_flatCamera)}_sceneToCubeUV(t,o,r,u,d){const f=new PerspectiveCamera(90,1,o,r),A=[1,-1,1,1,1,1],G=[1,1,1,-1,-1,-1],B=this._renderer,Z=B.autoClear,w=B.toneMapping;B.getClearColor(_clearColor),B.toneMapping=NoToneMapping,B.autoClear=!1;const V=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),Y=new Mesh(new BoxGeometry,V);let J=!1;const T=t.background;T?T.isColor&&(V.color.copy(T),t.background=null,J=!0):(V.color.copy(_clearColor),J=!0);for(let L=0;L<6;L++){const z=L%3;z===0?(f.up.set(0,A[L],0),f.position.set(d.x,d.y,d.z),f.lookAt(d.x+G[L],d.y,d.z)):z===1?(f.up.set(0,0,A[L]),f.position.set(d.x,d.y,d.z),f.lookAt(d.x,d.y+G[L],d.z)):(f.up.set(0,A[L],0),f.position.set(d.x,d.y,d.z),f.lookAt(d.x,d.y,d.z+G[L]));const K=this._cubeSize;_setViewport(u,z*K,L>2?K:0,K,K),B.setRenderTarget(u),J&&B.render(Y,f),B.render(t,f)}Y.geometry.dispose(),Y.material.dispose(),B.toneMapping=w,B.autoClear=Z,t.background=T}_textureToCubeUV(t,o){const r=this._renderer,u=t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping;u?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const d=u?this._cubemapMaterial:this._equirectMaterial,C=new Mesh(this._lodPlanes[0],d),I=d.uniforms;I.envMap.value=t;const f=this._cubeSize;_setViewport(o,0,0,3*f,2*f),r.setRenderTarget(o),r.render(C,_flatCamera)}_applyPMREM(t){const o=this._renderer,r=o.autoClear;o.autoClear=!1;const u=this._lodPlanes.length;for(let d=1;d<u;d++){const C=Math.sqrt(this._sigmas[d]*this._sigmas[d]-this._sigmas[d-1]*this._sigmas[d-1]),I=_axisDirections[(u-d-1)%_axisDirections.length];this._blur(t,d-1,d,C,I)}o.autoClear=r}_blur(t,o,r,u,d){const C=this._pingPongRenderTarget;this._halfBlur(t,C,o,r,u,"latitudinal",d),this._halfBlur(C,t,r,r,u,"longitudinal",d)}_halfBlur(t,o,r,u,d,C,I){const f=this._renderer,A=this._blurMaterial;C!=="latitudinal"&&C!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const G=3,B=new Mesh(this._lodPlanes[u],A),Z=A.uniforms,w=this._sizeLods[r]-1,V=isFinite(d)?Math.PI/(2*w):2*Math.PI/(2*MAX_SAMPLES-1),Y=d/V,J=isFinite(d)?1+Math.floor(G*Y):MAX_SAMPLES;J>MAX_SAMPLES&&console.warn(`sigmaRadians, ${d}, is too large and will clip, as it requested ${J} samples when the maximum is set to ${MAX_SAMPLES}`);const T=[];let L=0;for(let ie=0;ie<MAX_SAMPLES;++ie){const ne=ie/Y,ee=Math.exp(-ne*ne/2);T.push(ee),ie===0?L+=ee:ie<J&&(L+=2*ee)}for(let ie=0;ie<T.length;ie++)T[ie]=T[ie]/L;Z.envMap.value=t.texture,Z.samples.value=J,Z.weights.value=T,Z.latitudinal.value=C==="latitudinal",I&&(Z.poleAxis.value=I);const{_lodMax:z}=this;Z.dTheta.value=V,Z.mipInt.value=z-r;const K=this._sizeLods[u],P=3*K*(u>z-LOD_MIN?u-z+LOD_MIN:0),$=4*(this._cubeSize-K);_setViewport(o,P,$,3*K,2*K),f.setRenderTarget(o),f.render(B,_flatCamera)}}function _createPlanes(n){const t=[],o=[],r=[];let u=n;const d=n-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let C=0;C<d;C++){const I=Math.pow(2,u);o.push(I);let f=1/I;C>n-LOD_MIN?f=EXTRA_LOD_SIGMA[C-n+LOD_MIN-1]:C===0&&(f=0),r.push(f);const A=1/(I-2),G=-A,B=1+A,Z=[G,G,B,G,B,B,G,G,B,B,G,B],w=6,V=6,Y=3,J=2,T=1,L=new Float32Array(Y*V*w),z=new Float32Array(J*V*w),K=new Float32Array(T*V*w);for(let $=0;$<w;$++){const ie=$%3*2/3-1,ne=$>2?0:-1,ee=[ie,ne,0,ie+2/3,ne,0,ie+2/3,ne+1,0,ie,ne,0,ie+2/3,ne+1,0,ie,ne+1,0];L.set(ee,Y*V*$),z.set(Z,J*V*$);const se=[$,$,$,$,$,$];K.set(se,T*V*$)}const P=new BufferGeometry;P.setAttribute("position",new BufferAttribute(L,Y)),P.setAttribute("uv",new BufferAttribute(z,J)),P.setAttribute("faceIndex",new BufferAttribute(K,T)),t.push(P),u>LOD_MIN&&u--}return{lodPlanes:t,sizeLods:o,sigmas:r}}function _createRenderTarget(n,t,o){const r=new WebGLRenderTarget(n,t,o);return r.texture.mapping=CubeUVReflectionMapping,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _setViewport(n,t,o,r,u){n.viewport.set(t,o,r,u),n.scissor.set(t,o,r,u)}function _getBlurShader(n,t,o){const r=new Float32Array(MAX_SAMPLES),u=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/o,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:u}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(n){let t=new WeakMap,o=null;function r(I){if(I&&I.isTexture){const f=I.mapping,A=f===EquirectangularReflectionMapping||f===EquirectangularRefractionMapping,G=f===CubeReflectionMapping||f===CubeRefractionMapping;if(A||G){let B=t.get(I);const Z=B!==void 0?B.texture.pmremVersion:0;if(I.isRenderTargetTexture&&I.pmremVersion!==Z)return o===null&&(o=new PMREMGenerator(n)),B=A?o.fromEquirectangular(I,B):o.fromCubemap(I,B),B.texture.pmremVersion=I.pmremVersion,t.set(I,B),B.texture;if(B!==void 0)return B.texture;{const w=I.image;return A&&w&&w.height>0||G&&w&&u(w)?(o===null&&(o=new PMREMGenerator(n)),B=A?o.fromEquirectangular(I):o.fromCubemap(I),B.texture.pmremVersion=I.pmremVersion,t.set(I,B),I.addEventListener("dispose",d),B.texture):null}}}return I}function u(I){let f=0;const A=6;for(let G=0;G<A;G++)I[G]!==void 0&&f++;return f===A}function d(I){const f=I.target;f.removeEventListener("dispose",d);const A=t.get(f);A!==void 0&&(t.delete(f),A.dispose())}function C(){t=new WeakMap,o!==null&&(o.dispose(),o=null)}return{get:r,dispose:C}}function WebGLExtensions(n){const t={};function o(r){if(t[r]!==void 0)return t[r];let u;switch(r){case"WEBGL_depth_texture":u=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":u=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":u=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":u=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:u=n.getExtension(r)}return t[r]=u,u}return{has:function(r){return o(r)!==null},init:function(){o("EXT_color_buffer_float"),o("WEBGL_clip_cull_distance"),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float"),o("WEBGL_multisampled_render_to_texture"),o("WEBGL_render_shared_exponent")},get:function(r){const u=o(r);return u===null&&warnOnce("THREE.WebGLRenderer: "+r+" extension not supported."),u}}}function WebGLGeometries(n,t,o,r){const u={},d=new WeakMap;function C(B){const Z=B.target;Z.index!==null&&t.remove(Z.index);for(const V in Z.attributes)t.remove(Z.attributes[V]);Z.removeEventListener("dispose",C),delete u[Z.id];const w=d.get(Z);w&&(t.remove(w),d.delete(Z)),r.releaseStatesOfGeometry(Z),Z.isInstancedBufferGeometry===!0&&delete Z._maxInstanceCount,o.memory.geometries--}function I(B,Z){return u[Z.id]===!0||(Z.addEventListener("dispose",C),u[Z.id]=!0,o.memory.geometries++),Z}function f(B){const Z=B.attributes;for(const w in Z)t.update(Z[w],n.ARRAY_BUFFER)}function A(B){const Z=[],w=B.index,V=B.attributes.position;let Y=0;if(w!==null){const L=w.array;Y=w.version;for(let z=0,K=L.length;z<K;z+=3){const P=L[z+0],$=L[z+1],ie=L[z+2];Z.push(P,$,$,ie,ie,P)}}else if(V!==void 0){const L=V.array;Y=V.version;for(let z=0,K=L.length/3-1;z<K;z+=3){const P=z+0,$=z+1,ie=z+2;Z.push(P,$,$,ie,ie,P)}}else return;const J=new(arrayNeedsUint32(Z)?Uint32BufferAttribute:Uint16BufferAttribute)(Z,1);J.version=Y;const T=d.get(B);T&&t.remove(T),d.set(B,J)}function G(B){const Z=d.get(B);if(Z){const w=B.index;w!==null&&Z.version<w.version&&A(B)}else A(B);return d.get(B)}return{get:I,update:f,getWireframeAttribute:G}}function WebGLIndexedBufferRenderer(n,t,o){let r;function u(Z){r=Z}let d,C;function I(Z){d=Z.type,C=Z.bytesPerElement}function f(Z,w){n.drawElements(r,w,d,Z*C),o.update(w,r,1)}function A(Z,w,V){V!==0&&(n.drawElementsInstanced(r,w,d,Z*C,V),o.update(w,r,V))}function G(Z,w,V){if(V===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,w,0,d,Z,0,V);let J=0;for(let T=0;T<V;T++)J+=w[T];o.update(J,r,1)}function B(Z,w,V,Y){if(V===0)return;const J=t.get("WEBGL_multi_draw");if(J===null)for(let T=0;T<Z.length;T++)A(Z[T]/C,w[T],Y[T]);else{J.multiDrawElementsInstancedWEBGL(r,w,0,d,Z,0,Y,0,V);let T=0;for(let L=0;L<V;L++)T+=w[L]*Y[L];o.update(T,r,1)}}this.setMode=u,this.setIndex=I,this.render=f,this.renderInstances=A,this.renderMultiDraw=G,this.renderMultiDrawInstances=B}function WebGLInfo(n){const t={geometries:0,textures:0},o={frame:0,calls:0,triangles:0,points:0,lines:0};function r(d,C,I){switch(o.calls++,C){case n.TRIANGLES:o.triangles+=I*(d/3);break;case n.LINES:o.lines+=I*(d/2);break;case n.LINE_STRIP:o.lines+=I*(d-1);break;case n.LINE_LOOP:o.lines+=I*d;break;case n.POINTS:o.points+=I*d;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",C);break}}function u(){o.calls=0,o.triangles=0,o.points=0,o.lines=0}return{memory:t,render:o,programs:null,autoReset:!0,reset:u,update:r}}function WebGLMorphtargets(n,t,o){const r=new WeakMap,u=new Vector4;function d(C,I,f){const A=C.morphTargetInfluences,G=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,B=G!==void 0?G.length:0;let Z=r.get(I);if(Z===void 0||Z.count!==B){let se=function(){ne.dispose(),r.delete(I),I.removeEventListener("dispose",se)};var w=se;Z!==void 0&&Z.texture.dispose();const V=I.morphAttributes.position!==void 0,Y=I.morphAttributes.normal!==void 0,J=I.morphAttributes.color!==void 0,T=I.morphAttributes.position||[],L=I.morphAttributes.normal||[],z=I.morphAttributes.color||[];let K=0;V===!0&&(K=1),Y===!0&&(K=2),J===!0&&(K=3);let P=I.attributes.position.count*K,$=1;P>t.maxTextureSize&&($=Math.ceil(P/t.maxTextureSize),P=t.maxTextureSize);const ie=new Float32Array(P*$*4*B),ne=new DataArrayTexture(ie,P,$,B);ne.type=FloatType,ne.needsUpdate=!0;const ee=K*4;for(let re=0;re<B;re++){const ce=T[re],ue=L[re],ye=z[re],Se=P*$*4*re;for(let Ce=0;Ce<ce.count;Ce++){const Ze=Ce*ee;V===!0&&(u.fromBufferAttribute(ce,Ce),ie[Se+Ze+0]=u.x,ie[Se+Ze+1]=u.y,ie[Se+Ze+2]=u.z,ie[Se+Ze+3]=0),Y===!0&&(u.fromBufferAttribute(ue,Ce),ie[Se+Ze+4]=u.x,ie[Se+Ze+5]=u.y,ie[Se+Ze+6]=u.z,ie[Se+Ze+7]=0),J===!0&&(u.fromBufferAttribute(ye,Ce),ie[Se+Ze+8]=u.x,ie[Se+Ze+9]=u.y,ie[Se+Ze+10]=u.z,ie[Se+Ze+11]=ye.itemSize===4?u.w:1)}}Z={count:B,texture:ne,size:new Vector2(P,$)},r.set(I,Z),I.addEventListener("dispose",se)}if(C.isInstancedMesh===!0&&C.morphTexture!==null)f.getUniforms().setValue(n,"morphTexture",C.morphTexture,o);else{let V=0;for(let J=0;J<A.length;J++)V+=A[J];const Y=I.morphTargetsRelative?1:1-V;f.getUniforms().setValue(n,"morphTargetBaseInfluence",Y),f.getUniforms().setValue(n,"morphTargetInfluences",A)}f.getUniforms().setValue(n,"morphTargetsTexture",Z.texture,o),f.getUniforms().setValue(n,"morphTargetsTextureSize",Z.size)}return{update:d}}function WebGLObjects(n,t,o,r){let u=new WeakMap;function d(f){const A=r.render.frame,G=f.geometry,B=t.get(f,G);if(u.get(B)!==A&&(t.update(B),u.set(B,A)),f.isInstancedMesh&&(f.hasEventListener("dispose",I)===!1&&f.addEventListener("dispose",I),u.get(f)!==A&&(o.update(f.instanceMatrix,n.ARRAY_BUFFER),f.instanceColor!==null&&o.update(f.instanceColor,n.ARRAY_BUFFER),u.set(f,A))),f.isSkinnedMesh){const Z=f.skeleton;u.get(Z)!==A&&(Z.update(),u.set(Z,A))}return B}function C(){u=new WeakMap}function I(f){const A=f.target;A.removeEventListener("dispose",I),o.remove(A.instanceMatrix),A.instanceColor!==null&&o.remove(A.instanceColor)}return{update:d,dispose:C}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(n,t,o){const r=n[0];if(r<=0||r>0)return n;const u=t*o;let d=arrayCacheF32[u];if(d===void 0&&(d=new Float32Array(u),arrayCacheF32[u]=d),t!==0){r.toArray(d,0);for(let C=1,I=0;C!==t;++C)I+=o,n[C].toArray(d,I)}return d}function arraysEqual(n,t){if(n.length!==t.length)return!1;for(let o=0,r=n.length;o<r;o++)if(n[o]!==t[o])return!1;return!0}function copyArray(n,t){for(let o=0,r=t.length;o<r;o++)n[o]=t[o]}function allocTexUnits(n,t){let o=arrayCacheI32[t];o===void 0&&(o=new Int32Array(t),arrayCacheI32[t]=o);for(let r=0;r!==t;++r)o[r]=n.allocateTextureUnit();return o}function setValueV1f(n,t){const o=this.cache;o[0]!==t&&(n.uniform1f(this.addr,t),o[0]=t)}function setValueV2f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2fv(this.addr,t),copyArray(o,t)}}function setValueV3f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else if(t.r!==void 0)(o[0]!==t.r||o[1]!==t.g||o[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),o[0]=t.r,o[1]=t.g,o[2]=t.b);else{if(arraysEqual(o,t))return;n.uniform3fv(this.addr,t),copyArray(o,t)}}function setValueV4f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4fv(this.addr,t),copyArray(o,t)}}function setValueM2(n,t){const o=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(o,t))return;n.uniformMatrix2fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,r))return;mat2array.set(r),n.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(o,r)}}function setValueM3(n,t){const o=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(o,t))return;n.uniformMatrix3fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,r))return;mat3array.set(r),n.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(o,r)}}function setValueM4(n,t){const o=this.cache,r=t.elements;if(r===void 0){if(arraysEqual(o,t))return;n.uniformMatrix4fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,r))return;mat4array.set(r),n.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(o,r)}}function setValueV1i(n,t){const o=this.cache;o[0]!==t&&(n.uniform1i(this.addr,t),o[0]=t)}function setValueV2i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2iv(this.addr,t),copyArray(o,t)}}function setValueV3i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else{if(arraysEqual(o,t))return;n.uniform3iv(this.addr,t),copyArray(o,t)}}function setValueV4i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4iv(this.addr,t),copyArray(o,t)}}function setValueV1ui(n,t){const o=this.cache;o[0]!==t&&(n.uniform1ui(this.addr,t),o[0]=t)}function setValueV2ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2uiv(this.addr,t),copyArray(o,t)}}function setValueV3ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else{if(arraysEqual(o,t))return;n.uniform3uiv(this.addr,t),copyArray(o,t)}}function setValueV4ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4uiv(this.addr,t),copyArray(o,t)}}function setValueT1(n,t,o){const r=this.cache,u=o.allocateTextureUnit();r[0]!==u&&(n.uniform1i(this.addr,u),r[0]=u);let d;this.type===n.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,d=emptyShadowTexture):d=emptyTexture,o.setTexture2D(t||d,u)}function setValueT3D1(n,t,o){const r=this.cache,u=o.allocateTextureUnit();r[0]!==u&&(n.uniform1i(this.addr,u),r[0]=u),o.setTexture3D(t||empty3dTexture,u)}function setValueT6(n,t,o){const r=this.cache,u=o.allocateTextureUnit();r[0]!==u&&(n.uniform1i(this.addr,u),r[0]=u),o.setTextureCube(t||emptyCubeTexture,u)}function setValueT2DArray1(n,t,o){const r=this.cache,u=o.allocateTextureUnit();r[0]!==u&&(n.uniform1i(this.addr,u),r[0]=u),o.setTexture2DArray(t||emptyArrayTexture,u)}function getSingularSetter(n){switch(n){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(n,t){n.uniform1fv(this.addr,t)}function setValueV2fArray(n,t){const o=flatten(t,this.size,2);n.uniform2fv(this.addr,o)}function setValueV3fArray(n,t){const o=flatten(t,this.size,3);n.uniform3fv(this.addr,o)}function setValueV4fArray(n,t){const o=flatten(t,this.size,4);n.uniform4fv(this.addr,o)}function setValueM2Array(n,t){const o=flatten(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,o)}function setValueM3Array(n,t){const o=flatten(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,o)}function setValueM4Array(n,t){const o=flatten(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,o)}function setValueV1iArray(n,t){n.uniform1iv(this.addr,t)}function setValueV2iArray(n,t){n.uniform2iv(this.addr,t)}function setValueV3iArray(n,t){n.uniform3iv(this.addr,t)}function setValueV4iArray(n,t){n.uniform4iv(this.addr,t)}function setValueV1uiArray(n,t){n.uniform1uiv(this.addr,t)}function setValueV2uiArray(n,t){n.uniform2uiv(this.addr,t)}function setValueV3uiArray(n,t){n.uniform3uiv(this.addr,t)}function setValueV4uiArray(n,t){n.uniform4uiv(this.addr,t)}function setValueT1Array(n,t,o){const r=this.cache,u=t.length,d=allocTexUnits(o,u);arraysEqual(r,d)||(n.uniform1iv(this.addr,d),copyArray(r,d));for(let C=0;C!==u;++C)o.setTexture2D(t[C]||emptyTexture,d[C])}function setValueT3DArray(n,t,o){const r=this.cache,u=t.length,d=allocTexUnits(o,u);arraysEqual(r,d)||(n.uniform1iv(this.addr,d),copyArray(r,d));for(let C=0;C!==u;++C)o.setTexture3D(t[C]||empty3dTexture,d[C])}function setValueT6Array(n,t,o){const r=this.cache,u=t.length,d=allocTexUnits(o,u);arraysEqual(r,d)||(n.uniform1iv(this.addr,d),copyArray(r,d));for(let C=0;C!==u;++C)o.setTextureCube(t[C]||emptyCubeTexture,d[C])}function setValueT2DArrayArray(n,t,o){const r=this.cache,u=t.length,d=allocTexUnits(o,u);arraysEqual(r,d)||(n.uniform1iv(this.addr,d),copyArray(r,d));for(let C=0;C!==u;++C)o.setTexture2DArray(t[C]||emptyArrayTexture,d[C])}function getPureArraySetter(n){switch(n){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(t,o,r){this.id=t,this.addr=r,this.cache=[],this.type=o.type,this.setValue=getSingularSetter(o.type)}}class PureArrayUniform{constructor(t,o,r){this.id=t,this.addr=r,this.cache=[],this.type=o.type,this.size=o.size,this.setValue=getPureArraySetter(o.type)}}class StructuredUniform{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,o,r){const u=this.seq;for(let d=0,C=u.length;d!==C;++d){const I=u[d];I.setValue(t,o[I.id],r)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(n,t){n.seq.push(t),n.map[t.id]=t}function parseUniform(n,t,o){const r=n.name,u=r.length;for(RePathPart.lastIndex=0;;){const d=RePathPart.exec(r),C=RePathPart.lastIndex;let I=d[1];const f=d[2]==="]",A=d[3];if(f&&(I=I|0),A===void 0||A==="["&&C+2===u){addUniform(o,A===void 0?new SingleUniform(I,n,t):new PureArrayUniform(I,n,t));break}else{let B=o.map[I];B===void 0&&(B=new StructuredUniform(I),addUniform(o,B)),o=B}}}class WebGLUniforms{constructor(t,o){this.seq=[],this.map={};const r=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let u=0;u<r;++u){const d=t.getActiveUniform(o,u),C=t.getUniformLocation(o,d.name);parseUniform(d,C,this)}}setValue(t,o,r,u){const d=this.map[o];d!==void 0&&d.setValue(t,r,u)}setOptional(t,o,r){const u=o[r];u!==void 0&&this.setValue(t,r,u)}static upload(t,o,r,u){for(let d=0,C=o.length;d!==C;++d){const I=o[d],f=r[I.id];f.needsUpdate!==!1&&I.setValue(t,f.value,u)}}static seqWithValue(t,o){const r=[];for(let u=0,d=t.length;u!==d;++u){const C=t[u];C.id in o&&r.push(C)}return r}}function WebGLShader(n,t,o){const r=n.createShader(t);return n.shaderSource(r,o),n.compileShader(r),r}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(n,t){const o=n.split(`
`),r=[],u=Math.max(t-6,0),d=Math.min(t+6,o.length);for(let C=u;C<d;C++){const I=C+1;r.push(`${I===t?">":" "} ${I}: ${o[C]}`)}return r.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(n){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,n);const t=`mat3( ${_m0.elements.map(o=>o.toFixed(4))} )`;switch(ColorManagement.getTransfer(n)){case LinearTransfer:return[t,"LinearTransferOETF"];case SRGBTransfer:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[t,"LinearTransferOETF"]}}function getShaderErrors(n,t,o){const r=n.getShaderParameter(t,n.COMPILE_STATUS),u=n.getShaderInfoLog(t).trim();if(r&&u==="")return"";const d=/ERROR: 0:(\d+)/.exec(u);if(d){const C=parseInt(d[1]);return o.toUpperCase()+`

`+u+`

`+handleSource(n.getShaderSource(t),C)}else return u}function getTexelEncodingFunction(n,t){const o=getEncodingComponents(t);return[`vec4 ${n}( vec4 value ) {`,`	return ${o[1]}( vec4( value.rgb * ${o[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(n,t){let o;switch(t){case LinearToneMapping:o="Linear";break;case ReinhardToneMapping:o="Reinhard";break;case CineonToneMapping:o="Cineon";break;case ACESFilmicToneMapping:o="ACESFilmic";break;case AgXToneMapping:o="AgX";break;case NeutralToneMapping:o="Neutral";break;case CustomToneMapping:o="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),o="Linear"}return"vec3 "+n+"( vec3 color ) { return "+o+"ToneMapping( color ); }"}const _v0=new Vector3;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0);const n=_v0.x.toFixed(4),t=_v0.y.toFixed(4),o=_v0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${t}, ${o} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(n){const t=[];for(const o in n){const r=n[o];r!==!1&&t.push("#define "+o+" "+r)}return t.join(`
`)}function fetchAttributeLocations(n,t){const o={},r=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let u=0;u<r;u++){const d=n.getActiveAttrib(t,u),C=d.name;let I=1;d.type===n.FLOAT_MAT2&&(I=2),d.type===n.FLOAT_MAT3&&(I=3),d.type===n.FLOAT_MAT4&&(I=4),o[C]={type:d.type,location:n.getAttribLocation(t,C),locationSize:I}}return o}function filterEmptyLine(n){return n!==""}function replaceLightNums(n,t){const o=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,o).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(n){return n.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(n,t){let o=ShaderChunk[t];if(o===void 0){const r=shaderChunkMap.get(t);if(r!==void 0)o=ShaderChunk[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,r);else throw new Error("Can not resolve #include <"+t+">")}return resolveIncludes(o)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(n){return n.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(n,t,o,r){let u="";for(let d=parseInt(t);d<parseInt(o);d++)u+=r.replace(/\[\s*i\s*\]/g,"[ "+d+" ]").replace(/UNROLLED_LOOP_INDEX/g,d);return u}function generatePrecision(n){let t=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?t+=`
#define HIGH_PRECISION`:n.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function generateShadowMapTypeDefine(n){let t="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":n.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:t="ENVMAP_TYPE_CUBE_UV";break}return t}function generateEnvMapModeDefine(n){let t="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case CubeRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}return t}function generateEnvMapBlendingDefine(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}return t}function generateCubeUVSize(n){const t=n.envMapCubeUVHeight;if(t===null)return null;const o=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,o),7*16)),texelHeight:r,maxMip:o}}function WebGLProgram(n,t,o,r){const u=n.getContext(),d=o.defines;let C=o.vertexShader,I=o.fragmentShader;const f=generateShadowMapTypeDefine(o),A=generateEnvMapTypeDefine(o),G=generateEnvMapModeDefine(o),B=generateEnvMapBlendingDefine(o),Z=generateCubeUVSize(o),w=generateVertexExtensions(o),V=generateDefines(d),Y=u.createProgram();let J,T,L=o.glslVersion?"#version "+o.glslVersion+`
`:"";o.isRawShaderMaterial?(J=["#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V].filter(filterEmptyLine).join(`
`),J.length>0&&(J+=`
`),T=["#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V].filter(filterEmptyLine).join(`
`),T.length>0&&(T+=`
`)):(J=[generatePrecision(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V,o.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",o.batching?"#define USE_BATCHING":"",o.batchingColor?"#define USE_BATCHING_COLOR":"",o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.instancingMorph?"#define USE_INSTANCING_MORPH":"",o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+G:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",o.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",o.displacementMap?"#define USE_DISPLACEMENTMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.anisotropy?"#define USE_ANISOTROPY":"",o.anisotropyMap?"#define USE_ANISOTROPYMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",o.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",o.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.alphaHash?"#define USE_ALPHAHASH":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",o.mapUv?"#define MAP_UV "+o.mapUv:"",o.alphaMapUv?"#define ALPHAMAP_UV "+o.alphaMapUv:"",o.lightMapUv?"#define LIGHTMAP_UV "+o.lightMapUv:"",o.aoMapUv?"#define AOMAP_UV "+o.aoMapUv:"",o.emissiveMapUv?"#define EMISSIVEMAP_UV "+o.emissiveMapUv:"",o.bumpMapUv?"#define BUMPMAP_UV "+o.bumpMapUv:"",o.normalMapUv?"#define NORMALMAP_UV "+o.normalMapUv:"",o.displacementMapUv?"#define DISPLACEMENTMAP_UV "+o.displacementMapUv:"",o.metalnessMapUv?"#define METALNESSMAP_UV "+o.metalnessMapUv:"",o.roughnessMapUv?"#define ROUGHNESSMAP_UV "+o.roughnessMapUv:"",o.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+o.anisotropyMapUv:"",o.clearcoatMapUv?"#define CLEARCOATMAP_UV "+o.clearcoatMapUv:"",o.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+o.clearcoatNormalMapUv:"",o.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+o.clearcoatRoughnessMapUv:"",o.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+o.iridescenceMapUv:"",o.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+o.iridescenceThicknessMapUv:"",o.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+o.sheenColorMapUv:"",o.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+o.sheenRoughnessMapUv:"",o.specularMapUv?"#define SPECULARMAP_UV "+o.specularMapUv:"",o.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+o.specularColorMapUv:"",o.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+o.specularIntensityMapUv:"",o.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+o.transmissionMapUv:"",o.thicknessMapUv?"#define THICKNESSMAP_UV "+o.thicknessMapUv:"",o.vertexTangents&&o.flatShading===!1?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.pointsUvs?"#define USE_POINTS_UV":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&o.flatShading===!1?"#define USE_MORPHNORMALS":"",o.morphColors?"#define USE_MORPHCOLORS":"",o.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+o.morphTextureStride:"",o.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+o.morphTargetsCount:"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+f:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.numLightProbes>0?"#define USE_LIGHT_PROBES":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),T=[generatePrecision(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+A:"",o.envMap?"#define "+G:"",o.envMap?"#define "+B:"",Z?"#define CUBEUV_TEXEL_WIDTH "+Z.texelWidth:"",Z?"#define CUBEUV_TEXEL_HEIGHT "+Z.texelHeight:"",Z?"#define CUBEUV_MAX_MIP "+Z.maxMip+".0":"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",o.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.anisotropy?"#define USE_ANISOTROPY":"",o.anisotropyMap?"#define USE_ANISOTROPYMAP":"",o.clearcoat?"#define USE_CLEARCOAT":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.dispersion?"#define USE_DISPERSION":"",o.iridescence?"#define USE_IRIDESCENCE":"",o.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",o.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",o.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.alphaTest?"#define USE_ALPHATEST":"",o.alphaHash?"#define USE_ALPHAHASH":"",o.sheen?"#define USE_SHEEN":"",o.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.vertexTangents&&o.flatShading===!1?"#define USE_TANGENT":"",o.vertexColors||o.instancingColor||o.batchingColor?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.pointsUvs?"#define USE_POINTS_UV":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+f:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.numLightProbes>0?"#define USE_LIGHT_PROBES":"",o.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",o.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",o.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",o.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",o.outputColorSpace),getLuminanceFunction(),o.useDepthPacking?"#define DEPTH_PACKING "+o.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),C=resolveIncludes(C),C=replaceLightNums(C,o),C=replaceClippingPlaneNums(C,o),I=resolveIncludes(I),I=replaceLightNums(I,o),I=replaceClippingPlaneNums(I,o),C=unrollLoops(C),I=unrollLoops(I),o.isRawShaderMaterial!==!0&&(L=`#version 300 es
`,J=[w,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+J,T=["#define varying in",o.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",o.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+T);const z=L+J+C,K=L+T+I,P=WebGLShader(u,u.VERTEX_SHADER,z),$=WebGLShader(u,u.FRAGMENT_SHADER,K);u.attachShader(Y,P),u.attachShader(Y,$),o.index0AttributeName!==void 0?u.bindAttribLocation(Y,0,o.index0AttributeName):o.morphTargets===!0&&u.bindAttribLocation(Y,0,"position"),u.linkProgram(Y);function ie(re){if(n.debug.checkShaderErrors){const ce=u.getProgramInfoLog(Y).trim(),ue=u.getShaderInfoLog(P).trim(),ye=u.getShaderInfoLog($).trim();let Se=!0,Ce=!0;if(u.getProgramParameter(Y,u.LINK_STATUS)===!1)if(Se=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(u,Y,P,$);else{const Ze=getShaderErrors(u,P,"vertex"),Be=getShaderErrors(u,$,"fragment");console.error("THREE.WebGLProgram: Shader Error "+u.getError()+" - VALIDATE_STATUS "+u.getProgramParameter(Y,u.VALIDATE_STATUS)+`

Material Name: `+re.name+`
Material Type: `+re.type+`

Program Info Log: `+ce+`
`+Ze+`
`+Be)}else ce!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ce):(ue===""||ye==="")&&(Ce=!1);Ce&&(re.diagnostics={runnable:Se,programLog:ce,vertexShader:{log:ue,prefix:J},fragmentShader:{log:ye,prefix:T}})}u.deleteShader(P),u.deleteShader($),ne=new WebGLUniforms(u,Y),ee=fetchAttributeLocations(u,Y)}let ne;this.getUniforms=function(){return ne===void 0&&ie(this),ne};let ee;this.getAttributes=function(){return ee===void 0&&ie(this),ee};let se=o.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return se===!1&&(se=u.getProgramParameter(Y,COMPLETION_STATUS_KHR)),se},this.destroy=function(){r.releaseStatesOfProgram(this),u.deleteProgram(Y),this.program=void 0},this.type=o.shaderType,this.name=o.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=Y,this.vertexShader=P,this.fragmentShader=$,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const o=t.vertexShader,r=t.fragmentShader,u=this._getShaderStage(o),d=this._getShaderStage(r),C=this._getShaderCacheForMaterial(t);return C.has(u)===!1&&(C.add(u),u.usedTimes++),C.has(d)===!1&&(C.add(d),d.usedTimes++),this}remove(t){const o=this.materialCache.get(t);for(const r of o)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const o=this.materialCache;let r=o.get(t);return r===void 0&&(r=new Set,o.set(t,r)),r}_getShaderStage(t){const o=this.shaderCache;let r=o.get(t);return r===void 0&&(r=new WebGLShaderStage(t),o.set(t,r)),r}}class WebGLShaderStage{constructor(t){this.id=_id++,this.code=t,this.usedTimes=0}}function WebGLPrograms(n,t,o,r,u,d,C){const I=new Layers,f=new WebGLShaderCache,A=new Set,G=[],B=u.logarithmicDepthBuffer,Z=u.vertexTextures;let w=u.precision;const V={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Y(ee){return A.add(ee),ee===0?"uv":`uv${ee}`}function J(ee,se,re,ce,ue){const ye=ce.fog,Se=ue.geometry,Ce=ee.isMeshStandardMaterial?ce.environment:null,Ze=(ee.isMeshStandardMaterial?o:t).get(ee.envMap||Ce),Be=Ze&&Ze.mapping===CubeUVReflectionMapping?Ze.image.height:null,xe=V[ee.type];ee.precision!==null&&(w=u.getMaxPrecision(ee.precision),w!==ee.precision&&console.warn("THREE.WebGLProgram.getParameters:",ee.precision,"not supported, using",w,"instead."));const ge=Se.morphAttributes.position||Se.morphAttributes.normal||Se.morphAttributes.color,de=ge!==void 0?ge.length:0;let ve=0;Se.morphAttributes.position!==void 0&&(ve=1),Se.morphAttributes.normal!==void 0&&(ve=2),Se.morphAttributes.color!==void 0&&(ve=3);let le,Ae,Xe,Te;if(xe){const ii=ShaderLib[xe];le=ii.vertexShader,Ae=ii.fragmentShader}else le=ee.vertexShader,Ae=ee.fragmentShader,f.update(ee),Xe=f.getVertexShaderID(ee),Te=f.getFragmentShaderID(ee);const Ne=n.getRenderTarget(),We=n.state.buffers.depth.getReversed(),dt=ue.isInstancedMesh===!0,nt=ue.isBatchedMesh===!0,Rt=!!ee.map,Qe=!!ee.matcap,Oe=!!Ze,be=!!ee.aoMap,yt=!!ee.lightMap,st=!!ee.bumpMap,Gt=!!ee.normalMap,rt=!!ee.displacementMap,Yt=!!ee.emissiveMap,Xt=!!ee.metalnessMap,Ge=!!ee.roughnessMap,he=ee.anisotropy>0,ke=ee.clearcoat>0,it=ee.dispersion>0,ht=ee.iridescence>0,He=ee.sheen>0,ot=ee.transmission>0,Zt=he&&!!ee.anisotropyMap,wt=ke&&!!ee.clearcoatMap,Et=ke&&!!ee.clearcoatNormalMap,De=ke&&!!ee.clearcoatRoughnessMap,ct=ht&&!!ee.iridescenceMap,ft=ht&&!!ee.iridescenceThicknessMap,At=He&&!!ee.sheenColorMap,Ct=He&&!!ee.sheenRoughnessMap,me=!!ee.specularMap,Ee=!!ee.specularColorMap,_e=!!ee.specularIntensityMap,Me=ot&&!!ee.transmissionMap,Bt=ot&&!!ee.thicknessMap,qe=!!ee.gradientMap,at=!!ee.alphaMap,bt=ee.alphaTest>0,_t=!!ee.alphaHash,Tt=!!ee.extensions;let si=NoToneMapping;ee.toneMapped&&(Ne===null||Ne.isXRRenderTarget===!0)&&(si=n.toneMapping);const Bi={shaderID:xe,shaderType:ee.type,shaderName:ee.name,vertexShader:le,fragmentShader:Ae,defines:ee.defines,customVertexShaderID:Xe,customFragmentShaderID:Te,isRawShaderMaterial:ee.isRawShaderMaterial===!0,glslVersion:ee.glslVersion,precision:w,batching:nt,batchingColor:nt&&ue._colorsTexture!==null,instancing:dt,instancingColor:dt&&ue.instanceColor!==null,instancingMorph:dt&&ue.morphTexture!==null,supportsVertexTextures:Z,outputColorSpace:Ne===null?n.outputColorSpace:Ne.isXRRenderTarget===!0?Ne.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!ee.alphaToCoverage,map:Rt,matcap:Qe,envMap:Oe,envMapMode:Oe&&Ze.mapping,envMapCubeUVHeight:Be,aoMap:be,lightMap:yt,bumpMap:st,normalMap:Gt,displacementMap:Z&&rt,emissiveMap:Yt,normalMapObjectSpace:Gt&&ee.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:Gt&&ee.normalMapType===TangentSpaceNormalMap,metalnessMap:Xt,roughnessMap:Ge,anisotropy:he,anisotropyMap:Zt,clearcoat:ke,clearcoatMap:wt,clearcoatNormalMap:Et,clearcoatRoughnessMap:De,dispersion:it,iridescence:ht,iridescenceMap:ct,iridescenceThicknessMap:ft,sheen:He,sheenColorMap:At,sheenRoughnessMap:Ct,specularMap:me,specularColorMap:Ee,specularIntensityMap:_e,transmission:ot,transmissionMap:Me,thicknessMap:Bt,gradientMap:qe,opaque:ee.transparent===!1&&ee.blending===NormalBlending&&ee.alphaToCoverage===!1,alphaMap:at,alphaTest:bt,alphaHash:_t,combine:ee.combine,mapUv:Rt&&Y(ee.map.channel),aoMapUv:be&&Y(ee.aoMap.channel),lightMapUv:yt&&Y(ee.lightMap.channel),bumpMapUv:st&&Y(ee.bumpMap.channel),normalMapUv:Gt&&Y(ee.normalMap.channel),displacementMapUv:rt&&Y(ee.displacementMap.channel),emissiveMapUv:Yt&&Y(ee.emissiveMap.channel),metalnessMapUv:Xt&&Y(ee.metalnessMap.channel),roughnessMapUv:Ge&&Y(ee.roughnessMap.channel),anisotropyMapUv:Zt&&Y(ee.anisotropyMap.channel),clearcoatMapUv:wt&&Y(ee.clearcoatMap.channel),clearcoatNormalMapUv:Et&&Y(ee.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:De&&Y(ee.clearcoatRoughnessMap.channel),iridescenceMapUv:ct&&Y(ee.iridescenceMap.channel),iridescenceThicknessMapUv:ft&&Y(ee.iridescenceThicknessMap.channel),sheenColorMapUv:At&&Y(ee.sheenColorMap.channel),sheenRoughnessMapUv:Ct&&Y(ee.sheenRoughnessMap.channel),specularMapUv:me&&Y(ee.specularMap.channel),specularColorMapUv:Ee&&Y(ee.specularColorMap.channel),specularIntensityMapUv:_e&&Y(ee.specularIntensityMap.channel),transmissionMapUv:Me&&Y(ee.transmissionMap.channel),thicknessMapUv:Bt&&Y(ee.thicknessMap.channel),alphaMapUv:at&&Y(ee.alphaMap.channel),vertexTangents:!!Se.attributes.tangent&&(Gt||he),vertexColors:ee.vertexColors,vertexAlphas:ee.vertexColors===!0&&!!Se.attributes.color&&Se.attributes.color.itemSize===4,pointsUvs:ue.isPoints===!0&&!!Se.attributes.uv&&(Rt||at),fog:!!ye,useFog:ee.fog===!0,fogExp2:!!ye&&ye.isFogExp2,flatShading:ee.flatShading===!0,sizeAttenuation:ee.sizeAttenuation===!0,logarithmicDepthBuffer:B,reverseDepthBuffer:We,skinning:ue.isSkinnedMesh===!0,morphTargets:Se.morphAttributes.position!==void 0,morphNormals:Se.morphAttributes.normal!==void 0,morphColors:Se.morphAttributes.color!==void 0,morphTargetsCount:de,morphTextureStride:ve,numDirLights:se.directional.length,numPointLights:se.point.length,numSpotLights:se.spot.length,numSpotLightMaps:se.spotLightMap.length,numRectAreaLights:se.rectArea.length,numHemiLights:se.hemi.length,numDirLightShadows:se.directionalShadowMap.length,numPointLightShadows:se.pointShadowMap.length,numSpotLightShadows:se.spotShadowMap.length,numSpotLightShadowsWithMaps:se.numSpotLightShadowsWithMaps,numLightProbes:se.numLightProbes,numClippingPlanes:C.numPlanes,numClipIntersection:C.numIntersection,dithering:ee.dithering,shadowMapEnabled:n.shadowMap.enabled&&re.length>0,shadowMapType:n.shadowMap.type,toneMapping:si,decodeVideoTexture:Rt&&ee.map.isVideoTexture===!0&&ColorManagement.getTransfer(ee.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:Yt&&ee.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(ee.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:ee.premultipliedAlpha,doubleSided:ee.side===DoubleSide,flipSided:ee.side===BackSide,useDepthPacking:ee.depthPacking>=0,depthPacking:ee.depthPacking||0,index0AttributeName:ee.index0AttributeName,extensionClipCullDistance:Tt&&ee.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Tt&&ee.extensions.multiDraw===!0||nt)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:ee.customProgramCacheKey()};return Bi.vertexUv1s=A.has(1),Bi.vertexUv2s=A.has(2),Bi.vertexUv3s=A.has(3),A.clear(),Bi}function T(ee){const se=[];if(ee.shaderID?se.push(ee.shaderID):(se.push(ee.customVertexShaderID),se.push(ee.customFragmentShaderID)),ee.defines!==void 0)for(const re in ee.defines)se.push(re),se.push(ee.defines[re]);return ee.isRawShaderMaterial===!1&&(L(se,ee),z(se,ee),se.push(n.outputColorSpace)),se.push(ee.customProgramCacheKey),se.join()}function L(ee,se){ee.push(se.precision),ee.push(se.outputColorSpace),ee.push(se.envMapMode),ee.push(se.envMapCubeUVHeight),ee.push(se.mapUv),ee.push(se.alphaMapUv),ee.push(se.lightMapUv),ee.push(se.aoMapUv),ee.push(se.bumpMapUv),ee.push(se.normalMapUv),ee.push(se.displacementMapUv),ee.push(se.emissiveMapUv),ee.push(se.metalnessMapUv),ee.push(se.roughnessMapUv),ee.push(se.anisotropyMapUv),ee.push(se.clearcoatMapUv),ee.push(se.clearcoatNormalMapUv),ee.push(se.clearcoatRoughnessMapUv),ee.push(se.iridescenceMapUv),ee.push(se.iridescenceThicknessMapUv),ee.push(se.sheenColorMapUv),ee.push(se.sheenRoughnessMapUv),ee.push(se.specularMapUv),ee.push(se.specularColorMapUv),ee.push(se.specularIntensityMapUv),ee.push(se.transmissionMapUv),ee.push(se.thicknessMapUv),ee.push(se.combine),ee.push(se.fogExp2),ee.push(se.sizeAttenuation),ee.push(se.morphTargetsCount),ee.push(se.morphAttributeCount),ee.push(se.numDirLights),ee.push(se.numPointLights),ee.push(se.numSpotLights),ee.push(se.numSpotLightMaps),ee.push(se.numHemiLights),ee.push(se.numRectAreaLights),ee.push(se.numDirLightShadows),ee.push(se.numPointLightShadows),ee.push(se.numSpotLightShadows),ee.push(se.numSpotLightShadowsWithMaps),ee.push(se.numLightProbes),ee.push(se.shadowMapType),ee.push(se.toneMapping),ee.push(se.numClippingPlanes),ee.push(se.numClipIntersection),ee.push(se.depthPacking)}function z(ee,se){I.disableAll(),se.supportsVertexTextures&&I.enable(0),se.instancing&&I.enable(1),se.instancingColor&&I.enable(2),se.instancingMorph&&I.enable(3),se.matcap&&I.enable(4),se.envMap&&I.enable(5),se.normalMapObjectSpace&&I.enable(6),se.normalMapTangentSpace&&I.enable(7),se.clearcoat&&I.enable(8),se.iridescence&&I.enable(9),se.alphaTest&&I.enable(10),se.vertexColors&&I.enable(11),se.vertexAlphas&&I.enable(12),se.vertexUv1s&&I.enable(13),se.vertexUv2s&&I.enable(14),se.vertexUv3s&&I.enable(15),se.vertexTangents&&I.enable(16),se.anisotropy&&I.enable(17),se.alphaHash&&I.enable(18),se.batching&&I.enable(19),se.dispersion&&I.enable(20),se.batchingColor&&I.enable(21),ee.push(I.mask),I.disableAll(),se.fog&&I.enable(0),se.useFog&&I.enable(1),se.flatShading&&I.enable(2),se.logarithmicDepthBuffer&&I.enable(3),se.reverseDepthBuffer&&I.enable(4),se.skinning&&I.enable(5),se.morphTargets&&I.enable(6),se.morphNormals&&I.enable(7),se.morphColors&&I.enable(8),se.premultipliedAlpha&&I.enable(9),se.shadowMapEnabled&&I.enable(10),se.doubleSided&&I.enable(11),se.flipSided&&I.enable(12),se.useDepthPacking&&I.enable(13),se.dithering&&I.enable(14),se.transmission&&I.enable(15),se.sheen&&I.enable(16),se.opaque&&I.enable(17),se.pointsUvs&&I.enable(18),se.decodeVideoTexture&&I.enable(19),se.decodeVideoTextureEmissive&&I.enable(20),se.alphaToCoverage&&I.enable(21),ee.push(I.mask)}function K(ee){const se=V[ee.type];let re;if(se){const ce=ShaderLib[se];re=UniformsUtils.clone(ce.uniforms)}else re=ee.uniforms;return re}function P(ee,se){let re;for(let ce=0,ue=G.length;ce<ue;ce++){const ye=G[ce];if(ye.cacheKey===se){re=ye,++re.usedTimes;break}}return re===void 0&&(re=new WebGLProgram(n,se,ee,d),G.push(re)),re}function $(ee){if(--ee.usedTimes===0){const se=G.indexOf(ee);G[se]=G[G.length-1],G.pop(),ee.destroy()}}function ie(ee){f.remove(ee)}function ne(){f.dispose()}return{getParameters:J,getProgramCacheKey:T,getUniforms:K,acquireProgram:P,releaseProgram:$,releaseShaderCache:ie,programs:G,dispose:ne}}function WebGLProperties(){let n=new WeakMap;function t(C){return n.has(C)}function o(C){let I=n.get(C);return I===void 0&&(I={},n.set(C,I)),I}function r(C){n.delete(C)}function u(C,I,f){n.get(C)[I]=f}function d(){n=new WeakMap}return{has:t,get:o,remove:r,update:u,dispose:d}}function painterSortStable(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function reversePainterSortStable(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function WebGLRenderList(){const n=[];let t=0;const o=[],r=[],u=[];function d(){t=0,o.length=0,r.length=0,u.length=0}function C(B,Z,w,V,Y,J){let T=n[t];return T===void 0?(T={id:B.id,object:B,geometry:Z,material:w,groupOrder:V,renderOrder:B.renderOrder,z:Y,group:J},n[t]=T):(T.id=B.id,T.object=B,T.geometry=Z,T.material=w,T.groupOrder=V,T.renderOrder=B.renderOrder,T.z=Y,T.group=J),t++,T}function I(B,Z,w,V,Y,J){const T=C(B,Z,w,V,Y,J);w.transmission>0?r.push(T):w.transparent===!0?u.push(T):o.push(T)}function f(B,Z,w,V,Y,J){const T=C(B,Z,w,V,Y,J);w.transmission>0?r.unshift(T):w.transparent===!0?u.unshift(T):o.unshift(T)}function A(B,Z){o.length>1&&o.sort(B||painterSortStable),r.length>1&&r.sort(Z||reversePainterSortStable),u.length>1&&u.sort(Z||reversePainterSortStable)}function G(){for(let B=t,Z=n.length;B<Z;B++){const w=n[B];if(w.id===null)break;w.id=null,w.object=null,w.geometry=null,w.material=null,w.group=null}}return{opaque:o,transmissive:r,transparent:u,init:d,push:I,unshift:f,finish:G,sort:A}}function WebGLRenderLists(){let n=new WeakMap;function t(r,u){const d=n.get(r);let C;return d===void 0?(C=new WebGLRenderList,n.set(r,[C])):u>=d.length?(C=new WebGLRenderList,d.push(C)):C=d[u],C}function o(){n=new WeakMap}return{get:t,dispose:o}}function UniformsCache(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let o;switch(t.type){case"DirectionalLight":o={direction:new Vector3,color:new Color};break;case"SpotLight":o={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":o={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":o={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":o={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return n[t.id]=o,o}}}function ShadowUniformsCache(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let o;switch(t.type){case"DirectionalLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[t.id]=o,o}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function WebGLLights(n){const t=new UniformsCache,o=ShadowUniformsCache(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let A=0;A<9;A++)r.probe.push(new Vector3);const u=new Vector3,d=new Matrix4,C=new Matrix4;function I(A){let G=0,B=0,Z=0;for(let ee=0;ee<9;ee++)r.probe[ee].set(0,0,0);let w=0,V=0,Y=0,J=0,T=0,L=0,z=0,K=0,P=0,$=0,ie=0;A.sort(shadowCastingAndTexturingLightsFirst);for(let ee=0,se=A.length;ee<se;ee++){const re=A[ee],ce=re.color,ue=re.intensity,ye=re.distance,Se=re.shadow&&re.shadow.map?re.shadow.map.texture:null;if(re.isAmbientLight)G+=ce.r*ue,B+=ce.g*ue,Z+=ce.b*ue;else if(re.isLightProbe){for(let Ce=0;Ce<9;Ce++)r.probe[Ce].addScaledVector(re.sh.coefficients[Ce],ue);ie++}else if(re.isDirectionalLight){const Ce=t.get(re);if(Ce.color.copy(re.color).multiplyScalar(re.intensity),re.castShadow){const Ze=re.shadow,Be=o.get(re);Be.shadowIntensity=Ze.intensity,Be.shadowBias=Ze.bias,Be.shadowNormalBias=Ze.normalBias,Be.shadowRadius=Ze.radius,Be.shadowMapSize=Ze.mapSize,r.directionalShadow[w]=Be,r.directionalShadowMap[w]=Se,r.directionalShadowMatrix[w]=re.shadow.matrix,L++}r.directional[w]=Ce,w++}else if(re.isSpotLight){const Ce=t.get(re);Ce.position.setFromMatrixPosition(re.matrixWorld),Ce.color.copy(ce).multiplyScalar(ue),Ce.distance=ye,Ce.coneCos=Math.cos(re.angle),Ce.penumbraCos=Math.cos(re.angle*(1-re.penumbra)),Ce.decay=re.decay,r.spot[Y]=Ce;const Ze=re.shadow;if(re.map&&(r.spotLightMap[P]=re.map,P++,Ze.updateMatrices(re),re.castShadow&&$++),r.spotLightMatrix[Y]=Ze.matrix,re.castShadow){const Be=o.get(re);Be.shadowIntensity=Ze.intensity,Be.shadowBias=Ze.bias,Be.shadowNormalBias=Ze.normalBias,Be.shadowRadius=Ze.radius,Be.shadowMapSize=Ze.mapSize,r.spotShadow[Y]=Be,r.spotShadowMap[Y]=Se,K++}Y++}else if(re.isRectAreaLight){const Ce=t.get(re);Ce.color.copy(ce).multiplyScalar(ue),Ce.halfWidth.set(re.width*.5,0,0),Ce.halfHeight.set(0,re.height*.5,0),r.rectArea[J]=Ce,J++}else if(re.isPointLight){const Ce=t.get(re);if(Ce.color.copy(re.color).multiplyScalar(re.intensity),Ce.distance=re.distance,Ce.decay=re.decay,re.castShadow){const Ze=re.shadow,Be=o.get(re);Be.shadowIntensity=Ze.intensity,Be.shadowBias=Ze.bias,Be.shadowNormalBias=Ze.normalBias,Be.shadowRadius=Ze.radius,Be.shadowMapSize=Ze.mapSize,Be.shadowCameraNear=Ze.camera.near,Be.shadowCameraFar=Ze.camera.far,r.pointShadow[V]=Be,r.pointShadowMap[V]=Se,r.pointShadowMatrix[V]=re.shadow.matrix,z++}r.point[V]=Ce,V++}else if(re.isHemisphereLight){const Ce=t.get(re);Ce.skyColor.copy(re.color).multiplyScalar(ue),Ce.groundColor.copy(re.groundColor).multiplyScalar(ue),r.hemi[T]=Ce,T++}}J>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(r.rectAreaLTC1=UniformsLib.LTC_HALF_1,r.rectAreaLTC2=UniformsLib.LTC_HALF_2)),r.ambient[0]=G,r.ambient[1]=B,r.ambient[2]=Z;const ne=r.hash;(ne.directionalLength!==w||ne.pointLength!==V||ne.spotLength!==Y||ne.rectAreaLength!==J||ne.hemiLength!==T||ne.numDirectionalShadows!==L||ne.numPointShadows!==z||ne.numSpotShadows!==K||ne.numSpotMaps!==P||ne.numLightProbes!==ie)&&(r.directional.length=w,r.spot.length=Y,r.rectArea.length=J,r.point.length=V,r.hemi.length=T,r.directionalShadow.length=L,r.directionalShadowMap.length=L,r.pointShadow.length=z,r.pointShadowMap.length=z,r.spotShadow.length=K,r.spotShadowMap.length=K,r.directionalShadowMatrix.length=L,r.pointShadowMatrix.length=z,r.spotLightMatrix.length=K+P-$,r.spotLightMap.length=P,r.numSpotLightShadowsWithMaps=$,r.numLightProbes=ie,ne.directionalLength=w,ne.pointLength=V,ne.spotLength=Y,ne.rectAreaLength=J,ne.hemiLength=T,ne.numDirectionalShadows=L,ne.numPointShadows=z,ne.numSpotShadows=K,ne.numSpotMaps=P,ne.numLightProbes=ie,r.version=nextVersion++)}function f(A,G){let B=0,Z=0,w=0,V=0,Y=0;const J=G.matrixWorldInverse;for(let T=0,L=A.length;T<L;T++){const z=A[T];if(z.isDirectionalLight){const K=r.directional[B];K.direction.setFromMatrixPosition(z.matrixWorld),u.setFromMatrixPosition(z.target.matrixWorld),K.direction.sub(u),K.direction.transformDirection(J),B++}else if(z.isSpotLight){const K=r.spot[w];K.position.setFromMatrixPosition(z.matrixWorld),K.position.applyMatrix4(J),K.direction.setFromMatrixPosition(z.matrixWorld),u.setFromMatrixPosition(z.target.matrixWorld),K.direction.sub(u),K.direction.transformDirection(J),w++}else if(z.isRectAreaLight){const K=r.rectArea[V];K.position.setFromMatrixPosition(z.matrixWorld),K.position.applyMatrix4(J),C.identity(),d.copy(z.matrixWorld),d.premultiply(J),C.extractRotation(d),K.halfWidth.set(z.width*.5,0,0),K.halfHeight.set(0,z.height*.5,0),K.halfWidth.applyMatrix4(C),K.halfHeight.applyMatrix4(C),V++}else if(z.isPointLight){const K=r.point[Z];K.position.setFromMatrixPosition(z.matrixWorld),K.position.applyMatrix4(J),Z++}else if(z.isHemisphereLight){const K=r.hemi[Y];K.direction.setFromMatrixPosition(z.matrixWorld),K.direction.transformDirection(J),Y++}}}return{setup:I,setupView:f,state:r}}function WebGLRenderState(n){const t=new WebGLLights(n),o=[],r=[];function u(G){A.camera=G,o.length=0,r.length=0}function d(G){o.push(G)}function C(G){r.push(G)}function I(){t.setup(o)}function f(G){t.setupView(o,G)}const A={lightsArray:o,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:u,state:A,setupLights:I,setupLightsView:f,pushLight:d,pushShadow:C}}function WebGLRenderStates(n){let t=new WeakMap;function o(u,d=0){const C=t.get(u);let I;return C===void 0?(I=new WebGLRenderState(n),t.set(u,[I])):d>=C.length?(I=new WebGLRenderState(n),C.push(I)):I=C[d],I}function r(){t=new WeakMap}return{get:o,dispose:r}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(n,t,o){let r=new Frustum;const u=new Vector2,d=new Vector2,C=new Vector4,I=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),f=new MeshDistanceMaterial,A={},G=o.maxTextureSize,B={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},Z=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),w=Z.clone();w.defines.HORIZONTAL_PASS=1;const V=new BufferGeometry;V.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Y=new Mesh(V,Z),J=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let T=this.type;this.render=function($,ie,ne){if(J.enabled===!1||J.autoUpdate===!1&&J.needsUpdate===!1||$.length===0)return;const ee=n.getRenderTarget(),se=n.getActiveCubeFace(),re=n.getActiveMipmapLevel(),ce=n.state;ce.setBlending(NoBlending),ce.buffers.color.setClear(1,1,1,1),ce.buffers.depth.setTest(!0),ce.setScissorTest(!1);const ue=T!==VSMShadowMap&&this.type===VSMShadowMap,ye=T===VSMShadowMap&&this.type!==VSMShadowMap;for(let Se=0,Ce=$.length;Se<Ce;Se++){const Ze=$[Se],Be=Ze.shadow;if(Be===void 0){console.warn("THREE.WebGLShadowMap:",Ze,"has no shadow.");continue}if(Be.autoUpdate===!1&&Be.needsUpdate===!1)continue;u.copy(Be.mapSize);const xe=Be.getFrameExtents();if(u.multiply(xe),d.copy(Be.mapSize),(u.x>G||u.y>G)&&(u.x>G&&(d.x=Math.floor(G/xe.x),u.x=d.x*xe.x,Be.mapSize.x=d.x),u.y>G&&(d.y=Math.floor(G/xe.y),u.y=d.y*xe.y,Be.mapSize.y=d.y)),Be.map===null||ue===!0||ye===!0){const de=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Be.map!==null&&Be.map.dispose(),Be.map=new WebGLRenderTarget(u.x,u.y,de),Be.map.texture.name=Ze.name+".shadowMap",Be.camera.updateProjectionMatrix()}n.setRenderTarget(Be.map),n.clear();const ge=Be.getViewportCount();for(let de=0;de<ge;de++){const ve=Be.getViewport(de);C.set(d.x*ve.x,d.y*ve.y,d.x*ve.z,d.y*ve.w),ce.viewport(C),Be.updateMatrices(Ze,de),r=Be.getFrustum(),K(ie,ne,Be.camera,Ze,this.type)}Be.isPointLightShadow!==!0&&this.type===VSMShadowMap&&L(Be,ne),Be.needsUpdate=!1}T=this.type,J.needsUpdate=!1,n.setRenderTarget(ee,se,re)};function L($,ie){const ne=t.update(Y);Z.defines.VSM_SAMPLES!==$.blurSamples&&(Z.defines.VSM_SAMPLES=$.blurSamples,w.defines.VSM_SAMPLES=$.blurSamples,Z.needsUpdate=!0,w.needsUpdate=!0),$.mapPass===null&&($.mapPass=new WebGLRenderTarget(u.x,u.y)),Z.uniforms.shadow_pass.value=$.map.texture,Z.uniforms.resolution.value=$.mapSize,Z.uniforms.radius.value=$.radius,n.setRenderTarget($.mapPass),n.clear(),n.renderBufferDirect(ie,null,ne,Z,Y,null),w.uniforms.shadow_pass.value=$.mapPass.texture,w.uniforms.resolution.value=$.mapSize,w.uniforms.radius.value=$.radius,n.setRenderTarget($.map),n.clear(),n.renderBufferDirect(ie,null,ne,w,Y,null)}function z($,ie,ne,ee){let se=null;const re=ne.isPointLight===!0?$.customDistanceMaterial:$.customDepthMaterial;if(re!==void 0)se=re;else if(se=ne.isPointLight===!0?f:I,n.localClippingEnabled&&ie.clipShadows===!0&&Array.isArray(ie.clippingPlanes)&&ie.clippingPlanes.length!==0||ie.displacementMap&&ie.displacementScale!==0||ie.alphaMap&&ie.alphaTest>0||ie.map&&ie.alphaTest>0){const ce=se.uuid,ue=ie.uuid;let ye=A[ce];ye===void 0&&(ye={},A[ce]=ye);let Se=ye[ue];Se===void 0&&(Se=se.clone(),ye[ue]=Se,ie.addEventListener("dispose",P)),se=Se}if(se.visible=ie.visible,se.wireframe=ie.wireframe,ee===VSMShadowMap?se.side=ie.shadowSide!==null?ie.shadowSide:ie.side:se.side=ie.shadowSide!==null?ie.shadowSide:B[ie.side],se.alphaMap=ie.alphaMap,se.alphaTest=ie.alphaTest,se.map=ie.map,se.clipShadows=ie.clipShadows,se.clippingPlanes=ie.clippingPlanes,se.clipIntersection=ie.clipIntersection,se.displacementMap=ie.displacementMap,se.displacementScale=ie.displacementScale,se.displacementBias=ie.displacementBias,se.wireframeLinewidth=ie.wireframeLinewidth,se.linewidth=ie.linewidth,ne.isPointLight===!0&&se.isMeshDistanceMaterial===!0){const ce=n.properties.get(se);ce.light=ne}return se}function K($,ie,ne,ee,se){if($.visible===!1)return;if($.layers.test(ie.layers)&&($.isMesh||$.isLine||$.isPoints)&&($.castShadow||$.receiveShadow&&se===VSMShadowMap)&&(!$.frustumCulled||r.intersectsObject($))){$.modelViewMatrix.multiplyMatrices(ne.matrixWorldInverse,$.matrixWorld);const ue=t.update($),ye=$.material;if(Array.isArray(ye)){const Se=ue.groups;for(let Ce=0,Ze=Se.length;Ce<Ze;Ce++){const Be=Se[Ce],xe=ye[Be.materialIndex];if(xe&&xe.visible){const ge=z($,xe,ee,se);$.onBeforeShadow(n,$,ie,ne,ue,ge,Be),n.renderBufferDirect(ne,null,ue,ge,$,Be),$.onAfterShadow(n,$,ie,ne,ue,ge,Be)}}}else if(ye.visible){const Se=z($,ye,ee,se);$.onBeforeShadow(n,$,ie,ne,ue,Se,null),n.renderBufferDirect(ne,null,ue,Se,$,null),$.onAfterShadow(n,$,ie,ne,ue,Se,null)}}const ce=$.children;for(let ue=0,ye=ce.length;ue<ye;ue++)K(ce[ue],ie,ne,ee,se)}function P($){$.target.removeEventListener("dispose",P);for(const ne in A){const ee=A[ne],se=$.target.uuid;se in ee&&(ee[se].dispose(),delete ee[se])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(n,t){function o(){let Me=!1;const Bt=new Vector4;let qe=null;const at=new Vector4(0,0,0,0);return{setMask:function(bt){qe!==bt&&!Me&&(n.colorMask(bt,bt,bt,bt),qe=bt)},setLocked:function(bt){Me=bt},setClear:function(bt,_t,Tt,si,Bi){Bi===!0&&(bt*=si,_t*=si,Tt*=si),Bt.set(bt,_t,Tt,si),at.equals(Bt)===!1&&(n.clearColor(bt,_t,Tt,si),at.copy(Bt))},reset:function(){Me=!1,qe=null,at.set(-1,0,0,0)}}}function r(){let Me=!1,Bt=!1,qe=null,at=null,bt=null;return{setReversed:function(_t){if(Bt!==_t){const Tt=t.get("EXT_clip_control");Bt?Tt.clipControlEXT(Tt.LOWER_LEFT_EXT,Tt.ZERO_TO_ONE_EXT):Tt.clipControlEXT(Tt.LOWER_LEFT_EXT,Tt.NEGATIVE_ONE_TO_ONE_EXT);const si=bt;bt=null,this.setClear(si)}Bt=_t},getReversed:function(){return Bt},setTest:function(_t){_t?Ne(n.DEPTH_TEST):We(n.DEPTH_TEST)},setMask:function(_t){qe!==_t&&!Me&&(n.depthMask(_t),qe=_t)},setFunc:function(_t){if(Bt&&(_t=reversedFuncs[_t]),at!==_t){switch(_t){case NeverDepth:n.depthFunc(n.NEVER);break;case AlwaysDepth:n.depthFunc(n.ALWAYS);break;case LessDepth:n.depthFunc(n.LESS);break;case LessEqualDepth:n.depthFunc(n.LEQUAL);break;case EqualDepth:n.depthFunc(n.EQUAL);break;case GreaterEqualDepth:n.depthFunc(n.GEQUAL);break;case GreaterDepth:n.depthFunc(n.GREATER);break;case NotEqualDepth:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}at=_t}},setLocked:function(_t){Me=_t},setClear:function(_t){bt!==_t&&(Bt&&(_t=1-_t),n.clearDepth(_t),bt=_t)},reset:function(){Me=!1,qe=null,at=null,bt=null,Bt=!1}}}function u(){let Me=!1,Bt=null,qe=null,at=null,bt=null,_t=null,Tt=null,si=null,Bi=null;return{setTest:function(ii){Me||(ii?Ne(n.STENCIL_TEST):We(n.STENCIL_TEST))},setMask:function(ii){Bt!==ii&&!Me&&(n.stencilMask(ii),Bt=ii)},setFunc:function(ii,ci,Zi){(qe!==ii||at!==ci||bt!==Zi)&&(n.stencilFunc(ii,ci,Zi),qe=ii,at=ci,bt=Zi)},setOp:function(ii,ci,Zi){(_t!==ii||Tt!==ci||si!==Zi)&&(n.stencilOp(ii,ci,Zi),_t=ii,Tt=ci,si=Zi)},setLocked:function(ii){Me=ii},setClear:function(ii){Bi!==ii&&(n.clearStencil(ii),Bi=ii)},reset:function(){Me=!1,Bt=null,qe=null,at=null,bt=null,_t=null,Tt=null,si=null,Bi=null}}}const d=new o,C=new r,I=new u,f=new WeakMap,A=new WeakMap;let G={},B={},Z=new WeakMap,w=[],V=null,Y=!1,J=null,T=null,L=null,z=null,K=null,P=null,$=null,ie=new Color(0,0,0),ne=0,ee=!1,se=null,re=null,ce=null,ue=null,ye=null;const Se=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ce=!1,Ze=0;const Be=n.getParameter(n.VERSION);Be.indexOf("WebGL")!==-1?(Ze=parseFloat(/^WebGL (\d)/.exec(Be)[1]),Ce=Ze>=1):Be.indexOf("OpenGL ES")!==-1&&(Ze=parseFloat(/^OpenGL ES (\d)/.exec(Be)[1]),Ce=Ze>=2);let xe=null,ge={};const de=n.getParameter(n.SCISSOR_BOX),ve=n.getParameter(n.VIEWPORT),le=new Vector4().fromArray(de),Ae=new Vector4().fromArray(ve);function Xe(Me,Bt,qe,at){const bt=new Uint8Array(4),_t=n.createTexture();n.bindTexture(Me,_t),n.texParameteri(Me,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Me,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Tt=0;Tt<qe;Tt++)Me===n.TEXTURE_3D||Me===n.TEXTURE_2D_ARRAY?n.texImage3D(Bt,0,n.RGBA,1,1,at,0,n.RGBA,n.UNSIGNED_BYTE,bt):n.texImage2D(Bt+Tt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,bt);return _t}const Te={};Te[n.TEXTURE_2D]=Xe(n.TEXTURE_2D,n.TEXTURE_2D,1),Te[n.TEXTURE_CUBE_MAP]=Xe(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Te[n.TEXTURE_2D_ARRAY]=Xe(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Te[n.TEXTURE_3D]=Xe(n.TEXTURE_3D,n.TEXTURE_3D,1,1),d.setClear(0,0,0,1),C.setClear(1),I.setClear(0),Ne(n.DEPTH_TEST),C.setFunc(LessEqualDepth),st(!1),Gt(CullFaceBack),Ne(n.CULL_FACE),be(NoBlending);function Ne(Me){G[Me]!==!0&&(n.enable(Me),G[Me]=!0)}function We(Me){G[Me]!==!1&&(n.disable(Me),G[Me]=!1)}function dt(Me,Bt){return B[Me]!==Bt?(n.bindFramebuffer(Me,Bt),B[Me]=Bt,Me===n.DRAW_FRAMEBUFFER&&(B[n.FRAMEBUFFER]=Bt),Me===n.FRAMEBUFFER&&(B[n.DRAW_FRAMEBUFFER]=Bt),!0):!1}function nt(Me,Bt){let qe=w,at=!1;if(Me){qe=Z.get(Bt),qe===void 0&&(qe=[],Z.set(Bt,qe));const bt=Me.textures;if(qe.length!==bt.length||qe[0]!==n.COLOR_ATTACHMENT0){for(let _t=0,Tt=bt.length;_t<Tt;_t++)qe[_t]=n.COLOR_ATTACHMENT0+_t;qe.length=bt.length,at=!0}}else qe[0]!==n.BACK&&(qe[0]=n.BACK,at=!0);at&&n.drawBuffers(qe)}function Rt(Me){return V!==Me?(n.useProgram(Me),V=Me,!0):!1}const Qe={[AddEquation]:n.FUNC_ADD,[SubtractEquation]:n.FUNC_SUBTRACT,[ReverseSubtractEquation]:n.FUNC_REVERSE_SUBTRACT};Qe[MinEquation]=n.MIN,Qe[MaxEquation]=n.MAX;const Oe={[ZeroFactor]:n.ZERO,[OneFactor]:n.ONE,[SrcColorFactor]:n.SRC_COLOR,[SrcAlphaFactor]:n.SRC_ALPHA,[SrcAlphaSaturateFactor]:n.SRC_ALPHA_SATURATE,[DstColorFactor]:n.DST_COLOR,[DstAlphaFactor]:n.DST_ALPHA,[OneMinusSrcColorFactor]:n.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:n.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:n.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:n.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:n.CONSTANT_COLOR,[OneMinusConstantColorFactor]:n.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:n.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:n.ONE_MINUS_CONSTANT_ALPHA};function be(Me,Bt,qe,at,bt,_t,Tt,si,Bi,ii){if(Me===NoBlending){Y===!0&&(We(n.BLEND),Y=!1);return}if(Y===!1&&(Ne(n.BLEND),Y=!0),Me!==CustomBlending){if(Me!==J||ii!==ee){if((T!==AddEquation||K!==AddEquation)&&(n.blendEquation(n.FUNC_ADD),T=AddEquation,K=AddEquation),ii)switch(Me){case NormalBlending:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:n.blendFunc(n.ONE,n.ONE);break;case SubtractiveBlending:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case MultiplyBlending:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}else switch(Me){case NormalBlending:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case SubtractiveBlending:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case MultiplyBlending:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}L=null,z=null,P=null,$=null,ie.set(0,0,0),ne=0,J=Me,ee=ii}return}bt=bt||Bt,_t=_t||qe,Tt=Tt||at,(Bt!==T||bt!==K)&&(n.blendEquationSeparate(Qe[Bt],Qe[bt]),T=Bt,K=bt),(qe!==L||at!==z||_t!==P||Tt!==$)&&(n.blendFuncSeparate(Oe[qe],Oe[at],Oe[_t],Oe[Tt]),L=qe,z=at,P=_t,$=Tt),(si.equals(ie)===!1||Bi!==ne)&&(n.blendColor(si.r,si.g,si.b,Bi),ie.copy(si),ne=Bi),J=Me,ee=!1}function yt(Me,Bt){Me.side===DoubleSide?We(n.CULL_FACE):Ne(n.CULL_FACE);let qe=Me.side===BackSide;Bt&&(qe=!qe),st(qe),Me.blending===NormalBlending&&Me.transparent===!1?be(NoBlending):be(Me.blending,Me.blendEquation,Me.blendSrc,Me.blendDst,Me.blendEquationAlpha,Me.blendSrcAlpha,Me.blendDstAlpha,Me.blendColor,Me.blendAlpha,Me.premultipliedAlpha),C.setFunc(Me.depthFunc),C.setTest(Me.depthTest),C.setMask(Me.depthWrite),d.setMask(Me.colorWrite);const at=Me.stencilWrite;I.setTest(at),at&&(I.setMask(Me.stencilWriteMask),I.setFunc(Me.stencilFunc,Me.stencilRef,Me.stencilFuncMask),I.setOp(Me.stencilFail,Me.stencilZFail,Me.stencilZPass)),Yt(Me.polygonOffset,Me.polygonOffsetFactor,Me.polygonOffsetUnits),Me.alphaToCoverage===!0?Ne(n.SAMPLE_ALPHA_TO_COVERAGE):We(n.SAMPLE_ALPHA_TO_COVERAGE)}function st(Me){se!==Me&&(Me?n.frontFace(n.CW):n.frontFace(n.CCW),se=Me)}function Gt(Me){Me!==CullFaceNone?(Ne(n.CULL_FACE),Me!==re&&(Me===CullFaceBack?n.cullFace(n.BACK):Me===CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):We(n.CULL_FACE),re=Me}function rt(Me){Me!==ce&&(Ce&&n.lineWidth(Me),ce=Me)}function Yt(Me,Bt,qe){Me?(Ne(n.POLYGON_OFFSET_FILL),(ue!==Bt||ye!==qe)&&(n.polygonOffset(Bt,qe),ue=Bt,ye=qe)):We(n.POLYGON_OFFSET_FILL)}function Xt(Me){Me?Ne(n.SCISSOR_TEST):We(n.SCISSOR_TEST)}function Ge(Me){Me===void 0&&(Me=n.TEXTURE0+Se-1),xe!==Me&&(n.activeTexture(Me),xe=Me)}function he(Me,Bt,qe){qe===void 0&&(xe===null?qe=n.TEXTURE0+Se-1:qe=xe);let at=ge[qe];at===void 0&&(at={type:void 0,texture:void 0},ge[qe]=at),(at.type!==Me||at.texture!==Bt)&&(xe!==qe&&(n.activeTexture(qe),xe=qe),n.bindTexture(Me,Bt||Te[Me]),at.type=Me,at.texture=Bt)}function ke(){const Me=ge[xe];Me!==void 0&&Me.type!==void 0&&(n.bindTexture(Me.type,null),Me.type=void 0,Me.texture=void 0)}function it(){try{n.compressedTexImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ht(){try{n.compressedTexImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function He(){try{n.texSubImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ot(){try{n.texSubImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Zt(){try{n.compressedTexSubImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function wt(){try{n.compressedTexSubImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Et(){try{n.texStorage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function De(){try{n.texStorage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ct(){try{n.texImage2D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ft(){try{n.texImage3D(...arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function At(Me){le.equals(Me)===!1&&(n.scissor(Me.x,Me.y,Me.z,Me.w),le.copy(Me))}function Ct(Me){Ae.equals(Me)===!1&&(n.viewport(Me.x,Me.y,Me.z,Me.w),Ae.copy(Me))}function me(Me,Bt){let qe=A.get(Bt);qe===void 0&&(qe=new WeakMap,A.set(Bt,qe));let at=qe.get(Me);at===void 0&&(at=n.getUniformBlockIndex(Bt,Me.name),qe.set(Me,at))}function Ee(Me,Bt){const at=A.get(Bt).get(Me);f.get(Bt)!==at&&(n.uniformBlockBinding(Bt,at,Me.__bindingPointIndex),f.set(Bt,at))}function _e(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),C.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),G={},xe=null,ge={},B={},Z=new WeakMap,w=[],V=null,Y=!1,J=null,T=null,L=null,z=null,K=null,P=null,$=null,ie=new Color(0,0,0),ne=0,ee=!1,se=null,re=null,ce=null,ue=null,ye=null,le.set(0,0,n.canvas.width,n.canvas.height),Ae.set(0,0,n.canvas.width,n.canvas.height),d.reset(),C.reset(),I.reset()}return{buffers:{color:d,depth:C,stencil:I},enable:Ne,disable:We,bindFramebuffer:dt,drawBuffers:nt,useProgram:Rt,setBlending:be,setMaterial:yt,setFlipSided:st,setCullFace:Gt,setLineWidth:rt,setPolygonOffset:Yt,setScissorTest:Xt,activeTexture:Ge,bindTexture:he,unbindTexture:ke,compressedTexImage2D:it,compressedTexImage3D:ht,texImage2D:ct,texImage3D:ft,updateUBOMapping:me,uniformBlockBinding:Ee,texStorage2D:Et,texStorage3D:De,texSubImage2D:He,texSubImage3D:ot,compressedTexSubImage2D:Zt,compressedTexSubImage3D:wt,scissor:At,viewport:Ct,reset:_e}}function WebGLTextures(n,t,o,r,u,d,C){const I=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),A=new Vector2,G=new WeakMap;let B;const Z=new WeakMap;let w=!1;try{w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function V(Ge,he){return w?new OffscreenCanvas(Ge,he):createElementNS("canvas")}function Y(Ge,he,ke){let it=1;const ht=Xt(Ge);if((ht.width>ke||ht.height>ke)&&(it=ke/Math.max(ht.width,ht.height)),it<1)if(typeof HTMLImageElement<"u"&&Ge instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ge instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ge instanceof ImageBitmap||typeof VideoFrame<"u"&&Ge instanceof VideoFrame){const He=Math.floor(it*ht.width),ot=Math.floor(it*ht.height);B===void 0&&(B=V(He,ot));const Zt=he?V(He,ot):B;return Zt.width=He,Zt.height=ot,Zt.getContext("2d").drawImage(Ge,0,0,He,ot),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ht.width+"x"+ht.height+") to ("+He+"x"+ot+")."),Zt}else return"data"in Ge&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ht.width+"x"+ht.height+")."),Ge;return Ge}function J(Ge){return Ge.generateMipmaps}function T(Ge){n.generateMipmap(Ge)}function L(Ge){return Ge.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:Ge.isWebGL3DRenderTarget?n.TEXTURE_3D:Ge.isWebGLArrayRenderTarget||Ge.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function z(Ge,he,ke,it,ht=!1){if(Ge!==null){if(n[Ge]!==void 0)return n[Ge];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ge+"'")}let He=he;if(he===n.RED&&(ke===n.FLOAT&&(He=n.R32F),ke===n.HALF_FLOAT&&(He=n.R16F),ke===n.UNSIGNED_BYTE&&(He=n.R8)),he===n.RED_INTEGER&&(ke===n.UNSIGNED_BYTE&&(He=n.R8UI),ke===n.UNSIGNED_SHORT&&(He=n.R16UI),ke===n.UNSIGNED_INT&&(He=n.R32UI),ke===n.BYTE&&(He=n.R8I),ke===n.SHORT&&(He=n.R16I),ke===n.INT&&(He=n.R32I)),he===n.RG&&(ke===n.FLOAT&&(He=n.RG32F),ke===n.HALF_FLOAT&&(He=n.RG16F),ke===n.UNSIGNED_BYTE&&(He=n.RG8)),he===n.RG_INTEGER&&(ke===n.UNSIGNED_BYTE&&(He=n.RG8UI),ke===n.UNSIGNED_SHORT&&(He=n.RG16UI),ke===n.UNSIGNED_INT&&(He=n.RG32UI),ke===n.BYTE&&(He=n.RG8I),ke===n.SHORT&&(He=n.RG16I),ke===n.INT&&(He=n.RG32I)),he===n.RGB_INTEGER&&(ke===n.UNSIGNED_BYTE&&(He=n.RGB8UI),ke===n.UNSIGNED_SHORT&&(He=n.RGB16UI),ke===n.UNSIGNED_INT&&(He=n.RGB32UI),ke===n.BYTE&&(He=n.RGB8I),ke===n.SHORT&&(He=n.RGB16I),ke===n.INT&&(He=n.RGB32I)),he===n.RGBA_INTEGER&&(ke===n.UNSIGNED_BYTE&&(He=n.RGBA8UI),ke===n.UNSIGNED_SHORT&&(He=n.RGBA16UI),ke===n.UNSIGNED_INT&&(He=n.RGBA32UI),ke===n.BYTE&&(He=n.RGBA8I),ke===n.SHORT&&(He=n.RGBA16I),ke===n.INT&&(He=n.RGBA32I)),he===n.RGB&&ke===n.UNSIGNED_INT_5_9_9_9_REV&&(He=n.RGB9_E5),he===n.RGBA){const ot=ht?LinearTransfer:ColorManagement.getTransfer(it);ke===n.FLOAT&&(He=n.RGBA32F),ke===n.HALF_FLOAT&&(He=n.RGBA16F),ke===n.UNSIGNED_BYTE&&(He=ot===SRGBTransfer?n.SRGB8_ALPHA8:n.RGBA8),ke===n.UNSIGNED_SHORT_4_4_4_4&&(He=n.RGBA4),ke===n.UNSIGNED_SHORT_5_5_5_1&&(He=n.RGB5_A1)}return(He===n.R16F||He===n.R32F||He===n.RG16F||He===n.RG32F||He===n.RGBA16F||He===n.RGBA32F)&&t.get("EXT_color_buffer_float"),He}function K(Ge,he){let ke;return Ge?he===null||he===UnsignedIntType||he===UnsignedInt248Type?ke=n.DEPTH24_STENCIL8:he===FloatType?ke=n.DEPTH32F_STENCIL8:he===UnsignedShortType&&(ke=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):he===null||he===UnsignedIntType||he===UnsignedInt248Type?ke=n.DEPTH_COMPONENT24:he===FloatType?ke=n.DEPTH_COMPONENT32F:he===UnsignedShortType&&(ke=n.DEPTH_COMPONENT16),ke}function P(Ge,he){return J(Ge)===!0||Ge.isFramebufferTexture&&Ge.minFilter!==NearestFilter&&Ge.minFilter!==LinearFilter?Math.log2(Math.max(he.width,he.height))+1:Ge.mipmaps!==void 0&&Ge.mipmaps.length>0?Ge.mipmaps.length:Ge.isCompressedTexture&&Array.isArray(Ge.image)?he.mipmaps.length:1}function $(Ge){const he=Ge.target;he.removeEventListener("dispose",$),ne(he),he.isVideoTexture&&G.delete(he)}function ie(Ge){const he=Ge.target;he.removeEventListener("dispose",ie),se(he)}function ne(Ge){const he=r.get(Ge);if(he.__webglInit===void 0)return;const ke=Ge.source,it=Z.get(ke);if(it){const ht=it[he.__cacheKey];ht.usedTimes--,ht.usedTimes===0&&ee(Ge),Object.keys(it).length===0&&Z.delete(ke)}r.remove(Ge)}function ee(Ge){const he=r.get(Ge);n.deleteTexture(he.__webglTexture);const ke=Ge.source,it=Z.get(ke);delete it[he.__cacheKey],C.memory.textures--}function se(Ge){const he=r.get(Ge);if(Ge.depthTexture&&(Ge.depthTexture.dispose(),r.remove(Ge.depthTexture)),Ge.isWebGLCubeRenderTarget)for(let it=0;it<6;it++){if(Array.isArray(he.__webglFramebuffer[it]))for(let ht=0;ht<he.__webglFramebuffer[it].length;ht++)n.deleteFramebuffer(he.__webglFramebuffer[it][ht]);else n.deleteFramebuffer(he.__webglFramebuffer[it]);he.__webglDepthbuffer&&n.deleteRenderbuffer(he.__webglDepthbuffer[it])}else{if(Array.isArray(he.__webglFramebuffer))for(let it=0;it<he.__webglFramebuffer.length;it++)n.deleteFramebuffer(he.__webglFramebuffer[it]);else n.deleteFramebuffer(he.__webglFramebuffer);if(he.__webglDepthbuffer&&n.deleteRenderbuffer(he.__webglDepthbuffer),he.__webglMultisampledFramebuffer&&n.deleteFramebuffer(he.__webglMultisampledFramebuffer),he.__webglColorRenderbuffer)for(let it=0;it<he.__webglColorRenderbuffer.length;it++)he.__webglColorRenderbuffer[it]&&n.deleteRenderbuffer(he.__webglColorRenderbuffer[it]);he.__webglDepthRenderbuffer&&n.deleteRenderbuffer(he.__webglDepthRenderbuffer)}const ke=Ge.textures;for(let it=0,ht=ke.length;it<ht;it++){const He=r.get(ke[it]);He.__webglTexture&&(n.deleteTexture(He.__webglTexture),C.memory.textures--),r.remove(ke[it])}r.remove(Ge)}let re=0;function ce(){re=0}function ue(){const Ge=re;return Ge>=u.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ge+" texture units while this GPU supports only "+u.maxTextures),re+=1,Ge}function ye(Ge){const he=[];return he.push(Ge.wrapS),he.push(Ge.wrapT),he.push(Ge.wrapR||0),he.push(Ge.magFilter),he.push(Ge.minFilter),he.push(Ge.anisotropy),he.push(Ge.internalFormat),he.push(Ge.format),he.push(Ge.type),he.push(Ge.generateMipmaps),he.push(Ge.premultiplyAlpha),he.push(Ge.flipY),he.push(Ge.unpackAlignment),he.push(Ge.colorSpace),he.join()}function Se(Ge,he){const ke=r.get(Ge);if(Ge.isVideoTexture&&rt(Ge),Ge.isRenderTargetTexture===!1&&Ge.version>0&&ke.__version!==Ge.version){const it=Ge.image;if(it===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(it.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ae(ke,Ge,he);return}}o.bindTexture(n.TEXTURE_2D,ke.__webglTexture,n.TEXTURE0+he)}function Ce(Ge,he){const ke=r.get(Ge);if(Ge.version>0&&ke.__version!==Ge.version){Ae(ke,Ge,he);return}o.bindTexture(n.TEXTURE_2D_ARRAY,ke.__webglTexture,n.TEXTURE0+he)}function Ze(Ge,he){const ke=r.get(Ge);if(Ge.version>0&&ke.__version!==Ge.version){Ae(ke,Ge,he);return}o.bindTexture(n.TEXTURE_3D,ke.__webglTexture,n.TEXTURE0+he)}function Be(Ge,he){const ke=r.get(Ge);if(Ge.version>0&&ke.__version!==Ge.version){Xe(ke,Ge,he);return}o.bindTexture(n.TEXTURE_CUBE_MAP,ke.__webglTexture,n.TEXTURE0+he)}const xe={[RepeatWrapping]:n.REPEAT,[ClampToEdgeWrapping]:n.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:n.MIRRORED_REPEAT},ge={[NearestFilter]:n.NEAREST,[NearestMipmapNearestFilter]:n.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:n.NEAREST_MIPMAP_LINEAR,[LinearFilter]:n.LINEAR,[LinearMipmapNearestFilter]:n.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:n.LINEAR_MIPMAP_LINEAR},de={[NeverCompare]:n.NEVER,[AlwaysCompare]:n.ALWAYS,[LessCompare]:n.LESS,[LessEqualCompare]:n.LEQUAL,[EqualCompare]:n.EQUAL,[GreaterEqualCompare]:n.GEQUAL,[GreaterCompare]:n.GREATER,[NotEqualCompare]:n.NOTEQUAL};function ve(Ge,he){if(he.type===FloatType&&t.has("OES_texture_float_linear")===!1&&(he.magFilter===LinearFilter||he.magFilter===LinearMipmapNearestFilter||he.magFilter===NearestMipmapLinearFilter||he.magFilter===LinearMipmapLinearFilter||he.minFilter===LinearFilter||he.minFilter===LinearMipmapNearestFilter||he.minFilter===NearestMipmapLinearFilter||he.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(Ge,n.TEXTURE_WRAP_S,xe[he.wrapS]),n.texParameteri(Ge,n.TEXTURE_WRAP_T,xe[he.wrapT]),(Ge===n.TEXTURE_3D||Ge===n.TEXTURE_2D_ARRAY)&&n.texParameteri(Ge,n.TEXTURE_WRAP_R,xe[he.wrapR]),n.texParameteri(Ge,n.TEXTURE_MAG_FILTER,ge[he.magFilter]),n.texParameteri(Ge,n.TEXTURE_MIN_FILTER,ge[he.minFilter]),he.compareFunction&&(n.texParameteri(Ge,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(Ge,n.TEXTURE_COMPARE_FUNC,de[he.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(he.magFilter===NearestFilter||he.minFilter!==NearestMipmapLinearFilter&&he.minFilter!==LinearMipmapLinearFilter||he.type===FloatType&&t.has("OES_texture_float_linear")===!1)return;if(he.anisotropy>1||r.get(he).__currentAnisotropy){const ke=t.get("EXT_texture_filter_anisotropic");n.texParameterf(Ge,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(he.anisotropy,u.getMaxAnisotropy())),r.get(he).__currentAnisotropy=he.anisotropy}}}function le(Ge,he){let ke=!1;Ge.__webglInit===void 0&&(Ge.__webglInit=!0,he.addEventListener("dispose",$));const it=he.source;let ht=Z.get(it);ht===void 0&&(ht={},Z.set(it,ht));const He=ye(he);if(He!==Ge.__cacheKey){ht[He]===void 0&&(ht[He]={texture:n.createTexture(),usedTimes:0},C.memory.textures++,ke=!0),ht[He].usedTimes++;const ot=ht[Ge.__cacheKey];ot!==void 0&&(ht[Ge.__cacheKey].usedTimes--,ot.usedTimes===0&&ee(he)),Ge.__cacheKey=He,Ge.__webglTexture=ht[He].texture}return ke}function Ae(Ge,he,ke){let it=n.TEXTURE_2D;(he.isDataArrayTexture||he.isCompressedArrayTexture)&&(it=n.TEXTURE_2D_ARRAY),he.isData3DTexture&&(it=n.TEXTURE_3D);const ht=le(Ge,he),He=he.source;o.bindTexture(it,Ge.__webglTexture,n.TEXTURE0+ke);const ot=r.get(He);if(He.version!==ot.__version||ht===!0){o.activeTexture(n.TEXTURE0+ke);const Zt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),wt=he.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(he.colorSpace),Et=he.colorSpace===NoColorSpace||Zt===wt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,he.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,he.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Et);let De=Y(he.image,!1,u.maxTextureSize);De=Yt(he,De);const ct=d.convert(he.format,he.colorSpace),ft=d.convert(he.type);let At=z(he.internalFormat,ct,ft,he.colorSpace,he.isVideoTexture);ve(it,he);let Ct;const me=he.mipmaps,Ee=he.isVideoTexture!==!0,_e=ot.__version===void 0||ht===!0,Me=He.dataReady,Bt=P(he,De);if(he.isDepthTexture)At=K(he.format===DepthStencilFormat,he.type),_e&&(Ee?o.texStorage2D(n.TEXTURE_2D,1,At,De.width,De.height):o.texImage2D(n.TEXTURE_2D,0,At,De.width,De.height,0,ct,ft,null));else if(he.isDataTexture)if(me.length>0){Ee&&_e&&o.texStorage2D(n.TEXTURE_2D,Bt,At,me[0].width,me[0].height);for(let qe=0,at=me.length;qe<at;qe++)Ct=me[qe],Ee?Me&&o.texSubImage2D(n.TEXTURE_2D,qe,0,0,Ct.width,Ct.height,ct,ft,Ct.data):o.texImage2D(n.TEXTURE_2D,qe,At,Ct.width,Ct.height,0,ct,ft,Ct.data);he.generateMipmaps=!1}else Ee?(_e&&o.texStorage2D(n.TEXTURE_2D,Bt,At,De.width,De.height),Me&&o.texSubImage2D(n.TEXTURE_2D,0,0,0,De.width,De.height,ct,ft,De.data)):o.texImage2D(n.TEXTURE_2D,0,At,De.width,De.height,0,ct,ft,De.data);else if(he.isCompressedTexture)if(he.isCompressedArrayTexture){Ee&&_e&&o.texStorage3D(n.TEXTURE_2D_ARRAY,Bt,At,me[0].width,me[0].height,De.depth);for(let qe=0,at=me.length;qe<at;qe++)if(Ct=me[qe],he.format!==RGBAFormat)if(ct!==null)if(Ee){if(Me)if(he.layerUpdates.size>0){const bt=getByteLength(Ct.width,Ct.height,he.format,he.type);for(const _t of he.layerUpdates){const Tt=Ct.data.subarray(_t*bt/Ct.data.BYTES_PER_ELEMENT,(_t+1)*bt/Ct.data.BYTES_PER_ELEMENT);o.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,qe,0,0,_t,Ct.width,Ct.height,1,ct,Tt)}he.clearLayerUpdates()}else o.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,qe,0,0,0,Ct.width,Ct.height,De.depth,ct,Ct.data)}else o.compressedTexImage3D(n.TEXTURE_2D_ARRAY,qe,At,Ct.width,Ct.height,De.depth,0,Ct.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ee?Me&&o.texSubImage3D(n.TEXTURE_2D_ARRAY,qe,0,0,0,Ct.width,Ct.height,De.depth,ct,ft,Ct.data):o.texImage3D(n.TEXTURE_2D_ARRAY,qe,At,Ct.width,Ct.height,De.depth,0,ct,ft,Ct.data)}else{Ee&&_e&&o.texStorage2D(n.TEXTURE_2D,Bt,At,me[0].width,me[0].height);for(let qe=0,at=me.length;qe<at;qe++)Ct=me[qe],he.format!==RGBAFormat?ct!==null?Ee?Me&&o.compressedTexSubImage2D(n.TEXTURE_2D,qe,0,0,Ct.width,Ct.height,ct,Ct.data):o.compressedTexImage2D(n.TEXTURE_2D,qe,At,Ct.width,Ct.height,0,Ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ee?Me&&o.texSubImage2D(n.TEXTURE_2D,qe,0,0,Ct.width,Ct.height,ct,ft,Ct.data):o.texImage2D(n.TEXTURE_2D,qe,At,Ct.width,Ct.height,0,ct,ft,Ct.data)}else if(he.isDataArrayTexture)if(Ee){if(_e&&o.texStorage3D(n.TEXTURE_2D_ARRAY,Bt,At,De.width,De.height,De.depth),Me)if(he.layerUpdates.size>0){const qe=getByteLength(De.width,De.height,he.format,he.type);for(const at of he.layerUpdates){const bt=De.data.subarray(at*qe/De.data.BYTES_PER_ELEMENT,(at+1)*qe/De.data.BYTES_PER_ELEMENT);o.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,at,De.width,De.height,1,ct,ft,bt)}he.clearLayerUpdates()}else o.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,De.width,De.height,De.depth,ct,ft,De.data)}else o.texImage3D(n.TEXTURE_2D_ARRAY,0,At,De.width,De.height,De.depth,0,ct,ft,De.data);else if(he.isData3DTexture)Ee?(_e&&o.texStorage3D(n.TEXTURE_3D,Bt,At,De.width,De.height,De.depth),Me&&o.texSubImage3D(n.TEXTURE_3D,0,0,0,0,De.width,De.height,De.depth,ct,ft,De.data)):o.texImage3D(n.TEXTURE_3D,0,At,De.width,De.height,De.depth,0,ct,ft,De.data);else if(he.isFramebufferTexture){if(_e)if(Ee)o.texStorage2D(n.TEXTURE_2D,Bt,At,De.width,De.height);else{let qe=De.width,at=De.height;for(let bt=0;bt<Bt;bt++)o.texImage2D(n.TEXTURE_2D,bt,At,qe,at,0,ct,ft,null),qe>>=1,at>>=1}}else if(me.length>0){if(Ee&&_e){const qe=Xt(me[0]);o.texStorage2D(n.TEXTURE_2D,Bt,At,qe.width,qe.height)}for(let qe=0,at=me.length;qe<at;qe++)Ct=me[qe],Ee?Me&&o.texSubImage2D(n.TEXTURE_2D,qe,0,0,ct,ft,Ct):o.texImage2D(n.TEXTURE_2D,qe,At,ct,ft,Ct);he.generateMipmaps=!1}else if(Ee){if(_e){const qe=Xt(De);o.texStorage2D(n.TEXTURE_2D,Bt,At,qe.width,qe.height)}Me&&o.texSubImage2D(n.TEXTURE_2D,0,0,0,ct,ft,De)}else o.texImage2D(n.TEXTURE_2D,0,At,ct,ft,De);J(he)&&T(it),ot.__version=He.version,he.onUpdate&&he.onUpdate(he)}Ge.__version=he.version}function Xe(Ge,he,ke){if(he.image.length!==6)return;const it=le(Ge,he),ht=he.source;o.bindTexture(n.TEXTURE_CUBE_MAP,Ge.__webglTexture,n.TEXTURE0+ke);const He=r.get(ht);if(ht.version!==He.__version||it===!0){o.activeTexture(n.TEXTURE0+ke);const ot=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),Zt=he.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(he.colorSpace),wt=he.colorSpace===NoColorSpace||ot===Zt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,he.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,he.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,wt);const Et=he.isCompressedTexture||he.image[0].isCompressedTexture,De=he.image[0]&&he.image[0].isDataTexture,ct=[];for(let at=0;at<6;at++)!Et&&!De?ct[at]=Y(he.image[at],!0,u.maxCubemapSize):ct[at]=De?he.image[at].image:he.image[at],ct[at]=Yt(he,ct[at]);const ft=ct[0],At=d.convert(he.format,he.colorSpace),Ct=d.convert(he.type),me=z(he.internalFormat,At,Ct,he.colorSpace),Ee=he.isVideoTexture!==!0,_e=He.__version===void 0||it===!0,Me=ht.dataReady;let Bt=P(he,ft);ve(n.TEXTURE_CUBE_MAP,he);let qe;if(Et){Ee&&_e&&o.texStorage2D(n.TEXTURE_CUBE_MAP,Bt,me,ft.width,ft.height);for(let at=0;at<6;at++){qe=ct[at].mipmaps;for(let bt=0;bt<qe.length;bt++){const _t=qe[bt];he.format!==RGBAFormat?At!==null?Ee?Me&&o.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt,0,0,_t.width,_t.height,At,_t.data):o.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt,me,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ee?Me&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt,0,0,_t.width,_t.height,At,Ct,_t.data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt,me,_t.width,_t.height,0,At,Ct,_t.data)}}}else{if(qe=he.mipmaps,Ee&&_e){qe.length>0&&Bt++;const at=Xt(ct[0]);o.texStorage2D(n.TEXTURE_CUBE_MAP,Bt,me,at.width,at.height)}for(let at=0;at<6;at++)if(De){Ee?Me&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,ct[at].width,ct[at].height,At,Ct,ct[at].data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,me,ct[at].width,ct[at].height,0,At,Ct,ct[at].data);for(let bt=0;bt<qe.length;bt++){const Tt=qe[bt].image[at].image;Ee?Me&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt+1,0,0,Tt.width,Tt.height,At,Ct,Tt.data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt+1,me,Tt.width,Tt.height,0,At,Ct,Tt.data)}}else{Ee?Me&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,At,Ct,ct[at]):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,me,At,Ct,ct[at]);for(let bt=0;bt<qe.length;bt++){const _t=qe[bt];Ee?Me&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt+1,0,0,At,Ct,_t.image[at]):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,bt+1,me,At,Ct,_t.image[at])}}}J(he)&&T(n.TEXTURE_CUBE_MAP),He.__version=ht.version,he.onUpdate&&he.onUpdate(he)}Ge.__version=he.version}function Te(Ge,he,ke,it,ht,He){const ot=d.convert(ke.format,ke.colorSpace),Zt=d.convert(ke.type),wt=z(ke.internalFormat,ot,Zt,ke.colorSpace),Et=r.get(he),De=r.get(ke);if(De.__renderTarget=he,!Et.__hasExternalTextures){const ct=Math.max(1,he.width>>He),ft=Math.max(1,he.height>>He);ht===n.TEXTURE_3D||ht===n.TEXTURE_2D_ARRAY?o.texImage3D(ht,He,wt,ct,ft,he.depth,0,ot,Zt,null):o.texImage2D(ht,He,wt,ct,ft,0,ot,Zt,null)}o.bindFramebuffer(n.FRAMEBUFFER,Ge),Gt(he)?I.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,it,ht,De.__webglTexture,0,st(he)):(ht===n.TEXTURE_2D||ht>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ht<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,it,ht,De.__webglTexture,He),o.bindFramebuffer(n.FRAMEBUFFER,null)}function Ne(Ge,he,ke){if(n.bindRenderbuffer(n.RENDERBUFFER,Ge),he.depthBuffer){const it=he.depthTexture,ht=it&&it.isDepthTexture?it.type:null,He=K(he.stencilBuffer,ht),ot=he.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Zt=st(he);Gt(he)?I.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Zt,He,he.width,he.height):ke?n.renderbufferStorageMultisample(n.RENDERBUFFER,Zt,He,he.width,he.height):n.renderbufferStorage(n.RENDERBUFFER,He,he.width,he.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ot,n.RENDERBUFFER,Ge)}else{const it=he.textures;for(let ht=0;ht<it.length;ht++){const He=it[ht],ot=d.convert(He.format,He.colorSpace),Zt=d.convert(He.type),wt=z(He.internalFormat,ot,Zt,He.colorSpace),Et=st(he);ke&&Gt(he)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Et,wt,he.width,he.height):Gt(he)?I.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Et,wt,he.width,he.height):n.renderbufferStorage(n.RENDERBUFFER,wt,he.width,he.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function We(Ge,he){if(he&&he.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(n.FRAMEBUFFER,Ge),!(he.depthTexture&&he.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const it=r.get(he.depthTexture);it.__renderTarget=he,(!it.__webglTexture||he.depthTexture.image.width!==he.width||he.depthTexture.image.height!==he.height)&&(he.depthTexture.image.width=he.width,he.depthTexture.image.height=he.height,he.depthTexture.needsUpdate=!0),Se(he.depthTexture,0);const ht=it.__webglTexture,He=st(he);if(he.depthTexture.format===DepthFormat)Gt(he)?I.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ht,0,He):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ht,0);else if(he.depthTexture.format===DepthStencilFormat)Gt(he)?I.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ht,0,He):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ht,0);else throw new Error("Unknown depthTexture format")}function dt(Ge){const he=r.get(Ge),ke=Ge.isWebGLCubeRenderTarget===!0;if(he.__boundDepthTexture!==Ge.depthTexture){const it=Ge.depthTexture;if(he.__depthDisposeCallback&&he.__depthDisposeCallback(),it){const ht=()=>{delete he.__boundDepthTexture,delete he.__depthDisposeCallback,it.removeEventListener("dispose",ht)};it.addEventListener("dispose",ht),he.__depthDisposeCallback=ht}he.__boundDepthTexture=it}if(Ge.depthTexture&&!he.__autoAllocateDepthBuffer){if(ke)throw new Error("target.depthTexture not supported in Cube render targets");We(he.__webglFramebuffer,Ge)}else if(ke){he.__webglDepthbuffer=[];for(let it=0;it<6;it++)if(o.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer[it]),he.__webglDepthbuffer[it]===void 0)he.__webglDepthbuffer[it]=n.createRenderbuffer(),Ne(he.__webglDepthbuffer[it],Ge,!1);else{const ht=Ge.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,He=he.__webglDepthbuffer[it];n.bindRenderbuffer(n.RENDERBUFFER,He),n.framebufferRenderbuffer(n.FRAMEBUFFER,ht,n.RENDERBUFFER,He)}}else if(o.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer),he.__webglDepthbuffer===void 0)he.__webglDepthbuffer=n.createRenderbuffer(),Ne(he.__webglDepthbuffer,Ge,!1);else{const it=Ge.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ht=he.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ht),n.framebufferRenderbuffer(n.FRAMEBUFFER,it,n.RENDERBUFFER,ht)}o.bindFramebuffer(n.FRAMEBUFFER,null)}function nt(Ge,he,ke){const it=r.get(Ge);he!==void 0&&Te(it.__webglFramebuffer,Ge,Ge.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ke!==void 0&&dt(Ge)}function Rt(Ge){const he=Ge.texture,ke=r.get(Ge),it=r.get(he);Ge.addEventListener("dispose",ie);const ht=Ge.textures,He=Ge.isWebGLCubeRenderTarget===!0,ot=ht.length>1;if(ot||(it.__webglTexture===void 0&&(it.__webglTexture=n.createTexture()),it.__version=he.version,C.memory.textures++),He){ke.__webglFramebuffer=[];for(let Zt=0;Zt<6;Zt++)if(he.mipmaps&&he.mipmaps.length>0){ke.__webglFramebuffer[Zt]=[];for(let wt=0;wt<he.mipmaps.length;wt++)ke.__webglFramebuffer[Zt][wt]=n.createFramebuffer()}else ke.__webglFramebuffer[Zt]=n.createFramebuffer()}else{if(he.mipmaps&&he.mipmaps.length>0){ke.__webglFramebuffer=[];for(let Zt=0;Zt<he.mipmaps.length;Zt++)ke.__webglFramebuffer[Zt]=n.createFramebuffer()}else ke.__webglFramebuffer=n.createFramebuffer();if(ot)for(let Zt=0,wt=ht.length;Zt<wt;Zt++){const Et=r.get(ht[Zt]);Et.__webglTexture===void 0&&(Et.__webglTexture=n.createTexture(),C.memory.textures++)}if(Ge.samples>0&&Gt(Ge)===!1){ke.__webglMultisampledFramebuffer=n.createFramebuffer(),ke.__webglColorRenderbuffer=[],o.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer);for(let Zt=0;Zt<ht.length;Zt++){const wt=ht[Zt];ke.__webglColorRenderbuffer[Zt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ke.__webglColorRenderbuffer[Zt]);const Et=d.convert(wt.format,wt.colorSpace),De=d.convert(wt.type),ct=z(wt.internalFormat,Et,De,wt.colorSpace,Ge.isXRRenderTarget===!0),ft=st(Ge);n.renderbufferStorageMultisample(n.RENDERBUFFER,ft,ct,Ge.width,Ge.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Zt,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Zt])}n.bindRenderbuffer(n.RENDERBUFFER,null),Ge.depthBuffer&&(ke.__webglDepthRenderbuffer=n.createRenderbuffer(),Ne(ke.__webglDepthRenderbuffer,Ge,!0)),o.bindFramebuffer(n.FRAMEBUFFER,null)}}if(He){o.bindTexture(n.TEXTURE_CUBE_MAP,it.__webglTexture),ve(n.TEXTURE_CUBE_MAP,he);for(let Zt=0;Zt<6;Zt++)if(he.mipmaps&&he.mipmaps.length>0)for(let wt=0;wt<he.mipmaps.length;wt++)Te(ke.__webglFramebuffer[Zt][wt],Ge,he,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Zt,wt);else Te(ke.__webglFramebuffer[Zt],Ge,he,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Zt,0);J(he)&&T(n.TEXTURE_CUBE_MAP),o.unbindTexture()}else if(ot){for(let Zt=0,wt=ht.length;Zt<wt;Zt++){const Et=ht[Zt],De=r.get(Et);o.bindTexture(n.TEXTURE_2D,De.__webglTexture),ve(n.TEXTURE_2D,Et),Te(ke.__webglFramebuffer,Ge,Et,n.COLOR_ATTACHMENT0+Zt,n.TEXTURE_2D,0),J(Et)&&T(n.TEXTURE_2D)}o.unbindTexture()}else{let Zt=n.TEXTURE_2D;if((Ge.isWebGL3DRenderTarget||Ge.isWebGLArrayRenderTarget)&&(Zt=Ge.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),o.bindTexture(Zt,it.__webglTexture),ve(Zt,he),he.mipmaps&&he.mipmaps.length>0)for(let wt=0;wt<he.mipmaps.length;wt++)Te(ke.__webglFramebuffer[wt],Ge,he,n.COLOR_ATTACHMENT0,Zt,wt);else Te(ke.__webglFramebuffer,Ge,he,n.COLOR_ATTACHMENT0,Zt,0);J(he)&&T(Zt),o.unbindTexture()}Ge.depthBuffer&&dt(Ge)}function Qe(Ge){const he=Ge.textures;for(let ke=0,it=he.length;ke<it;ke++){const ht=he[ke];if(J(ht)){const He=L(Ge),ot=r.get(ht).__webglTexture;o.bindTexture(He,ot),T(He),o.unbindTexture()}}}const Oe=[],be=[];function yt(Ge){if(Ge.samples>0){if(Gt(Ge)===!1){const he=Ge.textures,ke=Ge.width,it=Ge.height;let ht=n.COLOR_BUFFER_BIT;const He=Ge.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ot=r.get(Ge),Zt=he.length>1;if(Zt)for(let wt=0;wt<he.length;wt++)o.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+wt,n.RENDERBUFFER,null),o.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+wt,n.TEXTURE_2D,null,0);o.bindFramebuffer(n.READ_FRAMEBUFFER,ot.__webglMultisampledFramebuffer),o.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglFramebuffer);for(let wt=0;wt<he.length;wt++){if(Ge.resolveDepthBuffer&&(Ge.depthBuffer&&(ht|=n.DEPTH_BUFFER_BIT),Ge.stencilBuffer&&Ge.resolveStencilBuffer&&(ht|=n.STENCIL_BUFFER_BIT)),Zt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ot.__webglColorRenderbuffer[wt]);const Et=r.get(he[wt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Et,0)}n.blitFramebuffer(0,0,ke,it,0,0,ke,it,ht,n.NEAREST),f===!0&&(Oe.length=0,be.length=0,Oe.push(n.COLOR_ATTACHMENT0+wt),Ge.depthBuffer&&Ge.resolveDepthBuffer===!1&&(Oe.push(He),be.push(He),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,be)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Oe))}if(o.bindFramebuffer(n.READ_FRAMEBUFFER,null),o.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Zt)for(let wt=0;wt<he.length;wt++){o.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+wt,n.RENDERBUFFER,ot.__webglColorRenderbuffer[wt]);const Et=r.get(he[wt]).__webglTexture;o.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+wt,n.TEXTURE_2D,Et,0)}o.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglMultisampledFramebuffer)}else if(Ge.depthBuffer&&Ge.resolveDepthBuffer===!1&&f){const he=Ge.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[he])}}}function st(Ge){return Math.min(u.maxSamples,Ge.samples)}function Gt(Ge){const he=r.get(Ge);return Ge.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&he.__useRenderToTexture!==!1}function rt(Ge){const he=C.render.frame;G.get(Ge)!==he&&(G.set(Ge,he),Ge.update())}function Yt(Ge,he){const ke=Ge.colorSpace,it=Ge.format,ht=Ge.type;return Ge.isCompressedTexture===!0||Ge.isVideoTexture===!0||ke!==LinearSRGBColorSpace&&ke!==NoColorSpace&&(ColorManagement.getTransfer(ke)===SRGBTransfer?(it!==RGBAFormat||ht!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ke)),he}function Xt(Ge){return typeof HTMLImageElement<"u"&&Ge instanceof HTMLImageElement?(A.width=Ge.naturalWidth||Ge.width,A.height=Ge.naturalHeight||Ge.height):typeof VideoFrame<"u"&&Ge instanceof VideoFrame?(A.width=Ge.displayWidth,A.height=Ge.displayHeight):(A.width=Ge.width,A.height=Ge.height),A}this.allocateTextureUnit=ue,this.resetTextureUnits=ce,this.setTexture2D=Se,this.setTexture2DArray=Ce,this.setTexture3D=Ze,this.setTextureCube=Be,this.rebindTextures=nt,this.setupRenderTarget=Rt,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=yt,this.setupDepthRenderbuffer=dt,this.setupFrameBufferTexture=Te,this.useMultisampledRTT=Gt}function WebGLUtils(n,t){function o(r,u=NoColorSpace){let d;const C=ColorManagement.getTransfer(u);if(r===UnsignedByteType)return n.UNSIGNED_BYTE;if(r===UnsignedShort4444Type)return n.UNSIGNED_SHORT_4_4_4_4;if(r===UnsignedShort5551Type)return n.UNSIGNED_SHORT_5_5_5_1;if(r===UnsignedInt5999Type)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===ByteType)return n.BYTE;if(r===ShortType)return n.SHORT;if(r===UnsignedShortType)return n.UNSIGNED_SHORT;if(r===IntType)return n.INT;if(r===UnsignedIntType)return n.UNSIGNED_INT;if(r===FloatType)return n.FLOAT;if(r===HalfFloatType)return n.HALF_FLOAT;if(r===AlphaFormat)return n.ALPHA;if(r===RGBFormat)return n.RGB;if(r===RGBAFormat)return n.RGBA;if(r===LuminanceFormat)return n.LUMINANCE;if(r===LuminanceAlphaFormat)return n.LUMINANCE_ALPHA;if(r===DepthFormat)return n.DEPTH_COMPONENT;if(r===DepthStencilFormat)return n.DEPTH_STENCIL;if(r===RedFormat)return n.RED;if(r===RedIntegerFormat)return n.RED_INTEGER;if(r===RGFormat)return n.RG;if(r===RGIntegerFormat)return n.RG_INTEGER;if(r===RGBAIntegerFormat)return n.RGBA_INTEGER;if(r===RGB_S3TC_DXT1_Format||r===RGBA_S3TC_DXT1_Format||r===RGBA_S3TC_DXT3_Format||r===RGBA_S3TC_DXT5_Format)if(C===SRGBTransfer)if(d=t.get("WEBGL_compressed_texture_s3tc_srgb"),d!==null){if(r===RGB_S3TC_DXT1_Format)return d.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(d=t.get("WEBGL_compressed_texture_s3tc"),d!==null){if(r===RGB_S3TC_DXT1_Format)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===RGB_PVRTC_4BPPV1_Format||r===RGB_PVRTC_2BPPV1_Format||r===RGBA_PVRTC_4BPPV1_Format||r===RGBA_PVRTC_2BPPV1_Format)if(d=t.get("WEBGL_compressed_texture_pvrtc"),d!==null){if(r===RGB_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===RGB_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===RGBA_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===RGBA_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===RGB_ETC1_Format||r===RGB_ETC2_Format||r===RGBA_ETC2_EAC_Format)if(d=t.get("WEBGL_compressed_texture_etc"),d!==null){if(r===RGB_ETC1_Format||r===RGB_ETC2_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ETC2:d.COMPRESSED_RGB8_ETC2;if(r===RGBA_ETC2_EAC_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:d.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===RGBA_ASTC_4x4_Format||r===RGBA_ASTC_5x4_Format||r===RGBA_ASTC_5x5_Format||r===RGBA_ASTC_6x5_Format||r===RGBA_ASTC_6x6_Format||r===RGBA_ASTC_8x5_Format||r===RGBA_ASTC_8x6_Format||r===RGBA_ASTC_8x8_Format||r===RGBA_ASTC_10x5_Format||r===RGBA_ASTC_10x6_Format||r===RGBA_ASTC_10x8_Format||r===RGBA_ASTC_10x10_Format||r===RGBA_ASTC_12x10_Format||r===RGBA_ASTC_12x12_Format)if(d=t.get("WEBGL_compressed_texture_astc"),d!==null){if(r===RGBA_ASTC_4x4_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:d.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===RGBA_ASTC_5x4_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:d.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===RGBA_ASTC_5x5_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:d.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===RGBA_ASTC_6x5_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:d.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===RGBA_ASTC_6x6_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:d.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===RGBA_ASTC_8x5_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:d.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===RGBA_ASTC_8x6_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:d.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===RGBA_ASTC_8x8_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:d.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===RGBA_ASTC_10x5_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:d.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===RGBA_ASTC_10x6_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:d.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===RGBA_ASTC_10x8_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:d.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===RGBA_ASTC_10x10_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:d.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===RGBA_ASTC_12x10_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:d.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===RGBA_ASTC_12x12_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:d.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===RGBA_BPTC_Format||r===RGB_BPTC_SIGNED_Format||r===RGB_BPTC_UNSIGNED_Format)if(d=t.get("EXT_texture_compression_bptc"),d!==null){if(r===RGBA_BPTC_Format)return C===SRGBTransfer?d.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:d.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===RGB_BPTC_SIGNED_Format)return d.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===RGB_BPTC_UNSIGNED_Format)return d.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===RED_RGTC1_Format||r===SIGNED_RED_RGTC1_Format||r===RED_GREEN_RGTC2_Format||r===SIGNED_RED_GREEN_RGTC2_Format)if(d=t.get("EXT_texture_compression_rgtc"),d!==null){if(r===RGBA_BPTC_Format)return d.COMPRESSED_RED_RGTC1_EXT;if(r===SIGNED_RED_RGTC1_Format)return d.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===RED_GREEN_RGTC2_Format)return d.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===SIGNED_RED_GREEN_RGTC2_Format)return d.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===UnsignedInt248Type?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:o}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,o,r){if(this.texture===null){const u=new Texture,d=t.properties.get(u);d.__webglTexture=o.texture,(o.depthNear!==r.depthNear||o.depthFar!==r.depthFar)&&(this.depthNear=o.depthNear,this.depthFar=o.depthFar),this.texture=u}}getMesh(t){if(this.texture!==null&&this.mesh===null){const o=t.cameras[0].viewport,r=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:o.z},depthHeight:{value:o.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher$1{constructor(t,o){super();const r=this;let u=null,d=1,C=null,I="local-floor",f=1,A=null,G=null,B=null,Z=null,w=null,V=null;const Y=new WebXRDepthSensing,J=o.getContextAttributes();let T=null,L=null;const z=[],K=[],P=new Vector2;let $=null;const ie=new PerspectiveCamera;ie.viewport=new Vector4;const ne=new PerspectiveCamera;ne.viewport=new Vector4;const ee=[ie,ne],se=new ArrayCamera;let re=null,ce=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ae){let Xe=z[Ae];return Xe===void 0&&(Xe=new WebXRController,z[Ae]=Xe),Xe.getTargetRaySpace()},this.getControllerGrip=function(Ae){let Xe=z[Ae];return Xe===void 0&&(Xe=new WebXRController,z[Ae]=Xe),Xe.getGripSpace()},this.getHand=function(Ae){let Xe=z[Ae];return Xe===void 0&&(Xe=new WebXRController,z[Ae]=Xe),Xe.getHandSpace()};function ue(Ae){const Xe=K.indexOf(Ae.inputSource);if(Xe===-1)return;const Te=z[Xe];Te!==void 0&&(Te.update(Ae.inputSource,Ae.frame,A||C),Te.dispatchEvent({type:Ae.type,data:Ae.inputSource}))}function ye(){u.removeEventListener("select",ue),u.removeEventListener("selectstart",ue),u.removeEventListener("selectend",ue),u.removeEventListener("squeeze",ue),u.removeEventListener("squeezestart",ue),u.removeEventListener("squeezeend",ue),u.removeEventListener("end",ye),u.removeEventListener("inputsourceschange",Se);for(let Ae=0;Ae<z.length;Ae++){const Xe=K[Ae];Xe!==null&&(K[Ae]=null,z[Ae].disconnect(Xe))}re=null,ce=null,Y.reset(),t.setRenderTarget(T),w=null,Z=null,B=null,u=null,L=null,le.stop(),r.isPresenting=!1,t.setPixelRatio($),t.setSize(P.width,P.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ae){d=Ae,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ae){I=Ae,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return A||C},this.setReferenceSpace=function(Ae){A=Ae},this.getBaseLayer=function(){return Z!==null?Z:w},this.getBinding=function(){return B},this.getFrame=function(){return V},this.getSession=function(){return u},this.setSession=async function(Ae){if(u=Ae,u!==null){if(T=t.getRenderTarget(),u.addEventListener("select",ue),u.addEventListener("selectstart",ue),u.addEventListener("selectend",ue),u.addEventListener("squeeze",ue),u.addEventListener("squeezestart",ue),u.addEventListener("squeezeend",ue),u.addEventListener("end",ye),u.addEventListener("inputsourceschange",Se),J.xrCompatible!==!0&&await o.makeXRCompatible(),$=t.getPixelRatio(),t.getSize(P),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Te=null,Ne=null,We=null;J.depth&&(We=J.stencil?o.DEPTH24_STENCIL8:o.DEPTH_COMPONENT24,Te=J.stencil?DepthStencilFormat:DepthFormat,Ne=J.stencil?UnsignedInt248Type:UnsignedIntType);const dt={colorFormat:o.RGBA8,depthFormat:We,scaleFactor:d};B=new XRWebGLBinding(u,o),Z=B.createProjectionLayer(dt),u.updateRenderState({layers:[Z]}),t.setPixelRatio(1),t.setSize(Z.textureWidth,Z.textureHeight,!1),L=new WebGLRenderTarget(Z.textureWidth,Z.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(Z.textureWidth,Z.textureHeight,Ne,void 0,void 0,void 0,void 0,void 0,void 0,Te),stencilBuffer:J.stencil,colorSpace:t.outputColorSpace,samples:J.antialias?4:0,resolveDepthBuffer:Z.ignoreDepthValues===!1,resolveStencilBuffer:Z.ignoreDepthValues===!1})}else{const Te={antialias:J.antialias,alpha:!0,depth:J.depth,stencil:J.stencil,framebufferScaleFactor:d};w=new XRWebGLLayer(u,o,Te),u.updateRenderState({baseLayer:w}),t.setPixelRatio(1),t.setSize(w.framebufferWidth,w.framebufferHeight,!1),L=new WebGLRenderTarget(w.framebufferWidth,w.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:t.outputColorSpace,stencilBuffer:J.stencil,resolveDepthBuffer:w.ignoreDepthValues===!1,resolveStencilBuffer:w.ignoreDepthValues===!1})}L.isXRRenderTarget=!0,this.setFoveation(f),A=null,C=await u.requestReferenceSpace(I),le.setContext(u),le.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(u!==null)return u.environmentBlendMode},this.getDepthTexture=function(){return Y.getDepthTexture()};function Se(Ae){for(let Xe=0;Xe<Ae.removed.length;Xe++){const Te=Ae.removed[Xe],Ne=K.indexOf(Te);Ne>=0&&(K[Ne]=null,z[Ne].disconnect(Te))}for(let Xe=0;Xe<Ae.added.length;Xe++){const Te=Ae.added[Xe];let Ne=K.indexOf(Te);if(Ne===-1){for(let dt=0;dt<z.length;dt++)if(dt>=K.length){K.push(Te),Ne=dt;break}else if(K[dt]===null){K[dt]=Te,Ne=dt;break}if(Ne===-1)break}const We=z[Ne];We&&We.connect(Te)}}const Ce=new Vector3,Ze=new Vector3;function Be(Ae,Xe,Te){Ce.setFromMatrixPosition(Xe.matrixWorld),Ze.setFromMatrixPosition(Te.matrixWorld);const Ne=Ce.distanceTo(Ze),We=Xe.projectionMatrix.elements,dt=Te.projectionMatrix.elements,nt=We[14]/(We[10]-1),Rt=We[14]/(We[10]+1),Qe=(We[9]+1)/We[5],Oe=(We[9]-1)/We[5],be=(We[8]-1)/We[0],yt=(dt[8]+1)/dt[0],st=nt*be,Gt=nt*yt,rt=Ne/(-be+yt),Yt=rt*-be;if(Xe.matrixWorld.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.translateX(Yt),Ae.translateZ(rt),Ae.matrixWorld.compose(Ae.position,Ae.quaternion,Ae.scale),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert(),We[10]===-1)Ae.projectionMatrix.copy(Xe.projectionMatrix),Ae.projectionMatrixInverse.copy(Xe.projectionMatrixInverse);else{const Xt=nt+rt,Ge=Rt+rt,he=st-Yt,ke=Gt+(Ne-Yt),it=Qe*Rt/Ge*Xt,ht=Oe*Rt/Ge*Xt;Ae.projectionMatrix.makePerspective(he,ke,it,ht,Xt,Ge),Ae.projectionMatrixInverse.copy(Ae.projectionMatrix).invert()}}function xe(Ae,Xe){Xe===null?Ae.matrixWorld.copy(Ae.matrix):Ae.matrixWorld.multiplyMatrices(Xe.matrixWorld,Ae.matrix),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert()}this.updateCamera=function(Ae){if(u===null)return;let Xe=Ae.near,Te=Ae.far;Y.texture!==null&&(Y.depthNear>0&&(Xe=Y.depthNear),Y.depthFar>0&&(Te=Y.depthFar)),se.near=ne.near=ie.near=Xe,se.far=ne.far=ie.far=Te,(re!==se.near||ce!==se.far)&&(u.updateRenderState({depthNear:se.near,depthFar:se.far}),re=se.near,ce=se.far),ie.layers.mask=Ae.layers.mask|2,ne.layers.mask=Ae.layers.mask|4,se.layers.mask=ie.layers.mask|ne.layers.mask;const Ne=Ae.parent,We=se.cameras;xe(se,Ne);for(let dt=0;dt<We.length;dt++)xe(We[dt],Ne);We.length===2?Be(se,ie,ne):se.projectionMatrix.copy(ie.projectionMatrix),ge(Ae,se,Ne)};function ge(Ae,Xe,Te){Te===null?Ae.matrix.copy(Xe.matrixWorld):(Ae.matrix.copy(Te.matrixWorld),Ae.matrix.invert(),Ae.matrix.multiply(Xe.matrixWorld)),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.updateMatrixWorld(!0),Ae.projectionMatrix.copy(Xe.projectionMatrix),Ae.projectionMatrixInverse.copy(Xe.projectionMatrixInverse),Ae.isPerspectiveCamera&&(Ae.fov=RAD2DEG*2*Math.atan(1/Ae.projectionMatrix.elements[5]),Ae.zoom=1)}this.getCamera=function(){return se},this.getFoveation=function(){if(!(Z===null&&w===null))return f},this.setFoveation=function(Ae){f=Ae,Z!==null&&(Z.fixedFoveation=Ae),w!==null&&w.fixedFoveation!==void 0&&(w.fixedFoveation=Ae)},this.hasDepthSensing=function(){return Y.texture!==null},this.getDepthSensingMesh=function(){return Y.getMesh(se)};let de=null;function ve(Ae,Xe){if(G=Xe.getViewerPose(A||C),V=Xe,G!==null){const Te=G.views;w!==null&&(t.setRenderTargetFramebuffer(L,w.framebuffer),t.setRenderTarget(L));let Ne=!1;Te.length!==se.cameras.length&&(se.cameras.length=0,Ne=!0);for(let nt=0;nt<Te.length;nt++){const Rt=Te[nt];let Qe=null;if(w!==null)Qe=w.getViewport(Rt);else{const be=B.getViewSubImage(Z,Rt);Qe=be.viewport,nt===0&&(t.setRenderTargetTextures(L,be.colorTexture,Z.ignoreDepthValues?void 0:be.depthStencilTexture),t.setRenderTarget(L))}let Oe=ee[nt];Oe===void 0&&(Oe=new PerspectiveCamera,Oe.layers.enable(nt),Oe.viewport=new Vector4,ee[nt]=Oe),Oe.matrix.fromArray(Rt.transform.matrix),Oe.matrix.decompose(Oe.position,Oe.quaternion,Oe.scale),Oe.projectionMatrix.fromArray(Rt.projectionMatrix),Oe.projectionMatrixInverse.copy(Oe.projectionMatrix).invert(),Oe.viewport.set(Qe.x,Qe.y,Qe.width,Qe.height),nt===0&&(se.matrix.copy(Oe.matrix),se.matrix.decompose(se.position,se.quaternion,se.scale)),Ne===!0&&se.cameras.push(Oe)}const We=u.enabledFeatures;if(We&&We.includes("depth-sensing")&&u.depthUsage=="gpu-optimized"&&B){const nt=B.getDepthInformation(Te[0]);nt&&nt.isValid&&nt.texture&&Y.init(t,nt,u.renderState)}}for(let Te=0;Te<z.length;Te++){const Ne=K[Te],We=z[Te];Ne!==null&&We!==void 0&&We.update(Ne,Xe,A||C)}de&&de(Ae,Xe),Xe.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Xe}),V=null}const le=new WebGLAnimation;le.setAnimationLoop(ve),this.setAnimationLoop=function(Ae){de=Ae},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(n,t){function o(J,T){J.matrixAutoUpdate===!0&&J.updateMatrix(),T.value.copy(J.matrix)}function r(J,T){T.color.getRGB(J.fogColor.value,getUnlitUniformColorSpace(n)),T.isFog?(J.fogNear.value=T.near,J.fogFar.value=T.far):T.isFogExp2&&(J.fogDensity.value=T.density)}function u(J,T,L,z,K){T.isMeshBasicMaterial||T.isMeshLambertMaterial?d(J,T):T.isMeshToonMaterial?(d(J,T),B(J,T)):T.isMeshPhongMaterial?(d(J,T),G(J,T)):T.isMeshStandardMaterial?(d(J,T),Z(J,T),T.isMeshPhysicalMaterial&&w(J,T,K)):T.isMeshMatcapMaterial?(d(J,T),V(J,T)):T.isMeshDepthMaterial?d(J,T):T.isMeshDistanceMaterial?(d(J,T),Y(J,T)):T.isMeshNormalMaterial?d(J,T):T.isLineBasicMaterial?(C(J,T),T.isLineDashedMaterial&&I(J,T)):T.isPointsMaterial?f(J,T,L,z):T.isSpriteMaterial?A(J,T):T.isShadowMaterial?(J.color.value.copy(T.color),J.opacity.value=T.opacity):T.isShaderMaterial&&(T.uniformsNeedUpdate=!1)}function d(J,T){J.opacity.value=T.opacity,T.color&&J.diffuse.value.copy(T.color),T.emissive&&J.emissive.value.copy(T.emissive).multiplyScalar(T.emissiveIntensity),T.map&&(J.map.value=T.map,o(T.map,J.mapTransform)),T.alphaMap&&(J.alphaMap.value=T.alphaMap,o(T.alphaMap,J.alphaMapTransform)),T.bumpMap&&(J.bumpMap.value=T.bumpMap,o(T.bumpMap,J.bumpMapTransform),J.bumpScale.value=T.bumpScale,T.side===BackSide&&(J.bumpScale.value*=-1)),T.normalMap&&(J.normalMap.value=T.normalMap,o(T.normalMap,J.normalMapTransform),J.normalScale.value.copy(T.normalScale),T.side===BackSide&&J.normalScale.value.negate()),T.displacementMap&&(J.displacementMap.value=T.displacementMap,o(T.displacementMap,J.displacementMapTransform),J.displacementScale.value=T.displacementScale,J.displacementBias.value=T.displacementBias),T.emissiveMap&&(J.emissiveMap.value=T.emissiveMap,o(T.emissiveMap,J.emissiveMapTransform)),T.specularMap&&(J.specularMap.value=T.specularMap,o(T.specularMap,J.specularMapTransform)),T.alphaTest>0&&(J.alphaTest.value=T.alphaTest);const L=t.get(T),z=L.envMap,K=L.envMapRotation;z&&(J.envMap.value=z,_e1.copy(K),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,z.isCubeTexture&&z.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),J.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),J.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,J.reflectivity.value=T.reflectivity,J.ior.value=T.ior,J.refractionRatio.value=T.refractionRatio),T.lightMap&&(J.lightMap.value=T.lightMap,J.lightMapIntensity.value=T.lightMapIntensity,o(T.lightMap,J.lightMapTransform)),T.aoMap&&(J.aoMap.value=T.aoMap,J.aoMapIntensity.value=T.aoMapIntensity,o(T.aoMap,J.aoMapTransform))}function C(J,T){J.diffuse.value.copy(T.color),J.opacity.value=T.opacity,T.map&&(J.map.value=T.map,o(T.map,J.mapTransform))}function I(J,T){J.dashSize.value=T.dashSize,J.totalSize.value=T.dashSize+T.gapSize,J.scale.value=T.scale}function f(J,T,L,z){J.diffuse.value.copy(T.color),J.opacity.value=T.opacity,J.size.value=T.size*L,J.scale.value=z*.5,T.map&&(J.map.value=T.map,o(T.map,J.uvTransform)),T.alphaMap&&(J.alphaMap.value=T.alphaMap,o(T.alphaMap,J.alphaMapTransform)),T.alphaTest>0&&(J.alphaTest.value=T.alphaTest)}function A(J,T){J.diffuse.value.copy(T.color),J.opacity.value=T.opacity,J.rotation.value=T.rotation,T.map&&(J.map.value=T.map,o(T.map,J.mapTransform)),T.alphaMap&&(J.alphaMap.value=T.alphaMap,o(T.alphaMap,J.alphaMapTransform)),T.alphaTest>0&&(J.alphaTest.value=T.alphaTest)}function G(J,T){J.specular.value.copy(T.specular),J.shininess.value=Math.max(T.shininess,1e-4)}function B(J,T){T.gradientMap&&(J.gradientMap.value=T.gradientMap)}function Z(J,T){J.metalness.value=T.metalness,T.metalnessMap&&(J.metalnessMap.value=T.metalnessMap,o(T.metalnessMap,J.metalnessMapTransform)),J.roughness.value=T.roughness,T.roughnessMap&&(J.roughnessMap.value=T.roughnessMap,o(T.roughnessMap,J.roughnessMapTransform)),T.envMap&&(J.envMapIntensity.value=T.envMapIntensity)}function w(J,T,L){J.ior.value=T.ior,T.sheen>0&&(J.sheenColor.value.copy(T.sheenColor).multiplyScalar(T.sheen),J.sheenRoughness.value=T.sheenRoughness,T.sheenColorMap&&(J.sheenColorMap.value=T.sheenColorMap,o(T.sheenColorMap,J.sheenColorMapTransform)),T.sheenRoughnessMap&&(J.sheenRoughnessMap.value=T.sheenRoughnessMap,o(T.sheenRoughnessMap,J.sheenRoughnessMapTransform))),T.clearcoat>0&&(J.clearcoat.value=T.clearcoat,J.clearcoatRoughness.value=T.clearcoatRoughness,T.clearcoatMap&&(J.clearcoatMap.value=T.clearcoatMap,o(T.clearcoatMap,J.clearcoatMapTransform)),T.clearcoatRoughnessMap&&(J.clearcoatRoughnessMap.value=T.clearcoatRoughnessMap,o(T.clearcoatRoughnessMap,J.clearcoatRoughnessMapTransform)),T.clearcoatNormalMap&&(J.clearcoatNormalMap.value=T.clearcoatNormalMap,o(T.clearcoatNormalMap,J.clearcoatNormalMapTransform),J.clearcoatNormalScale.value.copy(T.clearcoatNormalScale),T.side===BackSide&&J.clearcoatNormalScale.value.negate())),T.dispersion>0&&(J.dispersion.value=T.dispersion),T.iridescence>0&&(J.iridescence.value=T.iridescence,J.iridescenceIOR.value=T.iridescenceIOR,J.iridescenceThicknessMinimum.value=T.iridescenceThicknessRange[0],J.iridescenceThicknessMaximum.value=T.iridescenceThicknessRange[1],T.iridescenceMap&&(J.iridescenceMap.value=T.iridescenceMap,o(T.iridescenceMap,J.iridescenceMapTransform)),T.iridescenceThicknessMap&&(J.iridescenceThicknessMap.value=T.iridescenceThicknessMap,o(T.iridescenceThicknessMap,J.iridescenceThicknessMapTransform))),T.transmission>0&&(J.transmission.value=T.transmission,J.transmissionSamplerMap.value=L.texture,J.transmissionSamplerSize.value.set(L.width,L.height),T.transmissionMap&&(J.transmissionMap.value=T.transmissionMap,o(T.transmissionMap,J.transmissionMapTransform)),J.thickness.value=T.thickness,T.thicknessMap&&(J.thicknessMap.value=T.thicknessMap,o(T.thicknessMap,J.thicknessMapTransform)),J.attenuationDistance.value=T.attenuationDistance,J.attenuationColor.value.copy(T.attenuationColor)),T.anisotropy>0&&(J.anisotropyVector.value.set(T.anisotropy*Math.cos(T.anisotropyRotation),T.anisotropy*Math.sin(T.anisotropyRotation)),T.anisotropyMap&&(J.anisotropyMap.value=T.anisotropyMap,o(T.anisotropyMap,J.anisotropyMapTransform))),J.specularIntensity.value=T.specularIntensity,J.specularColor.value.copy(T.specularColor),T.specularColorMap&&(J.specularColorMap.value=T.specularColorMap,o(T.specularColorMap,J.specularColorMapTransform)),T.specularIntensityMap&&(J.specularIntensityMap.value=T.specularIntensityMap,o(T.specularIntensityMap,J.specularIntensityMapTransform))}function V(J,T){T.matcap&&(J.matcap.value=T.matcap)}function Y(J,T){const L=t.get(T).light;J.referencePosition.value.setFromMatrixPosition(L.matrixWorld),J.nearDistance.value=L.shadow.camera.near,J.farDistance.value=L.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:u}}function WebGLUniformsGroups(n,t,o,r){let u={},d={},C=[];const I=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function f(L,z){const K=z.program;r.uniformBlockBinding(L,K)}function A(L,z){let K=u[L.id];K===void 0&&(V(L),K=G(L),u[L.id]=K,L.addEventListener("dispose",J));const P=z.program;r.updateUBOMapping(L,P);const $=t.render.frame;d[L.id]!==$&&(Z(L),d[L.id]=$)}function G(L){const z=B();L.__bindingPointIndex=z;const K=n.createBuffer(),P=L.__size,$=L.usage;return n.bindBuffer(n.UNIFORM_BUFFER,K),n.bufferData(n.UNIFORM_BUFFER,P,$),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,z,K),K}function B(){for(let L=0;L<I;L++)if(C.indexOf(L)===-1)return C.push(L),L;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function Z(L){const z=u[L.id],K=L.uniforms,P=L.__cache;n.bindBuffer(n.UNIFORM_BUFFER,z);for(let $=0,ie=K.length;$<ie;$++){const ne=Array.isArray(K[$])?K[$]:[K[$]];for(let ee=0,se=ne.length;ee<se;ee++){const re=ne[ee];if(w(re,$,ee,P)===!0){const ce=re.__offset,ue=Array.isArray(re.value)?re.value:[re.value];let ye=0;for(let Se=0;Se<ue.length;Se++){const Ce=ue[Se],Ze=Y(Ce);typeof Ce=="number"||typeof Ce=="boolean"?(re.__data[0]=Ce,n.bufferSubData(n.UNIFORM_BUFFER,ce+ye,re.__data)):Ce.isMatrix3?(re.__data[0]=Ce.elements[0],re.__data[1]=Ce.elements[1],re.__data[2]=Ce.elements[2],re.__data[3]=0,re.__data[4]=Ce.elements[3],re.__data[5]=Ce.elements[4],re.__data[6]=Ce.elements[5],re.__data[7]=0,re.__data[8]=Ce.elements[6],re.__data[9]=Ce.elements[7],re.__data[10]=Ce.elements[8],re.__data[11]=0):(Ce.toArray(re.__data,ye),ye+=Ze.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,ce,re.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function w(L,z,K,P){const $=L.value,ie=z+"_"+K;if(P[ie]===void 0)return typeof $=="number"||typeof $=="boolean"?P[ie]=$:P[ie]=$.clone(),!0;{const ne=P[ie];if(typeof $=="number"||typeof $=="boolean"){if(ne!==$)return P[ie]=$,!0}else if(ne.equals($)===!1)return ne.copy($),!0}return!1}function V(L){const z=L.uniforms;let K=0;const P=16;for(let ie=0,ne=z.length;ie<ne;ie++){const ee=Array.isArray(z[ie])?z[ie]:[z[ie]];for(let se=0,re=ee.length;se<re;se++){const ce=ee[se],ue=Array.isArray(ce.value)?ce.value:[ce.value];for(let ye=0,Se=ue.length;ye<Se;ye++){const Ce=ue[ye],Ze=Y(Ce),Be=K%P,xe=Be%Ze.boundary,ge=Be+xe;K+=xe,ge!==0&&P-ge<Ze.storage&&(K+=P-ge),ce.__data=new Float32Array(Ze.storage/Float32Array.BYTES_PER_ELEMENT),ce.__offset=K,K+=Ze.storage}}}const $=K%P;return $>0&&(K+=P-$),L.__size=K,L.__cache={},this}function Y(L){const z={boundary:0,storage:0};return typeof L=="number"||typeof L=="boolean"?(z.boundary=4,z.storage=4):L.isVector2?(z.boundary=8,z.storage=8):L.isVector3||L.isColor?(z.boundary=16,z.storage=12):L.isVector4?(z.boundary=16,z.storage=16):L.isMatrix3?(z.boundary=48,z.storage=48):L.isMatrix4?(z.boundary=64,z.storage=64):L.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",L),z}function J(L){const z=L.target;z.removeEventListener("dispose",J);const K=C.indexOf(z.__bindingPointIndex);C.splice(K,1),n.deleteBuffer(u[z.id]),delete u[z.id],delete d[z.id]}function T(){for(const L in u)n.deleteBuffer(u[L]);C=[],u={},d={}}return{bind:f,update:A,dispose:T}}class WebGLRenderer{constructor(t={}){const{canvas:o=createCanvasElement(),context:r=null,depth:u=!0,stencil:d=!1,alpha:C=!1,antialias:I=!1,premultipliedAlpha:f=!0,preserveDrawingBuffer:A=!1,powerPreference:G="default",failIfMajorPerformanceCaveat:B=!1,reverseDepthBuffer:Z=!1}=t;this.isWebGLRenderer=!0;let w;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");w=r.getContextAttributes().alpha}else w=C;const V=new Uint32Array(4),Y=new Int32Array(4);let J=null,T=null;const L=[],z=[];this.domElement=o,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const K=this;let P=!1,$=0,ie=0,ne=null,ee=-1,se=null;const re=new Vector4,ce=new Vector4;let ue=null;const ye=new Color(0);let Se=0,Ce=o.width,Ze=o.height,Be=1,xe=null,ge=null;const de=new Vector4(0,0,Ce,Ze),ve=new Vector4(0,0,Ce,Ze);let le=!1;const Ae=new Frustum;let Xe=!1,Te=!1;this.transmissionResolutionScale=1;const Ne=new Matrix4,We=new Matrix4,dt=new Vector3,nt=new Vector4,Rt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Qe=!1;function Oe(){return ne===null?Be:1}let be=r;function yt(Ie,Ve){return o.getContext(Ie,Ve)}try{const Ie={alpha:!0,depth:u,stencil:d,antialias:I,premultipliedAlpha:f,preserveDrawingBuffer:A,powerPreference:G,failIfMajorPerformanceCaveat:B};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${REVISION}`),o.addEventListener("webglcontextlost",at,!1),o.addEventListener("webglcontextrestored",bt,!1),o.addEventListener("webglcontextcreationerror",_t,!1),be===null){const Ve="webgl2";if(be=yt(Ve,Ie),be===null)throw yt(Ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ie){throw console.error("THREE.WebGLRenderer: "+Ie.message),Ie}let st,Gt,rt,Yt,Xt,Ge,he,ke,it,ht,He,ot,Zt,wt,Et,De,ct,ft,At,Ct,me,Ee,_e,Me;function Bt(){st=new WebGLExtensions(be),st.init(),Ee=new WebGLUtils(be,st),Gt=new WebGLCapabilities(be,st,t,Ee),rt=new WebGLState(be,st),Gt.reverseDepthBuffer&&Z&&rt.buffers.depth.setReversed(!0),Yt=new WebGLInfo(be),Xt=new WebGLProperties,Ge=new WebGLTextures(be,st,rt,Xt,Gt,Ee,Yt),he=new WebGLCubeMaps(K),ke=new WebGLCubeUVMaps(K),it=new WebGLAttributes(be),_e=new WebGLBindingStates(be,it),ht=new WebGLGeometries(be,it,Yt,_e),He=new WebGLObjects(be,ht,it,Yt),At=new WebGLMorphtargets(be,Gt,Ge),De=new WebGLClipping(Xt),ot=new WebGLPrograms(K,he,ke,st,Gt,_e,De),Zt=new WebGLMaterials(K,Xt),wt=new WebGLRenderLists,Et=new WebGLRenderStates(st),ft=new WebGLBackground(K,he,ke,rt,He,w,f),ct=new WebGLShadowMap(K,He,Gt),Me=new WebGLUniformsGroups(be,Yt,Gt,rt),Ct=new WebGLBufferRenderer(be,st,Yt),me=new WebGLIndexedBufferRenderer(be,st,Yt),Yt.programs=ot.programs,K.capabilities=Gt,K.extensions=st,K.properties=Xt,K.renderLists=wt,K.shadowMap=ct,K.state=rt,K.info=Yt}Bt();const qe=new WebXRManager(K,be);this.xr=qe,this.getContext=function(){return be},this.getContextAttributes=function(){return be.getContextAttributes()},this.forceContextLoss=function(){const Ie=st.get("WEBGL_lose_context");Ie&&Ie.loseContext()},this.forceContextRestore=function(){const Ie=st.get("WEBGL_lose_context");Ie&&Ie.restoreContext()},this.getPixelRatio=function(){return Be},this.setPixelRatio=function(Ie){Ie!==void 0&&(Be=Ie,this.setSize(Ce,Ze,!1))},this.getSize=function(Ie){return Ie.set(Ce,Ze)},this.setSize=function(Ie,Ve,$e=!0){if(qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ce=Ie,Ze=Ve,o.width=Math.floor(Ie*Be),o.height=Math.floor(Ve*Be),$e===!0&&(o.style.width=Ie+"px",o.style.height=Ve+"px"),this.setViewport(0,0,Ie,Ve)},this.getDrawingBufferSize=function(Ie){return Ie.set(Ce*Be,Ze*Be).floor()},this.setDrawingBufferSize=function(Ie,Ve,$e){Ce=Ie,Ze=Ve,Be=$e,o.width=Math.floor(Ie*$e),o.height=Math.floor(Ve*$e),this.setViewport(0,0,Ie,Ve)},this.getCurrentViewport=function(Ie){return Ie.copy(re)},this.getViewport=function(Ie){return Ie.copy(de)},this.setViewport=function(Ie,Ve,$e,Pe){Ie.isVector4?de.set(Ie.x,Ie.y,Ie.z,Ie.w):de.set(Ie,Ve,$e,Pe),rt.viewport(re.copy(de).multiplyScalar(Be).round())},this.getScissor=function(Ie){return Ie.copy(ve)},this.setScissor=function(Ie,Ve,$e,Pe){Ie.isVector4?ve.set(Ie.x,Ie.y,Ie.z,Ie.w):ve.set(Ie,Ve,$e,Pe),rt.scissor(ce.copy(ve).multiplyScalar(Be).round())},this.getScissorTest=function(){return le},this.setScissorTest=function(Ie){rt.setScissorTest(le=Ie)},this.setOpaqueSort=function(Ie){xe=Ie},this.setTransparentSort=function(Ie){ge=Ie},this.getClearColor=function(Ie){return Ie.copy(ft.getClearColor())},this.setClearColor=function(){ft.setClearColor(...arguments)},this.getClearAlpha=function(){return ft.getClearAlpha()},this.setClearAlpha=function(){ft.setClearAlpha(...arguments)},this.clear=function(Ie=!0,Ve=!0,$e=!0){let Pe=0;if(Ie){let Le=!1;if(ne!==null){const pt=ne.texture.format;Le=pt===RGBAIntegerFormat||pt===RGIntegerFormat||pt===RedIntegerFormat}if(Le){const pt=ne.texture.type,Mt=pt===UnsignedByteType||pt===UnsignedIntType||pt===UnsignedShortType||pt===UnsignedInt248Type||pt===UnsignedShort4444Type||pt===UnsignedShort5551Type,Vt=ft.getClearColor(),Nt=ft.getClearAlpha(),Dt=Vt.r,Ot=Vt.g,zt=Vt.b;Mt?(V[0]=Dt,V[1]=Ot,V[2]=zt,V[3]=Nt,be.clearBufferuiv(be.COLOR,0,V)):(Y[0]=Dt,Y[1]=Ot,Y[2]=zt,Y[3]=Nt,be.clearBufferiv(be.COLOR,0,Y))}else Pe|=be.COLOR_BUFFER_BIT}Ve&&(Pe|=be.DEPTH_BUFFER_BIT),$e&&(Pe|=be.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),be.clear(Pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",at,!1),o.removeEventListener("webglcontextrestored",bt,!1),o.removeEventListener("webglcontextcreationerror",_t,!1),ft.dispose(),wt.dispose(),Et.dispose(),Xt.dispose(),he.dispose(),ke.dispose(),He.dispose(),_e.dispose(),Me.dispose(),ot.dispose(),qe.dispose(),qe.removeEventListener("sessionstart",Gn),qe.removeEventListener("sessionend",Ys),An.stop()};function at(Ie){Ie.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function bt(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1;const Ie=Yt.autoReset,Ve=ct.enabled,$e=ct.autoUpdate,Pe=ct.needsUpdate,Le=ct.type;Bt(),Yt.autoReset=Ie,ct.enabled=Ve,ct.autoUpdate=$e,ct.needsUpdate=Pe,ct.type=Le}function _t(Ie){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ie.statusMessage)}function Tt(Ie){const Ve=Ie.target;Ve.removeEventListener("dispose",Tt),si(Ve)}function si(Ie){Bi(Ie),Xt.remove(Ie)}function Bi(Ie){const Ve=Xt.get(Ie).programs;Ve!==void 0&&(Ve.forEach(function($e){ot.releaseProgram($e)}),Ie.isShaderMaterial&&ot.releaseShaderCache(Ie))}this.renderBufferDirect=function(Ie,Ve,$e,Pe,Le,pt){Ve===null&&(Ve=Rt);const Mt=Le.isMesh&&Le.matrixWorld.determinant()<0,Vt=Nl(Ie,Ve,$e,Pe,Le);rt.setMaterial(Pe,Mt);let Nt=$e.index,Dt=1;if(Pe.wireframe===!0){if(Nt=ht.getWireframeAttribute($e),Nt===void 0)return;Dt=2}const Ot=$e.drawRange,zt=$e.attributes.position;let di=Ot.start*Dt,Ci=(Ot.start+Ot.count)*Dt;pt!==null&&(di=Math.max(di,pt.start*Dt),Ci=Math.min(Ci,(pt.start+pt.count)*Dt)),Nt!==null?(di=Math.max(di,0),Ci=Math.min(Ci,Nt.count)):zt!=null&&(di=Math.max(di,0),Ci=Math.min(Ci,zt.count));const Ji=Ci-di;if(Ji<0||Ji===1/0)return;_e.setup(Le,Pe,Vt,$e,Nt);let Ai,jt=Ct;if(Nt!==null&&(Ai=it.get(Nt),jt=me,jt.setIndex(Ai)),Le.isMesh)Pe.wireframe===!0?(rt.setLineWidth(Pe.wireframeLinewidth*Oe()),jt.setMode(be.LINES)):jt.setMode(be.TRIANGLES);else if(Le.isLine){let Ft=Pe.linewidth;Ft===void 0&&(Ft=1),rt.setLineWidth(Ft*Oe()),Le.isLineSegments?jt.setMode(be.LINES):Le.isLineLoop?jt.setMode(be.LINE_LOOP):jt.setMode(be.LINE_STRIP)}else Le.isPoints?jt.setMode(be.POINTS):Le.isSprite&&jt.setMode(be.TRIANGLES);if(Le.isBatchedMesh)if(Le._multiDrawInstances!==null)warnOnce("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),jt.renderMultiDrawInstances(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount,Le._multiDrawInstances);else if(st.get("WEBGL_multi_draw"))jt.renderMultiDraw(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount);else{const Ft=Le._multiDrawStarts,cn=Le._multiDrawCounts,Ii=Le._multiDrawCount,kn=Nt?it.get(Nt).bytesPerElement:1,Cs=Xt.get(Pe).currentProgram.getUniforms();for(let Vn=0;Vn<Ii;Vn++)Cs.setValue(be,"_gl_DrawID",Vn),jt.render(Ft[Vn]/kn,cn[Vn])}else if(Le.isInstancedMesh)jt.renderInstances(di,Ji,Le.count);else if($e.isInstancedBufferGeometry){const Ft=$e._maxInstanceCount!==void 0?$e._maxInstanceCount:1/0,cn=Math.min($e.instanceCount,Ft);jt.renderInstances(di,Ji,cn)}else jt.render(di,Ji)};function ii(Ie,Ve,$e){Ie.transparent===!0&&Ie.side===DoubleSide&&Ie.forceSinglePass===!1?(Ie.side=BackSide,Ie.needsUpdate=!0,Qt(Ie,Ve,$e),Ie.side=FrontSide,Ie.needsUpdate=!0,Qt(Ie,Ve,$e),Ie.side=DoubleSide):Qt(Ie,Ve,$e)}this.compile=function(Ie,Ve,$e=null){$e===null&&($e=Ie),T=Et.get($e),T.init(Ve),z.push(T),$e.traverseVisible(function(Le){Le.isLight&&Le.layers.test(Ve.layers)&&(T.pushLight(Le),Le.castShadow&&T.pushShadow(Le))}),Ie!==$e&&Ie.traverseVisible(function(Le){Le.isLight&&Le.layers.test(Ve.layers)&&(T.pushLight(Le),Le.castShadow&&T.pushShadow(Le))}),T.setupLights();const Pe=new Set;return Ie.traverse(function(Le){if(!(Le.isMesh||Le.isPoints||Le.isLine||Le.isSprite))return;const pt=Le.material;if(pt)if(Array.isArray(pt))for(let Mt=0;Mt<pt.length;Mt++){const Vt=pt[Mt];ii(Vt,$e,Le),Pe.add(Vt)}else ii(pt,$e,Le),Pe.add(pt)}),T=z.pop(),Pe},this.compileAsync=function(Ie,Ve,$e=null){const Pe=this.compile(Ie,Ve,$e);return new Promise(Le=>{function pt(){if(Pe.forEach(function(Mt){Xt.get(Mt).currentProgram.isReady()&&Pe.delete(Mt)}),Pe.size===0){Le(Ie);return}setTimeout(pt,10)}st.get("KHR_parallel_shader_compile")!==null?pt():setTimeout(pt,10)})};let ci=null;function Zi(Ie){ci&&ci(Ie)}function Gn(){An.stop()}function Ys(){An.start()}const An=new WebGLAnimation;An.setAnimationLoop(Zi),typeof self<"u"&&An.setContext(self),this.setAnimationLoop=function(Ie){ci=Ie,qe.setAnimationLoop(Ie),Ie===null?An.stop():An.start()},qe.addEventListener("sessionstart",Gn),qe.addEventListener("sessionend",Ys),this.render=function(Ie,Ve){if(Ve!==void 0&&Ve.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(P===!0)return;if(Ie.matrixWorldAutoUpdate===!0&&Ie.updateMatrixWorld(),Ve.parent===null&&Ve.matrixWorldAutoUpdate===!0&&Ve.updateMatrixWorld(),qe.enabled===!0&&qe.isPresenting===!0&&(qe.cameraAutoUpdate===!0&&qe.updateCamera(Ve),Ve=qe.getCamera()),Ie.isScene===!0&&Ie.onBeforeRender(K,Ie,Ve,ne),T=Et.get(Ie,z.length),T.init(Ve),z.push(T),We.multiplyMatrices(Ve.projectionMatrix,Ve.matrixWorldInverse),Ae.setFromProjectionMatrix(We),Te=this.localClippingEnabled,Xe=De.init(this.clippingPlanes,Te),J=wt.get(Ie,L.length),J.init(),L.push(J),qe.enabled===!0&&qe.isPresenting===!0){const pt=K.xr.getDepthSensingMesh();pt!==null&&vn(pt,Ve,-1/0,K.sortObjects)}vn(Ie,Ve,0,K.sortObjects),J.finish(),K.sortObjects===!0&&J.sort(xe,ge),Qe=qe.enabled===!1||qe.isPresenting===!1||qe.hasDepthSensing()===!1,Qe&&ft.addToRenderList(J,Ie),this.info.render.frame++,Xe===!0&&De.beginShadows();const $e=T.state.shadowsArray;ct.render($e,Ie,Ve),Xe===!0&&De.endShadows(),this.info.autoReset===!0&&this.info.reset();const Pe=J.opaque,Le=J.transmissive;if(T.setupLights(),Ve.isArrayCamera){const pt=Ve.cameras;if(Le.length>0)for(let Mt=0,Vt=pt.length;Mt<Vt;Mt++){const Nt=pt[Mt];ns(Pe,Le,Ie,Nt)}Qe&&ft.render(Ie);for(let Mt=0,Vt=pt.length;Mt<Vt;Mt++){const Nt=pt[Mt];Nn(J,Ie,Nt,Nt.viewport)}}else Le.length>0&&ns(Pe,Le,Ie,Ve),Qe&&ft.render(Ie),Nn(J,Ie,Ve);ne!==null&&ie===0&&(Ge.updateMultisampleRenderTarget(ne),Ge.updateRenderTargetMipmap(ne)),Ie.isScene===!0&&Ie.onAfterRender(K,Ie,Ve),_e.resetDefaultState(),ee=-1,se=null,z.pop(),z.length>0?(T=z[z.length-1],Xe===!0&&De.setGlobalState(K.clippingPlanes,T.state.camera)):T=null,L.pop(),L.length>0?J=L[L.length-1]:J=null};function vn(Ie,Ve,$e,Pe){if(Ie.visible===!1)return;if(Ie.layers.test(Ve.layers)){if(Ie.isGroup)$e=Ie.renderOrder;else if(Ie.isLOD)Ie.autoUpdate===!0&&Ie.update(Ve);else if(Ie.isLight)T.pushLight(Ie),Ie.castShadow&&T.pushShadow(Ie);else if(Ie.isSprite){if(!Ie.frustumCulled||Ae.intersectsSprite(Ie)){Pe&&nt.setFromMatrixPosition(Ie.matrixWorld).applyMatrix4(We);const Mt=He.update(Ie),Vt=Ie.material;Vt.visible&&J.push(Ie,Mt,Vt,$e,nt.z,null)}}else if((Ie.isMesh||Ie.isLine||Ie.isPoints)&&(!Ie.frustumCulled||Ae.intersectsObject(Ie))){const Mt=He.update(Ie),Vt=Ie.material;if(Pe&&(Ie.boundingSphere!==void 0?(Ie.boundingSphere===null&&Ie.computeBoundingSphere(),nt.copy(Ie.boundingSphere.center)):(Mt.boundingSphere===null&&Mt.computeBoundingSphere(),nt.copy(Mt.boundingSphere.center)),nt.applyMatrix4(Ie.matrixWorld).applyMatrix4(We)),Array.isArray(Vt)){const Nt=Mt.groups;for(let Dt=0,Ot=Nt.length;Dt<Ot;Dt++){const zt=Nt[Dt],di=Vt[zt.materialIndex];di&&di.visible&&J.push(Ie,Mt,di,$e,nt.z,zt)}}else Vt.visible&&J.push(Ie,Mt,Vt,$e,nt.z,null)}}const pt=Ie.children;for(let Mt=0,Vt=pt.length;Mt<Vt;Mt++)vn(pt[Mt],Ve,$e,Pe)}function Nn(Ie,Ve,$e,Pe){const Le=Ie.opaque,pt=Ie.transmissive,Mt=Ie.transparent;T.setupLightsView($e),Xe===!0&&De.setGlobalState(K.clippingPlanes,$e),Pe&&rt.viewport(re.copy(Pe)),Le.length>0&&Yi(Le,Ve,$e),pt.length>0&&Yi(pt,Ve,$e),Mt.length>0&&Yi(Mt,Ve,$e),rt.buffers.depth.setTest(!0),rt.buffers.depth.setMask(!0),rt.buffers.color.setMask(!0),rt.setPolygonOffset(!1)}function ns(Ie,Ve,$e,Pe){if(($e.isScene===!0?$e.overrideMaterial:null)!==null)return;T.state.transmissionRenderTarget[Pe.id]===void 0&&(T.state.transmissionRenderTarget[Pe.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:st.has("EXT_color_buffer_half_float")||st.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:d,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const pt=T.state.transmissionRenderTarget[Pe.id],Mt=Pe.viewport||re;pt.setSize(Mt.z*K.transmissionResolutionScale,Mt.w*K.transmissionResolutionScale);const Vt=K.getRenderTarget();K.setRenderTarget(pt),K.getClearColor(ye),Se=K.getClearAlpha(),Se<1&&K.setClearColor(16777215,.5),K.clear(),Qe&&ft.render($e);const Nt=K.toneMapping;K.toneMapping=NoToneMapping;const Dt=Pe.viewport;if(Pe.viewport!==void 0&&(Pe.viewport=void 0),T.setupLightsView(Pe),Xe===!0&&De.setGlobalState(K.clippingPlanes,Pe),Yi(Ie,$e,Pe),Ge.updateMultisampleRenderTarget(pt),Ge.updateRenderTargetMipmap(pt),st.has("WEBGL_multisampled_render_to_texture")===!1){let Ot=!1;for(let zt=0,di=Ve.length;zt<di;zt++){const Ci=Ve[zt],Ji=Ci.object,Ai=Ci.geometry,jt=Ci.material,Ft=Ci.group;if(jt.side===DoubleSide&&Ji.layers.test(Pe.layers)){const cn=jt.side;jt.side=BackSide,jt.needsUpdate=!0,Ti(Ji,$e,Pe,Ai,jt,Ft),jt.side=cn,jt.needsUpdate=!0,Ot=!0}}Ot===!0&&(Ge.updateMultisampleRenderTarget(pt),Ge.updateRenderTargetMipmap(pt))}K.setRenderTarget(Vt),K.setClearColor(ye,Se),Dt!==void 0&&(Pe.viewport=Dt),K.toneMapping=Nt}function Yi(Ie,Ve,$e){const Pe=Ve.isScene===!0?Ve.overrideMaterial:null;for(let Le=0,pt=Ie.length;Le<pt;Le++){const Mt=Ie[Le],Vt=Mt.object,Nt=Mt.geometry,Dt=Pe===null?Mt.material:Pe,Ot=Mt.group;Vt.layers.test($e.layers)&&Ti(Vt,Ve,$e,Nt,Dt,Ot)}}function Ti(Ie,Ve,$e,Pe,Le,pt){Ie.onBeforeRender(K,Ve,$e,Pe,Le,pt),Ie.modelViewMatrix.multiplyMatrices($e.matrixWorldInverse,Ie.matrixWorld),Ie.normalMatrix.getNormalMatrix(Ie.modelViewMatrix),Le.onBeforeRender(K,Ve,$e,Pe,Ie,pt),Le.transparent===!0&&Le.side===DoubleSide&&Le.forceSinglePass===!1?(Le.side=BackSide,Le.needsUpdate=!0,K.renderBufferDirect($e,Ve,Pe,Le,Ie,pt),Le.side=FrontSide,Le.needsUpdate=!0,K.renderBufferDirect($e,Ve,Pe,Le,Ie,pt),Le.side=DoubleSide):K.renderBufferDirect($e,Ve,Pe,Le,Ie,pt),Ie.onAfterRender(K,Ve,$e,Pe,Le,pt)}function Qt(Ie,Ve,$e){Ve.isScene!==!0&&(Ve=Rt);const Pe=Xt.get(Ie),Le=T.state.lights,pt=T.state.shadowsArray,Mt=Le.state.version,Vt=ot.getParameters(Ie,Le.state,pt,Ve,$e),Nt=ot.getProgramCacheKey(Vt);let Dt=Pe.programs;Pe.environment=Ie.isMeshStandardMaterial?Ve.environment:null,Pe.fog=Ve.fog,Pe.envMap=(Ie.isMeshStandardMaterial?ke:he).get(Ie.envMap||Pe.environment),Pe.envMapRotation=Pe.environment!==null&&Ie.envMap===null?Ve.environmentRotation:Ie.envMapRotation,Dt===void 0&&(Ie.addEventListener("dispose",Tt),Dt=new Map,Pe.programs=Dt);let Ot=Dt.get(Nt);if(Ot!==void 0){if(Pe.currentProgram===Ot&&Pe.lightsStateVersion===Mt)return Oo(Ie,Vt),Ot}else Vt.uniforms=ot.getUniforms(Ie),Ie.onBeforeCompile(Vt,K),Ot=ot.acquireProgram(Vt,Nt),Dt.set(Nt,Ot),Pe.uniforms=Vt.uniforms;const zt=Pe.uniforms;return(!Ie.isShaderMaterial&&!Ie.isRawShaderMaterial||Ie.clipping===!0)&&(zt.clippingPlanes=De.uniform),Oo(Ie,Vt),Pe.needsLights=Wl(Ie),Pe.lightsStateVersion=Mt,Pe.needsLights&&(zt.ambientLightColor.value=Le.state.ambient,zt.lightProbe.value=Le.state.probe,zt.directionalLights.value=Le.state.directional,zt.directionalLightShadows.value=Le.state.directionalShadow,zt.spotLights.value=Le.state.spot,zt.spotLightShadows.value=Le.state.spotShadow,zt.rectAreaLights.value=Le.state.rectArea,zt.ltc_1.value=Le.state.rectAreaLTC1,zt.ltc_2.value=Le.state.rectAreaLTC2,zt.pointLights.value=Le.state.point,zt.pointLightShadows.value=Le.state.pointShadow,zt.hemisphereLights.value=Le.state.hemi,zt.directionalShadowMap.value=Le.state.directionalShadowMap,zt.directionalShadowMatrix.value=Le.state.directionalShadowMatrix,zt.spotShadowMap.value=Le.state.spotShadowMap,zt.spotLightMatrix.value=Le.state.spotLightMatrix,zt.spotLightMap.value=Le.state.spotLightMap,zt.pointShadowMap.value=Le.state.pointShadowMap,zt.pointShadowMatrix.value=Le.state.pointShadowMatrix),Pe.currentProgram=Ot,Pe.uniformsList=null,Ot}function Ts(Ie){if(Ie.uniformsList===null){const Ve=Ie.currentProgram.getUniforms();Ie.uniformsList=WebGLUniforms.seqWithValue(Ve.seq,Ie.uniforms)}return Ie.uniformsList}function Oo(Ie,Ve){const $e=Xt.get(Ie);$e.outputColorSpace=Ve.outputColorSpace,$e.batching=Ve.batching,$e.batchingColor=Ve.batchingColor,$e.instancing=Ve.instancing,$e.instancingColor=Ve.instancingColor,$e.instancingMorph=Ve.instancingMorph,$e.skinning=Ve.skinning,$e.morphTargets=Ve.morphTargets,$e.morphNormals=Ve.morphNormals,$e.morphColors=Ve.morphColors,$e.morphTargetsCount=Ve.morphTargetsCount,$e.numClippingPlanes=Ve.numClippingPlanes,$e.numIntersection=Ve.numClipIntersection,$e.vertexAlphas=Ve.vertexAlphas,$e.vertexTangents=Ve.vertexTangents,$e.toneMapping=Ve.toneMapping}function Nl(Ie,Ve,$e,Pe,Le){Ve.isScene!==!0&&(Ve=Rt),Ge.resetTextureUnits();const pt=Ve.fog,Mt=Pe.isMeshStandardMaterial?Ve.environment:null,Vt=ne===null?K.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:LinearSRGBColorSpace,Nt=(Pe.isMeshStandardMaterial?ke:he).get(Pe.envMap||Mt),Dt=Pe.vertexColors===!0&&!!$e.attributes.color&&$e.attributes.color.itemSize===4,Ot=!!$e.attributes.tangent&&(!!Pe.normalMap||Pe.anisotropy>0),zt=!!$e.morphAttributes.position,di=!!$e.morphAttributes.normal,Ci=!!$e.morphAttributes.color;let Ji=NoToneMapping;Pe.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(Ji=K.toneMapping);const Ai=$e.morphAttributes.position||$e.morphAttributes.normal||$e.morphAttributes.color,jt=Ai!==void 0?Ai.length:0,Ft=Xt.get(Pe),cn=T.state.lights;if(Xe===!0&&(Te===!0||Ie!==se)){const Qi=Ie===se&&Pe.id===ee;De.setState(Pe,Ie,Qi)}let Ii=!1;Pe.version===Ft.__version?(Ft.needsLights&&Ft.lightsStateVersion!==cn.state.version||Ft.outputColorSpace!==Vt||Le.isBatchedMesh&&Ft.batching===!1||!Le.isBatchedMesh&&Ft.batching===!0||Le.isBatchedMesh&&Ft.batchingColor===!0&&Le.colorTexture===null||Le.isBatchedMesh&&Ft.batchingColor===!1&&Le.colorTexture!==null||Le.isInstancedMesh&&Ft.instancing===!1||!Le.isInstancedMesh&&Ft.instancing===!0||Le.isSkinnedMesh&&Ft.skinning===!1||!Le.isSkinnedMesh&&Ft.skinning===!0||Le.isInstancedMesh&&Ft.instancingColor===!0&&Le.instanceColor===null||Le.isInstancedMesh&&Ft.instancingColor===!1&&Le.instanceColor!==null||Le.isInstancedMesh&&Ft.instancingMorph===!0&&Le.morphTexture===null||Le.isInstancedMesh&&Ft.instancingMorph===!1&&Le.morphTexture!==null||Ft.envMap!==Nt||Pe.fog===!0&&Ft.fog!==pt||Ft.numClippingPlanes!==void 0&&(Ft.numClippingPlanes!==De.numPlanes||Ft.numIntersection!==De.numIntersection)||Ft.vertexAlphas!==Dt||Ft.vertexTangents!==Ot||Ft.morphTargets!==zt||Ft.morphNormals!==di||Ft.morphColors!==Ci||Ft.toneMapping!==Ji||Ft.morphTargetsCount!==jt)&&(Ii=!0):(Ii=!0,Ft.__version=Pe.version);let kn=Ft.currentProgram;Ii===!0&&(kn=Qt(Pe,Ve,Le));let Cs=!1,Vn=!1,mn=!1;const xi=kn.getUniforms(),Wn=Ft.uniforms;if(rt.useProgram(kn.program)&&(Cs=!0,Vn=!0,mn=!0),Pe.id!==ee&&(ee=Pe.id,Vn=!0),Cs||se!==Ie){rt.buffers.depth.getReversed()?(Ne.copy(Ie.projectionMatrix),toNormalizedProjectionMatrix(Ne),toReversedProjectionMatrix(Ne),xi.setValue(be,"projectionMatrix",Ne)):xi.setValue(be,"projectionMatrix",Ie.projectionMatrix),xi.setValue(be,"viewMatrix",Ie.matrixWorldInverse);const Bn=xi.map.cameraPosition;Bn!==void 0&&Bn.setValue(be,dt.setFromMatrixPosition(Ie.matrixWorld)),Gt.logarithmicDepthBuffer&&xi.setValue(be,"logDepthBufFC",2/(Math.log(Ie.far+1)/Math.LN2)),(Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshLambertMaterial||Pe.isMeshBasicMaterial||Pe.isMeshStandardMaterial||Pe.isShaderMaterial)&&xi.setValue(be,"isOrthographic",Ie.isOrthographicCamera===!0),se!==Ie&&(se=Ie,Vn=!0,mn=!0)}if(Le.isSkinnedMesh){xi.setOptional(be,Le,"bindMatrix"),xi.setOptional(be,Le,"bindMatrixInverse");const Qi=Le.skeleton;Qi&&(Qi.boneTexture===null&&Qi.computeBoneTexture(),xi.setValue(be,"boneTexture",Qi.boneTexture,Ge))}Le.isBatchedMesh&&(xi.setOptional(be,Le,"batchingTexture"),xi.setValue(be,"batchingTexture",Le._matricesTexture,Ge),xi.setOptional(be,Le,"batchingIdTexture"),xi.setValue(be,"batchingIdTexture",Le._indirectTexture,Ge),xi.setOptional(be,Le,"batchingColorTexture"),Le._colorsTexture!==null&&xi.setValue(be,"batchingColorTexture",Le._colorsTexture,Ge));const xn=$e.morphAttributes;if((xn.position!==void 0||xn.normal!==void 0||xn.color!==void 0)&&At.update(Le,$e,kn),(Vn||Ft.receiveShadow!==Le.receiveShadow)&&(Ft.receiveShadow=Le.receiveShadow,xi.setValue(be,"receiveShadow",Le.receiveShadow)),Pe.isMeshGouraudMaterial&&Pe.envMap!==null&&(Wn.envMap.value=Nt,Wn.flipEnvMap.value=Nt.isCubeTexture&&Nt.isRenderTargetTexture===!1?-1:1),Pe.isMeshStandardMaterial&&Pe.envMap===null&&Ve.environment!==null&&(Wn.envMapIntensity.value=Ve.environmentIntensity),Vn&&(xi.setValue(be,"toneMappingExposure",K.toneMappingExposure),Ft.needsLights&&Vl(Wn,mn),pt&&Pe.fog===!0&&Zt.refreshFogUniforms(Wn,pt),Zt.refreshMaterialUniforms(Wn,Pe,Be,Ze,T.state.transmissionRenderTarget[Ie.id]),WebGLUniforms.upload(be,Ts(Ft),Wn,Ge)),Pe.isShaderMaterial&&Pe.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(be,Ts(Ft),Wn,Ge),Pe.uniformsNeedUpdate=!1),Pe.isSpriteMaterial&&xi.setValue(be,"center",Le.center),xi.setValue(be,"modelViewMatrix",Le.modelViewMatrix),xi.setValue(be,"normalMatrix",Le.normalMatrix),xi.setValue(be,"modelMatrix",Le.matrixWorld),Pe.isShaderMaterial||Pe.isRawShaderMaterial){const Qi=Pe.uniformsGroups;for(let Bn=0,Hs=Qi.length;Bn<Hs;Bn++){const Pn=Qi[Bn];Me.update(Pn,kn),Me.bind(Pn,kn)}}return kn}function Vl(Ie,Ve){Ie.ambientLightColor.needsUpdate=Ve,Ie.lightProbe.needsUpdate=Ve,Ie.directionalLights.needsUpdate=Ve,Ie.directionalLightShadows.needsUpdate=Ve,Ie.pointLights.needsUpdate=Ve,Ie.pointLightShadows.needsUpdate=Ve,Ie.spotLights.needsUpdate=Ve,Ie.spotLightShadows.needsUpdate=Ve,Ie.rectAreaLights.needsUpdate=Ve,Ie.hemisphereLights.needsUpdate=Ve}function Wl(Ie){return Ie.isMeshLambertMaterial||Ie.isMeshToonMaterial||Ie.isMeshPhongMaterial||Ie.isMeshStandardMaterial||Ie.isShadowMaterial||Ie.isShaderMaterial&&Ie.lights===!0}this.getActiveCubeFace=function(){return $},this.getActiveMipmapLevel=function(){return ie},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(Ie,Ve,$e){Xt.get(Ie.texture).__webglTexture=Ve,Xt.get(Ie.depthTexture).__webglTexture=$e;const Pe=Xt.get(Ie);Pe.__hasExternalTextures=!0,Pe.__autoAllocateDepthBuffer=$e===void 0,Pe.__autoAllocateDepthBuffer||st.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Pe.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ie,Ve){const $e=Xt.get(Ie);$e.__webglFramebuffer=Ve,$e.__useDefaultFramebuffer=Ve===void 0};const Io=be.createFramebuffer();this.setRenderTarget=function(Ie,Ve=0,$e=0){ne=Ie,$=Ve,ie=$e;let Pe=!0,Le=null,pt=!1,Mt=!1;if(Ie){const Nt=Xt.get(Ie);if(Nt.__useDefaultFramebuffer!==void 0)rt.bindFramebuffer(be.FRAMEBUFFER,null),Pe=!1;else if(Nt.__webglFramebuffer===void 0)Ge.setupRenderTarget(Ie);else if(Nt.__hasExternalTextures)Ge.rebindTextures(Ie,Xt.get(Ie.texture).__webglTexture,Xt.get(Ie.depthTexture).__webglTexture);else if(Ie.depthBuffer){const zt=Ie.depthTexture;if(Nt.__boundDepthTexture!==zt){if(zt!==null&&Xt.has(zt)&&(Ie.width!==zt.image.width||Ie.height!==zt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ge.setupDepthRenderbuffer(Ie)}}const Dt=Ie.texture;(Dt.isData3DTexture||Dt.isDataArrayTexture||Dt.isCompressedArrayTexture)&&(Mt=!0);const Ot=Xt.get(Ie).__webglFramebuffer;Ie.isWebGLCubeRenderTarget?(Array.isArray(Ot[Ve])?Le=Ot[Ve][$e]:Le=Ot[Ve],pt=!0):Ie.samples>0&&Ge.useMultisampledRTT(Ie)===!1?Le=Xt.get(Ie).__webglMultisampledFramebuffer:Array.isArray(Ot)?Le=Ot[$e]:Le=Ot,re.copy(Ie.viewport),ce.copy(Ie.scissor),ue=Ie.scissorTest}else re.copy(de).multiplyScalar(Be).floor(),ce.copy(ve).multiplyScalar(Be).floor(),ue=le;if($e!==0&&(Le=Io),rt.bindFramebuffer(be.FRAMEBUFFER,Le)&&Pe&&rt.drawBuffers(Ie,Le),rt.viewport(re),rt.scissor(ce),rt.setScissorTest(ue),pt){const Nt=Xt.get(Ie.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,Nt.__webglTexture,$e)}else if(Mt){const Nt=Xt.get(Ie.texture),Dt=Ve;be.framebufferTextureLayer(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,Nt.__webglTexture,$e,Dt)}else if(Ie!==null&&$e!==0){const Nt=Xt.get(Ie.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,Nt.__webglTexture,$e)}ee=-1},this.readRenderTargetPixels=function(Ie,Ve,$e,Pe,Le,pt,Mt){if(!(Ie&&Ie.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Vt=Xt.get(Ie).__webglFramebuffer;if(Ie.isWebGLCubeRenderTarget&&Mt!==void 0&&(Vt=Vt[Mt]),Vt){rt.bindFramebuffer(be.FRAMEBUFFER,Vt);try{const Nt=Ie.texture,Dt=Nt.format,Ot=Nt.type;if(!Gt.textureFormatReadable(Dt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Gt.textureTypeReadable(Ot)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ve>=0&&Ve<=Ie.width-Pe&&$e>=0&&$e<=Ie.height-Le&&be.readPixels(Ve,$e,Pe,Le,Ee.convert(Dt),Ee.convert(Ot),pt)}finally{const Nt=ne!==null?Xt.get(ne).__webglFramebuffer:null;rt.bindFramebuffer(be.FRAMEBUFFER,Nt)}}},this.readRenderTargetPixelsAsync=async function(Ie,Ve,$e,Pe,Le,pt,Mt){if(!(Ie&&Ie.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Vt=Xt.get(Ie).__webglFramebuffer;if(Ie.isWebGLCubeRenderTarget&&Mt!==void 0&&(Vt=Vt[Mt]),Vt){const Nt=Ie.texture,Dt=Nt.format,Ot=Nt.type;if(!Gt.textureFormatReadable(Dt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Gt.textureTypeReadable(Ot))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ve>=0&&Ve<=Ie.width-Pe&&$e>=0&&$e<=Ie.height-Le){rt.bindFramebuffer(be.FRAMEBUFFER,Vt);const zt=be.createBuffer();be.bindBuffer(be.PIXEL_PACK_BUFFER,zt),be.bufferData(be.PIXEL_PACK_BUFFER,pt.byteLength,be.STREAM_READ),be.readPixels(Ve,$e,Pe,Le,Ee.convert(Dt),Ee.convert(Ot),0);const di=ne!==null?Xt.get(ne).__webglFramebuffer:null;rt.bindFramebuffer(be.FRAMEBUFFER,di);const Ci=be.fenceSync(be.SYNC_GPU_COMMANDS_COMPLETE,0);return be.flush(),await probeAsync(be,Ci,4),be.bindBuffer(be.PIXEL_PACK_BUFFER,zt),be.getBufferSubData(be.PIXEL_PACK_BUFFER,0,pt),be.deleteBuffer(zt),be.deleteSync(Ci),pt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Ie,Ve=null,$e=0){Ie.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ve=arguments[0]||null,Ie=arguments[1]);const Pe=Math.pow(2,-$e),Le=Math.floor(Ie.image.width*Pe),pt=Math.floor(Ie.image.height*Pe),Mt=Ve!==null?Ve.x:0,Vt=Ve!==null?Ve.y:0;Ge.setTexture2D(Ie,0),be.copyTexSubImage2D(be.TEXTURE_2D,$e,0,0,Mt,Vt,Le,pt),rt.unbindTexture()};const wr=be.createFramebuffer(),Js=be.createFramebuffer();this.copyTextureToTexture=function(Ie,Ve,$e=null,Pe=null,Le=0,pt=null){Ie.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),Pe=arguments[0]||null,Ie=arguments[1],Ve=arguments[2],pt=arguments[3]||0,$e=null),pt===null&&(Le!==0?(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),pt=Le,Le=0):pt=0);let Mt,Vt,Nt,Dt,Ot,zt,di,Ci,Ji;const Ai=Ie.isCompressedTexture?Ie.mipmaps[pt]:Ie.image;if($e!==null)Mt=$e.max.x-$e.min.x,Vt=$e.max.y-$e.min.y,Nt=$e.isBox3?$e.max.z-$e.min.z:1,Dt=$e.min.x,Ot=$e.min.y,zt=$e.isBox3?$e.min.z:0;else{const xn=Math.pow(2,-Le);Mt=Math.floor(Ai.width*xn),Vt=Math.floor(Ai.height*xn),Ie.isDataArrayTexture?Nt=Ai.depth:Ie.isData3DTexture?Nt=Math.floor(Ai.depth*xn):Nt=1,Dt=0,Ot=0,zt=0}Pe!==null?(di=Pe.x,Ci=Pe.y,Ji=Pe.z):(di=0,Ci=0,Ji=0);const jt=Ee.convert(Ve.format),Ft=Ee.convert(Ve.type);let cn;Ve.isData3DTexture?(Ge.setTexture3D(Ve,0),cn=be.TEXTURE_3D):Ve.isDataArrayTexture||Ve.isCompressedArrayTexture?(Ge.setTexture2DArray(Ve,0),cn=be.TEXTURE_2D_ARRAY):(Ge.setTexture2D(Ve,0),cn=be.TEXTURE_2D),be.pixelStorei(be.UNPACK_FLIP_Y_WEBGL,Ve.flipY),be.pixelStorei(be.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ve.premultiplyAlpha),be.pixelStorei(be.UNPACK_ALIGNMENT,Ve.unpackAlignment);const Ii=be.getParameter(be.UNPACK_ROW_LENGTH),kn=be.getParameter(be.UNPACK_IMAGE_HEIGHT),Cs=be.getParameter(be.UNPACK_SKIP_PIXELS),Vn=be.getParameter(be.UNPACK_SKIP_ROWS),mn=be.getParameter(be.UNPACK_SKIP_IMAGES);be.pixelStorei(be.UNPACK_ROW_LENGTH,Ai.width),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,Ai.height),be.pixelStorei(be.UNPACK_SKIP_PIXELS,Dt),be.pixelStorei(be.UNPACK_SKIP_ROWS,Ot),be.pixelStorei(be.UNPACK_SKIP_IMAGES,zt);const xi=Ie.isDataArrayTexture||Ie.isData3DTexture,Wn=Ve.isDataArrayTexture||Ve.isData3DTexture;if(Ie.isDepthTexture){const xn=Xt.get(Ie),Qi=Xt.get(Ve),Bn=Xt.get(xn.__renderTarget),Hs=Xt.get(Qi.__renderTarget);rt.bindFramebuffer(be.READ_FRAMEBUFFER,Bn.__webglFramebuffer),rt.bindFramebuffer(be.DRAW_FRAMEBUFFER,Hs.__webglFramebuffer);for(let Pn=0;Pn<Nt;Pn++)xi&&(be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,Xt.get(Ie).__webglTexture,Le,zt+Pn),be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,Xt.get(Ve).__webglTexture,pt,Ji+Pn)),be.blitFramebuffer(Dt,Ot,Mt,Vt,di,Ci,Mt,Vt,be.DEPTH_BUFFER_BIT,be.NEAREST);rt.bindFramebuffer(be.READ_FRAMEBUFFER,null),rt.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else if(Le!==0||Ie.isRenderTargetTexture||Xt.has(Ie)){const xn=Xt.get(Ie),Qi=Xt.get(Ve);rt.bindFramebuffer(be.READ_FRAMEBUFFER,wr),rt.bindFramebuffer(be.DRAW_FRAMEBUFFER,Js);for(let Bn=0;Bn<Nt;Bn++)xi?be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,xn.__webglTexture,Le,zt+Bn):be.framebufferTexture2D(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,xn.__webglTexture,Le),Wn?be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,Qi.__webglTexture,pt,Ji+Bn):be.framebufferTexture2D(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,Qi.__webglTexture,pt),Le!==0?be.blitFramebuffer(Dt,Ot,Mt,Vt,di,Ci,Mt,Vt,be.COLOR_BUFFER_BIT,be.NEAREST):Wn?be.copyTexSubImage3D(cn,pt,di,Ci,Ji+Bn,Dt,Ot,Mt,Vt):be.copyTexSubImage2D(cn,pt,di,Ci,Dt,Ot,Mt,Vt);rt.bindFramebuffer(be.READ_FRAMEBUFFER,null),rt.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else Wn?Ie.isDataTexture||Ie.isData3DTexture?be.texSubImage3D(cn,pt,di,Ci,Ji,Mt,Vt,Nt,jt,Ft,Ai.data):Ve.isCompressedArrayTexture?be.compressedTexSubImage3D(cn,pt,di,Ci,Ji,Mt,Vt,Nt,jt,Ai.data):be.texSubImage3D(cn,pt,di,Ci,Ji,Mt,Vt,Nt,jt,Ft,Ai):Ie.isDataTexture?be.texSubImage2D(be.TEXTURE_2D,pt,di,Ci,Mt,Vt,jt,Ft,Ai.data):Ie.isCompressedTexture?be.compressedTexSubImage2D(be.TEXTURE_2D,pt,di,Ci,Ai.width,Ai.height,jt,Ai.data):be.texSubImage2D(be.TEXTURE_2D,pt,di,Ci,Mt,Vt,jt,Ft,Ai);be.pixelStorei(be.UNPACK_ROW_LENGTH,Ii),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,kn),be.pixelStorei(be.UNPACK_SKIP_PIXELS,Cs),be.pixelStorei(be.UNPACK_SKIP_ROWS,Vn),be.pixelStorei(be.UNPACK_SKIP_IMAGES,mn),pt===0&&Ve.generateMipmaps&&be.generateMipmap(cn),rt.unbindTexture()},this.copyTextureToTexture3D=function(Ie,Ve,$e=null,Pe=null,Le=0){return Ie.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),$e=arguments[0]||null,Pe=arguments[1]||null,Ie=arguments[2],Ve=arguments[3],Le=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Ie,Ve,$e,Pe,Le)},this.initRenderTarget=function(Ie){Xt.get(Ie).__webglFramebuffer===void 0&&Ge.setupRenderTarget(Ie)},this.initTexture=function(Ie){Ie.isCubeTexture?Ge.setTextureCube(Ie,0):Ie.isData3DTexture?Ge.setTexture3D(Ie,0):Ie.isDataArrayTexture||Ie.isCompressedArrayTexture?Ge.setTexture2DArray(Ie,0):Ge.setTexture2D(Ie,0),rt.unbindTexture()},this.resetState=function(){$=0,ie=0,ne=null,rt.reset(),_e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const o=this.getContext();o.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(t),o.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}const THREE=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AgXToneMapping,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,AttachedBindMode,Audio,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,BatchedMesh,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,ConstantAlphaFactor,ConstantColorFactor,Controls,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DetachedBindMode,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher:EventDispatcher$1,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace,LinearToneMapping,LinearTransfer,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix2,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeutralToneMapping,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusConstantAlphaFactor,OneMinusConstantColorFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane:Plane$1,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion:Quaternion$2,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGBDepthPacking,RGBFormat,RGBIntegerFormat,RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGDepthPacking,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray:Ray$2,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RenderTarget,RenderTarget3D,RenderTargetArray,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace,SRGBTransfer,Scene,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape:Shape$2,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TextureUtils,TimestampQuery,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedInt5999Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoFrameTexture,VideoTexture,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WebXRController,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,createCanvasElement},Symbol.toStringTag,{value:"Module"}));var constants$1={exports:{}},reactReconcilerConstants_production={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconcilerConstants_production;function requireReactReconcilerConstants_production(){return hasRequiredReactReconcilerConstants_production||(hasRequiredReactReconcilerConstants_production=1,reactReconcilerConstants_production.ConcurrentRoot=1,reactReconcilerConstants_production.ContinuousEventPriority=8,reactReconcilerConstants_production.DefaultEventPriority=32,reactReconcilerConstants_production.DiscreteEventPriority=2,reactReconcilerConstants_production.IdleEventPriority=268435456,reactReconcilerConstants_production.LegacyRoot=0,reactReconcilerConstants_production.NoEventPriority=0),reactReconcilerConstants_production}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants$1.exports=requireReactReconcilerConstants_production()),constants$1.exports}var constantsExports=requireConstants(),withSelector={exports:{}},withSelector_production={},shim={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production;function requireUseSyncExternalStoreShim_production(){if(hasRequiredUseSyncExternalStoreShim_production)return useSyncExternalStoreShim_production;hasRequiredUseSyncExternalStoreShim_production=1;var n=requireReact();function t(B,Z){return B===Z&&(B!==0||1/B===1/Z)||B!==B&&Z!==Z}var o=typeof Object.is=="function"?Object.is:t,r=n.useState,u=n.useEffect,d=n.useLayoutEffect,C=n.useDebugValue;function I(B,Z){var w=Z(),V=r({inst:{value:w,getSnapshot:Z}}),Y=V[0].inst,J=V[1];return d(function(){Y.value=w,Y.getSnapshot=Z,f(Y)&&J({inst:Y})},[B,w,Z]),u(function(){return f(Y)&&J({inst:Y}),B(function(){f(Y)&&J({inst:Y})})},[B]),C(w),w}function f(B){var Z=B.getSnapshot;B=B.value;try{var w=Z();return!o(B,w)}catch{return!0}}function A(B,Z){return Z()}var G=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?A:I;return useSyncExternalStoreShim_production.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:G,useSyncExternalStoreShim_production}var hasRequiredShim;function requireShim(){return hasRequiredShim||(hasRequiredShim=1,shim.exports=requireUseSyncExternalStoreShim_production()),shim.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredWithSelector_production;function requireWithSelector_production(){if(hasRequiredWithSelector_production)return withSelector_production;hasRequiredWithSelector_production=1;var n=requireReact(),t=requireShim();function o(A,G){return A===G&&(A!==0||1/A===1/G)||A!==A&&G!==G}var r=typeof Object.is=="function"?Object.is:o,u=t.useSyncExternalStore,d=n.useRef,C=n.useEffect,I=n.useMemo,f=n.useDebugValue;return withSelector_production.useSyncExternalStoreWithSelector=function(A,G,B,Z,w){var V=d(null);if(V.current===null){var Y={hasValue:!1,value:null};V.current=Y}else Y=V.current;V=I(function(){function T($){if(!L){if(L=!0,z=$,$=Z($),w!==void 0&&Y.hasValue){var ie=Y.value;if(w(ie,$))return K=ie}return K=$}if(ie=K,r(z,$))return ie;var ne=Z($);return w!==void 0&&w(ie,ne)?(z=$,ie):(z=$,K=ne)}var L=!1,z,K,P=B===void 0?null:B;return[function(){return T(G())},P===null?void 0:function(){return T(P())}]},[G,B,Z,w]);var J=u(A,V[0],V[1]);return C(function(){Y.hasValue=!0,Y.value=J},[J]),f(J),J},withSelector_production}var hasRequiredWithSelector;function requireWithSelector(){return hasRequiredWithSelector||(hasRequiredWithSelector=1,withSelector.exports=requireWithSelector_production()),withSelector.exports}var withSelectorExports=requireWithSelector();const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),createStoreImpl=n=>{let t;const o=new Set,r=(A,G)=>{const B=typeof A=="function"?A(t):A;if(!Object.is(B,t)){const Z=t;t=G??(typeof B!="object"||B===null)?B:Object.assign({},t,B),o.forEach(w=>w(t,Z))}},u=()=>t,I={setState:r,getState:u,getInitialState:()=>f,subscribe:A=>(o.add(A),()=>o.delete(A))},f=t=n(r,u,I);return I},createStore$1=n=>n?createStoreImpl(n):createStoreImpl,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports,identity=n=>n;function useStoreWithEqualityFn(n,t=identity,o){const r=useSyncExternalStoreWithSelector(n.subscribe,n.getState,n.getInitialState,t,o);return React.useDebugValue(r),r}const createWithEqualityFnImpl=(n,t)=>{const o=createStore$1(n),r=(u,d=t)=>useStoreWithEqualityFn(o,u,d);return Object.assign(r,o),r},createWithEqualityFn=(n,t)=>n?createWithEqualityFnImpl(n,t):createWithEqualityFnImpl;var reactReconciler={exports:{}},reactReconciler_production={exports:{}};/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconciler_production;function requireReactReconciler_production(){return hasRequiredReactReconciler_production||(hasRequiredReactReconciler_production=1,function(n){n.exports=function(t){function o(_,M,F,U){return new uu(_,M,F,U)}function r(){}function u(_){var M="https://react.dev/errors/"+_;if(1<arguments.length){M+="?args[]="+encodeURIComponent(arguments[1]);for(var F=2;F<arguments.length;F++)M+="&args[]="+encodeURIComponent(arguments[F])}return"Minified React error #"+_+"; visit "+M+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(_){return _===null||typeof _!="object"?null:(_=Ri&&_[Ri]||_["@@iterator"],typeof _=="function"?_:null)}function C(_){if(_==null)return null;if(typeof _=="function")return _.$$typeof===hn?null:_.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case gr:return"Fragment";case no:return"Portal";case ur:return"Profiler";case Fr:return"StrictMode";case wo:return"Suspense";case ml:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case hr:return(_.displayName||"Context")+".Provider";case ig:return(_._context.displayName||"Context")+".Consumer";case nc:var M=_.render;return _=_.displayName,_||(_=M.displayName||M.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case Ga:return M=_.displayName||null,M!==null?M:C(_.type)||"Memo";case Mo:M=_._payload,_=_._init;try{return C(_(M))}catch{}}return null}function I(_){if(dr===void 0)try{throw Error()}catch(F){var M=F.stack.trim().match(/\n( *(at )?)/);dr=M&&M[1]||"",Cr=-1<F.stack.indexOf(`
    at`)?" (<anonymous>)":-1<F.stack.indexOf("@")?"@unknown:0:0":""}return`
`+dr+_+Cr}function f(_,M){if(!_||va)return"";va=!0;var F=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var U={DetermineComponentFrameRoot:function(){try{if(M){var Wt=function(){throw Error()};if(Object.defineProperty(Wt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Wt,[])}catch(ti){var St=ti}Reflect.construct(_,[],Wt)}else{try{Wt.call()}catch(ti){St=ti}_.call(Wt.prototype)}}else{try{throw Error()}catch(ti){St=ti}(Wt=_())&&typeof Wt.catch=="function"&&Wt.catch(function(){})}}catch(ti){if(ti&&St&&typeof ti.stack=="string")return[ti.stack,St.stack]}return[null,null]}};U.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var te=Object.getOwnPropertyDescriptor(U.DetermineComponentFrameRoot,"name");te&&te.configurable&&Object.defineProperty(U.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var oe=U.DetermineComponentFrameRoot(),pe=oe[0],we=oe[1];if(pe&&we){var Ke=pe.split(`
`),gt=we.split(`
`);for(te=U=0;U<Ke.length&&!Ke[U].includes("DetermineComponentFrameRoot");)U++;for(;te<gt.length&&!gt[te].includes("DetermineComponentFrameRoot");)te++;if(U===Ke.length||te===gt.length)for(U=Ke.length-1,te=gt.length-1;1<=U&&0<=te&&Ke[U]!==gt[te];)te--;for(;1<=U&&0<=te;U--,te--)if(Ke[U]!==gt[te]){if(U!==1||te!==1)do if(U--,te--,0>te||Ke[U]!==gt[te]){var xt=`
`+Ke[U].replace(" at new "," at ");return _.displayName&&xt.includes("<anonymous>")&&(xt=xt.replace("<anonymous>",_.displayName)),xt}while(1<=U&&0<=te);break}}}finally{va=!1,Error.prepareStackTrace=F}return(F=_?_.displayName||_.name:"")?I(F):""}function A(_){switch(_.tag){case 26:case 27:case 5:return I(_.type);case 16:return I("Lazy");case 13:return I("Suspense");case 19:return I("SuspenseList");case 0:case 15:return _=f(_.type,!1),_;case 11:return _=f(_.type.render,!1),_;case 1:return _=f(_.type,!0),_;default:return""}}function G(_){try{var M="";do M+=A(_),_=_.return;while(_);return M}catch(F){return`
Error generating stack: `+F.message+`
`+F.stack}}function B(_){var M=_,F=_;if(_.alternate)for(;M.return;)M=M.return;else{_=M;do M=_,(M.flags&4098)!==0&&(F=M.return),_=M.return;while(_)}return M.tag===3?F:null}function Z(_){if(B(_)!==_)throw Error(u(188))}function w(_){var M=_.alternate;if(!M){if(M=B(_),M===null)throw Error(u(188));return M!==_?null:_}for(var F=_,U=M;;){var te=F.return;if(te===null)break;var oe=te.alternate;if(oe===null){if(U=te.return,U!==null){F=U;continue}break}if(te.child===oe.child){for(oe=te.child;oe;){if(oe===F)return Z(te),_;if(oe===U)return Z(te),M;oe=oe.sibling}throw Error(u(188))}if(F.return!==U.return)F=te,U=oe;else{for(var pe=!1,we=te.child;we;){if(we===F){pe=!0,F=te,U=oe;break}if(we===U){pe=!0,U=te,F=oe;break}we=we.sibling}if(!pe){for(we=oe.child;we;){if(we===F){pe=!0,F=oe,U=te;break}if(we===U){pe=!0,U=oe,F=te;break}we=we.sibling}if(!pe)throw Error(u(189))}}if(F.alternate!==U)throw Error(u(190))}if(F.tag!==3)throw Error(u(188));return F.stateNode.current===F?_:M}function V(_){var M=_.tag;if(M===5||M===26||M===27||M===6)return _;for(_=_.child;_!==null;){if(M=V(_),M!==null)return M;_=_.sibling}return null}function Y(_){var M=_.tag;if(M===5||M===26||M===27||M===6)return _;for(_=_.child;_!==null;){if(_.tag!==4&&(M=Y(_),M!==null))return M;_=_.sibling}return null}function J(_){return{current:_}}function T(_){0>Ar||(_.current=fc[Ar],fc[Ar]=null,Ar--)}function L(_,M){Ar++,fc[Ar]=_.current,_.current=M}function z(_){return _>>>=0,_===0?32:31-(Xg(_)/xh|0)|0}function K(_){var M=_&42;if(M!==0)return M;switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return _&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return _}}function P(_,M){var F=_.pendingLanes;if(F===0)return 0;var U=0,te=_.suspendedLanes,oe=_.pingedLanes,pe=_.warmLanes;_=_.finishedLanes!==0;var we=F&134217727;return we!==0?(F=we&~te,F!==0?U=K(F):(oe&=we,oe!==0?U=K(oe):_||(pe=we&~pe,pe!==0&&(U=K(pe))))):(we=F&~te,we!==0?U=K(we):oe!==0?U=K(oe):_||(pe=F&~pe,pe!==0&&(U=K(pe)))),U===0?0:M!==0&&M!==U&&(M&te)===0&&(te=U&-U,pe=M&-M,te>=pe||te===32&&(pe&4194176)!==0)?M:U}function $(_,M){return(_.pendingLanes&~(_.suspendedLanes&~_.pingedLanes)&M)===0}function ie(_,M){switch(_){case 1:case 2:case 4:case 8:return M+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return M+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ne(){var _=vl;return vl<<=1,(vl&4194176)===0&&(vl=128),_}function ee(){var _=xa;return xa<<=1,(xa&62914560)===0&&(xa=4194304),_}function se(_){for(var M=[],F=0;31>F;F++)M.push(_);return M}function re(_,M){_.pendingLanes|=M,M!==268435456&&(_.suspendedLanes=0,_.pingedLanes=0,_.warmLanes=0)}function ce(_,M,F,U,te,oe){var pe=_.pendingLanes;_.pendingLanes=F,_.suspendedLanes=0,_.pingedLanes=0,_.warmLanes=0,_.expiredLanes&=F,_.entangledLanes&=F,_.errorRecoveryDisabledLanes&=F,_.shellSuspendCounter=0;var we=_.entanglements,Ke=_.expirationTimes,gt=_.hiddenUpdates;for(F=pe&~F;0<F;){var xt=31-nn(F),Wt=1<<xt;we[xt]=0,Ke[xt]=-1;var St=gt[xt];if(St!==null)for(gt[xt]=null,xt=0;xt<St.length;xt++){var ti=St[xt];ti!==null&&(ti.lane&=-536870913)}F&=~Wt}U!==0&&ue(_,U,0),oe!==0&&te===0&&_.tag!==0&&(_.suspendedLanes|=oe&~(pe&~M))}function ue(_,M,F){_.pendingLanes|=M,_.suspendedLanes&=~M;var U=31-nn(M);_.entangledLanes|=M,_.entanglements[U]=_.entanglements[U]|1073741824|F&4194218}function ye(_,M){var F=_.entangledLanes|=M;for(_=_.entanglements;F;){var U=31-nn(F),te=1<<U;te&M|_[U]&M&&(_[U]|=M),F&=~te}}function Se(_){return _&=-_,2<_?8<_?(_&134217727)!==0?32:268435456:8:2}function Ce(_){if(dn&&typeof dn.onCommitFiberRoot=="function")try{dn.onCommitFiberRoot(_a,_,void 0,(_.current.flags&128)===128)}catch{}}function Ze(_){if(typeof Tn=="function"&&Ac(_),dn&&typeof dn.setStrictMode=="function")try{dn.setStrictMode(_a,_)}catch{}}function Be(_,M){return _===M&&(_!==0||1/_===1/M)||_!==_&&M!==M}function xe(_,M){if(typeof _=="object"&&_!==null){var F=mc.get(_);return F!==void 0?F:(M={value:_,source:M,stack:G(M)},mc.set(_,M),M)}return{value:_,source:M,stack:G(M)}}function ge(_,M){ms[bs++]=wa,ms[bs++]=br,br=_,wa=M}function de(_,M,F){us[Jn++]=ao,us[Jn++]=lo,us[Jn++]=ks,ks=_;var U=ao;_=lo;var te=32-nn(U)-1;U&=~(1<<te),F+=1;var oe=32-nn(M)+te;if(30<oe){var pe=te-te%5;oe=(U&(1<<pe)-1).toString(32),U>>=pe,te-=pe,ao=1<<32-nn(M)+te|F<<te|U,lo=oe+_}else ao=1<<oe|F<<te|U,lo=_}function ve(_){_.return!==null&&(ge(_,1),de(_,1,0))}function le(_){for(;_===br;)br=ms[--bs],ms[bs]=null,wa=ms[--bs],ms[bs]=null;for(;_===ks;)ks=us[--Jn],us[Jn]=null,lo=us[--Jn],us[Jn]=null,ao=us[--Jn],us[Jn]=null}function Ae(_,M){L(Yo,M),L(Zs,_),L(sn,null),_=ng(M),T(sn),L(sn,_)}function Xe(){T(sn),T(Zs),T(Yo)}function Te(_){_.memoizedState!==null&&L(Sl,_);var M=sn.current,F=hu(M,_.type);M!==F&&(L(Zs,_),L(sn,F))}function Ne(_){Zs.current===_&&(T(sn),T(Zs)),Sl.current===_&&(T(Sl),zs?Vo._currentValue=kr:Vo._currentValue2=kr)}function We(_){var M=Error(u(418,""));throw Oe(xe(M,_)),Xl}function dt(_,M){if(!gs)throw Error(u(175));Or(_.stateNode,_.type,_.memoizedProps,M,_)||We(_)}function nt(_){for(on=_.return;on;)switch(on.tag){case 3:case 27:Ps=!0;return;case 5:case 13:Ps=!1;return;default:on=on.return}}function Rt(_){if(!gs||_!==on)return!1;if(!bi)return nt(_),bi=!0,!1;var M=!1;if(Xn?_.tag!==3&&_.tag!==27&&(_.tag!==5||fg(_.type)&&!Mn(_.type,_.memoizedProps))&&(M=!0):_.tag!==3&&(_.tag!==5||fg(_.type)&&!Mn(_.type,_.memoizedProps))&&(M=!0),M&&wi&&We(_),nt(_),_.tag===13){if(!gs)throw Error(u(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(u(317));wi=Ku(_)}else wi=on?pr(_.stateNode):null;return!0}function Qe(){gs&&(wi=on=null,bi=!1)}function Oe(_){xs===null?xs=[_]:xs.push(_)}function be(){for(var _=To,M=Ds=To=0;M<_;){var F=hs[M];hs[M++]=null;var U=hs[M];hs[M++]=null;var te=hs[M];hs[M++]=null;var oe=hs[M];if(hs[M++]=null,U!==null&&te!==null){var pe=U.pending;pe===null?te.next=te:(te.next=pe.next,pe.next=te),U.pending=te}oe!==0&&rt(F,te,oe)}}function yt(_,M,F,U){hs[To++]=_,hs[To++]=M,hs[To++]=F,hs[To++]=U,Ds|=U,_.lanes|=U,_=_.alternate,_!==null&&(_.lanes|=U)}function st(_,M,F,U){return yt(_,M,F,U),Yt(_)}function Gt(_,M){return yt(_,null,null,M),Yt(_)}function rt(_,M,F){_.lanes|=F;var U=_.alternate;U!==null&&(U.lanes|=F);for(var te=!1,oe=_.return;oe!==null;)oe.childLanes|=F,U=oe.alternate,U!==null&&(U.childLanes|=F),oe.tag===22&&(_=oe.stateNode,_===null||_._visibility&1||(te=!0)),_=oe,oe=oe.return;te&&M!==null&&_.tag===3&&(oe=_.stateNode,te=31-nn(F),oe=oe.hiddenUpdates,_=oe[te],_===null?oe[te]=[M]:_.push(M),M.lane=F|536870912)}function Yt(_){if(50<ia)throw ia=0,wg=null,Error(u(185));for(var M=_.return;M!==null;)_=M,M=_.return;return _.tag===3?_.stateNode:null}function Xt(_){_!==yr&&_.next===null&&(yr===null?Fi=yr=_:yr=yr.next=_),rn=!0,bc||(bc=!0,He(he))}function Ge(_,M){if(!yc&&rn){yc=!0;do for(var F=!1,U=Fi;U!==null;){if(_!==0){var te=U.pendingLanes;if(te===0)var oe=0;else{var pe=U.suspendedLanes,we=U.pingedLanes;oe=(1<<31-nn(42|_)+1)-1,oe&=te&~(pe&~we),oe=oe&201326677?oe&201326677|1:oe?oe|2:0}oe!==0&&(F=!0,ht(U,oe))}else oe=hi,oe=P(U,U===Ni?oe:0),(oe&3)===0||$(U,oe)||(F=!0,ht(U,oe));U=U.next}while(F);yc=!1}}function he(){rn=bc=!1;var _=0;Ma!==0&&(fu()&&(_=Ma),Ma=0);for(var M=As(),F=null,U=Fi;U!==null;){var te=U.next,oe=ke(U,M);oe===0?(U.next=null,F===null?Fi=te:F.next=te,te===null&&(yr=F)):(F=U,(_!==0||(oe&3)!==0)&&(rn=!0)),U=te}Ge(_)}function ke(_,M){for(var F=_.suspendedLanes,U=_.pingedLanes,te=_.expirationTimes,oe=_.pendingLanes&-62914561;0<oe;){var pe=31-nn(oe),we=1<<pe,Ke=te[pe];Ke===-1?((we&F)===0||(we&U)!==0)&&(te[pe]=ie(we,M)):Ke<=M&&(_.expiredLanes|=we),oe&=~we}if(M=Ni,F=hi,F=P(_,_===M?F:0),U=_.callbackNode,F===0||_===M&&_i===2||_.cancelPendingCommit!==null)return U!==null&&U!==null&&Ks(U),_.callbackNode=null,_.callbackPriority=0;if((F&3)===0||$(_,F)){if(M=F&-F,M===_.callbackPriority)return M;switch(U!==null&&Ks(U),Se(F)){case 2:case 8:F=Bl;break;case 32:F=Ra;break;case 268435456:F=$r;break;default:F=Ra}return U=it.bind(null,_),F=ro(F,U),_.callbackPriority=M,_.callbackNode=F,M}return U!==null&&U!==null&&Ks(U),_.callbackPriority=2,_.callbackNode=null,2}function it(_,M){var F=_.callbackNode;if(rr()&&_.callbackNode!==F)return null;var U=hi;return U=P(_,_===Ni?U:0),U===0?null:(Is(_,U,M),ke(_,As()),_.callbackNode!=null&&_.callbackNode===F?it.bind(null,_):null)}function ht(_,M){if(rr())return null;Is(_,M,!0)}function He(_){bu?yu(function(){(ui&6)!==0?ro(pc,_):_()}):ro(pc,_)}function ot(){return Ma===0&&(Ma=ne()),Ma}function Zt(_,M){if(Na===null){var F=Na=[];Gc=0,Ki=ot(),Zn={status:"pending",value:void 0,then:function(U){F.push(U)}}}return Gc++,M.then(wt,wt),M}function wt(){if(--Gc===0&&Na!==null){Zn!==null&&(Zn.status="fulfilled");var _=Na;Na=null,Ki=0,Zn=null;for(var M=0;M<_.length;M++)(0,_[M])()}}function Et(_,M){var F=[],U={status:"pending",value:null,reason:null,then:function(te){F.push(te)}};return _.then(function(){U.status="fulfilled",U.value=M;for(var te=0;te<F.length;te++)(0,F[te])(M)},function(te){for(U.status="rejected",U.reason=te,te=0;te<F.length;te++)(0,F[te])(void 0)}),U}function De(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ct(_,M){_=_.updateQueue,M.updateQueue===_&&(M.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,callbacks:null})}function ft(_){return{lane:_,tag:0,payload:null,callback:null,next:null}}function At(_,M,F){var U=_.updateQueue;if(U===null)return null;if(U=U.shared,(ui&2)!==0){var te=U.pending;return te===null?M.next=M:(M.next=te.next,te.next=M),U.pending=M,M=Yt(_),rt(_,null,F),M}return yt(_,U,M,F),Yt(_)}function Ct(_,M,F){if(M=M.updateQueue,M!==null&&(M=M.shared,(F&4194176)!==0)){var U=M.lanes;U&=_.pendingLanes,F|=U,M.lanes=F,ye(_,F)}}function me(_,M){var F=_.updateQueue,U=_.alternate;if(U!==null&&(U=U.updateQueue,F===U)){var te=null,oe=null;if(F=F.firstBaseUpdate,F!==null){do{var pe={lane:F.lane,tag:F.tag,payload:F.payload,callback:null,next:null};oe===null?te=oe=pe:oe=oe.next=pe,F=F.next}while(F!==null);oe===null?te=oe=M:oe=oe.next=M}else te=oe=M;F={baseState:U.baseState,firstBaseUpdate:te,lastBaseUpdate:oe,shared:U.shared,callbacks:U.callbacks},_.updateQueue=F;return}_=F.lastBaseUpdate,_===null?F.firstBaseUpdate=M:_.next=M,F.lastBaseUpdate=M}function Ee(){if(vc){var _=Zn;if(_!==null)throw _}}function _e(_,M,F,U){vc=!1;var te=_.updateQueue;Hn=!1;var oe=te.firstBaseUpdate,pe=te.lastBaseUpdate,we=te.shared.pending;if(we!==null){te.shared.pending=null;var Ke=we,gt=Ke.next;Ke.next=null,pe===null?oe=gt:pe.next=gt,pe=Ke;var xt=_.alternate;xt!==null&&(xt=xt.updateQueue,we=xt.lastBaseUpdate,we!==pe&&(we===null?xt.firstBaseUpdate=gt:we.next=gt,xt.lastBaseUpdate=Ke))}if(oe!==null){var Wt=te.baseState;pe=0,xt=gt=Ke=null,we=oe;do{var St=we.lane&-536870913,ti=St!==we.lane;if(ti?(hi&St)===St:(U&St)===St){St!==0&&St===Ki&&(vc=!0),xt!==null&&(xt=xt.next={lane:0,tag:we.tag,payload:we.payload,callback:null,next:null});e:{var Es=_,Ja=we;St=M;var na=F;switch(Ja.tag){case 1:if(Es=Ja.payload,typeof Es=="function"){Wt=Es.call(na,Wt,St);break e}Wt=Es;break e;case 3:Es.flags=Es.flags&-65537|128;case 0:if(Es=Ja.payload,St=typeof Es=="function"?Es.call(na,Wt,St):Es,St==null)break e;Wt=en({},Wt,St);break e;case 2:Hn=!0}}St=we.callback,St!==null&&(_.flags|=64,ti&&(_.flags|=8192),ti=te.callbacks,ti===null?te.callbacks=[St]:ti.push(St))}else ti={lane:St,tag:we.tag,payload:we.payload,callback:we.callback,next:null},xt===null?(gt=xt=ti,Ke=Wt):xt=xt.next=ti,pe|=St;if(we=we.next,we===null){if(we=te.shared.pending,we===null)break;ti=we,we=ti.next,ti.next=null,te.lastBaseUpdate=ti,te.shared.pending=null}}while(!0);xt===null&&(Ke=Wt),te.baseState=Ke,te.firstBaseUpdate=gt,te.lastBaseUpdate=xt,oe===null&&(te.shared.lanes=0),Vs|=pe,_.lanes=pe,_.memoizedState=Wt}}function Me(_,M){if(typeof _!="function")throw Error(u(191,_));_.call(M)}function Bt(_,M){var F=_.callbacks;if(F!==null)for(_.callbacks=null,_=0;_<F.length;_++)Me(F[_],M)}function qe(_,M){if($n(_,M))return!0;if(typeof _!="object"||_===null||typeof M!="object"||M===null)return!1;var F=Object.keys(_),U=Object.keys(M);if(F.length!==U.length)return!1;for(U=0;U<F.length;U++){var te=F[U];if(!ju.call(M,te)||!$n(_[te],M[te]))return!1}return!0}function at(_){return _=_.status,_==="fulfilled"||_==="rejected"}function bt(){}function _t(_,M,F){switch(F=_[F],F===void 0?_.push(M):F!==M&&(M.then(bt,bt),M=F),M.status){case"fulfilled":return M.value;case"rejected":throw _=M.reason,_===Zl?Error(u(483)):_;default:if(typeof M.status=="string")M.then(bt,bt);else{if(_=Ni,_!==null&&100<_.shellSuspendCounter)throw Error(u(482));_=M,_.status="pending",_.then(function(U){if(M.status==="pending"){var te=M;te.status="fulfilled",te.value=U}},function(U){if(M.status==="pending"){var te=M;te.status="rejected",te.reason=U}})}switch(M.status){case"fulfilled":return M.value;case"rejected":throw _=M.reason,_===Zl?Error(u(483)):_}throw Ln=M,Zl}}function Tt(){if(Ln===null)throw Error(u(459));var _=Ln;return Ln=null,_}function si(_){var M=zn;return zn+=1,Qr===null&&(Qr=[]),_t(Qr,_,M)}function Bi(_,M){M=M.props.ref,_.ref=M!==void 0?M:null}function ii(_,M){throw M.$$typeof===tg?Error(u(525)):(_=Object.prototype.toString.call(M),Error(u(31,_==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":_)))}function ci(_){var M=_._init;return M(_._payload)}function Zi(_){function M(je,ze){if(_){var tt=je.deletions;tt===null?(je.deletions=[ze],je.flags|=16):tt.push(ze)}}function F(je,ze){if(!_)return null;for(;ze!==null;)M(je,ze),ze=ze.sibling;return null}function U(je){for(var ze=new Map;je!==null;)je.key!==null?ze.set(je.key,je):ze.set(je.index,je),je=je.sibling;return ze}function te(je,ze){return je=xo(je,ze),je.index=0,je.sibling=null,je}function oe(je,ze,tt){return je.index=tt,_?(tt=je.alternate,tt!==null?(tt=tt.index,tt<ze?(je.flags|=33554434,ze):tt):(je.flags|=33554434,ze)):(je.flags|=1048576,ze)}function pe(je){return _&&je.alternate===null&&(je.flags|=33554434),je}function we(je,ze,tt,vt){return ze===null||ze.tag!==6?(ze=Al(tt,je.mode,vt),ze.return=je,ze):(ze=te(ze,tt),ze.return=je,ze)}function Ke(je,ze,tt,vt){var Ht=tt.type;return Ht===gr?xt(je,ze,tt.props.children,vt,tt.key):ze!==null&&(ze.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===Mo&&ci(Ht)===ze.type)?(ze=te(ze,tt.props),Bi(ze,tt),ze.return=je,ze):(ze=zr(tt.type,tt.key,tt.props,null,je.mode,vt),Bi(ze,tt),ze.return=je,ze)}function gt(je,ze,tt,vt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==tt.containerInfo||ze.stateNode.implementation!==tt.implementation?(ze=cs(tt,je.mode,vt),ze.return=je,ze):(ze=te(ze,tt.children||[]),ze.return=je,ze)}function xt(je,ze,tt,vt,Ht){return ze===null||ze.tag!==7?(ze=lr(tt,je.mode,vt,Ht),ze.return=je,ze):(ze=te(ze,tt),ze.return=je,ze)}function Wt(je,ze,tt){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return ze=Al(""+ze,je.mode,tt),ze.return=je,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case cr:return tt=zr(ze.type,ze.key,ze.props,null,je.mode,tt),Bi(tt,ze),tt.return=je,tt;case no:return ze=cs(ze,je.mode,tt),ze.return=je,ze;case Mo:var vt=ze._init;return ze=vt(ze._payload),Wt(je,ze,tt)}if(Ir(ze)||d(ze))return ze=lr(ze,je.mode,tt,null),ze.return=je,ze;if(typeof ze.then=="function")return Wt(je,si(ze),tt);if(ze.$$typeof===hr)return Wt(je,il(je,ze),tt);ii(je,ze)}return null}function St(je,ze,tt,vt){var Ht=ze!==null?ze.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return Ht!==null?null:we(je,ze,""+tt,vt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case cr:return tt.key===Ht?Ke(je,ze,tt,vt):null;case no:return tt.key===Ht?gt(je,ze,tt,vt):null;case Mo:return Ht=tt._init,tt=Ht(tt._payload),St(je,ze,tt,vt)}if(Ir(tt)||d(tt))return Ht!==null?null:xt(je,ze,tt,vt,null);if(typeof tt.then=="function")return St(je,ze,si(tt),vt);if(tt.$$typeof===hr)return St(je,ze,il(je,tt),vt);ii(je,tt)}return null}function ti(je,ze,tt,vt,Ht){if(typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint")return je=je.get(tt)||null,we(ze,je,""+vt,Ht);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case cr:return je=je.get(vt.key===null?tt:vt.key)||null,Ke(ze,je,vt,Ht);case no:return je=je.get(vt.key===null?tt:vt.key)||null,gt(ze,je,vt,Ht);case Mo:var Vi=vt._init;return vt=Vi(vt._payload),ti(je,ze,tt,vt,Ht)}if(Ir(vt)||d(vt))return je=je.get(tt)||null,xt(ze,je,vt,Ht,null);if(typeof vt.then=="function")return ti(je,ze,tt,si(vt),Ht);if(vt.$$typeof===hr)return ti(je,ze,tt,il(ze,vt),Ht);ii(ze,vt)}return null}function Es(je,ze,tt,vt){for(var Ht=null,Vi=null,Pt=ze,li=ze=0,Ei=null;Pt!==null&&li<tt.length;li++){Pt.index>li?(Ei=Pt,Pt=null):Ei=Pt.sibling;var fi=St(je,Pt,tt[li],vt);if(fi===null){Pt===null&&(Pt=Ei);break}_&&Pt&&fi.alternate===null&&M(je,Pt),ze=oe(fi,ze,li),Vi===null?Ht=fi:Vi.sibling=fi,Vi=fi,Pt=Ei}if(li===tt.length)return F(je,Pt),bi&&ge(je,li),Ht;if(Pt===null){for(;li<tt.length;li++)Pt=Wt(je,tt[li],vt),Pt!==null&&(ze=oe(Pt,ze,li),Vi===null?Ht=Pt:Vi.sibling=Pt,Vi=Pt);return bi&&ge(je,li),Ht}for(Pt=U(Pt);li<tt.length;li++)Ei=ti(Pt,je,li,tt[li],vt),Ei!==null&&(_&&Ei.alternate!==null&&Pt.delete(Ei.key===null?li:Ei.key),ze=oe(Ei,ze,li),Vi===null?Ht=Ei:Vi.sibling=Ei,Vi=Ei);return _&&Pt.forEach(function(_r){return M(je,_r)}),bi&&ge(je,li),Ht}function Ja(je,ze,tt,vt){if(tt==null)throw Error(u(151));for(var Ht=null,Vi=null,Pt=ze,li=ze=0,Ei=null,fi=tt.next();Pt!==null&&!fi.done;li++,fi=tt.next()){Pt.index>li?(Ei=Pt,Pt=null):Ei=Pt.sibling;var _r=St(je,Pt,fi.value,vt);if(_r===null){Pt===null&&(Pt=Ei);break}_&&Pt&&_r.alternate===null&&M(je,Pt),ze=oe(_r,ze,li),Vi===null?Ht=_r:Vi.sibling=_r,Vi=_r,Pt=Ei}if(fi.done)return F(je,Pt),bi&&ge(je,li),Ht;if(Pt===null){for(;!fi.done;li++,fi=tt.next())fi=Wt(je,fi.value,vt),fi!==null&&(ze=oe(fi,ze,li),Vi===null?Ht=fi:Vi.sibling=fi,Vi=fi);return bi&&ge(je,li),Ht}for(Pt=U(Pt);!fi.done;li++,fi=tt.next())fi=ti(Pt,je,li,fi.value,vt),fi!==null&&(_&&fi.alternate!==null&&Pt.delete(fi.key===null?li:fi.key),ze=oe(fi,ze,li),Vi===null?Ht=fi:Vi.sibling=fi,Vi=fi);return _&&Pt.forEach(function(eh){return M(je,eh)}),bi&&ge(je,li),Ht}function na(je,ze,tt,vt){if(typeof tt=="object"&&tt!==null&&tt.type===gr&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case cr:e:{for(var Ht=tt.key;ze!==null;){if(ze.key===Ht){if(Ht=tt.type,Ht===gr){if(ze.tag===7){F(je,ze.sibling),vt=te(ze,tt.props.children),vt.return=je,je=vt;break e}}else if(ze.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===Mo&&ci(Ht)===ze.type){F(je,ze.sibling),vt=te(ze,tt.props),Bi(vt,tt),vt.return=je,je=vt;break e}F(je,ze);break}else M(je,ze);ze=ze.sibling}tt.type===gr?(vt=lr(tt.props.children,je.mode,vt,tt.key),vt.return=je,je=vt):(vt=zr(tt.type,tt.key,tt.props,null,je.mode,vt),Bi(vt,tt),vt.return=je,je=vt)}return pe(je);case no:e:{for(Ht=tt.key;ze!==null;){if(ze.key===Ht)if(ze.tag===4&&ze.stateNode.containerInfo===tt.containerInfo&&ze.stateNode.implementation===tt.implementation){F(je,ze.sibling),vt=te(ze,tt.children||[]),vt.return=je,je=vt;break e}else{F(je,ze);break}else M(je,ze);ze=ze.sibling}vt=cs(tt,je.mode,vt),vt.return=je,je=vt}return pe(je);case Mo:return Ht=tt._init,tt=Ht(tt._payload),na(je,ze,tt,vt)}if(Ir(tt))return Es(je,ze,tt,vt);if(d(tt)){if(Ht=d(tt),typeof Ht!="function")throw Error(u(150));return tt=Ht.call(tt),Ja(je,ze,tt,vt)}if(typeof tt.then=="function")return na(je,ze,si(tt),vt);if(tt.$$typeof===hr)return na(je,ze,il(je,tt),vt);ii(je,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint"?(tt=""+tt,ze!==null&&ze.tag===6?(F(je,ze.sibling),vt=te(ze,tt),vt.return=je,je=vt):(F(je,ze),vt=Al(tt,je.mode,vt),vt.return=je,je=vt),pe(je)):F(je,ze)}return function(je,ze,tt,vt){try{zn=0;var Ht=na(je,ze,tt,vt);return Qr=null,Ht}catch(Pt){if(Pt===Zl)throw Pt;var Vi=o(29,Pt,null,je.mode);return Vi.lanes=vt,Vi.return=je,Vi}finally{}}}function Gn(_,M){_=Qs,L(Us,_),L(Os,M),Qs=_|M.baseLanes}function Ys(){L(Us,Qs),L(Os,Os.current)}function An(){Qs=Us.current,T(Os),T(Us)}function vn(_){var M=_.alternate;L(Li,Li.current&1),L(ds,_),Rs===null&&(M===null||Os.current!==null||M.memoizedState!==null)&&(Rs=_)}function Nn(_){if(_.tag===22){if(L(Li,Li.current),L(ds,_),Rs===null){var M=_.alternate;M!==null&&M.memoizedState!==null&&(Rs=_)}}else ns()}function ns(){L(Li,Li.current),L(ds,ds.current)}function Yi(_){T(ds),Rs===_&&(Rs=null),T(Li)}function Ti(_){for(var M=_;M!==null;){if(M.tag===13){var F=M.memoizedState;if(F!==null&&(F=F.dehydrated,F===null||Pr(F)||Gl(F)))return M}else if(M.tag===19&&M.memoizedProps.revealOrder!==void 0){if((M.flags&128)!==0)return M}else if(M.child!==null){M.child.return=M,M=M.child;continue}if(M===_)break;for(;M.sibling===null;){if(M.return===null||M.return===_)return null;M=M.return}M.sibling.return=M.return,M=M.sibling}return null}function Qt(){throw Error(u(321))}function Ts(_,M){if(M===null)return!1;for(var F=0;F<M.length&&F<_.length;F++)if(!$n(_[F],M[F]))return!1;return!0}function Oo(_,M,F,U,te,oe){return Jo=oe,qt=M,M.memoizedState=null,M.updateQueue=null,M.lanes=0,Ut.H=_===null||_.memoizedState===null?zo:jn,vr=!1,oe=F(U,te),vr=!1,jr&&(oe=Vl(M,F,U,te)),Nl(_),oe}function Nl(_){Ut.H=an;var M=Gi!==null&&Gi.next!==null;if(Jo=0,Oi=Gi=qt=null,Ho=!1,Va=0,Lo=null,M)throw Error(u(300));_===null||Cn||(_=_.dependencies,_!==null&&tl(_)&&(Cn=!0))}function Vl(_,M,F,U){qt=_;var te=0;do{if(jr&&(Lo=null),Va=0,jr=!1,25<=te)throw Error(u(301));if(te+=1,Oi=Gi=null,_.updateQueue!=null){var oe=_.updateQueue;oe.lastEffect=null,oe.events=null,oe.stores=null,oe.memoCache!=null&&(oe.memoCache.index=0)}Ut.H=Sr,oe=M(F,U)}while(jr);return oe}function Wl(){var _=Ut.H,M=_.useState()[0];return M=typeof M.then=="function"?$e(M):M,_=_.useState()[0],(Gi!==null?Gi.memoizedState:null)!==_&&(qt.flags|=1024),M}function Io(){var _=Br!==0;return Br=0,_}function wr(_,M,F){M.updateQueue=_.updateQueue,M.flags&=-2053,_.lanes&=~F}function Js(_){if(Ho){for(_=_.memoizedState;_!==null;){var M=_.queue;M!==null&&(M.pending=null),_=_.next}Ho=!1}Jo=0,Oi=Gi=qt=null,jr=!1,Va=Br=0,Lo=null}function Ie(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?qt.memoizedState=Oi=_:Oi=Oi.next=_,Oi}function Ve(){if(Gi===null){var _=qt.alternate;_=_!==null?_.memoizedState:null}else _=Gi.next;var M=Oi===null?qt.memoizedState:Oi.next;if(M!==null)Oi=M,Gi=_;else{if(_===null)throw qt.alternate===null?Error(u(467)):Error(u(310));Gi=_,_={memoizedState:Gi.memoizedState,baseState:Gi.baseState,baseQueue:Gi.baseQueue,queue:Gi.queue,next:null},Oi===null?qt.memoizedState=Oi=_:Oi=Oi.next=_}return Oi}function $e(_){var M=Va;return Va+=1,Lo===null&&(Lo=[]),_=_t(Lo,_,M),M=qt,(Oi===null?M.memoizedState:Oi.next)===null&&(M=M.alternate,Ut.H=M===null||M.memoizedState===null?zo:jn),_}function Pe(_){if(_!==null&&typeof _=="object"){if(typeof _.then=="function")return $e(_);if(_.$$typeof===hr)return _n(_)}throw Error(u(438,String(_)))}function Le(_){var M=null,F=qt.updateQueue;if(F!==null&&(M=F.memoCache),M==null){var U=qt.alternate;U!==null&&(U=U.updateQueue,U!==null&&(U=U.memoCache,U!=null&&(M={data:U.data.map(function(te){return te.slice()}),index:0})))}if(M==null&&(M={data:[],index:0}),F===null&&(F=Zg(),qt.updateQueue=F),F.memoCache=M,F=M.data[M.index],F===void 0)for(F=M.data[M.index]=Array(_),U=0;U<_;U++)F[U]=oi;return M.index++,F}function pt(_,M){return typeof M=="function"?M(_):M}function Mt(_){var M=Ve();return Vt(M,Gi,_)}function Vt(_,M,F){var U=_.queue;if(U===null)throw Error(u(311));U.lastRenderedReducer=F;var te=_.baseQueue,oe=U.pending;if(oe!==null){if(te!==null){var pe=te.next;te.next=oe.next,oe.next=pe}M.baseQueue=te=oe,U.pending=null}if(oe=_.baseState,te===null)_.memoizedState=oe;else{M=te.next;var we=pe=null,Ke=null,gt=M,xt=!1;do{var Wt=gt.lane&-536870913;if(Wt!==gt.lane?(hi&Wt)===Wt:(Jo&Wt)===Wt){var St=gt.revertLane;if(St===0)Ke!==null&&(Ke=Ke.next={lane:0,revertLane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),Wt===Ki&&(xt=!0);else if((Jo&St)===St){gt=gt.next,St===Ki&&(xt=!0);continue}else Wt={lane:0,revertLane:gt.revertLane,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null},Ke===null?(we=Ke=Wt,pe=oe):Ke=Ke.next=Wt,qt.lanes|=St,Vs|=St;Wt=gt.action,vr&&F(oe,Wt),oe=gt.hasEagerState?gt.eagerState:F(oe,Wt)}else St={lane:Wt,revertLane:gt.revertLane,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null},Ke===null?(we=Ke=St,pe=oe):Ke=Ke.next=St,qt.lanes|=Wt,Vs|=Wt;gt=gt.next}while(gt!==null&&gt!==M);if(Ke===null?pe=oe:Ke.next=we,!$n(oe,_.memoizedState)&&(Cn=!0,xt&&(F=Zn,F!==null)))throw F;_.memoizedState=oe,_.baseState=pe,_.baseQueue=Ke,U.lastRenderedState=oe}return te===null&&(U.lanes=0),[_.memoizedState,U.dispatch]}function Nt(_){var M=Ve(),F=M.queue;if(F===null)throw Error(u(311));F.lastRenderedReducer=_;var U=F.dispatch,te=F.pending,oe=M.memoizedState;if(te!==null){F.pending=null;var pe=te=te.next;do oe=_(oe,pe.action),pe=pe.next;while(pe!==te);$n(oe,M.memoizedState)||(Cn=!0),M.memoizedState=oe,M.baseQueue===null&&(M.baseState=oe),F.lastRenderedState=oe}return[oe,U]}function Dt(_,M,F){var U=qt,te=Ve(),oe=bi;if(oe){if(F===void 0)throw Error(u(407));F=F()}else F=M();var pe=!$n((Gi||te).memoizedState,F);if(pe&&(te.memoizedState=F,Cn=!0),te=te.queue,Pa(di.bind(null,U,te,_),[_]),te.getSnapshot!==M||pe||Oi!==null&&Oi.memoizedState.tag&1){if(U.flags|=2048,Hs(9,zt.bind(null,U,te,F,M),{destroy:void 0},null),Ni===null)throw Error(u(349));oe||(Jo&60)!==0||Ot(U,M,F)}return F}function Ot(_,M,F){_.flags|=16384,_={getSnapshot:M,value:F},M=qt.updateQueue,M===null?(M=Zg(),qt.updateQueue=M,M.stores=[_]):(F=M.stores,F===null?M.stores=[_]:F.push(_))}function zt(_,M,F,U){M.value=F,M.getSnapshot=U,Ci(M)&&Ji(_)}function di(_,M,F){return F(function(){Ci(M)&&Ji(_)})}function Ci(_){var M=_.getSnapshot;_=_.value;try{var F=M();return!$n(_,F)}catch{return!0}}function Ji(_){var M=Gt(_,2);M!==null&&Hi(M,_,2)}function Ai(_){var M=Ie();if(typeof _=="function"){var F=_;if(_=F(),vr){Ze(!0);try{F()}finally{Ze(!1)}}}return M.memoizedState=M.baseState=_,M.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pt,lastRenderedState:_},M}function jt(_,M,F,U){return _.baseState=F,Vt(_,Gi,typeof U=="function"?U:pt)}function Ft(_,M,F,U,te){if($a(_))throw Error(u(485));if(_=M.action,_!==null){var oe={payload:te,action:_,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(pe){oe.listeners.push(pe)}};Ut.T!==null?F(!0):oe.isTransition=!1,U(oe),F=M.pending,F===null?(oe.next=M.pending=oe,cn(M,oe)):(oe.next=F.next,M.pending=F.next=oe)}}function cn(_,M){var F=M.action,U=M.payload,te=_.state;if(M.isTransition){var oe=Ut.T,pe={};Ut.T=pe;try{var we=F(te,U),Ke=Ut.S;Ke!==null&&Ke(pe,we),Ii(_,M,we)}catch(gt){Cs(_,M,gt)}finally{Ut.T=oe}}else try{oe=F(te,U),Ii(_,M,oe)}catch(gt){Cs(_,M,gt)}}function Ii(_,M,F){F!==null&&typeof F=="object"&&typeof F.then=="function"?F.then(function(U){kn(_,M,U)},function(U){return Cs(_,M,U)}):kn(_,M,F)}function kn(_,M,F){M.status="fulfilled",M.value=F,Vn(M),_.state=F,M=_.pending,M!==null&&(F=M.next,F===M?_.pending=null:(F=F.next,M.next=F,cn(_,F)))}function Cs(_,M,F){var U=_.pending;if(_.pending=null,U!==null){U=U.next;do M.status="rejected",M.reason=F,Vn(M),M=M.next;while(M!==U)}_.action=null}function Vn(_){_=_.listeners;for(var M=0;M<_.length;M++)(0,_[M])()}function mn(_,M){return M}function xi(_,M){if(bi){var F=Ni.formState;if(F!==null){e:{var U=qt;if(bi){if(wi){var te=Hu(wi,Ps);if(te){wi=pr(te),U=oo(te);break e}}We(U)}U=!1}U&&(M=F[0])}}F=Ie(),F.memoizedState=F.baseState=M,U={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mn,lastRenderedState:M},F.queue=U,F=Nc.bind(null,qt,U),U.dispatch=F,U=Ai(!1);var oe=aa.bind(null,qt,!1,U.queue);return U=Ie(),te={state:M,dispatch:null,action:_,pending:null},U.queue=te,F=Ft.bind(null,qt,te,oe,F),te.dispatch=F,U.memoizedState=_,[M,F,!1]}function Wn(_){var M=Ve();return xn(M,Gi,_)}function xn(_,M,F){M=Vt(_,M,mn)[0],_=Mt(pt)[0],M=typeof M=="object"&&M!==null&&typeof M.then=="function"?$e(M):M;var U=Ve(),te=U.queue,oe=te.dispatch;return F!==U.memoizedState&&(qt.flags|=2048,Hs(9,Qi.bind(null,te,F),{destroy:void 0},null)),[M,oe,_]}function Qi(_,M){_.action=M}function Bn(_){var M=Ve(),F=Gi;if(F!==null)return xn(M,F,_);Ve(),M=M.memoizedState,F=Ve();var U=F.queue.dispatch;return F.memoizedState=_,[M,U,!1]}function Hs(_,M,F,U){return _={tag:_,create:M,inst:F,deps:U,next:null},M=qt.updateQueue,M===null&&(M=Zg(),qt.updateQueue=M),F=M.lastEffect,F===null?M.lastEffect=_.next=_:(U=F.next,F.next=_,_.next=U,M.lastEffect=_),_}function Pn(){return Ve().memoizedState}function El(_,M,F,U){var te=Ie();qt.flags|=_,te.memoizedState=Hs(1|M,F,{destroy:void 0},U===void 0?null:U)}function ka(_,M,F,U){var te=Ve();U=U===void 0?null:U;var oe=te.memoizedState.inst;Gi!==null&&U!==null&&Ts(U,Gi.memoizedState.deps)?te.memoizedState=Hs(M,F,oe,U):(qt.flags|=_,te.memoizedState=Hs(1|M,F,oe,U))}function _c(_,M){El(8390656,8,_,M)}function Pa(_,M){ka(2048,8,_,M)}function zg(_,M){return ka(4,2,_,M)}function Fg(_,M){return ka(4,4,_,M)}function Da(_,M){if(typeof M=="function"){_=_();var F=M(_);return function(){typeof F=="function"?F():M(null)}}if(M!=null)return _=_(),M.current=_,function(){M.current=null}}function Yl(_,M,F){F=F!=null?F.concat([_]):null,ka(4,4,Da.bind(null,M,_),F)}function Oa(){}function Mr(_,M){var F=Ve();M=M===void 0?null:M;var U=F.memoizedState;return M!==null&&Ts(M,U[1])?U[0]:(F.memoizedState=[_,M],_)}function Nr(_,M){var F=Ve();M=M===void 0?null:M;var U=F.memoizedState;if(M!==null&&Ts(M,U[1]))return U[0];if(U=_(),vr){Ze(!0);try{_()}finally{Ze(!1)}}return F.memoizedState=[U,M],U}function Tl(_,M,F){return F===void 0||(Jo&1073741824)!==0?_.memoizedState=M:(_.memoizedState=F,_=ul(),qt.lanes|=_,Vs|=_,F)}function Jl(_,M,F,U){return $n(F,M)?F:Os.current!==null?(_=Tl(_,F,U),$n(_,M)||(Cn=!0),_):(Jo&42)===0?(Cn=!0,_.memoizedState=F):(_=ul(),qt.lanes|=_,Vs|=_,M)}function wc(_,M,F,U,te){var oe=fr();Un(oe!==0&&8>oe?oe:8);var pe=Ut.T,we={};Ut.T=we,aa(_,!1,M,F);try{var Ke=te(),gt=Ut.S;if(gt!==null&&gt(we,Ke),Ke!==null&&typeof Ke=="object"&&typeof Ke.then=="function"){var xt=Et(Ke,U);Uo(_,M,xt,En(_))}else Uo(_,M,U,En(_))}catch(Wt){Uo(_,M,{then:function(){},status:"rejected",reason:Wt},En())}finally{Un(oe),Ut.T=pe}}function oa(_){var M=_.memoizedState;if(M!==null)return M;M={memoizedState:kr,baseState:kr,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pt,lastRenderedState:kr},next:null};var F={};return M.next={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pt,lastRenderedState:F},next:null},_.memoizedState=M,_=_.alternate,_!==null&&(_.memoizedState=M),M}function Ua(){return _n(Vo)}function ra(){return Ve().memoizedState}function fo(){return Ve().memoizedState}function Mc(_){for(var M=_.return;M!==null;){switch(M.tag){case 24:case 3:var F=En();_=ft(F);var U=At(M,_,F);U!==null&&(Hi(U,M,F),Ct(U,M,F)),M={cache:qo()},_.payload=M;return}M=M.return}}function Hl(_,M,F){var U=En();F={lane:U,revertLane:0,action:F,hasEagerState:!1,eagerState:null,next:null},$a(_)?Dn(M,F):(F=st(_,M,F,U),F!==null&&(Hi(F,_,U),$o(F,M,U)))}function Nc(_,M,F){var U=En();Uo(_,M,F,U)}function Uo(_,M,F,U){var te={lane:U,revertLane:0,action:F,hasEagerState:!1,eagerState:null,next:null};if($a(_))Dn(M,te);else{var oe=_.alternate;if(_.lanes===0&&(oe===null||oe.lanes===0)&&(oe=M.lastRenderedReducer,oe!==null))try{var pe=M.lastRenderedState,we=oe(pe,F);if(te.hasEagerState=!0,te.eagerState=we,$n(we,pe))return yt(_,M,te,0),Ni===null&&be(),!1}catch{}finally{}if(F=st(_,M,te,U),F!==null)return Hi(F,_,U),$o(F,M,U),!0}return!1}function aa(_,M,F,U){if(U={lane:2,revertLane:ot(),action:U,hasEagerState:!1,eagerState:null,next:null},$a(_)){if(M)throw Error(u(479))}else M=st(_,F,U,2),M!==null&&Hi(M,_,2)}function $a(_){var M=_.alternate;return _===qt||M!==null&&M===qt}function Dn(_,M){jr=Ho=!0;var F=_.pending;F===null?M.next=M:(M.next=F.next,F.next=M),_.pending=M}function $o(_,M,F){if((F&4194176)!==0){var U=M.lanes;U&=_.pendingLanes,F|=U,M.lanes=F,ye(_,F)}}function la(_,M,F,U){M=_.memoizedState,F=F(U,M),F=F==null?M:en({},M,F),_.memoizedState=F,_.lanes===0&&(_.updateQueue.baseState=F)}function ca(_,M,F,U,te,oe,pe){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(U,oe,pe):M.prototype&&M.prototype.isPureReactComponent?!qe(F,U)||!qe(te,oe):!0}function Kg(_,M,F,U){_=M.state,typeof M.componentWillReceiveProps=="function"&&M.componentWillReceiveProps(F,U),typeof M.UNSAFE_componentWillReceiveProps=="function"&&M.UNSAFE_componentWillReceiveProps(F,U),M.state!==_&&Wa.enqueueReplaceState(M,M.state,null)}function po(_,M){var F=M;if("ref"in M){F={};for(var U in M)U!=="ref"&&(F[U]=M[U])}if(_=_.defaultProps){F===M&&(F=en({},F));for(var te in _)F[te]===void 0&&(F[te]=_[te])}return F}function ga(_,M){try{var F=_.onUncaughtError;F(M.value,{componentStack:M.stack})}catch(U){setTimeout(function(){throw U})}}function ua(_,M,F){try{var U=_.onCaughtError;U(F.value,{componentStack:F.stack,errorBoundary:M.tag===1?M.stateNode:null})}catch(te){setTimeout(function(){throw te})}}function ha(_,M,F){return F=ft(F),F.tag=3,F.payload={element:null},F.callback=function(){ga(_,M)},F}function Vc(_){return _=ft(_),_.tag=3,_}function kg(_,M,F,U){var te=F.type.getDerivedStateFromError;if(typeof te=="function"){var oe=U.value;_.payload=function(){return te(oe)},_.callback=function(){ua(M,F,U)}}var pe=F.stateNode;pe!==null&&typeof pe.componentDidCatch=="function"&&(_.callback=function(){ua(M,F,U),typeof te!="function"&&(ho===null?ho=new Set([this]):ho.add(this));var we=U.stack;this.componentDidCatch(U.value,{componentStack:we!==null?we:""})})}function ph(_,M,F,U,te){if(F.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){if(M=F.alternate,M!==null&&el(M,F,te,!0),F=ds.current,F!==null){switch(F.tag){case 13:return Rs===null?Xs():F.alternate===null&&Ui===0&&(Ui=3),F.flags&=-257,F.flags|=65536,F.lanes=te,U===Qn?F.flags|=16384:(M=F.updateQueue,M===null?F.updateQueue=new Set([U]):M.add(U),ar(_,U,te)),!1;case 22:return F.flags|=65536,U===Qn?F.flags|=16384:(M=F.updateQueue,M===null?(M={transitions:null,markerInstances:null,retryQueue:new Set([U])},F.updateQueue=M):(F=M.retryQueue,F===null?M.retryQueue=new Set([U]):F.add(U)),ar(_,U,te)),!1}throw Error(u(435,F.tag))}return ar(_,U,te),Xs(),!1}if(bi)return M=ds.current,M!==null?((M.flags&65536)===0&&(M.flags|=256),M.flags|=65536,M.lanes=te,U!==Xl&&(_=Error(u(422),{cause:U}),Oe(xe(_,F)))):(U!==Xl&&(M=Error(u(423),{cause:U}),Oe(xe(M,F))),_=_.current.alternate,_.flags|=65536,te&=-te,_.lanes|=te,U=xe(U,F),te=ha(_.stateNode,U,te),me(_,te),Ui!==4&&(Ui=2)),!1;var oe=Error(u(520),{cause:U});if(oe=xe(oe,F),Ya===null?Ya=[oe]:Ya.push(oe),Ui!==4&&(Ui=2),M===null)return!0;U=xe(U,F),F=M;do{switch(F.tag){case 3:return F.flags|=65536,_=te&-te,F.lanes|=_,_=ha(F.stateNode,U,_),me(F,_),!1;case 1:if(M=F.type,oe=F.stateNode,(F.flags&128)===0&&(typeof M.getDerivedStateFromError=="function"||oe!==null&&typeof oe.componentDidCatch=="function"&&(ho===null||!ho.has(oe))))return F.flags|=65536,te&=-te,F.lanes|=te,te=Vc(te),kg(te,_,F,U),me(F,te),!1}F=F.return}while(F!==null);return!1}function Rn(_,M,F,U){M.child=_===null?co(M,null,F,U):Gr(M,_.child,F,U)}function Ll(_,M,F,U,te){F=F.render;var oe=M.ref;if("ref"in U){var pe={};for(var we in U)we!=="ref"&&(pe[we]=U[we])}else pe=U;return jo(M),U=Oo(_,M,F,pe,oe,te),we=Io(),_!==null&&!Cn?(wr(_,M,te),Ao(_,M,te)):(bi&&we&&ve(M),M.flags|=1,Rn(_,M,U,te),M.child)}function Pg(_,M,F,U,te){if(_===null){var oe=F.type;return typeof oe=="function"&&!Zo(oe)&&oe.defaultProps===void 0&&F.compare===null?(M.tag=15,M.type=oe,Dg(_,M,oe,U,te)):(_=zr(F.type,null,U,M,M.mode,te),_.ref=M.ref,_.return=M,M.child=_)}if(oe=_.child,!Jc(_,te)){var pe=oe.memoizedProps;if(F=F.compare,F=F!==null?F:qe,F(pe,U)&&_.ref===M.ref)return Ao(_,M,te)}return M.flags|=1,_=xo(oe,U),_.ref=M.ref,_.return=M,M.child=_}function Dg(_,M,F,U,te){if(_!==null){var oe=_.memoizedProps;if(qe(oe,U)&&_.ref===M.ref)if(Cn=!1,M.pendingProps=U=oe,Jc(_,te))(_.flags&131072)!==0&&(Cn=!0);else return M.lanes=_.lanes,Ao(_,M,te)}return zl(_,M,F,U,te)}function Og(_,M,F){var U=M.pendingProps,te=U.children,oe=(M.stateNode._pendingVisibility&2)!==0,pe=_!==null?_.memoizedState:null;if(Qa(_,M),U.mode==="hidden"||oe){if((M.flags&128)!==0){if(U=pe!==null?pe.baseLanes|F:F,_!==null){for(te=M.child=_.child,oe=0;te!==null;)oe=oe|te.lanes|te.childLanes,te=te.sibling;M.childLanes=oe&~U}else M.childLanes=0,M.child=null;return Ug(_,M,U,F)}if((F&536870912)!==0)M.memoizedState={baseLanes:0,cachePool:null},_!==null&&Kl(M,pe!==null?pe.cachePool:null),pe!==null?Gn(M,pe):Ys(),Nn(M);else return M.lanes=M.childLanes=536870912,Ug(_,M,pe!==null?pe.baseLanes|F:F,F)}else pe!==null?(Kl(M,pe.cachePool),Gn(M,pe),ns(),M.memoizedState=null):(_!==null&&Kl(M,null),Ys(),ns());return Rn(_,M,te,F),M.child}function Ug(_,M,F,U){var te=Lc();return te=te===null?null:{parent:zs?qi._currentValue:qi._currentValue2,pool:te},M.memoizedState={baseLanes:F,cachePool:te},_!==null&&Kl(M,null),Ys(),Nn(M),_!==null&&el(_,M,U,!0),null}function Qa(_,M){var F=M.ref;if(F===null)_!==null&&_.ref!==null&&(M.flags|=2097664);else{if(typeof F!="function"&&typeof F!="object")throw Error(u(284));(_===null||_.ref!==F)&&(M.flags|=2097664)}}function zl(_,M,F,U,te){return jo(M),F=Oo(_,M,F,U,void 0,te),U=Io(),_!==null&&!Cn?(wr(_,M,te),Ao(_,M,te)):(bi&&U&&ve(M),M.flags|=1,Rn(_,M,F,te),M.child)}function $g(_,M,F,U,te,oe){return jo(M),M.updateQueue=null,F=Vl(M,U,F,te),Nl(_),U=Io(),_!==null&&!Cn?(wr(_,M,oe),Ao(_,M,oe)):(bi&&U&&ve(M),M.flags|=1,Rn(_,M,F,oe),M.child)}function Qg(_,M,F,U,te){if(jo(M),M.stateNode===null){var oe=Ur,pe=F.contextType;typeof pe=="object"&&pe!==null&&(oe=_n(pe)),oe=new F(U,oe),M.memoizedState=oe.state!==null&&oe.state!==void 0?oe.state:null,oe.updater=Wa,M.stateNode=oe,oe._reactInternals=M,oe=M.stateNode,oe.props=U,oe.state=M.memoizedState,oe.refs={},De(M),pe=F.contextType,oe.context=typeof pe=="object"&&pe!==null?_n(pe):Ur,oe.state=M.memoizedState,pe=F.getDerivedStateFromProps,typeof pe=="function"&&(la(M,F,pe,U),oe.state=M.memoizedState),typeof F.getDerivedStateFromProps=="function"||typeof oe.getSnapshotBeforeUpdate=="function"||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(pe=oe.state,typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount(),pe!==oe.state&&Wa.enqueueReplaceState(oe,oe.state,null),_e(M,U,oe,te),Ee(),oe.state=M.memoizedState),typeof oe.componentDidMount=="function"&&(M.flags|=4194308),U=!0}else if(_===null){oe=M.stateNode;var we=M.memoizedProps,Ke=po(F,we);oe.props=Ke;var gt=oe.context,xt=F.contextType;pe=Ur,typeof xt=="object"&&xt!==null&&(pe=_n(xt));var Wt=F.getDerivedStateFromProps;xt=typeof Wt=="function"||typeof oe.getSnapshotBeforeUpdate=="function",we=M.pendingProps!==we,xt||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(we||gt!==pe)&&Kg(M,oe,U,pe),Hn=!1;var St=M.memoizedState;oe.state=St,_e(M,U,oe,te),Ee(),gt=M.memoizedState,we||St!==gt||Hn?(typeof Wt=="function"&&(la(M,F,Wt,U),gt=M.memoizedState),(Ke=Hn||ca(M,F,Ke,U,St,gt,pe))?(xt||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(M.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(M.flags|=4194308),M.memoizedProps=U,M.memoizedState=gt),oe.props=U,oe.state=gt,oe.context=pe,U=Ke):(typeof oe.componentDidMount=="function"&&(M.flags|=4194308),U=!1)}else{oe=M.stateNode,ct(_,M),pe=M.memoizedProps,xt=po(F,pe),oe.props=xt,Wt=M.pendingProps,St=oe.context,gt=F.contextType,Ke=Ur,typeof gt=="object"&&gt!==null&&(Ke=_n(gt)),we=F.getDerivedStateFromProps,(gt=typeof we=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(pe!==Wt||St!==Ke)&&Kg(M,oe,U,Ke),Hn=!1,St=M.memoizedState,oe.state=St,_e(M,U,oe,te),Ee();var ti=M.memoizedState;pe!==Wt||St!==ti||Hn||_!==null&&_.dependencies!==null&&tl(_.dependencies)?(typeof we=="function"&&(la(M,F,we,U),ti=M.memoizedState),(xt=Hn||ca(M,F,xt,U,St,ti,Ke)||_!==null&&_.dependencies!==null&&tl(_.dependencies))?(gt||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(U,ti,Ke),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(U,ti,Ke)),typeof oe.componentDidUpdate=="function"&&(M.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(M.flags|=1024)):(typeof oe.componentDidUpdate!="function"||pe===_.memoizedProps&&St===_.memoizedState||(M.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||pe===_.memoizedProps&&St===_.memoizedState||(M.flags|=1024),M.memoizedProps=U,M.memoizedState=ti),oe.props=U,oe.state=ti,oe.context=Ke,U=xt):(typeof oe.componentDidUpdate!="function"||pe===_.memoizedProps&&St===_.memoizedState||(M.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||pe===_.memoizedProps&&St===_.memoizedState||(M.flags|=1024),U=!1)}return oe=U,Qa(_,M),U=(M.flags&128)!==0,oe||U?(oe=M.stateNode,F=U&&typeof F.getDerivedStateFromError!="function"?null:oe.render(),M.flags|=1,_!==null&&U?(M.child=Gr(M,_.child,null,te),M.child=Gr(M,null,F,te)):Rn(_,M,F,te),M.memoizedState=oe.state,_=M.child):_=Ao(_,M,te),_}function jg(_,M,F,U){return Qe(),M.flags|=256,Rn(_,M,F,U),M.child}function Wc(_){return{baseLanes:_,cachePool:zc()}}function ja(_,M,F){return _=_!==null?_.childLanes&~F:0,M&&(_|=ys),_}function qg(_,M,F){var U=M.pendingProps,te=!1,oe=(M.flags&128)!==0,pe;if((pe=oe)||(pe=_!==null&&_.memoizedState===null?!1:(Li.current&2)!==0),pe&&(te=!0,M.flags&=-129),pe=(M.flags&32)!==0,M.flags&=-33,_===null){if(bi){if(te?vn(M):ns(),bi){var we=wi,Ke;(Ke=we)&&(we=zu(we,Ps),we!==null?(M.memoizedState={dehydrated:we,treeContext:ks!==null?{id:ao,overflow:lo}:null,retryLane:536870912},Ke=o(18,null,null,0),Ke.stateNode=we,Ke.return=M,M.child=Ke,on=M,wi=null,Ke=!0):Ke=!1),Ke||We(M)}if(we=M.memoizedState,we!==null&&(we=we.dehydrated,we!==null))return Gl(we)?M.lanes=16:M.lanes=536870912,null;Yi(M)}return we=U.children,U=U.fallback,te?(ns(),te=M.mode,we=Yc({mode:"hidden",children:we},te),U=lr(U,te,F,null),we.return=M,U.return=M,we.sibling=U,M.child=we,te=M.child,te.memoizedState=Wc(F),te.childLanes=ja(_,pe,F),M.memoizedState=Rl,U):(vn(M),Ec(M,we))}if(Ke=_.memoizedState,Ke!==null&&(we=Ke.dehydrated,we!==null)){if(oe)M.flags&256?(vn(M),M.flags&=-257,M=Fl(_,M,F)):M.memoizedState!==null?(ns(),M.child=_.child,M.flags|=128,M=null):(ns(),te=U.fallback,we=M.mode,U=Yc({mode:"visible",children:U.children},we),te=lr(te,we,F,null),te.flags|=2,U.return=M,te.return=M,U.sibling=te,M.child=U,Gr(M,_.child,null,F),U=M.child,U.memoizedState=Wc(F),U.childLanes=ja(_,pe,F),M.memoizedState=Rl,M=te);else if(vn(M),Gl(we))pe=uc(we).digest,U=Error(u(419)),U.stack="",U.digest=pe,Oe({value:U,source:null,stack:null}),M=Fl(_,M,F);else if(Cn||el(_,M,F,!1),pe=(F&_.childLanes)!==0,Cn||pe){if(pe=Ni,pe!==null){if(U=F&-F,(U&42)!==0)U=1;else switch(U){case 2:U=1;break;case 8:U=4;break;case 32:U=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:U=64;break;case 268435456:U=134217728;break;default:U=0}if(U=(U&(pe.suspendedLanes|F))!==0?0:U,U!==0&&U!==Ke.retryLane)throw Ke.retryLane=U,Gt(_,U),Hi(pe,_,U),xg}Pr(we)||Xs(),M=Fl(_,M,F)}else Pr(we)?(M.flags|=128,M.child=_.child,M=pl.bind(null,_),Ju(we,M),M=null):(_=Ke.treeContext,gs&&(wi=dg(we),on=M,bi=!0,xs=null,Ps=!1,_!==null&&(us[Jn++]=ao,us[Jn++]=lo,us[Jn++]=ks,ao=_.id,lo=_.overflow,ks=M)),M=Ec(M,U.children),M.flags|=4096);return M}return te?(ns(),te=U.fallback,we=M.mode,Ke=_.child,oe=Ke.sibling,U=xo(Ke,{mode:"hidden",children:U.children}),U.subtreeFlags=Ke.subtreeFlags&31457280,oe!==null?te=xo(oe,te):(te=lr(te,we,F,null),te.flags|=2),te.return=M,U.return=M,U.sibling=te,M.child=U,U=te,te=M.child,we=_.child.memoizedState,we===null?we=Wc(F):(Ke=we.cachePool,Ke!==null?(oe=zs?qi._currentValue:qi._currentValue2,Ke=Ke.parent!==oe?{parent:oe,pool:oe}:Ke):Ke=zc(),we={baseLanes:we.baseLanes|F,cachePool:Ke}),te.memoizedState=we,te.childLanes=ja(_,pe,F),M.memoizedState=Rl,U):(vn(M),F=_.child,_=F.sibling,F=xo(F,{mode:"visible",children:U.children}),F.return=M,F.sibling=null,_!==null&&(pe=M.deletions,pe===null?(M.deletions=[_],M.flags|=16):pe.push(_)),M.child=F,M.memoizedState=null,F)}function Ec(_,M){return M=Yc({mode:"visible",children:M},_.mode),M.return=_,_.child=M}function Yc(_,M){return ic(_,M,0,null)}function Fl(_,M,F){return Gr(M,_.child,null,F),_=Ec(M,M.pendingProps.children),_.flags|=2,M.memoizedState=null,_}function eu(_,M,F){_.lanes|=M;var U=_.alternate;U!==null&&(U.lanes|=M),qa(_.return,M,F)}function Tc(_,M,F,U,te){var oe=_.memoizedState;oe===null?_.memoizedState={isBackwards:M,rendering:null,renderingStartTime:0,last:U,tail:F,tailMode:te}:(oe.isBackwards=M,oe.rendering=null,oe.renderingStartTime=0,oe.last=U,oe.tail=F,oe.tailMode=te)}function tu(_,M,F){var U=M.pendingProps,te=U.revealOrder,oe=U.tail;if(Rn(_,M,U.children,F),U=Li.current,(U&2)!==0)U=U&1|2,M.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=M.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&eu(_,F,M);else if(_.tag===19)eu(_,F,M);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===M)break e;for(;_.sibling===null;){if(_.return===null||_.return===M)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}U&=1}switch(L(Li,U),te){case"forwards":for(F=M.child,te=null;F!==null;)_=F.alternate,_!==null&&Ti(_)===null&&(te=F),F=F.sibling;F=te,F===null?(te=M.child,M.child=null):(te=F.sibling,F.sibling=null),Tc(M,!1,te,F,oe);break;case"backwards":for(F=null,te=M.child,M.child=null;te!==null;){if(_=te.alternate,_!==null&&Ti(_)===null){M.child=te;break}_=te.sibling,te.sibling=F,F=te,te=_}Tc(M,!0,F,null,oe);break;case"together":Tc(M,!1,null,null,void 0);break;default:M.memoizedState=null}return M.child}function Ao(_,M,F){if(_!==null&&(M.dependencies=_.dependencies),Vs|=M.lanes,(F&M.childLanes)===0)if(_!==null){if(el(_,M,F,!1),(F&M.childLanes)===0)return null}else return null;if(_!==null&&M.child!==_.child)throw Error(u(153));if(M.child!==null){for(_=M.child,F=xo(_,_.pendingProps),M.child=F,F.return=M;_.sibling!==null;)_=_.sibling,F=F.sibling=xo(_,_.pendingProps),F.return=M;F.sibling=null}return M.child}function Jc(_,M){return(_.lanes&M)!==0?!0:(_=_.dependencies,!!(_!==null&&tl(_)))}function Ah(_,M,F){switch(M.tag){case 3:Ae(M,M.stateNode.containerInfo),Qo(M,qi,_.memoizedState.cache),Qe();break;case 27:case 5:Te(M);break;case 4:Ae(M,M.stateNode.containerInfo);break;case 10:Qo(M,M.type,M.memoizedProps.value);break;case 13:var U=M.memoizedState;if(U!==null)return U.dehydrated!==null?(vn(M),M.flags|=128,null):(F&M.child.childLanes)!==0?qg(_,M,F):(vn(M),_=Ao(_,M,F),_!==null?_.sibling:null);vn(M);break;case 19:var te=(_.flags&128)!==0;if(U=(F&M.childLanes)!==0,U||(el(_,M,F,!1),U=(F&M.childLanes)!==0),te){if(U)return tu(_,M,F);M.flags|=128}if(te=M.memoizedState,te!==null&&(te.rendering=null,te.tail=null,te.lastEffect=null),L(Li,Li.current),U)break;return null;case 22:case 23:return M.lanes=0,Og(_,M,F);case 24:Qo(M,qi,_.memoizedState.cache)}return Ao(_,M,F)}function iu(_,M,F){if(_!==null)if(_.memoizedProps!==M.pendingProps)Cn=!0;else{if(!Jc(_,F)&&(M.flags&128)===0)return Cn=!1,Ah(_,M,F);Cn=(_.flags&131072)!==0}else Cn=!1,bi&&(M.flags&1048576)!==0&&de(M,wa,M.index);switch(M.lanes=0,M.tag){case 16:e:{_=M.pendingProps;var U=M.elementType,te=U._init;if(U=te(U._payload),M.type=U,typeof U=="function")Zo(U)?(_=po(U,_),M.tag=1,M=Qg(null,M,U,_,F)):(M.tag=0,M=zl(null,M,U,_,F));else{if(U!=null){if(te=U.$$typeof,te===nc){M.tag=11,M=Ll(null,M,U,_,F);break e}else if(te===Ga){M.tag=14,M=Pg(null,M,U,_,F);break e}}throw M=C(U)||U,Error(u(306,M,""))}}return M;case 0:return zl(_,M,M.type,M.pendingProps,F);case 1:return U=M.type,te=po(U,M.pendingProps),Qg(_,M,U,te,F);case 3:e:{if(Ae(M,M.stateNode.containerInfo),_===null)throw Error(u(387));var oe=M.pendingProps;te=M.memoizedState,U=te.element,ct(_,M),_e(M,oe,null,F);var pe=M.memoizedState;if(oe=pe.cache,Qo(M,qi,oe),oe!==te.cache&&Vr(M,[qi],F,!0),Ee(),oe=pe.element,gs&&te.isDehydrated)if(te={element:oe,isDehydrated:!1,cache:pe.cache},M.updateQueue.baseState=te,M.memoizedState=te,M.flags&256){M=jg(_,M,oe,F);break e}else if(oe!==U){U=xe(Error(u(424)),M),Oe(U),M=jg(_,M,oe,F);break e}else for(gs&&(wi=Dr(M.stateNode.containerInfo),on=M,bi=!0,xs=null,Ps=!0),F=co(M,null,oe,F),M.child=F;F;)F.flags=F.flags&-3|4096,F=F.sibling;else{if(Qe(),oe===U){M=Ao(_,M,F);break e}Rn(_,M,oe,F)}M=M.child}return M;case 26:if(ps)return Qa(_,M),_===null?(F=pg(M.type,null,M.pendingProps,null))?M.memoizedState=F:bi||(M.stateNode=yg(M.type,M.pendingProps,Yo.current,M)):M.memoizedState=pg(M.type,_.memoizedProps,M.pendingProps,_.memoizedState),null;case 27:if(Xn)return Te(M),_===null&&Xn&&bi&&(U=M.stateNode=Cc(M.type,M.pendingProps,Yo.current,sn.current,!1),on=M,Ps=!0,wi=Wo(U)),U=M.pendingProps.children,_!==null||bi?Rn(_,M,U,F):M.child=Gr(M,null,U,F),Qa(_,M),M.child;case 5:return _===null&&bi&&(Du(M.type,M.pendingProps,sn.current),(te=U=wi)&&(U=Cg(U,M.type,M.pendingProps,Ps),U!==null?(M.stateNode=U,on=M,wi=Wo(U),Ps=!1,te=!0):te=!1),te||We(M)),Te(M),te=M.type,oe=M.pendingProps,pe=_!==null?_.memoizedProps:null,U=oe.children,Mn(te,oe)?U=null:pe!==null&&Mn(te,pe)&&(M.flags|=32),M.memoizedState!==null&&(te=Oo(_,M,Wl,null,null,F),zs?Vo._currentValue=te:Vo._currentValue2=te),Qa(_,M),Rn(_,M,U,F),M.child;case 6:return _===null&&bi&&(Zh(M.pendingProps,sn.current),(_=F=wi)&&(F=Lu(F,M.pendingProps,Ps),F!==null?(M.stateNode=F,on=M,wi=null,_=!0):_=!1),_||We(M)),null;case 13:return qg(_,M,F);case 4:return Ae(M,M.stateNode.containerInfo),U=M.pendingProps,_===null?M.child=Gr(M,null,U,F):Rn(_,M,U,F),M.child;case 11:return Ll(_,M,M.type,M.pendingProps,F);case 7:return Rn(_,M,M.pendingProps,F),M.child;case 8:return Rn(_,M,M.pendingProps.children,F),M.child;case 12:return Rn(_,M,M.pendingProps.children,F),M.child;case 10:return U=M.pendingProps,Qo(M,M.type,U.value),Rn(_,M,U.children,F),M.child;case 9:return te=M.type._context,U=M.pendingProps.children,jo(M),te=_n(te),U=U(te),M.flags|=1,Rn(_,M,U,F),M.child;case 14:return Pg(_,M,M.type,M.pendingProps,F);case 15:return Dg(_,M,M.type,M.pendingProps,F);case 19:return tu(_,M,F);case 22:return Og(_,M,F);case 24:return jo(M),U=_n(qi),_===null?(te=Lc(),te===null&&(te=Ni,oe=qo(),te.pooledCache=oe,oe.refCount++,oe!==null&&(te.pooledCacheLanes|=F),te=oe),M.memoizedState={parent:U,cache:te},De(M),Qo(M,qi,te)):((_.lanes&F)!==0&&(ct(_,M),_e(M,null,null,F),Ee()),te=_.memoizedState,oe=M.memoizedState,te.parent!==U?(te={parent:U,cache:U},M.memoizedState=te,M.lanes===0&&(M.memoizedState=M.updateQueue.baseState=te),Qo(M,qi,U)):(U=oe.cache,Qo(M,qi,U),U!==te.cache&&Vr(M,[qi],F,!0))),Rn(_,M,M.pendingProps.children,F),M.child;case 29:throw M.pendingProps}throw Error(u(156,M.tag))}function Qo(_,M,F){zs?(L(_s,M._currentValue),M._currentValue=F):(L(_s,M._currentValue2),M._currentValue2=F)}function mo(_){var M=_s.current;zs?_._currentValue=M:_._currentValue2=M,T(_s)}function qa(_,M,F){for(;_!==null;){var U=_.alternate;if((_.childLanes&M)!==M?(_.childLanes|=M,U!==null&&(U.childLanes|=M)):U!==null&&(U.childLanes&M)!==M&&(U.childLanes|=M),_===F)break;_=_.return}}function Vr(_,M,F,U){var te=_.child;for(te!==null&&(te.return=_);te!==null;){var oe=te.dependencies;if(oe!==null){var pe=te.child;oe=oe.firstContext;e:for(;oe!==null;){var we=oe;oe=te;for(var Ke=0;Ke<M.length;Ke++)if(we.context===M[Ke]){oe.lanes|=F,we=oe.alternate,we!==null&&(we.lanes|=F),qa(oe.return,F,_),U||(pe=null);break e}oe=we.next}}else if(te.tag===18){if(pe=te.return,pe===null)throw Error(u(341));pe.lanes|=F,oe=pe.alternate,oe!==null&&(oe.lanes|=F),qa(pe,F,_),pe=null}else pe=te.child;if(pe!==null)pe.return=te;else for(pe=te;pe!==null;){if(pe===_){pe=null;break}if(te=pe.sibling,te!==null){te.return=pe.return,pe=te;break}pe=pe.return}te=pe}}function el(_,M,F,U){_=null;for(var te=M,oe=!1;te!==null;){if(!oe){if((te.flags&524288)!==0)oe=!0;else if((te.flags&262144)!==0)break}if(te.tag===10){var pe=te.alternate;if(pe===null)throw Error(u(387));if(pe=pe.memoizedProps,pe!==null){var we=te.type;$n(te.pendingProps.value,pe.value)||(_!==null?_.push(we):_=[we])}}else if(te===Sl.current){if(pe=te.alternate,pe===null)throw Error(u(387));pe.memoizedState.memoizedState!==te.memoizedState.memoizedState&&(_!==null?_.push(Vo):_=[Vo])}te=te.return}_!==null&&Vr(M,_,F,U),M.flags|=262144}function tl(_){for(_=_.firstContext;_!==null;){var M=_.context;if(!$n(zs?M._currentValue:M._currentValue2,_.memoizedValue))return!0;_=_.next}return!1}function jo(_){Zr=_,ws=null,_=_.dependencies,_!==null&&(_.firstContext=null)}function _n(_){return Hc(Zr,_)}function il(_,M){return Zr===null&&jo(_),Hc(_,M)}function Hc(_,M){var F=zs?M._currentValue:M._currentValue2;if(M={context:M,memoizedValue:F,next:null},ws===null){if(_===null)throw Error(u(308));ws=M,_.dependencies={lanes:0,firstContext:M},_.flags|=524288}else ws=ws.next=M;return F}function qo(){return{controller:new _l,data:new Map,refCount:0}}function nl(_){_.refCount--,_.refCount===0&&$i(Rh,function(){_.controller.abort()})}function Lc(){var _=qr.current;return _!==null?_:Ni.pooledCache}function Kl(_,M){M===null?L(qr,qr.current):L(qr,M.pool)}function zc(){var _=Lc();return _===null?null:{parent:zs?qi._currentValue:qi._currentValue2,pool:_}}function ss(_){_.flags|=4}function da(_,M){if(_!==null&&_.child===M.child)return!1;if((M.flags&16)!==0)return!0;for(_=M.child;_!==null;){if((_.flags&13878)!==0||(_.subtreeFlags&13878)!==0)return!0;_=_.sibling}return!1}function Wr(_,M,F,U){if(Di)for(F=M.child;F!==null;){if(F.tag===5||F.tag===6)bl(_,F.stateNode);else if(!(F.tag===4||Xn&&F.tag===27)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===M)break;for(;F.sibling===null;){if(F.return===null||F.return===M)return;F=F.return}F.sibling.return=F.return,F=F.sibling}else if(Fs)for(var te=M.child;te!==null;){if(te.tag===5){var oe=te.stateNode;F&&U&&(oe=Tu(oe,te.type,te.memoizedProps)),bl(_,oe)}else if(te.tag===6)oe=te.stateNode,F&&U&&(oe=hg(oe,te.memoizedProps)),bl(_,oe);else if(te.tag!==4){if(te.tag===22&&te.memoizedState!==null)oe=te.child,oe!==null&&(oe.return=te),Wr(_,te,!0,!0);else if(te.child!==null){te.child.return=te,te=te.child;continue}}if(te===M)break;for(;te.sibling===null;){if(te.return===null||te.return===M)return;te=te.return}te.sibling.return=te.return,te=te.sibling}}function nu(_,M,F,U){if(Fs)for(var te=M.child;te!==null;){if(te.tag===5){var oe=te.stateNode;F&&U&&(oe=Tu(oe,te.type,te.memoizedProps)),ug(_,oe)}else if(te.tag===6)oe=te.stateNode,F&&U&&(oe=hg(oe,te.memoizedProps)),ug(_,oe);else if(te.tag!==4){if(te.tag===22&&te.memoizedState!==null)oe=te.child,oe!==null&&(oe.return=te),nu(_,te,!(te.memoizedProps!==null&&te.memoizedProps.mode==="manual"),!0);else if(te.child!==null){te.child.return=te,te=te.child;continue}}if(te===M)break;for(;te.sibling===null;){if(te.return===null||te.return===M)return;te=te.return}te.sibling.return=te.return,te=te.sibling}}function sl(_,M){if(Fs&&da(_,M)){_=M.stateNode;var F=_.containerInfo,U=gc();nu(U,M,!1,!1),_.pendingChildren=U,ss(M),Eu(F,U)}}function kl(_,M,F,U){if(Di)_.memoizedProps!==U&&ss(M);else if(Fs){var te=_.stateNode,oe=_.memoizedProps;if((_=da(_,M))||oe!==U){var pe=sn.current;oe=Wu(te,F,oe,U,!_,null),oe===te?M.stateNode=te:(sc(oe,F,U,pe)&&ss(M),M.stateNode=oe,_?Wr(oe,M,!1,!1):ss(M))}else M.stateNode=te}}function Pl(_,M,F){if(og(M,F)){if(_.flags|=16777216,!rg(M,F))if(Sn())_.flags|=8192;else throw Ln=Qn,xl}else _.flags&=-16777217}function Dl(_,M){if($u(M)){if(_.flags|=16777216,!Gg(M))if(Sn())_.flags|=8192;else throw Ln=Qn,xl}else _.flags&=-16777217}function Ca(_,M){M!==null&&(_.flags|=4),_.flags&16384&&(M=_.tag!==22?ee():536870912,_.lanes|=M,fn|=M)}function Ia(_,M){if(!bi)switch(_.tailMode){case"hidden":M=_.tail;for(var F=null;M!==null;)M.alternate!==null&&(F=M),M=M.sibling;F===null?_.tail=null:F.sibling=null;break;case"collapsed":F=_.tail;for(var U=null;F!==null;)F.alternate!==null&&(U=F),F=F.sibling;U===null?M||_.tail===null?_.tail=null:_.tail.sibling=null:U.sibling=null}}function Pi(_){var M=_.alternate!==null&&_.alternate.child===_.child,F=0,U=0;if(M)for(var te=_.child;te!==null;)F|=te.lanes|te.childLanes,U|=te.subtreeFlags&31457280,U|=te.flags&31457280,te.return=_,te=te.sibling;else for(te=_.child;te!==null;)F|=te.lanes|te.childLanes,U|=te.subtreeFlags,U|=te.flags,te.return=_,te=te.sibling;return _.subtreeFlags|=U,_.childLanes=F,M}function su(_,M,F){var U=M.pendingProps;switch(le(M),M.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pi(M),null;case 1:return Pi(M),null;case 3:return F=M.stateNode,U=null,_!==null&&(U=_.memoizedState.cache),M.memoizedState.cache!==U&&(M.flags|=2048),mo(qi),Xe(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(_===null||_.child===null)&&(Rt(M)?ss(M):_===null||_.memoizedState.isDehydrated&&(M.flags&256)===0||(M.flags|=1024,xs!==null&&(So(xs),xs=null))),sl(_,M),Pi(M),null;case 26:if(ps){F=M.type;var te=M.memoizedState;return _===null?(ss(M),te!==null?(Pi(M),Dl(M,te)):(Pi(M),Pl(M,F,U))):te?te!==_.memoizedState?(ss(M),Pi(M),Dl(M,te)):(Pi(M),M.flags&=-16777217):(Di?_.memoizedProps!==U&&ss(M):kl(_,M,F,U),Pi(M),Pl(M,F,U)),null}case 27:if(Xn){if(Ne(M),F=Yo.current,te=M.type,_!==null&&M.stateNode!=null)Di?_.memoizedProps!==U&&ss(M):kl(_,M,te,U);else{if(!U){if(M.stateNode===null)throw Error(u(166));return Pi(M),null}_=sn.current,Rt(M)?dt(M,_):(_=Cc(te,U,F,_,!0),M.stateNode=_,ss(M))}return Pi(M),null}case 5:if(Ne(M),F=M.type,_!==null&&M.stateNode!=null)kl(_,M,F,U);else{if(!U){if(M.stateNode===null)throw Error(u(166));return Pi(M),null}_=sn.current,Rt(M)?dt(M,_):(te=sg(F,U,Yo.current,_,M),Wr(te,M,!1,!1),M.stateNode=te,sc(te,F,U,_)&&ss(M))}return Pi(M),Pl(M,M.type,M.pendingProps),null;case 6:if(_&&M.stateNode!=null)F=_.memoizedProps,Di?F!==U&&ss(M):Fs&&(F!==U?(M.stateNode=tn(U,Yo.current,sn.current,M),ss(M)):M.stateNode=_.stateNode);else{if(typeof U!="string"&&M.stateNode===null)throw Error(u(166));if(_=Yo.current,F=sn.current,Rt(M)){if(!gs)throw Error(u(176));if(_=M.stateNode,F=M.memoizedProps,U=null,te=on,te!==null)switch(te.tag){case 27:case 5:U=te.memoizedProps}hc(_,F,M,U)||We(M)}else M.stateNode=tn(U,_,F,M)}return Pi(M),null;case 13:if(U=M.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(te=Rt(M),U!==null&&U.dehydrated!==null){if(_===null){if(!te)throw Error(u(318));if(!gs)throw Error(u(344));if(te=M.memoizedState,te=te!==null?te.dehydrated:null,!te)throw Error(u(317));Fu(te,M)}else Qe(),(M.flags&128)===0&&(M.memoizedState=null),M.flags|=4;Pi(M),te=!1}else xs!==null&&(So(xs),xs=null),te=!0;if(!te)return M.flags&256?(Yi(M),M):(Yi(M),null)}if(Yi(M),(M.flags&128)!==0)return M.lanes=F,M;if(F=U!==null,_=_!==null&&_.memoizedState!==null,F){U=M.child,te=null,U.alternate!==null&&U.alternate.memoizedState!==null&&U.alternate.memoizedState.cachePool!==null&&(te=U.alternate.memoizedState.cachePool.pool);var oe=null;U.memoizedState!==null&&U.memoizedState.cachePool!==null&&(oe=U.memoizedState.cachePool.pool),oe!==te&&(U.flags|=2048)}return F!==_&&F&&(M.child.flags|=8192),Ca(M,M.updateQueue),Pi(M),null;case 4:return Xe(),sl(_,M),_===null&&Cu(M.stateNode.containerInfo),Pi(M),null;case 10:return mo(M.type),Pi(M),null;case 19:if(T(Li),te=M.memoizedState,te===null)return Pi(M),null;if(U=(M.flags&128)!==0,oe=te.rendering,oe===null)if(U)Ia(te,!1);else{if(Ui!==0||_!==null&&(_.flags&128)!==0)for(_=M.child;_!==null;){if(oe=Ti(_),oe!==null){for(M.flags|=128,Ia(te,!1),_=oe.updateQueue,M.updateQueue=_,Ca(M,_),M.subtreeFlags=0,_=F,F=M.child;F!==null;)Lr(F,_),F=F.sibling;return L(Li,Li.current&1|2),M.child}_=_.sibling}te.tail!==null&&As()>Gs&&(M.flags|=128,U=!0,Ia(te,!1),M.lanes=4194304)}else{if(!U)if(_=Ti(oe),_!==null){if(M.flags|=128,U=!0,_=_.updateQueue,M.updateQueue=_,Ca(M,_),Ia(te,!0),te.tail===null&&te.tailMode==="hidden"&&!oe.alternate&&!bi)return Pi(M),null}else 2*As()-te.renderingStartTime>Gs&&F!==536870912&&(M.flags|=128,U=!0,Ia(te,!1),M.lanes=4194304);te.isBackwards?(oe.sibling=M.child,M.child=oe):(_=te.last,_!==null?_.sibling=oe:M.child=oe,te.last=oe)}return te.tail!==null?(M=te.tail,te.rendering=M,te.tail=M.sibling,te.renderingStartTime=As(),M.sibling=null,_=Li.current,L(Li,U?_&1|2:_&1),M):(Pi(M),null);case 22:case 23:return Yi(M),An(),U=M.memoizedState!==null,_!==null?_.memoizedState!==null!==U&&(M.flags|=8192):U&&(M.flags|=8192),U?(F&536870912)!==0&&(M.flags&128)===0&&(Pi(M),M.subtreeFlags&6&&(M.flags|=8192)):Pi(M),F=M.updateQueue,F!==null&&Ca(M,F.retryQueue),F=null,_!==null&&_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(F=_.memoizedState.cachePool.pool),U=null,M.memoizedState!==null&&M.memoizedState.cachePool!==null&&(U=M.memoizedState.cachePool.pool),U!==F&&(M.flags|=2048),_!==null&&T(qr),null;case 24:return F=null,_!==null&&(F=_.memoizedState.cache),M.memoizedState.cache!==F&&(M.flags|=2048),mo(qi),Pi(M),null;case 25:return null}throw Error(u(156,M.tag))}function mh(_,M){switch(le(M),M.tag){case 1:return _=M.flags,_&65536?(M.flags=_&-65537|128,M):null;case 3:return mo(qi),Xe(),_=M.flags,(_&65536)!==0&&(_&128)===0?(M.flags=_&-65537|128,M):null;case 26:case 27:case 5:return Ne(M),null;case 13:if(Yi(M),_=M.memoizedState,_!==null&&_.dehydrated!==null){if(M.alternate===null)throw Error(u(340));Qe()}return _=M.flags,_&65536?(M.flags=_&-65537|128,M):null;case 19:return T(Li),null;case 4:return Xe(),null;case 10:return mo(M.type),null;case 22:case 23:return Yi(M),An(),_!==null&&T(qr),_=M.flags,_&65536?(M.flags=_&-65537|128,M):null;case 24:return mo(qi),null;case 25:return null;default:return null}}function ou(_,M){switch(le(M),M.tag){case 3:mo(qi),Xe();break;case 26:case 27:case 5:Ne(M);break;case 4:Xe();break;case 13:Yi(M);break;case 19:T(Li);break;case 10:mo(M.type);break;case 22:case 23:Yi(M),An(),_!==null&&T(qr);break;case 24:mo(qi)}}function ol(_,M){try{var F=M.updateQueue,U=F!==null?F.lastEffect:null;if(U!==null){var te=U.next;F=te;do{if((F.tag&_)===_){U=void 0;var oe=F.create,pe=F.inst;U=oe(),pe.destroy=U}F=F.next}while(F!==te)}}catch(we){Si(M,M.return,we)}}function er(_,M,F){try{var U=M.updateQueue,te=U!==null?U.lastEffect:null;if(te!==null){var oe=te.next;U=oe;do{if((U.tag&_)===_){var pe=U.inst,we=pe.destroy;if(we!==void 0){pe.destroy=void 0,te=M;var Ke=F;try{we()}catch(gt){Si(te,Ke,gt)}}}U=U.next}while(U!==oe)}}catch(gt){Si(M,M.return,gt)}}function ru(_){var M=_.updateQueue;if(M!==null){var F=_.stateNode;try{Bt(M,F)}catch(U){Si(_,_.return,U)}}}function os(_,M,F){F.props=po(_.type,_.memoizedProps),F.state=_.memoizedState;try{F.componentWillUnmount()}catch(U){Si(_,M,U)}}function Ls(_,M){try{var F=_.ref;if(F!==null){var U=_.stateNode;switch(_.tag){case 26:case 27:case 5:var te=Kr(U);break;default:te=U}typeof F=="function"?_.refCleanup=F(te):F.current=te}}catch(oe){Si(_,M,oe)}}function rs(_,M){var F=_.ref,U=_.refCleanup;if(F!==null)if(typeof U=="function")try{U()}catch(te){Si(_,M,te)}finally{_.refCleanup=null,_=_.alternate,_!=null&&(_.refCleanup=null)}else if(typeof F=="function")try{F(null)}catch(te){Si(_,M,te)}else F.current=null}function Fc(_){var M=_.type,F=_.memoizedProps,U=_.stateNode;try{Zu(U,M,F,_)}catch(te){Si(_,_.return,te)}}function Kc(_,M,F){try{xu(_.stateNode,_.type,F,M,_)}catch(U){Si(_,_.return,U)}}function kc(_){return _.tag===5||_.tag===3||(ps?_.tag===26:!1)||(Xn?_.tag===27:!1)||_.tag===4}function rl(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||kc(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&(!Xn||_.tag!==27)&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function Pc(_,M,F){var U=_.tag;if(U===5||U===6)_=_.stateNode,M?cg(F,_,M):lg(F,_);else if(!(U===4||Xn&&U===27)&&(_=_.child,_!==null))for(Pc(_,M,F),_=_.sibling;_!==null;)Pc(_,M,F),_=_.sibling}function Ol(_,M,F){var U=_.tag;if(U===5||U===6)_=_.stateNode,M?Ru(F,_,M):Su(F,_);else if(!(U===4||Xn&&U===27)&&(_=_.child,_!==null))for(Ol(_,M,F),_=_.sibling;_!==null;)Ol(_,M,F),_=_.sibling}function Er(_,M,F){_=_.containerInfo;try{Yu(_,F)}catch(U){Si(M,M.return,U)}}function Dc(_,M){for(du(_.containerInfo),kt=M;kt!==null;)if(_=kt,M=_.child,(_.subtreeFlags&1028)!==0&&M!==null)M.return=_,kt=M;else for(;kt!==null;){_=kt;var F=_.alternate;switch(M=_.flags,_.tag){case 0:break;case 11:case 15:break;case 1:if((M&1024)!==0&&F!==null){M=void 0;var U=_,te=F.memoizedProps;F=F.memoizedState;var oe=U.stateNode;try{var pe=po(U.type,te,U.elementType===U.type);M=oe.getSnapshotBeforeUpdate(pe,F),oe.__reactInternalSnapshotBeforeUpdate=M}catch(we){Si(U,U.return,we)}}break;case 3:(M&1024)!==0&&Di&&Vu(_.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((M&1024)!==0)throw Error(u(163))}if(M=_.sibling,M!==null){M.return=_.return,kt=M;break}kt=_.return}return pe=Wi,Wi=!1,pe}function fa(_,M,F){var U=F.flags;switch(F.tag){case 0:case 11:case 15:yo(_,F),U&4&&ol(5,F);break;case 1:if(yo(_,F),U&4)if(_=F.stateNode,M===null)try{_.componentDidMount()}catch(we){Si(F,F.return,we)}else{var te=po(F.type,M.memoizedProps);M=M.memoizedState;try{_.componentDidUpdate(te,M,_.__reactInternalSnapshotBeforeUpdate)}catch(we){Si(F,F.return,we)}}U&64&&ru(F),U&512&&Ls(F,F.return);break;case 3:if(yo(_,F),U&64&&(U=F.updateQueue,U!==null)){if(_=null,F.child!==null)switch(F.child.tag){case 27:case 5:_=Kr(F.child.stateNode);break;case 1:_=F.child.stateNode}try{Bt(U,_)}catch(we){Si(F,F.return,we)}}break;case 26:if(ps){yo(_,F),U&512&&Ls(F,F.return);break}case 27:case 5:yo(_,F),M===null&&U&4&&Fc(F),U&512&&Ls(F,F.return);break;case 12:yo(_,F);break;case 13:yo(_,F),U&4&&Yr(_,F);break;case 22:if(te=F.memoizedState!==null||Fo,!te){M=M!==null&&M.memoizedState!==null||ei;var oe=Fo,pe=ei;Fo=te,(ei=M)&&!pe?tr(_,F,(F.subtreeFlags&8772)!==0):yo(_,F),Fo=oe,ei=pe}U&512&&(F.memoizedProps.mode==="manual"?Ls(F,F.return):rs(F,F.return));break;default:yo(_,F)}}function Ul(_){var M=_.alternate;M!==null&&(_.alternate=null,Ul(M)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(M=_.stateNode,M!==null&&pu(M)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function vs(_,M,F){for(F=F.child;F!==null;)bo(_,M,F),F=F.sibling}function bo(_,M,F){if(dn&&typeof dn.onCommitFiberUnmount=="function")try{dn.onCommitFiberUnmount(_a,F)}catch{}switch(F.tag){case 26:if(ps){ei||rs(F,M),vs(_,M,F),F.memoizedState?mg(F.memoizedState):F.stateNode&&Za(F.stateNode);break}case 27:if(Xn){ei||rs(F,M);var U=vi,te=ln;vi=F.stateNode,vs(_,M,F),Sg(F.stateNode),vi=U,ln=te;break}case 5:ei||rs(F,M);case 6:if(Di){if(U=vi,te=ln,vi=null,vs(_,M,F),vi=U,ln=te,vi!==null)if(ln)try{wu(vi,F.stateNode)}catch(oe){Si(F,M,oe)}else try{_u(vi,F.stateNode)}catch(oe){Si(F,M,oe)}}else vs(_,M,F);break;case 18:Di&&vi!==null&&(ln?Ig(vi,F.stateNode):Pu(vi,F.stateNode));break;case 4:Di?(U=vi,te=ln,vi=F.stateNode.containerInfo,ln=!0,vs(_,M,F),vi=U,ln=te):(Fs&&Er(F.stateNode,F,gc()),vs(_,M,F));break;case 0:case 11:case 14:case 15:ei||er(2,F,M),ei||er(4,F,M),vs(_,M,F);break;case 1:ei||(rs(F,M),U=F.stateNode,typeof U.componentWillUnmount=="function"&&os(F,M,U)),vs(_,M,F);break;case 21:vs(_,M,F);break;case 22:ei||rs(F,M),ei=(U=ei)||F.memoizedState!==null,vs(_,M,F),ei=U;break;default:vs(_,M,F)}}function Yr(_,M){if(gs&&M.memoizedState===null&&(_=M.alternate,_!==null&&(_=_.memoizedState,_!==null&&(_=_.dehydrated,_!==null))))try{dc(_)}catch(F){Si(M,M.return,F)}}function Oc(_){switch(_.tag){case 13:case 19:var M=_.stateNode;return M===null&&(M=_.stateNode=new ai),M;case 22:return _=_.stateNode,M=_._retryCache,M===null&&(M=_._retryCache=new ai),M;default:throw Error(u(435,_.tag))}}function $l(_,M){var F=Oc(_);M.forEach(function(U){var te=tc.bind(null,_,U);F.has(U)||(F.add(U),U.then(te,te))})}function gn(_,M){var F=M.deletions;if(F!==null)for(var U=0;U<F.length;U++){var te=F[U],oe=_,pe=M;if(Di){var we=pe;e:for(;we!==null;){switch(we.tag){case 27:case 5:vi=we.stateNode,ln=!1;break e;case 3:vi=we.stateNode.containerInfo,ln=!0;break e;case 4:vi=we.stateNode.containerInfo,ln=!0;break e}we=we.return}if(vi===null)throw Error(u(160));bo(oe,pe,te),vi=null,ln=!1}else bo(oe,pe,te);oe=te.alternate,oe!==null&&(oe.return=null),te.return=null}if(M.subtreeFlags&13878)for(M=M.child;M!==null;)Uc(M,_),M=M.sibling}function Uc(_,M){var F=_.alternate,U=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:gn(M,_),as(_),U&4&&(er(3,_,_.return),ol(3,_),er(5,_,_.return));break;case 1:gn(M,_),as(_),U&512&&(ei||F===null||rs(F,F.return)),U&64&&Fo&&(_=_.updateQueue,_!==null&&(U=_.callbacks,U!==null&&(F=_.shared.hiddenCallbacks,_.shared.hiddenCallbacks=F===null?U:F.concat(U))));break;case 26:if(ps){var te=Fn;gn(M,_),as(_),U&512&&(ei||F===null||rs(F,F.return)),U&4&&(U=F!==null?F.memoizedState:null,M=_.memoizedState,F===null?M===null?_.stateNode===null?_.stateNode=Ou(te,_.type,_.memoizedProps,_):bg(te,_.type,_.stateNode):_.stateNode=Ag(te,M,_.memoizedProps):U!==M?(U===null?F.stateNode!==null&&Za(F.stateNode):mg(U),M===null?bg(te,_.type,_.stateNode):Ag(te,M,_.memoizedProps)):M===null&&_.stateNode!==null&&Kc(_,_.memoizedProps,F.memoizedProps));break}case 27:if(Xn&&U&4&&_.alternate===null){te=_.stateNode;var oe=_.memoizedProps;try{Qu(te),Bg(_.type,oe,te,_)}catch(xt){Si(_,_.return,xt)}}case 5:if(gn(M,_),as(_),U&512&&(ei||F===null||rs(F,F.return)),Di){if(_.flags&32){M=_.stateNode;try{cc(M)}catch(xt){Si(_,_.return,xt)}}U&4&&_.stateNode!=null&&(M=_.memoizedProps,Kc(_,M,F!==null?F.memoizedProps:M)),U&1024&&(Mi=!0)}break;case 6:if(gn(M,_),as(_),U&4&&Di){if(_.stateNode===null)throw Error(u(162));U=_.memoizedProps,F=F!==null?F.memoizedProps:U,M=_.stateNode;try{Xu(M,F,U)}catch(xt){Si(_,_.return,xt)}}break;case 3:if(ps?(Uu(),te=Fn,Fn=yn(M.containerInfo),gn(M,_),Fn=te):gn(M,_),as(_),U&4){if(Di&&gs&&F!==null&&F.memoizedState.isDehydrated)try{ku(M.containerInfo)}catch(xt){Si(_,_.return,xt)}if(Fs){U=M.containerInfo,F=M.pendingChildren;try{Yu(U,F)}catch(xt){Si(_,_.return,xt)}}}Mi&&(Mi=!1,$c(_));break;case 4:ps?(F=Fn,Fn=yn(_.stateNode.containerInfo),gn(M,_),as(_),Fn=F):(gn(M,_),as(_)),U&4&&Fs&&Er(_.stateNode,_,_.stateNode.pendingChildren);break;case 12:gn(M,_),as(_);break;case 13:gn(M,_),as(_),_.child.flags&8192&&_.memoizedState!==null!=(F!==null&&F.memoizedState!==null)&&(_g=As()),U&4&&(U=_.updateQueue,U!==null&&(_.updateQueue=null,$l(_,U)));break;case 22:U&512&&(ei||F===null||rs(F,F.return)),te=_.memoizedState!==null;var pe=F!==null&&F.memoizedState!==null,we=Fo,Ke=ei;if(Fo=we||te,ei=Ke||pe,gn(M,_),ei=Ke,Fo=we,as(_),M=_.stateNode,M._current=_,M._visibility&=-3,M._visibility|=M._pendingVisibility&2,U&8192&&(M._visibility=te?M._visibility&-2:M._visibility|1,te&&(M=Fo||ei,F===null||pe||M||pa(_)),Di&&(_.memoizedProps===null||_.memoizedProps.mode!=="manual"))){e:if(F=null,Di)for(M=_;;){if(M.tag===5||ps&&M.tag===26||Xn&&M.tag===27){if(F===null){pe=F=M;try{oe=pe.stateNode,te?Mu(oe):Xh(pe.stateNode,pe.memoizedProps)}catch(xt){Si(pe,pe.return,xt)}}}else if(M.tag===6){if(F===null){pe=M;try{var gt=pe.stateNode;te?Nu(gt):gg(gt,pe.memoizedProps)}catch(xt){Si(pe,pe.return,xt)}}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===_)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===_)break e;for(;M.sibling===null;){if(M.return===null||M.return===_)break e;F===M&&(F=null),M=M.return}F===M&&(F=null),M.sibling.return=M.return,M=M.sibling}}U&4&&(U=_.updateQueue,U!==null&&(F=U.retryQueue,F!==null&&(U.retryQueue=null,$l(_,F))));break;case 19:gn(M,_),as(_),U&4&&(U=_.updateQueue,U!==null&&(_.updateQueue=null,$l(_,U)));break;case 21:break;default:gn(M,_),as(_)}}function as(_){var M=_.flags;if(M&2){try{if(Di&&(!Xn||_.tag!==27)){e:{for(var F=_.return;F!==null;){if(kc(F)){var U=F;break e}F=F.return}throw Error(u(160))}switch(U.tag){case 27:if(Xn){var te=U.stateNode,oe=rl(_);Ol(_,oe,te);break}case 5:var pe=U.stateNode;U.flags&32&&(cc(pe),U.flags&=-33);var we=rl(_);Ol(_,we,pe);break;case 3:case 4:var Ke=U.stateNode.containerInfo,gt=rl(_);Pc(_,gt,Ke);break;default:throw Error(u(161))}}}catch(xt){Si(_,_.return,xt)}_.flags&=-3}M&4096&&(_.flags&=-4097)}function $c(_){if(_.subtreeFlags&1024)for(_=_.child;_!==null;){var M=_;$c(M),M.tag===5&&M.flags&1024&&mu(M.stateNode),_=_.sibling}}function yo(_,M){if(M.subtreeFlags&8772)for(M=M.child;M!==null;)fa(_,M.alternate,M),M=M.sibling}function pa(_){for(_=_.child;_!==null;){var M=_;switch(M.tag){case 0:case 11:case 14:case 15:er(4,M,M.return),pa(M);break;case 1:rs(M,M.return);var F=M.stateNode;typeof F.componentWillUnmount=="function"&&os(M,M.return,F),pa(M);break;case 26:case 27:case 5:rs(M,M.return),pa(M);break;case 22:rs(M,M.return),M.memoizedState===null&&pa(M);break;default:pa(M)}_=_.sibling}}function tr(_,M,F){for(F=F&&(M.subtreeFlags&8772)!==0,M=M.child;M!==null;){var U=M.alternate,te=_,oe=M,pe=oe.flags;switch(oe.tag){case 0:case 11:case 15:tr(te,oe,F),ol(4,oe);break;case 1:if(tr(te,oe,F),U=oe,te=U.stateNode,typeof te.componentDidMount=="function")try{te.componentDidMount()}catch(gt){Si(U,U.return,gt)}if(U=oe,te=U.updateQueue,te!==null){var we=U.stateNode;try{var Ke=te.shared.hiddenCallbacks;if(Ke!==null)for(te.shared.hiddenCallbacks=null,te=0;te<Ke.length;te++)Me(Ke[te],we)}catch(gt){Si(U,U.return,gt)}}F&&pe&64&&ru(oe),Ls(oe,oe.return);break;case 26:case 27:case 5:tr(te,oe,F),F&&U===null&&pe&4&&Fc(oe),Ls(oe,oe.return);break;case 12:tr(te,oe,F);break;case 13:tr(te,oe,F),F&&pe&4&&Yr(te,oe);break;case 22:oe.memoizedState===null&&tr(te,oe,F),Ls(oe,oe.return);break;default:tr(te,oe,F)}M=M.sibling}}function Ql(_,M){var F=null;_!==null&&_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(F=_.memoizedState.cachePool.pool),_=null,M.memoizedState!==null&&M.memoizedState.cachePool!==null&&(_=M.memoizedState.cachePool.pool),_!==F&&(_!=null&&_.refCount++,F!=null&&nl(F))}function jl(_,M){_=null,M.alternate!==null&&(_=M.alternate.memoizedState.cache),M=M.memoizedState.cache,M!==_&&(M.refCount++,_!=null&&nl(_))}function Go(_,M,F,U){if(M.subtreeFlags&10256)for(M=M.child;M!==null;)Bs(_,M,F,U),M=M.sibling}function Bs(_,M,F,U){var te=M.flags;switch(M.tag){case 0:case 11:case 15:Go(_,M,F,U),te&2048&&ol(9,M);break;case 3:Go(_,M,F,U),te&2048&&(_=null,M.alternate!==null&&(_=M.alternate.memoizedState.cache),M=M.memoizedState.cache,M!==_&&(M.refCount++,_!=null&&nl(_)));break;case 12:if(te&2048){Go(_,M,F,U),_=M.stateNode;try{var oe=M.memoizedProps,pe=oe.id,we=oe.onPostCommit;typeof we=="function"&&we(pe,M.alternate===null?"mount":"update",_.passiveEffectDuration,-0)}catch(Ke){Si(M,M.return,Ke)}}else Go(_,M,F,U);break;case 23:break;case 22:oe=M.stateNode,M.memoizedState!==null?oe._visibility&4?Go(_,M,F,U):js(_,M):oe._visibility&4?Go(_,M,F,U):(oe._visibility|=4,wn(_,M,F,U,(M.subtreeFlags&10256)!==0)),te&2048&&Ql(M.alternate,M);break;case 24:Go(_,M,F,U),te&2048&&jl(M.alternate,M);break;default:Go(_,M,F,U)}}function wn(_,M,F,U,te){for(te=te&&(M.subtreeFlags&10256)!==0,M=M.child;M!==null;){var oe=_,pe=M,we=F,Ke=U,gt=pe.flags;switch(pe.tag){case 0:case 11:case 15:wn(oe,pe,we,Ke,te),ol(8,pe);break;case 23:break;case 22:var xt=pe.stateNode;pe.memoizedState!==null?xt._visibility&4?wn(oe,pe,we,Ke,te):js(oe,pe):(xt._visibility|=4,wn(oe,pe,we,Ke,te)),te&&gt&2048&&Ql(pe.alternate,pe);break;case 24:wn(oe,pe,we,Ke,te),te&&gt&2048&&jl(pe.alternate,pe);break;default:wn(oe,pe,we,Ke,te)}M=M.sibling}}function js(_,M){if(M.subtreeFlags&10256)for(M=M.child;M!==null;){var F=_,U=M,te=U.flags;switch(U.tag){case 22:js(F,U),te&2048&&Ql(U.alternate,U);break;case 24:js(F,U),te&2048&&jl(U.alternate,U);break;default:js(F,U)}M=M.sibling}}function vo(_){if(_.subtreeFlags&xr)for(_=_.child;_!==null;)al(_),_=_.sibling}function al(_){switch(_.tag){case 26:vo(_),_.flags&xr&&(_.memoizedState!==null?vg(Fn,_.memoizedState,_.memoizedProps):ag(_.type,_.memoizedProps));break;case 5:vo(_),_.flags&xr&&ag(_.type,_.memoizedProps);break;case 3:case 4:if(ps){var M=Fn;Fn=yn(_.stateNode.containerInfo),vo(_),Fn=M}else vo(_);break;case 22:_.memoizedState===null&&(M=_.alternate,M!==null&&M.memoizedState!==null?(M=xr,xr=16777216,vo(_),xr=M):vo(_));break;default:vo(_)}}function ll(_){var M=_.alternate;if(M!==null&&(_=M.child,_!==null)){M.child=null;do M=_.sibling,_.sibling=null,_=M;while(_!==null)}}function Tr(_){var M=_.deletions;if((_.flags&16)!==0){if(M!==null)for(var F=0;F<M.length;F++){var U=M[F];kt=U,gl(U,_)}ll(_)}if(_.subtreeFlags&10256)for(_=_.child;_!==null;)Bo(_),_=_.sibling}function Bo(_){switch(_.tag){case 0:case 11:case 15:Tr(_),_.flags&2048&&er(9,_,_.return);break;case 3:Tr(_);break;case 12:Tr(_);break;case 22:var M=_.stateNode;_.memoizedState!==null&&M._visibility&4&&(_.return===null||_.return.tag!==13)?(M._visibility&=-5,cl(_)):Tr(_);break;default:Tr(_)}}function cl(_){var M=_.deletions;if((_.flags&16)!==0){if(M!==null)for(var F=0;F<M.length;F++){var U=M[F];kt=U,gl(U,_)}ll(_)}for(_=_.child;_!==null;){switch(M=_,M.tag){case 0:case 11:case 15:er(8,M,M.return),cl(M);break;case 22:F=M.stateNode,F._visibility&4&&(F._visibility&=-5,cl(M));break;default:cl(M)}_=_.sibling}}function gl(_,M){for(;kt!==null;){var F=kt;switch(F.tag){case 0:case 11:case 15:er(8,F,M);break;case 23:case 22:if(F.memoizedState!==null&&F.memoizedState.cachePool!==null){var U=F.memoizedState.cachePool.pool;U!=null&&U.refCount++}break;case 24:nl(F.memoizedState.cache)}if(U=F.child,U!==null)U.return=F,kt=U;else e:for(F=_;kt!==null;){U=kt;var te=U.sibling,oe=U.return;if(Ul(U),U===F){kt=null;break e}if(te!==null){te.return=oe,kt=te;break e}kt=oe}}}function ir(_){var M=rc(_);if(M!=null){if(typeof M.memoizedProps["data-testname"]!="string")throw Error(u(364));return M}if(_=Gu(_),_===null)throw Error(u(362));return _.stateNode.current}function ql(_,M){var F=_.tag;switch(M.$$typeof){case ki:if(_.type===M.value)return!0;break;case $s:e:{for(M=M.value,_=[_,0],F=0;F<_.length;){var U=_[F++],te=U.tag,oe=_[F++],pe=M[oe];if(te!==5&&te!==26&&te!==27||!so(U)){for(;pe!=null&&ql(U,pe);)oe++,pe=M[oe];if(oe===M.length){M=!0;break e}else for(U=U.child;U!==null;)_.push(U,oe),U=U.sibling}}M=!1}return M;case go:if((F===5||F===26||F===27)&&Bu(_.stateNode,M.value))return!0;break;case qn:if((F===5||F===6||F===26||F===27)&&(_=vu(_),_!==null&&0<=_.indexOf(M.value)))return!0;break;case Ea:if((F===5||F===26||F===27)&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===M.value.toLowerCase()))return!0;break;default:throw Error(u(365))}return!1}function ls(_){switch(_.$$typeof){case ki:return"<"+(C(_.value)||"Unknown")+">";case $s:return":has("+(ls(_)||"")+")";case go:return'[role="'+_.value+'"]';case qn:return'"'+_.value+'"';case Ea:return'[data-testname="'+_.value+'"]';default:throw Error(u(365))}}function Jr(_,M){var F=[];_=[_,0];for(var U=0;U<_.length;){var te=_[U++],oe=te.tag,pe=_[U++],we=M[pe];if(oe!==5&&oe!==26&&oe!==27||!so(te)){for(;we!=null&&ql(te,we);)pe++,we=M[pe];if(pe===M.length)F.push(te);else for(te=te.child;te!==null;)_.push(te,pe),te=te.sibling}}return F}function nr(_,M){if(!Xa)throw Error(u(363));_=ir(_),_=Jr(_,M),M=[],_=Array.from(_);for(var F=0;F<_.length;){var U=_[F++],te=U.tag;if(te===5||te===26||te===27)so(U)||M.push(U.stateNode);else for(U=U.child;U!==null;)_.push(U),U=U.sibling}return M}function En(){if((ui&2)!==0&&hi!==0)return hi&-hi;if(Ut.T!==null){var _=Ki;return _!==0?_:ot()}return Iu()}function ul(){ys===0&&(ys=(hi&536870912)===0||bi?ne():536870912);var _=ds.current;return _!==null&&(_.flags|=32),ys}function Hi(_,M,F){(_===Ni&&_i===2||_.cancelPendingCommit!==null)&&(sr(_,0),On(_,hi,ys,!1)),re(_,F),((ui&2)===0||_!==Ni)&&(_===Ni&&((ui&2)===0&&(ko|=F),Ui===4&&On(_,hi,ys,!1)),Xt(_))}function Is(_,M,F){if((ui&6)!==0)throw Error(u(327));var U=!F&&(M&60)===0&&(M&_.expiredLanes)===0||$(_,M),te=U?au(_,M):dl(_,M,!0),oe=U;do{if(te===0){Ns&&!U&&On(_,M,0,!1);break}else if(te===6)On(_,M,0,!Ms);else{if(F=_.current.alternate,oe&&!Xo(F)){te=dl(_,M,!1),oe=!1;continue}if(te===2){if(oe=M,_.errorRecoveryDisabledLanes&oe)var pe=0;else pe=_.pendingLanes&-536870913,pe=pe!==0?pe:pe&536870912?536870912:0;if(pe!==0){M=pe;e:{var we=_;te=Ya;var Ke=gs&&we.current.memoizedState.isDehydrated;if(Ke&&(sr(we,pe).flags|=256),pe=dl(we,pe,!1),pe!==2){if(ea&&!Ke){we.errorRecoveryDisabledLanes|=oe,ko|=oe,te=4;break e}oe=Ws,Ws=te,oe!==null&&So(oe)}te=pe}if(oe=!1,te!==2)continue}}if(te===1){sr(_,0),On(_,M,0,!0);break}e:{switch(U=_,te){case 0:case 1:throw Error(u(345));case 4:if((M&4194176)===M){On(U,M,ys,!Ms);break e}break;case 2:Ws=null;break;case 3:case 5:break;default:throw Error(u(329))}if(U.finishedWork=F,U.finishedLanes=M,(M&62914560)===M&&(oe=_g+300-As(),10<oe)){if(On(U,M,ys,!Ms),P(U,0)!==0)break e;U.timeoutHandle=oc(qs.bind(null,U,F,Ws,ta,Bc,M,ys,ko,fn,Ms,2,-0,0),oe);break e}qs(U,F,Ws,ta,Bc,M,ys,ko,fn,Ms,0,-0,0)}}break}while(!0);Xt(_)}function So(_){Ws===null?Ws=_:Ws.push.apply(Ws,_)}function qs(_,M,F,U,te,oe,pe,we,Ke,gt,xt,Wt,St){var ti=M.subtreeFlags;if((ti&8192||(ti&16785408)===16785408)&&(Bh(),al(M),M=Au(),M!==null)){_.cancelPendingCommit=M(ec.bind(null,_,F,U,te,pe,we,Ke,1,Wt,St)),On(_,oe,pe,!gt);return}ec(_,F,U,te,pe,we,Ke,xt,Wt,St)}function Xo(_){for(var M=_;;){var F=M.tag;if((F===0||F===11||F===15)&&M.flags&16384&&(F=M.updateQueue,F!==null&&(F=F.stores,F!==null)))for(var U=0;U<F.length;U++){var te=F[U],oe=te.getSnapshot;te=te.value;try{if(!$n(oe(),te))return!1}catch{return!1}}if(F=M.child,M.subtreeFlags&16384&&F!==null)F.return=M,M=F;else{if(M===_)break;for(;M.sibling===null;){if(M.return===null||M.return===_)return!0;M=M.return}M.sibling.return=M.return,M=M.sibling}}return!0}function On(_,M,F,U){M&=~es,M&=~ko,_.suspendedLanes|=M,_.pingedLanes&=~M,U&&(_.warmLanes|=M),U=_.expirationTimes;for(var te=M;0<te;){var oe=31-nn(te),pe=1<<oe;U[oe]=-1,te&=~pe}F!==0&&ue(_,F,M)}function Qc(){return(ui&6)===0?(Ge(0),!1):!0}function hl(){if(ri!==null){if(_i===0)var _=ri.return;else _=ri,ws=Zr=null,Js(_),Qr=null,zn=0,_=ri;for(;_!==null;)ou(_.alternate,_),_=_.return;ri=null}}function sr(_,M){_.finishedWork=null,_.finishedLanes=0;var F=_.timeoutHandle;F!==Sa&&(_.timeoutHandle=Sa,yl(F)),F=_.cancelPendingCommit,F!==null&&(_.cancelPendingCommit=null,F()),hl(),Ni=_,ri=F=xo(_.current,null),hi=M,_i=0,In=null,Ms=!1,Ns=$(_,M),ea=!1,fn=ys=es=ko=Vs=Ui=0,Ws=Ya=null,Bc=!1,(M&8)!==0&&(M|=M&32);var U=_.entangledLanes;if(U!==0)for(_=_.entanglements,U&=M;0<U;){var te=31-nn(U),oe=1<<te;M|=_[te],U&=~oe}return Qs=M,be(),F}function Yn(_,M){qt=null,Ut.H=an,M===Zl?(M=Tt(),_i=3):M===xl?(M=Tt(),_i=4):_i=M===xg?8:M!==null&&typeof M=="object"&&typeof M.then=="function"?6:1,In=M,ri===null&&(Ui=1,ga(_,xe(M,_.current)))}function Sn(){var _=ds.current;return _===null?!0:(hi&4194176)===hi?Rs===null:(hi&62914560)===hi||(hi&536870912)!==0?_===Rs:!1}function mi(){var _=Ut.H;return Ut.H=an,_===null?an:_}function Ss(){var _=Ut.A;return Ut.A=Ko,_}function Xs(){Ui=4,Ms||(hi&4194176)!==hi&&ds.current!==null||(Ns=!0),(Vs&134217727)===0&&(ko&134217727)===0||Ni===null||On(Ni,hi,ys,!1)}function dl(_,M,F){var U=ui;ui|=2;var te=mi(),oe=Ss();(Ni!==_||hi!==M)&&(ta=null,sr(_,M)),M=!1;var pe=Ui;e:do try{if(_i!==0&&ri!==null){var we=ri,Ke=In;switch(_i){case 8:hl(),pe=6;break e;case 3:case 2:case 6:ds.current===null&&(M=!0);var gt=_i;if(_i=0,In=null,eo(_,we,Ke,gt),F&&Ns){pe=0;break e}break;default:gt=_i,_i=0,In=null,eo(_,we,Ke,gt)}}Hr(),pe=Ui;break}catch(xt){Yn(_,xt)}while(!0);return M&&_.shellSuspendCounter++,ws=Zr=null,ui=U,Ut.H=te,Ut.A=oe,ri===null&&(Ni=null,hi=0,be()),pe}function Hr(){for(;ri!==null;)Aa(ri)}function au(_,M){var F=ui;ui|=2;var U=mi(),te=Ss();Ni!==_||hi!==M?(ta=null,Gs=As()+500,sr(_,M)):Ns=$(_,M);e:do try{if(_i!==0&&ri!==null){M=ri;var oe=In;t:switch(_i){case 1:_i=0,In=null,eo(_,M,oe,1);break;case 2:if(at(oe)){_i=0,In=null,ma(M);break}M=function(){_i===2&&Ni===_&&(_i=7),Xt(_)},oe.then(M,M);break e;case 3:_i=7;break e;case 4:_i=5;break e;case 7:at(oe)?(_i=0,In=null,ma(M)):(_i=0,In=null,eo(_,M,oe,7));break;case 5:var pe=null;switch(ri.tag){case 26:pe=ri.memoizedState;case 5:case 27:var we=ri,Ke=we.type,gt=we.pendingProps;if(pe?Gg(pe):rg(Ke,gt)){_i=0,In=null;var xt=we.sibling;if(xt!==null)ri=xt;else{var Wt=we.return;Wt!==null?(ri=Wt,or(Wt)):ri=null}break t}}_i=0,In=null,eo(_,M,oe,5);break;case 6:_i=0,In=null,eo(_,M,oe,6);break;case 8:hl(),Ui=6;break e;default:throw Error(u(462))}}lu();break}catch(St){Yn(_,St)}while(!0);return ws=Zr=null,Ut.H=U,Ut.A=te,ui=F,ri!==null?0:(Ni=null,hi=0,be(),Ui)}function lu(){for(;ri!==null&&!mr();)Aa(ri)}function Aa(_){var M=iu(_.alternate,_,Qs);_.memoizedProps=_.pendingProps,M===null?or(_):ri=M}function ma(_){var M=_,F=M.alternate;switch(M.tag){case 15:case 0:M=$g(F,M,M.pendingProps,M.type,void 0,hi);break;case 11:M=$g(F,M,M.pendingProps,M.type.render,M.ref,hi);break;case 5:Js(M);default:ou(F,M),M=ri=Lr(M,Qs),M=iu(F,M,Qs)}_.memoizedProps=_.pendingProps,M===null?or(_):ri=M}function eo(_,M,F,U){ws=Zr=null,Js(M),Qr=null,zn=0;var te=M.return;try{if(ph(_,te,M,F,hi)){Ui=1,ga(_,xe(F,_.current)),ri=null;return}}catch(oe){if(te!==null)throw ri=te,oe;Ui=1,ga(_,xe(F,_.current)),ri=null;return}M.flags&32768?(bi||U===1?_=!0:Ns||(hi&536870912)!==0?_=!1:(Ms=_=!0,(U===2||U===3||U===6)&&(U=ds.current,U!==null&&U.tag===13&&(U.flags|=16384))),qc(M,_)):or(M)}function or(_){var M=_;do{if((M.flags&32768)!==0){qc(M,Ms);return}_=M.return;var F=su(M.alternate,M,Qs);if(F!==null){ri=F;return}if(M=M.sibling,M!==null){ri=M;return}ri=M=_}while(M!==null);Ui===0&&(Ui=5)}function qc(_,M){do{var F=mh(_.alternate,_);if(F!==null){F.flags&=32767,ri=F;return}if(F=_.return,F!==null&&(F.flags|=32768,F.subtreeFlags=0,F.deletions=null),!M&&(_=_.sibling,_!==null)){ri=_;return}ri=_=F}while(_!==null);Ui=6,ri=null}function ec(_,M,F,U,te,oe,pe,we,Ke,gt){var xt=Ut.T,Wt=fr();try{Un(2),Ut.T=null,cu(_,M,F,U,Wt,te,oe,pe,we,Ke,gt)}finally{Ut.T=xt,Un(Wt)}}function cu(_,M,F,U,te,oe,pe,we){do rr();while(Rr!==null);if((ui&6)!==0)throw Error(u(327));var Ke=_.finishedWork;if(U=_.finishedLanes,Ke===null)return null;if(_.finishedWork=null,_.finishedLanes=0,Ke===_.current)throw Error(u(177));_.callbackNode=null,_.callbackPriority=0,_.cancelPendingCommit=null;var gt=Ke.lanes|Ke.childLanes;if(gt|=Ds,ce(_,U,gt,oe,pe,we),_===Ni&&(ri=Ni=null,hi=0),(Ke.subtreeFlags&10256)===0&&(Ke.flags&10256)===0||Po||(Po=!0,Sc=gt,Ml=F,gu(Ra,function(){return rr(),null})),F=(Ke.flags&15990)!==0,(Ke.subtreeFlags&15990)!==0||F?(F=Ut.T,Ut.T=null,oe=fr(),Un(2),pe=ui,ui|=4,Dc(_,Ke),Uc(Ke,_),vh(_.containerInfo),_.current=Ke,fa(_,Ke.alternate,Ke),Eo(),ui=pe,Un(oe),Ut.T=F):_.current=Ke,Po?(Po=!1,Rr=_,Ta=U):Cl(_,gt),gt=_.pendingLanes,gt===0&&(ho=null),Ce(Ke.stateNode),Xt(_),M!==null)for(te=_.onRecoverableError,Ke=0;Ke<M.length;Ke++)gt=M[Ke],te(gt.value,{componentStack:gt.stack});return(Ta&3)!==0&&rr(),gt=_.pendingLanes,(U&4194218)!==0&&(gt&42)!==0?_===wg?ia++:(ia=0,wg=_):ia=0,Ge(0),null}function Cl(_,M){(_.pooledCacheLanes&=M)===0&&(M=_.pooledCache,M!=null&&(_.pooledCache=null,nl(M)))}function rr(){if(Rr!==null){var _=Rr,M=Sc;Sc=0;var F=Se(Ta),U=32>F?32:F;F=Ut.T;var te=fr();try{if(Un(U),Ut.T=null,Rr===null)var oe=!1;else{U=Ml,Ml=null;var pe=Rr,we=Ta;if(Rr=null,Ta=0,(ui&6)!==0)throw Error(u(331));var Ke=ui;if(ui|=4,Bo(pe.current),Bs(pe,pe.current,we,U),ui=Ke,Ge(0,!1),dn&&typeof dn.onPostCommitFiberRoot=="function")try{dn.onPostCommitFiberRoot(_a,pe)}catch{}oe=!0}return oe}finally{Un(te),Ut.T=F,Cl(_,M)}}return!1}function ba(_,M,F){M=xe(F,M),M=ha(_.stateNode,M,2),_=At(_,M,2),_!==null&&(re(_,2),Xt(_))}function Si(_,M,F){if(_.tag===3)ba(_,_,F);else for(;M!==null;){if(M.tag===3){ba(M,_,F);break}else if(M.tag===1){var U=M.stateNode;if(typeof M.type.getDerivedStateFromError=="function"||typeof U.componentDidCatch=="function"&&(ho===null||!ho.has(U))){_=xe(F,_),F=Vc(2),U=At(M,F,2),U!==null&&(kg(F,U,M,_),re(U,2),Xt(U));break}}M=M.return}}function ar(_,M,F){var U=_.pingCache;if(U===null){U=_.pingCache=new wl;var te=new Set;U.set(M,te)}else te=U.get(M),te===void 0&&(te=new Set,U.set(M,te));te.has(F)||(ea=!0,te.add(F),_=Il.bind(null,_,M,F),M.then(_,_))}function Il(_,M,F){var U=_.pingCache;U!==null&&U.delete(M),_.pingedLanes|=_.suspendedLanes&F,_.warmLanes&=~F,Ni===_&&(hi&F)===F&&(Ui===4||Ui===3&&(hi&62914560)===hi&&300>As()-_g?(ui&2)===0&&sr(_,0):es|=F,fn===hi&&(fn=0)),Xt(_)}function fl(_,M){M===0&&(M=ee()),_=Gt(_,M),_!==null&&(re(_,M),Xt(_))}function pl(_){var M=_.memoizedState,F=0;M!==null&&(F=M.retryLane),fl(_,F)}function tc(_,M){var F=0;switch(_.tag){case 13:var U=_.stateNode,te=_.memoizedState;te!==null&&(F=te.retryLane);break;case 19:U=_.stateNode;break;case 22:U=_.stateNode._retryCache;break;default:throw Error(u(314))}U!==null&&U.delete(M),fl(_,F)}function gu(_,M){return ro(_,M)}function uu(_,M,F,U){this.tag=_,this.key=F,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=M,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=U,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zo(_){return _=_.prototype,!(!_||!_.isReactComponent)}function xo(_,M){var F=_.alternate;return F===null?(F=o(_.tag,M,_.key,_.mode),F.elementType=_.elementType,F.type=_.type,F.stateNode=_.stateNode,F.alternate=_,_.alternate=F):(F.pendingProps=M,F.type=_.type,F.flags=0,F.subtreeFlags=0,F.deletions=null),F.flags=_.flags&31457280,F.childLanes=_.childLanes,F.lanes=_.lanes,F.child=_.child,F.memoizedProps=_.memoizedProps,F.memoizedState=_.memoizedState,F.updateQueue=_.updateQueue,M=_.dependencies,F.dependencies=M===null?null:{lanes:M.lanes,firstContext:M.firstContext},F.sibling=_.sibling,F.index=_.index,F.ref=_.ref,F.refCleanup=_.refCleanup,F}function Lr(_,M){_.flags&=31457282;var F=_.alternate;return F===null?(_.childLanes=0,_.lanes=M,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=F.childLanes,_.lanes=F.lanes,_.child=F.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=F.memoizedProps,_.memoizedState=F.memoizedState,_.updateQueue=F.updateQueue,_.type=F.type,M=F.dependencies,_.dependencies=M===null?null:{lanes:M.lanes,firstContext:M.firstContext}),_}function zr(_,M,F,U,te,oe){var pe=0;if(U=_,typeof _=="function")Zo(_)&&(pe=1);else if(typeof _=="string")pe=ps&&Xn?bn(_,F,sn.current)?26:Ic(_)?27:5:ps?bn(_,F,sn.current)?26:5:Xn&&Ic(_)?27:5;else e:switch(_){case gr:return lr(F.children,te,oe,M);case Fr:pe=8,te|=24;break;case ur:return _=o(12,F,M,te|2),_.elementType=ur,_.lanes=oe,_;case wo:return _=o(13,F,M,te),_.elementType=wo,_.lanes=oe,_;case ml:return _=o(19,F,M,te),_.elementType=ml,_.lanes=oe,_;case No:return ic(F,te,oe,M);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case yh:case hr:pe=10;break e;case ig:pe=9;break e;case nc:pe=11;break e;case Ga:pe=14;break e;case Mo:pe=16,U=null;break e}pe=29,F=Error(u(130,_===null?"null":typeof _,"")),U=null}return M=o(pe,F,M,te),M.elementType=_,M.type=U,M.lanes=oe,M}function lr(_,M,F,U){return _=o(7,_,U,M),_.lanes=F,_}function ic(_,M,F,U){_=o(22,_,U,M),_.elementType=No,_.lanes=F;var te={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var oe=te._current;if(oe===null)throw Error(u(456));if((te._pendingVisibility&2)===0){var pe=Gt(oe,2);pe!==null&&(te._pendingVisibility|=2,Hi(pe,oe,2))}},attach:function(){var oe=te._current;if(oe===null)throw Error(u(456));if((te._pendingVisibility&2)!==0){var pe=Gt(oe,2);pe!==null&&(te._pendingVisibility&=-3,Hi(pe,oe,2))}}};return _.stateNode=te,_}function Al(_,M,F){return _=o(6,_,null,M),_.lanes=F,_}function cs(_,M,F){return M=o(4,_.children!==null?_.children:[],_.key,M),M.lanes=F,M.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},M}function to(_,M,F,U,te,oe,pe,we){this.tag=1,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Sa,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=se(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=se(0),this.hiddenUpdates=se(null),this.identifierPrefix=U,this.onUncaughtError=te,this.onCaughtError=oe,this.onRecoverableError=pe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=we,this.incompleteTransitions=new Map}function Ro(_,M,F,U,te,oe,pe,we,Ke,gt,xt,Wt){return _=new to(_,M,F,pe,we,Ke,gt,Wt),M=1,oe===!0&&(M|=24),oe=o(3,null,null,M),_.current=oe,oe.stateNode=_,M=qo(),M.refCount++,_.pooledCache=M,M.refCount++,oe.memoizedState={element:U,isDehydrated:F,cache:M},De(oe),_}function eg(_){return _?(_=Ur,_):Ur}function _o(_){var M=_._reactInternals;if(M===void 0)throw typeof _.render=="function"?Error(u(188)):(_=Object.keys(_).join(","),Error(u(268,_)));return _=w(M),_=_!==null?V(_):null,_===null?null:Kr(_.stateNode)}function io(_,M,F,U,te,oe){te=eg(te),U.context===null?U.context=te:U.pendingContext=te,U=ft(M),U.payload={element:F},oe=oe===void 0?null:oe,oe!==null&&(U.callback=oe),F=At(_,U,M),F!==null&&(Hi(F,_,M),Ct(F,_,M))}function un(_,M){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var F=_.retryLane;_.retryLane=F!==0&&F<M?F:M}}function ya(_,M){un(_,M),(_=_.alternate)&&un(_,M)}var gi={},bh=requireReact(),fs=requireScheduler(),en=Object.assign,tg=Symbol.for("react.element"),cr=Symbol.for("react.transitional.element"),no=Symbol.for("react.portal"),gr=Symbol.for("react.fragment"),Fr=Symbol.for("react.strict_mode"),ur=Symbol.for("react.profiler"),yh=Symbol.for("react.provider"),ig=Symbol.for("react.consumer"),hr=Symbol.for("react.context"),nc=Symbol.for("react.forward_ref"),wo=Symbol.for("react.suspense"),ml=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Mo=Symbol.for("react.lazy"),No=Symbol.for("react.offscreen"),oi=Symbol.for("react.memo_cache_sentinel"),Ri=Symbol.iterator,hn=Symbol.for("react.client.reference"),Ut=bh.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,dr,Cr,va=!1,Ir=Array.isArray,Ba=t.rendererVersion,Gh=t.rendererPackageName,ji=t.extraDevToolsConfig,Kr=t.getPublicInstance,ng=t.getRootHostContext,hu=t.getChildHostContext,du=t.prepareForCommit,vh=t.resetAfterCommit,sg=t.createInstance,bl=t.appendInitialChild,sc=t.finalizeInitialChildren,Mn=t.shouldSetTextContent,tn=t.createTextInstance,oc=t.scheduleTimeout,yl=t.cancelTimeout,Sa=t.noTimeout,zs=t.isPrimaryRenderer;t.warnsIfNotActing;var Di=t.supportsMutation,Fs=t.supportsPersistence,gs=t.supportsHydration,rc=t.getInstanceFromNode;t.beforeActiveInstanceBlur,t.afterActiveInstanceBlur;var Cu=t.preparePortalMount;t.prepareScopeUpdate,t.getInstanceFromScope;var Un=t.setCurrentUpdatePriority,fr=t.getCurrentUpdatePriority,Iu=t.resolveUpdatePriority;t.resolveEventType,t.resolveEventTimeStamp;var fu=t.shouldAttemptEagerTransition,pu=t.detachDeletedInstance;t.requestPostPaintCallback;var og=t.maySuspendCommit,rg=t.preloadInstance,Bh=t.startSuspendingCommit,ag=t.suspendInstance,Au=t.waitForCommitToBeReady,kr=t.NotPendingTransition,Vo=t.HostTransitionContext,mu=t.resetFormInstance;t.bindToConsole;var bu=t.supportsMicrotasks,yu=t.scheduleMicrotask,Xa=t.supportsTestSelectors,Gu=t.findFiberRoot,Sh=t.getBoundingRect,vu=t.getTextContent,so=t.isHiddenSubtree,Bu=t.matchAccessibilityRole,ac=t.setFocusIfFocusable,lc=t.setupIntersectionObserver,Su=t.appendChild,lg=t.appendChildToContainer,Xu=t.commitTextUpdate,Zu=t.commitMount,xu=t.commitUpdate,Ru=t.insertBefore,cg=t.insertInContainerBefore,_u=t.removeChild,wu=t.removeChildFromContainer,cc=t.resetTextContent,Mu=t.hideInstance,Nu=t.hideTextInstance,Xh=t.unhideInstance,gg=t.unhideTextInstance,Vu=t.clearContainer,Wu=t.cloneInstance,gc=t.createContainerChildSet,ug=t.appendChildToContainerChildSet,Eu=t.finalizeContainerChildren,Yu=t.replaceContainerChildren,Tu=t.cloneHiddenInstance,hg=t.cloneHiddenTextInstance,Pr=t.isSuspenseInstancePending,Gl=t.isSuspenseInstanceFallback,uc=t.getSuspenseInstanceFallbackErrorDetails,Ju=t.registerSuspenseInstanceRetry,Hu=t.canHydrateFormStateMarker,oo=t.isFormStateMarkerMatching,pr=t.getNextHydratableSibling,Wo=t.getFirstHydratableChild,Dr=t.getFirstHydratableChildWithinContainer,dg=t.getFirstHydratableChildWithinSuspenseInstance,Cg=t.canHydrateInstance,Lu=t.canHydrateTextInstance,zu=t.canHydrateSuspenseInstance,Or=t.hydrateInstance,hc=t.hydrateTextInstance,Fu=t.hydrateSuspenseInstance,Ku=t.getNextHydratableInstanceAfterSuspenseInstance,ku=t.commitHydratedContainer,dc=t.commitHydratedSuspenseInstance,Pu=t.clearSuspenseBoundary,Ig=t.clearSuspenseBoundaryFromContainer,fg=t.shouldDeleteUnhydratedTailInstances;t.diffHydratedPropsForDevWarnings,t.diffHydratedTextForDevWarnings,t.describeHydratableInstanceForDevWarnings;var Du=t.validateHydratableInstance,Zh=t.validateHydratableTextInstance,ps=t.supportsResources,bn=t.isHostHoistableType,yn=t.getHoistableRoot,pg=t.getResource,Ag=t.acquireResource,mg=t.releaseResource,Ou=t.hydrateHoistable,bg=t.mountHoistable,Za=t.unmountHoistable,yg=t.createHoistableInstance,Uu=t.prepareToCommitHoistables,$u=t.mayResourceSuspendCommit,Gg=t.preloadResource,vg=t.suspendResource,Xn=t.supportsSingletons,Cc=t.resolveSingletonInstance,Qu=t.clearSingleton,Bg=t.acquireSingletonInstance,Sg=t.releaseSingletonInstance,Ic=t.isHostSingletonType,fc=[],Ar=-1,Ur={},nn=Math.clz32?Math.clz32:z,Xg=Math.log,xh=Math.LN2,vl=128,xa=4194304,ro=fs.unstable_scheduleCallback,Ks=fs.unstable_cancelCallback,mr=fs.unstable_shouldYield,Eo=fs.unstable_requestPaint,As=fs.unstable_now,pc=fs.unstable_ImmediatePriority,Bl=fs.unstable_UserBlockingPriority,Ra=fs.unstable_NormalPriority,$r=fs.unstable_IdlePriority,Tn=fs.log,Ac=fs.unstable_setDisableYieldValue,_a=null,dn=null,$n=typeof Object.is=="function"?Object.is:Be,mc=new WeakMap,ms=[],bs=0,br=null,wa=0,us=[],Jn=0,ks=null,ao=1,lo="",sn=J(null),Zs=J(null),Yo=J(null),Sl=J(null),on=null,wi=null,bi=!1,xs=null,Ps=!1,Xl=Error(u(519)),hs=[],To=0,Ds=0,Fi=null,yr=null,bc=!1,rn=!1,yc=!1,Ma=0,Na=null,Gc=0,Ki=0,Zn=null,Hn=!1,vc=!1,ju=Object.prototype.hasOwnProperty,Zl=Error(u(460)),xl=Error(u(474)),Qn={then:function(){}},Ln=null,Qr=null,zn=0,Gr=Zi(!0),co=Zi(!1),Os=J(null),Us=J(0),ds=J(null),Rs=null,Li=J(0),Jo=0,qt=null,Gi=null,Oi=null,Ho=!1,jr=!1,vr=!1,Br=0,Va=0,Lo=null,qu=0,Zg=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},an={readContext:_n,use:Pe,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt};an.useCacheRefresh=Qt,an.useMemoCache=Qt,an.useHostTransitionStatus=Qt,an.useFormState=Qt,an.useActionState=Qt,an.useOptimistic=Qt;var zo={readContext:_n,use:Pe,useCallback:function(_,M){return Ie().memoizedState=[_,M===void 0?null:M],_},useContext:_n,useEffect:_c,useImperativeHandle:function(_,M,F){F=F!=null?F.concat([_]):null,El(4194308,4,Da.bind(null,M,_),F)},useLayoutEffect:function(_,M){return El(4194308,4,_,M)},useInsertionEffect:function(_,M){El(4,2,_,M)},useMemo:function(_,M){var F=Ie();M=M===void 0?null:M;var U=_();if(vr){Ze(!0);try{_()}finally{Ze(!1)}}return F.memoizedState=[U,M],U},useReducer:function(_,M,F){var U=Ie();if(F!==void 0){var te=F(M);if(vr){Ze(!0);try{F(M)}finally{Ze(!1)}}}else te=M;return U.memoizedState=U.baseState=te,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:te},U.queue=_,_=_.dispatch=Hl.bind(null,qt,_),[U.memoizedState,_]},useRef:function(_){var M=Ie();return _={current:_},M.memoizedState=_},useState:function(_){_=Ai(_);var M=_.queue,F=Nc.bind(null,qt,M);return M.dispatch=F,[_.memoizedState,F]},useDebugValue:Oa,useDeferredValue:function(_,M){var F=Ie();return Tl(F,_,M)},useTransition:function(){var _=Ai(!1);return _=wc.bind(null,qt,_.queue,!0,!1),Ie().memoizedState=_,[!1,_]},useSyncExternalStore:function(_,M,F){var U=qt,te=Ie();if(bi){if(F===void 0)throw Error(u(407));F=F()}else{if(F=M(),Ni===null)throw Error(u(349));(hi&60)!==0||Ot(U,M,F)}te.memoizedState=F;var oe={value:F,getSnapshot:M};return te.queue=oe,_c(di.bind(null,U,oe,_),[_]),U.flags|=2048,Hs(9,zt.bind(null,U,oe,F,M),{destroy:void 0},null),F},useId:function(){var _=Ie(),M=Ni.identifierPrefix;if(bi){var F=lo,U=ao;F=(U&~(1<<32-nn(U)-1)).toString(32)+F,M=":"+M+"R"+F,F=Br++,0<F&&(M+="H"+F.toString(32)),M+=":"}else F=qu++,M=":"+M+"r"+F.toString(32)+":";return _.memoizedState=M},useCacheRefresh:function(){return Ie().memoizedState=Mc.bind(null,qt)}};zo.useMemoCache=Le,zo.useHostTransitionStatus=Ua,zo.useFormState=xi,zo.useActionState=xi,zo.useOptimistic=function(_){var M=Ie();M.memoizedState=M.baseState=_;var F={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return M.queue=F,M=aa.bind(null,qt,!0,F),F.dispatch=M,[_,M]};var jn={readContext:_n,use:Pe,useCallback:Mr,useContext:_n,useEffect:Pa,useImperativeHandle:Yl,useInsertionEffect:zg,useLayoutEffect:Fg,useMemo:Nr,useReducer:Mt,useRef:Pn,useState:function(){return Mt(pt)},useDebugValue:Oa,useDeferredValue:function(_,M){var F=Ve();return Jl(F,Gi.memoizedState,_,M)},useTransition:function(){var _=Mt(pt)[0],M=Ve().memoizedState;return[typeof _=="boolean"?_:$e(_),M]},useSyncExternalStore:Dt,useId:ra};jn.useCacheRefresh=fo,jn.useMemoCache=Le,jn.useHostTransitionStatus=Ua,jn.useFormState=Wn,jn.useActionState=Wn,jn.useOptimistic=function(_,M){var F=Ve();return jt(F,Gi,_,M)};var Sr={readContext:_n,use:Pe,useCallback:Mr,useContext:_n,useEffect:Pa,useImperativeHandle:Yl,useInsertionEffect:zg,useLayoutEffect:Fg,useMemo:Nr,useReducer:Nt,useRef:Pn,useState:function(){return Nt(pt)},useDebugValue:Oa,useDeferredValue:function(_,M){var F=Ve();return Gi===null?Tl(F,_,M):Jl(F,Gi.memoizedState,_,M)},useTransition:function(){var _=Nt(pt)[0],M=Ve().memoizedState;return[typeof _=="boolean"?_:$e(_),M]},useSyncExternalStore:Dt,useId:ra};Sr.useCacheRefresh=fo,Sr.useMemoCache=Le,Sr.useHostTransitionStatus=Ua,Sr.useFormState=Bn,Sr.useActionState=Bn,Sr.useOptimistic=function(_,M){var F=Ve();return Gi!==null?jt(F,Gi,_,M):(F.baseState=_,[_,F.queue.dispatch])};var Wa={isMounted:function(_){return(_=_._reactInternals)?B(_)===_:!1},enqueueSetState:function(_,M,F){_=_._reactInternals;var U=En(),te=ft(U);te.payload=M,F!=null&&(te.callback=F),M=At(_,te,U),M!==null&&(Hi(M,_,U),Ct(M,_,U))},enqueueReplaceState:function(_,M,F){_=_._reactInternals;var U=En(),te=ft(U);te.tag=1,te.payload=M,F!=null&&(te.callback=F),M=At(_,te,U),M!==null&&(Hi(M,_,U),Ct(M,_,U))},enqueueForceUpdate:function(_,M){_=_._reactInternals;var F=En(),U=ft(F);U.tag=2,M!=null&&(U.callback=M),M=At(_,U,F),M!==null&&(Hi(M,_,F),Ct(M,_,F))}},Xr=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var M=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(M))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)},xg=Error(u(461)),Cn=!1,Rl={dehydrated:null,treeContext:null,retryLane:0},_s=J(null),Zr=null,ws=null,_l=typeof AbortController<"u"?AbortController:function(){var _=[],M=this.signal={aborted:!1,addEventListener:function(F,U){_.push(U)}};this.abort=function(){M.aborted=!0,_.forEach(function(F){return F()})}},$i=fs.unstable_scheduleCallback,Rh=fs.unstable_NormalPriority,qi={$$typeof:hr,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},Rg=Ut.S;Ut.S=function(_,M){typeof M=="object"&&M!==null&&typeof M.then=="function"&&Zt(_,M),Rg!==null&&Rg(_,M)};var qr=J(null),Fo=!1,ei=!1,Mi=!1,ai=typeof WeakSet=="function"?WeakSet:Set,kt=null,Wi=!1,vi=null,ln=!1,Fn=null,xr=8192,Ko={getCacheForType:function(_){var M=_n(qi),F=M.data.get(_);return F===void 0&&(F=_(),M.data.set(_,F)),F}},ki=0,$s=1,go=2,Ea=3,qn=4;if(typeof Symbol=="function"&&Symbol.for){var uo=Symbol.for;ki=uo("selector.component"),$s=uo("selector.has_pseudo_class"),go=uo("selector.role"),Ea=uo("selector.test_id"),qn=uo("selector.text")}var wl=typeof WeakMap=="function"?WeakMap:Map,ui=0,Ni=null,ri=null,hi=0,_i=0,In=null,Ms=!1,Ns=!1,ea=!1,Qs=0,Ui=0,Vs=0,ko=0,es=0,ys=0,fn=0,Ya=null,Ws=null,Bc=!1,_g=0,Gs=1/0,ta=null,ho=null,Po=!1,Rr=null,Ta=0,Sc=0,Ml=null,ia=0,wg=null;return gi.attemptContinuousHydration=function(_){if(_.tag===13){var M=Gt(_,67108864);M!==null&&Hi(M,_,67108864),ya(_,67108864)}},gi.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var M=En(),F=Gt(_,M);F!==null&&Hi(F,_,M),ya(_,M)}},gi.attemptSynchronousHydration=function(_){switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var M=K(_.pendingLanes);if(M!==0){for(_.pendingLanes|=2,_.entangledLanes|=2;M;){var F=1<<31-nn(M);_.entanglements[1]|=F,M&=~F}Xt(_),(ui&6)===0&&(Gs=As()+500,Ge(0))}}break;case 13:M=Gt(_,2),M!==null&&Hi(M,_,2),Qc(),ya(_,2)}},gi.batchedUpdates=function(_,M){return _(M)},gi.createComponentSelector=function(_){return{$$typeof:ki,value:_}},gi.createContainer=function(_,M,F,U,te,oe,pe,we,Ke,gt){return Ro(_,M,!1,null,F,U,oe,pe,we,Ke,gt,null)},gi.createHasPseudoClassSelector=function(_){return{$$typeof:$s,value:_}},gi.createHydrationContainer=function(_,M,F,U,te,oe,pe,we,Ke,gt,xt,Wt,St){return _=Ro(F,U,!0,_,te,oe,we,Ke,gt,xt,Wt,St),_.context=eg(null),F=_.current,U=En(),te=ft(U),te.callback=M??null,At(F,te,U),_.current.lanes=U,re(_,U),Xt(_),_},gi.createPortal=function(_,M,F){var U=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:no,key:U==null?null:""+U,children:_,containerInfo:M,implementation:F}},gi.createRoleSelector=function(_){return{$$typeof:go,value:_}},gi.createTestNameSelector=function(_){return{$$typeof:Ea,value:_}},gi.createTextSelector=function(_){return{$$typeof:qn,value:_}},gi.defaultOnCaughtError=function(_){console.error(_)},gi.defaultOnRecoverableError=function(_){Xr(_)},gi.defaultOnUncaughtError=function(_){Xr(_)},gi.deferredUpdates=function(_){var M=Ut.T,F=fr();try{return Un(32),Ut.T=null,_()}finally{Un(F),Ut.T=M}},gi.discreteUpdates=function(_,M,F,U,te){var oe=Ut.T,pe=fr();try{return Un(2),Ut.T=null,_(M,F,U,te)}finally{Un(pe),Ut.T=oe,ui===0&&(Gs=As()+500)}},gi.findAllNodes=nr,gi.findBoundingRects=function(_,M){if(!Xa)throw Error(u(363));M=nr(_,M),_=[];for(var F=0;F<M.length;F++)_.push(Sh(M[F]));for(M=_.length-1;0<M;M--){F=_[M];for(var U=F.x,te=U+F.width,oe=F.y,pe=oe+F.height,we=M-1;0<=we;we--)if(M!==we){var Ke=_[we],gt=Ke.x,xt=gt+Ke.width,Wt=Ke.y,St=Wt+Ke.height;if(U>=gt&&oe>=Wt&&te<=xt&&pe<=St){_.splice(M,1);break}else if(U!==gt||F.width!==Ke.width||St<oe||Wt>pe){if(!(oe!==Wt||F.height!==Ke.height||xt<U||gt>te)){gt>U&&(Ke.width+=gt-U,Ke.x=U),xt<te&&(Ke.width=te-gt),_.splice(M,1);break}}else{Wt>oe&&(Ke.height+=Wt-oe,Ke.y=oe),St<pe&&(Ke.height=pe-Wt),_.splice(M,1);break}}}return _},gi.findHostInstance=_o,gi.findHostInstanceWithNoPortals=function(_){return _=w(_),_=_!==null?Y(_):null,_===null?null:Kr(_.stateNode)},gi.findHostInstanceWithWarning=function(_){return _o(_)},gi.flushPassiveEffects=rr,gi.flushSyncFromReconciler=function(_){var M=ui;ui|=1;var F=Ut.T,U=fr();try{if(Un(2),Ut.T=null,_)return _()}finally{Un(U),Ut.T=F,ui=M,(ui&6)===0&&Ge(0)}},gi.flushSyncWork=Qc,gi.focusWithin=function(_,M){if(!Xa)throw Error(u(363));for(_=ir(_),M=Jr(_,M),M=Array.from(M),_=0;_<M.length;){var F=M[_++],U=F.tag;if(!so(F)){if((U===5||U===26||U===27)&&ac(F.stateNode))return!0;for(F=F.child;F!==null;)M.push(F),F=F.sibling}}return!1},gi.getFindAllNodesFailureDescription=function(_,M){if(!Xa)throw Error(u(363));var F=0,U=[];_=[ir(_),0];for(var te=0;te<_.length;){var oe=_[te++],pe=oe.tag,we=_[te++],Ke=M[we];if((pe!==5&&pe!==26&&pe!==27||!so(oe))&&(ql(oe,Ke)&&(U.push(ls(Ke)),we++,we>F&&(F=we)),we<M.length))for(oe=oe.child;oe!==null;)_.push(oe,we),oe=oe.sibling}if(F<M.length){for(_=[];F<M.length;F++)_.push(ls(M[F]));return`findAllNodes was able to match part of the selector:
  `+(U.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},gi.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 27:case 5:return Kr(_.child.stateNode);default:return _.child.stateNode}},gi.injectIntoDevTools=function(){var _={bundleType:0,version:Ba,rendererPackageName:Gh,currentDispatcherRef:Ut,findFiberByHostInstance:rc,reconcilerVersion:"19.0.0"};if(ji!==null&&(_.rendererConfig=ji),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var M=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(M.isDisabled||!M.supportsFiber)_=!0;else{try{_a=M.inject(_),dn=M}catch{}_=!!M.checkDCE}}return _},gi.isAlreadyRendering=function(){return!1},gi.observeVisibleRects=function(_,M,F,U){if(!Xa)throw Error(u(363));_=nr(_,M);var te=lc(_,F,U).disconnect;return{disconnect:function(){te()}}},gi.shouldError=function(){return null},gi.shouldSuspend=function(){return!1},gi.startHostTransition=function(_,M,F,U){if(_.tag!==5)throw Error(u(476));var te=oa(_).queue;wc(_,te,M,kr,F===null?r:function(){var oe=oa(_).next.queue;return Uo(_,oe,{},En()),F(U)})},gi.updateContainer=function(_,M,F,U){var te=M.current,oe=En();return io(te,oe,_,M,F,U),oe},gi.updateContainerSync=function(_,M,F,U){return M.tag===0&&rr(),io(M.current,2,_,M,F,U),2},gi},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})}(reactReconciler_production)),reactReconciler_production.exports}var hasRequiredReactReconciler;function requireReactReconciler(){return hasRequiredReactReconciler||(hasRequiredReactReconciler=1,reactReconciler.exports=requireReactReconciler_production()),reactReconciler.exports}var reactReconcilerExports=requireReactReconciler();const Reconciler=getDefaultExportFromCjs(reactReconcilerExports);var schedulerExports=requireScheduler();function i$1(n,t,o){if(!n)return;if(o(n)===!0)return n;let r=t?n.return:n.child;for(;r;){const u=i$1(r,t,o);if(u)return u;r=t?null:r.sibling}}function l(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const a$2=l(reactExports.createContext(null));let m$1=class extends reactExports.Component{render(){return reactExports.createElement(a$2.Provider,{value:this._reactInternals},this.props.children)}};function c$2(){const n=reactExports.useContext(a$2);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=reactExports.useId();return reactExports.useMemo(()=>{for(const o of[n,n==null?void 0:n.alternate]){if(!o)continue;const r=i$1(o,!1,u=>{let d=u.memoizedState;for(;d;){if(d.memoizedState===t)return!0;d=d.next}});if(r)return r}},[n,t])}const p=Symbol.for("react.context"),b$2=n=>n!==null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===p;function h(){const n=c$2(),[t]=reactExports.useState(()=>new Map);t.clear();let o=n;for(;o;){const r=o.type;b$2(r)&&r!==a$2&&!t.has(r)&&t.set(r,reactExports.use(l(r))),o=o.return}return t}function x(){const n=h();return reactExports.useMemo(()=>Array.from(n.keys()).reduce((t,o)=>r=>reactExports.createElement(t,null,reactExports.createElement(o.Provider,{...r,value:n.get(o)})),t=>reactExports.createElement(m$1,{...t})),[n])}function findInitialRoot(n){let t=n.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const isOrthographicCamera=n=>n&&n.isOrthographicCamera,isRef=n=>n&&n.hasOwnProperty("current"),isColorRepresentation=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),useIsomorphicLayoutEffect=((n,t)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(n){const t=reactExports.useRef(n);return useIsomorphicLayoutEffect(()=>void(t.current=n),[n]),t}function useBridge(){const n=c$2(),t=x();return reactExports.useMemo(()=>({children:o})=>{const u=!!i$1(n,!0,d=>d.type===reactExports.StrictMode)?reactExports.StrictMode:reactExports.Fragment;return jsxRuntimeExports.jsx(u,{children:jsxRuntimeExports.jsx(t,{children:o})})},[n,t])}function Block({set:n}){return useIsomorphicLayoutEffect(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}const ErrorBoundary=(n=>(n=class extends reactExports.Component{constructor(...o){super(...o),this.state={error:!1}}componentDidCatch(o){this.props.set(o)}render(){return this.state.error?null:this.props.children}},n.getDerivedStateFromError=()=>({error:!0}),n))();function calculateDpr(n){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],o),n[1]):n}function getRootState(n){var t;return(t=n.__r3f)==null?void 0:t.root.getState()}const is={obj:n=>n===Object(n)&&!is.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,t,{arrays:o="shallow",objects:r="reference",strict:u=!0}={}){if(typeof n!=typeof t||!!n!=!!t)return!1;if(is.str(n)||is.num(n)||is.boo(n))return n===t;const d=is.obj(n);if(d&&r==="reference")return n===t;const C=is.arr(n);if(C&&o==="reference")return n===t;if((C||d)&&n===t)return!0;let I;for(I in n)if(!(I in t))return!1;if(d&&o==="shallow"&&r==="shallow"){for(I in u?t:n)if(!is.equ(n[I],t[I],{strict:u,objects:"reference"}))return!1}else for(I in u?t:n)if(n[I]!==t[I])return!1;if(is.und(I)){if(C&&n.length===0&&t.length===0||d&&Object.keys(n).length===0&&Object.keys(t).length===0)return!0;if(n!==t)return!1}return!0}};function dispose(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const t in n){const o=n[t];(o==null?void 0:o.type)!=="Scene"&&(o==null||o.dispose==null||o.dispose())}}const REACT_INTERNAL_PROPS=["children","key","ref"];function getInstanceProps(n){const t={};for(const o in n)REACT_INTERNAL_PROPS.includes(o)||(t[o]=n[o]);return t}function prepare$1(n,t,o,r){const u=n;let d=u==null?void 0:u.__r3f;return d||(d={root:t,type:o,parent:null,children:[],props:getInstanceProps(r),object:u,eventCount:0,handlers:{},isHidden:!1},u&&(u.__r3f=d)),d}function resolve(n,t){let o=n[t];if(!t.includes("-"))return{root:n,key:t,target:o};o=n;for(const u of t.split("-")){var r;t=u,n=o,o=(r=o)==null?void 0:r[t]}return{root:n,key:t,target:o}}const INDEX_REGEX=/-\d+$/;function attach(n,t){if(is.str(t.props.attach)){if(INDEX_REGEX.test(t.props.attach)){const u=t.props.attach.replace(INDEX_REGEX,""),{root:d,key:C}=resolve(n.object,u);Array.isArray(d[C])||(d[C]=[])}const{root:o,key:r}=resolve(n.object,t.props.attach);t.previousAttach=o[r],o[r]=t.object}else is.fun(t.props.attach)&&(t.previousAttach=t.props.attach(n.object,t.object))}function detach(n,t){if(is.str(t.props.attach)){const{root:o,key:r}=resolve(n.object,t.props.attach),u=t.previousAttach;u===void 0?delete o[r]:o[r]=u}else t.previousAttach==null||t.previousAttach(n.object,t.object);delete t.previousAttach}const RESERVED_PROPS=[...REACT_INTERNAL_PROPS,"args","dispose","attach","object","onUpdate","dispose"],MEMOIZED_PROTOTYPES=new Map;function getMemoizedPrototype(n){let t=MEMOIZED_PROTOTYPES.get(n.constructor);try{t||(t=new n.constructor,MEMOIZED_PROTOTYPES.set(n.constructor,t))}catch{}return t}function diffProps(n,t){const o={};for(const r in t)if(!RESERVED_PROPS.includes(r)&&!is.equ(t[r],n.props[r])){o[r]=t[r];for(const u in t)u.startsWith(`${r}-`)&&(o[u]=t[u])}for(const r in n.props){if(RESERVED_PROPS.includes(r)||t.hasOwnProperty(r))continue;const{root:u,key:d}=resolve(n.object,r);if(u.constructor&&u.constructor.length===0){const C=getMemoizedPrototype(u);is.und(C)||(o[d]=C[d])}else o[d]=0}return o}const colorMaps=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],EVENT_REGEX=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function applyProps(n,t){var o;const r=n.__r3f,u=r&&findInitialRoot(r).getState(),d=r==null?void 0:r.eventCount;for(const I in t){let f=t[I];if(RESERVED_PROPS.includes(I))continue;if(r&&EVENT_REGEX.test(I)){typeof f=="function"?r.handlers[I]=f:delete r.handlers[I],r.eventCount=Object.keys(r.handlers).length;continue}if(f===void 0)continue;let{root:A,key:G,target:B}=resolve(n,I);if(B instanceof Layers&&f instanceof Layers)B.mask=f.mask;else if(B instanceof Color&&isColorRepresentation(f))B.set(f);else if(B!==null&&typeof B=="object"&&typeof B.set=="function"&&typeof B.copy=="function"&&f!=null&&f.constructor&&B.constructor===f.constructor)B.copy(f);else if(B!==null&&typeof B=="object"&&typeof B.set=="function"&&Array.isArray(f))typeof B.fromArray=="function"?B.fromArray(f):B.set(...f);else if(B!==null&&typeof B=="object"&&typeof B.set=="function"&&typeof f=="number")typeof B.setScalar=="function"?B.setScalar(f):B.set(f);else{var C;A[G]=f,u&&!u.linear&&colorMaps.includes(G)&&(C=A[G])!=null&&C.isTexture&&A[G].format===RGBAFormat&&A[G].type===UnsignedByteType&&(A[G].colorSpace=SRGBColorSpace)}}if(r!=null&&r.parent&&u!=null&&u.internal&&(o=r.object)!=null&&o.isObject3D&&d!==r.eventCount){const I=r.object,f=u.internal.interaction.indexOf(I);f>-1&&u.internal.interaction.splice(f,1),r.eventCount&&I.raycast!==null&&u.internal.interaction.push(I)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&invalidateInstance(r),n}function invalidateInstance(n){var t;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const o=(t=n.root)==null||t.getState==null?void 0:t.getState();o&&o.internal.frames===0&&o.invalidate()}function updateCamera(n,t){n.manual||(isOrthographicCamera(n)?(n.left=t.width/-2,n.right=t.width/2,n.top=t.height/2,n.bottom=t.height/-2):n.aspect=t.width/t.height,n.updateProjectionMatrix())}const isObject3D=n=>n==null?void 0:n.isObject3D;function makeId(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function releaseInternalPointerCapture(n,t,o,r){const u=o.get(t);u&&(o.delete(t),o.size===0&&(n.delete(r),u.target.releasePointerCapture(r)))}function removeInteractivity(n,t){const{internal:o}=n.getState();o.interaction=o.interaction.filter(r=>r!==t),o.initialHits=o.initialHits.filter(r=>r!==t),o.hovered.forEach((r,u)=>{(r.eventObject===t||r.object===t)&&o.hovered.delete(u)}),o.capturedMap.forEach((r,u)=>{releaseInternalPointerCapture(o.capturedMap,t,r,u)})}function createEvents(n){function t(f){const{internal:A}=n.getState(),G=f.offsetX-A.initialClick[0],B=f.offsetY-A.initialClick[1];return Math.round(Math.sqrt(G*G+B*B))}function o(f){return f.filter(A=>["Move","Over","Enter","Out","Leave"].some(G=>{var B;return(B=A.__r3f)==null?void 0:B.handlers["onPointer"+G]}))}function r(f,A){const G=n.getState(),B=new Set,Z=[],w=A?A(G.internal.interaction):G.internal.interaction;for(let T=0;T<w.length;T++){const L=getRootState(w[T]);L&&(L.raycaster.camera=void 0)}G.previousRoot||G.events.compute==null||G.events.compute(f,G);function V(T){const L=getRootState(T);if(!L||!L.events.enabled||L.raycaster.camera===null)return[];if(L.raycaster.camera===void 0){var z;L.events.compute==null||L.events.compute(f,L,(z=L.previousRoot)==null?void 0:z.getState()),L.raycaster.camera===void 0&&(L.raycaster.camera=null)}return L.raycaster.camera?L.raycaster.intersectObject(T,!0):[]}let Y=w.flatMap(V).sort((T,L)=>{const z=getRootState(T.object),K=getRootState(L.object);return!z||!K?T.distance-L.distance:K.events.priority-z.events.priority||T.distance-L.distance}).filter(T=>{const L=makeId(T);return B.has(L)?!1:(B.add(L),!0)});G.events.filter&&(Y=G.events.filter(Y,G));for(const T of Y){let L=T.object;for(;L;){var J;(J=L.__r3f)!=null&&J.eventCount&&Z.push({...T,eventObject:L}),L=L.parent}}if("pointerId"in f&&G.internal.capturedMap.has(f.pointerId))for(let T of G.internal.capturedMap.get(f.pointerId).values())B.has(makeId(T.intersection))||Z.push(T.intersection);return Z}function u(f,A,G,B){if(f.length){const Z={stopped:!1};for(const w of f){let V=getRootState(w.object);if(V||w.object.traverseAncestors(Y=>{const J=getRootState(Y);if(J)return V=J,!1}),V){const{raycaster:Y,pointer:J,camera:T,internal:L}=V,z=new Vector3(J.x,J.y,0).unproject(T),K=ee=>{var se,re;return(se=(re=L.capturedMap.get(ee))==null?void 0:re.has(w.eventObject))!=null?se:!1},P=ee=>{const se={intersection:w,target:A.target};L.capturedMap.has(ee)?L.capturedMap.get(ee).set(w.eventObject,se):L.capturedMap.set(ee,new Map([[w.eventObject,se]])),A.target.setPointerCapture(ee)},$=ee=>{const se=L.capturedMap.get(ee);se&&releaseInternalPointerCapture(L.capturedMap,w.eventObject,se,ee)};let ie={};for(let ee in A){let se=A[ee];typeof se!="function"&&(ie[ee]=se)}let ne={...w,...ie,pointer:J,intersections:f,stopped:Z.stopped,delta:G,unprojectedPoint:z,ray:Y.ray,camera:T,stopPropagation(){const ee="pointerId"in A&&L.capturedMap.get(A.pointerId);if((!ee||ee.has(w.eventObject))&&(ne.stopped=Z.stopped=!0,L.hovered.size&&Array.from(L.hovered.values()).find(se=>se.eventObject===w.eventObject))){const se=f.slice(0,f.indexOf(w));d([...se,w])}},target:{hasPointerCapture:K,setPointerCapture:P,releasePointerCapture:$},currentTarget:{hasPointerCapture:K,setPointerCapture:P,releasePointerCapture:$},nativeEvent:A};if(B(ne),Z.stopped===!0)break}}}return f}function d(f){const{internal:A}=n.getState();for(const G of A.hovered.values())if(!f.length||!f.find(B=>B.object===G.object&&B.index===G.index&&B.instanceId===G.instanceId)){const Z=G.eventObject.__r3f;if(A.hovered.delete(makeId(G)),Z!=null&&Z.eventCount){const w=Z.handlers,V={...G,intersections:f};w.onPointerOut==null||w.onPointerOut(V),w.onPointerLeave==null||w.onPointerLeave(V)}}}function C(f,A){for(let G=0;G<A.length;G++){const B=A[G].__r3f;B==null||B.handlers.onPointerMissed==null||B.handlers.onPointerMissed(f)}}function I(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>d([]);case"onLostPointerCapture":return A=>{const{internal:G}=n.getState();"pointerId"in A&&G.capturedMap.has(A.pointerId)&&requestAnimationFrame(()=>{G.capturedMap.has(A.pointerId)&&(G.capturedMap.delete(A.pointerId),d([]))})}}return function(G){const{onPointerMissed:B,internal:Z}=n.getState();Z.lastEvent.current=G;const w=f==="onPointerMove",V=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",J=r(G,w?o:void 0),T=V?t(G):0;f==="onPointerDown"&&(Z.initialClick=[G.offsetX,G.offsetY],Z.initialHits=J.map(z=>z.eventObject)),V&&!J.length&&T<=2&&(C(G,Z.interaction),B&&B(G)),w&&d(J);function L(z){const K=z.eventObject,P=K.__r3f;if(!(P!=null&&P.eventCount))return;const $=P.handlers;if(w){if($.onPointerOver||$.onPointerEnter||$.onPointerOut||$.onPointerLeave){const ie=makeId(z),ne=Z.hovered.get(ie);ne?ne.stopped&&z.stopPropagation():(Z.hovered.set(ie,z),$.onPointerOver==null||$.onPointerOver(z),$.onPointerEnter==null||$.onPointerEnter(z))}$.onPointerMove==null||$.onPointerMove(z)}else{const ie=$[f];ie?(!V||Z.initialHits.includes(K))&&(C(G,Z.interaction.filter(ne=>!Z.initialHits.includes(ne))),ie(z)):V&&Z.initialHits.includes(K)&&C(G,Z.interaction.filter(ne=>!Z.initialHits.includes(ne)))}}u(J,G,T,L)}}return{handlePointer:I}}const isRenderer=n=>!!(n!=null&&n.render),context=reactExports.createContext(null),createStore=(n,t)=>{const o=createWithEqualityFn((I,f)=>{const A=new Vector3,G=new Vector3,B=new Vector3;function Z(T=f().camera,L=G,z=f().size){const{width:K,height:P,top:$,left:ie}=z,ne=K/P;L.isVector3?B.copy(L):B.set(...L);const ee=T.getWorldPosition(A).distanceTo(B);if(isOrthographicCamera(T))return{width:K/T.zoom,height:P/T.zoom,top:$,left:ie,factor:1,distance:ee,aspect:ne};{const se=T.fov*Math.PI/180,re=2*Math.tan(se/2)*ee,ce=re*(K/P);return{width:ce,height:re,top:$,left:ie,factor:K/ce,distance:ee,aspect:ne}}}let w;const V=T=>I(L=>({performance:{...L.performance,current:T}})),Y=new Vector2;return{set:I,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(T=1)=>n(f(),T),advance:(T,L)=>t(T,L,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:Y,mouse:Y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const T=f();w&&clearTimeout(w),T.performance.current!==T.performance.min&&V(T.performance.min),w=setTimeout(()=>V(f().performance.max),T.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:Z},setEvents:T=>I(L=>({...L,events:{...L.events,...T}})),setSize:(T,L,z=0,K=0)=>{const P=f().camera,$={width:T,height:L,top:z,left:K};I(ie=>({size:$,viewport:{...ie.viewport,...Z(P,G,$)}}))},setDpr:T=>I(L=>{const z=calculateDpr(T);return{viewport:{...L.viewport,dpr:z,initialDpr:L.viewport.initialDpr||z}}}),setFrameloop:(T="always")=>{const L=f().clock;L.stop(),L.elapsedTime=0,T!=="never"&&(L.start(),L.elapsedTime=0),I(()=>({frameloop:T}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:reactExports.createRef(),active:!1,frames:0,priority:0,subscribe:(T,L,z)=>{const K=f().internal;return K.priority=K.priority+(L>0?1:0),K.subscribers.push({ref:T,priority:L,store:z}),K.subscribers=K.subscribers.sort((P,$)=>P.priority-$.priority),()=>{const P=f().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(L>0?1:0),P.subscribers=P.subscribers.filter($=>$.ref!==T))}}}}}),r=o.getState();let u=r.size,d=r.viewport.dpr,C=r.camera;return o.subscribe(()=>{const{camera:I,size:f,viewport:A,gl:G,set:B}=o.getState();if(f.width!==u.width||f.height!==u.height||A.dpr!==d){u=f,d=A.dpr,updateCamera(I,f),A.dpr>0&&G.setPixelRatio(A.dpr);const Z=typeof HTMLCanvasElement<"u"&&G.domElement instanceof HTMLCanvasElement;G.setSize(f.width,f.height,Z)}I!==C&&(C=I,B(Z=>({viewport:{...Z.viewport,...Z.viewport.getCurrentViewport(I)}})))}),o.subscribe(I=>n(I)),o};function useStore(){const n=reactExports.useContext(context);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function useThree(n=o=>o,t){return useStore()(n,t)}function useFrame(n,t=0){const o=useStore(),r=o.getState().internal.subscribe,u=useMutableCallback(n);return useIsomorphicLayoutEffect(()=>r(u,t,o),[t,r,o]),null}function createReconciler(n){const t=Reconciler(n);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version}),t}const NoEventPriority=0,catalogue={},PREFIX_REGEX=/^three(?=[A-Z])/,toPascalCase=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let i=0;const isConstructor=n=>typeof n=="function";function extend(n){if(isConstructor(n)){const t=`${i++}`;return catalogue[t]=n,t}else Object.assign(catalogue,n)}function validateInstance(n,t){const o=toPascalCase(n),r=catalogue[o];if(n!=="primitive"&&!r)throw new Error(`R3F: ${o} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function createInstance(n,t,o){var r;return n=toPascalCase(n)in catalogue?n:n.replace(PREFIX_REGEX,""),validateInstance(n,t),n==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,prepare$1(t.object,o,n,t)}function hideInstance(n){if(!n.isHidden){var t;n.props.attach&&(t=n.parent)!=null&&t.object?detach(n.parent,n):isObject3D(n.object)&&(n.object.visible=!1),n.isHidden=!0,invalidateInstance(n)}}function unhideInstance(n){if(n.isHidden){var t;n.props.attach&&(t=n.parent)!=null&&t.object?attach(n.parent,n):isObject3D(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,invalidateInstance(n)}}function handleContainerEffects(n,t,o){const r=t.root.getState();if(!(!n.parent&&n.object!==r.scene)){if(!t.object){var u,d;const C=catalogue[toPascalCase(t.type)];t.object=(u=t.props.object)!=null?u:new C(...(d=t.props.args)!=null?d:[]),t.object.__r3f=t}if(applyProps(t.object,t.props),t.props.attach)attach(n,t);else if(isObject3D(t.object)&&isObject3D(n.object)){const C=n.object.children.indexOf(o==null?void 0:o.object);if(o&&C!==-1){const I=n.object.children.indexOf(t.object);if(I!==-1){n.object.children.splice(I,1);const f=I<C?C-1:C;n.object.children.splice(f,0,t.object)}else t.object.parent=n.object,n.object.children.splice(C,0,t.object),t.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:t.object})}else n.object.add(t.object)}for(const C of t.children)handleContainerEffects(t,C);invalidateInstance(t)}}function appendChild(n,t){t&&(t.parent=n,n.children.push(t),handleContainerEffects(n,t))}function insertBefore(n,t,o){if(!t||!o)return;t.parent=n;const r=n.children.indexOf(o);r!==-1?n.children.splice(r,0,t):n.children.push(t),handleContainerEffects(n,t,o)}function disposeOnIdle(n){if(typeof n.dispose=="function"){const t=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,t)}}function removeChild(n,t,o){if(!t)return;t.parent=null;const r=n.children.indexOf(t);r!==-1&&n.children.splice(r,1),t.props.attach?detach(n,t):isObject3D(t.object)&&isObject3D(n.object)&&(n.object.remove(t.object),removeInteractivity(findInitialRoot(t),t.object));const u=t.props.dispose!==null&&o!==!1;for(let d=t.children.length-1;d>=0;d--){const C=t.children[d];removeChild(t,C,u)}t.children.length=0,delete t.object.__r3f,u&&t.type!=="primitive"&&t.object.type!=="Scene"&&disposeOnIdle(t.object),o===void 0&&invalidateInstance(t)}function setFiberRef(n,t){for(const o of[n,n.alternate])if(o!==null)if(typeof o.ref=="function"){o.refCleanup==null||o.refCleanup();const r=o.ref(t);typeof r=="function"&&(o.refCleanup=r)}else o.ref&&(o.ref.current=t)}const reconstructed=[];function swapInstances(){for(const[o]of reconstructed){const r=o.parent;if(r){o.props.attach?detach(r,o):isObject3D(o.object)&&isObject3D(r.object)&&r.object.remove(o.object);for(const u of o.children)u.props.attach?detach(o,u):isObject3D(u.object)&&isObject3D(o.object)&&o.object.remove(u.object)}o.isHidden&&unhideInstance(o),o.object.__r3f&&delete o.object.__r3f,o.type!=="primitive"&&disposeOnIdle(o.object)}for(const[o,r,u]of reconstructed){o.props=r;const d=o.parent;if(d){var n,t;const C=catalogue[toPascalCase(o.type)];o.object=(n=o.props.object)!=null?n:new C(...(t=o.props.args)!=null?t:[]),o.object.__r3f=o,setFiberRef(u,o.object),applyProps(o.object,o.props),o.props.attach?attach(d,o):isObject3D(o.object)&&isObject3D(d.object)&&d.object.add(o.object);for(const I of o.children)I.props.attach?attach(o,I):isObject3D(I.object)&&isObject3D(o.object)&&o.object.add(I.object);invalidateInstance(o)}}reconstructed.length=0}const handleTextInstance=()=>{},NO_CONTEXT={};let currentUpdatePriority=NoEventPriority;const NoFlags=0,Update=4,reconciler=createReconciler({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance,removeChild,appendChild,appendInitialChild:appendChild,insertBefore,appendChildToContainer(n,t){const o=n.getState().scene.__r3f;!t||!o||appendChild(o,t)},removeChildFromContainer(n,t){const o=n.getState().scene.__r3f;!t||!o||removeChild(o,t)},insertInContainerBefore(n,t,o){const r=n.getState().scene.__r3f;!t||!o||!r||insertBefore(r,t,o)},getRootHostContext:()=>NO_CONTEXT,getChildHostContext:()=>NO_CONTEXT,commitUpdate(n,t,o,r,u){var d,C,I;validateInstance(t,r);let f=!1;if((n.type==="primitive"&&o.object!==r.object||((d=r.args)==null?void 0:d.length)!==((C=o.args)==null?void 0:C.length)||(I=r.args)!=null&&I.some((G,B)=>{var Z;return G!==((Z=o.args)==null?void 0:Z[B])}))&&(f=!0),f)reconstructed.push([n,{...r},u]);else{const G=diffProps(n,r);Object.keys(G).length&&(Object.assign(n.props,G),applyProps(n.object,G))}(u.sibling===null||(u.flags&Update)===NoFlags)&&swapInstances()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n==null?void 0:n.object,prepareForCommit:()=>null,preparePortalMount:n=>prepare$1(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance,unhideInstance,createTextInstance:handleTextInstance,hideTextInstance:handleTextInstance,unhideTextInstance:handleTextInstance,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:reactExports.createContext(null),setCurrentUpdatePriority(n){currentUpdatePriority=n},getCurrentUpdatePriority(){return currentUpdatePriority},resolveUpdatePriority(){var n;if(currentUpdatePriority!==NoEventPriority)return currentUpdatePriority;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}},resetFormInstance(){}}),_roots=new Map,shallowLoose={objects:"shallow",strict:!1};function computeInitialSize(n,t){if(!t&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:o,height:r,top:u,left:d}=n.parentElement.getBoundingClientRect();return{width:o,height:r,top:u,left:d}}else if(!t&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function createRoot(n){const t=_roots.get(n),o=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,d=r||createStore(invalidate,advance),C=o||reconciler.createContainer(d,constantsExports.ConcurrentRoot,null,!1,null,"",u,u,u,null);t||_roots.set(n,{fiber:C,store:d});let I,f,A=!1,G=null;return{async configure(B={}){let Z;G=new Promise(de=>Z=de);let{gl:w,size:V,scene:Y,events:J,onCreated:T,shadows:L=!1,linear:z=!1,flat:K=!1,legacy:P=!1,orthographic:$=!1,frameloop:ie="always",dpr:ne=[1,2],performance:ee,raycaster:se,camera:re,onPointerMissed:ce}=B,ue=d.getState(),ye=ue.gl;if(!ue.gl){const de={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},ve=typeof w=="function"?await w(de):w;isRenderer(ve)?ye=ve:ye=new WebGLRenderer({...de,...w}),ue.set({gl:ye})}let Se=ue.raycaster;Se||ue.set({raycaster:Se=new Raycaster});const{params:Ce,...Ze}=se||{};if(is.equ(Ze,Se,shallowLoose)||applyProps(Se,{...Ze}),is.equ(Ce,Se.params,shallowLoose)||applyProps(Se,{params:{...Se.params,...Ce}}),!ue.camera||ue.camera===f&&!is.equ(f,re,shallowLoose)){f=re;const de=re==null?void 0:re.isCamera,ve=de?re:$?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);de||(ve.position.z=5,re&&(applyProps(ve,re),ve.manual||("aspect"in re||"left"in re||"right"in re||"bottom"in re||"top"in re)&&(ve.manual=!0,ve.updateProjectionMatrix())),!ue.camera&&!(re!=null&&re.rotation)&&ve.lookAt(0,0,0)),ue.set({camera:ve}),Se.camera=ve}if(!ue.scene){let de;Y!=null&&Y.isScene?(de=Y,prepare$1(de,d,"",{})):(de=new Scene,prepare$1(de,d,"",{}),Y&&applyProps(de,Y)),ue.set({scene:de})}J&&!ue.events.handlers&&ue.set({events:J(d)});const Be=computeInitialSize(n,V);if(is.equ(Be,ue.size,shallowLoose)||ue.setSize(Be.width,Be.height,Be.top,Be.left),ne&&ue.viewport.dpr!==calculateDpr(ne)&&ue.setDpr(ne),ue.frameloop!==ie&&ue.setFrameloop(ie),ue.onPointerMissed||ue.set({onPointerMissed:ce}),ee&&!is.equ(ee,ue.performance,shallowLoose)&&ue.set(de=>({performance:{...de.performance,...ee}})),!ue.xr){var xe;const de=(Ae,Xe)=>{const Te=d.getState();Te.frameloop!=="never"&&advance(Ae,!0,Te,Xe)},ve=()=>{const Ae=d.getState();Ae.gl.xr.enabled=Ae.gl.xr.isPresenting,Ae.gl.xr.setAnimationLoop(Ae.gl.xr.isPresenting?de:null),Ae.gl.xr.isPresenting||invalidate(Ae)},le={connect(){const Ae=d.getState().gl;Ae.xr.addEventListener("sessionstart",ve),Ae.xr.addEventListener("sessionend",ve)},disconnect(){const Ae=d.getState().gl;Ae.xr.removeEventListener("sessionstart",ve),Ae.xr.removeEventListener("sessionend",ve)}};typeof((xe=ye.xr)==null?void 0:xe.addEventListener)=="function"&&le.connect(),ue.set({xr:le})}if(ye.shadowMap){const de=ye.shadowMap.enabled,ve=ye.shadowMap.type;if(ye.shadowMap.enabled=!!L,is.boo(L))ye.shadowMap.type=PCFSoftShadowMap;else if(is.str(L)){var ge;const le={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};ye.shadowMap.type=(ge=le[L])!=null?ge:PCFSoftShadowMap}else is.obj(L)&&Object.assign(ye.shadowMap,L);(de!==ye.shadowMap.enabled||ve!==ye.shadowMap.type)&&(ye.shadowMap.needsUpdate=!0)}return ColorManagement.enabled=!P,A||(ye.outputColorSpace=z?LinearSRGBColorSpace:SRGBColorSpace,ye.toneMapping=K?NoToneMapping:ACESFilmicToneMapping),ue.legacy!==P&&ue.set(()=>({legacy:P})),ue.linear!==z&&ue.set(()=>({linear:z})),ue.flat!==K&&ue.set(()=>({flat:K})),w&&!is.fun(w)&&!isRenderer(w)&&!is.equ(w,ye,shallowLoose)&&applyProps(ye,w),I=T,A=!0,Z(),this},render(B){return!A&&!G&&this.configure(),G.then(()=>{reconciler.updateContainer(jsxRuntimeExports.jsx(Provider,{store:d,children:B,onCreated:I,rootElement:n}),C,null,()=>{})}),d},unmount(){unmountComponentAtNode(n)}}}function Provider({store:n,children:t,onCreated:o,rootElement:r}){return useIsomorphicLayoutEffect(()=>{const u=n.getState();u.set(d=>({internal:{...d.internal,active:!0}})),o&&o(u),n.getState().events.connected||u.events.connect==null||u.events.connect(r)},[]),jsxRuntimeExports.jsx(context.Provider,{value:n,children:t})}function unmountComponentAtNode(n,t){const o=_roots.get(n),r=o==null?void 0:o.fiber;if(r){const u=o==null?void 0:o.store.getState();u&&(u.internal.active=!1),reconciler.updateContainer(null,r,null,()=>{u&&setTimeout(()=>{try{var d,C,I,f;u.events.disconnect==null||u.events.disconnect(),(d=u.gl)==null||(C=d.renderLists)==null||C.dispose==null||C.dispose(),(I=u.gl)==null||I.forceContextLoss==null||I.forceContextLoss(),(f=u.gl)!=null&&f.xr&&u.xr.disconnect(),dispose(u.scene),_roots.delete(n)}catch{}},500)})}}const globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;function run(n,t){if(n.size)for(const{callback:o}of n.values())o(t)}function flushGlobalEffects(n,t){switch(n){case"before":return run(globalEffects,t);case"after":return run(globalAfterEffects,t);case"tail":return run(globalTailEffects,t)}}let subscribers,subscription;function update(n,t,o){let r=t.clock.getDelta();t.frameloop==="never"&&typeof n=="number"&&(r=n-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=n),subscribers=t.internal.subscribers;for(let u=0;u<subscribers.length;u++)subscription=subscribers[u],subscription.ref.current(subscription.store.getState(),r,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let running=!1,useFrameInProgress=!1,repeat,frame,state;function loop(n){frame=requestAnimationFrame(loop),running=!0,repeat=0,flushGlobalEffects("before",n),useFrameInProgress=!0;for(const o of _roots.values()){var t;state=o.store.getState(),state.internal.active&&(state.frameloop==="always"||state.internal.frames>0)&&!((t=state.gl.xr)!=null&&t.isPresenting)&&(repeat+=update(n,state))}if(useFrameInProgress=!1,flushGlobalEffects("after",n),repeat===0)return flushGlobalEffects("tail",n),running=!1,cancelAnimationFrame(frame)}function invalidate(n,t=1){var o;if(!n)return _roots.forEach(r=>invalidate(r.store.getState(),t));(o=n.gl.xr)!=null&&o.isPresenting||!n.internal.active||n.frameloop==="never"||(t>1?n.internal.frames=Math.min(60,n.internal.frames+t):useFrameInProgress?n.internal.frames=2:n.internal.frames=1,running||(running=!0,requestAnimationFrame(loop)))}function advance(n,t=!0,o,r){if(t&&flushGlobalEffects("before",n),o)update(n,o,r);else for(const u of _roots.values())update(n,u.store.getState());t&&flushGlobalEffects("after",n)}const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(n){const{handlePointer:t}=createEvents(n);return{priority:1,enabled:!0,compute(o,r,u){r.pointer.set(o.offsetX/r.size.width*2-1,-(o.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((o,r)=>({...o,[r]:t(r)}),{}),update:()=>{var o;const{events:r,internal:u}=n.getState();(o=u.lastEvent)!=null&&o.current&&r.handlers&&r.handlers.onPointerMove(u.lastEvent.current)},connect:o=>{const{set:r,events:u}=n.getState();if(u.disconnect==null||u.disconnect(),r(d=>({events:{...d.events,connected:o}})),u.handlers)for(const d in u.handlers){const C=u.handlers[d],[I,f]=DOM_EVENTS[d];o.addEventListener(I,C,{passive:f})}},disconnect:()=>{const{set:o,events:r}=n.getState();if(r.connected){if(r.handlers)for(const u in r.handlers){const d=r.handlers[u],[C]=DOM_EVENTS[u];r.connected.removeEventListener(C,d)}o(u=>({events:{...u.events,connected:void 0}}))}}}}function g(n,t){let o;return(...r)=>{window.clearTimeout(o),o=window.setTimeout(()=>n(...r),t)}}function j({debounce:n,scroll:t,polyfill:o,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const u=o||(typeof window>"u"?class{}:window.ResizeObserver);if(!u)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[d,C]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),I=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:d,orientationHandler:null}),f=n?typeof n=="number"?n:n.scroll:null,A=n?typeof n=="number"?n:n.resize:null,G=reactExports.useRef(!1);reactExports.useEffect(()=>(G.current=!0,()=>void(G.current=!1)));const[B,Z,w]=reactExports.useMemo(()=>{const T=()=>{if(!I.current.element)return;const{left:L,top:z,width:K,height:P,bottom:$,right:ie,x:ne,y:ee}=I.current.element.getBoundingClientRect(),se={left:L,top:z,width:K,height:P,bottom:$,right:ie,x:ne,y:ee};I.current.element instanceof HTMLElement&&r&&(se.height=I.current.element.offsetHeight,se.width=I.current.element.offsetWidth),Object.freeze(se),G.current&&!D(I.current.lastBounds,se)&&C(I.current.lastBounds=se)};return[T,A?g(T,A):T,f?g(T,f):T]},[C,r,f,A]);function V(){I.current.scrollContainers&&(I.current.scrollContainers.forEach(T=>T.removeEventListener("scroll",w,!0)),I.current.scrollContainers=null),I.current.resizeObserver&&(I.current.resizeObserver.disconnect(),I.current.resizeObserver=null),I.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",I.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",I.current.orientationHandler))}function Y(){I.current.element&&(I.current.resizeObserver=new u(w),I.current.resizeObserver.observe(I.current.element),t&&I.current.scrollContainers&&I.current.scrollContainers.forEach(T=>T.addEventListener("scroll",w,{capture:!0,passive:!0})),I.current.orientationHandler=()=>{w()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",I.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",I.current.orientationHandler))}const J=T=>{!T||T===I.current.element||(V(),I.current.element=T,I.current.scrollContainers=E(T),Y())};return X(w,!!t),W(Z),reactExports.useEffect(()=>{V(),Y()},[t,w,Z]),reactExports.useEffect(()=>V,[]),[J,d,B]}function W(n){reactExports.useEffect(()=>{const t=n;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[n])}function X(n,t){reactExports.useEffect(()=>{if(t){const o=n;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[n,t])}function E(n){const t=[];if(!n||n===document.body)return t;const{overflow:o,overflowX:r,overflowY:u}=window.getComputedStyle(n);return[o,r,u].some(d=>d==="auto"||d==="scroll")&&t.push(n),[...t,...E(n.parentElement)]}const k=["x","y","top","bottom","left","right","width","height"],D=(n,t)=>k.every(o=>n[o]===t[o]);function CanvasImpl({ref:n,children:t,fallback:o,resize:r,style:u,gl:d,events:C=createPointerEvents,eventSource:I,eventPrefix:f,shadows:A,linear:G,flat:B,legacy:Z,orthographic:w,frameloop:V,dpr:Y,performance:J,raycaster:T,camera:L,scene:z,onPointerMissed:K,onCreated:P,...$}){reactExports.useMemo(()=>extend(THREE),[]);const ie=useBridge(),[ne,ee]=j({scroll:!0,debounce:{scroll:50,resize:0},...r}),se=reactExports.useRef(null),re=reactExports.useRef(null);reactExports.useImperativeHandle(n,()=>se.current);const ce=useMutableCallback(K),[ue,ye]=reactExports.useState(!1),[Se,Ce]=reactExports.useState(!1);if(ue)throw ue;if(Se)throw Se;const Ze=reactExports.useRef(null);useIsomorphicLayoutEffect(()=>{const xe=se.current;if(ee.width>0&&ee.height>0&&xe){Ze.current||(Ze.current=createRoot(xe));async function ge(){await Ze.current.configure({gl:d,scene:z,events:C,shadows:A,linear:G,flat:B,legacy:Z,orthographic:w,frameloop:V,dpr:Y,performance:J,raycaster:T,camera:L,size:ee,onPointerMissed:(...de)=>ce.current==null?void 0:ce.current(...de),onCreated:de=>{de.events.connect==null||de.events.connect(I?isRef(I)?I.current:I:re.current),f&&de.setEvents({compute:(ve,le)=>{const Ae=ve[f+"X"],Xe=ve[f+"Y"];le.pointer.set(Ae/le.size.width*2-1,-(Xe/le.size.height)*2+1),le.raycaster.setFromCamera(le.pointer,le.camera)}}),P==null||P(de)}}),Ze.current.render(jsxRuntimeExports.jsx(ie,{children:jsxRuntimeExports.jsx(ErrorBoundary,{set:Ce,children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Block,{set:ye}),children:t??null})})}))}ge()}}),reactExports.useEffect(()=>{const xe=se.current;if(xe)return()=>unmountComponentAtNode(xe)},[]);const Be=I?"none":"auto";return jsxRuntimeExports.jsx("div",{ref:re,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Be,...u},...$,children:jsxRuntimeExports.jsx("div",{ref:ne,style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:se,style:{display:"block"},children:o})})})}function Canvas(n){return jsxRuntimeExports.jsx(m$1,{children:jsxRuntimeExports.jsx(CanvasImpl,{...n})})}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(t,o,r){return Function.prototype.apply.call(t,o,r)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(n){console&&console.warn&&console.warn(n)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(n){if(typeof n!="number"||n<0||NumberIsNaN(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");defaultMaxListeners=n}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(n){return n._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:n._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(t){for(var o=[],r=1;r<arguments.length;r++)o.push(arguments[r]);var u=t==="error",d=this._events;if(d!==void 0)u=u&&d.error===void 0;else if(!u)return!1;if(u){var C;if(o.length>0&&(C=o[0]),C instanceof Error)throw C;var I=new Error("Unhandled error."+(C?" ("+C.message+")":""));throw I.context=C,I}var f=d[t];if(f===void 0)return!1;if(typeof f=="function")ReflectApply(f,this,o);else for(var A=f.length,G=arrayClone(f,A),r=0;r<A;++r)ReflectApply(G[r],this,o);return!0};function _addListener(n,t,o,r){var u,d,C;if(checkListener(o),d=n._events,d===void 0?(d=n._events=Object.create(null),n._eventsCount=0):(d.newListener!==void 0&&(n.emit("newListener",t,o.listener?o.listener:o),d=n._events),C=d[t]),C===void 0)C=d[t]=o,++n._eventsCount;else if(typeof C=="function"?C=d[t]=r?[o,C]:[C,o]:r?C.unshift(o):C.push(o),u=_getMaxListeners(n),u>0&&C.length>u&&!C.warned){C.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=n,I.type=t,I.count=C.length,ProcessEmitWarning(I)}return n}EventEmitter$1.prototype.addListener=function(t,o){return _addListener(this,t,o,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(t,o){return _addListener(this,t,o,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(n,t,o){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:o},u=onceWrapper.bind(r);return u.listener=o,r.wrapFn=u,u}EventEmitter$1.prototype.once=function(t,o){return checkListener(o),this.on(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.prependOnceListener=function(t,o){return checkListener(o),this.prependListener(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.removeListener=function(t,o){var r,u,d,C,I;if(checkListener(o),u=this._events,u===void 0)return this;if(r=u[t],r===void 0)return this;if(r===o||r.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete u[t],u.removeListener&&this.emit("removeListener",t,r.listener||o));else if(typeof r!="function"){for(d=-1,C=r.length-1;C>=0;C--)if(r[C]===o||r[C].listener===o){I=r[C].listener,d=C;break}if(d<0)return this;d===0?r.shift():spliceOne(r,d),r.length===1&&(u[t]=r[0]),u.removeListener!==void 0&&this.emit("removeListener",t,I||o)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(t){var o,r,u;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var d=Object.keys(r),C;for(u=0;u<d.length;++u)C=d[u],C!=="removeListener"&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=r[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(u=o.length-1;u>=0;u--)this.removeListener(t,o[u]);return this};function _listeners(n,t,o){var r=n._events;if(r===void 0)return[];var u=r[t];return u===void 0?[]:typeof u=="function"?o?[u.listener||u]:[u]:o?unwrapListeners(u):arrayClone(u,u.length)}EventEmitter$1.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter$1.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter$1.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):listenerCount.call(n,t)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(n){var t=this._events;if(t!==void 0){var o=t[n];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(n,t){for(var o=new Array(t),r=0;r<t;++r)o[r]=n[r];return o}function spliceOne(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function unwrapListeners(n){for(var t=new Array(n.length),o=0;o<t.length;++o)t[o]=n[o].listener||n[o];return t}function once(n,t){return new Promise(function(o,r){function u(C){n.removeListener(t,d),r(C)}function d(){typeof n.removeListener=="function"&&n.removeListener("error",u),o([].slice.call(arguments))}eventTargetAgnosticAddListener(n,t,d,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(n,u,{once:!0})})}function addErrorHandlerIfEventEmitter(n,t,o){typeof n.on=="function"&&eventTargetAgnosticAddListener(n,"error",t,o)}function eventTargetAgnosticAddListener(n,t,o,r){if(typeof n.on=="function")r.once?n.once(t,o):n.on(t,o);else if(typeof n.addEventListener=="function")n.addEventListener(t,function u(d){r.once&&n.removeEventListener(t,u),o(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var EventEmitter$1$1=events.exports;function decodeBase64(n,t){var o=atob(n);if(t){for(var r=new Uint8Array(o.length),u=0,d=o.length;u<d;++u)r[u]=o.charCodeAt(u);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return o}function createURL(n,t,o){var r=t===void 0?null:t,u=o===void 0?!1:o,d=decodeBase64(n,u),C=d.indexOf(`
`,10)+1,I=d.substring(C)+(r?"//# sourceMappingURL="+r:""),f=new Blob([I],{type:"application/javascript"});return URL.createObjectURL(f)}function createBase64WorkerFactory(n,t,o){var r;return function(d){return r=r||createURL(n,t,o),new Worker(r,d)}}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class CannonWorkerAPI extends EventEmitter$1$1{constructor(o){let{allowSleep:r=!1,axisIndex:u=0,broadphase:d="Naive",defaultContactMaterial:C={contactEquationStiffness:1e6},frictionGravity:I=null,gravity:f=[0,-9.81,0],iterations:A=5,quatNormalizeFast:G=!1,quatNormalizeSkip:B=0,size:Z=1e3,solver:w="GS",tolerance:V=.001}=o;super();jh(this,"messageQueue",[]);jh(this,"worker",null);this.config={allowSleep:r,axisIndex:u,broadphase:d,defaultContactMaterial:C,frictionGravity:I,gravity:f,iterations:A,quatNormalizeFast:G,quatNormalizeSkip:B,size:Z,solver:w,tolerance:V},this.buffers={positions:new Float32Array(Z*3),quaternions:new Float32Array(Z*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(o){this.config.axisIndex=o,this.postMessage({op:"setAxisIndex",props:o})}get broadphase(){return this.config.broadphase}set broadphase(o){this.config.broadphase=o,this.postMessage({op:"setBroadphase",props:o})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(o){this.config.frictionGravity=o,this.postMessage({op:"setFrictionGravity",props:o})}get gravity(){return this.config.gravity}set gravity(o){this.config.gravity=o,this.postMessage({op:"setGravity",props:o})}get iterations(){return this.config.iterations}set iterations(o){this.config.iterations=o,this.postMessage({op:"setIterations",props:o})}get tolerance(){return this.config.tolerance}set tolerance(o){this.config.tolerance=o,this.postMessage({op:"setTolerance",props:o})}addBodies(o){let{props:r,type:u,uuid:d}=o;this.postMessage({op:"addBodies",props:r,type:u,uuid:d})}addConstraint(o){let{props:[r,u,d],type:C,uuid:I}=o;this.postMessage({op:"addConstraint",props:[r,u,d],type:C,uuid:I})}addContactMaterial(o){let{props:r,uuid:u}=o;this.postMessage({op:"addContactMaterial",props:r,uuid:u})}addRay(o){let{props:r,uuid:u}=o;this.postMessage({op:"addRay",props:r,uuid:u})}addRaycastVehicle(o){let{props:[r,u,d,C,I,f],uuid:A}=o;this.postMessage({op:"addRaycastVehicle",props:[r,u,d,C,I,f],uuid:A})}addSpring(o){let{props:[r,u,d],uuid:C}=o;this.postMessage({op:"addSpring",props:[r,u,d],uuid:C})}applyForce(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyForce",props:r,uuid:u})}applyImpulse(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyImpulse",props:r,uuid:u})}applyLocalForce(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyLocalForce",props:r,uuid:u})}applyLocalImpulse(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyLocalImpulse",props:r,uuid:u})}applyRaycastVehicleEngineForce(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyRaycastVehicleEngineForce",props:r,uuid:u})}applyTorque(o){let{props:r,uuid:u}=o;this.postMessage({op:"applyTorque",props:r,uuid:u})}connect(){this.worker=new WorkerFactory,this.worker.onmessage=o=>{if(o.data.op==="frame"){this.buffers.positions=o.data.positions,this.buffers.quaternions=o.data.quaternions,this.emit(o.data.op,o.data);return}this.emit(o.data.type,o.data)};for(const o of this.messageQueue)this.worker.postMessage(o);this.messageQueue.length=0}disableConstraint(o){let{uuid:r}=o;this.postMessage({op:"disableConstraint",uuid:r})}disableConstraintMotor(o){let{uuid:r}=o;this.postMessage({op:"disableConstraintMotor",uuid:r})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(o){let{uuid:r}=o;this.postMessage({op:"enableConstraint",uuid:r})}enableConstraintMotor(o){let{uuid:r}=o;this.postMessage({op:"enableConstraintMotor",uuid:r})}init(){const{allowSleep:o,axisIndex:r,broadphase:u,defaultContactMaterial:d,frictionGravity:C,gravity:I,iterations:f,quatNormalizeFast:A,quatNormalizeSkip:G,solver:B,tolerance:Z}=this.config;this.postMessage({op:"init",props:{allowSleep:o,axisIndex:r,broadphase:u,defaultContactMaterial:d,frictionGravity:C,gravity:I,iterations:f,quatNormalizeFast:A,quatNormalizeSkip:G,solver:B,tolerance:Z}})}removeBodies(o){let{uuid:r}=o;this.postMessage({op:"removeBodies",uuid:r})}removeConstraint(o){let{uuid:r}=o;this.postMessage({op:"removeConstraint",uuid:r})}removeContactMaterial(o){let{uuid:r}=o;this.postMessage({op:"removeContactMaterial",uuid:r})}removeRay(o){let{uuid:r}=o;this.postMessage({op:"removeRay",uuid:r})}removeRaycastVehicle(o){let{uuid:r}=o;this.postMessage({op:"removeRaycastVehicle",uuid:r})}removeSpring(o){let{uuid:r}=o;this.postMessage({op:"removeSpring",uuid:r})}setAllowSleep(o){let{props:r,uuid:u}=o;this.postMessage({op:"setAllowSleep",props:r,uuid:u})}setAngularDamping(o){let{props:r,uuid:u}=o;this.postMessage({op:"setAngularDamping",props:r,uuid:u})}setAngularFactor(o){let{props:r,uuid:u}=o;this.postMessage({op:"setAngularFactor",props:r,uuid:u})}setAngularVelocity(o){let{props:r,uuid:u}=o;this.postMessage({op:"setAngularVelocity",props:r,uuid:u})}setCollisionFilterGroup(o){let{props:r,uuid:u}=o;this.postMessage({op:"setCollisionFilterGroup",props:r,uuid:u})}setCollisionFilterMask(o){let{props:r,uuid:u}=o;this.postMessage({op:"setCollisionFilterMask",props:r,uuid:u})}setCollisionResponse(o){let{props:r,uuid:u}=o;this.postMessage({op:"setCollisionResponse",props:r,uuid:u})}setConstraintMotorMaxForce(o){let{props:r,uuid:u}=o;this.postMessage({op:"setConstraintMotorMaxForce",props:r,uuid:u})}setConstraintMotorSpeed(o){let{props:r,uuid:u}=o;this.postMessage({op:"setConstraintMotorSpeed",props:r,uuid:u})}setFixedRotation(o){let{props:r,uuid:u}=o;this.postMessage({op:"setFixedRotation",props:r,uuid:u})}setIsTrigger(o){let{props:r,uuid:u}=o;this.postMessage({op:"setIsTrigger",props:r,uuid:u})}setLinearDamping(o){let{props:r,uuid:u}=o;this.postMessage({op:"setLinearDamping",props:r,uuid:u})}setLinearFactor(o){let{props:r,uuid:u}=o;this.postMessage({op:"setLinearFactor",props:r,uuid:u})}setMass(o){let{props:r,uuid:u}=o;this.postMessage({op:"setMass",props:r,uuid:u})}setMaterial(o){let{props:r,uuid:u}=o;this.postMessage({op:"setMaterial",props:r,uuid:u})}setPosition(o){let{props:r,uuid:u}=o;this.postMessage({op:"setPosition",props:r,uuid:u})}setQuaternion(o){let{props:[r,u,d,C],uuid:I}=o;this.postMessage({op:"setQuaternion",props:[r,u,d,C],uuid:I})}setRaycastVehicleBrake(o){let{props:r,uuid:u}=o;this.postMessage({op:"setRaycastVehicleBrake",props:r,uuid:u})}setRaycastVehicleSteeringValue(o){let{props:r,uuid:u}=o;this.postMessage({op:"setRaycastVehicleSteeringValue",props:r,uuid:u})}setRotation(o){let{props:r,uuid:u}=o;this.postMessage({op:"setRotation",props:r,uuid:u})}setSleepSpeedLimit(o){let{props:r,uuid:u}=o;this.postMessage({op:"setSleepSpeedLimit",props:r,uuid:u})}setSleepTimeLimit(o){let{props:r,uuid:u}=o;this.postMessage({op:"setSleepTimeLimit",props:r,uuid:u})}setSpringDamping(o){let{props:r,uuid:u}=o;this.postMessage({op:"setSpringDamping",props:r,uuid:u})}setSpringRestLength(o){let{props:r,uuid:u}=o;this.postMessage({op:"setSpringRestLength",props:r,uuid:u})}setSpringStiffness(o){let{props:r,uuid:u}=o;this.postMessage({op:"setSpringStiffness",props:r,uuid:u})}setUserData(o){let{props:r,uuid:u}=o;this.postMessage({op:"setUserData",props:r,uuid:u})}setVelocity(o){let{props:r,uuid:u}=o;this.postMessage({op:"setVelocity",props:r,uuid:u})}sleep(o){let{uuid:r}=o;this.postMessage({op:"sleep",uuid:r})}step(o){var r;const{buffers:{positions:u,quaternions:d}}=this;!u.byteLength&&!d.byteLength||(r=this.worker)==null||r.postMessage({op:"step",positions:u,props:o,quaternions:d},[u.buffer,d.buffer])}subscribe(o){let{props:{id:r,target:u,type:d},uuid:C}=o;this.postMessage({op:"subscribe",props:{id:r,target:u,type:d},uuid:C})}terminate(){var o;(o=this.worker)==null||o.terminate(),this.worker=null}unsubscribe(o){let{props:r}=o;this.postMessage({op:"unsubscribe",props:r})}wakeUp(o){let{uuid:r}=o;this.postMessage({op:"wakeUp",uuid:r})}postMessage(o){if(this.worker)return this.worker.postMessage(o);this.messageQueue.push(o)}}class Mat3$1{constructor(t){t===void 0&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const o=this.elements;o[0]=t.x,o[4]=t.y,o[8]=t.z}getTrace(t){t===void 0&&(t=new Vec3$1);const o=this.elements;return t.x=o[0],t.y=o[4],t.z=o[8],t}vmult(t,o){o===void 0&&(o=new Vec3$1);const r=this.elements,u=t.x,d=t.y,C=t.z;return o.x=r[0]*u+r[1]*d+r[2]*C,o.y=r[3]*u+r[4]*d+r[5]*C,o.z=r[6]*u+r[7]*d+r[8]*C,o}smult(t){for(let o=0;o<this.elements.length;o++)this.elements[o]*=t}mmult(t,o){o===void 0&&(o=new Mat3$1);const r=this.elements,u=t.elements,d=o.elements,C=r[0],I=r[1],f=r[2],A=r[3],G=r[4],B=r[5],Z=r[6],w=r[7],V=r[8],Y=u[0],J=u[1],T=u[2],L=u[3],z=u[4],K=u[5],P=u[6],$=u[7],ie=u[8];return d[0]=C*Y+I*L+f*P,d[1]=C*J+I*z+f*$,d[2]=C*T+I*K+f*ie,d[3]=A*Y+G*L+B*P,d[4]=A*J+G*z+B*$,d[5]=A*T+G*K+B*ie,d[6]=Z*Y+w*L+V*P,d[7]=Z*J+w*z+V*$,d[8]=Z*T+w*K+V*ie,o}scale(t,o){o===void 0&&(o=new Mat3$1);const r=this.elements,u=o.elements;for(let d=0;d!==3;d++)u[3*d+0]=t.x*r[3*d+0],u[3*d+1]=t.y*r[3*d+1],u[3*d+2]=t.z*r[3*d+2];return o}solve(t,o){o===void 0&&(o=new Vec3$1);const r=3,u=4,d=[];let C,I;for(C=0;C<r*u;C++)d.push(0);for(C=0;C<3;C++)for(I=0;I<3;I++)d[C+u*I]=this.elements[C+3*I];d[3+4*0]=t.x,d[3+4*1]=t.y,d[3+4*2]=t.z;let f=3;const A=f;let G;const B=4;let Z;do{if(C=A-f,d[C+u*C]===0){for(I=C+1;I<A;I++)if(d[C+u*I]!==0){G=B;do Z=B-G,d[Z+u*C]+=d[Z+u*I];while(--G);break}}if(d[C+u*C]!==0)for(I=C+1;I<A;I++){const w=d[C+u*I]/d[C+u*C];G=B;do Z=B-G,d[Z+u*I]=Z<=C?0:d[Z+u*I]-d[Z+u*C]*w;while(--G)}}while(--f);if(o.z=d[2*u+3]/d[2*u+2],o.y=(d[1*u+3]-d[1*u+2]*o.z)/d[1*u+1],o.x=(d[0*u+3]-d[0*u+2]*o.z-d[0*u+1]*o.y)/d[0*u+0],isNaN(o.x)||isNaN(o.y)||isNaN(o.z)||o.x===1/0||o.y===1/0||o.z===1/0)throw`Could not solve equation! Got x=[${o.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return o}e(t,o,r){if(r===void 0)return this.elements[o+3*t];this.elements[o+3*t]=r}copy(t){for(let o=0;o<t.elements.length;o++)this.elements[o]=t.elements[o];return this}toString(){let t="";const o=",";for(let r=0;r<9;r++)t+=this.elements[r]+o;return t}reverse(t){t===void 0&&(t=new Mat3$1);const o=3,r=6,u=reverse_eqns$1;let d,C;for(d=0;d<3;d++)for(C=0;C<3;C++)u[d+r*C]=this.elements[d+3*C];u[3+6*0]=1,u[3+6*1]=0,u[3+6*2]=0,u[4+6*0]=0,u[4+6*1]=1,u[4+6*2]=0,u[5+6*0]=0,u[5+6*1]=0,u[5+6*2]=1;let I=3;const f=I;let A;const G=r;let B;do{if(d=f-I,u[d+r*d]===0){for(C=d+1;C<f;C++)if(u[d+r*C]!==0){A=G;do B=G-A,u[B+r*d]+=u[B+r*C];while(--A);break}}if(u[d+r*d]!==0)for(C=d+1;C<f;C++){const Z=u[d+r*C]/u[d+r*d];A=G;do B=G-A,u[B+r*C]=B<=d?0:u[B+r*C]-u[B+r*d]*Z;while(--A)}}while(--I);d=2;do{C=d-1;do{const Z=u[d+r*C]/u[d+r*d];A=r;do B=r-A,u[B+r*C]=u[B+r*C]-u[B+r*d]*Z;while(--A)}while(C--)}while(--d);d=2;do{const Z=1/u[d+r*d];A=r;do B=r-A,u[B+r*d]=u[B+r*d]*Z;while(--A)}while(d--);d=2;do{C=2;do{if(B=u[o+C+r*d],isNaN(B)||B===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(d,C,B)}while(C--)}while(d--);return t}setRotationFromQuaternion(t){const o=t.x,r=t.y,u=t.z,d=t.w,C=o+o,I=r+r,f=u+u,A=o*C,G=o*I,B=o*f,Z=r*I,w=r*f,V=u*f,Y=d*C,J=d*I,T=d*f,L=this.elements;return L[3*0+0]=1-(Z+V),L[3*0+1]=G-T,L[3*0+2]=B+J,L[3*1+0]=G+T,L[3*1+1]=1-(A+V),L[3*1+2]=w-Y,L[3*2+0]=B-J,L[3*2+1]=w+Y,L[3*2+2]=1-(A+Z),this}transpose(t){t===void 0&&(t=new Mat3$1);const o=this.elements,r=t.elements;let u;return r[0]=o[0],r[4]=o[4],r[8]=o[8],u=o[1],r[1]=o[3],r[3]=u,u=o[2],r[2]=o[6],r[6]=u,u=o[5],r[5]=o[7],r[7]=u,t}}const reverse_eqns$1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3$1{constructor(t,o,r){t===void 0&&(t=0),o===void 0&&(o=0),r===void 0&&(r=0),this.x=t,this.y=o,this.z=r}cross(t,o){o===void 0&&(o=new Vec3$1);const r=t.x,u=t.y,d=t.z,C=this.x,I=this.y,f=this.z;return o.x=I*d-f*u,o.y=f*r-C*d,o.z=C*u-I*r,o}set(t,o,r){return this.x=t,this.y=o,this.z=r,this}setZero(){this.x=this.y=this.z=0}vadd(t,o){if(o)o.x=t.x+this.x,o.y=t.y+this.y,o.z=t.z+this.z;else return new Vec3$1(this.x+t.x,this.y+t.y,this.z+t.z)}vsub(t,o){if(o)o.x=this.x-t.x,o.y=this.y-t.y,o.z=this.z-t.z;else return new Vec3$1(this.x-t.x,this.y-t.y,this.z-t.z)}crossmat(){return new Mat3$1([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,o=this.y,r=this.z,u=Math.sqrt(t*t+o*o+r*r);if(u>0){const d=1/u;this.x*=d,this.y*=d,this.z*=d}else this.x=0,this.y=0,this.z=0;return u}unit(t){t===void 0&&(t=new Vec3$1);const o=this.x,r=this.y,u=this.z;let d=Math.sqrt(o*o+r*r+u*u);return d>0?(d=1/d,t.x=o*d,t.y=r*d,t.z=u*d):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,o=this.y,r=this.z;return Math.sqrt(t*t+o*o+r*r)}lengthSquared(){return this.dot(this)}distanceTo(t){const o=this.x,r=this.y,u=this.z,d=t.x,C=t.y,I=t.z;return Math.sqrt((d-o)*(d-o)+(C-r)*(C-r)+(I-u)*(I-u))}distanceSquared(t){const o=this.x,r=this.y,u=this.z,d=t.x,C=t.y,I=t.z;return(d-o)*(d-o)+(C-r)*(C-r)+(I-u)*(I-u)}scale(t,o){o===void 0&&(o=new Vec3$1);const r=this.x,u=this.y,d=this.z;return o.x=t*r,o.y=t*u,o.z=t*d,o}vmul(t,o){return o===void 0&&(o=new Vec3$1),o.x=t.x*this.x,o.y=t.y*this.y,o.z=t.z*this.z,o}addScaledVector(t,o,r){return r===void 0&&(r=new Vec3$1),r.x=this.x+t*o.x,r.y=this.y+t*o.y,r.z=this.z+t*o.z,r}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(t){return t===void 0&&(t=new Vec3$1),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,o){const r=this.length();if(r>0){const u=Vec3_tangents_n$1,d=1/r;u.set(this.x*d,this.y*d,this.z*d);const C=Vec3_tangents_randVec$1;Math.abs(u.x)<.9?(C.set(1,0,0),u.cross(C,t)):(C.set(0,1,0),u.cross(C,t)),u.cross(t,o)}else t.set(1,0,0),o.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,o,r){const u=this.x,d=this.y,C=this.z;r.x=u+(t.x-u)*o,r.y=d+(t.y-d)*o,r.z=C+(t.z-C)*o}almostEquals(t,o){return o===void 0&&(o=1e-6),!(Math.abs(this.x-t.x)>o||Math.abs(this.y-t.y)>o||Math.abs(this.z-t.z)>o)}almostZero(t){return t===void 0&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,o){return this.negate(antip_neg$1),antip_neg$1.almostEquals(t,o)}clone(){return new Vec3$1(this.x,this.y,this.z)}}Vec3$1.ZERO=new Vec3$1(0,0,0);Vec3$1.UNIT_X=new Vec3$1(1,0,0);Vec3$1.UNIT_Y=new Vec3$1(0,1,0);Vec3$1.UNIT_Z=new Vec3$1(0,0,1);const Vec3_tangents_n$1=new Vec3$1,Vec3_tangents_randVec$1=new Vec3$1,antip_neg$1=new Vec3$1;class AABB$1{constructor(t){t===void 0&&(t={}),this.lowerBound=new Vec3$1,this.upperBound=new Vec3$1,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,o,r,u){const d=this.lowerBound,C=this.upperBound,I=r;d.copy(t[0]),I&&I.vmult(d,d),C.copy(d);for(let f=1;f<t.length;f++){let A=t[f];I&&(I.vmult(A,tmp$1$1),A=tmp$1$1),A.x>C.x&&(C.x=A.x),A.x<d.x&&(d.x=A.x),A.y>C.y&&(C.y=A.y),A.y<d.y&&(d.y=A.y),A.z>C.z&&(C.z=A.z),A.z<d.z&&(d.z=A.z)}return o&&(o.vadd(d,d),o.vadd(C,C)),u&&(d.x-=u,d.y-=u,d.z-=u,C.x+=u,C.y+=u,C.z+=u),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return new AABB$1().copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const o=this.lowerBound,r=this.upperBound,u=t.lowerBound,d=t.upperBound,C=u.x<=r.x&&r.x<=d.x||o.x<=d.x&&d.x<=r.x,I=u.y<=r.y&&r.y<=d.y||o.y<=d.y&&d.y<=r.y,f=u.z<=r.z&&r.z<=d.z||o.z<=d.z&&d.z<=r.z;return C&&I&&f}volume(){const t=this.lowerBound,o=this.upperBound;return(o.x-t.x)*(o.y-t.y)*(o.z-t.z)}contains(t){const o=this.lowerBound,r=this.upperBound,u=t.lowerBound,d=t.upperBound;return o.x<=u.x&&r.x>=d.x&&o.y<=u.y&&r.y>=d.y&&o.z<=u.z&&r.z>=d.z}getCorners(t,o,r,u,d,C,I,f){const A=this.lowerBound,G=this.upperBound;t.copy(A),o.set(G.x,A.y,A.z),r.set(G.x,G.y,A.z),u.set(A.x,G.y,G.z),d.set(G.x,A.y,G.z),C.set(A.x,G.y,A.z),I.set(A.x,A.y,G.z),f.copy(G)}toLocalFrame(t,o){const r=transformIntoFrame_corners$1,u=r[0],d=r[1],C=r[2],I=r[3],f=r[4],A=r[5],G=r[6],B=r[7];this.getCorners(u,d,C,I,f,A,G,B);for(let Z=0;Z!==8;Z++){const w=r[Z];t.pointToLocal(w,w)}return o.setFromPoints(r)}toWorldFrame(t,o){const r=transformIntoFrame_corners$1,u=r[0],d=r[1],C=r[2],I=r[3],f=r[4],A=r[5],G=r[6],B=r[7];this.getCorners(u,d,C,I,f,A,G,B);for(let Z=0;Z!==8;Z++){const w=r[Z];t.pointToWorld(w,w)}return o.setFromPoints(r)}overlapsRay(t){const{direction:o,from:r}=t,u=1/o.x,d=1/o.y,C=1/o.z,I=(this.lowerBound.x-r.x)*u,f=(this.upperBound.x-r.x)*u,A=(this.lowerBound.y-r.y)*d,G=(this.upperBound.y-r.y)*d,B=(this.lowerBound.z-r.z)*C,Z=(this.upperBound.z-r.z)*C,w=Math.max(Math.max(Math.min(I,f),Math.min(A,G)),Math.min(B,Z)),V=Math.min(Math.min(Math.max(I,f),Math.max(A,G)),Math.max(B,Z));return!(V<0||w>V)}}const tmp$1$1=new Vec3$1,transformIntoFrame_corners$1=[new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1];class Quaternion$1{constructor(t,o,r,u){t===void 0&&(t=0),o===void 0&&(o=0),r===void 0&&(r=0),u===void 0&&(u=1),this.x=t,this.y=o,this.z=r,this.w=u}set(t,o,r,u){return this.x=t,this.y=o,this.z=r,this.w=u,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,o){const r=Math.sin(o*.5);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(o*.5),this}toAxisAngle(t){t===void 0&&(t=new Vec3$1),this.normalize();const o=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return r<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/r,t.y=this.y/r,t.z=this.z/r),[t,o]}setFromVectors(t,o){if(t.isAntiparallelTo(o)){const r=sfv_t1$1,u=sfv_t2$1;t.tangents(r,u),this.setFromAxisAngle(r,Math.PI)}else{const r=t.cross(o);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(t.length()**2*o.length()**2)+t.dot(o),this.normalize()}return this}mult(t,o){o===void 0&&(o=new Quaternion$1);const r=this.x,u=this.y,d=this.z,C=this.w,I=t.x,f=t.y,A=t.z,G=t.w;return o.x=r*G+C*I+u*A-d*f,o.y=u*G+C*f+d*I-r*A,o.z=d*G+C*A+r*f-u*I,o.w=C*G-r*I-u*f-d*A,o}inverse(t){t===void 0&&(t=new Quaternion$1);const o=this.x,r=this.y,u=this.z,d=this.w;this.conjugate(t);const C=1/(o*o+r*r+u*u+d*d);return t.x*=C,t.y*=C,t.z*=C,t.w*=C,t}conjugate(t){return t===void 0&&(t=new Quaternion$1),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,o){o===void 0&&(o=new Vec3$1);const r=t.x,u=t.y,d=t.z,C=this.x,I=this.y,f=this.z,A=this.w,G=A*r+I*d-f*u,B=A*u+f*r-C*d,Z=A*d+C*u-I*r,w=-C*r-I*u-f*d;return o.x=G*A+w*-C+B*-f-Z*-I,o.y=B*A+w*-I+Z*-C-G*-f,o.z=Z*A+w*-f+G*-I-B*-C,o}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,o){o===void 0&&(o="YZX");let r,u,d;const C=this.x,I=this.y,f=this.z,A=this.w;switch(o){case"YZX":const G=C*I+f*A;if(G>.499&&(r=2*Math.atan2(C,A),u=Math.PI/2,d=0),G<-.499&&(r=-2*Math.atan2(C,A),u=-Math.PI/2,d=0),r===void 0){const B=C*C,Z=I*I,w=f*f;r=Math.atan2(2*I*A-2*C*f,1-2*Z-2*w),u=Math.asin(2*G),d=Math.atan2(2*C*A-2*I*f,1-2*B-2*w)}break;default:throw new Error(`Euler order ${o} not supported yet.`)}t.y=r,t.z=u,t.x=d}setFromEuler(t,o,r,u){u===void 0&&(u="XYZ");const d=Math.cos(t/2),C=Math.cos(o/2),I=Math.cos(r/2),f=Math.sin(t/2),A=Math.sin(o/2),G=Math.sin(r/2);return u==="XYZ"?(this.x=f*C*I+d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I-f*A*G):u==="YXZ"?(this.x=f*C*I+d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I+f*A*G):u==="ZXY"?(this.x=f*C*I-d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I-f*A*G):u==="ZYX"?(this.x=f*C*I-d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I+f*A*G):u==="YZX"?(this.x=f*C*I+d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I-f*A*G):u==="XZY"&&(this.x=f*C*I-d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I+f*A*G),this}clone(){return new Quaternion$1(this.x,this.y,this.z,this.w)}slerp(t,o,r){r===void 0&&(r=new Quaternion$1);const u=this.x,d=this.y,C=this.z,I=this.w;let f=t.x,A=t.y,G=t.z,B=t.w,Z,w,V,Y,J;return w=u*f+d*A+C*G+I*B,w<0&&(w=-w,f=-f,A=-A,G=-G,B=-B),1-w>1e-6?(Z=Math.acos(w),V=Math.sin(Z),Y=Math.sin((1-o)*Z)/V,J=Math.sin(o*Z)/V):(Y=1-o,J=o),r.x=Y*u+J*f,r.y=Y*d+J*A,r.z=Y*C+J*G,r.w=Y*I+J*B,r}integrate(t,o,r,u){u===void 0&&(u=new Quaternion$1);const d=t.x*r.x,C=t.y*r.y,I=t.z*r.z,f=this.x,A=this.y,G=this.z,B=this.w,Z=o*.5;return u.x+=Z*(d*B+C*G-I*A),u.y+=Z*(C*B+I*f-d*G),u.z+=Z*(I*B+d*A-C*f),u.w+=Z*(-d*f-C*A-I*G),u}}const sfv_t1$1=new Vec3$1,sfv_t2$1=new Vec3$1,SHAPE_TYPES$1={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape$1{constructor(t){t===void 0&&(t={}),this.id=Shape$1.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,o){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,o,r,u){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape$1.idCounter=0;Shape$1.types=SHAPE_TYPES$1;class Transform$1{constructor(t){t===void 0&&(t={}),this.position=new Vec3$1,this.quaternion=new Quaternion$1,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,o){return Transform$1.pointToLocalFrame(this.position,this.quaternion,t,o)}pointToWorld(t,o){return Transform$1.pointToWorldFrame(this.position,this.quaternion,t,o)}vectorToWorldFrame(t,o){return o===void 0&&(o=new Vec3$1),this.quaternion.vmult(t,o),o}static pointToLocalFrame(t,o,r,u){return u===void 0&&(u=new Vec3$1),r.vsub(t,u),o.conjugate(tmpQuat$1$1),tmpQuat$1$1.vmult(u,u),u}static pointToWorldFrame(t,o,r,u){return u===void 0&&(u=new Vec3$1),o.vmult(r,u),u.vadd(t,u),u}static vectorToWorldFrame(t,o,r){return r===void 0&&(r=new Vec3$1),t.vmult(o,r),r}static vectorToLocalFrame(t,o,r,u){return u===void 0&&(u=new Vec3$1),o.w*=-1,o.vmult(r,u),o.w*=-1,u}}const tmpQuat$1$1=new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Quaternion$1;new AABB$1;new Mat3$1;new Mat3$1;new Mat3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;class RaycastResult$1{constructor(){this.rayFromWorld=new Vec3$1,this.rayToWorld=new Vec3$1,this.hitNormalWorld=new Vec3$1,this.hitPointWorld=new Vec3$1,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,o,r,u,d,C,I){this.rayFromWorld.copy(t),this.rayToWorld.copy(o),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(u),this.shape=d,this.body=C,this.distance=I}}let _Shape$types$SPHERE$1,_Shape$types$PLANE$1,_Shape$types$BOX$1,_Shape$types$CYLINDER$1,_Shape$types$CONVEXPO$1,_Shape$types$HEIGHTFI$1,_Shape$types$TRIMESH$1;const RAY_MODES$1={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE$1=Shape$1.types.SPHERE;_Shape$types$PLANE$1=Shape$1.types.PLANE;_Shape$types$BOX$1=Shape$1.types.BOX;_Shape$types$CYLINDER$1=Shape$1.types.CYLINDER;_Shape$types$CONVEXPO$1=Shape$1.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI$1=Shape$1.types.HEIGHTFIELD;_Shape$types$TRIMESH$1=Shape$1.types.TRIMESH;class Ray$1{get[_Shape$types$SPHERE$1](){return this._intersectSphere}get[_Shape$types$PLANE$1](){return this._intersectPlane}get[_Shape$types$BOX$1](){return this._intersectBox}get[_Shape$types$CYLINDER$1](){return this._intersectConvex}get[_Shape$types$CONVEXPO$1](){return this._intersectConvex}get[_Shape$types$HEIGHTFI$1](){return this._intersectHeightfield}get[_Shape$types$TRIMESH$1](){return this._intersectTrimesh}constructor(t,o){t===void 0&&(t=new Vec3$1),o===void 0&&(o=new Vec3$1),this.from=t.clone(),this.to=o.clone(),this.direction=new Vec3$1,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray$1.ANY,this.result=new RaycastResult$1,this.hasHit=!1,this.callback=r=>{}}intersectWorld(t,o){return this.mode=o.mode||Ray$1.ANY,this.result=o.result||new RaycastResult$1,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=typeof o.collisionFilterMask<"u"?o.collisionFilterMask:-1,this.collisionFilterGroup=typeof o.collisionFilterGroup<"u"?o.collisionFilterGroup:-1,this.checkCollisionResponse=typeof o.checkCollisionResponse<"u"?o.checkCollisionResponse:!0,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1$1),tmpArray$1.length=0,t.broadphase.aabbQuery(t,tmpAABB$1$1,tmpArray$1),this.intersectBodies(tmpArray$1),this.hasHit}intersectBody(t,o){o&&(this.result=o,this.updateDirection());const r=this.checkCollisionResponse;if(r&&!t.collisionResponse||(this.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&this.collisionFilterMask)===0)return;const u=intersectBody_xi$1,d=intersectBody_qi$1;for(let C=0,I=t.shapes.length;C<I;C++){const f=t.shapes[C];if(!(r&&!f.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[C],d),t.quaternion.vmult(t.shapeOffsets[C],u),u.vadd(t.position,u),this.intersectShape(f,d,u,t),this.result.shouldStop))break}}intersectBodies(t,o){o&&(this.result=o,this.updateDirection());for(let r=0,u=t.length;!this.result.shouldStop&&r<u;r++)this.intersectBody(t[r])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,o,r,u){const d=this.from;if(distanceFromIntersection$1(d,this.direction,r)>t.boundingSphereRadius)return;const I=this[t.type];I&&I.call(this,t,o,r,u,t)}_intersectBox(t,o,r,u,d){return this._intersectConvex(t.convexPolyhedronRepresentation,o,r,u,d)}_intersectPlane(t,o,r,u,d){const C=this.from,I=this.to,f=this.direction,A=new Vec3$1(0,0,1);o.vmult(A,A);const G=new Vec3$1;C.vsub(r,G);const B=G.dot(A);I.vsub(r,G);const Z=G.dot(A);if(B*Z>0||C.distanceTo(I)<B)return;const w=A.dot(f);if(Math.abs(w)<this.precision)return;const V=new Vec3$1,Y=new Vec3$1,J=new Vec3$1;C.vsub(r,V);const T=-A.dot(V)/w;f.scale(T,Y),C.vadd(Y,J),this.reportIntersection(A,J,d,u,-1)}getAABB(t){const{lowerBound:o,upperBound:r}=t,u=this.to,d=this.from;o.x=Math.min(u.x,d.x),o.y=Math.min(u.y,d.y),o.z=Math.min(u.z,d.z),r.x=Math.max(u.x,d.x),r.y=Math.max(u.y,d.y),r.z=Math.max(u.z,d.z)}_intersectHeightfield(t,o,r,u,d){t.data,t.elementSize;const C=intersectHeightfield_localRay$1;C.from.copy(this.from),C.to.copy(this.to),Transform$1.pointToLocalFrame(r,o,C.from,C.from),Transform$1.pointToLocalFrame(r,o,C.to,C.to),C.updateDirection();const I=intersectHeightfield_index$1;let f,A,G,B;f=A=0,G=B=t.data.length-1;const Z=new AABB$1;C.getAABB(Z),t.getIndexOfPosition(Z.lowerBound.x,Z.lowerBound.y,I,!0),f=Math.max(f,I[0]),A=Math.max(A,I[1]),t.getIndexOfPosition(Z.upperBound.x,Z.upperBound.y,I,!0),G=Math.min(G,I[0]+1),B=Math.min(B,I[1]+1);for(let w=f;w<G;w++)for(let V=A;V<B;V++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(w,V,Z),!!Z.overlapsRay(C)){if(t.getConvexTrianglePillar(w,V,!1),Transform$1.pointToWorldFrame(r,o,t.pillarOffset,worldPillarOffset$1),this._intersectConvex(t.pillarConvex,o,worldPillarOffset$1,u,d,intersectConvexOptions$1),this.result.shouldStop)return;t.getConvexTrianglePillar(w,V,!0),Transform$1.pointToWorldFrame(r,o,t.pillarOffset,worldPillarOffset$1),this._intersectConvex(t.pillarConvex,o,worldPillarOffset$1,u,d,intersectConvexOptions$1)}}}_intersectSphere(t,o,r,u,d){const C=this.from,I=this.to,f=t.radius,A=(I.x-C.x)**2+(I.y-C.y)**2+(I.z-C.z)**2,G=2*((I.x-C.x)*(C.x-r.x)+(I.y-C.y)*(C.y-r.y)+(I.z-C.z)*(C.z-r.z)),B=(C.x-r.x)**2+(C.y-r.y)**2+(C.z-r.z)**2-f**2,Z=G**2-4*A*B,w=Ray_intersectSphere_intersectionPoint$1,V=Ray_intersectSphere_normal$1;if(!(Z<0))if(Z===0)C.lerp(I,Z,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1);else{const Y=(-G-Math.sqrt(Z))/(2*A),J=(-G+Math.sqrt(Z))/(2*A);if(Y>=0&&Y<=1&&(C.lerp(I,Y,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1)),this.result.shouldStop)return;J>=0&&J<=1&&(C.lerp(I,J,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1))}}_intersectConvex(t,o,r,u,d,C){const I=intersectConvex_normal$1,f=intersectConvex_vector$1,A=C&&C.faceList||null,G=t.faces,B=t.vertices,Z=t.faceNormals,w=this.direction,V=this.from,Y=this.to,J=V.distanceTo(Y),T=A?A.length:G.length,L=this.result;for(let z=0;!L.shouldStop&&z<T;z++){const K=A?A[z]:z,P=G[K],$=Z[K],ie=o,ne=r;f.copy(B[P[0]]),ie.vmult(f,f),f.vadd(ne,f),f.vsub(V,f),ie.vmult($,I);const ee=w.dot(I);if(Math.abs(ee)<this.precision)continue;const se=I.dot(f)/ee;if(!(se<0)){w.scale(se,intersectPoint$1),intersectPoint$1.vadd(V,intersectPoint$1),a$1.copy(B[P[0]]),ie.vmult(a$1,a$1),ne.vadd(a$1,a$1);for(let re=1;!L.shouldStop&&re<P.length-1;re++){b$1.copy(B[P[re]]),c$1.copy(B[P[re+1]]),ie.vmult(b$1,b$1),ie.vmult(c$1,c$1),ne.vadd(b$1,b$1),ne.vadd(c$1,c$1);const ce=intersectPoint$1.distanceTo(V);!(Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1))||ce>J||this.reportIntersection(I,intersectPoint$1,d,u,K)}}}}_intersectTrimesh(t,o,r,u,d,C){const I=intersectTrimesh_normal$1,f=intersectTrimesh_triangles$1,A=intersectTrimesh_treeTransform$1,G=intersectConvex_vector$1,B=intersectTrimesh_localDirection$1,Z=intersectTrimesh_localFrom$1,w=intersectTrimesh_localTo$1,V=intersectTrimesh_worldIntersectPoint$1,Y=intersectTrimesh_worldNormal$1,J=t.indices;t.vertices;const T=this.from,L=this.to,z=this.direction;A.position.copy(r),A.quaternion.copy(o),Transform$1.vectorToLocalFrame(r,o,z,B),Transform$1.pointToLocalFrame(r,o,T,Z),Transform$1.pointToLocalFrame(r,o,L,w),w.x*=t.scale.x,w.y*=t.scale.y,w.z*=t.scale.z,Z.x*=t.scale.x,Z.y*=t.scale.y,Z.z*=t.scale.z,w.vsub(Z,B),B.normalize();const K=Z.distanceSquared(w);t.tree.rayQuery(this,A,f);for(let P=0,$=f.length;!this.result.shouldStop&&P!==$;P++){const ie=f[P];t.getNormal(ie,I),t.getVertex(J[ie*3],a$1),a$1.vsub(Z,G);const ne=B.dot(I),ee=I.dot(G)/ne;if(ee<0)continue;B.scale(ee,intersectPoint$1),intersectPoint$1.vadd(Z,intersectPoint$1),t.getVertex(J[ie*3+1],b$1),t.getVertex(J[ie*3+2],c$1);const se=intersectPoint$1.distanceSquared(Z);!(Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1))||se>K||(Transform$1.vectorToWorldFrame(o,I,Y),Transform$1.pointToWorldFrame(r,o,intersectPoint$1,V),this.reportIntersection(Y,V,d,u,ie))}f.length=0}reportIntersection(t,o,r,u,d){const C=this.from,I=this.to,f=C.distanceTo(o),A=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(A.hitFaceIndex=typeof d<"u"?d:-1,this.mode){case Ray$1.ALL:this.hasHit=!0,A.set(C,I,t,o,r,u,f),A.hasHit=!0,this.callback(A);break;case Ray$1.CLOSEST:(f<A.distance||!A.hasHit)&&(this.hasHit=!0,A.hasHit=!0,A.set(C,I,t,o,r,u,f));break;case Ray$1.ANY:this.hasHit=!0,A.hasHit=!0,A.set(C,I,t,o,r,u,f),A.shouldStop=!0;break}}static pointInTriangle(t,o,r,u){u.vsub(o,v0$1),r.vsub(o,v1$1),t.vsub(o,v2$1);const d=v0$1.dot(v0$1),C=v0$1.dot(v1$1),I=v0$1.dot(v2$1),f=v1$1.dot(v1$1),A=v1$1.dot(v2$1);let G,B;return(G=f*I-C*A)>=0&&(B=d*A-C*I)>=0&&G+B<d*f-C*C}}Ray$1.CLOSEST=RAY_MODES$1.CLOSEST;Ray$1.ANY=RAY_MODES$1.ANY;Ray$1.ALL=RAY_MODES$1.ALL;const tmpAABB$1$1=new AABB$1,tmpArray$1=[],v1$1=new Vec3$1,v2$1=new Vec3$1,intersectBody_xi$1=new Vec3$1,intersectBody_qi$1=new Quaternion$1,intersectPoint$1=new Vec3$1,a$1=new Vec3$1,b$1=new Vec3$1,c$1=new Vec3$1;new Vec3$1;new RaycastResult$1;const intersectConvexOptions$1={faceList:[0]},worldPillarOffset$1=new Vec3$1,intersectHeightfield_localRay$1=new Ray$1,intersectHeightfield_index$1=[],Ray_intersectSphere_intersectionPoint$1=new Vec3$1,Ray_intersectSphere_normal$1=new Vec3$1,intersectConvex_normal$1=new Vec3$1;new Vec3$1;new Vec3$1;const intersectConvex_vector$1=new Vec3$1,intersectTrimesh_normal$1=new Vec3$1,intersectTrimesh_localDirection$1=new Vec3$1,intersectTrimesh_localFrom$1=new Vec3$1,intersectTrimesh_localTo$1=new Vec3$1,intersectTrimesh_worldNormal$1=new Vec3$1,intersectTrimesh_worldIntersectPoint$1=new Vec3$1;new AABB$1;const intersectTrimesh_triangles$1=[],intersectTrimesh_treeTransform$1=new Transform$1,v0$1=new Vec3$1,intersect$1=new Vec3$1;function distanceFromIntersection$1(n,t,o){o.vsub(n,v0$1);const r=v0$1.dot(t);return t.scale(r,intersect$1),intersect$1.vadd(n,intersect$1),o.distanceTo(intersect$1)}new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Ray$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1(1,0,0),new Vec3$1(0,1,0),new Vec3$1(0,0,1);new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Transform$1;new AABB$1;Shape$1.types.SPHERE,Shape$1.types.SPHERE|Shape$1.types.PLANE,Shape$1.types.BOX|Shape$1.types.BOX,Shape$1.types.SPHERE|Shape$1.types.BOX,Shape$1.types.PLANE|Shape$1.types.BOX,Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.PLANE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.BOX|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.HEIGHTFIELD,Shape$1.types.BOX|Shape$1.types.HEIGHTFIELD,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.HEIGHTFIELD,Shape$1.types.PARTICLE|Shape$1.types.SPHERE,Shape$1.types.PLANE|Shape$1.types.PARTICLE,Shape$1.types.BOX|Shape$1.types.PARTICLE,Shape$1.types.PARTICLE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.CYLINDER,Shape$1.types.PLANE|Shape$1.types.CYLINDER,Shape$1.types.BOX|Shape$1.types.CYLINDER,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.CYLINDER,Shape$1.types.HEIGHTFIELD|Shape$1.types.CYLINDER,Shape$1.types.PARTICLE|Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.TRIMESH,Shape$1.types.PLANE|Shape$1.types.TRIMESH;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Ray$1;const performance$1=globalThis.performance||{};if(!performance$1.now){let n=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(n=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-n}new Vec3$1;class Mat3{constructor(t){t===void 0&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const o=this.elements;o[0]=t.x,o[4]=t.y,o[8]=t.z}getTrace(t){t===void 0&&(t=new Vec3);const o=this.elements;return t.x=o[0],t.y=o[4],t.z=o[8],t}vmult(t,o){o===void 0&&(o=new Vec3);const r=this.elements,u=t.x,d=t.y,C=t.z;return o.x=r[0]*u+r[1]*d+r[2]*C,o.y=r[3]*u+r[4]*d+r[5]*C,o.z=r[6]*u+r[7]*d+r[8]*C,o}smult(t){for(let o=0;o<this.elements.length;o++)this.elements[o]*=t}mmult(t,o){o===void 0&&(o=new Mat3);const r=this.elements,u=t.elements,d=o.elements,C=r[0],I=r[1],f=r[2],A=r[3],G=r[4],B=r[5],Z=r[6],w=r[7],V=r[8],Y=u[0],J=u[1],T=u[2],L=u[3],z=u[4],K=u[5],P=u[6],$=u[7],ie=u[8];return d[0]=C*Y+I*L+f*P,d[1]=C*J+I*z+f*$,d[2]=C*T+I*K+f*ie,d[3]=A*Y+G*L+B*P,d[4]=A*J+G*z+B*$,d[5]=A*T+G*K+B*ie,d[6]=Z*Y+w*L+V*P,d[7]=Z*J+w*z+V*$,d[8]=Z*T+w*K+V*ie,o}scale(t,o){o===void 0&&(o=new Mat3);const r=this.elements,u=o.elements;for(let d=0;d!==3;d++)u[3*d+0]=t.x*r[3*d+0],u[3*d+1]=t.y*r[3*d+1],u[3*d+2]=t.z*r[3*d+2];return o}solve(t,o){o===void 0&&(o=new Vec3);const r=3,u=4,d=[];let C,I;for(C=0;C<r*u;C++)d.push(0);for(C=0;C<3;C++)for(I=0;I<3;I++)d[C+u*I]=this.elements[C+3*I];d[3+4*0]=t.x,d[3+4*1]=t.y,d[3+4*2]=t.z;let f=3;const A=f;let G;const B=4;let Z;do{if(C=A-f,d[C+u*C]===0){for(I=C+1;I<A;I++)if(d[C+u*I]!==0){G=B;do Z=B-G,d[Z+u*C]+=d[Z+u*I];while(--G);break}}if(d[C+u*C]!==0)for(I=C+1;I<A;I++){const w=d[C+u*I]/d[C+u*C];G=B;do Z=B-G,d[Z+u*I]=Z<=C?0:d[Z+u*I]-d[Z+u*C]*w;while(--G)}}while(--f);if(o.z=d[2*u+3]/d[2*u+2],o.y=(d[1*u+3]-d[1*u+2]*o.z)/d[1*u+1],o.x=(d[0*u+3]-d[0*u+2]*o.z-d[0*u+1]*o.y)/d[0*u+0],isNaN(o.x)||isNaN(o.y)||isNaN(o.z)||o.x===1/0||o.y===1/0||o.z===1/0)throw`Could not solve equation! Got x=[${o.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return o}e(t,o,r){if(r===void 0)return this.elements[o+3*t];this.elements[o+3*t]=r}copy(t){for(let o=0;o<t.elements.length;o++)this.elements[o]=t.elements[o];return this}toString(){let t="";const o=",";for(let r=0;r<9;r++)t+=this.elements[r]+o;return t}reverse(t){t===void 0&&(t=new Mat3);const o=3,r=6,u=reverse_eqns;let d,C;for(d=0;d<3;d++)for(C=0;C<3;C++)u[d+r*C]=this.elements[d+3*C];u[3+6*0]=1,u[3+6*1]=0,u[3+6*2]=0,u[4+6*0]=0,u[4+6*1]=1,u[4+6*2]=0,u[5+6*0]=0,u[5+6*1]=0,u[5+6*2]=1;let I=3;const f=I;let A;const G=r;let B;do{if(d=f-I,u[d+r*d]===0){for(C=d+1;C<f;C++)if(u[d+r*C]!==0){A=G;do B=G-A,u[B+r*d]+=u[B+r*C];while(--A);break}}if(u[d+r*d]!==0)for(C=d+1;C<f;C++){const Z=u[d+r*C]/u[d+r*d];A=G;do B=G-A,u[B+r*C]=B<=d?0:u[B+r*C]-u[B+r*d]*Z;while(--A)}}while(--I);d=2;do{C=d-1;do{const Z=u[d+r*C]/u[d+r*d];A=r;do B=r-A,u[B+r*C]=u[B+r*C]-u[B+r*d]*Z;while(--A)}while(C--)}while(--d);d=2;do{const Z=1/u[d+r*d];A=r;do B=r-A,u[B+r*d]=u[B+r*d]*Z;while(--A)}while(d--);d=2;do{C=2;do{if(B=u[o+C+r*d],isNaN(B)||B===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(d,C,B)}while(C--)}while(d--);return t}setRotationFromQuaternion(t){const o=t.x,r=t.y,u=t.z,d=t.w,C=o+o,I=r+r,f=u+u,A=o*C,G=o*I,B=o*f,Z=r*I,w=r*f,V=u*f,Y=d*C,J=d*I,T=d*f,L=this.elements;return L[3*0+0]=1-(Z+V),L[3*0+1]=G-T,L[3*0+2]=B+J,L[3*1+0]=G+T,L[3*1+1]=1-(A+V),L[3*1+2]=w-Y,L[3*2+0]=B-J,L[3*2+1]=w+Y,L[3*2+2]=1-(A+Z),this}transpose(t){t===void 0&&(t=new Mat3);const o=this.elements,r=t.elements;let u;return r[0]=o[0],r[4]=o[4],r[8]=o[8],u=o[1],r[1]=o[3],r[3]=u,u=o[2],r[2]=o[6],r[6]=u,u=o[5],r[5]=o[7],r[7]=u,t}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(t,o,r){t===void 0&&(t=0),o===void 0&&(o=0),r===void 0&&(r=0),this.x=t,this.y=o,this.z=r}cross(t,o){o===void 0&&(o=new Vec3);const r=t.x,u=t.y,d=t.z,C=this.x,I=this.y,f=this.z;return o.x=I*d-f*u,o.y=f*r-C*d,o.z=C*u-I*r,o}set(t,o,r){return this.x=t,this.y=o,this.z=r,this}setZero(){this.x=this.y=this.z=0}vadd(t,o){if(o)o.x=t.x+this.x,o.y=t.y+this.y,o.z=t.z+this.z;else return new Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}vsub(t,o){if(o)o.x=this.x-t.x,o.y=this.y-t.y,o.z=this.z-t.z;else return new Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,o=this.y,r=this.z,u=Math.sqrt(t*t+o*o+r*r);if(u>0){const d=1/u;this.x*=d,this.y*=d,this.z*=d}else this.x=0,this.y=0,this.z=0;return u}unit(t){t===void 0&&(t=new Vec3);const o=this.x,r=this.y,u=this.z;let d=Math.sqrt(o*o+r*r+u*u);return d>0?(d=1/d,t.x=o*d,t.y=r*d,t.z=u*d):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,o=this.y,r=this.z;return Math.sqrt(t*t+o*o+r*r)}lengthSquared(){return this.dot(this)}distanceTo(t){const o=this.x,r=this.y,u=this.z,d=t.x,C=t.y,I=t.z;return Math.sqrt((d-o)*(d-o)+(C-r)*(C-r)+(I-u)*(I-u))}distanceSquared(t){const o=this.x,r=this.y,u=this.z,d=t.x,C=t.y,I=t.z;return(d-o)*(d-o)+(C-r)*(C-r)+(I-u)*(I-u)}scale(t,o){o===void 0&&(o=new Vec3);const r=this.x,u=this.y,d=this.z;return o.x=t*r,o.y=t*u,o.z=t*d,o}vmul(t,o){return o===void 0&&(o=new Vec3),o.x=t.x*this.x,o.y=t.y*this.y,o.z=t.z*this.z,o}addScaledVector(t,o,r){return r===void 0&&(r=new Vec3),r.x=this.x+t*o.x,r.y=this.y+t*o.y,r.z=this.z+t*o.z,r}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(t){return t===void 0&&(t=new Vec3),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,o){const r=this.length();if(r>0){const u=Vec3_tangents_n,d=1/r;u.set(this.x*d,this.y*d,this.z*d);const C=Vec3_tangents_randVec;Math.abs(u.x)<.9?(C.set(1,0,0),u.cross(C,t)):(C.set(0,1,0),u.cross(C,t)),u.cross(t,o)}else t.set(1,0,0),o.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,o,r){const u=this.x,d=this.y,C=this.z;r.x=u+(t.x-u)*o,r.y=d+(t.y-d)*o,r.z=C+(t.z-C)*o}almostEquals(t,o){return o===void 0&&(o=1e-6),!(Math.abs(this.x-t.x)>o||Math.abs(this.y-t.y)>o||Math.abs(this.z-t.z)>o)}almostZero(t){return t===void 0&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,o){return this.negate(antip_neg),antip_neg.almostEquals(t,o)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(t){t===void 0&&(t={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,o,r,u){const d=this.lowerBound,C=this.upperBound,I=r;d.copy(t[0]),I&&I.vmult(d,d),C.copy(d);for(let f=1;f<t.length;f++){let A=t[f];I&&(I.vmult(A,tmp$1),A=tmp$1),A.x>C.x&&(C.x=A.x),A.x<d.x&&(d.x=A.x),A.y>C.y&&(C.y=A.y),A.y<d.y&&(d.y=A.y),A.z>C.z&&(C.z=A.z),A.z<d.z&&(d.z=A.z)}return o&&(o.vadd(d,d),o.vadd(C,C)),u&&(d.x-=u,d.y-=u,d.z-=u,C.x+=u,C.y+=u,C.z+=u),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return new AABB().copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const o=this.lowerBound,r=this.upperBound,u=t.lowerBound,d=t.upperBound,C=u.x<=r.x&&r.x<=d.x||o.x<=d.x&&d.x<=r.x,I=u.y<=r.y&&r.y<=d.y||o.y<=d.y&&d.y<=r.y,f=u.z<=r.z&&r.z<=d.z||o.z<=d.z&&d.z<=r.z;return C&&I&&f}volume(){const t=this.lowerBound,o=this.upperBound;return(o.x-t.x)*(o.y-t.y)*(o.z-t.z)}contains(t){const o=this.lowerBound,r=this.upperBound,u=t.lowerBound,d=t.upperBound;return o.x<=u.x&&r.x>=d.x&&o.y<=u.y&&r.y>=d.y&&o.z<=u.z&&r.z>=d.z}getCorners(t,o,r,u,d,C,I,f){const A=this.lowerBound,G=this.upperBound;t.copy(A),o.set(G.x,A.y,A.z),r.set(G.x,G.y,A.z),u.set(A.x,G.y,G.z),d.set(G.x,A.y,G.z),C.set(A.x,G.y,A.z),I.set(A.x,A.y,G.z),f.copy(G)}toLocalFrame(t,o){const r=transformIntoFrame_corners,u=r[0],d=r[1],C=r[2],I=r[3],f=r[4],A=r[5],G=r[6],B=r[7];this.getCorners(u,d,C,I,f,A,G,B);for(let Z=0;Z!==8;Z++){const w=r[Z];t.pointToLocal(w,w)}return o.setFromPoints(r)}toWorldFrame(t,o){const r=transformIntoFrame_corners,u=r[0],d=r[1],C=r[2],I=r[3],f=r[4],A=r[5],G=r[6],B=r[7];this.getCorners(u,d,C,I,f,A,G,B);for(let Z=0;Z!==8;Z++){const w=r[Z];t.pointToWorld(w,w)}return o.setFromPoints(r)}overlapsRay(t){const{direction:o,from:r}=t,u=1/o.x,d=1/o.y,C=1/o.z,I=(this.lowerBound.x-r.x)*u,f=(this.upperBound.x-r.x)*u,A=(this.lowerBound.y-r.y)*d,G=(this.upperBound.y-r.y)*d,B=(this.lowerBound.z-r.z)*C,Z=(this.upperBound.z-r.z)*C,w=Math.max(Math.max(Math.min(I,f),Math.min(A,G)),Math.min(B,Z)),V=Math.min(Math.min(Math.max(I,f),Math.max(A,G)),Math.max(B,Z));return!(V<0||w>V)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class Quaternion{constructor(t,o,r,u){t===void 0&&(t=0),o===void 0&&(o=0),r===void 0&&(r=0),u===void 0&&(u=1),this.x=t,this.y=o,this.z=r,this.w=u}set(t,o,r,u){return this.x=t,this.y=o,this.z=r,this.w=u,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,o){const r=Math.sin(o*.5);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(o*.5),this}toAxisAngle(t){t===void 0&&(t=new Vec3),this.normalize();const o=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return r<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/r,t.y=this.y/r,t.z=this.z/r),[t,o]}setFromVectors(t,o){if(t.isAntiparallelTo(o)){const r=sfv_t1,u=sfv_t2;t.tangents(r,u),this.setFromAxisAngle(r,Math.PI)}else{const r=t.cross(o);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(t.length()**2*o.length()**2)+t.dot(o),this.normalize()}return this}mult(t,o){o===void 0&&(o=new Quaternion);const r=this.x,u=this.y,d=this.z,C=this.w,I=t.x,f=t.y,A=t.z,G=t.w;return o.x=r*G+C*I+u*A-d*f,o.y=u*G+C*f+d*I-r*A,o.z=d*G+C*A+r*f-u*I,o.w=C*G-r*I-u*f-d*A,o}inverse(t){t===void 0&&(t=new Quaternion);const o=this.x,r=this.y,u=this.z,d=this.w;this.conjugate(t);const C=1/(o*o+r*r+u*u+d*d);return t.x*=C,t.y*=C,t.z*=C,t.w*=C,t}conjugate(t){return t===void 0&&(t=new Quaternion),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,o){o===void 0&&(o=new Vec3);const r=t.x,u=t.y,d=t.z,C=this.x,I=this.y,f=this.z,A=this.w,G=A*r+I*d-f*u,B=A*u+f*r-C*d,Z=A*d+C*u-I*r,w=-C*r-I*u-f*d;return o.x=G*A+w*-C+B*-f-Z*-I,o.y=B*A+w*-I+Z*-C-G*-f,o.z=Z*A+w*-f+G*-I-B*-C,o}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,o){o===void 0&&(o="YZX");let r,u,d;const C=this.x,I=this.y,f=this.z,A=this.w;switch(o){case"YZX":const G=C*I+f*A;if(G>.499&&(r=2*Math.atan2(C,A),u=Math.PI/2,d=0),G<-.499&&(r=-2*Math.atan2(C,A),u=-Math.PI/2,d=0),r===void 0){const B=C*C,Z=I*I,w=f*f;r=Math.atan2(2*I*A-2*C*f,1-2*Z-2*w),u=Math.asin(2*G),d=Math.atan2(2*C*A-2*I*f,1-2*B-2*w)}break;default:throw new Error(`Euler order ${o} not supported yet.`)}t.y=r,t.z=u,t.x=d}setFromEuler(t,o,r,u){u===void 0&&(u="XYZ");const d=Math.cos(t/2),C=Math.cos(o/2),I=Math.cos(r/2),f=Math.sin(t/2),A=Math.sin(o/2),G=Math.sin(r/2);return u==="XYZ"?(this.x=f*C*I+d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I-f*A*G):u==="YXZ"?(this.x=f*C*I+d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I+f*A*G):u==="ZXY"?(this.x=f*C*I-d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I-f*A*G):u==="ZYX"?(this.x=f*C*I-d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I+f*A*G):u==="YZX"?(this.x=f*C*I+d*A*G,this.y=d*A*I+f*C*G,this.z=d*C*G-f*A*I,this.w=d*C*I-f*A*G):u==="XZY"&&(this.x=f*C*I-d*A*G,this.y=d*A*I-f*C*G,this.z=d*C*G+f*A*I,this.w=d*C*I+f*A*G),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(t,o,r){r===void 0&&(r=new Quaternion);const u=this.x,d=this.y,C=this.z,I=this.w;let f=t.x,A=t.y,G=t.z,B=t.w,Z,w,V,Y,J;return w=u*f+d*A+C*G+I*B,w<0&&(w=-w,f=-f,A=-A,G=-G,B=-B),1-w>1e-6?(Z=Math.acos(w),V=Math.sin(Z),Y=Math.sin((1-o)*Z)/V,J=Math.sin(o*Z)/V):(Y=1-o,J=o),r.x=Y*u+J*f,r.y=Y*d+J*A,r.z=Y*C+J*G,r.w=Y*I+J*B,r}integrate(t,o,r,u){u===void 0&&(u=new Quaternion);const d=t.x*r.x,C=t.y*r.y,I=t.z*r.z,f=this.x,A=this.y,G=this.z,B=this.w,Z=o*.5;return u.x+=Z*(d*B+C*G-I*A),u.y+=Z*(C*B+I*f-d*G),u.z+=Z*(I*B+d*A-C*f),u.w+=Z*(-d*f-C*A-I*G),u}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(t){t===void 0&&(t={}),this.id=Shape.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,o){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,o,r,u){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(t){t===void 0&&(t={}),this.position=new Vec3,this.quaternion=new Quaternion,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,o){return Transform.pointToLocalFrame(this.position,this.quaternion,t,o)}pointToWorld(t,o){return Transform.pointToWorldFrame(this.position,this.quaternion,t,o)}vectorToWorldFrame(t,o){return o===void 0&&(o=new Vec3),this.quaternion.vmult(t,o),o}static pointToLocalFrame(t,o,r,u){return u===void 0&&(u=new Vec3),r.vsub(t,u),o.conjugate(tmpQuat$1),tmpQuat$1.vmult(u,u),u}static pointToWorldFrame(t,o,r,u){return u===void 0&&(u=new Vec3),o.vmult(r,u),u.vadd(t,u),u}static vectorToWorldFrame(t,o,r){return r===void 0&&(r=new Vec3),t.vmult(o,r),r}static vectorToLocalFrame(t,o,r,u){return u===void 0&&(u=new Vec3),o.w*=-1,o.vmult(r,u),o.w*=-1,u}}const tmpQuat$1=new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Quaternion;new AABB;new Mat3;new Mat3;new Mat3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,o,r,u,d,C,I){this.rayFromWorld.copy(t),this.rayToWorld.copy(o),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(u),this.shape=d,this.body=C,this.distance=I}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(t,o){t===void 0&&(t=new Vec3),o===void 0&&(o=new Vec3),this.from=t.clone(),this.to=o.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=r=>{}}intersectWorld(t,o){return this.mode=o.mode||Ray.ANY,this.result=o.result||new RaycastResult,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=typeof o.collisionFilterMask<"u"?o.collisionFilterMask:-1,this.collisionFilterGroup=typeof o.collisionFilterGroup<"u"?o.collisionFilterGroup:-1,this.checkCollisionResponse=typeof o.checkCollisionResponse<"u"?o.checkCollisionResponse:!0,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,t.broadphase.aabbQuery(t,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(t,o){o&&(this.result=o,this.updateDirection());const r=this.checkCollisionResponse;if(r&&!t.collisionResponse||(this.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&this.collisionFilterMask)===0)return;const u=intersectBody_xi,d=intersectBody_qi;for(let C=0,I=t.shapes.length;C<I;C++){const f=t.shapes[C];if(!(r&&!f.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[C],d),t.quaternion.vmult(t.shapeOffsets[C],u),u.vadd(t.position,u),this.intersectShape(f,d,u,t),this.result.shouldStop))break}}intersectBodies(t,o){o&&(this.result=o,this.updateDirection());for(let r=0,u=t.length;!this.result.shouldStop&&r<u;r++)this.intersectBody(t[r])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,o,r,u){const d=this.from;if(distanceFromIntersection(d,this.direction,r)>t.boundingSphereRadius)return;const I=this[t.type];I&&I.call(this,t,o,r,u,t)}_intersectBox(t,o,r,u,d){return this._intersectConvex(t.convexPolyhedronRepresentation,o,r,u,d)}_intersectPlane(t,o,r,u,d){const C=this.from,I=this.to,f=this.direction,A=new Vec3(0,0,1);o.vmult(A,A);const G=new Vec3;C.vsub(r,G);const B=G.dot(A);I.vsub(r,G);const Z=G.dot(A);if(B*Z>0||C.distanceTo(I)<B)return;const w=A.dot(f);if(Math.abs(w)<this.precision)return;const V=new Vec3,Y=new Vec3,J=new Vec3;C.vsub(r,V);const T=-A.dot(V)/w;f.scale(T,Y),C.vadd(Y,J),this.reportIntersection(A,J,d,u,-1)}getAABB(t){const{lowerBound:o,upperBound:r}=t,u=this.to,d=this.from;o.x=Math.min(u.x,d.x),o.y=Math.min(u.y,d.y),o.z=Math.min(u.z,d.z),r.x=Math.max(u.x,d.x),r.y=Math.max(u.y,d.y),r.z=Math.max(u.z,d.z)}_intersectHeightfield(t,o,r,u,d){t.data,t.elementSize;const C=intersectHeightfield_localRay;C.from.copy(this.from),C.to.copy(this.to),Transform.pointToLocalFrame(r,o,C.from,C.from),Transform.pointToLocalFrame(r,o,C.to,C.to),C.updateDirection();const I=intersectHeightfield_index;let f,A,G,B;f=A=0,G=B=t.data.length-1;const Z=new AABB;C.getAABB(Z),t.getIndexOfPosition(Z.lowerBound.x,Z.lowerBound.y,I,!0),f=Math.max(f,I[0]),A=Math.max(A,I[1]),t.getIndexOfPosition(Z.upperBound.x,Z.upperBound.y,I,!0),G=Math.min(G,I[0]+1),B=Math.min(B,I[1]+1);for(let w=f;w<G;w++)for(let V=A;V<B;V++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(w,V,Z),!!Z.overlapsRay(C)){if(t.getConvexTrianglePillar(w,V,!1),Transform.pointToWorldFrame(r,o,t.pillarOffset,worldPillarOffset),this._intersectConvex(t.pillarConvex,o,worldPillarOffset,u,d,intersectConvexOptions),this.result.shouldStop)return;t.getConvexTrianglePillar(w,V,!0),Transform.pointToWorldFrame(r,o,t.pillarOffset,worldPillarOffset),this._intersectConvex(t.pillarConvex,o,worldPillarOffset,u,d,intersectConvexOptions)}}}_intersectSphere(t,o,r,u,d){const C=this.from,I=this.to,f=t.radius,A=(I.x-C.x)**2+(I.y-C.y)**2+(I.z-C.z)**2,G=2*((I.x-C.x)*(C.x-r.x)+(I.y-C.y)*(C.y-r.y)+(I.z-C.z)*(C.z-r.z)),B=(C.x-r.x)**2+(C.y-r.y)**2+(C.z-r.z)**2-f**2,Z=G**2-4*A*B,w=Ray_intersectSphere_intersectionPoint,V=Ray_intersectSphere_normal;if(!(Z<0))if(Z===0)C.lerp(I,Z,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1);else{const Y=(-G-Math.sqrt(Z))/(2*A),J=(-G+Math.sqrt(Z))/(2*A);if(Y>=0&&Y<=1&&(C.lerp(I,Y,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1)),this.result.shouldStop)return;J>=0&&J<=1&&(C.lerp(I,J,w),w.vsub(r,V),V.normalize(),this.reportIntersection(V,w,d,u,-1))}}_intersectConvex(t,o,r,u,d,C){const I=intersectConvex_normal,f=intersectConvex_vector,A=C&&C.faceList||null,G=t.faces,B=t.vertices,Z=t.faceNormals,w=this.direction,V=this.from,Y=this.to,J=V.distanceTo(Y),T=A?A.length:G.length,L=this.result;for(let z=0;!L.shouldStop&&z<T;z++){const K=A?A[z]:z,P=G[K],$=Z[K],ie=o,ne=r;f.copy(B[P[0]]),ie.vmult(f,f),f.vadd(ne,f),f.vsub(V,f),ie.vmult($,I);const ee=w.dot(I);if(Math.abs(ee)<this.precision)continue;const se=I.dot(f)/ee;if(!(se<0)){w.scale(se,intersectPoint),intersectPoint.vadd(V,intersectPoint),a.copy(B[P[0]]),ie.vmult(a,a),ne.vadd(a,a);for(let re=1;!L.shouldStop&&re<P.length-1;re++){b.copy(B[P[re]]),c.copy(B[P[re+1]]),ie.vmult(b,b),ie.vmult(c,c),ne.vadd(b,b),ne.vadd(c,c);const ce=intersectPoint.distanceTo(V);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||ce>J||this.reportIntersection(I,intersectPoint,d,u,K)}}}}_intersectTrimesh(t,o,r,u,d,C){const I=intersectTrimesh_normal,f=intersectTrimesh_triangles,A=intersectTrimesh_treeTransform,G=intersectConvex_vector,B=intersectTrimesh_localDirection,Z=intersectTrimesh_localFrom,w=intersectTrimesh_localTo,V=intersectTrimesh_worldIntersectPoint,Y=intersectTrimesh_worldNormal,J=t.indices;t.vertices;const T=this.from,L=this.to,z=this.direction;A.position.copy(r),A.quaternion.copy(o),Transform.vectorToLocalFrame(r,o,z,B),Transform.pointToLocalFrame(r,o,T,Z),Transform.pointToLocalFrame(r,o,L,w),w.x*=t.scale.x,w.y*=t.scale.y,w.z*=t.scale.z,Z.x*=t.scale.x,Z.y*=t.scale.y,Z.z*=t.scale.z,w.vsub(Z,B),B.normalize();const K=Z.distanceSquared(w);t.tree.rayQuery(this,A,f);for(let P=0,$=f.length;!this.result.shouldStop&&P!==$;P++){const ie=f[P];t.getNormal(ie,I),t.getVertex(J[ie*3],a),a.vsub(Z,G);const ne=B.dot(I),ee=I.dot(G)/ne;if(ee<0)continue;B.scale(ee,intersectPoint),intersectPoint.vadd(Z,intersectPoint),t.getVertex(J[ie*3+1],b),t.getVertex(J[ie*3+2],c);const se=intersectPoint.distanceSquared(Z);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||se>K||(Transform.vectorToWorldFrame(o,I,Y),Transform.pointToWorldFrame(r,o,intersectPoint,V),this.reportIntersection(Y,V,d,u,ie))}f.length=0}reportIntersection(t,o,r,u,d){const C=this.from,I=this.to,f=C.distanceTo(o),A=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(A.hitFaceIndex=typeof d<"u"?d:-1,this.mode){case Ray.ALL:this.hasHit=!0,A.set(C,I,t,o,r,u,f),A.hasHit=!0,this.callback(A);break;case Ray.CLOSEST:(f<A.distance||!A.hasHit)&&(this.hasHit=!0,A.hasHit=!0,A.set(C,I,t,o,r,u,f));break;case Ray.ANY:this.hasHit=!0,A.hasHit=!0,A.set(C,I,t,o,r,u,f),A.shouldStop=!0;break}}static pointInTriangle(t,o,r,u){u.vsub(o,v0),r.vsub(o,v1),t.vsub(o,v2);const d=v0.dot(v0),C=v0.dot(v1),I=v0.dot(v2),f=v1.dot(v1),A=v1.dot(v2);let G,B;return(G=f*I-C*A)>=0&&(B=d*A-C*I)>=0&&G+B<d*f-C*C}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3;new Vec3;new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(n,t,o){o.vsub(n,v0);const r=v0.dot(t);return t.scale(r,intersect),intersect.vadd(n,intersect),o.distanceTo(intersect)}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Ray;new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Transform;new AABB;Shape.types.SPHERE,Shape.types.SPHERE|Shape.types.PLANE,Shape.types.BOX|Shape.types.BOX,Shape.types.SPHERE|Shape.types.BOX,Shape.types.PLANE|Shape.types.BOX,Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.HEIGHTFIELD,Shape.types.BOX|Shape.types.HEIGHTFIELD,Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,Shape.types.PARTICLE|Shape.types.SPHERE,Shape.types.PLANE|Shape.types.PARTICLE,Shape.types.BOX|Shape.types.PARTICLE,Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.CYLINDER,Shape.types.PLANE|Shape.types.CYLINDER,Shape.types.BOX|Shape.types.CYLINDER,Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,Shape.types.PARTICLE|Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.TRIMESH,Shape.types.PLANE|Shape.types.TRIMESH;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Ray;const performance$2=globalThis.performance||{};if(!performance$2.now){let n=Date.now();performance$2.timing&&performance$2.timing.navigationStart&&(n=performance$2.timing.navigationStart),performance$2.now=()=>Date.now()-n}new Vec3;const debugContext=reactExports.createContext(null),useDebugContext=()=>reactExports.useContext(debugContext),physicsContext=reactExports.createContext(null),usePhysicsContext=()=>{const n=reactExports.useContext(physicsContext);if(!n)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return n};new Vector3(1,1,1);new Vector3;new Matrix4;const temp=new Object3D;function useForwardedRef(n){const t=reactExports.useRef(null);return n&&typeof n!="function"?n:t}function capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)}function getUUID(n,t){const o=t===void 0?"":`/${t}`;return typeof n=="function"?null:n&&n.current&&`${n.current.uuid}${o}`}const e=new Euler,q$1=new Quaternion$2,quaternionToRotation=n=>t=>n(e.setFromQuaternion(q$1.fromArray(t)).toArray());let incrementingId=0;function subscribe(n,t,o,r,u,d){return d===void 0&&(d="bodies"),C=>{const I=incrementingId++;o[I]={[r]:C};const f=getUUID(n,u);return f&&t.subscribe({props:{id:I,target:d,type:r},uuid:f}),()=>{delete o[I],t.unsubscribe({props:I})}}}function prepare(n,t){let{position:o=[0,0,0],rotation:r=[0,0,0],userData:u={}}=t;n.userData=u,n.position.set(...o),n.rotation.set(...r),n.updateMatrix()}function setupCollision(n,t,o){let{onCollide:r,onCollideBegin:u,onCollideEnd:d}=t;n[o]={collide:r,collideBegin:u,collideEnd:d}}function useBody(n,t,o,r,u){r===void 0&&(r=null),u===void 0&&(u=[]);const d=useForwardedRef(r),{events:C,refs:I,scaleOverrides:f,subscriptions:A,worker:G}=usePhysicsContext(),B=useDebugContext();reactExports.useLayoutEffect(()=>{d.current||(d.current=new Object3D);const w=d.current,V=G,Y=w instanceof InstancedMesh?(w.instanceMatrix.setUsage(DynamicDrawUsage),w.count):1,J=w instanceof InstancedMesh?new Array(Y).fill(0).map((L,z)=>`${w.uuid}/${z}`):[w.uuid],T=w instanceof InstancedMesh?J.map((L,z)=>{const K=t(z);return prepare(temp,K),w.setMatrixAt(z,temp.matrix),w.instanceMatrix.needsUpdate=!0,I[L]=w,B==null||B.add(L,K,n),setupCollision(C,K,L),{...K,args:o(K.args)}}):J.map((L,z)=>{const K=t(z);return prepare(w,K),I[L]=w,B==null||B.add(L,K,n),setupCollision(C,K,L),{...K,args:o(K.args)}});return V.addBodies({props:T.map(L=>{let{onCollide:z,onCollideBegin:K,onCollideEnd:P,...$}=L;return{onCollide:!!z,...$}}),type:n,uuid:J}),()=>{J.forEach(L=>{delete I[L],B==null||B.remove(L),delete C[L]}),V.removeBodies({uuid:J})}},u);const Z=reactExports.useMemo(()=>{const w=(z,K)=>{const P=`set${capitalize(z)}`;return{set:$=>{const ie=getUUID(d,K);ie&&G[P]({props:$,uuid:ie})},subscribe:subscribe(d,G,A,z,K)}},V=z=>({copy:P=>{let{w:$,x:ie,y:ne,z:ee}=P;const se=getUUID(d,z);se&&G.setQuaternion({props:[ie,ne,ee,$],uuid:se})},set:(P,$,ie,ne)=>{const ee=getUUID(d,z);ee&&G.setQuaternion({props:[P,$,ie,ne],uuid:ee})},subscribe:subscribe(d,G,A,"quaternion",z)}),Y=z=>({copy:K=>{let{x:P,y:$,z:ie}=K;const ne=getUUID(d,z);ne&&G.setRotation({props:[P,$,ie],uuid:ne})},set:(K,P,$)=>{const ie=getUUID(d,z);ie&&G.setRotation({props:[K,P,$],uuid:ie})},subscribe:K=>{const P=incrementingId++,$="bodies",ie="quaternion",ne=getUUID(d,z);return A[P]={[ie]:quaternionToRotation(K)},ne&&G.subscribe({props:{id:P,target:$,type:ie},uuid:ne}),()=>{delete A[P],G.unsubscribe({props:P})}}}),J=(z,K)=>{const P=`set${capitalize(z)}`;return{copy:$=>{let{x:ie,y:ne,z:ee}=$;const se=getUUID(d,K);se&&G[P]({props:[ie,ne,ee],uuid:se})},set:($,ie,ne)=>{const ee=getUUID(d,K);ee&&G[P]({props:[$,ie,ne],uuid:ee})},subscribe:subscribe(d,G,A,z,K)}};function T(z){return{allowSleep:w("allowSleep",z),angularDamping:w("angularDamping",z),angularFactor:J("angularFactor",z),angularVelocity:J("angularVelocity",z),applyForce(K,P){const $=getUUID(d,z);$&&G.applyForce({props:[K,P],uuid:$})},applyImpulse(K,P){const $=getUUID(d,z);$&&G.applyImpulse({props:[K,P],uuid:$})},applyLocalForce(K,P){const $=getUUID(d,z);$&&G.applyLocalForce({props:[K,P],uuid:$})},applyLocalImpulse(K,P){const $=getUUID(d,z);$&&G.applyLocalImpulse({props:[K,P],uuid:$})},applyTorque(K){const P=getUUID(d,z);P&&G.applyTorque({props:[K],uuid:P})},collisionFilterGroup:w("collisionFilterGroup",z),collisionFilterMask:w("collisionFilterMask",z),collisionResponse:w("collisionResponse",z),fixedRotation:w("fixedRotation",z),isTrigger:w("isTrigger",z),linearDamping:w("linearDamping",z),linearFactor:J("linearFactor",z),mass:w("mass",z),material:w("material",z),position:J("position",z),quaternion:V(z),rotation:Y(z),scaleOverride(K){const P=getUUID(d,z);P&&(f[P]=new Vector3(...K))},sleep(){const K=getUUID(d,z);K&&G.sleep({uuid:K})},sleepSpeedLimit:w("sleepSpeedLimit",z),sleepTimeLimit:w("sleepTimeLimit",z),userData:w("userData",z),velocity:J("velocity",z),wakeUp(){const K=getUUID(d,z);K&&G.wakeUp({uuid:K})}}}const L={};return{...T(void 0),at:z=>L[z]||(L[z]=T(z))}},[]);return[d,Z]}function usePlane(n,t,o){return useBody("Plane",n,()=>[],t,o)}function useSphere(n,t,o){return useBody("Sphere",n,function(r){if(r===void 0&&(r=[1]),!Array.isArray(r))throw new Error("useSphere args must be an array");return[r[0]]},t,o)}const v=new Vector3,s=new Vector3(1,1,1),q=new Quaternion$2,m=new Matrix4;function apply(n,t,o,r,u){return r===void 0&&(r=s),n!==void 0?(m.compose(v.fromArray(t,n*3),q.fromArray(o,n*4),r),u&&(u.matrixAutoUpdate=!1,u.matrix.copy(m)),m):m.identity()}const unique=()=>{const n=[];return t=>n.includes(t)?!1:!!n.push(t)};function PhysicsProvider(n){let{allowSleep:t=!1,axisIndex:o=0,broadphase:r="Naive",children:u,defaultContactMaterial:d={contactEquationStiffness:1e6},frictionGravity:C=null,gravity:I=[0,-9.81,0],isPaused:f=!1,iterations:A=5,maxSubSteps:G=10,quatNormalizeFast:B=!1,quatNormalizeSkip:Z=0,shouldInvalidate:w=!0,size:V=1e3,solver:Y="GS",stepSize:J=1/60,tolerance:T=.001}=n;const{invalidate:L}=useThree(),[{bodies:z,events:K,refs:P,scaleOverrides:$,subscriptions:ie,worker:ne}]=reactExports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new CannonWorkerAPI({allowSleep:t,axisIndex:o,broadphase:r,defaultContactMaterial:d,frictionGravity:C,gravity:I,iterations:A,quatNormalizeFast:B,quatNormalizeSkip:Z,size:V,solver:Y,tolerance:T})}));let ee=0;const se=reactExports.useCallback((Ze,Be)=>{f||(ee+=Be,ne.step({maxSubSteps:G,stepSize:J,timeSinceLastCalled:ee}),ee=0)},[f,G,J]),re=Ze=>{var Be;let{body:xe,contact:{bi:ge,bj:de,...ve},target:le,...Ae}=Ze;const Xe=(Be=K[le])==null?void 0:Be.collide;Xe&&Xe({body:P[xe],contact:{bi:P[ge],bj:P[de],...ve},target:P[le],...Ae})},ce=Ze=>{var Be,xe;let{bodyA:ge,bodyB:de}=Ze;const ve=(Be=K[ge])==null?void 0:Be.collideBegin;ve&&ve({body:P[de],op:"event",target:P[ge],type:"collideBegin"});const le=(xe=K[de])==null?void 0:xe.collideBegin;le&&le({body:P[ge],op:"event",target:P[de],type:"collideBegin"})},ue=Ze=>{var Be,xe;let{bodyA:ge,bodyB:de}=Ze;const ve=(Be=K[ge])==null?void 0:Be.collideEnd;ve&&ve({body:P[de],op:"event",target:P[ge],type:"collideEnd"});const le=(xe=K[de])==null?void 0:xe.collideEnd;le&&le({body:P[ge],op:"event",target:P[de],type:"collideEnd"})},ye=Ze=>{let{active:Be,bodies:xe=[],observations:ge,positions:de,quaternions:ve}=Ze;for(let le=0;le<xe.length;le++)z[xe[le]]=le;if(ge.forEach(le=>{let[Ae,Xe,Te]=le;const We=(ie[Ae]||{})[Te];We&&We(Xe)}),!!Be){for(const le of Object.values(P).filter(unique()))if(le instanceof InstancedMesh)for(let Ae=0;Ae<le.count;Ae++){const Xe=`${le.uuid}/${Ae}`,Te=z[Xe];Te!==void 0&&(le.setMatrixAt(Ae,apply(Te,de,ve,$[Xe])),le.instanceMatrix.needsUpdate=!0)}else{const Ae=$[le.uuid]||le.scale;apply(z[le.uuid],de,ve,Ae,le)}w&&L()}},Se=Ze=>{var Be;let{body:xe,ray:{uuid:ge,...de},...ve}=Ze;const le=(Be=K[ge])==null?void 0:Be.rayhit;le&&le({body:xe?P[xe]:null,ray:{uuid:ge,...de},...ve})};useFrame(se),reactExports.useEffect(()=>(ne.connect(),ne.init(),ne.on("collide",re),ne.on("collideBegin",ce),ne.on("collideEnd",ue),ne.on("frame",ye),ne.on("rayhit",Se),()=>{ne.terminate(),ne.removeAllListeners()}),[]),reactExports.useEffect(()=>{ne.axisIndex=o},[o]),reactExports.useEffect(()=>{ne.broadphase=r},[r]),reactExports.useEffect(()=>{ne.gravity=I},[I]),reactExports.useEffect(()=>{ne.iterations=A},[A]),reactExports.useEffect(()=>{ne.tolerance=T},[T]);const Ce=reactExports.useMemo(()=>({bodies:z,events:K,refs:P,scaleOverrides:$,subscriptions:ie,worker:ne}),[z,K,P,ie,ne]);return jsxRuntimeExports.jsx(physicsContext.Provider,{value:Ce,children:u})}function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)({}).hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n},_extends.apply(null,arguments)}var __defProp$1=Object.defineProperty,__defNormalProp$1=(n,t,o)=>t in n?__defProp$1(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,__publicField$1=(n,t,o)=>(__defNormalProp$1(n,t+"",o),o);class EventDispatcher{constructor(){__publicField$1(this,"_listeners")}addEventListener(t,o){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(o)===-1&&r[t].push(o)}hasEventListener(t,o){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(o)!==-1}removeEventListener(t,o){if(this._listeners===void 0)return;const u=this._listeners[t];if(u!==void 0){const d=u.indexOf(o);d!==-1&&u.splice(d,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const u=r.slice(0);for(let d=0,C=u.length;d<C;d++)u[d].call(this,t);t.target=null}}}var __defProp=Object.defineProperty,__defNormalProp=(n,t,o)=>t in n?__defProp(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,__publicField=(n,t,o)=>(__defNormalProp(n,typeof t!="symbol"?t+"":t,o),o);const _ray=new Ray$2,_plane=new Plane$1,TILT_LIMIT=Math.cos(70*(Math.PI/180)),moduloWrapAround=(n,t)=>(n%t+t)%t;let OrbitControls$1=class extends EventDispatcher{constructor(t,o){super(),__publicField(this,"object"),__publicField(this,"domElement"),__publicField(this,"enabled",!0),__publicField(this,"target",new Vector3),__publicField(this,"minDistance",0),__publicField(this,"maxDistance",1/0),__publicField(this,"minZoom",0),__publicField(this,"maxZoom",1/0),__publicField(this,"minPolarAngle",0),__publicField(this,"maxPolarAngle",Math.PI),__publicField(this,"minAzimuthAngle",-1/0),__publicField(this,"maxAzimuthAngle",1/0),__publicField(this,"enableDamping",!1),__publicField(this,"dampingFactor",.05),__publicField(this,"enableZoom",!0),__publicField(this,"zoomSpeed",1),__publicField(this,"enableRotate",!0),__publicField(this,"rotateSpeed",1),__publicField(this,"enablePan",!0),__publicField(this,"panSpeed",1),__publicField(this,"screenSpacePanning",!0),__publicField(this,"keyPanSpeed",7),__publicField(this,"zoomToCursor",!1),__publicField(this,"autoRotate",!1),__publicField(this,"autoRotateSpeed",2),__publicField(this,"reverseOrbit",!1),__publicField(this,"reverseHorizontalOrbit",!1),__publicField(this,"reverseVerticalOrbit",!1),__publicField(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),__publicField(this,"mouseButtons",{LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN}),__publicField(this,"touches",{ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN}),__publicField(this,"target0"),__publicField(this,"position0"),__publicField(this,"zoom0"),__publicField(this,"_domElementKeyEvents",null),__publicField(this,"getPolarAngle"),__publicField(this,"getAzimuthalAngle"),__publicField(this,"setPolarAngle"),__publicField(this,"setAzimuthalAngle"),__publicField(this,"getDistance"),__publicField(this,"getZoomScale"),__publicField(this,"listenToKeyEvents"),__publicField(this,"stopListenToKeyEvents"),__publicField(this,"saveState"),__publicField(this,"reset"),__publicField(this,"update"),__publicField(this,"connect"),__publicField(this,"dispose"),__publicField(this,"dollyIn"),__publicField(this,"dollyOut"),__publicField(this,"getScale"),__publicField(this,"setScale"),this.object=t,this.domElement=o,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>G.phi,this.getAzimuthalAngle=()=>G.theta,this.setPolarAngle=me=>{let Ee=moduloWrapAround(me,2*Math.PI),_e=G.phi;_e<0&&(_e+=2*Math.PI),Ee<0&&(Ee+=2*Math.PI);let Me=Math.abs(Ee-_e);2*Math.PI-Me<Me&&(Ee<_e?Ee+=2*Math.PI:_e+=2*Math.PI),B.phi=Ee-_e,r.update()},this.setAzimuthalAngle=me=>{let Ee=moduloWrapAround(me,2*Math.PI),_e=G.theta;_e<0&&(_e+=2*Math.PI),Ee<0&&(Ee+=2*Math.PI);let Me=Math.abs(Ee-_e);2*Math.PI-Me<Me&&(Ee<_e?Ee+=2*Math.PI:_e+=2*Math.PI),B.theta=Ee-_e,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=me=>{me.addEventListener("keydown",Zt),this._domElementKeyEvents=me},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Zt),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(u),r.update(),f=I.NONE},this.update=(()=>{const me=new Vector3,Ee=new Vector3(0,1,0),_e=new Quaternion$2().setFromUnitVectors(t.up,Ee),Me=_e.clone().invert(),Bt=new Vector3,qe=new Quaternion$2,at=2*Math.PI;return function(){const _t=r.object.position;_e.setFromUnitVectors(t.up,Ee),Me.copy(_e).invert(),me.copy(_t).sub(r.target),me.applyQuaternion(_e),G.setFromVector3(me),r.autoRotate&&f===I.NONE&&ye(ce()),r.enableDamping?(G.theta+=B.theta*r.dampingFactor,G.phi+=B.phi*r.dampingFactor):(G.theta+=B.theta,G.phi+=B.phi);let Tt=r.minAzimuthAngle,si=r.maxAzimuthAngle;isFinite(Tt)&&isFinite(si)&&(Tt<-Math.PI?Tt+=at:Tt>Math.PI&&(Tt-=at),si<-Math.PI?si+=at:si>Math.PI&&(si-=at),Tt<=si?G.theta=Math.max(Tt,Math.min(si,G.theta)):G.theta=G.theta>(Tt+si)/2?Math.max(Tt,G.theta):Math.min(si,G.theta)),G.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,G.phi)),G.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(w,r.dampingFactor):r.target.add(w),r.zoomToCursor&&ee||r.object.isOrthographicCamera?G.radius=le(G.radius):G.radius=le(G.radius*Z),me.setFromSpherical(G),me.applyQuaternion(Me),_t.copy(r.target).add(me),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(B.theta*=1-r.dampingFactor,B.phi*=1-r.dampingFactor,w.multiplyScalar(1-r.dampingFactor)):(B.set(0,0,0),w.set(0,0,0));let Bi=!1;if(r.zoomToCursor&&ee){let ii=null;if(r.object instanceof PerspectiveCamera&&r.object.isPerspectiveCamera){const ci=me.length();ii=le(ci*Z);const Zi=ci-ii;r.object.position.addScaledVector(ie,Zi),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const ci=new Vector3(ne.x,ne.y,0);ci.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/Z)),r.object.updateProjectionMatrix(),Bi=!0;const Zi=new Vector3(ne.x,ne.y,0);Zi.unproject(r.object),r.object.position.sub(Zi).add(ci),r.object.updateMatrixWorld(),ii=me.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;ii!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ii).add(r.object.position):(_ray.origin.copy(r.object.position),_ray.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(_ray.direction))<TILT_LIMIT?t.lookAt(r.target):(_plane.setFromNormalAndCoplanarPoint(r.object.up,r.target),_ray.intersectPlane(_plane,r.target))))}else r.object instanceof OrthographicCamera&&r.object.isOrthographicCamera&&(Bi=Z!==1,Bi&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/Z)),r.object.updateProjectionMatrix()));return Z=1,ee=!1,Bi||Bt.distanceToSquared(r.object.position)>A||8*(1-qe.dot(r.object.quaternion))>A?(r.dispatchEvent(u),Bt.copy(r.object.position),qe.copy(r.object.quaternion),Bi=!1,!0):!1}})(),this.connect=me=>{r.domElement=me,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",De),r.domElement.addEventListener("pointerdown",he),r.domElement.addEventListener("pointercancel",it),r.domElement.addEventListener("wheel",ot)},this.dispose=()=>{var me,Ee,_e,Me,Bt,qe;r.domElement&&(r.domElement.style.touchAction="auto"),(me=r.domElement)==null||me.removeEventListener("contextmenu",De),(Ee=r.domElement)==null||Ee.removeEventListener("pointerdown",he),(_e=r.domElement)==null||_e.removeEventListener("pointercancel",it),(Me=r.domElement)==null||Me.removeEventListener("wheel",ot),(Bt=r.domElement)==null||Bt.ownerDocument.removeEventListener("pointermove",ke),(qe=r.domElement)==null||qe.ownerDocument.removeEventListener("pointerup",it),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Zt)};const r=this,u={type:"change"},d={type:"start"},C={type:"end"},I={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let f=I.NONE;const A=1e-6,G=new Spherical,B=new Spherical;let Z=1;const w=new Vector3,V=new Vector2,Y=new Vector2,J=new Vector2,T=new Vector2,L=new Vector2,z=new Vector2,K=new Vector2,P=new Vector2,$=new Vector2,ie=new Vector3,ne=new Vector2;let ee=!1;const se=[],re={};function ce(){return 2*Math.PI/60/60*r.autoRotateSpeed}function ue(){return Math.pow(.95,r.zoomSpeed)}function ye(me){r.reverseOrbit||r.reverseHorizontalOrbit?B.theta+=me:B.theta-=me}function Se(me){r.reverseOrbit||r.reverseVerticalOrbit?B.phi+=me:B.phi-=me}const Ce=(()=>{const me=new Vector3;return function(_e,Me){me.setFromMatrixColumn(Me,0),me.multiplyScalar(-_e),w.add(me)}})(),Ze=(()=>{const me=new Vector3;return function(_e,Me){r.screenSpacePanning===!0?me.setFromMatrixColumn(Me,1):(me.setFromMatrixColumn(Me,0),me.crossVectors(r.object.up,me)),me.multiplyScalar(_e),w.add(me)}})(),Be=(()=>{const me=new Vector3;return function(_e,Me){const Bt=r.domElement;if(Bt&&r.object instanceof PerspectiveCamera&&r.object.isPerspectiveCamera){const qe=r.object.position;me.copy(qe).sub(r.target);let at=me.length();at*=Math.tan(r.object.fov/2*Math.PI/180),Ce(2*_e*at/Bt.clientHeight,r.object.matrix),Ze(2*Me*at/Bt.clientHeight,r.object.matrix)}else Bt&&r.object instanceof OrthographicCamera&&r.object.isOrthographicCamera?(Ce(_e*(r.object.right-r.object.left)/r.object.zoom/Bt.clientWidth,r.object.matrix),Ze(Me*(r.object.top-r.object.bottom)/r.object.zoom/Bt.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function xe(me){r.object instanceof PerspectiveCamera&&r.object.isPerspectiveCamera||r.object instanceof OrthographicCamera&&r.object.isOrthographicCamera?Z=me:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ge(me){xe(Z/me)}function de(me){xe(Z*me)}function ve(me){if(!r.zoomToCursor||!r.domElement)return;ee=!0;const Ee=r.domElement.getBoundingClientRect(),_e=me.clientX-Ee.left,Me=me.clientY-Ee.top,Bt=Ee.width,qe=Ee.height;ne.x=_e/Bt*2-1,ne.y=-(Me/qe)*2+1,ie.set(ne.x,ne.y,1).unproject(r.object).sub(r.object.position).normalize()}function le(me){return Math.max(r.minDistance,Math.min(r.maxDistance,me))}function Ae(me){V.set(me.clientX,me.clientY)}function Xe(me){ve(me),K.set(me.clientX,me.clientY)}function Te(me){T.set(me.clientX,me.clientY)}function Ne(me){Y.set(me.clientX,me.clientY),J.subVectors(Y,V).multiplyScalar(r.rotateSpeed);const Ee=r.domElement;Ee&&(ye(2*Math.PI*J.x/Ee.clientHeight),Se(2*Math.PI*J.y/Ee.clientHeight)),V.copy(Y),r.update()}function We(me){P.set(me.clientX,me.clientY),$.subVectors(P,K),$.y>0?ge(ue()):$.y<0&&de(ue()),K.copy(P),r.update()}function dt(me){L.set(me.clientX,me.clientY),z.subVectors(L,T).multiplyScalar(r.panSpeed),Be(z.x,z.y),T.copy(L),r.update()}function nt(me){ve(me),me.deltaY<0?de(ue()):me.deltaY>0&&ge(ue()),r.update()}function Rt(me){let Ee=!1;switch(me.code){case r.keys.UP:Be(0,r.keyPanSpeed),Ee=!0;break;case r.keys.BOTTOM:Be(0,-r.keyPanSpeed),Ee=!0;break;case r.keys.LEFT:Be(r.keyPanSpeed,0),Ee=!0;break;case r.keys.RIGHT:Be(-r.keyPanSpeed,0),Ee=!0;break}Ee&&(me.preventDefault(),r.update())}function Qe(){if(se.length==1)V.set(se[0].pageX,se[0].pageY);else{const me=.5*(se[0].pageX+se[1].pageX),Ee=.5*(se[0].pageY+se[1].pageY);V.set(me,Ee)}}function Oe(){if(se.length==1)T.set(se[0].pageX,se[0].pageY);else{const me=.5*(se[0].pageX+se[1].pageX),Ee=.5*(se[0].pageY+se[1].pageY);T.set(me,Ee)}}function be(){const me=se[0].pageX-se[1].pageX,Ee=se[0].pageY-se[1].pageY,_e=Math.sqrt(me*me+Ee*Ee);K.set(0,_e)}function yt(){r.enableZoom&&be(),r.enablePan&&Oe()}function st(){r.enableZoom&&be(),r.enableRotate&&Qe()}function Gt(me){if(se.length==1)Y.set(me.pageX,me.pageY);else{const _e=Ct(me),Me=.5*(me.pageX+_e.x),Bt=.5*(me.pageY+_e.y);Y.set(Me,Bt)}J.subVectors(Y,V).multiplyScalar(r.rotateSpeed);const Ee=r.domElement;Ee&&(ye(2*Math.PI*J.x/Ee.clientHeight),Se(2*Math.PI*J.y/Ee.clientHeight)),V.copy(Y)}function rt(me){if(se.length==1)L.set(me.pageX,me.pageY);else{const Ee=Ct(me),_e=.5*(me.pageX+Ee.x),Me=.5*(me.pageY+Ee.y);L.set(_e,Me)}z.subVectors(L,T).multiplyScalar(r.panSpeed),Be(z.x,z.y),T.copy(L)}function Yt(me){const Ee=Ct(me),_e=me.pageX-Ee.x,Me=me.pageY-Ee.y,Bt=Math.sqrt(_e*_e+Me*Me);P.set(0,Bt),$.set(0,Math.pow(P.y/K.y,r.zoomSpeed)),ge($.y),K.copy(P)}function Xt(me){r.enableZoom&&Yt(me),r.enablePan&&rt(me)}function Ge(me){r.enableZoom&&Yt(me),r.enableRotate&&Gt(me)}function he(me){var Ee,_e;r.enabled!==!1&&(se.length===0&&((Ee=r.domElement)==null||Ee.ownerDocument.addEventListener("pointermove",ke),(_e=r.domElement)==null||_e.ownerDocument.addEventListener("pointerup",it)),ct(me),me.pointerType==="touch"?wt(me):ht(me))}function ke(me){r.enabled!==!1&&(me.pointerType==="touch"?Et(me):He(me))}function it(me){var Ee,_e,Me;ft(me),se.length===0&&((Ee=r.domElement)==null||Ee.releasePointerCapture(me.pointerId),(_e=r.domElement)==null||_e.ownerDocument.removeEventListener("pointermove",ke),(Me=r.domElement)==null||Me.ownerDocument.removeEventListener("pointerup",it)),r.dispatchEvent(C),f=I.NONE}function ht(me){let Ee;switch(me.button){case 0:Ee=r.mouseButtons.LEFT;break;case 1:Ee=r.mouseButtons.MIDDLE;break;case 2:Ee=r.mouseButtons.RIGHT;break;default:Ee=-1}switch(Ee){case MOUSE.DOLLY:if(r.enableZoom===!1)return;Xe(me),f=I.DOLLY;break;case MOUSE.ROTATE:if(me.ctrlKey||me.metaKey||me.shiftKey){if(r.enablePan===!1)return;Te(me),f=I.PAN}else{if(r.enableRotate===!1)return;Ae(me),f=I.ROTATE}break;case MOUSE.PAN:if(me.ctrlKey||me.metaKey||me.shiftKey){if(r.enableRotate===!1)return;Ae(me),f=I.ROTATE}else{if(r.enablePan===!1)return;Te(me),f=I.PAN}break;default:f=I.NONE}f!==I.NONE&&r.dispatchEvent(d)}function He(me){if(r.enabled!==!1)switch(f){case I.ROTATE:if(r.enableRotate===!1)return;Ne(me);break;case I.DOLLY:if(r.enableZoom===!1)return;We(me);break;case I.PAN:if(r.enablePan===!1)return;dt(me);break}}function ot(me){r.enabled===!1||r.enableZoom===!1||f!==I.NONE&&f!==I.ROTATE||(me.preventDefault(),r.dispatchEvent(d),nt(me),r.dispatchEvent(C))}function Zt(me){r.enabled===!1||r.enablePan===!1||Rt(me)}function wt(me){switch(At(me),se.length){case 1:switch(r.touches.ONE){case TOUCH.ROTATE:if(r.enableRotate===!1)return;Qe(),f=I.TOUCH_ROTATE;break;case TOUCH.PAN:if(r.enablePan===!1)return;Oe(),f=I.TOUCH_PAN;break;default:f=I.NONE}break;case 2:switch(r.touches.TWO){case TOUCH.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;yt(),f=I.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;st(),f=I.TOUCH_DOLLY_ROTATE;break;default:f=I.NONE}break;default:f=I.NONE}f!==I.NONE&&r.dispatchEvent(d)}function Et(me){switch(At(me),f){case I.TOUCH_ROTATE:if(r.enableRotate===!1)return;Gt(me),r.update();break;case I.TOUCH_PAN:if(r.enablePan===!1)return;rt(me),r.update();break;case I.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Xt(me),r.update();break;case I.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ge(me),r.update();break;default:f=I.NONE}}function De(me){r.enabled!==!1&&me.preventDefault()}function ct(me){se.push(me)}function ft(me){delete re[me.pointerId];for(let Ee=0;Ee<se.length;Ee++)if(se[Ee].pointerId==me.pointerId){se.splice(Ee,1);return}}function At(me){let Ee=re[me.pointerId];Ee===void 0&&(Ee=new Vector2,re[me.pointerId]=Ee),Ee.set(me.pageX,me.pageY)}function Ct(me){const Ee=me.pointerId===se[0].pointerId?se[1]:se[0];return re[Ee.pointerId]}this.dollyIn=(me=ue())=>{de(me),r.update()},this.dollyOut=(me=ue())=>{ge(me),r.update()},this.getScale=()=>Z,this.setScale=me=>{xe(me),r.update()},this.getZoomScale=()=>ue(),o!==void 0&&this.connect(o),this.update()}};const OrbitControls=reactExports.forwardRef(({makeDefault:n,camera:t,regress:o,domElement:r,enableDamping:u=!0,keyEvents:d=!1,onChange:C,onStart:I,onEnd:f,...A},G)=>{const B=useThree($=>$.invalidate),Z=useThree($=>$.camera),w=useThree($=>$.gl),V=useThree($=>$.events),Y=useThree($=>$.setEvents),J=useThree($=>$.set),T=useThree($=>$.get),L=useThree($=>$.performance),z=t||Z,K=r||V.connected||w.domElement,P=reactExports.useMemo(()=>new OrbitControls$1(z),[z]);return useFrame(()=>{P.enabled&&P.update()},-1),reactExports.useEffect(()=>(d&&P.connect(d===!0?K:d),P.connect(K),()=>void P.dispose()),[d,K,o,P,B]),reactExports.useEffect(()=>{const $=ee=>{B(),o&&L.regress(),C&&C(ee)},ie=ee=>{I&&I(ee)},ne=ee=>{f&&f(ee)};return P.addEventListener("change",$),P.addEventListener("start",ie),P.addEventListener("end",ne),()=>{P.removeEventListener("start",ie),P.removeEventListener("end",ne),P.removeEventListener("change",$)}},[C,I,f,P,B,Y]),reactExports.useEffect(()=>{if(n){const $=T().controls;return J({controls:P}),()=>J({controls:$})}},[n,P]),reactExports.createElement("primitive",_extends({ref:G,object:P,enableDamping:u},A))});function Ball({config:n,onPositionUpdate:t}){const{mass:o,radius:r,position:u,velocity:d,color:C="red",restitution:I=.7}=n,[f,A]=useSphere(()=>({mass:o,position:u,velocity:d,args:[r],material:{restitution:I}})),G=reactExports.useRef(performance.now()/1e3),B=reactExports.useRef({x:u[0],y:u[1],z:u[2]});return useFrame(()=>{A.position.subscribe(Z=>{const[w,V,Y]=Z,J=performance.now()/1e3-G.current;(Math.abs(w-B.current.x)>.01||Math.abs(V-B.current.y)>.01||Math.abs(Y-B.current.z)>.01)&&(B.current={x:w,y:V,z:Y},t({x:w,y:V,z:Y,t:J}))})}),jsxRuntimeExports.jsxs("mesh",{ref:f,children:[jsxRuntimeExports.jsx("sphereGeometry",{args:[r,32,32]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:C})]})}function Plane(n){const[t]=usePlane(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],...n}));return jsxRuntimeExports.jsxs("mesh",{ref:t,receiveShadow:!0,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[100,100]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"gray"})]})}function FpsCounter({setFps:n}){const t=reactExports.useRef(performance.now()),o=reactExports.useRef(0);return useFrame(()=>{const r=performance.now();o.current+=1;const u=r-t.current;u>=1e3&&(n(Math.round(o.current*1e3/u)),o.current=0,t.current=r)}),null}function Visualizer({scene:n,onPositionUpdate:t}){const[o,r]=reactExports.useState(0),[u,d]=reactExports.useState({x:0,y:0,z:0,t:0}),{gravity:C=[0,-9.81,0]}=n||{},I=f=>{d(f),t(f)};return jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[jsxRuntimeExports.jsxs(Canvas,{style:{height:"100%",width:"100%"},shadows:!0,camera:{position:[10,10,10],fov:50},children:[jsxRuntimeExports.jsx("ambientLight",{intensity:.5}),jsxRuntimeExports.jsx("pointLight",{position:[10,10,10],castShadow:!0}),jsxRuntimeExports.jsxs(PhysicsProvider,{gravity:C,defaultContactMaterial:{friction:.5,restitution:.7},children:[n&&n.objects.map((f,A)=>f.type==="sphere"?jsxRuntimeExports.jsx(Ball,{config:f,onPositionUpdate:I},A):null),jsxRuntimeExports.jsx(Plane,{})]}),jsxRuntimeExports.jsx(OrbitControls,{}),jsxRuntimeExports.jsx("axesHelper",{args:[5]}),jsxRuntimeExports.jsx(FpsCounter,{setFps:r}),jsxRuntimeExports.jsx("gridHelper",{args:[20,20]})]}),jsxRuntimeExports.jsxs("div",{className:"position-display",style:{position:"absolute",top:"50px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",padding:"5px",borderRadius:"4px",zIndex:10},children:[jsxRuntimeExports.jsx("div",{children:"Position:"}),jsxRuntimeExports.jsxs("div",{children:["X: ",u.x.toFixed(2)," m"]}),jsxRuntimeExports.jsxs("div",{children:["Y: ",u.y.toFixed(2)," m"]}),jsxRuntimeExports.jsxs("div",{children:["T: ",u.t.toFixed(2)," s"]})]}),jsxRuntimeExports.jsxs("div",{className:"fps-counter",style:{position:"absolute",top:"10px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",padding:"5px",borderRadius:"4px",zIndex:10},children:["FPS: ",o]})]})}var jxg={};try{typeof JXG=="object"&&!JXG.extend&&(jxg=JXG)}catch{}jxg.extend=function(n,t,o,r){var u,d;o=o||!1,r=r||!1;for(u in t)(!o||o&&t.hasOwnProperty(u))&&(r?d=u.toLowerCase():d=u,n[d]=t[u])};jxg.defineConstant=function(n,t,o,r){r=r||!1,!(r&&jxg.exists(n[t]))&&Object.defineProperty(n,t,{value:o,writable:!1,enumerable:!0,configurable:!1})};jxg.extendConstants=function(n,t,o,r){var u,d;o=o||!1,r=r||!1;for(u in t)(!o||o&&t.hasOwnProperty(u))&&(r?d=u.toUpperCase():d=u,this.defineConstant(n,d,t[u]))};jxg.extend(jxg,{boards:{},readers:{},elements:{},registerElement:function(n,t){n=n.toLowerCase(),this.elements[n]=t},registerReader:function(n,t){var o,r;for(o=0;o<t.length;o++)r=t[o].toLowerCase(),typeof this.readers[r]!="function"&&(this.readers[r]=n)},shortcut:function(n,t){return function(){return n[t].apply(this,arguments)}},getRef:function(n,t){return jxg.deprecated("JXG.getRef()","Board.select()"),n.select(t)},getReference:function(n,t){return jxg.deprecated("JXG.getReference()","Board.select()"),n.select(t)},getBoardByContainerId:function(n){var t;for(t in JXG.boards)if(JXG.boards.hasOwnProperty(t)&&JXG.boards[t].container===n)return JXG.boards[t];return null},deprecated:function(n,t){var o=n+" is deprecated.";t&&(o+=" Please use "+t+" instead."),jxg.warn(o)},warn:function(n){typeof window=="object"&&window.console&&console.warn?console.warn("WARNING:",n):typeof document=="object"&&document.getElementById("warning")&&(document.getElementById("debug").innerHTML+="WARNING: "+n+"<br />")},debugInt:function(n){var t,o;for(t=0;t<arguments.length;t++)o=arguments[t],typeof window=="object"&&window.console&&console.log?console.log(o):typeof document=="object"&&document.getElementById("debug")&&(document.getElementById("debug").innerHTML+=o+"<br/>")},debugWST:function(n){var t=new Error;jxg.debugInt.apply(this,arguments),t&&t.stack&&(jxg.debugInt("stacktrace"),jxg.debugInt(t.stack.split(`
`).slice(1).join(`
`)))},debugLine:function(n){var t=new Error;jxg.debugInt.apply(this,arguments),t&&t.stack&&jxg.debugInt("Called from",t.stack.split(`
`).slice(2,3).join(`
`))},debug:function(n){jxg.debugInt.apply(this,arguments)},themes:{}});const JXG$1=jxg;var major=1,minor=10,patch=1,version=major+"."+minor+"."+patch,constants;constants={version,licenseText:"JSXGraph v"+version+" Copyright (C) see https://jsxgraph.org",COORDS_BY_USER:1,COORDS_BY_SCREEN:2,OBJECT_TYPE_ARC:1,OBJECT_TYPE_ARROW:2,OBJECT_TYPE_AXIS:3,OBJECT_TYPE_AXISPOINT:4,OBJECT_TYPE_TICKS:5,OBJECT_TYPE_CIRCLE:6,OBJECT_TYPE_CONIC:7,OBJECT_TYPE_CURVE:8,OBJECT_TYPE_GLIDER:9,OBJECT_TYPE_IMAGE:10,OBJECT_TYPE_LINE:11,OBJECT_TYPE_POINT:12,OBJECT_TYPE_SLIDER:13,OBJECT_TYPE_CAS:14,OBJECT_TYPE_GXTCAS:15,OBJECT_TYPE_POLYGON:16,OBJECT_TYPE_SECTOR:17,OBJECT_TYPE_TEXT:18,OBJECT_TYPE_ANGLE:19,OBJECT_TYPE_INTERSECTION:20,OBJECT_TYPE_TURTLE:21,OBJECT_TYPE_VECTOR:22,OBJECT_TYPE_OPROJECT:23,OBJECT_TYPE_GRID:24,OBJECT_TYPE_TANGENT:25,OBJECT_TYPE_HTMLSLIDER:26,OBJECT_TYPE_CHECKBOX:27,OBJECT_TYPE_INPUT:28,OBJECT_TYPE_BUTTON:29,OBJECT_TYPE_TRANSFORMATION:30,OBJECT_TYPE_FOREIGNOBJECT:31,OBJECT_TYPE_VIEW3D:32,OBJECT_TYPE_POINT3D:33,OBJECT_TYPE_LINE3D:34,OBJECT_TYPE_PLANE3D:35,OBJECT_TYPE_CURVE3D:36,OBJECT_TYPE_SURFACE3D:37,OBJECT_TYPE_MEASUREMENT:38,OBJECT_TYPE_INTERSECTION_LINE3D:39,OBJECT_TYPE_SPHERE3D:40,OBJECT_TYPE_CIRCLE3D:41,OBJECT_TYPE_INTERSECTION_CIRCLE3D:42,OBJECT_TYPE_TEXT3D:43,OBJECT_CLASS_POINT:1,OBJECT_CLASS_LINE:2,OBJECT_CLASS_CIRCLE:3,OBJECT_CLASS_CURVE:4,OBJECT_CLASS_AREA:5,OBJECT_CLASS_OTHER:6,OBJECT_CLASS_TEXT:7,OBJECT_CLASS_3D:8};JXG$1.extendConstants(JXG$1,constants);const Const=constants;var undef,memoizer=function(n){var t,o;return n.memo||(t={},o=Array.prototype.join,n.memo=function(){var r=o.call(arguments);return t[r]!==undef?t[r]:t[r]=n.apply(this,arguments)}),n.memo};JXG$1.Math={eps:1e-6,relDif:function(n,t){var o=Math.abs(n),r=Math.abs(t);return r=Math.max(o,r),r===0?0:Math.abs(n-t)/r},mod:function(n,t){return n-Math.floor(n/t)*t},wrap:function(n,t,o){return t+this.mod(n-t,o-t)},clamp:function(n,t,o){return Math.min(Math.max(n,t),o)},wrapAndClamp:function(n,t,o,r){var u=.5*(t+o),d=.5*r;return this.clamp(this.wrap(n,u-d,u+d),t,o)},vector:function(n,t){var o,r;for(t=t||0,o=[],r=0;r<n;r++)o[r]=t;return o},matrix:function(n,t,o){var r,u,d;for(o=o||0,t=t||n,r=[],u=0;u<n;u++)for(r[u]=[],d=0;d<t;d++)r[u][d]=o;return r},identity:function(n,t){var o,r;for(t===undef&&typeof t!="number"&&(t=n),o=this.matrix(n,t),r=0;r<Math.min(n,t);r++)o[r][r]=1;return o},frustum:function(n,t,o,r,u,d){var C=this.matrix(4,4);return C[0][0]=u*2/(t-n),C[0][1]=0,C[0][2]=(t+n)/(t-n),C[0][3]=0,C[1][0]=0,C[1][1]=u*2/(r-o),C[1][2]=(r+o)/(r-o),C[1][3]=0,C[2][0]=0,C[2][1]=0,C[2][2]=-(d+u)/(d-u),C[2][3]=-(d*u*2)/(d-u),C[3][0]=0,C[3][1]=0,C[3][2]=-1,C[3][3]=0,C},projection:function(n,t,o,r){var u=o*Math.tan(n/2),d=u*t;return this.frustum(-d,d,-u,u,o,r)},matVecMult:function(n,t){var o,r,u,d=n.length,C=t.length,I=[];if(C===3)for(o=0;o<d;o++)I[o]=n[o][0]*t[0]+n[o][1]*t[1]+n[o][2]*t[2];else for(o=0;o<d;o++){for(r=0,u=0;u<C;u++)r+=n[o][u]*t[u];I[o]=r}return I},matMatMult:function(n,t){var o,r,u,d,C=n.length,I=C>0?t[0].length:0,f=t.length,A=this.matrix(C,I);for(o=0;o<C;o++)for(r=0;r<I;r++){for(u=0,d=0;d<f;d++)u+=n[o][d]*t[d][r];A[o][r]=u}return A},transpose:function(n){var t,o,r,u,d;for(u=n.length,d=n.length>0?n[0].length:0,t=this.matrix(d,u),o=0;o<d;o++)for(r=0;r<u;r++)t[o][r]=n[r][o];return t},inverse:function(n){var t,o,r,u,d,C,I,f=n.length,A=[],G=[],B=[];for(t=0;t<f;t++){for(A[t]=[],o=0;o<f;o++)A[t][o]=n[t][o];G[t]=t}for(o=0;o<f;o++){for(d=Math.abs(A[o][o]),C=o,t=o+1;t<f;t++)Math.abs(A[t][o])>d&&(d=Math.abs(A[t][o]),C=t);if(d<=this.eps)return[];if(C>o){for(r=0;r<f;r++)I=A[o][r],A[o][r]=A[C][r],A[C][r]=I;I=G[o],G[o]=G[C],G[C]=I}for(u=1/A[o][o],t=0;t<f;t++)A[t][o]*=u;for(A[o][o]=u,r=0;r<f;r++)if(r!==o){for(t=0;t<f;t++)t!==o&&(A[t][r]-=A[t][o]*A[o][r]);A[o][r]=-u*A[o][r]}}for(t=0;t<f;t++){for(r=0;r<f;r++)B[G[r]]=A[t][r];for(r=0;r<f;r++)A[t][r]=B[r]}return A},innerProduct:function(n,t,o){var r,u=0;for((o===undef||!JXG$1.isNumber(o))&&(o=n.length),r=0;r<o;r++)u+=n[r]*t[r];return u},crossProduct:function(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]},norm:function(n,t){var o,r=0;for((t===undef||!JXG$1.isNumber(t))&&(t=n.length),o=0;o<t;o++)r+=n[o]*n[o];return Math.sqrt(r)},axpy:function(n,t,o){var r,u=t.length,d=[];for(r=0;r<u;r++)d[r]=n*t[r]+o[r];return d},factorial:memoizer(function(n){return n<0?NaN:(n=Math.floor(n),n===0||n===1?1:n*this.factorial(n-1))}),binomial:memoizer(function(n,t){var o,r;if(t>n||t<0)return NaN;if(t=Math.round(t),n=Math.round(n),t===0||t===n)return 1;for(o=1,r=0;r<t;r++)o*=n-r,o/=r+1;return o}),cosh:Math.cosh||function(n){return(Math.exp(n)+Math.exp(-n))*.5},sinh:Math.sinh||function(n){return(Math.exp(n)-Math.exp(-n))*.5},acosh:Math.acosh||function(n){return Math.log(n+Math.sqrt(n*n-1))},asinh:Math.asinh||function(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))},cot:function(n){return 1/Math.tan(n)},acot:function(n){return(n>=0?.5:-.5)*Math.PI-Math.atan(n)},nthroot:function(n,t){var o=1/t;return t<=0||Math.floor(t)!==t?NaN:n===0?0:n>0?Math.exp(o*Math.log(n)):t%2===1?-Math.exp(o*Math.log(-n)):NaN},cbrt:Math.cbrt||function(n){return this.nthroot(n,3)},pow:function(n,t){return n===0?t===0?1:0:Math.floor(t)===t?Math.pow(n,t):n>0?Math.exp(t*Math.log(n)):NaN},ratpow:function(n,t,o){var r;return t===0?1:o===0?NaN:(r=this.gcd(t,o),this.nthroot(this.pow(n,t/r),o/r))},log10:function(n){return Math.log(n)/Math.log(10)},log2:function(n){return Math.log(n)/Math.log(2)},log:function(n,t){return t!==void 0&&JXG$1.isNumber(t)?Math.log(n)/Math.log(t):Math.log(n)},sign:Math.sign||function(n){return n=+n,n===0||isNaN(n)?n:n>0?1:-1},squampow:function(n,t){var o;if(Math.floor(t)===t){for(o=1,t<0&&(n=1/n,t*=-1);t!==0;)t&1&&(o*=n),t>>=1,n*=n;return o}return this.pow(n,t)},gcd:function(n,t){var o,r=!0;if(n=Math.abs(n),t=Math.abs(t),!(JXG$1.isNumber(n)&&JXG$1.isNumber(t)))return NaN;for(t>n&&(o=n,n=t,t=o);r;){if(n%=t,n===0)return t;if(t%=n,t===0)return n}},lcm:function(n,t){var o;return JXG$1.isNumber(n)&&JXG$1.isNumber(t)?(o=n*t,o!==0?o/this.gcd(n,t):0):NaN},roundToStep:function(n,t,o,r){var u=n,d,C;if(!JXG$1.exists(t)&&!JXG$1.exists(o)&&!JXG$1.exists(r))return u;if(JXG$1.exists(r)&&(u=Math.min(u,r)),JXG$1.exists(o)&&(u=Math.max(u,o)),C=o||0,JXG$1.exists(t)){if(d=(u-C)/t,Number.isInteger(d))return u;d=Math.round(d),u=C+d*t}return JXG$1.exists(r)&&(u=Math.min(u,r)),JXG$1.exists(o)&&(u=Math.max(u,o)),u},erf:function(n){return this.ProbFuncs.erf(n)},erfc:function(n){return this.ProbFuncs.erfc(n)},erfi:function(n){return this.ProbFuncs.erfi(n)},ndtr:function(n){return this.ProbFuncs.ndtr(n)},ndtri:function(n){return this.ProbFuncs.ndtri(n)},hypot:function(){var n,t,o,r;for(t=arguments.length,n=0,r=0;n<t;n++)o=arguments[n],r+=o*o;return Math.sqrt(r)},hstep:function(n){return n>0?1:n<0?0:.5},gamma:function(n){var t,o,r,u,d,C=7,I=[1,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(n<.5)o=Math.PI/(Math.sin(Math.PI*n)*this.gamma(1-n));else{for(n-=1,t=I[0],d=I.length,u=1;u<d;u++)t+=I[u]/(n+u);r=n+C+.5,o=Math.sqrt(2*Math.PI)*Math.pow(r,n+.5)*Math.exp(-r)*t}return o},lt:function(n,t){return n<t},leq:function(n,t){return n<=t},gt:function(n,t){return n>t},geq:function(n,t){return n>=t},eq:function(n,t){return n===t},neq:function(n,t){return n!==t},and:function(n,t){return n&&t},not:function(n){return!n},or:function(n,t){return n||t},xor:function(n,t){return(n||t)&&!(n&&t)},decToFraction:function(n,t){var o,r,u,d,C,I,f,A,G,B=0,Z=20;for(t=JXG$1.def(t,.001),n=Math.round(n*1e12)*1e-12,r=n<0?-1:1,n=Math.abs(n),o=Math.floor(n),n-=Math.floor(n),u=0,I=1,d=C=u,G=0,f=A=1;n-Math.floor(n)>t&&B<Z;)n=1/(n-u),u=Math.floor(n),d=I+u*C,f=G+u*A,I=C,G=A,C=d,A=f,B++;return[r,o,d,f]},normalize:function(n){var t,o,r=2*n[3],u=n[4]/r;return n[5]=u,n[6]=-n[1]/r,n[7]=-n[2]/r,isFinite(u)?Math.abs(u)>=1?(n[0]=(n[6]*n[6]+n[7]*n[7]-u*u)/(2*u),n[1]=-n[6]/u,n[2]=-n[7]/u,n[3]=1/(2*u),n[4]=1):(o=u<=0?-1:1,n[0]=o*(n[6]*n[6]+n[7]*n[7]-u*u)*.5,n[1]=-o*n[6],n[2]=-o*n[7],n[3]=o/2,n[4]=o*u):(t=this.hypot(n[1],n[2]),n[0]/=t,n[1]/=t,n[2]/=t,n[3]=0,n[4]=1),n},toGL:function(n){var t,o,r;if(typeof Float32Array=="function"?t=new Float32Array(16):t=new Array(16),n.length!==4&&n[0].length!==4)return t;for(o=0;o<4;o++)for(r=0;r<4;r++)t[o+4*r]=n[o][r];return t},Vieta:function(n){var t=n.length,o=[],r,u,d;for(o=n.slice(),r=1;r<t;++r){for(d=o[r],o[r]*=o[r-1],u=r-1;u>=1;--u)o[u]+=o[u-1]*d;o[0]+=d}return o}};const Mat=JXG$1.Math;JXG$1.extend(JXG$1,{isBoard:function(n){return n!==null&&typeof n=="object"&&this.isNumber(n.BOARD_MODE_NONE)&&this.isObject(n.objects)&&this.isObject(n.jc)&&this.isFunction(n.update)&&!!n.containerObj&&this.isString(n.id)},isId:function(n,t){return typeof t=="string"&&!!n.objects[t]},isName:function(n,t){return typeof t=="string"&&!!n.elementsByName[t]},isGroup:function(n,t){return typeof t=="string"&&!!n.groups[t]},isString:function(n){return typeof n=="string"},isNumber:function(n,t,o){var r=typeof n=="number"||Object.prototype.toString.call(n)==="[Object Number]";return t=t||!1,o=o===void 0?!0:o,t&&(r=r||""+parseFloat(n)===n),o||(r=r&&!isNaN(n)),r},isFunction:function(n){return typeof n=="function"},isArray:function(n){var t;return Array.isArray?t=Array.isArray(n):t=n!==null&&typeof n=="object"&&typeof n.splice=="function"&&typeof n.join=="function",t},isObject:function(n){return typeof n=="object"&&!this.isArray(n)},isDocumentOrFragment:function(n){return this.isObject(n)&&(n.nodeType===9||n.nodeType===11)},isPoint:function(n){return n!==null&&typeof n=="object"&&this.exists(n.elementClass)?n.elementClass===Const.OBJECT_CLASS_POINT:!1},isPoint3D:function(n){return n!==null&&typeof n=="object"&&this.exists(n.type)?n.type===Const.OBJECT_TYPE_POINT3D:!1},isPointType:function(n,t){var o,r;return this.isArray(t)||this.isFunction(t)&&(o=t(),this.isArray(o)&&o.length>1)?!0:(r=n.select(t),this.isPoint(r))},isPointType3D:function(n,t){var o,r;return this.isArray(t)&&t.length>=3||this.isFunction(t)&&(o=t(),this.isArray(o)&&o.length>=3)?!0:(r=n.select(t),this.isPoint3D(r))},isTransformationOrArray:function(n){if(n!==null){if(this.isArray(n)&&n.length>0)return this.isTransformationOrArray(n[0]);if(typeof n=="object")return n.type===Const.OBJECT_TYPE_TRANSFORMATION}return!1},isEmpty:function(n){return Object.keys(n).length===0},exists:function(n,t){var o=!(n==null||n===null);return t=t||!1,t?o&&n!=="":o},def:function(n,t){return this.exists(n)?n:t},str2Bool:function(n){return this.exists(n)?typeof n=="boolean"?n:this.isString(n)?n.toLowerCase()==="true":!1:!0},cssParse:function(n){var t=n;return this.isString(t)?(t=t.replace(/\s*;\s*$/g,""),t=t.replace(/\s*;\s*/g,'","'),t=t.replace(/\s*:\s*/g,'":"'),t=t.trim(),t='{"'+t+'"}',JSON.parse(t)):{}},cssStringify:function(n){var t="",o,r;if(!this.isObject(n))return"";for(o in n)n.hasOwnProperty(o)&&(r=n[o],!(!this.isString(r)&&!this.isNumber(r))&&(t+=o+":"+r+"; "));return t=t.trim(),t},createEvalFunction:function(n,t,o){var r=[],u,d,C,I={};for(d=0;d<o;d++){r[d]=JXG$1.createFunction(t[d],n);for(C in r[d].deps)I[C]=r[d].deps}return u=function(f){return r[f]()},u.deps=I,u},createFunction:function(n,t,o,r){var u=null;return this.isString(n)?u=t.jc.snippet(n,!0,o,!1):this.isFunction(n)?(u=n,u.deps=this.isObject(n.deps)?n.deps:{}):this.isNumber(n)&&(u=function(){return n},u.deps={}),u!==null&&(u.origin=n),u},providePoints:function(n,t,o,r,u){var d,C,I,f=0,A=[],G,B;for(this.isArray(t)||(t=[t]),I=t.length,this.exists(u)&&(f=u.length),f===0&&(G=this.copyAttributes(o,n.options,r)),d=0;d<I;++d)if(f>0&&(C=Math.min(d,f-1),G=this.copyAttributes(o,n.options,r,u[C].toLowerCase())),this.isArray(t[d])&&t[d].length>1?(A.push(n.create("point",t[d],G)),A[A.length-1]._is_new=!0):this.isFunction(t[d])?(B=t[d](),this.isArray(B)&&B.length>1&&(A.push(n.create("point",[t[d]],G)),A[A.length-1]._is_new=!0)):A.push(n.select(t[d])),!this.isPoint(A[d]))return!1;return A},providePoints3D:function(n,t,o,r,u){var d,C,I,f=0,A=[],G,B;for(this.isArray(t)||(t=[t]),I=t.length,this.exists(u)&&(f=u.length),f===0&&(G=this.copyAttributes(o,n.board.options,r)),d=0;d<I;++d)if(f>0&&(C=Math.min(d,f-1),G=this.copyAttributes(o,n.board.options,r,u[C])),this.isArray(t[d])&&t[d].length>1?(A.push(n.create("point3d",t[d],G)),A[A.length-1]._is_new=!0):this.isFunction(t[d])?(B=t[d](),this.isArray(B)&&B.length>1&&(A.push(n.create("point3d",[t[d]],G)),A[A.length-1]._is_new=!0)):A.push(n.select(t[d])),!this.isPoint3D(A[d]))return!1;return A},bind:function(n,t){return function(){return n.apply(t,arguments)}},evaluate:function(n){return this.isFunction(n)?n():n},indexOf:function(n,t,o){var r,u=this.exists(o);if(Array.indexOf&&!u)return n.indexOf(t);for(r=0;r<n.length;r++)if(u&&n[r][o]===t||!u&&n[r]===t)return r;return-1},eliminateDuplicates:function(n){var t,o=n.length,r=[],u={};for(t=0;t<o;t++)u[n[t]]=0;for(t in u)u.hasOwnProperty(t)&&r.push(t);return r},swap:function(n,t,o){var r;return r=n[t],n[t]=n[o],n[o]=r,n},uniqueArray:function(n){var t,o,r,u=[];if(n.length===0)return[];for(t=0;t<n.length;t++){if(r=this.isArray(n[t]),!this.exists(n[t])){n[t]="";continue}for(o=t+1;o<n.length;o++)r&&JXG$1.cmpArrays(n[t],n[o])?n[t]=[]:!r&&n[t]===n[o]&&(n[t]="")}for(o=0,t=0;t<n.length;t++)r=this.isArray(n[t]),!r&&n[t]!==""?(u[o]=n[t],o++):r&&n[t].length!==0&&(u[o]=n[t].slice(0),o++);return n=u,u},isInArray:function(n,t){return JXG$1.indexOf(n,t)>-1},coordsArrayToMatrix:function(n,t){var o,r=[],u=[];for(o=0;o<n.length;o++)t?(r.push(n[o].usrCoords[1]),u.push(n[o].usrCoords[2])):u.push([n[o].usrCoords[1],n[o].usrCoords[2]]);return t&&(u=[r,u]),u},cmpArrays:function(n,t){var o;if(n===t)return!0;if(n.length!==t.length)return!1;for(o=0;o<n.length;o++)if(this.isArray(n[o])&&this.isArray(t[o])){if(!this.cmpArrays(n[o],t[o]))return!1}else if(n[o]!==t[o])return!1;return!0},removeElementFromArray:function(n,t){var o;for(o=0;o<n.length;o++)if(n[o]===t)return n.splice(o,1),n;return n},trunc:function(n,t){return t=JXG$1.def(t,0),this.toFixed(n,t)},_decimalAdjust:function(n,t,o){return o===void 0||+o==0?Math[n](t):(t=+t,o=+o,isNaN(t)||!(typeof o=="number"&&o%1===0)?NaN:(t=t.toString().split("e"),t=Math[n](+(t[0]+"e"+(t[1]?+t[1]-o:-o))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+o:o))))},_round10:function(n,t){return this._decimalAdjust("round",n,t)},_floor10:function(n,t){return this._decimalAdjust("floor",n,t)},_ceil10:function(n,t){return this._decimalAdjust("ceil",n,t)},toFixed:function(n,t){return this._round10(n,-t).toFixed(t)},autoDigits:function(n){var t=Math.abs(n),o;return t>=.1?o=this.toFixed(n,2):t>=.01?o=this.toFixed(n,4):t>=1e-4?o=this.toFixed(n,6):o=n,o},parseNumber:function(n,t,o){var r;return this.isString(n)&&n.indexOf("%")>-1?(r=n.replace(/\s+%\s+/,""),parseFloat(r)*t*.01):this.isString(n)&&n.indexOf("fr")>-1?(r=n.replace(/\s+fr\s+/,""),parseFloat(r)*t):this.isString(n)&&n.indexOf("px")>-1?(r=n.replace(/\s+px\s+/,""),r=parseFloat(r),this.isFunction(o)?o(r):this.isNumber(o)?r*o:r):parseFloat(n)},parsePosition:function(n){var t,o,r="",u="";if(n=n.trim(),n!=="")for(t=n.split(/[ ,]+/),o=0;o<t.length;o++)t[o]==="left"||t[o]==="right"?r=t[o]:u=t[o];return{side:r,pos:u}},keys:function(n,t){var o=[],r;for(r in n)t?n.hasOwnProperty(r)&&o.push(r):o.push(r);return o},clone:function(n){var t={};return t.prototype=n,t},cloneAndCopy:function(n,t){var o,r=function(){};r.prototype=n;for(o in t)r[o]=t[o];return r},merge:function(n,t){var o,r,u,d;for(o in t)if(t.hasOwnProperty(o))if(u=t[o],this.isArray(u))for(n[o]||(n[o]=[]),r=0;r<u.length;r++)d=t[o][r],typeof t[o][r]=="object"?n[o][r]=this.merge(n[o][r],d):n[o][r]=t[o][r];else typeof u=="object"?(n[o]||(n[o]={}),n[o]=this.merge(n[o],u)):(typeof n=="boolean"&&(n={}),n[o]=u);return n},deepCopy:function(n,t,o){var r,u,d,C;if(o=o||!1,typeof n!="object"||n===null)return n;if(this.isArray(n))for(r=[],u=0;u<n.length;u++)d=n[u],d!==null&&typeof d=="object"?this.exists(d.board)?r[u]=d.id:r[u]=this.deepCopy(d,{},o):r[u]=d;else{r={};for(u in n)n.hasOwnProperty(u)&&(C=o?u.toLowerCase():u,d=n[u],d!==null&&typeof d=="object"?this.exists(d.board)?r[C]=d.id:r[C]=this.deepCopy(d,{},o):r[C]=d);for(u in t)t.hasOwnProperty(u)&&(C=o?u.toLowerCase():u,d=t[u],d!==null&&typeof d=="object"?this.isArray(d)||!this.exists(r[C])?r[C]=this.deepCopy(d,{},o):r[C]=this.deepCopy(r[C],d,o):r[C]=d)}return r},mergeAttr:function(n,t,o,r){var u,d,C;o=o||!0,r=r||!1;for(u in t)t.hasOwnProperty(u)&&(d=o?u.toLowerCase():u,d!==u&&n.hasOwnProperty(u)&&(n.hasOwnProperty(d)?this.mergeAttr(n[d],n[u],o):n[d]=n[u],delete n[u]),C=t[u],this.isObject(C)&&C!==null&&!this.isDocumentOrFragment(C)&&!this.exists(C.board)&&typeof C.valueOf()!="string"?((n[d]===void 0||n[d]===null||!this.isObject(n[d]))&&(n[d]={}),this.mergeAttr(n[d],C,o)):(!r||this.exists(C))&&(n[d]=C))},keysToLowerCase:function(n){var t,o,r=Object.keys(n),u=r.length,d={};if(typeof n!="object")return n;for(;u--;)t=r[u],n.hasOwnProperty(t)&&(o=n[t],typeof o=="object"&&o!==null&&!this.isArray(o)&&!this.exists(o.nodeType)&&!this.exists(o.board)?d[t.toLowerCase()]=this.keysToLowerCase(o):d[t.toLowerCase()]=o);return d},copyAttributes:function(n,t,o){var r,u,d,C,I,f,A={circle:1,curve:1,foreignobject:1,image:1,line:1,point:1,polygon:1,text:1,ticks:1,integral:1};for(C=arguments.length,C<3||A[o]?r=JXG$1.deepCopy(t.elements,null,!0):r={},C<4&&this.exists(o)&&this.exists(t.layer[o])&&(r.layer=t.layer[o]),I=t,f=!0,d=2;d<C;d++)if(u=arguments[d],this.exists(I[u]))I=I[u];else{f=!1;break}for(f&&(r=JXG$1.deepCopy(r,I,!0)),I=typeof n=="object"?this.keysToLowerCase(n):{},f=!0,d=3;d<C;d++)if(u=arguments[d].toLowerCase(),this.exists(I[u]))I=I[u];else{f=!1;break}if(f&&this.mergeAttr(r,I,!0),arguments[2]==="board")return r;for(I=t,f=!0,d=2;d<C;d++)if(u=arguments[d],this.exists(I[u]))I=I[u];else{f=!1;break}return f&&this.exists(I.label)&&(r.label=JXG$1.deepCopy(I.label,r.label,!0)),r.label=JXG$1.deepCopy(t.label,r.label,!0),r},copyPrototypeMethods:function(n,t,o){var r;n.prototype[o]=t.prototype.constructor;for(r in t.prototype)t.prototype.hasOwnProperty(r)&&(n.prototype[r]=t.prototype[r])},toJSON:function(n,t){var o,r,u,d,C;if(t=JXG$1.def(t,!1),JSON!==void 0&&JSON.stringify&&!t)try{return d=JSON.stringify(n),d}catch{}switch(typeof n){case"object":if(n){if(o=[],this.isArray(n)){for(u=0;u<n.length;u++)o.push(JXG$1.toJSON(n[u],t));return"["+o.join(",")+"]"}for(r in n)if(n.hasOwnProperty(r)){try{C=JXG$1.toJSON(n[r],t)}catch{C=""}t?o.push(r+":"+C):o.push('"'+r+'":'+C)}return"{"+o.join(",")+"} "}return"null";case"string":return"'"+n.replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return n.toString()}return"0"},clearVisPropOld:function(n){return n.visPropOld={cssclass:"",cssdefaultstyle:"",cssstyle:"",fillcolor:"",fillopacity:"",firstarrow:!1,fontsize:-1,lastarrow:!1,left:-1e5,linecap:"",shadow:!1,strokecolor:"",strokeopacity:"",strokewidth:"",tabindex:-1e5,transitionduration:0,top:-1e5,visible:null},n},isInObject:function(n,t){var o;for(o in n)if(n.hasOwnProperty(o)&&n[o]===t)return!0;return!1},escapeHTML:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(n){return n.replace(/<\/?[^>]+>/gi,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},capitalize:function(n){return n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()},trimNumber:function(n){return n=n.replace(/^0+/,""),n=n.replace(/0+$/,""),(n[n.length-1]==="."||n[n.length-1]===",")&&(n=n.slice(0,-1)),(n[0]==="."||n[0]===",")&&(n="0"+n),n},filterElements:function(n,t){var o,r,u,d,C,I,f,A=n.length,G=[];if(typeof t!="function"&&typeof t!="object")return G;for(o=0;o<A;o++){if(f=!0,u=n[o],typeof t=="object"){for(r in t)if(t.hasOwnProperty(r)&&(d=r.toLowerCase(),typeof u[r]=="function"?C=u[r]():C=u[r],u.visProp&&typeof u.visProp[d]=="function"?I=u.visProp[d]():I=u.visProp&&u.visProp[d],typeof t[r]=="function"?f=t[r](C)||t[r](I):f=C===t[r]||I===t[r],!f))break}else typeof t=="function"&&(f=t(u));f&&G.push(u)}return G},trim:function(n){return n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},toFraction:function(n,t,o){var r=Mat.decToFraction(n,o),u="";return r[1]===0&&r[2]===0?u+="0":(r[0]<0&&(u+="-"),r[2]===0?u+=r[1]:r[2]===1&&r[3]===1||(r[1]!==0&&(u+=r[1]+" "),t===!0?u+="\\frac{"+r[2]+"}{"+r[3]+"}":u+=r[2]+"/"+r[3])),u},concat:function(n,t){var o,r=t.length;for(o=0;o<r;o++)n.push(t[o]);return n},sanitizeHTML:function(n,t){return typeof html_sanitize=="function"&&t?html_sanitize(n,function(){},function(o){return o}):(n&&typeof n=="string"&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;")),n)},evalSlider:function(n){return n&&n.type===Const.OBJECT_TYPE_GLIDER&&typeof n.Value=="function"?n.Value():n},stack2jsxgraph:function(n){var t;return t=n.replace(/%pi/g,"PI").replace(/%e/g,"EULER").replace(/%phi/g,"1.618033988749895").replace(/%gamma/g,"0.5772156649015329").trim(),t[0]==="["&&t[t.length-1]==="]"&&(t=t.slice(1,-1).split(/\s*,\s*/)),t}});JXG$1.extendConstants(JXG$1,{});JXG$1.extend(JXG$1,{isTouchEvent:function(n){return JXG$1.exists(n.touches)},isPointerEvent:function(n){return JXG$1.exists(n.pointerId)},isMouseEvent:function(n){return!JXG$1.isTouchEvent(n)&&!JXG$1.isPointerEvent(n)},getNumberOfTouchPoints:function(n){var t=-1;return JXG$1.isTouchEvent(n)&&(t=n.touches.length),t},isFirstTouch:function(n){var t=JXG$1.getNumberOfTouchPoints(n);return JXG$1.isPointerEvent(n)?n.isPrimary:t===1},isBrowser:typeof window=="object"&&typeof document=="object",supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch{return!1}},supportsVML:function(){return this.isBrowser&&!!document.namespaces},supportsSVG:function(){var n;return this.isBrowser?(n=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,n):!1},supportsCanvas:function(){var n=!1;return this.isNode()&&(n=!0),n||this.isBrowser&&!!document.createElement("canvas").getContext},isNode:function(){return!this.isBrowser&&typeof process<"u"&&process.release.name.search(/node|io.js/)!==-1},isWebWorker:function(){return!this.isBrowser&&typeof self=="object"&&typeof self.postMessage=="function"},supportsPointerEvents:function(){return!!(this.isBrowser&&window.navigator&&(window.PointerEvent||window.navigator.pointerEnabled||window.navigator.msPointerEnabled))},isTouchDevice:function(){return this.isBrowser&&window.ontouchstart!==void 0},isAndroid:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")>-1},isWebkitAndroid:function(){return this.isAndroid()&&navigator.userAgent.indexOf(" AppleWebKit/")>-1},isApple:function(){return JXG$1.exists(navigator)&&(navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPhone")>-1)},isWebkitApple:function(){return this.isApple()&&navigator.userAgent.search(/Mobile\/[0-9A-Za-z.]*Safari/)>-1},isMetroApp:function(){return typeof window=="object"&&window.clientInformation&&window.clientInformation.appVersion&&window.clientInformation.appVersion.indexOf("MSAppHost")>-1},isMozilla:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1},isFirefoxOS:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")===-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1&&navigator.userAgent.toLowerCase().indexOf("mobile")>-1&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1},isDesktop:function(){return!0},isMobile:function(){return!0},ieVersion:function(){var n,t,o=3;if(typeof document!="object")return 0;n=document.createElement("div"),t=n.getElementsByTagName("i");do n.innerHTML="<!--[if gt IE "+ ++o+"]><i></i><![endif]-->";while(t[0]);return o>4?o:void 0}(),getDimensions:function(n,t){var o,r,u,d,C,I,f,A,G,B=/\d+(\.\d*)?px/;if(!this.isBrowser||n===null)return{width:500,height:500};if(t=t||document,o=JXG$1.isString(n)?t.getElementById(n):n,!JXG$1.exists(o))throw new Error(`
JSXGraph: HTML container element '`+n+"' not found.");return r=o.style.display,r!=="none"&&r!==null?o.clientWidth>0&&o.clientHeight>0?{width:o.clientWidth,height:o.clientHeight}:(G=window.getComputedStyle?window.getComputedStyle(o):o.style,{width:B.test(G.width)?parseFloat(G.width):0,height:B.test(G.height)?parseFloat(G.height):0}):(u=o.style,d=u.visibility,C=u.position,I=u.display,u.visibility="hidden",u.position="absolute",u.display="block",f=o.clientWidth,A=o.clientHeight,u.display=I,u.position=C,u.visibility=d,{width:f,height:A})},addEvent:function(n,t,o,r,u){var d=function(){return o.apply(r,arguments)};d.origin=o,typeof r=="object"&&JXG$1.exists(r.BOARD_MODE_NONE)&&(r["x_internal"+t]=r["x_internal"+t]||[],r["x_internal"+t].push(d)),JXG$1.exists(n)&&JXG$1.exists(n.addEventListener)&&(u=u||!1,n.addEventListener(t,d,u)),JXG$1.exists(n)&&JXG$1.exists(n.attachEvent)&&n.attachEvent("on"+t,d)},removeEvent:function(n,t,o,r){var u;if(!JXG$1.exists(r)){JXG$1.debug("no such owner");return}if(!JXG$1.exists(r["x_internal"+t])){JXG$1.debug("removeEvent: no such type: "+t);return}if(!JXG$1.isArray(r["x_internal"+t])){JXG$1.debug("owner[x_internal + "+t+"] is not an array");return}if(u=JXG$1.indexOf(r["x_internal"+t],o,"origin"),u===-1){JXG$1.debug("removeEvent: no such event function in internal list: "+o);return}try{JXG$1.exists(n)&&JXG$1.exists(n.removeEventListener)&&n.removeEventListener(t,r["x_internal"+t][u],!1),JXG$1.exists(n)&&JXG$1.exists(n.detachEvent)&&n.detachEvent("on"+t,r["x_internal"+t][u])}catch{JXG$1.debug("removeEvent: event not registered in browser: ("+t+" -- "+o+")")}r["x_internal"+t].splice(u,1)},removeAllEvents:function(n,t,o){var r,u;if(o["x_internal"+t]){for(u=o["x_internal"+t].length,r=u-1;r>=0;r--)JXG$1.removeEvent(n,t,o["x_internal"+t][r].origin,o);o["x_internal"+t].length>0&&JXG$1.debug("removeAllEvents: Not all events could be removed.")}},getPosition:function(n,t,o){var r,u,d,C=0,I=0;if(n||(n=window.event),d=n.touches,JXG$1.exists(d)&&d.length===0&&(d=n.changedTouches),JXG$1.exists(t)&&JXG$1.exists(d))if(t===-1){for(u=d.length,r=0;r<u;r++)if(d[r]){n=d[r];break}}else n=d[t];return n.clientX&&(C=n.clientX,I=n.clientY),[C,I]},getOffset:function(n){var t,o=n,r=n,u=o.offsetLeft-o.scrollLeft,d=o.offsetTop-o.scrollTop;for(t=this.getCSSTransform([u,d],o),u=t[0],d=t[1],o=o.offsetParent;o;){for(u+=o.offsetLeft,d+=o.offsetTop,o.offsetParent&&(u+=o.clientLeft-o.scrollLeft,d+=o.clientTop-o.scrollTop),t=this.getCSSTransform([u,d],o),u=t[0],d=t[1],r=r.parentNode;r!==o;)u+=r.clientLeft-r.scrollLeft,d+=r.clientTop-r.scrollTop,t=this.getCSSTransform([u,d],r),u=t[0],d=t[1],r=r.parentNode;o=o.offsetParent}return[u,d]},getStyle:function(n,t){var o,r=n.ownerDocument;return r.defaultView&&r.defaultView.getComputedStyle?o=r.defaultView.getComputedStyle(n,null).getPropertyValue(t):n.currentStyle&&JXG$1.ieVersion>=9?o=n.currentStyle[t]:n.style&&(t=t.replace(/-([a-z]|[0-9])/gi,function(u,d){return d.toUpperCase()}),o=n.style[t]),o},getProp:function(n,t){var o=parseInt(this.getStyle(n,t),10);return isNaN(o)?0:o},getCSSTransform:function(n,t){var o,r,u,d,C,I,f,A,G=["transform","webkitTransform","MozTransform","msTransform","oTransform"];for(I=G.length,o=0,u="";o<I;o++)if(JXG$1.exists(t.style[G[o]])){u=t.style[G[o]];break}if(u!==""&&(C=u.indexOf("("),C>0)){for(I=u.length,d=u.substring(C+1,I-1),A=d.split(","),r=0,f=A.length;r<f;r++)A[r]=parseFloat(A[r]);u.indexOf("matrix")===0?(n[0]+=A[4],n[1]+=A[5]):u.indexOf("translateX")===0?n[0]+=A[0]:u.indexOf("translateY")===0?n[1]+=A[0]:u.indexOf("translate")===0&&(n[0]+=A[0],n[1]+=A[1])}return JXG$1.exists(t.style.zoom)&&(u=t.style.zoom,u!==""&&(n[0]*=parseFloat(u),n[1]*=parseFloat(u))),n},getCSSTransformMatrix:function(n){var t,o,r,u,d,C,I,f,A,G=n.ownerDocument,B=["transform","webkitTransform","MozTransform","msTransform","oTransform"],Z=[[1,0,0],[0,1,0],[0,0,1]];if(G.defaultView&&G.defaultView.getComputedStyle)A=G.defaultView.getComputedStyle(n,null),r=A.getPropertyValue("-webkit-transform")||A.getPropertyValue("-moz-transform")||A.getPropertyValue("-ms-transform")||A.getPropertyValue("-o-transform")||A.getPropertyValue("transform");else for(I=B.length,t=0,r="";t<I;t++)if(JXG$1.exists(n.style[B[t]])){r=n.style[B[t]];break}if(r!==""&&(C=r.indexOf("("),C>0)){for(I=r.length,u=r.substring(C+1,I-1),d=u.split(","),o=0,f=d.length;o<f;o++)d[o]=parseFloat(d[o]);r.indexOf("matrix")===0?Z=[[1,0,0],[0,d[0],d[1]],[0,d[2],d[3]]]:r.indexOf("scaleX")===0?Z[1][1]=d[0]:r.indexOf("scaleY")===0?Z[2][2]=d[0]:r.indexOf("scale")===0&&(Z[1][1]=d[0],Z[2][2]=d[1])}return JXG$1.exists(n.style.zoom)&&(r=n.style.zoom,r!==""&&(Z[1][1]*=parseFloat(r),Z[2][2]*=parseFloat(r))),Z},timedChunk:function(n,t,o,r){var u=n.slice(),d=function(){var C=+new Date;do t.call(o,u.shift());while(u.length>0&&+new Date-C<300);u.length>0?window.setTimeout(d,1):r(n)};window.setTimeout(d,1)},scaleJSXGraphDiv:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w,V=r,Y,J=[":fullscreen",":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"],T=J.length,L;for(C=o.getElementById(n).getBoundingClientRect(),d=C.height,u=C.width,B=o.getElementById(t),A=B._cssFullscreenStore.w,G=B._cssFullscreenStore.h,Y=G/A,A>u*V&&(A=u*V,G=A*Y),G>d*V&&(G=d*V,A=G/Y),I=A,f=G,Y>1,Y<d/u?Z=u*V/A:Z=d*V/G,w=(d-f)*.5,L=0;L<T;L++)try{B.style.width=I+"px !important",B.style.height=f+"px !important",B.style.margin="0 auto",B.style.transform=B._cssFullscreenStore.transform+" matrix("+Z+",0,0,"+Z+",0,"+w+")";break}catch(z){JXG$1.debug(`JXG.scaleJSXGraphDiv:
`+z)}L===T&&JXG$1.debug("JXG.scaleJSXGraphDiv: Could not set any CSS property.")}});JXG$1.XML={cleanWhitespace:function(n){for(var t=n.firstChild;JXG$1.exists(t);)t.nodeType===3&&!/\S/.test(t.nodeValue)?n.removeChild(t):t.nodeType===1&&this.cleanWhitespace(t),t=t.nextSibling},parse:function(n){var t,o,r;return typeof DOMParser=="function"||typeof DOMParser=="object"?r=DOMParser:r=function(){this.parseFromString=function(u){var d;return typeof ActiveXObject=="function"&&(d=new ActiveXObject("MSXML.DomDocument"),d.loadXML(u)),d}},t=new r,o=t.parseFromString(n,"text/xml"),this.cleanWhitespace(o),o}};JXG$1.XML;JXG$1.EventEmitter={eventHandlers:{},suspended:{},trigger:function(n,t){var o,r,u,d,C,I;for(C=n.length,r=0;r<C;r++)if(d=this.eventHandlers[n[r]],!this.suspended[n[r]]){if(this.suspended[n[r]]=!0,d)for(I=d.length,o=0;o<I;o++)u=d[o],u.handler.apply(u.context,t);this.suspended[n[r]]=!1}return this},on:function(n,t,o){return JXG$1.isArray(this.eventHandlers[n])||(this.eventHandlers[n]=[]),o=JXG$1.def(o,this),this.eventHandlers[n].push({handler:t,context:o}),this},off:function(n,t){var o;return!n||!JXG$1.isArray(this.eventHandlers[n])?this:(t?(o=JXG$1.indexOf(this.eventHandlers[n],t,"handler"),o>-1&&this.eventHandlers[n].splice(o,1),this.eventHandlers[n].length===0&&delete this.eventHandlers[n]):delete this.eventHandlers[n],this)},eventify:function(n){n.eventHandlers={clicks:0},n.on=this.on,n.off=this.off,n.triggerEventHandlers=this.trigger,n.trigger=this.trigger,n.suspended={}}};const EventEmitter=JXG$1.EventEmitter;JXG$1.Coords=function(n,t,o,r){this.board=o,this.usrCoords=[],this.scrCoords=[],this.emitter=!JXG$1.exists(r)||r,this.emitter&&EventEmitter.eventify(this),this.setCoordinates(n,t,!1,!0)};JXG$1.extend(JXG$1.Coords.prototype,{normalizeUsrCoords:function(){Math.abs(this.usrCoords[0])>Mat.eps&&(this.usrCoords[1]/=this.usrCoords[0],this.usrCoords[2]/=this.usrCoords[0],this.usrCoords[0]=1)},usr2screen:function(n){var t=Math.round,o=this.board,r=this.usrCoords,u=o.origin.scrCoords;n===!0?(this.scrCoords[0]=t(r[0]),this.scrCoords[1]=t(r[0]*u[1]+r[1]*o.unitX),this.scrCoords[2]=t(r[0]*u[2]-r[2]*o.unitY)):(this.scrCoords[0]=r[0],this.scrCoords[1]=r[0]*u[1]+r[1]*o.unitX,this.scrCoords[2]=r[0]*u[2]-r[2]*o.unitY)},screen2usr:function(){var n=this.board.origin.scrCoords,t=this.scrCoords,o=this.board;this.usrCoords[0]=1,this.usrCoords[1]=(t[1]-n[1])/o.unitX,this.usrCoords[2]=(n[2]-t[2])/o.unitY},distance:function(n,t){var o=0,r,u=this.usrCoords,d=this.scrCoords,C;return n===Const.COORDS_BY_USER?(r=t.usrCoords,C=u[0]-r[0],o=C*C,o>Mat.eps*Mat.eps?Number.POSITIVE_INFINITY:Mat.hypot(u[1]-r[1],u[2]-r[2])):(r=t.scrCoords,Mat.hypot(d[1]-r[1],d[2]-r[2]))},setCoordinates:function(n,t,o,r){var u=this.usrCoords,d=this.scrCoords,C=[u[0],u[1],u[2]],I=[d[0],d[1],d[2]];return n===Const.COORDS_BY_USER?(t.length===2?(u[0]=1,u[1]=t[0],u[2]=t[1]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],this.normalizeUsrCoords()),this.usr2screen(o)):(t.length===2?(d[1]=t[0],d[2]=t[1]):(d[1]=t[1],d[2]=t[2]),this.screen2usr()),this.emitter&&!r&&(I[1]!==d[1]||I[2]!==d[2])&&this.triggerEventHandlers(["update"],[C,I]),this},copy:function(n,t){return t===void 0&&(t=0),this[n].slice(t)},isReal:function(){return!isNaN(this.usrCoords[1]+this.usrCoords[2])&&Math.abs(this.usrCoords[0])>Mat.eps},__evt__update:function(n,t){},__evt:function(){}});const Coords=JXG$1.Coords;JXG$1.Expect={each:function(n,t,o){var r,u,d=[];if(JXG$1.exists(n.length))for(u=n.length,r=0;r<u;r++)d.push(t.call(this,n[r],o));return d},coords:function(n,t){var o=n;return n&&n.elementClass===Const.OBJECT_CLASS_POINT?o=n.coords:n.usrCoords&&n.scrCoords&&n.usr2screen&&(o=n),t&&(o=new Coords(Const.COORDS_BY_USER,o.usrCoords,o.board)),o},coordsArray:function(n,t){var o;return JXG$1.isArray(n)?o=n:o=this.coords(n).usrCoords,o.length<3&&o.unshift(1),t&&(o=[o[0],o[1],o[2]]),o}};const Expect=JXG$1.Expect;Mat.ProbFuncs={MAXNUM:17014118346046923e22,SQRTH:.7071067811865476,SQRT2:1.4142135623730951,MAXLOG:708.3964185322641,P:[2461969814735305e-25,.5641895648310689,7.463210564422699,48.63719709856814,196.5208329560771,526.4451949954773,934.5285271719576,1027.5518868951572,557.5353353693994],Q:[13.228195115474499,86.70721408859897,354.9377788878199,975.7085017432055,1823.9091668790973,2246.3376081871097,1656.6630919416134,557.5353408177277],R:[.5641895835477551,1.275366707599781,5.019050422511805,6.160210979930536,7.4097426995044895,2.9788666537210022],S:[2.2605286322011726,9.396035249380015,12.048953980809666,17.08144507475659,9.608968090632859,3.369076451000815],T:[9.604973739870516,90.02601972038427,2232.005345946843,7003.325141128051,55592.30130103949],U:[33.56171416475031,521.3579497801527,4594.323829709801,22629.000061389095,49267.39426086359],M:128,MINV:.0078125,expx2:function(n,t){var o,r,u,d;return n=Math.abs(n),t<0&&(n=-n),u=this.MINV*Math.floor(this.M*n+.5),d=n-u,o=u*u,r=2*u*d+d*d,t<0&&(o=-o,r=-r),o+r>this.MAXLOG?1/0:(o=Math.exp(o)*Math.exp(r),o)},polevl:function(n,t,o){var r,u;if(JXG$1.exists(t.reduce))return t.reduce(function(d,C){return d*n+C},0);for(u=0,r=0;u<=o;u++)r=r*n+t[u];return r},p1evl:function(n,t,o){var r,u;if(JXG$1.exists(t.reduce))return t.reduce(function(d,C){return d*n+C},1);for(u=0,r=1;u<o;u++)r=r*n+t[u];return r},ndtr:function(n){var t,o,r;return t=n*this.SQRTH,r=Math.abs(t),r<1?o=.5+.5*this.erf(t):(o=.5*this.erfce(r),r=this.expx2(n,-1),o=o*Math.sqrt(r),t>0&&(o=1-o)),o},_underflow:function(n){return console.log("erfc","UNDERFLOW"),n<0?2:0},erfc:function(n){var t,o,r,u,d;return n<0?r=-n:r=n,r<1?1-this.erf(n):(d=-n*n,d<-this.MAXLOG?this._underflow(n):(d=this.expx2(n,-1),r<8?(t=this.polevl(r,this.P,8),o=this.p1evl(r,this.Q,8)):(t=this.polevl(r,this.R,5),o=this.p1evl(r,this.S,6)),u=d*t/o,n<0&&(u=2-u),u===0?this._underflow(n):u))},erfce:function(n){var t,o;return n<8?(t=this.polevl(n,this.P,8),o=this.p1evl(n,this.Q,8)):(t=this.polevl(n,this.R,5),o=this.p1evl(n,this.S,6)),t/o},erf:function(n){var t,o;return Math.abs(n)>1?1-this.erfc(n):(o=n*n,t=n*this.polevl(o,this.T,4)/this.p1evl(o,this.U,5),t)},s2pi:2.5066282746310007,P0:[-59.96335010141079,98.00107541859997,-56.67628574690703,13.931260938727968,-1.2391658386738125],Q0:[1.9544885833814176,4.676279128988815,86.36024213908905,-225.46268785411937,200.26021238006066,-82.03722561683334,15.90562251262117,-1.1833162112133],P1:[4.0554489230596245,31.525109459989388,57.16281922464213,44.08050738932008,14.684956192885803,2.1866330685079025,-.1402560791713545,-.03504246268278482,-.0008574567851546854],Q1:[15.779988325646675,45.39076351288792,41.3172038254672,15.04253856929075,2.504649462083094,-.14218292285478779,-.03808064076915783,-.0009332594808954574],P2:[3.2377489177694603,6.915228890689842,3.9388102529247444,1.3330346081580755,.20148538954917908,.012371663481782003,.00030158155350823543,26580697468673755e-22,6239745391849833e-24],Q2:[6.02427039364742,3.6798356385616087,1.3770209948908132,.21623699359449663,.013420400608854318,.00032801446468212774,28924786474538068e-22,6790194080099813e-24],ndtri:function(n){var t,o,r,u,d,C,I;return n<=0?-1/0:n>=1?1/0:(I=1,o=n,o>1-.1353352832366127&&(o=1-o,I=0),o>.1353352832366127?(o=o-.5,u=o*o,t=o+o*(u*this.polevl(u,this.P0,4)/this.p1evl(u,this.Q0,8)),t=t*this.s2pi,t):(t=Math.sqrt(-2*Math.log(o)),d=t-Math.log(t)/t,r=1/t,t<8?C=r*this.polevl(r,this.P1,8)/this.p1evl(r,this.Q1,8):C=r*this.polevl(r,this.P2,8)/this.p1evl(r,this.Q2,8),t=d-C,I!==0&&(t=-t),t))},erfi:function(n){return this.ndtri((n+1)*.5)*this.SQRTH}};Mat.ProbFuncs;JXG$1.Math.DoubleBits=function(){var n=new Float64Array(1),t=new Uint32Array(n.buffer),o,r,u,d,C,I,f,A;Float64Array!==void 0&&(n[0]=1,t[1]===1072693248?(o=function(G){return n[0]=G,[t[0],t[1]]},r=function(G,B){return t[0]=G,t[1]=B,n[0]},u=function(G){return n[0]=G,t[0]},d=function(G){return n[0]=G,t[1]},this.doubleBits=o,this.pack=r,this.lo=u,this.hi=d):t[0]===1072693248&&(C=function(G){return n[0]=G,[t[1],t[0]]},I=function(G,B){return t[1]=G,t[0]=B,n[0]},f=function(G){return n[0]=G,t[1]},A=function(G){return n[0]=G,t[0]},this.doubleBits=C,this.pack=I,this.lo=f,this.hi=A))};JXG$1.extend(JXG$1.Math.DoubleBits.prototype,{sign:function(n){return this.hi(n)>>>31},exponent:function(n){var t=this.hi(n);return(t<<1>>>21)-1023},fraction:function(n){var t=this.lo(n),o=this.hi(n),r=o&(1<<20)-1;return o&2146435072&&(r+=1<<20),[t,r]},denormalized:function(n){var t=this.hi(n);return!(t&2146435072)}});var doubleBits=new JXG$1.Math.DoubleBits,MatInterval=function(n,t){if(n!==void 0&&t!==void 0){if(Mat.IntervalArithmetic.isInterval(n)){if(!Mat.IntervalArithmetic.isSingleton(n))throw new TypeError("JXG.Math.IntervalArithmetic: interval `lo` must be a singleton");this.lo=n.lo}else this.lo=n;if(Mat.IntervalArithmetic.isInterval(t)){if(!Mat.IntervalArithmetic.isSingleton(t))throw new TypeError("JXG.Math.IntervalArithmetic: interval `hi` must be a singleton");this.hi=t.hi}else this.hi=t}else{if(n!==void 0)return Array.isArray(n)?new MatInterval(n[0],n[1]):new MatInterval(n,n);this.lo=this.hi=0}};JXG$1.extend(MatInterval.prototype,{print:function(){console.log("[",this.lo,this.hi,"]")},set:function(n,t){return this.lo=n,this.hi=t,this},bounded:function(n,t){return this.set(Mat.IntervalArithmetic.prev(n),Mat.IntervalArithmetic.next(t))},boundedSingleton:function(n){return this.bounded(n,n)},assign:function(n,t){if(typeof n!="number"||typeof t!="number")throw new TypeError("JXG.Math.Interval#assign: arguments must be numbers");return isNaN(n)||isNaN(t)||n>t?this.setEmpty():this.set(n,t)},setEmpty:function(){return this.set(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},setWhole:function(){return this.set(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},open:function(n,t){return this.assign(Mat.IntervalArithmetic.next(n),Mat.IntervalArithmetic.prev(t))},halfOpenLeft:function(n,t){return this.assign(Mat.IntervalArithmetic.next(n),t)},halfOpenRight:function(n,t){return this.assign(n,Mat.IntervalArithmetic.prev(t))},toArray:function(){return[this.lo,this.hi]},clone:function(){return new MatInterval().set(this.lo,this.hi)}});JXG$1.Math.IntervalArithmetic={Interval:function(n,t){return new MatInterval(n,t)},isInterval:function(n){return n!==null&&typeof n=="object"&&typeof n.lo=="number"&&typeof n.hi=="number"},isSingleton:function(n){return n.lo===n.hi},add:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),new MatInterval(this.addLo(n.lo,t.lo),this.addHi(n.hi,t.hi))},sub:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),new MatInterval(this.subLo(n.lo,t.hi),this.subHi(n.hi,t.lo))},mul:function(n,t){var o,r,u,d,C;return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=n.lo,r=n.hi,u=t.lo,d=t.hi,C=new MatInterval,o<0?r>0?u<0?d>0?(C.lo=Math.min(this.mulLo(o,d),this.mulLo(r,u)),C.hi=Math.max(this.mulHi(o,u),this.mulHi(r,d))):(C.lo=this.mulLo(r,u),C.hi=this.mulHi(o,u)):d>0?(C.lo=this.mulLo(o,d),C.hi=this.mulHi(r,d)):(C.lo=0,C.hi=0):u<0?d>0?(C.lo=this.mulLo(o,d),C.hi=this.mulHi(o,u)):(C.lo=this.mulLo(r,d),C.hi=this.mulHi(o,u)):d>0?(C.lo=this.mulLo(o,d),C.hi=this.mulHi(r,u)):(C.lo=0,C.hi=0):r>0?u<0?d>0?(C.lo=this.mulLo(r,u),C.hi=this.mulHi(r,d)):(C.lo=this.mulLo(r,u),C.hi=this.mulHi(o,d)):d>0?(C.lo=this.mulLo(o,u),C.hi=this.mulHi(r,d)):(C.lo=0,C.hi=0):(C.lo=0,C.hi=0),C)},div:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():this.zeroIn(t)?t.lo!==0?t.hi!==0?this.divZero(n):this.divNegative(n,t.lo):t.hi!==0?this.divPositive(n,t.hi):this.EMPTY.clone():this.divNonZero(n,t)},positive:function(n){return new MatInterval(n.lo,n.hi)},negative:function(n){return JXG$1.isNumber(n)?new MatInterval(-n):new MatInterval(-n.hi,-n.lo)},isEmpty:function(n){return n.lo>n.hi},isWhole:function(n){return n.lo===-1/0&&n.hi===1/0},zeroIn:function(n){return this.hasValue(n,0)},hasValue:function(n,t){return this.isEmpty(n)?!1:n.lo<=t&&t<=n.hi},hasInterval:function(n,t){return this.isEmpty(n)?!0:!this.isEmpty(t)&&t.lo<=n.lo&&n.hi<=t.hi},intervalsOverlap:function(n,t){return this.isEmpty(n)||this.isEmpty(t)?!1:n.lo<=t.lo&&t.lo<=n.hi||t.lo<=n.lo&&n.lo<=t.hi},divNonZero:function(n,t){var o=n.lo,r=n.hi,u=t.lo,d=t.hi,C=new MatInterval;return r<0?d<0?(C.lo=this.divLo(r,u),C.hi=this.divHi(o,d)):(C.lo=this.divLo(o,u),C.hi=this.divHi(r,d)):o<0?d<0?(C.lo=this.divLo(r,d),C.hi=this.divHi(o,d)):(C.lo=this.divLo(o,u),C.hi=this.divHi(r,u)):d<0?(C.lo=this.divLo(r,d),C.hi=this.divHi(o,u)):(C.lo=this.divLo(o,d),C.hi=this.divHi(r,u)),C},divPositive:function(n,t){return n.lo===0&&n.hi===0?n:this.zeroIn(n)?this.WHOLE:n.hi<0?new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(n.hi,t)):new MatInterval(this.divLo(n.lo,t),Number.POSITIVE_INFINITY)},divNegative:function(n,t){return n.lo===0&&n.hi===0?n:this.zeroIn(n)?this.WHOLE:n.hi<0?new MatInterval(this.divLo(n.hi,t),Number.POSITIVE_INFINITY):new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(n.lo,t))},divZero:function(n){return n.lo===0&&n.hi===0?n:this.WHOLE},fmod:function(n,t){var o,r;return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=n.lo<0?t.lo:t.hi,r=n.lo/o,r<0?r=Math.ceil(r):r=Math.floor(r),this.sub(n,this.mul(t,new MatInterval(r))))},multiplicativeInverse:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():this.zeroIn(n)?n.lo!==0?n.hi!==0?this.WHOLE:new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(1,n.lo)):n.hi!==0?new MatInterval(this.divLo(1,n.hi),Number.POSITIVE_INFINITY):this.EMPTY.clone():new MatInterval(this.divLo(1,n.hi),this.divHi(1,n.lo))},pow:function(n,t){var o,r;if(JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n))return this.EMPTY.clone();if(this.isInterval(t)){if(!this.isSingleton(t))return this.EMPTY.clone();t=t.lo}return t===0?n.lo===0&&n.hi===0?this.EMPTY.clone():this.ONE.clone():t<0?this.pow(this.multiplicativeInverse(n),-t):t%1===0?n.hi<0?(o=this.powLo(-n.hi,t),r=this.powHi(-n.lo,t),(t&1)===1?new MatInterval(-r,-o):new MatInterval(o,r)):n.lo<0?(t&1)===1?new MatInterval(-this.powLo(-n.lo,t),this.powHi(n.hi,t)):new MatInterval(0,this.powHi(Math.max(-n.lo,n.hi),t)):new MatInterval(this.powLo(n.lo,t),this.powHi(n.hi,t)):(console.warn("power is not an integer, you should use nth-root instead, returning an empty interval"),this.EMPTY.clone())},sqrt:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.nthRoot(n,2)},nthRoot:function(n,t){var o,r,u,d,C;if(JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)||t<0)return this.EMPTY.clone();if(this.isInterval(t)){if(!this.isSingleton(t))return this.EMPTY.clone();t=t.lo}return o=1/t,n.hi<0?t%1===0&&(t&1)===1?(r=this.powHi(-n.lo,o),u=this.powLo(-n.hi,o),new MatInterval(-r,-u)):this.EMPTY.clone():n.lo<0?(d=this.powHi(n.hi,o),t%1===0&&(t&1)===1?(C=-this.powHi(-n.lo,o),new MatInterval(C,d)):new MatInterval(0,d)):new MatInterval(this.powLo(n.lo,o),this.powHi(n.hi,o))},exp:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.expLo(n.lo),this.expHi(n.hi))},log:function(n){var t;return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():(t=n.lo<=0?Number.NEGATIVE_INFINITY:this.logLo(n.lo),new MatInterval(t,this.logHi(n.hi)))},ln:function(n){return this.log(n)},log10:function(n){return this.isEmpty(n)?this.EMPTY.clone():this.div(this.log(n),this.log(new MatInterval(10,10)))},log2:function(n){return this.isEmpty(n)?this.EMPTY.clone():this.div(this.log(n),this.log(new MatInterval(2,2)))},hull:function(n,t){var o=this.isEmpty(n),r=this.isEmpty(t);return o&&r?this.EMPTY.clone():o?t.clone():r?n.clone():new MatInterval(Math.min(n.lo,t.lo),Math.max(n.hi,t.hi))},intersection:function(n,t){var o,r;return this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=Math.max(n.lo,t.lo),r=Math.min(n.hi,t.hi),o<=r?new MatInterval(o,r):this.EMPTY.clone())},union:function(n,t){if(!this.intervalsOverlap(n,t))throw new Error("Interval#unions do not overlap");return new MatInterval(Math.min(n.lo,t.lo),Math.max(n.hi,t.hi))},difference:function(n,t){if(this.isEmpty(n)||this.isWhole(t))return this.EMPTY.clone();if(this.intervalsOverlap(n,t)){if(n.lo<t.lo&&t.hi<n.hi)throw new Error("Interval.difference: difference creates multiple intervals");return t.lo<=n.lo&&t.hi===1/0||t.hi>=n.hi&&t.lo===-1/0?this.EMPTY.clone():t.lo<=n.lo?new MatInterval().halfOpenLeft(t.hi,n.hi):new MatInterval().halfOpenRight(n.lo,t.lo)}return n.clone()},width:function(n){return this.isEmpty(n)?0:this.subHi(n.hi,n.lo)},abs:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():n.lo>=0?n.clone():n.hi<=0?this.negative(n):new MatInterval(0,Math.max(-n.lo,n.hi))},max:function(n,t){var o=this.isEmpty(n),r=this.isEmpty(t);return o&&r?this.EMPTY.clone():o?t.clone():r?n.clone():new MatInterval(Math.max(n.lo,t.lo),Math.max(n.hi,t.hi))},min:function(n,t){var o=this.isEmpty(n),r=this.isEmpty(t);return o&&r?this.EMPTY.clone():o?t.clone():r?n.clone():new MatInterval(Math.min(n.lo,t.lo),Math.min(n.hi,t.hi))},onlyInfinity:function(n){return!isFinite(n.lo)&&n.lo===n.hi},_handleNegative:function(n){var t;return n.lo<0&&(n.lo===-1/0?(n.lo=0,n.hi=1/0):(t=Math.ceil(-n.lo/this.piTwiceLow),n.lo+=this.piTwiceLow*t,n.hi+=this.piTwiceLow*t)),n},cos:function(n){var t,o,r,u,d,C,I,f;return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():(t=new MatInterval().set(n.lo,n.hi),this._handleNegative(t),o=this.PI_TWICE,r=this.fmod(t,o),this.width(r)>=o.lo?new MatInterval(-1,1):r.lo>=this.piHigh?(u=this.cos(this.sub(r,this.PI)),this.negative(u)):(d=r.lo,C=r.hi,I=this.cosLo(C),f=this.cosHi(d),C<=this.piLow?new MatInterval(I,f):C<=o.lo?new MatInterval(-1,Math.max(I,f)):new MatInterval(-1,1)))},sin:function(n){return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():this.cos(this.sub(n,this.PI_HALF))},tan:function(n){var t,o,r;return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():(t=new MatInterval().set(n.lo,n.hi),this._handleNegative(t),r=this.PI,o=this.fmod(t,r),o.lo>=this.piHalfLow&&(o=this.sub(o,r)),o.lo<=-this.piHalfLow||o.hi>=this.piHalfLow?this.WHOLE.clone():new MatInterval(this.tanLo(o.lo),this.tanHi(o.hi)))},asin:function(n){var t,o;return this.isEmpty(n)||n.hi<-1||n.lo>1?this.EMPTY.clone():(t=n.lo<=-1?-this.piHalfHigh:this.asinLo(n.lo),o=n.hi>=1?this.piHalfHigh:this.asinHi(n.hi),new MatInterval(t,o))},acos:function(n){var t,o;return this.isEmpty(n)||n.hi<-1||n.lo>1?this.EMPTY.clone():(t=n.hi>=1?0:this.acosLo(n.hi),o=n.lo<=-1?this.piHigh:this.acosHi(n.lo),new MatInterval(t,o))},acot:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.acotLo(n.lo),this.acotHi(n.hi))},atan:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.atanLo(n.lo),this.atanHi(n.hi))},sinh:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.sinhLo(n.lo),this.sinhHi(n.hi))},cosh:function(n){return this.isEmpty(n)?this.EMPTY.clone():n.hi<0?new MatInterval(this.coshLo(n.hi),this.coshHi(n.lo)):n.lo>=0?new MatInterval(this.coshLo(n.lo),this.coshHi(n.hi)):new MatInterval(1,this.coshHi(-n.lo>n.hi?n.lo:n.hi))},tanh:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.tanhLo(n.lo),this.tanhHi(n.hi))},equal:function(n,t){return this.isEmpty(n)?this.isEmpty(t):!this.isEmpty(t)&&n.lo===t.lo&&n.hi===t.hi},notEqual:function(n,t){return this.isEmpty(n)?!this.isEmpty(t):this.isEmpty(t)||n.hi<t.lo||n.lo>t.hi},lt:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.hi<t.lo},gt:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.lo>t.hi},leq:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.hi<=t.lo},geq:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.lo>=t.hi},piLow:(3373259426+273688/(1<<21))/(1<<30),piHigh:(3373259426+273689/(1<<21))/(1<<30),piHalfLow:(3373259426+273688/(1<<21))/(1<<30)*.5,piHalfHigh:(3373259426+273689/(1<<21))/(1<<30)*.5,piTwiceLow:(3373259426+273688/(1<<21))/(1<<30)*2,piTwiceHigh:(3373259426+273689/(1<<21))/(1<<30)*2,identity:function(n){return n},_prev:function(n){return n===1/0?n:this.nextafter(n,-1/0)},_next:function(n){return n===-1/0?n:this.nextafter(n,1/0)},prev:function(n){return this._prev(n)},next:function(n){return this._next(n)},toInteger:function(n){return n<0?Math.ceil(n):Math.floor(n)},addLo:function(n,t){return this.prev(n+t)},addHi:function(n,t){return this.next(n+t)},subLo:function(n,t){return this.prev(n-t)},subHi:function(n,t){return this.next(n-t)},mulLo:function(n,t){return this.prev(n*t)},mulHi:function(n,t){return this.next(n*t)},divLo:function(n,t){return this.prev(n/t)},divHi:function(n,t){return this.next(n/t)},intLo:function(n){return this.toInteger(this.prev(n))},intHi:function(n){return this.toInteger(this.next(n))},logLo:function(n){return this.prev(Math.log(n))},logHi:function(n){return this.next(Math.log(n))},expLo:function(n){return this.prev(Math.exp(n))},expHi:function(n){return this.next(Math.exp(n))},sinLo:function(n){return this.prev(Math.sin(n))},sinHi:function(n){return this.next(Math.sin(n))},cosLo:function(n){return this.prev(Math.cos(n))},cosHi:function(n){return this.next(Math.cos(n))},tanLo:function(n){return this.prev(Math.tan(n))},tanHi:function(n){return this.next(Math.tan(n))},asinLo:function(n){return this.prev(Math.asin(n))},asinHi:function(n){return this.next(Math.asin(n))},acosLo:function(n){return this.prev(Math.acos(n))},acosHi:function(n){return this.next(Math.acos(n))},acotLo:function(n){return this.prev(Mat.acot(n))},acotHi:function(n){return this.next(Mat.acot(n))},atanLo:function(n){return this.prev(Math.atan(n))},atanHi:function(n){return this.next(Math.atan(n))},sinhLo:function(n){return this.prev(Mat.sinh(n))},sinhHi:function(n){return this.next(Mat.sinh(n))},coshLo:function(n){return this.prev(Mat.cosh(n))},coshHi:function(n){return this.next(Mat.cosh(n))},tanhLo:function(n){return this.prev(Mat.tanh(n))},tanhHi:function(n){return this.next(Mat.tanh(n))},sqrtLo:function(n){return this.prev(Math.sqrt(n))},sqrtHi:function(n){return this.next(Math.sqrt(n))},powLo:function(n,t){var o;if(t%1!==0)return this.prev(Math.pow(n,t));for(o=(t&1)===1?n:1,t>>=1;t>0;)n=this.mulLo(n,n),(t&1)===1&&(o=this.mulLo(n,o)),t>>=1;return o},powHi:function(n,t){var o;if(t%1!==0)return this.next(Math.pow(n,t));for(o=(t&1)===1?n:1,t>>=1;t>0;)n=this.mulHi(n,n),(t&1)===1&&(o=this.mulHi(n,o)),t>>=1;return o},disable:function(){this.next=this.prev=this.identity},enable:function(){this.prev=function(n){return this._prev(n)},this.next=function(n){return this._next(n)}},SMALLEST_DENORM:Math.pow(2,-1074),UINT_MAX:-1>>>0,nextafter:function(n,t){var o,r;return isNaN(n)||isNaN(t)?NaN:n===t?n:n===0?t<0?-this.SMALLEST_DENORM:this.SMALLEST_DENORM:(r=doubleBits.hi(n),o=doubleBits.lo(n),t>n==n>0?o===this.UINT_MAX?(r+=1,o=0):o+=1:o===0?(o=this.UINT_MAX,r-=1):o-=1,doubleBits.pack(o,r))}};JXG$1.Math.IntervalArithmetic.PI=new MatInterval(Mat.IntervalArithmetic.piLow,Mat.IntervalArithmetic.piHigh);JXG$1.Math.IntervalArithmetic.PI_HALF=new MatInterval(Mat.IntervalArithmetic.piHalfLow,Mat.IntervalArithmetic.piHalfHigh);JXG$1.Math.IntervalArithmetic.PI_TWICE=new MatInterval(Mat.IntervalArithmetic.piTwiceLow,Mat.IntervalArithmetic.piTwiceHigh);JXG$1.Math.IntervalArithmetic.ZERO=new MatInterval(0);JXG$1.Math.IntervalArithmetic.ONE=new MatInterval(1);JXG$1.Math.IntervalArithmetic.WHOLE=new MatInterval().setWhole();JXG$1.Math.IntervalArithmetic.EMPTY=new MatInterval().setEmpty();const Interval=JXG$1.Math.IntervalArithmetic;Mat.Extrapolate={upper:15,infty:1e4,wynnEps:function(n,t,o){var r=1e20,u=1e-15,d=1,C,I,f,A,G,B;if(o[t]=n,t===0)B=n;else{for(A=0,I=t;I>0;I--)f=A,A=o[I-1],G=o[I]-A,Math.abs(G)<=u?o[I-1]=r:(C=(t-I+1)%2===1?d:1,o[I-1]=f*C+1/G);B=o[t%2]}return B},aitken:function(n,t,o){var r,u=1e20,d=1e-15,C,I,f,A,G;if(o[t]=n,t<2)r=n;else{for(f=t/2,A=1;A<=f;A++)G=t-2*A,C=o[G+2]-2*o[G+1]+o[G],Math.abs(C)<d?o[G]=u:(I=o[G]-o[G+1],o[G]-=I*I/C);r=o[t%2]}return r},brezinski:function(n,t,o){var r,u=1e20,d=1e-15,C,I,f,A,G,B,Z;if(o[t]=n,t<3)r=n;else{for(G=t/3,Z=t,B=1;B<=G;B++)Z-=3,I=o[Z+1]-o[Z],f=o[Z+2]-o[Z+1],A=o[Z+3]-o[Z+2],C=A*(f-I)-I*(A-f),Math.abs(C)<d?o[Z]=u:o[Z]=o[Z+1]-I*f*(A-f)/C;r=o[t%3]}return r},iteration:function(n,t,o,r,u){var d,C,I,f=NaN,A,G=.5,B=[],Z="finite",w=t;for(u=u||0,d=1;d<=this.upper;d++){if(w=u===0?t/(d+1):w*G,C=o(n+w,!0),I=this[r](C,d-1,B),isNaN(I)){Z="NaN";break}if(C!==0&&I/C>this.infty){f=I,Z="infinite";break}if(A=I-f,Math.abs(A)<1e-7)break;f=I}return[f,Z,1-(d-1)/this.upper]},levin:function(n,t,o,r,u,d){var C=1e20,I=1e-15,f,A,G,B,Z;if(B=1/(r+t),u[t]=n/o,d[t]=1/o,t>0&&(u[t-1]=u[t]-u[t-1],d[t-1]=d[t]-d[t-1],t>1))for(G=(r+t-1)*B,f=2;f<=t;f++)A=(r+t-f)*Math.pow(G,f-2)*B,u[t-f]=u[t-f+1]-A*u[t-f],d[t-f]=d[t-f+1]-A*d[t-f],B*=G;return Math.abs(d[0])<I?Z=C:Z=u[0]/d[0],Z},iteration_levin:function(n,t,o,r){var u,d,C,I=NaN,f,A,G,B,Z=1,w=.5,V=[],Y=[],J="finite",T=t,L="u";for(r=r||0,f=o(n+t,!0),u=1;u<=this.upper;u++){if(T=r===0?t/(u+1):T*w,d=o(n+T,!0),A=d-f,Math.abs(A)<1?L="u":L="t",L==="u"?B=(Z+u)*A:B=A,f=d,C=this.levin(d,u-1,B,Z,V,Y),G=C-I,isNaN(C)){J="NaN";break}if(d!==0&&C/d>this.infty){I=C,J="infinite";break}if(Math.abs(G)<1e-7)break;I=C}return[I,J,1-(u-1)/this.upper]},limit:function(n,t,o){return this.iteration_levin(n,t,o,0)}};const Extrapolate=Mat.Extrapolate;var predefinedButcher={rk4:{s:4,A:[[0,0,0,0],[.5,0,0,0],[0,.5,0,0],[0,0,1,0]],b:[1/6,1/3,1/3,1/6],c:[0,.5,.5,1]},heun:{s:2,A:[[0,0],[1,0]],b:[.5,.5],c:[0,1]},euler:{s:1,A:[[0]],b:[1],c:[0]}};Mat.Numerics={Gauss:function(n,t){var o,r,u,d,C,I=Mat.eps,f=n.length>0?n[0].length:0;if(f!==t.length||f!==n.length)throw new Error("JXG.Math.Numerics.Gauss: Dimensions don't match. A must be a square matrix and b must be of the same length as A.");for(d=[],C=t.slice(0,f),o=0;o<f;o++)d[o]=n[o].slice(0,f);for(r=0;r<f;r++){for(o=f-1;o>r;o--)if(Math.abs(d[o][r])>I)if(Math.abs(d[r][r])<I)JXG$1.swap(d,o,r),JXG$1.swap(C,o,r);else for(d[o][r]/=d[r][r],C[o]-=d[o][r]*C[r],u=r+1;u<f;u++)d[o][u]-=d[o][r]*d[r][u];if(Math.abs(d[r][r])<I)throw new Error("JXG.Math.Numerics.Gauss(): The given matrix seems to be singular.")}return this.backwardSolve(d,C,!0),C},backwardSolve:function(n,t,o){var r,u,d,C,I;for(o?r=t:r=t.slice(0,t.length),u=n.length,d=n.length>0?n[0].length:0,C=u-1;C>=0;C--){for(I=d-1;I>C;I--)r[C]-=n[C][I]*r[I];r[C]/=n[C][C]}return r},gaussBareiss:function(n){var t,o,r,u,d,C,I,f,A,G=Mat.eps;if(I=n.length,I<=0)return 0;for(n[0].length<I&&(I=n[0].length),f=[],u=0;u<I;u++)f[u]=n[u].slice(0,I);for(o=1,r=1,t=0;t<I-1;t++){if(C=f[t][t],Math.abs(C)<G){for(u=t+1;u<I&&!(Math.abs(f[u][t])>=G);u++);if(u===I)return 0;for(d=t;d<I;d++)A=f[u][d],f[u][d]=f[t][d],f[t][d]=A;r=-r,C=f[t][t]}for(u=t+1;u<I;u++)for(d=t+1;d<I;d++)A=C*f[u][d]-f[u][t]*f[t][d],f[u][d]=A/o;o=C}return r*f[I-1][I-1]},det:function(n){var t=n.length;return t===2&&n[0].length===2?n[0][0]*n[1][1]-n[1][0]*n[0][1]:this.gaussBareiss(n)},Jacobi:function(n){var t,o,r,u,d,C,I,f,A=Mat.eps*Mat.eps,G=0,B=n.length,Z=[[0,0,0],[0,0,0],[0,0,0]],w=[[0,0,0],[0,0,0],[0,0,0]],V=0;for(t=0;t<B;t++){for(o=0;o<B;o++)Z[t][o]=0,w[t][o]=n[t][o],G+=Math.abs(w[t][o]);Z[t][t]=1}if(B===1)return[w,Z];if(G<=0)return[w,Z];G/=B*B;do{for(f=0,o=1;o<B;o++)for(t=0;t<o;t++)if(u=Math.abs(w[t][o]),f+=u,u>=A){for(u=Math.atan2(2*w[t][o],w[t][t]-w[o][o])*.5,d=Math.sin(u),C=Math.cos(u),r=0;r<B;r++)I=w[r][t],w[r][t]=C*I+d*w[r][o],w[r][o]=-d*I+C*w[r][o],I=Z[r][t],Z[r][t]=C*I+d*Z[r][o],Z[r][o]=-d*I+C*Z[r][o];for(w[t][t]=C*w[t][t]+d*w[o][t],w[o][o]=-d*w[t][o]+C*w[o][o],w[t][o]=0,r=0;r<B;r++)w[t][r]=w[r][t],w[o][r]=w[r][o]}V+=1}while(Math.abs(f)/G>A&&V<2e3);return[w,Z]},NewtonCotes:function(n,t,o){var r,u,d,C=0,I=o&&JXG$1.isNumber(o.number_of_nodes)?o.number_of_nodes:28,f={trapez:!0,simpson:!0,milne:!0},A=o&&o.integration_type&&f.hasOwnProperty(o.integration_type)&&f[o.integration_type]?o.integration_type:"milne",G=(n[1]-n[0])/I;switch(A){case"trapez":for(C=(t(n[0])+t(n[1]))*.5,r=n[0],u=0;u<I-1;u++)r+=G,C+=t(r);C*=G;break;case"simpson":if(I%2>0)throw new Error("JSXGraph:  INT_SIMPSON requires config.number_of_nodes dividable by 2.");for(d=I/2,C=t(n[0])+t(n[1]),r=n[0],u=0;u<d-1;u++)r+=2*G,C+=2*t(r);for(r=n[0]-G,u=0;u<d;u++)r+=2*G,C+=4*t(r);C*=G/3;break;default:if(I%4>0)throw new Error("JSXGraph: Error in INT_MILNE: config.number_of_nodes must be a multiple of 4");for(d=I*.25,C=7*(t(n[0])+t(n[1])),r=n[0],u=0;u<d-1;u++)r+=4*G,C+=14*t(r);for(r=n[0]-3*G,u=0;u<d;u++)r+=4*G,C+=32*(t(r)+t(r+2*G));for(r=n[0]-2*G,u=0;u<d;u++)r+=4*G,C+=12*t(r);C*=2*G/45}return C},Romberg:function(n,t,o){var r,u,d,C,I,f,A,G,B=[],Z=0,w=1/0,V=o&&JXG$1.isNumber(o.max_iterations)?o.max_iterations:20,Y=o&&JXG$1.isNumber(o.eps)?o.eps:o.eps||1e-7;for(r=n[0],u=n[1],d=u-r,I=1,B[0]=.5*d*(t(r)+t(u)),f=0;f<V;++f){for(C=0,d*=.5,I*=2,G=1,A=1;A<I;A+=2)C+=t(r+A*d);for(B[f+1]=.5*B[f]+C*d,Z=B[f+1],A=f-1;A>=0;--A)G*=4,B[A]=B[A+1]+(B[A+1]-B[A])/(G-1),Z=B[A];if(Math.abs(Z-w)<Y*Math.abs(Z))break;w=Z}return Z},GaussLegendre:function(n,t,o){var r,u,d,C,I,f,A=0,G=[],B=[],Z,w,V=o&&JXG$1.isNumber(o.n)?o.n:12;if(V>18&&(V=18),G[2]=[.5773502691896257],B[2]=[1],G[4]=[.33998104358485626,.8611363115940526],B[4]=[.6521451548625461,.34785484513745385],G[6]=[.2386191860831969,.6612093864662645,.932469514203152],B[6]=[.46791393457269104,.3607615730481386,.17132449237917036],G[8]=[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],B[8]=[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],G[10]=[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],B[10]=[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],G[12]=[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],B[12]=[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],G[14]=[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],B[14]=[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],G[16]=[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499],B[16]=[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096],G[18]=[.0847750130417353,.2518862256915055,.41175116146284263,.5597708310739475,.6916870430603532,.8037049589725231,.8926024664975557,.9558239495713977,.9915651684209309],B[18]=[.1691423829631436,.16427648374583273,.15468467512626524,.14064291467065065,.12255520671147846,.10094204410628717,.07642573025488905,.0497145488949698,.02161601352648331],G[3]=[0,.7745966692414834],B[3]=[.8888888888888888,.5555555555555556],G[5]=[0,.5384693101056831,.906179845938664],B[5]=[.5688888888888889,.47862867049936647,.23692688505618908],G[7]=[0,.4058451513773972,.7415311855993945,.9491079123427585],B[7]=[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],G[9]=[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],B[9]=[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],G[11]=[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],B[11]=[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],G[13]=[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],B[13]=[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],G[15]=[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],B[15]=[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],G[17]=[0,.17848418149584785,.3512317634538763,.5126905370864769,.6576711592166907,.7815140038968014,.8802391537269859,.9506755217687678,.9905754753144174],B[17]=[.17944647035620653,.17656270536699264,.16800410215645004,.15404576107681028,.13513636846852548,.11188384719340397,.08503614831717918,.0554595293739872,.02414830286854793],r=n[0],u=n[1],C=V+1>>1,Z=G[V],w=B[V],f=.5*(u-r),I=.5*(u+r),V&!0)for(A=w[0]*t(I),d=1;d<C;++d)A+=w[d]*(t(I+f*Z[d])+t(I-f*Z[d]));else for(A=0,d=0;d<C;++d)A+=w[d]*(t(I+f*Z[d])+t(I-f*Z[d]));return f*A},_rescale_error:function(n,t,o){var r,u,d=22250738585072014e-324,C=2220446049250313e-31;return n=Math.abs(n),o!==0&&n!==0&&(r=Math.pow(200*n/o,1.5),r<1?n=o*r:n=o),t>d/(50*C)&&(u=50*C*t,u>n&&(n=u)),n},_gaussKronrod:function(n,t,o,r,u,d,C){var I=n[0],f=n[1],A,G,B=.5*(I+f),Z=.5*(f-I),w=Math.abs(Z),V=t(B),Y=0,J=V*d[o-1],T=Math.abs(J),L=0,z=0,K=0,P,$,ie,ne,ee,se,re,ce=[],ue=[];for(o%2===0&&(Y=V*u[o/2-1]),A=Math.floor((o-1)/2),P=0;P<A;P++)$=P*2+1,ie=Z*r[$],ne=t(B-ie),ee=t(B+ie),se=ne+ee,ce[$]=ne,ue[$]=ee,Y+=u[P]*se,J+=d[$]*se,T+=d[$]*(Math.abs(ne)+Math.abs(ee));for(A=Math.floor(o/2),P=0;P<A;P++)re=P*2,ie=Z*r[re],ne=t(B-ie),ee=t(B+ie),ce[re]=ne,ue[re]=ee,J+=d[re]*(ne+ee),T+=d[re]*(Math.abs(ne)+Math.abs(ee));for(z=J*.5,L=d[o-1]*Math.abs(V-z),P=0;P<o-1;P++)L+=d[P]*(Math.abs(ce[P]-z)+Math.abs(ue[P]-z));return K=(J-Y)*Z,J*=Z,T*=w,L*=w,G=J,C.abserr=this._rescale_error(K,T,L),C.resabs=T,C.resasc=L,G},GaussKronrod15:function(n,t,o){var r=[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],u=[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694],d=[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782];return this._gaussKronrod(n,t,8,r,u,d,o)},GaussKronrod21:function(n,t,o){var r=[.9956571630258081,.9739065285171717,.9301574913557082,.8650633666889845,.7808177265864169,.6794095682990244,.5627571346686047,.4333953941292472,.2943928627014602,.14887433898163122,0],u=[.06667134430868814,.1494513491505806,.21908636251598204,.26926671930999635,.29552422471475287],d=[.011694638867371874,.032558162307964725,.054755896574351995,.07503967481091996,.0931254545836976,.10938715880229764,.12349197626206584,.13470921731147334,.14277593857706009,.14773910490133849,.1494455540029169];return this._gaussKronrod(n,t,11,r,u,d,o)},GaussKronrod31:function(n,t,o){var r=[.9980022986933971,.9879925180204854,.9677390756791391,.937273392400706,.8972645323440819,.8482065834104272,.790418501442466,.7244177313601701,.650996741297417,.5709721726085388,.4850818636402397,.3941513470775634,.29918000715316884,.20119409399743451,.1011420669187175,0],u=[.03075324199611727,.07036604748810812,.10715922046717194,.13957067792615432,.16626920581699392,.1861610000155622,.19843148532711158,.2025782419255613],d=[.005377479872923349,.015007947329316122,.02546084732671532,.03534636079137585,.04458975132476488,.05348152469092809,.06200956780067064,.06985412131872826,.07684968075772038,.08308050282313302,.08856444305621176,.09312659817082532,.09664272698362368,.09917359872179196,.10076984552387559,.10133000701479154];return this._gaussKronrod(n,t,16,r,u,d,o)},_workspace:function(n,t){return{limit:t,size:0,nrmax:0,i:0,alist:[n[0]],blist:[n[1]],rlist:[0],elist:[0],order:[0],level:[0],qpsrt:function(){var o=this.size-1,r=this.limit,u,d,C,I,f,A=this.nrmax,G=this.order[A];if(o<2){this.order[0]=0,this.order[1]=1,this.i=G;return}for(u=this.elist[G];A>0&&u>this.elist[this.order[A-1]];)this.order[A]=this.order[A-1],A--;for(o<r/2+2?f=o:f=r-o+1,C=A+1;C<f&&u<this.elist[this.order[C]];)this.order[C-1]=this.order[C],C++;for(this.order[C-1]=G,d=this.elist[o],I=f-1;I>C-2&&d>=this.elist[this.order[I]];)this.order[I+1]=this.order[I],I--;this.order[I+1]=o,G=this.order[A],this.i=G,this.nrmax=A},set_initial_result:function(o,r){this.size=1,this.rlist[0]=o,this.elist[0]=r},update:function(o,r,u,d,C,I,f,A){var G=this.i,B=this.size,Z=this.level[this.i]+1;A>d?(this.alist[G]=C,this.rlist[G]=f,this.elist[G]=A,this.level[G]=Z,this.alist[B]=o,this.blist[B]=r,this.rlist[B]=u,this.elist[B]=d,this.level[B]=Z):(this.blist[G]=r,this.rlist[G]=u,this.elist[G]=d,this.level[G]=Z,this.alist[B]=C,this.blist[B]=I,this.rlist[B]=f,this.elist[B]=A,this.level[B]=Z),this.size++,Z>this.maximum_level&&(this.maximum_level=Z),this.qpsrt()},retrieve:function(){var o=this.i;return{a:this.alist[o],b:this.blist[o],r:this.rlist[o],e:this.elist[o]}},sum_results:function(){var o=this.size,r,u=0;for(r=0;r<o;r++)u+=this.rlist[r];return u},subinterval_too_small:function(o,r,u){var d=2220446049250313e-31,C=22250738585072014e-324,I=(1+100*d)*(Math.abs(r)+1e3*C);return Math.abs(o)<=I&&Math.abs(u)<=I}}},Qag:function(n,t,o){var r=2220446049250313e-31,u=this._workspace(n,1e3),d=o&&JXG$1.isNumber(o.limit)?o.limit:15,C=o&&JXG$1.isNumber(o.epsrel)?o.epsrel:1e-7,I=o&&JXG$1.isNumber(o.epsabs)?o.epsabs:1e-7,f=o&&JXG$1.isFunction(o.q)?o.q:this.GaussKronrod15,A={},G,B,Z,w,V,Y,J,T,L=0,z=0,K=0,P=0,$,ie,ne,ee,se,re,ce,ue,ye,Se=0,Ce=0,Ze=0,Be=0,xe=0,ge=0,de,ve,le,Ae;if(d>u.limit&&JXG$1.warn("iteration limit exceeds available workspace"),I<=0&&(C<50*Mat.eps||C<5e-29)&&JXG$1.warn("tolerance cannot be acheived with given epsabs and epsrel"),Z=f.apply(this,[n,t,A]),w=A.abserr,V=A.resabs,Y=A.resasc,u.set_initial_result(Z,w),T=Math.max(I,C*Math.abs(Z)),$=50*r*V,w<=$&&w>T)return J=Z,JXG$1.warn("cannot reach tolerance because of roundoff error on first attempt"),-1/0;if(w<=T&&w!==Y||w===0)return J=Z,J;if(d===1)return J=Z,JXG$1.warn("a maximum of one iteration was insufficient"),-1/0;G=Z,B=w,L=1;do Se=0,Ce=0,Ze=0,Be=0,xe=0,ge=0,le=u.retrieve(),re=le.a,ce=le.b,ue=le.r,ye=le.e,ie=re,ne=.5*(re+ce),ee=ne,se=ce,Se=f.apply(this,[[ie,ne],t,A]),Be=A.abserr,de=A.resasc,Ce=f.apply(this,[[ee,se],t,A]),xe=A.abserr,ve=A.resasc,Ze=Se+Ce,ge=Be+xe,B+=ge-ye,G+=Ze-ue,de!==Be&&ve!==xe&&(Ae=ue-Ze,Math.abs(Ae)<=1e-5*Math.abs(Ze)&&ge>=.99*ye&&z++,L>=10&&ge>ye&&K++),T=Math.max(I,C*Math.abs(G)),B>T&&((z>=6||K>=20)&&(P=2),u.subinterval_too_small(ie,ee,se)&&(P=3)),u.update(ie,ne,Se,Be,ee,se,Ce,xe),le=u.retrieve(),re=le.a_i,ce=le.b_i,ue=le.r_i,ye=le.e_i,L++;while(L<d&&!P&&B>T);return J=u.sum_results(),J},I:function(n,t){return this.Qag(n,t,{q:this.GaussKronrod15,limit:15,epsrel:1e-7,epsabs:1e-7})},Newton:function(n,t,o){var r,u=0,d=Mat.eps,C=n.apply(o,[t]);for(JXG$1.isArray(t)&&(t=t[0]);u<50&&Math.abs(C)>d;)r=this.D(n,o)(t),Math.abs(r)>d?t-=C/r:t+=Math.random()*.2-1,C=n.apply(o,[t]),u+=1;return t},root:function(n,t,o){return this.chandrupatla(n,t,o)},generalizedNewton:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L=0;for(this.generalizedNewton.t1memo?(u=this.generalizedNewton.t1memo,d=this.generalizedNewton.t2memo):(u=o,d=r),G=n.X(u)-t.X(d),B=n.Y(u)-t.Y(d),w=G*G+B*B,V=this.D(n.X,n),Y=this.D(t.X,t),J=this.D(n.Y,n),T=this.D(t.Y,t);w>Mat.eps&&L<10;)C=V(u),I=-Y(d),f=J(u),A=-T(d),Z=C*A-I*f,u-=(A*G-I*B)/Z,d-=(C*B-f*G)/Z,G=n.X(u)-t.X(d),B=n.Y(u)-t.Y(d),w=G*G+B*B,L+=1;return this.generalizedNewton.t1memo=u,this.generalizedNewton.t2memo=d,Math.abs(u)<Math.abs(d)?[n.X(u),n.Y(u)]:[t.X(d),t.Y(d)]},Neville:function(n){var t=[],o=function(d){return function(C,I){var f,A,G,B=Mat.binomial,Z=n.length,w=Z-1,V=0,Y=0;if(!I)for(G=1,f=0;f<Z;f++)t[f]=B(w,f)*G,G*=-1;for(A=C,f=0;f<Z;f++){if(A===0)return n[f][d]();G=t[f]/A,A-=1,V+=n[f][d]()*G,Y+=G}return V/Y}},r=o("X"),u=o("Y");return[r,u,0,function(){return n.length-1}]},splineDef:function(n,t){var o,r,u,d=Math.min(n.length,t.length),C=[],I=[],f=[],A=[],G=[],B=[];if(d===2)return[0,0];for(r=0;r<d;r++)o={X:n[r],Y:t[r]},f.push(o);for(f.sort(function(Z,w){return Z.X-w.X}),r=0;r<d;r++)n[r]=f[r].X,t[r]=f[r].Y;for(r=0;r<d-1;r++)A.push(n[r+1]-n[r]);for(r=0;r<d-2;r++)G.push(6*(t[r+2]-t[r+1])/A[r+1]-6*(t[r+1]-t[r])/A[r]);for(C.push(2*(A[0]+A[1])),I.push(G[0]),r=0;r<d-3;r++)u=A[r+1]/C[r],C.push(2*(A[r+1]+A[r+2])-u*A[r+1]),I.push(G[r+1]-u*I[r]);for(B[d-3]=I[d-3]/C[d-3],r=d-4;r>=0;r--)B[r]=(I[r]-A[r+1]*B[r+1])/C[r];for(r=d-3;r>=0;r--)B[r+1]=B[r];return B[0]=0,B[d-1]=0,B},splineEval:function(n,t,o,r){var u,d,C,I,f,A,G,B=Math.min(t.length,o.length),Z=1,w=!1,V=[];for(JXG$1.isArray(n)?(Z=n.length,w=!0):n=[n],u=0;u<Z;u++){if(n[u]<t[0]||t[u]>t[B-1])return NaN;for(d=1;d<B&&!(n[u]<=t[d]);d++);d-=1,C=o[d],I=(o[d+1]-o[d])/(t[d+1]-t[d])-(t[d+1]-t[d])/6*(r[d+1]+2*r[d]),f=r[d]/2,A=(r[d+1]-r[d])/(6*(t[d+1]-t[d])),G=n[u]-t[d],V.push(C+(I+(f+A*G)*G)*G)}return w?V:V[0]},generatePolynomialTerm:function(n,t,o,r){var u,d=[];for(u=t;u>=0;u--)JXG$1.concat(d,["(",n[u].toPrecision(r),")"]),u>1?JXG$1.concat(d,["*",o,"<sup>",u,"<","/sup> + "]):u===1&&JXG$1.concat(d,["*",o," + "]);return d.join("")},lagrangePolynomial:function(n){var t=[],o=this,r=function(u,d){var C,I,f,A,G=n.length,B=0,Z=0;if(!d)for(C=0;C<G;C++){for(t[C]=1,f=n[C].X(),I=0;I<G;I++)I!==C&&(t[C]*=f-n[I].X());t[C]=1/t[C]}for(C=0;C<G;C++){if(f=n[C].X(),u===f)return n[C].Y();A=t[C]/(u-f),Z+=A,B+=A*n[C].Y()}return B/Z};return r.getTerm=function(u,d,C){return o.lagrangePolynomialTerm(n,u,d,C)()},r.getCoefficients=function(){return o.lagrangePolynomialCoefficients(n)()},r},lagrangePolynomialTerm:function(n,t,o,r){var u=this;return function(){var d=n.length,C=[],I=!0,f,A,G,B;for(o=o||"x",r===void 0&&(r=" * "),f=d-1,C=u.lagrangePolynomialCoefficients(n)(),A="",G=0;G<C.length;G++)B=C[G],!(Math.abs(B)<Mat.eps)&&(JXG$1.exists(t)&&(B=JXG$1._round10(B,-t)),I?(A+=B>0?B:"-"+-B,I=!1):A+=B>0?" + "+B:" - "+-B,f-G>1?A+=r+o+"^"+(f-G):f-G===1&&(A+=r+o));return A}},lagrangePolynomialCoefficients:function(n){return function(){var t=n.length,o=[],r=[],u=[],d,C,I,f;for(C=0;C<t;C++)u[C]=0;for(d=0;d<t;d++){for(I=n[d].Y(),f=n[d].X(),o=[],C=0;C<t;C++)C!==d&&(I/=f-n[C].X(),o.push(n[C].X()));for(r=[1].concat(Mat.Vieta(o)),C=0;C<r.length;C++)u[C]+=(C%2===1?-1:1)*r[C]*I}return u}},_initCubicPoly:function(n,t,o,r){return[n,o,-3*n+3*t-2*o-r,2*n-2*t+o+r]},CardinalSpline:function(n,t,o){var r,u=[],d,C,I,f=this;return JXG$1.isFunction(t)?I=t:I=function(){return t},o===void 0&&(o="uniform"),d=function(A){return function(G,B){var Z,w,V,Y,J,T,L,z,K,P;if(n.length<2)return NaN;if(!B)for(C=I(),V={X:function(){return 2*n[0].X()-n[1].X()},Y:function(){return 2*n[0].Y()-n[1].Y()},Dist:function($){var ie=this.X()-$.X(),ne=this.Y()-$.Y();return Mat.hypot(ie,ne)}},Y={X:function(){return 2*n[n.length-1].X()-n[n.length-2].X()},Y:function(){return 2*n[n.length-1].Y()-n[n.length-2].Y()},Dist:function($){var ie=this.X()-$.X(),ne=this.Y()-$.Y();return Mat.hypot(ie,ne)}},r=[V].concat(n,[Y]),P=r.length,u[A]=[],Z=0;Z<P-3;Z++)o==="centripetal"?(L=r[Z].Dist(r[Z+1]),z=r[Z+2].Dist(r[Z+1]),K=r[Z+3].Dist(r[Z+2]),L=Math.sqrt(L),z=Math.sqrt(z),K=Math.sqrt(K),z<Mat.eps&&(z=1),L<Mat.eps&&(L=z),K<Mat.eps&&(K=z),J=(r[Z+1][A]()-r[Z][A]())/L-(r[Z+2][A]()-r[Z][A]())/(z+L)+(r[Z+2][A]()-r[Z+1][A]())/z,T=(r[Z+2][A]()-r[Z+1][A]())/z-(r[Z+3][A]()-r[Z+1][A]())/(K+z)+(r[Z+3][A]()-r[Z+2][A]())/K,J*=z,T*=z,u[A][Z]=f._initCubicPoly(r[Z+1][A](),r[Z+2][A](),C*J,C*T)):u[A][Z]=f._initCubicPoly(r[Z+1][A](),r[Z+2][A](),C*(r[Z+2][A]()-r[Z][A]()),C*(r[Z+3][A]()-r[Z+1][A]()));return isNaN(G)?NaN:(P=n.length,G<=0?n[0][A]():G>=P?n[P-1][A]():(Z=Math.floor(G),Z===G?n[Z][A]():(G-=Z,w=u[A][Z],w===void 0?NaN:((w[3]*G+w[2])*G+w[1])*G+w[0])))}},[d("X"),d("Y"),0,function(){return n.length-1}]},CatmullRomSpline:function(n,t){return this.CardinalSpline(n,.5,t)},regressionPolynomial:function(n,t,o){var r,u,d,C,I,f,A="";if(JXG$1.isPoint(n)&&JXG$1.isFunction(n.Value))u=function(){return n.Value()};else if(JXG$1.isFunction(n))u=n;else if(JXG$1.isNumber(n))u=function(){return n};else throw new Error("JSXGraph: Can't create regressionPolynomial from degree of type'"+typeof n+"'.");if(arguments.length===3&&JXG$1.isArray(t)&&JXG$1.isArray(o))I=0;else if(arguments.length===2&&JXG$1.isArray(t)&&t.length>0&&JXG$1.isPoint(t[0]))I=1;else if(arguments.length===2&&JXG$1.isArray(t)&&t.length>0&&t[0].usrCoords&&t[0].scrCoords)I=2;else throw new Error("JSXGraph: Can't create regressionPolynomial. Wrong parameters.");return f=function(G,B){var Z,w,V,Y,J,T,L,z,K,P=t.length;if(K=Math.floor(u()),!B){if(I===1)for(d=[],C=[],Z=0;Z<P;Z++)d[Z]=t[Z].X(),C[Z]=t[Z].Y();if(I===2)for(d=[],C=[],Z=0;Z<P;Z++)d[Z]=t[Z].usrCoords[1],C[Z]=t[Z].usrCoords[2];if(I===0)for(d=[],C=[],Z=0;Z<P;Z++)JXG$1.isFunction(t[Z])?d.push(t[Z]()):d.push(t[Z]),JXG$1.isFunction(o[Z])?C.push(o[Z]()):C.push(o[Z]);for(V=[],w=0;w<P;w++)V.push([1]);for(Z=1;Z<=K;Z++)for(w=0;w<P;w++)V[w][Z]=V[w][Z-1]*d[w];J=C,Y=Mat.transpose(V),T=Mat.matMatMult(Y,V),L=Mat.matVecMult(Y,J),r=Mat.Numerics.Gauss(T,L),A=Mat.Numerics.generatePolynomialTerm(r,K,"x",3)}for(z=r[K],Z=K-1;Z>=0;Z--)z=z*G+r[Z];return z},f.getTerm=function(){return A},f},bezier:function(n){var t,o,r=function(u){return function(d,C){var I=Math.floor(d)*3,f=d%1,A=1-f;return C||(o=3*Math.floor((n.length-1)/3),t=Math.floor(o/3)),d<0?n[0][u]():d>=t?n[o][u]():isNaN(d)?NaN:A*A*(A*n[I][u]()+3*f*n[I+1][u]())+(3*A*n[I+2][u]()+f*n[I+3][u]())*f*f}};return[r("X"),r("Y"),0,function(){return Math.floor(n.length/3)}]},bspline:function(n,t){var o,r=function(C,I){var f,A=[];for(f=0;f<C+I+1;f++)f<I?A[f]=0:f<=C?A[f]=f-I+1:A[f]=C-I+2;return A},u=function(C,I,f,A){var G,B,Z,w,V,Y=[];for(I[A]<=C&&C<I[A+1]?Y[A]=1:Y[A]=0,G=2;G<=f;G++)for(B=A-G+1;B<=A;B++)B<=A-G+1||B<0?Z=0:Z=Y[B],B>=A?w=0:w=Y[B+1],V=I[B+G-1]-I[B],V===0?Y[B]=0:Y[B]=(C-I[B])/V*Z,V=I[B+G]-I[B+1],V!==0&&(Y[B]+=(I[B+G]-C)/V*w);return Y},d=function(C){return function(I,f){var A,G,B,Z=[],w=n.length,V=w-1,Y=t;if(V<=0)return NaN;if(V+2<=Y&&(Y=V+1),I<=0)return n[0][C]();if(I>=V-Y+2)return n[V][C]();for(B=Math.floor(I)+Y-1,o=r(V,Y),Z=u(I,o,Y,B),A=0,G=B-Y+1;G<=B;G++)G<w&&G>=0&&(A+=n[G][C]()*Z[G]);return A}};return[d("X"),d("Y"),0,function(){return n.length-1}]},D:function(n,t){return JXG$1.exists(t)?function(o,r){var u=1e-5,d=u*2;return(n.apply(t,[o+u,r])-n.apply(t,[o-u,r]))/d}:function(o,r){var u=1e-5,d=u*2;return(n(o+u,r)-n(o-u,r))/d}},_riemannValue:function(n,t,o,r){var u,d,C,I;if(r<0&&(o!=="trapezoidal"&&(n=n+r),r*=-1,o==="lower"?o="upper":o==="upper"&&(o="lower")),I=r*.01,o==="right")u=t(n+r);else if(o==="middle")u=t(n+r*.5);else if(o==="left"||o==="trapezoidal")u=t(n);else if(o==="lower"){for(u=t(n),C=n+I;C<=n+r;C+=I)d=t(C),d<u&&(u=d);d=t(n+r),d<u&&(u=d)}else if(o==="upper"){for(u=t(n),C=n+I;C<=n+r;C+=I)d=t(C),d>u&&(u=d);d=t(n+r),d>u&&(u=d)}else o==="random"?u=t(n+r*Math.random()):o==="simpson"?u=(t(n)+4*t(n+r*.5)+t(n+r))/6:u=t(n);return u},riemann:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z,w,V,Y,J=30,T=[],L=[],z=r,K=0,P,$,ie;if(JXG$1.isArray(n)?(ie=n[0],$=n[1]):$=n,t=Math.floor(t),t<=0)return[T,L,K];for(C=(u-r)/t,d=0;d<t;d++){if(o==="simpson"){for(K+=this._riemannValue(z,$,o,C)*C,Y=C*.5,B=$(z),Z=$(z+Y),w=$(z+2*Y),f=(w+B-2*Z)/(Y*Y)*.5,A=(w-B)/(2*Y),G=Z,I=0;I<J;I++)V=I*C/J-Y,T.push(z+V+Y),L.push(f*V*V+A*V+G);z+=C,P=w}else P=this._riemannValue(z,$,o,C),T.push(z),L.push(P),z+=C,o==="trapezoidal"?(w=$(z),K+=(P+w)*.5*C,P=w):K+=P*C,T.push(z),L.push(P);T.push(z),L.push(P)}for(d=0;d<t;d++){if(o==="simpson"&&ie){for(K-=this._riemannValue(z,ie,o,-C)*C,Y=C*.5,B=ie(z),Z=ie(z-Y),w=ie(z-2*Y),f=(w+B-2*Z)/(Y*Y)*.5,A=(w-B)/(2*Y),G=Z,I=0;I<J;I++)V=I*C/J-Y,T.push(z-V-Y),L.push(f*V*V+A*V+G);z-=C,P=w}else ie?P=this._riemannValue(z,ie,o,-C):P=0,T.push(z),L.push(P),z-=C,ie&&(o==="trapezoidal"?(w=ie(z),K-=(P+w)*.5*C,P=w):K-=P*C);T.push(z),L.push(P),T.push(z),L.push($(z))}return[T,L,K]},riemannsum:function(n,t,o,r,u){return JXG$1.deprecated("Numerics.riemannsum()","Numerics.riemann()[2]"),this.riemann(n,t,o,r,u)[2]},rungeKutta:function(n,t,o,r,u){var d,C,I,f,A,G,B=[],Z=[],w=(o[1]-o[0])/r,V=o[0],Y=t.length,J=[],T=0;for(JXG$1.isString(n)&&(n=predefinedButcher[n]||predefinedButcher.euler),G=n.s,B=t.slice(),C=0;C<=r;C++){for(J[T]=B.slice(),T++,f=[],I=0;I<G;I++){for(d=0;d<Y;d++)Z[d]=0;for(A=0;A<I;A++)for(d=0;d<Y;d++)Z[d]+=n.A[I][A]*w*f[A][d];for(d=0;d<Y;d++)Z[d]+=B[d];f.push(u(V+n.c[I]*w,Z))}for(d=0;d<Y;d++)Z[d]=0;for(A=0;A<G;A++)for(d=0;d<Y;d++)Z[d]+=n.b[A]*f[A][d];for(d=0;d<Y;d++)B[d]=B[d]+w*Z[d];V+=w}return J},maxIterationsRoot:80,maxIterationsMinimize:500,findBracket:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z;if(JXG$1.isArray(t))return t;for(r=t,d=n.call(o,r),u=r===0?1:r,C=[r-.1*u,r+.1*u,r-1,r+1,r-.5*u,r+.5*u,r-.6*u,r+.6*u,r-1*u,r+1*u,r-2*u,r+2*u,r-5*u,r+5*u,r-10*u,r+10*u,r-50*u,r+50*u,r-100*u,r+100*u],Z=C.length,B=0;B<Z&&(I=C[B],f=n.call(o,I),!(d*f<=0));B++);return I<r&&(A=r,r=I,I=A,G=d,d=f,f=G),[r,d,I,f]},fzero:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z=Mat.eps,K=this.maxIterationsRoot,P=0;if(JXG$1.isArray(t)){if(t.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");G=this.findDomain(n,t,o),r=G[0],u=G[1],C=n.call(o,r),I=n.call(o,u)}else A=this.findBracket(n,t,o),r=A[0],C=A[1],u=A[2],I=A[3];if(Math.abs(C)<=z)return r;if(Math.abs(I)<=z)return u;if(C*I>0)return JXG$1.isArray(t)?this.fminbr(n,[r,u],o):this.Newton(n,r,o);for(d=r,f=C;P<K;){if(B=u-r,Math.abs(f)<Math.abs(I)&&(r=u,u=d,d=r,C=I,I=f,f=C),Y=2*z*Math.abs(u)+z*.5,L=(d-u)*.5,Math.abs(L)<=Y||Math.abs(I)<=z)return u;Math.abs(B)>=Y&&Math.abs(C)>Math.abs(I)&&(V=d-u,r===d?(Z=I/C,J=V*Z,T=1-Z):(T=C/f,Z=I/f,w=I/C,J=w*(V*T*(T-Z)-(u-r)*(Z-1)),T=(T-1)*(Z-1)*(w-1)),J>0?T=-T:J=-J,J<.75*V*T-Math.abs(Y*T)*.5&&J<Math.abs(B*T*.5)&&(L=J/T)),Math.abs(L)<Y&&(L=L>0?Y:-Y),r=u,C=I,u+=L,I=n.call(o,u),(I>0&&f>0||I<0&&f<0)&&(d=r,f=C),P++}return u},chandrupatla:function(n,t,o){var r,u,d,C,I,f=0,A=this.maxIterationsRoot,G=1+Math.random()*.001,B=.5*G,Z=Mat.eps,w=1e-5,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se,Ce,Ze,Be;if(JXG$1.isArray(t)){if(t.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");r=t[0],d=n.call(o,r),u=t[1],C=n.call(o,u)}else I=this.findBracket(n,t,o),r=I[0],d=I[1],u=I[2],C=I[3];if(d*C>0)return JXG$1.isArray(t)?this.fminbr(n,[r,u],o):this.Newton(n,r,o);V=r,Y=u,L=d,z=C;do{if(T=V+B*(Y-V),P=n.call(o,T),Math.sign(P)===Math.sign(L)?(J=V,V=T,K=L,L=P):(J=Y,Y=V,K=z,z=L),V=T,L=P,$=V,ie=L,Math.abs(z)<Math.abs(L)&&($=Y,ie=z),ne=2*Z*Math.abs($)+.5*w,ee=ne/Math.abs(Y-V),ee>.5||ie===0)break;se=(V-Y)/(J-Y),re=(L-z)/(K-z),ce=1-Math.sqrt(1-se),ue=Math.sqrt(se),ce<re&&re<ue?(ye=(J-V)/(Y-V),Se=L/(z-L),Ce=K/(z-K),Ze=L/(K-L),Be=z/(K-z),B=Se*Ce+Ze*Be*ye):B=.5*G,B<ee&&(B=ee),B>1-ee&&(B=1-ee),f++}while(f<=A);return $},findDomain:function(n,t,o){var r,u,d,C,I,f=.3819660112501453,A=.001,G,B=20;if(!JXG$1.isArray(t)||t.length<2)throw new Error("JXG.Math.Numerics.findDomain: length of array x0 has to be at least two.");if(I=t.slice(),r=I[0],u=I[1],C=n.call(o,r),isNaN(C)){for(G=0;u-r>A&&G<B;)d=(u-r)*f+r,C=n.call(o,d),isNaN(C)?r=d:u=d,G++;I[0]=r}if(r=I[0],u=I[1],C=n.call(o,u),isNaN(C)){for(G=0;u-r>A&&G<B;)d=u-(u-r)*f,C=n.call(o,d),isNaN(C)?u=d:r=d,G++;I[0]=u}return I},fminbr:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K=(3-Math.sqrt(5))*.5,P=Mat.eps,$=Mat.eps,ie=this.maxIterationsMinimize,ne=0;if(!JXG$1.isArray(t)||t.length<2)throw new Error("JXG.Math.Numerics.fminbr: length of array x0 has to be at least two.");for(B=this.findDomain(n,t,o),r=B[0],u=B[1],C=r+K*(u-r),A=n.call(o,C),d=C,I=C,f=A,G=A;ne<ie;){if(Z=u-r,w=(r+u)*.5,V=$*Math.abs(d)+P/3,Math.abs(d-w)+Z*.5<=2*V)return d;Y=K*(d<w?u-d:r-d),Math.abs(d-I)>=V&&(L=(d-I)*(f-A),T=(d-C)*(f-G),J=(d-C)*T-(d-I)*L,T=2*(T-L),T>0?J=-J:T=-T,Math.abs(J)<Math.abs(Y*T)&&J>T*(r-d+2*V)&&J<T*(u-d-2*V)&&(Y=J/T)),Math.abs(Y)<V&&(Y>0?Y=V:Y=-V),L=d+Y,z=n.call(o,L),z<=f?(L<d?u=d:r=d,C=I,I=d,d=L,A=G,G=f,f=z):(L<d?r=L:u=L,z<=G||I===d?(C=I,I=L,A=G,G=z):(z<=A||C===d||C===I)&&(C=L,A=z)),ne+=1}return d},glomin:function(n,t){var o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye=1e7,Se=Mat.eps,Ce=Mat.eps*Mat.eps,Ze=Mat.eps*Mat.eps*Mat.eps;if(se=t[0],re=t[1],ce=n(se)<n(re)?se:re,o=re,ue=o,r=se,L=n(re),$=L,K=n(se),T=K,L<T?T=L:ue=se,re<=se)return T;for(G=.5*(1+16*Ze)*ye,ce<=se||re<=ce?J=.5*(se+re):J=ce,z=n(J),A=3,d=r-J,f=9/11,z<T&&(ue=J,T=z);;){if(C=r-o,I=J-o,ee=re-r,ie=K-z,ne=K-L,V=C*C*ie-d*d*ne,B=V,w=2*(d*ne-C*ie),Z=w,A<1e6||K<=T)for(;Z*(V*($-K)+ee*Z*(K-T+Se))<ee*G*V*(ee*Z-V)&&(u=r+V/Z,P=n(u),P<T&&(ue=u,T=P)),A=1611*A%1048576,Z=1,V=(re-se)*1e-5*A,!(ee<=V););else for(A=1611*A%1048576,Z=1,V=(re-se)*1e-5*A;V<ee;)Z*(V*($-K)+ee*Z*(K-T+Se))<ee*G*V*(ee*Z-V)&&(u=r+V/Z,P=n(u),P<T&&(ue=u,T=P)),A=1611*A%1048576,Z=1,V=(re-se)*1e-5*A;for(V=G*d*C*I,Y=Math.sqrt((K-T+Se)/G),f=.5*(1+f),B=f*(B+2*V*Y),Z=Z+.5*w,V=-.5*(d+(ie+2.01*Ce)/(d*G)),V<Y||d<0?V=r+Y:V=r+V,0<B*Z?u=r+B/Z:u=V;u=Math.max(u,V),re<=u?(u=re,P=$):P=n(u),P<T&&(ue=u,T=P),d=u-r,!(u<=V||(B=2*(K-P)/(ye*d),(1+9*Ze)*d<=Math.abs(B))||.5*G*(d*d+B*B)<=K-T+(P-T)+2*Se);)u=.5*(r+u),f=.9*f;if(re<=u)break;o=J,J=r,r=u,L=z,z=K,K=P}return[ue,T]},polzeros:function(n,t,o,r,u){var d,C,I,f=[],A=[],G=[],B=function(J,T,L){var z,K,P=J.length-1;if(L=L||!1,L)for(K=JXG$1.C.mult(P,J[P]),z=P-1;z>0;z--)K.mult(T),K.add(JXG$1.C.mult(J[z],z));else for(K=JXG$1.C.copy(J[P]),z=P-1;z>=0;z--)K.mult(T),K.add(J[z]);return K},Z=function(J,T,L){var z,K,P=J.length-1;if(L=L||!1,L)for(K=JXG$1.C.mult(P,J[0]),z=P-1;z>0;z--)K.mult(T),K.add(JXG$1.C.mult(J[P-z],z));else for(K=JXG$1.C.copy(J[0]),z=P-1;z>=0;z--)K.mult(T),K.add(J[P-z]);return K},w=function(J,T){var L,z,K=J.length-1;for(z=J[K],L=K-1;L>=0;L--)z=z*T+J[L];return z},V=function(J){var T,L,z=J.length-1,K=Math.PI*2/z,P=Math.PI/z*.5,$,ie,ne=[];for($=JXG$1.C.mult(-1,J[z-1]),$.div(JXG$1.C.mult(z,J[z])),ie=JXG$1.C.div(B(J,$),J[z]),L=Math.pow(JXG$1.C.abs(ie),1/z),L===0&&(L=1),T=0;T<z;T++)J=new JXG$1.Complex(L*Math.cos(K*T+P),L*Math.sin(K*T+P)),ne[T]=JXG$1.C.add($,J);return ne},Y=function(J,T,L,z){var K,P,$,ie=[],ne=[],ee,se,re=0,ce,ue,ye,Se,Ce=z.length;for(P=0;P<Ce;P++)ie.push(!1);for(P=0;P<J.length;P++)ne.push(JXG$1.C.abs(J[P])*(4*P+1));for(K=0;K<L&&re<Ce;K++)for(P=0;P<Ce;P++)if(!ie[P]){if(ce=B(J,z[P]),se=JXG$1.C.abs(z[P]),JXG$1.C.abs(ce)<T*w(ne,se)){if(ie[P]=!0,re++,re===Ce)break;continue}for(se>1?(ee=JXG$1.C.div(1,z[P]),Se=Z(J,ee,!0),Se.div(Z(J,ee)),Se.mult(ee),ce=JXG$1.C.sub(Ce,Se),ce=JXG$1.C.div(z[P],ce)):ce.div(B(J,z[P],!0)),ue=new JXG$1.Complex(0),$=0;$<Ce;$++)$!==P&&(ye=JXG$1.C.sub(z[P],z[$]),ye=JXG$1.C.div(1,ye),ue.add(ye));ue.mult(ce),ue=JXG$1.C.sub(1,ue),ce.div(ue),z[P].sub(ce)}return K};for(o=o||Number.EPSILON,r=r||30,C=n.length,JXG$1.isNumber(t)&&t>=0&&t<C-1&&(C=t+1),d=0;d<C;d++)f.push(new JXG$1.Complex(n[d]));for(d=0;d<C;d++)if(f[d].real!==0||f[d].imaginary!==0){I=d;break}for(d=0;d<I;d++)A.push(new JXG$1.Complex(0));for(f=f.slice(I),C=f.length,d=C-1;d>=0&&!(f[d].real!==0||f[d].imaginary!==0);d--)f.pop();if(C=f.length,C===0)return[];if(u)for(d=0;d<C-1;d++)G.push(new JXG$1.Complex(u[d]));else G=V(f);return Y(f,o,r,G),G=A.concat(G),G.sort(function(J,T){return J.real<T.real?-1:J.real>T.real?1:0}),G},RamerDouglasPeucker:function(n,t){var o=[],r=[],u,d,C,I=!0,f=function(G,B,Z){var w,V,Y,J,T,L,z,K,P,$,ie,ne=Mat.eps*Mat.eps,ee=1e4,se=0,re=B;if(Z-B<2)return[-1,0];if(Y=G[B].scrCoords,J=G[Z].scrCoords,isNaN(Y[1])||isNaN(Y[2]))return[NaN,B];if(isNaN(J[1])||isNaN(J[2]))return[NaN,Z];for(V=B+1;V<Z;V++){if(T=G[V].scrCoords,isNaN(T[1])||isNaN(T[2]))return[NaN,V];L=T[1]-Y[1],z=T[2]-Y[2],K=J[1]-Y[1],P=J[2]-Y[2],L=L===1/0?ee:L,z=z===1/0?ee:z,K=K===1/0?ee:K,P=P===1/0?ee:P,L=L===-1/0?-1e4:L,z=z===-1/0?-1e4:z,K=K===-1/0?-1e4:K,P=P===-1/0?-1e4:P,$=K*K+P*P,$>ne?(ie=(L*K+z*P)/$,ie<0?ie=0:ie>1&&(ie=1),L=L-ie*K,z=z-ie*P,w=L*L+z*z):(ie=0,w=L*L+z*z),w>se&&(se=w,re=V)}return[Math.sqrt(se),re]},A=function(G,B,Z,w,V){var Y=f(G,B,Z),J=Y[1];if(isNaN(Y[0])){A(G,B,J-1,w,V),V.push(G[J]);do++J;while(J<=Z&&isNaN(G[J].scrCoords[1]+G[J].scrCoords[2]));J<=Z&&V.push(G[J]),A(G,J+1,Z,w,V)}else Y[0]>w?(A(G,B,J,w,V),A(G,J,Z,w,V)):V.push(G[Z])};for(C=n.length,u=0;I;){for(;u<C&&isNaN(n[u].scrCoords[1]+n[u].scrCoords[2]);)u+=1;for(d=u+1;d<C&&!isNaN(n[d].scrCoords[1]+n[d].scrCoords[2]);)d+=1;if(d--,u<C&&d>u&&(r=[],r[0]=n[u],A(n,u,d,t,r),o=o.concat(r)),u>=C)break;d<C-1&&o.push(n[d+1]),u=d+1}return o},RamerDouglasPeuker:function(n,t){return JXG$1.deprecated("Numerics.RamerDouglasPeuker()","Numerics.RamerDouglasPeucker()"),this.RamerDouglasPeucker(n,t)},Visvalingam:function(n,t){var o,r,u,d,C=[],I=[],f=[],A,G,B,Z,w;if(r=n.length,r<=2)return n;for(C[0]={used:!0,lft:null,node:null},A=0,o=1;o<r-1;o++)u=Math.abs(JXG$1.Math.Numerics.det([n[o-1].usrCoords,n[o].usrCoords,n[o+1].usrCoords])),isNaN(u)||(w={v:u,idx:o},I.push(w),C[o]={used:!0,lft:A,node:w},C[A].rt=o,A=o);for(C[r-1]={used:!0,rt:null,lft:A,node:null},C[A].rt=r-1,d=-1/0;I.length>t;)I.sort(function(V,Y){return Y.v-V.v}),o=I.pop().idx,C[o].used=!1,d=C[o].node.v,A=C[o].lft,G=C[o].rt,C[A].rt=G,C[G].lft=A,B=C[A].lft,B!==null&&(u=Math.abs(JXG$1.Math.Numerics.det([n[B].usrCoords,n[A].usrCoords,n[G].usrCoords])),C[A].node.v=u>=d?u:d),Z=C[G].rt,Z!==null&&(u=Math.abs(JXG$1.Math.Numerics.det([n[A].usrCoords,n[G].usrCoords,n[Z].usrCoords])),C[G].node.v=u>=d?u:d);o=0,f=[n[o]];do o=C[o].rt,f.push(n[o]);while(C[o].rt!==null);return f}};const Numerics=Mat.Numerics;Mat.Geometry={};JXG$1.extend(Mat.Geometry,{angle:function(n,t,o){var r,u,d,C,I=[],f=[],A=[];return JXG$1.deprecated("Geometry.angle()","Geometry.rad()"),n.coords?(I[0]=n.coords.usrCoords[1],I[1]=n.coords.usrCoords[2]):(I[0]=n[0],I[1]=n[1]),t.coords?(f[0]=t.coords.usrCoords[1],f[1]=t.coords.usrCoords[2]):(f[0]=t[0],f[1]=t[1]),o.coords?(A[0]=o.coords.usrCoords[1],A[1]=o.coords.usrCoords[2]):(A[0]=o[0],A[1]=o[1]),r=I[0]-f[0],u=I[1]-f[1],d=A[0]-f[0],C=A[1]-f[1],Math.atan2(r*C-u*d,r*d+u*C)},trueAngle:function(n,t,o){return this.rad(n,t,o)*57.29577951308232},rad:function(n,t,o){var r,u,d,C,I,f,A;return n.coords?(r=n.coords.usrCoords[1],u=n.coords.usrCoords[2]):(r=n[0],u=n[1]),t.coords?(d=t.coords.usrCoords[1],C=t.coords.usrCoords[2]):(d=t[0],C=t[1]),o.coords?(I=o.coords.usrCoords[1],f=o.coords.usrCoords[2]):(I=o[0],f=o[1]),A=Math.atan2(f-C,I-d)-Math.atan2(u-C,r-d),A<0&&(A+=6.283185307179586),A},angleBisector:function(n,t,o,r){var u,d,C,I=n.coords.usrCoords,f=t.coords.usrCoords,A=o.coords.usrCoords,G,B;return JXG$1.exists(r)||(r=n.board),f[0]===0?new Coords(Const.COORDS_BY_USER,[1,(I[1]+A[1])*.5,(I[2]+A[2])*.5],r):(G=I[1]-f[1],B=I[2]-f[2],u=Math.atan2(B,G),G=A[1]-f[1],B=A[2]-f[2],d=Math.atan2(B,G),C=(u+d)*.5,u>d&&(C+=Math.PI),G=Math.cos(C)+f[1],B=Math.sin(C)+f[2],new Coords(Const.COORDS_BY_USER,[1,G,B],r))},reflection:function(n,t,o){var r,u,d,C,I,f,A,G=t.coords.usrCoords,B=n.point1.coords.usrCoords,Z=n.point2.coords.usrCoords;return JXG$1.exists(o)||(o=t.board),I=Z[1]-B[1],f=Z[2]-B[2],r=G[1]-B[1],u=G[2]-B[2],A=(I*u-f*r)/(I*I+f*f),d=G[1]+2*A*f,C=G[2]-2*A*I,new Coords(Const.COORDS_BY_USER,[d,C],o)},rotation:function(n,t,o,r){var u,d,C,I,f,A,G=t.coords.usrCoords,B=n.coords.usrCoords;return JXG$1.exists(r)||(r=t.board),u=G[1]-B[1],d=G[2]-B[2],C=Math.cos(o),I=Math.sin(o),f=u*C-d*I+B[1],A=u*I+d*C+B[2],new Coords(Const.COORDS_BY_USER,[f,A],r)},perpendicular:function(n,t,o){var r,u,d,C,I,f=n.point1.coords.usrCoords,A=n.point2.coords.usrCoords,G=t.coords.usrCoords;return JXG$1.exists(o)||(o=t.board),t===n.point1?(r=f[1]+A[2]-f[2],u=f[2]-A[1]+f[1],I=f[0]*A[0],Math.abs(I)<Mat.eps&&(r=A[2],u=-A[1]),C=[I,r,u],d=!0):t===n.point2?(r=A[1]+f[2]-A[2],u=A[2]-f[1]+A[1],I=f[0]*A[0],Math.abs(I)<Mat.eps&&(r=f[2],u=-f[1]),C=[I,r,u],d=!1):Math.abs(Mat.innerProduct(G,n.stdform,3))<Mat.eps?(r=G[1]+A[2]-G[2],u=G[2]-A[1]+G[1],I=A[0],Math.abs(I)<Mat.eps&&(r=A[2],u=-A[1]),d=!0,Math.abs(I)>Mat.eps&&Math.abs(r-G[1])<Mat.eps&&Math.abs(u-G[2])<Mat.eps&&(r=G[1]+f[2]-G[2],u=G[2]-f[1]+G[1],d=!1),C=[I,r,u]):(C=[0,n.stdform[1],n.stdform[2]],C=Mat.crossProduct(C,G),C=Mat.crossProduct(C,n.stdform),d=!0),[new Coords(Const.COORDS_BY_USER,C,o),d]},circumcenterMidpoint:function(){JXG$1.deprecated("Geometry.circumcenterMidpoint()","Geometry.circumcenter()"),this.circumcenter.apply(this,arguments)},circumcenter:function(n,t,o,r){var u,d,C,I,f=n.coords.usrCoords,A=t.coords.usrCoords,G=o.coords.usrCoords;return JXG$1.exists(r)||(r=n.board),u=[A[0]-f[0],-A[2]+f[2],A[1]-f[1]],d=[(f[0]+A[0])*.5,(f[1]+A[1])*.5,(f[2]+A[2])*.5],C=Mat.crossProduct(u,d),u=[G[0]-A[0],-G[2]+A[2],G[1]-A[1]],d=[(A[0]+G[0])*.5,(A[1]+G[1])*.5,(A[2]+G[2])*.5],I=Mat.crossProduct(u,d),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(C,I),r)},distance:function(n,t,o){var r,u=0;for(o||(o=Math.min(n.length,t.length)),r=0;r<o;r++)u+=(n[r]-t[r])*(n[r]-t[r]);return Math.sqrt(u)},affineDistance:function(n,t,o){var r;return r=this.distance(n,t,o),r>Mat.eps&&(Math.abs(n[0])<Mat.eps||Math.abs(t[0])<Mat.eps)?1/0:r},affineRatio:function(n,t,o){var r=0,u;return JXG$1.exists(n.usrCoords)&&(n=n.usrCoords),JXG$1.exists(t.usrCoords)&&(t=t.usrCoords),JXG$1.exists(o.usrCoords)&&(o=o.usrCoords),u=t[1]-n[1],Math.abs(u)>Mat.eps?r=(o[1]-n[1])/u:r=(o[2]-n[2])/(t[2]-n[2]),r},sortVertices:function(n){for(var t,o=Expect.each(n,Expect.coordsArray),r=o.length,u=null;o[0][0]===o[r-1][0]&&o[0][1]===o[r-1][1]&&o[0][2]===o[r-1][2];)u=o.pop(),r--;return t=o[0],o.sort(function(d,C){var I=d[2]===t[2]&&d[1]===t[1]?-1/0:Math.atan2(d[2]-t[2],d[1]-t[1]),f=C[2]===t[2]&&C[1]===t[1]?-1/0:Math.atan2(C[2]-t[2],C[1]-t[1]);return I-f}),u!==null&&o.push(u),o},signedTriangle:function(n,t,o){var r=Expect.coordsArray(n),u=Expect.coordsArray(t),d=Expect.coordsArray(o);return .5*((u[1]-r[1])*(d[2]-r[2])-(u[2]-r[2])*(d[1]-r[1]))},signedPolygon:function(n,t){var o,r,u=0,d=Expect.each(n,Expect.coordsArray);for(t===void 0&&(t=!0),t?d.unshift(d[d.length-1]):d=this.sortVertices(d),r=d.length,o=1;o<r;o++)u+=d[o-1][1]*d[o][2]-d[o][1]*d[o-1][2];return .5*u},GrahamScan:function(n){var t,o=1,r=Expect.each(n,Expect.coordsArray),u=r.length;for(r=this.sortVertices(r),u=r.length,t=2;t<u;t++){for(;this.signedTriangle(r[o-1],r[o],r[t])<=0;){if(o>1)o-=1;else if(t===u-1)break;t+=1}o+=1,r=JXG$1.swap(r,o,t)}return r.slice(0,o)},calcStraight:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w;JXG$1.exists(r)||(r=10),A=JXG$1.evaluate(n.visProp.straightfirst),G=JXG$1.evaluate(n.visProp.straightlast),Math.abs(t.scrCoords[0])<Mat.eps&&(A=!0),Math.abs(o.scrCoords[0])<Mat.eps&&(G=!0),!(!A&&!G)&&(B=[],B[0]=n.stdform[0]-n.stdform[1]*n.board.origin.scrCoords[1]/n.board.unitX+n.stdform[2]*n.board.origin.scrCoords[2]/n.board.unitY,B[1]=n.stdform[1]/n.board.unitX,B[2]=-n.stdform[2]/n.board.unitY,!isNaN(B[0]+B[1]+B[2])&&(u=!1,d=!1,u=!A&&Math.abs(t.usrCoords[0])>=Mat.eps&&t.scrCoords[1]>=0&&t.scrCoords[1]<=n.board.canvasWidth&&t.scrCoords[2]>=0&&t.scrCoords[2]<=n.board.canvasHeight,d=!G&&Math.abs(o.usrCoords[0])>=Mat.eps&&o.scrCoords[1]>=0&&o.scrCoords[1]<=n.board.canvasWidth&&o.scrCoords[2]>=0&&o.scrCoords[2]<=n.board.canvasHeight,C=this.meetLineBoard(B,n.board,r),I=C[0],f=C[1],!(!u&&!d&&(!A&&G&&!this.isSameDirection(t,o,I)&&!this.isSameDirection(t,o,f)||A&&!G&&!this.isSameDirection(o,t,I)&&!this.isSameDirection(o,t,f)))&&(u?d||(this.isSameDir(t,o,I,f)?w=f:w=I):d?this.isSameDir(t,o,I,f)?Z=I:Z=f:this.isSameDir(t,o,I,f)?(Z=I,w=f):(w=I,Z=f),Z&&t.setCoordinates(Const.COORDS_BY_USER,Z.usrCoords),w&&o.setCoordinates(Const.COORDS_BY_USER,w.usrCoords))))},calcLineDelimitingPoints:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w=!1,V=!1;f=JXG$1.evaluate(n.visProp.straightfirst),A=JXG$1.evaluate(n.visProp.straightlast),Math.abs(t.scrCoords[0])<Mat.eps&&(f=!0),Math.abs(o.scrCoords[0])<Mat.eps&&(A=!0),G=[],G[0]=n.stdform[0]-n.stdform[1]*n.board.origin.scrCoords[1]/n.board.unitX+n.stdform[2]*n.board.origin.scrCoords[2]/n.board.unitY,G[1]=n.stdform[1]/n.board.unitX,G[2]=-n.stdform[2]/n.board.unitY,!isNaN(G[0]+G[1]+G[2])&&(w=!f,V=!A,u=n.board.getBoundingBox(),d=n.getSlope(),d>=0?(C=this.projectPointToLine({coords:{usrCoords:[1,u[2],u[1]]}},n,n.board),I=this.projectPointToLine({coords:{usrCoords:[1,u[0],u[3]]}},n,n.board)):(C=this.projectPointToLine({coords:{usrCoords:[1,u[0],u[1]]}},n,n.board),I=this.projectPointToLine({coords:{usrCoords:[1,u[2],u[3]]}},n,n.board)),!(!w&&!V&&(!f&&!A&&(r=t.distance(Const.COORDS_BY_USER,o),Math.abs(t.distance(Const.COORDS_BY_USER,C)+C.distance(Const.COORDS_BY_USER,o)-r)>Mat.eps||Math.abs(t.distance(Const.COORDS_BY_USER,I)+I.distance(Const.COORDS_BY_USER,o)-r)>Mat.eps)||!f&&A&&!this.isSameDirection(t,o,C)&&!this.isSameDirection(t,o,I)||f&&!A&&!this.isSameDirection(o,t,C)&&!this.isSameDirection(o,t,I)))&&(w?V||(this.isSameDir(t,o,C,I)?Z=I:Z=C):V?this.isSameDir(t,o,C,I)?B=C:B=I:this.isSameDir(t,o,C,I)?(B=C,Z=I):(Z=C,B=I),B&&t.setCoordinates(Const.COORDS_BY_USER,B.usrCoords),Z&&o.setCoordinates(Const.COORDS_BY_USER,Z.usrCoords)))},calcLabelQuadrant:function(n){var t;return n<0&&(n+=2*Math.PI),t=Math.floor((n+Math.PI/8)/(Math.PI/4))%8,["rt","urt","top","ulft","lft","llft","lrt"][t]},isSameDir:function(n,t,o,r){var u=t.usrCoords[1]-n.usrCoords[1],d=t.usrCoords[2]-n.usrCoords[2],C=r.usrCoords[1]-o.usrCoords[1],I=r.usrCoords[2]-o.usrCoords[2];return Math.abs(t.usrCoords[0])<Mat.eps&&(u=t.usrCoords[1],d=t.usrCoords[2]),Math.abs(n.usrCoords[0])<Mat.eps&&(u=-n.usrCoords[1],d=-n.usrCoords[2]),u*C+d*I>=0},isSameDirection:function(n,t,o){var r,u,d,C,I=!1;return r=t.usrCoords[1]-n.usrCoords[1],u=t.usrCoords[2]-n.usrCoords[2],d=o.usrCoords[1]-n.usrCoords[1],C=o.usrCoords[2]-n.usrCoords[2],Math.abs(r)<Mat.eps&&(r=0),Math.abs(u)<Mat.eps&&(u=0),Math.abs(d)<Mat.eps&&(d=0),Math.abs(C)<Mat.eps&&(C=0),(r>=0&&d>=0||r<=0&&d<=0)&&(I=u>=0&&C>=0||u<=0&&C<=0),I},det3p:function(n,t,o){var r,u,d;return JXG$1.isPoint(n)?r=n.Coords(!0):r=n,JXG$1.isPoint(t)?u=t.Coords(!0):u=t,JXG$1.isPoint(o)?d=o.Coords(!0):d=o,(r[1]-d[1])*(u[2]-d[2])-(u[1]-d[1])*(r[2]-d[2])},windingNumber:function(n,t,o){var r=0,u=t.length,d=n[1],C=n[2],I,f,A,G,B,Z,w=0;if(u===0)return 0;if(o=o||!1,o&&(w=1),isNaN(d)||isNaN(C)||(JXG$1.exists(t[0].coords)?(I=t[0].coords,f=t[u-1].coords):(I=t[0],f=t[u-1]),I.usrCoords[1]===d&&I.usrCoords[2]===C))return 1;for(Z=0;Z<u-w;Z++)if(JXG$1.exists(t[Z].coords)?(f=t[Z].coords.usrCoords,A=t[(Z+1)%u].coords.usrCoords):(f=t[Z].usrCoords,A=t[(Z+1)%u].usrCoords),!(f[0]===0||A[0]===0||isNaN(f[1])||isNaN(A[1])||isNaN(f[2])||isNaN(A[2]))){if(A[2]===C){if(A[1]===d)return 1;if(f[2]===C&&A[1]>d==f[1]<d)return 0}if(f[2]<C!=A[2]<C)if(B=2*(A[2]>f[2]?1:0)-1,f[1]>=d)if(A[1]>d)r+=B;else{if(G=this.det3p(f,A,n),G===0)return 0;G>0+Mat.eps==A[2]>f[2]&&(r+=B)}else A[1]>d&&(G=this.det3p(f,A,n),G>0+Mat.eps==A[2]>f[2]&&(r+=B))}return r},pnpoly:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z=o,w=!1;for(r===Const.COORDS_BY_USER?(B=new Coords(Const.COORDS_BY_USER,[n,t],this.board),A=B.scrCoords[1],G=B.scrCoords[2]):(A=n,G=t),f=o.length,u=0,d=f-2;u<f-1;d=u++)C=JXG$1.exists(Z[u].coords)?Z[u].coords:Z[u],I=JXG$1.exists(Z[d].coords)?Z[d].coords:Z[d],C.scrCoords[2]>G!=I.scrCoords[2]>G&&A<(I.scrCoords[1]-C.scrCoords[1])*(G-C.scrCoords[2])/(I.scrCoords[2]-C.scrCoords[2])+C.scrCoords[1]&&(w=!w);return w},intersectionFunction:function(n,t,o,r,u,d){var C,I=this,f=!1,A=!1;return f=t.elementClass===Const.OBJECT_CLASS_CURVE&&(t.type===Const.OBJECT_TYPE_ARC||t.type===Const.OBJECT_TYPE_SECTOR),A=o.elementClass===Const.OBJECT_CLASS_CURVE&&(o.type===Const.OBJECT_TYPE_ARC||o.type===Const.OBJECT_TYPE_SECTOR),(t.elementClass===Const.OBJECT_CLASS_CURVE||o.elementClass===Const.OBJECT_CLASS_CURVE)&&(t.elementClass===Const.OBJECT_CLASS_CURVE||t.elementClass===Const.OBJECT_CLASS_CIRCLE)&&(o.elementClass===Const.OBJECT_CLASS_CURVE||o.elementClass===Const.OBJECT_CLASS_CIRCLE)?C=function(){return I.meetCurveCurve(t,o,r,u,t.board)}:t.elementClass===Const.OBJECT_CLASS_CURVE&&!f&&o.elementClass===Const.OBJECT_CLASS_LINE||o.elementClass===Const.OBJECT_CLASS_CURVE&&!A&&t.elementClass===Const.OBJECT_CLASS_LINE?C=function(){return I.meetCurveLine(t,o,r,t.board,JXG$1.evaluate(d))}:t.type===Const.OBJECT_TYPE_POLYGON||o.type===Const.OBJECT_TYPE_POLYGON?t.elementClass===Const.OBJECT_CLASS_LINE?C=function(){var G=JXG$1.evaluate(t.visProp.straightfirst),B=JXG$1.evaluate(t.visProp.straightlast),Z=JXG$1.evaluate(o.visProp.straightfirst),w=JXG$1.evaluate(o.visProp.straightlast),V;return V=!JXG$1.evaluate(d)&&(!G||!B||!Z||!w),I.meetPolygonLine(o,t,r,t.board,V)}:o.elementClass===Const.OBJECT_CLASS_LINE?C=function(){var G=JXG$1.evaluate(t.visProp.straightfirst),B=JXG$1.evaluate(t.visProp.straightlast),Z=JXG$1.evaluate(o.visProp.straightfirst),w=JXG$1.evaluate(o.visProp.straightlast),V;return V=!JXG$1.evaluate(d)&&(!G||!B||!Z||!w),I.meetPolygonLine(t,o,r,t.board,V)}:C=function(){return I.meetPathPath(t,o,r,t.board)}:t.elementClass===Const.OBJECT_CLASS_LINE&&o.elementClass===Const.OBJECT_CLASS_LINE?C=function(){var G,B,Z=JXG$1.evaluate(t.visProp.straightfirst),w=JXG$1.evaluate(t.visProp.straightlast),V=JXG$1.evaluate(o.visProp.straightfirst),Y=JXG$1.evaluate(o.visProp.straightlast);return!JXG$1.evaluate(d)&&(!Z||!w||!V||!Y)?(G=I.meetSegmentSegment(t.point1.coords.usrCoords,t.point2.coords.usrCoords,o.point1.coords.usrCoords,o.point2.coords.usrCoords),!Z&&G[1]<0||!w&&G[1]>1||!V&&G[2]<0||!Y&&G[2]>1?B=[0,NaN,NaN]:B=G[0],new Coords(Const.COORDS_BY_USER,B,t.board)):I.meet(t.stdform,o.stdform,r,t.board)}:C=function(){var G=I.meet(t.stdform,o.stdform,r,t.board),B=!0,Z,w,V;return JXG$1.evaluate(d)?G:t.elementClass===Const.OBJECT_CLASS_LINE&&(Z=JXG$1.evaluate(t.visProp.straightfirst),w=JXG$1.evaluate(t.visProp.straightlast),(!Z||!w)&&(V=I.affineRatio(t.point1.coords,t.point2.coords,G),!w&&V>1+Mat.eps||!Z&&V<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):o.elementClass===Const.OBJECT_CLASS_LINE&&(Z=JXG$1.evaluate(o.visProp.straightfirst),w=JXG$1.evaluate(o.visProp.straightlast),(!Z||!w)&&(V=I.affineRatio(o.point1.coords,o.point2.coords,G),!w&&V>1+Mat.eps||!Z&&V<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):f&&(B=I.coordsOnArc(t,G),B&&A&&(B=I.coordsOnArc(o,G)),!B)?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):G},C},otherIntersectionFunction:function(n,t,o,r){var u,d,C,I,f=this;return C=n[0],I=n[1],d=C.board,u=function(){var A,G,B,Z,w,V=t.length,Y=JXG$1.evaluate(r);for(A=V;A>=0;A--){for(C.elementClass===Const.OBJECT_CLASS_CIRCLE&&[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_LINE].indexOf(I.elementClass)>=0?B=f.meet(C.stdform,I.stdform,A,d):C.elementClass===Const.OBJECT_CLASS_CURVE&&[Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_CIRCLE].indexOf(I.elementClass)>=0?B=f.meetCurveCurve(C,I,A,0,d,"segment"):C.elementClass===Const.OBJECT_CLASS_CURVE&&I.elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.exists(C.dataX)?B=JXG$1.Math.Geometry.meetCurveLine(C,I,A,C.board,JXG$1.evaluate(o)):B=JXG$1.Math.Geometry.meetCurveLineContinuous(C,I,A,C.board)),w=!1,G=0;!w&&G<V;G++)Z=B.distance(JXG$1.COORDS_BY_USER,t[G].coords),Z<Y&&(w=!0);if(!w)return B}return B},u},intersectionFunction3D:function(n,t,o,r){var u,d=this;return t.type===Const.OBJECT_TYPE_PLANE3D?o.type===Const.OBJECT_TYPE_PLANE3D?u=()=>n.intersectionPlanePlane(t,o)[r]:o.type===Const.OBJECT_TYPE_SPHERE3D&&(u=d.meetPlaneSphere(t,o)):t.type===Const.OBJECT_TYPE_SPHERE3D&&(o.type===Const.OBJECT_TYPE_PLANE3D?u=d.meetPlaneSphere(o,t):o.type===Const.OBJECT_TYPE_SPHERE3D&&(u=d.meetSphereSphere(t,o))),u},coordsOnArc:function(n,t){var o=this.rad(n.radiuspoint,n.center,t.usrCoords.slice(1)),r=0,u=this.rad(n.radiuspoint,n.center,n.anglepoint),d=JXG$1.evaluate(n.visProp.selection);return(d==="minor"&&u>Math.PI||d==="major"&&u<Math.PI)&&(r=u,u=2*Math.PI),!(o<r||o>u)},meet:function(n,t,o,r){var u,d=Mat.eps;return Math.abs(n[3])<d&&Math.abs(t[3])<d?u=this.meetLineLine(n,t,o,r):Math.abs(n[3])>=d&&Math.abs(t[3])<d?u=this.meetLineCircle(t,n,o,r):Math.abs(n[3])<d&&Math.abs(t[3])>=d?u=this.meetLineCircle(n,t,o,r):u=this.meetCircleCircle(n,t,o,r),u},meetLineBoard:function(n,t,o){var r=[],u,d,C,I;for(JXG$1.exists(o)||(o=0),r[0]=Mat.crossProduct(n,[o,0,1]),r[1]=Mat.crossProduct(n,[o,1,0]),r[2]=Mat.crossProduct(n,[-o-t.canvasHeight,0,1]),r[3]=Mat.crossProduct(n,[-o-t.canvasWidth,1,0]),C=0;C<4;C++)if(Math.abs(r[C][0])>Mat.eps){for(I=2;I>0;I--)r[C][I]/=r[C][0];r[C][0]=1}return Math.abs(r[1][0])<Mat.eps?(u=r[0],d=r[2]):Math.abs(r[0][0])<Mat.eps?(u=r[1],d=r[3]):r[1][2]<0?(u=r[0],r[3][2]>t.canvasHeight?d=r[2]:d=r[3]):r[1][2]>t.canvasHeight?(u=r[2],r[3][2]<0?d=r[0]:d=r[3]):(u=r[1],r[3][2]<0?d=r[0]:r[3][2]>t.canvasHeight?d=r[2]:d=r[3]),[new Coords(Const.COORDS_BY_SCREEN,u.slice(1),t),new Coords(Const.COORDS_BY_SCREEN,d.slice(1),t)]},meetLineLine:function(n,t,o,r){var u=isNaN(n[5]+t[5])?[0,0,0]:Mat.crossProduct(n,t);return Math.abs(u[0])<1e-14&&(u[0]=0),new Coords(Const.COORDS_BY_USER,u,r)},meetLineCircle:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w;return t[4]<Mat.eps?Math.abs(Mat.innerProduct([1,t[6],t[7]],n,3))<Mat.eps?new Coords(Const.COORDS_BY_USER,t.slice(6,8),r):new Coords(Const.COORDS_BY_USER,[NaN,NaN],r):(C=t[0],d=t.slice(1,3),u=t[3],I=n[0],f=n.slice(1,3),A=u,G=d[0]*f[1]-d[1]*f[0],B=u*I*I-(d[0]*f[0]+d[1]*f[1])*I+C,Z=G*G-4*A*B,Z>-Mat.eps*Mat.eps?(Z=Math.sqrt(Math.abs(Z)),w=[(-G+Z)/(2*A),(-G-Z)/(2*A)],JXG$1.evaluate(o)===0?new Coords(Const.COORDS_BY_USER,[-w[0]*-f[1]-I*f[0],-w[0]*f[0]-I*f[1]],r):new Coords(Const.COORDS_BY_USER,[-w[1]*-f[1]-I*f[0],-w[1]*f[0]-I*f[1]],r)):new Coords(Const.COORDS_BY_USER,[0,0,0],r))},meetCircleCircle:function(n,t,o,r){var u;return n[4]<Mat.eps?Math.abs(this.distance(n.slice(6,2),t.slice(6,8))-t[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,n.slice(6,8),r):new Coords(Const.COORDS_BY_USER,[0,0,0],r):t[4]<Mat.eps?Math.abs(this.distance(t.slice(6,2),n.slice(6,8))-n[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,t.slice(6,8),r):new Coords(Const.COORDS_BY_USER,[0,0,0],r):(u=[t[3]*n[0]-n[3]*t[0],t[3]*n[1]-n[3]*t[1],t[3]*n[2]-n[3]*t[2],0,1,1/0,1/0,1/0],u=Mat.normalize(u),this.meetLineCircle(u,n,o,r))},meetCurveCurve:function(n,t,o,r,u,d){var C;return JXG$1.exists(d)&&d==="newton"?C=Numerics.generalizedNewton(n,t,JXG$1.evaluate(o),r):n.bezierDegree===3||t.bezierDegree===3?C=this.meetBezierCurveRedBlueSegments(n,t,o):C=this.meetCurveRedBlueSegments(n,t,o),new Coords(Const.COORDS_BY_USER,C,u)},meetCurveLine:function(n,t,o,r,u){var d=[0,NaN,NaN],C,I;return JXG$1.exists(r)||(r=n.board),n.elementClass===Const.OBJECT_CLASS_CURVE?(C=n,I=t):(C=t,I=n),d=this.meetCurveLineDiscrete(C,I,o,r,!u),d},meetCurveLineContinuous:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z=Mat.eps,w=Mat.eps,V,Y,J,T,L,z,K;for(f=this.meetCurveLineDiscrete(n,t,o,r,u),A=f.usrCoords[1],G=f.usrCoords[2],d=function(P){var $,ie;return P>n.maxX()||P<n.minX()?1/0:($=n.X(P)-A,ie=n.Y(P)-G,$*$+ie*ie)},C=function(P){var $=t.stdform[0]+t.stdform[1]*n.X(P)+t.stdform[2]*n.Y(P);return $*$},V=50,Y=(n.maxX()-n.minX())/V,J=n.minX(),L=1e-4,T=NaN,z=0;z<V&&(I=Numerics.root(d,[Math.max(J,n.minX()),Math.min(J+Y,n.maxX())]),K=Math.abs(d(I)),!(K<=L&&(L=K,T=I,L<Z)));z++)J+=Y;return I=T,I=Numerics.root(C,[Math.max(I-Y,n.minX()),Math.min(I+Y,n.maxX())]),K=C(I),isNaN(K)||Math.abs(K)>w?B=0:B=1,new Coords(Const.COORDS_BY_USER,[B,n.X(I),n.Y(I)],r)},meetCurveLineDiscrete:function(n,t,o,r,u){var d,C,I=JXG$1.evaluate(o),f,A,G,B,Z=t.point1.coords.usrCoords,w=t.point2.coords.usrCoords,V,Y,J=0,T=n.numberPoints,L=JXG$1.evaluate(t.visProp.straightfirst),z=JXG$1.evaluate(t.visProp.straightlast);for(B=new Coords(Const.COORDS_BY_USER,[0,NaN,NaN],r),Z[0]===0?Z=[1,w[1]+t.stdform[2],w[2]-t.stdform[1]]:w[0]===0&&(w=[1,Z[1]+t.stdform[2],Z[2]-t.stdform[1]]),A=n.points[0].usrCoords,d=1;d<T;d+=n.bezierDegree)if(f=A.slice(0),A=n.points[d].usrCoords,V=this.distance(f,A),V>Mat.eps){for(n.bezierDegree===3?Y=this.meetBeziersegmentBeziersegment([n.points[d-1].usrCoords.slice(1),n.points[d].usrCoords.slice(1),n.points[d+1].usrCoords.slice(1),n.points[d+2].usrCoords.slice(1)],[Z.slice(1),w.slice(1)],u):Y=[this.meetSegmentSegment(f,A,Z,w)],C=0;C<Y.length;C++)if(G=Y[C],0<=G[1]&&G[1]<=1){if(J===I)return u&&(!L&&G[2]<0||!z&&G[2]>1)||(B=new Coords(Const.COORDS_BY_USER,G[0],r)),B;J+=1}}return B},meetCurveRedBlueSegments:function(n,t,o){var r,u,d=JXG$1.evaluate(o),C,I,f,A,G,B,Z,w=0,V=t.numberPoints,Y=n.numberPoints;if(V<=1||Y<=1)return[0,NaN,NaN];for(r=1;r<Y;r++)for(C=n.points[r-1].usrCoords,I=n.points[r].usrCoords,B=Math.min(C[1],I[1]),Z=Math.max(C[1],I[1]),A=t.points[0].usrCoords,u=1;u<V;u++)if(f=A,A=t.points[u].usrCoords,Math.min(f[1],A[1])<Z&&Math.max(f[1],A[1])>B&&(G=this.meetSegmentSegment(C,I,f,A),G[1]>=0&&G[2]>=0&&(G[1]<1&&G[2]<1||r===Y-1&&G[1]===1||u===V-1&&G[2]===1))){if(w===d)return G[0];w++}return[0,NaN,NaN]},meetSegmentSegment:function(n,t,o,r){var u,d,C,I,f=Mat.crossProduct(n,t),A=Mat.crossProduct(o,r),G=Mat.crossProduct(f,A);return Math.abs(G[0])<Mat.eps?[G,1/0,1/0]:(G[1]/=G[0],G[2]/=G[0],G[0]/=G[0],C=Math.abs(t[1]-t[0]*n[1])<Mat.eps?2:1,I=n[C]/n[0],u=(G[C]-I)/(t[0]!==0?t[C]/t[0]-I:t[C]),C=Math.abs(r[1]-r[0]*o[1])<Mat.eps?2:1,I=o[C]/o[0],d=(G[C]-I)/(r[0]!==0?r[C]/r[0]-I:r[C]),[G,u,d])},meetPathPath:function(n,t,o,r){var u,d,C,I,f=JXG$1.evaluate(o);return u=JXG$1.Math.Clip._getPath(n,r),C=u.length,C>0&&this.distance(u[0].coords.usrCoords,u[C-1].coords.usrCoords,3)<Mat.eps&&u.pop(),d=JXG$1.Math.Clip._getPath(t,r),C=d.length,C>0&&this.distance(d[0].coords.usrCoords,d[C-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&d.pop(),o<0||JXG$1.Math.Clip.isEmptyCase(u,d,"intersection")?new Coords(Const.COORDS_BY_USER,[0,0,0],r):(JXG$1.Math.Clip.makeDoublyLinkedList(u),JXG$1.Math.Clip.makeDoublyLinkedList(d),I=JXG$1.Math.Clip.findIntersections(u,d,r)[0],f<I.length?I[f].coords:new Coords(Const.COORDS_BY_USER,[0,0,0],r))},meetPolygonLine:function(n,t,o,r,u){var d,C=JXG$1.evaluate(o),I,f,A=[0,0,0],G=n.borders.length,B=[];for(d=0;d<G;d++)f=n.borders[d],I=this.meetSegmentSegment(f.point1.coords.usrCoords,f.point2.coords.usrCoords,t.point1.coords.usrCoords,t.point2.coords.usrCoords),(!u||I[2]>=0&&I[2]<1)&&I[1]>=0&&I[1]<1&&B.push(I[0]);return C>=0&&C<B.length&&(A=B[C]),new Coords(Const.COORDS_BY_USER,A,r)},meetPlaneSphere:function(n,t){var o=function(){return n.normal[0]*t.center.X()+n.normal[1]*t.center.Y()+n.normal[2]*t.center.Z()-n.d};return[[function(){return t.center.X()-o()*n.normal[0]},function(){return t.center.Y()-o()*n.normal[1]},function(){return t.center.Z()-o()*n.normal[2]}],[()=>n.normal[0],()=>n.normal[1],()=>n.normal[2]],function(){var r=t.Radius(),u=o();return Math.sqrt(r*r-u*u)}]},meetSphereSphere:function(n,t){var o=function(){var r=n.center.distance(t.center),u=n.Radius(),d=t.Radius();return(u-d)*(u+d)/(r*r)};return[[function(){var r=o();return .5*((1-r)*n.center.X()+(1+r)*t.center.X())},function(){var r=o();return .5*((1-r)*n.center.Y()+(1+r)*t.center.Y())},function(){var r=o();return .5*((1-r)*n.center.Z()+(1+r)*t.center.Z())}],[()=>t.center.X()-n.center.X(),()=>t.center.Y()-n.center.Y(),()=>t.center.Z()-n.center.Z()],function(){var r=n.center.distance(t.center),u=n.Radius(),d=t.Radius(),C=o(),I=.5*(u*u+d*d-.5*r*r*(1+C*C));return Math.sqrt(I)}]},_bezierSplit:function(n){var t,o,r,u,d,C;return t=[(n[0][0]+n[1][0])*.5,(n[0][1]+n[1][1])*.5],o=[(n[1][0]+n[2][0])*.5,(n[1][1]+n[2][1])*.5],r=[(n[2][0]+n[3][0])*.5,(n[2][1]+n[3][1])*.5],u=[(t[0]+o[0])*.5,(t[1]+o[1])*.5],d=[(o[0]+r[0])*.5,(o[1]+r[1])*.5],C=[(u[0]+d[0])*.5,(u[1]+d[1])*.5],[[n[0],t,u,C],[C,d,r,n[3]]]},_bezierBbox:function(n){var t=[];return n.length===4?(t[0]=Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),t[1]=Math.max(n[0][1],n[1][1],n[2][1],n[3][1]),t[2]=Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),t[3]=Math.min(n[0][1],n[1][1],n[2][1],n[3][1])):(t[0]=Math.min(n[0][0],n[1][0]),t[1]=Math.max(n[0][1],n[1][1]),t[2]=Math.max(n[0][0],n[1][0]),t[3]=Math.min(n[0][1],n[1][1])),t},_bezierOverlap:function(n,t){return n[2]>=t[0]&&n[0]<=t[2]&&n[1]>=t[3]&&n[3]<=t[1]},_bezierListConcat:function(n,t,o,r){var u,d=JXG$1.exists(r),C=0,I=t.length,f=n.length;for(f>0&&I>0&&(n[f-1][1]===1&&t[0][1]===0||d&&n[f-1][2]===1&&t[0][2]===0)&&(C=1),u=C;u<I;u++)d&&(t[u][2]*=.5,t[u][2]+=r),t[u][1]*=.5,t[u][1]+=o,n.push(t[u])},_bezierMeetSubdivision:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y=[],J=5;return u=this._bezierBbox(t),r=this._bezierBbox(n),this._bezierOverlap(u,r)?o<J?(d=this._bezierSplit(n),f=d[0],A=d[1],d=this._bezierSplit(t),C=d[0],I=d[1],this._bezierListConcat(Y,this._bezierMeetSubdivision(f,C,o+1),0,0),this._bezierListConcat(Y,this._bezierMeetSubdivision(f,I,o+1),0,.5),this._bezierListConcat(Y,this._bezierMeetSubdivision(A,C,o+1),.5,0),this._bezierListConcat(Y,this._bezierMeetSubdivision(A,I,o+1),.5,.5),Y):(w=[1].concat(n[0]),V=[1].concat(n[3]),B=[1].concat(t[0]),Z=[1].concat(t[3]),G=this.meetSegmentSegment(w,V,B,Z),G[1]>=0&&G[2]>=0&&G[1]<=1&&G[2]<=1?[G]:[]):[]},_bezierLineMeetSubdivision:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w,V=[],Y=5;return u=this._bezierBbox(t),d=this._bezierBbox(n),r&&!this._bezierOverlap(d,u)?[]:o<Y?(C=this._bezierSplit(n),I=C[0],f=C[1],this._bezierListConcat(V,this._bezierLineMeetSubdivision(I,t,o+1),0),this._bezierListConcat(V,this._bezierLineMeetSubdivision(f,t,o+1),.5),V):(Z=[1].concat(n[0]),w=[1].concat(n[3]),G=[1].concat(t[0]),B=[1].concat(t[1]),A=this.meetSegmentSegment(Z,w,G,B),A[1]>=0&&A[1]<=1&&(!r||A[2]>=0&&A[2]<=1)?[A]:[])},meetBeziersegmentBeziersegment:function(n,t,o){var r,u,d;for(n.length===4&&t.length===4?r=this._bezierMeetSubdivision(n,t,0):r=this._bezierLineMeetSubdivision(n,t,0,o),r.sort(function(C,I){return(C[1]-I[1])*1e7+(C[2]-I[2])}),u=[],d=0;d<r.length;d++)(d===0||r[d][1]!==r[d-1][1]||r[d][2]!==r[d-1][2])&&u.push(r[d]);return u},meetBezierCurveRedBlueSegments:function(n,t,o){var r,u,d,C,I=JXG$1.evaluate(o),f,A,G,B,Z,w,V,Y=0,J=0,T,L,z=[];if(t.numberPoints<t.bezierDegree+1||n.numberPoints<n.bezierDegree+1)return[0,NaN,NaN];for(n.bezierDegree===1&&t.bezierDegree===3&&(A=n,n=t,t=A),T=t.numberPoints-t.bezierDegree,L=n.numberPoints-n.bezierDegree,n.type===Const.OBJECT_TYPE_SECTOR&&(Y=3,L-=3),t.type===Const.OBJECT_TYPE_SECTOR&&(J=3,T-=3),u=Y;u<L;u+=n.bezierDegree)for(r=n.points,G=[r[u].usrCoords.slice(1),r[u+1].usrCoords.slice(1)],n.bezierDegree===3&&(G[2]=r[u+2].usrCoords.slice(1),G[3]=r[u+3].usrCoords.slice(1)),Z=this._bezierBbox(G),d=J;d<T;d+=t.bezierDegree)if(r=t.points,B=[r[d].usrCoords.slice(1),r[d+1].usrCoords.slice(1)],t.bezierDegree===3&&(B[2]=r[d+2].usrCoords.slice(1),B[3]=r[d+3].usrCoords.slice(1)),w=this._bezierBbox(B),this._bezierOverlap(Z,w)){if(V=this.meetBeziersegmentBeziersegment(G,B),V.length===0)continue;for(C=0;C<V.length;C++)f=V[C],!(f[1]<-Mat.eps||f[1]>1+Mat.eps||f[2]<-Mat.eps||f[2]>1+Mat.eps)&&z.push(f);if(z.length>I)return z[I][0]}return z.length>I?z[I][0]:[0,NaN,NaN]},bezierSegmentEval:function(n,t){var o,r,u,d=1-n;return r=0,u=0,o=d*d*d,r+=o*t[0][0],u+=o*t[0][1],o=3*n*d*d,r+=o*t[1][0],u+=o*t[1][1],o=3*n*n*d,r+=o*t[2][0],u+=o*t[2][1],o=n*n*n,r+=o*t[3][0],u+=o*t[3][1],[1,r,u]},bezierArc:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z,w=t[1],V=t[2],Y=t[0],J=[],T=[],L,z,K,P,$,ie,ne,ee,se,re;for(A=this.distance(t,n),w/=Y,V/=Y,G=this.rad(n.slice(1),t.slice(1),o.slice(1)),u===-1&&(G=2*Math.PI-G),Z=G/4,d=n,d[1]/=d[0],d[2]/=d[0],d[0]/=d[0],f=d.slice(0),r?(J=[w,w+.333*(d[1]-w),w+.666*(d[1]-w),d[1]],T=[V,V+.333*(d[2]-V),V+.666*(d[2]-V),d[2]]):(J=[d[1]],T=[d[2]]);G>Mat.eps;)G>Z?(B=Z,G-=Z):(B=G,G=0),L=Math.cos(u*B),z=Math.sin(u*B),re=[[1,0,0],[w*(1-L)+V*z,L,-z],[V*(1-L)-w*z,z,L]],ee=Mat.matVecMult(re,d),f=[ee[0]/ee[0],ee[1]/ee[0],ee[2]/ee[0]],K=d[1]-w,P=d[2]-V,$=f[1]-w,ie=f[2]-V,se=Mat.hypot(K+$,P+ie),Math.abs(ie-P)>Mat.eps?ne=(K+$)*(A/se-.5)/(ie-P)*8/3:ne=(P+ie)*(A/se-.5)/(K-$)*8/3,C=[1,d[1]-ne*P,d[2]+ne*K],I=[1,f[1]+ne*ie,f[2]-ne*$],JXG$1.concat(J,[C[1],I[1],f[1]]),JXG$1.concat(T,[C[2],I[2],f[2]]),d=f.slice(0);return r&&(JXG$1.concat(J,[f[1]+.333*(w-f[1]),f[1]+.666*(w-f[1]),w]),JXG$1.concat(T,[f[2]+.333*(V-f[2]),f[2]+.666*(V-f[2]),V])),[J,T]},projectPointToCircle:function(n,t,o){var r,u,d,C,I,f=t.center.coords.usrCoords;return JXG$1.exists(o)||(o=n.board),JXG$1.isPoint(n)?(r=n.coords.distance(Const.COORDS_BY_USER,t.center.coords),u=n.coords.usrCoords):(r=n.distance(Const.COORDS_BY_USER,t.center.coords),u=n.usrCoords),Math.abs(r)<Mat.eps&&(r=Mat.eps),I=t.Radius()/r,d=f[1]+I*(u[1]-f[1]),C=f[2]+I*(u[2]-f[2]),new Coords(Const.COORDS_BY_USER,[d,C],o)},projectPointToLine:function(n,t,o){var r=[0,t.stdform[1],t.stdform[2]],u;return JXG$1.exists(o)||(JXG$1.exists(n.coords)?o=n.board:o=t.board),JXG$1.exists(n.coords)?u=n.coords.usrCoords:u=n.usrCoords,r=Mat.crossProduct(r,u),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(r,t.stdform),o)},projectCoordsToSegment:function(n,t,o){var r,u,d=[o[1]-t[1],o[2]-t[2]],C=[n[1]-t[1],n[2]-t[2]];return Math.abs(d[0])<Mat.eps&&Math.abs(d[1])<Mat.eps?[t,0]:(r=Mat.innerProduct(C,d),u=Mat.innerProduct(d,d),r/=u,[[1,r*d[0]+t[1],r*d[1]+t[2]],r])},projectCoordsToBeziersegment:function(n,t,o){var r,u=function(d){var C=[1,t.X(o+d),t.Y(o+d)];return C[1]-=n[1],C[2]-=n[2],C[1]*C[1]+C[2]*C[2]};return r=JXG$1.Math.Numerics.fminbr(u,[0,1]),[[1,t.X(r+o),t.Y(r+o)],r]},projectPointToCurve:function(n,t,o){JXG$1.exists(o)||(o=n.board);var r=n.X(),u=n.Y(),d=n.position,C;return JXG$1.exists(d)||(d=JXG$1.evaluate(t.visProp.curvetype)==="functiongraph"?r:0),C=this.projectCoordsToCurve(r,u,d,t,o),C},projectCoordsToCurve:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se=Number.POSITIVE_INFINITY;if(JXG$1.exists(u)||(u=r.board),JXG$1.evaluate(r.visProp.curvetype)==="plot"){if(o=0,A=Se,r.numberPoints===0?d=[0,1,1]:d=[r.Z(0),r.X(0),r.Y(0)],r.numberPoints>1)for(Z=[1,n,t],r.bezierDegree===3?f=0:Y=[r.Z(0),r.X(0),r.Y(0)],I=0;I<r.numberPoints-1;I++)r.bezierDegree===3?T=this.projectCoordsToBeziersegment(Z,r,f):(J=[r.Z(I+1),r.X(I+1),r.Y(I+1)],T=this.projectCoordsToSegment(Z,Y,J)),B=T[1],w=T[0],0<=B&&B<=1?(G=this.distance(w,Z),V=I+B):B<0?(w=Y,G=this.distance(Y,Z),V=I):B>1&&I===r.numberPoints-2&&(w=J,G=this.distance(w,Z),V=r.numberPoints-1),G<A&&(A=G,o=V,d=w),r.bezierDegree===3?(f++,I+=2):Y=J;C=new Coords(Const.COORDS_BY_USER,d,u)}else{for(ue=r.minX(),ye=r.maxX(),re=ue,ce=ye,JXG$1.evaluate(r.visProp.curvetype)==="functiongraph"&&($=Math.abs(t-r.Y(n)),isNaN($)||(re=n-$,ce=n+$)),L=function(Ce){var Ze,Be;return Ce<ue||Ce>r.maxX_glob?1/0:(Ze=n-r.X(Ce),Be=t-r.Y(Ce),Ze*Ze+Be*Be)},P=L(o),se=50,ie=(ce-re)/se,z=re,I=0;I<se;I++)K=L(z),(K<P||P===1/0||isNaN(P))&&(o=z,P=K),z+=ie;for(ne=ie,I=0;I<20&&isNaN(L(o-ne));I++,ne*=.5);for(isNaN(L(o-ne))&&(ne=0),ee=ie,I=0;I<20&&isNaN(L(o+ee));I++,ee*=.5);isNaN(L(o+ee))&&(ee=0),o=Numerics.fminbr(L,[Math.max(o-ne,re),Math.min(o+ee,ce)]),o=o<ue?ue:o,o=o>ye?ye:o,C=new Coords(Const.COORDS_BY_USER,[r.X(o),r.Y(o)],u)}return[r.updateTransform(C),o]},projectCoordsToPolygon:function(n,t){var o,r=t.vertices.length,u=1/0,d,C,I,f;for(o=0;o<r-1;o++)C=JXG$1.Math.Geometry.projectCoordsToSegment(n,t.vertices[o].coords.usrCoords,t.vertices[o+1].coords.usrCoords),0<=C[1]&&C[1]<=1?(d=JXG$1.Math.Geometry.distance(C[0],n,3),I=C[0]):C[1]<0?(d=JXG$1.Math.Geometry.distance(t.vertices[o].coords.usrCoords,n,3),I=t.vertices[o].coords.usrCoords):(d=JXG$1.Math.Geometry.distance(t.vertices[o+1].coords.usrCoords,n,3),I=t.vertices[o+1].coords.usrCoords),d<u&&(f=I.slice(0),u=d);return f},projectPointToTurtle:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w=0,V=0,Y=Number.POSITIVE_INFINITY,J=t.objects.length;for(JXG$1.exists(o)||(o=n.board),I=0;I<J;I++)A=t.objects[I],A.elementClass===Const.OBJECT_CLASS_CURVE&&(B=this.projectPointToCurve(n,A),r=B[0],Z=B[1],f=this.distance(r.usrCoords,n.coords.usrCoords),f<Y&&(d=r.usrCoords[1],C=r.usrCoords[2],u=Z,Y=f,G=A,V=w),w+=A.numberPoints);return r=new Coords(Const.COORDS_BY_USER,[d,C],o),[G.updateTransform(r),u+V]},projectPointToPoint:function(n,t){return t.coords},projectPointToBoard:function(n,t){var o,r,u,d=t||n.board,C=[[1,1,0,0,3,0,1],[-1,2,1,0,1,2,1],[-1,1,2,2,1,2,3],[1,2,3,0,3,2,3]],I=n.coords||n,f=d.getBoundingBox();for(o=0;o<4;o++)u=C[o],u[0]*I.usrCoords[u[1]]<u[0]*f[u[2]]&&(r=Mat.crossProduct([1,f[u[3]],f[u[4]]],[1,f[u[5]],f[u[6]]]),r[3]=0,r=Mat.normalize(r),I=this.projectPointToLine({coords:I},{stdform:r},d));return I},projectCoordsToParametric:function(n,t,o){var r,u,d=0,C=200,I=o.length,f;return I===1?r=.1*(t.range[1]-t.range[0]):I===2&&(r=.1*Math.min(t.range_u[1]-t.range_u[0],t.range_v[1]-t.range_v[0])),u=r/5e6,f=function(A,G,B,Z){var w=n[0]-t.X.apply(null,B),V=n[1]-t.Y.apply(null,B),Y=n[2]-t.Z.apply(null,B);return A===1?(Z[0]=B[0]-t.range[0],Z[1]=-B[0]+t.range[1]):A===2&&(Z[0]=B[0]-t.range_u[0],Z[1]=-B[0]+t.range_u[1],Z[2]=B[1]-t.range_v[0],Z[3]=-B[1]+t.range_v[1]),w*w+V*V+Y*Y},Mat.Nlp.FindMinimum(f,I,2*I,o,r,u,d,C),[1,t.X.apply(null,o),t.Y.apply(null,o),t.Z.apply(null,o)]},projectScreenCoordsToParametric:function(n,t,o){var r,u,d=0,C=200,I=o.length,f;return I===1?r=.1*(t.range[1]-t.range[0]):I===2&&(r=.1*Math.min(t.range_u[1]-t.range_u[0],t.range_v[1]-t.range_v[0])),u=r/5e6,f=function(A,G,B,Z){var w=[1,t.X.apply(null,B),t.Y.apply(null,B),t.Z.apply(null,B)],V=t.view.project3DTo2D(w),Y=n[0]-V[1],J=n[1]-V[2];return A===1?(Z[0]=B[0]-t.range[0],Z[1]=-B[0]+t.range[1]):A===2&&(Z[0]=B[0]-t.range_u[0],Z[1]=-B[0]+t.range_u[1],Z[2]=B[1]-t.range_v[0],Z[3]=-B[1]+t.range_v[1]),Y*Y+J*J},Mat.Nlp.FindMinimum(f,I,2*I,o,r,u,d,C),[1,t.X.apply(null,o),t.Y.apply(null,o),t.Z.apply(null,o)]},distPointLine:function(n,t){var o=t[1],r=t[2],u=t[0],d;return Math.abs(o)+Math.abs(r)<Mat.eps?Number.POSITIVE_INFINITY:(d=o*n[1]+r*n[2]+u,o*=o,r*=r,Math.abs(d)/Math.sqrt(o+r))},distPointSegment:function(n,t,o){var r,u,d,C,I,f,A=Mat.eps*Mat.eps,G=1e6;return r=n[1]-t[1],u=n[2]-t[2],r=r===1/0?G:r===-1/0?-1e6:r,u=u===1/0?G:u===-1/0?-1e6:u,d=o[1]-t[1],C=o[2]-t[2],d=d===1/0?G:d===-1/0?-1e6:d,C=C===1/0?G:C===-1/0?-1e6:C,I=d*d+C*C,I>A&&(f=(r*d+u*C)/I,f<0?f=0:f>1&&(f=1),r-=f*d,u-=f*C),Mat.hypot(r,u)},reuleauxPolygon:function(n,t){var o,r=Math.PI*2,u=r/t,d=(t-1)/2,C=0,I=function(f,A){return function(G,B){var Z=(G%r+r)%r,w=Math.floor(Z/u)%t;return B||(C=n[0].Dist(n[d]),o=Mat.Geometry.rad([n[0].X()+1,n[0].Y()],n[0],n[d%t])),isNaN(w)?w:(Z=Z*.5+w*u*.5+o,n[w][f]()+C*Math[A](Z))}};return[I("X","cos"),I("Y","sin"),0,r]},meet3Planes:function(n,t,o,r,u,d){var C=[0,0,0],I,f,A,G,B;for(I=Mat.crossProduct(u,n),f=Mat.crossProduct(n,o),A=Mat.crossProduct(o,u),G=Mat.innerProduct(n,A,3),B=0;B<3;B++)C[B]=(t*A[B]+r*I[B]+d*f[B])/G;return C},meetPlanePlane:function(n,t,o,r){var u,d,C,I=[0,0,0],f=[0,0,0];for(u=0;u<3;u++)I[u]=JXG$1.evaluate(n[u]),f[u]=JXG$1.evaluate(t[u]);for(d=Mat.crossProduct(I,f),u=0;u<3;u++)I[u]=JXG$1.evaluate(o[u]),f[u]=JXG$1.evaluate(r[u]);return C=Mat.crossProduct(I,f),Mat.crossProduct(d,C)},project3DTo3DPlane:function(n,t,o){var r=[0,0,0],u,d,C,I;return o=o||[0,0,0],u=Mat.norm(t),d=Mat.innerProduct(n,t,3),C=Mat.innerProduct(o,t,3),I=(d-C)/u,r=Mat.axpy(-I,t,n),r},getPlaneBounds:function(n,t,o,r,u){var d,C,I,f,A,G,B;return n[2]+t[0]!==0?(A=[[n[0],t[0]],[n[1],t[1]]],G=[r-o[0],r-o[1]],B=Numerics.Gauss(A,G),d=B[0],C=B[1],G=[u-o[0],u-o[1]],B=Numerics.Gauss(A,G),I=B[0],f=B[1],[d,I,C,f]):null}});const Geometry=Mat.Geometry;Mat.Quadtree=function(n,t,o){t=t||{capacity:10,pointType:"coords"},this.config={},this.config.capacity=t.capacity||10,this.config.pointType=t.pointType||"coords",this.points=[],this.xlb=n[0],this.xub=n[2],this.ylb=n[3],this.yub=n[1],this.parent=o||null,this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null};JXG$1.extend(Mat.Quadtree.prototype,{contains:function(n,t){return this.xlb<n&&n<=this.xub&&this.ylb<t&&t<=this.yub},insert:function(n){switch(this.config.pointType){case"coords":if(!this.contains(n.usrCoords[1],n.usrCoords[2]))return!1;break;case"object":if(!this.contains(n.x,n.y))return!1;break}return this.points.length<this.config.capacity&&this.northWest===null?(this.points.push(n),!0):(this.northWest===null&&this.subdivide(),this.northWest.insert(n)||this.northEast.insert(n)||this.southEast.insert(n)?!0:!!this.southWest.insert(n))},subdivide:function(){var n=this.xlb+(this.xub-this.xlb)*.5,t=this.ylb+(this.yub-this.ylb)*.5;this.northWest=new Mat.Quadtree([this.xlb,this.yub,n,t],this.config,this),this.northEast=new Mat.Quadtree([n,this.yub,this.xub,t],this.config,this),this.southEast=new Mat.Quadtree([this.xlb,t,n,this.ylb],this.config,this),this.southWest=new Mat.Quadtree([n,t,this.xub,this.ylb],this.config,this)},_query:function(n,t){var o;if(this.contains(n,t)){if(this.northWest===null)return this;if(o=this.northWest._query(n,t),o||(o=this.northEast._query(n,t),o)||(o=this.southEast._query(n,t),o)||(o=this.southWest._query(n,t),o))return o}return!1},query:function(n,t){var o,r;return JXG$1.exists(t)?(o=n,r=t):(o=n.usrCoords[1],r=n.usrCoords[2]),this._query(o,r)},hasPoint:function(n,t,o){var r,u,d;if(this.contains(n,t)){switch(d=this.points.length,this.config.pointType){case"coords":for(u=0;u<d;u++)if(Geometry.distance([n,t],this.points[u].usrCoords.slice(1),2)<o)return!0;break;case"object":for(u=0;u<d;u++)if(Geometry.distance([n,t],[this.points[u].x,this.points[u].y],2)<o)return!0;break}if(this.northWest===null)return!1;if(r=this.northWest.hasPoint(n,t,o),r||(r=this.northEast.hasPoint(n,t,o),r)||(r=this.southEast.hasPoint(n,t,o),r)||(r=this.southWest.hasPoint(n,t,o),r))return r}return!1},getAllPoints:function(){var n=[];return this.getAllPointsRecursive(n),n},getAllPointsRecursive(n){Array.prototype.push.apply(n,this.points.slice()),this.northWest!==null&&(this.northWest.getAllPointsRecursive(n),this.northEast.getAllPointsRecursive(n),this.southEast.getAllPointsRecursive(n),this.southWest.getAllPointsRecursive(n))}});const QDT=Mat.Quadtree;Mat.BoxQuadtree=function(n,t,o){var r,u,d,C;n--,this.depth=n,this.capacity=t,this.items=[],this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null,this.bbox=null,this.cx=null,this.cy=null,o&&(r=o[0],u=o[1],d=o[2],C=o[3],this.cx=(r+d)*.5,this.cy=(u+C)*.5,this.bbox=[r,u,d,C])};JXG$1.extend(Mat.BoxQuadtree.prototype,{insert:function(n){var t,o,r,u,d,C,I,f=[],A=[],G=[],B=[],Z,w,V,Y;if(this.bbox===null){for(o=n.length,r=C=1/0,d=u=-1/0,t=0;t<n.length;t++)I=n[t],r=I.xlb<r?I.xlb:r,u=I.yub>u?I.yub:u,d=I.xub>d?I.xub:d,C=I.ylb<C?I.ylb:C;this.cx=(r+d)*.5,this.cy=(u+C)*.5,this.bbox=[r,u,d,C]}else r=this.bbox[0],u=this.bbox[1],d=this.bbox[2],C=this.bbox[3];if(this.depth===0||this.items.length+n.length<this.capacity)return this.items=this.items.concat(n),this;for(o=n.length,t=0;t<o;t++)I=n[t],Z=I.xlb<=this.cx&&I.yub>this.cy,V=I.xlb<=this.cx&&I.ylb<=this.cy,w=I.xub>this.cx&&I.yub>this.cy,Y=I.xub>this.cx&&I.ylb<=this.cy,Z&&w&&Y&&V?this.items.push(I):(Z&&f.push(I),V&&G.push(I),w&&A.push(I),Y&&B.push(I));return this.subdivide(f,G,A,B,r,u,d,C),this},insertItem:function(n){var t,o,r,u,d=[],C=[],I=[],f=[],A,G,B,Z;return this.bbox===null?(t=u=1/0,r=o=-1/0,t=n.xlb<t?n.xlb:t,o=n.yub>o?n.yub:o,r=n.xub>r?n.xub:r,u=n.ylb<u?n.ylb:u,this.cx=(t+r)*.5,this.cy=(o+u)*.5,this.bbox=[t,o,r,u]):(t=this.bbox[0],o=this.bbox[1],r=this.bbox[2],u=this.bbox[3]),this.depth===0||this.items.length+1<this.capacity?(this.items.push(n),this):(A=n.xlb<=this.cx&&n.yub>this.cy,B=n.xlb<=this.cx&&n.ylb<=this.cy,G=n.xub>this.cx&&n.yub>this.cy,Z=n.xub>this.cx&&n.ylb<=this.cy,A&&G&&Z&&B?this.items.push(n):(A&&d.push(n),B&&I.push(n),G&&C.push(n),Z&&f.push(n)),this.subdivide(d,I,C,f,t,o,r,u),this)},subdivide:function(n,t,o,r,u,d,C,I){return n.length>0&&(this.northWest===null&&(this.northWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[u,d,this.cx,this.cy])),this.northWest.insert(n)),t.length>0&&(this.southWest===null&&(this.southWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[u,this.cy,this.cx,I])),this.southWest.insert(t)),o.length>0&&(this.northEast===null&&(this.northEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,d,C,this.cy])),this.northEast.insert(o)),r.length>0&&(this.southEast===null&&(this.southEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,this.cy,C,I])),this.southEast.insert(r)),this},find:function(n){var t=function(d){return n[2]>=d.xlb&&n[0]<=d.xub&&n[3]<=d.yub&&n[1]>=d.ylb},o=[],r,u;for(u=this.items.length,r=0;r<u;r++)t(this.items[r])&&o.push(this.items[r]);return this.northWest!==null&&n[0]<=this.cx&n[1]>=this.cy&&JXG$1.concat(o,this.northWest.find(n)),this.southWest!==null&&n[0]<=this.cx&n[3]<=this.cy&&JXG$1.concat(o,this.southWest.find(n)),this.northEast!==null&&n[2]>=this.cx&n[1]>=this.cy&&JXG$1.concat(o,this.northEast.find(n)),this.southEast!==null&&n[2]>=this.cx&n[3]<=this.cy&&JXG$1.concat(o,this.southEast.find(n)),o},analyzeTree:function(){var n={number_items:this.items.length,depth:1},t;return this.northWest!==null&&(t=this.northWest.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.southWest!==null&&(t=this.southWest.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.northEast!==null&&(t=this.northEast.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.southEast!==null&&(t=this.southEast.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),n},plot:function(){var n=[],t=[],o;return n.push(this.bbox[0]),t.push(this.bbox[3]),n.push(this.bbox[2]),t.push(this.bbox[3]),n.push(this.bbox[2]),t.push(this.bbox[1]),n.push(this.bbox[0]),t.push(this.bbox[1]),n.push(this.bbox[0]),t.push(this.bbox[3]),n.push(NaN),t.push(NaN),this.northWest!==null&&(o=this.northWest.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.northEast!==null&&(o=this.northEast.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.southEast!==null&&(o=this.southEast.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.southWest!==null&&(o=this.southWest.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),[n,t]}});const Quadtree=Mat.BoxQuadtree;JXG$1.Math.Nlp={arr:function(n){return new Float64Array(n)},arr2:function(n,t){for(var o=0,r=new Array(n);o<n;)r[o]=this.arr(t),o++;return r},arraycopy:function(n,t,o,r,u){for(var d=0;d<u;)o[d+r]=n[d+t],d++},lastNumberOfEvaluations:0,GetLastNumberOfEvaluations:function(){return this.lastNumberOfEvaluations},Normal:0,MaxIterationsReached:1,DivergingRoundingErrors:2,FindMinimum:function(n,t,o,r,u,d,C,I,f){var A=o+2,G,B=this.arr(t+1),Z=this,w;return this.lastNumberOfEvaluations=0,f&&console.log("Experimental feature 'testForRoundingErrors' is activated."),B[0]=0,this.arraycopy(r,0,B,1,t),w=function(V,Y,J,T){var L=Z.arr(V),z,K;return Z.lastNumberOfEvaluations=Z.lastNumberOfEvaluations+1,Z.arraycopy(J,1,L,0,V),z=Z.arr(Y),K=n(V,Y,L,z),Z.arraycopy(z,0,T,1,Y),K},G=this.cobylb(w,t,o,A,B,u,d,C,I,f),this.arraycopy(B,1,r,0,t),G},cobylb:function(n,t,o,r,u,d,C,I,f,A){var G=-1,B=.25,Z=2.1,w=.5,V=1.1,Y=0,J=0,T,L=t+1,z=o+1,K=d,P=0,$=!1,ie=!1,ne=0,ee=0,se=0,re=this.arr(1+r),ce=this.arr2(1+t,1+L),ue=this.arr2(1+t,1+t),ye=this.arr2(1+r,1+L),Se=this.arr2(1+t,1+z),Ce=this.arr(1+t),Ze=this.arr(1+t),Be=this.arr(1+t),xe=this.arr(1+t),ge=this.arr(1+t),de,ve,le,Ae,Xe,Te,Ne,We,dt,nt,Rt,Qe,Oe,be,yt,st,Gt,rt,Yt,Xt,Ge,he,ke,it,ht,He,ot,Zt,wt,Et,De=!0;for(I>=2&&console.log("The initial value of RHO is "+K+" and PARMU is set to zero."),Ne=0,Xe=1/K,de=1;de<=t;++de)ce[de][L]=u[de],ce[de][de]=K,ue[de][de]=Xe;We=L,dt=!1;e:do{if(Ne>=f&&Ne>0){G=this.MaxIterationsReached;break e}for(++Ne,Y=n(t,o,u,re),J=0,le=1;le<=o;++le)J=Math.max(J,-re[le]);if((Ne===I-1||I===3)&&this.PrintIterationResult(Ne,Y,J,u,t,I),re[z]=Y,re[r]=J,nt=!0,!dt){for(nt=!1,de=1;de<=r;++de)ye[de][We]=re[de];if(Ne<=L){if(We<=t)if(ye[z][L]<=Y)u[We]=ce[We][L];else{for(ce[We][L]=u[We],le=1;le<=r;++le)ye[le][We]=ye[le][L],ye[le][L]=re[le];for(le=1;le<=We;++le){for(ce[We][le]=-K,Xe=0,de=le;de<=We;++de)Xe-=ue[de][le];ue[We][le]=Xe}}if(Ne<=t){We=Ne,u[We]+=K;continue e}}dt=!0}t:do{i:do{if(!nt){for(Rt=ye[z][L]+P*ye[r][L],Qe=L,ve=1;ve<=t;++ve)Xe=ye[z][ve]+P*ye[r][ve],Xe<Rt?(Qe=ve,Rt=Xe):Xe===Rt&&P===0&&ye[r][ve]<ye[r][Qe]&&(Qe=ve);if(Qe<=t){for(de=1;de<=r;++de)Xe=ye[de][L],ye[de][L]=ye[de][Qe],ye[de][Qe]=Xe;for(de=1;de<=t;++de){for(Xe=ce[de][Qe],ce[de][Qe]=0,ce[de][L]+=Xe,Te=0,le=1;le<=t;++le)ce[de][le]-=Xe,Te-=ue[le][de];ue[Qe][de]=Te}}if(Oe=0,A)for(de=1;de<=t;++de)for(ve=1;ve<=t;++ve)Xe=this.DOT_PRODUCT_ROW_COL(ue,de,ce,ve,1,t)-(de===ve?1:0),Oe=Math.max(Oe,Math.abs(Xe));if(Oe>.1){G=this.DivergingRoundingErrors;break e}for(le=1;le<=z;++le){for(re[le]=-ye[le][L],ve=1;ve<=t;++ve)ge[ve]=ye[le][ve]+re[le];for(de=1;de<=t;++de)Se[de][le]=(le===z?-1:1)*this.DOT_PRODUCT_ROW_COL(ge,-1,ue,de,1,t)}for($=!0,ne=B*K,be=Z*K,ve=1;ve<=t;++ve){for(yt=0,st=0,le=1;le<=t;++le)yt+=ue[ve][le]*ue[ve][le],st+=ce[le][ve]*ce[le][ve];Ce[ve]=1/Math.sqrt(yt),Ze[ve]=Math.sqrt(st),(Ce[ve]<ne||Ze[ve]>be)&&($=!1)}if(!dt&&!$){for(We=0,Xe=be,ve=1;ve<=t;++ve)Ze[ve]>Xe&&(We=ve,Xe=Ze[ve]);if(We===0)for(ve=1;ve<=t;++ve)Ce[ve]<Xe&&(We=ve,Xe=Ce[ve]);for(Xe=w*K*Ce[We],le=1;le<=t;++le)xe[le]=Xe*ue[We][le];for(Gt=0,rt=0,T=0,le=1;le<=z;++le)T=this.DOT_PRODUCT_ROW_COL(xe,-1,Se,le,1,t),le<z&&(Xe=ye[le][L],Gt=Math.max(Gt,-T-Xe),rt=Math.max(rt,T-Xe));for(Yt=P*(Gt-rt)>2*T?-1:1,Xe=0,de=1;de<=t;++de)xe[de]=Yt*xe[de],ce[de][We]=xe[de],Xe+=ue[We][de]*xe[de];for(le=1;le<=t;++le)ue[We][le]/=Xe;for(ve=1;ve<=t;++ve){if(ve!==We)for(Xe=this.DOT_PRODUCT_ROW_COL(ue,ve,xe,-1,1,t),le=1;le<=t;++le)ue[ve][le]-=Xe*ue[We][le];u[ve]=ce[ve][L]+xe[ve]}continue e}if(ie=this.trstlp(t,o,Se,re,K,xe),!ie){for(Xe=0,le=1;le<=t;++le)Xe+=xe[le]*xe[le];if(Xe<.25*K*K){dt=!0;break i}}for(T=0,Xt=0,re[z]=0,le=1;le<=z;++le)T=re[le]-this.DOT_PRODUCT_ROW_COL(xe,-1,Se,le,1,t),le<z&&(Xt=Math.max(Xt,T));if(ee=ye[r][L]-Xt,Ge=ee>0?T/ee:0,P<1.5*Ge){for(P=2*Ge,I>=2&&console.log("Increase in PARMU to "+P),he=ye[z][L]+P*ye[r][L],ve=1;ve<=t;++ve)if(Xe=ye[z][ve]+P*ye[r][ve],Xe<he||Xe===he&&P===0&&ye[r][ve]<ye[r][L])continue t}for(se=P*ee-T,le=1;le<=t;++le)u[le]=ce[le][L]+xe[le];dt=!0;continue e}for(nt=!1,ke=ye[z][L]+P*ye[r][L],it=Y+P*J,ht=ke-it,P===0&&Y===ye[z][L]&&(se=ee,ht=ye[r][L]-J),He=ht<=0?1:0,We=0,ve=1;ve<=t;++ve)Xe=Math.abs(this.DOT_PRODUCT_ROW_COL(ue,ve,xe,-1,1,t)),Xe>He&&(We=ve,He=Xe),Be[ve]=Xe*Ce[ve];for(ot=V*K,Ae=0,ve=1;ve<=t;++ve)if(Be[ve]>=ne||Be[ve]>=Ce[ve]){if(Xe=Ze[ve],ht>0){for(Xe=0,le=1;le<=t;++le)Xe+=Math.pow(xe[le]-ce[le][ve],2);Xe=Math.sqrt(Xe)}Xe>ot&&(Ae=ve,ot=Xe)}if(Ae>0&&(We=Ae),We!==0){for(Xe=0,de=1;de<=t;++de)ce[de][We]=xe[de],Xe+=ue[We][de]*xe[de];for(le=1;le<=t;++le)ue[We][le]/=Xe;for(ve=1;ve<=t;++ve)if(ve!==We)for(Xe=this.DOT_PRODUCT_ROW_COL(ue,ve,xe,-1,1,t),le=1;le<=t;++le)ue[ve][le]-=Xe*ue[We][le];for(le=1;le<=r;++le)ye[le][We]=re[le];if(ht>0&&ht>=.1*se)continue t}}while(!1);if(!$){dt=!1;continue t}if(K<=C){G=this.Normal;break e}if(Zt=0,wt=0,K*=.5,K<=1.5*C&&(K=C),P>0){for(Et=0,le=1;le<=z;++le){for(Zt=ye[le][L],wt=Zt,de=1;de<=t;++de)Zt=Math.min(Zt,ye[le][de]),wt=Math.max(wt,ye[le][de]);le<=o&&Zt<.5*wt&&(Xe=Math.max(wt,0)-Zt,Et=Et<=0?Xe:Math.min(Et,Xe))}Et===0?P=0:wt-Zt<P*Et&&(P=(wt-Zt)/Et)}I>=2&&console.log("Reduction in RHO to "+K+"  and PARMU = "+P),I===2&&this.PrintIterationResult(Ne,ye[z][L],ye[r][L],this.COL(ce,L),t,I)}while(De)}while(De);switch(G){case this.Normal:if(I>=1&&console.log("%nNormal return from subroutine COBYLA%n"),ie)return I>=1&&this.PrintIterationResult(Ne,Y,J,u,t,I),G;break;case this.MaxIterationsReached:I>=1&&console.log("%nReturn from subroutine COBYLA because the MAXFUN limit has been reached.%n");break;case this.DivergingRoundingErrors:I>=1&&console.log("%nReturn from subroutine COBYLA because rounding errors are becoming damaging.%n");break}for(le=1;le<=t;++le)u[le]=ce[le][L];return Y=ye[z][L],J=ye[r][L],I>=1&&this.PrintIterationResult(Ne,Y,J,u,t,I),G},trstlp:function(n,t,o,r,u,d){var C=0,I=0,f=0,A=this.arr2(1+n,1+n),G=this.arr(2+t),B=this.arr(2+t),Z=this.arr(1+n),w=this.arr(1+n),V=this.arr(2+t),Y=this.arr(2+t),J=t,T=0,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se,Ce,Ze,Be,xe,ge,de,ve,le,Ae,Xe,Te,Ne,We,dt,nt,Rt,Qe,Oe,be,yt,st=!0;for(K=1;K<=n;++K)A[K][K]=1,d[K]=0;if(L=0,z=0,t>=1){for(P=1;P<=t;++P)r[P]>z&&(z=r[P],L=P);for(P=1;P<=t;++P)Y[P]=P,B[P]=z-r[P]}$=!0;do e:do{(!$||$&&z===0)&&(J=t+1,L=J,Y[J]=J,B[J]=0),$=!1,ie=0,ne=0,ee=0,se=0;t:do{if(re=J===t?z:-this.DOT_PRODUCT_ROW_COL(d,-1,o,J,1,n),ne===0||re<ie?(ie=re,I=T,ne=3):T>I?(I=T,ne=3):--ne,ne===0)break e;if(ce=0,L<=T){if(L<T){ue=Y[L],ye=B[L],P=L;do{for(Ce=P+1,Ze=Y[Ce],Be=this.DOT_PRODUCT(this.PART(this.COL(A,P),1,n),this.PART(this.COL(o,Ze),1,n)),C=Mat.hypot(Be,G[Ce]),xe=G[Ce]/C,ge=Be/C,G[Ce]=xe*G[P],G[P]=C,K=1;K<=n;++K)C=xe*A[K][Ce]+ge*A[K][P],A[K][Ce]=xe*A[K][P]-ge*A[K][Ce],A[K][P]=C;Y[P]=Ze,B[P]=B[Ce],P=Ce}while(P<T);Y[P]=ue,B[P]=ye}if(--T,J>t)for(C=1/G[T],P=1;P<=n;++P)Z[P]=C*A[P][T];else for(C=this.DOT_PRODUCT_ROW_COL(Z,-1,A,T+1,1,n),P=1;P<=n;++P)Z[P]-=C*A[P][T+1]}else{for(Ze=Y[L],P=1;P<=n;++P)w[P]=o[P][Ze];for(de=0,P=n;P>T;){for(Be=0,ve=0,K=1;K<=n;++K)C=A[K][P]*w[K],Be+=C,ve+=Math.abs(C);if(le=ve+.1*Math.abs(Be),Ae=ve+.2*Math.abs(Be),(ve>=le||le>=Ae)&&(Be=0),de===0)de=Be;else for(Ce=P+1,C=Mat.hypot(Be,de),xe=Be/C,ge=de/C,de=C,K=1;K<=n;++K)C=xe*A[K][P]+ge*A[K][Ce],A[K][Ce]=xe*A[K][Ce]-ge*A[K][P],A[K][P]=C;--P}if(de===0){ce=-1,P=T;do{for(Xe=0,Te=0,K=1;K<=n;++K)C=A[K][P]*w[K],Xe+=C,Te+=Math.abs(C);if(le=Te+.1*Math.abs(Xe),Ae=Te+.2*Math.abs(Xe),Te<le&&le<Ae){if(C=Xe/G[P],C>0&&Y[P]<=t&&(yt=B[P]/C,(ce<0||yt<ce)&&(ce=yt)),P>=2)for(Ne=Y[P],K=1;K<=n;++K)w[K]-=C*o[K][Ne];V[P]=C}else V[P]=0}while(--P>0);if(ce<0)break e;for(P=1;P<=T;++P)B[P]=Math.max(0,B[P]-ce*V[P]);if(L<T){ue=Y[L],ye=B[L],P=L;do{for(Ce=P+1,Ne=Y[Ce],Be=this.DOT_PRODUCT(this.PART(this.COL(A,P),1,n),this.PART(this.COL(o,Ne),1,n)),C=Mat.hypot(Be,G[Ce]),xe=G[Ce]/C,ge=Be/C,G[Ce]=xe*G[P],G[P]=C,K=1;K<=n;++K)C=xe*A[K][Ce]+ge*A[K][P],A[K][Ce]=xe*A[K][P]-ge*A[K][Ce],A[K][P]=C;Y[P]=Ne,B[P]=B[Ce],P=Ce}while(P<T);Y[P]=ue,B[P]=ye}if(C=this.DOT_PRODUCT(this.PART(this.COL(A,T),1,n),this.PART(this.COL(o,Ze),1,n)),C===0)break e;G[T]=C,B[L]=0,B[T]=ce}else++T,G[T]=de,B[L]=B[T],B[T]=0;if(Y[L]=Y[T],Y[T]=Ze,J>t&&Ze!==J){for(P=T-1,Be=this.DOT_PRODUCT(this.PART(this.COL(A,P),1,n),this.PART(this.COL(o,Ze),1,n)),C=Mat.hypot(Be,G[T]),xe=G[T]/C,ge=Be/C,G[T]=xe*G[P],G[P]=C,K=1;K<=n;++K)C=xe*A[K][T]+ge*A[K][P],A[K][T]=xe*A[K][P]-ge*A[K][T],A[K][P]=C;Y[T]=Y[P],Y[P]=Ze,C=B[P],B[P]=B[T],B[T]=C}if(J>t)for(C=1/G[T],P=1;P<=n;++P)Z[P]=C*A[P][T];else for(Ze=Y[T],C=(this.DOT_PRODUCT_ROW_COL(Z,-1,o,Ze,1,n)-1)/G[T],P=1;P<=n;++P)Z[P]-=C*A[P][T]}for(We=u*u,nt=0,dt=0,K=1;K<=n;++K)Math.abs(d[K])>=1e-6*u&&(We-=d[K]*d[K]),nt+=d[K]*Z[K],dt+=Z[K]*Z[K];if(We<=0)break e;if(C=Math.sqrt(dt*We),Math.abs(nt)>=1e-6*C&&(C=Math.sqrt(dt*We+nt*nt)),se=We/(C+nt),ee=se,J===t){if(le=ee+.1*z,Ae=ee+.2*z,ee>=le||le>=Ae)break t;ee=Math.min(ee,z)}for(P=1;P<=n;++P)w[P]=d[P]+ee*Z[P];if(J===t)for(f=z,z=0,P=1;P<=T;++P)Ze=Y[P],C=r[Ze]-this.DOT_PRODUCT_ROW_COL(w,-1,o,Ze,1,n),z=Math.max(z,C);P=T;do{for(Rt=0,Qe=0,K=1;K<=n;++K)C=A[K][P]*w[K],Rt+=C,Qe+=Math.abs(C);if(le=Qe+.1*Math.abs(Rt),Ae=Qe+.2*Math.abs(Rt),(Qe>=le||le>=Ae)&&(Rt=0),V[P]=Rt/G[P],P>=2)for(Ze=Y[P],K=1;K<=n;++K)w[K]-=V[P]*o[K][Ze]}while(P-->=2);for(J>t&&(V[T]=Math.max(0,V[T])),P=1;P<=n;++P)w[P]=d[P]+ee*Z[P];if(J>T)for(Oe=T+1,P=Oe;P<=J;++P){for(Ze=Y[P],Se=z-r[Ze],be=z+Math.abs(r[Ze]),K=1;K<=n;++K)C=o[K][Ze]*w[K],Se+=C,be+=Math.abs(C);le=be+.1*Math.abs(Se),Ae=be+.2*Math.abs(Se),(be>=le||le>=Ae)&&(Se=0),V[P]=Se}for(ce=1,L=0,P=1;P<=J;++P)V[P]<0&&(C=B[P]/(B[P]-V[P]),C<ce&&(ce=C,L=P));for(C=1-ce,P=1;P<=n;++P)d[P]=C*d[P]+ce*w[P];for(P=1;P<=J;++P)B[P]=Math.max(0,C*B[P]+ce*V[P]);J===t&&(z=f+ce*(z-f))}while(L>0);if(ee===se)return!0}while(st);while(J===t);return!1},PrintIterationResult:function(n,t,o,r,u,d){d>1&&console.log("NFVALS = "+n+"  F = "+t+"  MAXCV = "+o),d>1&&console.log("X = "+this.PART(r,1,u))},ROW:function(n,t){return n[t].slice()},COL:function(n,t){var o,r=n.length,u=[];for(o=0;o<r;++o)u[o]=n[o][t];return u},PART:function(n,t,o){return n.slice(t,o+1)},FORMAT:function(n){return n.join(",")},DOT_PRODUCT:function(n,t){var o,r=0,u=n.length;for(o=0;o<u;++o)r+=n[o]*t[o];return r},DOT_PRODUCT_ROW_COL:function(n,t,o,r,u,d){var C,I=0;if(t===-1)for(C=u;C<=d;++C)I+=n[C]*o[C][r];else if(r===-1)for(C=u;C<=d;++C)I+=n[t][C]*o[C];else for(C=u;C<=d;++C)I+=n[t][C]*o[C][r];return I}};JXG$1.Math.Nlp;Mat.Statistics={sum:function(n){var t,o=n.length,r=0;for(t=0;t<o;t++)r+=n[t];return r},prod:function(n){var t,o=n.length,r=1;for(t=0;t<o;t++)r*=n[t];return r},mean:function(n){return n.length>0?this.sum(n)/n.length:0},median:function(n){var t,o;return n.length>0?(ArrayBuffer.isView(n)?(t=new Float64Array(n),t.sort()):(t=n.slice(0),t.sort(function(r,u){return r-u})),o=t.length,o&1?t[parseInt(o*.5,10)]:(t[o*.5-1]+t[o*.5])*.5):0},percentile:function(n,t){var o,r,u,d,C=[],I;if(n.length>0){for(ArrayBuffer.isView(n)?(o=new Float64Array(n),o.sort()):(o=n.slice(0),o.sort(function(f,A){return f-A})),r=o.length,JXG$1.isArray(t)?d=t:d=[t],u=0;u<d.length;u++)I=r*d[u]*.01,parseInt(I,10)===I?C.push((o[I-1]+o[I])*.5):C.push(o[parseInt(I,10)]);return JXG$1.isArray(t)?C:C[0]}return 0},variance:function(n){var t,o,r,u=n.length;if(u>1){for(t=this.mean(n),o=0,r=0;r<u;r++)o+=(n[r]-t)*(n[r]-t);return o/(n.length-1)}return 0},sd:function(n){return Math.sqrt(this.variance(n))},weightedMean:function(n,t){if(n.length!==t.length)throw new Error("JSXGraph error (Math.Statistics.weightedMean): Array dimension mismatch.");return n.length>0?this.mean(this.multiply(n,t)):0},max:function(n){return Math.max.apply(this,n)},min:function(n){return Math.min.apply(this,n)},range:function(n){return[this.min(n),this.max(n)]},abs:function(n){var t,o,r;if(JXG$1.isArray(n))if(n.map)r=n.map(Math.abs);else for(o=n.length,r=[],t=0;t<o;t++)r[t]=Math.abs(n[t]);else ArrayBuffer.isView(n)?r=n.map(Math.abs):r=Math.abs(n);return r},add:function(n,t){var o,r,u=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,o=0;o<r;o++)u[o]=n[o]+t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(r=t.length,o=0;o<r;o++)u[o]=n+t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),o=0;o<r;o++)u[o]=n[o]+t[o];else u=n+t;return u},div:function(n,t){var o,r,u=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,o=0;o<r;o++)u[o]=n[o]/t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(r=t.length,o=0;o<r;o++)u[o]=n/t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),o=0;o<r;o++)u[o]=n[o]/t[o];else u=n/t;return u},divide:function(){JXG$1.deprecated("Statistics.divide()","Statistics.div()"),Mat.Statistics.div.apply(Mat.Statistics,arguments)},mod:function(n,t,o){var r,u,d=[],C=function(I,f){return I%f};if(o=JXG$1.def(o,!1),o&&(C=Mat.mod),n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,r=0;r<u;r++)d[r]=C(n[r],t);else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,r=0;r<u;r++)d[r]=C(n,t[r]);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),r=0;r<u;r++)d[r]=C(n[r],t[r]);else d=C(n,t);return d},multiply:function(n,t){var o,r,u=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,o=0;o<r;o++)u[o]=n[o]*t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(r=t.length,o=0;o<r;o++)u[o]=n*t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),o=0;o<r;o++)u[o]=n[o]*t[o];else u=n*t;return u},subtract:function(n,t){var o,r,u=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,o=0;o<r;o++)u[o]=n[o]-t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(r=t.length,o=0;o<r;o++)u[o]=n-t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),o=0;o<r;o++)u[o]=n[o]-t[o];else u=n-t;return u},TheilSenRegression:function(n){var t,o,r=[],u=[],d=[];for(t=0;t<n.length;t++){for(u.length=0,o=0;o<n.length;o++)Math.abs(n[o].usrCoords[1]-n[t].usrCoords[1])>Mat.eps&&(u[o]=(n[o].usrCoords[2]-n[t].usrCoords[2])/(n[o].usrCoords[1]-n[t].usrCoords[1]));r[t]=this.median(u),d.push(n[t].usrCoords[2]-r[t]*n[t].usrCoords[1])}return[this.median(d),this.median(r),-1]},generateGaussian:function(n,t){var o,r,u;if(this.hasSpare)return this.hasSpare=!1,this.spare*t+n;do o=Math.random()*2-1,r=Math.random()*2-1,u=o*o+r*r;while(u>=1||u===0);return u=Math.sqrt(-2*Math.log(u)/u),this.spare=r*u,this.hasSpare=!0,n+t*o*u},randomNormal:function(n,t){return this.generateGaussian(n,t)},randomUniform:function(n,t){return Math.random()*(t-n)+n},randomExponential:function(n){var t;if(n<=0)return NaN;do t=Math.random();while(t===0);return-Math.log(t)/n},randomGamma:function(n,t,o){var r,u,d,C,I,f;if(n<=0)return NaN;if(t=t||1,o=o||0,n===1)return t*this.randomExponential(1)+o;if(n<1){I=Math.E/(n+Math.E);do{r=Math.random();do u=Math.random();while(u===0);r<I?(d=Math.pow(u,1/n),f=Math.exp(-d)):(d=1-Math.log(u),f=Math.pow(d,n-1)),r=Math.random()}while(r>=f);return t*d+o}do if(C=Math.tan(Math.PI*Math.random()),d=Math.sqrt(2*n-1)*C+n-1,d>0)u=Math.random();else continue;while(d<=0||u>(1+C*C)*Math.exp((n-1)*Math.log(d/(n-1))-Math.sqrt(2*n-1)*C));return t*d+o},randomBeta:function(n,t){var o,r,u;return n<=0||t<=0?NaN:(o=this.randomGamma(n),r=this.randomGamma(t),u=o/(o+r),u)},randomChisquare:function(n){return n<=0?NaN:2*this.randomGamma(n*.5)},randomF:function(n,t){var o,r;return n<=0||t<=0?NaN:(o=this.randomChisquare(n),r=this.randomChisquare(t),o*t/(r*n))},randomT:function(n){var t,o;return n<=0?NaN:(t=this.randomNormal(0,1),o=this.randomChisquare(n),t/Math.sqrt(o/n))},randomBinomial:function(n,t){var o,r,u,d,C,I;if(t<0||t>1||n<0)return NaN;if(t===0)return 0;if(t===1)return n;if(n===0)return 0;if(n===1)return Math.random()<t?1:0;if(t>.5)return n-this.randomBinomial(n,1-t);if(n<100){if(o=-1,r=0,u=Math.log(1-t),u===0)return 0;do o+=1,r+=Math.floor(Math.log(Math.random())/u)+1;while(r<n)}else d=1+Math.floor(n*.5),C=n-d+1,o=this.randomBeta(d,C),o>=t?(I=this.randomBinomial(d-1,t/o),o=I):(I=this.randomBinomial(C-1,(t-o)/(1-o)),o=d+I);return o},randomGeometric:function(n){var t;return n<0||n>1?NaN:(t=Math.random(),Math.ceil(Math.log(t)/Math.log(1-n)))},randomPoisson:function(n){var t=Math.exp(-n),o,r=0,u=1,d,C=7/8;if(n<=0)return NaN;if(n<10){do u*=Math.random(),r+=1;while(u>t);o=r-1}else r=Math.floor(C*n),d=this.randomGamma(r),d<n?o=r+this.randomPoisson(n-d):o=this.randomBinomial(r-1,n/d);return o},randomPareto:function(n,t){var o=Math.random();return n<=0||t<=0?NaN:t*Math.pow(1-o,-1/n)},randomHypergeometric:function(n,t,o){var r,u,d=0,C=n+t-o,I=Math.min(n,t),f=I;if(n<1||t<1||o>n+t)return NaN;for(r=o;f*r>0;)u=Math.random(),f-=Math.floor(u+f/(C+r)),r-=1;return d=I-f,n<=t?d:o-d},histogram:function(n,t){var o,r,u,d,C,I,f,A,G,B=[],Z=[],w=0;for(I=t.bins||10,A=t.range||!1,A===!1?(d=Math.min.apply(null,n),C=Math.max.apply(null,n)):(d=A[0],C=A[1]),I>0?f=(C-d)/(I-1):f=0,o=0;o<I;o++)B.push(0),Z.push(d+o*f);for(r=n.length,o=0;o<r;o++)u=Math.floor((n[o]-d)/f),u>=0&&u<I?B[u]+=1:w+=1;if(t.density)for(G=JXG$1.Math.Statistics.sum(B)+w,o=0;o<I;o++)B[o]/=G*f;if(t.cumulative){if(t.density)for(o=0;o<I;o++)B[o]*=f;for(o=1;o<I;o++)B[o]+=B[o-1]}return[B,Z]}};const Statistics=Mat.Statistics;Mat.Plot={checkReal:function(n){var t=!1,o,r,u=n.length;for(o=0;o<u;o++)if(r=n[o].usrCoords,!isNaN(r[1])&&!isNaN(r[2])&&Math.abs(r[0])>Mat.eps){t=!0;break}return t},updateParametricCurveNaive:function(n,t,o,r){var u,d,C=!1,I=(o-t)/r;for(u=0;u<r;u++)d=t+u*I,n.points[u].setCoordinates(Const.COORDS_BY_USER,[n.X(d,C),n.Y(d,C)],!1),n.points[u]._t=d,C=!0;return n},isSegmentOutside:function(n,t,o,r,u){return t<0&&r<0||t>u.canvasHeight&&r>u.canvasHeight||n<0&&o<0||n>u.canvasWidth&&o>u.canvasWidth},isDistOK:function(n,t,o,r){return Math.abs(n)<o&&Math.abs(t)<r&&!isNaN(n+t)},isSegmentDefined:function(n,t,o,r){return!(isNaN(n+t)&&isNaN(o+r))},updateParametricCurveOld:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y=!1,J=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),T=[],L=[],z=[],K=[],P=!1,$=0,ie=function(ne,ee,se){var re,ce=se[1]-ne[1],ue=se[2]-ne[2],ye=ee[0]-ne[1],Se=ee[1]-ne[2],Ce=ye*ye+Se*Se;return Ce>=Mat.eps&&(re=(ce*ye+ue*Se)/Ce,re>0&&(re<=1?(ce-=re*ye,ue-=re*Se):(ce-=ye,ue-=Se))),Mat.hypot(ce,ue)};for(JXG$1.deprecated("Curve.updateParametricCurveOld()"),n.board.updateQuality===n.board.BOARD_QUALITY_LOW?(Z=15,w=10,V=10):(Z=21,w=.7,V=.7),K[0]=o-t,r=1;r<Z;r++)K[r]=K[r-1]*.5;r=1,T[0]=1,L[0]=0,u=t,J.setCoordinates(Const.COORDS_BY_USER,[n.X(u,Y),n.Y(u,Y)],!1),Y=!0,f=J.scrCoords[1],A=J.scrCoords[2],u=o,J.setCoordinates(Const.COORDS_BY_USER,[n.X(u,Y),n.Y(u,Y)],!1),C=J.scrCoords[1],I=J.scrCoords[2],z[0]=[C,I],G=1,B=0,n.points=[],n.points[$++]=new Coords(Const.COORDS_BY_SCREEN,[f,A],n.board,!1);do{for(P=this.isDistOK(C-f,I-A,w,V)||this.isSegmentOutside(f,A,C,I,n.board);B<Z&&(!P||B<6)&&(B<=7||this.isSegmentDefined(f,A,C,I));)T[G]=r,L[G]=B,z[G]=[C,I],G+=1,r=2*r-1,B++,u=t+r*K[B],J.setCoordinates(Const.COORDS_BY_USER,[n.X(u,Y),n.Y(u,Y)],!1,!0),C=J.scrCoords[1],I=J.scrCoords[2],P=this.isDistOK(C-f,I-A,w,V)||this.isSegmentOutside(f,A,C,I,n.board);$>1&&(d=ie(n.points[$-2].scrCoords,[C,I],n.points[$-1].scrCoords),d<.015&&($-=1)),n.points[$]=new Coords(Const.COORDS_BY_SCREEN,[C,I],n.board,!1),n.points[$]._t=u,$+=1,f=C,A=I,G-=1,C=z[G][0],I=z[G][1],B=L[G]+1,r=T[G]*2}while(G>0&&$<5e5);return n.numberPoints=n.points.length,n},_insertPoint_v2:function(n,t,o){var r=!isNaN(this._lastCrds[1]+this._lastCrds[2]),u=!isNaN(t.scrCoords[1]+t.scrCoords[2]),d=n.board.canvasWidth,C=n.board.canvasHeight,I=500;u=u&&t.scrCoords[1]>-500&&t.scrCoords[2]>-500&&t.scrCoords[1]<d+I&&t.scrCoords[2]<C+I,(!u&&r||u&&(!r||Math.abs(t.scrCoords[1]-this._lastCrds[1])>.7||Math.abs(t.scrCoords[2]-this._lastCrds[2])>.7))&&(t._t=o,n.points.push(t),this._lastCrds=t.copy("scrCoords"))},neighborhood_isNaN_v2:function(n,t){var o,r=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),u,d;return u=t+Mat.eps,r.setCoordinates(Const.COORDS_BY_USER,[n.X(u,!0),n.Y(u,!0)],!1),d=r.usrCoords,o=isNaN(d[1]+d[2]),!(!o&&(u=t-Mat.eps,r.setCoordinates(Const.COORDS_BY_USER,[n.X(u,!0),n.Y(u,!0)],!1),d=r.usrCoords,o=isNaN(d[1]+d[2]),!o))},_borderCase:function(n,t,o,r,u,d,C,I){var f,A,G,B=null,Z,w=30,V=!1,Y,J;if(I<=1){if(A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),isNaN(t[1]+t[2])&&!isNaN(r[1]+r[2])&&!this.neighborhood_isNaN_v2(n,u)||isNaN(o[1]+o[2])&&!isNaN(r[1]+r[2])&&!this.neighborhood_isNaN_v2(n,d)||isNaN(r[1]+r[2])&&(!isNaN(t[1]+t[2])||!isNaN(o[1]+o[2]))&&!this.neighborhood_isNaN_v2(n,C))return!1;Z=0;do{if(isNaN(t[1]+t[2])&&!isNaN(r[1]+r[2]))Y=u,J=C;else if(isNaN(o[1]+o[2])&&!isNaN(r[1]+r[2]))Y=d,J=C;else if(isNaN(r[1]+r[2])&&!isNaN(o[1]+o[2]))Y=C,J=d;else if(isNaN(r[1]+r[2])&&!isNaN(t[1]+t[2]))Y=C,J=u;else return!1;f=.5*(Y+J),A.setCoordinates(Const.COORDS_BY_USER,[n.X(f,!0),n.Y(f,!0)],!1),G=A.usrCoords,V=isNaN(G[1]+G[2]),V?Y=f:J=f,++Z}while(V&&Z<w);if(Z<w&&(B=G.slice(),r=G.slice(),J=f),B!==null)return this._insertPoint_v2(n,new Coords(Const.COORDS_BY_USER,B,n.board,!1)),!0}return!1},_plotRecursive_v2:function(n,t,o,r,u,d,C){var I,f,A,G=0,B,Z,w,V=.5,Y=.99,J=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1);if(!(n.numberPoints>65536))return d<this.nanLevel&&this._isUndefined(n,t,o,r,u)?this:d<this.nanLevel&&this._isOutside(t,o,r,u,n.board)?this:(I=(o+u)*.5,J.setCoordinates(Const.COORDS_BY_USER,[n.X(I,!0),n.Y(I,!0)],!1),f=J.scrCoords,this._borderCase(n,t,r,f,o,u,I,d)?this:(A=this._triangleDists(t,r,f),B=d<this.smoothLevel&&A[3]<C,Z=d<=this.jumpLevel&&(isNaN(A[0])||isNaN(A[1])||isNaN(A[2]))||d<this.jumpLevel&&(A[2]>Y*A[0]||A[1]>Y*A[0]||A[0]===1/0||A[1]===1/0||A[2]===1/0),w=d<this.smoothLevel+2&&A[0]<V*(A[1]+A[2]),w&&(G=0,B=!1),--d,Z?this._insertPoint_v2(n,new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],n.board,!1),I):d<=G||B?this._insertPoint_v2(n,J,I):(this._plotRecursive_v2(n,t,o,f,I,d,C),isNaN(J.scrCoords[1]+J.scrCoords[2])||this._insertPoint_v2(n,J,I),this._plotRecursive_v2(n,f,I,r,u,d,C)),this))},updateParametricCurve_v2:function(n,t,o){var r,u,d,C,I=!1,f=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G,B,Z,w,V;return n.board.updateQuality===n.board.BOARD_QUALITY_LOW?(G=JXG$1.evaluate(n.visProp.recursiondepthlow)||13,B=2,this.smoothLevel=G-6,this.jumpLevel=3):(G=JXG$1.evaluate(n.visProp.recursiondepthhigh)||17,B=2,this.smoothLevel=G-9,this.jumpLevel=2),this.nanLevel=G-4,n.points=[],this.xterm==="x"?(w=n.board.getBoundingBox(),Z=(w[2]-w[0])*.3,r=Math.max(t,w[0]-Z),u=Math.min(o,w[2]+Z)):(r=t,u=o),f.setCoordinates(Const.COORDS_BY_USER,[n.X(r,I),n.Y(r,I)],!1),I=!0,A.setCoordinates(Const.COORDS_BY_USER,[n.X(u,I),n.Y(u,I)],!1),V=this._findStartPoint(n,f.scrCoords,r,A.scrCoords,u),f.setCoordinates(Const.COORDS_BY_SCREEN,V[0],!1),r=V[1],V=this._findStartPoint(n,A.scrCoords,u,f.scrCoords,r),A.setCoordinates(Const.COORDS_BY_SCREEN,V[0],!1),u=V[1],this._visibleArea=[r,u],d=f.copy("scrCoords"),C=A.copy("scrCoords"),f._t=r,n.points.push(f),this._lastCrds=f.copy("scrCoords"),this._plotRecursive_v2(n,d,r,C,u,G,B),A._t=u,n.points.push(A),n.numberPoints=n.points.length,n},_insertLimesPoint:function(n,t,o,r,u){var d,C,I;Math.abs(this._lastUsrCrds[1])===1/0&&Math.abs(u.left_x)===1/0||Math.abs(this._lastUsrCrds[2])===1/0&&Math.abs(u.left_y)===1/0||(d=new Coords(Const.COORDS_BY_USER,[u.left_x,u.left_y],n.board),d._t=o,n.points.push(d),!isNaN(u.left_x)&&!isNaN(u.left_y)&&!isNaN(u.right_x)&&!isNaN(u.right_y)&&(Math.abs(u.left_x-u.right_x)>Mat.eps||Math.abs(u.left_y-u.right_y)>Mat.eps)&&(C=new Coords(Const.COORDS_BY_SCREEN,t,n.board),C._t=o,n.points.push(C)),I=new Coords(Const.COORDS_BY_USER,[u.right_x,u.right_y],n.board),I._t=o,n.points.push(I),this._lastScrCrds=I.copy("scrCoords"),this._lastUsrCrds=I.copy("usrCoords"))},_insertPoint:function(n,t,o,r,u){var d=!isNaN(this._lastScrCrds[1]+this._lastScrCrds[2]),C=!isNaN(t[1]+t[2]),I=n.board.canvasWidth,f=n.board.canvasHeight,A,G=.8,B=500;if(JXG$1.exists(u)){this._insertLimesPoint(n,t,o,r,u);return}C=C&&t[1]>-500&&t[2]>-500&&t[1]<I+B&&t[2]<f+B,!(!d&&!C)&&(C&&d&&Math.abs(t[1]-this._lastScrCrds[1])<G&&Math.abs(t[2]-this._lastScrCrds[2])<G||Math.abs(t[1])===1/0&&Math.abs(this._lastUsrCrds[1])===1/0||Math.abs(t[2])===1/0&&Math.abs(this._lastUsrCrds[2])===1/0||(A=new Coords(Const.COORDS_BY_SCREEN,t,n.board),A._t=o,n.points.push(A),this._lastScrCrds=A.copy("scrCoords"),this._lastUsrCrds=A.copy("usrCoords")))},_triangleDists:function(n,t,o){var r,u,d,C,I;return r=[n[0]*t[0],(n[1]+t[1])*.5,(n[2]+t[2])*.5],u=Geometry.distance(n,t,3),d=Geometry.distance(n,o,3),C=Geometry.distance(o,t,3),I=Geometry.distance(o,r,3),[u,d,C,I]},_isUndefined:function(n,t,o,r,u){var d,C,I;if(!isNaN(t[1]+t[2])||!isNaN(r[1]+r[2]))return!1;for(I=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),C=0;C<20;++C)if(d=o+Math.random()*(u-o),I.setCoordinates(Const.COORDS_BY_USER,[n.X(d,!0),n.Y(d,!0)],!1),!isNaN(I.scrCoords[0]+I.scrCoords[1]+I.scrCoords[2]))return!1;return!0},_isOutside:function(n,t,o,r,u){var d=500,C=u.canvasWidth,I=u.canvasHeight;return n[1]<-500&&o[1]<-500||n[2]<-500&&o[2]<-500||n[1]>C+d&&o[1]>C+d||n[2]>I+d&&o[2]>I+d},_isOutsidePoint:function(n,t){var o=500,r=t.canvasWidth,u=t.canvasHeight;return n[1]<-500||n[2]<-500||n[1]>r+o||n[2]>u+o},_findStartPoint:function(n,t,o,r,u){return[t,o]},_getBorderPos:function(n,t,o,r,u,d,C){var I,f,A,G,B=30,Z=!1,w,V;if(f=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G=0,isNaN(o[1]+o[2])&&!isNaN(u[1]+u[2]))V=t,w=r;else if(isNaN(C[1]+C[2])&&!isNaN(u[1]+u[2]))V=d,w=r;else if(isNaN(u[1]+u[2])&&!isNaN(C[1]+C[2]))V=r,w=d;else if(isNaN(u[1]+u[2])&&!isNaN(o[1]+o[2]))V=r,w=t;else return!1;do I=.5*(w+V),f.setCoordinates(Const.COORDS_BY_USER,[n.X(I,!0),n.Y(I,!0)],!1),A=f.usrCoords,Z=isNaN(A[1]+A[2]),Z?V=I:w=I,++G;while(G<B&&Math.abs(w-V)>Mat.eps);return I},_getCuspPos:function(n,t,o){var r=[n.X(t,!0),n.Y(t,!0)],u=[n.X(o,!0),n.Y(o,!0)],d=function(C){var I=[n.X(C,!0),n.Y(C,!0)];return-(Mat.hypot(r[0]-I[0],r[1]-I[1])+Mat.hypot(u[0]-I[0],u[1]-I[1]))};return Numerics.fminbr(d,[t,o],n)},_getJumpPos:function(n,t,o){var r=function(u){var d=Mat.eps*Mat.eps,C=[n.X(u,!0),n.Y(u,!0)],I=[n.X(u+d,!0),n.Y(u+d,!0)];return-Math.abs((I[1]-C[1])/(I[0]-C[0]))};return Numerics.fminbr(r,[t,o],n)},_getLimits:function(n,t){var o,r=2/(n.maxX()-n.minX()),u,d,C,I;return o=Extrapolate.limit(t,-r,n.X),u=o[0],o[1]==="infinite"&&(u=Math.sign(u)*(1/0)),o=Extrapolate.limit(t,-r,n.Y),C=o[0],o[1]==="infinite"&&(C=Math.sign(C)*(1/0)),o=Extrapolate.limit(t,r,n.X),d=o[0],o[1]==="infinite"&&(d=Math.sign(d)*(1/0)),o=Extrapolate.limit(t,r,n.Y),I=o[0],o[1]==="infinite"&&(I=Math.sign(I)*(1/0)),{left_x:u,left_y:C,right_x:d,right_y:I,t}},_getLimes:function(n,t,o,r,u,d,C,I,f){var A;return I==="border"?A=this._getBorderPos(n,t,o,r,u,d,C):I==="cusp"?A=this._getCuspPos(n,t,d):I==="jump"&&(A=this._getJumpPos(n,t,d)),this._getLimits(n,A)},_plotNonRecursive:function(n,t,o,r,u,d){var C,I,f,A=0,G=null,B,Z,w=!1,V="",Y,J,T,L,z,K=[],P=0,$;for(T=n.board.origin.scrCoords,K[P++]=[t,o,r,u,d,1/0];P>0;){if($=K[--P],t=$[0],o=$[1],r=$[2],u=$[3],L=$[4],z=$[5],w=!1,V="",G=null,n.points.length>65536)return;L<this.nanLevel&&(this._isUndefined(n,t,o,r,u)||this._isOutside(t,o,r,u,n.board))||(C=(o+u)*.5,Y=n.X(C,!0),J=n.Y(C,!0),I=[1,T[1]+Y*n.board.unitX,T[2]-J*n.board.unitY],f=this._triangleDists(t,r,I),B=isNaN(t[1]+t[2]),Z=isNaN(r[1]+r[2]),B&&!Z||!B&&Z?V="border":f[0]>.66*z||f[0]<this.cusp_threshold*(f[1]+f[2])||f[1]>5*f[2]||f[2]>5*f[1]?V="cusp":(f[2]>this.jump_threshold*f[0]||f[1]>this.jump_threshold*f[0]||f[0]===1/0||f[1]===1/0||f[2]===1/0)&&(V="jump"),w=V===""&&L<this.smoothLevel&&f[3]<this.smooth_threshold,L<this.testLevel&&!w&&(V===""?w=!0:G=this._getLimes(n,o,t,C,I,u,r,V,L)),G!==null?(I=[1,NaN,NaN],this._insertPoint(n,I,C,L,G)):L<=A||w?this._insertPoint(n,I,C,L,null):(K[P++]=[I,C,r,u,L-1,f[0]],K[P++]=[t,o,I,C,L-1,f[0]]))}return this},updateParametricCurve_v3:function(n,t,o){var r,u,d,C,I=!1,f=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G,B,Z,w;return n.board.updateQuality===n.board.BOARD_QUALITY_LOW?G=JXG$1.evaluate(n.visProp.recursiondepthlow)||14:G=JXG$1.evaluate(n.visProp.recursiondepthhigh)||17,this.smoothLevel=7,this.nanLevel=G-4,this.testLevel=4,this.cusp_threshold=.5,this.jump_threshold=.99,this.smooth_threshold=2,n.points=[],n.xterm==="x"?(Z=n.board.getBoundingBox(),B=(Z[2]-Z[0])*.3,r=Math.max(t,Z[0]-B),u=Math.min(o,Z[2]+B)):(r=t,u=o),f.setCoordinates(Const.COORDS_BY_USER,[n.X(r,I),n.Y(r,I)],!1),I=!0,A.setCoordinates(Const.COORDS_BY_USER,[n.X(u,I),n.Y(u,I)],!1),w=this._findStartPoint(n,f.scrCoords,r,A.scrCoords,u),f.setCoordinates(Const.COORDS_BY_SCREEN,w[0],!1),r=w[1],w=this._findStartPoint(n,A.scrCoords,u,f.scrCoords,r),A.setCoordinates(Const.COORDS_BY_SCREEN,w[0],!1),u=w[1],this._visibleArea=[r,u],d=f.copy("scrCoords"),C=A.copy("scrCoords"),f._t=r,n.points.push(f),this._lastScrCrds=f.copy("scrCoords"),this._lastUsrCrds=f.copy("usrCoords"),this._plotNonRecursive(n,d,r,C,u,G),A._t=u,n.points.push(A),n.numberPoints=n.points.length,n},_criticalInterval:function(n,t,o){var r,u,d,C,I,f,A=!1,G,B=-1/0,Z=!1,w=!1,V=0,Y=[],J=[],T=[];for(G=Statistics.abs(n),C=Statistics.median(G),C<1e-7?(C=1e-7,Z=!0):C*=this.criticalThreshold,r=0;r<t;r++)G[r]>C?(T.push({i:r,v:n[r],group:V}),B=r,A||(A=!0)):A&&r>B+4&&(T.length>0&&Y.push(T.slice(0)),T=[],A=!1,V++);for(A&&T.length>1&&Y.push(T.slice(0)),Z&&Y.length===0&&(w=!0),u=0;u<Y.length;u++)if(J[u]="point",d=Y[u].length,!(d<64)){for(f=0,I=Math.sign(Y[u][0].v),r=1;r<d;r++)Math.sign(Y[u][r].v)!==I&&(f++,I=Math.sign(Y[u][r].v));f*6>d&&(J[u]="interval")}return{smooth:w,groups:Y,types:J}},Component:function(){this.left_isNaN=!1,this.right_isNaN=!1,this.left_t=null,this.right_t=null,this.t_values=[],this.x_values=[],this.y_values=[],this.len=0},findComponents:function(n,t,o,r){var u,d,C,I,f,A=[],G,B=0,Z=0,w=0,V=!1,Y=!1;for(C=(o-t)/r,A[B]=new this.Component,G=A[B],u=0,d=t;u<=r;u++,d+=C)I=n.X(d,Y),f=n.Y(d,Y),isNaN(I)||isNaN(f)?(w++,w>1&&V&&(G.right_isNaN=!0,G.right_t=d-C,G.len=Z,V=!1,B++,A[B]=new this.Component,G=A[B],w=0)):(V||(V=!0,Z=0,w>0&&(G.left_t=d-C,G.left_isNaN=!0)),w=0,G.t_values[Z]=d,G.x_values[Z]=I,G.y_values[Z]=f,Z++),u===0&&(Y=!0);return V?G.len=Z:A.pop(),A},getPointType:function(n,t,o,r,u,d,C){var I=u[0],f=d[0],A=r.length,G={idx:t,t:o,x:I[t],y:f[t],type:"other"};return t<5?(G.type="borderleft",G.idx=0,G.t=r[0],G.x=I[0],G.y=f[0],G):(t>C-6&&(G.type="borderright",G.idx=A-1,G.t=r[A-1],G.x=I[A-1],G.y=f[A-1]),G)},newtonApprox:function(n,t,o,r,u){var d,C=0;for(d=r;d>0;d--)C=(C+u[d][n])*(t-(d-1)*o)/d;return C+u[0][n]},thiele:function(n,t,o,r,u){var d,C=0;for(d=u;d>1;d--)C=(n-o[r+d])/(t[d][r+1]-t[d-2][r+1]+C);return t[0][r+1]+(n-o[r+1])/(t[1][r+1]+C)},differenceMethodExperiments:function(n,t){var o,r,u,d,C=n.t_values,I=n.x_values,f=n.y_values,A=[],G=[],B=[],Z=[],w=[],V=[],Y=[],J=[],T,L,z=0,K,P,$,ie,ne,ee=[];for(T=C[1]-C[0],w.push([]),V.push([]),Y.push([]),J.push([]),u=f.length,o=0;o<u;o++)w[0][o]=I[o],V[0][o]=f[o],Y[0][o]=I[o],J[0][o]=f[o];for(w.push([]),V.push([]),Y.push([]),J.push([]),L=T,u=f.length-1,o=0;o<u;o++)A[o]=I[o+1]-I[o],G[o]=f[o+1]-f[o],B[o]=A[o],Z[o]=G[o],w[1][o]=A[o],V[1][o]=G[o],Y[1][o]=L/A[o],J[1][o]=L/G[o];for(u--,d=Math.min(8,f.length-1),r=1;r<d;r++){for(w.push([]),V.push([]),Y.push([]),J.push([]),L*=T,o=0;o<u;o++)A[o]=A[o+1]-A[o],G[o]=G[o+1]-G[o],w[r+1][o]=A[o],V[r+1][o]=G[o],Y[r+1][o]=L/(Y[r][o+1]-Y[r][o])+Y[r-1][o+1],J[r+1][o]=L/(J[r][o+1]-J[r][o])+J[r-1][o+1];if(ne=this._criticalPoints(G,u,r),ne===!1){console.log("Polynomial of degree",r),ne=[];break}if(ne.length>0&&(z++,z>1&&r%2===0))break;u--}for(o=0;o<ne.length;o++){for(P=-1/0,$=0;$<ne[o].length;$++)ie=Math.abs(ne[o][$].v),ie>P&&(P=ie,K=$);K=Math.floor(ne[o][K].i+r/2),ee.push(this.getPointType(t,K,C,I,f,B,Z,u+1))}return[ee,w,V,Y,J]},getCenterOfCriticalInterval:function(n,t,o){var r,u,d,C,I=0,f=0,A=o[1]-o[0],G,B=[];for(r=-1/0,B=[],u=0;u<n.length;u++)C=Math.abs(n[u].v),C>r?(B=[u],r=C,d=u):r===C&&B.push(u);if(B.length>0&&(G=B.reduce(function(Z,w){return Z+w},0)/B.length,d=Math.floor(G),G+=n[0].i),r<1/0){for(u=0;u<n.length;u++)I+=Math.abs(n[u].v)*n[u].i,f+=Math.abs(n[u].v);G=I/f}return G+=t/2,[n[d].i+t/2,G,o[Math.floor(G)]+A*(G-Math.floor(G))]},differenceMethod:function(n,t){var o,r,u,d,C=n.t_values,I=n.x_values,f=n.y_values,A=[],G=[],B=0,Z=-1,w=-1,V,Y,J,T,L,z=[],K,P=[];for(u=f.length,A.push(new Float64Array(I)),G.push(new Float64Array(f)),u--,d=Math.min(12,u),r=0;r<d&&(A.push(new Float64Array(u)),G.push(new Float64Array(u)),A[r+1]=A[r].map(function($,ie,ne){return ne[ie+1]-$}),G[r+1]=G[r].map(function($,ie,ne){return ne[ie+1]-$}),T=this._criticalInterval(G[r+1],u,r),T.smooth===!0&&(w=r,z=[]),J=this._criticalInterval(A[r+1],u,r),Z===-1&&J.smooth===!0&&(Z=r),!(w>=0));r++){if(T.groups.length>0&&(B++,B>2&&(r+1)%2===0)){z=T.groups,K=T.types;break}u--}for(o=0;o<z.length;o++)K[o]!=="interval"&&(Y=this.getCenterOfCriticalInterval(z[o],r+1,C),V=T[0],V=Math.floor(Y[1]),L=Y[2],P.push(this.getPointType(t,V,L,C,A,G,u+1)));return[P,A,G,Z,w]},_insertPoint_v4:function(n,t,o,r){var u,d=null,C,I,f=.8;n.points.length>0&&(d=n.points[n.points.length-1].scrCoords),u=new Coords(Const.COORDS_BY_USER,t,n.board),!(d!==null&&(C=u.scrCoords[1]-d[1],I=u.scrCoords[2]-d[2],C*C+I*I<f*f))&&(u._t=o,n.points.push(u))},getInterval:function(n,t,o){var r,u;return Interval.disable(),r=Interval.Interval(t,o),n.board.mathLib=Interval,n.board.mathLibJXG=Interval,u=n.Y(r,!0),n.board.mathLib=Math,n.board.mathLibJXG=JXG$1.Math,u},sign:function(n){return n<0?-1:n>0?1:0},handleBorder:function(n,t,o,r,u){var d=o.idx,C,I,f,A=32,G,B,Z,w,V,Y,J,T,L;if(L=t.t_values[1]-t.t_values[0],o.type==="borderleft"?(C=t.left_isNaN?t.left_t:o.t-L,I=C,f=I+L):o.type==="borderright"?(C=t.right_isNaN?t.right_t:o.t+L,f=C,I=f-L):console.log("No bordercase!!!"),J=this.findComponents(n,I,f,A),J.length!==0){for(o.type==="borderleft"&&(I=J[0].left_t,f=J[0].t_values[0],L=J[0].t_values[1]-J[0].t_values[0],I=I===null?f-L:I,C=I,G=this.getInterval(n,I,f),JXG$1.isObject(G)&&(w=G.lo,V=G.hi,B=n.X(C,!0),Z=u[1][d]<0?V:w,this._insertPoint_v4(n,[1,B,Z],C))),T=J[0].t_values.length,Y=0;Y<T;Y++)C=J[0].t_values[Y],B=J[0].x_values[Y],Z=J[0].y_values[Y],this._insertPoint_v4(n,[1,B,Z],C);o.type==="borderright"&&(I=J[0].t_values[T-1],f=J[0].right_t,L=J[0].t_values[1]-J[0].t_values[0],f=f===null?I+L:f,C=f,G=this.getInterval(n,I,f),JXG$1.isObject(G)&&(w=G.lo,V=G.hi,B=n.X(C,!0),Z=u[1][d]>0?V:w,this._insertPoint_v4(n,[1,B,Z],C)))}},_seconditeration_v4:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z,w,V,Y,J,T;for(C=t.t_values[o.idx-2],I=t.t_values[o.idx+2],A=this.findComponents(n,C,I,64),B=0;B<A.length;B++){for(G=A[B],f=this.differenceMethod(G,n),Z=f[0],V=f[1],Y=f[2],J=0,w=0;w<=Z.length;w++){for(w===Z.length?T=G.len:T=Z[w].idx,d=J;d<T;d++)!isNaN(G.x_values[d])&&!isNaN(G.y_values[d])&&this._insertPoint_v4(n,[1,G.x_values[d],G.y_values[d]],G.t_values[d]);w<Z.length&&(this.handleSingularity(n,G,Z[w],V,Y),J=Z[w].idx+1)}T=G.len,B<A.length-1&&this._insertPoint_v4(n,[1,NaN,NaN],G.right_t)}return this},_recurse_v4:function(n,t,o,r,u,d,C,I){var f=2,A=(t+o)*.5,G=n.X(A,!0),B=n.Y(A,!0),Z,w;if(I===0){this._insertPoint_v4(n,[1,NaN,NaN],A);return}Z=(G-r)*n.board.unitX,w=(B-u)*n.board.unitY,Mat.hypot(Z,w)>f?this._recurse_v4(n,t,A,r,u,G,B,I-1):this._insertPoint_v4(n,[1,G,B],A),Z=(G-d)*n.board.unitX,w=(B-C)*n.board.unitY,Mat.hypot(Z,w)>f?this._recurse_v4(n,A,o,G,B,d,C,I-1):this._insertPoint_v4(n,[1,G,B],A)},handleSingularity:function(n,t,o,r,u){var d=o.idx,C,I,f,A,G,B,Z,w,V,Y,J,T=100,L=5,z=3;C=o.t,console.log("HandleSingularity at t =",C),I=t.t_values[d-L],f=t.t_values[d+L],A=this.getInterval(n,I,f),JXG$1.isObject(A)?(w=A.lo,V=A.hi):u[0][d-1]<u[0][d+1]?(w=u[0][d-1],V=u[0][d+1]):(w=u[0][d+1],V=u[0][d-1]),Z=n.X(C,!0),Y=(u[0][d-z]-u[0][d-L])/(t.t_values[d-z]-t.t_values[d-L]),J=(u[0][d+z]-u[0][d+L])/(t.t_values[d+z]-t.t_values[d+L]),console.log(":::",Y,J),Y<-100?(this._insertPoint_v4(n,[1,Z,w],C,!0),J<=T&&this._insertPoint_v4(n,[1,NaN,NaN],C)):Y>T?(this._insertPoint_v4(n,[1,Z,V],C),J>=-100&&this._insertPoint_v4(n,[1,NaN,NaN],C)):(w===-1/0&&(this._insertPoint_v4(n,[1,Z,w],C,!0),this._insertPoint_v4(n,[1,NaN,NaN],C)),V===1/0&&(this._insertPoint_v4(n,[1,NaN,NaN],C),this._insertPoint_v4(n,[1,Z,V],C,!0)),o.t<t.t_values[d]?(G=d-1,B=d):(G=d,B=d+1),I=t.t_values[G],f=t.t_values[B],this._recurse_v4(n,I,f,r[0][G],u[0][G],r[0][B],u[0][B],10)),J<-100?this._insertPoint_v4(n,[1,Z,V],C):J>T&&this._insertPoint_v4(n,[1,Z,w],C)},steps:1021,criticalThreshold:1e3,plot_v4:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z=(o-t)/r,K=function(ie){return n.Y(ie,!0)},P=function(ie){return-n.Y(ie,!0)},$=z*.5;for(C=this.findComponents(n,t,o,r),I=0;I<C.length;I++){for(f=C[I],Z=this.differenceMethod(f,n),A=Z[0],w=Z[1],V=Z[2],(A.length===0||A[0].type!=="borderleft")&&A.unshift({idx:0,t:f.t_values[0],x:f.x_values[0],y:f.y_values[0],type:"borderleft"}),A[A.length-1].type!=="borderright"&&(d=f.t_values.length,A.push({idx:d-1,t:f.t_values[d-1],x:f.x_values[d-1],y:f.y_values[d-1],type:"borderright"})),B=0,G=0;G<=A.length;G++){for(G===A.length?d=f.len:d=A[G].idx-1,u=B;u<d-2;u++)this._insertPoint_v4(n,[1,f.x_values[u],f.y_values[u]],f.t_values[u]),u>=B+3&&u<d-3&&V.length>3&&Math.abs(V[2][u])>.2*Math.abs(V[0][u])&&(Y=f.t_values[u],$=z*.25,L=this.getInterval(n,Y,Y+z),JXG$1.isObject(L)?V[2][u]>0?this._insertPoint_v4(n,[1,Y+$,L.lo],Y+$):this._insertPoint_v4(n,[1,Y+z-$,L.hi],Y+z-$):(J=Numerics.fminbr(K,[Y,Y+z]),T=Numerics.fminbr(P,[Y,Y+z]),J<T?(this._insertPoint_v4(n,[1,n.X(J,!0),n.Y(J,!0)],J),this._insertPoint_v4(n,[1,n.X(T,!0),n.Y(T,!0)],T)):(this._insertPoint_v4(n,[1,n.X(T,!0),n.Y(T,!0)],T),this._insertPoint_v4(n,[1,n.X(J,!0),n.Y(J,!0)],J))));G<A.length&&(u=A[G].idx,A[G].type==="borderleft"||A[G].type==="borderright"?this.handleBorder(n,f,A[G],w,V):this._seconditeration_v4(n,f,A[G],w,V),B=A[G].idx+1+1)}d=f.len,I<C.length-1&&this._insertPoint_v4(n,[1,NaN,NaN],f.right_t)}},updateParametricCurve_v4:function(n,t,o){var r,u,d,C;n.xterm==="x"?(C=n.board.getBoundingBox(),d=(C[2]-C[0])*.3,r=Math.max(t,C[0]-d),u=Math.min(o,C[2]+d)):(r=t,u=o),n.points=[],this.plot_v4(n,r,u,this.steps),n.numberPoints=n.points.length},updateParametricCurve:function(n,t,o){return this.updateParametricCurve_v2(n,t,o)}};const Plot=Mat.Plot;Mat.ImplicitPlot=function(n,t,o,r,u){var d={resolution_out:5,resolution_in:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0,unitX:10,unitY:10};this.config=JXG$1.merge(d,t),this.f=o,this.dfx=null,this.dfy=null,JXG$1.isFunction(r)?this.dfx=r:this.dfx=function(C,I){var f=Mat.eps*Mat.eps;return(this.f(C+f,I)-this.f(C-f,I))*.5/f},JXG$1.isFunction(u)?this.dfy=u:this.dfy=function(C,I){var f=Mat.eps*Mat.eps;return(this.f(C,I+f)-this.f(C,I-f))*.5/f},this.bbox=n,this.qdt=new Quadtree(20,5,n),this.components=[]};JXG$1.extend(Mat.ImplicitPlot.prototype,{plot:function(){var n,t,o,r,u,d,C=[],I=[],f=[],A=0,G,B=this,Z=function(J){return B.f(n,J)},w=function(J){return-B.f(n,J)},V=function(J){return B.f(J,t)},Y=function(J){return-B.f(J,t)};for(o=Math.min(this.bbox[0],this.bbox[2])-Mat.eps,r=Math.max(this.bbox[0],this.bbox[2]),u=Math.min(this.bbox[1],this.bbox[3])+Mat.eps,d=Math.max(this.bbox[1],this.bbox[3]),G=this.config.resolution_out/this.config.unitX,G*=1+Mat.eps,n=o;n<r;n+=G)f=this.searchLine(Z,w,n,[u,d],"vertical",A,C,I),f!==!1&&(C=f[0],I=f[1],A=f[2]);for(G=this.config.resolution_out/this.config.unitY,G*=1+Mat.eps,t=u;t<d;t+=G)f=this.searchLine(V,Y,t,[o,r],"horizontal",A,C,I),f!==!1&&(C=f[0],I=f[1],A=f[2]);return[C,I,A]},searchLine:function(n,t,o,r,u,d,C,I){var f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie=this.config.tol_u0,ne=r[0],ee=r[1];if(f=Numerics.fminbr(n,[ne,ee]),Z=n(f),A=Numerics.fminbr(t,[ne,ee]),w=n(A),Z<ie&&w>-ie){if(V=f,f=Math.min(V,A),A=Math.max(V,A),G=Numerics.fzero(n,[f,A]),B=n(G),Math.abs(B)>Math.max((w-Z)*Mat.eps,.001))return!1;if(u==="vertical"?(T=[1,o,G],$=this.config.resolution_in/this.config.unitY):(T=[1,G,o],$=this.config.resolution_in/this.config.unitX),$*=1+Mat.eps,J=this.curveContainsPoint(T,C,I,$*2,this.config.qdt_box),!J){if(K=this.traceComponent(T,1),K.length>0){for(d>0&&(C.push(NaN),I.push(NaN)),P=C.length,z=K[0].length,L=1;L<z;L++)this.qdt.insertItem({xlb:Math.min(K[0][L-1],K[0][L]),xub:Math.max(K[0][L-1],K[0][L]),ylb:Math.min(K[1][L-1],K[1][L]),yub:Math.max(K[1][L-1],K[1][L]),idx1:P+L-1,idx2:P+L,comp:d});d++,JXG$1.concat(C,K[0]),JXG$1.concat(I,K[1])}}return Y=G-$*.01,Y-ne>$&&(K=this.searchLine(n,t,o,[ne,Y],u,d,C,I),K!==!1&&(C=K[0],I=K[1],d=K[2])),Y=G+$*.01,ee-Y>$&&(K=this.searchLine(n,t,o,[Y,ee],u,d,C,I),K!==!1&&(C=K[0],I=K[1],d=K[2])),[C,I,d]}return!1},curveContainsPoint:function(n,t,o,r,u){var d,C,I,f,A=n[1],G=n[2];for(I=this.qdt.find([A-u,G+u,A+u,G-u]),C=I.length,d=0;d<C;d++)if(f=Geometry.distPointSegment(n,[1,t[I[d].idx1],o[I[d].idx1]],[1,t[I[d].idx2],o[I[d].idx2]]),f<r)return!0;return!1},traceComponent:function(n){var t=[],o=[],r=[];return r=this.tracing(n,1),r.length===0||(t=r[0],o=r[1]),r[2]||(r=this.tracing(n,-1),r.length===0||(t=r[0].reverse().concat(t.slice(1)),o=r[1].reverse().concat(o.slice(1)))),t.length<6&&(t.push(t[t.length-1]),o.push(o[o.length-1])),[t,o]},tracing:function(n,t){var o=[],r=[],u=[],d,C,I,f,A,G,B=0,Z=0,w=!1,V,Y,J,T,L,z,K,P,$,ie=!1,ne=!1,ee=this.config.kappa_0,se=this.config.delta_0,re=this.config.alpha_0,ce=this.config.h_initial,ue=this.config.max_steps,ye=t,Se=[],Ce=[],Ze=[],Be,xe,ge,de;if(o=n.slice(1),Se.push(o[0]),Ce.push(o[1]),d=this.tangent(o),d===!1)return[];this.dfx(o[0],o[1]),this.dfy(o[0],o[1]);do{if(d=this.tangent(o),d===!1){o=r.slice(),Se.push(o[0]),Ce.push(o[1]);break}if(Se.length===1)I=d.slice();else if(Se.length===2)Ze.push(Se.length-1);else if(ie&&Se.length>2&&!ne){if(T=Geometry.distPointSegment([1,o[0],o[1]],[1,Se[0],Ce[0]],[1,Se[1],Ce[1]]),T<this.config.loop_dist*ce&&Mat.innerProduct(d,I,2)>this.config.loop_dir){o=n.slice(1),Se.push(o[0]),Ce.push(o[1]),w=!0;break}if(this.config.loop_detection){for(Be=Se.length-1,xe=Math.floor(Mat.log2(Be)),ge=0;ge<=xe&&(T=Geometry.distPointSegment([1,o[0],o[1]],[1,Se[Ze[ge]-1],Ce[Ze[ge]-1]],[1,Se[Ze[ge]],Ce[Ze[ge]]]),!(T<this.config.loop_dist*ce&&(C=this.tangent([Se[Ze[ge]],Ce[Ze[ge]]]),Mat.innerProduct(d,C,2)>this.config.loop_dir)));ge++);if(ge<=xe){w=!0;break}for(xe=1,de=0,ge=0;ge<100&&(Be+1)%xe===0;ge++)xe*=2,de++;Ze[de]=Be}}r[0]=o[0]+ce*ye*d[0],r[1]=o[1]+ce*ye*d[1],Z=0;do f=[this.dfx(r[0],r[1]),this.dfy(r[0],r[1])],J=f[0]*f[0]+f[1]*f[1],A=this.f(r[0],r[1])/J,u[0]=r[0]-f[0]*A,u[1]=r[1]-f[1]*A,Z===0?V=Math.abs(A)*Math.sqrt(J):Z===1&&(Y=Math.abs(A)*Math.sqrt(J)),r[0]=u[0],r[1]=u[1],Z++;while(Z<20&&Math.abs(this.f(r[0],r[1]))>this.config.tol_newton);if(K=V,Z>1?z=Y/V:z=0,C=this.tangent(r),G=Mat.innerProduct(d,C,2),G=Math.max(-1,Math.min(1,G)),P=Math.acos(G),ne=!1,L=Geometry.distance(o,r,2),L<this.config.tol_progress){o=r.slice(),Se.push(o[0]),Ce.push(o[1]);break}else if(G<0&&!(ce>this.config.h_critical))if(ne=!0,this.isBifurcation(o,this.config.tol_cusp))ye*=-1,P=0;else{o=r.slice(),Se.push(o[0]),Ce.push(o[1]);break}if(!ne&&($=Math.max(Math.sqrt(z/ee),Math.sqrt(K/se),P/re),isNaN($)&&($=1),$=Math.max(Math.min($,2),.5),ce/=$,ce=Math.min(this.config.h_max,ce),$>=2)){if(B++,B>=3*ue)break;ie=!1;continue}o=r.slice(),Se.push(o[0]),Ce.push(o[1]),ie=!0,B++}while(B<ue&&o[0]>=this.bbox[0]&&o[1]<=this.bbox[1]&&o[0]<=this.bbox[2]&&o[1]>=this.bbox[3]);return[Se,Ce,w]},isBifurcation:function(n,t){var o=Mat.eps*Mat.eps*100,r,u,d,C,I,f,A,G,B,Z;return r=n[0],u=n[1],d=.5*(this.dfx(r+o,u)-this.dfx(r-o,u))/o,C=.5*(this.dfx(r,u+o)-this.dfx(r,u-o))/o,I=.5*(this.dfy(r+o,u)-this.dfy(r-o,u))/o,f=.5*(this.dfy(r,u+o)-this.dfy(r,u-o))/o,A=d+f,Z=A*A-4*(d*f-C*I),G=.5*(A+Math.sqrt(Z)),B=.5*(A-Math.sqrt(Z)),Math.abs(G)>t&&Math.abs(B)>t},handleCriticalPoint:function(n,t,o,r){var u=Math.atan2(r*t[1],r*t[0]),d=function(A){var G=n[0]+o*Math.cos(A),B=n[1]+o*Math.sin(A);return this.f(G,B)},C,I,f;return f=Numerics.root(d,u),C=n[0]+o*Math.cos(f),I=n[1]+o*Math.sin(f),[C,I]},updateA:function(n,t,o){var r=[o[0]-t[0],o[1]-t[1]],u=this.f(o[0],o[1])-this.f(t[0],t[1]),d,C;return C=r[0]*r[0]+r[1]*r[1],d=u-(n[0]*r[0]+n[1]*r[1]),d/=C,n[0]+=d*r[0],n[1]+=d*r[1],n},tangent_A:function(n){var t=[-n[1],n[0]],o=Mat.norm(t,2);return o<Mat.eps,[t[0]/o,t[1]/o]},tangent:function(n){var t=[-this.dfy(n[0],n[1]),this.dfx(n[0],n[1])],o=Mat.norm(t,2);return o<Mat.eps*Mat.eps?!1:[t[0]/o,t[1]/o]}});const ImplicitPlot=Mat.ImplicitPlot;Mat.Metapost={MP_ENDPOINT:0,MP_EXPLICIT:1,MP_GIVEN:2,MP_CURL:3,MP_OPEN:4,MP_END_CYCLE:5,UNITY:1,FRACTION_ONE:1,FRACTION_THREE:3,ONE_EIGHTY_DEG:Math.PI,THREE_SIXTY_DEG:2*Math.PI,EPS_SQ:1e-5*1e-5,make_choices:function(n){var t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J=!0;I=n[0];do{if(!I)break;C=I.next,I.rtype>this.MP_EXPLICIT&&(I.x-C.x)*(I.x-C.x)+(I.y-C.y)*(I.y-C.y)<this.EPS_SQ&&(I.rtype=this.MP_EXPLICIT,I.ltype===this.MP_OPEN&&(I.ltype=this.MP_CURL,I.set_left_curl(this.UNITY)),C.ltype=this.MP_EXPLICIT,C.rtype===this.MP_OPEN&&(C.rtype=this.MP_CURL,C.set_right_curl(this.UNITY)),I.rx=I.x,C.lx=I.x,I.ry=I.y,C.ly=I.y),I=C}while(I!==n[0]);for(o=n[0];J&&!(o.ltype!==this.MP_OPEN||o.rtype!==this.MP_OPEN);)if(o=o.next,o===n[0]){o.ltype=this.MP_END_CYCLE;break}for(I=o;J&&I;){if(C=I.next,I.rtype>=this.MP_GIVEN){for(;C.ltype===this.MP_OPEN&&C.rtype===this.MP_OPEN;)C=C.next;for(r=0,f=I,d=n.length,Z=[],w=[],V=[],Y=[null];J&&(G=f.next,Z.push(G.x-f.x),w.push(G.y-f.y),V.push(this.mp_pyth_add(Z[r],w[r])),r>0&&(B=w[r-1]/V[r-1],A=Z[r-1]/V[r-1],Y.push(Math.atan2(w[r]*A-Z[r]*B,Z[r]*A+w[r]*B))),r++,f=G,f===C&&(d=r),!(r>=d&&f.ltype!==this.MP_END_CYCLE)););r===d?Y.push(0):Y.push(Y[1]),C.ltype===this.MP_OPEN&&(u=C.rx-C.x,t=C.ry-C.y,u*u+t*t<this.EPS_SQ?(C.ltype=this.MP_CURL,C.set_left_curl(this.UNITY)):(C.ltype=this.MP_GIVEN,C.set_left_given(Math.atan2(t,u)))),I.rtype===this.MP_OPEN&&I.ltype===this.MP_EXPLICIT&&(u=I.x-I.lx,t=I.y-I.ly,u*u+t*t<this.EPS_SQ?(I.rtype=this.MP_CURL,I.set_right_curl(this.UNITY)):(I.rtype=this.MP_GIVEN,I.set_right_given(Math.atan2(t,u)))),this.mp_solve_choices(I,C,d,Z,w,V,Y)}else I.rtype===this.MP_ENDPOINT&&(I.rx=I.x,I.ry=I.y,C.lx=C.x,C.ly=C.y);if(I=C,I===o)break}},mp_solve_choices:function(n,t,o,r,u,d,C){var I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se,Ce,Ze=!0;for(B=d.length+1,J=new Array(B),Y=new Array(B),A=new Array(B),P=new Array(B),Se=0;Se<B;Se++)P[Se]=A[Se]=Y[Se]=J[Se]=0;for(w=0,V=n,L=0;Ze;){if(z=V.next,w===0)if(V.rtype===this.MP_GIVEN){if(z.ltype===this.MP_GIVEN){I=Math.atan2(u[0],r[0]),ee=this.mp_n_sin_cos(n.right_given()-I),se=ee[0],re=ee[1],ce=this.mp_n_sin_cos(t.left_given()-I),ue=ce[0],ye=ce[1],this.mp_set_controls(n,t,r[0],u[0],re,se,-ye,ue);return}A[0]=V.right_given()-Math.atan2(u[0],r[0]),A[0]=this.reduce_angle(A[0]),J[0]=0,Y[0]=0}else if(V.rtype===this.MP_CURL){if(z.ltype===this.MP_CURL){n.rtype=this.MP_EXPLICIT,t.ltype=this.MP_EXPLICIT,T=Math.abs(t.left_tension()),$=Math.abs(n.right_tension()),K=this.UNITY/(3*$),n.rx=n.x+r[0]*K,n.ry=n.y+u[0]*K,K=this.UNITY/(3*T),t.lx=t.x-r[0]*K,t.ly=t.y-u[0]*K;return}ne=V.right_curl(),T=Math.abs(z.left_tension()),$=Math.abs(V.right_tension()),J[0]=this.mp_curl_ratio(ne,$,T),A[0]=-C[1]*J[0],Y[0]=0}else V.rtype===this.MP_OPEN&&(J[0]=0,A[0]=0,Y[0]=this.FRACTION_ONE);else if(V.ltype===this.MP_END_CYCLE||V.ltype===this.MP_OPEN){if(I=this.UNITY/(3*Math.abs(L.right_tension())-this.UNITY),ie=d[w]*(this.FRACTION_THREE-this.UNITY/Math.abs(L.right_tension())),G=this.UNITY/(3*Math.abs(z.left_tension())-this.UNITY),Z=d[w-1]*(this.FRACTION_THREE-this.UNITY/Math.abs(z.left_tension())),ne=this.FRACTION_ONE-J[w-1]*I,ie=ie*ne,T=Math.abs(V.left_tension()),$=Math.abs(V.right_tension()),T<$?ie*=Math.pow(T/$,2):T>$&&(Z*=Math.pow($/T,2)),K=Z/(Z+ie),J[w]=K*G,f=-C[w+1]*J[w],L.rtype===this.MP_CURL?(Y[w]=0,A[w]=f-C[1]*(this.FRACTION_ONE-K)):(K=(this.FRACTION_ONE-K)/ne,f=f-C[w]*K,K=K*I,A[w]=f-A[w-1]*K,Y[w]=-Y[w-1]*K),V.ltype===this.MP_END_CYCLE){for(I=0,G=this.FRACTION_ONE;Ze&&(w-=1,w===0&&(w=o),I=A[w]-I*J[w],G=Y[w]-G*J[w],w!==o););for(I=I/(this.FRACTION_ONE-G),P[o]=I,A[0]=I,Ce=1;Ce<o;Ce++)A[Ce]=A[Ce]+I*Y[Ce];break}}else{if(V.ltype===this.MP_CURL){ne=V.left_curl(),T=Math.abs(V.left_tension()),$=Math.abs(L.right_tension()),K=this.mp_curl_ratio(ne,T,$),P[o]=-(A[o-1]*K)/(this.FRACTION_ONE-K*J[o-1]);break}if(V.ltype===this.MP_GIVEN){P[o]=V.left_given()-Math.atan2(u[o-1],r[o-1]),P[o]=this.reduce_angle(P[o]);break}}L=V,V=z,w+=1}for(w=o-1;w>-1;w--)P[w]=A[w]-P[w+1]*J[w];for(V=n,w=0;Ze&&(z=V.next,ee=this.mp_n_sin_cos(P[w]),se=ee[0],re=ee[1],ce=this.mp_n_sin_cos(-C[w+1]-P[w+1]),ue=ce[0],ye=ce[1],this.mp_set_controls(V,z,r[w],u[w],re,se,ye,ue),w++,V=z,w!==o););},mp_n_sin_cos:function(n){return[Math.cos(n),Math.sin(n)]},mp_set_controls:function(n,t,o,r,u,d,C,I){var f,A,G,B,Z;G=Math.abs(t.left_tension()),f=Math.abs(n.right_tension()),Z=this.mp_velocity(u,d,C,I,f),A=this.mp_velocity(C,I,u,d,G),(n.right_tension()<0||t.left_tension()<0)&&(u>=0&&C>=0||u<=0&&C<=0)&&(B=Math.abs(u)*I+Math.abs(C)*d,B>0&&(B*=1.00024414062,n.right_tension()<0&&this.mp_ab_vs_cd(Math.abs(C),this.FRACTION_ONE,Z,B)<0&&(Z=Math.abs(C)/B),t.left_tension()<0&&this.mp_ab_vs_cd(Math.abs(u),this.FRACTION_ONE,A,B)<0&&(A=Math.abs(u)/B))),n.rx=n.x+(o*d-r*u)*Z,n.ry=n.y+(r*d+o*u)*Z,t.lx=t.x-(o*I+r*C)*A,t.ly=t.y-(r*I-o*C)*A,n.rtype=this.MP_EXPLICIT,t.ltype=this.MP_EXPLICIT},mp_pyth_add:function(n,t){return Mat.hypot(n,t)},mp_curl_ratio:function(n,t,o){var r=1/t,u=1/o;return Math.min(4,((3-r)*r*r*n+u*u*u)/(r*r*r*n+(3-u)*u*u))},mp_ab_vs_cd:function(n,t,o,r){return n*t===o*r?0:n*t>o*r?1:-1},mp_velocity:function(n,t,o,r,u){return Math.min(4,(2+Math.sqrt(2)*(n-o/16)*(o-n/16)*(t-r))/(1.5*u*(2+(Math.sqrt(5)-1)*t+(3-Math.sqrt(5))*r)))},reduce_angle:function(n){return Math.abs(n)>this.ONE_EIGHTY_DEG&&(n>0?n-=this.THREE_SIXTY_DEG:n+=this.THREE_SIXTY_DEG),n},makeknots:function(n,t){var o,r,u=[];for(r=n.length,o=0;o<r;o++)u.push({x:n[o][0],y:n[o][1],ltype:this.MP_OPEN,rtype:this.MP_OPEN,lx:!1,rx:!1,ly:t,ry:t,left_curl:function(){return this.lx||0},right_curl:function(){return this.rx||0},left_tension:function(){return this.ly||1},right_tension:function(){return this.ry||1},set_right_curl:function(d){this.rx=d||0},set_left_curl:function(d){this.lx=d||0}});for(r=u.length,o=0;o<r;o++)u[o].next=u[o+1]||u[o],u[o].set_right_given=u[o].set_right_curl,u[o].set_left_given=u[o].set_left_curl,u[o].right_given=u[o].right_curl,u[o].left_given=u[o].left_curl;return u[r-1].next=u[0],u},curve:function(n,t){var o,r,u,d,C,I,f=!1,A=[],G=[];t=t||{tension:1,direction:{},curl:{},isClosed:!1},C=1,t.hasOwnProperty("tension")&&(C=JXG$1.evaluate(t.tension)),o=this.makeknots(n,C),r=o.length,JXG$1.exists(t.isClosed)&&JXG$1.evaluate(t.isClosed)&&(f=!0),f||(o[0].ltype=this.MP_ENDPOINT,o[0].rtype=this.MP_CURL,o[r-1].rtype=this.MP_ENDPOINT,o[r-1].ltype=this.MP_CURL);for(d in t)if(t.hasOwnProperty(d)){if(u=parseInt(d,10),isNaN(u)||u<0||u>=r)continue;if(I=t[u],JXG$1.exists(I.type))switch(I.type){case"curl":C=JXG$1.evaluate(I.curl),u===0?(o[u].rtype=this.MP_CURL,o[u].set_right_curl(C)):u===r-1?(o[u].ltype=this.MP_CURL,o[u].set_left_curl(C)):(o[u].ltype=this.MP_CURL,o[u].rtype=this.MP_CURL,o[u].lx=C,o[u].rx=C);break}JXG$1.exists(I.direction)&&(C=JXG$1.evaluate(I.direction),JXG$1.isArray(C)?(C[0]!==!1&&(o[u].lx=C[0]*Math.PI/180,o[u].ltype=this.MP_GIVEN),C[1]!==!1&&(o[u].rx=C[1]*Math.PI/180,o[u].rtype=this.MP_GIVEN)):(o[u].lx=C*Math.PI/180,o[u].rx=C*Math.PI/180,o[u].ltype=o[u].rtype=this.MP_GIVEN)),JXG$1.exists(I.tension)&&(C=JXG$1.evaluate(I.tension),JXG$1.isArray(C)?(C[0]!==!1&&(o[u].ly=JXG$1.evaluate(C[0])),C[1]!==!1&&(o[u].ry=JXG$1.evaluate(C[1]))):(o[u].ly=C,o[u].ry=C))}for(this.make_choices(o),u=0;u<r-1;u++)A.push(o[u].x),A.push(o[u].rx),A.push(o[u+1].lx),G.push(o[u].y),G.push(o[u].ry),G.push(o[u+1].ly);return A.push(o[r-1].x),G.push(o[r-1].y),f&&(A.push(o[r-1].rx),G.push(o[r-1].ry),A.push(o[0].lx),G.push(o[0].ly),A.push(o[0].x),G.push(o[0].y)),[A,G]}};const Metapost=Mat.Metapost;Mat.Clip={_isSeparator:function(n){return isNaN(n.coords.usrCoords[1])&&isNaN(n.coords.usrCoords[2])},makeDoublyLinkedList:function(n){var t,o=null,r=[],u=n.length;if(u>0)for(t=0;t<u;t++){if(this._isSeparator(n[t])){n[t]._next=n[(t+1)%u],n[t]._prev=n[(u+t-1)%u];continue}o===null&&(o=t,r.push(o)),this._isSeparator(n[(t+1)%u])||t===u-1?(n[t]._next=n[o],n[o]._prev=n[t],n[t]._end=!0,o=null):(n[t]._next=n[(t+1)%u],n[o]._prev=n[t]),this._isSeparator(n[(u+t-1)%u])||(n[t]._prev=n[(u+t-1)%u])}return r},Vertex:function(n,t,o,r,u,d){this.pos=t,this.intersection=!0,this.coords=n,this.elementClass=Const.OBJECT_CLASS_POINT,this.data={alpha:o,path:r,pathname:u,done:!1,type:d,idx:0},this.neighbour=null,this.entry_exit=!1},_addToList:function(n,t,o){var r=n.length,u=Mat.eps*Mat.eps;r>0&&Math.abs(n[r-1].coords.usrCoords[0]-t.usrCoords[0])<u&&Math.abs(n[r-1].coords.usrCoords[1]-t.usrCoords[1])<u&&Math.abs(n[r-1].coords.usrCoords[2]-t.usrCoords[2])<u||n.push({pos:o,intersection:!1,coords:t,elementClass:Const.OBJECT_CLASS_POINT})},sortIntersections:function(n){var t,o,r,u,d,C,I=[],f=n.length;for(t=0;t<f;t++)if(n[t].sort(function(A,G){return A.data.alpha>G.data.alpha?1:-1}),n[t].length>0){for(d=n[t].length-1,r=n[t][0],u=r.data.path[r.pos],C=u._next,t===f-1&&(u._end=!1),r.data.alpha===0&&r.data.type==="T"?(u.intersection=!0,u.data=r.data,u.neighbour=r.neighbour,u.neighbour.neighbour=u,u.entry_exit=!1,n[t][0]=u):(r._prev=u,r._prev._next=r),o=1;o<=d;o++)r=n[t][o],r._prev=n[t][o-1],r._prev._next=r;r=n[t][d],r._next=C,r._next._prev=r,t===f-1&&(r._end=!0),I=I.concat(n[t])}return I},_inbetween:function(n,t,o){var r,u=Mat.eps*Mat.eps,d=o[1]-t[1],C=o[2]-t[2],I=n[1]-t[1],f=n[2]-t[2];return d===0&&C===0&&I===0&&f===0?!0:(Math.abs(I)<u&&Math.abs(d)<u?r=f/C:r=I/d,Math.abs(r)<u&&(r=0),r)},_print_array:function(n){var t,o;for(t=0;t<n.length;t++)try{o="",n[t]._end&&(o=" end"),console.log(t,n[t].coords.usrCoords,n[t].data.type,"	","prev",n[t]._prev.coords.usrCoords,"next",n[t]._next.coords.usrCoords+o)}catch{console.log(t,n[t].coords.usrCoords)}},_print_list:function(n){for(var t=0,o;t<100&&(n.data?o=n.data.alpha:o="-",console.log("	",n.coords.usrCoords,`
		is:`,n.intersection,"end:",n._end,o,`
		-:`,n._prev.coords.usrCoords,`
		+:`,n._next.coords.usrCoords,`
		n:`,n.intersection?n.neighbour.coords.usrCoords:"-"),!n._end);)n=n._next,t++},_noOverlap:function(n,t,o,r){var u,d=Math.sqrt(Mat.eps),C,I,f,A,G=!1;for(u=0;u<3;u++)if(C=Math.min(n[u],t[u]),I=Math.max(n[u],t[u]),f=Math.min(o[u],r[u]),A=Math.max(o[u],r[u]),I<f-d||C>A+d){G=!0;break}return G},findIntersections:function(n,t,o){var r=[],u=Mat.eps*100,d,C,I,f=n.length,A=t.length,G,B,Z,w,V,Y,J,T,L,z,K=[],P=[],$=[],ie=[],ne=!1,ee=!1;for(C=0;C<A;C++)ie.push([]);for(d=0;d<f;d++){if($.push([]),this._isSeparator(n[d])||this._isSeparator(n[(d+1)%f])){ne=!0;continue}if(ne&&d===f-1)break;for(G=n[d].coords.usrCoords,B=n[(d+1)%f].coords.usrCoords,C=0;C<A;C++){if(this._isSeparator(t[C])||this._isSeparator(t[(C+1)%A])){ee=!0;continue}if(ee&&C===A-1)break;if(Z=t[C].coords.usrCoords,w=t[(C+1)%A].coords.usrCoords,!this._noOverlap(G,B,Z,w)&&(r=Geometry.meetSegmentSegment(G,B,Z,w),V=Geometry.distance(G,B,3),Y=Geometry.distance(Z,w,3),r[1]*V>-u&&r[1]<1-u/V&&r[2]*Y>-u&&r[2]<1-u/Y||r[1]===1/0&&r[2]===1/0&&Mat.norm(r[0],3)<u)){if(I=new Coords(Const.COORDS_BY_USER,r[0],o),T="X",Math.abs(r[1])*V<u||Math.abs(r[2])*Y<u)T="T",Math.abs(r[1])*V<u&&(r[1]=0),Math.abs(r[2])*Y<u&&(r[2]=0),r[1]===0?I=new Coords(Const.COORDS_BY_USER,G,o):I=new Coords(Const.COORDS_BY_USER,Z,o);else if(r[1]===1/0&&r[2]===1/0&&Mat.norm(r[0],3)<u){J=this._inbetween(G,Z,w),J>=0&&J<1&&(T="T",I=new Coords(Const.COORDS_BY_USER,G,o),r[1]=0,r[2]=J,L=new this.Vertex(I,d,r[1],n,"S",T),z=new this.Vertex(I,C,r[2],t,"C",T),L.neighbour=z,z.neighbour=L,$[d].push(L),ie[C].push(z)),J=this._inbetween(Z,G,B),Geometry.distance(G,Z,3)>u&&J>=0&&J<1&&(T="T",I=new Coords(Const.COORDS_BY_USER,Z,o),r[1]=J,r[2]=0,L=new this.Vertex(I,d,r[1],n,"S",T),z=new this.Vertex(I,C,r[2],t,"C",T),L.neighbour=z,z.neighbour=L,$[d].push(L),ie[C].push(z));continue}L=new this.Vertex(I,d,r[1],n,"S",T),z=new this.Vertex(I,C,r[2],t,"C",T),L.neighbour=z,z.neighbour=L,$[d].push(L),ie[C].push(z)}}}for(K=this.sortIntersections($),d=0;d<K.length;d++)K[d].data.idx=d,K[d].neighbour.data.idx=d;return P=this.sortIntersections(ie),[K,P]},_getPosition:function(n,t,o,r){var u=Geometry.det3p(n,t,o),d=Geometry.det3p(n,o,r),C=Geometry.det3p(t,o,r);return C>=0?u>=0&&d>=0?"left":"right":u>=0||d>=0?"left":"right"},_classifyDegenerateIntersections:function(n){var t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y=!0;for(A=Geometry.det3p,I=0,n._tours=0;Y;){if(n.intersection&&n.data.type==="T"&&(t=n._next.coords.usrCoords,o=n._prev.coords.usrCoords,Geometry.distance(n.coords.usrCoords,t,3)<Mat.eps&&(t=n._next._next.coords.usrCoords),Geometry.distance(n.coords.usrCoords,o,3)<Mat.eps&&(o=n._prev._prev.coords.usrCoords),d=n.neighbour,u=d._prev.coords.usrCoords,r=d._next.coords.usrCoords,Geometry.distance(d.coords.usrCoords,r,3)<Mat.eps&&(r=d._next._next.coords.usrCoords),Geometry.distance(d.coords.usrCoords,u,3)<Mat.eps&&(u=d._prev._prev.coords.usrCoords),B=A(n.coords.usrCoords,o,u),Z=A(n.coords.usrCoords,t,r),w=A(n.coords.usrCoords,o,r),V=A(n.coords.usrCoords,t,u),B===0&&Z===0&&w===0&&V===0&&(n.coords.usrCoords[1]*=1+Math.random()*Mat.eps,n.coords.usrCoords[2]*=1+Math.random()*Mat.eps,d.coords.usrCoords[1]=n.coords.usrCoords[1],d.coords.usrCoords[2]=n.coords.usrCoords[2],B=A(n.coords.usrCoords,o,u),Z=A(n.coords.usrCoords,t,r),w=A(n.coords.usrCoords,o,r),V=A(n.coords.usrCoords,t,u)),G=!1,B===0?Geometry.affineRatio(n.coords.usrCoords,o,u)<0&&(G=!0):Z===0?Geometry.affineRatio(n.coords.usrCoords,t,r)<0&&(G=!0):w===0?Geometry.affineRatio(n.coords.usrCoords,o,r)>0&&(G=!0):V===0&&Geometry.affineRatio(n.coords.usrCoords,t,u)>0&&(G=!0),G&&(f=u,u=r,r=f,f=B,B=w,w=f,f=Z,Z=V,V=f),JXG$1.exists(n.delayedStatus)||(n.delayedStatus=[]),B===0&&Z===0?n.delayedStatus=["on","on"]:B===0?(C=this._getPosition(t,u,d.coords.usrCoords,r),n.delayedStatus=["on",C]):Z===0?(C=this._getPosition(o,u,d.coords.usrCoords,r),n.delayedStatus=[C,"on"]):n.delayedStatus.length===0&&(this._getPosition(o,u,d.coords.usrCoords,r)!==this._getPosition(t,u,d.coords.usrCoords,r)?n.data.type="X":n.data.type="B")),JXG$1.exists(n._tours)&&n._tours++,n._tours>3||n._end||I>1e3){I>1e3&&console.log("Clipping: _classifyDegenerateIntersections exit"),JXG$1.exists(n._tours)&&delete n._tours;break}n.intersection&&I++,n=n._next}},_handleIntersectionChains:function(n){for(var t=0,o="Null",r,u=!0,d=!1,C=!1;u&&(n.intersection===!0&&(n.data.type==="T"&&(n.delayedStatus[0]!=="on"&&n.delayedStatus[1]==="on"?(d=!0,r=n,o=n.delayedStatus[0]):d&&n.delayedStatus[0]==="on"&&n.delayedStatus[1]==="on"?n.data.type="B":d&&n.delayedStatus[0]==="on"&&n.delayedStatus[1]!=="on"&&(d=!1,o===n.delayedStatus[1]?(r.data.type="DB",n.data.type="DB"):(r.data.type="DX",n.data.type="DX"))),t++),n._end&&(C=!0),!(C&&!d));){if(t>1e3){console.log("Warning: _handleIntersectionChains: intersection chain reached maximum numbers of iterations");break}n=n._next}},_handleFullyDegenerateCase:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L=[n,t];for(d=0;d<2;d++){for(r=L[d],w=r.length,B=0,T=!0;B<w;B++)if(!r[B].intersection){T=!1;break}if(T)for(u=L[(d+1)%2],V=u.length,B=0;B<w;B++){for(f=r[B].coords.usrCoords,A=r[B]._next.coords.usrCoords,C=[(f[0]+A[0])*.5,(f[1]+A[1])*.5,(f[2]+A[2])*.5],Z=0,Y=!1;Z<V;Z++)if(Math.abs(Geometry.det3p(u[Z].coords.usrCoords,u[(Z+1)%V].coords.usrCoords,C))<Mat.eps){Y=!0;break}if(!Y){I=new Coords(Const.COORDS_BY_USER,C,o),G={pos:B,intersection:!1,coords:I,elementClass:Const.OBJECT_CLASS_POINT},J=r[B]._next,r[B]._next=G,G._prev=r[B],G._next=J,J._prev=G,r[B]._end&&(r[B]._end=!1,G._end=!0);break}}}},_getStatus:function(n,t){for(var o;n.intersection&&!n._end;)n=n._next;return Geometry.windingNumber(n.coords.usrCoords,t)===0?o="entry":o="exit",[n,o]},markEntryExit:function(n,t,o){var r,u,d,C,I,f,A,G=!0,B=null,Z=0;for(f=o.length,I=0;I<f;I++)for(A=o[I],this._classifyDegenerateIntersections(n[A]),this._handleIntersectionChains(n[A]),C=this._getStatus(n[A],t),u=C[0],r=C[1],u._starter=!0,d=0,B=null,Z=0;G&&(u.intersection===!0&&(u.data.type==="X"&&Z===1&&(B.entry_exit=r,r==="exit"&&(B.data.type="X"),Z=2),(u.data.type==="X"||u.data.type==="DB")&&(u.entry_exit=r,r=r==="entry"?"exit":"entry"),u.data.type==="DX"&&(Z===0?(B=u,Z=1):Z===1?(u.entry_exit=r,B.entry_exit=r,r==="exit"?B.data.type="X":u.data.type="X",r=r==="entry"?"exit":"entry",B=null,Z=0):Z===2&&(u.entry_exit=r,u.data.type="X",r=r==="entry"?"exit":"entry",B=null,Z=0))),u=u._next,!(JXG$1.exists(u._starter)||d>1e4));)d++},_stayOnPath:function(n,t){var o=!0;return n.intersection&&n.data.type!=="B"&&(o=t===n.entry_exit),o},_addVertex:function(n,t,o){return!isNaN(t.coords.usrCoords[1])&&!isNaN(t.coords.usrCoords[2])&&n.push(t),t.intersection&&t.data.done?(o&&console.log("Add last intersection point",t.coords.usrCoords,"on",t.data.pathname,t.entry_exit,t.data.type),!0):(t.intersection&&(t.data.done=!0,o&&console.log("Add intersection point",t.coords.usrCoords,"on",t.data.pathname,t.entry_exit,t.data.type)),!1)},tracing:function(n,t,o){for(var r,u,d,C,I=0,f=1e4,A=0,G=[],B=!1,Z=!1;A<t.length&&I<f;){if(d=t[A],d.data.done||d.data.type!=="X"){A++;continue}G.length>0&&G.push([NaN,NaN]),C=d.data.idx,r=n,B=this._addVertex(G,d,Z),u=d.entry_exit;do{if(B)break;if(o==="intersection"&&d.entry_exit==="entry"||o==="union"&&d.entry_exit==="exit"||o==="difference"&&r===n==(d.entry_exit==="exit")){do if(d=d._next,B=this._addVertex(G,d,Z),B)break;while(this._stayOnPath(d,u));I++}else{do if(d=d._prev,B=this._addVertex(G,d,Z),B)break;while(this._stayOnPath(d,u));I++}if(B)break;if(!d.neighbour)return console.log("Tracing: emergency break - no neighbour!!!!!!!!!!!!!!!!!",I),[[0],[0]];if(d=d.neighbour,d.data.done)break;d.data.done=!0,u=d.entry_exit,r=d.data.path}while(d.data.idx!==C&&I<f);I>=f&&console.log("Tracing: stopping an infinite loop!",I),A++}return this._getCoordsArrays(G,!1)},isEmptyCase:function(n,t,o){return o==="intersection"&&(n.length===0||t.length===0)||o==="union"&&n.length===0&&t.length===0||o==="difference"&&n.length===0},_getCoordsArrays:function(n,t){var o=[],r=[],u,d=n.length;for(u=0;u<d;u++)n[u].coords?(o.push(n[u].coords.usrCoords[1]),r.push(n[u].coords.usrCoords[2])):(o.push(n[u][0]),r.push(n[u][1]));return t&&d>0&&(n[0].coords?(o.push(n[0].coords.usrCoords[1]),r.push(n[0].coords.usrCoords[2])):(o.push(n[0][0]),r.push(n[0][1]))),[o,r]},handleEmptyIntersection:function(n,t,o){var r,u,d=!1,C=[];if(n.length===0)return o==="union"?C=t:C=[],this._getCoordsArrays(C,!0);if(t.length===0)return o==="intersection"?C=[]:C=n,this._getCoordsArrays(C,!0);if(n.length>0)for(r=n[0];r.intersection&&(r=r._next,!r._end););if(t.length>0)for(u=t[0];u.intersection&&(u=u._next,!u._end););return Geometry.windingNumber(r.coords.usrCoords,t)===0?Geometry.windingNumber(u.coords.usrCoords,n)!==0?(o==="union"?(JXG$1.concat(C,n),C.push(n[0])):o==="difference"&&(JXG$1.concat(C,n),C.push(n[0]),Geometry.signedPolygon(n)*Geometry.signedPolygon(t)>0&&C.reverse(),C.push([NaN,NaN])),(o==="difference"||o==="intersection")&&(JXG$1.concat(C,t),C.push(t[0]),d=!1)):o==="difference"?(JXG$1.concat(C,n),d=!0):o==="union"&&(JXG$1.concat(C,n),C.push(n[0]),C.push([NaN,NaN]),JXG$1.concat(C,t),C.push(t[0])):o==="intersection"?(JXG$1.concat(C,n),d=!0):o==="union"&&(JXG$1.concat(C,t),C.push(t[0])),this._getCoordsArrays(C,d)},_countCrossingIntersections:function(n){var t,o=n.length,r=0;for(t=0;t<o;t++)n[t].data.type==="X"&&r++;return r},_getPath:function(n,t){var o,r,u,d,C,I,f,A=[];if(n.elementClass===Const.OBJECT_CLASS_CURVE&&(n.type===Const.OBJECT_TYPE_ARC||n.type===Const.OBJECT_TYPE_SECTOR)){for(C=Geometry.rad(n.radiuspoint,n.center,n.anglepoint),f=Math.floor(C*180/Math.PI),u=n.Radius(),d=C/f,I=Math.atan2(n.radiuspoint.coords.usrCoords[2]-n.center.coords.usrCoords[2],n.radiuspoint.coords.usrCoords[1]-n.center.coords.usrCoords[1]),n.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(A,n.center.coords,0),o=0;o<=f;o++)this._addToList(A,new Coords(Const.COORDS_BY_USER,[n.center.coords.usrCoords[0],n.center.coords.usrCoords[1]+Math.cos(o*d+I)*u,n.center.coords.usrCoords[2]+Math.sin(o*d+I)*u],t),o+1);n.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(A,n.center.coords,f+2)}else if(n.elementClass===Const.OBJECT_CLASS_CURVE&&JXG$1.exists(n.points))for(r=n.numberPoints,o=0;o<r;o++)this._addToList(A,n.points[o],o);else if(n.type===Const.OBJECT_TYPE_POLYGON)for(o=0;o<n.vertices.length;o++)this._addToList(A,n.vertices[o].coords,o);else if(n.elementClass===Const.OBJECT_CLASS_CIRCLE)for(f=359,u=n.Radius(),d=2*Math.PI/f,o=0;o<=f;o++)this._addToList(A,new Coords(Const.COORDS_BY_USER,[n.center.coords.usrCoords[0],n.center.coords.usrCoords[1]+Math.cos(o*d)*u,n.center.coords.usrCoords[2]+Math.sin(o*d)*u],t),o);else if(JXG$1.isArray(n))for(r=n.length,o=0;o<r;o++)JXG$1.exists(n[o].coords)?this._addToList(A,n[o].coords,o):JXG$1.isArray(n[o])?this._addToList(A,new Coords(Const.COORDS_BY_USER,n[o],t),o):JXG$1.exists(n[o].usrCoords)&&this._addToList(A,n[o],o);return A},greinerHormann:function(n,t,o,r){var u,d=[],C=[],I=[],f,A,G=[];return d=this._getPath(n,r),u=d.length,u>0&&Geometry.distance(d[0].coords.usrCoords,d[u-1].coords.usrCoords,3)<Mat.eps&&d.pop(),C=this._getPath(t,r),u=C.length,u>0&&Geometry.distance(C[0].coords.usrCoords,C[u-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&C.pop(),this.isEmptyCase(d,C,o)?[[],[]]:(f=this.makeDoublyLinkedList(d),A=this.makeDoublyLinkedList(C),G=this.findIntersections(d,C,r),I=G[0],this._handleFullyDegenerateCase(d,C,r),this.markEntryExit(d,C,f),this.markEntryExit(C,d,A),this._countCrossingIntersections(I)===0?this.handleEmptyIntersection(d,C,o):this.tracing(d,I,o))},union:function(n,t,o){return this.greinerHormann(n,t,"union",o)},intersection:function(n,t,o){return this.greinerHormann(n,t,"intersection",o)},difference:function(n,t,o){return this.greinerHormann(n,t,"difference",o)}};const Clip=Mat.Clip;Mat.Poly={};Mat.Poly.Ring=function(n){this.vars=n};JXG$1.extend(Mat.Poly.Ring.prototype,{});Mat.Poly.Monomial=function(n,t,o){var r;if(!JXG$1.exists(n))throw new Error("JSXGraph error: In JXG.Math.Poly.monomial missing parameter 'ring'.");for(JXG$1.isArray(o)||(o=[]),o=o.slice(0,n.vars.length),r=o.length;r<n.vars.length;r++)o.push(0);this.ring=n,this.coefficient=t||0,this.exponents=JXG$1.deepCopy(o)};JXG$1.extend(Mat.Poly.Monomial.prototype,{copy:function(){return new Mat.Poly.Monomial(this.ring,this.coefficient,this.exponents)},print:function(){var n=[],t;for(t=0;t<this.ring.vars.length;t++)n.push(this.ring.vars[t]+"^"+this.exponents[t]);return this.coefficient+"*"+n.join("*")}});Mat.Poly.Polynomial=function(n,t){var o=function(){},r;if(!JXG$1.exists(n))throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial missing parameter 'ring'.");JXG$1.exists(t)&&JXG$1.isString(t)?r=o():r=[],this.ring=n,this.monomials=r};JXG$1.extend(Mat.Poly.Polynomial.prototype,{findSignature:function(n){var t;for(t=0;t<this.monomials.length;t++)if(JXG$1.cmpArrays(this.monomials[t].exponents,n))return t;return-1},addSubMonomial:function(n,t){var o;o=this.findSignature(n.exponents),o>-1?this.monomials[o].coefficient+=t*n.coefficient:(n.coefficient*=t,this.monomials.push(n))},add:function(n){var t;if(JXG$1.exists(n)&&n.ring===this.ring)if(JXG$1.isArray(n.exponents))this.addSubMonomial(n,1);else for(t=0;t<n.monomials.length;t++)this.addSubMonomial(n.monomials[t],1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.add either summand is undefined or rings don't match.")},sub:function(n){var t;if(JXG$1.exists(n)&&n.ring===this.ring)if(JXG$1.isArray(n.exponents))this.addSubMonomial(n,-1);else for(t=0;t<n.monomials.length;t++)this.addSubMonomial(n.monomials[t],-1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.sub either summand is undefined or rings don't match.")},copy:function(){var n,t;for(t=new Mat.Poly.Polynomial(this.ring),n=0;n<this.monomials.length;n++)t.monomials.push(this.monomials[n].copy());return t},print:function(){var n=[],t;for(t=0;t<this.monomials.length;t++)n.push("("+this.monomials[t].print()+")");return n.join("+")}});Mat.Poly;JXG$1.Complex=function(n,t){this.isComplex=!0,n&&n.isComplex&&(t=n.imaginary,n=n.real),this.real=n||0,this.imaginary=t||0,this.absval=0,this.angle=0};JXG$1.extend(JXG$1.Complex.prototype,{toString:function(){return this.real+" + "+this.imaginary+"i"},add:function(n){return JXG$1.isNumber(n)?this.real+=n:(this.real+=n.real,this.imaginary+=n.imaginary),this},sub:function(n){return JXG$1.isNumber(n)?this.real-=n:(this.real-=n.real,this.imaginary-=n.imaginary),this},mult:function(n){var t,o;return JXG$1.isNumber(n)?(this.real*=n,this.imaginary*=n):(t=this.real,o=this.imaginary,this.real=t*n.real-o*n.imaginary,this.imaginary=t*n.imaginary+o*n.real),this},div:function(n){var t,o,r;if(JXG$1.isNumber(n)){if(Math.abs(n)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;this.real/=n,this.imaginary/=n}else{if(Math.abs(n.real)<Math.eps&&Math.abs(n.imaginary)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;t=n.real*n.real+n.imaginary*n.imaginary,r=this.real,o=this.imaginary,this.real=(r*n.real+o*n.imaginary)/t,this.imaginary=(o*n.real-r*n.imaginary)/t}return this},conj:function(){return this.imaginary*=-1,this}});JXG$1.C={};JXG$1.C.add=function(n,t){var o=new JXG$1.Complex(n);return o.add(t),o};JXG$1.C.sub=function(n,t){var o=new JXG$1.Complex(n);return o.sub(t),o};JXG$1.C.mult=function(n,t){var o=new JXG$1.Complex(n);return o.mult(t),o};JXG$1.C.div=function(n,t){var o=new JXG$1.Complex(n);return o.div(t),o};JXG$1.C.conj=function(n){var t=new JXG$1.Complex(n);return t.conj(),t};JXG$1.C.abs=function(n){var t=new JXG$1.Complex(n);return t.conj(),t.mult(n),Math.sqrt(t.real)};JXG$1.C.copy=function(n){return new JXG$1.Complex(n)};JXG$1.Complex.C=JXG$1.C;const Complex=JXG$1.Complex;var simpleColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},colorDefs=[{re:/^\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d.]{1,3})\s*\)\s*$/,example:["rgba(123, 234, 45, 0.5)","rgba(255,234,245,1.0)"],process:function(n){return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}},{re:/^\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(n){return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(n){return[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(n){return[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]}}];JXG$1.rgbParser=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z=n,w;if(!JXG$1.exists(n))return[];if(JXG$1.exists(t)&&JXG$1.exists(o)&&(Z=[n,t,o]),r=Z,w=!1,JXG$1.isArray(r)){for(f=0;f<3;f++)w=w||/\./.test(Z[f].toString());for(f=0;f<3;f++)w=w&&Z[f]>=0&&Z[f]<=1;return w?[Math.ceil(Z[0]*255),Math.ceil(Z[1]*255),Math.ceil(Z[2]*255)]:Z}for(typeof Z=="string"&&(r=Z),r.charAt(0)==="#"&&(r=r.slice(1,7)),r=r.replace(/ /g,"").toLowerCase(),r=simpleColors[r]||r,f=0;f<colorDefs.length;f++)d=colorDefs[f].re,C=colorDefs[f].process,I=d.exec(r),I&&(u=C(I),A=u[0],G=u[1],B=u[2]);return isNaN(A)||isNaN(G)||isNaN(B)?[]:(A=A<0||isNaN(A)?0:A>255?255:A,G=G<0||isNaN(G)?0:G>255?255:G,B=B<0||isNaN(B)?0:B>255?255:B,[A,G,B])};JXG$1.isColor=function(n){var t=new Option().style;return t.color=n,t.color!==""};JXG$1.rgb2css=function(n,t,o){var r;return r=JXG$1.rgbParser(n,t,o),"rgb("+r[0]+", "+r[1]+", "+r[2]+")"};JXG$1.rgb2hex=function(n,t,o){var r,u,d;return r=JXG$1.rgbParser(n,t,o),u=r[1],d=r[2],r=r[0],r=r.toString(16),u=u.toString(16),d=d.toString(16),r.length===1&&(r="0"+r),u.length===1&&(u="0"+u),d.length===1&&(d="0"+d),"#"+r+u+d};JXG$1.hex2rgb=function(n){return JXG$1.deprecated("JXG.hex2rgb()","JXG.rgb2css()"),JXG$1.rgb2css(n)};JXG$1.hsv2rgb=function(n,t,o){var r,u,d,C,I,f,A,G,B;if(n=(n%360+360)%360,t===0)if(isNaN(n)||n<Mat.eps)r=o,u=o,d=o;else return"#ffffff";else switch(n>=360?f=0:f=n,f=f/60,I=Math.floor(f),C=f-I,A=o*(1-t),G=o*(1-t*C),B=o*(1-t*(1-C)),I){case 0:r=o,u=B,d=A;break;case 1:r=G,u=o,d=A;break;case 2:r=A,u=o,d=B;break;case 3:r=A,u=G,d=o;break;case 4:r=B,u=A,d=o;break;case 5:r=o,u=A,d=G;break}return r=Math.round(r*255).toString(16),r=r.length===2?r:r.length===1?"0"+r:"00",u=Math.round(u*255).toString(16),u=u.length===2?u:u.length===1?"0"+u:"00",d=Math.round(d*255).toString(16),d=d.length===2?d:d.length===1?"0"+d:"00",["#",r,u,d].join("")};JXG$1.rgb2hsv=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y;return r=JXG$1.rgbParser(n,t,o),u=r[1],d=r[2],r=r[0],C=r/255,I=u/255,f=d/255,V=Math.max(r,u,d),Y=Math.min(r,u,d),A=V/255,G=Y/255,w=A,Z=0,w>0&&(Z=(w-G)/w),B=1/(A-G),Z>0&&(V===r?B=(I-f)*B:V===u?B=2+(f-C)*B:B=4+(C-I)*B),B*=60,B<0&&(B+=360),V===Y&&(B=0),[B,Z,w]};JXG$1.rgb2LMS=function(n,t,o){var r,u,d,C,I,f,A,G=[[.05059983,.08585369,.0095242],[.01893033,.08925308,.01370054],[.00292202,.00975732,.07145979]];return r=JXG$1.rgbParser(n,t,o),u=r[1],d=r[2],r=r[0],r=Math.pow(r,.476190476),u=Math.pow(u,.476190476),d=Math.pow(d,.476190476),C=r*G[0][0]+u*G[0][1]+d*G[0][2],I=r*G[1][0]+u*G[1][1]+d*G[1][2],f=r*G[2][0]+u*G[2][1]+d*G[2][2],A=[C,I,f],A.l=C,A.m=I,A.s=f,A};JXG$1.LMS2rgb=function(n,t,o){var r,u,d,C,I=[[30.830854,-29.832659,1.610474],[-6.481468,17.715578,-2.532642],[-.37569,-1.199062,14.273846]],f=function(A){for(var G=127,B=64;B>0;){if(Math.pow(G,.476190476)>A)G-=B;else{if(Math.pow(G+1,.476190476)>A)return G;G+=B}B/=2}return G===254&&13.994955247<A?255:G};return r=n*I[0][0]+t*I[0][1]+o*I[0][2],u=n*I[1][0]+t*I[1][1]+o*I[1][2],d=n*I[2][0]+t*I[2][1]+o*I[2][2],r=f(r),u=f(u),d=f(d),C=[r,u,d],C.r=r,C.g=u,C.b=d,C};JXG$1.rgba2rgbo=function(n){var t;return n.length===9&&n.charAt(0)==="#"?(t=parseInt(n.slice(7,9).toUpperCase(),16)/255,n=n.slice(0,7)):t=1,[n,t]};JXG$1.rgbo2rgba=function(n,t){var o;return n==="none"||n==="transparent"?n:(o=Math.round(t*255).toString(16),o.length===1&&(o="0"+o),JXG$1.rgb2hex(n)+o)};JXG$1.rgb2bw=function(n){var t,o,r,u="0123456789ABCDEF";return n==="none"||(r=JXG$1.rgbParser(n),t=Math.floor(.3*r[0]+.59*r[1]+.11*r[2]),o=u.charAt(t>>4&15)+u.charAt(t&15),n="#"+o+o+o),n};JXG$1.rgb2cb=function(n,t){var o,r,u,d,C,I,f,A,G,B,Z,w,V,Y="0123456789ABCDEF";if(n==="none")return n;switch(C=JXG$1.rgb2LMS(n),r=C[0],u=C[1],d=C[2],t=t.toLowerCase(),t){case"protanopia":f=-.06150039994295001,A=.08277001656812001,G=-.013200141220000003,B=.05858939668799999,Z=-.07934519995360001,w=.013289415272000003,V=.6903216543277437,I=d/u,I<V?r=-(A*u+G*d)/f:r=-(Z*u+w*d)/B;break;case"tritanopia":f=-.00058973116217,A=.007690316482,G=-.01011703519052,B=.025495080838999994,Z=-.0422740347,w=.017005316784,V=.8349489908460004,I=u/r,I<V?d=-(f*r+A*u)/G:d=-(B*r+Z*u)/w;break;default:f=-.06150039994295001,A=.08277001656812001,G=-.013200141220000003,B=.05858939668799999,Z=-.07934519995360001,w=.013289415272000003,V=.5763833686400911,I=d/r,I<V?u=-(f*r+G*d)/A:u=-(B*r+w*d)/Z;break}return o=JXG$1.LMS2rgb(r,u,d),I=Y.charAt(o[0]>>4&15)+Y.charAt(o[0]&15),n="#"+I,I=Y.charAt(o[1]>>4&15)+Y.charAt(o[1]&15),n+=I,I=Y.charAt(o[2]>>4&15)+Y.charAt(o[2]&15),n+=I,n};JXG$1.shadeColor=function(n,t){var o=JXG$1.rgbParser(n),r=o[0],u=o[1],d=o[2];return r=parseInt(r+255*t),u=parseInt(u+255*t),d=parseInt(d+255*t),r=r>0?r:0,u=u>0?u:0,d=d>0?d:0,r=r<255?r:255,u=u<255?u:255,d=d<255?d:255,r=Math.round(r),u=Math.round(u),d=Math.round(d),JXG$1.rgb2hex([r,u,d])};JXG$1.lightenColor=function(n,t){return JXG$1.shadeColor(n,t)};JXG$1.darkenColor=function(n,t){return JXG$1.shadeColor(n,-1*t)};JXG$1.autoHighlight=function(n){var t=JXG$1.rgba2rgbo(n),o=t[0],r=t[1];return n.charAt(0)==="#"?(r<.3?r*=1.8:r*=.4,JXG$1.rgbo2rgba(o,r)):n};JXG$1.contrast=function(n,t,o,r){var u,d="#000000",C,I,f,A;return t=t||"#000000",o=o||"#ffffff",r=r||7,u=JXG$1.rgbParser(n),C=JXG$1.rgbParser(d),I=.2126*Math.pow(u[0]/255,2.2)+.7152*Math.pow(u[1]/255,2.2)+.0722*Math.pow(u[2]/255,2.2),f=.2126*Math.pow(C[0]/255,2.2)+.7152*Math.pow(C[1]/255,2.2)+.0722*Math.pow(C[2]/255,2.2),I>f?A=Math.floor((I+.05)/(f+.05)):A=Math.floor((f+.05)/(I+.05)),A=A-1,A>r?t:o};JXG$1.setClassicColors=function(){JXG$1.Options.elements.strokeColor="blue",JXG$1.Options.elements.fillColor="red",JXG$1.Options.hatch.strokeColor="blue",JXG$1.Options.angle.fillColor="#ff7f00",JXG$1.Options.angle.highlightFillColor="#ff7f00",JXG$1.Options.angle.strokeColor="#ff7f00",JXG$1.Options.angle.label.strokeColor="blue",JXG$1.Options.arc.strokeColor="blue",JXG$1.Options.circle.center.fillColor="red",JXG$1.Options.circle.center.strokeColor="blue",JXG$1.Options.circumcircle.strokeColor="blue",JXG$1.Options.circumcircle.center.fillColor="red",JXG$1.Options.circumcircle.center.strokeColor="blue",JXG$1.Options.circumcirclearc.strokeColor="blue",JXG$1.Options.circumcirclesector.strokeColor="blue",JXG$1.Options.circumcirclesector.fillColor="green",JXG$1.Options.circumcirclesector.highlightFillColor="green",JXG$1.Options.conic.strokeColor="blue",JXG$1.Options.curve.strokeColor="blue",JXG$1.Options.incircle.strokeColor="blue",JXG$1.Options.incircle.center.fillColor="red",JXG$1.Options.incircle.center.strokeColor="blue",JXG$1.Options.inequality.fillColor="red",JXG$1.Options.integral.fillColor="red",JXG$1.Options.integral.curveLeft.color="red",JXG$1.Options.integral.curveRight.color="red",JXG$1.Options.line.strokeColor="blue",JXG$1.Options.point.fillColor="red",JXG$1.Options.point.strokeColor="red",JXG$1.Options.polygon.fillColor="green",JXG$1.Options.polygon.highlightFillColor="green",JXG$1.Options.polygon.vertices.strokeColor="red",JXG$1.Options.polygon.vertices.fillColor="red",JXG$1.Options.regularpolygon.fillColor="green",JXG$1.Options.regularpolygon.highlightFillColor="green",JXG$1.Options.regularpolygon.vertices.strokeColor="red",JXG$1.Options.regularpolygon.vertices.fillColor="red",JXG$1.Options.riemannsum.fillColor="yellow",JXG$1.Options.sector.fillColor="green",JXG$1.Options.sector.highlightFillColor="green",JXG$1.Options.semicircle.center.fillColor="red",JXG$1.Options.semicircle.center.strokeColor="blue",JXG$1.Options.slopetriangle.fillColor="red",JXG$1.Options.slopetriangle.highlightFillColor="red",JXG$1.Options.turtle.arrow.strokeColor="blue"};JXG$1.extend(JXG$1,{paletteWong:{black:"#000000",orange:"#E69F00",skyblue:"#56B4E9",bluishgreen:"#009E73",yellow:"#F0E442",darkblue:"#0072B2",vermillion:"#D55E00",reddishpurple:"#CC79A7",blue:"#0072B2",red:"#D55E00",green:"#009E73",purple:"#CC79A7",white:"#ffffff"}});JXG$1.palette=JXG$1.paletteWong;JXG$1.Options={jc:{enabled:!0,compile:!0},board:{animationDelay:35,axis:!1,boundingBox:[-5,5,5,-5],browserPan:!1,clickDelay:600,dblClickSuppressClick:!1,defaultAxes:{x:{name:"x",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"middle",anchorY:"top",fontSize:12,offset:[0,-3]},tickEndings:[0,1],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}},y:{name:"y",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"right",anchorY:"middle",fontSize:12,offset:[-6,0]},tickEndings:[1,0],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}}},description:"",document:!1,drag:{enabled:!0},fullscreen:{symbol:'<svg height="1em" width="1em" version="1.1" viewBox="10 10 18 18"><path fill="#666" d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path><path fill="#666" d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path><path fill="#666" d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path><path fill="#666" d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',scale:.85,id:null},ignoreLabels:!0,intl:{enabled:!1},keepAspectRatio:!1,keyboard:{enabled:!0,dx:10,dy:10,panShift:!0,panCtrl:!1},logging:{enabled:!1},minimizeReflow:"none",maxBoundingBox:[-1/0,1/0,1/0,-1/0],maxFrameRate:40,maxNameLength:1,moveTarget:null,offsetX:0,offsetY:0,pan:{enabled:!0,needShift:!0,needTwoFingers:!1},registerEvents:!0,renderer:"auto",resize:{enabled:!0,throttle:10},screenshot:{scale:1,type:"png",symbol:"",css:"background-color:#eeeeee; opacity:1.0; border:2px solid black; border-radius:10px; text-align:center",cssButton:"padding: 4px 10px; border: solid #356AA0 1px; border-radius: 5px; position: absolute; right: 2ex; top: 2ex; background-color: rgba(255, 255, 255, 0.3);"},selection:{enabled:!1,name:"selectionPolygon",needShift:!1,needCtrl:!0,fillColor:"#ffff00",visible:!1,withLines:!1,vertices:{visible:!1}},showClearTraces:!1,showCopyright:!0,showFullscreen:!1,showInfobox:!0,showNavigation:!0,showReload:!1,showScreenshot:!1,showZoom:!0,takeFirst:!1,takeSizeFromFile:!1,theme:"default",title:"",viewport:[0,0,0,0],zoom:{enabled:!0,factorX:1.25,factorY:1.25,wheel:!0,needShift:!0,center:"auto",min:1e-4,max:1e4,pinch:!0,pinchHorizontal:!0,pinchVertical:!0,pinchSensitivity:7},zoomX:1,zoomY:1},navbar:{strokeColor:"#333333",fillColor:"transparent",highlightFillColor:"#aaaaaa",padding:"2px",position:"absolute",fontSize:"14px",cursor:"pointer",zIndex:"100",right:"5px",bottom:"5px"},elements:{dash:0,dashScale:!1,draft:{draft:!1,strokeColor:"#565656",fillColor:"#565656",strokeOpacity:.8,fillOpacity:.8,strokeWidth:1},dragToTopOfLayer:!1,fillColor:JXG$1.palette.red,fillOpacity:1,fixed:!1,frozen:!1,gradient:null,gradientAngle:0,gradientCX:.5,gradientCY:.5,gradientEndOffset:1,gradientFX:.5,gradientFY:.5,gradientFR:0,gradientR:.5,gradientSecondColor:"#ffffff",gradientSecondOpacity:1,gradientStartOffset:0,highlight:!0,highlightFillColor:"none",highlightFillOpacity:1,highlightStrokeColor:"#c3d9ff",highlightStrokeOpacity:1,highlightStrokeWidth:2,isLabel:!1,layer:0,lineCap:"butt",needsRegularUpdate:!0,nonnegativeOnly:!1,precision:"inherit",priv:!1,rotatable:!0,scalable:!0,shadow:{enabled:!1,color:[0,0,0],opacity:1,blur:3,blend:.1,offset:[5,5]},snapToGrid:!1,strokeColor:JXG$1.palette.blue,strokeOpacity:1,strokeWidth:2,tabindex:0,trace:!1,traceAttributes:{},transitionDuration:100,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width"],visible:!0,viewport:"inherit",withLabel:!1},ticks:{generateLabelText:null,generateLabelValue:null,drawLabels:!1,label:{},beautifulScientificTickLabels:!1,useUnicodeMinus:!0,anchor:"left",drawZero:!1,insertTicks:!1,minTicksDistance:10,minorHeight:4,majorHeight:10,tickEndings:[1,1],majorTickEndings:[1,1],ignoreInfiniteTickEndings:!0,minorTicks:4,ticksPerLabel:!1,scale:1,scaleSymbol:"",labels:[],maxLabelLength:5,precision:3,digits:3,ticksDistance:1,face:"|",strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"none",highlightFillColor:"none",visible:"inherit",includeBoundaries:!1,type:"linear",intl:{enabled:"inherit",options:{}},minorTicksInArrow:!1,majorTicksInArrow:!0,labelInArrow:!0,minorTicksInMargin:!1,majorTicksInMargin:!0,labelInMargin:!0},hatch:{drawLabels:!1,drawZero:!0,majorHeight:20,anchor:"middle",face:"|",strokeWidth:2,strokeColor:JXG$1.palette.blue,ticksDistance:.2},precision:{touch:30,touchMax:100,mouse:4,pen:4,epsilon:1e-4,hasPoint:4},layer:{numlayers:20,unused9:19,unused8:18,unused7:17,unused6:16,unused5:15,unused4:14,unused3:13,unused2:12,unused1:11,unused0:10,text:9,point:9,glider:9,arc:8,line:7,circle:6,curve:5,turtle:5,polygon:3,sector:3,angle:3,integral:3,axis:2,ticks:2,grid:1,image:0,trace:0},angle:{withLabel:!0,radius:"auto",type:"sector",orthoType:"square",orthoSensitivity:1,fillColor:JXG$1.palette.orange,highlightFillColor:JXG$1.palette.orange,strokeColor:JXG$1.palette.orange,fillOpacity:.3,highlightFillOpacity:.3,radiuspoint:{withLabel:!1,visible:!1,name:""},pointsquare:{withLabel:!1,visible:!1,name:""},dot:{visible:!1,strokeColor:"none",fillColor:"#000000",size:2,face:"o",withLabel:!1,name:""},label:{position:"top",offset:[0,0],strokeColor:JXG$1.palette.blue},arc:{visible:!1,fillColor:"none"}},arc:{selection:"auto",hasInnerPoints:!1,label:{anchorX:"auto",anchorY:"auto"},firstArrow:!1,lastArrow:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",useDirection:!1,center:{},radiusPoint:{},anglePoint:{}},arrow:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},arrowparallel:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},axis:{name:"",needsRegularUpdate:!1,strokeWidth:1,lastArrow:{type:1,highlightSize:8,size:8},strokeColor:"#666666",highlightStrokeWidth:1,highlightStrokeColor:"#888888",position:"static",anchor:"",anchorDist:"10%",ticksAutoPos:!1,ticksAutoPosThreshold:"5%",withTicks:!0,straightFirst:!0,straightLast:!0,margin:-4,withLabel:!1,scalable:!1,ticks:{label:{offset:[4,-9],parse:!1,needsRegularUpdate:!1,display:"internal",visible:"inherit",layer:9},visible:"inherit",needsRegularUpdate:!1,strokeWidth:1,strokeColor:"#666666",highlightStrokeColor:"#888888",drawLabels:!0,drawZero:!1,insertTicks:!0,minTicksDistance:5,minorHeight:10,majorHeight:-1,tickEndings:[0,1],majorTickEndings:[1,1],minorTicks:4,ticksDistance:1,strokeOpacity:.25},point1:{needsRegularUpdate:!1,visible:!1},point2:{needsRegularUpdate:!1,visible:!1},tabindex:-1,label:{position:"lft",offset:[10,10]}},bisector:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},bisectorlines:{line1:{strokeColor:"#000000"},line2:{strokeColor:"#000000"}},boxplot:{dir:"vertical",smallWidth:.5,strokeWidth:2,strokeColor:JXG$1.palette.blue,fillColor:JXG$1.palette.blue,fillOpacity:.2,highlightStrokeWidth:2,highlightStrokeColor:JXG$1.palette.blue,highlightFillColor:JXG$1.palette.blue,highlightFillOpacity:.1},button:{disabled:!1,display:"html"},cardinalspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.05,fillOpacity:.05,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},chart:{chartStyle:"line",colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],highlightcolors:null,fillcolor:null,highlightonsector:!1,highlightbysize:!1,fillOpacity:.6,withLines:!1,label:{}},checkbox:{disabled:!1,checked:!1,display:"html"},circle:{hasInnerPoints:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},label:{position:"urt"}},circumcircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},circumcirclearc:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,name:""}},circumcirclesector:{useDirection:!0,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},comb:{frequency:.2,width:.4,angle:Math.PI/3,reverse:!1,point1:{visible:!1,withLabel:!1,fixed:!1,name:""},point2:{visible:!1,withLabel:!1,fixed:!1,name:""},strokeWidth:1,strokeColor:"#0000ff",fillColor:"none"},conic:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",foci:{fixed:!1,visible:!1,withLabel:!1,name:""},center:{visible:!1,withLabel:!1,name:""},point:{withLabel:!1,name:""},line:{visible:!1}},curve:{strokeWidth:1,strokeColor:JXG$1.palette.blue,fillColor:"none",fixed:!0,curveType:null,doAdvancedPlot:!0,doAdvancedPlotOld:!1,firstArrow:!1,handDrawing:!1,label:{position:"lft"},lastArrow:!1,lineCap:"round",numberPointsHigh:1600,numberPointsLow:400,plotVersion:2,recursionDepthHigh:17,recursionDepthLow:15},foreignobject:{fixed:!0,visible:!0,needsRegularUpdate:!1,attractors:[]},functiongraph:{},glider:{label:{}},grid:{needsRegularUpdate:!1,hasGrid:!1,highlight:!1,gridX:null,gridY:null,majorStep:"auto",minorElements:0,forceSquare:!1,includeBoundaries:!1,size:void 0,face:void 0,margin:void 0,drawZero:void 0,polygonVertices:void 0,major:{size:5,face:"line",margin:0,drawZero:!0,polygonVertices:6},minor:{visible:"inherit",size:3,face:"point",margin:0,drawZero:!0,polygonVertices:6},snapToGrid:!1,strokeColor:"#c0c0c0",strokeWidth:1,strokeOpacity:.5,dash:0,theme:0,themes:[{},{forceSquare:"min",major:{face:"line"}},{major:{face:"line"},minor:{size:3,face:"point"},minorElements:"auto"},{major:{face:"line"},minor:{face:"line",strokeOpacity:.25},minorElements:"auto"},{major:{face:"line"},minor:{face:"+",size:"95%"},minorElements:"auto"},{major:{face:"+",size:10,strokeOpacity:1},minor:{face:"point",size:3},minorElements:"auto"},{major:{face:"circle",size:8,fillColor:"#c0c0c0"},minor:{face:"point",size:3},minorElements:"auto"}]},group:{needsRegularUpdate:!0},htmlslider:{widthRange:100,widthOut:34,step:.01,frozen:!0,isLabel:!1,strokeColor:"#000000",display:"html",anchorX:"left",anchorY:"middle",withLabel:!1},image:{imageString:null,fillOpacity:1,highlightFillOpacity:.6,cssClass:"JXGimage",highlightCssClass:"JXGimageHighlight",rotate:0,snapSizeX:1,snapSizeY:1,attractors:[]},implicitcurve:{margin:1,resolution_outer:5,resolution_inner:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0},incircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},inequality:{fillColor:JXG$1.palette.red,fillOpacity:.2,strokeColor:"none",inverse:!1},infobox:{distanceX:-20,distanceY:25,intl:{enabled:"inherit",options:{}},fontSize:12,isLabel:!1,strokeColor:"#bbbbbb",display:"html",anchorX:"left",anchorY:"middle",cssClass:"JXGinfobox",rotate:0,visible:!0,parse:!1,transitionDuration:0,needsRegularUpdate:!1,tabindex:null,viewport:[0,0,0,0]},integral:{axis:"x",withLabel:!0,fixed:!0,strokeWidth:0,strokeOpacity:0,fillColor:JXG$1.palette.red,fillOpacity:.3,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.2,curveLeft:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseLeft:{visible:!1,fixed:!1,withLabel:!1,name:""},curveRight:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseRight:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{fontSize:20,digits:4,intl:{enabled:!1,options:{}}}},input:{disabled:!1,maxlength:524288,display:"html"},intersection:{alwaysIntersect:!0},label:{visible:"inherit",strokeColor:"#000000",strokeOpacity:1,highlightStrokeOpacity:.666666,highlightStrokeColor:"#000000",fixed:!0,position:"urt",distance:1.5,offset:[10,10],autoPosition:!1,autoPositionMinDistance:12,autoPositionMaxDistance:28,autoPositionWhitelist:[]},legend:{style:"vertical",labels:["1","2","3","4","5","6","7","8"],colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],rowHeight:20,strokeWidth:5},line:{firstArrow:!1,lastArrow:!1,margin:0,straightFirst:!0,straightLast:!0,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",withTicks:!1,point1:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},ticks:{drawLabels:!0,label:{offset:[4,-9]},drawZero:!1,insertTicks:!1,ticksDistance:1,minTicksDistance:50,minorHeight:4,majorHeight:-1,minorTicks:4,strokeOpacity:.3,visible:"inherit"},label:{position:"llft"},snapToGrid:!1,snapSizeX:1,snapSizeY:1,touchFirstPoint:!1,touchLastPoint:!1},locus:{translateToOrigin:!1,translateTo10:!1,stretch:!1,toOrigin:null,to10:null},measurement:{baseUnit:"",units:{},dim:null,showPrefix:!0,showSuffix:!0,prefix:"",suffix:"",formatPrefix:function(n){return n},formatSuffix:function(n){return n},formatCoords:function(n,t,o){return parseFloat(o)!==1?"(NaN | NaN)":"("+n+", "+t+")"},formatDirection:function(n,t){return"("+n+", "+t+")"}},metapostspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.5,fillOpacity:.5,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},mirrorelement:{fixed:!0,point:{},center:{},type:"Euclidean"},nonreflexangle:{},normal:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},orthogonalprojection:{},otherintersection:{alwaysIntersect:!0,precision:.001},parallel:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{position:"llft"}},parallelogram:{parallelpoint:{withLabel:!1,name:""}},parallelpoint:{},perpendicular:{strokeColor:"#000000",straightFirst:!0,straightLast:!0},perpendicularsegment:{strokeColor:"#000000",straightFirst:!1,straightLast:!1,point:{visible:!1,fixed:!0,withLabel:!1,name:""}},point:{withLabel:!0,label:{},style:5,face:"o",size:3,sizeUnit:"screen",strokeWidth:2,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width","width","height","rx","ry"],fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",zoom:!1,showInfobox:"inherit",infoboxDigits:"auto",draft:!1,attractors:[],attractorUnit:"user",attractorDistance:0,snatchDistance:0,snapToGrid:!1,attractToGrid:!1,snapSizeX:1,snapSizeY:1,snapToPoints:!1,ignoredSnapToPoints:[]},polygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"},visible:"inherit"},highlightByStrokeWidth:!1,vertices:{layer:9,withLabel:!1,name:"",strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1,visible:"inherit"},label:{offset:[0,0]}},polygonalchain:{fillColor:"none",highlightFillColor:"none"},prescribedangle:{anglePoint:{size:2,visible:!1,withLabel:!1}},reflection:{fixed:!0,center:{},type:"Euclidean"},reflexangle:{},regularpolygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"}},vertices:{layer:9,withLabel:!0,strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1},label:{offset:[0,0]}},riemannsum:{withLabel:!1,fillOpacity:.3,fillColor:JXG$1.palette.yellow},sector:{fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,highlightOnSector:!1,highlightStrokeWidth:0,selection:"auto",arc:{visible:!1,fillColor:"none",withLabel:!1,name:"",center:{visible:!1,withLabel:!1,name:""},radiusPoint:{visible:!1,withLabel:!1,name:""},anglePoint:{visible:!1,withLabel:!1,name:""}},radiusPoint:{visible:!1,withLabel:!1},center:{visible:!1,withLabel:!1},anglePoint:{visible:!1,withLabel:!1},label:{offset:[0,0],anchorX:"auto",anchorY:"auto"}},segment:{label:{position:"top"}},semicircle:{center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#eeeeee",highlightStrokeColor:JXG$1.palette.red,name:""}},slider:{snapWidth:-1,snapValues:[],snapValueDistance:0,precision:2,digits:2,intl:{enabled:"inherit",options:{}},firstArrow:!1,lastArrow:!1,withTicks:!0,withLabel:!0,suffixLabel:null,unitLabel:null,postLabel:null,layer:9,showInfobox:!1,name:"",visible:!0,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"#ffffff",highlightFillColor:"none",size:6,point1:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},point2:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},baseline:{needsRegularUpdate:!1,visible:"inherit",fixed:!0,scalable:!1,tabindex:null,name:"",strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888"},ticks:{needsRegularUpdate:!1,fixed:!0,drawLabels:!1,digits:2,includeBoundaries:!0,drawZero:!0,label:{offset:[-4,-14],display:"internal"},minTicksDistance:30,insertTicks:!0,ticksDistance:1,minorHeight:4,majorHeight:5,minorTicks:0,strokeOpacity:1,strokeWidth:1,tickEndings:[0,1],majortickEndings:[0,1],strokeColor:"#000000",visible:"inherit"},highline:{strokeWidth:3,visible:"inherit",fixed:!0,tabindex:null,name:"",strokeColor:"#000000",highlightStrokeColor:"#888888"},label:{visible:"inherit",strokeColor:"#000000"},moveOnUp:!0},slopefield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!1,size:5,angle:Math.PI*.125}},slopetriangle:{fillColor:JXG$1.palette.red,fillOpacity:.4,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.3,borders:{lastArrow:{type:1,size:6}},glider:{fixed:!0,visible:!1,withLabel:!1},baseline:{visible:!1,withLabel:!1,name:""},basepoint:{visible:!1,withLabel:!1,name:""},tangent:{visible:!1,withLabel:!1,name:""},toppoint:{visible:!1,withLabel:!1,name:""},label:{visible:!0,position:"first"}},smartlabelangle:{cssClass:"smart-label-solid smart-label-angle",highlightCssClass:"smart-label-solid smart-label-angle",anchorX:"left",anchorY:"middle",unit:"",prefix:"",suffix:"",measure:"deg",useMathJax:!0},smartlabelcircle:{cssClass:"smart-label-solid smart-label-circle",highlightCssClass:"smart-label-solid smart-label-circle",anchorX:"middle",useMathJax:!0,unit:"",prefix:"",suffix:"",measure:"radius"},smartlabelline:{cssClass:"smart-label-solid smart-label-line",highlightCssClass:"smart-label-solid smart-label-line",anchorX:"middle",useMathJax:!0,unit:"",measure:"length"},smartlabelpoint:{cssClass:"smart-label-solid smart-label-point",highlightCssClass:"smart-label-solid smart-label-point",anchorX:"middle",anchorY:"top",useMathJax:!0,dir:"row",unit:""},smartlabelpolygon:{cssClass:"smart-label-solid smart-label-polygon",highlightCssClass:"smart-label-solid smart-label-polygon",anchorX:"middle",useMathJax:!0,unit:"",measure:"area"},stepfunction:{},tangent:{},tangentto:{polar:{visible:!1,strokeWidth:1,dash:3},point:{visible:!1}},tapemeasure:{strokeColor:"#000000",strokeWidth:2,highlightStrokeColor:"#000000",withTicks:!0,withLabel:!0,rotate:0,precision:2,digits:2,point1:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},point2:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},ticks:{drawLabels:!1,drawZero:!0,insertTicks:!0,ticksDistance:.1,minorHeight:8,majorHeight:16,minorTicks:4,tickEndings:[0,1],majorTickEndings:[0,1],strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",visible:"inherit",label:{anchorY:"top",anchorX:"middle",offset:[0,-10]}},label:{position:"top"}},text:{fontSize:12,fontUnit:"px",formatNumber:!1,digits:2,intl:{enabled:"inherit",options:{minimumFractionDigits:0,maximumFractionDigits:2}},parse:!0,useCaja:!1,isLabel:!1,strokeColor:"#000000",highlightStrokeColor:"#000000",highlightStrokeOpacity:.666666,cssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",highlightCssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",cssStyle:"",highlightCssStyle:"",transitionProperties:["color","opacity"],useASCIIMathML:!1,useMathJax:!1,useKatex:!1,katexMacros:{},toFraction:!1,display:"html",anchor:null,anchorX:"left",anchorY:"middle",cssClass:"JXGtext",highlightCssClass:"JXGtext",dragArea:"all",withLabel:!1,rotate:0,visible:!0,snapSizeX:1,snapSizeY:1,attractors:[]},tracecurve:{strokeColor:"#000000",fillColor:"none",numberPoints:100},turtle:{strokeWidth:1,fillColor:"none",strokeColor:"#000000",arrow:{strokeWidth:2,withLabel:!1,strokeColor:JXG$1.palette.red,lastArrow:!0}},vectorfield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},shortcuts:{color:["strokeColor","fillColor"],opacity:["strokeOpacity","fillOpacity"],highlightColor:["highlightStrokeColor","highlightFillColor"],highlightOpacity:["highlightStrokeOpacity","highlightFillOpacity"],strokeWidth:["strokeWidth","highlightStrokeWidth"]}};JXG$1.Validator=function(){var n,t=function(w){return/^[0-9]+px$/.test(w)},o=function(w){return w==="html"||w==="internal"},r=function(w){return JXG$1.isString(w)},u=function(w){return JXG$1.exists(JXG$1.normalizePointFace(w))},d=function(w){return Math.abs(w-Math.round(w))<Mat.eps},C=function(w){return d(w)&&w>=0},I=function(w){return d(w)&&w>0},f=function(w){return w==="vml"||w==="svg"||w==="canvas"||w==="no"},A=function(w){return w>0},G=function(w){return w>=0},B={},Z={attractorDistance:G,color:r,display:o,doAdvancedPlot:!1,draft:!1,drawLabels:!1,drawZero:!1,face:u,factor:JXG$1.isNumber,fillColor:r,fillOpacity:JXG$1.isNumber,firstArrow:!1,fontSize:d,dash:d,gridX:JXG$1.isNumber,gridY:JXG$1.isNumber,hasGrid:!1,highlightFillColor:r,highlightFillOpacity:JXG$1.isNumber,highlightStrokeColor:r,highlightStrokeOpacity:JXG$1.isNumber,insertTicks:!1,lastArrow:!1,layer:C,majorHeight:d,minorHeight:d,minorTicks:G,minTicksDistance:I,numberPointsHigh:I,numberPointsLow:I,opacity:JXG$1.isNumber,radius:JXG$1.isNumber,RDPsmoothing:!1,renderer:f,right:t,showCopyright:!1,showInfobox:!1,showNavigation:!1,size:G,snapSizeX:A,snapSizeY:A,snapWidth:JXG$1.isNumber,snapToGrid:!1,snatchDistance:G,straightFirst:!1,straightLast:!1,stretch:!1,strokeColor:r,strokeOpacity:JXG$1.isNumber,strokeWidth:G,takeFirst:!1,takeSizeFromFile:!1,to10:!1,toOrigin:!1,translateTo10:!1,translateToOrigin:!1,useASCIIMathML:!1,useDirection:!1,useMathJax:!1,withLabel:!1,withTicks:!1,zoom:!1};for(n in Z)Z.hasOwnProperty(n)&&(B[n.toLowerCase()]=Z[n]);return B}();JXG$1.normalizePointFace=function(n){var t={cross:"x",x:"x",circle:"o",o:"o",square:"[]","[]":"[]",plus:"+","+":"+",divide:"|","|":"|",minus:"-","-":"-",diamond:"<>","<>":"<>",diamond2:"<<>>","<<>>":"<<>>",triangleup:"^",A:"^",a:"^","^":"^",triangledown:"v",v:"v",triangleleft:"<","<":"<",triangleright:">",">":">"};return t[n]};JXG$1.useStandardOptions=function(n){var t,o,r,u,d=JXG$1.Options,C=n.hasGrid;n.options.grid.hasGrid=d.grid.hasGrid,n.options.grid.gridX=d.grid.gridX,n.options.grid.gridY=d.grid.gridY,n.options.grid.gridColor=d.grid.gridColor,n.options.grid.gridOpacity=d.grid.gridOpacity,n.options.grid.gridDash=d.grid.gridDash,n.options.grid.snapToGrid=d.grid.snapToGrid,n.options.grid.snapSizeX=d.grid.SnapSizeX,n.options.grid.snapSizeY=d.grid.SnapSizeY,n.takeSizeFromFile=d.takeSizeFromFile,u=function(I,f){I.visProp.fillcolor=f.fillColor,I.visProp.highlightfillcolor=f.highlightFillColor,I.visProp.strokecolor=f.strokeColor,I.visProp.highlightstrokecolor=f.highlightStrokeColor};for(t in n.objects)if(n.objects.hasOwnProperty(t))if(r=n.objects[t],r.elementClass===Const.OBJECT_CLASS_POINT)u(r,d.point);else if(r.elementClass===Const.OBJECT_CLASS_LINE)for(u(r,d.line),o=0;o<r.ticks.length;o++)r.ticks[o].majorTicks=d.line.ticks.majorTicks,r.ticks[o].minTicksDistance=d.line.ticks.minTicksDistance,r.ticks[o].visProp.minorheight=d.line.ticks.minorHeight,r.ticks[o].visProp.majorheight=d.line.ticks.majorHeight;else r.elementClass===Const.OBJECT_CLASS_CIRCLE?u(r,d.circle):r.type===Const.OBJECT_TYPE_ANGLE?u(r,d.angle):r.type===Const.OBJECT_TYPE_ARC?u(r,d.arc):r.type===Const.OBJECT_TYPE_POLYGON?u(r,d.polygon):r.type===Const.OBJECT_TYPE_CONIC?u(r,d.conic):r.type===Const.OBJECT_TYPE_CURVE?u(r,d.curve):r.type===Const.OBJECT_TYPE_SECTOR&&(r.arc.visProp.fillcolor=d.sector.fillColor,r.arc.visProp.highlightfillcolor=d.sector.highlightFillColor,r.arc.visProp.fillopacity=d.sector.fillOpacity,r.arc.visProp.highlightfillopacity=d.sector.highlightFillOpacity);n.fullUpdate(),C&&!n.hasGrid?n.removeGrids(n):!C&&n.hasGrid&&n.create("grid",[])};JXG$1.useBlackWhiteOptions=function(n){var t=JXG$1.Options;t.point.fillColor=JXG$1.rgb2bw(t.point.fillColor),t.point.highlightFillColor=JXG$1.rgb2bw(t.point.highlightFillColor),t.point.strokeColor=JXG$1.rgb2bw(t.point.strokeColor),t.point.highlightStrokeColor=JXG$1.rgb2bw(t.point.highlightStrokeColor),t.line.fillColor=JXG$1.rgb2bw(t.line.fillColor),t.line.highlightFillColor=JXG$1.rgb2bw(t.line.highlightFillColor),t.line.strokeColor=JXG$1.rgb2bw(t.line.strokeColor),t.line.highlightStrokeColor=JXG$1.rgb2bw(t.line.highlightStrokeColor),t.circle.fillColor=JXG$1.rgb2bw(t.circle.fillColor),t.circle.highlightFillColor=JXG$1.rgb2bw(t.circle.highlightFillColor),t.circle.strokeColor=JXG$1.rgb2bw(t.circle.strokeColor),t.circle.highlightStrokeColor=JXG$1.rgb2bw(t.circle.highlightStrokeColor),t.arc.fillColor=JXG$1.rgb2bw(t.arc.fillColor),t.arc.highlightFillColor=JXG$1.rgb2bw(t.arc.highlightFillColor),t.arc.strokeColor=JXG$1.rgb2bw(t.arc.strokeColor),t.arc.highlightStrokeColor=JXG$1.rgb2bw(t.arc.highlightStrokeColor),t.polygon.fillColor=JXG$1.rgb2bw(t.polygon.fillColor),t.polygon.highlightFillColor=JXG$1.rgb2bw(t.polygon.highlightFillColor),t.sector.fillColor=JXG$1.rgb2bw(t.sector.fillColor),t.sector.highlightFillColor=JXG$1.rgb2bw(t.sector.highlightFillColor),t.curve.strokeColor=JXG$1.rgb2bw(t.curve.strokeColor),t.grid.gridColor=JXG$1.rgb2bw(t.grid.gridColor),JXG$1.useStandardOptions(n)};JXG$1.Options.normalizePointFace=JXG$1.normalizePointFace;const Options=JXG$1.Options;JXG$1.AbstractRenderer=function(){this.vOffsetText=0,this.enhancedRendering=!0,this.container=null,this.type="",this.supportsForeignObject=!1,this.dashArray=[[2,2],[5,5],[10,10],[20,20],[20,10,10,10],[20,5,10,5],[0,5]]};JXG$1.extend(JXG$1.AbstractRenderer.prototype,{_updateVisual:function(n,t,o){(o||this.enhancedRendering)&&(t=t||{},this.setObjectViewport(n),this.setObjectTransition(n),JXG$1.evaluate(n.visProp.draft)?this.setDraft(n):(t.stroke||(n.highlighted?(this.setObjectStrokeColor(n,n.visProp.highlightstrokecolor,n.visProp.highlightstrokeopacity),this.setObjectStrokeWidth(n,n.visProp.highlightstrokewidth)):(this.setObjectStrokeColor(n,n.visProp.strokecolor,n.visProp.strokeopacity),this.setObjectStrokeWidth(n,n.visProp.strokewidth))),t.fill||(n.highlighted?this.setObjectFillColor(n,n.visProp.highlightfillcolor,n.visProp.highlightfillopacity):this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity)),t.dash||this.setDashStyle(n,n.visProp),t.shadow||this.setShadow(n),t.tabindex||this.setTabindex(n)))},_getHighlighted:function(n){var t=!1,o;return(!JXG$1.exists(n.board)||!JXG$1.exists(n.board.highlightedObjects))&&(t=!0),!t&&JXG$1.exists(n.board.highlightedObjects[n.id])?o="highlight":o="",o},drawPoint:function(n){var t,o=Options.normalizePointFace(JXG$1.evaluate(n.visProp.face));o==="o"?t="ellipse":o==="[]"?t="rect":t="path",n.rendNode=this.appendChildPrim(this.createPrim(t,n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,t),this._updateVisual(n,{dash:!0,shadow:!0},!0),this.updatePoint(n)},updatePoint:function(n){var t=JXG$1.evaluate(n.visProp.size),o=Options.normalizePointFace(JXG$1.evaluate(n.visProp.face)),r=JXG$1.evaluate(n.visProp.sizeunit),u=JXG$1.evaluate(n.visProp.zoom),d;isNaN(n.coords.scrCoords[2]+n.coords.scrCoords[1])||(r==="user"&&(t*=Math.sqrt(Math.abs(n.board.unitX*n.board.unitY))),t*=!n.board||!u?1:Math.sqrt(n.board.zoomX*n.board.zoomY),d=t===0?0:t+1,o==="o"?this.updateEllipsePrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2],d,d):o==="[]"?this.updateRectPrim(n.rendNode,n.coords.scrCoords[1]-t,n.coords.scrCoords[2]-t,t*2,t*2):this.updatePathPrim(n.rendNode,this.updatePathStringPoint(n,t,o),n.board),this._updateVisual(n,{dash:!1,shadow:!1}),this.setShadow(n))},changePointStyle:function(n){var t=this.getElementById(n.id);JXG$1.exists(t)&&this.remove(t),this.drawPoint(n),JXG$1.clearVisPropOld(n),n.visPropCalc.visible||this.display(n,!1),JXG$1.evaluate(n.visProp.draft)&&this.setDraft(n)},drawLine:function(n){n.rendNode=this.appendChildPrim(this.createPrim("line",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"lines"),this.updateLine(n)},updateLine:function(n){this._updateVisual(n),this.updatePathWithArrowHeads(n),this.setLineCap(n)},drawCurve:function(n){n.rendNode=this.appendChildPrim(this.createPrim("path",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"path"),this.updateCurve(n)},updateCurve:function(n){this._updateVisual(n),this.updatePathWithArrowHeads(n),this.setLineCap(n)},updatePathWithArrowHeads:function(n,t){var o=n.visProp,r=t?"highlight":"",u,d;t&&o.highlightstrokewidth?u=Math.max(JXG$1.evaluate(o.highlightstrokewidth),JXG$1.evaluate(o.strokewidth)):u=JXG$1.evaluate(o.strokewidth),d=this.getArrowHeadData(n,u,r),this.makeArrows(n,d),n.elementClass===Const.OBJECT_CLASS_LINE?this.updateLineWithEndings(n,d):n.elementClass===Const.OBJECT_CLASS_CURVE&&this.updatePath(n),this.setArrowSize(n,d)},getArrowHeadData:function(n,t,o){var r=Mat.eps,u,d,C=0,I=0,f=0,A=0,G=JXG$1.evaluate(n.visProp.firstarrow),B=JXG$1.evaluate(n.visProp.lastarrow),Z,w;return(G||B)&&(JXG$1.exists(G.type)?u=JXG$1.evaluate(G.type):n.elementClass===Const.OBJECT_CLASS_LINE?u=1:u=7,JXG$1.exists(B.type)?d=JXG$1.evaluate(B.type):n.elementClass===Const.OBJECT_CLASS_LINE?d=1:d=7,G&&(w=6,JXG$1.exists(G.size)&&(w=JXG$1.evaluate(G.size)),o!==""&&JXG$1.exists(G[o+"size"])&&(w=JXG$1.evaluate(G[o+"size"])),Z=t*w,u===2?(Z*=.5,r+=t*w):u===3?(Z=t*w/3,r+=t):u===4||u===5||u===6?(Z=t*w/1.5,r+=t*w):u===7?(Z=0,w=10,r+=t):r+=t*w,C+=Z,f=w),B&&(w=6,JXG$1.exists(B.size)&&(w=JXG$1.evaluate(B.size)),o!==""&&JXG$1.exists(B[o+"size"])&&(w=JXG$1.evaluate(B[o+"size"])),Z=t*w,d===2?(Z*=.5,r+=t*w):d===3?(Z=t*w/3,r+=t):d===4||d===5||d===6?(Z=t*w/1.5,r+=t*w):d===7?(Z=0,w=10,r+=t):r+=t*w,I+=Z,A=w)),n.visPropCalc.typeFirst=u,n.visPropCalc.typeLast=d,{evFirst:G,evLast:B,typeFirst:u,typeLast:d,offFirst:C,offLast:I,sizeFirst:f,sizeLast:A,showFirst:1,showLast:1,minLen:r,strokeWidth:t}},updateLineWithEndings:function(n,t){var o,r,u=null;return o=new Coords(Const.COORDS_BY_USER,n.point1.coords.usrCoords,n.board),r=new Coords(Const.COORDS_BY_USER,n.point2.coords.usrCoords,n.board),u=JXG$1.evaluate(n.visProp.margin),Geometry.calcStraight(n,o,r,u),this.handleTouchpoints(n,o,r,t),this.getPositionArrowHead(n,o,r,t),this.updateLinePrim(n.rendNode,o.scrCoords[1],o.scrCoords[2],r.scrCoords[1],r.scrCoords[2],n.board),this},updatePath:function(n){return JXG$1.evaluate(n.visProp.handdrawing)?this.updatePathPrim(n.rendNode,this.updatePathStringBezierPrim(n),n.board):this.updatePathPrim(n.rendNode,this.updatePathStringPrim(n),n.board),this},getPositionArrowHead:function(n,t,o,r){var u,d,C,I,f;return(r.evFirst||r.evLast)&&(d=C=I=f=0,u=t.distance(Const.COORDS_BY_SCREEN,o),r.evFirst&&n.board.renderer.type!=="vml"&&(u>=r.minLen?(d=(o.scrCoords[1]-t.scrCoords[1])*r.offFirst/u,C=(o.scrCoords[2]-t.scrCoords[2])*r.offFirst/u):r.showFirst=0),r.evLast&&n.board.renderer.type!=="vml"&&(u>=r.minLen?(I=(o.scrCoords[1]-t.scrCoords[1])*r.offLast/u,f=(o.scrCoords[2]-t.scrCoords[2])*r.offLast/u):r.showLast=0),t.setCoordinates(Const.COORDS_BY_SCREEN,[t.scrCoords[1]+d,t.scrCoords[2]+C],!1,!0),o.setCoordinates(Const.COORDS_BY_SCREEN,[o.scrCoords[1]-I,o.scrCoords[2]-f],!1,!0)),this},handleTouchpoints:function(n,t,o,r){var u,d,C,I,f,A,G;return(r.evFirst||r.evLast)&&(C=I=f=A=G=0,u=JXG$1.evaluate(n.point1.visProp.size)+JXG$1.evaluate(n.point1.visProp.strokewidth),d=JXG$1.evaluate(n.point2.visProp.size)+JXG$1.evaluate(n.point2.visProp.strokewidth),r.evFirst&&JXG$1.evaluate(n.visProp.touchfirstpoint)&&JXG$1.evaluate(n.point1.visProp.visible)&&(C=t.distance(Const.COORDS_BY_SCREEN,o),I=(o.scrCoords[1]-t.scrCoords[1])*u/C,f=(o.scrCoords[2]-t.scrCoords[2])*u/C),r.evLast&&JXG$1.evaluate(n.visProp.touchlastpoint)&&JXG$1.evaluate(n.point2.visProp.visible)&&(C=t.distance(Const.COORDS_BY_SCREEN,o),A=(o.scrCoords[1]-t.scrCoords[1])*d/C,G=(o.scrCoords[2]-t.scrCoords[2])*d/C),t.setCoordinates(Const.COORDS_BY_SCREEN,[t.scrCoords[1]+I,t.scrCoords[2]+f],!1,!0),o.setCoordinates(Const.COORDS_BY_SCREEN,[o.scrCoords[1]-A,o.scrCoords[2]-G],!1,!0)),this},setArrowSize:function(n,t){return t.evFirst&&this._setArrowWidth(n.rendNodeTriangleStart,t.showFirst*t.strokeWidth,n.rendNode,t.sizeFirst),t.evLast&&this._setArrowWidth(n.rendNodeTriangleEnd,t.showLast*t.strokeWidth,n.rendNode,t.sizeLast),this},setLineCap:function(n){},drawTicks:function(n){n.rendNode=this.appendChildPrim(this.createPrim("path",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"path")},updateTicks:function(n){},drawEllipse:function(n){n.rendNode=this.appendChildPrim(this.createPrim("ellipse",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"ellipse"),this.updateEllipse(n)},updateEllipse:function(n){this._updateVisual(n);var t=n.Radius();Math.abs(n.center.coords.usrCoords[0])>Mat.eps&&!isNaN(t+n.center.coords.scrCoords[1]+n.center.coords.scrCoords[2])&&t*n.board.unitX<2e6&&this.updateEllipsePrim(n.rendNode,n.center.coords.scrCoords[1],n.center.coords.scrCoords[2],t*n.board.unitX,t*n.board.unitY),this.setLineCap(n)},drawPolygon:function(n){n.rendNode=this.appendChildPrim(this.createPrim("polygon",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"polygon"),this.updatePolygon(n)},updatePolygon:function(n){this._updateVisual(n,{stroke:!0,dash:!0}),this.updatePolygonPrim(n.rendNode,n)},displayCopyright:function(n,t){},drawInternalText:function(n){},updateInternalText:function(n){},drawText:function(n){var t,o,r,u;JXG$1.evaluate(n.visProp.display)==="html"&&JXG$1.isBrowser&&this.type!=="no"?(t=this.container.ownerDocument.createElement("div"),t.style.position="absolute",t.className=JXG$1.evaluate(n.visProp.cssclass),r=JXG$1.evaluate(n.visProp.layer),JXG$1.exists(r)||(r=0),this.container.style.zIndex===""?o=0:o=parseInt(this.container.style.zIndex,10),t.style.zIndex=o+r,this.container.appendChild(t),t.setAttribute("id",this.container.id+"_"+n.id)):t=this.drawInternalText(n),n.rendNode=t,n.htmlStr="",n.visProp.islabel&&JXG$1.exists(n.visProp.anchor)?(u=JXG$1.evaluate(n.visProp.anchor.visProp.visible),n.prepareUpdate().updateVisibility(u)):n.prepareUpdate().updateVisibility(),this.updateText(n)},updateText:function(n){var t=n.plaintext,o,r,u,d,C,I,f,A,G,B,Z;if(n.visPropCalc.visible)if(this.updateTextStyle(n,!1),JXG$1.evaluate(n.visProp.display)==="html"&&this.type!=="no"){if(isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])||(r=n.coords.scrCoords[1],r=Math.abs(r)<1e6?r:1e6,C=n.getAnchorX(),C==="right"?(o=n.board.canvasWidth-r,B="right"):C==="middle"?(o=r-.5*n.size[0],B="center"):(o=r,B="left"),n.visPropOld.left!==C+o&&(C==="right"?(n.rendNode.style.right=o+"px",n.rendNode.style.left="auto"):(n.rendNode.style.left=o+"px",n.rendNode.style.right="auto"),n.visPropOld.left=C+o),r=n.coords.scrCoords[2]+this.vOffsetText,r=Math.abs(r)<1e6?r:1e6,I=n.getAnchorY(),I==="bottom"?(o=n.board.canvasHeight-r,Z="bottom"):I==="middle"?(o=r-.5*n.size[1],Z="center"):(o=r,Z="top"),n.visPropOld.top!==I+o&&(I==="bottom"?(n.rendNode.style.top="auto",n.rendNode.style.bottom=o+"px"):(n.rendNode.style.bottom="auto",n.rendNode.style.top=o+"px"),n.visPropOld.top=I+o)),n.htmlStr!==t){try{n.type===JXG$1.OBJECT_TYPE_BUTTON?n.rendNodeButton.innerHTML=t:n.type===JXG$1.OBJECT_TYPE_CHECKBOX||n.type===JXG$1.OBJECT_TYPE_INPUT?n.rendNodeLabel.innerHTML=t:n.rendNode.innerHTML=t}catch{u=n.rendNode.parentNode,n.rendNode.parentNode.removeChild(n.rendNode),n.rendNode.innerHTML=t,u.appendChild(n.rendNode)}if(n.htmlStr=t,JXG$1.evaluate(n.visProp.usemathjax))try{MathJax.typeset?MathJax.typeset([n.rendNode]):MathJax.Hub.Queue(["Typeset",MathJax.Hub,n.rendNode])}catch{JXG$1.debug("MathJax (not yet) loaded")}else if(JXG$1.evaluate(n.visProp.usekatex))try{n.rendNode.innerHTML.indexOf("<span")===0&&n.rendNode.innerHTML.indexOf("<label")>0&&(n.rendNode.innerHTML.indexOf("<checkbox")>0||n.rendNode.innerHTML.indexOf("<input")>0)?d=n.rendNodeLabel:n.rendNode.innerHTML.indexOf("<button")===0?d=n.rendNodeButton:d=n.rendNode,d&&katex.render(t,d,{macros:JXG$1.evaluate(n.visProp.katexmacros),throwOnError:!1})}catch{JXG$1.debug("KaTeX not loaded (yet)")}else if(JXG$1.evaluate(n.visProp.useasciimathml))try{AMprocessNode(n.rendNode,!1)}catch{JXG$1.debug("AsciiMathML not loaded (yet)")}}f=JXG$1.evaluate(n.visProp.rotate),f!==0&&(f*=Math.PI/180,A=Math.cos(f),G=Math.sin(f),n.rendNode.style.transform="matrix("+[A,-1*G,G,A,0,0].join(",")+")",n.rendNode.style["transform-origin"]=B+" "+Z),this.transformImage(n,n.transformations)}else this.updateInternalText(n)},_css2js:function(n){var t=[],o,r,u,d,C,I=JXG$1.trim(n).replace(/;$/,"").split(";");for(r=I.length,o=0;o<r;++o)JXG$1.trim(I[o])!==""&&(C=I[o].split(":"),u=JXG$1.trim(C[0].replace(/-([a-z])/gi,function(f,A){return A.toUpperCase()})),d=JXG$1.trim(C[1]),t.push({key:u,val:d}));return t},updateTextStyle:function(n,t){var o,r,u,d,C,I=n.visProp,f=JXG$1.isBrowser?I.display:"internal",A=["rendNode","rendNodeTag","rendNodeLabel"],G=A.length,B=JXG$1.evaluate(I.fontunit),Z,w,V,Y,J=["cssdefaultstyle","cssstyle"],T=J.length;if(t?(u=I.highlightstrokecolor,r=I.highlightstrokeopacity,d=I.highlightcssclass):(u=I.strokecolor,r=I.strokeopacity,d=I.cssclass),this.type!=="no"&&(f==="html"||this.type!=="canvas")){for(V=0;V<T;V++)if(Y=JXG$1.evaluate(I[(t?"highlight":"")+J[V]]),Y!==""&&n.visPropOld[J[V]]!==Y){for(Z=this._css2js(Y),C=0;C<G;C++)if(JXG$1.exists(n[A[C]]))for(w in Z)Z.hasOwnProperty(w)&&(n[A[C]].style[Z[w].key]=Z[w].val);n.visPropOld[J[V]]=Y}if(o=JXG$1.evaluate(I.fontsize),n.visPropOld.fontsize!==o){n.needsSizeUpdate=!0;try{for(C=0;C<G;C++)JXG$1.exists(n[A[C]])&&(n[A[C]].style.fontSize=o+B)}catch{for(C=0;C<G;C++)JXG$1.exists(n[A[C]])&&(n[A[C]].style.fontSize=o)}n.visPropOld.fontsize=o}}return this.setTabindex(n),this.setObjectTransition(n),f==="html"&&this.type!=="no"?(this.setObjectViewport(n,!0),n.visPropOld.cssclass!==d&&(n.rendNode.className=d,n.visPropOld.cssclass=d,n.needsSizeUpdate=!0),this.setObjectStrokeColor(n,u,r)):this.updateInternalTextStyle(n,u,r),this},updateInternalTextStyle:function(n,t,o){this.setObjectStrokeColor(n,t,o)},drawImage:function(n){},updateImage:function(n){this.updateRectPrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),this.updateImageURL(n),this.transformImage(n,n.transformations),this._updateVisual(n,{stroke:!0,dash:!0},!0)},joinTransforms:function(n,t){var o,r=n.board.origin.scrCoords[1],u=n.board.origin.scrCoords[2],d=n.board.unitX,C=n.board.unitY,I=t.length,f=[[1,0,0],[-r/d,1/d,0],[u/C,0,-1/C]];for(o=0;o<I;o++)f=Mat.matMatMult(t[o].matrix,f);return f=Mat.matMatMult([[1,0,0],[r,d,0],[u,0,-C]],f),f},transformImage:function(n,t){},updateImageURL:function(n){},updateImageStyle:function(n,t){n.rendNode.className=JXG$1.evaluate(t?n.visProp.highlightcssclass:n.visProp.cssclass)},drawForeignObject:function(n){},updateForeignObject:function(n){},appendChildPrim:function(n,t){},appendNodesToElement:function(n,t){},createPrim:function(n,t){return null},remove:function(n){},makeArrows:function(n,t){},_setArrowWidth:function(n,t,o){},updateEllipsePrim:function(n,t,o,r,u){},updateLinePrim:function(n,t,o,r,u,d){},updatePathPrim:function(n,t,o){},updatePathStringPoint:function(n,t,o){},updatePathStringPrim:function(n){},updatePathStringBezierPrim:function(n){},updatePolygonPrim:function(n,t){},updateRectPrim:function(n,t,o,r,u){},setPropertyPrim:function(n,t,o){},setTabindex:function(n){var t;n.board.attr.keyboard.enabled&&JXG$1.exists(n.rendNode)&&(t=JXG$1.evaluate(n.visProp.tabindex),(!n.visPropCalc.visible||JXG$1.evaluate(n.visProp.fixed))&&(t=null),t!==n.visPropOld.tabindex&&(n.rendNode.setAttribute("tabindex",t),n.visPropOld.tabindex=t))},display:function(n,t){n&&(n.visPropOld.visible=t)},show:function(n){},hide:function(n){},setBuffering:function(n,t){},setDashStyle:function(n){},setDraft:function(n){if(JXG$1.evaluate(n.visProp.draft)){var t=n.board.options.elements.draft.color,o=n.board.options.elements.draft.opacity;this.setObjectViewport(n),this.setObjectTransition(n),n.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(n,t,o):(n.elementClass===Const.OBJECT_CLASS_POINT?this.setObjectFillColor(n,t,o):this.setObjectFillColor(n,"none",0),this.setObjectStrokeColor(n,t,o),this.setObjectStrokeWidth(n,n.board.options.elements.draft.strokeWidth))}},removeDraft:function(n){this.setObjectViewport(n),this.setObjectTransition(n),n.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity):(n.type===Const.OBJECT_CLASS_POINT&&this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity),this.setObjectStrokeColor(n,n.visProp.strokecolor,n.visProp.strokeopacity),this.setObjectStrokeWidth(n,n.visProp.strokewidth))},setGradient:function(n){},updateGradient:function(n){},setObjectTransition:function(n,t){},setObjectViewport:function(n,t){},setObjectFillColor:function(n,t,o){},setObjectStrokeColor:function(n,t,o){},setObjectStrokeWidth:function(n,t){},setShadow:function(n){},highlight:function(n,t){var o,r,u=n.visProp,d;if(this.setObjectViewport(n),this.setObjectTransition(n),!u.draft){if(n.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(n,u.highlightfillcolor,u.highlightfillopacity),r=JXG$1.evaluate(u.highlightbystrokewidth),o=0;o<n.borders.length;o++)this.highlight(n.borders[o],!r);else n.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(n,!0):n.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(n,!0),this.setObjectFillColor(n,u.highlightfillcolor,u.highlightfillopacity)):(this.setObjectStrokeColor(n,u.highlightstrokecolor,u.highlightstrokeopacity),this.setObjectFillColor(n,u.highlightfillcolor,u.highlightfillopacity));u.highlightstrokewidth&&!t&&(d=Math.max(JXG$1.evaluate(u.highlightstrokewidth),JXG$1.evaluate(u.strokewidth)),this.setObjectStrokeWidth(n,d),(n.elementClass===Const.OBJECT_CLASS_LINE||n.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(n,!0))}return this},noHighlight:function(n){var t,o=n.visProp,r;if(this.setObjectViewport(n),this.setObjectTransition(n),!JXG$1.evaluate(n.visProp.draft)){if(n.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(n,o.fillcolor,o.fillopacity),t=0;t<n.borders.length;t++)this.noHighlight(n.borders[t]);else n.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(n,!1):n.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(n,!1),this.setObjectFillColor(n,o.fillcolor,o.fillopacity)):(this.setObjectStrokeColor(n,o.strokecolor,o.strokeopacity),this.setObjectFillColor(n,o.fillcolor,o.fillopacity));r=JXG$1.evaluate(o.strokewidth),this.setObjectStrokeWidth(n,r),(n.elementClass===Const.OBJECT_CLASS_LINE||n.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(n,!1)}return this},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(n,t){var o,r,u=function(C){C||(C=window.event),C.stopPropagation?C.stopPropagation():C.cancelBubble=!0},d=function(C,I,f,A){var G;f=f||"",G=o.createElement("span"),G.innerHTML=C,G.style.paddingLeft="7px",G.style.paddingRight="7px",G.classList!==void 0&&(G.classList.add("JXG_navigation_button"),G.classList.add("JXG_navigation_button_"+A)),G.setAttribute("id",f+"_navigation_"+A),r.appendChild(G),JXG$1.addEvent(G,"click",function(B){return JXG$1.bind(I,n)(),!1},n),JXG$1.addEvent(G,"pointerup",u,n),JXG$1.addEvent(G,"pointerdown",u,n),JXG$1.addEvent(G,"pointerleave",u,n),JXG$1.addEvent(G,"mouseup",u,n),JXG$1.addEvent(G,"mousedown",u,n),JXG$1.addEvent(G,"touchend",u,n),JXG$1.addEvent(G,"touchstart",u,n)};JXG$1.isBrowser&&this.type!=="no"&&(o=n.containerObj.ownerDocument,r=o.createElement("div"),r.setAttribute("id",n.container+"_navigationbar"),r.style.color=t.strokecolor,r.style.backgroundColor=t.fillcolor,r.style.padding=t.padding,r.style.position=t.position,r.style.fontSize=t.fontsize,r.style.cursor=t.cursor,r.style.zIndex=t.zindex,n.containerObj.appendChild(r),r.style.right=t.right,r.style.bottom=t.bottom,r.classList!==void 0&&r.classList.add("JXG_navigation"),n.attr.showfullscreen&&d(n.attr.fullscreen.symbol,function(){n.toFullscreen(n.attr.fullscreen.id)},n.container,"fullscreen"),n.attr.showscreenshot&&d(n.attr.screenshot.symbol,function(){window.setTimeout(function(){n.renderer.screenshot(n,"",!1)},330)},n.container,"screenshot"),n.attr.showreload&&d("",function(){n.reload()},n.container,"reload"),n.attr.showcleartraces&&d("",function(){n.clearTraces()},n.container,"cleartraces"),n.attr.shownavigation&&(n.attr.showzoom&&(d("",n.zoomOut,n.container,"out"),d("o",n.zoom100,n.container,"100"),d("+",n.zoomIn,n.container,"in")),d("",n.clickLeftArrow,n.container,"left"),d("",n.clickUpArrow,n.container,"down"),d("",n.clickDownArrow,n.container,"up"),d("",n.clickRightArrow,n.container,"right")))},getElementById:function(n){var t;return JXG$1.exists(this.container)?(t=this.container.id+"_"+n,JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(t=CSS.escape(t)),this.container.querySelector("#"+t)):""},removeToInsertLater:function(n){var t=n.parentNode,o=n.nextSibling;if(t!==null)return t.removeChild(n),function(){o?t.insertBefore(n,o):t.appendChild(n)}},resize:function(n,t){},createTouchpoints:function(n){},showTouchpoint:function(n){},hideTouchpoint:function(n){},updateTouchpoint:function(n,t){},dumpToDataURI:function(n){},dumpToCanvas:function(n,t,o,r){},screenshot:function(n){},setLayer:function(n,t){}});const AbstractRenderer=JXG$1.AbstractRenderer;var UTF8_ACCEPT=0,UTF8D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,12,24,36,60,96,84,12,12,12,48,72,12,12,12,12,12,12,12,12,12,12,12,12,12,0,12,12,12,12,12,0,12,0,12,12,12,24,12,12,12,12,12,24,12,24,12,12,12,12,12,12,12,12,12,24,12,12,12,12,12,24,12,12,12,12,12,12,12,24,12,12,12,12,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,12,12,12,12,12];JXG$1.Util=JXG$1.Util||{};JXG$1.Util.UTF8={encode:function(n){var t,o,r="",u=n.length;if(n=n.replace(/\r\n/g,`
`),typeof unescape=="function"&&typeof encodeURIComponent=="function")return unescape(encodeURIComponent(n));for(t=0;t<u;t++)o=n.charCodeAt(t),o<128?r+=String.fromCharCode(o):o>127&&o<2048?(r+=String.fromCharCode(o>>6|192),r+=String.fromCharCode(o&63|128)):(r+=String.fromCharCode(o>>12|224),r+=String.fromCharCode(o>>6&63|128),r+=String.fromCharCode(o&63|128));return r},decode:function(n){var t,o,r,u=0,d=0,C=UTF8_ACCEPT,I=[],f=n.length,A=[];for(t=0;t<f;t++)o=n.charCodeAt(t),r=UTF8D[o],C!==UTF8_ACCEPT?d=o&63|d<<6:d=255>>r&o,C=UTF8D[256+C+r],C===UTF8_ACCEPT&&(d>65535?I.push(55232+(d>>10),56320+(d&1023)):I.push(d),u++,u%1e4===0&&(A.push(String.fromCharCode.apply(null,I)),I=[]));return A.push(String.fromCharCode.apply(null,I)),A.join("")},asciiCharCodeAt:function(n,t){var o=n.charCodeAt(t);if(o>255)switch(o){case 8364:o=128;break;case 8218:o=130;break;case 402:o=131;break;case 8222:o=132;break;case 8230:o=133;break;case 8224:o=134;break;case 8225:o=135;break;case 710:o=136;break;case 8240:o=137;break;case 352:o=138;break;case 8249:o=139;break;case 338:o=140;break;case 381:o=142;break;case 8216:o=145;break;case 8217:o=146;break;case 8220:o=147;break;case 8221:o=148;break;case 8226:o=149;break;case 8211:o=150;break;case 8212:o=151;break;case 732:o=152;break;case 8482:o=153;break;case 353:o=154;break;case 8250:o=155;break;case 339:o=156;break;case 382:o=158;break;case 376:o=159;break}return o}};const Encoding=JXG$1.Util.UTF8;var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad="=";JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Base64={_getByte:function(n,t){return n.charCodeAt(t)&255},_getIndex:function(n,t){return alphabet.indexOf(n.charAt(t))},encode:function(n){var t,o,r,u,d,C=[];for(d=Encoding.encode(n),r=d.length,u=r%3,t=0;t<r-u;t+=3)o=this._getByte(d,t)<<16|this._getByte(d,t+1)<<8|this._getByte(d,t+2),C.push(alphabet.charAt(o>>18),alphabet.charAt(o>>12&63),alphabet.charAt(o>>6&63),alphabet.charAt(o&63));switch(u){case 1:o=this._getByte(d,r-1),C.push(alphabet.charAt(o>>2),alphabet.charAt(o<<4&63),pad,pad);break;case 2:o=this._getByte(d,r-2)<<8|this._getByte(d,r-1),C.push(alphabet.charAt(o>>10),alphabet.charAt(o>>4&63),alphabet.charAt(o<<2&63),pad);break}return C.join("")},decode:function(n,t){var o,r,u,d,C,I,f=[],A=[];if(o=n.replace(/[^A-Za-z0-9+/=]/g,""),u=o.length,u%4!==0)throw new Error("JSXGraph/utils/base64: Can't decode string (invalid input length).");for(o.charAt(u-1)===pad&&(d=1,o.charAt(u-2)===pad&&(d=2),u-=4),r=0;r<u;r+=4)C=this._getIndex(o,r)<<18|this._getIndex(o,r+1)<<12|this._getIndex(o,r+2)<<6|this._getIndex(o,r+3),A.push(C>>16,C>>8&255,C&255),r%1e4===0&&(f.push(String.fromCharCode.apply(null,A)),A=[]);switch(d){case 1:C=this._getIndex(o,u)<<12|this._getIndex(o,u+1)<<6|this._getIndex(o,u+2),A.push(C>>10,C>>2&255);break;case 2:C=this._getIndex(o,r)<<6|this._getIndex(o,r+1),A.push(C>>4);break}return f.push(String.fromCharCode.apply(null,A)),I=f.join(""),t&&(I=Encoding.decode(I)),I},decodeAsArray:function(n){var t,o=this.decode(n),r=[],u=o.length;for(t=0;t<u;t++)r[t]=o.charCodeAt(t);return r}};const Base64=JXG$1.Util.Base64;JXG$1.FileReader={handleRemoteFile:function(n,t,o,r,u,d){var C=!1;try{C=new XMLHttpRequest,o.toLowerCase()==="raw"?C.overrideMimeType("text/plain; charset="+u):C.overrideMimeType("text/xml; charset="+u)}catch{try{C=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{C=new ActiveXObject("Microsoft.XMLHTTP")}catch{C=!1}}}if(!C){JXG$1.debug("AJAX not activated!");return}C.open("GET",n,r),o.toLowerCase()==="raw"?this.cbp=function(){var I=C;I.readyState===4&&t(I.responseText)}:this.cbp=function(){var I=C,f="";I.readyState===4&&(JXG$1.exists(I.responseStream)&&(I.responseText.slice(0,2)==="PK"||Encoding.asciiCharCodeAt(I.responseText.slice(0,1),0)===31)?f=Base64.decode(jxgBinFileReader(I)):f=I.responseText,this.parseString(f,t,o,d))},this.cb=JXG$1.bind(this.cbp,this),C.onreadystatechange=this.cb;try{C.send(null)}catch{throw new Error("JSXGraph: A problem occurred while trying to read remote file '"+n+"'.")}},handleLocalFile:function(n,t,o,r,u,d){JXG$1.exists(r)||(r=!0),o.toLowerCase()==="raw"?this.cbp=function(I){t(I.target.result)}:this.cbp=function(I){var f=I.target.result;this.parseString(f,t,o,d)},this.cb=JXG$1.bind(this.cbp,this);var C=new FileReader;C.onload=this.cb,o.toLowerCase()==="raw"?C.readAsText(n):C.readAsText(n,u)},parseFileContent:function(n,t,o,r,u,d){JXG$1.isString(n)||FileReader===void 0?this.handleRemoteFile(n,t,o,r,u,d):this.handleLocalFile(n,t,o,r,u,d)},parseString:function(n,t,o,r){var u,d;if(o=o.toLowerCase(),u=JXG$1.readers[o],JXG$1.exists(u))d=new u(t,n),d.read();else if(o!=="jessiecode")throw new Error("JSXGraph: There is no reader available for '"+o+"'.");JXG$1.isFunction(r)&&r(t)}};!JXG$1.isMetroApp()&&JXG$1.isBrowser&&typeof navigator=="object"&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&document&&document.write&&document.write(`<script type="text/vbscript">
Function Base64Encode(inData)
  Const Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
  Dim cOut, sOut, I
  For I = 1 To LenB(inData) Step 3
    Dim nGroup, pOut, sGroup
    nGroup = &H10000 * AscB(MidB(inData, I, 1)) + _
      &H100 * MyASC(MidB(inData, I + 1, 1)) + MyASC(MidB(inData, I + 2, 1))
    nGroup = Oct(nGroup)
    nGroup = String(8 - Len(nGroup), "0") & nGroup
    pOut = Mid(Base64, CLng("&o" & Mid(nGroup, 1, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 3, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 5, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 7, 2)) + 1, 1)
    sOut = sOut + pOut
  Next
  Select Case LenB(inData) Mod 3
    Case 1: '8 bit final
      sOut = Left(sOut, Len(sOut) - 2) + "=="
    Case 2: '16 bit final
      sOut = Left(sOut, Len(sOut) - 1) + "="
  End Select
  Base64Encode = sOut
End Function

Function MyASC(OneChar)
  If OneChar = "" Then MyASC = 0 Else MyASC = AscB(OneChar)
End Function

Function jxgBinFileReader(xhr)
    Dim byteString
    Dim b64String
    Dim i
    byteString = xhr.responseBody
    ReDim byteArray(LenB(byteString))
    For i = 1 To LenB(byteString)
        byteArray(i-1) = AscB(MidB(byteString, i, 1))
    Next
    b64String = Base64Encode(byteString)
    jxgBinFileReader = b64String
End Function
<\/script>
`);const FileReader$1=JXG$1.FileReader;JXG$1.GeonextParser={replacePow:function(n){var t,o,r,u,d,C,I,f,A,G,B,Z;for(n=n.replace(/(\s*)\^(\s*)/g,"^"),G=n.indexOf("^"),u=-1;G>=0&&G<n.length-1;){if(u===G)throw new Error("JSXGraph: Error while parsing expression '"+n+"'");if(u=G,A=n.slice(0,G),B=n.slice(G+1),A.charAt(A.length-1)===")"){for(t=1,o=A.length-2;o>=0&&t>0;)r=A.charAt(o),r===")"?t++:r==="("&&(t-=1),o-=1;if(t===0){for(d="",I=A.substring(0,o+1),f=o;f>=0&&I.slice(f,f+1).match(/([\w.]+)/);)d=RegExp.$1+d,f-=1;d+=A.substring(o+1,A.length),d=d.replace(/([()+*%^\-/\][])/g,"\\$1")}else throw new Error("JSXGraph: Missing '(' in expression")}else d="[\\w\\.]+";if(B.match(/^([\w.]*\()/)){for(t=1,o=RegExp.$1.length;o<B.length&&t>0;)r=B.charAt(o),r===")"?t-=1:r==="("&&(t+=1),o+=1;if(t===0)C=B.substring(0,o),C=C.replace(/([()+*%^\-/[\]])/g,"\\$1");else throw new Error("JSXGraph: Missing ')' in expression")}else C="[\\w\\.]+";Z=new RegExp("("+d+")\\^("+C+")"),n=n.replace(Z,"pow($1,$2)"),G=n.indexOf("^")}return n},replaceIf:function(n){var t,o,r,u,d,C,I,f,A,G="",B=null,Z=null,w=null;if(r=n.indexOf("If("),r<0)return n;for(n=n.replace(/""/g,"0");r>=0;){for(t=n.slice(0,r),o=n.slice(r+3),d=1,u=0,C=-1,I=-1;u<o.length&&d>0;)f=o.charAt(u),f===")"?d-=1:f==="("?d+=1:f===","&&d===1&&(C<0?C=u:I=u),u+=1;if(A=o.slice(0,u-1),o=o.slice(u),C<0||I<0)return"";B=A.slice(0,C),Z=A.slice(C+1,I),w=A.slice(I+1),B=this.replaceIf(B),Z=this.replaceIf(Z),w=this.replaceIf(w),G+=t+"(("+B+")?("+Z+"):("+w+"))",n=o,B=null,Z=null,r=n.indexOf("If(")}return G+=o,G},replaceNameById:function(n,t,o){var r,u,d,C,I=0,f=["X","Y","L","V"],A=function(G){return o?"$('"+G+"')":G};for(C=0;C<f.length;C++)for(I=n.indexOf(f[C]+"(");I>=0;)I>=0&&(r=n.indexOf(")",I+2),r>=0&&(u=n.slice(I+2,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+2)+(o?"$('":"")+A(d.id)+n.slice(r)))),r=n.indexOf(")",I+2),I=n.indexOf(f[C]+"(",r);for(I=n.indexOf("Dist(");I>=0;)I>=0&&(r=n.indexOf(",",I+5),r>=0&&(u=n.slice(I+5,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+5)+A(d.id)+n.slice(r)))),r=n.indexOf(",",I+5),I=n.indexOf(",",r),r=n.indexOf(")",I+1),r>=0&&(u=n.slice(I+1,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+1)+A(d.id)+n.slice(r))),r=n.indexOf(")",I+1),I=n.indexOf("Dist(",r);for(f=["Deg","Rad"],C=0;C<f.length;C++)for(I=n.indexOf(f[C]+"(");I>=0;)I>=0&&(r=n.indexOf(",",I+4),r>=0&&(u=n.slice(I+4,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+4)+A(d.id)+n.slice(r)))),r=n.indexOf(",",I+4),I=n.indexOf(",",r),r=n.indexOf(",",I+1),r>=0&&(u=n.slice(I+1,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+1)+A(d.id)+n.slice(r))),r=n.indexOf(",",I+1),I=n.indexOf(",",r),r=n.indexOf(")",I+1),r>=0&&(u=n.slice(I+1,r),u=u.replace(/\\(['"])?/g,"$1"),d=t.elementsByName[u],d&&(n=n.slice(0,I+1)+A(d.id)+n.slice(r))),r=n.indexOf(")",I+1),I=n.indexOf(f[C]+"(",r);return n},replaceIdByObj:function(n){var t=/(X|Y|L)\(([\w_]+)\)/g;return n=n.replace(t,"$('$2').$1()"),t=/(V)\(([\w_]+)\)/g,n=n.replace(t,"$('$2').Value()"),t=/(Dist)\(([\w_]+),([\w_]+)\)/g,n=n.replace(t,"dist($('$2'), $('$3'))"),t=/(Deg)\(([\w_]+),([ \w[\w_]+),([\w_]+)\)/g,n=n.replace(t,"deg($('$2'),$('$3'),$('$4'))"),t=/Rad\(([\w_]+),([\w_]+),([\w_]+)\)/g,n=n.replace(t,"rad($('$1'),$('$2'),$('$3'))"),t=/N\((.+)\)/g,n=n.replace(t,"($1)"),n},geonext2JS:function(n,t){var o,r,u,d=["Abs","ACos","ASin","ATan","Ceil","Cos","Exp","Factorial","Floor","Log","Max","Min","Random","Round","Sin","Sqrt","Tan","Trunc"],C=["abs","acos","asin","atan","ceil","cos","exp","factorial","floor","log","max","min","random","round","sin","sqrt","tan","ceil"];for(n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),r=n,r=this.replaceNameById(r,t),r=this.replaceIf(r),r=this.replacePow(r),r=this.replaceIdByObj(r),u=0;u<d.length;u++)o=new RegExp(["(\\W|^)(",d[u],")"].join(""),"ig"),r=r.replace(o,["$1",C[u]].join(""));return r=r.replace(/True/g,"true"),r=r.replace(/False/g,"false"),r=r.replace(/fasle/g,"false"),r=r.replace(/Pi/g,"PI"),r=r.replace(/"/g,"'"),r},findDependencies:function(n,t,o){var r,u,d,C;JXG$1.exists(o)||(o=n.board),r=o.elementsByName;for(u in r)r.hasOwnProperty(u)&&u!==n.name&&(r[u].elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(r[u].visProp.islabel)||(C=u.replace(/\[/g,"\\["),C=C.replace(/\]/g,"\\]"),d=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+C+")(,[\\w\\[\\]'_ ]+)*\\)","g"),t.search(d)>=0&&r[u].addChild(n)):(C=u.replace(/\[/g,"\\["),C=C.replace(/\]/g,"\\]"),d=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+C+")(,[\\w\\[\\]'_ ]+)*\\)","g"),t.search(d)>=0&&r[u].addChild(n)))},gxt2jc:function(n,t){var o;return n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),o=n,o=this.replaceNameById(o,t,!0),o=o.replace(/True/g,"true"),o=o.replace(/False/g,"false"),o=o.replace(/fasle/g,"false"),o}};const GeonextParser=JXG$1.GeonextParser;JXG$1.GeometryElement=function(n,t,o,r){var u,d,C;if(this.needsUpdate=!0,this.isDraggable=!1,this.isReal=!0,this.childElements={},this.hasLabel=!1,this.highlighted=!1,this.notExistingParents={},this.traces={},this.numTraces=0,this.transformations=[],this.baseElement=null,this.descendants={},this.ancestors={},this.parents=[],this.symbolic={},this.rendNode=null,this.elType="",this.dump=!0,this.subs={},this.inherits=[],this._pos=-1,this.stdform=[1,0,0,0,1,1,0,0],this.methodMap={setLabel:"setLabel",label:"label",setName:"setName",getName:"getName",Name:"getName",addTransform:"addTransform",setProperty:"setAttribute",setAttribute:"setAttribute",addChild:"addChild",animate:"animate",on:"on",off:"off",trigger:"trigger",addTicks:"addTicks",removeTicks:"removeTicks",removeAllTicks:"removeAllTicks",Bounds:"bounds"},this.quadraticform=[[1,0,0],[0,1,0],[0,0,1]],this.visProp={},this.visPropCalc={visible:!1},EventEmitter.eventify(this),this.mouseover=!1,this.lastDragTime=new Date,this.view=null,arguments.length>0){this.board=n,this.type=o,this._org_type=o,this.elementClass=r||Const.OBJECT_CLASS_OTHER,this.id=t.id,u=t.name,JXG$1.exists(u)||(u=this.board.generateName(this)),u!==""&&(this.board.elementsByName[u]=this),this.name=u,this.needsRegularUpdate=t.needsregularupdate,JXG$1.clearVisPropOld(this),C=this.resolveShortcuts(t);for(d in C)C.hasOwnProperty(d)&&this._set(d,C[d]);this.visProp.draft=C.draft&&C.draft.draft}};JXG$1.extend(JXG$1.GeometryElement.prototype,{addChild:function(n){var t,o;this.childElements[n.id]=n,this.addDescendants(n),n.ancestors[this.id]=this;for(t in this.descendants)if(this.descendants.hasOwnProperty(t)){this.descendants[t].ancestors[this.id]=this;for(o in this.ancestors)this.ancestors.hasOwnProperty(o)&&(this.descendants[t].ancestors[this.ancestors[o].id]=this.ancestors[o])}for(t in this.ancestors)if(this.ancestors.hasOwnProperty(t))for(o in this.descendants)this.descendants.hasOwnProperty(o)&&(this.ancestors[t].descendants[this.descendants[o].id]=this.descendants[o]);return this},addDescendants:function(n){var t;this.descendants[n.id]=n;for(t in n.childElements)n.childElements.hasOwnProperty(t)&&this.addDescendants(n.childElements[t]);return this},addParents:function(n){var t,o,r;for(JXG$1.isArray(n)?r=n:r=arguments,o=r.length,t=0;t<o;++t)JXG$1.exists(r[t])&&(JXG$1.isId(this.board,r[t])?this.parents.push(r[t]):JXG$1.exists(r[t].id)&&this.parents.push(r[t].id));this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(n){this.parents=[],this.addParents(n)},addParentsFromJCFunctions:function(n){var t,o,r;for(t=0;t<n.length;t++)for(o in n[t].deps)r=n[t].deps[o],this.addParents(r),r.addChild(this);return this},removeChild:function(n){return delete this.childElements[n.id],this.removeDescendants(n),delete n.ancestors[this.id],this},removeDescendants:function(n){var t;delete this.descendants[n.id];for(t in n.childElements)n.childElements.hasOwnProperty(t)&&this.removeDescendants(n.childElements[t]);return this},countChildren:function(){var n,t,o=0;t=this.childElements;for(n in t)t.hasOwnProperty(n)&&n.indexOf("Label")<0&&o++;return o},getName:function(){return this.name},addTransform:function(n){return this},draggable:function(){return this.isDraggable&&!JXG$1.evaluate(this.visProp.fixed)&&this.type!==Const.OBJECT_TYPE_GLIDER},setPosition:function(n,t){var o=[],r,u,d,C;if(!JXG$1.exists(this.parents))return this;for(d=this.parents.length,u=0;u<d;++u)if(r=this.board.select(this.parents[u]),JXG$1.isPoint(r)){if(!r.draggable())return this;o.push(r)}if(t.length===3&&(t=t.slice(1)),C=this.board.create("transform",t,{type:"translate"}),d=o.length,d>0){if(C.applyOnce(o),JXG$1.exists(this.view)&&this.view.elType==="view3d")for(u=0;u<this.parents.length;++u)r=this.view.select(this.parents[u]),JXG$1.exists(r.setPosition2D)&&r.setPosition2D(C)}else this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(C):this.addTransform(C);for(u=0;u<d;++u)o[u].type===Const.OBJECT_TYPE_GLIDER&&o[u].updateGlider();return this},setPositionDirectly:function(n,t,o){var r=new Coords(n,t,this.board,!1),u=new Coords(n,o,this.board,!1),d=Statistics.subtract(r.usrCoords,u.usrCoords);return this.setPosition(Const.COORDS_BY_USER,d),this},generatePolynomial:function(){return[]},animate:function(n,t,o){o=o||{};var r,u,d,C=this.board.attr.animationdelay,I=Math.ceil(t/C),f=this,A=function(B,Z,w){var V,Y,J,T,L;for(V=JXG$1.rgb2hsv(B),Y=JXG$1.rgb2hsv(Z),J=(Y[0]-V[0])/I,T=(Y[1]-V[1])/I,L=(Y[2]-V[2])/I,f.animationData[w]=[],d=0;d<I;d++)f.animationData[w][I-d-1]=JXG$1.hsv2rgb(V[0]+(d+1)*J,V[1]+(d+1)*T,V[2]+(d+1)*L)},G=function(B,Z,w,V){var Y,J;if(B=parseFloat(B),Z=parseFloat(Z),!(isNaN(B)||isNaN(Z)))for(J=(Z-B)/I,f.animationData[w]=[],d=0;d<I;d++)Y=B+(d+1)*J,f.animationData[w][I-d-1]=V?Math.floor(Y):Y};this.animationData={};for(r in n)if(n.hasOwnProperty(r))switch(u=r.toLowerCase(),u){case"strokecolor":case"fillcolor":A(this.visProp[u],n[r],u);break;case"size":if(!JXG$1.isPoint(this))break;G(this.visProp[u],n[r],u,!0);break;case"strokeopacity":case"strokewidth":case"fillopacity":G(this.visProp[u],n[r],u,!1);break}return this.animationCallback=o.callback,this.board.addAnimation(this),this},update:function(){return JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(),this},updateRenderer:function(){return this},fullUpdate:function(n){return this.prepareUpdate().update().updateVisibility(n).updateRenderer()},setDisplayRendNode:function(n){var t,o,r,u,d;if(n===void 0&&(n=this.visPropCalc.visible),n===this.visPropOld.visible)return this;for(this.board.renderer.display(this,n),o=this.inherits.length,r=0;r<o;r++)if(d=this.inherits[r],JXG$1.isArray(d))for(u=d.length,t=0;t<u;t++)JXG$1.exists(d[t])&&JXG$1.exists(d[t].rendNode)&&JXG$1.evaluate(d[t].visProp.visible)==="inherit"&&d[t].setDisplayRendNode(n);else JXG$1.exists(d)&&JXG$1.exists(d.rendNode)&&JXG$1.evaluate(d.visProp.visible)==="inherit"&&d.setDisplayRendNode(n);return this.hasLabel&&JXG$1.exists(this.label)&&JXG$1.exists(this.label.rendNode)&&JXG$1.evaluate(this.label.visProp.visible)==="inherit"&&this.label.setDisplayRendNode(n),this},hide:function(){return this.setAttribute({visible:!1}),this},hideElement:function(){return this.hide(),this},show:function(){return this.setAttribute({visible:!0}),this},showElement:function(){return this.show(),this},updateVisibility:function(n){var t,o,r,u,d,C;if(this.needsUpdate){if(JXG$1.exists(this.view)&&JXG$1.evaluate(this.view.visProp.visible)===!1)this.visPropCalc.visible=!1;else for(n!==void 0?this.visPropCalc.visible=n:(C=JXG$1.evaluate(this.visProp.visible),JXG$1.exists(this.hiddenByParent)&&this.hiddenByParent&&(C=!1),C!=="inherit"&&(this.visPropCalc.visible=C)),o=this.inherits.length,r=0;r<o;r++)if(d=this.inherits[r],JXG$1.isArray(d))for(u=d.length,t=0;t<u;t++)JXG$1.exists(d[t])&&JXG$1.evaluate(d[t].visProp.visible)==="inherit"&&d[t].prepareUpdate().updateVisibility(this.visPropCalc.visible);else JXG$1.exists(d)&&JXG$1.evaluate(d.visProp.visible)==="inherit"&&d.prepareUpdate().updateVisibility(this.visPropCalc.visible);JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp)&&JXG$1.evaluate(this.label.visProp.visible)&&this.label.prepareUpdate().updateVisibility(this.visPropCalc.visible)}return this},_set:function(n,t){var o;if(n=n.toLocaleLowerCase(),this.visProp.hasOwnProperty(n)&&n.indexOf("color")>=0&&JXG$1.isString(t)&&t.length===9&&t.charAt(0)==="#")t=JXG$1.rgba2rgbo(t),this.visProp[n]=t[0],this.visProp[n.replace("color","opacity")]=t[1];else if(t!==null&&JXG$1.isObject(t)&&!JXG$1.exists(t.id)&&!JXG$1.exists(t.name)){this.visProp[n]={};for(o in t)t.hasOwnProperty(o)&&(this.visProp[n][o.toLocaleLowerCase()]=t[o])}else this.visProp[n]=t},resolveShortcuts:function(n){var t,o,r,u=["traceattributes","traceAttributes"];for(t in Options.shortcuts)if(Options.shortcuts.hasOwnProperty(t)){if(JXG$1.exists(n[t]))for(o=0;o<Options.shortcuts[t].length;o++)JXG$1.exists(n[Options.shortcuts[t][o]])||(n[Options.shortcuts[t][o]]=n[t]);for(r=0;r<u.length;r++)JXG$1.isObject(n[u[r]])&&(n[u[r]]=this.resolveShortcuts(n[u[r]]))}return n},setLabel:function(n){this.hasLabel||this.setAttribute({withlabel:!0}),this.setLabelText(n)},setLabelText:function(n){return JXG$1.exists(this.label)&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.label.setText(n)),this},setName:function(n){n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.elType!=="slider"&&this.setLabelText(n),this.setAttribute({name:n})},setProperty:function(){JXG$1.deprecated("setProperty()","setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(n){var t,o,r,u,d,C,I,f,A,G={};for(t=0;t<arguments.length;t++)C=arguments[t],JXG$1.isString(C)?(f=C.split(":"),G[JXG$1.trim(f[0])]=JXG$1.trim(f[1])):JXG$1.isArray(C)?G[C[0]]=C[1]:JXG$1.extend(G,C);G=this.resolveShortcuts(G);for(t in G)if(G.hasOwnProperty(t)){if(u=t.replace(/\s+/g,"").toLowerCase(),d=G[t],JXG$1.isObject(d)&&JXG$1.exists(this.visProp[u])){if(this.visProp[u]=JXG$1.merge(this.visProp[u],d),this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.exists(this.labels))for(r=this.labels.length,o=0;o<r;o++)this.labels[o].setAttribute(d);else if(JXG$1.exists(this[u]))if(JXG$1.isArray(this[u]))for(o=0;o<this[u].length;o++)this[u][o].setAttribute(d);else this[u].setAttribute(d);continue}switch(A=this.visProp[u],u){case"checked":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeCheckbox.checked=!!d);break;case"disabled":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.disabled=!!d);break;case"face":JXG$1.isPoint(this)&&(this.visProp.face=d,this.board.renderer.changePointStyle(this));break;case"generatelabelvalue":this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.isFunction(d)&&(this.generateLabelValue=d);break;case"gradient":this.visProp.gradient=d,this.board.renderer.setGradient(this);break;case"gradientsecondcolor":d=JXG$1.rgba2rgbo(d),this.visProp.gradientsecondcolor=d[0],this.visProp.gradientsecondopacity=d[1],this.board.renderer.updateGradient(this);break;case"gradientsecondopacity":this.visProp.gradientsecondopacity=d,this.board.renderer.updateGradient(this);break;case"infoboxtext":JXG$1.isString(d)?this.infoboxText=d:this.infoboxText=!1;break;case"labelcolor":d=JXG$1.rgba2rgbo(d),I=d[1],d=d[0],I===0&&JXG$1.exists(this.label)&&this.hasLabel&&this.label.hideElement(),JXG$1.exists(this.label)&&this.hasLabel&&(this.label.visProp.strokecolor=d,this.board.renderer.setObjectStrokeColor(this.label,d,I)),this.elementClass===Const.OBJECT_CLASS_TEXT&&(this.visProp.strokecolor=d,this.visProp.strokeopacity=I,this.board.renderer.setObjectStrokeColor(this,d,I));break;case"layer":this.board.renderer.setLayer(this,JXG$1.evaluate(d)),this._set(u,d);break;case"maxlength":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.maxlength=!!d);break;case"name":A=this.name,delete this.board.elementsByName[this.name],this.name=d,this.board.elementsByName[this.name]=this;break;case"needsregularupdate":this.needsRegularUpdate=!(d==="false"||d===!1),this.board.renderer.setBuffering(this,this.needsRegularUpdate?"auto":"static");break;case"onpolygon":this.type===Const.OBJECT_TYPE_GLIDER&&(this.onPolygon=!!d);break;case"radius":(this.type===Const.OBJECT_TYPE_ANGLE||this.type===Const.OBJECT_TYPE_SECTOR)&&this.setRadius(d);break;case"rotate":(this.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(this.visProp.display)==="internal"||this.type===Const.OBJECT_TYPE_IMAGE)&&this.addRotation(d);break;case"tabindex":JXG$1.exists(this.rendNode)&&(this.rendNode.setAttribute("tabindex",d),this._set(u,d));break;case"trace":d==="false"||d===!1?(this.clearTrace(),this.visProp.trace=!1):d==="pause"?this.visProp.trace=!1:this.visProp.trace=!0;break;case"visible":d==="false"?this.visProp.visible=!1:d==="true"?this.visProp.visible=!0:this.visProp.visible=d,this.setDisplayRendNode(JXG$1.evaluate(this.visProp.visible)),JXG$1.evaluate(this.visProp.visible)&&JXG$1.exists(this.updateSize)&&this.updateSize();break;case"withlabel":this.visProp.withlabel=d,JXG$1.evaluate(d)?(this.label||this.createLabel(),this.label.setAttribute({visible:"inherit"})):this.label&&this.hasLabel&&this.label.setAttribute({visible:!1}),this.hasLabel=d;break;case"straightfirst":case"straightlast":this._set(u,d);for(o in this.childElements)this.childElements.hasOwnProperty(o)&&this.childElements[o].elType==="glider"&&this.childElements[o].fullUpdate();break;default:JXG$1.exists(this.visProp[u])&&(!JXG$1.Validator[u]||JXG$1.Validator[u]&&JXG$1.Validator[u](d)||JXG$1.Validator[u]&&JXG$1.isFunction(d)&&JXG$1.Validator[u](d()))&&(d=d.toLowerCase&&d.toLowerCase()==="false"?!1:d,this._set(u,d));break}this.triggerEventHandlers(["attribute:"+u],[A,d,this])}return this.triggerEventHandlers(["attribute"],[G,this]),JXG$1.evaluate(this.visProp.needsregularupdate)?this.board.update(this):this.board.fullUpdate(),this.elementClass===Const.OBJECT_CLASS_TEXT&&this.updateSize(),this},getProperty:function(){JXG$1.deprecated("getProperty()","getAttribute()"),this.getProperty.apply(this,arguments)},getAttribute:function(n){var t;switch(n=n.toLowerCase(),n){case"needsregularupdate":t=this.needsRegularUpdate;break;case"labelcolor":t=this.label.visProp.strokecolor;break;case"infoboxtext":t=this.infoboxText;break;case"withlabel":t=this.hasLabel;break;default:t=this.visProp[n];break}return t},setDash:function(n){return this.setAttribute({dash:n}),this},prepareUpdate:function(){return this.needsUpdate=!0,this},remove:function(){return this.board.renderer.remove(this.rendNode),this.hasLabel&&this.board.renderer.remove(this.board.renderer.getElementById(this.label.id)),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},getLabelAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},setArrow:function(n,t){return this.visProp.firstarrow=n,this.visProp.lastarrow=t,t&&(this.type=Const.OBJECT_TYPE_VECTOR,this.elType="arrow"),this.prepareUpdate().update().updateVisibility().updateRenderer(),this},createGradient:function(){var n=JXG$1.evaluate(this.visProp.gradient);(n==="linear"||n==="radial")&&this.board.renderer.setGradient(this)},createLabel:function(){var n,t=this;return JXG$1.elements.text?(n=JXG$1.deepCopy(this.visProp.label,null),n.id=this.id+"Label",n.isLabel=!0,n.anchor=this,n.priv=this.visProp.priv,this.visProp.withlabel&&(this.label=JXG$1.elements.text(this.board,[0,0,function(){return JXG$1.isFunction(t.name)?t.name():t.name}],n),this.label.needsUpdate=!0,this.label.dump=!1,this.label.fullUpdate(),this.hasLabel=!0)):JXG$1.debug("JSXGraph: Can't create label: text element is not available. Make sure you include base/text"),this},highlight:function(n){return n=JXG$1.def(n,!1),JXG$1.evaluate(this.visProp.highlight)&&(!this.highlighted||n)&&(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this)),this},noHighlight:function(){return this.highlighted&&(this.highlighted=!1,delete this.board.highlightedObjects[this.id],this.board.renderer.noHighlight(this)),this},clearTrace:function(){var n;for(n in this.traces)this.traces.hasOwnProperty(n)&&this.board.renderer.remove(this.traces[n]);return this.numTraces=0,this},cloneToBackground:function(){return this},bounds:function(){return[0,0,0,0]},normalize:function(){return this.stdform=Mat.normalize(this.stdform),this},toJSON:function(){var n,t,o=['{"name":',this.name];o.push(', "id":'+this.id),n=[];for(t in this.visProp)this.visProp.hasOwnProperty(t)&&JXG$1.exists(this.visProp[t])&&n.push('"'+t+'":'+this.visProp[t]);return o.push(', "visProp":{'+n.toString()+"}"),o.push("}"),o.join("")},addRotation:function(n){var t,o,r,u,d,C=this;return(this.elementClass===Const.OBJECT_CLASS_TEXT||this.type===Const.OBJECT_TYPE_IMAGE)&&n!==0&&(t=this.board.create("transform",[function(){return-C.X()},function(){return-C.Y()}],{type:"translate"}),o=this.board.create("transform",[function(){return C.X()},function(){return C.Y()}],{type:"translate"}),r=this.board.create("transform",[function(){return C.board.unitX/C.board.unitY},function(){return 1}],{type:"scale"}),u=this.board.create("transform",[function(){return C.board.unitY/C.board.unitX},function(){return 1}],{type:"scale"}),d=this.board.create("transform",[function(){return JXG$1.evaluate(n)*Math.PI/180}],{type:"rotate"}),t.bindTo(this),r.bindTo(this),d.bindTo(this),u.bindTo(this),o.bindTo(this)),this},highlightStrokeColor:function(n){return JXG$1.deprecated("highlightStrokeColor()","setAttribute()"),this.setAttribute({highlightStrokeColor:n}),this},strokeColor:function(n){return JXG$1.deprecated("strokeColor()","setAttribute()"),this.setAttribute({strokeColor:n}),this},strokeWidth:function(n){return JXG$1.deprecated("strokeWidth()","setAttribute()"),this.setAttribute({strokeWidth:n}),this},fillColor:function(n){return JXG$1.deprecated("fillColor()","setAttribute()"),this.setAttribute({fillColor:n}),this},highlightFillColor:function(n){return JXG$1.deprecated("highlightFillColor()","setAttribute()"),this.setAttribute({highlightFillColor:n}),this},labelColor:function(n){return JXG$1.deprecated("labelColor()","setAttribute()"),this.setAttribute({labelColor:n}),this},dash:function(n){return JXG$1.deprecated("dash()","setAttribute()"),this.setAttribute({dash:n}),this},visible:function(n){return JXG$1.deprecated("visible()","setAttribute()"),this.setAttribute({visible:n}),this},shadow:function(n){return JXG$1.deprecated("shadow()","setAttribute()"),this.setAttribute({shadow:n}),this},getType:function(){return this.elType},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},snapToGrid:function(){return this},snapToPoints:function(){return this},getAttributes:function(){var n=JXG$1.deepCopy(this.visProp),t=[],o,r=t.length;for(n.id=this.id,n.name=this.name,o=0;o<r;o++)delete n[t[o]];return n},hasPoint:function(n,t){return!1},addTicks:function(n){return(n.id===""||!JXG$1.exists(n.id))&&(n.id=this.id+"_ticks_"+(this.ticks.length+1)),this.board.renderer.drawTicks(n),this.ticks.push(n),n.id},removeAllTicks:function(){var n;if(JXG$1.exists(this.ticks)){for(n=this.ticks.length-1;n>=0;n--)this.removeTicks(this.ticks[n]);this.ticks=[],this.board.update()}},removeTicks:function(n){var t,o;if(JXG$1.exists(this.defaultTicks)&&this.defaultTicks===n&&(this.defaultTicks=null),JXG$1.exists(this.ticks)){for(t=this.ticks.length-1;t>=0;t--)if(this.ticks[t]===n){if(this.board.removeObject(this.ticks[t]),this.ticks[t].ticks)for(o=0;o<this.ticks[t].ticks.length;o++)JXG$1.exists(this.ticks[t].labels[o])&&this.board.removeObject(this.ticks[t].labels[o]);delete this.ticks[t];break}}},getSnapSizes:function(){var n,t,o;return n=JXG$1.evaluate(this.visProp.snapsizex),t=JXG$1.evaluate(this.visProp.snapsizey),n<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(o=this.board.defaultAxes.x.defaultTicks,n=o.ticksDelta*(JXG$1.evaluate(o.visProp.minorticks)+1)),t<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(o=this.board.defaultAxes.y.defaultTicks,t=o.ticksDelta*(JXG$1.evaluate(o.visProp.minorticks)+1)),[n,t]},handleSnapToGrid:function(n,t){var o,r,u,d,C,I,f,A,G,B,Z,w=!1,V=JXG$1.evaluate(this.visProp.attracttogrid),Y=JXG$1.evaluate(this.visProp.attractorunit),J=JXG$1.evaluate(this.visProp.attractordistance);return!JXG$1.exists(this.coords)||JXG$1.evaluate(this.visProp.fixed)?this:(w=JXG$1.evaluate(this.visProp.snaptogrid)||V||n===!0,w&&(o=this.coords.usrCoords[1],r=this.coords.usrCoords[2],G=this.getSnapSizes(),B=G[0],Z=G[1],B>0&&Z>0&&(A=this.board.getBoundingBox(),u=Math.round(o/B)*B,d=Math.round(r/Z)*Z,C=new JXG$1.Coords(Const.COORDS_BY_USER,[u,d],this.board),(!V||C.distance(Y==="screen"?Const.COORDS_BY_SCREEN:Const.COORDS_BY_USER,this.coords)<J)&&(o=u,r=d,t||(I=Math.min(A[0],A[2]),f=Math.max(A[0],A[2]),o<I&&o>I-B?o+=B:o>f&&o<f+B&&(o-=B),I=Math.min(A[1],A[3]),f=Math.max(A[1],A[3]),r<I&&r>I-Z?r+=Z:r>f&&r<f+Z&&(r-=Z)),this.coords.setCoordinates(Const.COORDS_BY_USER,[o,r])))),this)},getBoundingBox:function(){var n,t,o,r,u,d=[1/0,1/0,-1/0,-1/0];if(this.type===Const.OBJECT_TYPE_POLYGON){if(t=this.vertices.length-1,t<=0)return d;for(n=0;n<t;n++)o=this.vertices[n].X(),d[0]=o<d[0]?o:d[0],d[2]=o>d[2]?o:d[2],o=this.vertices[n].Y(),d[1]=o<d[1]?o:d[1],d[3]=o>d[3]?o:d[3]}else if(this.elementClass===Const.OBJECT_CLASS_CIRCLE)r=this.center.X(),u=this.center.Y(),d=[r-this.radius,u+this.radius,r+this.radius,u-this.radius];else if(this.elementClass===Const.OBJECT_CLASS_CURVE){if(t=this.vertices.length,t===0)return d;for(n=0;n<t;n++)o=this.points[n].coords.usrCoords[1],d[0]=o<d[0]?o:d[0],d[2]=o>d[2]?o:d[2],o=this.points[n].coords.usrCoords[1],d[1]=o<d[1]?o:d[1],d[3]=o>d[3]?o:d[3]}return d},addEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"on"),removeEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"off"),formatNumberLocale:function(n,t){var o,r,u,d={},C={maximumfractiondigits:"maximumFractionDigits",minimumfractiondigits:"minimumFractionDigits",compactdisplay:"compactDisplay",currencydisplay:"currencyDisplay",currencysign:"currencySign",localematcher:"localeMatcher",numberingsystem:"numberingSystem",signdisplay:"signDisplay",unitdisplay:"unitDisplay",usegrouping:"useGrouping",roundingmode:"roundingMode",roundingpriority:"roundingPriority",roundingincrement:"roundingIncrement",trailingzerodisplay:"trailingZeroDisplay",minimumintegerdigits:"minimumIntegerDigits",minimumsignificantdigits:"minimumSignificantDigits",maximumsignificantdigits:"maximumSignificantDigits"};if(JXG$1.exists(Intl)&&this.useLocale()){o=JXG$1.evaluate(this.visProp.intl.locale)||JXG$1.evaluate(this.board.attr.intl.locale),r=JXG$1.evaluate(this.visProp.intl.options)||{};for(u in r)r.hasOwnProperty(u)&&(C.hasOwnProperty(u)?d[C[u]]=JXG$1.evaluate(r[u]):d[u]=JXG$1.evaluate(r[u]));return u="maximumfractiondigits",JXG$1.exists(r[u])||(d[C[u]]=t),Intl.NumberFormat(o,d).format(n)}return n},useLocale:function(){var n;return!JXG$1.exists(this.visProp.intl)||!JXG$1.exists(this.visProp.intl.enabled)?!1:(n=JXG$1.evaluate(this.visProp.intl.enabled),n===!0||n==="inherit"&&JXG$1.evaluate(this.board.attr.intl.enabled)===!0)},__evt__over:function(n){},__evt__mouseover:function(n){},__evt__out:function(n){},__evt__mouseout:function(n){},__evt__move:function(n){},__evt__mousemove:function(n){},__evt__drag:function(n){},__evt__mousedrag:function(n){},__evt__pendrag:function(n){},__evt__touchdrag:function(n){},__evt__keydrag:function(n){},__evt__down:function(n){},__evt__mousedown:function(n){},__evt__pendown:function(n){},__evt__touchdown:function(n){},__evt__click:function(n){},__evt__dblclick:function(n){},__evt__mouseclick:function(n){},__evt__mousedblclick:function(n){},__evt__pointerclick:function(n){},__evt__pointerdblclick:function(n){},__evt__up:function(n){},__evt__mouseup:function(n){},__evt__penup:function(n){},__evt__touchup:function(n){},__evt__attribute:function(n,t){},__evt__attribute_:function(n,t,o){},__evt:function(){}});const GeometryElement=JXG$1.GeometryElement;JXG$1.CoordsElement=function(n,t){var o;for(JXG$1.exists(n)||(n=[1,0,0]),o=0;o<n.length;++o)n[o]=parseFloat(n[o]);this.coords=new Coords(Const.COORDS_BY_USER,n,this.board),this.initialCoords=new Coords(Const.COORDS_BY_USER,n,this.board),this.position=null,this.isConstrained=!1,this.onPolygon=!1,this.slideObject=null,this.slideObjects=[],this.needsUpdateFromParent=!0,this.groups=[],this.Xjc=null,this.Yjc=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{move:"moveTo",moveTo:"moveTo",moveAlong:"moveAlong",visit:"visit",glide:"makeGlider",makeGlider:"makeGlider",intersect:"makeIntersection",makeIntersection:"makeIntersection",X:"X",Y:"Y",Coords:"Coords",free:"free",setPosition:"setGliderPosition",setGliderPosition:"setGliderPosition",addConstraint:"addConstraint",dist:"Dist",Dist:"Dist",onPolygon:"onPolygon",startAnimation:"startAnimation",stopAnimation:"stopAnimation"}),JXG$1.exists(this.element)&&this.addAnchor(n,t),this.isDraggable=!0};JXG$1.extend(JXG$1.CoordsElement.prototype,{updateConstraint:function(){return this},updateCoords:function(n){return this.needsUpdate?(JXG$1.exists(n)||(n=!1),JXG$1.evaluate(this.visProp.frozen)||this.updateConstraint(),this.type===Const.OBJECT_TYPE_GLIDER&&(this.isConstrained&&(n=!1),n?this.updateGliderFromParent():this.updateGlider()),this.updateTransform(n),this):this},updateGlider:function(){var n,t,o,r,u,d,C,I,f,A,G,B,Z=2*Math.PI,w,V,Y,J,T,L=!1,z,K,P,$=this.slideObject,ie,ne,ee=[],se;if(this.needsUpdateFromParent=!1,$.elementClass===Const.OBJECT_CLASS_CIRCLE)JXG$1.evaluate(this.visProp.isgeonext)&&(Z=1),J=Geometry.projectPointToCircle(this,$,this.board),T=Geometry.rad([$.center.X()+1,$.center.Y()],$.center,this)/Z;else if($.elementClass===Const.OBJECT_CLASS_LINE){if(this.onPolygon){if(r=$.point1.coords.usrCoords,u=$.point2.coords.usrCoords,n=1,t=u[n]-r[n],Math.abs(t)<Mat.eps&&(n=2,t=u[n]-r[n]),C=Geometry.projectPointToLine(this,$,this.board),I=(C.usrCoords[n]-r[n])/t,d=$.parentPolygon,I<0){for(n=0;n<d.borders.length;n++)if($===d.borders[n]){$=d.borders[(n-1+d.borders.length)%d.borders.length];break}}else if(I>1){for(n=0;n<d.borders.length;n++)if($===d.borders[n]){$=d.borders[(n+1+d.borders.length)%d.borders.length];break}}$.id!==this.slideObject.id&&(this.slideObject=$)}r=$.point1.coords,u=$.point2.coords,t=r.distance(Const.COORDS_BY_USER,u),t<Mat.eps?(J=r,L=!0,T=0):(J=Geometry.projectPointToLine(this,$,this.board),r=r.usrCoords.slice(0),u=u.usrCoords.slice(0),Math.abs(u[0])<Mat.eps?(n=1,t=u[n],Math.abs(t)<Mat.eps&&(n=2,t=u[n]),t=(J.usrCoords[n]-r[n])/t,A=t>=0?1:-1,t=Math.abs(t),T=A*t/(t+1)):Math.abs(r[0])<Mat.eps?(n=1,t=r[n],Math.abs(t)<Mat.eps&&(n=2,t=r[n]),t=(J.usrCoords[n]-u[n])/t,t<0?T=(1-2*t)/(1-t):T=1/(t+1)):(n=1,t=u[n]-r[n],Math.abs(t)<Mat.eps&&(n=2,t=u[n]-r[n]),T=(J.usrCoords[n]-r[n])/t)),K=this.findClosestSnapValue(T),K!==null?(P=JXG$1.evaluate(this.visProp.snapvalues),T=(P[K]-this._smin)/(this._smax-this._smin),this.update(!0)):(z=JXG$1.evaluate(this.visProp.snapwidth),JXG$1.evaluate(z)>0&&Math.abs(this._smax-this._smin)>=Mat.eps&&(T=Math.max(Math.min(T,1),0),o=T*(this._smax-this._smin)+this._smin,o=Math.round(o/z)*z,T=(o-this._smin)/(this._smax-this._smin),this.update(!0))),r=$.point1.coords,!JXG$1.evaluate($.visProp.straightfirst)&&Math.abs(r.usrCoords[0])>Mat.eps&&T<0&&(J=r,L=!0,T=0),u=$.point2.coords,!JXG$1.evaluate($.visProp.straightlast)&&Math.abs(u.usrCoords[0])>Mat.eps&&T>1&&(J=u,L=!0,T=1)}else if($.type===Const.OBJECT_TYPE_TURTLE)this.updateConstraint(),ie=Geometry.projectPointToTurtle(this,$,this.board),J=ie[0],T=ie[1];else if($.elementClass===Const.OBJECT_CLASS_CURVE)if($.type===Const.OBJECT_TYPE_ARC||$.type===Const.OBJECT_TYPE_SECTOR)J=Geometry.projectPointToCircle(this,$,this.board),f=Geometry.rad($.radiuspoint,$.center,this),G=0,B=Geometry.rad($.radiuspoint,$.center,$.anglepoint),T=f,z=JXG$1.evaluate($.visProp.selection),(z==="minor"&&B>Math.PI||z==="major"&&B<Math.PI)&&(G=B,B=2*Math.PI),(f<G||f>B)&&(T=B,(f<G&&f>G*.5||f>B&&f>B*.5+Math.PI)&&(T=G),this.needsUpdateFromParent=!0,this.updateGliderFromParent()),Z=B-G,this.visProp.isgeonext&&(Z=1),Math.abs(Z)>Mat.eps&&(T/=Z);else if(this.updateConstraint(),$.transformations.length>0){for(se=!1,ie=$.getTransformationSource(),ie[0]&&(se=ie[0],ee.push($),ee.push(ie[1]));ie[0]&&JXG$1.exists(ie[1]._transformationSource);)ie=ie[1].getTransformationSource(),ee.push(ie[1]);if(ne=this.coords.usrCoords,se){for(n=0;n<ee.length;n++)ee[n].updateTransformMatrix(),Y=Mat.inverse(ee[n].transformMat),ne=Mat.matVecMult(Y,ne);for(w=new Coords(Const.COORDS_BY_USER,ne,this.board).usrCoords,V=Geometry.projectCoordsToCurve(w[1],w[2],this.position||0,ee[ee.length-1],this.board),ne=V[0].usrCoords,n=ee.length-2;n>=0;n--)ne=Mat.matVecMult(ee[n].transformMat,ne);V[0]=new Coords(Const.COORDS_BY_USER,ne,this.board)}else $.updateTransformMatrix(),Y=Mat.inverse($.transformMat),ne=Mat.matVecMult(Y,ne),w=new Coords(Const.COORDS_BY_USER,ne,this.board).usrCoords,V=Geometry.projectCoordsToCurve(w[1],w[2],this.position||0,$,this.board);J=V[0],T=V[1]}else ie=Geometry.projectPointToCurve(this,$,this.board),J=ie[0],T=ie[1];else JXG$1.isPoint($)&&(J=Geometry.projectPointToPoint(this,$,this.board),T=this.position);this.coords.setCoordinates(Const.COORDS_BY_USER,J.usrCoords,L),this.position=T},findClosestSnapValue:function(n){var t,o,r,u,d=null;if(r=JXG$1.evaluate(this.visProp.snapvalues),u=JXG$1.evaluate(this.visProp.snapvaluedistance),JXG$1.isArray(r)&&Math.abs(this._smax-this._smin)>=Mat.eps&&u>0)for(t=0;t<r.length;t++)o=Math.abs(n*(this._smax-this._smin)+this._smin-r[t]),o<u&&(u=o,d=t);return d},updateGliderFromParent:function(){var n,t,o,r,u,d=this.slideObject,C=[],I,f,A,G,B,Z,w,V=2*Math.PI;if(!this.needsUpdateFromParent){this.needsUpdateFromParent=!0;return}if(d.elementClass===Const.OBJECT_CLASS_CIRCLE)o=d.Radius(),JXG$1.evaluate(this.visProp.isgeonext)&&(V=1),u=[d.center.X()+o*Math.cos(this.position*V),d.center.Y()+o*Math.sin(this.position*V)];else if(d.elementClass===Const.OBJECT_CLASS_LINE)n=d.point1.coords.usrCoords,t=d.point2.coords.usrCoords,n[0]===0&&n[1]===0&&n[2]===0||t[0]===0&&t[1]===0&&t[2]===0?u=[0,0,0]:Math.abs(t[0])<Mat.eps?(r=Math.min(Math.abs(this.position),1-Mat.eps),r/=1-r,this.position<0&&(r=-r),u=[n[0]+r*t[0],n[1]+r*t[1],n[2]+r*t[2]]):Math.abs(n[0])<Mat.eps?(r=Math.max(this.position,Mat.eps),r=Math.min(r,2-Mat.eps),r>1?r=(r-1)/(r-2):r=(1-r)/r,u=[t[0]+r*n[0],t[1]+r*n[1],t[2]+r*n[2]]):(r=this.position,u=[n[0]+r*(t[0]-n[0]),n[1]+r*(t[1]-n[1]),n[2]+r*(t[2]-n[2])]);else if(d.type===Const.OBJECT_TYPE_TURTLE)this.coords.setCoordinates(Const.COORDS_BY_USER,[d.Z(this.position),d.X(this.position),d.Y(this.position)]),this.updateConstraint(),u=Geometry.projectPointToTurtle(this,d,this.board)[0].usrCoords;else if(d.elementClass===Const.OBJECT_CLASS_CURVE){for(A=!1,I=d.getTransformationSource(),I[0]&&(A=I[0],C.push(d),C.push(I[1]));I[0]&&JXG$1.exists(I[1]._transformationSource);)I=I[1].getTransformationSource(),C.push(I[1]);if(A?this.coords.setCoordinates(Const.COORDS_BY_USER,[C[C.length-1].Z(this.position),C[C.length-1].X(this.position),C[C.length-1].Y(this.position)]):this.coords.setCoordinates(Const.COORDS_BY_USER,[d.Z(this.position),d.X(this.position),d.Y(this.position)]),d.type===Const.OBJECT_TYPE_ARC||d.type===Const.OBJECT_TYPE_SECTOR)G=Geometry.rad([d.center.X()+1,d.center.Y()],d.center,d.radiuspoint),B=0,w=Geometry.rad(d.radiuspoint,d.center,d.anglepoint),(d.visProp.selection==="minor"&&w>Math.PI||d.visProp.selection==="major"&&w<Math.PI)&&(B=w,w=2*Math.PI),V=w-B,JXG$1.evaluate(this.visProp.isgeonext)&&(V=1),Z=this.position*V,(Z<B||Z>w)&&(Z=w,(Z<B&&Z>B*.5||Z>w&&Z>w*.5+Math.PI)&&(Z=B),this.position=Z,Math.abs(V)>Mat.eps&&(this.position/=V)),o=d.Radius(),u=[d.center.X()+o*Math.cos(this.position*V+G),d.center.Y()+o*Math.sin(this.position*V+G)];else if(this.updateConstraint(),A)for(u=Geometry.projectPointToCurve(this,C[C.length-1],this.board)[0].usrCoords,f=C.length-2;f>=0;f--)u=new Coords(Const.COORDS_BY_USER,Mat.matVecMult(C[f].transformMat,u),this.board).usrCoords;else u=Geometry.projectPointToCurve(this,d,this.board)[0].usrCoords}else JXG$1.isPoint(d)&&(u=Geometry.projectPointToPoint(this,d,this.board).usrCoords);this.coords.setCoordinates(Const.COORDS_BY_USER,u,!1)},updateRendererGeneric:function(n){return!this.needsUpdate||!this.board.renderer?this:(this.visPropCalc.visible&&(this.isReal=!isNaN(this.coords.usrCoords[1]+this.coords.usrCoords[2]),this.isReal=Math.abs(this.coords.usrCoords[0])>Mat.eps?this.isReal:!1,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer[n](this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this)},X:function(){return this.coords.usrCoords[1]},Y:function(){return this.coords.usrCoords[2]},Z:function(){return this.coords.usrCoords[0]},Coords:function(n){return n?this.coords.usrCoords.slice():this.coords.usrCoords.slice(1)},XEval:function(){return this.coords.usrCoords[1]},YEval:function(){return this.coords.usrCoords[2]},ZEval:function(){return this.coords.usrCoords[0]},Dist:function(n){return this.isReal&&n.isReal?this.coords.distance(Const.COORDS_BY_USER,n.coords):NaN},snapToGrid:function(n){return this.handleSnapToGrid(n)},handleSnapToPoints:function(n){var t,o,r,u=0,d,C=1/0,I=null,f,A,G=JXG$1.evaluate(this.visProp.ignoredsnaptopoints),B,Z,w=!1;if(d=this.board.objectsList.length,G&&(B=G.length),JXG$1.evaluate(this.visProp.snaptopoints)||n){for(f=JXG$1.evaluate(this.visProp.attractorunit),A=JXG$1.evaluate(this.visProp.attractordistance),t=0;t<d;t++){if(o=this.board.objectsList[t],G){for(w=!1,Z=0;Z<B;Z++)if(o===this.board.select(G[Z])){w=!0;break}if(w)continue}JXG$1.isPoint(o)&&o!==this&&o.visPropCalc.visible&&(r=Geometry.projectPointToPoint(this,o,this.board),f==="screen"?u=r.distance(Const.COORDS_BY_SCREEN,this.coords):u=r.distance(Const.COORDS_BY_USER,this.coords),u<A&&u<C&&(C=u,I=r))}I!==null&&this.coords.setCoordinates(Const.COORDS_BY_USER,I.usrCoords)}return this},snapToPoints:function(n){return this.handleSnapToPoints(n)},handleAttractors:function(){var n,t,o,r=0,u,d=JXG$1.evaluate(this.visProp.attractorunit),C=JXG$1.evaluate(this.visProp.attractordistance),I=JXG$1.evaluate(this.visProp.snatchdistance),f=JXG$1.evaluate(this.visProp.attractors),A=f.length;if(C!==0){for(n=0;n<A;n++)if(t=this.board.select(f[n]),JXG$1.exists(t)&&t!==this){if(JXG$1.isPoint(t)?o=Geometry.projectPointToPoint(this,t,this.board):t.elementClass===Const.OBJECT_CLASS_LINE?(u=Geometry.projectCoordsToSegment(this.coords.usrCoords,t.point1.coords.usrCoords,t.point2.coords.usrCoords),!JXG$1.evaluate(t.visProp.straightfirst)&&u[1]<0?o=t.point1.coords:!JXG$1.evaluate(t.visProp.straightlast)&&u[1]>1?o=t.point2.coords:o=new Coords(Const.COORDS_BY_USER,u[0],this.board)):t.elementClass===Const.OBJECT_CLASS_CIRCLE?o=Geometry.projectPointToCircle(this,t,this.board):t.elementClass===Const.OBJECT_CLASS_CURVE?o=Geometry.projectPointToCurve(this,t,this.board)[0]:t.type===Const.OBJECT_TYPE_TURTLE?o=Geometry.projectPointToTurtle(this,t,this.board)[0]:t.type===Const.OBJECT_TYPE_POLYGON&&(o=new Coords(Const.COORDS_BY_USER,Geometry.projectCoordsToPolygon(this.coords.usrCoords,t),this.board)),d==="screen"?r=o.distance(Const.COORDS_BY_SCREEN,this.coords):r=o.distance(Const.COORDS_BY_USER,this.coords),r<C){this.type===Const.OBJECT_TYPE_GLIDER&&(t===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===t)||this.makeGlider(t);break}r>=I&&(t===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===t)&&this.popSlideObject()}return this}},setPositionDirectly:function(n,t){var o,r,u,d=this.coords,C;if(this.relativeCoords)return r=new Coords(n,t,this.board),JXG$1.evaluate(this.visProp.islabel)?(u=Statistics.subtract(r.scrCoords,d.scrCoords),this.relativeCoords.scrCoords[1]+=u[1],this.relativeCoords.scrCoords[2]+=u[2]):(u=Statistics.subtract(r.usrCoords,d.usrCoords),this.relativeCoords.usrCoords[1]+=u[1],this.relativeCoords.usrCoords[2]+=u[2]),this;for(this.coords.setCoordinates(n,t),this.handleSnapToGrid(),this.handleSnapToPoints(),this.handleAttractors(),o=this.transformations.length-1;o>=0;o--)n===Const.COORDS_BY_SCREEN?C=new Coords(n,t,this.board).usrCoords:(t.length===2&&(t=[1].concat(t)),C=t),this.initialCoords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(Mat.inverse(this.transformations[o].matrix),C));return this.prepareUpdate().update(),this.board.isSuspendedUpdate&&this.type===Const.OBJECT_TYPE_GLIDER&&this.updateGlider(),this},setPositionByTransform:function(n,t){var o;return t=new Coords(n,t,this.board),o=this.board.create("transform",t.usrCoords.slice(1),{type:"translate"}),this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(o):this.addTransform(this,o),this.prepareUpdate().update(),this},setPosition:function(n,t){return this.setPositionDirectly(n,t)},setGliderPosition:function(n){return this.type===Const.OBJECT_TYPE_GLIDER&&(this.position=n,this.board.update()),this},makeGlider:function(n){var t=this.board.select(n),o=!1,r,u,d;if(t.type===Const.OBJECT_TYPE_POLYGON){for(r=Number.MAX_VALUE,u=0;u<t.borders.length;u++)d=JXG$1.Math.Geometry.distPointLine(this.coords.usrCoords,t.borders[u].stdform),d<r&&(r=d,n=t.borders[u]);t=this.board.select(n),o=!0}if(JXG$1.exists(t)){if(t.type===Const.OBJECT_TYPE_TICKS)throw new Error("JSXGraph: gliders on ticks are not possible.")}else throw new Error("JSXGraph: slide object undefined.");return this.slideObject=this.board.select(n),this.slideObjects.push(this.slideObject),this.addParents(n),this.type=Const.OBJECT_TYPE_GLIDER,this.elType="glider",this.visProp.snapwidth=-1,this.slideObject.addChild(this),this.isDraggable=!0,this.onPolygon=o,this.generatePolynomial=function(){return this.slideObject.generatePolynomial(this)},this.updateGlider(),this.needsUpdateFromParent=!0,this.updateGliderFromParent(),this},popSlideObject:function(){this.slideObjects.length>0&&(this.slideObjects.pop(),this.slideObject.removeChild(this),this.slideObjects.length===0?(this.type=this._org_type,this.type===Const.OBJECT_TYPE_POINT?this.elType="point":this.elementClass===Const.OBJECT_CLASS_TEXT?this.elType="text":this.type===Const.OBJECT_TYPE_IMAGE?this.elType="image":this.type===Const.OBJECT_TYPE_FOREIGNOBJECT&&(this.elType="foreignobject"),this.slideObject=null):this.slideObject=this.slideObjects[this.slideObjects.length-1])},free:function(){var n,t;if(this.type!==Const.OBJECT_TYPE_GLIDER)if(this.transformations.length=0,delete this.updateConstraint,this.isConstrained=!1,!this.isDraggable)this.isDraggable=!0,this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"),this.XEval=function(){return this.coords.usrCoords[1]},this.YEval=function(){return this.coords.usrCoords[2]},this.ZEval=function(){return this.coords.usrCoords[0]},this.Xjc=null,this.Yjc=null;else return;for(n in this.board.objects)this.board.objects.hasOwnProperty(n)&&(t=this.board.objects[n],t.descendants&&(delete t.descendants[this.id],delete t.childElements[this.id],this.hasLabel&&(delete t.descendants[this.label.id],delete t.childElements[this.label.id])));this.ancestors={},this.parents=[],this.slideObject=null,this.slideObjects=[],this.elementClass===Const.OBJECT_CLASS_POINT?(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"):this.elementClass===Const.OBJECT_CLASS_TEXT?(this.type=this._org_type,this.elType="text"):this.elementClass===Const.OBJECT_CLASS_OTHER&&(this.type=this._org_type,this.elType="image")},addConstraint:function(n){var t,o,r=[],u=["X","Y"],d=function(I){return function(){return I}},C=function(I){return function(){return I.Value()}};for(this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_CAS),this.isDraggable=!1,t=0;t<n.length;t++)o=n[t],JXG$1.isString(o)?(r[t]=this.board.jc.snippet(o,!0,null,!0),this.addParentsFromJCFunctions([r[t]]),n.length===2&&(this[u[t]+"jc"]=n[t])):JXG$1.isFunction(o)?r[t]=o:JXG$1.isNumber(o)?r[t]=d(o):JXG$1.isObject(o)&&JXG$1.isFunction(o.Value)&&(r[t]=C(o)),r[t].origin=o;return n.length===1?this.updateConstraint=function(){var I=r[0]();return JXG$1.isArray(I)?this.coords.setCoordinates(Const.COORDS_BY_USER,I):this.coords=I,this}:n.length===2?(this.XEval=r[0],this.YEval=r[1],this.addParents([r[0].origin,r[1].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.XEval(),this.YEval()]),this}):(this.ZEval=r[0],this.XEval=r[1],this.YEval=r[2],this.addParents([r[0].origin,r[1].origin,r[2].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()]),this}),this.isConstrained=!0,this.prepareUpdate().update(),this.board.isSuspendedUpdate||(this.updateVisibility().updateRenderer(),this.hasLabel&&this.label.fullUpdate()),this},addAnchor:function(n,t){t?this.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,n.slice(0,2),this.board):this.relativeCoords=new Coords(Const.COORDS_BY_USER,n,this.board),this.element.addChild(this),t&&this.addParents(this.element),this.XEval=function(){var o,r,u,d;return JXG$1.evaluate(this.visProp.islabel)?(d=JXG$1.evaluate(this.visProp.offset),o=parseFloat(d[0]),u=this.element.getLabelAnchor(),r=new Coords(Const.COORDS_BY_SCREEN,[o+this.relativeCoords.scrCoords[1]+u.scrCoords[1],0],this.board),r.usrCoords[1]):(u=this.element.getTextAnchor(),this.relativeCoords.usrCoords[1]+u.usrCoords[1])},this.YEval=function(){var o,r,u,d;return JXG$1.evaluate(this.visProp.islabel)?(d=JXG$1.evaluate(this.visProp.offset),o=-parseFloat(d[1]),u=this.element.getLabelAnchor(),r=new Coords(Const.COORDS_BY_SCREEN,[0,o+this.relativeCoords.scrCoords[2]+u.scrCoords[2]],this.board),r.usrCoords[2]):(u=this.element.getTextAnchor(),this.relativeCoords.usrCoords[2]+u.usrCoords[2])},this.ZEval=JXG$1.createFunction(1,this.board,""),this.updateConstraint=function(){this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()])},this.isConstrained=!0,this.updateConstraint()},updateTransform:function(n){var t;if(this.transformations.length===0)return this;for(t=0;t<this.transformations.length;t++)this.transformations[t].update();return this},addTransform:function(n,t){var o,r=JXG$1.isArray(t)?t:[t],u=r.length;for(this.transformations.length===0&&(this.baseElement=n),o=0;o<u;o++)this.transformations.push(r[o]);return this},startAnimation:function(n,t,o){var r=JXG$1.evaluate(n),u=JXG$1.evaluate(t),d=this;return o=JXG$1.evaluate(o)||250,this.type===Const.OBJECT_TYPE_GLIDER&&!JXG$1.exists(this.intervalCode)&&(this.intervalCode=window.setInterval(function(){d._anim(r,u)},o),JXG$1.exists(this.intervalCount)||(this.intervalCount=0)),this},stopAnimation:function(){return JXG$1.exists(this.intervalCode)&&(window.clearInterval(this.intervalCode),delete this.intervalCode),this},moveAlong:function(n,t,o){o=o||{};var r,u,d=[],C=[],I=this.board.attr.animationdelay,f=t/I,A,G,B,Z=function(w,V){return function(){return n[w][V]}};if(JXG$1.isArray(n)){for(A=n.length,r=0;r<A;r++)JXG$1.isPoint(n[r])?C[r]=n[r]:C[r]={elementClass:Const.OBJECT_CLASS_POINT,X:Z(r,0),Y:Z(r,1)};if(t=t||0,t===0)return this.setPosition(Const.COORDS_BY_USER,[C[C.length-1].X(),C[C.length-1].Y()]),this.board.update(this);if(!JXG$1.exists(o.interpolate)||o.interpolate)for(u=Numerics.Neville(C),r=0;r<f;r++)d[r]=[],d[r][0]=u[0]((f-r)/f*u[3]()),d[r][1]=u[1]((f-r)/f*u[3]());else{for(A=n.length-1,r=0;r<f;++r)G=Math.floor(r/f*A),B=r/f*A-G,d[r]=[],d[r][0]=(1-B)*C[G].X()+B*C[G+1].X(),d[r][1]=(1-B)*C[G].Y()+B*C[G+1].Y();d.push([C[A].X(),C[A].Y()]),d.reverse()}this.animationPath=d}else JXG$1.isFunction(n)&&(this.animationPath=n,this.animationStart=new Date().getTime());return this.animationCallback=o.callback,this.board.addAnimation(this),this},moveTo:function(n,t,o){o=o||{},n=new Coords(Const.COORDS_BY_USER,n,this.board);var r,u=this.board.attr.animationdelay,d=Math.ceil(t/u),C=[],I=this.coords.usrCoords[1],f=this.coords.usrCoords[2],A=n.usrCoords[1]-I,G=n.usrCoords[2]-f,B=function(Z){let w=Z/d;if(o.effect){if(o.effect==="<>")return Math.pow(Math.sin(w*Math.PI/2),2);if(o.effect==="<")return w*w*w;if(o.effect===">")return 1-Math.pow(1-w,3);if(o.effect==="==")return Z/d;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return Z/d};if(!JXG$1.exists(t)||t===0||Math.abs(n.usrCoords[0]-this.coords.usrCoords[0])>Mat.eps)return this.setPosition(Const.COORDS_BY_USER,n.usrCoords),this.board.update(this);if(!JXG$1.exists(o.callback)&&Math.abs(A)<Mat.eps&&Math.abs(G)<Mat.eps)return this;for(r=d;r>=0;r--)C[d-r]=[n.usrCoords[0],I+A*B(r),f+G*B(r)];return this.animationPath=C,this.animationCallback=o.callback,this.board.addAnimation(this),this},visit:function(n,t,o){n=new Coords(Const.COORDS_BY_USER,n,this.board);var r,u,d,C=this.board.attr.animationdelay,I=[],f=this.coords.usrCoords[1],A=this.coords.usrCoords[2],G=n.usrCoords[1]-f,B=n.usrCoords[2]-A,Z=function(w){var V=w<d/2?2*w/d:2*(d-w)/d;if(o.effect){if(o.effect==="<>")return Math.pow(Math.sin(V*Math.PI/2),2);if(o.effect==="<")return V*V*V;if(o.effect===">")return 1-Math.pow(1-V,3);if(o.effect==="==")return V;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return V};for(JXG$1.isNumber(o)?o={repeat:o}:(o=o||{},JXG$1.exists(o.repeat)||(o.repeat=1)),d=Math.ceil(t/(C*o.repeat)),u=0;u<o.repeat;u++)for(r=d;r>=0;r--)I[u*(d+1)+d-r]=[n.usrCoords[0],f+G*Z(r),A+B*Z(r)];return this.animationPath=I,this.animationCallback=o.callback,this.board.addAnimation(this),this},_anim:function(n,t){var o,r,u,d,C,I,f,A,G;return this.intervalCount+=1,this.intervalCount>t&&(this.intervalCount=0),this.slideObject.elementClass===Const.OBJECT_CLASS_LINE?(f=this.slideObject.point1.coords.scrCoords,A=this.slideObject.point2.coords.scrCoords,o=Math.round((A[1]-f[1])*this.intervalCount/t),r=Math.round((A[2]-f[2])*this.intervalCount/t),n>0?d=this.slideObject.point1:(d=this.slideObject.point2,o*=-1,r*=-1),this.coords.setCoordinates(Const.COORDS_BY_SCREEN,[d.coords.scrCoords[1]+o,d.coords.scrCoords[2]+r])):this.slideObject.elementClass===Const.OBJECT_CLASS_CURVE?(n>0?C=(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/t+this.slideObject.minX():C=-(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/t+this.slideObject.maxX(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.X(C),this.slideObject.Y(C)]),G=Geometry.projectPointToCurve(this,this.slideObject,this.board),this.coords=G[0],this.position=G[1]):this.slideObject.elementClass===Const.OBJECT_CLASS_CIRCLE&&(u=2*Math.PI,n<0?u*=this.intervalCount/t:u*=(t-this.intervalCount)/t,I=this.slideObject.Radius(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.center.coords.usrCoords[1]+I*Math.cos(u),this.slideObject.center.coords.usrCoords[2]+I*Math.sin(u)])),this.board.update(this),this},getTextAnchor:function(){return this.coords},getLabelAnchor:function(){return this.coords},getParents:function(){var n=[this.Z(),this.X(),this.Y()];return this.parents.length!==0&&(n=this.parents),this.type===Const.OBJECT_TYPE_GLIDER&&(n=[this.X(),this.Y(),this.slideObject.id]),n}});JXG$1.CoordsElement.create=function(n,t,o,r,u,d){var C,I=!1,f;for(f=0;f<o.length;f++)(JXG$1.isFunction(o[f])||JXG$1.isString(o[f]))&&(I=!0);if(I)C=new n(t,[0,0],r,u,d),C.addConstraint(o);else if(JXG$1.isNumber(o[0])&&JXG$1.isNumber(o[1]))C=new n(t,o,r,u,d),JXG$1.exists(r.slideobject)?C.makeGlider(r.slideobject):C.baseElement=C,C.isDraggable=!0;else if(JXG$1.isObject(o[0])&&JXG$1.isTransformationOrArray(o[1]))C=new n(t,[0,0],r,u,d),C.addTransform(o[0],o[1]),C.isDraggable=!1;else return!1;return C.handleSnapToGrid(),C.handleSnapToPoints(),C.handleAttractors(),C.addParents(o),C};const CoordsElement=JXG$1.CoordsElement;var priv$5={HTMLSliderInputEventHandler:function(){this._val=parseFloat(this.rendNodeRange.value),this.rendNodeOut.value=this.rendNodeRange.value,this.board.update()}};JXG$1.Text=function(n,t,o,r){var u;this.constructor(n,o,Const.OBJECT_TYPE_TEXT,Const.OBJECT_CLASS_TEXT),this.element=this.board.select(o.anchor),this.coordsConstructor(t,JXG$1.evaluate(this.visProp.islabel)),this.content="",this.plaintext="",this.plaintextOld=null,this.orgText="",this.needsSizeUpdate=!1,this.hiddenByParent=!1,this.size=[1,1],this.id=this.board.setId(this,"T"),this.board.renderer.drawText(this),this.board.finalizeAdding(this),u=this.visProp.visible,this.visProp.visible=!0,this.setText(r),this.visProp.visible=u,JXG$1.isString(this.content)&&this.notifyParents(this.content),this.elType="text",this.methodMap=JXG$1.deepCopy(this.methodMap,{setText:"setTextJessieCode",move:"setCoords",Size:"getSize",setAutoPosition:"setAutoPosition"})};JXG$1.Text.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Text.prototype,{hasPoint:function(n,t){var o,r,u,d,C,I,f,A;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(f=this.board._inputDevice,A=JXG$1.evaluate(this.visProp.precision[f])):A=this.board.options.precision.hasPoint,this.transformations.length>0&&(o=Mat.matVecMult(Mat.inverse(this.board.renderer.joinTransforms(this,this.transformations)),[1,n,t]),n=o[1],t=o[2]),C=this.getAnchorX(),C==="right"?o=this.coords.scrCoords[1]-this.size[0]:C==="middle"?o=this.coords.scrCoords[1]-.5*this.size[0]:o=this.coords.scrCoords[1],r=o+this.size[0],I=this.getAnchorY(),I==="top"?d=this.coords.scrCoords[2]+this.size[1]:I==="middle"?d=this.coords.scrCoords[2]+.5*this.size[1]:d=this.coords.scrCoords[2],u=d-this.size[1],JXG$1.evaluate(this.visProp.dragarea)==="all"?n>=o-A&&n<r+A&&t>=u-A&&t<=d+A:t>=u-A&&t<=d+A&&(n>=o-A&&n<=o+2*A||n>=r-2*A&&n<=r+A)},_createFctUpdateText:function(n){var t,o,r,u,d,C,I=JXG$1.evaluate(this.visProp.parse),f=JXG$1.evaluate(this.visProp.usemathjax),A=JXG$1.evaluate(this.visProp.usekatex),G=!1;if(this.orgText=n,JXG$1.isFunction(n))this.updateText=function(){u=n().toString(),I&&!f&&!A?this.plaintext=this.replaceSub(this.replaceSup(this.convertGeonextAndSketchometry2CSS(u,!1))):this.plaintext=u};else if(JXG$1.isNumber(n)&&JXG$1.evaluate(this.visProp.formatnumber)?JXG$1.evaluate(this.visProp.tofraction)?f?this.content="\\("+JXG$1.toFraction(n,!0)+"\\)":this.content=JXG$1.toFraction(n,A):(r=JXG$1.evaluate(this.visProp.digits),this.useLocale()?this.content=this.formatNumberLocale(n,r):this.content=JXG$1.toFixed(n,r)):JXG$1.isString(n)&&I?(JXG$1.evaluate(this.visProp.useasciimathml)?this.content="'`"+n+"`'":f||A?(this.content=this.valueTagToJessieCode(n),JXG$1.isArray(this.content)||(this.content=this.content.replace(/\\/g,"\\\\"))):this.content=this.poorMansTeX(this.valueTagToJessieCode(n)),G=!0):this.content=n,G){if(JXG$1.isArray(this.content)){for(C=this,d=0;d<this.content.length;d++)if(this.content[d][0]!=='"'){this.content[d]=this.board.jc.snippet(this.content[d],!0,"",!1);for(o in this.content[d].deps)this.addParents(this.content[d].deps[o]),this.content[d].deps[o].addChild(this)}t=function(){var B,Z,w=JXG$1.evaluate(C.visProp.digits),V="";for(B=0;B<C.content.length;B++)JXG$1.isFunction(C.content[B])?(Z=C.content[B](),C.useLocale()?Z=C.formatNumberLocale(Z,w):Z=JXG$1.toFixed(Z,w)):(Z=C.content[B],Z[0]==='"'&&Z[Z.length-1]==='"'&&(Z=Z.slice(1,-1))),V+=Z;return V}}else{t=this.board.jc.snippet(this.content,!0,"",!1);for(o in t.deps)this.addParents(t.deps[o]),t.deps[o].addChild(this)}this.updateText=function(){this.plaintext=this.unescapeTicks(t())}}else this.updateText=function(){this.plaintext=this.content}},_setText:function(n){return this._createFctUpdateText(n),this.updateText(),this.fullUpdate(),(!this.board.infobox||this.id!==this.board.infobox.id)&&this.updateSize(),this},setTextJessieCode:function(n){var t;return this.visProp.castext=n,JXG$1.isFunction(n)?t=function(){return JXG$1.sanitizeHTML(n())}:JXG$1.isNumber(n)?t=n:t=JXG$1.sanitizeHTML(n),this._setText(t)},setText:function(n){return this._setText(n)},updateSize:function(){var n,t,o,r=JXG$1.evaluate(this.visProp.display);return!JXG$1.isBrowser||this.board.renderer.type==="no"?this:(o=this.rendNode,r==="html"||this.board.renderer.type==="vml"?JXG$1.exists(o.offsetWidth)?(t=this,window.setTimeout(function(){t.size=[o.offsetWidth,o.offsetHeight],t.needsUpdate=!0,t.updateRenderer()},0)):this.size=this.crudeSizeEstimate():r==="internal"&&(this.board.renderer.type==="svg"?(t=this,window.setTimeout(function(){try{n=o.getBBox(),t.size=[n.width,n.height],t.needsUpdate=!0,t.updateRenderer()}catch{}},0)):this.board.renderer.type==="canvas"&&(this.size=this.crudeSizeEstimate())),this)},crudeSizeEstimate:function(){var n=parseFloat(JXG$1.evaluate(this.visProp.fontsize));return[n*this.plaintext.length*.45,n*.9]},utf8_decode:function(n){return n.replace(/&#x(\w+);/g,function(t,o){return String.fromCharCode(parseInt(o,16))})},replaceSub:function(n){if(!n.indexOf)return n;for(var t,o=n.indexOf("_{");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/_\{/,"<sub>"),t=n.indexOf("}",o+4),t>=0&&(n=n.slice(0,t)+n.slice(t).replace(/\}/,"</sub>")),o=n.indexOf("_{");for(o=n.indexOf("_");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/_(.?)/,"<sub>$1</sub>"),o=n.indexOf("_");return n},replaceSup:function(n){if(!n.indexOf)return n;for(var t,o=n.indexOf("^{");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/\^\{/,"<sup>"),t=n.indexOf("}",o+4),t>=0&&(n=n.slice(0,t)+n.slice(t).replace(/\}/,"</sup>")),o=n.indexOf("^{");for(o=n.indexOf("^");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/\^(.?)/,"<sup>$1</sup>"),o=n.indexOf("^");return n},getSize:function(){return this.size},setCoords:function(n,t){var o,r,u;return JXG$1.isArray(n)&&n.length>1&&(t=n[1],n=n[0]),JXG$1.evaluate(this.visProp.islabel)&&JXG$1.exists(this.element)?(o=this.element.getLabelAnchor(),r=(n-o.usrCoords[1])*this.board.unitX,u=-(t-o.usrCoords[2])*this.board.unitY,this.relativeCoords.setCoordinates(Const.COORDS_BY_SCREEN,[r,u])):this.coords.setCoordinates(Const.COORDS_BY_USER,[n,t]),this.fullUpdate(),this},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateText(),JXG$1.evaluate(this.visProp.display)==="internal"&&JXG$1.isString(this.plaintext)&&(this.plaintext=this.utf8_decode(this.plaintext)),this.checkForSizeUpdate(),this.needsSizeUpdate&&this.updateSize(),this):this},checkForSizeUpdate:function(){this.board.infobox&&this.id===this.board.infobox.id?this.needsSizeUpdate=!1:(this.needsSizeUpdate=this.plaintextOld!==this.plaintext,this.needsSizeUpdate&&(this.plaintextOld=this.plaintext))},updateRenderer:function(){return JXG$1.evaluate(this.visProp.autoposition)&&this.setAutoPosition().updateConstraint(),this.updateRendererGeneric("updateText")},expandShortMath:function(n){var t=/([)0-9.])\s*([(a-zA-Z_])/g;return n.replace(t,"$1*$2")},generateTerm:function(n,t,o){var r,u,d,C,I='""';if(n=n||"",n=n.replace(/\r/g,""),n=n.replace(/\n/g,""),n=n.replace(/"/g,"'"),n=n.replace(/'/g,"\\'"),n=n.replace(/&amp;arc;/g,"&ang;"),n=n.replace(/<arc\s*\/>/g,"&ang;"),n=n.replace(/&lt;arc\s*\/&gt;/g,"&ang;"),n=n.replace(/&lt;sqrt\s*\/&gt;/g,"&radic;"),n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>"),d=n.indexOf("<value>"),C=n.indexOf("</value>"),d>=0)for(;d>=0;)I+=' + "'+this.replaceSub(this.replaceSup(n.slice(0,d)))+'"',u=n.slice(d+7,C),u=u.replace(/\s+/g,""),t===!0&&(u=this.expandShortMath(u)),o?r=u:r=GeonextParser.geonext2JS(u,this.board),r=r.replace(/\\"/g,"'"),r=r.replace(/\\'/g,"'"),r.indexOf("toFixed")<0&&JXG$1.isNumber(JXG$1.bind(this.board.jc.snippet(r,!0,"",!1),this)())?I+="+("+r+").toFixed("+JXG$1.evaluate(this.visProp.digits)+")":I+="+("+r+")",n=n.slice(C+8),d=n.indexOf("<value>"),C=n.indexOf("</value>");return I+=' + "'+this.replaceSub(this.replaceSup(n))+'"',I=this.convertGeonextAndSketchometry2CSS(I),I=I.replace(/&amp;/g,"&"),I=I.replace(/"/g,"'"),I},valueTagToJessieCode:function(n){var t,o,r,u,d=[],C='"';if(n=n||"",n=n.replace(/\r/g,""),n=n.replace(/\n/g,""),n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>"),r=n.indexOf("<value>"),u=n.indexOf("</value>"),r>=0)for(;r>=0;)d.push(C+this.escapeTicks(n.slice(0,r))+C),o=n.slice(r+7,u),o=o.replace(/\s+/g,""),o=this.expandShortMath(o),t=o,t=t.replace(/\\"/g,"'").replace(/\\'/g,"'"),d.push("("+t+")"),n=n.slice(u+8),r=n.indexOf("<value>"),u=n.indexOf("</value>");for(d.push(C+this.escapeTicks(n)+C),r=0;r<d.length;r++)d[r]=d[r].replace(/&amp;/g,"&");return d},poorMansTeX:function(n){var t,o;if(JXG$1.isArray(n)){for(o=[],t=0;t<n.length;t++)o.push(this.poorMansTeX(n[t]));return o}return n=n.replace(/<arc\s*\/*>/g,"&ang;").replace(/&lt;arc\s*\/*&gt;/g,"&ang;").replace(/<sqrt\s*\/*>/g,"&radic;").replace(/&lt;sqrt\s*\/*&gt;/g,"&radic;"),this.convertGeonextAndSketchometry2CSS(this.replaceSub(this.replaceSup(n)),!0)},escapeTicks:function(n){return n.replace(/"/g,"%22").replace(/'/g,"%27")},unescapeTicks:function(n){return n.replace(/%22/g,'"').replace(/%27/g,"'")},convertGeonext2CSS:function(n){return JXG$1.isString(n)&&(n=n.replace(/(<|&lt;)overline(>|&gt;)/g,"<span style=text-decoration:overline;>"),n=n.replace(/(<|&lt;)\/overline(>|&gt;)/g,"</span>"),n=n.replace(/(<|&lt;)arrow(>|&gt;)/g,"<span style=text-decoration:overline;>"),n=n.replace(/(<|&lt;)\/arrow(>|&gt;)/g,"</span>")),n},convertSketchometry2CSS:function(n,t){var o='<span class="sketcho sketcho-inherit sketcho-',r='"></span>';return JXG$1.isString(n)&&(t&&(o=this.escapeTicks(o),r=this.escapeTicks(r)),n=n.replace(/(<|&lt;)sketchofont(>|&gt;)/g,o),n=n.replace(/(<|&lt;)\/sketchofont(>|&gt;)/g,r)),n},convertGeonextAndSketchometry2CSS:function(n,t){return n=this.convertGeonext2CSS(n),n=this.convertSketchometry2CSS(n,t),n},notifyParents:function(n){var t,o=null;n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>");do t=/<value>([\w\s*/^\-+()[\],<>=!]+)<\/value>/,o=t.exec(n),o!==null&&(GeonextParser.findDependencies(this,o[1],this.board),n=n.slice(o.index),n=n.replace(t,""));while(o!==null);return this},getParents:function(){var n;return this.relativeCoords!==void 0?n=[this.relativeCoords.usrCoords[1],this.relativeCoords.usrCoords[2],this.orgText]:n=[this.Z(),this.X(),this.Y(),this.orgText],this.parents.length!==0&&(n=this.parents),n},bounds:function(){var n=this.coords.usrCoords;return JXG$1.evaluate(this.visProp.islabel)||this.board.unitY===0||this.board.unitX===0?[0,0,0,0]:[n[1],n[2]+this.size[1]/this.board.unitY,n[1]+this.size[0]/this.board.unitX,n[2]]},getAnchorX:function(){var n=JXG$1.evaluate(this.visProp.anchorx);if(n==="auto")switch(this.visProp.position){case"top":case"bot":return"middle";case"rt":case"lrt":case"urt":return"left";case"lft":case"llft":case"ulft":default:return"right"}return n},getAnchorY:function(){var n=JXG$1.evaluate(this.visProp.anchory);if(n==="auto")switch(this.visProp.position){case"top":case"ulft":case"urt":return"bottom";case"bot":case"lrt":case"llft":return"top";case"rt":case"lft":default:return"middle"}return n},getNumberOfConflicts:function(n,t,o,r,u){u=u||[];var d=0,C,I,f,A,G;for(A=this.board.options.precision.hasPoint,this.board.options.precision.hasPoint=(o+r)*.25,C=0,f=this.board.objectsList.length;C<f;C++)I=this.board.objectsList[C],G=I.visProp.hasinnerpoints,I.visProp.hasinnerpoints=!1,I.visPropCalc.visible&&I.elType!=="axis"&&I.elType!=="ticks"&&I!==this.board.infobox&&I!==this&&I.hasPoint(n,t)&&u.indexOf(I.id)===-1&&d++,I.visProp.hasinnerpoints=G;return this.board.options.precision.hasPoint=A,d},setAutoPosition:function(){var n,t,o,r,u,d=this.size[0],C=this.size[1],I,f,A={conflicts:1/0,angle:0,r:0},G,B,Z,w,V,Y=12,J=2*Math.PI/Y,T,L,z,K,P;if(this===this.board.infobox||!this.visPropCalc.visible||!JXG$1.evaluate(this.visProp.islabel)||!this.element)return this;if(w=JXG$1.evaluate(this.visProp.offset),u=this.element.getLabelAnchor(),o=u.scrCoords[1],r=u.scrCoords[2],L=w[0],z=w[1],Z=this.getNumberOfConflicts(o+L,r-z,d,C,JXG$1.evaluate(this.visProp.autopositionwhitelist)),Z===0)return this;for(V=JXG$1.evaluate(this.visProp.autopositionmindistance),G=JXG$1.evaluate(this.visProp.autopositionmaxdistance),B=.2*V,I=Math.atan2(z,L),A.conflicts=Z,A.angle=I,A.r=V;A.conflicts>0&&V<=G;){for(T=1,f=I+J;T<Y&&A.conflicts>0&&(K=Math.cos(f),P=Math.sin(f),n=o+V*K,t=r-V*P,Z=this.getNumberOfConflicts(n,t,d,C,JXG$1.evaluate(this.visProp.autopositionwhitelist)),Z<A.conflicts&&(A.conflicts=Z,A.angle=f,A.r=V),A.conflicts!==0);T++)f+=J;V+=B}return V=A.r,K=Math.cos(A.angle),P=Math.sin(A.angle),this.visProp.offset=[V*K,V*P],K<-.2?this.visProp.anchorx="right":K>.2?this.visProp.anchorx="left":this.visProp.anchorx="middle",this}});JXG$1.createText=function(n,t,o){var r,u=JXG$1.copyAttributes(o,n.options,"text"),d=t.slice(0,-1),C=t[t.length-1];if(u.anchor=u.parent||u.anchor,r=CoordsElement.create(JXG$1.Text,n,d,u,C),!r)throw new Error("JSXGraph: Can't create text with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return u.rotate!==0&&r.addRotation(u.rotate),r};JXG$1.registerElement("text",JXG$1.createText);JXG$1.createHTMLSlider=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"htmlslider");if(t.length!==2||t[0].length!==2||t[1].length!==3)throw new Error("JSXGraph: Can't create htmlslider with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parents are: [[x,y], [min, start, max]]`);d.anchor=d.parent||d.anchor,d.fixed=d.fixed||!0,u=[t[0][0],t[0][1],'<form style="display:inline"><input type="range" /><span></span><input type="text" /></form>'],r=JXG$1.createText(n,u,d),r.type=JXG$1.OBJECT_TYPE_HTMLSLIDER,r.rendNodeForm=r.rendNode.childNodes[0],r.rendNodeRange=r.rendNodeForm.childNodes[0],r.rendNodeRange.min=t[1][0],r.rendNodeRange.max=t[1][2],r.rendNodeRange.step=d.step,r.rendNodeRange.value=t[1][1],r.rendNodeLabel=r.rendNodeForm.childNodes[1],r.rendNodeLabel.id=r.rendNode.id+"_label",d.withlabel&&(r.rendNodeLabel.innerHTML=r.name+"="),r.rendNodeOut=r.rendNodeForm.childNodes[2],r.rendNodeOut.value=t[1][1];try{r.rendNodeForm.id=r.rendNode.id+"_form",r.rendNodeRange.id=r.rendNode.id+"_range",r.rendNodeOut.id=r.rendNode.id+"_out"}catch(C){JXG$1.debug(C)}return r.rendNodeRange.style.width=d.widthrange+"px",r.rendNodeRange.style.verticalAlign="middle",r.rendNodeOut.style.width=d.widthout+"px",r._val=t[1][1],JXG$1.supportsVML()?JXG$1.addEvent(r.rendNodeForm,"change",priv$5.HTMLSliderInputEventHandler,r):JXG$1.addEvent(r.rendNodeForm,"input",priv$5.HTMLSliderInputEventHandler,r),r.Value=function(){return this._val},r};JXG$1.registerElement("htmlslider",JXG$1.createHTMLSlider);const Text=JXG$1.Text;Object.create||(Object.create=function(n,t){if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object prototype may only be an Object: "+n);if(n===null)throw new Error("This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.");if(typeof t<"u")throw new Error("This browser's implementation of Object.create is a shim and doesn't support a second argument.");function o(){}return o.prototype=n,new o});var priv$4={modules:{math:Mat,"math/geometry":Geometry,"math/statistics":Statistics,"math/numerics":Mat.Numerics}};JXG$1.JessieCode=function(n,t){this.scope={id:0,hasChild:!0,args:[],locals:{},context:null,previous:null},this.scopes=[],this.scopes.push(this.scope),this.dpstack=[[]],this.pscope=0,this.propstack=[{}],this.propscope=0,this.lhs=[],this.isLHS=!1,this.warnLog="jcwarn",this.$log=[],this.builtIn=this.defineBuiltIn(),this.operands=this.getPossibleOperands(),this.board=null,this.forceValueCall=!1,this.lineToElement={},this.parCurLine=1,this.parCurColumn=0,this.line=1,this.col=1,JXG$1.CA&&(this.CA=new JXG$1.CA(this.node,this.createNode,this)),this.code="",typeof n=="string"&&this.parse(n,t)};JXG$1.extend(JXG$1.JessieCode.prototype,{node:function(n,t,o){return{type:n,value:t,children:o}},createNode:function(n,t,o){var r=this.node(n,t,[]),u;for(u=2;u<arguments.length;u++)r.children.push(arguments[u]);return r.type==="node_const"&&JXG$1.isNumber(r.value)&&(r.isMath=!0),r.line=this.parCurLine,r.col=this.parCurColumn,r},pushScope:function(n){var t={args:n,locals:{},context:null,previous:this.scope};return this.scope.hasChild=!0,this.scope=t,t.id=this.scopes.push(t)-1,t},popScope:function(){var n=this.scope.previous;return this.scope=n!==null?n:this.scope,this.scope},getElementById:function(n){return this.board.objects[n]},log:function(){this.$log.push(arguments),typeof console=="object"&&console.log&&console.log.apply(console,arguments)},creator:function(){var n={},t;return t=function(o){var r;return typeof n[this.board.id+o]=="function"?r=n[this.board.id+o]:(r=function(u){return function(d,C){var I;return JXG$1.exists(C)?I=C:I={},I.name===void 0&&I.id===void 0&&(I.name=u.lhs[u.scope.id]!==0?u.lhs[u.scope.id]:""),u.board.create(o,d,I)}}(this),r.creator=!0,n[this.board.id+o]=r),r},t.clearCache=function(){n={}},t}(),letvar:function(n,t){this.builtIn[n]&&this._warn('"'+n+'" is a predefined value.'),this.scope.locals[n]=t},isLocalVariable:function(n){for(var t=this.scope;t!==null;){if(JXG$1.exists(t.locals[n]))return t;t=t.previous}return null},isParameter:function(n){for(var t=this.scope;t!==null;){if(JXG$1.indexOf(t.args,n)>-1)return t;t=t.previous}return null},isCreator:function(n){return!!JXG$1.elements[n]},isMathMethod:function(n){return n!=="E"&&!!Math[n]},isBuiltIn:function(n){return!!this.builtIn[n]},getvar:function(n,t,o){var r;if(t=JXG$1.def(t,!1),r=this.isLocalVariable(n),r!==null)return r.locals[n];if(n==="$board"||n==="EULER"||n==="PI")return this.builtIn[n];if(o){if(this.isBuiltIn(n))return this.builtIn[n];if(this.isMathMethod(n))return Math[n];if(this.isCreator(n))return this.creator(n)}if(!t&&(r=this.board.select(n),r!==n))return r},resolve:function(n){for(var t=this.scope;t!==null;){if(JXG$1.exists(t.locals[n]))return t.locals[n];t=t.previous}},getvarJS:function(n,t,o){var r,u="",d;return t=JXG$1.def(t,!1),o=JXG$1.def(o,!1),r=this.isParameter(n),r!==null?n:(r=this.isLocalVariable(n),r!==null&&!o?"$jc$.resolve('"+n+"')":this.isCreator(n)?"(function () { var a = Array.prototype.slice.call(arguments, 0), props = "+(o?"a.pop()":"{}")+"; return $jc$.board.create.apply($jc$.board, ['"+n+"'].concat([a, props])); })":(o&&this._error("Syntax error (attribute values are allowed with element creators only)"),this.isBuiltIn(n)?(u=this.builtIn[n].src||this.builtIn[n],JXG$1.isNumber(u)||u.match(/board\.select/)?u:(n=u.split(".").pop(),JXG$1.exists(this.board.mathLib)&&(d=new RegExp("^Math."+n),d.exec(u)!==null)?u.replace(d,"$jc$.board.mathLib."+n):JXG$1.exists(this.board.mathLibJXG)?(d=new RegExp("^JXG.Math."),d.exec(u)!==null?u.replace(d,"$jc$.board.mathLibJXG."):u):u)):this.isMathMethod(n)?"$jc$.board.mathLib."+n:t?"":(JXG$1.isId(this.board,n)?(u="$jc$.board.objects['"+n+"']",this.board.objects[n].elType==="slider"&&(u+=".Value()")):JXG$1.isName(this.board,n)?(u="$jc$.board.elementsByName['"+n+"']",this.board.elementsByName[n].elType==="slider"&&(u+=".Value()")):JXG$1.isGroup(this.board,n)&&(u="$jc$.board.groups['"+n+"']"),u)))},makeMap:function(n){return n.isMap=!0,n},functionCodeJS:function(n){var t=n.children[0].join(", "),o="",r="";return n.value==="op_map"&&(o="{ return  ",r=" }"),"function ("+t+`) {
var $oldscope$ = $jc$.scope;
$jc$.scope = $jc$.scopes[`+this.scope.id+`];
var r = (function () `+o+this.compile(n.children[1],!0)+r+`)();
$jc$.scope = $oldscope$;
return r;
}`},defineFunction:function(node){var fun,i,that=this,list=node.children[0],scope=this.pushScope(list);if(this.board.options.jc.compile){for(this.isLHS=!1,i=0;i<list.length;i++)scope.locals[list[i]]=list[i];this.replaceNames(node.children[1]),fun=function(jc){var fun,str="var f = function($jc$) { return "+jc.functionCodeJS(node)+"}; f;";try{for(fun=eval(str)(jc),scope.argtypes=[],i=0;i<list.length;i++)scope.argtypes.push(that.resolveType(list[i],node));return fun}catch(n){return jc._warn(`error compiling function

`+str+`

`+n.toString()),function(){}}}(this),this.popScope()}else fun=function(n,t,o){return function(){var r,u;for(u=t.scope,t.scope=t.scopes[o],r=0;r<n.length;r++)t.scope.locals[n[r]]=arguments[r];return r=t.execute(node.children[1]),t.scope=u,r}}(list,this,scope.id);return fun.node=node,fun.scope=scope,fun.toJS=fun.toString,fun.toString=function(n){return function(){return n.compile(n.replaceIDs(JXG$1.deepCopy(node)))}}(this),fun.deps={},this.collectDependencies(node.children[1],node.children[0],fun.deps),fun},mergeAttributes:function(n){var t,o={};for(t=0;t<arguments.length;t++)o=JXG$1.deepCopy(o,arguments[t],!0);return o},setProp:function(n,t,o){var r={},u,d;n.elementClass===Const.OBJECT_CLASS_POINT&&(t==="X"||t==="Y")?(t=t.toLowerCase(),n.isDraggable&&typeof o=="number"?(u=t==="x"?o:n.X(),d=t==="y"?o:n.Y(),n.setPosition(Const.COORDS_BY_USER,[u,d])):n.isDraggable&&(typeof o=="function"||typeof o=="string")?(u=t==="x"?o:n.coords.usrCoords[1],d=t==="y"?o:n.coords.usrCoords[2],n.addConstraint([u,d])):n.isDraggable||(u=t==="x"?o:n.XEval.origin,d=t==="y"?o:n.YEval.origin,n.addConstraint([u,d])),this.board.update()):n.elementClass===Const.OBJECT_CLASS_TEXT&&(t==="X"||t==="Y")?(typeof o=="number"?n[t]=function(){return o}:typeof o=="function"?(n.isDraggable=!1,n[t]=o):typeof o=="string"&&(n.isDraggable=!1,n[t]=JXG$1.createFunction(o,this.board),n[t+"jc"]=o),n[t].origin=o,this.board.update()):n.type&&n.elementClass&&n.visProp?JXG$1.exists(n[n.methodMap[t]])&&typeof n[n.methodMap[t]]!="function"?n[n.methodMap[t]]=o:(r[t]=o,n.setAttribute(r)):n[t]=o},_genericParse:function(n,t,o,r){var u,d,C,I,f=n.replace(/\r\n/g,`
`).split(`
`),A=[];r||(this.code+=n+`
`),Text&&(d=Text.prototype.setText,Text.prototype.setText=Text.prototype.setTextJessieCode);try{for(JXG$1.exists(o)||(o=!1),u=0;u<f.length;u++)o&&(f[u]=JXG$1.GeonextParser.geonext2JS(f[u],this.board)),A.push(f[u]);switch(n=A.join(`
`),C=parser.parse(n),this.CA&&(C=this.CA.expandDerivatives(C,null,C),C=this.CA.removeTrivialNodes(C)),t){case"parse":I=this.execute(C);break;case"manipulate":I=this.compile(C);break;case"getAst":I=C;break;default:I=!1}}catch(G){throw G}finally{Text&&(Text.prototype.setText=d)}return I},parse:function(n,t,o){return this._genericParse(n,"parse",t,o)},manipulate:function(n,t,o){return this._genericParse(n,"manipulate",t,o)},getAST:function(n,t,o){return this._genericParse(n,"getAst",t,o)},snippet:function(n,t,o,r,u){var d;return t=JXG$1.def(t,!0),o=JXG$1.def(o,""),r=JXG$1.def(r,!1),this.forceValueCall=JXG$1.def(u,!0),d=(t?" function ("+o+") { return ":"")+n+(t?"; }":"")+";",this.parse(d,r,!0)},replaceIDs:function(n){var t,o;if(n.replaced&&(o=this.board.objects[n.children[1][0].value],JXG$1.exists(o)&&o.name!==""&&(n.type="node_var",n.value=o.name,n.children.length=0,delete n.replaced)),JXG$1.isArray(n))for(t=0;t<n.length;t++)n[t]=this.replaceIDs(n[t]);if(n.children)for(t=n.children.length;t>0;t--)JXG$1.exists(n.children[t-1])&&(n.children[t-1]=this.replaceIDs(n.children[t-1]));return n},replaceNames:function(n,t){var o,r,u=!1;if(t!==void 0&&(u=t),r=n.value,n.type==="node_op"&&r==="op_lhs"&&n.children.length===1?this.isLHS=!0:n.type==="node_var"&&(this.isLHS?this.letvar(r,!0):!JXG$1.exists(this.getvar(r,!0))&&JXG$1.exists(this.board.elementsByName[r])&&(u&&this.board.elementsByName[r].elType!=="slider"&&(u=!1),n=this.createReplacementNode(n,u))),JXG$1.isArray(n))for(o=0;o<n.length;o++)n[o]=this.replaceNames(n[o],u);if(n.children)for(this.forceValueCall&&(n.value==="op_execfun"&&n.children[0].value!=="V"&&n.children[0].value!=="$"&&(JXG$1.exists(Math[n.children[0].value])||JXG$1.exists(Mat[n.children[0].value]))&&n.children[1][0].type==="node_var"||n.value==="op_return"&&n.children.length===1&&n.children[0].type==="node_var")&&(u=!0),o=n.children.length;o>0;o--)JXG$1.exists(n.children[o-1])&&(n.children[o-1]=this.replaceNames(n.children[o-1],u));return n.type==="node_op"&&n.value==="op_lhs"&&n.children.length===1&&(this.isLHS=!1),n},createReplacementNode:function(n,t){var o=n.value,r=this.board.elementsByName[o];return n=this.createNode("node_op","op_execfun",this.createNode("node_var",t===!0?"$value":"$"),[this.createNode("node_str",r.id)]),n.replaced=!0,n},collectDependencies:function(n,t,o){var r,u,d,C;if(JXG$1.isArray(n)){for(C=n.length,r=0;r<C;r++)this.collectDependencies(n[r],t,o);return}if(u=n.value,n.type==="node_var"&&t.indexOf(u)<0&&(d=this.getvar(u),d&&d.visProp&&d.elType&&d.elementClass&&d.id&&d.elType==="slider"&&(o[d.id]=d)),n.type==="node_op"&&n.value==="op_execfun"&&n.children.length>1&&(n.children[0].value==="$"||n.children[0].value==="$value")&&n.children[1].length>0&&(d=n.children[1][0].value,o[d]=this.board.objects[d]),n.children)for(r=n.children.length;r>0;r--)JXG$1.exists(n.children[r-1])&&this.collectDependencies(n.children[r-1],t,o)},resolveProperty:function(n,t,o){return o=JXG$1.def(o,!1),n&&n.methodMap&&(JXG$1.exists(n.subs)&&JXG$1.exists(n.subs[t])?n=n.subs:JXG$1.exists(n.methodMap[t])?t=n.methodMap[t]:(n=n.visProp,t=t.toLowerCase())),JXG$1.isFunction(n)&&this._error("Accessing function properties is not allowed."),JXG$1.exists(n)||this._error(n+" is not an object"),JXG$1.exists(n[t])||this._error("unknown property "+t),o&&typeof n[t]=="function"?function(){return n[t].apply(n,arguments)}:n[t]},resolveType:function(n,t){var o,r,u="any";if(JXG$1.isArray(t)){for(o=0;o<t.length;o++)if(r=this.resolveType(n,t[o]),r!=="any")return u=r,u}if(t.type==="node_op"&&t.value==="op_execfun"&&t.children[0].type==="node_var"&&t.children[0].value===n)return"function";if(t.type==="node_op"){for(o=0;o<t.children.length;o++)if(t.children[0].type==="node_var"&&t.children[0].value===n&&(t.value==="op_add"||t.value==="op_sub"||t.value==="op_mul"||t.value==="op_div"||t.value==="op_mod"||t.value==="op_exp"||t.value==="op_neg"))return"any";for(o=0;o<t.children.length;o++)if(r=this.resolveType(n,t.children[o]),r!=="any")return u=r,u}return"any"},getLHS:function(n){var t;if(n.type==="node_var")t={o:this.scope.locals,what:n.value};else if(n.type==="node_op"&&n.value==="op_property")t={o:this.execute(n.children[0]),what:n.children[1]};else if(n.type==="node_op"&&n.value==="op_extvalue")t={o:this.execute(n.children[0]),what:this.execute(n.children[1])};else throw new Error("Syntax error: Invalid left-hand side of assignment.");return t},getLHSCompiler:function(n,t){var o;if(n.type==="node_var")o=n.value;else if(n.type==="node_op"&&n.value==="op_property")o=[this.compile(n.children[0],t),"'"+n.children[1]+"'"];else if(n.type==="node_op"&&n.value==="op_extvalue")o=[this.compile(n.children[0],t),n.children[1].type==="node_const"?n.children[1].value:this.compile(n.children[1],t)];else throw new Error("Syntax error: Invalid left-hand side of assignment.");return o},execute:function(n){var t,o,r,u,d,C,I,f,A=[],G,B,Z;if(t=0,!n)return t;switch(this.line=n.line,this.col=n.col,n.type){case"node_op":switch(n.value){case"op_none":n.children[0]&&this.execute(n.children[0]),n.children[1]&&(t=this.execute(n.children[1]));break;case"op_assign":o=this.getLHS(n.children[0]),this.lhs[this.scope.id]=o.what,o.o.type&&o.o.elementClass&&o.o.methodMap&&o.what==="label"&&this._error("Left-hand side of assignment is read-only."),t=this.execute(n.children[1]),o.o!==this.scope.locals||JXG$1.isArray(o.o)&&typeof o.what=="number"?this.setProp(o.o,o.what,t):this.letvar(o.what,t),this.lhs[this.scope.id]=0;break;case"op_if":this.execute(n.children[0])&&(t=this.execute(n.children[1]));break;case"op_conditional":case"op_if_else":this.execute(n.children[0])?t=this.execute(n.children[1]):t=this.execute(n.children[2]);break;case"op_while":for(;this.execute(n.children[0]);)this.execute(n.children[1]);break;case"op_do":do this.execute(n.children[0]);while(this.execute(n.children[1]));break;case"op_for":for(this.execute(n.children[0]);this.execute(n.children[1]);this.execute(n.children[2]))this.execute(n.children[3]);break;case"op_proplst":n.children[0]&&this.execute(n.children[0]),n.children[1]&&this.execute(n.children[1]);break;case"op_emptyobject":t={};break;case"op_proplst_val":this.propstack.push({}),this.propscope++,this.execute(n.children[0]),t=this.propstack[this.propscope],this.propstack.pop(),this.propscope--;break;case"op_prop":this.propstack[this.propscope][n.children[0]]=this.execute(n.children[1]);break;case"op_array":for(t=[],d=n.children[0].length,r=0;r<d;r++)t.push(this.execute(n.children[0][r]));break;case"op_extvalue":t=this.execute(n.children[0]),r=this.execute(n.children[1]),typeof r=="number"&&Math.abs(Math.round(r)-r)<Mat.eps?t=t[r]:t=C;break;case"op_return":if(this.scope===0)this._error("Unexpected return.");else return this.execute(n.children[0]);break;case"op_map":!n.children[1].isMath&&n.children[1].type!=="node_var"&&this._error("execute: In a map only function calls and mathematical expressions are allowed."),G=this.defineFunction(n),G.isMap=!0,t=G;break;case"op_function":G=this.defineFunction(n),G.isMap=!1,t=G;break;case"op_execfun":if(this.dpstack.push([]),this.pscope++,I=n.children[1],JXG$1.exists(n.children[2]))if(n.children[3])for(f=n.children[2],B={},r=0;r<f.length;r++)B=JXG$1.deepCopy(B,this.execute(f[r]),!0);else B=this.execute(n.children[2]);for(n.children[0]._isFunctionName=!0,G=this.execute(n.children[0]),delete n.children[0]._isFunctionName,JXG$1.exists(G)&&JXG$1.exists(G.sc)?Z=G.sc:Z=this,!G.creator&&JXG$1.exists(n.children[2])&&this._error("Unexpected value. Only element creators are allowed to have a value after the function call."),r=0;r<I.length;r++)JXG$1.exists(G.scope)&&JXG$1.exists(G.scope.argtypes)&&G.scope.argtypes[r]==="function"?(I[r]._isFunctionName=!0,A[r]=this.execute(I[r]),delete I[r]._isFunctionName):A[r]=this.execute(I[r]),this.dpstack[this.pscope].push({line:n.children[1][r].line,col:n.children[1][r].ecol});if(typeof G=="function"&&!G.creator)t=G.apply(Z,A);else if(typeof G=="function"&&G.creator){u=this.line;try{for(t=G(A,B),t.jcLineStart=u,t.jcLineEnd=n.eline,r=u;r<=n.line;r++)this.lineToElement[r]=t;t.debugParents=this.dpstack[this.pscope]}catch(w){this._error(w.toString())}}else this._error("Function '"+G+"' is undefined.");this.dpstack.pop(),this.pscope--;break;case"op_property":u=this.execute(n.children[0]),o=n.children[1],t=this.resolveProperty(u,o,!1),JXG$1.exists(t)&&["number","string","boolean"].indexOf(typeof t)<0&&(t.sc=u);break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),this.use(n.children[0].toString());break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),o=this.getvar(n.children[0]),t=this.del(o);break;case"op_eq":t=this.execute(n.children[0])==this.execute(n.children[1]);break;case"op_neq":t=this.execute(n.children[0])!=this.execute(n.children[1]);break;case"op_approx":t=Math.abs(this.execute(n.children[0])-this.execute(n.children[1]))<Mat.eps;break;case"op_gt":t=this.execute(n.children[0])>this.execute(n.children[1]);break;case"op_lt":t=this.execute(n.children[0])<this.execute(n.children[1]);break;case"op_geq":t=this.execute(n.children[0])>=this.execute(n.children[1]);break;case"op_leq":t=this.execute(n.children[0])<=this.execute(n.children[1]);break;case"op_or":t=this.execute(n.children[0])||this.execute(n.children[1]);break;case"op_and":t=this.execute(n.children[0])&&this.execute(n.children[1]);break;case"op_not":t=!this.execute(n.children[0]);break;case"op_add":t=this.add(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_sub":t=this.sub(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_div":t=this.div(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_mod":t=this.mod(this.execute(n.children[0]),this.execute(n.children[1]),!0);break;case"op_mul":t=this.mul(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_exp":t=this.pow(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_neg":t=this.neg(this.execute(n.children[0]));break}break;case"node_var":t=this.getvar(n.value,!1,n._isFunctionName);break;case"node_const":n.value===null?t=null:t=Number(n.value);break;case"node_const_bool":t=n.value;break;case"node_str":t=n.value.replace(/\\(.)/g,"$1");break}return t},compile:function(n,t){var o,r,u,d="";if(JXG$1.exists(t)||(t=!1),!n)return d;switch(n.type){case"node_op":switch(n.value){case"op_none":n.children[0]&&(d=this.compile(n.children[0],t)),n.children[1]&&(d+=this.compile(n.children[1],t));break;case"op_assign":t?(o=this.getLHSCompiler(n.children[0],t),JXG$1.isArray(o)?d="$jc$.setProp("+o[0]+", "+o[1]+", "+this.compile(n.children[1],t)+`);
`:(this.isLocalVariable(o)!==this.scope&&(this.scope.locals[o]=!0),d="$jc$.scopes["+this.scope.id+"].locals['"+o+"'] = "+this.compile(n.children[1],t)+`;
`)):(o=this.compile(n.children[0]),d=o+" = "+this.compile(n.children[1],t)+`;
`);break;case"op_if":d=" if ("+this.compile(n.children[0],t)+") "+this.compile(n.children[1],t);break;case"op_if_else":d=" if ("+this.compile(n.children[0],t)+")"+this.compile(n.children[1],t),d+=" else "+this.compile(n.children[2],t);break;case"op_conditional":d="(("+this.compile(n.children[0],t)+")?("+this.compile(n.children[1],t),d+="):("+this.compile(n.children[2],t)+"))";break;case"op_while":d=" while ("+this.compile(n.children[0],t)+`) {
`+this.compile(n.children[1],t)+`}
`;break;case"op_do":d=` do {
`+this.compile(n.children[0],t)+"} while ("+this.compile(n.children[1],t)+`);
`;break;case"op_for":d=" for ("+this.compile(n.children[0],t)+this.compile(n.children[1],t)+"; "+this.compile(n.children[2],t).slice(0,-2)+`) {
`+this.compile(n.children[3],t)+`
}
`;break;case"op_proplst":n.children[0]&&(d=this.compile(n.children[0],t)+", "),d+=this.compile(n.children[1],t);break;case"op_prop":d=n.children[0]+": "+this.compile(n.children[1],t);break;case"op_emptyobject":d=t?"{}":"<< >>";break;case"op_proplst_val":d=this.compile(n.children[0],t);break;case"op_array":for(u=[],r=0;r<n.children[0].length;r++)u.push(this.compile(n.children[0][r],t));d="["+u.join(", ")+"]";break;case"op_extvalue":d=this.compile(n.children[0],t)+"["+this.compile(n.children[1],t)+"]";break;case"op_return":d=" return "+this.compile(n.children[0],t)+`;
`;break;case"op_map":!n.children[1].isMath&&n.children[1].type!=="node_var"&&this._error("compile: In a map only function calls and mathematical expressions are allowed."),u=n.children[0],t?d=" $jc$.makeMap(function ("+u.join(", ")+") { return "+this.compile(n.children[1],t)+"; })":d="map ("+u.join(", ")+") -> "+this.compile(n.children[1],t);break;case"op_function":u=n.children[0],this.pushScope(u),t?d=this.functionCodeJS(n):d=" function ("+u.join(", ")+") "+this.compile(n.children[1],t),this.popScope();break;case"op_execfunmath":console.log("op_execfunmath: TODO"),d="-1";break;case"op_execfun":if(n.children[2]){for(u=[],r=0;r<n.children[2].length;r++)u.push(this.compile(n.children[2][r],t));t?o="$jc$.mergeAttributes("+u.join(", ")+")":o=u.join(", ")}for(n.children[0].withProps=!!n.children[2],u=[],r=0;r<n.children[1].length;r++)u.push(this.compile(n.children[1][r],t));d=this.compile(n.children[0],t)+"("+u.join(", ")+(n.children[2]&&t?", "+o:"")+")"+(n.children[2]&&!t?" "+o:""),t&&(d+=`
`),t&&n.children[0].value==="$"&&(d="$jc$.board.objects["+this.compile(n.children[1][0],t)+"]");break;case"op_property":t&&n.children[1]!=="X"&&n.children[1]!=="Y"?d="$jc$.resolveProperty("+this.compile(n.children[0],t)+", '"+n.children[1]+"', true)":d=this.compile(n.children[0],t)+"."+n.children[1];break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),t?d="$jc$.use('":d="use('",d+=n.children[0].toString()+"');";break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),t?d="$jc$.del(":d="remove(",d+=this.compile(n.children[0],t)+")";break;case"op_eq":d="("+this.compile(n.children[0],t)+" === "+this.compile(n.children[1],t)+")";break;case"op_neq":d="("+this.compile(n.children[0],t)+" !== "+this.compile(n.children[1],t)+")";break;case"op_approx":d="("+this.compile(n.children[0],t)+" ~= "+this.compile(n.children[1],t)+")";break;case"op_gt":t?d="$jc$.gt("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" > "+this.compile(n.children[1],t)+")";break;case"op_lt":t?d="$jc$.lt("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" < "+this.compile(n.children[1],t)+")";break;case"op_geq":t?d="$jc$.geq("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" >= "+this.compile(n.children[1],t)+")";break;case"op_leq":t?d="$jc$.leq("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" <= "+this.compile(n.children[1],t)+")";break;case"op_or":d="("+this.compile(n.children[0],t)+" || "+this.compile(n.children[1],t)+")";break;case"op_and":d="("+this.compile(n.children[0],t)+" && "+this.compile(n.children[1],t)+")";break;case"op_not":d="!("+this.compile(n.children[0],t)+")";break;case"op_add":t?d="$jc$.add("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" + "+this.compile(n.children[1],t)+")";break;case"op_sub":t?d="$jc$.sub("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" - "+this.compile(n.children[1],t)+")";break;case"op_div":t?d="$jc$.div("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" / "+this.compile(n.children[1],t)+")";break;case"op_mod":t?d="$jc$.mod("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+", true)":d="("+this.compile(n.children[0],t)+" % "+this.compile(n.children[1],t)+")";break;case"op_mul":t?d="$jc$.mul("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+" * "+this.compile(n.children[1],t)+")";break;case"op_exp":t?d="$jc$.pow("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":d="("+this.compile(n.children[0],t)+"^"+this.compile(n.children[1],t)+")";break;case"op_neg":t?d="$jc$.neg("+this.compile(n.children[0],t)+")":d="(-"+this.compile(n.children[0],t)+")";break}break;case"node_var":t?d=this.getvarJS(n.value,!1,n.withProps):d=n.value;break;case"node_const":d=n.value;break;case"node_const_bool":d=n.value;break;case"node_str":d="'"+n.value+"'";break}return n.needsBrackets&&(d=`{
`+d+` }
`),n.needsAngleBrackets&&(t?d=`{
`+d+` }
`:d="<< "+d+` >>
`),d},getName:function(n,t){var o="";return JXG$1.exists(n)&&JXG$1.exists(n.getName)?(o=n.getName(),(!JXG$1.exists(o)||o==="")&&t&&(o=n.id)):t&&(o=n.id),o},X:function(n){return n.X()},Y:function(n){return n.Y()},V:function(n){return n.Value()},L:function(n){return n.L()},area:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Area))&&this._error("Error: Can't calculate area."),n.Area()},perimeter:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Perimeter))&&this._error("Error: Can't calculate perimeter."),n.Perimeter()},dist:function(n,t){return(!JXG$1.exists(n)||!JXG$1.exists(n.Dist))&&this._error("Error: Can't calculate distance."),n.Dist(t)},radius:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Radius))&&this._error("Error: Can't calculate radius."),n.Radius()},slope:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Slope))&&this._error("Error: Can't calculate slope."),n.Slope()},add:function(n,t){var o,r,u;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))u=Interval.add(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),u=[],o=0;o<r;o++)u[o]=n[o]+t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?u=n+t:JXG$1.isString(n)||JXG$1.isString(t)?u=n.toString()+t.toString():this._error("Operation + not defined on operands "+typeof n+" and "+typeof t);return u},sub:function(n,t){var o,r,u;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))u=Interval.sub(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(r=Math.min(n.length,t.length),u=[],o=0;o<r;o++)u[o]=n[o]-t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?u=n-t:this._error("Operation - not defined on operands "+typeof n+" and "+typeof t);return u},neg:function(n){var t,o,r;if(n=JXG$1.evalSlider(n),Interval.isInterval(n))r=Interval.negative(n);else if(JXG$1.isArray(n))for(o=n.length,r=[],t=0;t<o;t++)r[t]=-n[t];else JXG$1.isNumber(n)?r=-n:this._error("Unary operation - not defined on operand "+typeof n);return r},mul:function(n,t){var o,r,u;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t)&&(o=n,n=t,t=n),Interval.isInterval(n)||Interval.isInterval(t))u=Interval.mul(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))r=Math.min(n.length,t.length),u=Mat.innerProduct(n,t,r);else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(r=t.length,u=[],o=0;o<r;o++)u[o]=n*t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?u=n*t:this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return u},div:function(n,t){var o,r,u;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))u=Interval.div(n,t);else if(JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,u=[],o=0;o<r;o++)u[o]=n[o]/t;else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?u=n/t:this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return u},mod:function(n,t){var o,r,u;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))return Interval.fmod(n,t);if(JXG$1.isArray(n)&&JXG$1.isNumber(t))for(r=n.length,u=[],o=0;o<r;o++)u[o]=Mat.mod(n[o],t,!0);else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?u=Mat.mod(n,t,!0):this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return u},pow:function(n,t){return n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t)?Interval.pow(n,t):Mat.pow(n,t)},lt:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.lt(n,t):n<t},leq:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.leq(n,t):n<=t},gt:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.gt(n,t):n>t},geq:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.geq(n,t):n>=t},randint:function(n,t,o){return JXG$1.exists(o)||(o=1),Math.round(Math.random()*(t-n)/o)*o+n},DDD:function(n){console.log("Dummy derivative function. This should never appear!")},ifthen:function(n,t,o){return n?t:o},del:function(n){typeof n=="object"&&JXG$1.exists(n.type)&&JXG$1.exists(n.elementClass)&&this.board.removeObject(n)},eval:function(n){return JXG$1.evaluate(n)},use:function(n){var t,o,r=!1;if(typeof n=="string"){for(t in JXG$1.boards)if(JXG$1.boards.hasOwnProperty(t)&&JXG$1.boards[t].container===n){o=JXG$1.boards[t],r=!0;break}}else o=n,r=!0;r?(this.board=o,this.builtIn.$board=o,this.builtIn.$board.src="$jc$.board"):this._error("Board '"+n+"' not found!")},findSymbol:function(n,t){var o,r;for(t=JXG$1.def(t,-1),t===-1?r=this.scope:r=this.scopes[t];r!==null;){for(o in r.locals)if(r.locals.hasOwnProperty(o)&&r.locals[o]===n)return[o,r];r=r.previous}return[]},importModule:function(n){return priv$4.modules[n.toLowerCase()]},defineBuiltIn:function(){var n=this,t={PI:Math.PI,EULER:Math.E,D:n.DDD,X:n.X,Y:n.Y,V:n.V,Value:n.V,L:n.L,Length:n.L,acosh:Mat.acosh,acot:Mat.acot,asinh:Mat.asinh,binomial:Mat.binomial,cbrt:Mat.cbrt,cosh:Mat.cosh,cot:Mat.cot,deg:Geometry.trueAngle,A:n.area,area:n.area,Area:n.area,perimeter:n.perimeter,Perimeter:n.perimeter,dist:n.dist,Dist:n.dist,R:n.radius,radius:n.radius,Radius:n.radius,erf:Mat.erf,erfc:Mat.erfc,erfi:Mat.erfi,factorial:Mat.factorial,gcd:Mat.gcd,lb:Mat.log2,lcm:Mat.lcm,ld:Mat.log2,lg:Mat.log10,ln:Math.log,log:Mat.log,log10:Mat.log10,log2:Mat.log2,ndtr:Mat.ndtr,ndtri:Mat.ndtri,nthroot:Mat.nthroot,pow:Mat.pow,rad:Geometry.rad,ratpow:Mat.ratpow,trunc:JXG$1.trunc,sinh:Mat.sinh,slope:n.slope,Slope:n.slope,randint:n.randint,IfThen:n.ifthen,import:n.importModule,eval:n.eval,use:n.use,remove:n.del,$:n.getElementById,$value:function(o){return n.getElementById(o).Value()},getName:n.getName,name:n.getName,$board:n.board,$log:n.log};return t.rad.sc=Geometry,t.deg.sc=Geometry,t.factorial.sc=Mat,t.X.src="$jc$.X",t.Y.src="$jc$.Y",t.V.src="$jc$.V",t.Value.src="$jc$.V",t.L.src="$jc$.L",t.Length.src="$jc$.L",t.acosh.src="JXG.Math.acosh",t.acot.src="JXG.Math.acot",t.asinh.src="JXG.Math.asinh",t.binomial.src="JXG.Math.binomial",t.cbrt.src="JXG.Math.cbrt",t.cot.src="JXG.Math.cot",t.cosh.src="JXG.Math.cosh",t.deg.src="JXG.Math.Geometry.trueAngle",t.erf.src="JXG.Math.erf",t.erfc.src="JXG.Math.erfc",t.erfi.src="JXG.Math.erfi",t.A.src="$jc$.area",t.area.src="$jc$.area",t.Area.src="$jc$.area",t.perimeter.src="$jc$.perimeter",t.Perimeter.src="$jc$.perimeter",t.dist.src="$jc$.dist",t.Dist.src="$jc$.dist",t.R.src="$jc$.radius",t.radius.src="$jc$.radius",t.Radius.src="$jc$.radius",t.factorial.src="JXG.Math.factorial",t.gcd.src="JXG.Math.gcd",t.lb.src="JXG.Math.log2",t.lcm.src="JXG.Math.lcm",t.ld.src="JXG.Math.log2",t.lg.src="JXG.Math.log10",t.ln.src="Math.log",t.log.src="JXG.Math.log",t.log10.src="JXG.Math.log10",t.log2.src="JXG.Math.log2",t.ndtr.src="JXG.Math.ndtr",t.ndtri.src="JXG.Math.ndtri",t.nthroot.src="JXG.Math.nthroot",t.pow.src="JXG.Math.pow",t.rad.src="JXG.Math.Geometry.rad",t.ratpow.src="JXG.Math.ratpow",t.trunc.src="JXG.trunc",t.sinh.src="JXG.Math.sinh",t.slope.src="$jc$.slope",t.Slope.src="$jc$.slope",t.randint.src="$jc$.randint",t.import.src="$jc$.importModule",t.eval.src="$jc$.eval",t.use.src="$jc$.use",t.remove.src="$jc$.del",t.IfThen.src="$jc$.ifthen",t.$.src="(function (n) { return $jc$.board.select(n); })",t.$value.src="(function (n) { return $jc$.board.select(n).Value(); })",t.getName.src="$jc$.getName",t.name.src="$jc$.getName",t.$board&&(t.$board.src="$jc$.board"),t.$log.src="$jc$.log",t=JXG$1.merge(t,n._addedBuiltIn),t},_addedBuiltIn:{},addBuiltIn:function(n,t){if(JXG$1.exists(this.builtIn)){if(JXG$1.exists(this.builtIn[n]))return;this.builtIn[n]=t,this.builtIn[n].src="$jc$."+n}JXG$1.exists(this._addedBuiltIn[n])||(this._addedBuiltIn[n]=t,this._addedBuiltIn[n].src="$jc$."+n,JXG$1.JessieCode.prototype[n]=t)},getPossibleOperands:function(){var n=["E"],t=this.builtIn||this.defineBuiltIn(),o=Math,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J;for(Y=function(T,L){return T.toLowerCase().localeCompare(L.toLowerCase())},J=function(T,L){var z=null;if(L==="jc")z=t[T];else if(L==="Math")z=o[T];else return;if(!(n.indexOf(T)>=0)){if(JXG$1.isFunction(z))return{name:T,type:"function",numParams:z.length,origin:L};if(JXG$1.isNumber(z))return{name:T,type:"constant",value:z,origin:L};T.startsWith("$")||z!==void 0&&console.error("undefined type",z)}},r=Object.getOwnPropertyNames(t).sort(Y),u=Object.getOwnPropertyNames(o).sort(Y),d=[],C=0,I=0;C<r.length||I<u.length;)r[C]===u[I]?(f=J(u[I],"Math"),JXG$1.exists(f)&&d.push(f),C++,I++):!JXG$1.exists(u[I])||r[C].toLowerCase().localeCompare(u[I].toLowerCase())<0?(f=J(r[C],"jc"),JXG$1.exists(f)&&d.push(f),C++):(f=J(u[I],"Math"),JXG$1.exists(f)&&d.push(f),I++);for(B=[],Z=[],w=[],V={},A=d.length,C=0;C<A;C++){switch(G=d[C],G.type){case"function":B.push(G.name),G.origin==="jc"&&Z.push(G.name);break;case"constant":w.push(G.name);break}V[G.name]=G}return{all:V,list:d,functions:B,functions_jessiecode:Z,constants:w}},_debug:function(n){typeof console=="object"?console.log(n):JXG$1.isBrowser&&document&&document.getElementById("debug")!==null&&(document.getElementById("debug").innerHTML+=n+"<br />")},_error:function(n){var t=new Error("Error("+this.line+"): "+n);throw t.line=this.line,t},_warn:function(n){typeof console=="object"?console.log("Warning("+this.line+"): "+n):JXG$1.isBrowser&&document&&document.getElementById(this.warnLog)!==null&&(document.getElementById(this.warnLog).innerHTML+="Warning("+this.line+"): "+n+"<br />")},_log:function(n){typeof window!="object"&&typeof self=="object"&&self.postMessage?self.postMessage({type:"log",msg:"Log: "+n.toString()}):console.log("Log: ",arguments)}});var parser=function(){var n=function(Et,De,ct,ft){for(ct=ct||{},ft=Et.length;ft--;ct[Et[ft]]=De);return ct},t=[2,14],o=[1,13],r=[1,37],u=[1,14],d=[1,15],C=[1,21],I=[1,16],f=[1,17],A=[1,33],G=[1,18],B=[1,19],Z=[1,12],w=[1,59],V=[1,60],Y=[1,58],J=[1,46],T=[1,48],L=[1,49],z=[1,50],K=[1,51],P=[1,52],$=[1,53],ie=[1,54],ne=[1,45],ee=[1,38],se=[1,39],re=[5,7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],ce=[5,7,8,12,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],ue=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],ye=[2,48],Se=[1,72],Ce=[10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,66,83,86],Ze=[1,78],Be=[8,10,16,32,34,35,37,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],xe=[1,82],ge=[8,10,16,32,34,35,37,39,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],de=[1,83],ve=[1,84],le=[1,85],Ae=[8,10,16,32,34,35,37,39,41,42,43,50,51,53,54,55,57,64,65,66,83,86],Xe=[1,89],Te=[1,90],Ne=[1,91],We=[1,92],dt=[1,97],nt=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,53,54,55,57,64,65,66,83,86],Rt=[1,103],Qe=[1,104],Oe=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,57,64,65,66,83,86],be=[1,105],yt=[1,106],st=[1,107],Gt=[1,126],rt=[1,139],Yt=[83,86],Xt=[1,150],Ge=[10,66,86],he=[8,10,16,20,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,82,83,86],ke=[1,167],it=[10,86],ht={trace:function(){},yy:{},symbols_:{error:2,Program:3,StatementList:4,EOF:5,IfStatement:6,IF:7,"(":8,Expression:9,")":10,Statement:11,ELSE:12,LoopStatement:13,WHILE:14,FOR:15,";":16,DO:17,UnaryStatement:18,USE:19,IDENTIFIER:20,DELETE:21,ReturnStatement:22,RETURN:23,EmptyStatement:24,StatementBlock:25,"{":26,"}":27,ExpressionStatement:28,AssignmentExpression:29,ConditionalExpression:30,LeftHandSideExpression:31,"=":32,LogicalORExpression:33,"?":34,":":35,LogicalANDExpression:36,"||":37,EqualityExpression:38,"&&":39,RelationalExpression:40,"==":41,"!=":42,"~=":43,AdditiveExpression:44,"<":45,">":46,"<=":47,">=":48,MultiplicativeExpression:49,"+":50,"-":51,UnaryExpression:52,"*":53,"/":54,"%":55,ExponentExpression:56,"^":57,"!":58,MemberExpression:59,CallExpression:60,PrimaryExpression:61,FunctionExpression:62,MapExpression:63,".":64,"[":65,"]":66,BasicLiteral:67,ObjectLiteral:68,ArrayLiteral:69,NullLiteral:70,BooleanLiteral:71,StringLiteral:72,NumberLiteral:73,NULL:74,TRUE:75,FALSE:76,STRING:77,NUMBER:78,NAN:79,INFINITY:80,ElementList:81,"<<":82,">>":83,PropertyList:84,Property:85,",":86,PropertyName:87,Arguments:88,AttributeList:89,Attribute:90,FUNCTION:91,ParameterDefinitionList:92,MAP:93,"->":94,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"IF",8:"(",10:")",12:"ELSE",14:"WHILE",15:"FOR",16:";",17:"DO",19:"USE",20:"IDENTIFIER",21:"DELETE",23:"RETURN",26:"{",27:"}",32:"=",34:"?",35:":",37:"||",39:"&&",41:"==",42:"!=",43:"~=",45:"<",46:">",47:"<=",48:">=",50:"+",51:"-",53:"*",54:"/",55:"%",57:"^",58:"!",64:".",65:"[",66:"]",74:"NULL",75:"TRUE",76:"FALSE",77:"STRING",78:"NUMBER",79:"NAN",80:"INFINITY",82:"<<",83:">>",86:",",91:"FUNCTION",93:"MAP",94:"->"},productions_:[0,[3,2],[6,5],[6,7],[13,5],[13,9],[13,7],[18,2],[18,2],[22,2],[22,3],[24,1],[25,3],[4,2],[4,0],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[28,2],[9,1],[29,1],[29,3],[30,1],[30,5],[33,1],[33,3],[36,1],[36,3],[38,1],[38,3],[38,3],[38,3],[40,1],[40,3],[40,3],[40,3],[40,3],[44,1],[44,3],[44,3],[49,1],[49,3],[49,3],[49,3],[56,1],[56,3],[52,1],[52,2],[52,2],[52,2],[31,1],[31,1],[59,1],[59,1],[59,1],[59,3],[59,4],[61,1],[61,1],[61,1],[61,1],[61,3],[67,1],[67,1],[67,1],[67,1],[70,1],[71,1],[71,1],[72,1],[73,1],[73,1],[73,1],[69,2],[69,3],[68,2],[68,3],[84,1],[84,3],[85,3],[87,1],[87,1],[87,1],[60,2],[60,3],[60,2],[60,4],[60,3],[88,2],[88,3],[89,1],[89,3],[90,1],[90,1],[81,1],[81,3],[62,4],[62,5],[63,5],[63,6],[92,1],[92,3]],performAction:function(De,ct,ft,At,Ct,me,Ee){var _e=me.length-1;switch(Ct){case 1:return me[_e-1];case 2:this.$=He.createNode(ot(Ee[_e-4]),"node_op","op_if",me[_e-2],me[_e]);break;case 3:this.$=He.createNode(ot(Ee[_e-6]),"node_op","op_if_else",me[_e-4],me[_e-2],me[_e]);break;case 4:this.$=He.createNode(ot(Ee[_e-4]),"node_op","op_while",me[_e-2],me[_e]);break;case 5:this.$=He.createNode(ot(Ee[_e-8]),"node_op","op_for",me[_e-6],me[_e-4],me[_e-2],me[_e]);break;case 6:this.$=He.createNode(ot(Ee[_e-6]),"node_op","op_do",me[_e-5],me[_e-2]);break;case 7:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_use",me[_e]);break;case 8:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_delete",me[_e]);break;case 9:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_return",void 0);break;case 10:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_return",me[_e-1]);break;case 11:case 14:this.$=He.createNode(ot(Ee[_e]),"node_op","op_none");break;case 12:this.$=me[_e-1],this.$.needsBrackets=!0;break;case 13:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_none",me[_e-1],me[_e]);break;case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 23:case 24:case 26:case 28:case 30:case 32:case 36:case 41:case 44:case 48:case 50:case 52:case 54:case 55:case 56:case 58:case 62:case 81:case 84:case 85:case 86:this.$=me[_e];break;case 22:case 65:case 93:this.$=me[_e-1];break;case 25:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_assign",me[_e-2],me[_e]),this.$.isMath=!1;break;case 27:this.$=He.createNode(ot(Ee[_e-4]),"node_op","op_conditional",me[_e-4],me[_e-2],me[_e]),this.$.isMath=!1;break;case 29:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_or",me[_e-2],me[_e]),this.$.isMath=!1;break;case 31:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_and",me[_e-2],me[_e]),this.$.isMath=!1;break;case 33:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_eq",me[_e-2],me[_e]),this.$.isMath=!1;break;case 34:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_neq",me[_e-2],me[_e]),this.$.isMath=!1;break;case 35:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_approx",me[_e-2],me[_e]),this.$.isMath=!1;break;case 37:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_lt",me[_e-2],me[_e]),this.$.isMath=!1;break;case 38:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_gt",me[_e-2],me[_e]),this.$.isMath=!1;break;case 39:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_leq",me[_e-2],me[_e]),this.$.isMath=!1;break;case 40:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_geq",me[_e-2],me[_e]),this.$.isMath=!1;break;case 42:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_add",me[_e-2],me[_e]),this.$.isMath=!0;break;case 43:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_sub",me[_e-2],me[_e]),this.$.isMath=!0;break;case 45:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_mul",me[_e-2],me[_e]),this.$.isMath=!0;break;case 46:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_div",me[_e-2],me[_e]),this.$.isMath=!0;break;case 47:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_mod",me[_e-2],me[_e]),this.$.isMath=!0;break;case 49:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_exp",me[_e-2],me[_e]),this.$.isMath=!0;break;case 51:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_not",me[_e]),this.$.isMath=!1;break;case 53:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_neg",me[_e]),this.$.isMath=!0;break;case 57:case 63:case 64:case 66:case 67:case 68:case 97:this.$=me[_e],this.$.isMath=!1;break;case 59:case 91:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_property",me[_e-2],me[_e]),this.$.isMath=!0;break;case 60:case 90:this.$=He.createNode(ot(Ee[_e-3]),"node_op","op_extvalue",me[_e-3],me[_e-1]),this.$.isMath=!0;break;case 61:this.$=He.createNode(ot(Ee[_e]),"node_var",me[_e]);break;case 69:this.$=me[_e],this.$.isMath=!0;break;case 70:this.$=He.createNode(ot(Ee[_e]),"node_const",null);break;case 71:this.$=He.createNode(ot(Ee[_e]),"node_const_bool",!0);break;case 72:this.$=He.createNode(ot(Ee[_e]),"node_const_bool",!1);break;case 73:this.$=He.createNode(ot(Ee[_e]),"node_str",me[_e].substring(1,me[_e].length-1));break;case 74:this.$=He.createNode(ot(Ee[_e]),"node_const",parseFloat(me[_e]));break;case 75:this.$=He.createNode(ot(Ee[_e]),"node_const",NaN);break;case 76:this.$=He.createNode(ot(Ee[_e]),"node_const",1/0);break;case 77:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_array",[]);break;case 78:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_array",me[_e-1]);break;case 79:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_emptyobject",{}),this.$.needsAngleBrackets=!0;break;case 80:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_proplst_val",me[_e-1]),this.$.needsAngleBrackets=!0;break;case 82:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_proplst",me[_e-2],me[_e]);break;case 83:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_prop",me[_e-2],me[_e]);break;case 87:case 89:this.$=He.createNode(ot(Ee[_e-1]),"node_op","op_execfun",me[_e-1],me[_e]),this.$.isMath=!0;break;case 88:this.$=He.createNode(ot(Ee[_e-2]),"node_op","op_execfun",me[_e-2],me[_e-1],me[_e],!0),this.$.isMath=!1;break;case 92:this.$=[];break;case 94:case 98:case 104:this.$=[me[_e]];break;case 95:case 99:case 105:this.$=me[_e-2].concat(me[_e]);break;case 96:this.$=He.createNode(ot(Ee[_e]),"node_var",me[_e]),this.$.isMath=!0;break;case 100:this.$=He.createNode(ot(Ee[_e-3]),"node_op","op_function",[],me[_e]),this.$.isMath=!1;break;case 101:this.$=He.createNode(ot(Ee[_e-4]),"node_op","op_function",me[_e-2],me[_e]),this.$.isMath=!1;break;case 102:this.$=He.createNode(ot(Ee[_e-4]),"node_op","op_map",[],me[_e]);break;case 103:this.$=He.createNode(ot(Ee[_e-5]),"node_op","op_map",me[_e-3],me[_e]);break}},table:[n([5,7,8,14,15,16,17,19,20,21,23,26,50,51,58,65,74,75,76,77,78,79,80,82,91,93],t,{3:1,4:2}),{1:[3]},{5:[1,3],6:6,7:o,8:r,9:20,11:4,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{1:[2,1]},n(re,[2,13]),n(ce,[2,15]),n(ce,[2,16]),n(ce,[2,17]),n(ce,[2,18]),n(ce,[2,19]),n(ce,[2,20]),n(ce,[2,21]),n([7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],t,{4:61}),{8:[1,62]},{8:[1,63]},{8:[1,64]},{6:6,7:o,8:r,9:20,11:65,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{20:[1,66]},{20:[1,67]},{8:r,9:69,16:[1,68],20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{16:[1,70]},n(ce,[2,11]),n(ue,[2,23]),n(ue,[2,24]),n([8,10,16,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],ye,{32:[1,71],57:Se}),n([8,10,16,32,35,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],[2,26],{34:[1,73],37:[1,74]}),n(Ce,[2,54],{88:77,8:Ze,64:[1,75],65:[1,76]}),n(Ce,[2,55],{88:79,8:Ze,64:[1,81],65:[1,80]}),n(Be,[2,28],{39:xe}),n(ue,[2,56]),n(ue,[2,57]),n(ue,[2,58]),n(ge,[2,30],{41:de,42:ve,43:le}),n(ue,[2,61]),n(ue,[2,62]),n(ue,[2,63]),n(ue,[2,64]),{8:r,9:86,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:[1,87]},{8:[1,88]},n(Ae,[2,32],{45:Xe,46:Te,47:Ne,48:We}),n(ue,[2,66]),n(ue,[2,67]),n(ue,[2,68]),n(ue,[2,69]),{20:dt,72:98,73:99,77:K,78:P,79:$,80:ie,83:[1,93],84:94,85:95,87:96},{8:r,20:A,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,66:[1,100],67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,81:101,82:ne,91:ee,93:se},n(nt,[2,36],{50:Rt,51:Qe}),n(ue,[2,70]),n(ue,[2,71]),n(ue,[2,72]),n(ue,[2,73]),n(ue,[2,74]),n(ue,[2,75]),n(ue,[2,76]),n(Oe,[2,41],{53:be,54:yt,55:st}),n(ue,[2,44]),n(ue,[2,50]),{8:r,20:A,31:109,50:w,51:V,52:108,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:110,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:111,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{6:6,7:o,8:r,9:20,11:4,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,27:[1,112],28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:113,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:114,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:115,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{14:[1,116]},n(ce,[2,7]),n(ce,[2,8]),n(ce,[2,9]),{16:[1,117]},n(ce,[2,22]),{8:r,20:A,29:118,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:119,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,29:120,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,36:121,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{20:[1,122]},{8:r,9:123,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ue,[2,87],{89:124,90:125,68:127,20:Gt,82:ne}),{8:r,10:[1,128],20:A,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,81:129,82:ne,91:ee,93:se},n(ue,[2,89]),{8:r,9:130,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{20:[1,131]},{8:r,20:A,31:109,38:132,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,40:133,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,40:134,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,40:135,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{10:[1,136]},{10:[1,137],20:rt,92:138},{10:[1,140],20:rt,92:141},{8:r,20:A,31:109,44:142,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,44:143,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,44:144,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,44:145,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ue,[2,79]),{83:[1,146],86:[1,147]},n(Yt,[2,81]),{35:[1,148]},{35:[2,84]},{35:[2,85]},{35:[2,86]},n(ue,[2,77]),{66:[1,149],86:Xt},n(Ge,[2,98]),{8:r,20:A,31:109,49:151,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,49:152,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:153,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:154,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,31:109,50:w,51:V,52:155,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ue,[2,51]),n([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],ye,{57:Se}),n(ue,[2,52]),n(ue,[2,53]),n([5,7,8,10,12,14,15,16,17,19,20,21,23,26,27,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,58,64,65,66,74,75,76,77,78,79,80,82,83,86,91,93],[2,12]),{10:[1,156]},{10:[1,157]},{16:[1,158]},{8:[1,159]},n(ce,[2,10]),n(ue,[2,25]),n(ue,[2,49]),{35:[1,160]},n(Be,[2,29],{39:xe}),n(ue,[2,59]),{66:[1,161]},n([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83],[2,88],{86:[1,162]}),n(ue,[2,94]),n(ue,[2,96]),n(ue,[2,97]),n(he,[2,92]),{10:[1,163],86:Xt},{66:[1,164]},n(ue,[2,91]),n(ge,[2,31],{41:de,42:ve,43:le}),n(Ae,[2,33],{45:Xe,46:Te,47:Ne,48:We}),n(Ae,[2,34],{45:Xe,46:Te,47:Ne,48:We}),n(Ae,[2,35],{45:Xe,46:Te,47:Ne,48:We}),n(ue,[2,65]),{25:165,26:Z},{10:[1,166],86:ke},n(it,[2,104]),{94:[1,168]},{10:[1,169],86:ke},n(nt,[2,37],{50:Rt,51:Qe}),n(nt,[2,38],{50:Rt,51:Qe}),n(nt,[2,39],{50:Rt,51:Qe}),n(nt,[2,40],{50:Rt,51:Qe}),n(ue,[2,80]),{20:dt,72:98,73:99,77:K,78:P,79:$,80:ie,85:170,87:96},{8:r,20:A,29:171,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ue,[2,78]),{8:r,20:A,29:172,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(Oe,[2,42],{53:be,54:yt,55:st}),n(Oe,[2,43],{53:be,54:yt,55:st}),n(ue,[2,45]),n(ue,[2,46]),n(ue,[2,47]),{6:6,7:o,8:r,9:20,11:173,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{6:6,7:o,8:r,9:20,11:174,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:175,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:176,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,20:A,29:177,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ue,[2,60]),{20:Gt,68:127,82:ne,90:178},n(he,[2,93]),n(ue,[2,90]),n(ue,[2,100]),{25:179,26:Z},{20:[1,180]},{8:r,9:181,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{94:[1,182]},n(Yt,[2,82]),n(Yt,[2,83]),n(Ge,[2,99]),n(re,[2,2],{12:[1,183]}),n(ce,[2,4]),{16:[1,184]},{10:[1,185]},n(ue,[2,27]),n(ue,[2,95]),n(ue,[2,101]),n(it,[2,105]),n(ue,[2,102]),{8:r,9:186,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{6:6,7:o,8:r,9:20,11:187,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{8:r,9:188,20:A,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},{16:[1,189]},n(ue,[2,103]),n(ce,[2,3]),{10:[1,190]},n(ce,[2,6]),{6:6,7:o,8:r,9:20,11:191,13:7,14:u,15:d,16:C,17:I,18:8,19:f,20:A,21:G,22:9,23:B,24:11,25:5,26:Z,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:w,51:V,52:56,56:57,58:Y,59:26,60:27,61:29,62:30,63:31,65:J,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:T,75:L,76:z,77:K,78:P,79:$,80:ie,82:ne,91:ee,93:se},n(ce,[2,5])],defaultActions:{3:[2,1],97:[2,84],98:[2,85],99:[2,86]},parseError:function(De,ct){if(ct.recoverable)this.trace(De);else{var ft=new Error(De);throw ft.hash=ct,ft}},parse:function(De){var ct=this,ft=[0],At=[null],Ct=[],me=this.table,Ee="",_e=0,Me=0,Bt=2,qe=1,at=Ct.slice.call(arguments,1),bt=Object.create(this.lexer),_t={yy:{}};for(var Tt in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Tt)&&(_t.yy[Tt]=this.yy[Tt]);bt.setInput(De,_t.yy),_t.yy.lexer=bt,_t.yy.parser=this,typeof bt.yylloc>"u"&&(bt.yylloc={});var si=bt.yylloc;Ct.push(si);var Bi=bt.options&&bt.options.ranges;typeof _t.yy.parseError=="function"?this.parseError=_t.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var ii=function(){var Qt;return Qt=bt.lex()||qe,typeof Qt!="number"&&(Qt=ct.symbols_[Qt]||Qt),Qt},ci,Zi,Gn,Ys,An={},vn,Nn,ns,Yi;;){if(Zi=ft[ft.length-1],this.defaultActions[Zi]?Gn=this.defaultActions[Zi]:((ci===null||typeof ci>"u")&&(ci=ii()),Gn=me[Zi]&&me[Zi][ci]),typeof Gn>"u"||!Gn.length||!Gn[0]){var Ti="";Yi=[];for(vn in me[Zi])this.terminals_[vn]&&vn>Bt&&Yi.push("'"+this.terminals_[vn]+"'");bt.showPosition?Ti="Parse error on line "+(_e+1)+`:
`+bt.showPosition()+`
Expecting `+Yi.join(", ")+", got '"+(this.terminals_[ci]||ci)+"'":Ti="Parse error on line "+(_e+1)+": Unexpected "+(ci==qe?"end of input":"'"+(this.terminals_[ci]||ci)+"'"),this.parseError(Ti,{text:bt.match,token:this.terminals_[ci]||ci,line:bt.yylineno,loc:si,expected:Yi})}if(Gn[0]instanceof Array&&Gn.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Zi+", token: "+ci);switch(Gn[0]){case 1:ft.push(ci),At.push(bt.yytext),Ct.push(bt.yylloc),ft.push(Gn[1]),ci=null,Me=bt.yyleng,Ee=bt.yytext,_e=bt.yylineno,si=bt.yylloc;break;case 2:if(Nn=this.productions_[Gn[1]][1],An.$=At[At.length-Nn],An._$={first_line:Ct[Ct.length-(Nn||1)].first_line,last_line:Ct[Ct.length-1].last_line,first_column:Ct[Ct.length-(Nn||1)].first_column,last_column:Ct[Ct.length-1].last_column},Bi&&(An._$.range=[Ct[Ct.length-(Nn||1)].range[0],Ct[Ct.length-1].range[1]]),Ys=this.performAction.apply(An,[Ee,Me,_e,_t.yy,Gn[1],At,Ct].concat(at)),typeof Ys<"u")return Ys;Nn&&(ft=ft.slice(0,-1*Nn*2),At=At.slice(0,-1*Nn),Ct=Ct.slice(0,-1*Nn)),ft.push(this.productions_[Gn[1]][0]),At.push(An.$),Ct.push(An._$),ns=me[ft[ft.length-2]][ft[ft.length-1]],ft.push(ns);break;case 3:return!0}}return!0}},He={node:function(Et,De,ct){return{type:Et,value:De,children:ct}},createNode:function(Et,De,ct,ft){var At,Ct=this.node(De,ct,[]);for(At=3;At<arguments.length;At++)Ct.children.push(arguments[At]);return Ct.line=Et[0],Ct.col=Et[1],Ct.eline=Et[2],Ct.ecol=Et[3],Ct}},ot=function(Et){return[Et.first_line,Et.first_column,Et.last_line,Et.last_column]},Zt=function(){var Et={EOF:1,parseError:function(ct,ft){if(this.yy.parser)this.yy.parser.parseError(ct,ft);else throw new Error(ct)},setInput:function(De,ct){return this.yy=ct||this.yy||{},this._input=De,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var De=this._input[0];this.yytext+=De,this.yyleng++,this.offset++,this.match+=De,this.matched+=De;var ct=De.match(/(?:\r\n?|\n).*/g);return ct?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),De},unput:function(De){var ct=De.length,ft=De.split(/(?:\r\n?|\n)/g);this._input=De+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-ct),this.offset-=ct;var At=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),ft.length-1&&(this.yylineno-=ft.length-1);var Ct=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:ft?(ft.length===At.length?this.yylloc.first_column:0)+At[At.length-ft.length].length-ft[0].length:this.yylloc.first_column-ct},this.options.ranges&&(this.yylloc.range=[Ct[0],Ct[0]+this.yyleng-ct]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(De){this.unput(this.match.slice(De))},pastInput:function(){var De=this.matched.substr(0,this.matched.length-this.match.length);return(De.length>20?"...":"")+De.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var De=this.match;return De.length<20&&(De+=this._input.substr(0,20-De.length)),(De.substr(0,20)+(De.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var De=this.pastInput(),ct=new Array(De.length+1).join("-");return De+this.upcomingInput()+`
`+ct+"^"},test_match:function(De,ct){var ft,At,Ct;if(this.options.backtrack_lexer&&(Ct={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(Ct.yylloc.range=this.yylloc.range.slice(0))),At=De[0].match(/(?:\r\n?|\n).*/g),At&&(this.yylineno+=At.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:At?At[At.length-1].length-At[At.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+De[0].length},this.yytext+=De[0],this.match+=De[0],this.matches=De,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(De[0].length),this.matched+=De[0],ft=this.performAction.call(this,this.yy,this,ct,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),ft)return ft;if(this._backtrack){for(var me in Ct)this[me]=Ct[me];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var De,ct,ft,At;this._more||(this.yytext="",this.match="");for(var Ct=this._currentRules(),me=0;me<Ct.length;me++)if(ft=this._input.match(this.rules[Ct[me]]),ft&&(!ct||ft[0].length>ct[0].length)){if(ct=ft,At=me,this.options.backtrack_lexer){if(De=this.test_match(ft,Ct[me]),De!==!1)return De;if(this._backtrack){ct=!1;continue}else return!1}else if(!this.options.flex)break}return ct?(De=this.test_match(ct,Ct[At]),De!==!1?De:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var ct=this.next();return ct||this.lex()},begin:function(ct){this.conditionStack.push(ct)},popState:function(){var ct=this.conditionStack.length-1;return ct>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(ct){return ct=this.conditionStack.length-1-Math.abs(ct||0),ct>=0?this.conditionStack[ct]:"INITIAL"},pushState:function(ct){this.begin(ct)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(ct,ft,At,Ct){switch(At){case 0:break;case 1:return 78;case 2:return 78;case 3:return 77;case 4:return 77;case 5:break;case 6:break;case 7:return 7;case 8:return 12;case 9:return 14;case 10:return 17;case 11:return 15;case 12:return 91;case 13:return 93;case 14:return 19;case 15:return 23;case 16:return 21;case 17:return 75;case 18:return 76;case 19:return 74;case 20:return 80;case 21:return 94;case 22:return 94;case 23:return 82;case 24:return 83;case 25:return 26;case 26:return 27;case 27:return 16;case 28:return"#";case 29:return 34;case 30:return 35;case 31:return 79;case 32:return 64;case 33:return 65;case 34:return 66;case 35:return 8;case 36:return 10;case 37:return 58;case 38:return 57;case 39:return 57;case 40:return 53;case 41:return 54;case 42:return 55;case 43:return 50;case 44:return 51;case 45:return 47;case 46:return 45;case 47:return 48;case 48:return 46;case 49:return 41;case 50:return 43;case 51:return 42;case 52:return 39;case 53:return 37;case 54:return 32;case 55:return 86;case 56:return 5;case 57:return 20;case 58:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+\b)/,/^(?:[0-9]+)/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:\/\/.*)/,/^(?:\/\*(.|\n|\r)*?\*\/)/,/^(?:if\b)/,/^(?:else\b)/,/^(?:while\b)/,/^(?:do\b)/,/^(?:for\b)/,/^(?:function\b)/,/^(?:map\b)/,/^(?:use\b)/,/^(?:return\b)/,/^(?:delete\b)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:Infinity\b)/,/^(?:->)/,/^(?:=>)/,/^(?:<<)/,/^(?:>>)/,/^(?:\{)/,/^(?:\})/,/^(?:;)/,/^(?:#)/,/^(?:\?)/,/^(?::)/,/^(?:NaN\b)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:!)/,/^(?:\^)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\/)/,/^(?:%)/,/^(?:\+)/,/^(?:-)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:==)/,/^(?:~=)/,/^(?:!=)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:=)/,/^(?:,)/,/^(?:$)/,/^(?:[A-Za-z_\$][A-Za-z0-9_]*)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58],inclusive:!0}}};return Et}();ht.lexer=Zt;function wt(){this.yy={}}return wt.prototype=ht,ht.Parser=wt,new wt}();parser.yy.parseError=parser.parseError;const JessieCode=JXG$1.JessieCode;JXG$1.Composition=function(n){var t,o=this,r=["setAttribute","setParents","prepareUpdate","updateRenderer","update","fullUpdate","highlight","noHighlight"],u=function(d){return function(){var C;for(C in o.elements)o.elements.hasOwnProperty(C)&&JXG$1.exists(o.elements[C][d])&&o.elements[C][d].apply(o.elements[C],arguments);return o}};for(t=0;t<r.length;t++)this[r[t]]=u(r[t]);this.elements={},this.objects=this.elements,this.elementsByName={},this.objectsList=[],this.groups={},this.methodMap={setAttribute:"setAttribute",setProperty:"setAttribute",setParents:"setParents",add:"add",remove:"remove",select:"select"};for(t in n)n.hasOwnProperty(t)&&this.add(t,n[t]);this.dump=!0,this.subs={}};JXG$1.extend(JXG$1.Composition.prototype,{add:function(n,t){return!JXG$1.exists(this[n])&&JXG$1.exists(t)?(JXG$1.exists(t.id)?this.elements[t.id]=t:this.elements[n]=t,JXG$1.exists(t.name)&&(this.elementsByName[t.name]=t),t.on("attribute:name",this.nameListener,this),this.objectsList.push(t),this[n]=t,this.methodMap[n]=t,!0):!1},remove:function(n){var t=!1,o;for(o in this.elements)if(this.elements.hasOwnProperty(o)&&this.elements[o].id===this[n].id){t=!0;break}return t&&(delete this.elements[this[n].id],delete this[n]),t},nameListener:function(n,t,o){delete this.elementsByName[n],this.elementsByName[t]=o},select:function(n){return JXG$1.exists(JXG$1.Board)?JXG$1.Board.prototype.select.call(this,n):new JXG$1.Composition},getParents:function(){return this.parents},getType:function(){return this.elType},getAttributes:function(){var n;for(n in this.subs)this.subs.hasOwnProperty(n)&&this.subs[n].visProp;return this.attr}});const Composition=JXG$1.Composition;JXG$1.Board=function(n,t,o,r,u,d,C,I,f,A,G){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,JXG$1.exists(G.document)&&G.document!==!1?this.document=G.document:JXG$1.isBrowser&&(this.document=document),this.container="",this.id="",this.containerObj=null,JXG$1.isString(n)?(this.container=n,this.containerObj=JXG$1.isBrowser?this.document.getElementById(this.container):null):JXG$1.isBrowser&&(this.containerObj=n,this.container=this.containerObj.getAttribute("id"),this.container===null&&(this.container="null"+parseInt(Math.random()*16777216).toString())),JXG$1.isBrowser&&t.type!=="no"&&this.containerObj===null)throw new Error(`
JSXGraph: HTML container element "`+n+'" not found.');JXG$1.exists(o)&&o!==""&&JXG$1.isBrowser&&!JXG$1.exists(this.document.getElementById(o))?this.id=o:this.id=this.generateId(),this.renderer=t,this.grids=[],this.options=JXG$1.deepCopy(Options),this.attr=G,this.attr.theme!=="default"&&JXG$1.exists(JXG$1.themes[this.attr.theme])&&JXG$1.mergeAttr(this.options,JXG$1.themes[this.attr.theme],!0),this.dimension=2,this.jc=new JessieCode,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,r[0],r[1]],this.zoomX=u,this.zoomY=d,this.unitX=C*this.zoomX,this.unitY=I*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=f,this.canvasHeight=A,EventEmitter.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.clickObjects={},this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this.resizeHandlers=[],this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=JXG$1.Math,this.attr.registerevents===!0?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:typeof this.attr.registerevents=="object"&&(JXG$1.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),JXG$1.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),JXG$1.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),JXG$1.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),JXG$1.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),this.attr.registerevents!==!1&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",getBoundingBox:"getBoundingBox",BoundingBox:"getBoundingBox",getView:"getBoundingBox",View:"getBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}};JXG$1.extend(JXG$1.Board.prototype,{generateName:function(n){var t,o,r=this.attr.maxnamelength,u="",d="",C=[],I="";if(n.type===Const.OBJECT_TYPE_TICKS)return"";for(JXG$1.isPoint(n)||JXG$1.isPoint3D(n)?t=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:n.type===Const.OBJECT_TYPE_ANGLE?t=["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:t=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],!JXG$1.isPoint(n)&&!JXG$1.isPoint3D(n)&&n.elementClass!==Const.OBJECT_CLASS_LINE&&n.type!==Const.OBJECT_TYPE_ANGLE&&(n.type===Const.OBJECT_TYPE_POLYGON?u="P_{":n.elementClass===Const.OBJECT_CLASS_CIRCLE?u="k_{":n.elementClass===Const.OBJECT_CLASS_TEXT?u="t_{":u="s_{",d="}"),o=0;o<r;o++)C[o]=0;for(;C[r-1]<t.length;){for(C[0]=1;C[0]<t.length;C[0]++){for(I=u,o=r;o>0;o--)I+=t[C[o-1]];if(!JXG$1.exists(this.elementsByName[I+d]))return I+d}for(C[0]=t.length,o=1;o<r;o++)C[o-1]===t.length&&(C[o-1]=1,C[o]+=1)}return""},generateId:function(){for(var n=1;JXG$1.exists(JXG$1.boards["jxgBoard"+n]);)n=Math.round(Math.random()*16777216);return"jxgBoard"+n},setId:function(n,t){var o,r=this.numObjects,u=n.id;if(this.numObjects+=1,u===""||!JXG$1.exists(u))for(u=this.id+t+r;JXG$1.exists(this.objects[u]);)o=Math.round(Math.random()*65535),u=this.id+t+r+"-"+o;return n.id=u,this.objects[u]=n,n._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=n,u},finalizeAdding:function(n){JXG$1.evaluate(n.visProp.visible)===!1&&this.renderer.display(n,!1)},finalizeLabel:function(n){n.hasLabel&&!JXG$1.evaluate(n.label.visProp.islabel)&&JXG$1.evaluate(n.label.visProp.visible)===!1&&this.renderer.display(n.label,!1)},checkFrameRate:function(n){var t=!1,o=new Date().getTime();return JXG$1.exists(n.pointerId)&&this.touchMoveLastId!==n.pointerId&&(t=!0,this.touchMoveLastId=n.pointerId),!t&&(o-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(t=!0),t&&(this.touchMoveLast=o),t},getCoordsTopLeftCorner:function(){var n,t,o,r=this.document.ownerDocument||this.document,u=r.documentElement||this.document.body.parentNode,d=r.body,C=this.containerObj,I,f;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||new Date().getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=new Date().getTime(),C.getBoundingClientRect){for(o=C.getBoundingClientRect(),I=1,f=C;f&&JXG$1.exists(f.parentNode);)JXG$1.exists(f.style)&&JXG$1.exists(f.style.zoom)&&f.style.zoom!==""&&(I*=parseFloat(f.style.zoom)),f=f.parentNode;return n=[o.left*I,o.top*I],n[0]+=JXG$1.getProp(C,"border-left-width"),n[1]+=JXG$1.getProp(C,"border-top-width"),this.renderer.type!=="vml"&&(n[0]+=JXG$1.getProp(C,"padding-left"),n[1]+=JXG$1.getProp(C,"padding-top")),this.cPos=n.slice(),this.cPos}return n=JXG$1.getOffset(C),t=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&t.defaultView&&(n[0]+=JXG$1.getProp(u,"margin-left"),n[1]+=JXG$1.getProp(u,"margin-top"),n[0]+=JXG$1.getProp(u,"border-left-width"),n[1]+=JXG$1.getProp(u,"border-top-width"),n[0]+=JXG$1.getProp(u,"padding-left"),n[1]+=JXG$1.getProp(u,"padding-top")),d&&(n[0]+=JXG$1.getProp(d,"left"),n[1]+=JXG$1.getProp(d,"top")),typeof google=="object"&&google.translate&&(n[0]+=10,n[1]+=25),n[0]+=JXG$1.getProp(C,"border-left-width"),n[1]+=JXG$1.getProp(C,"border-top-width"),this.renderer.type!=="vml"&&(n[0]+=JXG$1.getProp(C,"padding-left"),n[1]+=JXG$1.getProp(C,"padding-top")),n[0]+=this.attr.offsetx,n[1]+=this.attr.offsety,this.cPos=n.slice(),this.cPos},getPointLoc:function(n,t){var o,r,u,d;return o=this.getBoundingBox(),r=n,r.length===2&&r.unshift(void 0),u=[0,0],d=t||0,JXG$1.isNumber(d)&&(d=[d,d,d,d]),r[1]>o[2]-d[1]&&(u[0]=1),r[1]<o[0]+d[3]&&(u[0]=-1),r[2]>o[1]-d[0]&&(u[1]=1),r[2]<o[3]+d[2]&&(u[1]=-1),u},getLocationOrigin:function(n){return this.getPointLoc([0,0],n)},getMousePosition:function(n,t){var o=this.getCoordsTopLeftCorner(),r,u;return r=JXG$1.getPosition(n,t,this.document),this.updateCSSTransforms(),u=[1,r[0]-o[0],r[1]-o[1]],u=Mat.matVecMult(this.cssTransMat,u),u[1]/=u[0],u[2]/=u[0],[u[1],u[2]]},initMoveOrigin:function(n,t){this.drag_dx=n-this.origin.scrCoords[1],this.drag_dy=t-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(n,t,o,r){var u,d,C=[],I=[],f,A=this.objectsList.length,G={visProp:{layer:-1e4}};for(this._shiftKey=o.shiftKey,this._ctrlKey=o.ctrlKey,d=0;d<A;d++)u=this.objectsList[d],f=u.hasPoint&&u.hasPoint(n,t),u.visPropCalc.visible&&f&&(u.triggerEventHandlers([r+"down","down"],[o]),this.downObjects.push(u)),f&&u.isDraggable&&u.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(u)||u.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(u.visProp.fixed)&&(u.visProp.layer>G.visProp.layer||u.visProp.layer===G.visProp.layer&&u.lastDragTime.getTime()>=G.lastDragTime.getTime())&&(!this.attr.ignorelabels||!JXG$1.exists(G.label)||u!==G.label)&&(G=u,C.push(G),JXG$1.exists(G.coords)?I.push(Statistics.subtract(G.coords.scrCoords.slice(1),[n,t])):I.push([0,0]));return this.attr.drag.enabled&&C.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(C.length=1,this._drag_offset=I[0]):(C=C.slice(-1),this._drag_offset=I[I.length-1]),this._drag_offset||(this._drag_offset=[0,0]),this.renderer.type==="svg"&&JXG$1.exists(C[0])&&JXG$1.evaluate(C[0].visProp.dragtotopoflayer)&&C.length===1&&JXG$1.exists(C[0].rendNode)&&C[0].rendNode.parentNode.appendChild(C[0].rendNode),C.length>=1&&(C[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[o,C[0]])),C},moveObject:function(n,t,o,r,u){var d=new Coords(Const.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(n,t),this),C,I,f;o&&o.obj&&(C=o.obj,C.coords&&(I=C.coords.scrCoords.slice()),this.addLogEntry("drag",C,d.usrCoords.slice(1)),this.drag_position=[d.scrCoords[1],d.scrCoords[2]],this.drag_position=Statistics.add(this.drag_position,this._drag_offset),this._shiftKey=r.shiftKey,this._ctrlKey=r.ctrlKey,JXG$1.exists(C.coords)?C.setPositionDirectly(Const.COORDS_BY_SCREEN,this.drag_position):(this.displayInfobox(!1),isNaN(o.targets[0].Xprev+o.targets[0].Yprev)||C.setPositionDirectly(Const.COORDS_BY_SCREEN,[d.scrCoords[1],d.scrCoords[2]],[o.targets[0].Xprev,o.targets[0].Yprev]),o.targets[0].Xprev=d.scrCoords[1],o.targets[0].Yprev=d.scrCoords[2]),JXG$1.exists(C.coords)&&(C.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(C),C.prepareUpdate().update(!0).updateRenderer()),C.coords&&(f=C.coords.scrCoords),(!C.coords||I[1]!==f[1]||I[2]!==f[2])&&(C.triggerEventHandlers([u+"drag","drag"],[r]),this.update()),C.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[r,C]),C.lastDragTime=new Date)},twoFingerMove:function(n,t,o){var r;if(JXG$1.exists(n)&&JXG$1.exists(n.obj))r=n.obj;else return;r.elementClass===Const.OBJECT_CLASS_LINE||r.type===Const.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(n.targets,r,t):r.elementClass===Const.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(n.targets,r,t),o&&r.triggerEventHandlers(["touchdrag","drag"],[o])},getTwoFingerTransform(n,t,o,r){var u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$;return u=new Coords(Const.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this).usrCoords,d=u[1],C=u[2],u=new Coords(Const.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this).usrCoords,I=u[1],f=u[2],u=new Coords(Const.COORDS_BY_SCREEN,[n.X,n.Y],this).usrCoords,B=u[1],Z=u[2],u=new Coords(Const.COORDS_BY_SCREEN,[t.X,t.Y],this).usrCoords,w=u[1],V=u[2],A=I-d,G=f-C,Y=w-B,J=V-Z,z=A*A+G*G,T=(Y*A+J*G)/z,L=(J*A-Y*G)/z,o||($=Mat.hypot(T,L),T/=$,L/=$),r||(L=0),K=.5*(B+w-T*(d+I)+L*(C+f)),P=.5*(Z+V-L*(d+I)-T*(C+f)),[1,0,0,K,T,-L,P,L,T]},twoFingerTouchObject:function(n,t,o){var r,u,d,C,I,f,A=!1;if(JXG$1.exists(n[0])&&JXG$1.exists(n[1])&&!isNaN(n[0].Xprev+n[0].Yprev+n[1].Xprev+n[1].Yprev)){if(u=this.getTwoFingerTransform(n[0],n[1],JXG$1.evaluate(t.visProp.scalable),JXG$1.evaluate(t.visProp.rotatable)),r=this.create("transform",u,{type:"generic"}),r.update(),t.elementClass===Const.OBJECT_CLASS_LINE)d=[],t.point1.draggable()&&d.push(t.point1),t.point2.draggable()&&d.push(t.point2),r.applyOnce(d);else if(t.type===Const.OBJECT_TYPE_POLYGON){for(I=t.vertices.length-1,f=t.visProp,A=JXG$1.evaluate(f.snaptogrid)||JXG$1.evaluate(f.snaptopoints),C=0;C<I&&!A;++C)f=t.vertices[C].visProp,A=A||JXG$1.evaluate(f.snaptogrid)||JXG$1.evaluate(f.snaptopoints),A=A||!t.vertices[C].draggable();if(!A){for(d=[],C=0;C<I;++C)t.vertices[C].draggable()&&d.push(t.vertices[C]);r.applyOnce(d)}}this.update(),t.highlight(!0)}},twoFingerTouchCircle:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w;t.method==="pointCircle"||t.method==="pointLine"||JXG$1.exists(n[0])&&JXG$1.exists(n[1])&&!isNaN(n[0].Xprev+n[0].Yprev+n[1].Xprev+n[1].Yprev)&&(o===n[0].num?(r=n[1],u=n[0]):(r=n[0],u=n[1]),I=new Coords(Const.COORDS_BY_SCREEN,[r.Xprev,r.Yprev],this).usrCoords,C=new Coords(Const.COORDS_BY_SCREEN,[u.Xprev,u.Yprev],this).usrCoords,d=new Coords(Const.COORDS_BY_SCREEN,[u.X,u.Y],this).usrCoords,A=Geometry.rad(C.slice(1),I.slice(1),d.slice(1)),G=this.create("transform",[-I[1],-I[2]],{type:"translate"}),B=this.create("transform",[A],{type:"rotate"}),G.melt(B),JXG$1.evaluate(t.visProp.scalable)&&(f=Geometry.distance(I,d)/Geometry.distance(I,C),Z=this.create("transform",[f,f],{type:"scale"}),G.melt(Z)),w=this.create("transform",[I[1],I[2]],{type:"translate"}),G.melt(w),t.center.draggable()&&G.applyOnce([t.center]),t.method==="twoPoints"?t.point2.draggable()&&G.applyOnce([t.point2]):t.method==="pointRadius"&&JXG$1.isNumber(t.updateRadius.origin)&&t.setRadius(t.radius*f),this.update(t.center),t.highlight(!0))},highlightElements:function(n,t,o,r){var u,d,C,I={},f=this.objectsList.length;for(u=0;u<f;u++)d=this.objectsList[u],C=d.id,JXG$1.exists(d.hasPoint)&&d.visPropCalc.visible&&d.hasPoint(n,t)&&(this.updateInfobox(d),JXG$1.exists(this.highlightedObjects[C])||(I[C]=d,d.highlight(),this.triggerEventHandlers(["mousehit","hit"],[o,d,r])),d.mouseover?d.triggerEventHandlers(["mousemove","move"],[o]):(d.triggerEventHandlers(["mouseover","over"],[o]),d.mouseover=!0));for(u=0;u<f;u++)d=this.objectsList[u],C=d.id,d.mouseover&&(I[C]||(d.triggerEventHandlers(["mouseout","out"],[o]),d.mouseover=!1))},saveStartPos:function(n,t){var o=[],r,u;if(n.type===Const.OBJECT_TYPE_TICKS)o.push([1,NaN,NaN]);else if(n.elementClass===Const.OBJECT_CLASS_LINE)o.push(n.point1.coords.usrCoords),o.push(n.point2.coords.usrCoords);else if(n.elementClass===Const.OBJECT_CLASS_CIRCLE)o.push(n.center.coords.usrCoords),n.method==="twoPoints"&&o.push(n.point2.coords.usrCoords);else if(n.type===Const.OBJECT_TYPE_POLYGON)for(u=n.vertices.length-1,r=0;r<u;r++)o.push(n.vertices[r].coords.usrCoords);else if(n.type===Const.OBJECT_TYPE_SECTOR)o.push(n.point1.coords.usrCoords),o.push(n.point2.coords.usrCoords),o.push(n.point3.coords.usrCoords);else if(JXG$1.isPoint(n)||n.type===Const.OBJECT_TYPE_GLIDER)o.push(n.coords.usrCoords);else if(n.elementClass===Const.OBJECT_CLASS_CURVE)n.points.length>0&&o.push(n.points[0].usrCoords);else try{o.push(n.coords.usrCoords)}catch(d){JXG$1.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+d)}for(u=o.length,r=0;r<u;r++)t.Zstart.push(o[r][0]),t.Xstart.push(o[r][1]),t.Ystart.push(o[r][2])},mouseOriginMoveStart:function(n){var t,o;return t=this._isRequiredKeyPressed(n,"pan"),t&&(o=this.getMousePosition(n),this.initMoveOrigin(o[0],o[1])),t},mouseOriginMove:function(n){var t=this.mode===this.BOARD_MODE_MOVE_ORIGIN,o;return t&&(o=this.getMousePosition(n),this.moveOrigin(o[0],o[1],!0)),t},touchStartMoveOriginOneFinger:function(n){var t=n.touches,o,r;return o=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&t.length===1,o&&(r=this.getMousePosition(n,0),this.initMoveOrigin(r[0],r[1])),o},touchOriginMove:function(n){var t=this.mode===this.BOARD_MODE_MOVE_ORIGIN,o;return t&&(o=this.getMousePosition(n,0),this.moveOrigin(o[0],o[1],!0)),t},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},suppressDefault:function(n){return JXG$1.exists(n)&&n.preventDefault(),!1},addEventHandlers:function(){JXG$1.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),this.containerObj!==null&&JXG$1.addEvent(this.containerObj,"contextmenu",this.suppressDefault,this)},removeEventHandlers:function(){(this.hasPointerHandlers||this.hasMouseHandlers||this.hasTouchHandlers)&&this.containerObj!==null&&JXG$1.removeEvent(this.containerObj,"contextmenu",this.suppressDefault,this),this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),this.removeResizeEventHandlers()},addResizeEventHandlers:function(){if(this.resizeHandlers=[],JXG$1.isBrowser){try{this.startResizeObserver(),this.resizeHandlers.push("resizeobserver")}catch{JXG$1.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver(),this.resizeHandlers.push("resize")}JXG$1.addEvent(window,"scroll",this.scrollListener,this),this.resizeHandlers.push("scroll");try{window.matchMedia("print").addEventListener("change",this.printListenerMatch.bind(this)),window.matchMedia("screen").addEventListener("change",this.printListenerMatch.bind(this)),this.resizeHandlers.push("print")}catch(n){JXG$1.debug("Error adding printListener",n)}}},removeResizeEventHandlers:function(){var n,t;if(this.resizeHandlers.length>0&&JXG$1.isBrowser){for(n=0;n<this.resizeHandlers.length;n++)switch(t=this.resizeHandlers[n],t){case"resizeobserver":JXG$1.exists(this.resizeObserver)&&this.stopResizeObserver();break;case"resize":JXG$1.removeEvent(window,"resize",this.resizeListener,this),JXG$1.exists(this.intersectionObserver)&&this.stopIntersectionObserver();break;case"scroll":JXG$1.removeEvent(window,"scroll",this.scrollListener,this);break;case"print":window.matchMedia("print").removeEventListener("change",this.printListenerMatch.bind(this),!1),window.matchMedia("screen").removeEventListener("change",this.printListenerMatch.bind(this),!1);break}this.resizeHandlers=[]}},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.addEvent(n,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.addEvent(n,"pointermove",this.pointerMoveListener,this),JXG$1.addEvent(n,"pointerleave",this.pointerLeaveListener,this),JXG$1.addEvent(n,"click",this.pointerClickListener,this),JXG$1.addEvent(n,"dblclick",this.pointerDblClickListener,this)),this.containerObj!==null&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.addEvent(n,"mousemove",this.mouseMoveListener,this),JXG$1.addEvent(n,"click",this.mouseClickListener,this),JXG$1.addEvent(n,"dblclick",this.mouseDblClickListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(n){if(!this.hasTouchHandlers&&JXG$1.isBrowser){var t=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.addEvent(t,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var n,t=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],o=t.length;if(!this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(n=0;n<o;n++)JXG$1.addEvent(this.document,t[n],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var n,t=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],o=t.length;if(this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(n=0;n<o;n++)JXG$1.removeEvent(this.document,t[n],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.removeEvent(n,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.removeEvent(n,"pointermove",this.pointerMoveListener,this),JXG$1.removeEvent(n,"pointerleave",this.pointerLeaveListener,this),JXG$1.removeEvent(n,"click",this.pointerClickListener,this),JXG$1.removeEvent(n,"dblclick",this.pointerDblClickListener,this)),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.removeEvent(n,"mousemove",this.mouseMoveListener,this),JXG$1.removeEvent(n,"click",this.mouseClickListener,this),JXG$1.removeEvent(n,"dblclick",this.mouseDblClickListener,this),this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.removeEvent(n,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-this.canvasHeight*.1),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+this.canvasHeight*.1),this},gestureChangeListener:function(n){var t,o=[],r=[],u,d=10,C=!1,I=this.attr.zoom.factorx,f=this.attr.zoom.factory,A,G,B,Z,w,V=!1,Y,J,T,L;return this.mode!==this.BOARD_MODE_ZOOM?!0:(n.preventDefault(),G=Geometry.distance([n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY],2),n.scale===void 0&&(n.scale=G/this.prevDist),!JXG$1.exists(this.prevCoords)||(o=[n.touches[0].clientX-this.prevCoords[0][0],n.touches[0].clientY-this.prevCoords[0][1]],r=[n.touches[1].clientX-this.prevCoords[1][0],n.touches[1].clientY-this.prevCoords[1][1]],o[0]*o[0]+o[1]*o[1]<d*d&&r[0]*r[0]+r[1]*r[1]<d*d)||(u=Geometry.rad(o,[0,0],r),this.isPreviousGesture!=="pan"&&Math.abs(u)>Math.PI*.2&&Math.abs(u)<Math.PI*1.8&&(C=!0),this.isPreviousGesture!=="pan"&&!C&&(Math.abs(n.scale)<.77||Math.abs(n.scale)>1.3)&&(C=!0),A=n.scale/this.prevScale,this.prevScale=n.scale,this.prevCoords=[[n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY]],t=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(n,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!C?(this.isPreviousGesture="pan",this.moveOrigin(t.scrCoords[1],t.scrCoords[2],!0)):this.attr.zoom.enabled&&Math.abs(A-1)<.5&&(V=!1,w=this.attr.zoom.center,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(Y=Math.abs(n.touches[0].clientX-n.touches[1].clientX),J=Math.abs(n.touches[0].clientY-n.touches[1].clientY),B=Math.abs(Math.atan2(J,Y)),Z=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&B<Z?(this.attr.zoom.factorx=A,this.attr.zoom.factory=1,T=0,L=0,V=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(B-Math.PI*.5)<Z?(this.attr.zoom.factorx=1,this.attr.zoom.factory=A,T=0,L=0,V=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=A,this.attr.zoom.factory=A,T=t.usrCoords[1],L=t.usrCoords[2],V=!0),V&&(w==="board"?this.zoomIn():this.zoomIn(T,L),this.attr.zoom.factorx=I,this.attr.zoom.factory=f))),!1)},gestureStartListener:function(n){var t;return n.preventDefault(),this.prevScale=1,this.prevDist=Geometry.distance([n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY],2),this.prevCoords=[[n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY]],this.isPreviousGesture="none",t=this.getMousePosition(n,0),this.initMoveOrigin(t[0],t[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(n,t){var o=this.attr[t];return o.enabled?!!((o.needshift&&n.shiftKey||!o.needshift&&!n.shiftKey)&&(o.needctrl&&n.ctrlKey||!o.needctrl&&!n.ctrlKey)):!1},_isPointerRegistered:function(n){var t,o=this._board_touches.length;for(t=0;t<o;t++)if(this._board_touches[t].pointerId===n.pointerId)return!0;return!1},_pointerStorePosition:function(n){var t,o;for(t=0,o=!1;t<this._board_touches.length;t++)if(this._board_touches[t].pointerId===n.pointerId){this._board_touches[t].clientX=n.clientX,this._board_touches[t].clientY=n.clientY,o=!0;break}return!o&&this._board_touches.length<2&&this._board_touches.push({pointerId:n.pointerId,clientX:n.clientX,clientY:n.clientY}),this},_pointerRemoveTouches:function(n){var t;for(t=0;t<this._board_touches.length;t++)if(this._board_touches[t].pointerId===n.pointerId){this._board_touches.splice(t,1);break}return this},_pointerClearTouches:function(n){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(n){if(JXG$1.isBrowser){if(n.pointerType==="touch"||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if(n.pointerType==="mouse")return"mouse";if(n.pointerType==="pen")return"pen"}return"mouse"},pointerDownListener:function(n,t,o){var r,u,d,C,I,f,A,G="mouse",B,Z,w;if(!t&&this._isPointerRegistered(n))return!1;if(JXG$1.evaluate(this.attr.movetarget)===null&&JXG$1.exists(n.target)&&JXG$1.exists(n.target.releasePointerCapture)&&n.target.releasePointerCapture(n.pointerId),!t&&n.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?JXG$1.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.addEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&JXG$1.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(f=window.getSelection(),f.removeAllRanges))try{f.removeAllRanges()}catch{}if(this._inputDevice=this._getPointerInputDevice(n),G=this._inputDevice,this.options.precision.hasPoint=this.options.precision[G],C=this.getMousePosition(n),this._testForSelection(n),this.selectingMode){this._startSelecting(C),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[n]);return}if(this.attr.drag.enabled&&t?(I=[t],this.mode=this.BOARD_MODE_DRAG):I=this.initMoveObject(C[0],C[1],n,G),A={num:n.pointerId,X:C[0],Y:C[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},I.length>0){for(Z=I[I.length-1],B=!1,r=0;r<this.touches.length;r++)if(this.touches[r].obj===Z){u=r,d=this.touches[r].targets.push(A)-1,B=!0;break}B||(d=0,u=this.touches.push({obj:Z,targets:[A]})-1),this.dehighlightAll(),Z.highlight(!0),this.saveStartPos(Z,this.touches[u].targets[d]),n&&n.preventDefault&&!o&&n.preventDefault()}return this.touches.length>0&&!o&&(n.preventDefault(),n.stopPropagation()),JXG$1.isBrowser?(this._getPointerInputDevice(n)!=="touch"?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(n):(this._pointerStorePosition(n),n.touches=this._board_touches,n.touches.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(n)||n.touches.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(n))),w="none",this.mode===this.BOARD_MODE_NONE&&JXG$1.evaluate(this.attr.browserpan)&&!(JXG$1.evaluate(this.attr.pan.enabled)&&!JXG$1.evaluate(this.attr.pan.needtwofingers))&&(w="pan-x pan-y"),this.containerObj.style.touchAction=w,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[n]),!0):!1},_handleClicks:function(n,t){var o=this,r,u,d;if(this.selectingMode){n.stopPropagation();return}if(u=JXG$1.evaluate(this.attr.clickdelay),d=JXG$1.evaluate(this.attr.dblclicksuppressclick),d)this._preventSingleClick=!1,this._singleClickTimer=setTimeout(function(){if(!o._preventSingleClick){o.triggerEventHandlers(t,[n]);for(r in o.clickObjects)o.clickObjects.hasOwnProperty(r)&&(o.clickObjects[r].triggerEventHandlers(t,[n]),delete o.clickObjects[r])}},u);else{o.triggerEventHandlers(t,[n]);for(r in o.clickObjects)o.clickObjects.hasOwnProperty(r)&&o.clickObjects[r].triggerEventHandlers(t,[n]);setTimeout(function(){for(r in o.clickObjects)o.clickObjects.hasOwnProperty(r)&&delete o.clickObjects[r]},u)}n.stopPropagation()},_handleDblClicks:function(n,t){var o;if(this.selectingMode){n.stopPropagation();return}this._preventSingleClick=!0,clearTimeout(this._singleClickTimer),this.triggerEventHandlers(t,[n]);for(o in this.clickObjects)this.clickObjects.hasOwnProperty(o)&&(this.clickObjects[o].triggerEventHandlers(t,[n]),delete this.clickObjects[o]);n.stopPropagation()},pointerClickListener:function(n){this._handleClicks(n,["click","pointerclick"])},pointerDblClickListener:function(n){this._handleDblClicks(n,["dblclick","pointerdblclick"])},mouseClickListener:function(n){this._handleClicks(n,["click","mouseclick"])},mouseDblClickListener:function(n){this._handleDblClicks(n,["dblclick","mousedblclick"])},pointerMoveListener:function(n){var t,o,r,u,d,C="mouse";if(this._getPointerInputDevice(n)==="touch"&&!this._isPointerRegistered(n))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(n))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(n.preventDefault(),n.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(n),C=this._inputDevice,this.options.precision.hasPoint=this.options.precision[C],u=this.options.precision.hasPoint*.3333,r=this.getMousePosition(n),JXG$1.evaluate(this.attr.movetarget)===null&&r[0]<=u||r[1]<=u||r[0]>=this.canvasWidth-u||r[1]>=this.canvasHeight-u)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(r),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[n,this.mode]);else if(!this.mouseOriginMove(n))if(this.mode===this.BOARD_MODE_DRAG){for(t=0;t<this.touches.length;t++)for(d=this.touches[t].targets,o=0;o<d.length;o++)if(d[o].num===n.pointerId){d[o].X=r[0],d[o].Y=r[1],d.length===1?this.moveObject(r[0],r[1],this.touches[t],n,C):d.length===2&&(this.twoFingerMove(this.touches[t],n.pointerId,n),d[o].Xprev=r[0],d[o].Yprev=r[1]);break}}else this._getPointerInputDevice(n)==="touch"&&(this._pointerStorePosition(n),this._board_touches.length===2&&(n.touches=this._board_touches,this.gestureChangeListener(n))),this.highlightElements(r[0],r[1],n,-1);return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[n,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(n){var t,o,r,u,d,C=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[n]),this.displayInfobox(!1),n){for(t=0;t<this.touches.length;t++)for(d=this.touches[t].targets,o=0;o<d.length;o++)if(d[o].num===n.pointerId){d.splice(o,1),d.length===0&&this.touches.splice(t,1);break}}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[n]),this.stopSelectionMode();else for(t=this.downObjects.length-1;t>-1;t--){for(r=!1,o=0;o<this.touches.length;o++)this.touches[o].obj.id===this.downObjects[t].id&&(r=!0);r||(this.downObjects[t].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[n]),JXG$1.exists(this.downObjects[t].coords)||(this.downObjects[t].snapToGrid(),this.downObjects[t].snapToPoints(),C=!0),u=this.downObjects[t].eventHandlers,(JXG$1.exists(u.click)&&u.click.length>0||JXG$1.exists(u.pointerclick)&&u.pointerclick.length>0||JXG$1.exists(u.dblclick)&&u.dblclick.length>0||JXG$1.exists(u.pointerdblclick)&&u.pointerdblclick.length>0)&&(this.clickObjects[this.downObjects[t].id]=this.downObjects[t]),this.downObjects.splice(t,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(n.pointerId),this._getPointerInputDevice(n)!=="touch"&&this.dehighlightAll(),C&&this.update(),!0},pointerLeaveListener:function(n){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(n){var t,o,r,u,d,C=this.options.precision.touch,I,f,A,G=n.touches,B,Z;for(this.hasTouchEnd||(JXG$1.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,t=0;t<G.length;t++)G[t].jxg_isused=!1;for(t=0;t<this.touches.length;t++)for(Z=this.touches[t].targets,u=0;u<Z.length;u++){Z[u].num=-1,C=this.options.precision.touch;do{for(d=0;d<G.length;d++)if(Math.abs(Math.pow(G[d].screenX-Z[u].X,2)+Math.pow(G[d].screenY-Z[u].Y,2))<C*C){Z[u].num=d,Z[u].X=G[d].screenX,Z[u].Y=G[d].screenY,G[d].jxg_isused=!0;break}C*=2}while(Z[u].num===-1&&C<this.options.precision.touchMax);Z[u].num===-1&&(JXG$1.debug("i couldn't find a targettouches for target no "+u+" on "+this.touches[t].obj.name+" ("+this.touches[t].obj.id+"). Removed the target."),JXG$1.debug("eps = "+C+", touchMax = "+Options.precision.touchMax),Z.splice(t,1))}for(t=0;t<G.length;t++)if(!G[t].jxg_isused){if(o=this.getMousePosition(n,t),this.selectingMode)return this._startSelecting(o),this.triggerEventHandlers(["touchstartselecting","startselecting"],[n]),n.preventDefault(),n.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(r=this.initMoveObject(o[0],o[1],n,"touch"),r.length!==0){if(I=r[r.length-1],B={num:t,X:G[t].screenX,Y:G[t].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},JXG$1.isPoint(I)||I.elementClass===Const.OBJECT_CLASS_TEXT||I.type===Const.OBJECT_TYPE_TICKS||I.type===Const.OBJECT_TYPE_IMAGE)A=[B],this.saveStartPos(I,A[0]),this.touches.push({obj:I,targets:A}),I.highlight(!0);else if(I.elementClass===Const.OBJECT_CLASS_LINE||I.elementClass===Const.OBJECT_CLASS_CIRCLE||I.elementClass===Const.OBJECT_CLASS_CURVE||I.type===Const.OBJECT_TYPE_POLYGON){for(f=!1,u=0;u<this.touches.length;u++)I.id===this.touches[u].obj.id&&(f=!0,this.touches[u].targets.length===1&&(this.saveStartPos(I,B),this.touches[u].targets.push(B)),G[t].jxg_isused=!0);f||(A=[B],this.saveStartPos(I,A[0]),this.touches.push({obj:I,targets:A}),I.highlight(!0))}}G[t].jxg_isused=!0}return this.touches.length>0&&(n.preventDefault(),n.stopPropagation()),G.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(n)||G.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(n)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[n]),!1},touchMoveListener:function(n){var t,o,r,u,d=n.touches;if(!this.checkFrameRate(n))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(n.preventDefault(),n.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(t=0;t<d.length;t++)if(!d[t].jxg_isused){o=this.getMousePosition(n,t),this._moveSelecting(o),this.triggerEventHandlers(["touchmoves","moveselecting"],[n,this.mode]);break}}else if(!this.touchOriginMove(n))if(this.mode===this.BOARD_MODE_DRAG){for(t=0;t<this.touches.length;t++)if(u=this.touches[t].targets,u.length===1){if(d[u[0].num]){if(o=this.getMousePosition(n,u[0].num),o[0]<0||o[0]>this.canvasWidth||o[1]<0||o[1]>this.canvasHeight)return;u[0].X=o[0],u[0].Y=o[1],this.moveObject(o[0],o[1],this.touches[t],n,"touch")}}else if(u.length===2&&u[0].num>-1&&u[1].num>-1&&d[u[0].num]&&d[u[1].num]){if(o=this.getMousePosition(n,u[0].num),r=this.getMousePosition(n,u[1].num),o[0]<0||o[0]>this.canvasWidth||o[1]<0||o[1]>this.canvasHeight||r[0]<0||r[0]>this.canvasWidth||r[1]<0||r[1]>this.canvasHeight)return;u[0].X=o[0],u[0].Y=o[1],u[1].X=r[0],u[1].Y=r[1],this.twoFingerMove(this.touches[t],u[0].num,n),u[0].Xprev=o[0],u[0].Yprev=o[1],u[1].Xprev=r[0],u[1].Yprev=r[1]}}else d.length===2&&this.gestureChangeListener(n),o=this.getMousePosition(n,0),this.highlightElements(o[0],o[1],n,-1);return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[n,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(n){var t,o,r,u=this.options.precision.touch,d=[],C,I,f=n&&n.touches,A,G=!1;if(this.triggerEventHandlers(["touchend","up"],[n]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[n]),this.stopSelectionMode();else if(f&&f.length>0){for(t=0;t<this.touches.length;t++)d[t]=this.touches[t];for(this.touches.length=0,t=0;t<f.length;t++)f[t].jxg_isused=!1;for(t=0;t<d.length;t++){for(C=!1,I=0,A=d[t].targets,o=0;o<A.length;o++)for(A[o].found=!1,r=0;r<f.length;r++)if(Math.abs(Math.pow(f[r].screenX-A[o].X,2)+Math.pow(f[r].screenY-A[o].Y,2))<u*u){A[o].found=!0,A[o].num=r,A[o].X=f[r].screenX,A[o].Y=f[r].screenY,I+=1;break}if(JXG$1.isPoint(d[t].obj)?C=A[0]&&A[0].found:d[t].obj.elementClass===Const.OBJECT_CLASS_LINE?C=A[0]&&A[0].found||A[1]&&A[1].found:d[t].obj.elementClass===Const.OBJECT_CLASS_CIRCLE&&(C=I===1||I===3),C)for(this.touches.push({obj:d[t].obj,targets:[]}),o=0;o<A.length;o++)A[o].found&&this.touches[this.touches.length-1].targets.push({num:A[o].num,X:A[o].screenX,Y:A[o].screenY,Xprev:NaN,Yprev:NaN,Xstart:A[o].Xstart,Ystart:A[o].Ystart,Zstart:A[o].Zstart});else d[t].obj.noHighlight()}}else this.touches.length=0;for(t=this.downObjects.length-1;t>-1;t--){for(C=!1,o=0;o<this.touches.length;o++)this.touches[o].obj.id===this.downObjects[t].id&&(C=!0);C||(this.downObjects[t].triggerEventHandlers(["touchup","up"],[n]),JXG$1.exists(this.downObjects[t].coords)||(this.downObjects[t].snapToGrid(),this.downObjects[t].snapToPoints(),G=!0),this.downObjects.splice(t,1))}return(!f||f.length===0)&&(this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),G&&this.update()),!0},mouseDownListener:function(n){var t,o,r;if(this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp)JXG$1.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0;else return;if(this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,t=this.getMousePosition(n),this._testForSelection(n),this.selectingMode){this._startSelecting(t),this.triggerEventHandlers(["mousestartselecting","startselecting"],[n]);return}return o=this.initMoveObject(t[0],t[1],n,"mouse"),o.length===0?(this.mode=this.BOARD_MODE_NONE,r=!0):(this.mouse={obj:null,targets:[{X:t[0],Y:t[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=o[o.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),n&&n.preventDefault?n.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(r=this.mouseOriginMoveStart(n)),this.triggerEventHandlers(["mousedown","down"],[n]),r},mouseMoveListener:function(n){var t;if(!this.checkFrameRate(n))return!1;t=this.getMousePosition(n),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(t),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[n,this.mode])):this.mouseOriginMove(n)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(t[0],t[1],this.mouse,n,"mouse"):this.highlightElements(t[0],t[1],n,-1),this.triggerEventHandlers(["mousemove","move"],[n,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(n){var t;if(this.selectingMode===!1&&this.triggerEventHandlers(["mouseup","up"],[n]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&(JXG$1.exists(this.mouse.obj.coords)||(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints())),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[n]),this.stopSelectionMode();else for(t=0;t<this.downObjects.length;t++)this.downObjects[t].triggerEventHandlers(["mouseup","up"],[n]);this.downObjects.length=0,this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(n){var t,o,r;return!this.attr.zoom.enabled||!this.attr.zoom.wheel||!this._isRequiredKeyPressed(n,"zoom")?!0:(n=n||window.event,t=n.detail?-n.detail:n.wheelDelta/40,o=this.attr.zoom.center,o==="board"?r=[]:r=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(n),this).usrCoords,t>0?this.zoomIn(r[1],r[2]):this.zoomOut(r[1],r[2]),this.triggerEventHandlers(["mousewheel"],[n]),n.preventDefault(),!1)},keyDownListener:function(n){var t=n.target.id,o,r,u,d,C=0,I=0,f=JXG$1.evaluate(this.attr.keyboard.dx)/this.unitX,A=JXG$1.evaluate(this.attr.keyboard.dy)/this.unitY,G=!1,B=!0,Z,w;return!this.attr.keyboard.enabled||t===""||(d=this.containerObj.shadowRoot||document,d.activeElement&&(r=d.activeElement,r.tagName==="INPUT"||r.tagName==="textarea"))?!1:(o=t.replace(this.containerObj.id+"_",""),r=this.select(o),JXG$1.exists(r.coords)&&(w=r.coords.usrCoords.slice(1)),JXG$1.evaluate(this.attr.keyboard.panshift)&&n.shiftKey||JXG$1.evaluate(this.attr.keyboard.panctrl)&&n.ctrlKey?(JXG$1.evaluate(this.attr.zoom.enabled)===!0&&(G=!0),n.keyCode===38?this.clickUpArrow():n.keyCode===40?this.clickDownArrow():n.keyCode===37?this.clickLeftArrow():n.keyCode===39?this.clickRightArrow():G&&n.keyCode===171?this.zoomIn():G&&n.keyCode===173?this.zoomOut():G&&n.keyCode===79?this.zoom100():B=!1):(JXG$1.exists(r.visProp)&&(JXG$1.exists(r.visProp.snaptogrid)&&r.visProp.snaptogrid&&JXG$1.evaluate(r.visProp.snapsizex)&&JXG$1.evaluate(r.visProp.snapsizey)?(u=r.getSnapSizes(),C=u[0],I=u[1],f=C,A=I):JXG$1.exists(r.visProp.attracttogrid)&&r.visProp.attracttogrid&&JXG$1.evaluate(r.visProp.attractordistance)&&JXG$1.evaluate(r.visProp.attractorunit)&&(C=1.1*JXG$1.evaluate(r.visProp.attractordistance),I=C,JXG$1.evaluate(r.visProp.attractorunit)==="screen"&&(C/=this.unitX,I/=this.unitX),f=Math.max(C,f),A=Math.max(I,A))),n.keyCode===38?Z=[0,A]:n.keyCode===40?Z=[0,-A]:n.keyCode===37?Z=[-f,0]:n.keyCode===39?Z=[f,0]:B=!1,Z&&r.isDraggable&&r.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(r)||r.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(r.visProp.fixed)&&(this.mode=this.BOARD_MODE_DRAG,JXG$1.exists(r.coords)&&(Z[0]+=w[0],Z[1]+=w[1]),JXG$1.exists(r.coords)?(r.setPosition(JXG$1.COORDS_BY_USER,Z),this.updateInfobox(r)):(this.displayInfobox(!1),r.setPositionDirectly(Const.COORDS_BY_USER,Z,[0,0])),this.triggerEventHandlers(["keymove","move"],[n,this.mode]),r.triggerEventHandlers(["keydrag","drag"],[n]),this.mode=this.BOARD_MODE_NONE)),this.update(),B&&JXG$1.exists(n.preventDefault)&&n.preventDefault(),B)},keyFocusInListener:function(n){var t=n.target.id,o,r;if(!this.attr.keyboard.enabled||t==="")return!1;o=t.replace(this.containerObj.id+"_",""),r=this.select(o),JXG$1.exists(r.highlight)&&(r.highlight(!0),this.focusObjects=[o],r.triggerEventHandlers(["hit"],[n])),JXG$1.exists(r.coords)&&this.updateInfobox(r)},keyFocusOutListener:function(n){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(n,t){var o=n,r=t,u,d,C;n===void 0&&(o=this.containerObj.offsetWidth,r=this.containerObj.offsetHeight),n===void 0&&window&&window.getComputedStyle&&(u=window.getComputedStyle(this.containerObj,null),d=parseFloat(u.getPropertyValue("border-left-width"))+parseFloat(u.getPropertyValue("border-right-width")),isNaN(d)||(o-=d),C=parseFloat(u.getPropertyValue("border-top-width"))+parseFloat(u.getPropertyValue("border-bottom-width")),isNaN(C)||(r-=C)),!(o<=0||r<=0||isNaN(o)||isNaN(r))&&(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),!(JXG$1.exists(this._prevDim)&&this._prevDim.w===o&&this._prevDim.h===r)&&(this.resizeContainer(o,r,!0),this._prevDim={w:o,h:r}))},startResizeObserver:function(){var n=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||(this.resizeObserver=new ResizeObserver(function(t){var o;n._isResizing||(n._isResizing=!0,o=t[0].contentRect,window.setTimeout(function(){try{n.updateContainerDims(o.width,o.height)}catch{n.stopResizeObserver()}finally{n._isResizing=!1}},n.attr.resize.throttle))}),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var n=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||!this._isScrolling&&!this._isResizing&&(this._isResizing=!0,window.setTimeout(function(){n.updateContainerDims(),n._isResizing=!1},this.attr.resize.throttle))},scrollListener:function(n){var t=this;JXG$1.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout(function(){t._isScrolling=!1},66)))},startIntersectionObserver:function(){var n=this,t={root:null,rootMargin:"0px",threshold:.8};try{this.intersectionObserver=new IntersectionObserver(function(o){isNaN(n.getBoundingBox()[0])&&n.updateContainerDims()},t),this.intersectionObserver.observe(n.containerObj)}catch{JXG$1.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){JXG$1.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},printListener:function(n){this.updateContainerDims()},printListenerMatch:function(n){n.matches&&this.printListener()},initInfobox:function(n){var t=JXG$1.copyAttributes(n,this.options,"infobox");return t.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],t),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(n){var t,o,r,u,d,C,I,f=JXG$1.evaluate(n.visProp.showinfobox);return!JXG$1.evaluate(this.attr.showinfobox)&&f==="inherit"||!f?this:(JXG$1.isPoint(n)&&(r=n.coords.usrCoords[1],u=n.coords.usrCoords[2],C=JXG$1.evaluate(this.infobox.visProp.distancex),I=JXG$1.evaluate(this.infobox.visProp.distancey),this.infobox.setCoords(r+C/this.unitX,u+I/this.unitY),d=JXG$1.evaluate(n.visProp.infoboxdigits),typeof n.infoboxText!="string"?(d==="auto"?this.infobox.useLocale()?(t=this.infobox.formatNumberLocale(r),o=this.infobox.formatNumberLocale(u)):(t=JXG$1.autoDigits(r),o=JXG$1.autoDigits(u)):JXG$1.isNumber(d)?this.infobox.useLocale()?(t=this.infobox.formatNumberLocale(r,d),o=this.infobox.formatNumberLocale(u,d)):(t=JXG$1.toFixed(r,d),o=JXG$1.toFixed(u,d)):(t=r,o=u),this.highlightInfobox(t,o,n)):this.highlightCustomInfobox(n.infoboxText,n),this.displayInfobox(!0)),this)},displayInfobox:function(n){return!n&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===Const.OBJECT_CLASS_POINT?this:(this.infobox.hiddenByParent===n&&(this.infobox.hiddenByParent=!n,this.infobox.prepareUpdate().updateVisibility(n).updateRenderer()),this)},showInfobox:function(n){return this.displayInfobox(n)},highlightInfobox:function(n,t,o){return this.highlightCustomInfobox("("+n+", "+t+")",o),this},highlightCustomInfobox:function(n,t){return this.infobox.setText(n),this},dehighlightAll:function(){var n,t,o={},r=!1;for(n in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(n)&&(t=this.highlightedObjects[n],this.focusObjects.indexOf(n)<0?((this.hasMouseHandlers||this.hasPointerHandlers)&&t.noHighlight(),r=!0):o[n]=t);return this.highlightedObjects=o,this.renderer.type==="canvas"&&r&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(n,t){return[n,t]},getUsrCoordsOfMouse:function(n){var t=this.getCoordsTopLeftCorner(),o=JXG$1.getPosition(n,null,this.document),r=o[0]-t[0],u=o[1]-t[1],d=new Coords(Const.COORDS_BY_SCREEN,[r,u],this);return d.usrCoords.slice(1)},getAllUnderMouse:function(n){var t=this.getAllObjectsUnderMouse(n);return t.push(this.getUsrCoordsOfMouse(n)),t},getAllObjectsUnderMouse:function(n){var t=this.getCoordsTopLeftCorner(),o=JXG$1.getPosition(n,null,this.document),r=o[0]-t[0],u=o[1]-t[1],d=[],C,I,f=this.objectsList.length;for(C=0;C<f;C++)I=this.objectsList[C],I.visPropCalc.visible&&I.hasPoint&&I.hasPoint(r,u)&&(d[d.length]=I);return d},updateCoords:function(){var n,t,o=this.objectsList.length;for(t=0;t<o;t++)n=this.objectsList[t],JXG$1.exists(n.coords)&&(JXG$1.evaluate(n.visProp.frozen)?n.is3D?n.element2D.coords.screen2usr():n.coords.screen2usr():n.is3D?n.element2D.coords.usr2screen():n.coords.usr2screen());return this},moveOrigin:function(n,t,o){var r,u,d,C;return JXG$1.exists(n)&&JXG$1.exists(t)&&(r=this.origin.scrCoords[1],u=this.origin.scrCoords[2],this.origin.scrCoords[1]=n,this.origin.scrCoords[2]=t,o&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),d=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,C=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(d[1]<this.maxboundingbox[0]||d[2]>this.maxboundingbox[1]||C[1]>this.maxboundingbox[2]||C[2]<this.maxboundingbox[3])&&(this.origin.scrCoords[1]=r,this.origin.scrCoords[2]=u)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(n){var t,o,r,u,d,C,I,f=[],A=n.indexOf("<data>"),G=n.indexOf("</data>"),B=function(J,T,L,z){return function(){var K,P;K=J.select(T.id),P=K.coords.usrCoords[z],z===2?K.setPositionDirectly(Const.COORDS_BY_USER,[L(),P]):K.setPositionDirectly(Const.COORDS_BY_USER,[P,L()]),K.prepareUpdate().update()}},Z=function(J,T,L){return function(){var z,K;z=J.select(T.id),K=L(),z.setAttribute({visible:K})}},w=function(J,T,L,z){return function(){var K,P;K=J.select(T.id),P=L(),z==="strokewidth"?K.visProp.strokewidth=P:(P=JXG$1.rgba2rgbo(P),K.visProp[z+"color"]=P[0],K.visProp[z+"opacity"]=P[1])}},V=function(J,T,L){return function(){var z=J.select(T.id);z.position=L()}},Y=function(J,T,L){return function(){var z=J.select(T.id);z.setStyle(L())}};if(!(A<0)){for(;A>=0;){if(t=n.slice(A+6,G),o=t.indexOf("="),r=t.slice(0,o),u=t.slice(o+1),o=r.indexOf("."),d=r.slice(0,o),C=this.elementsByName[JXG$1.unescapeHTML(d)],I=r.slice(o+1).replace(/\s+/g,"").toLowerCase(),u=JXG$1.createFunction(u,this,"",!0),!JXG$1.exists(this.elementsByName[d]))JXG$1.debug("debug conditions: |"+d+"| undefined");else switch(I){case"x":f.push(B(this,C,u,2));break;case"y":f.push(B(this,C,u,1));break;case"visible":f.push(Z(this,C,u));break;case"position":f.push(V(this,C,u));break;case"stroke":f.push(w(this,C,u,"stroke"));break;case"style":f.push(Y(this,C,u));break;case"strokewidth":f.push(w(this,C,u,"strokewidth"));break;case"fill":f.push(w(this,C,u,"fill"));break;case"label":break;default:JXG$1.debug('property "'+I+'" in conditions not yet implemented:'+u);break}n=n.slice(G+7),A=n.indexOf("<data>"),G=n.indexOf("</data>")}this.updateConditions=function(){var J;for(J=0;J<f.length;J++)f[J]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var n,t,o=this.getBoundingBox(),r=JXG$1.evaluate(this.options.grid.majorStep),u=JXG$1.evaluate(this.options.grid.gridX),d=JXG$1.evaluate(this.options.grid.gridY),C,I;for(JXG$1.isArray(r)||(r=[r,r]),r.length<2&&(r=[r[0],r[0]]),JXG$1.exists(u)&&(r[0]=u),JXG$1.exists(d)&&(r[1]=d),r[0]==="auto"?r[0]=1:r[0]=JXG$1.parseNumber(r[0],Math.abs(o[1]-o[3]),1/this.unitX),r[1]==="auto"?r[1]=1:r[1]=JXG$1.parseNumber(r[1],Math.abs(o[0]-o[2]),1/this.unitY),n=new Coords(Const.COORDS_BY_USER,[0,0],this),t=new Coords(Const.COORDS_BY_USER,[r[0],r[1]],this),C=n.scrCoords[1]-t.scrCoords[1],I=n.scrCoords[2]-t.scrCoords[2],this.options.grid.snapSizeX=r[0];Math.abs(C)>25;)this.options.grid.snapSizeX*=2,C/=2;for(this.options.grid.snapSizeY=r[1];Math.abs(I)>25;)this.options.grid.snapSizeY*=2,I/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(n,t){var o=this.getBoundingBox(),r=this.attr.zoom.factorx,u=this.attr.zoom.factory,d=(o[2]-o[0])*(1-1/r),C=(o[1]-o[3])*(1-1/u),I=.5,f=.5,A=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX>this.attr.zoom.max&&r>1||this.zoomY>this.attr.zoom.max&&u>1||this.zoomX<A&&r<1||this.zoomY<A&&u<1?this:(JXG$1.isNumber(n)&&JXG$1.isNumber(t)&&(I=(n-o[0])/(o[2]-o[0]),f=(o[1]-t)/(o[1]-o[3])),this.setBoundingBox([o[0]+d*I,o[1]-C*f,o[2]-d*(1-I),o[3]+C*(1-f)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(n,t){var o=this.getBoundingBox(),r=this.attr.zoom.factorx,u=this.attr.zoom.factory,d=(o[2]-o[0])*(1-r),C=(o[1]-o[3])*(1-u),I=.5,f=.5,A=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX<A||this.zoomY<A?this:(JXG$1.isNumber(n)&&JXG$1.isNumber(t)&&(I=(n-o[0])/(o[2]-o[0]),f=(o[1]-t)/(o[1]-o[3])),this.setBoundingBox([o[0]+d*I,o[1]-C*f,o[2]-d*(1-I),o[3]+C*(1-f)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var n,t,o;return JXG$1.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(n=this.getBoundingBox(),t=(n[2]-n[0])*(1-this.zoomX)*.5,o=(n[1]-n[3])*(1-this.zoomY)*.5,this.setBoundingBox([n[0]+t,n[1]-o,n[2]-t,n[3]+o],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var n,t,o,r,u,d=0,C=0,I=0,f=0,A=this.objectsList.length;for(n=0;n<A;n++)u=this.objectsList[n],JXG$1.isPoint(u)&&u.visPropCalc.visible&&(u.coords.usrCoords[1]<d?d=u.coords.usrCoords[1]:u.coords.usrCoords[1]>C&&(C=u.coords.usrCoords[1]),u.coords.usrCoords[2]>f?f=u.coords.usrCoords[2]:u.coords.usrCoords[2]<I&&(I=u.coords.usrCoords[2]));return t=50,o=t/this.unitX,r=t/this.unitY,this.setBoundingBox([d-o,f+r,C+o,I-r],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(n){var t,o,r,u=[1/0,-1/0,-1/0,1/0],d,C,I,f,A;if(!JXG$1.isArray(n)||n.length===0)return this;for(t=0;t<n.length;t++)o=this.select(n[t]),r=o.bounds(),JXG$1.isArray(r)&&(r[0]<u[0]&&(u[0]=r[0]),r[1]>u[1]&&(u[1]=r[1]),r[2]>u[2]&&(u[2]=r[2]),r[3]<u[3]&&(u[3]=r[3]));return JXG$1.isArray(u)&&(d=.5*(u[0]+u[2]),C=.5*(u[1]+u[3]),I=1.5*(u[2]-u[0])*.5,f=1.5*(u[1]-u[3])*.5,A=Math.max(I,f),this.setBoundingBox([d-A,C+A,d+A,C-A],this.keepaspectratio,"update")),this},setZoom:function(n,t){var o=this.attr.zoom.factorx,r=this.attr.zoom.factory;return this.attr.zoom.factorx=n/this.zoomX,this.attr.zoom.factory=t/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=o,this.attr.zoom.factory=r,this},_removeObj:function(n,t){var o,r;if(JXG$1.isArray(n)){for(r=0;r<n.length;r++)this._removeObj(n[r],t);return this}if(n=this.select(n),!JXG$1.exists(n)||JXG$1.isString(n))return this;try{for(o in n.childElements)n.childElements.hasOwnProperty(o)&&n.childElements[o].board._removeObj(n.childElements[o]);for(o in n.objects)n.objects.hasOwnProperty(o)&&n.objects[o].board._removeObj(n.objects[o]);if(t)for(o in this.objects)this.objects.hasOwnProperty(o)&&JXG$1.exists(this.objects[o].childElements)&&JXG$1.exists(this.objects[o].childElements.hasOwnProperty(n.id))&&(delete this.objects[o].childElements[n.id],delete this.objects[o].descendants[n.id]);else if(JXG$1.exists(n.ancestors))for(o in n.ancestors)n.ancestors.hasOwnProperty(o)&&JXG$1.exists(n.ancestors[o].childElements)&&JXG$1.exists(n.ancestors[o].childElements.hasOwnProperty(n.id))&&(delete n.ancestors[o].childElements[n.id],delete n.ancestors[o].descendants[n.id]);if(n._pos>-1)for(this.objectsList.splice(n._pos,1),r=n._pos;r<this.objectsList.length;r++)this.objectsList[r]._pos--;else n.type!==Const.OBJECT_TYPE_TURTLE&&JXG$1.debug("Board.removeObject: object "+n.id+" not found in list.");delete this.objects[n.id],delete this.elementsByName[n.name],n.visProp&&JXG$1.evaluate(n.visProp.trace)&&n.clearTrace(),JXG$1.exists(n.remove)&&n.remove()}catch(u){JXG$1.debug(n.id+": Could not be removed: "+u)}return this},removeObject:function(n,t){var o;if(this.renderer.suspendRedraw(this),JXG$1.isArray(n))for(o=0;o<n.length;o++)this._removeObj(n[o],t);else this._removeObj(n,t);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(n){var t;for(t in n.ancestors)n.ancestors.hasOwnProperty(t)&&this.removeAncestors(n.ancestors[t]);return this.removeObject(n),this},initGeonextBoard:function(){var n,t,o;return n=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),t=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),o=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[n,t],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[n,o],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(n,t,o,r){var u,d,C,I,f;return d=this.canvasWidth,C=this.canvasHeight,r||(u=this.getBoundingBox()),this.canvasWidth=parseFloat(n),this.canvasHeight=parseFloat(t),o||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),r?(I=(this.canvasWidth-d)*.5,f=(this.canvasHeight-C)*.5,this.moveOrigin(this.origin.scrCoords[1]+I,this.origin.scrCoords[2]+f)):this.setBoundingBox(u,this.keepaspectratio,"keep"),this},showDependencies:function(){var n,t,o,r,u;t=`<p>
`;for(n in this.objects)if(this.objects.hasOwnProperty(n)){u=0;for(o in this.objects[n].childElements)this.objects[n].childElements.hasOwnProperty(o)&&(u+=1);u>=0&&(t+="<strong>"+this.objects[n].id+":</strong> ");for(o in this.objects[n].childElements)this.objects[n].childElements.hasOwnProperty(o)&&(t+=this.objects[n].childElements[o].id+"("+this.objects[n].childElements[o].name+"), ");t+=`<p>
`}return t+=`</p>
`,r=window.open(),r.document.open(),r.document.write(t),r.document.close(),this},showXML:function(){var n=window.open("");return n.document.open(),n.document.write("<pre>"+JXG$1.escapeHTML(this.xmlString)+"</pre>"),n.document.close(),this},prepareUpdate:function(){var n,t,o=this.objectsList.length;for(n=0;n<o;n++)t=this.objectsList[n],t.needsUpdate=t.needsRegularUpdate||this.needsFullUpdate;for(n in this.groups)this.groups.hasOwnProperty(n)&&(t=this.groups[n],t.needsUpdate=t.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(n){var t,o;for(n=this.select(n),t=0;t<this.objectsList.length;t++)o=this.objectsList[t],this.needsFullUpdate&&o.elementClass===Const.OBJECT_CLASS_TEXT&&o.updateSize(),o.update(!JXG$1.exists(n)||o.id!==n.id).updateVisibility();for(t in this.groups)this.groups.hasOwnProperty(t)&&this.groups[t].update(n);return this},updateRenderer:function(){var n,t=this.objectsList.length;if(this.renderer){if(this.renderer.type==="canvas")this.updateRendererCanvas();else for(n=0;n<t;n++)this.objectsList[n].updateRenderer();return this}},updateRendererCanvas:function(){var n,t,o,r,u,d=this.objectsList.length,C=this.options.layer,I=this.options.layer.numlayers,f=Number.NEGATIVE_INFINITY;for(o=0;o<I;o++){r=Number.POSITIVE_INFINITY;for(u in C)C.hasOwnProperty(u)&&C[u]>f&&C[u]<r&&(r=C[u]);for(f=r,n=0;n<d;n++)t=this.objectsList[n],t.visProp.layer===r&&t.prepareUpdate().updateRenderer()}return this},addHook:function(n,t,o){return JXG$1.deprecated("Board.addHook()","Board.on()"),t=JXG$1.def(t,"update"),o=JXG$1.def(o,this),this.hooks.push([t,n]),this.on(t,n,o),this.hooks.length-1},addEvent:JXG$1.shortcut(JXG$1.Board.prototype,"on"),removeHook:function(n){return JXG$1.deprecated("Board.removeHook()","Board.off()"),this.hooks[n]&&(this.off(this.hooks[n][0],this.hooks[n][1]),this.hooks[n]=null),this},removeEvent:JXG$1.shortcut(JXG$1.Board.prototype,"off"),updateHooks:function(n){var t=Array.prototype.slice.call(arguments,0);return JXG$1.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),t[0]=JXG$1.def(t[0],"update"),this.triggerEventHandlers([t[0]],arguments),this},addChild:function(n){return JXG$1.exists(n)&&JXG$1.exists(n.containerObj)&&(this.dependentBoards.push(n),this.update()),this},removeChild:function(n){var t;for(t=this.dependentBoards.length-1;t>=0;t--)this.dependentBoards[t]===n&&this.dependentBoards.splice(t,1);return this},update:function(n){var t,o,r,u,d;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,this.attr.minimizereflow==="all"&&this.containerObj&&this.renderer.type!=="vml"&&(d=this.document.activeElement,u=this.renderer.removeToInsertLater(this.containerObj)),this.attr.minimizereflow==="svg"&&this.renderer.type==="svg"&&(d=this.document.activeElement,u=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate().updateElements(n).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),u&&(u(),d.focus()),o=this.dependentBoards.length,t=0;t<o;t++)r=this.dependentBoards[t],JXG$1.exists(r)&&r!==this&&(r.updateQuality=this.updateQuality,r.prepareUpdate().updateElements().updateConditions(),r.renderer.suspendRedraw(this),r.updateRenderer(),r.renderer.unsuspendRedraw(),r.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var n;for(n=0;n<this.grids.length;n++)this.removeObject(this.grids[n]);return this.grids.length=0,this.update(),this},create:function(n,t,o){var r,u;for(n=n.toLowerCase(),JXG$1.exists(t)||(t=[]),JXG$1.exists(o)||(o={}),u=0;u<t.length;u++)JXG$1.isString(t[u])&&!(n==="text"&&u===2)&&!(n==="solidofrevolution3d"&&u===2)&&!(n==="text3d"&&(u===2||u===4))&&!((n==="input"||n==="checkbox"||n==="button")&&(u===2||u===3))&&n!=="curve"&&n!=="functiongraph"&&n!=="implicitcurve"&&(t[u]=this.select(t[u]));if(JXG$1.isFunction(JXG$1.elements[n]))r=JXG$1.elements[n](this,t,o);else throw new Error("JSXGraph: create: Unknown element type given: "+n);return JXG$1.exists(r)?(r.prepareUpdate&&r.update&&r.updateRenderer&&r.fullUpdate(),r):(JXG$1.debug("JSXGraph: create: failure creating "+n),r)},createElement:function(){return JXG$1.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var n;for(n=0;n<this.objectsList.length;n++)this.objectsList[n].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(n,t,o){var r,u,d,C,I=0,f=0,A=1,G,B,Z,w,V,Y=JXG$1.getDimensions(this.containerObj,this.document);return JXG$1.isArray(n)?n[0]<this.maxboundingbox[0]||n[1]>this.maxboundingbox[1]||n[2]>this.maxboundingbox[2]||n[3]<this.maxboundingbox[3]?this:(JXG$1.exists(o)||(o="reset"),d=this.unitX,C=this.unitY,this.canvasWidth=parseFloat(Y.width),this.canvasHeight=parseFloat(Y.height),u=this.canvasWidth,r=this.canvasHeight,t?(this.keepaspectratio?(G=d/C,isNaN(G)&&(G=1)):G=1,o==="keep"&&(A=this.zoomX/this.zoomY),B=n[2]-n[0],Z=n[1]-n[3],w=d*B,V=C*Z,u>=r?w>=V?(this.unitY=r/Z,this.unitX=this.unitY*G):(this.unitY=r/Math.abs(B)*Mat.sign(Z)/A,this.unitX=this.unitY*G):V>w?(this.unitX=u/B,this.unitY=this.unitX/G):(this.unitX=u/Math.abs(Z)*Mat.sign(B)*A,this.unitY=this.unitX/G),I=(u/this.unitX-B)*.5,f=(r/this.unitY-Z)*.5,this.keepaspectratio=!0):(this.unitX=u/(n[2]-n[0]),this.unitY=r/(n[1]-n[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(n[0]-I),this.unitY*(n[1]+f)),o==="update"?(this.zoomX*=this.unitX/d,this.zoomY*=this.unitY/C):o==="reset"&&(this.zoomX=JXG$1.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=JXG$1.exists(this.attr.zoomy)?this.attr.zoomy:1),this):this},getBoundingBox:function(){var n=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,t=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[n[1],n[2],t[1],t[2]]},_set:function(n,t){n=n.toLocaleLowerCase(),t!==null&&JXG$1.isObject(t)&&!JXG$1.exists(t.id)&&!JXG$1.exists(t.name)?JXG$1.mergeAttr(this.attr[n],t):this.attr[n]=t},setAttribute:function(n){var t,o,r,u,d,C,I,f={};for(t=0;t<arguments.length;t++)o=arguments[t],JXG$1.isString(o)?(r=o.split(":"),f[JXG$1.trim(r[0])]=JXG$1.trim(r[1])):JXG$1.isArray(o)?f[o[0]]=o[1]:JXG$1.extend(f,o);for(t in f)if(f.hasOwnProperty(t)&&(u=t.replace(/\s+/g,"").toLowerCase(),d=f[t]),d=d.toLowerCase&&d.toLowerCase()==="false"?!1:d,C=this.attr[u],C!==d)switch(u){case"axis":d===!1&&JXG$1.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(d,this.keepaspectratio),this._set(u,d);break;case"defaultaxes":JXG$1.exists(this.defaultAxes.x)&&JXG$1.exists(d.x)&&this.defaultAxes.x.setAttribute(d.x),JXG$1.exists(this.defaultAxes.y)&&JXG$1.exists(d.y)&&this.defaultAxes.y.setAttribute(d.y);break;case"description":this.document.getElementById(this.container+"_ARIAdescription").innerHTML=d,this._set(u,d);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=d,this._set(u,d);break;case"keepaspectratio":this._set(u,d),this.setBoundingBox(this.getBoundingBox(),d,"keep");break;case"document":case"maxboundingbox":this[u]=d,this._set(u,d);break;case"zoomx":case"zoomy":this[u]=d,this._set(u,d),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":I=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+u),I&&JXG$1.exists(d.symbol)&&(I.innerHTML=JXG$1.evaluate(d.symbol)),this._set(u,d);break;case"selection":d.visible=!1,d.withLines=!1,d.vertices={visible:!1},this._set(u,d);break;case"showcopyright":this.renderer.type==="svg"&&(I=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")),I?I.style.display=JXG$1.evaluate(d)?"inline":"none":JXG$1.evaluate(d)&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)));default:JXG$1.exists(this.attr[u])&&this._set(u,d);break}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[f,this]),this.fullUpdate(),this},addAnimation:function(n){var t=this;return this.animationObjects[n.id]=n,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){t.animate()},n.board.attr.animationdelay)),this},stopAllAnimation:function(){var n;for(n in this.animationObjects)this.animationObjects.hasOwnProperty(n)&&JXG$1.exists(this.animationObjects[n])&&(this.animationObjects[n]=null,delete this.animationObjects[n]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var n,t,o,r,u,d,C,I,f=0,A=null;for(t in this.animationObjects)if(this.animationObjects.hasOwnProperty(t)&&JXG$1.exists(this.animationObjects[t])){if(f+=1,o=this.animationObjects[t],o.animationPath&&(JXG$1.isFunction(o.animationPath)?r=o.animationPath(new Date().getTime()-o.animationStart):r=o.animationPath.pop(),!JXG$1.exists(r)||!JXG$1.isArray(r)&&isNaN(r)?delete o.animationPath:(o.setPositionDirectly(Const.COORDS_BY_USER,r),o.fullUpdate(),A=o)),o.animationData){C=0;for(u in o.animationData)o.animationData.hasOwnProperty(u)&&(d=o.animationData[u].pop(),JXG$1.exists(d)?(C+=1,n={},n[u]=d,o.setAttribute(n)):delete o.animationData[d]);C===0&&delete o.animationData}!JXG$1.exists(o.animationData)&&!JXG$1.exists(o.animationPath)&&(this.animationObjects[t]=null,delete this.animationObjects[t],JXG$1.exists(o.animationCallback)&&(I=o.animationCallback,o.animationCallback=null,I()))}return f===0?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(A),this},migratePoint:function(n,t,o){var r,u,d,C,I,f,A=!1;n=this.select(n),t=this.select(t),JXG$1.exists(n.label)&&(f=n.label.id,A=!0,this.removeObject(n.label));for(u in n.childElements)if(n.childElements.hasOwnProperty(u)){r=n.childElements[u],C=!1;for(d in r)r.hasOwnProperty(d)&&r[d]===n&&(r[d]=t,C=!0);for(C&&delete n.childElements[u],I=0;I<r.parents.length;I++)r.parents[I]===n.id&&(r.parents[I]=t.id);t.addChild(r)}return o&&(A&&(delete t.childElements[f],delete t.descendants[f]),t.label&&this.removeObject(t.label),delete this.elementsByName[t.name],t.name=n.name,A&&t.createLabel()),this.removeObject(n),JXG$1.exists(t.name)&&t.name!==""&&(this.elementsByName[t.name]=t),this.fullUpdate(),this},emulateColorblindness:function(n){var t,o;if(JXG$1.exists(n)||(n="none"),this.currentCBDef===n)return this;for(t in this.objects)this.objects.hasOwnProperty(t)&&(o=this.objects[t],n!=="none"?(this.currentCBDef==="none"&&(o.visPropOriginal={strokecolor:o.visProp.strokecolor,fillcolor:o.visProp.fillcolor,highlightstrokecolor:o.visProp.highlightstrokecolor,highlightfillcolor:o.visProp.highlightfillcolor}),o.setAttribute({strokecolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.strokecolor),n),fillcolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.fillcolor),n),highlightstrokecolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.highlightstrokecolor),n),highlightfillcolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.highlightfillcolor),n)})):JXG$1.exists(o.visPropOriginal)&&JXG$1.extend(o.visProp,o.visPropOriginal));return this.currentCBDef=n,this.update(),this},select:function(n,t){var o,r,u,d,C=n;if(C===null)return C;if(JXG$1.isString(C)&&C!=="")JXG$1.exists(this.objects[C])?C=this.objects[C]:JXG$1.exists(this.elementsByName[C])?C=this.elementsByName[C]:JXG$1.exists(this.groups[C])&&(C=this.groups[C]);else if(!t&&(JXG$1.isFunction(C)||JXG$1.isObject(C)&&!JXG$1.isFunction(C.setAttribute))){for(o=JXG$1.filterElements(this.objectsList,C),r={},d=o.length,u=0;u<d;u++)r[o[u].id]=o[u];C=new Composition(r)}else JXG$1.isObject(C)&&JXG$1.exists(C.id)&&!JXG$1.exists(this.objects[C.id])&&(C=null);return C},hasPoint:function(n,t){var o=n,r=t,u=this.getBoundingBox();return JXG$1.exists(n)&&JXG$1.isArray(n.usrCoords)&&(o=n.usrCoords[1],r=n.usrCoords[2]),!!(JXG$1.isNumber(o)&&JXG$1.isNumber(r)&&u[0]<o&&o<u[2]&&u[1]>r&&r>u[3])},updateCSSTransforms:function(){var n=this.containerObj,t=n,o=n;if(this.cssTransMat=JXG$1.getCSSTransformMatrix(t),JXG$1.exists(t.getRootNode)){for(t=t.parentNode===t.getRootNode()?t.parentNode.host:t.parentNode;t;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),t=t.parentNode===t.getRootNode()?t.parentNode.host:t.parentNode;this.cssTransMat=Mat.inverse(this.cssTransMat)}else{for(t=t.offsetParent;t;){for(this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),o=o.parentNode;o!==t;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),o=o.parentNode;t=t.offsetParent}this.cssTransMat=Mat.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(n){this.isSelecting=!0,this.selectingBox=[[n[0],n[1]],[n[0],n[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(n){this.isSelecting&&(this.selectingBox[1]=[n[0],n[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(n){var t=this.getMousePosition(n);this.isSelecting=!1,this.selectingBox[1]=[t[0],t[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var n=this.selectingBox[0],t=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],n[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],t[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[t[0],t[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[t[0],n[1]])},_testForSelection:function(n){this._isRequiredKeyPressed(n,"selection")&&(JXG$1.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(n){var t;return JXG$1.exists(this.selectionPolygon)||(t=JXG$1.copyAttributes(n,Options,"board","selection"),t.enabled===!0&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],t))),this},__evt__attribute:function(n){},__evt__down:function(n){},__evt__mousedown:function(n){},__evt__pendown:function(n){},__evt__pointerdown:function(n){},__evt__touchstart:function(n){},__evt__up:function(n){},__evt__mouseup:function(n){},__evt__pointerup:function(n){},__evt__touchend:function(n){},__evt__click:function(n){},__evt__dblclick:function(n){},__evt__mouseclick:function(n){},__evt__mousedblclick:function(n){},__evt__pointerclick:function(n){},__evt__pointerdblclick:function(n){},__evt__move:function(n,t){},__evt__mousemove:function(n,t){},__evt__penmove:function(n,t){},__evt__pointermove:function(n,t){},__evt__touchmove:function(n,t){},__evt__keymove:function(n,t){},__evt__hit:function(n,t,o){},__evt__mousehit:function(n,t,o){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(n){var t,o,r,u,d=this.document,C;return n=n||this.container,this._fullscreen_inner_id=n,r=d.getElementById(n),t="fullscreenwrap_"+n,JXG$1.exists(r._cssFullscreenStore)||(u=this.containerObj.getBoundingClientRect(),r._cssFullscreenStore={w:u.width,h:u.height}),d.getElementById(t)?o=d.getElementById(t):(o=document.createElement("div"),o.classList.add("JXG_wrap_private"),o.setAttribute("id",t),r.parentNode.insertBefore(o,r),o.appendChild(r)),o.requestFullscreen=o.requestFullscreen||o.webkitRequestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen,d.fullscreenElement!==void 0?C=d.fullscreenElement:d.webkitFullscreenElement!==void 0?C=d.webkitFullscreenElement:C=d.msFullscreenElement,C===null?o.requestFullscreen&&(o.requestFullscreen(),this.startFullscreenResizeObserver(o)):(this.stopFullscreenResizeObserver(o),JXG$1.exists(document.exitFullscreen)?document.exitFullscreen():JXG$1.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(n){var t,o,r,u=this.document;t=this._fullscreen_inner_id,JXG$1.exists(t)&&(u.fullscreenElement!==void 0?r=u.fullscreenElement:u.webkitFullscreenElement!==void 0?r=u.webkitFullscreenElement:r=u.msFullscreenElement,o=u.getElementById(t),r?(o._cssFullscreenStore.id=r.id,o._cssFullscreenStore.isFullscreen=!0,o._cssFullscreenStore.margin=o.style.margin,o._cssFullscreenStore.width=o.style.width,o._cssFullscreenStore.height=o.style.height,o._cssFullscreenStore.transform=o.style.transform,o.style.width=o._cssFullscreenStore.w+"px",o.style.height=o._cssFullscreenStore.h+"px",o.style.margin="",JXG$1.scaleJSXGraphDiv(r.id,t,u,JXG$1.evaluate(this.attr.fullscreen.scale)),r=null):JXG$1.exists(o._cssFullscreenStore)&&(o._cssFullscreenStore.isFullscreen=!1,o.style.margin=o._cssFullscreenStore.margin,o.style.width=o._cssFullscreenStore.width,o.style.height=o._cssFullscreenStore.height,o.style.transform=o._cssFullscreenStore.transform,o._cssFullscreenStore=null,o.parentElement.replaceWith(o)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(n){var t=this;return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(this.resizeObserver=new ResizeObserver(function(o){var r,u,d=t.document;t._isResizing||(t._isResizing=!0,window.setTimeout(function(){try{r=t._fullscreen_inner_id,d.fullscreenElement!==void 0?u=d.fullscreenElement:d.webkitFullscreenElement!==void 0?u=d.webkitFullscreenElement:u=d.msFullscreenElement,u!==null&&JXG$1.scaleJSXGraphDiv(u.id,r,d,JXG$1.evaluate(t.attr.fullscreen.scale))}catch{t.stopFullscreenResizeObserver(n)}finally{t._isResizing=!1}},t.attr.resize.throttle))}),this.resizeObserver.observe(n),this)},stopFullscreenResizeObserver:function(n){return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(n),this)},addLogEntry:function(n,t,o){var r,u,d=this.userLog.length-1;return JXG$1.exists(t.elementClass)&&(u=t.id),JXG$1.evaluate(this.attr.logging.enabled)&&(r=new Date().getTime(),d>=0&&this.userLog[d].type===n&&this.userLog[d].id===u&&r-this.userLog[d].end<500?(this.userLog[d].end=r,this.userLog[d].endpos=o):this.userLog.push({type:n,id:u,start:r,startpos:o,end:r,endpos:o,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(n,t,o,r,u,d,C){var I=this,f=function(){var A=0,G=0,B=0,Z=o,w=Numerics.root(function(ee){var se=n.X(Z),re=n.Y(Z),ce=t.X(ee),ue=t.Y(ee);return(se-ce)*(se-ce)+(re-ue)*(re-ue)},[0,Math.PI*2]),V=0,Y=0,J,T=I.create("transform",[function(){return A}],{type:"rotate"}),L=I.create("transform",[function(){return A},function(){return n.X(Z)},function(){return n.Y(Z)}],{type:"rotate"}),z=I.create("transform",[function(){return G},function(){return B}],{type:"translate"}),K=function(ee,se,re){var ce=Numerics.D(ee.X)(se),ue=Numerics.D(ee.Y)(se),ye=Numerics.D(ee.X)(re),Se=Numerics.D(ee.Y)(re),Ce=Numerics.D(ee.X)((se+re)*.5),Ze=Numerics.D(ee.Y)((se+re)*.5),Be=Mat.hypot(ce,ue),xe=Mat.hypot(ye,Se),ge=Mat.hypot(Ce,Ze);return(Be+4*ge+xe)*(re-se)/6},P=function(ee){return J-K(t,w,ee)},$=Math.PI/18,ie=$*9,ne=null;return this.rolling=function(){var ee,se,re,ce,ue;V=Z+u*r,J=K(n,Z,V),Y=Numerics.root(P,w),ee=new Complex(n.X(V),n.Y(V)),se=new Complex(t.X(Y),t.Y(Y)),re=new Complex(Numerics.D(n.X)(V),Numerics.D(n.Y)(V)),ce=new Complex(Numerics.D(t.X)(Y),Numerics.D(t.Y)(Y)),ue=Complex.C.div(re,ce),A=Math.atan2(ue.imaginary,ue.real),ue.div(Complex.C.abs(ue)),ue.mult(se),G=ee.real-ue.real,B=ee.imaginary-ue.imaginary,A<-$&&A>-ie?(A=-$,L.applyOnce(C)):A>$&&A<ie?(A=$,L.applyOnce(C)):(T.applyOnce(C),z.applyOnce(C),Z=V,w=Y),I.update()},this.start=function(){return d>0&&(ne=window.setInterval(this.rolling,d)),this},this.stop=function(){return window.clearInterval(ne),this},this};return new f}});const Board=JXG$1.Board;JXG$1.SVGRenderer=function(n,t){var o;for(this.type="svg",this.isIE=navigator.appVersion.indexOf("MSIE")!==-1||navigator.userAgent.match(/Trident\//),this.svgRoot=null,this.svgNamespace="http://www.w3.org/2000/svg",this.xlinkNamespace="http://www.w3.org/1999/xlink",this.container=n,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.svgRoot=this.container.ownerDocument.createElementNS(this.svgNamespace,"svg"),this.svgRoot.style.overflow="hidden",this.svgRoot.style.display="block",this.resize(t.width,t.height),this.container.appendChild(this.svgRoot),this.defs=this.container.ownerDocument.createElementNS(this.svgNamespace,"defs"),this.svgRoot.appendChild(this.defs),this.createShadowFilter=function(r,u,d,C,I,f){var A=this.container.ownerDocument.createElementNS(this.svgNamespace,"filter"),G,B,Z,w,V;return A.setAttributeNS(null,"id",r),A.setAttributeNS(null,"width","300%"),A.setAttributeNS(null,"height","300%"),A.setAttributeNS(null,"filterUnits","userSpaceOnUse"),G=this.container.ownerDocument.createElementNS(this.svgNamespace,"feOffset"),G.setAttributeNS(null,"in","SourceGraphic"),G.setAttributeNS(null,"result","offOut"),G.setAttributeNS(null,"dx",f[0]),G.setAttributeNS(null,"dy",f[1]),A.appendChild(G),B=this.container.ownerDocument.createElementNS(this.svgNamespace,"feColorMatrix"),B.setAttributeNS(null,"in","offOut"),B.setAttributeNS(null,"result","colorOut"),B.setAttributeNS(null,"type","matrix"),u==="none"||!JXG$1.isArray(u)||u.length<3?B.setAttributeNS(null,"values","0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 "+d+" 0"):(u[0]/=255,u[1]/=255,u[2]/=255,V=C+" 0 0 0 "+u[0]+"  0 "+C+" 0 0 "+u[1]+"  0 0 "+C+" 0 "+u[2]+"  0 0 0 "+d+" 0",B.setAttributeNS(null,"values",V)),A.appendChild(B),Z=this.container.ownerDocument.createElementNS(this.svgNamespace,"feGaussianBlur"),Z.setAttributeNS(null,"in","colorOut"),Z.setAttributeNS(null,"result","blurOut"),Z.setAttributeNS(null,"stdDeviation",I),A.appendChild(Z),w=this.container.ownerDocument.createElementNS(this.svgNamespace,"feBlend"),w.setAttributeNS(null,"in","SourceGraphic"),w.setAttributeNS(null,"in2","blurOut"),w.setAttributeNS(null,"mode","normal"),A.appendChild(w),A},this.uniqName=function(){return this.container.id+"_"+Array.prototype.slice.call(arguments).join("_")},this.toStr=function(){var r=Array.prototype.slice.call(arguments).join("");return JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(r=CSS.escape(r)),r},this.toURL=function(){return"url(#"+this.toStr.apply(this,arguments)+")"},this.defs.appendChild(this.createShadowFilter(this.uniqName("f1"),"none",1,.1,3,[5,5])),this.layer=[],o=0;o<Options.layer.numlayers;o++)this.layer[o]=this.container.ownerDocument.createElementNS(this.svgNamespace,"g"),this.svgRoot.appendChild(this.layer[o]);try{this.foreignObjLayer=this.container.ownerDocument.createElementNS(this.svgNamespace,"foreignObject"),this.foreignObjLayer.setAttribute("display","none"),this.foreignObjLayer.setAttribute("x",0),this.foreignObjLayer.setAttribute("y",0),this.foreignObjLayer.setAttribute("width","100%"),this.foreignObjLayer.setAttribute("height","100%"),this.foreignObjLayer.setAttribute("id",this.uniqName("foreignObj")),this.svgRoot.appendChild(this.foreignObjLayer),this.supportsForeignObject=!0}catch{this.supportsForeignObject=!1}};JXG$1.SVGRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.SVGRenderer.prototype,{_createArrowHead:function(n,t,o){var r,u,d=n.id+"Triangle",C,I;return JXG$1.exists(t)&&(d+=t),JXG$1.exists(o)&&(d+=o),r=this.createPrim("marker",d),r.setAttributeNS(null,"stroke",JXG$1.evaluate(n.visProp.strokecolor)),r.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),r.setAttributeNS(null,"fill",JXG$1.evaluate(n.visProp.strokecolor)),r.setAttributeNS(null,"fill-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),r.setAttributeNS(null,"stroke-width",0),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"markerUnits","strokeWidth"),u=this.container.ownerDocument.createElementNS(this.svgNamespace,"path"),I=5,t==="Start"?(C=0,o===2?u.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 L 5,5 z"):o===3?u.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z"):o===4?(I=3.31,u.setAttributeNS(null,"d","M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31")):o===5?(I=3.28,u.setAttributeNS(null,"d","M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28")):o===6?(I=2.84,u.setAttributeNS(null,"d","M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84")):o===7?(I=5.2,u.setAttributeNS(null,"d","M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20")):u.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 z"),n.elementClass===Const.OBJECT_CLASS_LINE&&(o===2?C=4.9:o===3?C=3.3:o===4||o===5||o===6?C=6.66:o===7?C=0:C=10)):(C=10,o===2?u.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 L 5,5 z"):o===3?(C=3.3,u.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z")):o===4?(I=3.31,u.setAttributeNS(null,"d","M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31")):o===5?(I=3.28,u.setAttributeNS(null,"d","M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28")):o===6?(I=2.84,u.setAttributeNS(null,"d","M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84")):o===7?(I=5.2,u.setAttributeNS(null,"d","M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20")):u.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 z"),n.elementClass===Const.OBJECT_CLASS_LINE&&(o===2?C=5.1:o===3?C=.02:o===4||o===5||o===6?C=3.33:o===7?C=10:C=.05)),o===7&&(r.setAttributeNS(null,"fill","none"),r.setAttributeNS(null,"stroke-width",1)),r.setAttributeNS(null,"refY",I),r.setAttributeNS(null,"refX",C),r.appendChild(u),r},_setArrowColor:function(n,t,o,r,u){n&&(JXG$1.isString(t)&&(u!==7?this._setAttribute(function(){n.setAttributeNS(null,"stroke",t),n.setAttributeNS(null,"fill",t),n.setAttributeNS(null,"stroke-opacity",o),n.setAttributeNS(null,"fill-opacity",o)},r.visPropOld.fillcolor):this._setAttribute(function(){n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"stroke",t),n.setAttributeNS(null,"stroke-opacity",o)},r.visPropOld.fillcolor)),this.isIE&&r.rendNode.parentNode.insertBefore(r.rendNode,r.rendNode))},_setArrowWidth:function(n,t,o,r){var u,d;n&&(u=t,d=u*r,n.setAttributeNS(null,"viewBox","0 0 "+u*10+" "+u*10),n.setAttributeNS(null,"markerHeight",d),n.setAttributeNS(null,"markerWidth",d),n.setAttributeNS(null,"display","inherit"),this.isIE&&o.parentNode.insertBefore(o,o))},updateTicks:function(n){var t,o,r,u,d,C,I="",f=n.ticks.length,A,G,B=!0;for(t=0;t<f;t++){for(r=n.ticks[t],d=r[0],C=r[1],A=d.length,G=" M "+d[0]+" "+C[0],JXG$1.isNumber(d[0])||(B=!1),o=1;B&&o<A;++o)JXG$1.isNumber(d[o])?G+=" L "+d[o]+" "+C[o]:B=!1;B&&(I+=G)}u=n.rendNode,JXG$1.exists(u)||(u=this.createPrim("path",n.id),this.appendChildPrim(u,JXG$1.evaluate(n.visProp.layer)),n.rendNode=u),u.setAttributeNS(null,"stroke",JXG$1.evaluate(n.visProp.strokecolor)),u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),u.setAttributeNS(null,"stroke-width",JXG$1.evaluate(n.visProp.strokewidth)),this.updatePathPrim(u,I,n.board),this.setObjectViewport(n)},displayCopyright:function(n,t){var o=this.createPrim("text","licenseText"),r;o.setAttributeNS(null,"x","20px"),o.setAttributeNS(null,"y",2+t+"px"),o.setAttributeNS(null,"style","font-family:Arial,Helvetica,sans-serif; font-size:"+t+"px; fill:#356AA0;  opacity:0.3;"),r=this.container.ownerDocument.createTextNode(n),o.appendChild(r),this.appendChildPrim(o,0)},drawInternalText:function(n){var t=this.createPrim("text",n.id);return t.style.whiteSpace="nowrap",n.rendNodeText=this.container.ownerDocument.createTextNode(""),t.appendChild(n.rendNodeText),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),t},updateInternalText:function(n){var t=n.plaintext,o,r=n.getAnchorX(),u=n.getAnchorY();n.rendNode.getAttributeNS(null,"class")!==n.visProp.cssclass&&(n.rendNode.setAttributeNS(null,"class",JXG$1.evaluate(n.visProp.cssclass)),n.needsSizeUpdate=!0),isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])||(o=n.coords.scrCoords[1],n.visPropOld.left!==r+o&&(n.rendNode.setAttributeNS(null,"x",o+"px"),r==="left"?n.rendNode.setAttributeNS(null,"text-anchor","start"):r==="right"?n.rendNode.setAttributeNS(null,"text-anchor","end"):r==="middle"&&n.rendNode.setAttributeNS(null,"text-anchor","middle"),n.visPropOld.left=r+o),o=n.coords.scrCoords[2],n.visPropOld.top!==u+o&&(n.rendNode.setAttributeNS(null,"y",o+this.vOffsetText*.5+"px"),u==="bottom"?(n.rendNode.setAttributeNS(null,"dy","0"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")):u==="top"?(n.rendNode.setAttributeNS(null,"dy","1.6ex"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")):u==="middle"&&(n.rendNode.setAttributeNS(null,"dy","0.6ex"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")),n.visPropOld.top=u+o)),n.htmlStr!==t&&(n.rendNodeText.data=t,n.htmlStr=t),this.transformImage(n,n.transformations)},updateInternalTextStyle:function(n,t,o,r){this.setObjectViewport(n),this.setObjectFillColor(n,t,o)},drawImage:function(n){var t=this.createPrim("image",n.id);t.setAttributeNS(null,"preserveAspectRatio","none"),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),n.rendNode=t,this.updateImage(n)},transformImage:function(n,t){var o,r,u=n.rendNode,d="",C,I,f=t.length;if(f>0&&(r=this.joinTransforms(n,t),o=[r[1][1],r[2][1],r[1][2],r[2][2],r[1][0],r[2][0]].join(","),o.indexOf("NaN")===-1))if(d+=" matrix("+o+") ",n.elementClass===Const.OBJECT_CLASS_TEXT&&n.visProp.display==="html"){switch(u.style.transform=d,C=-n.coords.scrCoords[1],I=-n.coords.scrCoords[2],JXG$1.evaluate(n.visProp.anchorx)){case"right":C+=n.size[0];break;case"middle":C+=n.size[0]*.5;break}switch(JXG$1.evaluate(n.visProp.anchory)){case"bottom":I+=n.size[1];break;case"middle":I+=n.size[1]*.5;break}u.style["transform-origin"]=C+"px "+I+"px"}else u.setAttributeNS(null,"transform",d)},updateImageURL:function(n){var t=JXG$1.evaluate(n.url);return n._src!==t?(n.imgIsLoaded=!1,n.rendNode.setAttributeNS(this.xlinkNamespace,"xlink:href",t),n._src=t,!0):!1},updateImageStyle:function(n,t){var o=JXG$1.evaluate(t?n.visProp.highlightcssclass:n.visProp.cssclass);n.rendNode.setAttributeNS(null,"class",o)},drawForeignObject:function(n){n.rendNode=this.appendChildPrim(this.createPrim("foreignObject",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"foreignObject"),this.updateForeignObject(n)},updateForeignObject:function(n){n._useUserSize?n.rendNode.style.overflow="hidden":n.rendNode.style.overflow="visible",this.updateRectPrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),n.rendNode.innerHTML=n.content,this._updateVisual(n,{stroke:!0,dash:!0},!0)},appendChildPrim:function(n,t){return JXG$1.exists(t)?t>=Options.layer.numlayers&&(t=Options.layer.numlayers-1):t=0,this.layer[t].appendChild(n),n},createPrim:function(n,t){var o=this.container.ownerDocument.createElementNS(this.svgNamespace,n);return o.setAttributeNS(null,"id",this.uniqName(t)),o.style.position="absolute",n==="path"&&(o.setAttributeNS(null,"stroke-linecap","round"),o.setAttributeNS(null,"stroke-linejoin","round"),o.setAttributeNS(null,"fill-rule","evenodd")),o},remove:function(n){JXG$1.exists(n)&&JXG$1.exists(n.parentNode)&&n.parentNode.removeChild(n)},setLayer:function(n,t){JXG$1.exists(t)?t>=Options.layer.numlayers&&(t=Options.layer.numlayers-1):t=0,this.layer[t].appendChild(n.rendNode)},makeArrows:function(n,t){var o,r,u=t.evFirst,d=t.evLast;if(this.isIE&&n.visPropCalc.visible&&(u||d)){n.rendNode.parentNode.insertBefore(n.rendNode,n.rendNode);return}o=n.rendNodeTriangleStart,u?(r=this.toStr(this.container.id,"_",n.id,"TriangleStart",t.typeFirst),(!JXG$1.exists(o)||o.id!==r)&&(o=this.container.ownerDocument.getElementById(r),o===null&&(o=this._createArrowHead(n,"Start",t.typeFirst),this.defs.appendChild(o)),n.rendNodeTriangleStart=o,n.rendNode.setAttributeNS(null,"marker-start",this.toURL(r)))):(JXG$1.exists(o)&&(this.remove(o),n.rendNodeTriangleStart=null),n.rendNode.setAttributeNS(null,"marker-start",null)),o=n.rendNodeTriangleEnd,d?(r=this.toStr(this.container.id,"_",n.id,"TriangleEnd",t.typeLast),(!JXG$1.exists(o)||o.id!==r)&&(o=this.container.ownerDocument.getElementById(r),o===null&&(o=this._createArrowHead(n,"End",t.typeLast),this.defs.appendChild(o)),n.rendNodeTriangleEnd=o,n.rendNode.setAttributeNS(null,"marker-end",this.toURL(r)))):(JXG$1.exists(o)&&(this.remove(o),n.rendNodeTriangleEnd=null),n.rendNode.setAttributeNS(null,"marker-end",null))},updateEllipsePrim:function(n,t,o,r,u){var d=1e6;d=2e5,t=Math.abs(t)<d?t:d*t/Math.abs(t),o=Math.abs(o)<d?o:d*o/Math.abs(o),r=Math.abs(r)<d?r:d*r/Math.abs(r),u=Math.abs(u)<d?u:d*u/Math.abs(u),n.setAttributeNS(null,"cx",t),n.setAttributeNS(null,"cy",o),n.setAttributeNS(null,"rx",Math.abs(r)),n.setAttributeNS(null,"ry",Math.abs(u))},updateLinePrim:function(n,t,o,r,u){var d=1e6;d=2e5,isNaN(t+o+r+u)||(t=Math.abs(t)<d?t:d*t/Math.abs(t),o=Math.abs(o)<d?o:d*o/Math.abs(o),r=Math.abs(r)<d?r:d*r/Math.abs(r),u=Math.abs(u)<d?u:d*u/Math.abs(u),n.setAttributeNS(null,"x1",t),n.setAttributeNS(null,"y1",o),n.setAttributeNS(null,"x2",r),n.setAttributeNS(null,"y2",u))},updatePathPrim:function(n,t){t===""&&(t="M 0 0"),n.setAttributeNS(null,"d",t)},updatePathStringPoint:function(n,t,o){var r="",u=n.coords.scrCoords,d=t*Math.sqrt(3)*.5,C=t*.5;return o==="x"?r=" M "+(u[1]-t)+" "+(u[2]-t)+" L "+(u[1]+t)+" "+(u[2]+t)+" M "+(u[1]+t)+" "+(u[2]-t)+" L "+(u[1]-t)+" "+(u[2]+t):o==="+"?r=" M "+(u[1]-t)+" "+u[2]+" L "+(u[1]+t)+" "+u[2]+" M "+u[1]+" "+(u[2]-t)+" L "+u[1]+" "+(u[2]+t):o==="|"?r=" M "+u[1]+" "+(u[2]-t)+" L "+u[1]+" "+(u[2]+t):o==="-"?r=" M "+(u[1]-t)+" "+u[2]+" L "+(u[1]+t)+" "+u[2]:o==="<>"||o==="<<>>"?(o==="<<>>"&&(t*=1.41),r=" M "+(u[1]-t)+" "+u[2]+" L "+u[1]+" "+(u[2]+t)+" L "+(u[1]+t)+" "+u[2]+" L "+u[1]+" "+(u[2]-t)+" Z "):o==="^"?r=" M "+u[1]+" "+(u[2]-t)+" L "+(u[1]-d)+" "+(u[2]+C)+" L "+(u[1]+d)+" "+(u[2]+C)+" Z ":o==="v"?r=" M "+u[1]+" "+(u[2]+t)+" L "+(u[1]-d)+" "+(u[2]-C)+" L "+(u[1]+d)+" "+(u[2]-C)+" Z ":o===">"?r=" M "+(u[1]+t)+" "+u[2]+" L "+(u[1]-C)+" "+(u[2]-d)+" L "+(u[1]-C)+" "+(u[2]+d)+" Z ":o==="<"&&(r=" M "+(u[1]-t)+" "+u[2]+" L "+(u[1]+C)+" "+(u[2]-d)+" L "+(u[1]+C)+" "+(u[2]+d)+" Z "),r},updatePathStringPrim:function(n){var t,o,r,u=" M ",d=" L ",C=" C ",I=u,f=5e3,A="";if(n.numberPoints<=0)return"";if(r=Math.min(n.points.length,n.numberPoints),n.bezierDegree===1)for(t=0;t<r;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?I=u:(o[1]=Math.max(Math.min(o[1],f),-5e3),o[2]=Math.max(Math.min(o[2],f),-5e3),A+=I+o[1]+" "+o[2],I=d);else if(n.bezierDegree===3)for(t=0;t<r;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?I=u:(A+=I+o[1]+" "+o[2],I===C&&(t+=1,o=n.points[t].scrCoords,A+=" "+o[1]+" "+o[2],t+=1,o=n.points[t].scrCoords,A+=" "+o[1]+" "+o[2]),I=C),t+=1;return A},updatePathStringBezierPrim:function(n){var t,o,r,u,d,C,I,f=" M ",A=" C ",G=f,B=5e3,Z="",w=JXG$1.evaluate(n.visProp.strokewidth),V=JXG$1.evaluate(n.visProp.curvetype)!=="plot";if(n.numberPoints<=0)return"";for(V&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,.5)),I=Math.min(n.points.length,n.numberPoints),o=1;o<3;o++)for(G=f,t=0;t<I;t++)u=n.points[t].scrCoords,isNaN(u[1])||isNaN(u[2])?G=f:(u[1]=Math.max(Math.min(u[1],B),-5e3),u[2]=Math.max(Math.min(u[2],B),-5e3),G===f?Z+=G+u[1]+" "+u[2]:(r=2*o,Z+=[G,d+(u[1]-d)*.333+w*(r*Math.random()-o)," ",C+(u[2]-C)*.333+w*(r*Math.random()-o)," ",d+(u[1]-d)*.666+w*(r*Math.random()-o)," ",C+(u[2]-C)*.666+w*(r*Math.random()-o)," ",u[1]," ",u[2]].join("")),G=A,d=u[1],C=u[2]);return Z},updatePolygonPrim:function(n,t){var o,r="",u,d=t.vertices.length;for(n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"fill-rule","evenodd"),t.elType==="polygonalchain"&&d++,o=0;o<d-1;o++){if(t.vertices[o].isReal)u=t.vertices[o].coords.scrCoords,r=r+u[1]+","+u[2];else{n.setAttributeNS(null,"points","");return}o<d-2&&(r+=" ")}r.indexOf("NaN")===-1&&n.setAttributeNS(null,"points",r)},updateRectPrim:function(n,t,o,r,u){n.setAttributeNS(null,"x",t),n.setAttributeNS(null,"y",o),n.setAttributeNS(null,"width",r),n.setAttributeNS(null,"height",u)},setPropertyPrim:function(n,t,o){t!=="stroked"&&n.setAttributeNS(null,t,o)},display:function(n,t){var o;n&&n.rendNode&&(n.visPropOld.visible=t,o=n.rendNode,t?(o.setAttributeNS(null,"display","inline"),o.style.visibility="inherit"):(o.setAttributeNS(null,"display","none"),o.style.visibility="hidden"))},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),this.display(n,!0)},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),this.display(n,!1)},setBuffering:function(n,t){n.rendNode.setAttribute("buffered-rendering",t)},setDashStyle:function(n){var t=JXG$1.evaluate(n.visProp.dash),o=JXG$1.evaluate(n.visProp.dashscale),r=o?.5*JXG$1.evaluate(n.visProp.strokewidth):1,u=n.rendNode;t>0?u.setAttributeNS(null,"stroke-dasharray",this.dashArray[t-1].map(function(d){return d*r}).join(",")):u.hasAttributeNS(null,"stroke-dasharray")&&u.removeAttributeNS(null,"stroke-dasharray")},setGradient:function(n){var t=n.rendNode,o,r,u,d=JXG$1.evaluate(n.visProp.gradient);d==="linear"||d==="radial"?(o=this.createPrim(d+"Gradient",n.id+"_gradient"),r=this.createPrim("stop",n.id+"_gradient1"),u=this.createPrim("stop",n.id+"_gradient2"),o.appendChild(r),o.appendChild(u),this.defs.appendChild(o),t.setAttributeNS(null,"style","fill:"+this.toURL(this.container.id+"_"+n.id+"_gradient")),n.gradNode1=r,n.gradNode2=u,n.gradNode=o):t.removeAttributeNS(null,"style")},updateGradientAngle:function(n,t){var o=1,r=Math.cos(t),u=Math.sin(t);Math.abs(r)>Math.abs(u)?o/=Math.abs(r):o/=Math.abs(u),r>=0?(n.setAttributeNS(null,"x1",0),n.setAttributeNS(null,"x2",r*o)):(n.setAttributeNS(null,"x1",-r*o),n.setAttributeNS(null,"x2",0)),u>=0?(n.setAttributeNS(null,"y1",0),n.setAttributeNS(null,"y2",u*o)):(n.setAttributeNS(null,"y1",-u*o),n.setAttributeNS(null,"y2",0))},updateGradientCircle:function(n,t,o,r,u,d,C){n.setAttributeNS(null,"cx",t*100+"%"),n.setAttributeNS(null,"cy",o*100+"%"),n.setAttributeNS(null,"r",r*100+"%"),n.setAttributeNS(null,"fx",u*100+"%"),n.setAttributeNS(null,"fy",d*100+"%"),n.setAttributeNS(null,"fr",C*100+"%")},updateGradient:function(n){var t,o,r=n.gradNode1,u=n.gradNode2,d=JXG$1.evaluate(n.visProp.gradient);!JXG$1.exists(r)||!JXG$1.exists(u)||(o=JXG$1.evaluate(n.visProp.fillopacity),o=o>0?o:0,t=JXG$1.evaluate(n.visProp.fillcolor),r.setAttributeNS(null,"style","stop-color:"+t+";stop-opacity:"+o),u.setAttributeNS(null,"style","stop-color:"+JXG$1.evaluate(n.visProp.gradientsecondcolor)+";stop-opacity:"+JXG$1.evaluate(n.visProp.gradientsecondopacity)),r.setAttributeNS(null,"offset",JXG$1.evaluate(n.visProp.gradientstartoffset)*100+"%"),u.setAttributeNS(null,"offset",JXG$1.evaluate(n.visProp.gradientendoffset)*100+"%"),d==="linear"?this.updateGradientAngle(n.gradNode,JXG$1.evaluate(n.visProp.gradientangle)):d==="radial"&&this.updateGradientCircle(n.gradNode,JXG$1.evaluate(n.visProp.gradientcx),JXG$1.evaluate(n.visProp.gradientcy),JXG$1.evaluate(n.visProp.gradientr),JXG$1.evaluate(n.visProp.gradientfx),JXG$1.evaluate(n.visProp.gradientfy),JXG$1.evaluate(n.visProp.gradientfr)))},setObjectTransition:function(n,t){var o,r,u=[],d,C,I=0,f=["rendNode","rendNodeTriangleStart","rendNodeTriangleEnd"];if(t===void 0&&(t=JXG$1.evaluate(n.visProp.transitionduration)),r=JXG$1.evaluate(n.visProp.transitionproperties),!(t===n.visPropOld.transitionduration&&r===n.visPropOld.transitionproperties)){for(JXG$1.exists(r)&&(I=r.length),C=0;C<I;C++)u.push(r[C]+" "+t+"ms");for(d=u.join(", "),I=f.length,C=0;C<I;++C)n[f[C]]&&(o=n[f[C]],o.style.transition=d);n.visPropOld.transitionduration=t,n.visPropOld.transitionproperties=r}},setObjectViewport:function(n,t){},_setAttribute:function(n,t){t===""?n():window.setTimeout(n,1)},setObjectFillColor:function(n,t,o,r){var u,d,C,I,f=JXG$1.evaluate(t),A=JXG$1.evaluate(o),G=JXG$1.evaluate(n.visProp.gradient);A=A>0?A:0,!(n.visPropOld.fillcolor===f&&n.visPropOld.fillopacity===A&&G===null)&&(JXG$1.exists(f)&&f!==!1&&(f.length!==9?(d=f,I=A):(C=JXG$1.rgba2rgbo(f),d=C[0],I=A*C[1]),r===void 0?u=n.rendNode:u=r,d!=="none"&&this._setAttribute(function(){u.setAttributeNS(null,"fill",d)},n.visPropOld.fillcolor),n.type===JXG$1.OBJECT_TYPE_IMAGE?this._setAttribute(function(){u.setAttributeNS(null,"opacity",I)},n.visPropOld.fillopacity):(d==="none"?(I=0,u.setAttributeNS(null,"pointer-events","visibleStroke")):u.setAttributeNS(null,"pointer-events","visiblePainted"),this._setAttribute(function(){u.setAttributeNS(null,"fill-opacity",I)},n.visPropOld.fillopacity)),(G==="linear"||G==="radial")&&this.updateGradient(n)),n.visPropOld.fillcolor=f,n.visPropOld.fillopacity=A)},setObjectStrokeColor:function(n,t,o){var r=JXG$1.evaluate(t),u,d,C=JXG$1.evaluate(o),I,f;C=C>0?C:0,!(n.visPropOld.strokecolor===r&&n.visPropOld.strokeopacity===C)&&(JXG$1.exists(r)&&r!==!1&&(r.length!==9?(u=r,I=C):(d=JXG$1.rgba2rgbo(r),u=d[0],I=C*d[1]),f=n.rendNode,n.elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(n.visProp.display)==="html"?this._setAttribute(function(){f.style.color=u,f.style.opacity=I},n.visPropOld.strokecolor):this._setAttribute(function(){f.setAttributeNS(null,"style","fill:"+u),f.setAttributeNS(null,"style","fill-opacity:"+I)},n.visPropOld.strokecolor):this._setAttribute(function(){f.setAttributeNS(null,"stroke",u),f.setAttributeNS(null,"stroke-opacity",I)},n.visPropOld.strokecolor),(n.elementClass===Const.OBJECT_CLASS_CURVE||n.elementClass===Const.OBJECT_CLASS_LINE)&&(JXG$1.evaluate(n.visProp.firstarrow)&&this._setArrowColor(n.rendNodeTriangleStart,u,I,n,n.visPropCalc.typeFirst),JXG$1.evaluate(n.visProp.lastarrow)&&this._setArrowColor(n.rendNodeTriangleEnd,u,I,n,n.visPropCalc.typeLast))),n.visPropOld.strokecolor=r,n.visPropOld.strokeopacity=C)},setObjectStrokeWidth:function(n,t){var o,r=JXG$1.evaluate(t);isNaN(r)||n.visPropOld.strokewidth===r||(o=n.rendNode,this.setPropertyPrim(o,"stroked","true"),JXG$1.exists(r)&&this.setPropertyPrim(o,"stroke-width",r+"px"),n.visPropOld.strokewidth=r)},setLineCap:function(n){var t=JXG$1.evaluate(n.visProp.linecap);t===void 0||t===""||n.visPropOld.linecap===t||!JXG$1.exists(n.rendNode)||(this.setPropertyPrim(n.rendNode,"stroke-linecap",t),n.visPropOld.linecap=t)},setShadow:function(n){var t=JXG$1.evaluate(n.visProp.shadow),o,r,u,d,C,I,f,A,G=!0,B=!1;o=JSON.stringify(t),o!==n.visPropOld.shadow&&(typeof t=="boolean"?(G=!0,B=t,r="none",u=3,d=.1,C=[5,5],I=1):JXG$1.evaluate(t.enabled)?(G=!1,B=!0,r=JXG$1.rgbParser(JXG$1.evaluate(t.color)),u=JXG$1.evaluate(t.blur),d=JXG$1.evaluate(t.blend),C=JXG$1.evaluate(t.offset),I=JXG$1.evaluate(t.opacity)):B=!1,JXG$1.exists(n.rendNode)&&(B?G?n.rendNode.setAttributeNS(null,"filter",this.toURL(this.container.id+"_f1")):(A=this.container.ownerDocument.getElementById(f),A&&this.defs.removeChild(A),f=n.rendNode.id+"_f1",this.defs.appendChild(this.createShadowFilter(f,r,I,d,u,C)),n.rendNode.setAttributeNS(null,"filter",this.toURL(f))):n.rendNode.removeAttributeNS(null,"filter")),n.visPropOld.shadow=o)},suspendRedraw:function(){this.suspendHandle=this.svgRoot.suspendRedraw(1e4)},unsuspendRedraw:function(){this.svgRoot.unsuspendRedraw(this.suspendHandle)},resize:function(n,t){this.svgRoot.setAttribute("width",parseFloat(n)),this.svgRoot.setAttribute("height",parseFloat(t))},createTouchpoints:function(n){var t,o,r,u;for(this.touchpoints=[],t=0;t<n;t++)o="touchpoint1_"+t,u=this.createPrim("path",o),this.appendChildPrim(u,19),u.setAttributeNS(null,"d","M 0 0"),this.touchpoints.push(u),this.setPropertyPrim(u,"stroked","true"),this.setPropertyPrim(u,"stroke-width","1px"),u.setAttributeNS(null,"stroke","#000000"),u.setAttributeNS(null,"stroke-opacity",1),u.setAttributeNS(null,"display","none"),r="touchpoint2_"+t,u=this.createPrim("ellipse",r),this.appendChildPrim(u,19),this.updateEllipsePrim(u,0,0,0,0),this.touchpoints.push(u),this.setPropertyPrim(u,"stroked","true"),this.setPropertyPrim(u,"stroke-width","1px"),u.setAttributeNS(null,"stroke","#000000"),u.setAttributeNS(null,"stroke-opacity",1),u.setAttributeNS(null,"fill","#ffffff"),u.setAttributeNS(null,"fill-opacity",0),u.setAttributeNS(null,"display","none")},showTouchpoint:function(n){this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(this.touchpoints[2*n].setAttributeNS(null,"display","inline"),this.touchpoints[2*n+1].setAttributeNS(null,"display","inline"))},hideTouchpoint:function(n){this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(this.touchpoints[2*n].setAttributeNS(null,"display","none"),this.touchpoints[2*n+1].setAttributeNS(null,"display","none"))},updateTouchpoint:function(n,t){var o,r,u=37;this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(o=t[0],r=t[1],this.touchpoints[2*n].setAttributeNS(null,"d","M "+(o-u)+" "+r+" L "+(o+u)+" "+r+" M "+o+" "+(r-u)+" L "+o+" "+(r+u)),this.updateEllipsePrim(this.touchpoints[2*n+1],t[0],t[1],25,25))},_getValuesOfDOMElements:function(n){var t=[];if(n.nodeType===1)for(n=n.firstChild;n;)n.id!==void 0&&n.value!==void 0&&t.push([n.id,n.value]),JXG$1.concat(t,this._getValuesOfDOMElements(n)),n=n.nextSibling;return t},_getImgDataURL:function(n){var t,o,r,u,d,C;if(t=n.getElementsByTagName("image"),o=t.length,o>0)for(r=document.createElement("canvas"),C=0;C<o;C++){t[C].setAttribute("crossorigin","anonymous"),u=r.getContext("2d"),r.width=t[C].getAttribute("width"),r.height=t[C].getAttribute("height");try{u.drawImage(t[C],0,0,r.width,r.height),d=r.toDataURL(),t[C].setAttribute("xlink:href",d)}catch(I){console.log("CORS problem! Image can not be used",I)}}return!0},dumpToDataURI:function(n){var t=this.svgRoot,o=window.btoa||Base64.encode,r,u,d,C=[];if(this.container.hasChildNodes()&&JXG$1.exists(this.foreignObjLayer))for(n||this.foreignObjLayer.setAttribute("display","inline");t.nextSibling;)JXG$1.concat(C,this._getValuesOfDOMElements(t.nextSibling)),this.foreignObjLayer.appendChild(t.nextSibling);if(this._getImgDataURL(t),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),r=new XMLSerializer().serializeToString(t),n!==!0)for(d=C.length,u=0;u<d;u++)r=r.replace('id="'+C[u][0]+'"','id="'+C[u][0]+'" value="'+C[u][1]+'"');if(this.isIE&&(r.match(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g)||[]).length>1&&(r=r.replace(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g,"")),r=r.replace(/&nbsp;/g," "),r=r.replace(/url\(&quot;(.*)&quot;\)/g,"url($1)"),JXG$1.exists(this.foreignObjLayer)&&this.foreignObjLayer.hasChildNodes()){for(;this.foreignObjLayer.firstChild;)this.container.appendChild(this.foreignObjLayer.firstChild);this.foreignObjLayer.setAttribute("display","none")}return"data:image/svg+xml;base64,"+o(unescape(encodeURIComponent(r)))},dumpToCanvas:function(n,t,o,r){var u,d,C,I,f=this.container.ownerDocument;return C=f.getElementById(n),C.width=C.width,I=C.getContext("2d"),t!==void 0&&o!==void 0&&(C.style.width=parseFloat(t)+"px",C.style.height=parseFloat(o)+"px",C.setAttribute("width",parseFloat(t)),C.setAttribute("height",parseFloat(o))),d=new Image,u=this.dumpToDataURI(r),d.src=u,"Promise"in window?new Promise(function(A,G){try{d.onload=function(){I.drawImage(d,0,0,t,o),A()}}catch(B){G(B)}}):(d.onload=function(){window.setTimeout(function(){try{I.drawImage(d,0,0,t,o)}catch{console.log("screenshots not longer supported on IE")}},200)},this)},screenshot:function(n,t,o){var r,u=this.container.ownerDocument,d=this.container.parentNode,C,I,f,A,G,B,Z,w=n.attr.screenshot,V,Y,J,T=!1,L;return this.type==="no"?this:(B=w.scale*this.container.getBoundingClientRect().width,Z=w.scale*this.container.getBoundingClientRect().height,t===void 0||t===""?(T=!0,f=new Image,f.style.width=B+"px",f.style.height=Z+"px"):(T=!1,f=u.getElementById(t)),T&&(r=u.createElement("div"),r.style.cssText=w.css,r.style.width=B+"px",r.style.height=Z+"px",r.style.zIndex=this.container.style.zIndex+120,r.style.position="absolute",r.style.top=this.container.offsetTop+"px",r.style.left=this.container.offsetLeft+"px"),C=u.createElement("canvas"),I=Math.random().toString(36).slice(2,7),C.setAttribute("id",I),C.setAttribute("width",B),C.setAttribute("height",Z),C.style.width=B+"px",C.style.height=B+"px",C.style.display="none",d.appendChild(C),T&&(A=u.createElement("span"),G=u.createTextNode(""),A.style.cssText=w.cssButton,A.appendChild(G),A.onclick=function(){r.parentNode.removeChild(r)},r.appendChild(f),r.appendChild(A),d.insertBefore(r,this.container.nextSibling)),V=u.getElementById(this.uniqName("navigationbar")),JXG$1.exists(V)&&(Y=V.style.display,V.style.display="none",J=this.removeToInsertLater(V)),L=function(){f.src=C.toDataURL("image/png"),d.removeChild(C)},"Promise"in window?this.dumpToCanvas(I,B,Z,o).then(L):(this.dumpToCanvas(I,B,Z,o),window.setTimeout(L,200)),JXG$1.exists(V)&&(V.style.display=Y,J()),this)}});const SVGRenderer=JXG$1.SVGRenderer;JXG$1.VMLRenderer=function(n){this.type="vml",this.container=n,this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.onselectstart=function(){return!1},this.resolution=10,JXG$1.exists(JXG$1.vmlStylesheet)||(n.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),JXG$1.vmlStylesheet=this.container.ownerDocument.createStyleSheet(),JXG$1.vmlStylesheet.addRule(".jxgvml","behavior:url(#default#VML)"));try{n.ownerDocument.namespaces.jxgvml||n.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),this.createNode=function(t){return n.ownerDocument.createElement("<jxgvml:"+t+' class="jxgvml">')}}catch{this.createNode=function(o){return n.ownerDocument.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="jxgvml">')}}this.dashArray=["Solid","1 1","ShortDash","Dash","LongDash","ShortDashDot","LongDashDot"]};JXG$1.VMLRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.VMLRenderer.prototype,{_setAttr:function(n,t,o,r){try{this.container.ownerDocument.documentMode===8?n[t]=o:n.setAttribute(t,o,r)}catch{JXG$1.debug("_setAttr: "+t+" "+o+`<br>
`)}},updateTicks:function(n){var t,o,r,u,d,C=this.resolution,I=[];for(o=n.ticks.length,t=0;t<o;t++)r=n.ticks[t],u=r[0],d=r[1],JXG$1.isNumber(u[0])&&JXG$1.isNumber(u[1])&&I.push(" m "+Math.round(C*u[0])+", "+Math.round(C*d[0])+" l "+Math.round(C*u[1])+", "+Math.round(C*d[1])+" ");JXG$1.exists(n.rendNode)||(n.rendNode=this.createPrim("path",n.id),this.appendChildPrim(n.rendNode,JXG$1.evaluate(n.visProp.layer))),this._setAttr(n.rendNode,"stroked","true"),this._setAttr(n.rendNode,"strokecolor",JXG$1.evaluate(n.visProp.strokecolor),1),this._setAttr(n.rendNode,"strokeweight",JXG$1.evaluate(n.visProp.strokewidth)),this._setAttr(n.rendNodeStroke,"opacity",JXG$1.evaluate(n.visProp.strokeopacity)*100+"%"),this.updatePathPrim(n.rendNode,I,n.board)},displayCopyright:function(n,t){var o,r;o=this.createNode("textbox"),o.style.position="absolute",this._setAttr(o,"id",this.container.id+"_licenseText"),o.style.left=20,o.style.top=2,o.style.fontSize=t,o.style.color="#356AA0",o.style.fontFamily="Arial,Helvetica,sans-serif",this._setAttr(o,"opacity","30%"),o.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 30, enabled = true)",r=this.container.ownerDocument.createTextNode(n),o.appendChild(r),this.appendChildPrim(o,0)},drawInternalText:function(n){var t;return t=this.createNode("textbox"),t.style.position="absolute",n.rendNodeText=this.container.ownerDocument.createTextNode(""),t.appendChild(n.rendNodeText),this.appendChildPrim(t,9),t.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",t},updateInternalText:function(n){var t,o=n.plaintext,r=this.joinTransforms(n,n.transformations),u=[0,0],d,C,I,f,A,G=n.rendNode,B=[],Z=n.getAnchorX(),w=n.getAnchorY();if(!isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])){for(Z==="right"?u[0]=1:Z==="middle"&&(u[0]=.5),w==="bottom"?u[1]=1:w==="middle"&&(u[1]=.5),B[0]=Mat.matVecMult(r,[1,n.coords.scrCoords[1]-u[0]*n.size[0],n.coords.scrCoords[2]+(1-u[1])*n.size[1]+this.vOffsetText]),B[0][1]/=B[0][0],B[0][2]/=B[0][0],B[1]=Mat.matVecMult(r,[1,n.coords.scrCoords[1]+(1-u[0])*n.size[0],n.coords.scrCoords[2]+(1-u[1])*n.size[1]+this.vOffsetText]),B[1][1]/=B[1][0],B[1][2]/=B[1][0],B[2]=Mat.matVecMult(r,[1,n.coords.scrCoords[1]+(1-u[0])*n.size[0],n.coords.scrCoords[2]-u[1]*n.size[1]+this.vOffsetText]),B[2][1]/=B[2][0],B[2][2]/=B[2][0],B[3]=Mat.matVecMult(r,[1,n.coords.scrCoords[1]-u[0]*n.size[0],n.coords.scrCoords[2]-u[1]*n.size[1]+this.vOffsetText]),B[3][1]/=B[3][0],B[3][2]/=B[3][0],d=B[0][1],I=B[0][1],C=B[0][2],f=B[0][2],A=1;A<4;A++)d=Math.max(d,B[A][1]),I=Math.min(I,B[A][1]),C=Math.max(C,B[A][2]),f=Math.min(f,B[A][2]);t=u[0]===1?Math.floor(n.board.canvasWidth-d):Math.floor(I),n.visPropOld.left!==Z+t&&(u[0]===1?(n.rendNode.style.right=t+"px",n.rendNode.style.left="auto"):(n.rendNode.style.left=t+"px",n.rendNode.style.right="auto"),n.visPropOld.left=Z+t),t=u[1]===1?Math.floor(n.board.canvasHeight-C):Math.floor(f),n.visPropOld.top!==w+t&&(u[1]===1?(n.rendNode.style.bottom=t+"px",n.rendNode.style.top="auto"):(n.rendNode.style.top=t+"px",n.rendNode.style.bottom="auto"),n.visPropOld.top=w+t)}n.htmlStr!==o&&(n.rendNodeText.data=o,n.htmlStr=o),G.filters.item(0).M11=r[1][1],G.filters.item(0).M12=r[1][2],G.filters.item(0).M21=r[2][1],G.filters.item(0).M22=r[2][2],G.filters.item(0).enabled=!0},drawImage:function(n){var t;t=this.container.ownerDocument.createElement("img"),t.style.position="absolute",this._setAttr(t,"id",this.container.id+"_"+n.id),this.container.appendChild(t),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),t.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand') progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",n.rendNode=t,this.updateImage(n)},transformImage:function(n,t){var o,r,u,d,C,I,f=n.rendNode,A=[],G=t.length;if(G>0){for(o=this.joinTransforms(n,t),A[0]=Mat.matVecMult(o,n.coords.scrCoords),A[0][1]/=A[0][0],A[0][2]/=A[0][0],A[1]=Mat.matVecMult(o,[1,n.coords.scrCoords[1]+n.size[0],n.coords.scrCoords[2]]),A[1][1]/=A[1][0],A[1][2]/=A[1][0],A[2]=Mat.matVecMult(o,[1,n.coords.scrCoords[1]+n.size[0],n.coords.scrCoords[2]-n.size[1]]),A[2][1]/=A[2][0],A[2][2]/=A[2][0],A[3]=Mat.matVecMult(o,[1,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1]]),A[3][1]/=A[3][0],A[3][2]/=A[3][0],r=A[0][1],d=A[0][1],u=A[0][2],C=A[0][2],I=1;I<4;I++)r=Math.max(r,A[I][1]),d=Math.min(d,A[I][1]),u=Math.max(u,A[I][2]),C=Math.min(C,A[I][2]);f.style.left=Math.floor(d)+"px",f.style.top=Math.floor(C)+"px",f.filters.item(0).M11=o[1][1],f.filters.item(0).M12=o[1][2],f.filters.item(0).M21=o[2][1],f.filters.item(0).M22=o[2][2],f.filters.item(0).enabled=!0}},updateImageURL:function(n){var t=JXG$1.evaluate(n.url);this._setAttr(n.rendNode,"src",t)},appendChildPrim:function(n,t){return JXG$1.exists(t)||(t=0),n.style.zIndex=t,this.container.appendChild(n),n},appendNodesToElement:function(n,t){(t==="shape"||t==="path"||t==="polygon")&&(n.rendNodePath=this.getElementById(n.id+"_path")),n.rendNodeFill=this.getElementById(n.id+"_fill"),n.rendNodeStroke=this.getElementById(n.id+"_stroke"),n.rendNodeShadow=this.getElementById(n.id+"_shadow"),n.rendNode=this.getElementById(n.id)},createPrim:function(n,t){var o,r,u=this.createNode("fill"),d=this.createNode("stroke"),C=this.createNode("shadow");return this._setAttr(u,"id",this.container.id+"_"+t+"_fill"),this._setAttr(d,"id",this.container.id+"_"+t+"_stroke"),this._setAttr(C,"id",this.container.id+"_"+t+"_shadow"),n==="circle"||n==="ellipse"?(o=this.createNode("oval"),o.appendChild(u),o.appendChild(d),o.appendChild(C)):n==="polygon"||n==="path"||n==="shape"||n==="line"?(o=this.createNode("shape"),o.appendChild(u),o.appendChild(d),o.appendChild(C),r=this.createNode("path"),this._setAttr(r,"id",this.container.id+"_"+t+"_path"),o.appendChild(r)):(o=this.createNode(n),o.appendChild(u),o.appendChild(d),o.appendChild(C)),o.style.position="absolute",o.style.left="0px",o.style.top="0px",this._setAttr(o,"id",this.container.id+"_"+t),o},remove:function(n){JXG$1.exists(n)&&n.removeNode(!0)},makeArrows:function(n){var t,o=JXG$1.evaluate(n.visProp.firstarrow),r=JXG$1.evaluate(n.visProp.lastarrow);n.visPropOld.firstarrow===o&&n.visPropOld.lastarrow===r||(o?(t=n.rendNodeStroke,this._setAttr(t,"startarrow","block"),this._setAttr(t,"startarrowlength","long")):(t=n.rendNodeStroke,JXG$1.exists(t)&&this._setAttr(t,"startarrow","none")),r?(t=n.rendNodeStroke,this._setAttr(t,"id",this.container.id+"_"+n.id+"stroke"),this._setAttr(t,"endarrow","block"),this._setAttr(t,"endarrowlength","long")):(t=n.rendNodeStroke,JXG$1.exists(t)&&this._setAttr(t,"endarrow","none")),n.visPropOld.firstarrow=o,n.visPropOld.lastarrow=r)},updateEllipsePrim:function(n,t,o,r,u){n.style.left=Math.floor(t-r)+"px",n.style.top=Math.floor(o-u)+"px",n.style.width=Math.floor(Math.abs(r)*2)+"px",n.style.height=Math.floor(Math.abs(u)*2)+"px"},updateLinePrim:function(n,t,o,r,u,d){var C,I=this.resolution;isNaN(t+o+r+u)||(C=["m ",Math.floor(I*t),", ",Math.floor(I*o)," l ",Math.floor(I*r),", ",Math.floor(I*u)],this.updatePathPrim(n,C,d))},updatePathPrim:function(n,t,o){var r=o.canvasWidth,u=o.canvasHeight;t.length<=0&&(t=["m 0,0"]),n.style.width=r,n.style.height=u,this._setAttr(n,"coordsize",[Math.floor(this.resolution*r),Math.floor(this.resolution*u)].join(",")),this._setAttr(n,"path",t.join(""))},updatePathStringPoint:function(n,t,o){var r=[],u=Math.round,d=n.coords.scrCoords,C=t*Math.sqrt(3)*.5,I=t*.5,f=this.resolution;return o==="x"?r.push([" m ",u(f*(d[1]-t)),", ",u(f*(d[2]-t))," l ",u(f*(d[1]+t)),", ",u(f*(d[2]+t))," m ",u(f*(d[1]+t)),", ",u(f*(d[2]-t))," l ",u(f*(d[1]-t)),", ",u(f*(d[2]+t))].join("")):o==="+"?r.push([" m ",u(f*(d[1]-t)),", ",u(f*d[2])," l ",u(f*(d[1]+t)),", ",u(f*d[2])," m ",u(f*d[1]),", ",u(f*(d[2]-t))," l ",u(f*d[1]),", ",u(f*(d[2]+t))].join("")):o==="<>"||o==="<<>>"?(o==="<<>>"&&(t*=1.41),r.push([" m ",u(f*(d[1]-t)),", ",u(f*d[2])," l ",u(f*d[1]),", ",u(f*(d[2]+t))," l ",u(f*(d[1]+t)),", ",u(f*d[2])," l ",u(f*d[1]),", ",u(f*(d[2]-t))," x e "].join(""))):o==="^"?r.push([" m ",u(f*d[1]),", ",u(f*(d[2]-t))," l ",u(f*(d[1]-C)),", ",u(f*(d[2]+I))," l ",u(f*(d[1]+C)),", ",u(f*(d[2]+I))," x e "].join("")):o==="v"?r.push([" m ",u(f*d[1]),", ",u(f*(d[2]+t))," l ",u(f*(d[1]-C)),", ",u(f*(d[2]-I))," l ",u(f*(d[1]+C)),", ",u(f*(d[2]-I))," x e "].join("")):o===">"?r.push([" m ",u(f*(d[1]+t)),", ",u(f*d[2])," l ",u(f*(d[1]-I)),", ",u(f*(d[2]-C))," l ",u(f*(d[1]-I)),", ",u(f*(d[2]+C))," l ",u(f*(d[1]+t)),", ",u(f*d[2])].join("")):o==="<"&&r.push([" m ",u(f*(d[1]-t)),", ",u(f*d[2])," l ",u(f*(d[1]+I)),", ",u(f*(d[2]-C))," l ",u(f*(d[1]+I)),", ",u(f*(d[2]+C))," x e "].join("")),r},updatePathStringPrim:function(n){var t,o,r=[],u=this.resolution,d=Math.round,C=" m ",I=" l ",f=" c ",A=C,G=Math.min(n.numberPoints,8192);if(n.numberPoints<=0)return"";if(G=Math.min(G,n.points.length),n.bezierDegree===1)for(t=0;t<G;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?A=C:(o[1]>2e4?o[1]=2e4:o[1]<-2e4&&(o[1]=-2e4),o[2]>2e4?o[2]=2e4:o[2]<-2e4&&(o[2]=-2e4),r.push([A,d(u*o[1]),", ",d(u*o[2])].join("")),A=I);else if(n.bezierDegree===3)for(t=0;t<G;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?A=C:(r.push([A,d(u*o[1]),", ",d(u*o[2])].join("")),A===f&&(t+=1,o=n.points[t].scrCoords,r.push([" ",d(u*o[1]),", ",d(u*o[2])].join("")),t+=1,o=n.points[t].scrCoords,r.push([" ",d(u*o[1]),", ",d(u*o[2])].join(""))),A=f),t+=1;return r.push(" e"),r},updatePathStringBezierPrim:function(n){var t,o,r,u,d,C,I=[],f=JXG$1.evaluate(n.visProp.strokewidth),A=this.resolution,G=Math.round,B=" m ",Z=" c ",w=B,V=JXG$1.evaluate(n.visProp.curvetype)!=="plot",Y=Math.min(n.numberPoints,8192);if(n.numberPoints<=0)return"";for(V&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,1)),Y=Math.min(Y,n.points.length),o=1;o<3;o++)for(w=B,t=0;t<Y;t++)u=n.points[t].scrCoords,isNaN(u[1])||isNaN(u[2])?w=B:(u[1]>2e4?u[1]=2e4:u[1]<-2e4&&(u[1]=-2e4),u[2]>2e4?u[2]=2e4:u[2]<-2e4&&(u[2]=-2e4),w===B?I.push([w,G(A*u[1])," ",G(A*u[2])].join("")):(r=2*o,I.push([w,G(A*(d+(u[1]-d)*.333+f*(r*Math.random()-o)))," ",G(A*(C+(u[2]-C)*.333+f*(r*Math.random()-o)))," ",G(A*(d+(u[1]-d)*.666+f*(r*Math.random()-o)))," ",G(A*(C+(u[2]-C)*.666+f*(r*Math.random()-o)))," ",G(A*u[1])," ",G(A*u[2])].join(""))),w=Z,d=u[1],C=u[2]);return I.push(" e"),I},updatePolygonPrim:function(n,t){var o,r=t.vertices.length,u=this.resolution,d,C=[];if(this._setAttr(n,"stroked","false"),d=t.vertices[0].coords.scrCoords,!isNaN(d[1]+d[2])){for(C.push(["m ",Math.floor(u*d[1]),",",Math.floor(u*d[2])," l "].join("")),o=1;o<r-1;o++){if(t.vertices[o].isReal){if(d=t.vertices[o].coords.scrCoords,isNaN(d[1]+d[2]))return;C.push(Math.floor(u*d[1])+","+Math.floor(u*d[2]))}else{this.updatePathPrim(n,"",t.board);return}o<r-2&&C.push(", ")}C.push(" x e"),this.updatePathPrim(n,C,t.board)}},updateRectPrim:function(n,t,o,r,u){n.style.left=Math.floor(t)+"px",n.style.top=Math.floor(o)+"px",r>=0&&(n.style.width=r+"px"),u>=0&&(n.style.height=u+"px")},setPropertyPrim:function(n,t,o){var r="",u;switch(t){case"stroke":r="strokecolor";break;case"stroke-width":r="strokeweight";break;case"stroke-dasharray":r="dashstyle";break}r!==""&&(u=JXG$1.evaluate(o),this._setAttr(n,r,u))},display:function(n,t){n&&n.rendNode&&(n.visPropOld.visible=t,t?n.rendNode.style.visibility="inherit":n.rendNode.style.visibility="hidden")},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),n&&n.rendNode&&(n.rendNode.style.visibility="inherit")},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),n&&n.rendNode&&(n.rendNode.style.visibility="hidden")},setDashStyle:function(n,t){var o;t.dash>=0&&(o=n.rendNodeStroke,this._setAttr(o,"dashstyle",this.dashArray[t.dash]))},setGradient:function(n){var t=n.rendNodeFill,o=JXG$1.evaluate(n.visProp.gradient);o==="linear"?(this._setAttr(t,"type","gradient"),this._setAttr(t,"color2",JXG$1.evaluate(n.visProp.gradientsecondcolor)),this._setAttr(t,"opacity2",JXG$1.evaluate(n.visProp.gradientsecondopacity)),this._setAttr(t,"angle",JXG$1.evaluate(n.visProp.gradientangle))):o==="radial"?(this._setAttr(t,"type","gradientradial"),this._setAttr(t,"color2",JXG$1.evaluate(n.visProp.gradientsecondcolor)),this._setAttr(t,"opacity2",JXG$1.evaluate(n.visProp.gradientsecondopacity)),this._setAttr(t,"focusposition",JXG$1.evaluate(n.visProp.gradientpositionx)*100+"%,"+JXG$1.evaluate(n.visProp.gradientpositiony)*100+"%"),this._setAttr(t,"focussize","0,0")):this._setAttr(t,"type","solid")},setObjectFillColor:function(n,t,o){var r=JXG$1.evaluate(t),u,d,C=JXG$1.evaluate(o),I,f=n.rendNode;C=C>0?C:0,!(n.visPropOld.fillcolor===r&&n.visPropOld.fillopacity===C)&&(JXG$1.exists(r)&&r!==!1&&(r.length!==9?(u=r,I=C):(d=JXG$1.rgba2rgbo(r),u=d[0],I=C*d[1]),u==="none"||u===!1?this._setAttr(n.rendNode,"filled","false"):(this._setAttr(n.rendNode,"filled","true"),this._setAttr(n.rendNode,"fillcolor",u),JXG$1.exists(I)&&n.rendNodeFill&&this._setAttr(n.rendNodeFill,"opacity",I*100+"%")),n.type===Const.OBJECT_TYPE_IMAGE&&f.filters.length>1&&(f.filters.item(1).opacity=Math.round(I*100),f.filters.item(1).enabled=!0)),n.visPropOld.fillcolor=r,n.visPropOld.fillopacity=C)},setObjectStrokeColor:function(n,t,o){var r=JXG$1.evaluate(t),u,d,C=JXG$1.evaluate(o),I,f=n.rendNode,A;C=C>0?C:0,!(n.visPropOld.strokecolor===r&&n.visPropOld.strokeopacity===C)&&(JXG$1.exists(r)&&r!==!1&&(r.length!==9?(u=r,I=C):(d=t.rgba2rgbo(r),u=d[0],I=C*d[1]),n.elementClass===Const.OBJECT_CLASS_TEXT?(f.filters.length>1&&(f.filters.item(1).opacity=Math.round(I*100),f.filters.item(1).enabled=!0),f.style.color=u):(u!==!1&&(this._setAttr(f,"stroked","true"),this._setAttr(f,"strokecolor",u)),A=n.rendNodeStroke,JXG$1.exists(I)&&n.type!==Const.OBJECT_TYPE_IMAGE&&this._setAttr(A,"opacity",I*100+"%"))),n.visPropOld.strokecolor=r,n.visPropOld.strokeopacity=C)},setObjectStrokeWidth:function(n,t){var o=JXG$1.evaluate(t),r;isNaN(o)||n.visPropOld.strokewidth===o||(r=n.rendNode,this.setPropertyPrim(r,"stroked","true"),JXG$1.exists(o)&&(this.setPropertyPrim(r,"stroke-width",o),o===0&&JXG$1.exists(n.rendNodeStroke)&&this._setAttr(r,"stroked","false")),n.visPropOld.strokewidth=o)},setShadow:function(n){var t=n.rendNodeShadow,o=JXG$1.evaluate(n.visProp.shadow);!t||n.visPropOld.shadow===o||(o?(this._setAttr(t,"On","True"),this._setAttr(t,"Offset","3pt,3pt"),this._setAttr(t,"Opacity","60%"),this._setAttr(t,"Color","#aaaaaa")):this._setAttr(t,"On","False"),n.visPropOld.shadow=o)},suspendRedraw:function(){this.container.style.display="none"},unsuspendRedraw:function(){this.container.style.display=""}});const VMLRenderer=JXG$1.VMLRenderer;var uuidCharsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",uuidChars=uuidCharsStr.split("");JXG$1.Util=JXG$1.Util||{};JXG$1.Util.genUUID=function(n){var t,o,r=[],u=0;for(n=n||"",n!==""&&n.slice(n.length-1)!=="-"&&(n=n+"-"),o=0;o<36;o++)o===8||o===13||o===18||o===23?r[o]="-":o===14?r[o]="4":(u<=2&&(u=33554432+Math.random()*16777216|0),t=u&15,u=u>>4,r[o]=uuidChars[o===19?t&3|8:t]);return n+r.join("")};const UUID=JXG$1.Util;JXG$1.CanvasRenderer=function(n,t){if(this.type="canvas",this.canvasRoot=null,this.suspendHandle=null,this.canvasId=UUID.genUUID(),this.canvasNamespace=null,JXG$1.isBrowser)this.container=n,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.innerHTML=['<canvas id="',this.canvasId,'" width="',t.width,'px" height="',t.height,'px"></canvas>'].join(""),this.canvasRoot=this.container.ownerDocument.getElementById(this.canvasId),this.canvasRoot.style.display="block",this.context=this.canvasRoot.getContext("2d");else if(JXG$1.isNode())try{this.canvasRoot=JXG$1.createCanvas(500,500),this.context=this.canvasRoot.getContext("2d")}catch{throw new Error(`JXG.createCanvas not available.
Install the npm package \`canvas\`
and call:
    import { createCanvas } from "canvas.js";
    JXG.createCanvas = createCanvas;
`)}};JXG$1.CanvasRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.CanvasRenderer.prototype,{_drawPolygon:function(n,t,o){var r,u=n.length,d=this.context;if(u>0){if(o&&(d.lineWidth=0),d.beginPath(),d.moveTo(n[0][0],n[0][1]),t===1)for(r=1;r<u;r++)d.lineTo(n[r][0],n[r][1]);else for(r=1;r<u;r+=3)d.bezierCurveTo(n[r][0],n[r][1],n[r+1][0],n[r+1][1],n[r+2][0],n[r+2][1]);o?(d.lineTo(n[0][0],n[0][1]),d.closePath(),d.fill("evenodd")):d.stroke()}},_fill:function(n){var t=this.context;t.save(),this._setColor(n,"fill")&&t.fill("evenodd"),t.restore()},_rotatePoint:function(n,t,o){return[t*Math.cos(n)-o*Math.sin(n),t*Math.sin(n)+o*Math.cos(n)]},_rotateShape:function(n,t){var o,r=[],u=n.length;if(u<=0)return n;for(o=0;o<u;o++)r.push(this._rotatePoint(t,n[o][0],n[o][1]));return r},updateGradientAngle:function(n,t){var o=1,r=Math.cos(-t),u=Math.sin(-t),d=n.getBoundingBox(),C,I,f,A,G,B,Z,w,V,Y,J,T;return Math.abs(r)>Math.abs(u)?o/=Math.abs(r):o/=Math.abs(u),r>=0?(f=0,A=r*o):(f=-r*o,A=0),u>=0?(G=0,B=u*o):(G=-u*o,B=0),C=new Coords(Const.COORDS_BY_USER,[d[0],d[1]],n.board),I=new Coords(Const.COORDS_BY_USER,[d[2],d[3]],n.board),J=I.scrCoords[1]-C.scrCoords[1],T=I.scrCoords[2]-C.scrCoords[2],Z=C.scrCoords[1]+J*f,V=C.scrCoords[2]+T*G,w=C.scrCoords[1]+J*A,Y=C.scrCoords[2]+T*B,this.context.createLinearGradient(Z,V,w,Y)},updateGradientCircle:function(n,t,o,r,u,d,C){var I=n.getBoundingBox(),f,A,G,B,Z,w,V,Y,J,T;return f=new Coords(Const.COORDS_BY_USER,[I[0],I[1]],n.board),A=new Coords(Const.COORDS_BY_USER,[I[2],I[3]],n.board),J=A.scrCoords[1]-f.scrCoords[1],T=f.scrCoords[2]-A.scrCoords[2],G=f.scrCoords[1]+J*t,B=A.scrCoords[2]+T*o,w=f.scrCoords[1]+J*u,V=A.scrCoords[2]+T*d,Z=r*(J+T)*.5,Y=C*(J+T)*.5,this.context.createRadialGradient(w,V,Y,G,B,Z)},updateGradient:function(n){var t,o=JXG$1.evaluate(n.visProp.gradient),r;return t=JXG$1.evaluate(n.visProp.fillcolor),o==="linear"?r=this.updateGradientAngle(n,JXG$1.evaluate(n.visProp.gradientangle)):o==="radial"&&(r=this.updateGradientCircle(n,JXG$1.evaluate(n.visProp.gradientcx),JXG$1.evaluate(n.visProp.gradientcy),JXG$1.evaluate(n.visProp.gradientr),JXG$1.evaluate(n.visProp.gradientfx),JXG$1.evaluate(n.visProp.gradientfy),JXG$1.evaluate(n.visProp.gradientfr))),r.addColorStop(JXG$1.evaluate(n.visProp.gradientstartoffset),t),r.addColorStop(JXG$1.evaluate(n.visProp.gradientendoffset),JXG$1.evaluate(n.visProp.gradientsecondcolor)),r},_setColor:function(n,t,o){var r=!0,u=n.visProp,d,C,I,f,A,G,B,Z;return t=t||"stroke",o=o||t,d=this._getHighlighted(n),Z=JXG$1.evaluate(n.visProp.gradient),Z==="linear"||Z==="radial"?(this.context[o+"Style"]=this.updateGradient(n),r):(I=JXG$1.evaluate(u[d+t+"color"]),I!=="none"&&I!==!1?(G=JXG$1.evaluate(u[d+t+"opacity"]),G=G>0?G:0,I.length!==9?(A=I,B=G):(f=JXG$1.rgba2rgbo(I),A=f[0],B=G*f[1]),this.context.globalAlpha=B,this.context[o+"Style"]=A):r=!1,C=parseFloat(JXG$1.evaluate(u[d+"strokewidth"])),t==="stroke"&&!isNaN(C)&&(C===0?this.context.globalAlpha=0:this.context.lineWidth=C),t==="stroke"&&u.linecap!==void 0&&u.linecap!==""&&(this.context.lineCap=u.linecap),r)},_stroke:function(n){var t=this.context,o=JXG$1.evaluate(n.visProp.dash),r=JXG$1.evaluate(n.visProp.dashscale),u=r?.5*JXG$1.evaluate(n.visProp.strokewidth):1;t.save(),o>0?t.setLineDash&&t.setLineDash(this.dashArray[o-1].map(function(d){return d*u})):this.context.lineDashArray=[],this._setColor(n,"stroke")&&t.stroke(),t.restore()},_translateShape:function(n,t,o){var r,u=[],d=n.length;if(d<=0)return n;for(r=0;r<d;r++)u.push([n[r][0]+t,n[r][1]+o]);return u},drawPoint:function(n){var t=JXG$1.evaluate(n.visProp.face),o=JXG$1.evaluate(n.visProp.size),r=n.coords.scrCoords,u=o*Math.sqrt(3)*.5,d=o*.5,C=parseFloat(JXG$1.evaluate(n.visProp.strokewidth))/2,I=this.context;if(n.visPropCalc.visible)switch(t){case"cross":case"x":I.beginPath(),I.moveTo(r[1]-o,r[2]-o),I.lineTo(r[1]+o,r[2]+o),I.moveTo(r[1]+o,r[2]-o),I.lineTo(r[1]-o,r[2]+o),I.lineCap="round",I.lineJoin="round",I.closePath(),this._stroke(n);break;case"circle":case"o":I.beginPath(),I.arc(r[1],r[2],o+1+C,0,2*Math.PI,!1),I.closePath(),this._fill(n),this._stroke(n);break;case"square":case"[]":if(o<=0)break;I.save(),this._setColor(n,"stroke","fill")&&I.fillRect(r[1]-o-C,r[2]-o-C,o*2+3*C,o*2+3*C),I.restore(),I.save(),this._setColor(n,"fill"),I.fillRect(r[1]-o+C,r[2]-o+C,o*2-C,o*2-C),I.restore();break;case"plus":case"+":I.beginPath(),I.moveTo(r[1]-o,r[2]),I.lineTo(r[1]+o,r[2]),I.moveTo(r[1],r[2]-o),I.lineTo(r[1],r[2]+o),I.lineCap="round",I.lineJoin="round",I.closePath(),this._stroke(n);break;case"divide":case"|":I.beginPath(),I.moveTo(r[1],r[2]-o),I.lineTo(r[1],r[2]+o),I.lineCap="round",I.lineJoin="round",I.closePath(),this._stroke(n);break;case"minus":case"-":I.beginPath(),I.moveTo(r[1]-o,r[2]),I.lineTo(r[1]+o,r[2]),I.lineCap="round",I.lineJoin="round",I.closePath(),this._stroke(n);break;case"diamond2":case"<<>>":o*=1.41;case"diamond":case"<>":I.beginPath(),I.moveTo(r[1]-o,r[2]),I.lineTo(r[1],r[2]+o),I.lineTo(r[1]+o,r[2]),I.lineTo(r[1],r[2]-o),I.closePath(),this._fill(n),this._stroke(n);break;case"triangleup":case"A":case"a":case"^":I.beginPath(),I.moveTo(r[1],r[2]-o),I.lineTo(r[1]-u,r[2]+d),I.lineTo(r[1]+u,r[2]+d),I.closePath(),this._fill(n),this._stroke(n);break;case"triangledown":case"v":I.beginPath(),I.moveTo(r[1],r[2]+o),I.lineTo(r[1]-u,r[2]-d),I.lineTo(r[1]+u,r[2]-d),I.closePath(),this._fill(n),this._stroke(n);break;case"triangleleft":case"<":I.beginPath(),I.moveTo(r[1]-o,r[2]),I.lineTo(r[1]+d,r[2]-u),I.lineTo(r[1]+d,r[2]+u),I.closePath(),this._fill(n),this._stroke(n);break;case"triangleright":case">":I.beginPath(),I.moveTo(r[1]+o,r[2]),I.lineTo(r[1]-d,r[2]-u),I.lineTo(r[1]-d,r[2]+u),I.closePath(),this._fill(n),this._stroke(n);break}},updatePoint:function(n){this.drawPoint(n)},drawArrows:function(n,t,o,r,u){var d,C,I,f,A,G,B,Z,w=this.context,V=6,Y=1,J,T,L=1,z=1,K,P,$,ie,ne,ee,se,re,ce,ue,ye=u.evFirst,Se=u.evLast;if(JXG$1.evaluate(n.visProp.strokecolor)!=="none"&&(ye||Se)){if(n.elementClass===Const.OBJECT_CLASS_LINE)d=t.scrCoords[1],C=t.scrCoords[2],I=o.scrCoords[1],f=o.scrCoords[2],ce=ue=Math.atan2(f-C,I-d);else{if(d=n.points[0].scrCoords[1],C=n.points[0].scrCoords[2],re=n.points.length-1,re<1)return;I=n.points[n.points.length-1].scrCoords[1],f=n.points[n.points.length-1].scrCoords[2],ie=n.points[1].scrCoords[1]-n.points[0].scrCoords[1],ne=n.points[1].scrCoords[2]-n.points[0].scrCoords[2],ee=n.points[re].scrCoords[1]-n.points[re-1].scrCoords[1],se=n.points[re].scrCoords[2]-n.points[re-1].scrCoords[2],ye&&(ce=Math.atan2(ne,ie)),Se&&(ue=Math.atan2(se,ee))}if(A=JXG$1.evaluate(n.visProp[r+"strokewidth"]),ye)if(V=u.sizeFirst,G=A*V,Y=u.typeFirst,J=Y,Y===2)Z=[[G,-G*.5],[0,0],[G,G*.5],[G*.5,0]];else if(Y===3)Z=[[G/3,-G*.5],[0,-G*.5],[0,G*.5],[G/3,G*.5]];else if(Y===4)for(G/=10,L=3,Z=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],$=Z.length,P=0;P<$;P++)Z[P][0]*=-G,Z[P][1]*=G,Z[P][0]+=10*G,Z[P][1]-=3.31*G;else if(Y===5)for(G/=10,L=3,Z=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],$=Z.length,P=0;P<$;P++)Z[P][0]*=-G,Z[P][1]*=G,Z[P][0]+=10*G,Z[P][1]-=3.28*G;else if(Y===6)for(G/=10,L=3,Z=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],$=Z.length,P=0;P<$;P++)Z[P][0]*=-G,Z[P][1]*=G,Z[P][0]+=10*G,Z[P][1]-=2.84*G;else if(Y===7)for(G=A,L=3,Z=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],$=Z.length,P=0;P<$;P++)Z[P][0]*=-G,Z[P][1]*=G,Z[P][0]+=10*G,Z[P][1]-=5.2*G;else Z=[[G,-G*.5],[0,0],[G,G*.5]];if(Se)if(V=u.sizeLast,G=A*V,Y=u.typeLast,T=Y,Y===2)B=[[-G,-G*.5],[0,0],[-G,G*.5],[-G*.5,0]];else if(Y===3)B=[[-G/3,-G*.5],[0,-G*.5],[0,G*.5],[-G/3,G*.5]];else if(Y===4)for(G/=10,z=3,B=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],$=B.length,P=0;P<$;P++)B[P][0]*=G,B[P][1]*=G,B[P][0]-=10*G,B[P][1]-=3.31*G;else if(Y===5)for(G/=10,z=3,B=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],$=B.length,P=0;P<$;P++)B[P][0]*=G,B[P][1]*=G,B[P][0]-=10*G,B[P][1]-=3.28*G;else if(Y===6)for(G/=10,z=3,B=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],$=B.length,P=0;P<$;P++)B[P][0]*=G,B[P][1]*=G,B[P][0]-=10*G,B[P][1]-=2.84*G;else if(Y===7)for(G=A,z=3,B=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],$=B.length,P=0;P<$;P++)B[P][0]*=G,B[P][1]*=G,B[P][0]-=10*G,B[P][1]-=5.2*G;else B=[[-G,-G*.5],[0,0],[-G,G*.5]];w.save(),this._setColor(n,"stroke","fill")&&(this._setColor(n,"stroke"),ye&&(J===7?K=!1:K=!0,this._drawPolygon(this._translateShape(this._rotateShape(Z,ce),d,C),L,K)),Se&&(T===7?K=!1:K=!0,this._drawPolygon(this._translateShape(this._rotateShape(B,ue),I,f),z,K))),w.restore()}},drawLine:function(n){var t,o,r=new Coords(Const.COORDS_BY_USER,n.point1.coords.usrCoords,n.board),u=new Coords(Const.COORDS_BY_USER,n.point2.coords.usrCoords,n.board),d=null,C,I,f;n.visPropCalc.visible&&(C=this._getHighlighted(n),I=JXG$1.evaluate(n.visProp[C+"strokewidth"]),f=this.getArrowHeadData(n,I,C),(f.evFirst||f.evLast)&&(d=-4),Geometry.calcStraight(n,r,u,d),this.handleTouchpoints(n,r,u,f),t=new Coords(Const.COORDS_BY_USER,r.usrCoords,n.board),o=new Coords(Const.COORDS_BY_USER,u.usrCoords,n.board),this.getPositionArrowHead(n,r,u,f),this.context.beginPath(),this.context.moveTo(r.scrCoords[1],r.scrCoords[2]),this.context.lineTo(u.scrCoords[1],u.scrCoords[2]),this._stroke(n),(f.evFirst||f.evLast)&&this.drawArrows(n,t,o,C,f))},updateLine:function(n){this.drawLine(n)},drawTicks:function(){},updateTicks:function(n){var t,o,r,u,d=n.ticks.length,C,I,f=this.context;for(f.beginPath(),t=0;t<d;t++)for(o=n.ticks[t],r=o[0],u=o[1],C=r.length,f.moveTo(r[0],u[0]),I=1;I<C;++I)f.lineTo(r[I],u[I]);f.lineCap="round",this._stroke(n)},drawCurve:function(n){var t,o,r;JXG$1.evaluate(n.visProp.handdrawing)?this.updatePathStringBezierPrim(n):this.updatePathStringPrim(n),n.numberPoints>1&&(t=this._getHighlighted(n),o=JXG$1.evaluate(n.visProp[t+"strokewidth"]),r=this.getArrowHeadData(n,o,t),(r.evFirst||r.evLast)&&this.drawArrows(n,null,null,t,r))},updateCurve:function(n){this.drawCurve(n)},drawEllipse:function(n){var t=n.center.coords.scrCoords[1],o=n.center.coords.scrCoords[2],r=n.board.unitX,u=n.board.unitY,d=2*n.Radius(),C=2*n.Radius(),I=d*r,f=C*u,A=t-I/2,G=o-f/2,B=I/2*.5522848,Z=f/2*.5522848,w=A+I,V=G+f,Y=A+I/2,J=G+f/2,T=this.context;d>0&&C>0&&!isNaN(t+o)&&(T.beginPath(),T.moveTo(A,J),T.bezierCurveTo(A,J-Z,Y-B,G,Y,G),T.bezierCurveTo(Y+B,G,w,J-Z,w,J),T.bezierCurveTo(w,J+Z,Y+B,V,Y,V),T.bezierCurveTo(Y-B,V,A,J+Z,A,J),T.closePath(),this._fill(n),this._stroke(n))},updateEllipse:function(n){return this.drawEllipse(n)},displayCopyright:function(n,t){var o=this.context;o.save(),o.font=t+"px Arial",o.fillStyle="#aaa",o.lineWidth=.5,o.fillText(n,10,2+t),o.restore()},drawInternalText:function(n){var t=JXG$1.evaluate(n.visProp.fontsize),o=JXG$1.evaluate(n.visProp.fontunit),r=n.getAnchorX(),u=n.getAnchorY(),d=this.context;return d.save(),this._setColor(n,"stroke","fill")&&!isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])&&(d.font=(t>0?t:0)+o+" Arial",this.transformImage(n,n.transformations),r==="left"?d.textAlign="left":r==="right"?d.textAlign="right":r==="middle"&&(d.textAlign="center"),u==="bottom"?d.textBaseline="bottom":u==="top"?d.textBaseline="top":u==="middle"&&(d.textBaseline="middle"),d.fillText(n.plaintext,n.coords.scrCoords[1],n.coords.scrCoords[2])),d.restore(),null},updateInternalText:function(n){this.drawInternalText(n)},setObjectStrokeColor:function(n,t,o){var r=JXG$1.evaluate(t),u,d,C=JXG$1.evaluate(o),I,f;C=C>0?C:0,!(n.visPropOld.strokecolor===r&&n.visPropOld.strokeopacity===C)&&(JXG$1.exists(r)&&r!==!1&&(r.length!==9?(u=r,I=C):(d=JXG$1.rgba2rgbo(r),u=d[0],I=C*d[1]),f=n.rendNode,n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"&&(f.style.color=u,f.style.opacity=I)),n.visPropOld.strokecolor=r,n.visPropOld.strokeopacity=C)},drawImage:function(n){n.rendNode=new Image,n._src="",this.updateImage(n)},updateImage:function(n){var t=this.context,o=JXG$1.evaluate(n.visProp.fillopacity),r=JXG$1.bind(function(){n.imgIsLoaded=!0,!(n.size[0]<=0||n.size[1]<=0)&&(t.save(),t.globalAlpha=o,this.transformImage(n,n.transformations),t.drawImage(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),t.restore())},this);this.updateImageURL(n)?n.rendNode.onload=r:n.imgIsLoaded&&r()},transformImage:function(n,t){var o,r,u,d,C,I=t.length,f=this.context;if(I>0)if(o=this.joinTransforms(n,t),n.elementClass===Const.OBJECT_CLASS_TEXT&&n.visProp.display==="html"){if(r=" matrix("+[o[1][1],o[2][1],o[1][2],o[2][2],o[1][0],o[2][0]].join(",")+") ",r.indexOf("NaN")===-1){switch(C=n.rendNode,C.style.transform=r,u=-n.coords.scrCoords[1],d=-n.coords.scrCoords[2],JXG$1.evaluate(n.visProp.anchorx)){case"right":u+=n.size[0];break;case"middle":u+=n.size[0]*.5;break}switch(JXG$1.evaluate(n.visProp.anchory)){case"bottom":d+=n.size[1];break;case"middle":d+=n.size[1]*.5;break}C.style["transform-origin"]=u+"px "+d+"px"}}else Math.abs(Numerics.det(o))>=Mat.eps&&f.transform(o[1][1],o[2][1],o[1][2],o[2][2],o[1][0],o[2][0])},updateImageURL:function(n){var t;return t=JXG$1.evaluate(n.url),n._src!==t?(n.imgIsLoaded=!1,n.rendNode.src=t,n._src=t,!0):!1},remove:function(n){JXG$1.exists(n)&&JXG$1.exists(n.parentNode)&&n.parentNode.removeChild(n)},updatePathStringPrim:function(n){var t,o,r,u,d,C="M",I="L",f="C",A=C,G=5e3,B=this.context;if(!(n.numberPoints<=0)){if(d=Math.min(n.points.length,n.numberPoints),B.beginPath(),n.bezierDegree===1)for(t=0;t<d;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?A=C:(o[1]>G?o[1]=G:o[1]<-5e3&&(o[1]=-5e3),o[2]>G?o[2]=G:o[2]<-5e3&&(o[2]=-5e3),A===C?B.moveTo(o[1],o[2]):B.lineTo(o[1],o[2]),A=I);else if(n.bezierDegree===3)for(t=0;t<d;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?A=C:(A===C?B.moveTo(o[1],o[2]):(t+=1,r=n.points[t].scrCoords,t+=1,u=n.points[t].scrCoords,B.bezierCurveTo(o[1],o[2],r[1],r[2],u[1],u[2])),A=f),t+=1;B.lineCap="round",this._fill(n),this._stroke(n)}},updatePathStringBezierPrim:function(n){var t,o,r,u,d,C,I,f="M",A="C",G=f,B=5e3,Z=JXG$1.evaluate(n.visProp.strokewidth),w=JXG$1.evaluate(n.visProp.curvetype)!=="plot",V=this.context;if(!(n.numberPoints<=0)){for(w&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,.5)),I=Math.min(n.points.length,n.numberPoints),V.beginPath(),o=1;o<3;o++)for(G=f,t=0;t<I;t++)u=n.points[t].scrCoords,isNaN(u[1])||isNaN(u[2])?G=f:(u[1]>B?u[1]=B:u[1]<-5e3&&(u[1]=-5e3),u[2]>B?u[2]=B:u[2]<-5e3&&(u[2]=-5e3),G===f?V.moveTo(u[1],u[2]):(r=2*o,V.bezierCurveTo(d+(u[1]-d)*.333+Z*(r*Math.random()-o),C+(u[2]-C)*.333+Z*(r*Math.random()-o),d+(u[1]-d)*.666+Z*(r*Math.random()-o),C+(u[2]-C)*.666+Z*(r*Math.random()-o),u[1],u[2])),G=A,d=u[1],C=u[2]);V.lineCap="round",this._fill(n),this._stroke(n)}},updatePolygonPrim:function(n,t){var o,r,u,d=t.vertices.length,C=this.context,I=!0;if(!(d<=0||!t.visPropCalc.visible)){for(t.elType==="polygonalchain"&&d++,C.beginPath(),r=0;!t.vertices[r].isReal&&r<d-1;)r++,I=!1;for(o=t.vertices[r].coords.scrCoords,C.moveTo(o[1],o[2]),u=r;u<d-1;u++)t.vertices[u].isReal||(I=!1),o=t.vertices[u].coords.scrCoords,C.lineTo(o[1],o[2]);C.closePath(),I&&this._fill(t)}},display:function(n,t){n&&n.rendNode&&(n.visPropOld.visible=t,t?n.rendNode.style.visibility="inherit":n.rendNode.style.visibility="hidden")},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),JXG$1.exists(n.rendNode)&&(n.rendNode.style.visibility="inherit")},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),JXG$1.exists(n.rendNode)&&(n.rendNode.style.visibility="hidden")},setGradient:function(n){},setShadow:function(n){n.visPropOld.shadow!==n.visProp.shadow&&(n.visPropOld.shadow=n.visProp.shadow)},highlight:function(n){return n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"?this.updateTextStyle(n,!0):(n.board.prepareUpdate(),n.board.renderer.suspendRedraw(n.board),n.board.updateRenderer(),n.board.renderer.unsuspendRedraw()),this},noHighlight:function(n){return n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"?this.updateTextStyle(n,!1):(n.board.prepareUpdate(),n.board.renderer.suspendRedraw(n.board),n.board.updateRenderer(),n.board.renderer.unsuspendRedraw()),this},suspendRedraw:function(n){this.context.save(),this.context.clearRect(0,0,this.canvasRoot.width,this.canvasRoot.height),n&&n.attr.showcopyright&&this.displayCopyright(JXG$1.licenseText,12)},unsuspendRedraw:function(){this.context.restore()},resize:function(n,t){this.container?(this.canvasRoot.style.width=parseFloat(n)+"px",this.canvasRoot.style.height=parseFloat(t)+"px",this.canvasRoot.setAttribute("width",2*parseFloat(n)+"px"),this.canvasRoot.setAttribute("height",2*parseFloat(t)+"px")):(this.canvasRoot.width=2*parseFloat(n),this.canvasRoot.height=2*parseFloat(t)),this.context=this.canvasRoot.getContext("2d"),this.context.scale(2,2)},removeToInsertLater:function(){return function(){}}});const CanvasRenderer=JXG$1.CanvasRenderer;JXG$1.NoRenderer=function(){this.enhancedRendering=!1,this.type="no"};JXG$1.extend(JXG$1.NoRenderer.prototype,{drawPoint:function(n){},updatePoint:function(n){},changePointStyle:function(n){},drawLine:function(n){},updateLine:function(n){},drawTicks:function(n){},updateTicks:function(n){},drawCurve:function(n){},updateCurve:function(n){},drawEllipse:function(n){},updateEllipse:function(n){},drawPolygon:function(n){},updatePolygon:function(n){},displayCopyright:function(n,t){},drawInternalText:function(n){},updateInternalText:function(n){},drawText:function(n){},updateText:function(n){},updateTextStyle:function(n,t){},updateInternalTextStyle:function(n,t,o){},drawImage:function(n){},updateImage:function(n){},transformImage:function(n,t){},updateImageURL:function(n){},appendChildPrim:function(n,t){},appendNodesToElement:function(n,t){},createPrim:function(n,t){return null},remove:function(n){},makeArrows:function(n){},updateEllipsePrim:function(n,t,o,r,u){},updateLinePrim:function(n,t,o,r,u,d){},updatePathPrim:function(n,t,o){},updatePathStringPoint:function(n,t,o){},updatePathStringPrim:function(n){},updatePathStringBezierPrim:function(n){},updatePolygonPrim:function(n,t){},updateRectPrim:function(n,t,o,r,u){},setPropertyPrim:function(n,t,o){},display:function(n,t){n&&(n.visPropOld.visible=t)},show:function(n){},hide:function(n){},setBuffering:function(n,t){},setDashStyle:function(n){},setDraft:function(n){},removeDraft:function(n){},setGradient:function(n){},updateGradient:function(n){},setObjectTransition:function(n,t){},setObjectFillColor:function(n,t,o){},setObjectStrokeColor:function(n,t,o){},setObjectStrokeWidth:function(n,t){},setShadow:function(n){},highlight:function(n){},noHighlight:function(n){},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(n){},getElementById:function(n){return null},resize:function(n,t){},removeToInsertLater:function(){return function(){}}});JXG$1.NoRenderer.prototype=new AbstractRenderer;const NoRenderer=JXG$1.NoRenderer;JXG$1.JSXGraph={rendererType:function(){return Options.board.renderer="no",JXG$1.supportsVML()&&(Options.board.renderer="vml",document.onmousemove=function(){var n;return document.body&&(n=document.body.scrollLeft,n+=document.body.scrollTop),n}),JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),JXG$1.supportsSVG()&&(Options.board.renderer="svg"),JXG$1.isNode()&&JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),(JXG$1.isNode()||Options.renderer==="no")&&(Options.text.display="internal",Options.infobox.display="internal"),Options.board.renderer}(),initRenderer:function(n,t,o,r){var u,d;if((!JXG$1.exists(o)||o===!1)&&typeof document=="object"&&(o=document),typeof o=="object"&&n!==null)for(u=JXG$1.isString(n)?o.getElementById(n):n;u.firstChild;)u.removeChild(u.firstChild);else u=n;return(r===void 0||r==="auto")&&(r=this.rendererType),r==="svg"?d=new SVGRenderer(u,t):r==="vml"?d=new VMLRenderer(u):r==="canvas"?d=new CanvasRenderer(u,t):d=new NoRenderer,d},_setAttributes:function(n,t){var o=JXG$1.copyAttributes(n,t,"board"),r=["drag","fullscreen","intl","keyboard","logging","pan","resize","screenshot","selection","zoom"],u=r.length,d,C;for(d=0;d<u;d++)C=r[d],o[C]=JXG$1.copyAttributes(o,t,"board",C);return o.navbar=JXG$1.copyAttributes(o.navbar,t,"navbar"),o.movetarget=n.moveTarget||n.movetarget||t.board.moveTarget,o},_fillBoard:function(n,t,o){n.initInfobox(t.infobox),n.maxboundingbox=t.maxboundingbox,n.resizeContainer(o.width,o.height,!0,!0),n._createSelectionPolygon(t),n.renderer.drawNavigationBar(n,t.navbar),JXG$1.boards[n.id]=n},_setARIA:function(n,t){var o=t.document,r,u,d,C,I,f;if(typeof o!="object"){if(!JXG$1.isBrowser)return;o=document}u=JXG$1.isString(n)?o.getElementById(n):n,r=u.ownerDocument,C=u.parentNode,I=n+"_ARIAlabel",f=n+"_ARIAdescription",d=r.createElement("div"),d.innerHTML=t.title,d.setAttribute("id",I),d.style.display="none",C.insertBefore(d,u),d=r.createElement("div"),d.innerHTML=t.description,d.setAttribute("id",f),d.style.display="none",C.insertBefore(d,u),u.setAttribute("aria-labelledby",I),u.setAttribute("aria-describedby",f)},_removeARIANodes:function(n){var t,o,r;r=n.document||document,typeof r=="object"&&(o=n.containerObj.getAttribute("aria-labelledby"),t=r.getElementById(o),t&&t.parentNode&&t.parentNode.removeChild(t),o=n.containerObj.getAttribute("aria-describedby"),t=r.getElementById(o),t&&t.parentNode&&t.parentNode.removeChild(t))},initBoard:function(n,t){var o,r,u,d,C,I,f=0,A=0,G,B,Z,w,V,Y,J,T,L={},z;return t=t||{},t.theme!=="default"&&JXG$1.exists(JXG$1.themes[t.theme])&&(L=JXG$1.themes[t.theme]),T=JXG$1.deepCopy(Options,L,!0),w=this._setAttributes(t,T),B=JXG$1.getDimensions(n,w.document),w.unitx||w.unity?(o=JXG$1.def(w.originx,150),r=JXG$1.def(w.originy,150),u=JXG$1.def(w.unitx,50),d=JXG$1.def(w.unity,50)):(Z=w.boundingbox,Z[0]<w.maxboundingbox[0]&&(Z[0]=w.maxboundingbox[0]),Z[1]>w.maxboundingbox[1]&&(Z[1]=w.maxboundingbox[1]),Z[2]>w.maxboundingbox[2]&&(Z[2]=w.maxboundingbox[2]),Z[3]<w.maxboundingbox[3]&&(Z[3]=w.maxboundingbox[3]),C=parseInt(B.width,10),I=parseInt(B.height,10),JXG$1.exists(Z)&&w.keepaspectratio?(u=C/(Z[2]-Z[0]),d=I/(Z[1]-Z[3]),Math.abs(u)<Math.abs(d)?(d=Math.abs(u)*d/Math.abs(d),A=(I/d-(Z[1]-Z[3]))*.5):(u=Math.abs(d)*u/Math.abs(u),f=(C/u-(Z[2]-Z[0]))*.5)):(u=C/(Z[2]-Z[0]),d=I/(Z[1]-Z[3])),o=-u*(Z[0]-f),r=d*(Z[1]+A)),G=this.initRenderer(n,B,w.document,w.renderer),this._setARIA(n,w),z=new Board(n,G,w.id,[o,r],w.zoomx,w.zoomy,u,d,B.width,B.height,w),z.keepaspectratio=w.keepaspectratio,this._fillBoard(z,w,B),z.suspendUpdate(),w=z.attr,w.axis&&(V=typeof w.axis=="object"?w.axis:{},Y=JXG$1.deepCopy(T.board.defaultaxes.x,V),J=JXG$1.deepCopy(T.board.defaultaxes.y,V),w.defaultaxes.x&&(Y=JXG$1.deepCopy(Y,w.defaultaxes.x)),w.defaultaxes.y&&(J=JXG$1.deepCopy(J,w.defaultaxes.y)),z.defaultAxes={},z.defaultAxes.x=z.create("axis",[[0,0],[1,0]],Y),z.defaultAxes.y=z.create("axis",[[0,0],[0,1]],J)),w.grid&&z.create("grid",[],typeof w.grid=="object"?w.grid:{}),z.unsuspendUpdate(),z},loadBoardFromFile:function(n,t,o,r,u){var d,C,I,f,A;return r=r||{},d=this._setAttributes(r),f=JXG$1.getDimensions(n,d.document),C=this.initRenderer(n,f,d.document,d.renderer),this._setARIA(n,d),I=new Board(n,C,"",[150,150],1,1,50,50,f.width,f.height,d),this._fillBoard(I,d,f),A=d.encoding||"iso-8859-1",FileReader$1.parseFileContent(t,I,o,!0,A,u),I},loadBoardFromString:function(n,t,o,r,u){var d,C,I,f;return r=r||{},d=this._setAttributes(r),f=JXG$1.getDimensions(n,d.document),C=this.initRenderer(n,f,d.document,d.renderer),this._setARIA(n,d),I=new Board(n,C,"",[150,150],1,1,50,50,f.width,f.height,d),this._fillBoard(I,d,f),FileReader$1.parseString(t,I,o,!0,u),I},freeBoard:function(n){var t;typeof n=="string"&&(n=JXG$1.boards[n]),this._removeARIANodes(n),n.removeEventHandlers(),n.suspendUpdate();for(t in n.objects)n.objects.hasOwnProperty(t)&&n.objects[t].remove();for(;n.containerObj.firstChild;)n.containerObj.removeChild(n.containerObj.firstChild);for(t in n.objects)n.objects.hasOwnProperty(t)&&delete n.objects[t];delete n.renderer,n.jc.creator.clearCache(),delete n.jc,delete JXG$1.boards[n.id]},registerElement:function(n,t){JXG$1.deprecated("JXG.JSXGraph.registerElement()","JXG.registerElement()"),JXG$1.registerElement(n,t)}};JXG$1.isBrowser&&typeof window=="object"&&typeof document=="object"&&JXG$1.addEvent(window,"load",function(){var n,t,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L=!1,z=document.getElementsByTagName("script"),K=function($,ie,ne){var ee=JXG$1.JSXGraph.initBoard(u,{boundingbox:ne,keepaspectratio:!0,grid:V,axis:w,showReload:!0});if(ie.toLowerCase().indexOf("script")>-1)ee.construct($);else try{ee.jc.parse($)}catch(se){JXG$1.debug(se)}return ee},P=function($,ie,ne,ee){return function(){var se;JXG$1.JSXGraph.freeBoard($),se=K(ie,ne,ee),se.reload=P(se,ie,ne,ee)}};for(t=0;t<z.length;t++)if(n=z[t].getAttribute("type",!1),JXG$1.exists(n)&&(n.toLowerCase()==="text/jessiescript"||n.toLowerCase()==="jessiescript"||n.toLowerCase()==="text/jessiecode"||n.toLowerCase()==="jessiecode")){if(B=z[t].getAttribute("class",!1)||"",I=z[t].getAttribute("width",!1)||"",f=z[t].getAttribute("height",!1)||"",A=z[t].getAttribute("maxwidth",!1)||"100%",G=z[t].getAttribute("aspectratio",!1)||"1/1",Z=z[t].getAttribute("boundingbox",!1)||"-5, 5, 5, -5",u=z[t].getAttribute("container",!1),J=z[t].getAttribute("src",!1),Z=Z.split(","),Z.length!==4)Z=[-5,5,5,-5];else for(o=0;o<Z.length;o++)Z[o]=parseFloat(Z[o]);if(w=JXG$1.str2Bool(z[t].getAttribute("axis",!1)||"false"),V=JXG$1.str2Bool(z[t].getAttribute("grid",!1)||"false"),JXG$1.exists(u))r=document.getElementById(u);else{u="jessiescript_autgen_jxg_"+t,r=document.createElement("div"),r.setAttribute("id",u),C=I!==""?"width:"+I+";":"",C+=f!==""?"height:"+f+";":"",C+=A!==""?"max-width:"+A+";":"",C+=G!==""?"aspect-ratio:"+G+";":"",r.setAttribute("style",C),r.setAttribute("class","jxgbox "+B);try{document.body.insertBefore(r,z[t])}catch{typeof jQuery=="object"&&jQuery(r).insertBefore(z[t])}}Y="",JXG$1.exists(J)?(L=!0,T=new XMLHttpRequest,T.open("GET",J),T.overrideMimeType("text/plain; charset=x-user-defined"),T.addEventListener("load",function(){if(this.status<400)Y=this.responseText+`
`+Y,d=K(Y,n,Z),d.reload=P(d,Y,n,Z);else throw new Error(`
JSXGraph: failed to load file`,J,":",this.responseText)}),T.addEventListener("error",function($){throw new Error(`
JSXGraph: failed to load file`,J,":",$)}),T.send()):L=!1,document.getElementById(u)?(Y=z[t].innerHTML,Y=Y.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""),z[t].innerHTML=Y,L||(d=K(Y,n,Z),d.reload=P(d,Y,n,Z))):JXG$1.debug("JSXGraph: Apparently the div injection failed. Can't create a board, sorry.")}},window);JXG$1.JSXGraph;JXG$1.Point=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_POINT,Const.OBJECT_CLASS_POINT),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this.elType="point",this.id=this.board.setId(this,"P"),this.board.renderer.drawPoint(this),this.board.finalizeAdding(this),this.createGradient(),this.createLabel()};JXG$1.Point.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Point.prototype,{hasPoint:function(n,t){var o=this.coords.scrCoords,r,u,d,C=JXG$1.evaluate(this.visProp.sizeunit);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(d=this.board._inputDevice,u=JXG$1.evaluate(this.visProp.precision[d])):u=this.board.options.precision.hasPoint,r=parseFloat(JXG$1.evaluate(this.visProp.size)),C==="user"&&(r*=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY))),r+=parseFloat(JXG$1.evaluate(this.visProp.strokewidth))*.5,r<u&&(r=u),Math.abs(o[1]-n)<r+2&&Math.abs(o[2]-t)<r+2},update:function(n){return this.needsUpdate?(this.updateCoords(n),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateTransform:function(n){var t,o;if(this.transformations.length===0||this.baseElement===null)return this;for(this===this.baseElement?(t=this.transformations[0].apply(this.baseElement,"self"),this.coords.setCoordinates(Const.COORDS_BY_USER,t)):t=this.transformations[0].apply(this.baseElement),this.coords.setCoordinates(Const.COORDS_BY_USER,t),o=1;o<this.transformations.length;o++)this.coords.setCoordinates(Const.COORDS_BY_USER,this.transformations[o].apply(this));return this},updateRenderer:function(){return this.updateRendererGeneric("updatePoint"),this},bounds:function(){return this.coords.usrCoords.slice(1).concat(this.coords.usrCoords.slice(1))},makeIntersection:function(n,t,o,r){var u;n=this.board.select(n),t=this.board.select(t),u=Geometry.intersectionFunction(this.board,n,t,o,r,this.visProp.alwaysintersect),this.addConstraint([u]);try{n.addChild(this),t.addChild(this)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof n+"' and '"+typeof t+"'.")}this.type=Const.OBJECT_TYPE_INTERSECTION,this.elType="intersection",this.parents=[n.id,t.id,o,r],this.generatePolynomial=function(){var d=n.generatePolynomial(this),C=t.generatePolynomial(this);return d.length===0||C.length===0?[]:[d[0],C[0]]},this.prepareUpdate().update()},setStyle:function(n){var t=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"],o=[2,3,4,1,2,3,4,2,3,4,2,3,4];return this.visProp.face=t[n],this.visProp.size=o[n],this.board.renderer.changePointStyle(this),this},normalizeFace:function(n){return JXG$1.deprecated("Point.normalizeFace()","JXG.normalizePointFace()"),Options.normalizePointFace(n)},face:function(n){JXG$1.deprecated("Point.face()","Point.setAttribute()"),this.setAttribute({face:n})},size:function(n){JXG$1.deprecated("Point.size()","Point.setAttribute()"),this.setAttribute({size:n})},isOn:function(n,t){var o,r;return t=t||Mat.eps,JXG$1.isPoint(n)?this.Dist(n)<t:n.elementClass===Const.OBJECT_CLASS_LINE?n.elType==="segment"&&!JXG$1.evaluate(this.visProp.alwaysintersect)?(o=JXG$1.Math.Geometry.projectCoordsToSegment(this.coords.usrCoords,n.point1.coords.usrCoords,n.point2.coords.usrCoords),o[1]>=0&&o[1]<=1&&Geometry.distPointLine(this.coords.usrCoords,n.stdform)<t):Geometry.distPointLine(this.coords.usrCoords,n.stdform)<t:n.elementClass===Const.OBJECT_CLASS_CIRCLE?JXG$1.evaluate(n.visProp.hasinnerpoints)?this.Dist(n.center)<n.Radius()+t:Math.abs(this.Dist(n.center)-n.Radius())<t:n.elementClass===Const.OBJECT_CLASS_CURVE?(r=Geometry.projectPointToCurve(this,n,this.board)[0],Geometry.distance(this.coords.usrCoords,r.usrCoords,3)<t):n.type===Const.OBJECT_TYPE_POLYGON?JXG$1.evaluate(n.visProp.hasinnerpoints)&&n.pnpoly(this.coords.usrCoords[1],this.coords.usrCoords[2],JXG$1.COORDS_BY_USER)?!0:(o=Geometry.projectCoordsToPolygon(this.coords.usrCoords,n),Geometry.distance(this.coords.usrCoords,o,3)<t):n.type===Const.OBJECT_TYPE_TURTLE?(r=Geometry.projectPointToTurtle(this,n,this.board),Geometry.distance(this.coords.usrCoords,r.usrCoords,3)<t):!1},cloneToBackground:function(){var n={};return n.id=this.id+"T"+this.numTraces,this.numTraces+=1,n.coords=this.coords,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,n.elementClass=Const.OBJECT_CLASS_POINT,n.board=this.board,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},this.board.renderer.drawPoint(n),this.traces[n.id]=n.rendNode,this}});JXG$1.createPoint=function(n,t,o){var r,u;if(u=JXG$1.copyAttributes(o,n.options,"point"),r=CoordsElement.create(JXG$1.Point,n,t,u),!r)throw new Error("JSXGraph: Can't create point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return r};JXG$1.createGlider=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"glider");return t.length===1?u=[0,0]:u=t.slice(0,2),r=n.create("point",u,d),r.makeGlider(t[t.length-1]),r};JXG$1.createIntersectionPoint=function(n,t,o){var r,u,d,C,I,f,A=JXG$1.copyAttributes(o,n.options,"intersection");t.push(0,0),u=n.select(t[0]),d=n.select(t[1]),I=t[2]||0,f=t[3]||0,r=n.create("point",[0,0,0],A),C=Geometry.intersectionFunction(n,u,d,I,f,r.visProp.alwaysintersect),r.addConstraint([C]);try{u.addChild(r),d.addChild(r)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return r.type=Const.OBJECT_TYPE_INTERSECTION,r.elType="intersection",r.setParents([u.id,d.id]),r.intersectionNumbers=[I,f],r.getParents=function(){return this.parents.concat(this.intersectionNumbers)},r.generatePolynomial=function(){var G=u.generatePolynomial(r),B=d.generatePolynomial(r);return G.length===0||B.length===0?[]:[G[0],B[0]]},r};JXG$1.createOtherIntersectionPoint=function(n,t,o){var r,u,d,C,I,f,A,G=!0,B=JXG$1.copyAttributes(o,n.options,"otherintersection");if(t.length!==3)G=!1;else{for(u=n.select(t[0]),d=n.select(t[1]),JXG$1.isArray(t[2])?I=t[2]:I=[t[2]],C=0;C<I.length;C++)if(I[C]=n.select(I[C]),!JXG$1.isPoint(I[C])){G=!1;break}G&&(A=[u,d],A.sort(function(Z,w){return w.elementClass-Z.elementClass}),([Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE].indexOf(A[0].elementClass)<0||[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_LINE].indexOf(A[1].elementClass)<0)&&(G=!1))}if(!G)throw new Error("JSXGraph: Can't create 'other intersection point' with parent types '"+typeof t[0]+"',  '"+typeof t[1]+"'and  '"+typeof t[2]+`'.
Possible parent types: [circle|curve|line,circle|curve|line, point], not two lines`);return r=n.create("point",[0,0,0],B),f=Geometry.otherIntersectionFunction(A,I,r.visProp.alwaysintersect,r.visProp.precision),r.addConstraint([f]),r.type=Const.OBJECT_TYPE_INTERSECTION,r.elType="otherintersection",r.setParents([u.id,d.id]),r.addParents(I),u.addChild(r),d.addChild(r),u.elementClass===Const.OBJECT_CLASS_CIRCLE&&(r.generatePolynomial=function(){var Z=u.generatePolynomial(r),w=d.generatePolynomial(r);return Z.length===0||w.length===0?[]:[Z[0],w[0]]}),r};JXG$1.createPolePoint=function(n,t,o){var r,u,d,C,I,f,A;if(t.length>1&&(C=t[0].type===Const.OBJECT_TYPE_CONIC||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE,I=t[1].type===Const.OBJECT_TYPE_CONIC||t[1].elementClass===Const.OBJECT_CLASS_CIRCLE,f=t[0].elementClass===Const.OBJECT_CLASS_LINE,A=t[1].elementClass===Const.OBJECT_CLASS_LINE),t.length!==2||!(C&&A||f&&I))throw new Error("JSXGraph: Can't create 'pole point' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [conic|circle,line], [line,conic|circle]`);return A?(u=n.select(t[0]),d=n.select(t[1])):(u=n.select(t[1]),d=n.select(t[0])),r=n.create("point",[function(){var G=u.quadraticform,B=d.stdform.slice(0,3);return[JXG$1.Math.Numerics.det([B,G[1],G[2]]),JXG$1.Math.Numerics.det([G[0],B,G[2]]),JXG$1.Math.Numerics.det([G[0],G[1],B])]}],o),r.elType="polepoint",r.setParents([u.id,d.id]),u.addChild(r),d.addChild(r),r};JXG$1.registerElement("point",JXG$1.createPoint);JXG$1.registerElement("glider",JXG$1.createGlider);JXG$1.registerElement("intersection",JXG$1.createIntersectionPoint);JXG$1.registerElement("otherintersection",JXG$1.createOtherIntersectionPoint);JXG$1.registerElement("polepoint",JXG$1.createPolePoint);const Point=JXG$1.Point;JXG$1.Line=function(n,t,o,r){this.constructor(n,r,Const.OBJECT_TYPE_LINE,Const.OBJECT_CLASS_LINE),this.point1=this.board.select(t),this.point2=this.board.select(o),this.ticks=[],this.defaultTicks=null,this.parentPolygon=null,this.id=this.board.setId(this,"L"),this.board.renderer.drawLine(this),this.board.finalizeAdding(this),this.elType="line",this.point1._is_new?(this.addChild(this.point1),delete this.point1._is_new):this.point1.addChild(this),this.point2._is_new?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this),this.inherits.push(this.point1,this.point2),this.updateStdform(),this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{point1:"point1",point2:"point2",getSlope:"Slope",Slope:"Slope",Direction:"Direction",getRise:"getRise",Rise:"getRise",getYIntersect:"getRise",YIntersect:"getRise",getAngle:"getAngle",Angle:"getAngle",L:"L",length:"L",setFixedLength:"setFixedLength",setStraight:"setStraight"})};JXG$1.Line.prototype=new GeometryElement;JXG$1.extend(JXG$1.Line.prototype,{hasPoint:function(n,t){var o=[],r=[1,n,t],u,d,C,I,f,A,G,B,Z,w=JXG$1.evaluate(this.visProp.strokewidth);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(Z=this.board._inputDevice,B=JXG$1.evaluate(this.visProp.precision[Z])):B=this.board.options.precision.hasPoint,B+=w*.5,o[0]=this.stdform[0]-this.stdform[1]*this.board.origin.scrCoords[1]/this.board.unitX+this.stdform[2]*this.board.origin.scrCoords[2]/this.board.unitY,o[1]=this.stdform[1]/this.board.unitX,o[2]=this.stdform[2]/-this.board.unitY,u=Geometry.distPointLine(r,o),isNaN(u)||u>B?!1:JXG$1.evaluate(this.visProp.straightfirst)&&JXG$1.evaluate(this.visProp.straightlast)?!0:(C=this.point1.coords,I=this.point2.coords,d=[0,o[1],o[2]],d=Mat.crossProduct(d,r),d=Mat.crossProduct(d,o),d[1]/=d[0],d[2]/=d[0],d[0]=1,d=new Coords(Const.COORDS_BY_SCREEN,d.slice(1),this.board).usrCoords,f=C.distance(Const.COORDS_BY_USER,I),C=C.usrCoords.slice(0),I=I.usrCoords.slice(0),f<Mat.eps?A=0:(f===Number.POSITIVE_INFINITY&&(f=1/Mat.eps,Math.abs(I[0])<Mat.eps?(f/=Geometry.distance([0,0,0],I),I=[1,C[1]+I[1]*f,C[2]+I[2]*f]):(f/=Geometry.distance([0,0,0],C),C=[1,I[1]+C[1]*f,I[2]+C[2]*f])),G=1,f=I[G]-C[G],Math.abs(f)<Mat.eps&&(G=2,f=I[G]-C[G]),A=(d[G]-C[G])/f),!JXG$1.evaluate(this.visProp.straightfirst)&&A<0?!1:!(!JXG$1.evaluate(this.visProp.straightlast)&&A>1))},update:function(){var n;return this.needsUpdate?(this.constrained&&(JXG$1.isFunction(this.funps)?(n=this.funps(),n&&n.length&&n.length===2&&(this.point1=n[0],this.point2=n[1])):(JXG$1.isFunction(this.funp1)&&(n=this.funp1(),JXG$1.isPoint(n)?this.point1=n:n&&n.length&&n.length===2&&this.point1.setPositionDirectly(Const.COORDS_BY_USER,n)),JXG$1.isFunction(this.funp2)&&(n=this.funp2(),JXG$1.isPoint(n)?this.point2=n:n&&n.length&&n.length===2&&this.point2.setPositionDirectly(Const.COORDS_BY_USER,n)))),this.updateSegmentFixedLength(),this.updateStdform(),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateSegmentFixedLength:function(){var n,t,o,r,u,d,C,I;return this.hasFixedLength?(n=this.point1.Dist(this.point2),t=JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.fixedLength()):Math.abs(this.fixedLength()),o=this.fixedLengthOldCoords[0].distance(Const.COORDS_BY_USER,this.point1.coords),r=this.fixedLengthOldCoords[1].distance(Const.COORDS_BY_USER,this.point2.coords),(o>Mat.eps||r>Mat.eps||n!==t)&&(u=this.point1.isDraggable&&this.point1.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point1.visProp.fixed),d=this.point2.isDraggable&&this.point2.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point2.visProp.fixed),n>Mat.eps?o>r&&d||o<=r&&d&&!u?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+(this.point2.X()-this.point1.X())*t/n,this.point1.Y()+(this.point2.Y()-this.point1.Y())*t/n]),this.point2.fullUpdate()):(o<=r&&u||o>r&&u&&!d)&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+(this.point1.X()-this.point2.X())*t/n,this.point2.Y()+(this.point1.Y()-this.point2.Y())*t/n]),this.point1.fullUpdate()):(C=Math.random()-.5,I=Math.random()-.5,n=Mat.hypot(C,I),d?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+C*t/n,this.point1.Y()+I*t/n]),this.point2.fullUpdate()):u&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+C*t/n,this.point2.Y()+I*t/n]),this.point1.fullUpdate())),this.fixedLengthOldCoords[0].setCoordinates(Const.COORDS_BY_USER,this.point1.coords.usrCoords),this.fixedLengthOldCoords[1].setCoordinates(Const.COORDS_BY_USER,this.point2.coords.usrCoords)),this):this},updateStdform:function(){var n=Mat.crossProduct(this.point1.coords.usrCoords,this.point2.coords.usrCoords);this.stdform[0]=n[0],this.stdform[1]=n[1],this.stdform[2]=n[2],this.stdform[3]=0,this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.point1.coords.usrCoords[1]+this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[1]+this.point2.coords.usrCoords[2])&&Mat.innerProduct(this.stdform,this.stdform,3)>=Mat.eps*Mat.eps,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateLine(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},generatePolynomial:function(n){var t=this.point1.symbolic.x,o=this.point1.symbolic.y,r=this.point2.symbolic.x,u=this.point2.symbolic.y,d=n.symbolic.x,C=n.symbolic.y;return[["(",o,")*(",d,")-(",o,")*(",r,")+(",C,")*(",r,")-(",t,")*(",C,")+(",t,")*(",u,")-(",d,")*(",u,")"].join("")]},getRise:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[0]/this.stdform[2]:1/0},Slope:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[1]/this.stdform[2]:1/0},getSlope:function(){return this.Slope()},getAngle:function(){return Math.atan2(-this.stdform[1],this.stdform[2])},Direction:function(){var n=this.point1.coords.usrCoords,t=this.point2.coords.usrCoords;return t[0]===0&&n[0]!==0?t.slice(1):n[0]===0&&t[0]!==0?[-n[1],-n[2]]:[t[1]-n[1],t[2]-n[2]]},isVertical:function(){var n=this.Direction();return n[0]===0&&n[1]!==0},isHorizontal:function(){var n=this.Direction();return n[1]===0&&n[0]!==0},setStraight:function(n,t){return this.visProp.straightfirst=n,this.visProp.straightlast=t,this.board.renderer.updateLine(this),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[.5*(this.point2.X()+this.point1.X()),.5*(this.point2.Y()+this.point1.Y())],this.board)},setLabelRelativeCoords:function(n){JXG$1.exists(this.label)&&(this.label.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,[n[0],-n[1]],this.board))},getLabelAnchor:function(){var n,t,o,r,u,d,C,I,f=1.5,A=0,G=new Coords(Const.COORDS_BY_USER,this.point1.coords.usrCoords,this.board),B=new Coords(Const.COORDS_BY_USER,this.point2.coords.usrCoords,this.board),Z=JXG$1.evaluate(this.visProp.straightfirst),w=JXG$1.evaluate(this.visProp.straightlast);if((Z||w)&&Geometry.calcStraight(this,G,B,0),G=G.scrCoords,B=B.scrCoords,!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(o){case"last":n=B[1],t=B[2];break;case"first":n=G[1],t=G[2];break;case"lft":case"llft":case"ulft":G[1]<B[1]+Mat.eps?(n=G[1],t=G[2]):(n=B[1],t=B[2]);break;case"rt":case"lrt":case"urt":G[1]>B[1]+Mat.eps?(n=G[1],t=G[2]):(n=B[1],t=B[2]);break;default:n=.5*(G[1]+B[1]),t=.5*(G[2]+B[2])}else r=JXG$1.parsePosition(o),u=JXG$1.parseNumber(r.pos,1,1),d=B[1]-G[1],C=B[2]-G[2],I=Mat.hypot(d,C),r.pos.indexOf("px")>=0||r.pos.indexOf("fr")>=0||r.pos.indexOf("%")>=0?(r.pos.indexOf("px")>=0&&(u/=I),n=G[1]+u*d,t=G[2]+u*C):(n=G[1]+u*this.board.unitX*d/I,t=G[2]+u*this.board.unitY*C/I),r.side==="left"?d*=-1:C*=-1,JXG$1.exists(this.label)&&(f=.5*JXG$1.evaluate(this.label.visProp.distance)/I),n+=C*this.label.size[0]*f,t+=d*this.label.size[1]*f;return(Z||w)&&(JXG$1.exists(this.label)&&(A=JXG$1.evaluate(this.label.visProp.fontsize)),Math.abs(n)<Mat.eps?n=A:this.board.canvasWidth+Mat.eps>n&&n>this.board.canvasWidth-A-Mat.eps&&(n=this.board.canvasWidth-A),Mat.eps+A>t&&t>-Mat.eps?t=A:this.board.canvasHeight+Mat.eps>t&&t>this.board.canvasHeight-A-Mat.eps&&(t=this.board.canvasHeight-A)),new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board)},cloneToBackground:function(){var n={},t,o,r;return n.id=this.id+"T"+this.numTraces,n.elementClass=Const.OBJECT_CLASS_LINE,this.numTraces++,n.point1=this.point1,n.point2=this.point2,n.stdform=this.stdform,n.board=this.board,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},o=this.getSlope(),t=this.getRise(),n.getSlope=function(){return o},n.getRise=function(){return t},r=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawLine(n),this.board.renderer.enhancedRendering=r,this.traces[n.id]=n.rendNode,this},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],r=o.length;for(t=0;t<r;t++)this.point1.transformations.push(o[t]),this.point2.transformations.push(o[t]);return this},snapToGrid:function(n){var t,o,r,u,d,C,I,f,A;return JXG$1.evaluate(this.visProp.snaptogrid)?this.parents.length<3?(this.point1.handleSnapToGrid(!0,!0),this.point2.handleSnapToGrid(!0,!0)):JXG$1.exists(n)&&(f=JXG$1.evaluate(this.visProp.snapsizex),A=JXG$1.evaluate(this.visProp.snapsizey),t=new Coords(Const.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this.board),C=t.usrCoords[1],I=t.usrCoords[2],f<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(d=this.board.defaultAxes.x.defaultTicks,f=d.ticksDelta*(JXG$1.evaluate(d.visProp.minorticks)+1)),A<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(d=this.board.defaultAxes.y.defaultTicks,A=d.ticksDelta*(JXG$1.evaluate(d.visProp.minorticks)+1)),f>0&&A>0&&(o=Geometry.projectPointToLine({coords:t},this,this.board),r=Statistics.subtract([1,Math.round(C/f)*f,Math.round(I/A)*A],o.usrCoords),u=this.board.create("transform",r.slice(1),{type:"translate"}),u.applyOnce([this.point1,this.point2]))):(this.point1.handleSnapToGrid(!1,!0),this.point2.handleSnapToGrid(!1,!0)),this},snapToPoints:function(){var n=JXG$1.evaluate(this.visProp.snaptopoints);return this.parents.length<3&&(this.point1.handleSnapToPoints(n),this.point2.handleSnapToPoints(n)),this},X:function(n){var t,o=this.stdform[2];return t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[1]:this.point2.coords.usrCoords[1],n=(n-.5)*2,(1-Math.abs(n))*t-n*o},Y:function(n){var t,o=this.stdform[1];return t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[2]:this.point2.coords.usrCoords[2],n=(n-.5)*2,(1-Math.abs(n))*t+n*o},Z:function(n){var t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[0]:this.point2.coords.usrCoords[0];return n=(n-.5)*2,(1-Math.abs(n))*t},L:function(){return this.point1.Dist(this.point2)},setFixedLength:function(n){return this.hasFixedLength?(this.fixedLength=JXG$1.createFunction(n,this.board),this.hasFixedLength=!0,this.addParentsFromJCFunctions([this.fixedLength]),this.board.update(),this):this},minX:function(){return 0},maxX:function(){return 1},bounds:function(){var n=this.point1.coords.usrCoords,t=this.point2.coords.usrCoords;return[Math.min(n[1],t[1]),Math.max(n[2],t[2]),Math.max(n[1],t[1]),Math.min(n[2],t[2])]},remove:function(){this.removeAllTicks(),GeometryElement.prototype.remove.call(this)}});JXG$1.createLine=function(n,t,o){var r,u,d,C,I,f,A=[],G=!1,B=!1,Z;if(t.length===2){if(f=JXG$1.copyAttributes(o,n.options,"line","point1"),JXG$1.isArray(t[0])&&t[0].length>1)d=n.create("point",t[0],f);else if(JXG$1.isString(t[0])||JXG$1.isPoint(t[0]))d=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))d=t[0](),B=!0;else if(JXG$1.isFunction(t[0])&&t[0]().length&&t[0]().length>=2)d=JXG$1.createPoint(n,t[0](),f),B=!0;else if(JXG$1.isObject(t[0])&&JXG$1.isTransformationOrArray(t[1]))G=!0,d=n.create("point",[t[0].point1,t[1]],f);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);if(f=JXG$1.copyAttributes(o,n.options,"line","point2"),G)C=n.create("point",[t[0].point2,t[1]],f);else if(JXG$1.isArray(t[1])&&t[1].length>1)C=n.create("point",t[1],f);else if(JXG$1.isString(t[1])||JXG$1.isPoint(t[1]))C=n.select(t[1]);else if(JXG$1.isFunction(t[1])&&JXG$1.isPoint(t[1]()))C=t[1](),B=!0;else if(JXG$1.isFunction(t[1])&&t[1]().length&&t[1]().length>=2)C=JXG$1.createPoint(n,t[1](),f),B=!0;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);f=JXG$1.copyAttributes(o,n.options,"line"),u=new JXG$1.Line(n,d,C,f),B?(u.constrained=!0,u.funp1=t[0],u.funp2=t[1]):G||(u.isDraggable=!0),u.setParents([d.id,C.id])}else if(t.length===3){for(Z=!0,I=0;I<3;I++)if(JXG$1.isNumber(t[I]))A[I]=JXG$1.createFunction(t[I]);else if(JXG$1.isFunction(t[I]))A[I]=t[I],Z=!1;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);f=JXG$1.copyAttributes(o,n.options,"line","point1"),Z?d=n.create("point",[A[2]()*A[2]()+A[1]()*A[1](),A[2]()-A[1]()*A[0]()+A[2](),-A[1]()-A[2]()*A[0]()-A[1]()],f):d=n.create("point",[function(){return(A[2]()*A[2]()+A[1]()*A[1]())*.5},function(){return(A[2]()-A[1]()*A[0]()+A[2]())*.5},function(){return(-A[1]()-A[2]()*A[0]()-A[1]())*.5}],f),f=JXG$1.copyAttributes(o,n.options,"line","point2"),Z?C=n.create("point",[A[2]()*A[2]()+A[1]()*A[1](),-A[1]()*A[0]()+A[2](),-A[2]()*A[0]()-A[1]()],f):C=n.create("point",[function(){return A[2]()*A[2]()+A[1]()*A[1]()},function(){return-A[1]()*A[0]()+A[2]()},function(){return-A[2]()*A[0]()-A[1]()}],f),d.prepareUpdate().update(),C.prepareUpdate().update(),f=JXG$1.copyAttributes(o,n.options,"line"),u=new JXG$1.Line(n,d,C,f),u.isDraggable=Z,u.setParents([d,C])}else if(t.length===1&&JXG$1.isFunction(t[0])&&t[0]().length===2&&JXG$1.isPoint(t[0]()[0])&&JXG$1.isPoint(t[0]()[1]))r=t[0](),f=JXG$1.copyAttributes(o,n.options,"line"),u=new JXG$1.Line(n,r[0],r[1],f),u.constrained=!0,u.funps=t[0],u.setParents(r);else if(t.length===1&&JXG$1.isFunction(t[0])&&t[0]().length===3&&JXG$1.isNumber(t[0]()[0])&&JXG$1.isNumber(t[0]()[1])&&JXG$1.isNumber(t[0]()[2]))r=t[0],f=JXG$1.copyAttributes(o,n.options,"line","point1"),d=n.create("point",[function(){var w=r();return[(w[2]*w[2]+w[1]*w[1])*.5,(w[2]-w[1]*w[0]+w[2])*.5,(-w[1]-w[2]*w[0]-w[1])*.5]}],f),f=JXG$1.copyAttributes(o,n.options,"line","point2"),C=n.create("point",[function(){var w=r();return[w[2]*w[2]+w[1]*w[1],-w[1]*w[0]+w[2],-w[2]*w[0]-w[1]]}],f),f=JXG$1.copyAttributes(o,n.options,"line"),u=new JXG$1.Line(n,d,C,f),u.constrained=!0,u.funps=t[0],u.setParents([d,C]);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);return u};JXG$1.registerElement("line",JXG$1.createLine);JXG$1.createSegment=function(n,t,o){var r,u;if(o.straightFirst=!1,o.straightLast=!1,u=JXG$1.copyAttributes(o,n.options,"segment"),r=n.create("line",t.slice(0,2),u),t.length===3){try{r.hasFixedLength=!0,r.fixedLengthOldCoords=[],r.fixedLengthOldCoords[0]=new Coords(Const.COORDS_BY_USER,r.point1.coords.usrCoords.slice(1,3),n),r.fixedLengthOldCoords[1]=new Coords(Const.COORDS_BY_USER,r.point2.coords.usrCoords.slice(1,3),n),r.setFixedLength(t[2])}catch{throw new Error("JSXGraph: Can't create segment with third parent type '"+typeof t[2]+`'.
Possible third parent types: number or function`)}r.getParents=function(){return this.parents.concat(this.fixedLength())}}return r.elType="segment",r};JXG$1.registerElement("segment",JXG$1.createSegment);JXG$1.createArrow=function(n,t,o){var r,u;return o.straightFirst=!1,o.straightLast=!1,u=JXG$1.copyAttributes(o,n.options,"arrow"),r=n.create("line",t,u),r.type=Const.OBJECT_TYPE_VECTOR,r.elType="arrow",r};JXG$1.registerElement("arrow",JXG$1.createArrow);JXG$1.createAxis=function(n,t,o){var r,u,d,C;u=JXG$1.copyAttributes(o,n.options,"axis");try{r=n.create("line",t,u)}catch{throw new Error("JSXGraph: Can't create axis with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}r.type=Const.OBJECT_TYPE_AXIS,r.isDraggable=!1,r.point1.isDraggable=!1,r.point2.isDraggable=!1,r._point1UsrCoordsOrg=r.point1.coords.usrCoords.slice(),r._point2UsrCoordsOrg=r.point2.coords.usrCoords.slice();for(d in r.ancestors)r.ancestors.hasOwnProperty(d)&&(r.ancestors[d].type=Const.OBJECT_TYPE_AXISPOINT);return JXG$1.exists(u.ticks.ticksdistance)?C=u.ticks.ticksdistance:JXG$1.isArray(u.ticks.ticks)?C=u.ticks.ticks:C=1,r.defaultTicks=n.create("ticks",[r,C],u.ticks),r.defaultTicks.dump=!1,r.elType="axis",r.subs={ticks:r.defaultTicks},r.inherits.push(r.defaultTicks),r.update=function(){var I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee;if(I=this.board.getBoundingBox(),f=JXG$1.evaluate(this.visProp.position),G=this.Direction(),B=this.isHorizontal(),Z=this.isVertical(),w=JXG$1.evaluate(this.visProp.ticksautopos),V=JXG$1.evaluate(this.visProp.ticksautoposthreshold),B?V=JXG$1.parseNumber(V,Math.abs(I[1]-I[3]),1/this.board.unitX)*this.board.unitX:Z?V=JXG$1.parseNumber(V,Math.abs(I[1]-I[3]),1/this.board.unitY)*this.board.unitY:V=JXG$1.parseNumber(V,1,1),J=JXG$1.evaluate(this.visProp.anchor),T=J.indexOf("left")>-1,L=J.indexOf("right")>-1,z=JXG$1.evaluate(this.visProp.anchordist),B?z=JXG$1.parseNumber(z,Math.abs(I[1]-I[3]),1/this.board.unitX):Z?z=JXG$1.parseNumber(z,Math.abs(I[0]-I[2]),1/this.board.unitY):z=0,$=this.board.getPointLoc(this._point1UsrCoordsOrg,z),K=this.point1.coords.usrCoords.slice(),P=this.point2.coords.usrCoords.slice(),f==="static"||!Z&&!B||(f==="fixed"?(B&&(G[0]>0&&L||G[0]<0&&T?(K[2]=I[3]+z,P[2]=I[3]+z):G[0]>0&&T||G[0]<0&&L?(K[2]=I[1]-z,P[2]=I[1]-z):(K=this._point1UsrCoordsOrg.slice(),P=this._point2UsrCoordsOrg.slice())),Z&&(G[1]>0&&T||G[1]<0&&L?(K[1]=I[0]+z,P[1]=I[0]+z):G[1]>0&&L||G[1]<0&&T?(K[1]=I[2]-z,P[1]=I[2]-z):(K=this._point1UsrCoordsOrg.slice(),P=this._point2UsrCoordsOrg.slice()))):f==="sticky"&&(B&&($[1]<0&&(G[0]>0&&L||G[0]<0&&T)?(K[2]=I[3]+z,P[2]=I[3]+z):$[1]>0&&(G[0]>0&&T||G[0]<0&&L)?(K[2]=I[1]-z,P[2]=I[1]-z):(K=this._point1UsrCoordsOrg.slice(),P=this._point2UsrCoordsOrg.slice())),Z&&($[0]<0&&(G[1]>0&&T||G[1]<0&&L)?(K[1]=I[0]+z,P[1]=I[0]+z):$[0]>0&&(G[1]>0&&L||G[1]<0&&T)?(K[1]=I[2]-z,P[1]=I[2]-z):(K=this._point1UsrCoordsOrg.slice(),P=this._point2UsrCoordsOrg.slice())))),this.point1.setPositionDirectly(JXG$1.COORDS_BY_USER,K),this.point2.setPositionDirectly(JXG$1.COORDS_BY_USER,P),JXG$1.exists(this.defaultTicks)){if(ie=this.defaultTicks.visProp.label,w&&(B||Z)){if(JXG$1.exists(ie._anchorx_org)||(ie._anchorx_org=JXG$1.def(ie.anchorx,this.board.options.text.anchorX)),JXG$1.exists(ie._anchory_org)||(ie._anchory_org=JXG$1.def(ie.anchory,this.board.options.text.anchorY)),JXG$1.exists(ie._offset_org)||(ie._offset_org=ie.offset.slice()),ee=ie.offset,B){for(Y=r.point1.coords.scrCoords[2]-this.board.canvasHeight*.5,ne=ie.anchory,Y<0&&Math.abs(Y)>V?ie._side==="bottom"&&(ie.anchory==="top"&&(ne="bottom"),ee[1]*=-1,ie._side="top"):Y>0&&Math.abs(Y)>V?ie._side==="top"&&(ie.anchory==="bottom"&&(ne="top"),ee[1]*=-1,ie._side="bottom"):(ne=ie._anchory_org,ee=ie._offset_org.slice(),ne==="top"?ie._side="bottom":ne==="bottom"?ie._side="top":ee[1]<0?ie._side="bottom":ie._side="top"),A=0;A<r.defaultTicks.labels.length;A++)this.defaultTicks.labels[A].visProp.anchory=ne;ie.anchory=ne}else if(Z){for(Y=r.point1.coords.scrCoords[1]-this.board.canvasWidth*.5,Y<0&&Math.abs(Y)>V?ie._side==="right"&&(ie.anchorx==="left"&&(ne="right"),ee[0]*=-1,ie._side="left"):Y>0&&Math.abs(Y)>V?ie._side==="left"&&(ie.anchorx==="right"&&(ne="left"),ee[0]*=-1,ie._side="right"):(ne=ie._anchorx_org,ee=ie._offset_org.slice(),ne==="left"?ie._side="right":ne==="right"||ee[0]<0?ie._side="left":ie._side="right"),A=0;A<r.defaultTicks.labels.length;A++)this.defaultTicks.labels[A].visProp.anchorx=ne;ie.anchorx=ne}ie.offset=ee}else delete ie._anchorx_org,delete ie._anchory_org,delete ie._offset_org;this.defaultTicks.needsUpdate=!0}return JXG$1.Line.prototype.update.call(this),this},r};JXG$1.registerElement("axis",JXG$1.createAxis);JXG$1.createTangent=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z=[];if(t.length===1)r=t[0],u=r.slideObject;else if(t.length===2)if(JXG$1.isPoint(t[0]))r=t[0],u=t[1];else if(JXG$1.isPoint(t[1]))u=t[0],r=t[1];else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);if(f=JXG$1.copyAttributes(o,n.options,"tangent"),u.elementClass===Const.OBJECT_CLASS_LINE)I=n.create("line",[u.point1,u.point2],f),I.glider=r;else if(u.elementClass===Const.OBJECT_CLASS_CURVE&&u.type!==Const.OBJECT_TYPE_CONIC){if(G=u.getTransformationSource(),B=G[0],B)for(Z.push(u);G[0]&&JXG$1.exists(G[1]._transformationSource);)Z.push(G[1]),G=G[1].getTransformationSource();JXG$1.evaluate(u.visProp.curvetype)!=="plot"||B?(I=n.create("line",[function(){var w=u.X,V=u.Y,Y,J,T,L,z,K,P,$;if(r.type===Const.OBJECT_TYPE_GLIDER?$=r.position:JXG$1.evaluate(u.visProp.curvetype)==="functiongraph"?$=r.X():$=Geometry.projectPointToCurve(r,u,n)[1],P=r.Coords(!0),B){for(z=Z[Z.length-1]._transformationSource,w=z.X,V=z.Y,L=0;L<Z.length;L++)Z[L].updateTransformMatrix(),K=Mat.inverse(Z[L].transformMat),P=Mat.matVecMult(K,P);r.type!==Const.OBJECT_TYPE_GLIDER&&(P[1]/=P[0],P[2]/=P[0],P[0]/=P[0],$=Geometry.projectCoordsToCurve(P[1],P[2],0,z,n)[1])}if(Y=Numerics.D(V)($),J=Numerics.D(w)($),T=[-P[1]*Y+P[2]*J,P[0]*Y,-P[0]*J],B)for(L=Z.length-1;L>=0;L--)K=Mat.transpose(Mat.inverse(Z[L].transformMat)),T=Mat.matVecMult(K,T);return T}],f),r.addChild(I),I.glider=r):(A=function(w,V,Y){var J=Math.floor(w),T,L,z,K,P,$,ie,ne,ee,se,re,ce;if(V.bezierDegree===1)J===V.numberPoints-1&&J--;else if(V.bezierDegree===3)V.elType==="sector"?(re=V.points.slice(3,V.numberPoints-3),ce=re.length):(re=V.points,ce=re.length),J=Math.floor(w*(ce-1)/3)*3,z=(w*(ce-1)-J)/3,J>=ce-1&&(J=ce-4,z=1);else return 0;if(J<0)return 1;switch(V.bezierDegree===1?(T=V.points[J].usrCoords,L=V.points[J+1].usrCoords):(K=re[J].usrCoords,P=re[J+1].usrCoords,$=re[J+2].usrCoords,ie=re[J+3].usrCoords,ne=(1-z)*(1-z)*(P[1]-K[1])+2*(1-z)*z*($[1]-P[1])+z*z*(ie[1]-$[1]),ee=(1-z)*(1-z)*(P[2]-K[2])+2*(1-z)*z*($[2]-P[2])+z*z*(ie[2]-$[2]),se=Mat.hypot(ne,ee),ne/=se,ee/=se,T=r.coords.usrCoords,L=[1,T[1]+ne,T[2]+ee]),Y){case 0:return T[2]*L[1]-T[1]*L[2];case 1:return L[2]-T[2];case 2:return T[1]-L[1];default:return[T[2]*L[1]-T[1]*L[2],L[2]-T[2],T[1]-L[1]]}},I=n.create("line",[function(){var w;return r.type===Const.OBJECT_TYPE_GLIDER?w=r.position:w=Geometry.projectPointToCurve(r,u,n)[1],A(w,u)}],f),r.addChild(I),I.glider=r)}else u.type===Const.OBJECT_TYPE_TURTLE?(I=n.create("line",[function(){var w,V;for(r.type===Const.OBJECT_TYPE_GLIDER?V=r.position:V=Geometry.projectPointToTurtle(r,u,n)[1],w=Math.floor(V),d=0;d<u.objects.length;d++)if(C=u.objects[d],C.type===Const.OBJECT_TYPE_CURVE){if(w<C.numberPoints)break;w-=C.numberPoints}return w===C.numberPoints-1&&w--,w<0?[1,0,0]:[C.Y(w)*C.X(w+1)-C.X(w)*C.Y(w+1),C.Y(w+1)-C.Y(w),C.X(w)-C.X(w+1)]}],f),r.addChild(I),I.glider=r):(u.elementClass===Const.OBJECT_CLASS_CIRCLE||u.type===Const.OBJECT_TYPE_CONIC)&&(I=n.create("line",[function(){return Mat.matVecMult(u.quadraticform,r.coords.usrCoords)}],f),r.addChild(I),I.glider=r);if(!JXG$1.exists(I))throw new Error("JSXGraph: Couldn't create tangent with the given parents.");return I.elType="tangent",I.type=Const.OBJECT_TYPE_TANGENT,I.setParents(t),I};JXG$1.createNormal=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w=[];for(C=0;C<t.length;++C)t[C]=n.select(t[C]);if(t.length===1)r=t[0],u=r.slideObject;else if(t.length===2)if(JXG$1.isPointType(n,t[0]))r=JXG$1.providePoints(n,[t[0]],o,"point")[0],u=t[1];else if(JXG$1.isPointType(n,t[1]))u=t[0],r=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);if(I=JXG$1.copyAttributes(o,n.options,"normal"),u.elementClass===Const.OBJECT_CLASS_LINE)A=JXG$1.copyAttributes(o,n.options,"normal","point"),f=n.create("point",[function(){var V=Mat.crossProduct([1,0,0],u.stdform);return[V[0],-V[2],V[1]]}],A),f.isDraggable=!0,d=n.create("line",[r,f],I),d.point=f,d.subs={point:f},d.inherits.push(f);else if(u.elementClass===Const.OBJECT_CLASS_CIRCLE)d=n.create("line",[u.midpoint,r],I);else if(u.elementClass===Const.OBJECT_CLASS_CURVE){if(B=u.getTransformationSource(),Z=B[0],Z)for(w.push(u);B[0]&&JXG$1.exists(B[1]._transformationSource);)w.push(B[1]),B=B[1].getTransformationSource();JXG$1.evaluate(u.visProp.curvetype)!=="plot"||Z?d=n.create("line",[function(){var V=u.X,Y=u.Y,J,T,L,z,K,P,$,ie;if(r.type===Const.OBJECT_TYPE_GLIDER?ie=r.position:JXG$1.evaluate(u.visProp.curvetype)==="functiongraph"?ie=r.X():ie=Geometry.projectPointToCurve(r,u,n)[1],$=r.Coords(!0),Z){for(K=w[w.length-1]._transformationSource,V=K.X,Y=K.Y,z=0;z<w.length;z++)w[z].updateTransformMatrix(),P=Mat.inverse(w[z].transformMat),$=Mat.matVecMult(P,$);r.type!==Const.OBJECT_TYPE_GLIDER&&($[1]/=$[0],$[2]/=$[0],$[0]/=$[0],ie=Geometry.projectCoordsToCurve($[1],$[2],0,K,n)[1])}if(J=Numerics.D(Y)(ie),T=Numerics.D(V)(ie),L=[-$[1]*T-$[2]*J,$[0]*T,$[0]*J],Z)for(z=w.length-1;z>=0;z--)P=Mat.transpose(Mat.inverse(w[z].transformMat)),L=Mat.matVecMult(P,L);return L}],I):(G=function(V,Y,J){var T=Math.floor(V),L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se,Ce,Ze;if(Y.bezierDegree===1)T===Y.numberPoints-1&&T--,P=V;else if(Y.bezierDegree===3)Y.elType==="sector"?(Ce=Y.points.slice(3,Y.numberPoints-3),Ze=Ce.length):(Ce=Y.points,Ze=Ce.length),T=Math.floor(V*(Ze-1)/3)*3,P=(V*(Ze-1)-T)/3,T>=Ze-1&&(T=Ze-4,P=1);else return 0;if(T<0)return 1;switch(L=P-T,Y.bezierDegree===1?(z=Y.points[T].usrCoords,K=Y.points[T+1].usrCoords,ye=[z[0]+L*(K[0]-z[0]),z[1]+L*(K[1]-z[1]),z[2]+L*(K[2]-z[2])],ue=Mat.crossProduct(z,K),Se=Mat.crossProduct([1,0,0],ue),Se=[Se[0],-Se[2],Se[1]],ue=Mat.crossProduct(ye,Se)):($=Ce[T].usrCoords,ie=Ce[T+1].usrCoords,ne=Ce[T+2].usrCoords,ee=Ce[T+3].usrCoords,se=(1-P)*(1-P)*(ie[1]-$[1])+2*(1-P)*P*(ne[1]-ie[1])+P*P*(ee[1]-ne[1]),re=(1-P)*(1-P)*(ie[2]-$[2])+2*(1-P)*P*(ne[2]-ie[2])+P*P*(ee[2]-ne[2]),ce=Mat.hypot(se,re),se/=ce,re/=ce,z=r.coords.usrCoords,K=[1,z[1]-re,z[2]+se],ue=[z[2]*K[1]-z[1]*K[2],K[2]-z[2],z[1]-K[1]]),J){case 0:return ue[0];case 1:return ue[1];case 2:return ue[2];default:return ue}},d=n.create("line",[function(){var V;return r.type===Const.OBJECT_TYPE_GLIDER?V=r.position:V=Geometry.projectPointToCurve(r,u,n)[1],G(V,u)}],I),r.addChild(d),d.glider=r)}else if(u.type===Const.OBJECT_TYPE_TURTLE)d=n.create("line",[function(){var V,Y,J=Math.floor(r.position),T=r.position-J;for(Y=0;Y<u.objects.length;Y++)if(V=u.objects[Y],V.type===Const.OBJECT_TYPE_CURVE){if(J<V.numberPoints)break;J-=V.numberPoints}return J===V.numberPoints-1&&(J-=1,T=1),J<0?1:(V.Y(J)+T*(V.Y(J+1)-V.Y(J)))*(V.Y(J)-V.Y(J+1))-(V.X(J)+T*(V.X(J+1)-V.X(J)))*(V.X(J+1)-V.X(J))},function(){var V,Y,J=Math.floor(r.position);for(Y=0;Y<u.objects.length;Y++)if(V=u.objects[Y],V.type===Const.OBJECT_TYPE_CURVE){if(J<V.numberPoints)break;J-=V.numberPoints}return J===V.numberPoints-1&&(J-=1),J<0?0:V.X(J+1)-V.X(J)},function(){var V,Y,J=Math.floor(r.position);for(Y=0;Y<u.objects.length;Y++)if(V=u.objects[Y],V.type===Const.OBJECT_TYPE_CURVE){if(J<V.numberPoints)break;J-=V.numberPoints}return J===V.numberPoints-1&&(J-=1),J<0?0:V.Y(J+1)-V.Y(J)}],I);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);return d.elType="normal",d.setParents(t),JXG$1.exists(r._is_new)?(d.addChild(r),delete r._is_new):r.addChild(d),u.addChild(d),d};JXG$1.createRadicalAxis=function(n,t,o){var r,u,d;if(t.length!==2||t[0].elementClass!==Const.OBJECT_CLASS_CIRCLE||t[1].elementClass!==Const.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create 'radical axis' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [circle,circle]`);return u=n.select(t[0]),d=n.select(t[1]),r=n.create("line",[function(){var C=u.stdform,I=d.stdform;return Mat.matVecMult(Mat.transpose([C.slice(0,3),I.slice(0,3)]),[I[3],-C[3]])}],o),r.elType="radicalaxis",r.setParents([u.id,d.id]),u.addChild(r),d.addChild(r),r};JXG$1.createPolarLine=function(n,t,o){var r,u,d,C,I,f,A;if(t.length>1&&(C=t[0].type===Const.OBJECT_TYPE_CONIC||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE,I=t[1].type===Const.OBJECT_TYPE_CONIC||t[1].elementClass===Const.OBJECT_CLASS_CIRCLE,f=JXG$1.isPoint(t[0]),A=JXG$1.isPoint(t[1])),t.length!==2||!(C&&A||f&&I))throw new Error("JSXGraph: Can't create 'polar line' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [conic|circle,point], [point,conic|circle]`);return A?(u=n.select(t[0]),d=n.select(t[1])):(u=n.select(t[1]),d=n.select(t[0])),r=n.create("tangent",[u,d],o),r.elType="polarline",r};JXG$1.createTangentTo=function(n,t,o){var r,u,d,C,I,f,A;if(d=n.select(t[0]),C=JXG$1.providePoints(n,t[1],o,"point")[0],I=JXG$1.def(t[2],0),d.type!==Const.OBJECT_TYPE_CIRCLE&&d.type!==Const.OBJECT_TYPE_CONIC||C.elementClass!==Const.OBJECT_CLASS_POINT)throw new Error("JSXGraph: Can't create tangentto with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [circle|conic,point,number]`);return u=JXG$1.copyAttributes(o,n.options,"tangentto"),A=n.create("polar",[d,C],u.polar),f=n.create("intersection",[A,d,I],u.point),r=n.create("tangent",[d,f],u),r.point=f,r.polar=A,r.elType="tangentto",r};JXG$1.registerElement("tangent",JXG$1.createTangent);JXG$1.registerElement("normal",JXG$1.createNormal);JXG$1.registerElement("tangentto",JXG$1.createTangentTo);JXG$1.registerElement("polar",JXG$1.createTangent);JXG$1.registerElement("radicalaxis",JXG$1.createRadicalAxis);JXG$1.registerElement("polarline",JXG$1.createPolarLine);JXG$1.Line;JXG$1.Group=function(n,t,o,r,u){var d,C,I,f;for(this.board=n,this.objects={},d=this.board.numObjects,this.board.numObjects+=1,t===""||!JXG$1.exists(t)?this.id=this.board.id+"Group"+d:this.id=t,this.board.groups[this.id]=this,this.type=Const.OBJECT_TYPE_POINT,this.elementClass=Const.OBJECT_CLASS_POINT,o===""||!JXG$1.exists(o)?this.name="group_"+this.board.generateName(this):this.name=o,delete this.type,this.coords={},this.needsRegularUpdate=u.needsregularupdate,this.rotationCenter="centroid",this.scaleCenter=null,this.rotationPoints=[],this.translationPoints=[],this.scalePoints=[],this.scaleDirections={},this.parents=[],JXG$1.isArray(r)?C=r:C=Array.prototype.slice.call(arguments,3),I=0;I<C.length;I++)f=this.board.select(C[I]),!JXG$1.evaluate(f.visProp.fixed)&&JXG$1.exists(f.coords)&&this.addPoint(f);this.methodMap={ungroup:"ungroup",add:"addPoint",addPoint:"addPoint",addPoints:"addPoints",addGroup:"addGroup",remove:"removePoint",removePoint:"removePoint",setAttribute:"setAttribute",setProperty:"setAttribute"}};JXG$1.extend(JXG$1.Group.prototype,{ungroup:function(){var n,t,o;for(n in this.objects)this.objects.hasOwnProperty(n)&&(t=this.objects[n].point,JXG$1.isArray(t.groups)&&(o=JXG$1.indexOf(t.groups,this.id),o>=0&&delete t.groups[o]));return this.objects={},this},addParents:function(n){var t,o,r;for(JXG$1.isArray(n)?r=n:r=arguments,o=r.length,t=0;t<o;++t)JXG$1.isId(this.board,r[t])?this.parents.push(r[t]):JXG$1.exists(r[t].id)&&this.parents.push(r[t].id);this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(n){return this.parents=[],this.addParents(n),this},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},_updateCoordsCache:function(n){var t;n!==""&&JXG$1.exists(this.objects[n])&&(t=this.objects[n].point,this.coords[t.id]={usrCoords:t.coords.usrCoords.slice(0)})},update:function(){var n,t,o,r,u,d,C,I,f,A,G=null;if(!this.needsUpdate)return this;if(n=this._update_find_drag_type(),n.action==="nothing")return this._updateCoordsCache(n.id),this;if(G=this.objects[n.id].point,n.action==="translation")f=[G.coords.usrCoords[1]-this.coords[n.id].usrCoords[1],G.coords.usrCoords[2]-this.coords[n.id].usrCoords[2]];else if(n.action==="rotation"||n.action==="scaling"){if(n.action==="rotation"?o="rotationCenter":o="scaleCenter",JXG$1.isPoint(this[o]))A=this[o].coords.usrCoords.slice(1);else if(this[o]==="centroid")A=this._update_centroid_center();else if(JXG$1.isArray(this[o]))A=this[o];else if(JXG$1.isFunction(this[o]))A=this[o]();else return this;if(n.action==="rotation")I=Geometry.rad(this.coords[n.id].usrCoords.slice(1),A,this.objects[n.id].point),f=this.board.create("transform",[I,A[0],A[1]],{type:"rotate"}),f.update();else if(n.action==="scaling"){if(u=Geometry.distance(this.coords[n.id].usrCoords.slice(1),A),Math.abs(u)<Mat.eps)return this;u=Geometry.distance(G.coords.usrCoords.slice(1),A)/u,d=this.scaleDirections[n.id].indexOf("x")>=0?u:1,C=this.scaleDirections[n.id].indexOf("y")>=0?u:1,f=this.board.create("transform",[1,0,0,A[0]*(1-d),d,0,A[1]*(1-C),0,C],{type:"generic"}),f.update()}else return this}this._update_apply_transformation(n,f),this.needsUpdate=!1;for(t in this.objects)if(this.objects.hasOwnProperty(t))for(r in this.objects[t].descendants)this.objects[t].descendants.hasOwnProperty(r)&&(this.objects[t].descendants.needsUpdate=this.objects[t].descendants.needsRegularUpdate||this.board.needsFullUpdate);this.board.updateElements(n);for(t in this.objects)this.objects.hasOwnProperty(t)&&this._updateCoordsCache(t);return this},_update_find_drag_type:function(){var n,t,o="nothing",r=[],u;for(n in this.objects)this.objects.hasOwnProperty(n)&&(t=this.objects[n].point,t.coords.distance(Const.COORDS_BY_USER,this.coords[n])>Mat.eps&&r.push(t.id));return r.length===0?{action:o,id:"",changed:r}:(u=r[0],t=this.objects[u].point,r.length>1?o="translation":JXG$1.isInArray(this.rotationPoints,t)&&JXG$1.exists(this.rotationCenter)?o="rotation":JXG$1.isInArray(this.scalePoints,t)&&JXG$1.exists(this.scaleCenter)?o="scaling":JXG$1.isInArray(this.translationPoints,t)&&(o="translation"),{action:o,id:u,changed:r})},_update_centroid_center:function(){var n,t,o;n=[0,0],t=0;for(o in this.coords)this.coords.hasOwnProperty(o)&&(n[0]+=this.coords[o].usrCoords[1],n[1]+=this.coords[o].usrCoords[2],++t);return t>0&&(n[0]/=t,n[1]/=t),n},_update_apply_transformation:function(n,t){var o,r;for(o in this.objects)this.objects.hasOwnProperty(o)&&(JXG$1.exists(this.board.objects[o])?(r=this.objects[o].point,r.id!==n.id?n.action==="translation"?JXG$1.isInArray(n.changed,r.id)||r.coords.setCoordinates(Const.COORDS_BY_USER,[this.coords[o].usrCoords[1]+t[0],this.coords[o].usrCoords[2]+t[1]]):(n.action==="rotation"||n.action==="scaling")&&t.applyOnce([r]):(n.action==="rotation"||n.action==="scaling")&&r.coords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(t.matrix,this.coords[r.id].usrCoords))):delete this.objects[o])},addPoint:function(n){return this.objects[n.id]={point:this.board.select(n)},this._updateCoordsCache(n.id),this.translationPoints.push(n),n.groups.push(this.id),n.groups=JXG$1.uniqueArray(n.groups),this},addPoints:function(n){var t;for(t=0;t<n.length;t++)this.addPoint(n[t]);return this},addGroup:function(n){var t;for(t in n.objects)n.objects.hasOwnProperty(t)&&this.addPoint(n.objects[t].point);return this},removePoint:function(n){return delete this.objects[n.id],this},setRotationCenter:function(n){return this.rotationCenter=n,this},setRotationPoints:function(n){return this._setActionPoints("rotation",n)},addRotationPoint:function(n){return this._addActionPoint("rotation",n)},removeRotationPoint:function(n){return this._removeActionPoint("rotation",n)},setTranslationPoints:function(n){return this._setActionPoints("translation",n)},addTranslationPoint:function(n){return this._addActionPoint("translation",n)},removeTranslationPoint:function(n){return this._removeActionPoint("translation",n)},setScaleCenter:function(n){return this.scaleCenter=n,this},setScalePoints:function(n,t){var o,r,u;for(JXG$1.isArray(n)?o=n:o=arguments,u=o.length,r=0;r<u;++r)this.scaleDirections[this.board.select(o[r]).id]=t||"xy";return this._setActionPoints("scale",n)},addScalePoint:function(n,t){return this._addActionPoint("scale",n),this.scaleDirections[this.board.select(n).id]=t||"xy",this},removeScalePoint:function(n){return this._removeActionPoint("scale",n)},_setActionPoints:function(n,t){var o,r,u;for(JXG$1.isArray(t)?o=t:o=arguments,u=o.length,this[n+"Points"]=[],r=0;r<u;++r)this._addActionPoint(n,o[r]);return this},_addActionPoint:function(n,t){return this[n+"Points"].push(this.board.select(t)),this},_removeActionPoint:function(n,t){var o=this[n+"Points"].indexOf(this.board.select(t));return o>-1&&this[n+"Points"].splice(o,1),this},setProperty:function(){JXG$1.deprecated("Group.setProperty","Group.setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(){var n;for(n in this.objects)this.objects.hasOwnProperty(n)&&this.objects[n].point.setAttribute.apply(this.objects[n].point,arguments);return this}});JXG$1.createGroup=function(n,t,o){var r=JXG$1.copyAttributes(o,n.options,"group"),u=new JXG$1.Group(n,r.id,r.name,t,r);return u.elType="group",u.setParents(t),u};JXG$1.registerElement("group",JXG$1.createGroup);JXG$1.Group;JXG$1.Circle=function(n,t,o,r,u){this.constructor(n,u,Const.OBJECT_TYPE_CIRCLE,Const.OBJECT_CLASS_CIRCLE),this.method=t,this.midpoint=this.board.select(o),this.center=this.board.select(o),this.point2=null,this.radius=0,this.line=null,this.circle=null,this.points=[],t==="twoPoints"?(this.point2=n.select(r),this.radius=this.Radius()):t==="pointRadius"?(this.gxtterm=r,this.updateRadius=JXG$1.createFunction(r,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])):t==="pointLine"?(this.line=n.select(r),this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords)):t==="pointCircle"&&(this.circle=n.select(r),this.radius=this.circle.Radius()),this.id=this.board.setId(this,"C"),this.board.renderer.drawEllipse(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="circle",this.createLabel(),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),t==="pointRadius"?this.notifyParents(r):t==="pointLine"?this.line.addChild(this):t==="pointCircle"?this.circle.addChild(this):t==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{setRadius:"setRadius",getRadius:"getRadius",Area:"Area",area:"Area",Perimeter:"Perimeter",Circumference:"Perimeter",radius:"Radius",Radius:"Radius",Diameter:"Diameter",center:"center",line:"line",point2:"point2"})};JXG$1.Circle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Circle.prototype,{hasPoint:function(n,t){var o,r,u=this.center.coords.usrCoords,d=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),C=this.Radius(),I,f,A;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(r=this.board._inputDevice,o=JXG$1.evaluate(this.visProp.precision[r])):o=this.board.options.precision.hasPoint,I=u[1]-d.usrCoords[1],f=u[2]-d.usrCoords[2],A=Mat.hypot(I,f),o+=JXG$1.evaluate(this.visProp.strokewidth)*.5,o/=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY)),JXG$1.evaluate(this.visProp.hasinnerpoints)?A<C+o:Math.abs(A-C)<o},generatePolynomial:function(n){var t=this.center.symbolic.x,o=this.center.symbolic.y,r=n.symbolic.x,u=n.symbolic.y,d=this.generateRadiusSquared();return d===""?[]:["(("+r+")-("+t+"))^2 + (("+u+")-("+o+"))^2 - ("+d+")"]},generateRadiusSquared:function(){var n,t,o,r,u,d,C="";return this.method==="twoPoints"?(n=this.center.symbolic.x,t=this.center.symbolic.y,o=this.point2.symbolic.x,r=this.point2.symbolic.y,C="(("+o+")-("+n+"))^2 + (("+r+")-("+t+"))^2"):this.method==="pointRadius"?JXG$1.isNumber(this.radius)&&(C=(this.radius*this.radius).toString()):this.method==="pointLine"?(o=this.line.point1.symbolic.x,r=this.line.point1.symbolic.y,u=this.line.point2.symbolic.x,d=this.line.point2.symbolic.y,C="(("+o+")-("+u+"))^2 + (("+r+")-("+d+"))^2"):this.method==="pointCircle"&&(C=this.circle.Radius()),C},update:function(){var n,t,o,r,u,d;if(this.needsUpdate)for(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.method==="pointLine"?this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords):this.method==="pointCircle"?this.radius=this.circle.Radius():this.method==="pointRadius"&&(this.radius=this.updateRadius()),this.radius=Math.abs(this.radius),this.updateStdform(),this.updateQuadraticform(),o=this.center.coords.usrCoords[0],n=this.center.coords.usrCoords[1]/o,t=this.center.coords.usrCoords[2]/o,o/=o,r=this.Radius(),u=.551915024494,this.numberPoints=13,this.dataX=[n+r,n+r,n+r*u,n,n-r*u,n-r,n-r,n-r,n-r*u,n,n+r*u,n+r,n+r],this.dataY=[t,t+r*u,t+r,t+r,t+r,t+r*u,t,t-r*u,t-r,t-r,t-r,t-r*u,t],this.bezierDegree=3,d=0;d<this.numberPoints;d++)this.points[d]=new Coords(Const.COORDS_BY_USER,[this.dataX[d],this.dataY[d]],this.board);return this},updateQuadraticform:function(){var n=this.center,t=n.X(),o=n.Y(),r=this.Radius();this.quadraticform=[[t*t+o*o-r*r,-t,-o],[-t,1,0],[-o,0,1]]},updateStdform:function(){this.stdform[3]=.5,this.stdform[4]=this.Radius(),this.stdform[1]=-this.center.coords.usrCoords[1],this.stdform[2]=-this.center.coords.usrCoords[2],isFinite(this.stdform[4])||(this.stdform[0]=JXG$1.exists(this.point2)?-(this.stdform[1]*this.point2.coords.usrCoords[1]+this.stdform[2]*this.point2.coords.usrCoords[2]):0),this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.center.coords.usrCoords[1]+this.center.coords.usrCoords[2]+this.Radius())&&this.center.isReal,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateEllipse(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},notifyParents:function(n){JXG$1.isString(n)&&GeonextParser.findDependencies(this,n,this.board)},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):this.method==="twoPoints"?JXG$1.cmpArrays(this.point2.coords.usrCoords,[0,0,0])||JXG$1.cmpArrays(this.center.coords.usrCoords,[0,0,0])?NaN:this.center.Dist(this.point2):this.method==="pointLine"||this.method==="pointCircle"?this.radius:this.method==="pointRadius"?JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.updateRadius()):Math.abs(this.updateRadius()):NaN},Diameter:function(){return 2*this.Radius()},getRadius:function(){return JXG$1.deprecated("Circle.getRadius()","Circle.Radius()"),this.Radius()},getTextAnchor:function(){return this.center.coords},getLabelAnchor:function(){var n,t,o,r,u,d,C=1.5,I=this.Radius(),f=this.center.coords.usrCoords,A=.7071067811865;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"lft":n=f[1]-I,t=f[2];break;case"llft":n=f[1]-A*I,t=f[2]-A*I;break;case"rt":n=f[1]+I,t=f[2];break;case"lrt":n=f[1]+A*I,t=f[2]-A*I;break;case"urt":n=f[1]+A*I,t=f[2]+A*I;break;case"top":n=f[1],t=f[2]+I;break;case"bot":n=f[1],t=f[2]-I;break;default:n=f[1]-A*I,t=f[2]+A*I;break}else return f=this.center.coords.scrCoords,r=JXG$1.parsePosition(o),u=JXG$1.parseNumber(r.pos,2*Math.PI,1),r.pos.indexOf("fr")<0&&r.pos.indexOf("%")<0&&(r.pos.indexOf("px")>=0?u=0:u*=Math.PI/180),d=1,r.side==="left"&&(d=-1),JXG$1.exists(this.label)&&(C=d*.5*JXG$1.evaluate(this.label.visProp.distance)),n=f[1]+(I*this.board.unitX+this.label.size[0]*C)*Math.cos(u),t=f[2]-(I*this.board.unitY+this.label.size[1]*C)*Math.sin(u),new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board);return new Coords(Const.COORDS_BY_USER,[n,t],this.board)},cloneToBackground:function(){var n,t=this.Radius(),o={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CIRCLE,center:{coords:this.center.coords},Radius:function(){return t},getRadius:function(){return t},board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return o.visProp.layer=this.board.options.layer.trace,this.numTraces++,JXG$1.clearVisPropOld(o),o.visPropCalc={visible:JXG$1.evaluate(o.visProp.visible)},n=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawEllipse(o),this.board.renderer.enhancedRendering=n,this.traces[o.id]=o.rendNode,this},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],r=o.length;for(t=0;t<r;t++)this.center.transformations.push(o[t]),this.method==="twoPoints"&&this.point2.transformations.push(o[t]);return this},snapToGrid:function(){var n=JXG$1.evaluate(this.visProp.snaptogrid);return this.center.handleSnapToGrid(n,!0),this.method==="twoPoints"&&this.point2.handleSnapToGrid(n,!0),this},snapToPoints:function(){var n=JXG$1.evaluate(this.visProp.snaptopoints);return this.center.handleSnapToPoints(n),this.method==="twoPoints"&&this.point2.handleSnapToPoints(n),this},X:function(n){return this.Radius()*Math.cos(n*2*Math.PI)+this.center.coords.usrCoords[1]},Y:function(n){return this.Radius()*Math.sin(n*2*Math.PI)+this.center.coords.usrCoords[2]},Z:function(n){return 1},minX:function(){return 0},maxX:function(){return 1},Area:function(){var n=this.Radius();return n*n*Math.PI},Perimeter:function(){return 2*this.Radius()*Math.PI},bounds:function(){var n=this.center.coords.usrCoords,t=this.Radius();return[n[1]-t,n[2]+t,n[1]+t,n[2]-t]},getParents:function(){return this.parents.length===1?this.parents.concat(this.radius):this.parents}});JXG$1.createCircle=function(n,t,o){var r,u,d,C,I,f=!0,A=["center","point2"];if(u=[],I=n.select(t[0]),JXG$1.isObject(I)&&I.elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isTransformationOrArray(t[1]))return C=JXG$1.copyAttributes(o,n.options,"circle"),r=JXG$1.createEllipse(n,[I.center,I.center,function(){return 2*I.Radius()}],C),r.addTransform(t[1]),r;for(d=0;d<t.length;d++)if(JXG$1.isPointType(n,t[d])){if(t.length<3?u.push(JXG$1.providePoints(n,[t[d]],o,"circle",[A[d]])[0]):u.push(JXG$1.providePoints(n,[t[d]],o,"point")[0]),u[u.length-1]===!1)throw new Error("JSXGraph: Can't create circle from this type. Please provide a point type.")}else u.push(t[d]);if(C=JXG$1.copyAttributes(o,n.options,"circle"),u.length===2&&JXG$1.isPoint(u[0])&&JXG$1.isPoint(u[1]))r=new JXG$1.Circle(n,"twoPoints",u[0],u[1],C);else if((JXG$1.isNumber(u[0])||JXG$1.isFunction(u[0])||JXG$1.isString(u[0]))&&JXG$1.isPoint(u[1]))r=new JXG$1.Circle(n,"pointRadius",u[1],u[0],C);else if((JXG$1.isNumber(u[1])||JXG$1.isFunction(u[1])||JXG$1.isString(u[1]))&&JXG$1.isPoint(u[0]))r=new JXG$1.Circle(n,"pointRadius",u[0],u[1],C);else if(u[0].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(u[1]))r=new JXG$1.Circle(n,"pointCircle",u[1],u[0],C);else if(u[1].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(u[0]))r=new JXG$1.Circle(n,"pointCircle",u[0],u[1],C);else if(u[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(u[1]))r=new JXG$1.Circle(n,"pointLine",u[1],u[0],C);else if(u[1].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(u[0]))r=new JXG$1.Circle(n,"pointLine",u[0],u[1],C);else if(t.length===3&&JXG$1.isPoint(u[0])&&JXG$1.isPoint(u[1])&&JXG$1.isPoint(u[2]))if(JXG$1.elements.circumcircle)r=JXG$1.elements.circumcircle(n,u,C);else throw new Error("JSXGraph: Can't create circle with three points. Please include the circumcircle element (element/composition).");else throw new Error("JSXGraph: Can't create circle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [point,number], [point,function], [point,circle], [point,point,point], [circle,transformation]`);for(r.isDraggable=f,r.setParents(u),r.elType="circle",d=0;d<u.length;d++)JXG$1.isPoint(u[d])&&r.inherits.push(u[d]);return r};JXG$1.registerElement("circle",JXG$1.createCircle);const Circle=JXG$1.Circle;JXG$1.createEllipse=function(n,t,o){var r,u,d,C,I,f,A,G=[],B=JXG$1.copyAttributes(o,n.options,"conic","foci"),Z=JXG$1.copyAttributes(o,n.options,"conic","center"),w=JXG$1.copyAttributes(o,n.options,"conic");for(f=0;f<2;f++)if(t[f].length>1)G[f]=n.create("point",t[f],B);else if(JXG$1.isPoint(t[f]))G[f]=n.select(t[f]);else if(JXG$1.isFunction(t[f])&&JXG$1.isPoint(t[f]()))G[f]=t[f]();else if(JXG$1.isString(t[f]))G[f]=n.select(t[f]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(t[2]))I=JXG$1.createFunction(t[2],n);else if(JXG$1.isFunction(t[2])&&JXG$1.isNumber(t[2]()))I=t[2];else{if(JXG$1.isPoint(t[2]))C=n.select(t[2]);else if(t[2].length>1)C=n.create("point",t[2],B);else if(JXG$1.isFunction(t[2])&&JXG$1.isPoint(t[2]()))C=t[2]();else if(JXG$1.isString(t[2]))C=n.select(t[2]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);I=function(){return C.Dist(G[0])+C.Dist(G[1])}}for(JXG$1.exists(t[4])||(t[4]=2*Math.PI),JXG$1.exists(t[3])||(t[3]=0),d=n.create("point",[function(){return(G[0].X()+G[1].X())*.5},function(){return(G[0].Y()+G[1].Y())*.5}],Z),u=n.create("curve",[function(V){return 0},function(V){return 0},t[3],t[4]],w),u.majorAxis=I,A=u.hasPoint,r=function(V,Y){var J,T,L,z,K,P,$,ie,ne;Y||(J=I(),T=J*J,L=G[0].X(),z=G[0].Y(),K=G[1].X(),P=G[1].Y(),$=L-K,ie=z-P,ne=(T-L*L-z*z+K*K+P*P)/(2*J),u.quadraticform=[[ne*ne-K*K-P*P,ne*$/J+K,ne*ie/J+P],[ne*$/J+K,$*$/T-1,$*ie/T],[ne*ie/J+P,$*ie/T,ie*ie/T-1]])},u.X=function(V,Y){var J=I(),T=G[1].Dist(G[0]),L=.5*(T*T-J*J)/(T*Math.cos(V)-J),z=Math.atan2(G[1].Y()-G[0].Y(),G[1].X()-G[0].X());return Y||r(V,Y),G[0].X()+Math.cos(z+V)*L},u.Y=function(V,Y){var J=I(),T=G[1].Dist(G[0]),L=.5*(T*T-J*J)/(T*Math.cos(V)-J),z=Math.atan2(G[1].Y()-G[0].Y(),G[1].X()-G[0].X());return G[0].Y()+Math.sin(z+V)*L},u.midpoint=u.center=d,u.type=Const.OBJECT_TYPE_CONIC,u.subs={center:u.center},u.inherits.push(u.center,G[0],G[1]),JXG$1.isPoint(C)&&u.inherits.push(C),u.hasPoint=function(V,Y){var J,T,L,z,K;return JXG$1.evaluate(this.visProp.hasinnerpoints)?(J=G[0].coords,T=G[1].coords,L=this.majorAxis(),z=new Coords(Const.COORDS_BY_SCREEN,[V,Y],this.board),K=z.distance(Const.COORDS_BY_USER,J)+z.distance(Const.COORDS_BY_USER,T),K<=L):A.apply(this,arguments)},d.addChild(u),f=0;f<2;f++)JXG$1.isPoint(G[f])&&G[f].addChild(u);return JXG$1.isPoint(C)&&C.addChild(u),u.setParents(t),u};JXG$1.createHyperbola=function(n,t,o){var r,u,d,C,I,f,A=[],G=JXG$1.copyAttributes(o,n.options,"conic","foci"),B=JXG$1.copyAttributes(o,n.options,"conic","center"),Z=JXG$1.copyAttributes(o,n.options,"conic");for(f=0;f<2;f++)if(t[f].length>1)A[f]=n.create("point",t[f],G);else if(JXG$1.isPoint(t[f]))A[f]=n.select(t[f]);else if(JXG$1.isFunction(t[f])&&JXG$1.isPoint(t[f]()))A[f]=t[f]();else if(JXG$1.isString(t[f]))A[f]=n.select(t[f]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(t[2]))I=JXG$1.createFunction(t[2],n);else if(JXG$1.isFunction(t[2])&&JXG$1.isNumber(t[2]()))I=t[2];else{if(JXG$1.isPoint(t[2]))C=n.select(t[2]);else if(t[2].length>1)C=n.create("point",t[2],G);else if(JXG$1.isFunction(t[2])&&JXG$1.isPoint(t[2]()))C=t[2]();else if(JXG$1.isString(t[2]))C=n.select(t[2]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);I=function(){return C.Dist(A[0])-C.Dist(A[1])}}for(JXG$1.exists(t[4])||(t[4]=1.0001*Math.PI),JXG$1.exists(t[3])||(t[3]=-1.0001*Math.PI),d=n.create("point",[function(){return(A[0].X()+A[1].X())*.5},function(){return(A[0].Y()+A[1].Y())*.5}],B),u=n.create("curve",[function(w){return 0},function(w){return 0},t[3],t[4]],Z),u.majorAxis=I,r=function(w,V){var Y,J,T,L,z,K,P,$,ie;V||(Y=I(),J=Y*Y,T=A[0].X(),L=A[0].Y(),z=A[1].X(),K=A[1].Y(),P=T-z,$=L-K,ie=(J-T*T-L*L+z*z+K*K)/(2*Y),u.quadraticform=[[ie*ie-z*z-K*K,ie*P/Y+z,ie*$/Y+K],[ie*P/Y+z,P*P/J-1,P*$/J],[ie*$/Y+K,P*$/J,$*$/J-1]])},u.X=function(w,V){var Y=I(),J=A[1].Dist(A[0]),T=.5*(J*J-Y*Y)/(J*Math.cos(w)+Y),L=Math.atan2(A[1].Y()-A[0].Y(),A[1].X()-A[0].X());return V||r(w,V),A[0].X()+Math.cos(L+w)*T},u.Y=function(w,V){var Y=I(),J=A[1].Dist(A[0]),T=.5*(J*J-Y*Y)/(J*Math.cos(w)+Y),L=Math.atan2(A[1].Y()-A[0].Y(),A[1].X()-A[0].X());return A[0].Y()+Math.sin(L+w)*T},u.midpoint=u.center=d,u.subs={center:u.center},u.inherits.push(u.center,A[0],A[1]),JXG$1.isPoint(C)&&u.inherits.push(C),u.type=Const.OBJECT_TYPE_CONIC,d.addChild(u),f=0;f<2;f++)JXG$1.isPoint(A[f])&&A[f].addChild(u);return JXG$1.isPoint(C)&&C.addChild(u),u.setParents(t),u};JXG$1.createParabola=function(n,t,o){var r,u,d,C=t[0],I=t[1],f=JXG$1.copyAttributes(o,n.options,"conic","foci"),A=JXG$1.copyAttributes(o,n.options,"conic","center"),G=JXG$1.copyAttributes(o,n.options,"conic"),B;if(t[0].length>1)C=n.create("point",t[0],f);else if(JXG$1.isPoint(t[0]))C=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))C=t[0]();else if(JXG$1.isString(t[0]))C=n.select(t[0]);else throw new Error("JSXGraph: Can't create Parabola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return JXG$1.isArray(I)&&I.length===2&&(B=JXG$1.copyAttributes(o,n.options,"conic","line"),I=n.create("line",I,B)),JXG$1.exists(t[3])||(t[3]=2*Math.PI),JXG$1.exists(t[2])||(t[2]=0),d=n.create("point",[function(){return Geometry.projectPointToLine(C,I,n).usrCoords}],A),u=n.create("curve",[function(Z){return 0},function(Z){return 0},t[2],t[3]],G),u.midpoint=u.center=d,u.subs={center:u.center},u.inherits.push(u.center),r=function(Z,w){var V,Y,J,T,L,z;w||(V=I.stdform[1],Y=I.stdform[2],J=I.stdform[0],T=V*V+Y*Y,L=C.X(),z=C.Y(),u.quadraticform=[[J*J-T*(L*L+z*z),J*V+T*L,J*Y+T*z],[J*V+T*L,-Y*Y,V*Y],[J*Y+T*z,V*Y,-V*V]])},u.X=function(Z,w){var V,Y,J=I.getAngle(),T=Geometry.distPointLine(C.coords.usrCoords,I.stdform),L=I.point1.coords.usrCoords,z=I.point2.coords.usrCoords,K=C.coords.usrCoords;return L[0]===0?L=[1,z[1]+I.stdform[2],z[2]-I.stdform[1]]:z[0]===0&&(z=[1,L[1]+I.stdform[2],L[2]-I.stdform[1]]),Y=(z[1]-L[1])*(K[2]-L[2])-(z[2]-L[2])*(K[1]-L[1])>=0?1:-1,V=Y*T/(1-Math.sin(Z)),w||r(Z,w),C.X()+Math.cos(Z+J)*V},u.Y=function(Z,w){var V,Y,J=I.getAngle(),T=Geometry.distPointLine(C.coords.usrCoords,I.stdform),L=I.point1.coords.usrCoords,z=I.point2.coords.usrCoords,K=C.coords.usrCoords;return L[0]===0?L=[1,z[1]+I.stdform[2],z[2]-I.stdform[1]]:z[0]===0&&(z=[1,L[1]+I.stdform[2],L[2]-I.stdform[1]]),Y=(z[1]-L[1])*(K[2]-L[2])-(z[2]-L[2])*(K[1]-L[1])>=0?1:-1,V=Y*T/(1-Math.sin(Z)),C.Y()+Math.sin(Z+J)*V},u.type=Const.OBJECT_TYPE_CONIC,d.addChild(u),JXG$1.isPoint(C)&&(C.addChild(u),u.inherits.push(C)),I.addChild(u),u.setParents(t),u};JXG$1.createConic=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T=[[1,0,0],[0,1,0],[0,0,1]],L=[[1,0,0],[0,1,0],[0,0,1]],z=[],K=[],P=JXG$1.copyAttributes(o,n.options,"conic","point"),$=JXG$1.copyAttributes(o,n.options,"conic","center"),ie=JXG$1.copyAttributes(o,n.options,"conic");if(t.length===5)J=!0;else if(t.length===6)J=!1;else throw new Error("JSXGraph: Can't create generic Conic with "+t.length+" parameters.");if(J)for(V=0;V<5;V++)if(t[V].length>1)z[V]=n.create("point",t[V],P);else if(JXG$1.isPoint(t[V]))z[V]=n.select(t[V]);else if(JXG$1.isFunction(t[V])&&JXG$1.isPoint(t[V]()))z[V]=t[V]();else if(JXG$1.isString(t[V]))z[V]=n.select(t[V]);else throw new Error("JSXGraph: Can't create Conic section with parent types '"+typeof t[V]+`'.
Possible parent types: [point,point,point,point,point], [a00,a11,a22,a01,a02,a12]`);else Y=[[0,0,0],[0,0,0],[0,0,0]],Y[0][0]=JXG$1.isFunction(t[2])?function(){return t[2]()}:function(){return t[2]},Y[0][1]=JXG$1.isFunction(t[4])?function(){return t[4]()}:function(){return t[4]},Y[0][2]=JXG$1.isFunction(t[5])?function(){return t[5]()}:function(){return t[5]},Y[1][1]=JXG$1.isFunction(t[0])?function(){return t[0]()}:function(){return t[0]},Y[1][2]=JXG$1.isFunction(t[3])?function(){return t[3]()}:function(){return t[3]},Y[2][2]=JXG$1.isFunction(t[1])?function(){return t[1]()}:function(){return t[1]};if(I=function(ne){var ee,se;for(ee=0;ee<3;ee++)for(se=ee;se<3;se++)ne[ee][se]+=ne[se][ee];for(ee=0;ee<3;ee++)for(se=0;se<ee;se++)ne[ee][se]=ne[se][ee];return ne},C=function(ne,ee){var se,re,ce=[[0,0,0],[0,0,0],[0,0,0]];for(se=0;se<3;se++)for(re=0;re<3;re++)ce[se][re]=ne[se]*ee[re];return I(ce)},d=function(ne,ee,se){var re,ce,ue,ye,Se,Ce=[[0,0,0],[0,0,0],[0,0,0]];for(Se=Mat.matVecMult(ee,se),ue=Mat.innerProduct(se,Se),Se=Mat.matVecMult(ne,se),ye=Mat.innerProduct(se,Se),re=0;re<3;re++)for(ce=0;ce<3;ce++)Ce[re][ce]=ue*ne[re][ce]-ye*ee[re][ce];return Ce},u=n.create("curve",[function(ne){return 0},function(ne){return 0},0,2*Math.PI],ie),r=function(ne,ee){var se,re,ce;if(!ee){if(J){for(se=0;se<5;se++)K[se]=z[se].coords.usrCoords;Z=C(Mat.crossProduct(K[0],K[1]),Mat.crossProduct(K[2],K[3])),w=C(Mat.crossProduct(K[0],K[2]),Mat.crossProduct(K[1],K[3])),L=d(Z,w,K[4])}else for(se=0;se<3;se++)for(re=se;re<3;re++)L[se][re]=Y[se][re](),re>se&&(L[re][se]=L[se][re]);u.quadraticform=L,f=Numerics.Jacobi(L),f[0][0][0]<0&&(f[0][0][0]*=-1,f[0][1][1]*=-1,f[0][2][2]*=-1),T=f[1],B=Math.sqrt(Math.abs(f[0][0][0])),A=Math.sqrt(Math.abs(f[0][1][1])),G=Math.sqrt(Math.abs(f[0][2][2]))}return f[0][1][1]<=0&&f[0][2][2]<=0?ce=Mat.matVecMult(T,[1/B,Math.cos(ne)/A,Math.sin(ne)/G]):f[0][1][1]<=0&&f[0][2][2]>0?ce=Mat.matVecMult(T,[Math.cos(ne)/B,1/A,Math.sin(ne)/G]):f[0][2][2]<0&&(ce=Mat.matVecMult(T,[Math.sin(ne)/B,Math.cos(ne)/A,1/G])),JXG$1.exists(ce)?(ce[1]/=ce[0],ce[2]/=ce[0],ce[0]=1):ce=[1,NaN,NaN],ce},u.X=function(ne,ee){return r(ne,ee)[1]},u.Y=function(ne,ee){return r(ne,ee)[2]},u.midpoint=n.create("point",[function(){var ne=u.quadraticform;return[ne[1][1]*ne[2][2]-ne[1][2]*ne[1][2],ne[1][2]*ne[0][2]-ne[2][2]*ne[0][1],ne[0][1]*ne[1][2]-ne[1][1]*ne[0][2]]}],$),u.type=Const.OBJECT_TYPE_CONIC,u.center=u.midpoint,u.subs={center:u.center},u.inherits.push(u.center),u.inherits=u.inherits.concat(z),J){for(V=0;V<5;V++)JXG$1.isPoint(z[V])&&z[V].addChild(u);u.setParents(t)}return u.addChild(u.center),u};JXG$1.registerElement("ellipse",JXG$1.createEllipse);JXG$1.registerElement("hyperbola",JXG$1.createHyperbola);JXG$1.registerElement("parabola",JXG$1.createParabola);JXG$1.registerElement("conic",JXG$1.createConic);JXG$1.Polygon=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_POLYGON,Const.OBJECT_CLASS_AREA);var r,u,d,C,I,f=JXG$1.copyAttributes(o,n.options,"polygon","borders");for(this.withLines=o.withlines,this.attr_line=f,this.vertices=[],r=0;r<t.length;r++)this.vertices[r]=this.board.select(t[r]),this.vertices[r]._is_new&&(delete this.vertices[r]._is_new,this.vertices[r]._is_new_pol=!0);if(this.vertices.length>0&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.borders=[],this.withLines)for(d=this.vertices.length-1,C=0;C<d;C++)r=(C+1)%d,f.id=f.ids&&f.ids[r],f.name=f.names&&f.names[r],f.strokecolor=JXG$1.isArray(f.colors)&&f.colors[r%f.colors.length]||f.strokecolor,f.visible=JXG$1.exists(o.borders.visible)?o.borders.visible:o.visible,f.strokecolor===!1&&(f.strokecolor="none"),u=n.create("segment",[this.vertices[r],this.vertices[r+1]],f),u.dump=!1,this.borders[r]=u,u.parentPolygon=this,this.addChild(u);for(this.inherits.push(this.vertices,this.borders),this.id=this.board.setId(this,"Py"),r=0;r<this.vertices.length-1;r++)I=this.board.select(this.vertices[r]),JXG$1.exists(I._is_new_pol)?(this.addChild(I),delete I._is_new_pol):I.addChild(this);this.board.renderer.drawPolygon(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="polygon",this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{borders:"borders",vertices:"vertices",A:"Area",Area:"Area",Perimeter:"Perimeter",L:"Perimeter",boundingBox:"bounds",BoundingBox:"bounds",addPoints:"addPoints",insertPoints:"insertPoints",removePoints:"removePoints",Intersect:"intersect"})};JXG$1.Polygon.prototype=new GeometryElement;JXG$1.extend(JXG$1.Polygon.prototype,{pnpoly:function(n,t,o){return Geometry.pnpoly(n,t,this.vertices,o)},hasPoint:function(n,t){var o,r;if(JXG$1.evaluate(this.visProp.hasinnerpoints)&&this.pnpoly(n,t))return!0;for(r=this.borders.length,o=0;o<r;o++)if(this.borders[o].hasPoint(n,t))return!0;return!1},updateRenderer:function(){var n,t;if(!this.needsUpdate)return this;if(this.visPropCalc.visible){for(t=this.vertices.length-(this.elType==="polygonalchain"?0:1),this.isReal=!0,n=0;n<t;++n)if(!this.vertices[n].isReal){this.isReal=!1;break}if(!this.isReal){this.updateVisibility(!1);for(n in this.childElements)this.childElements.hasOwnProperty(n)&&this.childElements[n].setDisplayRendNode(!1)}}return this.visPropCalc.visible&&this.board.renderer.updatePolygon(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this},getTextAnchor:function(){var n,t,o,r,u;if(this.vertices.length===0)return new Coords(Const.COORDS_BY_USER,[1,0,0],this.board);for(n=this.vertices[0].X(),t=this.vertices[0].Y(),o=n,r=t,u=0;u<this.vertices.length;u++)this.vertices[u].X()<n&&(n=this.vertices[u].X()),this.vertices[u].X()>o&&(o=this.vertices[u].X()),this.vertices[u].Y()>t&&(t=this.vertices[u].Y()),this.vertices[u].Y()<r&&(r=this.vertices[u].Y());return new Coords(Const.COORDS_BY_USER,[(n+o)*.5,(t+r)*.5],this.board)},getLabelAnchor:JXG$1.shortcut(JXG$1.Polygon.prototype,"getTextAnchor"),cloneToBackground:function(){var n={},t;return n.id=this.id+"T"+this.numTraces,this.numTraces++,n.vertices=this.vertices,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,n.board=this.board,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},t=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawPolygon(n),this.board.renderer.enhancedRendering=t,this.traces[n.id]=n.rendNode,this},hideElement:function(n){var t;if(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),!n)for(t=0;t<this.borders.length;t++)this.borders[t].hideElement();this.hasLabel&&JXG$1.exists(this.label)&&(this.label.hiddenByParent=!0,this.label.visPropCalc.visible&&this.label.hideElement())},showElement:function(n){var t;if(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!0),!n)for(t=0;t<this.borders.length;t++)this.borders[t].showElement().updateRenderer();return JXG$1.exists(this.label)&&this.hasLabel&&this.label.hiddenByParent&&(this.label.hiddenByParent=!1,this.label.visPropCalc.visible||this.label.showElement().updateRenderer()),this},Area:function(){return Math.abs(Geometry.signedPolygon(this.vertices,!0))},Perimeter:function(){var n,t=this.vertices.length,o=0;for(n=1;n<t;++n)o+=this.vertices[n].Dist(this.vertices[n-1]);return o},L:function(){return this.Perimeter()},boundingBox:function(){var n=[0,0,0,0],t,o,r=this.vertices.length-1;if(r===0)return n;for(n[0]=this.vertices[0].X(),n[2]=n[0],n[1]=this.vertices[0].Y(),n[3]=n[1],t=1;t<r;++t)o=this.vertices[t].X(),o<n[0]?n[0]=o:o>n[2]&&(n[2]=o),o=this.vertices[t].Y(),o>n[1]?n[1]=o:o<n[3]&&(n[3]=o);return n},bounds:function(){return this.boundingBox()},remove:function(){var n;for(n=0;n<this.borders.length;n++)this.board.removeObject(this.borders[n]);GeometryElement.prototype.remove.call(this)},findPoint:function(n){var t;if(!JXG$1.isPoint(n))return-1;for(t=0;t<this.vertices.length;t++)if(this.vertices[t].id===n.id)return t;return-1},addPoints:function(n){var t,o=Array.prototype.slice.call(arguments);return this.elType==="polygonalchain"?t=this.vertices.length-1:t=this.vertices.length-2,this.insertPoints.apply(this,[t].concat(o))},insertPoints:function(n,t){var o,r,u,d,C;if(arguments.length===0)return this;if(u=this.vertices.length-1,this.elType==="polygon"&&u--,n<-1||n>u)return this;for(r=arguments.length-1,o=1;o<r+1;o++)C=JXG$1.providePoints(this.board,[arguments[o]],{},"polygon",["vertices"])[0],C._is_new&&(this.addChild(C),delete C._is_new),this.vertices.splice(n+o,0,C);if(this.withLines)for(d=n+1,this.elType==="polygon"?n<0?(this.vertices[this.vertices.length-1]=this.vertices[0],this.borders[this.borders.length-1].point2=this.vertices[this.vertices.length-1]):this.borders[n].point2=this.vertices[d]:n>=0&&(n<this.borders.length?this.borders[n].point2=this.vertices[d]:d=n),o=d;o<d+r;o++)this.borders.splice(o,0,this.board.create("segment",[this.vertices[o],this.vertices[o+1]],this.attr_line));return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},removePoints:function(n){var t,o,r,u,d=[],C=[],I=[],f=[];for(this.elType==="polygon"&&(u=this.vertices.pop()),t=0;t<arguments.length;t++)r=arguments[t],JXG$1.isPoint(r)&&(r=this.findPoint(r)),JXG$1.isNumber(r)&&r>-1&&r<this.vertices.length&&JXG$1.indexOf(I,r)===-1&&I.push(r);if(I.length===0)return this.elType==="polygon"&&this.vertices.push(u),this;for(t=0;t<I.length;t++)this.vertices[I[t]].removeChild(this);for(I=I.sort(),d=this.vertices.slice(),C=this.borders.slice(),this.withLines&&f.push([I[I.length-1]]),t=I.length-1;t>-1;t--)d[I[t]]=-1,this.withLines&&I.length>1&&I[t]-1>I[t-1]&&(f[f.length-1][1]=I[t],f.push([I[t-1]]));for(this.withLines&&(f[f.length-1][1]=I[0]),this.vertices=[],t=0;t<d.length;t++)JXG$1.isPoint(d[t])&&this.vertices.push(d[t]);if(this.elType==="polygon"&&this.vertices.length>1&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.withLines){for(t=0;t<f.length;t++){for(o=f[t][1]-1;o<f[t][0]+1;o++)o<0?this.elType==="polygon"&&(this.board.removeObject(this.borders[C.length-1]),C[C.length-1]=-1):o<C.length&&(this.board.removeObject(this.borders[o]),C[o]=-1);f[t][1]!==0&&f[t][0]!==d.length-1&&(C[f[t][0]-1]=this.board.create("segment",[d[f[t][1]-1],d[f[t][0]+1]],this.attr_line))}for(this.borders=[],t=0;t<C.length;t++)C[t]!==-1&&this.borders.push(C[t]);this.elType==="polygon"&&this.vertices.length>2&&(f[0][1]===this.vertices.length-1||f[f.length-1][1]===0)&&this.borders.push(this.board.create("segment",[this.vertices[this.vertices.length-2],this.vertices[0]],this.attr_line))}return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},getParents:function(){return this.setParents(this.vertices),this.parents},getAttributes:function(){var n=GeometryElement.prototype.getAttributes.call(this),t;if(this.withLines)for(n.lines=n.lines||{},n.lines.ids=[],n.lines.colors=[],t=0;t<this.borders.length;t++)n.lines.ids.push(this.borders[t].id),n.lines.colors.push(this.borders[t].visProp.strokecolor);return n},snapToGrid:function(){var n,t;for(JXG$1.evaluate(this.visProp.snaptogrid)?t=!0:t=!1,n=0;n<this.vertices.length;n++)this.vertices[n].handleSnapToGrid(t,!0)},setPositionDirectly:function(n,t,o){var r,u,d,C,I=new Coords(n,t,this.board),f=new Coords(n,o,this.board);for(C=this.vertices.length-1,d=0;d<C;d++)if(!this.vertices[d].draggable())return this;return r=Statistics.subtract(I.usrCoords,f.usrCoords),u=this.board.create("transform",r.slice(1),{type:"translate"}),u.applyOnce(this.vertices.slice(0,-1)),this},sutherlandHodgman:function(n){var t=JXG$1.Math.Geometry.sortVertices(this.vertices),o=JXG$1.Math.Geometry.sortVertices(n.vertices),r=t.length-1,u=o.length-1,d,C=[],I,f,A,G,B,Z,w=function(V,Y,J){return(Y[1]-V[1])*(J[2]-V[2])-(Y[2]-V[2])*(J[1]-V[1])>=0};for(f=0;f<u;f++)C.push(o[f]);for(f=0;f<r;f++)for(I=C.slice(0),d=I.length,C=[],G=I[d-1],A=0;A<d;A++)B=I[A],w(t[f],t[f+1],B)?(w(t[f],t[f+1],G)||(Z=JXG$1.Math.Geometry.meetSegmentSegment(G,B,t[f],t[f+1]),Z[0][1]/=Z[0][0],Z[0][2]/=Z[0][0],Z[0][0]=1,C.push(Z[0])),C.push(B)):w(t[f],t[f+1],G)&&(Z=JXG$1.Math.Geometry.meetSegmentSegment(G,B,t[f],t[f+1]),Z[0][1]/=Z[0][0],Z[0][2]/=Z[0][0],Z[0][0]=1,C.push(Z[0])),G=B;return C},intersect:function(n){return this.sutherlandHodgman(n)}});JXG$1.createPolygon=function(n,t,o){var r,u,d,C,I=[],f,A,G=!1;if(f=JXG$1.copyAttributes(o,n.options,"polygon"),C=n.select(t[0]),C===null&&(C=t[0]),JXG$1.isObject(C)&&C.type===Const.OBJECT_TYPE_POLYGON&&JXG$1.isTransformationOrArray(t[1]))for(G=!0,d=C.vertices.length-1,A=JXG$1.copyAttributes(o,n.options,"polygon","vertices"),u=0;u<d;u++)A.withlabel&&(A.name=C.vertices[u].name===""?"":C.vertices[u].name+"'"),I.push(n.create("point",[C.vertices[u],t[1]],A));else if(I=JXG$1.providePoints(n,t,o,"polygon",["vertices"]),I===!1)throw new Error("JSXGraph: Can't create polygon / polygonalchain with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon and a transformation can be supplied");if(f=JXG$1.copyAttributes(o,n.options,"polygon"),r=new JXG$1.Polygon(n,I,f),r.isDraggable=!0,G)for(r.prepareUpdate().update().updateVisibility().updateRenderer(),d=C.vertices.length-1,u=0;u<d;u++)I[u].prepareUpdate().update().updateVisibility().updateRenderer();return r};JXG$1.createRegularPolygon=function(n,t,o){var r,u,d,C=[],I,f,A,G;if(f=t.length,d=t[f-1],JXG$1.isNumber(d)&&(t.length!==3||d<3))throw new Error("JSXGraph: A regular polygon needs two point types and a number > 2 as input.");if(JXG$1.isNumber(n.select(d))?(f--,A=!1):(d=f,A=!0),C=JXG$1.providePoints(n,t.slice(0,f),o,"regularpolygon",["vertices"]),C===!1)throw new Error("JSXGraph: Can't create regular polygon with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates");for(G=JXG$1.copyAttributes(o,n.options,"regularpolygon","vertices"),u=2;u<d;u++)I=n.create("transform",[Math.PI*(2-(d-2)/d),C[u-1]],{type:"rotate"}),A?(C[u].addTransform(C[u-2],I),C[u].fullUpdate()):(JXG$1.isArray(G.ids)&&G.ids.length>=d-2&&(G.id=G.ids[u-2]),C[u]=n.create("point",[C[u-2],I],G),C[u].type=Const.OBJECT_TYPE_CAS,C[u].isDraggable=!0,C[u].visProp.fixed=!1);return G=JXG$1.copyAttributes(o,n.options,"regularpolygon"),r=n.create("polygon",C,G),r.elType="regularpolygon",r};JXG$1.createPolygonalChain=function(n,t,o){var r,u;return r=JXG$1.copyAttributes(o,n.options,"polygonalchain"),u=n.create("polygon",t,r),u.elType="polygonalchain",u.vertices.pop(),n.removeObject(u.borders[u.borders.length-1]),u.borders.pop(),u};JXG$1.createParallelogram=function(n,t,o){var r,u,d=[],C,I;if(d=JXG$1.providePoints(n,t,o,"polygon",["vertices"]),d===!1||d.length<3)throw new Error("JSXGraph: Can't create parallelogram with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates.");return I=JXG$1.copyAttributes(o,n.options,"parallelogram","parallelpoint"),u=n.create("parallelpoint",d,I),C=JXG$1.copyAttributes(o,n.options,"parallelogram"),r=n.create("polygon",[d[0],d[1],u,d[2]],C),r.elType="parallelogram",r.parallelPoint=u,r.isDraggable=!0,u.isDraggable=!0,u.visProp.fixed=!1,r};JXG$1.registerElement("polygon",JXG$1.createPolygon);JXG$1.registerElement("regularpolygon",JXG$1.createRegularPolygon);JXG$1.registerElement("polygonalchain",JXG$1.createPolygonalChain);JXG$1.registerElement("parallelogram",JXG$1.createParallelogram);const Polygon=JXG$1.Polygon;JXG$1.Curve=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_CURVE,Const.OBJECT_CLASS_CURVE),this.points=[],this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh),this.bezierDegree=1,this.dataX=null,this.dataY=null,this.ticks=[],this.qdt=null,JXG$1.exists(t[0])?this.varname=t[0]:this.varname="x",this.xterm=t[1],this.yterm=t[2],this.generateTerm(this.varname,this.xterm,this.yterm,t[3],t[4]),this.updateCurve(),this.id=this.board.setId(this,"G"),this.board.renderer.drawCurve(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="curve",this.createLabel(),JXG$1.isString(this.xterm)&&this.notifyParents(this.xterm),JXG$1.isString(this.yterm)&&this.notifyParents(this.yterm),this.methodMap=JXG$1.deepCopy(this.methodMap,{generateTerm:"generateTerm",setTerm:"generateTerm",move:"moveTo",moveTo:"moveTo",MinX:"minX",MaxX:"maxX"})};JXG$1.Curve.prototype=new GeometryElement;JXG$1.extend(JXG$1.Curve.prototype,{minX:function(){var n;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?0:(n=new Coords(Const.COORDS_BY_SCREEN,[-this.board.canvasWidth*.1,0],this.board,!1),n.usrCoords[1])},maxX:function(){var n;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?2*Math.PI:(n=new Coords(Const.COORDS_BY_SCREEN,[this.board.canvasWidth*1.1,0],this.board,!1),n.usrCoords[1])},X:function(n){return NaN},Y:function(n){return NaN},Z:function(n){return 1},hasPoint:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z=[],w,V,Y=JXG$1.evaluate(this.visProp.numberpointslow),J=(this.maxX()-this.minX())/Y,T,L,z=1/0,K,P,$,ie,ne,ee=!0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(L=this.board._inputDevice,T=JXG$1.evaluate(this.visProp.precision[L])):T=this.board.options.precision.hasPoint,f=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board,!1),n=f.usrCoords[1],t=f.usrCoords[2],this.bezierDegree===1&&JXG$1.evaluate(this.visProp.hasinnerpoints)&&(B=Geometry.windingNumber([1,n,t],this.points,!0),B!==0))return!0;if(T+=JXG$1.evaluate(this.visProp.strokewidth)*.5,T*=T,K=this.board.unitX*this.board.unitX,P=this.board.unitY*this.board.unitY,ie=this.minX(),ne=this.maxX(),JXG$1.exists(this._visibleArea)&&(ie=this._visibleArea[0],ne=this._visibleArea[1],J=(ne-ie)/Y),$=JXG$1.evaluate(this.visProp.curvetype),$==="parameter"||$==="polar")for(this.transformations.length>0&&(this.updateTransformMatrix(),G=Mat.inverse(this.transformMat),u=Mat.matVecMult(G,[1,n,t]),n=u[1],t=u[2]),d=0,r=ie;d<Y;d++){if(C=this.X(r,ee),I=this.Y(r,ee),z=(n-C)*(n-C)*K+(t-I)*(t-I)*P,z<=T)return!0;r+=J}else if($==="plot"||$==="functiongraph"){for((!JXG$1.exists(o)||o<0)&&(o=0),JXG$1.exists(this.qdt)&&JXG$1.evaluate(this.visProp.useqdt)&&this.bezierDegree!==3?(V=this.qdt.query(new Coords(Const.COORDS_BY_USER,[n,t],this.board)),w=V.points,A=w.length):(w=this.points,A=this.numberPoints-1),d=o;d<A;d++)if(this.bezierDegree===3?Z=Geometry.projectCoordsToBeziersegment([1,n,t],this,d):V?(w[d].prev&&(Z=Geometry.projectCoordsToSegment([1,n,t],w[d].prev.usrCoords,w[d].usrCoords)),w[d].next&&w[d+1]!==w[d].next&&(Z=Geometry.projectCoordsToSegment([1,n,t],w[d].usrCoords,w[d].next.usrCoords))):Z=Geometry.projectCoordsToSegment([1,n,t],w[d].usrCoords,w[d+1].usrCoords),Z[1]>=0&&Z[1]<=1&&(n-Z[0][1])*(n-Z[0][1])*K+(t-Z[0][2])*(t-Z[0][2])*P<=T)return!0;return!1}return z<T},allocatePoints:function(){var n,t;if(t=this.numberPoints,this.points.length<this.numberPoints)for(n=this.points.length;n<t;n++)this.points[n]=new Coords(Const.COORDS_BY_USER,[0,0],this.board,!1)},update:function(){return this.needsUpdate&&(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.updateCurve()),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=Plot.checkReal(this.points),this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateCurve(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateDataArray:function(){},updateCurve:function(){var n,t,o,r,u,d,C=this.visProp.plotversion,I=!1;if(this.updateTransformMatrix(),this.updateDataArray(),o=this.minX(),r=this.maxX(),JXG$1.exists(this.dataX))for(this.numberPoints=this.dataX.length,t=this.numberPoints,this.allocatePoints(),n=0;n<t;n++)u=n,JXG$1.exists(this.dataY)?(d=n,this.points[n].setCoordinates(Const.COORDS_BY_USER,[this.dataX[n],this.dataY[n]],!1)):(d=this.X(u),this.points[n].setCoordinates(Const.COORDS_BY_USER,[this.dataX[n],this.Y(d,I)],!1)),this.points[n]._t=n,I=!0;else if(JXG$1.evaluate(this.visProp.doadvancedplot)?C===1||JXG$1.evaluate(this.visProp.doadvancedplotold)?Plot.updateParametricCurveOld(this,o,r):C===2?Plot.updateParametricCurve_v2(this,o,r):C===3?Plot.updateParametricCurve_v3(this,o,r):C===4?Plot.updateParametricCurve_v4(this,o,r):Plot.updateParametricCurve_v2(this,o,r):(this.board.updateQuality===this.board.BOARD_QUALITY_HIGH?this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh):this.numberPoints=JXG$1.evaluate(this.visProp.numberpointslow),this.allocatePoints(),Plot.updateParametricCurveNaive(this,o,r,this.numberPoints)),t=this.numberPoints,JXG$1.evaluate(this.visProp.useqdt)&&this.board.updateQuality===this.board.BOARD_QUALITY_HIGH)for(this.qdt=new QDT(this.board.getBoundingBox()),n=0;n<this.points.length;n++)this.qdt.insert(this.points[n]),n>0&&(this.points[n].prev=this.points[n-1]),n<t-1&&(this.points[n].next=this.points[n+1]);for(JXG$1.evaluate(this.visProp.curvetype)!=="plot"&&JXG$1.evaluate(this.visProp.rdpsmoothing)&&(this.points=Numerics.RamerDouglasPeucker(this.points,.2),this.numberPoints=this.points.length),t=this.numberPoints,n=0;n<t;n++)this.updateTransform(this.points[n]);return this},updateTransformMatrix:function(){var n,t,o=this.transformations.length;for(this.transformMat=[[1,0,0],[0,1,0],[0,0,1]],t=0;t<o;t++)n=this.transformations[t],n.update(),this.transformMat=Mat.matMatMult(n.matrix,this.transformMat);return this},updateTransform:function(n){var t,o=this.transformations.length;return o>0&&(t=Mat.matVecMult(this.transformMat,n.usrCoords),n.setCoordinates(Const.COORDS_BY_USER,t,!1,!0)),n},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],r=o.length;for(t=0;t<r;t++)this.transformations.push(o[t]);return this},interpolationFunctionFromArray:function(n){var t="data"+n,o=this;return function(r,u){var d,C,I,f,A=o[t],G=A.length,B,Z=[];if(isNaN(r))return NaN;if(r<0)return JXG$1.isFunction(A[0])?A[0]():A[0];if(o.bezierDegree===3){if(B=(G-1)/3,r>=B)return JXG$1.isFunction(A[A.length-1])?A[A.length-1]():A[A.length-1];for(d=Math.floor(r)*3,I=r%1,f=1-I,C=0;C<4;C++)JXG$1.isFunction(A[d+C])?Z[C]=A[d+C]():Z[C]=A[d+C];return f*f*(f*Z[0]+3*I*Z[1])+(3*f*Z[2]+I*Z[3])*I*I}if(r>G-2?d=G-2:d=parseInt(Math.floor(r),10),d===r)return JXG$1.isFunction(A[d])?A[d]():A[d];for(C=0;C<2;C++)JXG$1.isFunction(A[d+C])?Z[C]=A[d+C]():Z[C]=A[d+C];return Z[0]+(Z[1]-Z[0])*(r-d)}},generateTerm:function(n,t,o,r,u){var d,C;JXG$1.isArray(t)?(this.dataX=t,this.numberPoints=this.dataX.length,this.X=this.interpolationFunctionFromArray.apply(this,["X"]),this.visProp.curvetype="plot",this.isDraggable=!0):(this.X=JXG$1.createFunction(t,this.board,n),JXG$1.isString(t)?this.visProp.curvetype="functiongraph":(JXG$1.isFunction(t)||JXG$1.isNumber(t))&&(this.visProp.curvetype="parameter"),this.isDraggable=!0),JXG$1.isArray(o)?(this.dataY=o,this.Y=this.interpolationFunctionFromArray.apply(this,["Y"])):this.Y=JXG$1.createFunction(o,this.board,n),JXG$1.isFunction(t)&&JXG$1.isArray(o)&&(d=JXG$1.createFunction(o[0],this.board,""),C=JXG$1.createFunction(o[1],this.board,""),this.X=function(I){return t(I)*Math.cos(I)+d()},this.X.deps=d.deps,this.Y=function(I){return t(I)*Math.sin(I)+C()},this.Y.deps=C.deps,this.visProp.curvetype="polar"),JXG$1.exists(r)?this.minX=JXG$1.createFunction(r,this.board,""):delete this.minX,JXG$1.exists(u)?this.maxX=JXG$1.createFunction(u,this.board,""):delete this.maxX,this.addParentsFromJCFunctions([this.X,this.Y,this.minX,this.maxX])},notifyParents:function(n){var t,o,r=!1,u;u={xterm:1,yterm:1};for(t in u)if(u.hasOwnProperty(t)&&this.hasOwnProperty(t)&&this[t].origin){r=!0;for(o in this[t].origin.deps)this[t].origin.deps.hasOwnProperty(o)&&this[t].origin.deps[o].addChild(this)}r||GeonextParser.findDependencies(this,n,this.board)},getLabelAnchor:function(){var n,t,o,r,u,d,C,I,f,A,G=1.5,B,Z=.05*this.board.canvasWidth,w=.05*this.board.canvasHeight,V=.95*this.board.canvasWidth,Y=.95*this.board.canvasHeight;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"ulft":n=Z,t=w;break;case"llft":n=Z,t=Y;break;case"rt":n=V,t=.5*Y;break;case"lrt":n=V,t=Y;break;case"urt":n=V,t=w;break;case"top":n=.5*V,t=w;break;case"bot":n=.5*V,t=Y;break;default:n=Z,t=.5*Y}else return r=JXG$1.parsePosition(o),u=JXG$1.parseNumber(r.pos,this.maxX()-this.minX(),1),r.pos.indexOf("fr")<0&&r.pos.indexOf("%")<0&&(u=0),C=this.minX()+u,n=this.X(C),t=this.Y(C),B=new Coords(Const.COORDS_BY_USER,[n,t],this.board).scrCoords,d=Mat.eps,C<this.minX()+d?(I=(this.X(C+d)-this.X(C))/d,f=(this.Y(C+d)-this.Y(C))/d):C>this.maxX()-d?(I=(this.X(C)-this.X(C-d))/d,f=(this.Y(C)-this.Y(C-d))/d):(I=.5*(this.X(C+d)-this.X(C-d))/d,f=.5*(this.Y(C+d)-this.Y(C-d))/d),A=Mat.hypot(I,f),r.side==="left"?f*=-1:I*=-1,JXG$1.exists(this.label)&&(G=.5*JXG$1.evaluate(this.label.visProp.distance)/A),n=B[1]+f*this.label.size[0]*G,t=B[2]-I*this.label.size[1]*G,new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board);return B=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board,!1),Geometry.projectCoordsToCurve(B.usrCoords[1],B.usrCoords[2],0,this,this.board)[0]},cloneToBackground:function(){var n,t={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CURVE,points:this.points.slice(0),bezierDegree:this.bezierDegree,numberPoints:this.numberPoints,board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return t.visProp.layer=this.board.options.layer.trace,t.visProp.curvetype=this.visProp.curvetype,this.numTraces++,JXG$1.clearVisPropOld(t),t.visPropCalc={visible:JXG$1.evaluate(t.visProp.visible)},n=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawCurve(t),this.board.renderer.enhancedRendering=n,this.traces[t.id]=t.rendNode,this},bounds:function(){var n=1/0,t=-1/0,o=1/0,r=-1/0,u=this.points.length,d,C,I;if(this.bezierDegree===3){for(d=0;d<u;d++)this.points[d].X=JXG$1.bind(function(){return this.usrCoords[1]},this.points[d]),this.points[d].Y=JXG$1.bind(function(){return this.usrCoords[2]},this.points[d]);return C=Numerics.bezier(this.points),I=C[3](),n=Numerics.fminbr(function(f){return C[0](f)},[0,I]),t=Numerics.fminbr(function(f){return-C[0](f)},[0,I]),o=Numerics.fminbr(function(f){return C[1](f)},[0,I]),r=Numerics.fminbr(function(f){return-C[1](f)},[0,I]),n=C[0](n),t=C[0](t),o=C[1](o),r=C[1](r),[n,r,t,o]}for(d=0;d<u;d++)n>this.points[d].usrCoords[1]&&(n=this.points[d].usrCoords[1]),t<this.points[d].usrCoords[1]&&(t=this.points[d].usrCoords[1]),o>this.points[d].usrCoords[2]&&(o=this.points[d].usrCoords[2]),r<this.points[d].usrCoords[2]&&(r=this.points[d].usrCoords[2]);return[n,r,t,o]},getParents:function(){var n=[this.xterm,this.yterm,this.minX(),this.maxX()];return this.parents.length!==0&&(n=this.parents),n},moveTo:function(n){var t=[],o;return this.points.length>0&&!JXG$1.evaluate(this.visProp.fixed)?(o=this.points[0],n.length===3?t=[n[0]-o.usrCoords[0],n[1]-o.usrCoords[1],n[2]-o.usrCoords[2]]:t=[n[0]-o.usrCoords[1],n[1]-o.usrCoords[2]],this.setPosition(Const.COORDS_BY_USER,t),this.board.update(this)):this},getTransformationSource:function(){var n,t;return JXG$1.exists(this._transformationSource)&&(t=this._transformationSource,t.elementClass===Const.OBJECT_CLASS_CURVE&&(n=!0)),[n,t]}});JXG$1.createCurve=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"curve");return r=n.select(t[0],!0),JXG$1.isTransformationOrArray(t[1])&&JXG$1.isObject(r)&&(r.type===Const.OBJECT_TYPE_CURVE||r.type===Const.OBJECT_TYPE_ANGLE||r.type===Const.OBJECT_TYPE_ARC||r.type===Const.OBJECT_TYPE_CONIC||r.type===Const.OBJECT_TYPE_SECTOR)?(r.type===Const.OBJECT_TYPE_SECTOR?d=JXG$1.copyAttributes(o,n.options,"sector"):r.type===Const.OBJECT_TYPE_ARC?d=JXG$1.copyAttributes(o,n.options,"arc"):r.type===Const.OBJECT_TYPE_ANGLE?(JXG$1.exists(o.withLabel)||(o.withLabel=!1),d=JXG$1.copyAttributes(o,n.options,"angle")):d=JXG$1.copyAttributes(o,n.options,"curve"),d=JXG$1.copyAttributes(d,n.options,"curve"),u=new JXG$1.Curve(n,["x",[],[]],d),u.updateDataArray=function(){var C,I=r.numberPoints;for(this.bezierDegree=r.bezierDegree,this.dataX=[],this.dataY=[],C=0;C<I;C++)this.dataX.push(r.points[C].usrCoords[1]),this.dataY.push(r.points[C].usrCoords[2]);return this},u.addTransform(t[1]),r.addChild(u),u.setParents([r]),u._transformationSource=r,u):(d=JXG$1.copyAttributes(o,n.options,"curve"),new JXG$1.Curve(n,["x"].concat(t),d))};JXG$1.registerElement("curve",JXG$1.createCurve);JXG$1.createFunctiongraph=function(n,t,o){var r,u=["x","x"].concat(t);return r=JXG$1.copyAttributes(o,n.options,"functiongraph"),r=JXG$1.copyAttributes(r,n.options,"curve"),r.curvetype="functiongraph",new JXG$1.Curve(n,u,r)};JXG$1.registerElement("functiongraph",JXG$1.createFunctiongraph);JXG$1.registerElement("plot",JXG$1.createFunctiongraph);JXG$1.createSpline=function(n,t,o){var r,u,d;return u=function(){var C,I=[],f=[];return[function(A,G){var B,Z,w;if(!G){if(I=[],f=[],t.length===2&&JXG$1.isArray(t[0])&&JXG$1.isArray(t[1])&&t[0].length===t[1].length)for(B=0;B<t[0].length;B++)JXG$1.isFunction(t[0][B])?I.push(t[0][B]()):I.push(t[0][B]),JXG$1.isFunction(t[1][B])?f.push(t[1][B]()):f.push(t[1][B]);else for(B=0;B<t.length;B++)if(JXG$1.isPoint(t[B]))I.push(t[B].X()),f.push(t[B].Y());else if(JXG$1.isArray(t[B])&&t[B].length===2)for(Z=0;Z<t.length;Z++)JXG$1.isFunction(t[Z][0])?I.push(t[Z][0]()):I.push(t[Z][0]),JXG$1.isFunction(t[Z][1])?f.push(t[Z][1]()):f.push(t[Z][1]);else JXG$1.isFunction(t[B])&&t[B]().length===2&&(w=t[B](),I.push(w[0]),f.push(w[1]));C=Numerics.splineDef(I,f)}return Numerics.splineEval(A,I,f,C)},function(){return I[0]},function(){return I[I.length-1]}]},o=JXG$1.copyAttributes(o,n.options,"curve"),o.curvetype="functiongraph",d=u(),r=new JXG$1.Curve(n,["x","x",d[0],d[1],d[2]],o),r.setParents(t),r.elType="spline",r};JXG$1.registerElement("spline",JXG$1.createSpline);JXG$1.createCardinalSpline=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w=`
Possible parent types: [points:array, tau:number|function, type:string]`;if(!JXG$1.exists(t[0])||!JXG$1.isArray(t[0]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 1 'points' has to be array of points or coordinate pairs"+w);if(!JXG$1.exists(t[1])||!JXG$1.isNumber(t[1])&&!JXG$1.isFunction(t[1]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 2 'tau' has to be number between [0,1] or function'"+w);if(!JXG$1.exists(t[2])||!JXG$1.isString(t[2]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 3 'type' has to be string 'uniform' or 'centripetal'"+w);if(o=JXG$1.copyAttributes(o,n.options,"curve"),o=JXG$1.copyAttributes(o,n.options,"cardinalspline"),o.curvetype="parameter",f=t[0],A=[],!o.isarrayofcoordinates&&f.length===2&&JXG$1.isArray(f[0])&&JXG$1.isArray(f[1])&&f[0].length===f[1].length)for(G=0;G<f[0].length;G++)A[G]=[],JXG$1.isFunction(f[0][G])?A[G].push(f[0][G]()):A[G].push(f[0][G]),JXG$1.isFunction(f[1][G])?A[G].push(f[1][G]()):A[G].push(f[1][G]);else for(G=0;G<f.length;G++)JXG$1.isString(f[G])?A.push(n.select(f[G])):JXG$1.isPoint(f[G])?A.push(f[G]):JXG$1.isArray(f[G])&&f[G].length===2?(A[G]=[],JXG$1.isFunction(f[G][0])?A[G].push(f[G][0]()):A[G].push(f[G][0]),JXG$1.isFunction(f[G][1])?A[G].push(f[G][1]()):A[G].push(f[G][1])):JXG$1.isFunction(f[G])&&f[G]().length===2&&A.push(t[G]());if(o.createpoints===!0)d=JXG$1.providePoints(n,A,o,"cardinalspline",["points"]);else for(d=[],u=function(V){return{X:function(){return A[V][0]},Y:function(){return A[V][1]},Dist:function(Y){var J=this.X()-Y.X(),T=this.Y()-Y.Y();return Mat.hypot(J,T)}}},G=0;G<A.length;G++)JXG$1.isPoint(A[G])?d.push(A[G]):d.push(u(G));for(C=t[1],I=t[2],Z=["x"].concat(Numerics.CardinalSpline(d,C,I)),r=new JXG$1.Curve(n,Z,o),B=d.length,r.setParents(d),G=0;G<B;G++)f=d[G],JXG$1.isPoint(f)&&(JXG$1.exists(f._is_new)?(r.addChild(f),delete f._is_new):f.addChild(r));return r.elType="cardinalspline",r};JXG$1.registerElement("cardinalspline",JXG$1.createCardinalSpline);JXG$1.createMetapostSpline=function(n,t,o){var r,u,d,C,I,f,A,G,B=`
Possible parent types: [points:array, controls:object`;if(!JXG$1.exists(t[0])||!JXG$1.isArray(t[0]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 1 'points' has to be array of points or coordinate pairs"+B);if(!JXG$1.exists(t[1])||!JXG$1.isObject(t[1]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 2 'controls' has to be a JavaScript object'"+B);if(o=JXG$1.copyAttributes(o,n.options,"curve"),o=JXG$1.copyAttributes(o,n.options,"metapostspline"),o.curvetype="parameter",I=t[0],f=[],!o.isarrayofcoordinates&&I.length===2&&JXG$1.isArray(I[0])&&JXG$1.isArray(I[1])&&I[0].length===I[1].length)for(A=0;A<I[0].length;A++)f[A]=[],JXG$1.isFunction(I[0][A])?f[A].push(I[0][A]()):f[A].push(I[0][A]),JXG$1.isFunction(I[1][A])?f[A].push(I[1][A]()):f[A].push(I[1][A]);else for(A=0;A<I.length;A++)JXG$1.isString(I[A])?f.push(n.select(I[A])):JXG$1.isPoint(I[A])?f.push(I[A]):JXG$1.isArray(I[A])&&I[A].length===2?(f[A]=[],JXG$1.isFunction(I[A][0])?f[A].push(I[A][0]()):f[A].push(I[A][0]),JXG$1.isFunction(I[A][1])?f[A].push(I[A][1]()):f[A].push(I[A][1])):JXG$1.isFunction(I[A])&&I[A]().length===2&&f.push(t[A]());if(o.createpoints===!0)d=JXG$1.providePoints(n,f,o,"metapostspline",["points"]);else for(d=[],u=function(Z){return{X:function(){return f[Z][0]},Y:function(){return f[Z][1]}}},A=0;A<f.length;A++)JXG$1.isPoint(f[A])?d.push(f[A]):d.push(u);for(C=t[1],r=new JXG$1.Curve(n,["t",[],[],0,I.length-1],o),r.updateDataArray=function(){var Z,w,V=d.length,Y=[];for(w=0;w<V;w++)Y.push([d[w].X(),d[w].Y()]);Z=Metapost.curve(Y,C),this.dataX=Z[0],this.dataY=Z[1]},r.bezierDegree=3,G=d.length,r.setParents(d),A=0;A<G;A++)JXG$1.isPoint(d[A])&&d[A].addChild(r);return r.elType="metapostspline",r};JXG$1.registerElement("metapostspline",JXG$1.createMetapostSpline);JXG$1.createRiemannsum=function(n,t,o){var r,u,d,C,I,f;if(f=JXG$1.copyAttributes(o,n.options,"riemannsum"),f.curvetype="plot",d=t[0],r=JXG$1.createFunction(t[1],n,""),!JXG$1.exists(r))throw new Error(`JSXGraph: JXG.createRiemannsum: argument '2' n has to be number or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);if(typeof t[2]=="string"&&(t[2]="'"+t[2]+"'"),u=JXG$1.createFunction(t[2],n,""),!JXG$1.exists(u))throw new Error(`JSXGraph: JXG.createRiemannsum: argument 3 'type' has to be string or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);return C=[[0],[0]].concat(t.slice(3)),I=n.create("curve",C,f),I.sum=0,I.Value=function(){return this.sum},I.updateDataArray=function(){var A=Numerics.riemann(d,r(),u(),this.minX(),this.maxX());this.dataX=A[0],this.dataY=A[1],this.sum=A[2]},I.addParentsFromJCFunctions([r,u]),I};JXG$1.registerElement("riemannsum",JXG$1.createRiemannsum);JXG$1.createTracecurve=function(n,t,o){var r,u,d,C;if(t.length!==2)throw new Error(`JSXGraph: Can't create trace curve with given parent'
Possible parent types: [glider, point]`);if(u=n.select(t[0]),d=n.select(t[1]),u.type!==Const.OBJECT_TYPE_GLIDER||!JXG$1.isPoint(d))throw new Error("JSXGraph: Can't create trace curve with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider, point]`);return C=JXG$1.copyAttributes(o,n.options,"tracecurve"),C.curvetype="plot",r=n.create("curve",[[0],[0]],C),r.updateDataArray=function(){var I,f,A,G,B,Z,w,V,Y,J=C.numberpoints,T=u.position,L=u.slideObject,z=L.minX(),K=L.maxX();for(f=(K-z)/J,this.dataX=[],this.dataY=[],L.elementClass!==Const.OBJECT_CLASS_CURVE&&J++,I=0;I<J;I++){A=z+I*f,Z=L.X(A)/L.Z(A),w=L.Y(A)/L.Z(A),u.setPositionDirectly(Const.COORDS_BY_USER,[Z,w]),V=!1;for(G in this.board.objects)if(this.board.objects.hasOwnProperty(G)&&(B=this.board.objects[G],B===u&&(V=!0),V&&B.needsRegularUpdate&&(Y=B.visProp.trace,B.visProp.trace=!1,B.needsUpdate=!0,B.update(!0),B.visProp.trace=Y,B===d)))break;this.dataX[I]=d.X(),this.dataY[I]=d.Y()}u.position=T,V=!1;for(G in this.board.objects)if(this.board.objects.hasOwnProperty(G)&&(B=this.board.objects[G],B===u&&(V=!0),V&&B.needsRegularUpdate&&(Y=B.visProp.trace,B.visProp.trace=!1,B.needsUpdate=!0,B.update(!0),B.visProp.trace=Y,B===d)))break},r};JXG$1.registerElement("tracecurve",JXG$1.createTracecurve);JXG$1.createStepfunction=function(n,t,o){var r,u;if(t.length!==2)throw new Error(`JSXGraph: Can't create step function with given parent'
Possible parent types: [array, array|function]`);return u=JXG$1.copyAttributes(o,n.options,"stepfunction"),r=n.create("curve",t,u),r.updateDataArray=function(){var d,C=0,I=this.xterm.length;if(this.dataX=[],this.dataY=[],I!==0)for(this.dataX[C]=this.xterm[0],this.dataY[C]=this.yterm[0],++C,d=1;d<I;++d)this.dataX[C]=this.xterm[d],this.dataY[C]=this.dataY[C-1],++C,this.dataX[C]=this.xterm[d],this.dataY[C]=this.yterm[d],++C},r};JXG$1.registerElement("stepfunction",JXG$1.createStepfunction);JXG$1.createDerivative=function(n,t,o){var r,u,d,C,I;if(t.length!==1&&t[0].class!==Const.OBJECT_CLASS_CURVE)throw new Error(`JSXGraph: Can't create derivative curve with given parent'
Possible parent types: [curve]`);return I=JXG$1.copyAttributes(o,n.options,"curve"),u=t[0],d=Numerics.D(u.X),C=Numerics.D(u.Y),r=n.create("curve",[function(f){return u.X(f)},function(f){return C(f)/d(f)},u.minX(),u.maxX()],I),r.setParents(u),r};JXG$1.registerElement("derivative",JXG$1.createDerivative);JXG$1.createCurveIntersection=function(n,t,o){var r;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve intersection with given parent'
Possible parent types: [array, array|function]`);return r=n.create("curve",[[],[]],o),r.updateDataArray=function(){var u=Clip.intersection(t[0],t[1],this.board);this.dataX=u[0],this.dataY=u[1]},r};JXG$1.createCurveUnion=function(n,t,o){var r;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve union with given parent'
Possible parent types: [array, array|function]`);return r=n.create("curve",[[],[]],o),r.updateDataArray=function(){var u=Clip.union(t[0],t[1],this.board);this.dataX=u[0],this.dataY=u[1]},r};JXG$1.createCurveDifference=function(n,t,o){var r;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve difference with given parent'
Possible parent types: [array, array|function]`);return r=n.create("curve",[[],[]],o),r.updateDataArray=function(){var u=Clip.difference(t[0],t[1],this.board);this.dataX=u[0],this.dataY=u[1]},r};JXG$1.registerElement("curvedifference",JXG$1.createCurveDifference);JXG$1.registerElement("curveintersection",JXG$1.createCurveIntersection);JXG$1.registerElement("curveunion",JXG$1.createCurveUnion);JXG$1.createBoxPlot=function(n,t,o){var r,u,d,C=JXG$1.copyAttributes(o,n.options,"boxplot");if(t.length!==3)throw new Error(`JSXGraph: Can't create box plot with given parent'
Possible parent types: [array, number|function, number|function] containing quantiles, axis, width`);if(t[0].length<5)throw new Error(`JSXGraph: Can't create box plot with given parent[0]'
parent[0] has to contain at least 5 quantiles.`);for(r=n.create("curve",[[],[]],C),d=t[0].length,r.Q=[],u=0;u<d;u++)r.Q[u]=JXG$1.createFunction(t[0][u],n);return r.x=JXG$1.createFunction(t[1],n),r.w=JXG$1.createFunction(t[2],n),r.updateDataArray=function(){var I,f,A,G,B,Z,w,V,Y;w=JXG$1.evaluate(this.visProp.smallwidth),V=JXG$1.evaluate(this.visProp.dir),Y=this.x(),A=Y-this.w()*.5,G=Y-this.w()*.5*w,B=Y+this.w()*.5,Z=Y+this.w()*.5*w,I=[Y,G,Z,Y,Y,A,A,B,B,Y,NaN,A,B,NaN,Y,Y,G,Z,Y],f=[this.Q[0](),this.Q[0](),this.Q[0](),this.Q[0](),this.Q[1](),this.Q[1](),this.Q[3](),this.Q[3](),this.Q[1](),this.Q[1](),NaN,this.Q[2](),this.Q[2](),NaN,this.Q[3](),this.Q[4](),this.Q[4](),this.Q[4](),this.Q[4]()],V==="vertical"?(this.dataX=I,this.dataY=f):(this.dataX=f,this.dataY=I)},r.addParentsFromJCFunctions([r.Q,r.x,r.w]),r};JXG$1.registerElement("boxplot",JXG$1.createBoxPlot);JXG$1.createImplicitCurve=function(n,t,o){var r,u;if([1,3,5].indexOf(t.length)<0)throw new Error(`JSXGraph: Can't create curve implicitCurve with given parent'
Possible parent types: [f], [f, rangex, rangey], [f, dfx, dfy] or [f, dfx, dfy, rangex, rangey]
with functions f, dfx, dfy and arrays of length 2 rangex, rangey.`);return u=JXG$1.copyAttributes(o,n.options,"implicitcurve"),r=n.create("curve",[[],[]],u),r.f=JXG$1.createFunction(t[0],n,"x, y"),r.dfx=JXG$1.createFunction(t[1],n,"x, y"),r.dfy=JXG$1.createFunction(t[2],n,"x, y"),r.domain=null,t.length===5?r.domain=[t[3],t[4]]:t.length===3&&(r.domain=[t[1],t[2]]),r.updateDataArray=function(){var d,C,I,f,A,G=[],B;this.domain===null?(B=JXG$1.evaluate(this.visProp.margin),d=this.board.getBoundingBox(),d[0]-=B,d[1]+=B,d[2]+=B,d[3]-=B):(C=JXG$1.evaluate(this.domain[0]),I=JXG$1.evaluate(this.domain[1]),d=[C[0],I[1],C[1],I[0]]),A={resolution_out:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_outer)),resolution_in:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_inner)),max_steps:JXG$1.evaluate(this.visProp.max_steps),alpha_0:JXG$1.evaluate(this.visProp.alpha_0),tol_u0:JXG$1.evaluate(this.visProp.tol_u0),tol_newton:JXG$1.evaluate(this.visProp.tol_newton),tol_cusp:JXG$1.evaluate(this.visProp.tol_cusp),tol_progress:JXG$1.evaluate(this.visProp.tol_progress),qdt_box:JXG$1.evaluate(this.visProp.qdt_box),kappa_0:JXG$1.evaluate(this.visProp.kappa_0),delta_0:JXG$1.evaluate(this.visProp.delta_0),h_initial:JXG$1.evaluate(this.visProp.h_initial),h_critical:JXG$1.evaluate(this.visProp.h_critical),h_max:JXG$1.evaluate(this.visProp.h_max),loop_dist:JXG$1.evaluate(this.visProp.loop_dist),loop_dir:JXG$1.evaluate(this.visProp.loop_dir),loop_detection:JXG$1.evaluate(this.visProp.loop_detection),unitX:this.board.unitX,unitY:this.board.unitY},this.dataX=[],this.dataY=[],f=new ImplicitPlot(d,A,this.f,this.dfx,this.dfy),this.qdt=f.qdt,G=f.plot(),this.dataX=G[0],this.dataY=G[1]},r.elType="implicitcurve",r};JXG$1.registerElement("implicitcurve",JXG$1.createImplicitCurve);JXG$1.Curve;JXG$1.createArc=function(n,t,o){var r,u,d;if(d=JXG$1.providePoints(n,t,o,"arc",["center","radiuspoint","anglepoint"]),d===!1||d.length<3)throw new Error("JSXGraph: Can't create Arc with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [arc, transformation]`);return u=JXG$1.copyAttributes(o,n.options,"arc"),r=n.create("curve",[[0],[0]],u),r.elType="arc",r.setParents(d),r.type=Const.OBJECT_TYPE_ARC,r.center=d[0],r.radiuspoint=d[1],r.point2=r.radiuspoint,r.anglepoint=d[2],r.point3=r.anglepoint,JXG$1.exists(r.center._is_new)?(r.addChild(r.center),delete r.center._is_new):r.center.addChild(r),JXG$1.exists(r.radiuspoint._is_new)?(r.addChild(r.radiuspoint),delete r.radiuspoint._is_new):r.radiuspoint.addChild(r),JXG$1.exists(r.anglepoint._is_new)?(r.addChild(r.anglepoint),delete r.anglepoint._is_new):r.anglepoint.addChild(r),r.useDirection=u.usedirection,r.updateDataArray=function(){var C,I,f,A,G,B,Z=1,w=this.radiuspoint,V=this.center,Y=this.anglepoint,J=JXG$1.evaluate(this.visProp.selection);I=Geometry.rad(w,V,Y),(J==="minor"&&I>Math.PI||J==="major"&&I<Math.PI)&&(Z=-1),this.useDirection&&(A=d[1].coords.usrCoords,G=d[3].coords.usrCoords,B=d[2].coords.usrCoords,f=(A[1]-B[1])*(A[2]-G[2])-(A[2]-B[2])*(A[1]-G[1]),f<0?(this.radiuspoint=d[1],this.anglepoint=d[2]):(this.radiuspoint=d[2],this.anglepoint=d[1])),w=w.coords.usrCoords,V=V.coords.usrCoords,Y=Y.coords.usrCoords,C=Geometry.bezierArc(w,V,Y,!1,Z),this.dataX=C[0],this.dataY=C[1],this.bezierDegree=3,this.updateStdform(),this.updateQuadraticform()},r.Radius=function(){return this.radiuspoint.Dist(this.center)},r.getRadius=function(){return JXG$1.deprecated("Arc.getRadius()","Arc.Radius()"),this.Radius()},r.Value=function(C,I){var f;return I=I||Geometry.rad(this.radiuspoint,this.center,this.anglepoint),C=C||"length",C=C.toLocaleLowerCase(),C===""||C.indexOf("len")===0?f=I*this.Radius():C.indexOf("rad")===0?f=I:C.indexOf("deg")===0?f=I*180/Math.PI:C.indexOf("sem")===0?f=I/Math.PI:C.indexOf("cir")===0&&(f=I*.5/Math.PI),f},r.L=function(){return this.Value("length")},r.hasPoint=function(C,I){var f,A,G,B,Z,w,V,Y=this.Radius();return JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(C,I):(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(V=this.board._inputDevice,w=JXG$1.evaluate(this.visProp.precision[V])):w=this.board.options.precision.hasPoint,w/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),A=new Coords(Const.COORDS_BY_SCREEN,[C,I],this.board),this.transformations.length>0&&(this.updateTransformMatrix(),B=Mat.inverse(this.transformMat),Z=Mat.matVecMult(B,A.usrCoords),A=new Coords(Const.COORDS_BY_USER,Z,this.board)),f=this.center.coords.distance(Const.COORDS_BY_USER,A),G=Math.abs(f-Y)<w,G&&(G=Geometry.coordsOnArc(this,A)),G)},r.hasPointSector=function(C,I){var f=new Coords(Const.COORDS_BY_SCREEN,[C,I],this.board),A=this.Radius(),G=this.center.coords.distance(Const.COORDS_BY_USER,f),B=G<A;return B&&(B=Geometry.coordsOnArc(this,f)),B},r.getTextAnchor=function(){return this.center.coords},r.getLabelAnchor=function(){var C,I,f,A,G,B=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),Z=10/this.board.unitX,w=10/this.board.unitY,V=this.point2.coords.usrCoords,Y=this.center.coords.usrCoords,J=V[1]-Y[1],T=V[2]-Y[2],L=JXG$1.evaluate(this.visProp.selection),z=this.label?this.label.visProp:this.visProp.label;return(L==="minor"&&B>Math.PI||L==="major"&&B<Math.PI)&&(B=-(2*Math.PI-B)),C=new Coords(Const.COORDS_BY_USER,[Y[1]+Math.cos(B*.5)*J-Math.sin(B*.5)*T,Y[2]+Math.sin(B*.5)*J+Math.cos(B*.5)*T],this.board),f=C.usrCoords[1]-Y[1],A=C.usrCoords[2]-Y[2],G=Mat.hypot(f,A),f=f*(G+Z)/G,A=A*(G+w)/G,I=[Y[1]+f,Y[2]+A],z.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],I)),new Coords(Const.COORDS_BY_USER,I,this.board)},r.updateQuadraticform=Circle.prototype.updateQuadraticform,r.updateStdform=Circle.prototype.updateStdform,r.methodMap=JXG$1.deepCopy(r.methodMap,{getRadius:"getRadius",radius:"Radius",Radius:"Radius",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint",Value:"Value",L:"L"}),r.prepareUpdate().update(),r};JXG$1.registerElement("arc",JXG$1.createArc);JXG$1.createSemicircle=function(n,t,o){var r,u,d,C;if(C=JXG$1.providePoints(n,t,o,"point"),C===!1||C.length!==2)throw new Error("JSXGraph: Can't create Semicircle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point]`);return d=JXG$1.copyAttributes(o,n.options,"semicircle","center"),u=n.create("midpoint",C,d),u.dump=!1,d=JXG$1.copyAttributes(o,n.options,"semicircle"),r=n.create("arc",[u,C[1],C[0]],d),r.elType="semicircle",r.setParents([C[0].id,C[1].id]),r.subs={midpoint:u},r.inherits.push(u),r.midpoint=r.center=u,r};JXG$1.registerElement("semicircle",JXG$1.createSemicircle);JXG$1.createCircumcircleArc=function(n,t,o){var r,u,d,C;if(C=JXG$1.providePoints(n,t,o,"point"),C===!1||C.length!==3)throw new Error("JSXGraph: create Circumcircle Arc with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);return d=JXG$1.copyAttributes(o,n.options,"circumcirclearc","center"),u=n.create("circumcenter",C,d),u.dump=!1,d=JXG$1.copyAttributes(o,n.options,"circumcirclearc"),d.usedirection=!0,r=n.create("arc",[u,C[0],C[2],C[1]],d),r.elType="circumcirclearc",r.setParents([C[0].id,C[1].id,C[2].id]),r.subs={center:u},r.inherits.push(u),r.center=u,r};JXG$1.registerElement("circumcirclearc",JXG$1.createCircumcircleArc);JXG$1.createMinorArc=function(n,t,o){return o.selection="minor",JXG$1.createArc(n,t,o)};JXG$1.registerElement("minorarc",JXG$1.createMinorArc);JXG$1.createMajorArc=function(n,t,o){return o.selection="major",JXG$1.createArc(n,t,o)};JXG$1.registerElement("majorarc",JXG$1.createMajorArc);JXG$1.createSector=function(n,t,o){var r,u,d,C="invalid",I,f,A=["center","radiusPoint","anglePoint"],G;if(t[0].elementClass===Const.OBJECT_CLASS_LINE&&t[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(t[2])||JXG$1.isNumber(t[2]))&&(JXG$1.isArray(t[3])||JXG$1.isNumber(t[3]))&&(JXG$1.isNumber(t[4])||JXG$1.isFunction(t[4])||JXG$1.isString(t[4])))C="2lines";else{if(G=JXG$1.providePoints(n,t,o,"sector",A),G===!1)throw new Error("JSXGraph: Can't create Sector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");C="3points"}if(u=JXG$1.copyAttributes(o,n.options,"sector"),r=n.create("curve",[[0],[0]],u),r.type=Const.OBJECT_TYPE_SECTOR,r.elType="sector",r.autoRadius=function(){var B=20/r.board.unitX,Z=1/0,w=50/r.board.unitX;return JXG$1.isPoint(r.center)&&(Z=r.center.Dist(r.point2)*.3333),Math.max(B,Math.min(Z,w))},C==="2lines")r.Radius=function(){var B=JXG$1.evaluate(t[4]);return B==="auto"?this.autoRadius():B},r.line1=n.select(t[0]),r.line2=n.select(t[1]),r.line1.addChild(r),r.line2.addChild(r),r.setParents(t),r.point1={visProp:{}},r.point2={visProp:{}},r.point3={visProp:{}},I=Geometry.meetLineLine(r.line1.stdform,r.line2.stdform,0,n),JXG$1.isArray(t[2])?(t[2].length===2&&(t[2]=[1].concat(t[2])),f=Geometry.projectPointToLine({coords:{usrCoords:t[2]}},r.line1,n),f=Statistics.subtract(f.usrCoords,I.usrCoords),r.direction1=Mat.innerProduct(f,[0,r.line1.stdform[2],-r.line1.stdform[1]],3)>=0?1:-1):r.direction1=t[2]>=0?1:-1,JXG$1.isArray(t[3])?(t[3].length===2&&(t[3]=[1].concat(t[3])),f=Geometry.projectPointToLine({coords:{usrCoords:t[3]}},r.line2,n),f=Statistics.subtract(f.usrCoords,I.usrCoords),r.direction2=Mat.innerProduct(f,[0,r.line2.stdform[2],-r.line2.stdform[1]],3)>=0?1:-1):r.direction2=t[3]>=0?1:-1,r.methodMap=JXG$1.deepCopy(r.methodMap,{arc:"arc",center:"center",line1:"line1",line2:"line2"}),r.updateDataArray=function(){var B,Z,w,V=[0,0,0],Y=[0,0,0],J=[0,0,0],T;if(Z=this.line1,w=this.line2,Y=Mat.crossProduct(Z.stdform,w.stdform),Math.abs(Y[0])>Mat.eps*Mat.eps&&(Y[1]/=Y[0],Y[2]/=Y[0],Y[0]/=Y[0]),B=this.direction1*this.Radius(),V=Statistics.add(Y,[0,B*Z.stdform[2],-B*Z.stdform[1]]),B=this.direction2*this.Radius(),J=Statistics.add(Y,[0,B*w.stdform[2],-B*w.stdform[1]]),this.point2.coords=new Coords(Const.COORDS_BY_USER,V,r.board),this.point1.coords=new Coords(Const.COORDS_BY_USER,Y,r.board),this.point3.coords=new Coords(Const.COORDS_BY_USER,J,r.board),Math.abs(V[0])<Mat.eps||Math.abs(Y[0])<Mat.eps||Math.abs(J[0])<Mat.eps){this.dataX=[NaN],this.dataY=[NaN];return}T=Geometry.bezierArc(V,Y,J,!0,1),this.dataX=T[0],this.dataY=T[1],this.bezierDegree=3};else if(C==="3points"){for(r.point1=G[0],r.point2=G[1],r.point3=G[2],d=0;d<3;d++)JXG$1.exists(G[d]._is_new)?(r.addChild(G[d]),delete G[d]._is_new):G[d].addChild(r);r.useDirection=o.usedirection,r.setParents(G),JXG$1.exists(G[3])&&(r.point4=G[3],r.point4.addChild(r)),r.methodMap=JXG$1.deepCopy(r.methodMap,{arc:"arc",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint"}),r.updateDataArray=function(){var B,Z,w,V,Y,J=this.point2,T=this.point1,L=this.point3,z,K=1,P=JXG$1.evaluate(this.visProp.selection);if(!J.isReal||!T.isReal||!L.isReal){this.dataX=[NaN],this.dataY=[NaN];return}z=Geometry.rad(J,T,L),(P==="minor"&&z>Math.PI||P==="major"&&z<Math.PI)&&(K=-1),this.useDirection&&JXG$1.exists(this.point4)&&(w=this.point2.coords.usrCoords,V=this.point4.coords.usrCoords,Y=this.point3.coords.usrCoords,Z=(w[1]-Y[1])*(w[2]-V[2])-(w[2]-Y[2])*(w[1]-V[1]),Z>=0&&(L=this.point2,J=this.point3)),J=J.coords.usrCoords,T=T.coords.usrCoords,L=L.coords.usrCoords,B=Geometry.bezierArc(J,T,L,!0,K),this.dataX=B[0],this.dataY=B[1],this.bezierDegree=3},r.Radius=function(){return this.point2.Dist(this.point1)}}return r.center=r.point1,r.radiuspoint=r.point2,r.anglepoint=r.point3,u=JXG$1.copyAttributes(o,n.options,"arc"),u=JXG$1.copyAttributes(u,n.options,"sector","arc"),u.withLabel=!1,u.selection=r.visProp.selection,u.name+="_arc",C==="2lines"?(r.updateDataArray(),r.arc=n.create("arc",[function(){return r.point1.coords.usrCoords},function(){var B=r.point2.coords.distance(Const.COORDS_BY_USER,r.point1.coords);return B===0?[r.point1.coords.usrCoords[1],r.point1.coords.usrCoords[2]]:[r.point1.coords.usrCoords[1]+r.Radius()*(r.point2.coords.usrCoords[1]-r.point1.coords.usrCoords[1])/B,r.point1.coords.usrCoords[2]+r.Radius()*(r.point2.coords.usrCoords[2]-r.point1.coords.usrCoords[2])/B]},function(){return r.point3.coords.usrCoords}],u)):r.arc=n.create("arc",[r.point1,function(){var B=r.point2.Dist(r.point1);return B===0?[r.point1.X(),r.point1.Y()]:[r.point1.X()+r.Radius()*(r.point2.X()-r.point1.X())/B,r.point1.Y()+r.Radius()*(r.point2.Y()-r.point1.Y())/B]},r.point3],u),r.addChild(r.arc),r.hasPointCurve=function(B,Z){var w,V,Y,J,T,L=new Coords(Const.COORDS_BY_SCREEN,[B,Z],this.board),z=this.Radius(),K=this.center.coords.distance(Const.COORDS_BY_USER,L),P,$=JXG$1.evaluate(this.visProp.selection);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(T=this.board._inputDevice,J=JXG$1.evaluate(this.visProp.precision[T])):J=this.board.options.precision.hasPoint,J/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),P=Math.abs(K-z)<J,P&&(w=Geometry.rad(this.point2,this.center,L.usrCoords.slice(1)),V=0,Y=Geometry.rad(this.point2,this.center,this.point3),($==="minor"&&Y>Math.PI||$==="major"&&Y<Math.PI)&&(V=Y,Y=2*Math.PI),(w<V||w>Y)&&(P=!1)),P},r.hasPointSector=function(B,Z){var w,V=new Coords(Const.COORDS_BY_SCREEN,[B,Z],this.board),Y=this.Radius(),J=this.point1.coords.distance(Const.COORDS_BY_USER,V),T,L,z=J<Y,K=JXG$1.evaluate(this.visProp.selection);return z&&(w=Geometry.rad(this.radiuspoint,this.center,V.usrCoords.slice(1)),T=0,L=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),(K==="minor"&&L>Math.PI||K==="major"&&L<Math.PI)&&(T=L,L=2*Math.PI),(w<T||w>L)&&(z=!1)),z},r.hasPoint=function(B,Z){return JXG$1.evaluate(this.visProp.highlightonsector)||JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(B,Z):this.hasPointCurve(B,Z)},r.getTextAnchor=function(){return this.point1.coords},r.getLabelAnchor=function(){var B,Z,w,V,Y,J=Geometry.rad(this.point2,this.point1,this.point3),T=13/this.board.unitX,L=13/this.board.unitY,z=this.point2.coords.usrCoords,K=this.point1.coords.usrCoords,P=z[1]-K[1],$=z[2]-K[2],ie=JXG$1.evaluate(this.visProp.selection),ne=this.label?this.label.visProp:this.visProp.label;return(ie==="minor"&&J>Math.PI||ie==="major"&&J<Math.PI)&&(J=-(2*Math.PI-J)),B=new Coords(Const.COORDS_BY_USER,[K[1]+Math.cos(J*.5)*P-Math.sin(J*.5)*$,K[2]+Math.sin(J*.5)*P+Math.cos(J*.5)*$],this.board),w=B.usrCoords[1]-K[1],V=B.usrCoords[2]-K[2],Y=Mat.hypot(w,V),w=w*(Y+T)/Y,V=V*(Y+L)/Y,Z=[K[1]+w,K[2]+V],ne.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],Z)),new Coords(Const.COORDS_BY_USER,Z,this.board)},r.setRadius=function(B){var Z,w=JXG$1.evaluate(B);B==="auto"||w==="auto"?Z="auto":JXG$1.isNumber(B)?Z="number":JXG$1.isFunction(B)&&!JXG$1.isString(w)?Z="function":Z="undefined",Z!=="undefined"&&(this.visProp.radius=B),r.Radius=function(){var V=JXG$1.evaluate(B);return V==="auto"?this.autoRadius():V}},r.getRadius=function(){return JXG$1.deprecated("Sector.getRadius()","Sector.Radius()"),this.Radius()},r.Value=function(B){return this.arc.Value(B)},r.L=function(){return this.arc.L()},r.Area=function(){var B=this.Radius();return .5*B*B*this.Value("radians")},r.Perimeter=function(){return this.L()+2*this.Radius()},C==="3points"&&(r.setPositionDirectly=function(B,Z,w){var V,Y,J=new Coords(B,Z,this.board),T=new Coords(B,w,this.board);return!r.point1.draggable()||!r.point2.draggable()||!r.point3.draggable()?this:(V=Statistics.subtract(J.usrCoords,T.usrCoords),Y=this.board.create("transform",V.slice(1),{type:"translate"}),Y.applyOnce([r.point1,r.point2,r.point3]),this)}),r.methodMap=JXG$1.deepCopy(r.methodMap,{radius:"Radius",Radius:"Radius",getRadius:"Radius",setRadius:"setRadius",Value:"Value",L:"L",Area:"Area",Perimeter:"Perimeter"}),r};JXG$1.registerElement("sector",JXG$1.createSector);JXG$1.createCircumcircleSector=function(n,t,o){var r,u,d,C;if(C=JXG$1.providePoints(n,t,o,"point"),C===!1)throw new Error("JSXGraph: Can't create circumcircle sector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");return u=n.create("circumcenter",C.slice(0,3),d),u.dump=!1,d=JXG$1.copyAttributes(o,n.options,"circumcirclesector"),r=n.create("sector",[u,C[0],C[2],C[1]],d),r.elType="circumcirclesector",r.setParents(C),r.center=u,r.subs={center:u},r};JXG$1.registerElement("circumcirclesector",JXG$1.createCircumcircleSector);JXG$1.createMinorSector=function(n,t,o){return o.selection="minor",JXG$1.createSector(n,t,o)};JXG$1.registerElement("minorsector",JXG$1.createMinorSector);JXG$1.createMajorSector=function(n,t,o){return o.selection="major",JXG$1.createSector(n,t,o)};JXG$1.registerElement("majorsector",JXG$1.createMajorSector);JXG$1.createAngle=function(n,t,o){var r,u,d,C,I,f,A="invalid";if(t[0].elementClass===Const.OBJECT_CLASS_LINE&&t[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(t[2])||JXG$1.isNumber(t[2]))&&(JXG$1.isArray(t[3])||JXG$1.isNumber(t[3])))A="2lines";else{if(d={name:""},f=JXG$1.providePoints(n,t,d,"point"),f===!1)throw new Error("JSXGraph: Can't create angle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");A="3points"}if(d=JXG$1.copyAttributes(o,n.options,"angle"),JXG$1.exists(d.name)||(d.name=n.generateName({type:Const.OBJECT_TYPE_ANGLE})),JXG$1.exists(d.radius)?u=d.radius:u=0,n.suspendUpdate(),A==="2lines"?(t.push(u),r=n.create("sector",t,d),r.updateDataArraySector=r.updateDataArray,r.setAngle=function(G){},r.free=function(G){}):(r=n.create("sector",[f[1],f[0],f[2]],d),r.arc.visProp.priv=!0,r.point=r.point2=r.radiuspoint=f[0],r.pointsquare=r.point3=r.anglepoint=f[2],r.Radius=function(){var G=JXG$1.evaluate(u);return G==="auto"?r.autoRadius():G},r.updateDataArraySector=function(){var G=this.point2,B=this.point1,Z=this.point3,w=this.Radius(),V=B.Dist(G),Y,J,T=1,L=JXG$1.evaluate(this.visProp.selection);J=Geometry.rad(G,B,Z),(L==="minor"&&J>Math.PI||L==="major"&&J<Math.PI)&&(T=-1),G=G.coords.usrCoords,B=B.coords.usrCoords,Z=Z.coords.usrCoords,G=[1,B[1]+(G[1]-B[1])*w/V,B[2]+(G[2]-B[2])*w/V],Z=[1,B[1]+(Z[1]-B[1])*w/V,B[2]+(Z[2]-B[2])*w/V],Y=Geometry.bezierArc(G,B,Z,!0,T),this.dataX=Y[0],this.dataY=Y[1],this.bezierDegree=3},r.setAngle=function(G){var B,Z,w,V=this.anglepoint,Y=this.radiuspoint;return V.draggable()&&(B=this.board.create("transform",[G,this.center],{type:"rotate"}),V.addTransform(Y,B),B.update(),V.moveTo(Mat.matVecMult(B.matrix,Y.coords.usrCoords)),JXG$1.isFunction(G)?w=function(){return Math.PI*2-G()}:w=function(){return Math.PI*2-G},Z=this.board.create("transform",[w,this.center],{type:"rotate"}),V.coords.on("update",function(){Z.update(),Y.moveTo(Mat.matVecMult(Z.matrix,V.coords.usrCoords))}),V.setParents(Y),this.hasFixedAngle=!0),this},r.free=function(){var G=this.anglepoint;return G.transformations.length>0&&(G.transformations.pop(),G.isDraggable=!0,G.parents=[],G.coords.off("update")),this.hasFixedAngle=!1,this},r.setParents(f)),JXG$1.exists(r.visProp.text)&&r.label.setText(JXG$1.evaluate(r.visProp.text)),r.elType="angle",r.type=Const.OBJECT_TYPE_ANGLE,r.subs={},r.updateDataArraySquare=function(){var G,B,Z,w,V,Y,J,T,L=this.Radius();A==="2lines"&&this.updateDataArraySector(),G=this.point2,B=this.point1,Z=this.point3,G=G.coords.usrCoords,B=B.coords.usrCoords,Z=Z.coords.usrCoords,w=Geometry.distance(G,B,3),V=Geometry.distance(Z,B,3),G=[1,B[1]+(G[1]-B[1])*L/w,B[2]+(G[2]-B[2])*L/w],Z=[1,B[1]+(Z[1]-B[1])*L/V,B[2]+(Z[2]-B[2])*L/V],Y=Mat.crossProduct(Z,B),J=[-G[1]*Y[1]-G[2]*Y[2],G[0]*Y[1],G[0]*Y[2]],Y=Mat.crossProduct(G,B),T=[-Z[1]*Y[1]-Z[2]*Y[2],Z[0]*Y[1],Z[0]*Y[2]],Y=Mat.crossProduct(J,T),Y[1]/=Y[0],Y[2]/=Y[0],this.dataX=[B[1],G[1],Y[1],Z[1],B[1]],this.dataY=[B[2],G[2],Y[2],Z[2],B[2]],this.bezierDegree=1},r.updateDataArrayNone=function(){this.dataX=[NaN],this.dataY=[NaN],this.bezierDegree=1},r.updateDataArray=function(){var G=JXG$1.evaluate(this.visProp.type),B=Geometry.trueAngle(this.point2,this.point1,this.point3),Z=JXG$1.evaluate(this.visProp.selection);(Z==="minor"&&B>180||Z==="major"&&B<180)&&(B=360-B),Math.abs(B-90)<JXG$1.evaluate(this.visProp.orthosensitivity)+Mat.eps&&(G=JXG$1.evaluate(this.visProp.orthotype)),G==="none"?this.updateDataArrayNone():G==="square"?this.updateDataArraySquare():G==="sector"?this.updateDataArraySector():G==="sectordot"&&(this.updateDataArraySector(),this.dot.visProp.visible||this.dot.setAttribute({visible:!0})),(!this.visProp.visible||G!=="sectordot"&&this.dot.visProp.visible)&&this.dot.setAttribute({visible:!1})},C=JXG$1.copyAttributes(o,n.options,"angle","dot"),r.dot=n.create("point",[function(){var G,B,Z,w,V,Y,J,T,L;return JXG$1.exists(r.dot)&&!r.dot.visProp.visible?[0,0]:(G=r.point2.coords.usrCoords,B=r.point1.coords.usrCoords,Z=r.Radius(),w=Geometry.distance(G,B,3),V=Geometry.rad(r.point2,r.point1,r.point3),L=JXG$1.evaluate(r.visProp.selection),(L==="minor"&&V>Math.PI||L==="major"&&V<Math.PI)&&(V=-(2*Math.PI-V)),V*=.5,Y=Math.cos(V),J=Math.sin(V),G=[1,B[1]+(G[1]-B[1])*Z/w,B[2]+(G[2]-B[2])*Z/w],T=[[1,0,0],[B[1]-.5*B[1]*Y+.5*B[2]*J,Y*.5,-J*.5],[B[2]-.5*B[1]*J-.5*B[2]*Y,J*.5,Y*.5]],Mat.matVecMult(T,G))}],C),r.dot.dump=!1,r.subs.dot=r.dot,A==="2lines")for(I=0;I<2;I++)n.select(t[I]).addChild(r.dot);else for(I=0;I<3;I++)n.select(f[I]).addChild(r.dot);return n.unsuspendUpdate(),r.Value=function(G){return G=G||"radians",G===""&&(G="radians"),r.arc.Value(G)},r.getLabelAnchor=function(){var G,B=12,Z,w,V,Y,J,T,L,z,K=JXG$1.evaluate(r.visProp.selection),P=this.label?this.label.visProp:this.visProp.label;return JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp.fontsize)&&(B=JXG$1.evaluate(this.label.visProp.fontsize)),B/=this.board.unitX,Z=r.point2.coords.usrCoords,w=r.point1.coords.usrCoords,V=r.Radius(),Y=Geometry.distance(Z,w,3),J=Geometry.rad(r.point2,r.point1,r.point3),(K==="minor"&&J>Math.PI||K==="major"&&J<Math.PI)&&(J=-(2*Math.PI-J)),J*=.5,T=Math.cos(J),L=Math.sin(J),Z=[1,w[1]+(Z[1]-w[1])*V/Y,w[2]+(Z[2]-w[2])*V/Y],z=[[1,0,0],[w[1]-.5*w[1]*T+.5*w[2]*L,T*.5,-L*.5],[w[2]-.5*w[1]*L-.5*w[2]*T,L*.5,T*.5]],G=Mat.matVecMult(z,Z),G[1]/=G[0],G[2]/=G[0],G[0]/=G[0],Y=Geometry.distance(G,w,3),G=[G[0],w[1]+(G[1]-w[1])*(V+B)/Y,w[2]+(G[2]-w[2])*(V+B)/Y],P.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],G)),new Coords(Const.COORDS_BY_USER,G,this.board)},r.methodMap=JXG$1.deepCopy(r.methodMap,{setAngle:"setAngle",Value:"Value",free:"free"}),r};JXG$1.registerElement("angle",JXG$1.createAngle);JXG$1.createNonreflexAngle=function(n,t,o){var r;return o.selection="minor",o=JXG$1.copyAttributes(o,n.options,"nonreflexangle"),r=JXG$1.createAngle(n,t,o),r.Value=function(u){var d=Geometry.rad(this.point2,this.point1,this.point3);return u=u||"radians",u===""&&(u="radians"),d=d<Math.PI?d:2*Math.PI-d,this.arc.Value(u,d)},r};JXG$1.registerElement("nonreflexangle",JXG$1.createNonreflexAngle);JXG$1.createReflexAngle=function(n,t,o){var r;return o.selection="major",o=JXG$1.copyAttributes(o,n.options,"reflexangle"),r=JXG$1.createAngle(n,t,o),r.Value=function(u){var d=Geometry.rad(this.point2,this.point1,this.point3);return u=u||"radians",u===""&&(u="radians"),d=d>=Math.PI?d:2*Math.PI-d,this.arc.Value(u,d)},r};JXG$1.registerElement("reflexangle",JXG$1.createReflexAngle);JXG$1.createOrthogonalProjection=function(n,t,o){var r,u,d,C;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)u=JXG$1.providePoints(n,[t[0]],o,"point")[0],r=t[1];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)u=JXG$1.providePoints(n,[t[1]],o,"point")[0],r=t[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return C=JXG$1.copyAttributes(o,n.options,"orthogonalprojection"),d=n.create("point",[function(){return Geometry.projectPointToLine(u,r,n)}],C),JXG$1.exists(u._is_new)?(d.addChild(u),delete u._is_new):u.addChild(d),r.addChild(d),d.elType="orthogonalprojection",d.setParents([u.id,d.id]),d.update(),d.generatePolynomial=function(){var I=r.point1.symbolic.x,f=r.point1.symbolic.y,A=r.point2.symbolic.x,G=r.point2.symbolic.y,B=u.symbolic.x,Z=u.symbolic.y,w=d.symbolic.x,V=d.symbolic.y,Y="("+f+")*("+w+")-("+f+")*("+A+")+("+V+")*("+A+")-("+I+")*("+V+")+("+I+")*("+G+")-("+w+")*("+G+")",J="("+Z+")*("+f+")-("+Z+")*("+G+")-("+V+")*("+f+")+("+V+")*("+G+")+("+B+")*("+I+")-("+B+")*("+A+")-("+w+")*("+I+")+("+w+")*("+A+")";return[Y,J]},d};JXG$1.createPerpendicular=function(n,t,o){var r,u,d,C;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)u=t[1],r=JXG$1.providePoints(n,[t[0]],o,"point")[0];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)u=t[0],r=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point]`);return C=JXG$1.copyAttributes(o,n.options,"perpendicular"),d=JXG$1.createLine(n,[function(){return u.stdform[2]*r.X()-u.stdform[1]*r.Y()},function(){return-u.stdform[2]*r.Z()},function(){return u.stdform[1]*r.Z()}],C),d.elType="perpendicular",d.setParents([u.id,r.id]),JXG$1.exists(r._is_new)?(d.addChild(r),delete r._is_new):r.addChild(d),u.addChild(d),d};JXG$1.createPerpendicularPoint=function(n,t,o){var r,u,d;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)u=JXG$1.providePoints(n,[t[0]],o,"point")[0],r=t[1];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)u=JXG$1.providePoints(n,[t[1]],o,"point")[0],r=t[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return d=n.create("point",[function(){return Geometry.perpendicular(r,u,n)[0]}],o),JXG$1.exists(u._is_new)?(d.addChild(u),delete u._is_new):u.addChild(d),r.addChild(d),d.elType="perpendicularpoint",d.setParents([u.id,r.id]),d.update(),d.generatePolynomial=function(){var C=r.point1.symbolic.x,I=r.point1.symbolic.y,f=r.point2.symbolic.x,A=r.point2.symbolic.y,G=u.symbolic.x,B=u.symbolic.y,Z=d.symbolic.x,w=d.symbolic.y,V="("+I+")*("+Z+")-("+I+")*("+f+")+("+w+")*("+f+")-("+C+")*("+w+")+("+C+")*("+A+")-("+Z+")*("+A+")",Y="("+B+")*("+I+")-("+B+")*("+A+")-("+w+")*("+I+")+("+w+")*("+A+")+("+G+")*("+C+")-("+G+")*("+f+")-("+Z+")*("+C+")+("+Z+")*("+f+")";return[V,Y]},d};JXG$1.createPerpendicularSegment=function(n,t,o){var r,u,d,C,I;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)u=t[1],r=JXG$1.providePoints(n,[t[0]],o,"point")[0];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)u=t[0],r=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point]`);return I=JXG$1.copyAttributes(o,n.options,"perpendicularsegment","point"),C=JXG$1.createPerpendicularPoint(n,[u,r],I),C.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),I=JXG$1.copyAttributes(o,n.options,"perpendicularsegment"),d=JXG$1.createLine(n,[function(){return Geometry.perpendicular(u,r,n)[1]?[C,r]:[r,C]}],I),d.point=C,JXG$1.exists(r._is_new)?(d.addChild(r),delete r._is_new):r.addChild(d),u.addChild(d),d.elType="perpendicularsegment",d.setParents([r.id,u.id]),d.subs={point:C},d.inherits.push(C),d};JXG$1.createMidpoint=function(n,t,o){var r,u,d,C,I;for(C=0;C<t.length;++C)t[C]=n.select(t[C]);if(t.length===2&&JXG$1.isPointType(n,t[0])&&JXG$1.isPointType(n,t[1]))t=JXG$1.providePoints(n,t,o,"point"),r=t[0],u=t[1];else if(t.length===1&&t[0].elementClass===Const.OBJECT_CLASS_LINE)r=t[0].point1,u=t[0].point2;else throw new Error(`JSXGraph: Can't create midpoint.
Possible parent types: [point,point], [line]`);return I=JXG$1.copyAttributes(o,n.options,"midpoint"),d=n.create("point",[function(){var f=r.coords.usrCoords[1]+u.coords.usrCoords[1];return isNaN(f)||Math.abs(r.coords.usrCoords[0])<Mat.eps||Math.abs(u.coords.usrCoords[0])<Mat.eps?NaN:f*.5},function(){var f=r.coords.usrCoords[2]+u.coords.usrCoords[2];return isNaN(f)||Math.abs(r.coords.usrCoords[0])<Mat.eps||Math.abs(u.coords.usrCoords[0])<Mat.eps?NaN:f*.5}],I),JXG$1.exists(r._is_new)?(d.addChild(r),delete r._is_new):r.addChild(d),JXG$1.exists(u._is_new)?(d.addChild(u),delete u._is_new):u.addChild(d),d.elType="midpoint",d.setParents([r.id,u.id]),d.prepareUpdate().update(),d.generatePolynomial=function(){var f=r.symbolic.x,A=r.symbolic.y,G=u.symbolic.x,B=u.symbolic.y,Z=d.symbolic.x,w=d.symbolic.y,V="("+A+")*("+Z+")-("+A+")*("+G+")+("+w+")*("+G+")-("+f+")*("+w+")+("+f+")*("+B+")-("+Z+")*("+B+")",Y="("+f+")^2 - 2*("+f+")*("+Z+")+("+A+")^2-2*("+A+")*("+w+")-("+G+")^2+2*("+G+")*("+Z+")-("+B+")^2+2*("+B+")*("+w+")";return[V,Y]},d};JXG$1.createParallelPoint=function(n,t,o){var r,u,d,C,I,f;for(I=0;I<t.length;++I)t[I]=n.select(t[I]);if(t.length===3&&JXG$1.isPointType(n,t[0])&&JXG$1.isPointType(n,t[1])&&JXG$1.isPointType(n,t[2]))t=JXG$1.providePoints(n,t,o,"point"),r=t[0],u=t[1],d=t[2];else if(JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[0]],o,"point")[0],r=t[1].point1,u=t[1].point2;else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[1]],o,"point")[0],r=t[0].point1,u=t[0].point2;else throw new Error("JSXGraph: Can't create parallel point with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [line,point], [point,point,point]`);return f=JXG$1.copyAttributes(o,n.options,"parallelpoint"),C=n.create("point",[function(){return d.coords.usrCoords[1]+u.coords.usrCoords[1]-r.coords.usrCoords[1]},function(){return d.coords.usrCoords[2]+u.coords.usrCoords[2]-r.coords.usrCoords[2]}],f),JXG$1.exists(r._is_new)?(C.addChild(r),delete r._is_new):r.addChild(C),JXG$1.exists(u._is_new)?(C.addChild(u),delete u._is_new):u.addChild(C),JXG$1.exists(d._is_new)?(C.addChild(d),delete d._is_new):d.addChild(C),C.elType="parallelpoint",C.setParents([r.id,u.id,d.id]),C.prepareUpdate().update(),C.generatePolynomial=function(){var A=r.symbolic.x,G=r.symbolic.y,B=u.symbolic.x,Z=u.symbolic.y,w=d.symbolic.x,V=d.symbolic.y,Y=C.symbolic.x,J=C.symbolic.y,T="("+Z+")*("+Y+")-("+Z+")*("+w+")-("+G+")*("+Y+")+("+G+")*("+w+")-("+J+")*("+B+")+("+J+")*("+A+")+("+V+")*("+B+")-("+V+")*("+A+")",L="("+J+")*("+A+")-("+J+")*("+w+")-("+Z+")*("+A+")+("+Z+")*("+w+")-("+Y+")*("+G+")+("+Y+")*("+V+")+("+B+")*("+G+")-("+B+")*("+V+")";return[T,L]},C};JXG$1.createParallel=function(n,t,o){var r,u,d,C,I,f,A=1;for(I=0;I<t.length;++I)t[I]=n.select(t[I]);return r=null,t.length===3?(t=JXG$1.providePoints(n,t,o,"point"),r=t[2],A=0):JXG$1.isPointType(n,t[0])?(r=JXG$1.providePoints(n,[t[0]],o,"point")[0],C=function(){return t[1].stdform}):JXG$1.isPointType(n,t[1])&&(r=JXG$1.providePoints(n,[t[1]],o,"point")[0],C=function(){return t[0].stdform}),JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),f=JXG$1.copyAttributes(o,n.options,"parallel","point"),A===1?u=n.create("point",[function(){return Mat.crossProduct([1,0,0],C())}],f):u=n.create("parallelpoint",t,f),u.isDraggable=!0,f=JXG$1.copyAttributes(o,n.options,"parallel"),d=n.create("line",[r,u],f),d.elType="parallel",d.subs={point:u},d.inherits.push(u),d.setParents([t[0].id,t[1].id]),t.length===3&&d.addParents(t[2].id),d.point=u,d};JXG$1.createArrowParallel=function(n,t,o){var r,u;try{return u=JXG$1.copyAttributes(o,n.options,"arrowparallel"),u.lastArrow===!1&&(u.lastArrow=!0),r=JXG$1.createParallel(n,t,u).setAttribute({straightFirst:!1,straightLast:!1}),r.type=Const.OBJECT_TYPE_VECTOR,r.elType="arrowparallel",r}catch{throw new Error("JSXGraph: Can't create arrowparallel with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point], [point,point,point]`)}};JXG$1.createBisector=function(n,t,o){var r,u,d,C;if(t=JXG$1.providePoints(n,t,o,"point"),JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(C=JXG$1.copyAttributes(o,n.options,"bisector","point"),C.snapToGrid=!1,r=n.create("point",[function(){return Geometry.angleBisector(t[0],t[1],t[2],n)}],C),r.dump=!1,d=0;d<3;d++)JXG$1.exists(t[d]._is_new)?(r.addChild(t[d]),delete t[d]._is_new):t[d].addChild(r);return JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),C=JXG$1.copyAttributes(o,n.options,"bisector"),u=JXG$1.createLine(n,[t[1],r],C),u.point=r,u.elType="bisector",u.setParents(t),u.subs={point:r},u.inherits.push(r),u}throw new Error("JSXGraph: Can't create angle bisector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createAngularBisectorsOfTwoLines=function(n,t,o){var r,u,d,C,I=n.select(t[0]),f=n.select(t[1]);if(I.elementClass!==Const.OBJECT_CLASS_LINE||f.elementClass!==Const.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create angle bisectors of two lines with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,line]`);return JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),d=JXG$1.copyAttributes(o,n.options,"bisectorlines","line1"),r=n.create("line",[function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[0]/A-f.stdform[0]/G},function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[1]/A-f.stdform[1]/G},function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[2]/A-f.stdform[2]/G}],d),JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),d=JXG$1.copyAttributes(o,n.options,"bisectorlines","line2"),u=n.create("line",[function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[0]/A+f.stdform[0]/G},function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[1]/A+f.stdform[1]/G},function(){var A=Mat.hypot(I.stdform[1],I.stdform[2]),G=Mat.hypot(f.stdform[1],f.stdform[2]);return I.stdform[2]/A+f.stdform[2]/G}],d),C=new Composition({line1:r,line2:u}),r.dump=!1,u.dump=!1,C.elType="bisectorlines",C.setParents([I.id,f.id]),C.subs={line1:r,line2:u},C};JXG$1.createCircumcenter=function(n,t,o){var r,u,d,C,I;if(t=JXG$1.providePoints(n,t,o,"point"),JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(d=t[0],C=t[1],I=t[2],r=JXG$1.createPoint(n,[function(){return Geometry.circumcenter(d,C,I,n)}],o),u=0;u<3;u++)JXG$1.exists(t[u]._is_new)?(r.addChild(t[u]),delete t[u]._is_new):t[u].addChild(r);return r.elType="circumcenter",r.setParents(t),r.generatePolynomial=function(){var f=d.symbolic.x,A=d.symbolic.y,G=C.symbolic.x,B=C.symbolic.y,Z=I.symbolic.x,w=I.symbolic.y,V=r.symbolic.x,Y=r.symbolic.y,J=["((",V,")-(",f,"))^2+((",Y,")-(",A,"))^2-((",V,")-(",G,"))^2-((",Y,")-(",B,"))^2"].join(""),T=["((",V,")-(",f,"))^2+((",Y,")-(",A,"))^2-((",V,")-(",Z,"))^2-((",Y,")-(",w,"))^2"].join("");return[J,T]},r}throw new Error("JSXGraph: Can't create circumcircle midpoint with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createIncenter=function(n,t,o){var r,u,d,C,I;if(t=JXG$1.providePoints(n,t,o,"point"),t.length>=3&&JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(u=t[0],d=t[1],C=t[2],r=n.create("point",[function(){var f,A,G;return f=Mat.hypot(d.X()-C.X(),d.Y()-C.Y()),A=Mat.hypot(u.X()-C.X(),u.Y()-C.Y()),G=Mat.hypot(d.X()-u.X(),d.Y()-u.Y()),new Coords(Const.COORDS_BY_USER,[(f*u.X()+A*d.X()+G*C.X())/(f+A+G),(f*u.Y()+A*d.Y()+G*C.Y())/(f+A+G)],n)}],o),I=0;I<3;I++)JXG$1.exists(t[I]._is_new)?(r.addChild(t[I]),delete t[I]._is_new):t[I].addChild(r);r.elType="incenter",r.setParents(t)}else throw new Error("JSXGraph: Can't create incenter with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);return r};JXG$1.createCircumcircle=function(n,t,o){var r,u,d,C;if(t=JXG$1.providePoints(n,t,o,"point"),t===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);try{for(d=JXG$1.copyAttributes(o,n.options,"circumcircle","center"),r=JXG$1.createCircumcenter(n,t,d),r.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.circle),d=JXG$1.copyAttributes(o,n.options,"circumcircle"),u=JXG$1.createCircle(n,[r,t[0]],d),u.elType="circumcircle",u.setParents(t),u.subs={center:r},u.inherits.push(u),C=0;C<3;C++)JXG$1.exists(t[C]._is_new)?(u.addChild(t[C]),delete t[C]._is_new):t[C].addChild(u)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)}return u};JXG$1.createIncircle=function(n,t,o){var r,u,d,C;if(t=JXG$1.providePoints(n,t,o,"point"),t===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);try{for(C=JXG$1.copyAttributes(o,n.options,"incircle","center"),u=JXG$1.createIncenter(n,t,C),u.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.circle),C=JXG$1.copyAttributes(o,n.options,"incircle"),d=JXG$1.createCircle(n,[u,function(){var I=Mat.hypot(t[1].X()-t[2].X(),t[1].Y()-t[2].Y()),f=Mat.hypot(t[0].X()-t[2].X(),t[0].Y()-t[2].Y()),A=Mat.hypot(t[1].X()-t[0].X(),t[1].Y()-t[0].Y()),G=(I+f+A)/2;return Math.sqrt((G-I)*(G-f)*(G-A)/G)}],C),d.elType="incircle",d.setParents(t),r=0;r<3;r++)JXG$1.exists(t[r]._is_new)?(d.addChild(t[r]),delete t[r]._is_new):t[r].addChild(d);d.center=u,d.subs={center:d.center},d.inherits.push(u)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)}return d};JXG$1.createReflection=function(n,t,o){var r,u,d,C,I,f,A,G,B=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, line]`;for(f=0;f<t.length;++f)t[f]=n.select(t[f]);if(A=JXG$1.copyAttributes(o,n.options,"reflection"),JXG$1.isPoint(t[0]))u=JXG$1.providePoints(n,[t[0]],G)[0];else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE||t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].type===Const.OBJECT_TYPE_POLYGON||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE)u=t[0];else throw new Error("JSXGraph: Can't create reflection element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);if(t[1].elementClass===Const.OBJECT_CLASS_LINE)r=t[1];else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);if(I=JXG$1.createTransform(n,[r],{type:"reflect"}),JXG$1.isPoint(u))d=JXG$1.createPoint(n,[u,I],A);else if(u.elementClass===Const.OBJECT_CLASS_CURVE)d=JXG$1.createCurve(n,[u,I],A);else if(u.elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.createLine(n,[u,I],A);else if(u.type===Const.OBJECT_TYPE_POLYGON)d=JXG$1.createPolygon(n,[u,I],A);else if(u.elementClass===Const.OBJECT_CLASS_CIRCLE)A.type.toLowerCase()==="euclidean"?(G=JXG$1.copyAttributes(o,n.options,"reflection","center"),C=JXG$1.createPoint(n,[u.center,I],G),C.prepareUpdate().update().updateVisibility(JXG$1.evaluate(C.visProp.visible)).updateRenderer(),d=JXG$1.createCircle(n,[C,function(){return u.Radius()}],A)):d=JXG$1.createCircle(n,[u,I],A);else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);return JXG$1.exists(u._is_new)&&(d.addChild(u),delete u._is_new),r.addChild(d),d.elType="reflection",d.addParents(r),d.prepareUpdate().update(),JXG$1.isPoint(d)&&(d.generatePolynomial=function(){var Z=r.point1.symbolic.x,w=r.point1.symbolic.y,V=r.point2.symbolic.x,Y=r.point2.symbolic.y,J=u.symbolic.x,T=u.symbolic.y,L=d.symbolic.x,z=d.symbolic.y,K=["((",z,")-(",T,"))*((",w,")-(",Y,"))+((",Z,")-(",V,"))*((",L,")-(",J,"))"].join(""),P=["((",L,")-(",Z,"))^2+((",z,")-(",w,"))^2-((",J,")-(",Z,"))^2-((",T,")-(",w,"))^2"].join("");return[K,P]}),d};JXG$1.createMirrorElement=function(n,t,o){var r,u,d,C,I,f,A,G,B=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, point]`;for(u=0;u<t.length;++u)t[u]=n.select(t[u]);if(A=JXG$1.copyAttributes(o,n.options,"mirrorelement"),JXG$1.isPoint(t[0]))r=JXG$1.providePoints(n,[t[0]],A)[0];else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE||t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].type===Const.OBJECT_TYPE_POLYGON||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE)r=t[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);if(JXG$1.isPoint(t[1]))G=JXG$1.copyAttributes(o,n.options,"mirrorelement","point"),d=JXG$1.providePoints(n,[t[1]],G)[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);if(f=JXG$1.createTransform(n,[Math.PI,d],{type:"rotate"}),JXG$1.isPoint(r))C=JXG$1.createPoint(n,[r,f],A);else if(r.elementClass===Const.OBJECT_CLASS_CURVE)C=JXG$1.createCurve(n,[r,f],A);else if(r.elementClass===Const.OBJECT_CLASS_LINE)C=JXG$1.createLine(n,[r,f],A);else if(r.type===Const.OBJECT_TYPE_POLYGON)C=JXG$1.createPolygon(n,[r,f],A);else if(r.elementClass===Const.OBJECT_CLASS_CIRCLE)A.type.toLowerCase()==="euclidean"?(G=JXG$1.copyAttributes(o,n.options,"mirrorelement","center"),I=JXG$1.createPoint(n,[r.center,f],G),I.prepareUpdate().update().updateVisibility(JXG$1.evaluate(I.visProp.visible)).updateRenderer(),C=JXG$1.createCircle(n,[I,function(){return r.Radius()}],A)):C=JXG$1.createCircle(n,[r,f],A);else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+B);return JXG$1.exists(r._is_new)&&(C.addChild(r),delete r._is_new),d.addChild(C),C.elType="mirrorelement",C.addParents(d),C.prepareUpdate().update(),C};JXG$1.createMirrorPoint=function(n,t,o){var r=JXG$1.createMirrorElement(n,t,o);return r.elType="mirrorpoint",r};JXG$1.createIntegral=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T=null,L;if(JXG$1.isArray(t[0])&&t[1].elementClass===Const.OBJECT_CLASS_CURVE)r=t[0],u=t[1];else if(JXG$1.isArray(t[1])&&t[0].elementClass===Const.OBJECT_CLASS_CURVE)r=t[1],u=t[0];else throw new Error("JSXGraph: Can't create integral with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[number|function,number|function],curve]`);return d=JXG$1.copyAttributes(o,n.options,"integral"),d.withLabel=!1,L=n.create("curve",[[0],[0]],d),C=r[0],I=r[1],JXG$1.isFunction(C)?(f=C,A=function(){return u.Y(f())},C=f()):(f=C,A=u.Y(C)),JXG$1.isFunction(I)?(G=I,B=function(){return u.Y(G())},I=G()):(G=I,B=u.Y(I)),d=JXG$1.copyAttributes(o,n.options,"integral","curveleft"),Z=n.create("glider",[f,A,u],d),JXG$1.isFunction(f)&&Z.hideElement(),d=JXG$1.copyAttributes(o,n.options,"integral","baseleft"),w=n.create("point",[function(){return JXG$1.evaluate(L.visProp.axis)==="y"?0:Z.X()},function(){return JXG$1.evaluate(L.visProp.axis)==="y"?Z.Y():0}],d),d=JXG$1.copyAttributes(o,n.options,"integral","curveright"),V=n.create("glider",[G,B,u],d),JXG$1.isFunction(G)&&V.hideElement(),d=JXG$1.copyAttributes(o,n.options,"integral","baseright"),Y=n.create("point",[function(){return JXG$1.evaluate(L.visProp.axis)==="y"?0:V.X()},function(){return JXG$1.evaluate(L.visProp.axis)==="y"?V.Y():0}],d),d=JXG$1.copyAttributes(o,n.options,"integral"),d.withlabel!==!1&&d.axis!=="y"&&(d=JXG$1.copyAttributes(o,n.options,"integral","label"),d=JXG$1.copyAttributes(d,n.options,"label"),T=n.create("text",[function(){var z=new Coords(Const.COORDS_BY_SCREEN,[JXG$1.evaluate(this.visProp.offset[0])+this.board.origin.scrCoords[1],0],this.board,!1),K=this.board.getBoundingBox(),P=(K[2]-K[0])*.1,$=V.X();return $<K[0]?$=K[0]+P:$>K[2]&&($=K[2]-P),$+z.usrCoords[1]},function(){var z=new Coords(Const.COORDS_BY_SCREEN,[0,JXG$1.evaluate(this.visProp.offset[1])+this.board.origin.scrCoords[2]],this.board,!1),K=this.board.getBoundingBox(),P=(K[1]-K[3])*.1,$=V.Y();return $>K[1]?$=K[1]-P:$<K[3]&&($=K[3]+P),$+z.usrCoords[2]},""],d),J=function(){var z=Numerics.NewtonCotes([w.X(),Y.X()],u.Y),K=JXG$1.evaluate(T.visProp.digits),P;return T.useLocale()?P=T.formatNumberLocale(z,K):P=JXG$1.toFixed(z,K),"&int; = "+P},T.setText(J),T.dump=!1,Z.addChild(T),V.addChild(T)),Z.dump=!1,w.dump=!1,V.dump=!1,Y.dump=!1,L.elType="integral",L.setParents([u.id,r]),L.subs={curveLeft:Z,baseLeft:w,curveRight:V,baseRight:Y},L.inherits.push(Z,w,V,Y),d.withLabel&&(L.subs.label=T,L.inherits.push(T)),L.Value=function(){return Numerics.I([w.X(),Y.X()],u.Y)},L.updateDataArray=function(){var z,K,P,$,ie,ne,ee,se,re;if(JXG$1.evaluate(this.visProp.axis)==="y"){for(Z.Y()<V.Y()?(ne=Z.X(),se=Z.Y(),ee=V.X(),re=V.Y()):(ne=V.X(),se=V.Y(),ee=Z.X(),re=Z.Y()),$=Math.min(ne,ee),ie=Math.max(ne,ee),z=[0,ne],K=[se,se],P=0;P<u.numberPoints;P++)se<=u.points[P].usrCoords[2]&&$<=u.points[P].usrCoords[1]&&u.points[P].usrCoords[2]<=re&&u.points[P].usrCoords[1]<=ie&&(z.push(u.points[P].usrCoords[1]),K.push(u.points[P].usrCoords[2]));z.push(ee),K.push(re),z.push(0),K.push(re),z.push(0),K.push(se)}else{for(w.X()<Y.X()?($=w.X(),ie=Y.X()):($=Y.X(),ie=w.X()),z=[$,$],K=[0,u.Y($)],P=0;P<u.numberPoints;P++)$<=u.points[P].usrCoords[1]&&u.points[P].usrCoords[1]<=ie&&(z.push(u.points[P].usrCoords[1]),K.push(u.points[P].usrCoords[2]));z.push(ie),K.push(u.Y(ie)),z.push(ie),K.push(0),z.push($),K.push(0)}this.dataX=z,this.dataY=K},Z.addChild(L),V.addChild(L),w.addChild(L),Y.addChild(L),L.baseLeft=w,L.baseRight=Y,L.curveLeft=Z,L.curveRight=V,L.methodMap=JXG$1.deepCopy(L.methodMap,{curveLeft:"curveLeft",baseLeft:"baseLeft",curveRight:"curveRight",baseRight:"baseRight",Value:"Value"}),L.label=T,L};JXG$1.createInequality=function(n,t,o){var r,u,d;if(d=JXG$1.copyAttributes(o,n.options,"inequality"),t[0].elementClass===Const.OBJECT_CLASS_LINE)u=n.create("curve",[[],[]],d),u.hasPoint=function(){return!1},u.updateDataArray=function(){var C,I,f,A=n.getBoundingBox(),G=JXG$1.evaluate(this.visProp.inverse),B=G?-1:1,Z=1.5,w=Z*Math.max(A[2]-A[0],A[1]-A[3]),V={coords:{usrCoords:[1,(A[0]+A[2])*.5,G?A[1]:A[3]]}},Y=t[0].stdform.slice(1),J=Y;f=Z*Math.max(Geometry.perpendicular(t[0],V,n)[0].distance(Const.COORDS_BY_USER,V.coords),w),f*=B,V={coords:{usrCoords:[1,(A[0]+A[2])*.5,(A[1]+A[3])*.5]}},Math.abs(Mat.innerProduct(V.coords.usrCoords,t[0].stdform,3))>=Mat.eps?V=Geometry.perpendicular(t[0],V,n)[0].usrCoords:V=V.coords.usrCoords,C=[1,V[1]+Y[1]*w,V[2]-Y[0]*w],I=[1,V[1]-J[1]*w,V[2]+J[0]*w],this.dataX=[C[1],C[1]+Y[0]*f,I[1]+J[0]*f,I[1],C[1]],this.dataY=[C[2],C[2]+Y[1]*f,I[2]+J[1]*f,I[2],C[2]]};else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE&&t[0].visProp.curvetype==="functiongraph")u=n.create("curve",[[],[]],d),u.updateDataArray=function(){var C=this.board.getBoundingBox(),I=[],f,A,G,B,Z,w=t[0].minX(),V=t[0].maxX(),Y,J,T,L,z=(C[1]-C[3])*.3,K=JXG$1.evaluate(this.visProp.inverse);if(f=K?1:3,this.dataX=[],this.dataY=[],B=t[0].points.length,B!==0)for(C[1]+=z,C[3]-=z,G=-1;G<B-1;){for(Z=G+1,A=B;Z<B;Z++)if(t[0].points[Z].isReal()){A=Z;break}if(A>=B)break;for(Z=A,G=B-1;Z<B-1;Z++)if(!t[0].points[Z+1].isReal()){G=Z;break}for(T=t[0].points[A].usrCoords[1],L=t[0].points[G].usrCoords[1],Y=C[0]<w?w:C[0],J=C[2]>V?V:C[2],Y=A===0?Y:Math.max(Y,T),J=G===B-1?J:Math.min(J,L),Y=A===0?w:T,J=G===B-1?V:L,I=[],I.push([1,Y,C[f]]),I.push([1,Y,t[0].points[A].usrCoords[2]]),Z=A;Z<=G;Z++)I.push(t[0].points[Z].usrCoords);for(I.push([1,J,t[0].points[G].usrCoords[2]]),I.push([1,J,C[f]]),I.push(I[0]),Z=0;Z<I.length;Z++)this.dataX.push(I[Z][1]),this.dataY.push(I[Z][2]);G<B-1&&(this.dataX.push(NaN),this.dataY.push(NaN))}},u.hasPoint=function(){return!1};else if(r=JXG$1.createFunction(t[0]),u.addParentsFromJCFunctions([r]),!JXG$1.exists(r))throw new Error(`JSXGraph: Can't create area with the given parents.
Possible parent types: [line], [function]`);return u.addParents(t[0]),u};JXG$1.registerElement("arrowparallel",JXG$1.createArrowParallel);JXG$1.registerElement("bisector",JXG$1.createBisector);JXG$1.registerElement("bisectorlines",JXG$1.createAngularBisectorsOfTwoLines);JXG$1.registerElement("msector",JXG$1.createMsector);JXG$1.registerElement("circumcircle",JXG$1.createCircumcircle);JXG$1.registerElement("circumcirclemidpoint",JXG$1.createCircumcenter);JXG$1.registerElement("circumcenter",JXG$1.createCircumcenter);JXG$1.registerElement("incenter",JXG$1.createIncenter);JXG$1.registerElement("incircle",JXG$1.createIncircle);JXG$1.registerElement("integral",JXG$1.createIntegral);JXG$1.registerElement("midpoint",JXG$1.createMidpoint);JXG$1.registerElement("mirrorelement",JXG$1.createMirrorElement);JXG$1.registerElement("mirrorpoint",JXG$1.createMirrorPoint);JXG$1.registerElement("orthogonalprojection",JXG$1.createOrthogonalProjection);JXG$1.registerElement("parallel",JXG$1.createParallel);JXG$1.registerElement("parallelpoint",JXG$1.createParallelPoint);JXG$1.registerElement("perpendicular",JXG$1.createPerpendicular);JXG$1.registerElement("perpendicularpoint",JXG$1.createPerpendicularPoint);JXG$1.registerElement("perpendicularsegment",JXG$1.createPerpendicularSegment);JXG$1.registerElement("reflection",JXG$1.createReflection);JXG$1.registerElement("inequality",JXG$1.createInequality);JXG$1.createGrid=function(n,t,o){var r=Mat.eps,u=5e3,d,C,I,f,A,G,B,Z=[],w=[],V;if(I=t,I.length>2||I.length>=1&&I[0].elType!=="axis"||I.length>=2&&I[1].elType!=="axis")throw new Error("JSXGraph: Can't create 'grid' with parent type '"+t[0].elType+"'. Possible parent types: [axis,axis]");return!JXG$1.exists(I[0])&&JXG$1.exists(n.defaultAxes)&&(I[0]=n.defaultAxes.x),!JXG$1.exists(I[1])&&JXG$1.exists(n.defaultAxes)&&(I[1]=n.defaultAxes.y),V=function(Y,J,T,L,z,K,P){var $,ie,ne,ee,se,re,ce;switch(Y.toLowerCase()){case".":case"point":return J.visProp.linecap="round",J.visProp.strokewidth=z*J.board.unitX+K*J.board.unitY,[[T,T,NaN],[L,L,NaN]];case"o":case"circle":return J.visProp.linecap="square",J.bezierDegree=3,ie=4*Math.tan(Math.PI/8)/3,[[T+z,T+z,T+ie*z,T,T-ie*z,T-z,T-z,T-z,T-ie*z,T,T+ie*z,T+z,T+z,NaN],[L,L+ie*K,L+K,L+K,L+K,L+ie*K,L,L-ie*K,L-K,L-K,L-K,L-ie*K,L,NaN]];case"regpol":case"regularpolygon":for(J.visProp.linecap="round",ee=JXG$1.evaluate(J.visProp.polygonvertices),se=[[],[]],$=0;$<=2*Math.PI;$+=2*Math.PI/ee)se[0].push(T-z*Math.sin($)),se[1].push(L-K*Math.cos($));return se[0].push(NaN),se[1].push(NaN),se;case"[]":case"square":return J.visProp.linecap="square",[[T-z,T+z,T+z,T-z,T-z,NaN],[L+K,L+K,L-K,L-K,L+K,NaN]];case"<>":case"diamond":return J.visProp.linecap="square",[[T,T+z,T,T-z,T,NaN],[L+K,L,L-K,L,L+K,NaN]];case"<<>>":case"diamond2":return J.visProp.linecap="square",re=z*Math.sqrt(2),ce=K*Math.sqrt(2),[[T,T+re,T,T-re,T,NaN],[L+ce,L,L-ce,L,L+ce,NaN]];case"x":case"cross":return[[T-z,T+z,NaN,T-z,T+z,NaN],[L+K,L-K,NaN,L-K,L+K,NaN]];case"+":case"plus":return[[T-z,T+z,NaN,T,T,NaN],[L,L,NaN,L-K,L+K,NaN]];case"-":case"minus":return[[T-z,T+z,NaN],[L,L,NaN]];case"|":case"divide":return[[T,T,NaN],[L-K,L+K,NaN]];case"^":case"a":case"A":case"triangleup":return[[T-z,T,T+z,NaN],[L-K,L,L-K,NaN]];case"v":case"triangledown":return[[T-z,T,T+z,NaN],[L+K,L,L+K,NaN]];case"<":case"triangleleft":return[[T+z,T,T+z,NaN],[L+K,L,L-K,NaN]];case">":case"triangleright":return[[T-z,T,T-z,NaN],[L+K,L,L-K,NaN]];case"line":return ne=JXG$1.evaluate(J.visProp.margin),[[T,T,NaN,P[0]-ne/J.board.unitX,P[2]+ne/J.board.unitX,NaN],[P[1]+ne/J.board.unitY,P[3]-ne/J.board.unitY,NaN,L,L,NaN]];default:return[[],[]]}},f=JXG$1.copyAttributes(o,n.options,"grid"),JXG$1.mergeAttr(f,f.themes[f.theme],!1),A={},JXG$1.mergeAttr(A,f,!0,!0),JXG$1.mergeAttr(A,f.major,!0,!0),d=n.create("curve",[[null],[null]],A),d.elType="grid",d.type=Const.OBJECT_TYPE_GRID,G={},JXG$1.mergeAttr(G,f,!0,!0),JXG$1.mergeAttr(G,f.minor,!0,!0),G.id===A.id&&(G.id=d.id+"_minor"),G.name===A.name&&(G.name=d.name+"_minor"),C=n.create("curve",[[null],[null]],G),C.elType="grid",C.type=Const.OBJECT_TYPE_GRID,d.minorGrid=C,C.majorGrid=d,d.hasPoint=function(){return!1},C.hasPoint=function(){return!1},d.inherits.push(C),d.updateDataArray=function(){var Y=this.board.getBoundingBox(),J,T,L,z,K,P,$,ie,ne=JXG$1.evaluate(this.visProp.gridx),ee=JXG$1.evaluate(this.visProp.gridy),se=JXG$1.evaluate(this.visProp.face),re=JXG$1.evaluate(this.visProp.drawzero),ce=re===!0||JXG$1.isObject(re)&&JXG$1.evaluate(re.origin)===!0,ue=re===!0||JXG$1.isObject(re)&&JXG$1.evaluate(re.x)===!0,ye=re===!0||JXG$1.isObject(re)&&JXG$1.evaluate(re.y)===!0,Se=JXG$1.evaluate(this.visProp.includeboundaries),Ce=JXG$1.evaluate(this.visProp.forcesquare);if(this.dataX=[],this.dataY=[],B=JXG$1.evaluate(this.visProp.majorstep),JXG$1.isArray(B)||(B=[B,B]),B.length<2&&(B=[B[0],B[0]]),JXG$1.exists(ne)&&(JXG$1.deprecated("gridX","majorStep"),B[0]=ne),JXG$1.exists(ee)&&(JXG$1.deprecated("gridY","majorStep"),B[1]=ee),B[0]==="auto"?(ie=Math.pow(10,Math.floor(Math.log(50/this.board.unitX)/Math.LN10)),B[0]=ie,JXG$1.exists(I[0])&&(B[0]=I[0].ticks[0].getDistanceMajorTicks())):B[0]=JXG$1.parseNumber(B[0],Math.abs(Y[1]-Y[3]),1/this.board.unitX),B[1]==="auto"?(ie=Math.pow(10,Math.floor(Math.log(50/this.board.unitY)/Math.LN10)),B[1]=ie,JXG$1.exists(I[1])&&(B[1]=I[1].ticks[0].getDistanceMajorTicks())):B[1]=JXG$1.parseNumber(B[1],Math.abs(Y[0]-Y[2]),1/this.board.unitY),Ce==="min"||Ce===!0?B[0]*this.board.unitX<=B[1]*this.board.unitY?B[1]=B[0]/this.board.unitY*this.board.unitX:B[0]=B[1]/this.board.unitX*this.board.unitY:Ce==="max"&&(B[0]*this.board.unitX<=B[1]*this.board.unitY?B[0]=B[1]/this.board.unitX*this.board.unitY:B[1]=B[0]/this.board.unitY*this.board.unitX),Z=JXG$1.evaluate(this.visProp.size),JXG$1.isArray(Z)||(Z=[Z,Z]),Z.length<2&&(Z=[Z[0],Z[0]]),JXG$1.isNumber(Z[0],!0)&&(Z[0]=Z[0]+"px"),JXG$1.isNumber(Z[1],!0)&&(Z[1]=Z[1]+"px"),Z[0]=JXG$1.parseNumber(Z[0],B[0],1/this.board.unitX),Z[1]=JXG$1.parseNumber(Z[1],B[1],1/this.board.unitY),w[0]=Z[0]/2,w[1]=Z[1]/2,J=Mat.roundToStep(Y[0],B[0]),T=Mat.roundToStep(Y[1],B[1]),$=isFinite(J)&&isFinite(T)&&isFinite(Y[2])&&isFinite(Y[3])&&Math.abs(Y[2])<Math.abs(B[0]*u)&&Math.abs(Y[3])<Math.abs(B[1]*u),se.toLowerCase()==="line"){for(K=JXG$1.evaluate(d.visProp.margin),z=T;$&&z>=Y[3];z-=B[1])!ce&&Math.abs(z)<r||!ye&&Math.abs(z)<r||!Se&&(z<=Y[3]+w[1]||z>=Y[1]-w[1])||(P=[[Y[0]-K/d.board.unitX,Y[2]+K/d.board.unitX,NaN],[z,z,NaN]],JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1]));for(L=J;$&&L<=Y[2];L+=B[0])!ce&&Math.abs(L)<r||!ue&&Math.abs(L)<r||!Se&&(L<=Y[0]+w[0]||L>=Y[2]-w[0])||(P=[[L,L,NaN],[Y[1]+K/d.board.unitY,Y[3]-K/d.board.unitY,NaN]],JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1]))}else for(z=T;$&&z>=Y[3];z-=B[1])for(L=J;$&&L<=Y[2];L+=B[0])!ce&&Math.abs(z)<r&&Math.abs(L)<r||!ue&&Math.abs(z)<r&&Math.abs(L)>=r||!ye&&Math.abs(L)<r&&Math.abs(z)>=r||!Se&&(L<=Y[0]+w[0]||L>=Y[2]-w[0]||z<=Y[3]+w[1]||z>=Y[1]-w[1])||(P=V(se,d,L,z,w[0],w[1],Y),JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1]))},C.updateDataArray=function(){var Y=this.board.getBoundingBox(),J,T,L,z,K,P,$,ie=[],ne=[],ee,se,re,ce,ue,ye,Se,Ce,Ze,Be,xe,ge,de=JXG$1.evaluate(this.visProp.minorelements),ve=JXG$1.evaluate(this.visProp.size),le=JXG$1.evaluate(this.visProp.face),Ae=JXG$1.evaluate(this.visProp.drawzero),Xe=Ae===!0||JXG$1.isObject(Ae)&&JXG$1.evaluate(Ae.x)===!0,Te=Ae===!0||JXG$1.isObject(Ae)&&JXG$1.evaluate(Ae.y)===!0,Ne=JXG$1.evaluate(this.majorGrid.visProp.face),We=JXG$1.evaluate(this.majorGrid.visProp.drawzero),dt=We===!0||JXG$1.isObject(We)&&JXG$1.evaluate(We.origin)===!0,nt=We===!0||JXG$1.isObject(We)&&JXG$1.evaluate(We.x)===!0,Rt=We===!0||JXG$1.isObject(We)&&JXG$1.evaluate(We.y)===!0,Qe=JXG$1.evaluate(this.visProp.includeboundaries);if(this.dataX=[],this.dataY=[],JXG$1.isArray(de)||(de=[de,de]),de.length<2&&(de=[de[0],de[0]]),JXG$1.isNumber(de[0],!0)?de[0]=parseFloat(de[0]):(de[0]=3,JXG$1.exists(I[0])&&(de[0]=JXG$1.evaluate(I[0].getAttribute("ticks").minorticks))),ie[0]=B[0]/(de[0]+1),JXG$1.isNumber(de[1],!0)?de[1]=parseFloat(de[1]):(de[1]=3,JXG$1.exists(I[1])&&(de[1]=JXG$1.evaluate(I[1].getAttribute("ticks").minorticks))),ie[1]=B[1]/(de[1]+1),JXG$1.isArray(ve)||(ve=[ve,ve]),ve.length<2&&(ve=[ve[0],ve[0]]),JXG$1.isNumber(ve[0],!0)&&(ve[0]=ve[0]+"px"),JXG$1.isNumber(ve[1],!0)&&(ve[1]=ve[1]+"px"),ve[0]=JXG$1.parseNumber(ve[0],ie[0],1/this.board.unitX),ve[1]=JXG$1.parseNumber(ve[1],ie[1],1/this.board.unitY),ne[0]=ve[0]*.5,ne[1]=ve[1]*.5,J=Mat.roundToStep(Y[0],ie[0]),T=Mat.roundToStep(Y[1],ie[1]),$=isFinite(J)&&isFinite(T)&&isFinite(Y[2])&&isFinite(Y[3])&&Math.abs(Y[2])<=Math.abs(ie[0]*u)&&Math.abs(Y[3])<Math.abs(ie[1]*u),le.toLowerCase()!=="line")for(z=T;$&&z>=Y[3];z-=ie[1])for(L=J;$&&L<=Y[2];L+=ie[0]){if(ee=Mat.roundToStep(Math.abs(L),B[0]),ee=Math.abs(ee-Math.abs(L)),se=B[0]-ee,re=Mat.roundToStep(Math.abs(z),B[1]),re=Math.abs(re-Math.abs(z)),ce=B[1]-re,Ne==="line"){if(ee-ne[0]-w[0]<r||se-ne[0]-w[0]<r||re-ne[1]-w[1]<r||ce-ne[1]-w[1]<r)continue}else if((ee-ne[0]-w[0]<r||se-ne[0]-w[0]<r)&&(re-ne[1]-w[1]<r||ce-ne[1]-w[1]<r)&&(dt||w[1]-Math.abs(z)+ne[1]<r||w[0]-Math.abs(L)+ne[0]<r)&&(nt||w[1]-Math.abs(z)+ne[1]<r||w[0]+Math.abs(L)-ne[0]<r)&&(Rt||w[0]-Math.abs(L)+ne[0]<r||w[1]+Math.abs(z)-ne[1]<r))continue;!Te&&Math.abs(L)<r||!Xe&&Math.abs(z)<r||(ue=Math.abs(Y[0]%B[0]),ye=Math.abs(Y[1]%B[1]),Se=Math.abs(Y[2]%B[0]),Ce=Math.abs(Y[3]%B[1]),Ze=B[0]-ue,Be=B[1]-ye,xe=B[0]-Se,ge=B[1]-Ce,!(!Qe&&(L-ne[0]-Y[0]-w[0]+Ze<r&&Ze-w[0]<r||L-ne[0]-Y[0]-w[0]-ue<r&&ue-w[0]<r||-L-ne[0]+Y[2]-w[0]+xe<r&&xe-w[0]<r||-L-ne[0]+Y[2]-w[0]-Se<r&&Se-w[0]<r||-z-ne[1]+Y[1]-w[1]+Be<r&&Be-w[1]<r||-z-ne[1]+Y[1]-w[1]-ye<r&&ye-w[1]<r||z-ne[1]-Y[3]-w[1]+ge<r&&ge-w[1]<r||z-ne[1]-Y[3]-w[1]-Ce<r&&Ce-w[1]<r||-z-ne[1]+Y[1]<r||L-ne[0]-Y[0]<r||z-ne[1]-Y[3]<r||-L-ne[0]+Y[2]<r))&&(P=V(le,C,L,z,ne[0],ne[1],Y),JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1])))}else{for(K=JXG$1.evaluate(C.visProp.margin),z=T;$&&z>=Y[3];z-=ie[1]){if(re=Mat.roundToStep(Math.abs(z),B[1]),re=Math.abs(re-Math.abs(z)),ce=B[1]-re,Ne==="line"){if(re-ne[1]-w[1]<r||ce-ne[1]-w[1]<r)continue}else if((re-ne[1]-w[1]<r||ce-ne[1]-w[1]<r)&&(dt||w[1]-Math.abs(z)+ne[1]<r)&&(nt||w[1]-Math.abs(z)+ne[1]<r)&&(Rt||w[1]+Math.abs(z)-ne[1]<r))continue;!Xe&&Math.abs(z)<r||(ue=Math.abs(Y[0]%B[0]),ye=Math.abs(Y[1]%B[1]),Se=Math.abs(Y[2]%B[0]),Ce=Math.abs(Y[3]%B[1]),Ze=B[0]-ue,Be=B[1]-ye,xe=B[0]-Se,ge=B[1]-Ce,!(!Qe&&(-z-ne[1]+Y[1]-w[1]+Be<r&&Be-w[1]<r||-z-ne[1]+Y[1]-w[1]-ye<r&&ye-w[1]<r||z-ne[1]-Y[3]-w[1]+ge<r&&ge-w[1]<r||z-ne[1]-Y[3]-w[1]-Ce<r&&Ce-w[1]<r||-z-ne[1]+Y[1]<r||z-ne[1]-Y[3]<r))&&(P=[[Y[0]-K/C.board.unitX,Y[2]+K/C.board.unitX,NaN],[z,z,NaN]],JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1])))}for(L=J;$&&L<=Y[2];L+=ie[0]){if(ee=Mat.roundToStep(Math.abs(L),B[0]),ee=Math.abs(ee-Math.abs(L)),se=B[0]-ee,Ne==="line"){if(ee-ne[0]-w[0]<r||se-ne[0]-w[0]<r)continue}else if((ee-ne[0]-w[0]<r||se-ne[0]-w[0]<r)&&(dt||w[0]-Math.abs(L)+ne[0]<r)&&(nt||w[0]+Math.abs(L)-ne[0]<r)&&(Rt||w[0]-Math.abs(L)+ne[0]<r))continue;!Te&&Math.abs(L)<r||(ue=Math.abs(Y[0]%B[0]),ye=Math.abs(Y[1]%B[1]),Se=Math.abs(Y[2]%B[0]),Ce=Math.abs(Y[3]%B[1]),Ze=B[0]-ue,Be=B[1]-ye,xe=B[0]-Se,ge=B[1]-Ce,!(!Qe&&(L-ne[0]-Y[0]-w[0]+Ze<r&&Ze-w[0]<r||L-ne[0]-Y[0]-w[0]-ue<r&&ue-w[0]<r||-L-ne[0]+Y[2]-w[0]+xe<r&&xe-w[0]<r||-L-ne[0]+Y[2]-w[0]-Se<r&&Se-w[0]<r||L-ne[0]-Y[0]<r||-L-ne[0]+Y[2]<r))&&(P=[[L,L,NaN],[Y[1]+K/C.board.unitY,Y[3]-K/C.board.unitY,NaN]],JXG$1.concat(this.dataX,P[0]),JXG$1.concat(this.dataY,P[1])))}}},n.grids.push(d),n.grids.push(C),d};JXG$1.registerElement("grid",JXG$1.createGrid);JXG$1.Image=function(n,t,o,r,u){this.constructor(n,o,Const.OBJECT_TYPE_IMAGE,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this.W=JXG$1.createFunction(u[0],this.board,""),this.H=JXG$1.createFunction(u[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*n.unitX),Math.abs(this.usrSize[1]*n.unitY)],this.url=r,this.elType="image",this.span=[this.coords.usrCoords.slice(0),[this.coords.usrCoords[0],this.W(),0],[this.coords.usrCoords[0],0,this.H()]],this.id=this.board.setId(this,"Im"),this.board.renderer.drawImage(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H",setSize:"setSize"})};JXG$1.Image.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Image,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Image.prototype,{hasPoint:function(n,t){var o,r,u,d,C,I,f,A,G,B=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(d=this.board._inputDevice,C=JXG$1.evaluate(this.visProp.precision[d])):C=this.board.options.precision.hasPoint,B===0?(o=n-this.coords.scrCoords[1],r=this.coords.scrCoords[2]-t,u=C,o>=-u&&o-this.size[0]<=u&&r>=-u&&r-this.size[1]<=u):(I=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),I=I.usrCoords,f=[I[0]-this.span[0][0],I[1]-this.span[0][1],I[2]-this.span[0][2]],G=Mat.innerProduct,A=G(f,this.span[1]),0<=A&&A<=G(this.span[1],this.span[1])&&(A=G(f,this.span[2]),0<=A&&A<=G(this.span[2],this.span[2])))},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateSize(),this.updateSpan(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateImage")},updateSize:function(){return this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)],this},updateSpan:function(){var n,t,o=this.transformations.length,r=[];if(o===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(r[0]=[this.Z(),this.X(),this.Y()],r[1]=[this.Z(),this.X()+this.W(),this.Y()],r[2]=[this.Z(),this.X(),this.Y()+this.H()],n=0;n<o;n++)for(t=0;t<3;t++)r[t]=Mat.matVecMult(this.transformations[n].matrix,r[t]);for(t=0;t<3;t++)r[t][1]/=r[t][0],r[t][2]/=r[t][0],r[t][0]/=r[t][0];for(t=1;t<3;t++)r[t][0]-=r[0][0],r[t][1]-=r[0][1],r[t][2]-=r[0][2];this.span=r}return this},addTransform:function(n){var t;if(JXG$1.isArray(n))for(t=0;t<n.length;t++)this.transformations.push(n[t]);else this.transformations.push(n);return this},getParents:function(){var n=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(n=this.parents),n},setSize:function(n,t){return this.W=JXG$1.createFunction(n,this.board,""),this.H=JXG$1.createFunction(t,this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createImage=function(n,t,o){var r,u,d=t[0],C=t[1],I=t[2];if(r=JXG$1.copyAttributes(o,n.options,"image"),u=CoordsElement.create(JXG$1.Image,n,C,r,d,I),!u)throw new Error("JSXGraph: Can't create image with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return r.rotate!==0&&u.addRotation(r.rotate),u};JXG$1.registerElement("image",JXG$1.createImage);JXG$1.Image;JXG$1.createSlider=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se;return se=JXG$1.copyAttributes(o,n.options,"slider"),K=se.withticks,z=se.withlabel,ie=se.snapwidth,P=se.snapvalues,$=se.snapvaluedistance,A=n.create("point",t[0],se.point1),G=n.create("point",t[1],se.point2),Z=n.create("segment",[A,G],se.baseline),Z.updateStdform(),r=A.coords.usrCoords.slice(1),u=G.coords.usrCoords.slice(1),d=t[2][0],C=t[2][1],I=t[2][2],f=I-d,ne=JXG$1.evaluate(ie),ee=ne===-1?C:Math.round(C/ne)*ne,T=r[0]+(u[0]-r[0])*(ee-d)/(I-d),L=r[1]+(u[1]-r[1])*(ee-d)/(I-d),se.withlabel=!1,B=n.create("glider",[T,L,Z],se),B.setAttribute({snapwidth:ie,snapvalues:P,snapvaluedistance:$}),w=n.create("segment",[A,B],se.highline),B.Value=function(){var re=this._smax-this._smin,ce=JXG$1.evaluate(this.visProp.snapwidth);return ce===-1?this.position*re+this._smin:Math.round((this.position*re+this._smin)/ce)*ce},B.methodMap=JXG$1.deepCopy(B.methodMap,{Value:"Value",setValue:"setValue",smax:"_smax",smin:"_smin",setMax:"setMax",setMin:"setMin",point1:"point1",point2:"point2",baseline:"baseline",highline:"highline",ticks:"ticks",label:"label"}),B._smax=I,B._smin=d,B.setMax=function(re){return this._smax=re,this},B.setValue=function(re){var ce=this._smax-this._smin;return Math.abs(ce)>Mat.eps?this.position=(re-this._smin)/ce:this.position=0,this.position=Math.max(0,Math.min(1,this.position)),this},B.setMin=function(re){return this._smin=re,this},z&&(J=n.create("text",[function(){return(G.X()-A.X())*.05+G.X()},function(){return(G.Y()-A.Y())*.05+G.Y()},function(){var re,ce=JXG$1.evaluate(B.visProp.digits),ue=JXG$1.evaluate(B.visProp.suffixlabel),ye=JXG$1.evaluate(B.visProp.unitlabel),Se=JXG$1.evaluate(B.visProp.postlabel);return ce===2&&JXG$1.evaluate(B.visProp.precision)!==2&&(ce=JXG$1.evaluate(B.visProp.precision)),ue!==null?re=ue:B.name&&B.name!==""?re=B.name+" = ":re="",B.useLocale()?re+=B.formatNumberLocale(B.Value(),ce):re+=JXG$1.toFixed(B.Value(),ce),ye!==null&&(re+=ye),Se!==null&&(re+=Se),re}],se.label),B.label=J,B.visProp.withlabel=!0,B.hasLabel=!0),B.point1=A,B.point2=G,B.baseline=Z,B.highline=w,K&&(JXG$1.exists(se.generatelabeltext)||(se.ticks.generateLabelText=function(re,ce,ue){var ye,Se=B.point1.Dist(B.point2),Ce=B._smin,Ze=B._smax,Be=this.getDistanceFromZero(ce,re)*(Ze-Ce)/Se+Ce;return Se<Mat.eps||Math.abs(Be)<Mat.eps?ye="0":ye=this.formatLabelText(Be),ye}),V=2,Y=n.create("ticks",[B.baseline,B.point1.Dist(A)/V,function(re){var ce=B.point1.Dist(B.point2),ue=B.point1.coords.distance(Const.COORDS_BY_USER,re);return ce<Mat.eps?0:ue/ce*f+d}],se.ticks),B.ticks=Y),B.remove=function(){z&&n.removeObject(J),n.removeObject(w),n.removeObject(Z),n.removeObject(G),n.removeObject(A),Point.prototype.remove.call(B)},A.dump=!1,G.dump=!1,Z.dump=!1,w.dump=!1,z&&(J.dump=!1),B.elType="slider",B.parents=t,B.subs={point1:A,point2:G,baseLine:Z,highLine:w},B.inherits.push(A,G,Z,w),Z.inherits=[],w.inherits=[],K&&(Y.dump=!1,B.subs.ticks=Y,B.inherits.push(Y)),B.getParents=function(){return[this.point1.coords.usrCoords.slice(1),this.point2.coords.usrCoords.slice(1),[this._smin,this.position*(this._smax-this._smin)+this._smin,this._smax]]},B.baseline.on("up",function(re){var ce,ue;JXG$1.evaluate(B.visProp.moveonup)&&!JXG$1.evaluate(B.visProp.fixed)&&(ce=Z.board.getMousePosition(re,0),ue=new Coords(Const.COORDS_BY_SCREEN,ce,this.board),B.moveTo([ue.usrCoords[1],ue.usrCoords[2]]),B.triggerEventHandlers(["drag"],[re]))}),B.prepareUpdate().update(),n.isSuspendedUpdate||(B.updateVisibility().updateRenderer(),B.baseline.updateVisibility().updateRenderer(),B.highline.updateVisibility().updateRenderer(),K&&B.ticks.updateVisibility().updateRenderer()),B};JXG$1.registerElement("slider",JXG$1.createSlider);JXG$1.PrefixParser={parse:function(n,t){var o,r,u,d,C,I;if(JXG$1.isNumber(n)||JXG$1.isString(n))return n;if(!JXG$1.isArray(n)||n.length<2)throw new Error("prefixParser.parse: term is not an array, number or string");if(o=n[0],u=n.length,t==="execute")if(JXG$1.isInArray(["+","-","*","/"],o))for(d=this.parse(n[1],t),r=2;r<u;r++)switch(I=this.parse(n[r],t),o){case"+":d+=I;break;case"-":d-=I;break;case"*":d*=I;break;case"/":d/=I;break}else if(o==="exec"){for(C=n[1],I=[],r=2;r<u;r++)I.push(this.parse(n[r],t));if(JXG$1.exists(Math[C]))d=Math[C].apply(this,I);else if(JXG$1.exists(Mat[C]))d=Mat[C].apply(this,I);else throw new Error("PrefixParser.parse: "+C+" is not allowed")}else{if(C=n[0],C==="V"&&(C="Value"),C==="Coords"&&(n[2]="true"),!JXG$1.exists(n[1][C]))throw new Error("PrefixParser.parse: "+C+" is not a method of "+n[1]);for(I=[],r=2;r<u;r++)I.push(this.parse(n[r],t));d=n[1][C].apply(n[1],I)}return d},dimension:function(n){var t,o,r,u,d,C,I,f;if(JXG$1.isNumber(n))return 0;if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.dimension: term is not an array");if(t=n[0],r=n.length,JXG$1.isInArray(["+","-","*","/"],t))for(u=this.dimension(n[1]),o=2;o<r;o++)switch(I=this.dimension(n[o]),t){case"+":I!==u&&(u=NaN);break;case"-":I!==u&&(u=NaN);break;case"*":u+=I;break;case"/":u-=I;break}else if(t==="exec")n[2].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(u=n[2].Dimension(),JXG$1.exists(n[2].visProp.dim)&&(C=JXG$1.evaluate(n[2].visProp.dim),C!==null&&(u=C))):u=0;else switch(d=n[0],d){case"L":case"Length":case"Perimeter":case"Radius":case"R":u=1;break;case"Area":case"A":u=2;break;default:n[1].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(u=n[1].Dimension(),JXG$1.exists(n[1].visProp.dim)&&(C=JXG$1.evaluate(n[1].visProp.dim),C!==null&&(u=C))):(u=0,(d==="Value"||d==="V")&&[Const.OBJECT_TYPE_ARC,Const.OBJECT_TYPE_SECTOR,Const.OBJECT_TYPE_ANGLE].indexOf(n[1].type)>=0&&(f="",n.length===3&&JXG$1.isString(n[2])&&(f=n[2].toLowerCase()),f===""?n[1].type===Const.OBJECT_TYPE_ANGLE?u=0:u=1:f.indexOf("len")===0?u=1:u=0))}return u},toPrefix:function(n){var t,o,r,u;if(JXG$1.isNumber(n))return n;if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.toPrefix: term is not an array");for(t=n[0],r=n.length,u=[t],o=1;o<r;o++)JXG$1.isInArray(["+","-","*","/"],t)?u.push(this.toPrefix(n[o])):t==="V"&&n[o].type===JXG$1.OBJECT_TYPE_MEASUREMENT?u=n[o].toPrefix():t==="exec"?o===1?u.push(n[o]):u.push(this.toPrefix(n[o])):u=[t,n[o].id];return u},getParents:function(n){var t,o,r,u;if(JXG$1.isNumber(n))return[];if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.getParents: term is not an array");for(t=n[0],r=n.length,u=[],o=1;o<r;o++)JXG$1.isInArray(["+","-","*","/"],t)?JXG$1.concat(u,this.getParents(n[o])):t==="V"&&n[o].type===JXG$1.OBJECT_TYPE_MEASUREMENT?JXG$1.concat(u,n[o].getParents()):t==="exec"?o>1&&JXG$1.concat(u,this.getParents(n[o])):u.push(n[o]);return u}};const Prefix=JXG$1.PrefixParser;JXG$1.createTapemeasure=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w;return r=t[0],u=t[1],d=JXG$1.copyAttributes(o,n.options,"tapemeasure","point1"),G=n.create("point",r,d),d=JXG$1.copyAttributes(o,n.options,"tapemeasure","point2"),B=n.create("point",u,d),G.setAttribute({ignoredSnapToPoints:[B.id]}),B.setAttribute({ignoredSnapToPoints:[G.id]}),d=JXG$1.copyAttributes(o,n.options,"tapemeasure"),C=d.withticks,I=d.withlabel,f=d.digits,f===2&&d.precision!==2&&(f=d.precision),I&&(d.withlabel=!0),A=n.create("segment",[G,B],d),I&&(o.name&&o.name!==""?Z=o.name+" = ":Z="",A.label.setText(function(){var V=JXG$1.evaluate(A.label.visProp.digits);return A.label.useLocale()?Z+A.label.formatNumberLocale(G.Dist(B),V):Z+JXG$1.toFixed(G.Dist(B),V)})),C&&(d=JXG$1.copyAttributes(o,n.options,"tapemeasure","ticks"),w=n.create("ticks",[A,.1],d),A.inherits.push(w)),A.remove=function(){C&&A.removeTicks(w),n.removeObject(B),n.removeObject(G),GeometryElement.prototype.remove.call(this)},A.Value=function(){return G.Dist(B)},G.dump=!1,B.dump=!1,A.elType="tapemeasure",A.getParents=function(){return[[G.X(),G.Y()],[B.X(),B.Y()]]},A.subs={point1:G,point2:B},C&&(w.dump=!1),A.methodMap=JXG$1.deepCopy(A.methodMap,{Value:"Value"}),A.prepareUpdate().update(),n.isSuspendedUpdate||(A.updateVisibility().updateRenderer(),A.point1.updateVisibility().updateRenderer(),A.point2.updateVisibility().updateRenderer()),A};JXG$1.registerElement("tapemeasure",JXG$1.createTapemeasure);JXG$1.createMeasurement=function(n,t,o){var r,u,d,C,I,f;for(u=JXG$1.copyAttributes(o,n.options,"measurement"),d=t[0],C=t[1],I=t[2],r=n.create("text",[d,C,""],u),r.type=JXG$1.OBJECT_TYPE_MEASUREMENT,r.elType="measurement",r.Value=function(){return Prefix.parse(I,"execute")},r.Dimension=function(){var A=JXG$1.evaluate(r.visProp.dim);return A!==null?A:Prefix.dimension(I)},r.Unit=function(){var A="",G=JXG$1.evaluate(r.visProp.units),B=r.Dimension();return JXG$1.isObject(G)&&JXG$1.exists(G[B])&&G[B]!==!1?A=JXG$1.evaluate(G[B]):JXG$1.isObject(G)&&JXG$1.exists(G["dim"+B])&&G["dim"+B]!==!1?A=JXG$1.evaluate(G["dim"+B]):(A=JXG$1.evaluate(r.visProp.baseunit),B===0?A="":B>1&&A!==""&&(A=A+"^{"+B+"}")),A},r.getTerm=function(){return I},r.getMethod=function(){var A=I[0];return A==="V"&&(A="Value"),A},r.toPrefix=function(){return Prefix.toPrefix(I)},r.getParents=function(){return Prefix.getParents(I)},r.addParents(r.getParents()),f=0;f<r.parents.length;f++)n.select(r.parents[f]).addChild(r);return r.setText(function(){var A="",G="",B=r.Dimension(),Z=JXG$1.evaluate(r.visProp.digits),w=r.Unit(),V=r.Value(),Y;if(JXG$1.evaluate(r.visProp.showprefix)&&(A=r.visProp.formatprefix.apply(r,[JXG$1.evaluate(r.visProp.prefix)])),JXG$1.evaluate(r.visProp.showsuffix)&&(G=r.visProp.formatsuffix.apply(r,[JXG$1.evaluate(r.visProp.suffix)])),JXG$1.isNumber(V))Z==="none"||(Z==="auto"?r.useLocale()?V=r.formatNumberLocale(V):V=JXG$1.autoDigits(V):r.useLocale()?V=r.formatNumberLocale(V,Z):V=JXG$1.toFixed(V,Z));else if(JXG$1.isArray(V))for(Y=0;Y<V.length;Y++)JXG$1.isNumber(V[Y])&&(Z==="none"||(Z==="auto"?r.useLocale()?V[Y]=r.formatNumberLocale(V[Y]):V[Y]=JXG$1.autoDigits(V[Y]):r.useLocale()?V[Y]=r.formatNumberLocale(V[Y],Z):V[Y]=JXG$1.toFixed(V[Y],Z)));return B==="coords"&&JXG$1.isArray(V)&&(V.length===2&&V.unshift(void 0),V=r.visProp.formatcoords.apply(r,[V[1],V[2],V[0]])),B==="direction"&&JXG$1.isArray(V)&&(V=r.visProp.formatdirection.apply(r,[V[0],V[1]])),JXG$1.isString(B)?A+V+G:isNaN(B)?A+"NaN"+G:A+V+w+G}),r.methodMap=JXG$1.deepCopy(r.methodMap,{Value:"Value",Dimension:"Dimension",Unit:"Unit",getTerm:"getTerm",Term:"getTerm",getMethod:"getMethod",Method:"getMethod",getParents:"getParents",Parents:"getParents"}),r};JXG$1.registerElement("measurement",JXG$1.createMeasurement);JXG$1.DataSource=function(){return this.data=[],this.columnHeaders=[],this.rowHeaders=[],this};JXG$1.extend(JXG$1.DataSource.prototype,{loadFromArray:function(n,t,o){var r,u,d;if(JXG$1.isArray(t)&&(this.columnHeaders=t,t=!1),JXG$1.isArray(o)&&(this.rowHeaders=o,o=!1),this.data=[],t&&(this.columnHeaders=[]),o&&(this.rowHeaders=[]),JXG$1.exists(n)){for(this.data=[],r=0;r<n.length;r++)for(this.data[r]=[],u=0;u<n[r].length;u++)d=n[r][u],parseFloat(d).toString()===d?this.data[r][u]=parseFloat(d):d!=="-"?this.data[r][u]=d:this.data[r][u]=NaN;if(t&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),o)for(this.rowHeaders=[],r=0;r<this.data.length;r++)this.rowHeaders.push(this.data[r][0]),this.data[r]=this.data[r].slice(1)}return this},loadFromTable:function(n,t,o){var r,u,d,C,I;if(JXG$1.isArray(t)&&(this.columnHeaders=t,t=!1),JXG$1.isArray(o)&&(this.rowHeaders=o,o=!1),this.data=[],t&&(this.columnHeaders=[]),o&&(this.rowHeaders=[]),n=document.getElementById(n),JXG$1.exists(n)){for(r=n.getElementsByTagName("tr"),this.data=[],u=0;u<r.length;u++)for(C=r[u].getElementsByTagName("td"),this.data[u]=[],d=0;d<C.length;d++)I=C[d].innerHTML,parseFloat(I).toString()===I?this.data[u][d]=parseFloat(I):I!=="-"?this.data[u][d]=I:this.data[u][d]=NaN;if(t&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),o)for(this.rowHeaders=[],u=0;u<this.data.length;u++)this.rowHeaders.push(this.data[u][0]),this.data[u]=this.data[u].slice(1)}return this},addColumn:function(n,t,o){throw new Error("not implemented")},addRow:function(n,t,o){throw new Error("not implemented")},getColumn:function(n){var t,o=[];if(JXG$1.isString(n)){for(t=0;t<this.columnHeaders.length;t++)if(n===this.columnHeaders[t]){n=t;break}}for(t=0;t<this.data.length;t++)this.data[t].length>n&&(o[t]=parseFloat(this.data[t][n]));return o},getRow:function(n){var t,o;if(JXG$1.isString(n)){for(o=0;o<this.rowHeaders.length;o++)if(n===this.rowHeaders[o]){n=o;break}}for(t=[],o=0;o<this.data[n].length;o++)t[o]=this.data[n][o];return t}});const DataSource=JXG$1.DataSource;JXG$1.Chart=function(n,t,o){this.constructor(n,o);var r,u,d,C,I,f;if(!JXG$1.isArray(t)||t.length===0)throw new Error("JSXGraph: Can't create a chart without data");if(this.elements=[],JXG$1.isNumber(t[0]))for(u=t,r=[],d=0;d<u.length;d++)r[d]=d+1;else if(t.length===1&&JXG$1.isArray(t[0]))for(u=t[0],r=[],f=JXG$1.evaluate(u).length,d=0;d<f;d++)r[d]=d+1;else t.length===2&&(f=Math.min(t[0].length,t[1].length),r=t[0].slice(0,f),u=t[1].slice(0,f));if(JXG$1.isArray(u)&&u.length===0)throw new Error("JSXGraph: Can't create charts without data.");for(I=o.chartstyle.replace(/ /g,"").split(","),d=0;d<I.length;d++){switch(I[d]){case"bar":C=this.drawBar(n,r,u,o);break;case"line":C=this.drawLine(n,r,u,o);break;case"fit":C=this.drawFit(n,r,u,o);break;case"spline":C=this.drawSpline(n,r,u,o);break;case"pie":C=this.drawPie(n,u,o);break;case"point":C=this.drawPoints(n,r,u,o);break;case"radar":C=this.drawRadar(n,t,o);break}this.elements.push(C)}return this.id=this.board.setId(this,"Chart"),this.elements};JXG$1.Chart.prototype=new GeometryElement;JXG$1.extend(JXG$1.Chart.prototype,{drawLine:function(n,t,o,r){return r.fillcolor="none",r.highlightfillcolor="none",n.create("curve",[t,o],r)},drawSpline:function(n,t,o,r){return r.fillColor="none",r.highlightfillcolor="none",n.create("spline",[t,o],r)},drawFit:function(n,t,o,r){var u=r.degree;return u=Math.max(parseInt(u,10),1)||1,r.fillcolor="none",r.highlightfillcolor="none",n.create("functiongraph",[Numerics.regressionPolynomial(u,t,o)],r)},drawBar:function(n,t,o,r){var u,d,C,I,f,A,G,B,Z=[],w=[],V,Y,J=function(L,z){return function(){return t[L]()-z*C}},T={fixed:!0,withLabel:!1,visible:!1,name:""};if(V=JXG$1.copyAttributes(r,n.options,"chart"),V&&V.width)C=V.width;else{if(t.length<=1)C=1;else for(C=t[1]-t[0],u=1;u<t.length-1;u++)C=t[u+1]-t[u]<C?t[u+1]-t[u]:C;C*=.8}for(Y=JXG$1.copyAttributes(r,n.options,"chart","label"),u=0;u<t.length;u++)JXG$1.isFunction(t[u])?(I=J(u,-.5),f=J(u,0),A=J(u,.5)):(I=t[u]-C*.5,f=t[u],A=t[u]+C*.5),JXG$1.isFunction(o[u])?G=o[u]():G=o[u],G=o[u],V.dir==="horizontal"?(w[0]=n.create("point",[0,I],T),w[1]=n.create("point",[G,I],T),w[2]=n.create("point",[G,A],T),w[3]=n.create("point",[0,A],T),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[u])&&(Y.anchorY="middle",d=n.create("text",[G,f,V.labels[u]],Y),d.visProp.anchorx=function(L){return function(){return L.X()>=0?"left":"right"}}(d))):(w[0]=n.create("point",[I,0],T),w[1]=n.create("point",[I,G],T),w[2]=n.create("point",[A,G],T),w[3]=n.create("point",[A,0],T),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[u])&&(Y.anchorX="middle",d=n.create("text",[f,G,V.labels[u]],Y),d.visProp.anchory=function(L){return function(){return L.Y()>=0?"bottom":"top"}}(d))),JXG$1.isArray(V.colors)&&(B=V.colors,V.fillcolor=B[u%B.length]),Z[u]=n.create("polygon",w,V),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[u])&&(Z[u].text=d);return Z},drawPoints:function(n,t,o,r){var u,d=[],C=r.infoboxarray;for(r.fixed=!0,r.name="",u=0;u<t.length;u++)r.infoboxtext=C?C[u%C.length]:!1,d[u]=n.create("point",[t[u],o[u]],r);return d},drawPie:function(n,t,o){var r,u,d=[],C=[],I=o.colors,f=o.highlightcolors,A=o.labels,G=o.radius||4,B=G,Z=o.center||[0,0],w=Z[0],V=Z[1],Y=function(K,P,$){return function(){var ie,ne,ee,se=0;for(ne=0;ne<=K;ne++)se+=parseFloat(JXG$1.evaluate(t[ne]));for(ie=se,ne=K+1;ne<t.length;ne++)ie+=parseFloat(JXG$1.evaluate(t[ne]));return ee=ie!==0?2*Math.PI*se/ie:0,B()*Math[P](ee)+$}},J=function(K,P){var $=-this.point1.coords.usrCoords[1]+this.point2.coords.usrCoords[1],ie=-this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[2];JXG$1.exists(this.label)&&(this.label.rendNode.style.fontSize=P*JXG$1.evaluate(this.label.visProp.fontsize)+"px",this.label.fullUpdate()),this.point2.coords=new Coords(Const.COORDS_BY_USER,[this.point1.coords.usrCoords[1]+$*K,this.point1.coords.usrCoords[2]+ie*K],this.board),this.fullUpdate()},T=function(){this.highlighted||(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this),J.call(this,1.1,2))},L=function(){this.highlighted&&(this.highlighted=!1,this.board.renderer.noHighlight(this),J.call(this,.9090909,1))},z={fixed:!0,withLabel:!1,visible:!1,name:""};if(!JXG$1.isArray(A))for(A=[],r=0;r<t.length;r++)A[r]="";for(JXG$1.isFunction(G)||(B=function(){return G}),o.highlightonsector=o.highlightonsector||!1,o.straightfirst=!1,o.straightlast=!1,u=n.create("point",[w,V],z),d[0]=n.create("point",[function(){return B()+w},function(){return V}],z),r=0;r<t.length;r++)d[r+1]=n.create("point",[Y(r,"cos",w),Y(r,"sin",V)],z),o.name=A[r],o.withlabel=o.name!=="",o.fillcolor=I&&I[r%I.length],o.labelcolor=I&&I[r%I.length],o.highlightfillcolor=f&&f[r%f.length],C[r]=n.create("sector",[u,d[r],d[r+1]],o),o.highlightonsector&&(C[r].hasPoint=C[r].hasPointSector),o.highlightbysize&&(C[r].highlight=T,C[r].noHighlight=L);return{sectors:C,points:d,midpoint:u}},drawRadar:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce,ue,ye,Se,Ce,Ze,Be,xe,ge,de,ve,le,Ae,Xe,Te,Ne,We,dt,nt,Rt=t.length,Qe=function(){var be,yt,st,Gt,rt=JXG$1.evaluate(this.visProp.label.offset).slice(0);return be=this.point1.X(),yt=this.point2.X(),st=this.point1.Y(),Gt=this.point2.Y(),yt<be&&(rt[0]=-rt[0]),Gt<st&&(rt[1]=-rt[1]),this.setLabelRelativeCoords(rt),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)},Oe=function(be,yt){var st,Gt,rt;return st=n.create("transform",[-(T[yt]-Y[yt]),0],{type:"translate"}),Gt=n.create("transform",[P/(L[yt]+J[yt]-(T[yt]-Y[yt])),1],{type:"scale"}),st.melt(Gt),rt=n.create("transform",[be],{type:"rotate"}),st.melt(rt),st};if(Rt<=0)throw new Error("JSXGraph radar chart: no data");if(d=o.paramarray,!JXG$1.exists(d))throw new Error("JSXGraph radar chart: need paramArray attribute");if(C=d.length,C<=1)throw new Error("JSXGraph radar chart: need more than one param in paramArray");for(r=0;r<Rt;r++)if(C!==t[r].length)throw new Error("JSXGraph radar chart: use data length equal to number of params ("+t[r].length+" != "+C+")");for(I=[],f=[],u=0;u<C;u++)I[u]=t[0][u],f[u]=I[u];for(r=1;r<Rt;r++)for(u=0;u<C;u++)t[r][u]>I[u]&&(I[u]=t[r][u]),t[r][u]<f[u]&&(f[u]=t[r][u]);for(A=[],G=[],r=0;r<Rt;r++)A[r]="",G[r]=[];for(B=[],Z=[],w=o.startshiftratio||0,V=o.endshiftratio||0,r=0;r<C;r++)B[r]=(I[r]-f[r])*w,Z[r]=(I[r]-f[r])*V;if(Y=o.startshiftarray||B,J=o.endshiftarray||Z,T=o.startarray||f,JXG$1.exists(o.start))for(r=0;r<C;r++)T[r]=o.start;if(L=o.endarray||I,JXG$1.exists(o.end))for(r=0;r<C;r++)L[r]=o.end;if(Y.length!==C)throw new Error("JSXGraph radar chart: start shifts length is not equal to number of parameters");if(J.length!==C)throw new Error("JSXGraph radar chart: end shifts length is not equal to number of parameters");if(T.length!==C)throw new Error("JSXGraph radar chart: starts length is not equal to number of parameters");if(L.length!==C)throw new Error("JSXGraph radar chart: snds length is not equal to number of parameters");for(z=o.labelarray||A,K=o.colors,P=o.radius||10,dt=o.strokewidth||1,JXG$1.exists(o.highlightonsector)||(o.highlightonsector=!1),$={name:o.name,id:o.id,strokewidth:dt,polystrokewidth:o.polystrokewidth||dt,strokecolor:o.strokecolor||"black",straightfirst:!1,straightlast:!1,fillcolor:o.fillColor||"#FFFF88",fillopacity:o.fillOpacity||.4,highlightfillcolor:o.highlightFillColor||"#FF7400",highlightstrokecolor:o.highlightStrokeColor||"black",gradient:o.gradient||"none"},ie=o.center||[0,0],ne=ie[0],ee=ie[1],se=n.create("point",[ne,ee],{name:"",fixed:!0,withlabel:!1,visible:!1}),re=Math.PI/2-Math.PI/C,re=o.startangle||0,ce=re,ue=[],ye=[],r=0;r<C;r++)for(ce+=2*Math.PI/C,Ce=P*Math.cos(ce)+ne,Ze=P*Math.sin(ce)+ee,ue[r]=n.create("point",[Ce,Ze],{name:"",fixed:!0,withlabel:!1,visible:!1}),ye[r]=n.create("line",[se,ue[r]],{name:d[r],strokeColor:$.strokecolor,strokeWidth:$.strokewidth,strokeOpacity:1,straightFirst:!1,straightLast:!1,withLabel:!0,highlightStrokeColor:$.highlightstrokecolor}),ye[r].getLabelAnchor=Qe,Se=Oe(ce,r),u=0;u<t.length;u++)nt=t[u][r],G[u][r]=n.create("point",[nt,0],{name:"",fixed:!0,withlabel:!1,visible:!1}),G[u][r].addTransform(G[u][r],Se);for(Be=[],r=0;r<Rt;r++)for($.labelcolor=K&&K[r%K.length],$.strokecolor=K&&K[r%K.length],$.fillcolor=K&&K[r%K.length],Be[r]=n.create("polygon",G[r],{withLines:!0,withLabel:!1,fillColor:$.fillcolor,fillOpacity:$.fillopacity,highlightFillColor:$.highlightfillcolor}),u=0;u<C;u++)Be[r].borders[u].setAttribute("strokecolor:"+K[r%K.length]),Be[r].borders[u].setAttribute("strokewidth:"+$.polystrokewidth);switch(xe=o.legendposition||"none",xe){case"right":de=o.legendleftoffset||2,ve=o.legendtopoffset||1,this.legend=n.create("legend",[ne+P+de,ee+P-ve],{labels:z,colors:K});break;case"none":break;default:JXG$1.debug("Unknown legend position")}if(ge=[],o.showcircles){for(le=[],r=0;r<6;r++)le[r]=20*r;if(le[0]="0",Ae=o.circlelabelarray||le,Xe=Ae.length,Xe<2)throw new Error("JSXGraph radar chart: too less circles in circleLabelArray");for(Te=[],Ne=re+Math.PI/C,Se=Oe(Ne,0),$.fillcolor="none",$.highlightfillcolor="none",$.strokecolor=o.strokecolor||"black",$.strokewidth=o.circlestrokewidth||.5,$.layer=0,We=(L[0]-T[0])/(Xe-1),r=0;r<Xe;r++)Te[r]=n.create("point",[T[0]+r*We,0],{name:Ae[r],size:0,fixed:!0,withLabel:!0,visible:!0}),Te[r].addTransform(Te[r],Se),ge[r]=n.create("circle",[se,Te[r]],$)}return this.rendNode=Be[0].rendNode,{circles:ge,lines:ye,points:G,midpoint:se,polygons:Be}},updateRenderer:function(){return this},update:function(){return this.needsUpdate&&this.updateDataArray(),this},updateDataArray:function(){return this}});JXG$1.createChart=function(n,t,o){var r,u,d,C,I,f=[],A,G,B,Z,w,V,Y,J,T,L,z,K=JXG$1.isBrowser?n.document.getElementById(t[0]):null;if(t.length===1&&JXG$1.isString(t[0])){if(JXG$1.exists(K)){if(Z=JXG$1.copyAttributes(o,n.options,"chart"),K=new DataSource().loadFromTable(t[0],Z.withheaders,Z.withheaders),r=K.data,I=K.columnHeaders,u=K.rowHeaders,w=Z.width,V=Z.name,Y=Z.strokecolor,J=Z.fillcolor,T=Z.highlightstrokecolor,L=Z.highlightfillcolor,n.suspendUpdate(),z=r.length,B=[],Z.rows&&JXG$1.isArray(Z.rows)){for(d=0;d<z;d++)for(C=0;C<Z.rows.length;C++)if(Z.rows[C]===d||Z.withheaders&&Z.rows[C]===u[d]){B.push(r[d]);break}}else B=r;for(z=B.length,d=0;d<z;d++){if(G=[],Z.chartstyle&&Z.chartstyle.indexOf("bar")!==-1){for(w?A=w:A=.8,G.push(1-A/2+(d+.5)*A/z),C=1;C<B[d].length;C++)G.push(G[C-1]+1);Z.width=A/z}V&&V.length===z?Z.name=V[d]:Z.withheaders&&(Z.name=I[d]),Y&&Y.length===z?Z.strokecolor=Y[d]:Z.strokecolor=JXG$1.hsv2rgb((d+1)/z*360,.9,.6),J&&J.length===z?Z.fillcolor=J[d]:Z.fillcolor=JXG$1.hsv2rgb((d+1)/z*360,.9,1),T&&T.length===z?Z.highlightstrokecolor=T[d]:Z.highlightstrokecolor=JXG$1.hsv2rgb((d+1)/z*360,.9,1),L&&L.length===z?Z.highlightfillcolor=L[d]:Z.highlightfillcolor=JXG$1.hsv2rgb((d+1)/z*360,.9,.6),Z.chartstyle&&Z.chartstyle.indexOf("bar")!==-1?f.push(new JXG$1.Chart(n,[G,B[d]],Z)):f.push(new JXG$1.Chart(n,[B[d]],Z))}n.unsuspendUpdate()}return f}return Z=JXG$1.copyAttributes(o,n.options,"chart"),new JXG$1.Chart(n,t,Z)};JXG$1.registerElement("chart",JXG$1.createChart);JXG$1.Legend=function(n,t,o){var r;if(this.constructor(),r=JXG$1.copyAttributes(o,n.options,"legend"),this.board=n,this.coords=new Coords(Const.COORDS_BY_USER,t,this.board),this.myAtts={},this.label_array=r.labelarray||r.labels,this.color_array=r.colorarray||r.colors,this.lines=[],this.myAtts.strokewidth=r.strokewidth||5,this.myAtts.straightfirst=!1,this.myAtts.straightlast=!1,this.myAtts.withlabel=!0,this.myAtts.fixed=!0,this.style=r.legendstyle||r.style,this.style==="vertical")this.drawVerticalLegend(n,r);else throw new Error("JSXGraph: Unknown legend style: "+this.style)};JXG$1.Legend.prototype=new GeometryElement;JXG$1.Legend.prototype.drawVerticalLegend=function(n,t){var o,r=t.linelength||1,u=(t.rowheight||20)/this.board.unitY,d=function(){return this.setLabelRelativeCoords(this.visProp.label.offset),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)};for(o=0;o<this.label_array.length;o++)this.myAtts.name=this.label_array[o],this.myAtts.strokecolor=this.color_array[o%this.color_array.length],this.myAtts.highlightstrokecolor=this.color_array[o%this.color_array.length],this.myAtts.label={offset:[10,0],strokeColor:this.color_array[o%this.color_array.length],strokeWidth:this.myAtts.strokewidth},this.lines[o]=n.create("line",[[this.coords.usrCoords[1],this.coords.usrCoords[2]-o*u],[this.coords.usrCoords[1]+r,this.coords.usrCoords[2]-o*u]],this.myAtts),this.lines[o].getLabelAnchor=d,this.lines[o].prepareUpdate().update().updateVisibility(JXG$1.evaluate(this.lines[o].visProp.visible)).updateRenderer()};JXG$1.createLegend=function(n,t,o){var r=[0,0];if(JXG$1.exists(t)&&t.length===2)r=t;else throw new Error("JSXGraph: Legend element needs two numbers as parameters");return new JXG$1.Legend(n,r,o)};JXG$1.registerElement("legend",JXG$1.createLegend);JXG$1.Chart,JXG$1.Legend;JXG$1.Transformation=function(n,t,o){this.elementClass=Const.OBJECT_CLASS_OTHER,this.type=Const.OBJECT_TYPE_TRANSFORMATION,this.matrix=[[1,0,0],[0,1,0],[0,0,1]],this.board=n,this.isNumericMatrix=!1,this.setMatrix(n,t,o),this.methodMap={apply:"apply",applyOnce:"applyOnce",bindTo:"bindTo",bind:"bindTo",melt:"melt"}};JXG$1.Transformation.prototype={};JXG$1.extend(JXG$1.Transformation.prototype,{update:function(){return this},setMatrix:function(n,t,o){var r;for(this.isNumericMatrix=!0,r=0;r<o.length;r++)if(typeof o[r]!="number"){this.isNumericMatrix=!1;break}if(t==="translate"){if(o.length!==2)throw new Error("JSXGraph: translate transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][0]=this.evalParam(0),this.matrix[2][0]=this.evalParam(1)}}else if(t==="scale"){if(o.length!==2)throw new Error("JSXGraph: scale transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][1]=this.evalParam(0),this.matrix[2][2]=this.evalParam(1)}}else if(t==="reflect")o.length<4&&(o[0]=n.select(o[0])),o.length===2&&(o[1]=n.select(o[1])),o.length===4&&(this.evalParam=JXG$1.createEvalFunction(n,o,4)),this.update=function(){var u,d,C,I,f,A,G,B;o.length===1?G=o[0].stdform:o.length===2?G=Mat.crossProduct(o[1].coords.usrCoords,o[0].coords.usrCoords):o.length===4&&(G=Mat.crossProduct([1,this.evalParam(2),this.evalParam(3)],[1,this.evalParam(0),this.evalParam(1)])),u=G[1],d=G[2],C=G[0],B=[-C*u,-C*d,u*u+d*d],A=B[2],I=B[0]/B[2],f=B[1]/B[2],u=-G[2],d=G[1],this.matrix[1][1]=(u*u-d*d)/A,this.matrix[1][2]=2*u*d/A,this.matrix[2][1]=this.matrix[1][2],this.matrix[2][2]=-this.matrix[1][1],this.matrix[1][0]=I*(1-this.matrix[1][1])-f*this.matrix[1][2],this.matrix[2][0]=f*(1-this.matrix[2][2])-I*this.matrix[2][1]};else if(t==="rotate")o.length===3?this.evalParam=JXG$1.createEvalFunction(n,o,3):o.length>0&&o.length<=2&&(this.evalParam=JXG$1.createEvalFunction(n,o,1),o.length===2&&!JXG$1.isArray(o[1])&&(o[1]=n.select(o[1]))),this.update=function(){var u,d,C=this.evalParam(0),I=Math.cos(C),f=Math.sin(C);this.matrix[1][1]=I,this.matrix[1][2]=-f,this.matrix[2][1]=f,this.matrix[2][2]=I,o.length>1&&(o.length===3?(u=this.evalParam(1),d=this.evalParam(2)):JXG$1.isArray(o[1])?(u=o[1][0],d=o[1][1]):(u=o[1].X(),d=o[1].Y()),this.matrix[1][0]=u*(1-I)+d*f,this.matrix[2][0]=d*(1-I)-u*f)};else if(t==="shear"){if(o.length!==2)throw new Error("JSXGraph: shear transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][2]=this.evalParam(0),this.matrix[2][1]=this.evalParam(1)}}else if(t==="generic"){if(o.length!==9)throw new Error("JSXGraph: generic transformation needs 9 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,9),this.update=function(){this.matrix[0][0]=this.evalParam(0),this.matrix[0][1]=this.evalParam(1),this.matrix[0][2]=this.evalParam(2),this.matrix[1][0]=this.evalParam(3),this.matrix[1][1]=this.evalParam(4),this.matrix[1][2]=this.evalParam(5),this.matrix[2][0]=this.evalParam(6),this.matrix[2][1]=this.evalParam(7),this.matrix[2][2]=this.evalParam(8)}}},apply:function(n,t){return this.update(),JXG$1.exists(t)?Mat.matVecMult(this.matrix,n.initialCoords.usrCoords):Mat.matVecMult(this.matrix,n.coords.usrCoords)},applyOnce:function(n){var t,o,r;for(JXG$1.isArray(n)||(n=[n]),o=n.length,r=0;r<o;r++)this.update(),t=Mat.matVecMult(this.matrix,n[r].coords.usrCoords),n[r].coords.setCoordinates(Const.COORDS_BY_USER,t)},bindTo:function(n){var t,o;if(JXG$1.isArray(n))for(o=n.length,t=0;t<o;t++)n[t].transformations.push(this);else n.transformations.push(this)},setProperty:function(n){JXG$1.deprecated("Transformation.setProperty()","Transformation.setAttribute()")},setAttribute:function(n){},melt:function(n){var t=[],o,r,u,d,C,I;for(r=n.matrix.length,u=this.matrix[0].length,o=0;o<r;o++)t[o]=[];for(this.update(),n.update(),o=0;o<r;o++)for(I=0;I<u;I++){for(C=0,d=0;d<r;d++)C+=n.matrix[o][d]*this.matrix[d][I];t[o][I]=C}return this.update=function(){var f=this.matrix.length,A=this.matrix[0].length;for(o=0;o<f;o++)for(I=0;I<A;I++)this.matrix[o][I]=t[o][I]},this},getParents:function(){var n=[[].concat.apply([],this.matrix)];return this.parents.length!==0&&(n=this.parents),n}});JXG$1.createTransform=function(n,t,o){return new JXG$1.Transformation(n,o.type,t)};JXG$1.registerElement("transform",JXG$1.createTransform);JXG$1.Transformation;JXG$1.Turtle=function(n,t,o){var r,u,d;return this.constructor(n,o,Const.OBJECT_TYPE_TURTLE,Const.OBJECT_CLASS_OTHER),this.turtleIsHidden=!1,this.board=n,this.visProp.curveType="plot",this._attributes=JXG$1.copyAttributes(this.visProp,n.options,"turtle"),delete this._attributes.id,r=0,u=0,d=90,t.length!==0&&(t.length===3?(r=t[0],u=t[1],d=t[2]):t.length===2?JXG$1.isArray(t[0])?(r=t[0][0],u=t[0][1],d=t[1]):(r=t[0],u=t[1]):(r=t[0][0],u=t[0][1])),this.init(r,u,d),this.methodMap=JXG$1.deepCopy(this.methodMap,{forward:"forward",fd:"forward",back:"back",bk:"back",right:"right",rt:"right",left:"left",lt:"left",penUp:"penUp",pu:"penUp",up:"penUp",penDown:"penDown",pd:"penDown",down:"penDown",clearScreen:"clearScreen",cs:"clearScreen",clean:"clean",setPos:"setPos",home:"home",hideTurtle:"hideTurtle",ht:"hideTurtle",hide:"hideTurtle",showTurtle:"showTurtle",st:"showTurtle",show:"showTurtle",penSize:"setPenSize",setPenSize:"setPenSize",penColor:"setPenColor",setPenColor:"setPenColor",highlightPenColor:"setHighlightPenColor",setHighlightPenColor:"setHighlightPenColor",getPenColor:"getPenColor",Color:"getPenColor",getHighlightPenColor:"getHighlightPenColor",HighlightColor:"getHighlightPenColor",getPenSize:"getPenSize",Size:"getPenSize",pushTurtle:"pushTurtle",push:"pushTurtle",popTurtle:"popTurtle",pop:"popTurtle",lookTo:"lookTo",pos:"pos",Pos:"pos",moveTo:"moveTo",X:"X",Y:"Y"}),this};JXG$1.Turtle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Turtle.prototype,{init:function(n,t,o){var r={fixed:!0,name:"",visible:!1,withLabel:!1};this.arrowLen=20/Mat.hypot(this.board.unitX,this.board.unitY),this.pos=[n,t],this.isPenDown=!0,this.dir=90,this.stack=[],this.objects=[],this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.turtle=this.board.create("point",this.pos,r),this.objects.push(this.turtle),this.turtle2=this.board.create("point",[this.pos[0],this.pos[1]+this.arrowLen],r),this.objects.push(this.turtle2),this.visProp.arrow.lastArrow=!0,this.visProp.arrow.straightFirst=!1,this.visProp.arrow.straightLast=!1,this.arrow=this.board.create("line",[this.turtle,this.turtle2],this.visProp.arrow),this.objects.push(this.arrow),this.subs={arrow:this.arrow},this.inherits.push(this.arrow),this.right(90-o),this.board.update()},forward:function(n){if(n===0)return this;var t,o=n*Math.cos(this.dir*Math.PI/180),r=n*Math.sin(this.dir*Math.PI/180);return this.turtleIsHidden||(t=this.board.create("transform",[o,r],{type:"translate"}),t.applyOnce(this.turtle),t.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]+=o,this.pos[1]+=r,this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update(),this},back:function(n){return this.forward(-n)},right:function(n){if(this.dir-=n,this.dir%=360,!this.turtleIsHidden){var t=this.board.create("transform",[-n*Math.PI/180,this.turtle],{type:"rotate"});t.applyOnce(this.turtle2)}return this.board.update(),this},left:function(n){return this.right(-n)},penUp:function(){return this.isPenDown=!1,this},penDown:function(){return this.isPenDown=!0,this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this},clean:function(){var n,t;for(n=0;n<this.objects.length;n++)t=this.objects[n],t.type===Const.OBJECT_TYPE_CURVE&&(this.board.removeObject(t),this.objects.splice(n,1));return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},clearScreen:function(){var n,t,o=this.objects.length;for(n=0;n<o;n++)t=this.objects[n],this.board.removeObject(t);return this.init(0,0,90),this},setPos:function(n,t){var o;return JXG$1.isArray(n)?this.pos=n:this.pos=[n,t],this.turtleIsHidden||(this.turtle.setPositionDirectly(Const.COORDS_BY_USER,[n,t]),this.turtle2.setPositionDirectly(Const.COORDS_BY_USER,[n,t+this.arrowLen]),o=this.board.create("transform",[-(this.dir-90)*Math.PI/180,this.turtle],{type:"rotate"}),o.applyOnce(this.turtle2)),this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},setPenSize:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeWidth",n)),this.objects.push(this.curve),this},setPenColor:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeColor",n)),this.objects.push(this.curve),this},getPenAttribute:function(n){var t,o=this.objects.length;return o===4?t=0:t=o-1,JXG$1.evaluate(this.objects[t].visProp[n])},getPenSize:function(){return this.getPenAttribute("strokewidth")},getPenColor:function(){return this.getPenAttribute("strokecolor")},getHighlightPenColor:function(){return this.getPenAttribute("highlightstrokecolor")},setHighlightPenColor:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("highlightStrokeColor",n)),this.objects.push(this.curve),this},setAttribute:function(n){var t,o,r,u=this.objects.length;for(t=0;t<u;t++)o=this.objects[t],o.type===Const.OBJECT_TYPE_CURVE&&o.setAttribute(n);return r=this.visProp.id,this.visProp=JXG$1.deepCopy(this.curve.visProp),this.visProp.id=r,this._attributes=JXG$1.deepCopy(this.visProp),delete this._attributes.id,this},copyAttr:function(n,t){return this._attributes[n.toLowerCase()]=t,this._attributes},showTurtle:function(){return this.turtleIsHidden=!1,this.arrow.setAttribute({visible:!0}),this.visProp.arrow.visible=!1,this.setPos(this.pos[0],this.pos[1]),this.board.update(),this},hideTurtle:function(){return this.turtleIsHidden=!0,this.arrow.setAttribute({visible:!1}),this.visProp.arrow.visible=!1,this.board.update(),this},home:function(){return this.pos=[0,0],this.setPos(this.pos[0],this.pos[1]),this},pushTurtle:function(){return this.stack.push([this.pos[0],this.pos[1],this.dir]),this},popTurtle:function(){var n=this.stack.pop();return this.pos[0]=n[0],this.pos[1]=n[1],this.dir=n[2],this.setPos(this.pos[0],this.pos[1]),this},lookTo:function(n){var t,o,r,u,d;return JXG$1.isArray(n)?(t=this.pos[0],o=this.pos[1],r=n[0],u=n[1],d=Math.atan2(u-o,r-t),this.right(this.dir-d*180/Math.PI)):JXG$1.isNumber(n)&&this.right(this.dir-n),this},moveTo:function(n){var t,o,r;return JXG$1.isArray(n)&&(t=n[0]-this.pos[0],o=n[1]-this.pos[1],this.turtleIsHidden||(r=this.board.create("transform",[t,o],{type:"translate"}),r.applyOnce(this.turtle),r.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]=n[0],this.pos[1]=n[1],this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update()),this},fd:function(n){return this.forward(n)},bk:function(n){return this.back(n)},lt:function(n){return this.left(n)},rt:function(n){return this.right(n)},pu:function(){return this.penUp()},pd:function(){return this.penDown()},ht:function(){return this.hideTurtle()},st:function(){return this.showTurtle()},cs:function(){return this.clearScreen()},push:function(){return this.pushTurtle()},pop:function(){return this.popTurtle()},evalAt:function(n,t){var o,r,u,d,C=this.objects.length;for(o=0,r=0;o<C;o++)if(u=this.objects[o],u.elementClass===Const.OBJECT_CLASS_CURVE){if(r<=n&&n<r+u.numberPoints)return d=n-r,u[t](d);r+=u.numberPoints}return this[t]()},X:function(n){return JXG$1.exists(n)?this.evalAt(n,"X"):this.pos[0]},Y:function(n){return JXG$1.exists(n)?this.evalAt(n,"Y"):this.pos[1]},Z:function(n){return 1},minX:function(){return 0},maxX:function(){var n,t,o=this.objects.length,r=0;for(n=0;n<o;n++)t=this.objects[n],t.elementClass===Const.OBJECT_CLASS_CURVE&&(r+=this.objects[n].numberPoints);return r},hasPoint:function(n,t){var o,r;for(o=0;o<this.objects.length;o++)if(r=this.objects[o],r.type===Const.OBJECT_TYPE_CURVE&&r.hasPoint(n,t))return!0;return!1}});JXG$1.createTurtle=function(n,t,o){var r;return t=t||[],r=JXG$1.copyAttributes(o,n.options,"turtle"),new JXG$1.Turtle(n,t,r)};JXG$1.registerElement("turtle",JXG$1.createTurtle);JXG$1.Turtle;JXG$1.Ticks=function(n,t,o){if(this.constructor(n.board,o,Const.OBJECT_TYPE_TICKS,Const.OBJECT_CLASS_OTHER),this.line=n,this.board=this.line.board,this.fixedTicks=null,this.equidistant=!1,this.labelsData=[],JXG$1.isFunction(t))throw this.ticksFunction=t,new Error("Function arguments are no longer supported.");JXG$1.isArray(t)?this.fixedTicks=t:this.equidistant=!0,this.ticks=[],this.labels=[],this.labelCounter=0,this.id=this.line.addTicks(this),this.elType="ticks",this.inherits.push(this.labels),this.board.setId(this,"Ti")};JXG$1.Ticks.prototype=new GeometryElement;JXG$1.extend(JXG$1.Ticks.prototype,{hasPoint:function(n,t){var o,r,u,d,C=this.ticks&&this.ticks.length||0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(d=this.board._inputDevice,u=JXG$1.evaluate(this.visProp.precision[d])):u=this.board.options.precision.hasPoint,u+=JXG$1.evaluate(this.visProp.strokewidth)*.5,!JXG$1.evaluate(this.line.visProp.scalable)||this.line.elementClass===Const.OBJECT_CLASS_CURVE||this.line.stdform[1]!==0&&this.line.stdform[2]!==0&&this.line.type!==Const.OBJECT_TYPE_AXIS)return!1;for(o=0;o<C;o++)if(r=this.ticks[o],r[2]&&!(this.line.stdform[1]===0&&Math.abs(r[0][0]-this.line.point1.coords.scrCoords[1])<Mat.eps||this.line.stdform[2]===0&&Math.abs(r[1][0]-this.line.point1.coords.scrCoords[2])<Mat.eps)&&(Math.abs(r[0][0]-r[0][1])>=1||Math.abs(r[1][0]-r[1][1])>=1)){if(this.line.stdform[1]===0){if(Math.abs(t-this.line.point1.coords.scrCoords[2])<2*u&&r[0][0]-u<n&&n<r[0][1]+u)return!0}else if(this.line.stdform[2]===0&&Math.abs(n-this.line.point1.coords.scrCoords[1])<2*u&&r[1][0]-u<t&&t<r[1][1]+u)return!0}return!1},setPositionDirectly:function(n,t,o){var r,u,d=new Coords(n,t,this.board),C=new Coords(n,o,this.board),I=this.board.getBoundingBox();return this.line.type!==Const.OBJECT_TYPE_AXIS||!JXG$1.evaluate(this.line.visProp.scalable)?this:(Math.abs(this.line.stdform[1])<Mat.eps&&Math.abs(d.usrCoords[1]*C.usrCoords[1])>Mat.eps?(r=C.usrCoords[1]/d.usrCoords[1],I[0]*=r,I[2]*=r,this.board.setBoundingBox(I,this.board.keepaspectratio,"update")):Math.abs(this.line.stdform[2])<Mat.eps&&Math.abs(d.usrCoords[2]*C.usrCoords[2])>Mat.eps&&(u=C.usrCoords[2]/d.usrCoords[2],I[3]*=u,I[1]*=u,this.board.setBoundingBox(I,this.board.keepaspectratio,"update")),this)},calculateTicksCoordinates:function(){var n,t,o,r;if(!(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(this.setTicksSizeVariables(),Math.abs(this.dx)<Mat.eps&&Math.abs(this.dy)<Mat.eps)))return n=this.getZeroCoordinates(),this.line.elementClass===Const.OBJECT_CLASS_LINE?t=this.getLowerAndUpperBounds(n,"ticksdistance"):t={lower:this.line.minX(),upper:this.line.maxX(),a1:0,a2:0,m1:0,m2:0},JXG$1.evaluate(this.visProp.type)==="polar"&&(r=this.board.getBoundingBox(),o=Math.max(Mat.hypot(r[0],r[1]),Mat.hypot(r[2],r[3])),t.upper=o),this.ticks=[],this.labelsData=[],this.equidistant?this.generateEquidistantTicks(n,t):this.generateFixedTicks(n,t),this},setTicksSizeVariables:function(n){var t,o,r,u,d=JXG$1.evaluate(this.visProp.majorheight)*.5,C=JXG$1.evaluate(this.visProp.minorheight)*.5;JXG$1.exists(n)?(o=this.line.minX(),r=this.line.maxX(),u=this.line.points.length,u<2?(this.dxMaj=0,this.dyMaj=0):Mat.relDif(n,o)<Mat.eps?(this.dxMaj=this.line.points[0].usrCoords[2]-this.line.points[1].usrCoords[2],this.dyMaj=this.line.points[1].usrCoords[1]-this.line.points[0].usrCoords[1]):Mat.relDif(n,r)<Mat.eps?(this.dxMaj=this.line.points[u-2].usrCoords[2]-this.line.points[u-1].usrCoords[2],this.dyMaj=this.line.points[u-1].usrCoords[1]-this.line.points[u-2].usrCoords[1]):(this.dxMaj=-Numerics.D(this.line.Y)(n),this.dyMaj=Numerics.D(this.line.X)(n))):(this.dxMaj=this.line.stdform[1],this.dyMaj=this.line.stdform[2]),this.dxMin=this.dxMaj,this.dyMin=this.dyMaj,this.dx=this.dxMaj,this.dy=this.dyMaj,t=Mat.hypot(this.dxMaj*this.board.unitX,this.dyMaj*this.board.unitY),this.dxMaj*=d/t*this.board.unitX,this.dyMaj*=d/t*this.board.unitY,this.dxMin*=C/t*this.board.unitX,this.dyMin*=C/t*this.board.unitY,this.minStyle=JXG$1.evaluate(this.visProp.minorheight)<0?"infinite":"finite",this.majStyle=JXG$1.evaluate(this.visProp.majorheight)<0?"infinite":"finite"},getZeroCoordinates:function(){var n,t,o,r,u,d,C,I,f,A=JXG$1.evaluate(this.visProp.anchor);return this.line.elementClass===Const.OBJECT_CLASS_LINE?this.line.type===Const.OBJECT_TYPE_AXIS?Geometry.projectPointToLine({coords:{usrCoords:[1,0,0]}},this.line,this.board):(o=this.line.point1.coords.usrCoords[0],n=this.line.point1.coords.usrCoords[1],t=this.line.point1.coords.usrCoords[2],d=this.line.point2.coords.usrCoords[0],r=this.line.point2.coords.usrCoords[1],u=this.line.point2.coords.usrCoords[2],A==="right"?this.line.point2.coords:A==="middle"?new Coords(Const.COORDS_BY_USER,[(o+d)*.5,(n+r)*.5,(t+u)*.5],this.board):JXG$1.isNumber(A)?new Coords(Const.COORDS_BY_USER,[o+(d-o)*A,n+(r-n)*A,t+(u-t)*A],this.board):this.line.point1.coords):(I=this.line.minX(),f=this.line.maxX(),A==="right"?C=f:A==="middle"?C=(I+f)*.5:JXG$1.isNumber(A)?C=I*(1-A)+f*A:C=I,C)},getLowerAndUpperBounds:function(n,t){var o,r,u,d,C,I,f,A,G,B,Z,w,V,Y,J,T=Mat.eps*10,L=JXG$1.evaluate(this.line.visProp.straightfirst),z=JXG$1.evaluate(this.line.visProp.straightlast),K=JXG$1.evaluate(this.visProp.includeboundaries);return this.line.elementClass===Const.OBJECT_CLASS_CURVE?{lower:this.line.minX(),upper:this.line.maxX()}:(C=new Coords(Const.COORDS_BY_USER,this.line.point1.coords.usrCoords,this.board),I=new Coords(Const.COORDS_BY_USER,this.line.point2.coords.usrCoords,this.board),f=Math.abs(C.usrCoords[0])>=Mat.eps&&C.scrCoords[1]>=0&&C.scrCoords[1]<=this.board.canvasWidth&&C.scrCoords[2]>=0&&C.scrCoords[2]<=this.board.canvasHeight,A=Math.abs(I.usrCoords[0])>=Mat.eps&&I.scrCoords[1]>=0&&I.scrCoords[1]<=this.board.canvasWidth&&I.scrCoords[2]>=0&&I.scrCoords[2]<=this.board.canvasHeight,JXG$1.exists(t)&&t==="ticksdistance"?(Geometry.calcStraight(this.line,C,I,0),Y=this.getDistanceFromZero(n,C),J=this.getDistanceFromZero(n,I),Geometry.calcStraight(this.line,C,I,JXG$1.evaluate(this.line.visProp.margin)),Y=this.getDistanceFromZero(n,C)-Y,J=this.getDistanceFromZero(n,I).m2):Geometry.calcLineDelimitingPoints(this.line,C,I),u=JXG$1.evaluate(this.line.visProp.firstarrow),d=JXG$1.evaluate(this.line.visProp.lastarrow),w=this.getDistanceFromZero(n,C),V=this.getDistanceFromZero(n,I),(u||d)&&(Z=this.board.renderer.getArrowHeadData(this.line,JXG$1.evaluate(this.line.visProp.strokewidth),""),this.board.renderer.getPositionArrowHead(this.line,C,I,Z)),G=this.getDistanceFromZero(n,C),B=this.getDistanceFromZero(n,I),w=G-w,V=G-V,G<B?(o=G,r=B,!L&&f&&!K&&(o+=T),!z&&A&&!K&&(r-=T)):B<G?(o=B,r=G,!z&&A&&!K&&(o+=T),!L&&f&&!K&&(r-=T)):(o=0,r=0),{lower:o,upper:r,a1:w,a2:V,m1:Y,m2:J})},getDistanceFromZero:function(n,t){var o,r,u,d,C;return o=this.line.point1.coords,r=this.line.point2.coords,C=n.distance(Const.COORDS_BY_USER,t),u=[r.usrCoords[0]-o.usrCoords[0],r.usrCoords[1]-o.usrCoords[1],r.usrCoords[2]-o.usrCoords[2]],d=[t.usrCoords[0]-n.usrCoords[0],t.usrCoords[1]-n.usrCoords[1],t.usrCoords[2]-n.usrCoords[2]],Mat.innerProduct(u,d,3)<0&&(C*=-1),C},generateEquidistantTicks:function(n,t){var o,r=Mat.eps,u,d,C=JXG$1.evaluate(this.visProp.minorticks);if(d=this.getDistanceMajorTicks(),this.line.elementClass===Const.OBJECT_CLASS_LINE&&(u=this.getXandYdeltas()),d*=JXG$1.evaluate(this.visProp.scale),d/=C+1,this.ticksDelta=d,!(d<Mat.eps)){for(o=0,JXG$1.evaluate(this.visProp.drawzero)||(o=d);o<=t.upper+r&&(o>=t.lower-r&&this.processTickPosition(n,o,d,u),o+=d,!(t.upper-o>d*1e4)););for(o=-d;o>=t.lower-r&&(o<=t.upper+r&&this.processTickPosition(n,o,d,u),o-=d,!(o-t.lower>d*1e4)););}},getDistanceMajorTicks:function(){var n,t,o,r,u,d,C=5,I,f,A;return JXG$1.evaluate(this.visProp.insertticks)?(o=this.getLowerAndUpperBounds(this.getZeroCoordinates(),""),u=o.upper-o.lower,d=JXG$1.evaluate(this.visProp.scale),I=u/(C+1)/d,f=JXG$1.evaluate(this.visProp.minticksdistance)/d,A=JXG$1.evaluate(this.visProp.minorticks),r=this.getXandYdeltas(),r.x*=this.board.unitX,r.y*=this.board.unitY,f/=Mat.hypot(r.x,r.y),f*=A+1,n=Math.pow(10,Math.floor(Math.log(f)/Math.LN10)),2*n>=f?n*=2:5*n>=f&&(n*=5),t=Math.pow(10,Math.floor(Math.log(I)/Math.LN10)),5*t<I?t*=5:2*t<I&&(t*=2),n=Math.max(n,t),n):JXG$1.evaluate(this.visProp.ticksdistance)},processTickPosition:function(n,t,o,r){var u,d,C,I,f,A=JXG$1.evaluate(this.visProp.ticksperlabel),G=null;this.line.elementClass===Const.OBJECT_CLASS_LINE?(u=n.usrCoords[1]+t*r.x,d=n.usrCoords[2]+t*r.y):(u=this.line.X(n+t),d=this.line.Y(n+t)),C=new Coords(Const.COORDS_BY_USER,[u,d],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&(G=n+t,this.setTicksSizeVariables(G)),C.major=Math.round(t/o)%(JXG$1.evaluate(this.visProp.minorticks)+1)===0,A||(A=JXG$1.evaluate(this.visProp.minorticks)+1),f=Math.round(t/o)%A===0,I=this.createTickPath(C,C.major),I.length===3&&(this.ticks.push(I),f&&JXG$1.evaluate(this.visProp.drawlabels)?this.labelsData.push(this.generateLabelData(this.generateLabelText(C,n,G),C,this.ticks.length)):this.labelsData.push(null))},generateFixedTicks:function(n,t){var o,r,u,d,C,I,f=Mat.eps,A,G=JXG$1.isArray(this.visProp.labels),B,Z=JXG$1.evaluate(this.visProp.drawlabels);for(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(B=this.getXandYdeltas()),u=0;u<this.fixedTicks.length;u++)this.line.elementClass===Const.OBJECT_CLASS_LINE?(A=this.fixedTicks[u],C=n.usrCoords[1]+A*B.x,I=n.usrCoords[2]+A*B.y):(A=n+this.fixedTicks[u],C=this.line.X(A),I=this.line.Y(A)),o=new Coords(Const.COORDS_BY_USER,[C,I],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&this.setTicksSizeVariables(A),d=this.createTickPath(o,!0),d.length===3&&A>=t.lower-f&&A<=t.upper+f&&(this.ticks.push(d),Z&&(G||JXG$1.exists(this.visProp.labels[u]))?(r=G?JXG$1.evaluate(this.visProp.labels[u]):A,this.labelsData.push(this.generateLabelData(this.generateLabelText(o,n,r),o,u))):this.labelsData.push(null))},getXandYdeltas:function(){var n,t,o=this.line.point1.Dist(this.line.point2);return n=this.line.point1.coords.usrCoords,t=this.line.point2.coords.usrCoords,{x:(t[1]-n[1])/o,y:(t[2]-n[2])/o}},_isInsideCanvas:function(n,t,o){var r=this.board.canvasWidth,u=this.board.canvasHeight;return o===void 0&&(o=0),n[0]>=o&&n[0]<=r-o&&t[0]>=o&&t[0]<=u-o||n[1]>=o&&n[1]<=r-o&&t[1]>=o&&t[1]<=u-o},createTickPath:function(n,t){var o,r,u,d,C,I,f,A,G,B=[-2e6,-2e6],Z=[-2e6,-2e6],w,V,Y,J,T,L,z,K,P;if(o=n.scrCoords,t?(d=this.dxMaj,C=this.dyMaj,G=this.majStyle,z=JXG$1.evaluate(this.visProp.majortickendings[0])>0,K=JXG$1.evaluate(this.visProp.majortickendings[1])>0):(d=this.dxMin,C=this.dyMin,G=this.minStyle,z=JXG$1.evaluate(this.visProp.tickendings[0])>0,K=JXG$1.evaluate(this.visProp.tickendings[1])>0),r=[-C*o[1]-d*o[2],C,d],t&&JXG$1.evaluate(this.visProp.type)==="polar"){if(J=this.board.getBoundingBox(),T=2*Math.PI,L=T/180,o=n.usrCoords,V=Mat.hypot(o[1],o[2]),Y=Math.max(Mat.hypot(J[0],J[1]),Mat.hypot(J[2],J[3])),V<Y){for(B=[],Z=[],w=0;w<=T;w+=L)B.push(this.board.origin.scrCoords[1]+V*Math.cos(w)*this.board.unitX),Z.push(this.board.origin.scrCoords[2]+V*Math.sin(w)*this.board.unitY);return[B,Z,t]}}else{if(G==="infinite"){if(JXG$1.evaluate(this.visProp.ignoreinfinitetickendings)&&(z=K=!0),u=Geometry.meetLineBoard(r,this.board),z&&K)B[0]=u[0].scrCoords[1],B[1]=u[1].scrCoords[1],Z[0]=u[0].scrCoords[2],Z[1]=u[1].scrCoords[2];else if(P=[Mat.innerProduct(u[0].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0],Mat.innerProduct(u[1].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0]],P[0]<P[1]&&(u.reverse(),P.reverse()),z){if(P[0]<0)return[];P[1]<0?(B[0]=u[0].scrCoords[1],Z[0]=u[0].scrCoords[2],B[1]=o[1],Z[1]=o[2]):(B[0]=u[0].scrCoords[1],Z[0]=u[0].scrCoords[2],B[1]=u[1].scrCoords[1],Z[1]=u[1].scrCoords[2])}else if(K){if(P[1]>0)return[];P[0]>0?(B[0]=o[1],Z[0]=o[2],B[1]=u[1].scrCoords[1],Z[1]=u[1].scrCoords[2]):(B[0]=u[0].scrCoords[1],Z[0]=u[0].scrCoords[2],B[1]=u[1].scrCoords[1],Z[1]=u[1].scrCoords[2])}}else JXG$1.evaluate(this.visProp.face)===">"?A=Math.PI/4:JXG$1.evaluate(this.visProp.face)==="<"?A=-Math.PI/4:A=0,I=Math.cos(A)*d-Math.sin(A)*C,f=Math.sin(A)*d+Math.cos(A)*C,B[0]=o[1]+I*z,Z[0]=o[2]-f*z,B[1]=o[1],Z[1]=o[2],A=-A,I=Math.cos(A)*d-Math.sin(A)*C,f=Math.sin(A)*d+Math.cos(A)*C,B[2]=o[1]-I*K,Z[2]=o[2]+f*K;if(this._isInsideCanvas(B,Z))return[B,Z,t]}return[]},formatLabelText:function(n){var t,o,r=JXG$1.evaluate(this.visProp.label.usemathjax),u=JXG$1.evaluate(this.visProp.label.usekatex),d=JXG$1.evaluate(this.visProp.scalesymbol);return JXG$1.isNumber(n)?(JXG$1.evaluate(this.visProp.label.tofraction)?r?t="\\("+JXG$1.toFraction(n,!0)+"\\)":t=JXG$1.toFraction(n,u):(o=JXG$1.evaluate(this.visProp.digits),this.useLocale()?t=this.formatNumberLocale(n,o):(t=(Math.round(n*1e11)/1e11).toString(),(t.length>JXG$1.evaluate(this.visProp.maxlabellength)||t.indexOf("e")!==-1)&&(JXG$1.evaluate(this.visProp.precision)!==3&&o===3&&(o=JXG$1.evaluate(this.visProp.precision)),t=n.toExponential(o).toString()))),JXG$1.evaluate(this.visProp.beautifulscientificticklabels)&&(t=this.beautifyScientificNotationLabel(t)),t.indexOf(".")>-1&&t.indexOf("e")===-1&&(t=t.replace(/0+$/,""),t=t.replace(/\.$/,""))):t=n.toString(),d.length>0&&(t==="1"?t=d:t==="-1"?t="-"+d:t!=="0"&&(t=t+d)),JXG$1.evaluate(this.visProp.useunicodeminus)&&(t=t.replace(/-/g,"")),t},beautifyScientificNotationLabel:function(n){var t;return n.indexOf("e")===-1?n:(t=parseFloat(n.substring(0,n.indexOf("e")))+n.substring(n.indexOf("e")),t=t.replace(/e(.*)$/g,function(o,r){var u="10";return u+=r.replace(/-/g,"").replace(/\+/g,"").replace(/0/g,"").replace(/1/g,"").replace(/2/g,"").replace(/3/g,"").replace(/4/g,"").replace(/5/g,"").replace(/6/g,"").replace(/7/g,"").replace(/8/g,"").replace(/9/g,""),u}),t)},generateLabelText:function(n,t,o){var r,u;if(!JXG$1.exists(o)){if(u=this.getDistanceFromZero(t,n),Math.abs(u)<Mat.eps)return"0";o=u/JXG$1.evaluate(this.visProp.scale)}return r=this.formatLabelText(o),r},generateLabelData:function(n,t,o){var r,u,d,C;return C=JXG$1.evaluate(this.visProp.label.fontsize),r=[t.scrCoords[1],t.scrCoords[1]],u=[t.scrCoords[2],t.scrCoords[2]],d=C===void 0?12:C,d*=.5,this._isInsideCanvas(r,u,d)?(r=JXG$1.evaluate(this.visProp.label.offset[0]),u=JXG$1.evaluate(this.visProp.label.offset[1]),{x:t.usrCoords[1]+r/this.board.unitX,y:t.usrCoords[2]+u/this.board.unitY,t:n,i:o}):null},update:function(){return this.needsUpdate&&this.board.canvasWidth!==0&&this.board.canvasHeight!==0&&this.calculateTicksCoordinates(),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&this.board.renderer.updateTicks(this),this.updateRendererLabels(),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateRendererLabels:function(){var n,t,o,r,u,d,C,I;for(o=this.labelsData.length,r=this.labels.length,n=0,t=0;n<o;n++)this.labelsData[n]!==null&&(C=this.labelsData[n],t<r?(d=this.labels[t],d.setText(C.t),d.setCoords(C.x,C.y),t++):(this.labelCounter+=1,u={isLabel:!0,layer:this.board.options.layer.line,highlightStrokeColor:this.board.options.text.strokeColor,highlightStrokeWidth:this.board.options.text.strokeWidth,highlightStrokeOpacity:this.board.options.text.strokeOpacity,priv:this.visProp.priv},u=JXG$1.deepCopy(u,this.visProp.label),u.id=this.id+C.i+"Label"+this.labelCounter,d=JXG$1.createText(this.board,[C.x,C.y,C.t],u),this.addChild(d),d.setParents(this),d.isDraggable=!1,d.dump=!1,this.labels.push(d)),I=JXG$1.evaluate(this.visProp.label.visible),I==="inherit"&&(I=this.visPropCalc.visible),d.prepareUpdate().updateVisibility(I).updateRenderer(),d.distanceX=JXG$1.evaluate(this.visProp.label.offset[0]),d.distanceY=JXG$1.evaluate(this.visProp.label.offset[1]));for(o=t,t=o;t<r;t++)this.board.renderer.display(this.labels[t],!1),this.labels[t].visProp.visible=this.labels[t].visPropCalc.visible=!1;return this},hideElement:function(){var n;for(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),n=0;n<this.labels.length;n++)JXG$1.exists(this.labels[n])&&this.labels[n].hideElement();return this},showElement:function(){var n;for(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!1),n=0;n<this.labels.length;n++)JXG$1.exists(this.labels[n])&&this.labels[n].showElement();return this}});JXG$1.createTicks=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"ticks");if(t.length<2?u=d.ticksdistance:u=t[1],t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].elementClass===Const.OBJECT_CLASS_CURVE)r=new JXG$1.Ticks(t[0],u,d);else throw new Error("JSXGraph: Can't create Ticks with parent types '"+typeof t[0]+"'.");return JXG$1.isFunction(d.generatelabelvalue)&&(r.generateLabelText=d.generatelabelvalue),JXG$1.isFunction(d.generatelabeltext)&&(r.generateLabelText=d.generatelabeltext),r.setParents(t[0]),r.isDraggable=!0,r.fullUpdate(t[0].visPropCalc.visible),r};JXG$1.createHatchmark=function(n,t,o){var r,u,d,C,I,f,A=[],G=JXG$1.copyAttributes(o,n.options,"hatch");if(t[0].elementClass!==Const.OBJECT_CLASS_LINE&&t[0].elementClass!==Const.OBJECT_CLASS_CURVE||typeof t[1]!="number")throw new Error("JSXGraph: Can't create Hatch mark with parent types '"+typeof t[0]+"' and '"+typeof t[1]+" and ''"+typeof t[2]+"'.");for(r=t[1],C=G.ticksdistance,I=(r-1)*C,d=-I*.5,u=0;u<r;u++)A[u]=d+u*C;return f=n.create("ticks",[t[0],A],G),f.elType="hatch",t[0].inherits.push(f),f};JXG$1.registerElement("ticks",JXG$1.createTicks);JXG$1.registerElement("hash",JXG$1.createHatchmark);JXG$1.registerElement("hatch",JXG$1.createHatchmark);JXG$1.Ticks;var bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],NAMEMAX=256;JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Unzip=function(n){var t,o,r,u,d=[],C=0,I=[],f=new Array(32768),A=0,G=!1,B=n.length,Z=0,w=1,V=new Array(288),Y=new Array(32),J=0,T=null,L=0,z=new Array(17),K=[];z[0]=0;function P(){return Z<B?n[Z++]:-1}function $(){w=1}function ie(){var xe;try{xe=w&1,w>>=1,w===0&&(w=P(),xe=w&1,w=w>>1|128)}catch(ge){throw console.log("Probably problems on iOS7 with >>"),ge}return xe}function ne(xe){var ge=0,de=xe;try{for(;de--;)ge=ge<<1|ie();xe&&(ge=bitReverse[ge]>>8-xe)}catch(ve){throw console.log("Probably problems on iOS7 with >>"),ve}return ge}function ee(){A=0}function se(xe){f[A++]=xe,d.push(String.fromCharCode(xe)),A===32768&&(A=0)}function re(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1}function ce(){for(var xe=!0;xe;){if(z[L]>=u)return-1;if(r[z[L]]===L)return z[L]++;z[L]++}}function ue(){var xe=T[J],ge;if(L===17)return-1;if(J++,L++,ge=ce(),ge>=0)xe.b0=ge;else if(xe.b0=32768,ue())return-1;if(ge=ce(),ge>=0)xe.b1=ge,xe.jump=null;else if(xe.b1=32768,xe.jump=T[J],xe.jumppos=J,ue())return-1;return L--,0}function ye(xe,ge,de,ve){var le;for(T=xe,J=0,r=de,u=ge,le=0;le<17;le++)z[le]=0;return L=0,ue()?-1:0}function Se(xe){for(var ge,de,ve,le=!0,Ae=0,Xe=xe[Ae];le;)if(ve=ie(),ve){if(!(Xe.b1&32768))return Xe.b1;for(Xe=Xe.jump,ge=xe.length,de=0;de<ge;de++)if(xe[de]===Xe){Ae=de;break}}else{if(!(Xe.b0&32768))return Xe.b0;Ae++,Xe=xe[Ae]}}function Ce(){var xe,ge,de,ve,le,Ae,Xe,Te,Ne,We,dt,nt,Rt,Qe,Oe,be,yt=!0;do if(xe=ie(),de=ne(2),de===0)for($(),We=P(),We|=P()<<8,nt=P(),nt|=P()<<8,(We^~nt)&65535&&JXG$1.debug(`BlockLen checksum mismatch
`);We--;)ge=P(),se(ge);else if(de===1)for(;yt;)if(le=bitReverse[ne(7)]>>1,le>23?(le=le<<1|ie(),le>199?(le-=128,le=le<<1|ie()):(le-=48,le>143&&(le=le+136))):le+=256,le<256)se(le);else{if(le===256)break;for(le-=257,Ne=ne(cplext[le])+cplens[le],le=bitReverse[ne(5)]>>3,cpdext[le]>8?(dt=ne(8),dt|=ne(cpdext[le]-8)<<8):dt=ne(cpdext[le]),dt+=cpdist[le],le=0;le<Ne;le++)ge=f[A-dt&32767],se(ge)}else if(de===2){for(Xe=new Array(320),Qe=257+ne(5),Oe=1+ne(5),be=4+ne(4),le=0;le<19;le++)Xe[le]=0;for(le=0;le<be;le++)Xe[border[le]]=ne(3);for(Ne=Y.length,ve=0;ve<Ne;ve++)Y[ve]=new re;if(ye(Y,19,Xe))return ee(),1;for(Rt=Qe+Oe,ve=0;ve<Rt;)if(le=Se(Y),le<16)Xe[ve++]=le;else if(le===16){if(le=3+ne(2),ve+le>Rt)return ee(),1;for(Ae=ve?Xe[ve-1]:0;le--;)Xe[ve++]=Ae}else{if(le===17?le=3+ne(3):le=11+ne(7),ve+le>Rt)return ee(),1;for(;le--;)Xe[ve++]=0}for(Ne=V.length,ve=0;ve<Ne;ve++)V[ve]=new re;if(ye(V,Qe,Xe))return ee(),1;for(Ne=V.length,ve=0;ve<Ne;ve++)Y[ve]=new re;for(Te=[],ve=Qe;ve<Xe.length;ve++)Te[ve-Qe]=Xe[ve];if(ye(Y,Oe,Te))return ee(),1;for(;yt;)if(le=Se(V),le>=256){if(le-=256,le===0)break;for(le-=1,Ne=ne(cplext[le])+cplens[le],le=Se(Y),cpdext[le]>8?(dt=ne(8),dt|=ne(cpdext[le]-8)<<8):dt=ne(cpdext[le]),dt+=cpdist[le];Ne--;)ge=f[A-dt&32767],se(ge)}else se(le)}while(!xe);return ee(),$(),0}function Ze(){var xe,ge,de,ve,le,Ae,Xe,Te,Ne=[];try{if(d=[],G=!1,Ne[0]=P(),Ne[1]=P(),Ne[0]===120&&Ne[1]===218&&(Ce(),I[C]=[d.join(""),"geonext.gxt"],C++),Ne[0]===31&&Ne[1]===139&&(Be(),I[C]=[d.join(""),"file"],C++),Ne[0]===80&&Ne[1]===75){if(G=!0,Ne[2]=P(),Ne[3]=P(),Ne[2]===3&&Ne[3]===4){for(Ne[0]=P(),Ne[1]=P(),t=P(),t|=P()<<8,Te=P(),Te|=P()<<8,P(),P(),P(),P(),Xe=P(),Xe|=P()<<8,Xe|=P()<<16,Xe|=P()<<24,Ae=P(),Ae|=P()<<8,Ae|=P()<<16,Ae|=P()<<24,le=P(),le|=P()<<8,le|=P()<<16,le|=P()<<24,ve=P(),ve|=P()<<8,de=P(),de|=P()<<8,xe=0,K=[];ve--;)ge=P(),ge==="/"|ge===":"?xe=0:xe<NAMEMAX-1&&(K[xe++]=String.fromCharCode(ge));for(o||(o=K),xe=0;xe<de;)ge=P(),xe++;if(Te===8&&(Ce(),I[C]=new Array(2),I[C][0]=d.join(""),I[C][1]=K.join(""),C++),Be())return!1}return!0}}catch(We){throw console.log("Probably problems on iOS7 with >>"),We}return!1}function Be(){var xe,ge,de,ve,le,Ae=[];if(t&8&&(Ae[0]=P(),Ae[1]=P(),Ae[2]=P(),Ae[3]=P(),Ae[0]===80&&Ae[1]===75&&Ae[2]===7&&Ae[3]===8?(xe=P(),xe|=P()<<8,xe|=P()<<16,xe|=P()<<24):xe=Ae[0]|Ae[1]<<8|Ae[2]<<16|Ae[3]<<24,ge=P(),ge|=P()<<8,ge|=P()<<16,ge|=P()<<24,de=P(),de|=P()<<8,de|=P()<<16,de|=P()<<24),G&&Ze())return!1;if(Ae[0]=P(),Ae[0]!==8)return!0;if(t=P(),P(),P(),P(),P(),P(),P(),t&4)for(Ae[0]=P(),Ae[2]=P(),L=Ae[0]+256*Ae[1],ve=0;ve<L;ve++)P();if(t&8)for(ve=0,K=[],le=P();le;)(le==="7"||le===":")&&(ve=0),ve<NAMEMAX-1&&(K[ve++]=le),le=P();if(t&16)for(le=P();le;)le=P();return t&2&&(P(),P()),Ce(),xe=P(),xe|=P()<<8,xe|=P()<<16,xe|=P()<<24,de=P(),de|=P()<<8,de|=P()<<16,de|=P()<<24,G&&Ze(),!1}JXG$1.Util.Unzip.prototype.unzipFile=function(xe){var ge;for(this.unzip(),ge=0;ge<I.length;ge++)if(I[ge][1]===xe)return I[ge][0];return""},JXG$1.Util.Unzip.prototype.unzip=function(){return Ze(),I}};JXG$1.Util;JXG$1.CA=function(n,t,o){this.node=n,this.createNode=t,this.parser=o};JXG$1.extend(JXG$1.CA.prototype,{findMapNode:function(n,t){var o,r,u;if(t.value==="op_assign"&&t.children[0].value===n)return t.children[1];if(t.children){for(r=t.children.length,o=0;o<r;++o)if(u=this.findMapNode(n,t.children[o]),u!==null)return u}return null},setMath:function(n){var t,o;if((n.type=="node_op"&&(n.value=="op_add"||n.value=="op_sub"||n.value=="op_mul"||n.value=="op_div"||n.value=="op_neg"||n.value=="op_execfun"||n.value=="op_exp")||n.type=="node_var"||n.type=="node_const")&&(n.isMath=!0),n.children)for(o=n.children.length,t=0;t<o;++t)this.setMath(n.children[t])},deriveElementary:function(n,t){var o=n.children[0].value,r=n.children[1],u;switch(o){case"abs":u=this.createNode("node_op","op_div",r[0],this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0]))]));break;case"sqrt":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_mul",this.createNode("node_const",2),this.createNode(n.type,n.value,JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1]))));break;case"sin":u=this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(r));break;case"cos":u=this.createNode("node_op","op_neg",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(r)));break;case"tan":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(r)),this.createNode("node_const",2)));break;case"cot":u=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(r)),this.createNode("node_const",2))));break;case"exp":u=this.createNode(n.type,n.value,JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1]));break;case"pow":u=this.createNode("node_op","op_mul",this.createNode("node_op","op_execfun",JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1])),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(n.children[1][0],t),this.createNode("node_op","op_div",JXG$1.deepCopy(n.children[1][1]),JXG$1.deepCopy(n.children[1][0]))),this.createNode("node_op","op_mul",this.derivative(n.children[1][1],t),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(n.children[1][0])]))));break;case"log":case"ln":u=this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(r[0]));break;case"log2":case"lb":case"ld":u=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(r[0])),this.createNode("node_const",1.4426950408889634));break;case"log10":case"lg":u=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(r[0])),this.createNode("node_const",.43429448190325176));break;case"asin":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0])))]));break;case"acos":u=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0])))])));break;case"atan":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0]))));break;case"acot":u=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0])))));break;case"sinh":u=this.createNode("node_op","op_execfun",this.createNode("node_var","cosh"),[JXG$1.deepCopy(r[0])]);break;case"cosh":u=this.createNode("node_op","op_execfun",this.createNode("node_var","sinh"),[JXG$1.deepCopy(r[0])]);break;case"tanh":u=this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","tanh"),[JXG$1.deepCopy(r[0])]),this.createNode("node_const",2)));break;case"asinh":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0])),this.createNode("node_const",1))]));break;case"acosh":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0])),this.createNode("node_const",1))]));break;case"atanh":u=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(r[0]),JXG$1.deepCopy(r[0]))));break;default:throw u=this.createNode("node_const",0),console.log('Derivative of "'+o+'" not yet implemented'),new Error("Error("+this.line+"): ")}return u},derivative:function(n,t){var o;switch(n.type){case"node_op":switch(n.value){case"op_execfun":n.children[0].value=="pow"?o=this.deriveElementary(n,t):n.children[1].length===0?o=this.createNode("node_const",0):o=this.createNode("node_op","op_mul",this.deriveElementary(n,t),this.derivative(n.children[1][0],t));break;case"op_div":o=this.createNode("node_op","op_div",this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",this.derivative(n.children[0],t),JXG$1.deepCopy(n.children[1])),this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[0]),this.derivative(n.children[1],t))),this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[1]),JXG$1.deepCopy(n.children[1])));break;case"op_mul":o=this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[0]),this.derivative(n.children[1],t)),this.createNode("node_op","op_mul",this.derivative(n.children[0],t),JXG$1.deepCopy(n.children[1])));break;case"op_neg":o=this.createNode("node_op","op_neg",this.derivative(n.children[0],t));break;case"op_add":case"op_sub":o=this.createNode("node_op",n.value,this.derivative(n.children[0],t),this.derivative(n.children[1],t));break;case"op_exp":o=this.createNode("node_op","op_mul",JXG$1.deepCopy(n),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(n.children[0],t),this.createNode("node_op","op_div",JXG$1.deepCopy(n.children[1]),JXG$1.deepCopy(n.children[0]))),this.createNode("node_op","op_mul",this.derivative(n.children[1],t),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(n.children[0])]))));break}break;case"node_var":n.value===t?o=this.createNode("node_const",1):o=this.createNode("node_const",0);break;case"node_const":o=this.createNode("node_const",0);break}return o},expandDerivatives:function(n,t,o){var r,u,d,C,I,f,A,G,B,Z,w,V,Y;if(f=0,!n)return f;for(this.line=n.line,this.col=n.col,r=n.children.length,u=0;u<r;++u)if(n.children[u]&&n.children[u].type)n.children[u]=this.expandDerivatives(n.children[u],n,o);else if(JXG$1.isArray(n.children[u]))for(d=0;d<n.children[u].length;++d)n.children[u][d]&&n.children[u][d].type&&(n.children[u][d]=this.expandDerivatives(n.children[u][d],n,o));switch(n.type){case"node_op":switch(n.value){case"op_execfun":if(n.children[0]&&n.children[0].value==="D"){if(Y=!1,n.children[1][0].type=="node_var"&&(B=n.children[1][0].value,C=this.findMapNode(B,o),C!==null&&(Y=!0)),Y?(w=C.children[0],n.children[1].length>=2?Z=n.children[1][1].value:Z=C.children[0][0],I=C.children[1]):(I=n.children[1][0],w=["x"],n.children[1].length>=2?Z=n.children[1][1].value:Z="x"),n.children[1].length>=3?V=n.children[1][2].value:V=1,G=I,V>=1)for(;V>=1;)G=this.derivative(G,Z),G=this.removeTrivialNodes(G),V--;t.type=="node_op"&&t.value=="op_assign"?A=this.createNode("node_op","op_map",w,G):A=G,this.setMath(A),n.type=A.type,n.value=A.value,A.children.length>0&&(n.children[0]=A.children[0]),A.children.length>1&&(n.children[1]=A.children[1])}}break}return n},removeTrivialNodes:function(n){var t,o,r,u,d;if(JXG$1.isArray(n))for(o=n.length,t=0;t<o;++t)n[t]=this.removeTrivialNodes(n[t]);if(n.type!="node_op"||!n.children)return n;for(o=n.children.length,t=0;t<o;++t){this.mayNotBeSimplified=!1;do n.children[t]=this.removeTrivialNodes(n.children[t]);while(this.mayNotBeSimplified)}switch(n.value){case"op_map":if(r=n.children[0],u=n.children[1],u.type=="node_var"){for(t=0;t<r.length;++t)if(r[t]==u.value){u.isMath=!0;break}}break;case"op_add":if(r=n.children[0],u=n.children[1],r.type=="node_const"&&r.value===0)return u;if(u.type=="node_const"&&u.value===0)return r;if(r.type=="node_const"&&u.type=="node_const")return r.value+=u.value,r;break;case"op_mul":if(r=n.children[0],u=n.children[1],r.type=="node_const"&&r.value==1)return u;if(u.type=="node_const"&&u.value==1||r.type=="node_const"&&r.value===0)return r;if(u.type=="node_const"&&u.value===0||u.type=="node_const"&&u.value===0)return u;if(r.type=="node_op"&&r.value=="op_neg"&&u.type=="node_op"&&u.value=="op_neg")return n.children=[r.children[0],u.children[0]],this.mayNotBeSimplified=!0,n;if(r.value=="op_neg"&&u.value!="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_mul",r.children[0],u)],this.mayNotBeSimplified=!0,n;if(r.value!="op_neg"&&u.value=="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_mul",r,u.children[0])],this.mayNotBeSimplified=!0,n;if(r.value=="op_div"&&r.children[0].type=="node_const"&&r.children[0].value==1)return n.type="node_op",n.value="op_div",n.children=[u,r.children[1]],this.mayNotBeSimplified=!0,n;if(u.value=="op_div"&&u.children[0].type=="node_const"&&u.children[0].value==1)return n.type="node_op",n.value="op_div",n.children=[r,u.children[1]],this.mayNotBeSimplified=!0,n;if(r.type!="node_const"&&u.type=="node_const")return n.children=[u,r],this.mayNotBeSimplified=!0,n;if(r.type!="node_const"&&u.type=="node_op"&&u.value=="op_neg"&&u.children[0].type=="node_const")return n.children=[u,r],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value!="op_execfun"&&(u.type=="node_var"||u.type=="node_op"&&u.value=="op_execfun"))return n.children=[u,r],this.mayNotBeSimplified=!0,n;if(r.type!="node_op"&&u.type=="node_op"&&u.value=="op_neg"&&u.children[0].type=="node_var")return n.children=[u,r],this.mayNotBeSimplified=!0,n;if(r.type!="node_const"&&u.type=="node_op"&&(u.value=="op_mul"||u.value=="op_div")&&u.children[0].type=="node_const")return d=u.children[0],u.children[0]=r,n.children=[d,u],this.mayNotBeSimplified=!0,n;if(u.type!="node_const"&&r.type=="node_op"&&r.value=="op_mul"&&r.children[0].type=="node_const")return n.children=[r.children[0],this.createNode("node_op","op_mul",r.children[1],u)],this.mayNotBeSimplified=!0,n;if(r.type=="node_const"&&u.type=="node_const")return r.value*=u.value,r;if(r.type=="node_const"&&u.type=="node_op"&&(u.value=="op_mul"||u.value=="op_div")&&u.children[0].type=="node_const")return u.children[0].value*=r.value,u;if(r.hash=this.parser.compile(r),u.hash=this.parser.compile(u),r.hash===u.hash)return n.value="op_exp",n.children[1]=this.createNode("node_const",2),n;if(r.type=="node_const"&&u.type=="node_op"&&(u.value=="op_mul"||u.value=="op_div")&&u.children[0].type=="node_const")return u.children[0].value*=r.value,u;if(u.type=="node_op"&&u.value=="op_exp"&&(r.hash||(r.hash=this.parser.compile(r)),u.children[0].hash||(u.children[0].hash=this.parser.compile(u.children[0])),r.hash===u.children[0].hash))return u.children[1]=this.createNode("node_op","op_add",u.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,u;if(r.type=="node_op"&&r.value=="op_exp"&&u.type=="node_op"&&u.value=="op_exp"&&(r.children[0].hash=this.parser.compile(r.children[0]),u.children[0].hash=this.parser.compile(u.children[0]),r.children[0].hash===u.children[0].hash))return r.children[1]=this.createNode("node_op","op_add",r.children[1],u.children[1]),this.mayNotBeSimplified=!0,r;break;case"op_sub":if(r=n.children[0],u=n.children[1],r.type=="node_const"&&r.value===0)return n.value="op_neg",n.children[0]=u,n;if(u.type=="node_const"&&u.value===0)return r;if(r.type=="node_const"&&u.type=="node_const"&&r.value==u.value)return this.createNode("node_const",0);if(r.type=="node_var"&&u.type=="node_var"&&r.value==u.value)return this.createNode("node_const",0);if(r.type=="node_const"&&u.type=="node_const")return r.value-=u.value,r;if(r.type=="node_op"&&r.value=="op_mul"&&u.type=="node_op"&&u.value=="op_mul"&&(r.children[1].hash=this.parser.compile(r.children[1]),u.children[1].hash=this.parser.compile(u.children[1]),r.children[1].hash===u.children[1].hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",r.children[0],u.children[0]),r.children[1]],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value=="op_mul"&&(r.children[1].hash=this.parser.compile(r.children[1]),u.hash=this.parser.compile(u),r.children[1].hash===u.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",r.children[0],this.createNode("node_const",1)),u],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),r.hash=this.parser.compile(r),u.children[1].hash===r.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",this.createNode("node_const",1),u.children[0]),r],this.mayNotBeSimplified=!0,n;break;case"op_neg":if(r=n.children[0],r.type=="node_const"&&r.value===0)return r;if(r.type=="node_op"&&r.value=="op_neg")return r.children[0];break;case"op_div":if(r=n.children[0],u=n.children[1],r.type=="node_const"&&u.type=="node_const"&&r.value==u.value&&r.value!==0)return r.value=1,r;if(r.type=="node_const"&&r.value===0&&u.type=="node_const"&&u.value!==0)return r.value=0,r;if(r.type=="node_const"&&r.value===0&&(u.type=="node_op"||u.type=="node_var"))return n.type="node_const",n.value=0,n;if(r.type=="node_var"&&u.type=="node_var"&&r.value==u.value)return this.createNode("node_const",1);if(r.type=="node_const"&&r.value!==0&&u.type=="node_const"&&u.value===0)return r.value>0?r.value=1/0:r.value=-1/0,r;if(r.type=="node_op"&&r.value=="op_neg"&&u.type=="node_op"&&u.value=="op_neg")return n.children=[r.children[0],u.children[0]],this.mayNotBeSimplified=!0,n;if(r.value=="op_neg"&&u.value!="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_div",r.children[0],u)],this.mayNotBeSimplified=!0,n;if(r.value!="op_neg"&&u.value=="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_div",r,u.children[0])],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value=="op_exp"&&(u.hash||(u.hash=this.parser.compile(u)),r.children[0].hash||(r.children[0].hash=this.parser.compile(r.children[0])),u.hash===r.children[0].hash))return r.children[1]=this.createNode("node_op","op_sub",r.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,r;if(u.type!="node_const"&&r.type=="node_op"&&r.value=="op_mul"&&r.children[0].type=="node_const")return n.value="op_mul",n.children=[r.children[0],this.createNode("node_op","op_div",r.children[1],u)],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value=="op_exp"&&u.type=="node_op"&&u.value=="op_exp"&&(r.children[0].hash=this.parser.compile(r.children[0]),u.children[0].hash=this.parser.compile(u.children[0]),r.children[0].hash===u.children[0].hash))return r.children[1]=this.createNode("node_op","op_sub",r.children[1],u.children[1]),this.mayNotBeSimplified=!0,r;break;case"op_exp":if(r=n.children[0],u=n.children[1],u.type=="node_const"&&u.value===0)return u.value=1,u;if(u.type=="node_const"&&u.value==1||r.type=="node_const"&&r.value==1||r.type=="node_const"&&r.value===0&&u.type=="node_const"&&u.value!==0)return r;if(r.type=="node_op"&&r.value=="op_exp")return n.children=[r.children[0],this.createNode("node_op","op_mul",r.children[1],u)],n;break}switch(n.value){case"op_add":if(r=n.children[0],u=n.children[1],r.type=="node_const"&&u.type=="node_const"&&r.value==u.value)return r.value+=u.value,r;if(r.type=="node_var"&&u.type=="node_var"&&r.value==u.value)return n.children[0]=this.createNode("node_const",2),n.value="op_mul",n;if(r.type=="node_op"&&r.value=="op_neg")return n.value="op_sub",n.children[0]=u,n.children[1]=r.children[0],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_neg")return n.value="op_sub",n.children[1]=u.children[0],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value=="op_mul"&&u.type=="node_op"&&u.value=="op_mul"&&(r.children[1].hash=this.parser.compile(r.children[1]),u.children[1].hash=this.parser.compile(u.children[1]),r.children[1].hash===u.children[1].hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",r.children[0],u.children[0]),r.children[1]],this.mayNotBeSimplified=!0,n;if(r.type=="node_op"&&r.value=="op_mul"&&(r.children[1].hash=this.parser.compile(r.children[1]),u.hash=this.parser.compile(u),r.children[1].hash===u.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",r.children[0],this.createNode("node_const",1)),u],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),r.hash=this.parser.compile(r),u.children[1].hash===r.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",this.createNode("node_const",1),u.children[0]),r],this.mayNotBeSimplified=!0,n;break;case"op_sub":if(r=n.children[0],u=n.children[1],u.type=="node_op"&&u.value=="op_neg")return n.value="op_add",n.children[1]=u.children[0],this.mayNotBeSimplified=!0,n;break;case"op_execfun":return this.simplifyElementary(n)}return n},simplifyElementary:function(n){var t=n.children[0].value,o=n.children[1];if(o.length==0)return n;switch(t){case"sin":case"tan":if(o[0].type=="node_const"&&o[0].value===0||o[0].type=="node_var"&&o[0].value=="PI"||o[0].type=="node_op"&&o[0].value=="op_mul"&&o[0].children[0].type=="node_const"&&o[0].children[0].value%1===0&&o[0].children[1].type=="node_var"&&o[0].children[1].value=="PI")return n.type="node_const",n.value=0,n;break;case"cos":if(o[0].type=="node_const"&&o[0].value===0)return n.type="node_const",n.value=1,n;if(o[0].type=="node_var"&&o[0].value=="PI")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_const",1)],n;break;case"exp":if(o[0].type=="node_const"&&o[0].value===0)return n.type="node_const",n.value=1,n;break;case"pow":if(o[1].type=="node_const"&&o[1].value===0)return n.type="node_const",n.value=1,n;break}return n}});JXG$1.CA;JXG$1.Dump={addMarkers:function(n,t,o){var r,u,d;JXG$1.isArray(t)||(t=[t]),JXG$1.isArray(o)||(o=[o]),u=Math.min(t.length,o.length),t.length=u,o.length=u;for(r in n.objects)if(n.objects.hasOwnProperty(r))for(d=0;d<u;d++)n.objects[r][t[d]]=o[d]},deleteMarkers:function(n,t){var o,r,u;JXG$1.isArray(t)||(t=[t]),r=t.length,t.length=r;for(o in n.objects)if(n.objects.hasOwnProperty(o))for(u=0;u<r;u++)delete n.objects[o][t[u]]},str:function(n){return typeof n=="string"&&n.slice(0,7)!=="function"&&(n='"'+n+'"'),n},minimizeObject:function(n,t){var o,r,u,d={},C=JXG$1.deepCopy(n),I=[];for(u=1;u<arguments.length;u++)I.push(arguments[u]);for(d=JXG$1.deepCopy(d,JXG$1.Options.elements,!0),u=I.length;u>0;u--)d=JXG$1.deepCopy(d,I[u-1],!0);for(o in d)d.hasOwnProperty(o)&&(r=o.toLowerCase(),typeof d[o]!="object"&&d[o]===C[r]&&delete C[r]);return C},prepareAttributes:function(n,t){var o,r;o=this.minimizeObject(t.getAttributes(),JXG$1.Options[t.elType]);for(r in t.subs)t.subs.hasOwnProperty(r)&&(o[r]=this.minimizeObject(t.subs[r].getAttributes(),JXG$1.Options[t.elType][r],JXG$1.Options[t.subs[r].elType]),o[r].id=t.subs[r].id,o[r].name=t.subs[r].name);return o.id=t.id,o.name=t.name,o},setBoundingBox:function(n,t,o){return n.push({obj:o,method:"setBoundingBox",params:[t.getBoundingBox(),t.keepaspectratio]}),n},dump:function(n){var t,o,r,u,d=[],C=[],I=[],f=n.objectsList.length;for(this.addMarkers(n,"dumped",!1),t=0;t<f;t++)if(o=n.objectsList[t],r={},!o.dumped&&o.dump){for(r.type=o.getType(),r.parents=o.getParents().slice(),r.type==="point"&&r.parents[0]===1&&(r.parents=r.parents.slice(1)),u=0;u<r.parents.length;u++)JXG$1.isString(r.parents[u])&&r.parents[u][0]!=="'"&&r.parents[u][0]!=='"'?r.parents[u]='"'+r.parents[u]+'"':JXG$1.isArray(r.parents[u])&&(r.parents[u]="["+r.parents[u].toString()+"]");r.attributes=this.prepareAttributes(n,o),r.type==="glider"&&o.onPolygon&&d.push({obj:o.id,prop:"onPolygon",val:!0}),I.push(r)}return this.deleteMarkers(n,"dumped"),{elements:I,props:d,methods:C}},arrayToParamStr:function(n,t){var o,r=[];for(o=0;o<n.length;o++)r.push(t.call(this,n[o]));return r.join(", ")},toJCAN:function(n){var t,o,r;switch(typeof n){case"object":if(n){if(o=[],JXG$1.isArray(n)){for(t=0;t<n.length;t++)o.push(this.toJCAN(n[t]));return"["+o.join(",")+"]"}for(r in n)n.hasOwnProperty(r)&&o.push(r+": "+this.toJCAN(n[r]));return"<<"+o.join(", ")+">> "}return"null";case"string":return"'"+n.replace(/\\/g,"\\\\").replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return n.toString();case"null":return"null"}},toJessie:function(n){var t,o,r,u=this.dump(n),d=[];for(u.methods=this.setBoundingBox(u.methods,n,"$board"),o=u.elements,t=0;t<o.length;t++)o[t].attributes.name.length>0&&d.push("// "+o[t].attributes.name),d.push("s"+t+" = "+o[t].type+"("+o[t].parents.join(", ")+") "+this.toJCAN(o[t].attributes).replace(/\n/,"\\n")+";"),o[t].type==="axis"&&(r=o[t].attributes.id,n.objects[r].defaultTicks===null&&d.push("s"+t+".removeAllTicks();")),d.push("");for(t=0;t<u.methods.length;t++)d.push(u.methods[t].obj+"."+u.methods[t].method+"("+this.arrayToParamStr(u.methods[t].params,this.toJCAN)+");"),d.push("");for(t=0;t<u.props.length;t++)d.push(u.props[t].obj+"."+u.props[t].prop+" = "+this.toJCAN(u.props[t].val)+";"),d.push("");return d.join(`
`)},toJavaScript:function(n){var t,o,r,u=this.dump(n),d=[];for(u.methods=this.setBoundingBox(u.methods,n,"board"),o=u.elements,t=0;t<o.length;t++)d.push('board.create("'+o[t].type+'", ['+o[t].parents.join(", ")+"], "+JXG$1.toJSON(o[t].attributes)+");"),o[t].type==="axis"&&(r=o[t].attributes.id,n.objects[r].defaultTicks===null&&d.push('board.objects["'+r+'"].removeTicks(board.objects["'+r+'"].defaultTicks);'));for(t=0;t<u.methods.length;t++)d.push(u.methods[t].obj+"."+u.methods[t].method+"("+this.arrayToParamStr(u.methods[t].params,JXG$1.toJSON)+");"),d.push("");for(t=0;t<u.props.length;t++)d.push(u.props[t].obj+"."+u.props[t].prop+" = "+JXG$1.toJSON(u.props[t].val)+";"),d.push("");return d.join(`
`)}};JXG$1.Dump;JXG$1.createComb=function(n,t,o){var r,u,d,C,I;if(t.length===2){if(JXG$1.isArray(t[0])&&t[0].length>1)C=JXG$1.copyAttributes(o,n.options,"comb","point1"),r=n.create("point",t[0],C);else if(JXG$1.isString(t[0])||JXG$1.isPoint(t[0]))r=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))r=t[0]();else if(JXG$1.isFunction(t[0])&&t[0]().length&&t[0]().length>=2)C=JXG$1.copyAttributes(o,n.options,"comb","point1"),r=JXG$1.createPoint(n,t[0](),C);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);if(JXG$1.isArray(t[1])&&t[1].length>1)C=JXG$1.copyAttributes(o,n.options,"comb","point2"),u=n.create("point",t[1],C);else if(JXG$1.isString(t[1])||JXG$1.isPoint(t[1]))u=n.select(t[1]);else if(JXG$1.isFunction(t[1])&&JXG$1.isPoint(t[1]()))u=t[1]();else if(JXG$1.isFunction(t[1])&&t[1]().length&&t[1]().length>=2)C=JXG$1.copyAttributes(o,n.options,"comb","point2"),u=JXG$1.createPoint(n,t[1](),C);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}else throw I=t.map(function(f){return"'"+typeof f+"'"}),new Error("JSXGraph: Can't create comb with parent types "+I.join(", ")+`.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);return C=JXG$1.copyAttributes(o,n.options,"comb"),d=n.create("curve",[[0],[0]],C),d.updateDataArray=function(){var f=0,A=r.Dist(u),G,B,Z,w,V,Y,J,T=r,L=u,z,K,P;for(z=JXG$1.evaluate(d.visProp.frequency),K=-JXG$1.evaluate(d.visProp.angle),P=JXG$1.evaluate(d.visProp.width),JXG$1.evaluate(d.visProp.reverse)&&(T=u,L=r,K=-K),G=Math.cos(K),B=Math.sin(K),Z=(L.X()-T.X())/A,w=(L.Y()-T.Y())/A,G*=P/Math.abs(B),B*=P/Math.abs(B),this.dataX=[],this.dataY=[];f<A;)V=T.X()+Z*f,Y=T.Y()+w*f,J=Math.min(G,A-f)/Math.abs(G),B*=J,G*=J,this.dataX.push(V),this.dataY.push(Y),this.dataX.push(V+Z*G+w*B),this.dataY.push(Y-Z*B+w*G),this.dataX.push(NaN),this.dataY.push(NaN),f+=z},d};JXG$1.registerElement("comb",JXG$1.createComb);var priv$3={removeSlopeTriangle:function(){Polygon.prototype.remove.call(this),this.board.removeObject(this.toppoint),this.board.removeObject(this.glider),this.board.removeObject(this.baseline),this.board.removeObject(this.basepoint),this.board.removeObject(this.label),this._isPrivateTangent&&this.board.removeObject(this.tangent)},Value:function(){return this.tangent.getSlope()},Direction:function(){return this.tangent.Direction()}};JXG$1.createSlopeTriangle=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z=!1;if(t.length===1&&t[0].type===Const.OBJECT_TYPE_TANGENT)u=t[0],d=u.glider;else if(t.length===1&&t[0].type===Const.OBJECT_TYPE_GLIDER)d=t[0],B=JXG$1.copyAttributes(o,n.options,"slopetriangle","tangent"),u=n.create("tangent",[d],B),Z=!0;else if(t.length===2&&t[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(t[1]))u=t[0],d=t[1];else throw new Error("JSXGraph: Can't create slope triangle with parent types '"+typeof t[0]+"'.");return B=JXG$1.copyAttributes(o,n.options,"slopetriangle","basepoint"),A=n.create("point",[function(){return[d.X()+1,d.Y()]}],B),B=JXG$1.copyAttributes(o,n.options,"slopetriangle","baseline"),f=n.create("line",[d,A],B),B=JXG$1.copyAttributes(o,n.options,"slopetriangle","glider"),C=n.create("glider",[d.X()+1,d.Y(),f],B),B=JXG$1.copyAttributes(o,n.options,"slopetriangle","toppoint"),I=n.create("point",[function(){return[C.X(),C.Y()+(C.X()-d.X())*u.getSlope()]}],B),B=JXG$1.copyAttributes(o,n.options,"slopetriangle"),r=n.create("polygon",[d,C,I],B),r.Value=priv$3.Value,r.Direction=priv$3.Direction,r.tangent=u,r._isPrivateTangent=Z,r.borders[2].setArrow(!1,!1),B=JXG$1.copyAttributes(o,n.options,"slopetriangle","label"),B=JXG$1.copyAttributes(B,n.options,"label"),B.isLabel=!0,B.anchor=r.borders[1],B.priv=r.borders[1].visProp.priv,B.id=r.borders[1].id+"Label",G=n.create("text",[0,0,function(){return""}],B),G.needsUpdate=!0,G.dump=!1,r.borders[1].label=G,r.borders[1].hasLabel=!0,r.borders[1].visProp.withlabel=!0,G._setText(function(){var w=JXG$1.evaluate(G.visProp.digits);return G.useLocale()?G.formatNumberLocale(r.Value(),w):JXG$1.toFixed(r.Value(),w)}),G.fullUpdate(),r.glider=C,r.basepoint=A,r.baseline=f,r.toppoint=I,r.label=G,r.subs={glider:C,basePoint:A,baseLine:f,topPoint:I,label:G},r.inherits.push(C,A,f,I,G),r.methodMap=JXG$1.deepCopy(r.methodMap,{tangent:"tangent",glider:"glider",basepoint:"basepoint",baseline:"baseline",toppoint:"toppoint",label:"label",Value:"Value",V:"Value",Direction:"Direction"}),r.remove=priv$3.removeSlopeTriangle,r};JXG$1.registerElement("slopetriangle",JXG$1.createSlopeTriangle);var priv$2={CheckboxChangeEventHandler:function(){this._value=this.rendNodeCheckbox.checked,this.board.update()}};JXG$1.createCheckbox=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"checkbox");return u=[t[0],t[1],'<span style="display:inline"><input type="checkbox" /><label for=""></label></span>'],r=n.create("text",u,d),r.type=JXG$1.OBJECT_TYPE_CHECKBOX,r.rendNodeCheckbox=r.rendNode.childNodes[0].childNodes[0],r.rendNodeLabel=r.rendNode.childNodes[0].childNodes[1],r.rendNodeTag=r.rendNodeCheckbox,r.rendNodeTag.disabled=!!d.disabled,r.rendNodeCheckbox.id=r.rendNode.id+"_checkbox",r.rendNodeLabel.id=r.rendNode.id+"_label",r.rendNodeLabel.setAttribute("for",r.rendNodeCheckbox.id),r.setText(t[2]),r.visPropOld.fontsize="0px",n.renderer.updateTextStyle(r,!1),r.rendNodeCheckbox.checked=d.checked,r._value=d.checked,r.Value=function(){return this._value},r.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeCheckbox.checked),this},JXG$1.addEvent(r.rendNodeCheckbox,"change",priv$2.CheckboxChangeEventHandler,r),r};JXG$1.registerElement("checkbox",JXG$1.createCheckbox);var priv$1={InputInputEventHandler:function(n){this._value=this.rendNodeInput.value,this.board.update()}};JXG$1.createInput=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"input");return u=[t[0],t[1],'<span style="display:inline; white-space:nowrap; padding:0px;"><span></span><input type="text" maxlength="'+d.maxlength+'" style="width:100%"/></span>'],r=n.create("text",u,d),r.type=JXG$1.OBJECT_TYPE_INPUT,r.rendNodeLabel=r.rendNode.childNodes[0].childNodes[0],r.rendNodeInput=r.rendNode.childNodes[0].childNodes[1],r.rendNodeInput.value=t[2],r.rendNodeTag=r.rendNodeInput,r.rendNodeTag.disabled=!!d.disabled,r.rendNodeLabel.id=r.rendNode.id+"_label",r.rendNodeInput.id=r.rendNode.id+"_input",r.setText(t[3]),r._value=t[2],r.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeInput.value),this},r.Value=function(){return this._value},r.set=function(C){return this._value=C,this.rendNodeInput.value=C,this},JXG$1.addEvent(r.rendNodeInput,"input",priv$1.InputInputEventHandler,r),JXG$1.addEvent(r.rendNodeInput,"mousedown",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),JXG$1.addEvent(r.rendNodeInput,"touchstart",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),JXG$1.addEvent(r.rendNodeInput,"pointerdown",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),r.visPropOld.fontsize="0px",n.renderer.updateTextStyle(r,!1),r};JXG$1.registerElement("input",JXG$1.createInput);var priv={ButtonClickEventHandler:function(){this._handler&&this._handler(),this.board.update()}};JXG$1.createButton=function(n,t,o){var r,u,d=JXG$1.copyAttributes(o,n.options,"button");return u=[t[0],t[1],'<button type="button" style="width:100%;"></button>'],r=n.create("text",u,d),r.type=JXG$1.OBJECT_TYPE_BUTTON,r.rendNodeButton=r.rendNode.childNodes[0],r.rendNodeButton.id=r.rendNode.id+"_button",r.rendNodeTag=r.rendNodeButton,r.rendNodeTag.disabled=!!d.disabled,r.setText(t[2]),r.visPropOld.fontsize="0px",n.renderer.updateTextStyle(r,!1),t[3]&&(JXG$1.isString(t[3])?(r._jc=new JXG$1.JessieCode,r._jc.use(n),r._handler=function(){r._jc.parse(t[3])}):r._handler=t[3]),JXG$1.addEvent(r.rendNodeButton,"click",priv.ButtonClickEventHandler,r),JXG$1.addEvent(r.rendNodeButton,"mousedown",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),JXG$1.addEvent(r.rendNodeButton,"touchstart",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),JXG$1.addEvent(r.rendNodeButton,"pointerdown",function(C){JXG$1.exists(C.stopPropagation)&&C.stopPropagation()},r),r};JXG$1.registerElement("button",JXG$1.createButton);JXG$1.createVectorField=function(n,t,o){var r,u;if(!(t.length>=3&&(JXG$1.isArray(t[0])||JXG$1.isFunction(t[0])||JXG$1.isString(t[0]))&&JXG$1.isArray(t[1])&&t[1].length===3&&JXG$1.isArray(t[2])&&t[2].length===3))throw new Error("JSXGraph: Can't create vector field with parent types '"+typeof t[0]+"', '"+typeof t[1]+"', '"+typeof t[2]+"'.");return u=JXG$1.copyAttributes(o,n.options,"vectorfield"),r=n.create("curve",[[],[]],u),r.elType="vectorfield",r.setF=function(d,C){var I,f;return JXG$1.isArray(d)?(I=JXG$1.createFunction(d[0],this.board,C),f=JXG$1.createFunction(d[1],this.board,C),this.F=function(A,G){return[I(A,G),f(A,G)]}):this.F=JXG$1.createFunction(d,r.board,C),this},r.setF(t[0],"x, y"),r.xData=t[1],r.yData=t[2],r.updateDataArray=function(){var d,C,I,f,A=JXG$1.evaluate(this.visProp.scale),G=JXG$1.evaluate(this.xData[0]),B=JXG$1.evaluate(this.xData[1]),Z=JXG$1.evaluate(this.xData[2]),w=(Z-G)/B,V=JXG$1.evaluate(this.yData[0]),Y=JXG$1.evaluate(this.yData[1]),J=JXG$1.evaluate(this.yData[2]),T=(J-V)/Y,L,z,K,P,$=JXG$1.evaluate(this.visProp.arrowhead.enabled),ie,ne,ee,se;for($&&(ie=JXG$1.evaluate(this.visProp.arrowhead.size),ne=ie/n.unitX,ee=ie/n.unitY,se=JXG$1.evaluate(this.visProp.arrowhead.angle)),this.dataX=[],this.dataY=[],I=0,d=G;I<=B;d+=w,I++)for(f=0,C=V;f<=Y;C+=T,f++)L=this.F(d,C),L[0]*=A,L[1]*=A,JXG$1.concat(this.dataX,[d,d+L[0],NaN]),JXG$1.concat(this.dataY,[C,C+L[1],NaN]),$&&Math.abs(L[0])+Math.abs(L[1])>0&&(z=Math.atan2(L[1],L[0]),K=z+se,P=z-se,JXG$1.concat(this.dataX,[d+L[0]-Math.cos(K)*ne,d+L[0],d+L[0]-Math.cos(P)*ne,NaN]),JXG$1.concat(this.dataY,[C+L[1]-Math.sin(K)*ee,C+L[1],C+L[1]-Math.sin(P)*ee,NaN]))},r.methodMap=JXG$1.deepCopy(r.methodMap,{setF:"setF"}),r};JXG$1.registerElement("vectorfield",JXG$1.createVectorField);JXG$1.createSlopeField=function(n,t,o){var r,u,d;if(!(t.length>=3&&(JXG$1.isFunction(t[0])||JXG$1.isString(t[0]))&&JXG$1.isArray(t[1])&&t[1].length===3&&JXG$1.isArray(t[2])&&t[2].length===3))throw new Error("JSXGraph: Can't create slope field with parent types '"+typeof t[0]+"', '"+typeof t[1]+"', '"+typeof t[2]+"'.");return u=JXG$1.createFunction(t[0],n,"x, y"),t[0]=function(C,I){var f=u(C,I),A=Math.sqrt(1+f*f);return[1/A,f/A]},d=JXG$1.copyAttributes(o,n.options,"slopefield"),r=n.create("vectorfield",t,d),r.elType="slopefield",r.setF=function(C,I){var f=JXG$1.createFunction(C,r.board,I);this.F=function(A,G){var B=f(A,G),Z=Math.sqrt(1+B*B);return[1/Z,B/Z]}},r.methodMap=JXG$1.deepCopy(r.methodMap,{setF:"setF"}),r};JXG$1.registerElement("slopefield",JXG$1.createSlopeField);JXG$1.createSmartLabel=function(n,t,o){var r,u,d,C,I,f;if(t.length===0||[Const.OBJECT_CLASS_POINT,Const.OBJECT_CLASS_LINE,Const.OBJECT_CLASS_CIRCLE].indexOf(t[0].elementClass)<0&&[Const.OBJECT_TYPE_POLYGON,Const.OBJECT_TYPE_ANGLE].indexOf(t[0].type)<0)throw new Error("JSXGraph: Can't create smartlabel with parent types '"+typeof t[0]+"', '"+typeof t[1]+"'.");return d=t[0],C=t[1]||"",d.elementClass===Const.OBJECT_CLASS_POINT?u=JXG$1.copyAttributes(o,n.options,"smartlabelpoint"):d.elementClass===Const.OBJECT_CLASS_LINE?(u=JXG$1.copyAttributes(o,n.options,"smartlabelline"),u.rotate=function(){return Math.atan(d.getSlope())*180/Math.PI},u.visible=function(){return!(d.L()<1.5)}):d.elementClass===Const.OBJECT_CLASS_CIRCLE?(u=JXG$1.copyAttributes(o,n.options,"smartlabelcircle"),u.visible=function(){return!(d.Radius()<1.5)}):d.type===Const.OBJECT_TYPE_POLYGON?u=JXG$1.copyAttributes(o,n.options,"smartlabelpolygon"):d.type===Const.OBJECT_TYPE_ANGLE&&(u=JXG$1.copyAttributes(o,n.options,"smartlabelangle"),u.rotate=function(){var A=d.center.coords.usrCoords,G=d.getLabelAnchor().usrCoords,B=Math.atan2(G[2]-A[2],G[1]-A[1])*180/Math.PI;return B>90&&B<270?B+180:B},u.anchorX=function(){var A=d.center.coords.usrCoords,G=d.getLabelAnchor().usrCoords,B=Math.atan2(G[2]-A[2],G[1]-A[1])*180/Math.PI;return B>90&&B<270?"right":"left"}),I=function(A,G,B,Z){var w;switch(Z){case"length":w=function(){return G.L()};break;case"slope":w=function(){return G.Slope()};break;case"area":w=function(){return G.Area()};break;case"radius":w=function(){return G.Radius()};break;case"perimeter":w=function(){return G.Perimeter()};break;case"rad":w=function(){return G.Value()};break;case"deg":w=function(){return G.Value()*180/Math.PI};break;default:w=function(){return 0}}return function(){var V="",Y,J=JXG$1.evaluate(C),T=JXG$1.evaluate(A.visProp.digits),L=JXG$1.evaluate(A.visProp.unit),z=JXG$1.evaluate(A.visProp.prefix),K=JXG$1.evaluate(A.visProp.suffix),P=JXG$1.evaluate(A.visProp.usemathjax)||JXG$1.evaluate(A.visProp.usekatex);return J===""?(A.useLocale()?Y=A.formatNumberLocale(w(),T):Y=JXG$1.toFixed(w(),T),P?V=["\\(",z,Y,"\\,",L,K,"\\)"].join(""):V=[z,Y,L,K].join("")):V=J,V}},d.elementClass===Const.OBJECT_CLASS_POINT?(r=n.create("text",[function(){return d.X()},function(){return d.Y()},""],u),f=function(){var A="",G=JXG$1.evaluate(C),B=JXG$1.evaluate(r.visProp.digits),Z=JXG$1.evaluate(r.visProp.unit),w=JXG$1.evaluate(r.visProp.prefix),V=JXG$1.evaluate(r.visProp.suffix),Y=JXG$1.evaluate(r.visProp.dir),J=JXG$1.evaluate(r.visProp.usemathjax)||JXG$1.evaluate(r.visProp.usekatex),T,L;return r.useLocale()?(T=r.formatNumberLocale(d.X(),B),L=r.formatNumberLocale(d.Y(),B)):(T=JXG$1.toFixed(d.X(),B),L=JXG$1.toFixed(d.Y(),B)),G===""?Y==="row"?J?A=["\\(",w,T,"\\,",Z," / ",L,"\\,",Z,V,"\\)"].join(""):A=[w,T," ",Z," / ",L," ",Z,V].join(""):Y.indexOf("col")===0&&(J?A=["\\(",w,"\\left(\\array{",T,"\\,",Z,"\\\\ ",L,"\\,",Z,"}\\right)",V,"\\)"].join(""):A=[w,T," ",Z,"<br/>",L," ",Z,V].join("")):A=G,A}):d.elementClass===Const.OBJECT_CLASS_LINE?u.measure==="length"?(r=n.create("text",[function(){return(d.point1.X()+d.point2.X())*.5},function(){return(d.point1.Y()+d.point2.Y())*.5},""],u),f=I(r,d,"line","length")):u.measure==="slope"&&(r=n.create("text",[function(){return d.point1.X()*.25+d.point2.X()*.75},function(){return d.point1.Y()*.25+d.point2.Y()*.75},""],u),f=I(r,d,"line","slope")):d.elementClass===Const.OBJECT_CLASS_CIRCLE?u.measure==="radius"?(r=n.create("text",[function(){return d.center.X()+d.Radius()*.5},function(){return d.center.Y()},""],u),f=I(r,d,"circle","radius")):u.measure==="area"?(r=n.create("text",[function(){return d.center.X()},function(){return d.center.Y()+d.Radius()*.5},""],u),f=I(r,d,"circle","area")):(u.measure==="circumference"||u.measure==="perimeter")&&(r=n.create("text",[function(){return d.getLabelAnchor()},""],u),f=I(r,d,"circle","perimeter")):d.type===Const.OBJECT_TYPE_POLYGON?u.measure==="area"?(r=n.create("text",[function(){return d.getTextAnchor()},""],u),f=I(r,d,"polygon","area")):u.measure==="perimeter"&&(r=n.create("text",[function(){var A=d.borders.length-1;return A>=0?[(d.borders[A].point1.X()+d.borders[A].point2.X())*.5,(d.borders[A].point1.Y()+d.borders[A].point2.Y())*.5]:d.getTextAnchor()},""],u),f=I(r,d,"polygon","perimeter")):d.type===Const.OBJECT_TYPE_ANGLE&&(r=n.create("text",[function(){return d.getLabelAnchor()},""],u),f=I(r,d,"angle",u.measure)),JXG$1.exists(r)&&(r.setText(f),d.addChild(r),r.setParents([d])),r};JXG$1.registerElement("smartlabel",JXG$1.createSmartLabel);JXG$1.ForeignObject=function(n,t,o,r,u){this.constructor(n,o,Const.OBJECT_TYPE_FOREIGNOBJECT,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this._useUserSize=!1,this.size=[1,1],JXG$1.exists(u)&&u.length>0&&(this._useUserSize=!0,this.W=JXG$1.createFunction(u[0],this.board,""),this.H=JXG$1.createFunction(u[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()]),this.content=r,this.elType="foreignobject",this.id=this.board.setId(this,"Im"),this.board.renderer.drawForeignObject(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H"})};JXG$1.ForeignObject.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.ForeignObject,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.ForeignObject.prototype,{hasPoint:function(n,t){var o,r,u,d,C,I,f,A,G,B=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(d=this.board._inputDevice,C=JXG$1.evaluate(this.visProp.precision[d])):C=this.board.options.precision.hasPoint,B===0?(o=n-this.coords.scrCoords[1],r=this.coords.scrCoords[2]-t,u=C,o>=-u&&o-this.size[0]<=u&&r>=-u&&r-this.size[1]<=u):(I=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),I=I.usrCoords,f=[I[0]-this.span[0][0],I[1]-this.span[0][1],I[2]-this.span[0][2]],G=Mat.innerProduct,A=G(f,this.span[1]),0<=A&&A<=G(this.span[1],this.span[1])&&(A=G(f,this.span[2]),0<=A&&A<=G(this.span[2],this.span[2])))},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateSize(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateForeignObject")},updateSize:function(){var n=[0,0];return this._useUserSize?(this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)]):this.rendNode.hasChildNodes()&&(n=this.rendNode.childNodes[0].getBoundingClientRect(),this.size=[n.width,n.height]),this},updateSpan:function(){var n,t,o=this.transformations.length,r=[];if(o===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(r[0]=[this.Z(),this.X(),this.Y()],r[1]=[this.Z(),this.X()+this.W(),this.Y()],r[2]=[this.Z(),this.X(),this.Y()+this.H()],n=0;n<o;n++)for(t=0;t<3;t++)r[t]=Mat.matVecMult(this.transformations[n].matrix,r[t]);for(t=0;t<3;t++)r[t][1]/=r[t][0],r[t][2]/=r[t][0],r[t][0]/=r[t][0];for(t=1;t<3;t++)r[t][0]-=r[0][0],r[t][1]-=r[0][1],r[t][2]-=r[0][2];this.span=r}return this},addTransform:function(n){var t;if(JXG$1.isArray(n))for(t=0;t<n.length;t++)this.transformations.push(n[t]);else this.transformations.push(n);return this},getParents:function(){var n=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(n=this.parents),n},setSize:function(n,t){return this.W=JXG$1.createFunction(n,this.board,""),this.H=JXG$1.createFunction(t,this.board,""),this._useUserSize=!0,this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createForeignObject=function(n,t,o){var r,u,d=t[0],C=t[1],I=[];if(t.length>=2&&(I=t[2]),r=JXG$1.copyAttributes(o,n.options,"foreignobject"),u=CoordsElement.create(JXG$1.ForeignObject,n,C,r,d,I),!u)throw new Error("JSXGraph: Can't create foreignObject with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [string, [x, y], [w, h]], [string, [x, y]], [element,transformation]`);return u};JXG$1.registerElement("foreignobject",JXG$1.createForeignObject);JXG$1.registerElement("fo",JXG$1.createForeignObject);JXG$1.ForeignObject;JXG$1.extend(Options,{axes3d:{axesPosition:"center",xAxis:{visible:!0,point2:{name:"x"},strokeColor:JXG$1.palette.red},yAxis:{visible:!0,point2:{name:"y"},strokeColor:JXG$1.palette.green},zAxis:{visible:!0,point2:{name:"z"},strokeColor:JXG$1.palette.blue},xAxisBorder:{name:"x",visible:"nherit",withLabel:!1,label:{position:"50% left",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle",anchorY:"middle"}}},yAxisBorder:{name:"y",visible:"nherit",withLabel:!1,label:{position:"50% right",offset:[0,-30],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle"}}},zAxisBorder:{name:"z",visible:"nherit",withLabel:!1,label:{position:"50% right",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle",anchorY:"middle"}}},xPlaneRear:{visible:!0,layer:0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",mesh3d:{layer:1}},yPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},yPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1}},axis3d:{highlight:!1,fixed:!0,strokeColor:"black",strokeWidth:1,tabindex:null,point1:{visible:!1,name:""},point2:{visible:!1,name:"",label:{visible:!0}}},circle3d:{point:{visible:!1,name:""}},curve3d:{highlight:!1,tabindex:-1,strokeWidth:1,numberPointsHigh:200},intersectionline3d:{point1:{visible:!1,name:""},point2:{visible:!1,name:""}},line3d:{strokeWidth:1,strokeColor:"black",fixed:!0,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",point:{visible:!1,name:""},point1:{visible:!1,name:""},point2:{visible:!1,name:""}},mesh3d:{strokeWidth:1,strokeColor:"#9a9a9a",strokeOpacity:.6,highlight:!1,tabindex:null,visible:"inherit"},plane3d:{strokeWidth:0,strokeColor:"black",strokeOpacity:1,highlight:!1,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",gradientAngle:Math.PI,fillColor:"#a7a7a7",fillOpacity:.6,point:{visible:!1,name:"",fixed:!0}},point3d:{infoboxDigits:"auto",strokeWidth:0,gradient:"radial",gradientSecondColor:"#555555",fillColor:"yellow",highlightStrokeColor:"#555555",gradientFX:.7,gradientFY:.3},polygon3d:{highlight:!1,tabindex:-1,strokeWidth:1,fillColor:"none"},sphere3d:{highlight:!1,strokeWidth:1,strokeColor:"#00ff80",fillColor:"white",gradient:"radial",gradientSecondColor:"#00ff80",gradientFX:.7,gradientFY:.3,fillOpacity:.4},surface3d:{highlight:!1,tabindex:-1,strokeWidth:1,stepsU:30,stepsV:30},text3d:{},ticks3d:{visible:!0,ticksDistance:1,majorHeight:10,minorTicks:0,tickEndings:[0,1],drawLabels:!0,label:{visible:!0}},vectorfield3d:{scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},view3d:{needsRegularUpdate:!0,projection:"parallel",verticalDrag:{enabled:!0,key:"shift"},az:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:1}},el:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:.3}},bank:{pointer:{enabled:!0,speed:.08,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:-Math.PI,max:Math.PI,start:0}},trackball:{enabled:!1,outside:!0,button:-1,key:"none"},r:"auto",fov:1/5*2*Math.PI,depthOrderPoints:!1,values:[[0,1.57],[.78,.62],[0,0],[5.49,.62],[4.71,0],[3.93,.62],[3.14,0],[2.36,.62],[1.57,1.57]],infobox:{strokeColor:"#000000",fontSize:24,useKatex:!1,useMathjax:!1},_currentView:-1}});JXG$1.Options;JXG$1.View3D=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_VIEW3D,Const.OBJECT_CLASS_3D),this.objects={},this.points=this.visProp.depthorderpoints?[]:null,this.elementsByName={},this.defaultAxes=null,this.angles={az:null,el:null,bank:null},this.matrix3DRot=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.matrix3D=[[1,0,0,0],[0,1,0,0],[0,0,1,0]],this.boxToCam=[],this.llftCorner=t[0],this.size=t[1],this.bbox3D=t[2],this.r=-1,this.focalDist=-1,this.projectionType="parallel",this.trackballEnabled=!1,this.timeoutAzimuth=null,this.id=this.board.setId(this,"V"),this.board.finalizeAdding(this),this.elType="view3d",this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.View3D.prototype=new GeometryElement;JXG$1.extend(JXG$1.View3D.prototype,{create:function(n,t,o){var r=[],u;return n.indexOf("3d")>0&&r.push(this),u=this.board.create(n,r.concat(t),o),u},select:function(n,t){var o,r,u,d,C=n;if(C===null)return C;if(JXG$1.isString(C)&&C!=="")JXG$1.exists(this.objects[C])?C=this.objects[C]:JXG$1.exists(this.elementsByName[C])&&(C=this.elementsByName[C]);else if(!t&&(JXG$1.isFunction(C)||JXG$1.isObject(C)&&!JXG$1.isFunction(C.setAttribute))){for(o=JXG$1.filterElements(this.objectsList,C),r={},d=o.length,u=0;u<d;u++)r[o[u].id]=o[u];C=new Composition(r)}else JXG$1.isObject(C)&&JXG$1.exists(C.id)&&!JXG$1.exists(this.objects[C.id])&&(C=null);return C},setAnglesFromRotation:function(){var n=this.matrix3DRot,t,o,r,u,d,C,I;t=Math.sqrt(n[1][3]*n[1][3]+n[2][3]*n[2][3]),t>Mat.eps?(o=n[2][3]/t,r=n[1][3]/t):(o=Math.cos(this.angles.bank),r=Math.sin(this.angles.bank)),n=Mat.matMatMult([[1,0,0,0],[0,o,-r,0],[0,r,o,0],[0,0,0,1]],n),this.angles.bank=Math.atan2(r,o),u=n[2][3],d=n[3][3],n=Mat.matMatMult([[1,0,0,0],[0,1,0,0],[0,0,u,d],[0,0,-d,u]],n),this.angles.el=Math.atan2(d,u),C=-n[1][1],I=n[3][1],this.angles.az=Math.atan2(I,C),this.angles.az<0&&(this.angles.az+=2*Math.PI),this.setSlidersFromAngles()},anglesHaveMoved:function(){return this._hasMoveAz||this._hasMoveEl||Math.abs(this.angles.az-this.az_slide.Value())>Mat.eps||Math.abs(this.angles.el-this.el_slide.Value())>Mat.eps||Math.abs(this.angles.bank-this.bank_slide.Value())>Mat.eps},getAnglesFromSliders:function(){this.angles.az=this.az_slide.Value(),this.angles.el=this.el_slide.Value(),this.angles.bank=this.bank_slide.Value()},setSlidersFromAngles:function(){this.az_slide.setValue(this.angles.az),this.el_slide.setValue(this.angles.el),this.bank_slide.setValue(this.angles.bank)},getRotationFromAngles:function(){var n,t,o,r,u,d,C=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return n=this.angles.az,t=this.angles.el,o=this.angles.bank,r=-Math.sin(t),C[1][1]=-Math.cos(n),C[1][2]=Math.sin(n),C[1][3]=0,C[2][1]=r*Math.sin(n),C[2][2]=r*Math.cos(n),C[2][3]=Math.cos(t),C[3][1]=Math.cos(t)*Math.sin(n),C[3][2]=Math.cos(t)*Math.cos(n),C[3][3]=Math.sin(t),u=Math.cos(o),d=Math.sin(o),C=Mat.matMatMult([[1,0,0,0],[0,u,d,0],[0,-d,u,0],[0,0,0,1]],C),C},_projectToSphere:function(n,t,o){var r=Mat.hypot(t,o),u,d;return r<n*.7071067811865475?d=Math.sqrt(n*n-r*r):(u=n/1.414213562373095,d=u*u/r),d},updateProjectionTrackball:function(n){var t=100,o,r,u,d,C,I,f,A,G,B,Z,w,V,Y=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return JXG$1.exists(this._trackball)?(o=this._trackball.dx,r=this._trackball.dy,u=o*o+r*r,u>Mat.eps&&(t=(this.size[0]*this.board.unitX+this.size[1]*this.board.unitY)*.25,I=this._trackball.x,f=this._trackball.y,C=[I,f,this._projectToSphere(t,I,f)],I-=o,f-=r,d=[I,f,this._projectToSphere(t,I,f)],V=Mat.crossProduct(d,C),B=Mat.hypot(V[0],V[1],V[2]),V[0]/=B,V[1]/=B,V[2]/=B,G=Geometry.distance(C,d,3)/(2*t),G=G>1?1:G,G=G<-1?-1:G,A=2*Math.asin(G),Z=Math.cos(A),G=1-Z,w=Math.sin(A),Y[1][1]=Z+V[0]*V[0]*G,Y[2][1]=V[1]*V[0]*G+V[2]*w,Y[3][1]=V[2]*V[0]*G-V[1]*w,Y[1][2]=V[0]*V[1]*G-V[2]*w,Y[2][2]=Z+V[1]*V[1]*G,Y[3][2]=V[2]*V[1]*G+V[0]*w,Y[1][3]=V[0]*V[2]*G+V[1]*w,Y[2][3]=V[1]*V[2]*G-V[0]*w,Y[3][3]=Z+V[2]*V[2]*G),Y=Mat.matMatMult(Y,this.matrix3DRot),Y):this.matrix3DRot},updateAngleSliderBounds:function(){var n,t,o,r,u,d,C,I,f,A,G,B,Z;this.trackballEnabled=JXG$1.evaluate(this.visProp.trackball.enabled),this.trackballEnabled?(this.az_slide.setMin(0),this.az_slide.setMax(2*Math.PI),this.el_slide.setMin(-.5*Math.PI),this.el_slide.setMax(.5*Math.PI),this.bank_slide.setMin(-Math.PI),this.bank_slide.setMax(Math.PI)):(this.az_slide.setMin(this.visProp.az.slider.min),this.az_slide.setMax(this.visProp.az.slider.max),this.el_slide.setMin(this.visProp.el.slider.min),this.el_slide.setMax(this.visProp.el.slider.max),this.bank_slide.setMin(this.visProp.bank.slider.min),this.bank_slide.setMax(this.visProp.bank.slider.max)),n=this.az_slide._smax,t=this.az_slide._smin,o=this.el_slide._smax,r=this.el_slide._smin,B=this.bank_slide._smax,Z=this.bank_slide._smin,this.trackballEnabled?(u=Mat.mod(this.angles.el,2*Math.PI),.5*Math.PI<u&&u<1.5*Math.PI&&(this.angles.el=Math.PI-u,this.angles.az=Mat.wrap(this.angles.az+Math.PI,t,n),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,Z,B)),this.angles.az=Mat.wrap(this.angles.az,t,n),this.angles.el=Mat.wrap(this.angles.el,r,o),this.angles.bank=Mat.wrap(this.angles.bank,Z,B)):(G=function(w){return w<r?r-w:o<w?w-o:0},d=.5*(r+o),C=Mat.wrap(this.angles.el,d-Math.PI,d+Math.PI),I=Mat.wrap(Math.PI-this.angles.el,d-Math.PI,d+Math.PI),f=G(C),A=G(I),f<=A?this.angles.el=Mat.clamp(C,r,o):(this.angles.el=Mat.clamp(I,r,o),this.angles.az=Mat.wrap(this.angles.az+Math.PI,t,n),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,Z,B)),this.angles.az=Mat.wrapAndClamp(this.angles.az,t,n,2*Math.PI),this.angles.bank=Mat.wrapAndClamp(this.angles.bank,Z,B,2*Math.PI),this.matrix3DRot=this.getRotationFromAngles()),this.setSlidersFromAngles()},_updateCentralProjection:function(){var n=20,t=8,o,r;return o=JXG$1.evaluate(this.visProp.r),o==="auto"&&(o=Mat.hypot(this.bbox3D[0][0]-this.bbox3D[0][1],this.bbox3D[1][0]-this.bbox3D[1][1],this.bbox3D[2][0]-this.bbox3D[2][1])*1.01),this.boxToCam=this.matrix3DRot.map(u=>u.slice()),this.boxToCam[3][0]=-o,this.focalDist=1/Math.tan(.5*JXG$1.evaluate(this.visProp.fov)),r=[[0,0,0,-1],[0,this.focalDist,0,0],[0,0,this.focalDist,0],[2*n*t/(t-n),0,0,(n+t)/(t-n)]],Mat.matMatMult(r,this.boxToCam)},compareDepth:function(n,t){var o=[0,n.coords[1]-t.coords[1],n.coords[2]-t.coords[2],n.coords[3]-t.coords[3]],r=Mat.matVecMult(this.matrix3DRot,Mat.matVecMult(this.shift,o));return r[3]},update:function(){var n=this.r,t=[[1,0,0,0],[0,-n,0,0],[0,0,-n,0],[0,0,0,1]],o,r,u,d,C,I;if(!JXG$1.exists(this.el_slide)||!JXG$1.exists(this.az_slide)||!JXG$1.exists(this.bank_slide)||!this.needsUpdate)return this;switch(o=[[1,0,0],[0,1,0],[0,0,1]],this.projectionType=JXG$1.evaluate(this.visProp.projection).toLowerCase(),this.trackballEnabled!==JXG$1.evaluate(this.visProp.trackball.enabled)&&this.updateAngleSliderBounds(),this._hasMoveTrackball?(this.matrix3DRot=this.updateProjectionTrackball(),this.setAnglesFromRotation()):this.anglesHaveMoved()&&(this.getAnglesFromSliders(),this.matrix3DRot=this.getRotationFromAngles()),this.shift=[[1,0,0,0],[-.5*(this.bbox3D[0][0]+this.bbox3D[0][1]),1,0,0],[-.5*(this.bbox3D[1][0]+this.bbox3D[1][1]),0,1,0],[-.5*(this.bbox3D[2][0]+this.bbox3D[2][1]),0,0,1]],this.projectionType){case"central":u=2*.4,o[1][1]=this.size[0]/u,o[2][2]=this.size[1]/u,o[1][0]=this.llftCorner[0]+o[1][1]*.5*u,o[2][0]=this.llftCorner[1]+o[2][2]*.5*u,this.viewPortTransform=o,r=this._updateCentralProjection(),this.matrix3D=Mat.matMatMult(r,this.shift);break;case"parallel":default:d=this.bbox3D[0][1]-this.bbox3D[0][0],C=this.bbox3D[1][1]-this.bbox3D[1][0],o[1][1]=this.size[0]/d,o[2][2]=this.size[1]/C,o[1][0]=this.llftCorner[0]+o[1][1]*.5*d,o[2][0]=this.llftCorner[1]+o[2][2]*.5*C,this.matrix3D=Mat.matMatMult(o,Mat.matMatMult(Mat.matMatMult(this.matrix3DRot,t),this.shift).slice(0,3))}return this.visProp.depthorderpoints&&this.points===null&&(I=Object.values(this.objects),this.points=I.filter(f=>f.type===Const.OBJECT_TYPE_POINT3D)),!this.visProp.depthorderpoints&&this.points!==null&&(this.points=null),this.visProp.depthorderpoints&&this.board.renderer&&this.board.renderer.type==="svg"&&this.points.filter(f=>JXG$1.evaluate(f.element2D.visProp.visible)).sort(this.compareDepth.bind(this)).forEach(f=>this.board.renderer.setLayer(f.element2D,f.element2D.visProp.layer)),this},updateRenderer:function(){return this.needsUpdate=!1,this},removeObject:function(n,t){var o;if(JXG$1.isArray(n)){for(o=0;o<n.length;o++)this.removeObject(n[o]);return this}if(n=this.select(n),!JXG$1.exists(n)||JXG$1.isString(n))return this;try{delete this.objects[n.id]}catch(r){JXG$1.debug("View3D "+n.id+": Could not be removed: "+r)}return this.board.removeObject(n,t),this},worldToFocal:function(n,t=!0){var o,r=Mat.matVecMult(this.boxToCam,Mat.matVecMult(this.shift,n));if(r[3]-=r[0]*this.focalDist,t)return r;for(o=1;o<4;o++)r[o]/=r[0];return r.slice(1,4)},project3DTo2D:function(n,t,o){var r,u;switch(arguments.length===3?r=[1,n,t,o]:n.length===3?(r=n.slice(),r.unshift(1)):r=n,u=Mat.matVecMult(this.matrix3D,r),this.projectionType){case"central":return u[1]/=u[0],u[2]/=u[0],u[3]/=u[0],u[0]/=u[0],Mat.matVecMult(this.viewPortTransform,u.slice(0,3));case"parallel":default:return u}},_getW0:function(n,t,o){var r=Mat.inverse(n),u=r[0][0]+t[1]*r[0][1]+t[2]*r[0][2],d=r[3][0]+t[1]*r[3][1]+t[2]*r[3][2],C,I,f;return f=o*r[0][3]-r[3][3],C=(d*r[0][3]-u*r[3][3])/f,I=(d-u*o)/f,[1/C,I]},project2DTo3DPlane:function(n,t,o){var r,u,d,C,I,f=t.slice(1),A,G,B;if(o=o||[1,0,0,0],C=Mat.norm(f,3),d=Mat.innerProduct(o.slice(1),f,3)/C,this.projectionType==="parallel"){r=this.matrix3D.slice(0,3),r.push([0,f[0],f[1],f[2]]),u=n.coords.usrCoords.slice(),u.push(d);try{r[2][3]===1&&(r[2][1]=r[2][2]=Mat.eps*.001),I=Mat.Numerics.Gauss(r,u)}catch{I=[0,NaN,NaN,NaN]}}else{r=this.matrix3D,u=n.coords.usrCoords.slice(),A=Mat.Numerics.Gauss(this.viewPortTransform,u),B=this._getW0(r,A,d),G=B[0],u=[A[0]*G,A[1]*G,A[2]*G,B[1]*G];try{r[2][3]===1&&(r[2][1]=r[2][2]=Mat.eps*.001),I=Mat.Numerics.Gauss(r,u),I[1]/=I[0],I[2]/=I[0],I[3]/=I[0],I[0]/=I[0]}catch{I=[0,NaN,NaN,NaN]}}return I},projectScreenToSegment:function(n,t,o){var r=this.project3DTo2D(t).slice(1,3),u=this.project3DTo2D(o).slice(1,3),d=[u[0]-r[0],u[1]-r[1]],C=Mat.innerProduct(d,d),I=[n[0]-r[0],n[1]-r[1]],f=Mat.innerProduct(I,d)/C,A,G,B,Z,w,V,Y;return this.projectionType==="central"?(A=[.5*(t[0]+o[0]),.5*(t[1]+o[1]),.5*(t[2]+o[2])],G=this.project3DTo2D(A).slice(1,3),B=[G[0]-r[0],G[1]-r[1]],Z=Mat.innerProduct(B,d)/C,w=(1-Z)*f/((1-2*Z)*f+Z)):w=f,V=Math.min(Math.max(w,0),1),Y=1-V,[1,Y*t[0]+V*o[0],Y*t[1]+V*o[1],Y*t[2]+V*o[2]]},project2DTo3DVertical:function(n,t){var o=n.coords.usrCoords.slice(1,3),r=[t[1],t[2],this.bbox3D[2][0]],u=[t[1],t[2],this.bbox3D[2][1]];return this.projectScreenToSegment(o,r,u)},project3DToCube:function(n){var t=this.bbox3D,o=!1;return n[1]<t[0][0]&&(n[1]=t[0][0],o=!0),n[1]>t[0][1]&&(n[1]=t[0][1],o=!0),n[2]<t[1][0]&&(n[2]=t[1][0],o=!0),n[2]>t[1][1]&&(n[2]=t[1][1],o=!0),n[3]<=t[2][0]&&(n[3]=t[2][0],o=!0),n[3]>=t[2][1]&&(n[3]=t[2][1],o=!0),[n,o]},intersectionLineCube:function(n,t,o){var r,u,d,C;for(r=o,u=0;u<3;u++)t[u]!==0&&(d=(this.bbox3D[u][0]-n[u])/t[u],C=(this.bbox3D[u][1]-n[u])/t[u],o<0?r=Math.max(r,Math.min(d,C)):r=Math.min(r,Math.max(d,C)));return r},isInCube:function(n){return n[0]>this.bbox3D[0][0]-Mat.eps&&n[0]<this.bbox3D[0][1]+Mat.eps&&n[1]>this.bbox3D[1][0]-Mat.eps&&n[1]<this.bbox3D[1][1]+Mat.eps&&n[2]>this.bbox3D[2][0]-Mat.eps&&n[2]<this.bbox3D[2][1]+Mat.eps},intersectionPlanePlane:function(n,t,o){var r=[[],[]],u,d,C,I;return o=o||t.d,u=Mat.Geometry.meet3Planes(n.normal,n.d,t.normal,o,Mat.crossProduct(n.normal,t.normal),0),d=Mat.Geometry.meetPlanePlane(n.vec1,n.vec2,t.vec1,t.vec2),C=this.intersectionLineCube(u,d,1/0),I=Mat.axpy(C,d,u),this.isInCube(I)&&(r[0]=I),C=this.intersectionLineCube(u,d,-1/0),I=Mat.axpy(C,d,u),this.isInCube(I)&&(r[1]=I),r},getMesh:function(n,t,o){var r,u,d,C,I,f,A,G=[0,0,0],B=t[2],Z=o[2],w=[],V=[];for(f=(JXG$1.evaluate(t[1])-JXG$1.evaluate(t[0]))/B,A=(JXG$1.evaluate(o[1])-JXG$1.evaluate(o[0]))/Z,r=0;r<=B;r++){for(d=t[0]+f*r,u=0;u<=Z;u++)C=o[0]+A*u,JXG$1.isFunction(n)?G=n(d,C):G=[n[0](d,C),n[1](d,C),n[2](d,C)],I=this.project3DTo2D(G),w.push(I[1]),V.push(I[2]);w.push(NaN),V.push(NaN)}for(u=0;u<=Z;u++){for(C=o[0]+A*u,r=0;r<=B;r++)d=t[0]+f*r,JXG$1.isFunction(n)?G=n(d,C):G=[n[0](d,C),n[1](d,C),n[2](d,C)],I=this.project3DTo2D(G),w.push(I[1]),V.push(I[2]);w.push(NaN),V.push(NaN)}return[w,V]},animateAzimuth:function(){var n=this.az_slide._smin,t=this.az_slide._smax,o=t-n,r=this.az_slide.Value()+.1;this.az_slide.position=(r-n)/o,this.az_slide.position>1&&(this.az_slide.position=0),this.board.update(),this.timeoutAzimuth=setTimeout((function(){this.animateAzimuth()}).bind(this),200)},stopAzimuth:function(){clearTimeout(this.timeoutAzimuth),this.timeoutAzimuth=null},isVerticalDrag:function(){var n=this.board,t;return JXG$1.evaluate(this.visProp.verticaldrag.enabled)?(t="_"+JXG$1.evaluate(this.visProp.verticaldrag.key)+"Key",n[t]):!1},setView:function(n,t,o){return o=o||this.r,this.az_slide.setValue(n),this.el_slide.setValue(t),this.r=o,this.board.update(),this},nextView:function(){var n=JXG$1.evaluate(this.visProp.values),t=this.visProp._currentview;return t=(t+1)%n.length,this.setCurrentView(t),this},previousView:function(){var n=JXG$1.evaluate(this.visProp.values),t=this.visProp._currentview;return t=(t+n.length-1)%n.length,this.setCurrentView(t),this},setCurrentView:function(n){var t=JXG$1.evaluate(this.visProp.values);return(n<0||n>=t.length)&&(n=(n%t.length+t.length)%t.length),this.setView(t[n][0],t[n][1],t[n][2]),this.visProp._currentview=n,this},_azEventHandler:function(n){var t=this.az_slide._smax,o=this.az_slide._smin,r=(t-o)/this.board.canvasWidth*JXG$1.evaluate(this.visProp.az.pointer.speed),u=n.movementX,d=this.az_slide.Value(),C=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.az.keyboard.enabled)&&(n.key==="ArrowRight"?d=d+JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180:n.key==="ArrowLeft"&&(d=d-JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.az.pointer.enabled)&&u!==0&&n.key==null&&(d+=u*r),JXG$1.evaluate(this.visProp.az.continuous)?d=Mat.wrap(d,o,t):d>0?d=Math.min(t,d):d<0&&(d=Math.max(o,d)),this.setView(d,C),this)},_elEventHandler:function(n){var t=this.el_slide._smax,o=this.el_slide._smin,r=(t-o)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.el.pointer.speed),u=n.movementY,d=this.az_slide.Value(),C=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.el.keyboard.enabled)&&(n.key==="ArrowUp"?C=C-JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180:n.key==="ArrowDown"&&(C=C+JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&u!==0&&n.key==null&&(C+=u*r),JXG$1.evaluate(this.visProp.el.continuous)&&!this.trackballEnabled?C=Mat.wrap(C,o,t):C>0?C=Math.min(t,C):C<0&&(C=Math.max(o,C)),this.setView(d,C),this)},_bankEventHandler:function(n){var t=this.bank_slide._smax,o=this.bank_slide._smin,r,u,d=n.deltaY,C=this.bank_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.bank.keyboard.enabled)&&(r=JXG$1.evaluate(this.visProp.bank.keyboard.step)*Math.PI/180,n.key==="."||n.key==="<"?C-=r:(n.key===","||n.key===">")&&(C+=r)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&d!==0&&n.key==null&&(u=(t-o)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.bank.pointer.speed),C+=d*u,n.preventDefault()),JXG$1.evaluate(this.visProp.bank.continuous)?C=Mat.wrap(C,o,t):C=Mat.clamp(C,o,t),this.bank_slide.setValue(C),this.board.update(),this)},_trackballHandler:function(n){var t=this.board.getMousePosition(n),o,r,u;return u=new Coords(Const.COORDS_BY_USER,[this.llftCorner[0]+this.size[0]*.5,this.llftCorner[1]+this.size[1]*.5],this.board),o=t[0]-u.scrCoords[1],r=t[1]-u.scrCoords[2],this._trackball={dx:n.movementX,dy:-n.movementY,x:o,y:-r},this.board.update(),this},pointerDownHandler:function(n){var t,o,r;this._hasMoveAz=!1,this._hasMoveEl=!1,this._hasMoveBank=!1,this._hasMoveTrackball=!1,this.board.mode===this.board.BOARD_MODE_NONE&&(JXG$1.evaluate(this.visProp.trackball.enabled)?(t=JXG$1.evaluate(this.visProp.trackball.button),o=JXG$1.evaluate(this.visProp.trackball.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(r=JXG$1.evaluate(this.visProp.trackball.outside)?document:this.board.containerObj,JXG$1.addEvent(r,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!0)):(JXG$1.evaluate(this.visProp.az.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.az.pointer.button),o=JXG$1.evaluate(this.visProp.az.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(r=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(r,"pointermove",this._azEventHandler,this),this._hasMoveAz=!0)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.el.pointer.button),o=JXG$1.evaluate(this.visProp.el.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(r=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(r,"pointermove",this._elEventHandler,this),this._hasMoveEl=!0)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.bank.pointer.button),o=JXG$1.evaluate(this.visProp.bank.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(r=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(r,"wheel",this._bankEventHandler,this,{passive:!1}),this._hasMoveBank=!0))),JXG$1.addEvent(document,"pointerup",this.pointerUpHandler,this))},pointerUpHandler:function(n){var t;this._hasMoveAz&&(t=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._azEventHandler,this),this._hasMoveAz=!1),this._hasMoveEl&&(t=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._elEventHandler,this),this._hasMoveEl=!1),this._hasMoveBank&&(t=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"wheel",this._bankEventHandler,this),this._hasMoveBank=!1),this._hasMoveTrackball&&(t=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!1),JXG$1.removeEvent(document,"pointerup",this.pointerUpHandler,this)}});JXG$1.createView3D=function(n,t,o){var r,u,d,C,I,f,A,G,B,Z=t[0],w=t[1];return u=JXG$1.copyAttributes(o,n.options,"view3d"),r=new JXG$1.View3D(n,t,u),r.defaultAxes=r.create("axes3d",[],u),f=Z[0],A=Z[1],G=w[0],B=w[1],d=JXG$1.copyAttributes(u,n.options,"view3d","az","slider"),d.name="az",C=JXG$1.copyAttributes(u,n.options,"view3d","el","slider"),C.name="el",I=JXG$1.copyAttributes(u,n.options,"view3d","bank","slider"),I.name="bank",r.az_slide=n.create("slider",[[f-1,A-2],[f+G+1,A-2],[JXG$1.evaluate(d.min),JXG$1.evaluate(d.start),JXG$1.evaluate(d.max)]],d),r.inherits.push(r.az_slide),r.el_slide=n.create("slider",[[f-1,A],[f-1,A+B],[JXG$1.evaluate(C.min),JXG$1.evaluate(C.start),JXG$1.evaluate(C.max)]],C),r.inherits.push(r.el_slide),r.bank_slide=n.create("slider",[[f-1,A+B+2],[f+G+1,A+B+2],[JXG$1.evaluate(I.min),JXG$1.evaluate(I.start),JXG$1.evaluate(I.max)]],I),r.inherits.push(r.bank_slide),r.board.infobox.visProp=JXG$1.merge(r.board.infobox.visProp,u.infobox),r.board.highlightInfobox=function(V,Y,J){var T,L,z,K,P="",$=J.board,ie,ne,ee=null;for(this.mode===this.BOARD_MODE_DRAG&&(r.isVerticalDrag()?P='<span style="color:black; font-size:200%"> &nbsp;</span>':P='<span style="color:black; font-size:200%"> &nbsp;</span>'),L=0;L<J.parents.length&&(ee=$.objects[J.parents[L]],!ee.is3D);L++);if(ee){if(K=[1,0,0,ee.coords[3]],r._w0=Mat.innerProduct(r.matrix3D[0],K,4),z=r.project2DTo3DPlane(ee.element2D,[1,0,0,1],K),!r.isInCube(z)){r.board.highlightCustomInfobox("",ee);return}T=JXG$1.evaluate(ee.visProp.infoboxdigits),ne=r.board.infobox,T==="auto"?ne.useLocale()?ie=[P,"(",ne.formatNumberLocale(ee.X())," | ",ne.formatNumberLocale(ee.Y())," | ",ne.formatNumberLocale(ee.Z()),")"]:ie=[P,"(",JXG$1.autoDigits(ee.X())," | ",JXG$1.autoDigits(ee.Y())," | ",JXG$1.autoDigits(ee.Z()),")"]:ne.useLocale()?ie=[P,"(",ne.formatNumberLocale(ee.X(),T)," | ",ne.formatNumberLocale(ee.Y(),T)," | ",ne.formatNumberLocale(ee.Z(),T),")"]:ie=[P,"(",JXG$1.toFixed(ee.X(),T)," | ",JXG$1.toFixed(ee.Y(),T)," | ",JXG$1.toFixed(ee.Z(),T),")"],r.board.highlightCustomInfobox(ie.join(""),ee)}else r.board.highlightCustomInfobox("("+V+", "+Y+")",J)},r.BOARD_MODE_NONE=0,JXG$1.addEvent(n.containerObj,"keydown",function(V){var Y,J=!1;JXG$1.evaluate(r.visProp.el.keyboard.enabled)&&(V.key==="ArrowUp"||V.key==="ArrowDown")&&(Y=JXG$1.evaluate(r.visProp.el.keyboard.key),(Y==="none"||Y.indexOf("shift")>-1&&V.shiftKey||Y.indexOf("ctrl")>-1&&V.ctrlKey)&&(r._elEventHandler(V),J=!0)),JXG$1.evaluate(r.visProp.el.keyboard.enabled)&&(V.key==="ArrowLeft"||V.key==="ArrowRight")&&(Y=JXG$1.evaluate(r.visProp.az.keyboard.key),(Y==="none"||Y.indexOf("shift")>-1&&V.shiftKey||Y.indexOf("ctrl")>-1&&V.ctrlKey)&&(r._azEventHandler(V),J=!0)),JXG$1.evaluate(r.visProp.bank.keyboard.enabled)&&(V.key===","||V.key==="<"||V.key==="."||V.key===">")&&(Y=JXG$1.evaluate(r.visProp.bank.keyboard.key),(Y==="none"||Y.indexOf("shift")>-1&&V.shiftKey||Y.indexOf("ctrl")>-1&&V.ctrlKey)&&(r._bankEventHandler(V),J=!0)),V.key==="PageUp"?(r.nextView(),J=!0):V.key==="PageDown"&&(r.previousView(),J=!0),J&&V.preventDefault()},r),JXG$1.addEvent(n.containerObj,"pointerdown",r.pointerDownHandler,r),r.getAnglesFromSliders(),r.matrix3DRot=r.getRotationFromAngles(),r.updateAngleSliderBounds(),r.board.update(),r};JXG$1.registerElement("view3d",JXG$1.createView3D);JXG$1.View3D;JXG$1.GeometryElement3D=function(n,t){this.elType=t,this.id=this.board.setId(this,t),this.view=n,this.element2D=null,this.is3D=!0,this.view.objects[this.id]=this,this.name!==""&&(this.view.elementsByName[this.name]=this)};JXG$1.extend(JXG$1.GeometryElement3D.prototype,{setAttr2D:function(n){var t=n;return t.name=this.name,t},setAttribute:function(n){var t,o,r,u,d,C={};for(t=0;t<arguments.length;t++)u=arguments[t],JXG$1.isString(u)?(d=u.split(":"),C[JXG$1.trim(d[0])]=JXG$1.trim(d[1])):JXG$1.isArray(u)?C[u[0]]=u[1]:JXG$1.extend(C,u);for(t in C)if(C.hasOwnProperty(t))switch(o=t.replace(/\s+/g,"").toLowerCase(),r=C[t],o){case"numberpointshigh":case"stepsu":case"stepsv":JXG$1.exists(this.visProp[o])&&(!JXG$1.Validator[o]||JXG$1.Validator[o]&&JXG$1.Validator[o](r)||JXG$1.Validator[o]&&JXG$1.isFunction(r)&&JXG$1.Validator[o](r()))&&(r=r.toLowerCase&&r.toLowerCase()==="false"?!1:r,this._set(o,r));break;default:JXG$1.exists(this.element2D)&&this.element2D.setAttribute(C)}},getAttribute:function(n){var t;switch(n=n.toLowerCase(),n){case"numberpointshigh":case"stepsu":case"stepsv":t=this.visProp[n];break;default:JXG$1.exists(this.element2D)&&(t=this.element2D.getAttribute(n));break}return t},getAttributes:function(){var n={},t,o,r=["numberpointshigh","stepsu","stepsv"],u=r.length;for(JXG$1.exists(this.element2D)&&(n=JXG$1.merge(this.element2D.getAttributes())),t=0;t<u;t++)o=r[t],JXG$1.exists(this.visProp[o])&&(n[o]=this.visProp[o]);return n},setPosition2D:function(n){},remove:function(){}});JXG$1.GeometryElement3D;JXG$1.createAxes3D=function(n,t,o){var r=t[0],u=["x","y","z"],d="Axis",C=["Rear","Front"],I=[0,0,0],f=[0,0,0],A,G,B,Z,w,V,Y,J,T,L,z,K,P,$,ie,ne,ee,se,re,ce={};if(JXG$1.exists(r.bbox3D))for(A=0;A<u.length;A++)I[A]=r.bbox3D[A][0],f[A]=r.bbox3D[A][1];else for(A=0;A<u.length;A++)I[A]=t[1][A],f[A]=t[2][1];for(V=JXG$1.copyAttributes(o,n.options,"axes3d"),Y=V.axesposition,A=0;A<u.length;A++)J=u[A],ee=J+d,Y==="center"?(z=[0,0,0],K=[0,0,0],K[A]=f[A],ce[ee]=r.create("axis3d",[z,K],V[ee.toLowerCase()]),ce[ee].view=r):Y==="border"&&(ee+="Border",z=I.slice(),K=f.slice(),J==="z"?(z[1]=f[1],K[0]=I[0]):J==="x"?(z=[I[0],f[1],I[2]],K=[f[0],f[1],I[2]]):(z=[f[0],I[1],I[2]],K=[f[0],f[1],I[2]]),K[A]=f[A],ce[ee]=r.create("axis3d",[z,K],V[ee.toLowerCase()]),ce[ee].view=r,re=V[ee.toLowerCase()].ticks3d,L=f[A]-I[A],J==="x"?ce[ee+"Ticks"]=r.create("ticks3d",[z,[1,0,0],L,[0,1,0]],re):J==="y"?ce[ee+"Ticks"]=r.create("ticks3d",[z,[0,1,0],L,[1,0,0]],re):ce[ee+"Ticks"]=r.create("ticks3d",[z,[0,0,1],L,[0,1,0]],re),ce[ee+"Ticks"].view=r);for(Y==="center"?(ce.O=r.create("intersection",[ce[u[0]+d],ce[u[1]+d]],{name:"",visible:!1,withLabel:!1}),ce.O.view=r):ce.O=null,A=0;A<u.length;A++)for(Z=(A+1)%3,w=(A+2)%3,J=u[A],G=0;G<C.length;G++)z=[0,0,0],z[A]=G===0?I[A]:f[A],P=[0,0,0],$=[0,0,0],P[Z]=1,$[w]=1,ie=[I[Z],f[Z]],ne=[I[w],f[w]],ee=J+"Plane"+C[G],V=JXG$1.copyAttributes(o,n.options,"axes3d",ee),ce[ee]=r.create("plane3d",[z,P,$,ie,ne],V),ce[ee].elType="axisplane3d";for(A=0;A<u.length;A++)for(J=u[A],G=0;G<C.length;G++)for(B=1;B<=2;B++)Z=(A+B)%3,T=u[Z],ee=J+"Plane"+C[G]+T.toUpperCase()+"Axis",se=J+"Plane"+C[G],z=[0,0,0],K=[0,0,0],z[A]=K[A]=G===0?I[A]:f[A],z[Z]=I[Z],K[Z]=f[Z],V=JXG$1.copyAttributes(o,n.options,"axes3d",ee),ce[ee]=r.create("axis3d",[z,K],V),ce[ee].view=r,ce[se].addChild(ce[ee]),ce[se].element2D.inherits.push(ce[ee]);return ce};JXG$1.registerElement("axes3d",JXG$1.createAxes3D);JXG$1.createAxis3D=function(n,t,o){var r=t[0],u,d=t[1],C=t[2],I,f,A;return u=JXG$1.copyAttributes(o.point1,n.options,"axis3d","point1"),I=r.create("point",[function(G,B,Z){return function(){return r.project3DTo2D(G,B,Z)[1]}}(d[0],d[1],d[2]),function(G,B,Z){return function(){return r.project3DTo2D(G,B,Z)[2]}}(d[0],d[1],d[2])],u),u=JXG$1.copyAttributes(o.point2,n.options,"axis3d","point2"),f=r.create("point",[function(G,B,Z){return function(){return r.project3DTo2D(G,B,Z)[1]}}(C[0],C[1],C[2]),function(G,B,Z){return function(){return r.project3DTo2D(G,B,Z)[2]}}(C[0],C[1],C[2])],u),u=JXG$1.copyAttributes(o,n.options,"axis3d"),A=r.create("arrow",[I,f],u),A};JXG$1.registerElement("axis3d",JXG$1.createAxis3D);JXG$1.createMesh3D=function(n,t,o){var r=t[0],u=t[1],d=t[2],C=t[3],I=t[4],f=t[5],A=t[6]||1,G;return G=r.create("curve",[[],[]],o),G.point=u,G.direction1=d,G.range1=C,G.direction2=I,G.range2=f,G.step=A,G.updateDataArray=function(){var B=JXG$1.evaluate(this.range1),Z=JXG$1.evaluate(this.range2),w=B[0],V=B[1],Y=Z[0],J=Z[1],T,L,z,K,P=[0,0,0],$=[0,0,0],ie=JXG$1.evaluate(this.step),ne=[0,0,0];if(this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ne=this.point().slice(1);else for(K=0;K<3;K++)ne[K]=JXG$1.evaluate(this.point[K]);for(K=0;K<3;K++)P[K]=JXG$1.evaluate(this.direction1[K]),$[K]=JXG$1.evaluate(this.direction2[K]);for(T=JXG$1.Math.norm(P,3),L=JXG$1.Math.norm($,3),K=0;K<3;K++)P[K]/=T,$[K]/=L;z=r.getMesh([function(ee,se){return ne[0]+ee*P[0]+se*$[0]},function(ee,se){return ne[1]+ee*P[1]+se*$[1]},function(ee,se){return ne[2]+ee*P[2]+se*$[2]}],[Math.ceil(w),Math.floor(V),(Math.ceil(V)-Math.floor(w))/ie],[Math.ceil(Y),Math.floor(J),(Math.ceil(J)-Math.floor(Y))/ie]),this.dataX=z[0],this.dataY=z[1]},G};JXG$1.registerElement("mesh3d",JXG$1.createMesh3D);JXG$1.Circle3D=function(n,t,o,r,u){var d;this.constructor(n.board,u,Const.OBJECT_TYPE_CIRCLE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"circle3d"),this.center=this.board.select(t),this.normal=[0,0,0],this.curve,this.frame1,this.frame2,this.updateNormal=function(){var C,I;for(C=0;C<3;C++)this.normal[C]=JXG$1.evaluate(o[C]);if(I=Mat.norm(this.normal),Math.abs(I)>Mat.eps)for(C=0;C<3;C++)this.normal[C]/=I},JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),this.updateRadius=JXG$1.createFunction(r,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.updateNormal(),this.frame1=Mat.crossProduct(this.normal,[1,0,0]),d=Mat.crossProduct(this.normal,[-.5,.8660254037844386,0]),Mat.norm(d)>Mat.norm(this.frame1)&&(this.frame1=d),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame(),this.curve=n.create("curve3d",[C=>this.center.X()+this.Radius()*(Math.cos(C)*this.frame1[0]+Math.sin(C)*this.frame2[0]),C=>this.center.Y()+this.Radius()*(Math.cos(C)*this.frame1[1]+Math.sin(C)*this.frame2[1]),C=>this.center.Z()+this.Radius()*(Math.cos(C)*this.frame1[2]+Math.sin(C)*this.frame2[2]),[0,2*Math.PI]],u)};JXG$1.Circle3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Circle3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Circle3D.prototype,{update:function(){return this.updateNormal(),this.updateFrame(),this.curve.visProp.visible=!isNaN(this.Radius()),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):Math.abs(this.updateRadius())},normalizeFrame:function(){var n=Mat.norm(this.frame1),t=Mat.norm(this.frame2),o;for(o=0;o<3;o++)this.frame1[o]/=n,this.frame2[o]/=t},updateFrame:function(){this.frame1=Mat.crossProduct(this.frame2,this.normal),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame()},projectCoords:function(n,t){return this.curve.projectCoords(n,t)},projectScreenCoords:function(n,t){return this.curve.projectScreenCoords(n,t)}});JXG$1.createCircle3D=function(n,t,o){var r=t[0],u=JXG$1.copyAttributes(o,n.options,"circle3d"),d=JXG$1.providePoints3D(r,[t[1]],o,"circle3d",["point"])[0],C=t[2],I=t[3],f;return f=new JXG$1.Circle3D(r,d,C,I,u),f.curve.addParents([f]),f.addChild(f.curve),f.update(),f};JXG$1.registerElement("circle3d",JXG$1.createCircle3D);JXG$1.createIntersectionCircle3D=function(n,t,o){var r=t[0],u=t[1],d=t[2],C,I,f,A=JXG$1.copyAttributes(o,n.options,"intersectioncircle3d");f=Geometry.intersectionFunction3D(r,u,d),I=r.create("point3d",f[0],{visible:!1}),C=r.create("circle3d",[I,f[1],f[2]],A);try{u.addChild(C),d.addChild(C)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return C.type=Const.OBJECT_TYPE_INTERSECTION_CIRCLE3D,C.elType="intersectioncircle3d",C.setParents([u.id,d.id]),C};JXG$1.registerElement("intersectioncircle3d",JXG$1.createIntersectionCircle3D);JXG$1.Point3D=function(n,t,o,r){this.constructor(n.board,r,Const.OBJECT_TYPE_POINT3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"point3d"),this.board.finalizeAdding(this),n.visProp.depthorderpoints&&n.points.push(this),this.coords=[0,0,0,0],this.F=t,this.slide=o,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Point3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Point3D.prototype,{updateCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)JXG$1.isFunction(this.F[n])&&(this.coords[n+1]=JXG$1.evaluate(this.F[n]));return this},initCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)this.coords[n+1]=JXG$1.evaluate(this.F[n]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(n,t){var o=this.coords;return n.length===3?(o[0]=1,o[1]=n[0],o[2]=n[1],o[3]=n[2]):(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[2],this.normalizeCoords()),this},update:function(n){var t,o,r;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?t=this.view.project2DTo3DVertical(this.element2D,this.coords):(o=[1,0,0,this.coords[3]],t=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],o)),t[0]!==0&&(r=this.view.project3DToCube(t),this.coords=r[0],r[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()]))),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},distance:function(n){var t=Mat.eps*Mat.eps,o=this.coords,r=n.coords;return o[0]*o[0]>t&&r[0]*r[0]>t?Mat.hypot(r[1]-o[1],r[2]-o[2],r[3]-o[3]):Number.POSITIVE_INFINITY},__evt__update3D:function(n){}});JXG$1.createPoint3D=function(n,t,o){var r=t[0],u,d,C,I,f;if(t.length>2&&JXG$1.exists(t[t.length-1].is3D)?C=t.pop():C=null,t.length===2)d=t[1];else if(t.length===4)d=t.slice(1);else throw new Error("JSXGraph: Can't create point3d with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[x,y,z]], [x,y,z]`);return u=JXG$1.copyAttributes(o,n.options,"point3d"),f=new JXG$1.Point3D(r,d,C,u),f.initCoords(),I=r.project3DTo2D(f.coords),u=f.setAttr2D(u),f.element2D=r.create("point",I,u),f.element2D.view=r,f.addChild(f.element2D),f.inherits.push(f.element2D),f.element2D.setParents(f),f.slide&&(f.slide.addChild(f),f.setParents(f.slide)),f._c2d=f.element2D.coords.usrCoords.slice(),f};JXG$1.registerElement("point3d",JXG$1.createPoint3D);JXG$1.Curve3D=function(n,t,o,r,u,d,C){this.constructor(n.board,C,Const.OBJECT_TYPE_CURVE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"curve3d"),this.board.finalizeAdding(this),this.F=t,this.X=o,this.Y=r,this.Z=u,this.dataX=null,this.dataY=null,this.dataZ=null,this.F!==null&&(this.X=function(I){return this.F(I)[0]},this.Y=function(I){return this.F(I)[1]},this.Z=function(I){return this.F(I)[2]}),this.range=d,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Curve3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Curve3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Curve3D.prototype,{updateDataArray2D:function(){var n=JXG$1.evaluate(this.visProp.numberpointshigh),t,o,r,u,d,C,I,f,A,G=[0,0,0];if(I=[],f=[],JXG$1.exists(this.dataX))for(n=this.dataX.length,C=0;C<n;C++)G=[this.dataX[C],this.dataY[C],this.dataZ[C]],d=this.view.project3DTo2D(G),I.push(d[1]),f.push(d[2]);else if(JXG$1.isArray(this.X))for(n=this.X.length,C=0;C<n;C++)G=[this.X[C],this.Y[C],this.Z[C]],d=this.view.project3DTo2D(G),I.push(d[1]),f.push(d[2]);else for(t=JXG$1.evaluate(this.range),o=JXG$1.evaluate(t[0]),r=JXG$1.evaluate(t[1]),u=(r-o)/(n-1),A=0,C=o;A<n&&C<=r;A++,C+=u)this.F!==null?G=this.F(C):G=[this.X(C),this.Y(C),this.Z(C)],d=this.view.project3DTo2D(G),I.push(d[1]),f.push(d[2]);return{X:I,Y:f}},updateDataArray:function(){},update:function(){return this.updateDataArray(),this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(n){n.length===0&&n.unshift(.5*(this.range[0]+this.range[1]))},projectCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectCoordsToParametric(n,this,t)},projectScreenCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectScreenCoordsToParametric(n,this,t)}});JXG$1.createCurve3D=function(n,t,o){var r=t[0],u,d,C,I,f,A,G;return t.length===3?(u=t[1],f=t[2],d=null,C=null,I=null):(d=t[1],C=t[2],I=t[3],f=t[4],u=null),A=JXG$1.copyAttributes(o,n.options,"curve3d"),G=new JXG$1.Curve3D(r,u,d,C,I,f,A),A=G.setAttr2D(A),G.element2D=r.create("curve",[[],[]],A),G.element2D.view=r,G.element2D.updateDataArray=function(){var B=G.updateDataArray2D();this.dataX=B.X,this.dataY=B.Y},G.addChild(G.element2D),G.inherits.push(G.element2D),G.element2D.setParents(G),G.element2D.prepareUpdate().update(),n.isSuspendedUpdate||G.element2D.updateVisibility().updateRenderer(),G};JXG$1.registerElement("curve3d",JXG$1.createCurve3D);JXG$1.createVectorfield3D=function(n,t,o){var r=t[0],u,d;if(!(t.length>=5&&(JXG$1.isArray(t[1])||JXG$1.isFunction(t[1])||JXG$1.isString(t[1]))&&JXG$1.isArray(t[2])&&t[1].length===3&&JXG$1.isArray(t[3])&&t[2].length===3&&JXG$1.isArray(t[4])&&t[3].length===3))throw new Error("JSXGraph: Can't create vector field 3D with parent types '"+typeof t[1]+"', '"+typeof t[2]+"', '"+typeof t[3]+"'.'"+typeof t[4]+"', ");return d=JXG$1.copyAttributes(o,n.options,"vectorfield3d"),u=r.create("curve3d",[[],[],[]],d),u.setF=function(C,I){var f,A,G;return JXG$1.isArray(C)?(f=JXG$1.createFunction(C[0],this.board,I),A=JXG$1.createFunction(C[1],this.board,I),G=JXG$1.createFunction(C[2],this.board,I),this.F=function(B,Z,w){return[f(B,Z,w),A(B,Z,w),G(B,Z,w)]}):this.F=JXG$1.createFunction(C,u.board,I),this},u.setF(t[1],"x, y, z"),u.xData=t[2],u.yData=t[3],u.zData=t[4],u.updateDataArray=function(){var C,I,f,A,G,B,Z,w,V=JXG$1.evaluate(this.visProp.scale),Y=[JXG$1.evaluate(this.xData[0]),JXG$1.evaluate(this.yData[0]),JXG$1.evaluate(this.zData[0])],J=[JXG$1.evaluate(this.xData[1]),JXG$1.evaluate(this.yData[1]),JXG$1.evaluate(this.zData[1])],T=[JXG$1.evaluate(this.xData[2]),JXG$1.evaluate(this.yData[2]),JXG$1.evaluate(this.zData[2])],L=[(T[0]-Y[0])/J[0],(T[1]-Y[1])/J[1],(T[2]-Y[2])/J[2]],z,K,P,$,ie=JXG$1.evaluate(this.visProp.arrowhead.enabled),ne,ee,se,re,ce;for(ie&&(ne=JXG$1.evaluate(this.visProp.arrowhead.size),ce=JXG$1.evaluate(this.visProp.arrowhead.angle),ee=ne/n.unitX,se=ne/n.unitY,re=ne/Math.sqrt(n.unitX*n.unitY)),this.dataX=[],this.dataY=[],this.dataZ=[],I=0,B=Y[0];I<=J[0];B+=L[0],I++)for(f=0,Z=Y[1];f<=J[1];Z+=L[1],f++)for(C=0,w=Y[2];C<=J[2];w+=L[2],C++)A=this.F(B,Z,w),G=Mat.norm(A),!(G<Number.EPSILON)&&(A[0]*=V,A[1]*=V,A[2]*=V,JXG$1.concat(this.dataX,[B,B+A[0],NaN]),JXG$1.concat(this.dataY,[Z,Z+A[1],NaN]),JXG$1.concat(this.dataZ,[w,w+A[2],NaN]),ie&&(G*=V,z=Math.atan2(A[1],A[0]),$=Math.asin(A[2]/G),K=$-ce,P=$+ce,JXG$1.concat(this.dataX,[B+A[0]-ee*Math.cos(z)*Math.cos(K),B+A[0],B+A[0]-ee*Math.cos(z)*Math.cos(P),NaN]),JXG$1.concat(this.dataY,[Z+A[1]-se*Math.sin(z)*Math.cos(K),Z+A[1],Z+A[1]-se*Math.sin(z)*Math.cos(P),NaN]),JXG$1.concat(this.dataZ,[w+A[2]-re*Math.sin(P),w+A[2],w+A[2]-re*Math.sin(K),NaN])))},u.methodMap=JXG$1.deepCopy(u.methodMap,{setF:"setF"}),u};JXG$1.registerElement("vectorfield3D",JXG$1.createVectorfield3D);JXG$1.Line3D=function(n,t,o,r,u){this.constructor(n.board,u,Const.OBJECT_TYPE_LINE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"line3d"),this.board.finalizeAdding(this),this.point=t,this.direction=o,this.range=r||[-1/0,1/0],this.point1=null,this.point2=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Line3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Line3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Line3D.prototype,{getPointCoords:function(n){var t=[],o=[],r,u;if(t=[this.point.X(),this.point.Y(),this.point.Z()],JXG$1.isFunction(this.direction))o=this.direction();else for(r=1;r<4;r++)o.push(JXG$1.evaluate(this.direction[r]));return u=JXG$1.evaluate(n),n=this.view.intersectionLineCube(t,o,u),[t[0]+o[0]*n,t[1]+o[1]*n,t[2]+o[2]*n]},update:function(){return this},setPosition2D:function(n){var t,o;for(t=0;t<this.parents.length;t++)o=this.view.select(this.parents[t]),o.elType==="point3d"&&o.element2D.draggable()&&n.applyOnce(o.element2D)},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(n){var t=this.getPointCoords(0),o=this.getPointCoords(1),r=[o[0]-t[0],o[1]-t[1],o[2]-t[2]],u=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],d=Mat.innerProduct(u,r)/Mat.innerProduct(r,r),C=Math.min(Math.max(d,this.range[0]),this.range[1]),I;return I=this.getPointCoords(C).slice(),I.unshift(1),I},projectScreenCoords:function(n){var t=this.getPointCoords(0),o=this.getPointCoords(1);return this.view.projectScreenToSegment(n,t,o)}});JXG$1.createLine3D=function(n,t,o){var r=t[0],u,d,C,I,f,A,G,B,Z;return u=JXG$1.copyAttributes(o,n.options,"line3d"),JXG$1.isPoint3D(t[2])||t.length===3&&(JXG$1.isArray(t[2])||JXG$1.isFunction(t[2]))?(A=JXG$1.providePoints3D(r,[t[1]],o,"line3d",["point1"])[0],G=JXG$1.providePoints3D(r,[t[2]],o,"line3d",["point2"])[0],I=function(){return[G.X()-A.X(),G.Y()-A.Y(),G.Z()-A.Z()]},f=[0,1],Z=new JXG$1.Line3D(r,A,I,f,u),B=JXG$1.providePoints3D(r,[[0,0,0],[0,0,0]],{visible:!1},"line3d",["point1","point2"]),B[0].F=function(){var w=0;return JXG$1.evaluate(Z.visProp.straightfirst)&&(w=-1/0),Z.getPointCoords(w)},B[1].F=function(){var w=1;return JXG$1.evaluate(Z.visProp.straightlast)&&(w=1/0),Z.getPointCoords(w)},B[0].prepareUpdate().update(),B[1].prepareUpdate().update(),u=Z.setAttr2D(u),u.straightfirst=!1,u.straightlast=!1,Z.element2D=r.create("segment",[B[0].element2D,B[1].element2D],u),Z.element2D.view=r,Z.endpoints=B,Z.addChild(B[0]),Z.addChild(B[1]),Z.addParents([A,G])):(C=JXG$1.providePoints3D(r,[t[1]],o,"line3d",["point"])[0],JXG$1.isFunction(t[2])?I=t[2]:t[2].length===3?I=[1].concat(t[2]):t[2].length===4&&(I=t[2]),f=t[3],d=JXG$1.providePoints3D(r,[[0,0,0],[0,0,0]],o,"line3d",["point1","point2"]),Z=new JXG$1.Line3D(r,C,I,f,u),d[0].F=function(){return Z.getPointCoords(JXG$1.evaluate(Z.range[0]))},d[0].prepareUpdate().update(),A=d[0],d[1].F=function(){return Z.getPointCoords(JXG$1.evaluate(Z.range[1]))},d[1].prepareUpdate().update(),G=d[1],u=Z.setAttr2D(u),u.straightfirst=!1,u.straightlast=!1,Z.element2D=r.create("segment",[A.element2D,G.element2D],u),Z.element2D.view=r,Z.endpoints=d,Z.addParents(C)),Z.addChild(Z.element2D),Z.inherits.push(Z.element2D),Z.element2D.addParents(Z),Z.point1=A,Z.point2=G,Z.point1._is_new?(Z.addChild(Z.point1),delete Z.point1._is_new):Z.point1.addChild(Z),Z.point2._is_new?(Z.addChild(Z.point2),delete Z.point2._is_new):Z.point2.addChild(Z),JXG$1.exists(C)&&(C._is_new?(Z.addChild(C),delete C._is_new):C.addChild(Z)),Z.update(),Z.element2D.prepareUpdate().update().updateRenderer(),Z};JXG$1.registerElement("line3d",JXG$1.createLine3D);JXG$1.Plane3D=function(n,t,o,r,u,d,C){this.constructor(n.board,C,Const.OBJECT_TYPE_PLANE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"plane3d"),this.board.finalizeAdding(this),this.point=t,this.direction1=o,this.direction2=u,this.range1=r||[-1/0,1/0],this.range2=d||[-1/0,1/0],this.vec1=[0,0,0],this.vec2=[0,0,0],this.grid=null,this.normal=[0,0,0],this.d=0,this.updateNormal(),this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Plane3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Plane3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Plane3D.prototype,{updateNormal:function(){var n,t;if(JXG$1.isFunction(this.direction1))this.vec1=JXG$1.evaluate(this.direction1);else for(n=0;n<3;n++)this.vec1[n]=JXG$1.evaluate(this.direction1[n]);if(JXG$1.isFunction(this.direction2))this.vec2=JXG$1.evaluate(this.direction2);else for(n=0;n<3;n++)this.vec2[n]=JXG$1.evaluate(this.direction2[n]);if(this.normal=Mat.crossProduct(this.vec1,this.vec2),t=Mat.norm(this.normal),Math.abs(t)>Mat.eps)for(n=0;n<3;n++)this.normal[n]/=t;return this.d=Mat.innerProduct(this.point.coords.slice(1),this.normal,3),this},updateDataArray:function(){var n,t,o,r,u,d,C,I=["xPlaneRear","yPlaneRear","zPlaneRear"],f=[],A=[0,0,0],G=[0,0,0],B=[0,0,0],Z=[0,0,0],w,V,Y,J,T,L,z,K,P=this.view;if(this.dataX=[],this.dataY=[],this.updateNormal(),this.elType!=="axisplane3d"&&P.defaultAxes&&JXG$1.evaluate(this.range1[0])===-1/0&&JXG$1.evaluate(this.range1[1])===1/0&&JXG$1.evaluate(this.range2[0])===-1/0&&JXG$1.evaluate(this.range2[1])===1/0){for(Y=0;Y<I.length;Y++){if(Z=P.intersectionPlanePlane(this,P.defaultAxes[I[Y]]),Z[0].length===3&&Z[1].length===3){for(V=0;V<f.length&&!(Geometry.distance(Z[0],f[V][0],3)<Mat.eps&&Geometry.distance(Z[1],f[V][1],3)<Mat.eps||Geometry.distance(Z[0],f[V][1],3)<Mat.eps&&Geometry.distance(Z[1],f[V][0],3)<Mat.eps);V++);V===f.length&&f.push(Z.slice())}if(Z=[0,0,0],Z[Y]=P.bbox3D[Y][1],w=Mat.innerProduct(Z,P.defaultAxes[I[Y]].normal,3),Z=P.intersectionPlanePlane(this,P.defaultAxes[I[Y]],w),Z[0].length===3&&Z[1].length===3){for(V=0;V<f.length&&!(Geometry.distance(Z[0],f[V][0],3)<Mat.eps&&Geometry.distance(Z[1],f[V][1],3)<Mat.eps||Geometry.distance(Z[0],f[V][1],3)<Mat.eps&&Geometry.distance(Z[1],f[V][0],3)<Mat.eps);V++);V===f.length&&f.push(Z.slice())}}if(f.length===0)return{X:this.dataX,Y:this.dataY};L=0,z=L,V=0;do{for(Z=f[z][V],Z.length===3&&(u=P.project3DTo2D(Z),this.dataX.push(u[1]),this.dataY.push(u[2])),V=(V+1)%2,Z=f[z][V],K=z,Y=0;Y<f.length;Y++){if(Y!==z&&Geometry.distance(Z,f[Y][0])<Mat.eps){z=Y,V=0;break}if(Y!==z&&Geometry.distance(Z,f[Y][1])<Mat.eps){z=Y,V=1;break}}if(z===K){console.log("Error: update plane3d: did not find next",z);break}}while(z!==L);u=P.project3DTo2D(f[L][0]),this.dataX.push(u[1]),this.dataY.push(u[2])}else{for(n=JXG$1.evaluate(this.range1[0]),t=JXG$1.evaluate(this.range1[1]),o=JXG$1.evaluate(this.range2[0]),r=JXG$1.evaluate(this.range2[1]),B=this.point.coords.slice(1),A=this.vec1.slice(),G=this.vec2.slice(),d=Mat.norm(A,3),C=Mat.norm(G,3),V=0;V<3;V++)A[V]/=d,G[V]/=C;for(Y=0;Y<4;Y++){switch(Y){case 0:J=n,T=o;break;case 1:J=t,T=o;break;case 2:J=t,T=r;break;case 3:J=n,T=r}for(V=0;V<3;V++)Z[V]=B[V]+J*A[V]+T*G[V];u=P.project3DTo2D(Z),this.dataX.push(u[1]),this.dataY.push(u[2])}this.dataX.push(this.dataX[0]),this.dataY.push(this.dataY[0])}return{X:this.dataX,Y:this.dataY}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPlane3D=function(n,t,o){var r=t[0],u,d,C=t[2],I=t[3],f=t[4]||[-1/0,1/0],A=t[5]||[-1/0,1/0],G,B;return d=JXG$1.providePoints3D(r,[t[1]],o,"plane3d",["point"])[0],u=JXG$1.copyAttributes(o,n.options,"plane3d"),G=new JXG$1.Plane3D(r,d,C,f,I,A,u),d.addChild(G),u=G.setAttr2D(u),G.element2D=r.create("curve",[[],[]],u),G.element2D.view=r,G.element2D.updateDataArray=function(){var Z=G.updateDataArray();this.dataX=Z.X,this.dataY=Z.Y},G.addChild(G.element2D),G.inherits.push(G.element2D),G.element2D.setParents(G),u=JXG$1.copyAttributes(o.mesh3d,n.options,"mesh3d"),Math.abs(G.range1[0])!==1/0&&Math.abs(G.range1[1])!==1/0&&Math.abs(G.range2[0])!==1/0&&Math.abs(G.range2[1])!==1/0&&(B=r.create("mesh3d",[function(){return d.coords},C,f,I,A],u),G.grid=B,G.addChild(B),G.inherits.push(B),B.setParents(G),G.grid.view=r),G.element2D.prepareUpdate().update(),n.isSuspendedUpdate||G.element2D.updateVisibility().updateRenderer(),G};JXG$1.registerElement("plane3d",JXG$1.createPlane3D);JXG$1.createIntersectionLine3D=function(n,t,o){var r=t[0],u=t[1],d=t[2],C,I,f,A=JXG$1.copyAttributes(o,n.options,"intersectionline3d"),G=[];for(I=0;I<2;I++)f=Geometry.intersectionFunction3D(r,u,d,I),G[I]=r.create("point3d",f,A["point"+(I+1)]);C=r.create("line3d",G,A);try{u.addChild(C),d.addChild(C)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return C.type=Const.OBJECT_TYPE_INTERSECTION_LINE3D,C.elType="intersectionline3d",C.setParents([u.id,d.id]),C};JXG$1.registerElement("intersectionline3d",JXG$1.createIntersectionLine3D);JXG$1.Text3D=function(n,t,o,r,u){this.constructor(n.board,u,Const.OBJECT_TYPE_TEXT3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"text3d"),this.board.finalizeAdding(this),n.visProp.depthorderpoints&&n.points.push(this),this.coords=[0,0,0,0],this.F=t,this.slide=r,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Text3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Text3D.prototype,{updateCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)JXG$1.isFunction(this.F[n])&&(this.coords[n+1]=JXG$1.evaluate(this.F[n]));return this},initCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)this.coords[n+1]=JXG$1.evaluate(this.F[n]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(n,t){var o=this.coords;return n.length===3?(o[0]=1,o[1]=n[0],o[2]=n[1],o[3]=n[2]):(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[2],this.normalizeCoords()),this},update:function(n){var t,o,r;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?t=this.view.project2DTo3DVertical(this.element2D,this.coords):(o=[1,0,0,this.coords[3]],t=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],o)),t[0]!==0&&(r=this.view.project3DToCube(t),this.coords=r[0],r[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()].slice(1))),this.element2D.prepareUpdate().update()),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},__evt__update3D:function(n){}});JXG$1.createText3D=function(n,t,o){var r=t[0],u,d,C,I,f,A;if(t.length>3&&JXG$1.exists(t[t.length-1].is3D)?C=t.pop():C=null,t.length===3)d=t[1],I=t[2];else if(t.length===5)d=t.slice(1,4),I=t[4];else throw new Error("JSXGraph: Can't create text3d with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[x,y,z], text], [x,y,z, text]`);return u=JXG$1.copyAttributes(o,n.options,"text3d"),A=new JXG$1.Text3D(r,d,I,C,u),A.initCoords(),f=r.project3DTo2D(A.coords),u=A.setAttr2D(u),A.element2D=r.create("text",[f[1],f[2],I],u),A.element2D.view=r,A.addChild(A.element2D),A.inherits.push(A.element2D),A.element2D.setParents(A),A.slide&&(A.slide.addChild(A),A.setParents(A.slide)),A._c2d=A.element2D.coords.usrCoords.slice(),A};JXG$1.registerElement("text3d",JXG$1.createText3D);JXG$1.createTicks3D=function(n,t,o){var r=t[0],u=t[1],d=t[2],C=t[3],I=t[4],f,A;return A=JXG$1.copyAttributes(o,n.options,"ticks3d"),f=r.create("curve",[[],[]],A),f.point=u,f.direction1=d,f.len=C,f.direction2=I,f.drawLabels=function(G){var B=0,Z=this.len,w=JXG$1.evaluate(this.visProp.ticksdistance),V=JXG$1.evaluate(this.visProp.tickendings),Y=JXG$1.evaluate(this.visProp.majorheight),J,T,L,z,K,P,$,ie=[0,0,0],ne=[0,0,0],ee=[0,0,0],se=[];if(Y/=Math.sqrt(n.unitX*n.unitY),J=Y*V[1]*2,this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ee=this.point().slice(1);else for(z=0;z<3;z++)ee[z]=JXG$1.evaluate(this.point[z]);for(z=0;z<3;z++)ie[z]=JXG$1.evaluate(this.direction1[z]),ne[z]=JXG$1.evaluate(this.direction2[z]);for(T=JXG$1.Math.norm(ie,3),L=JXG$1.Math.norm(ne,3),z=0;z<3;z++)ie[z]/=T,ne[z]/=L;if(!(Math.abs(w)<Mat.eps)){for(K=B;K<=Z;K+=w){for($=[ee[0]+K*ie[0]+J*ne[0],ee[1]+K*ie[1]+J*ne[1],ee[2]+K*ie[2]+J*ne[2]],z=0;z<3;z++)ie[z]!==0&&(P=ee[z]+K*ie[z]);se.push(r.create("text3d",[$,P],G))}return se}},JXG$1.evaluate(f.visProp.drawlabels)&&(f.labels=f.drawLabels(A.label)),f.updateDataArray=function(){var G=0,B=this.len,Z=JXG$1.evaluate(this.visProp.ticksdistance),w=JXG$1.evaluate(this.visProp.tickendings),V=JXG$1.evaluate(this.visProp.majorheight),Y,J,T,L,z,K,P,$,ie=[0,0,0],ne=[0,0,0],ee=[0,0,0];if(V/=Math.sqrt(n.unitX*n.unitY),Y=V*-w[0],J=V*w[1],this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ee=this.point().slice(1);else for(z=0;z<3;z++)ee[z]=JXG$1.evaluate(this.point[z]);for(z=0;z<3;z++)ie[z]=JXG$1.evaluate(this.direction1[z]),ne[z]=JXG$1.evaluate(this.direction2[z]);for(T=JXG$1.Math.norm(ie,3),L=JXG$1.Math.norm(ne,3),z=0;z<3;z++)ie[z]/=T,ne[z]/=L;if(!(Math.abs(Z)<Mat.eps))for(K=G;K<=B;K+=Z)$=[ee[0]+K*ie[0]+Y*ne[0],ee[1]+K*ie[1]+Y*ne[1],ee[2]+K*ie[2]+Y*ne[2]],P=r.project3DTo2D($),this.dataX.push(P[1]),this.dataY.push(P[2]),$=[ee[0]+K*ie[0]+J*ne[0],ee[1]+K*ie[1]+J*ne[1],ee[2]+K*ie[2]+J*ne[2]],P=r.project3DTo2D($),this.dataX.push(P[1]),this.dataY.push(P[2]),this.dataX.push(NaN),this.dataY.push(NaN)},f};JXG$1.registerElement("ticks3d",JXG$1.createTicks3D);JXG$1.Polygon3D=function(n,t,o){var r;for(this.constructor(n.board,o,Const.OBJECT_TYPE_POLYGON3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"polygon3d"),this.board.finalizeAdding(this),this.vertices=[],r=0;r<t.length;r++)this.vertices[r]=this.board.select(t[r]),this.vertices[r]._is_new&&(delete this.vertices[r]._is_new,this.vertices[r]._is_new_pol=!0)};JXG$1.Polygon3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Polygon3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Polygon3D.prototype,{update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPolygon3D=function(n,t,o){var r=t[0],u,d,C,I,f=[],A=[],G,B,Z=!1;if(G=JXG$1.copyAttributes(o,n.options,"polygon3d"),I=n.select(t[1]),I===null&&(I=t[1]),JXG$1.isObject(I)&&I.type===Const.OBJECT_TYPE_POLYGON3D&&JXG$1.isTransformationOrArray(t[2]))for(Z=!0,C=I.vertices.length-1,B=JXG$1.copyAttributes(o,n.options,"polygon3d","vertices"),d=0;d<C;d++)B.withlabel&&(B.name=I.vertices[d].name===""?"":I.vertices[d].name+"'"),f.push(n.create("point3d",[I.vertices[d],t[2]],B));else if(f=JXG$1.providePoints3D(r,t.slice(1),o,"polygon3d",["vertices"]),f===!1)throw new Error("JSXGraph: Can't create polygon3d with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon3d and a transformation can be supplied");for(u=new JXG$1.Polygon3D(r,f,G),u.isDraggable=!0,G=u.setAttr2D(G),d=0;d<f.length;d++)A.push(f[d].element2D);if(u.element2D=n.create("polygon",A,G),u.element2D.view=r,u.addChild(u.element2D),u.inherits.push(u.element2D),u.element2D.setParents(u),Z)for(u.prepareUpdate().update().updateVisibility().updateRenderer(),C=I.vertices.length-1,d=0;d<C;d++)f[d].prepareUpdate().update().updateVisibility().updateRenderer();return u};JXG$1.registerElement("polygon3d",JXG$1.createPolygon3D);JXG$1.Sphere3D=function(n,t,o,r,u){this.constructor(n.board,u,Const.OBJECT_TYPE_SPHERE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"sphere3d"),this.board.finalizeAdding(this),this.method=t,this.center=this.board.select(o),this.point2=null,this.points=[],this.element2D=null,this.aux2D=[],this.projectionType=n.projectionType,t==="twoPoints"?(this.point2=this.board.select(r),this.radius=this.Radius()):t==="pointRadius"&&(this.updateRadius=JXG$1.createFunction(r,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),t==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{center:"center",point2:"point2",Radius:"Radius"})};JXG$1.Sphere3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Sphere3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Sphere3D.prototype,{update:function(){return this.projectionType!==this.view.projectionType&&this.rebuildProjection(),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):this.method==="twoPoints"?this.center.isIllDefined()||this.point2.isIllDefined()?NaN:this.center.distance(this.point2):this.method==="pointRadius"?Math.abs(this.updateRadius()):NaN},focusFn:function(n){var t=this;return function(){var o=t.view.boxToCam[3],r=t.Radius();return t.view.project3DTo2D([t.center.X()+n*r*o[1],t.center.Y()+n*r*o[2],t.center.Z()+n*r*o[3]]).slice(1,3)}},innerVertexFn:function(){var n=this;return function(){var t=n.view,o=t.worldToFocal(n.center.coords,!1),r=Mat.hypot(o[0],o[1]),u=t.boxToCam,d=[-(o[0]*u[1][1]+o[1]*u[2][1])/r,-(o[0]*u[1][2]+o[1]*u[2][2])/r,-(o[0]*u[1][3]+o[1]*u[2][3])/r],C=n.Radius(),I=Math.atan(-r/o[2]),f=Math.acos(C/Mat.norm(o)),A=I+f,G=Math.cos(A),B=Math.sin(A);return t.project3DTo2D([n.center.X()+C*(B*d[0]+G*u[3][1]),n.center.Y()+C*(B*d[1]+G*u[3][2]),n.center.Z()+C*(B*d[2]+G*u[3][3])])}},buildCentralProjection:function(){var n=this.view,t={visible:!1,withLabel:!1},o=n.create("point",this.focusFn(-1),t),r=n.create("point",this.focusFn(1),t),u=n.create("point",this.innerVertexFn(n),t);this.aux2D=[o,r,u],this.element2D=n.create("ellipse",this.aux2D,this.visProp)},buildParallelProjection:function(){var n=this,t=function(){var r=[1,n.center.X(),n.center.Y(),n.center.Z()];return n.view.project3DTo2D(r)},o=function(){var r=n.view.bbox3D[0][1]-n.view.bbox3D[0][0];return n.Radius()*n.view.size[0]/r};this.aux2D=[],this.element2D=this.view.create("circle",[t,o],this.visProp)},rebuildProjection:function(){var n;if(this.element2D){this.view.board.removeObject(this.element2D);for(n in this.aux2D)this.aux2D.hasOwnProperty(n)&&this.view.board.removeObject(this.aux2D[n])}this.projectionType=this.view.projectionType,this.projectionType==="central"?this.buildCentralProjection():this.buildParallelProjection(),this.addChild(this.element2D),this.inherits.push(this.element2D),this.element2D.view=this.view}});JXG$1.createSphere3D=function(n,t,o){var r=t[0],u,d,C,I,f,A;for(u=JXG$1.copyAttributes(o,n.options,"sphere3d"),d=[],A=1;A<t.length;A++)if(JXG$1.isPointType3D(n,t[A])){if(d.length===0?C="center":C="point",I=JXG$1.providePoints3D(r,[t[A]],o,"sphere3d",[C])[0],I===!1)throw new Error("JSXGraph: Can't create sphere3d from this type. Please provide a point type.");d.push(I)}else d.push(t[A]);if(JXG$1.isPoint3D(d[0])&&JXG$1.isPoint3D(d[1]))f=new JXG$1.Sphere3D(r,"twoPoints",d[0],d[1],u);else if((JXG$1.isNumber(d[0])||JXG$1.isFunction(d[0])||JXG$1.isString(d[0]))&&JXG$1.isPoint3D(d[1]))f=new JXG$1.Sphere3D(r,"pointRadius",d[1],d[0],u);else if((JXG$1.isNumber(d[1])||JXG$1.isFunction(d[1])||JXG$1.isString(d[1]))&&JXG$1.isPoint3D(d[0]))f=new JXG$1.Sphere3D(r,"pointRadius",d[0],d[1],u);else throw new Error("JSXGraph: Can't create sphere3d with parent types '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point], [point,number], [point,function]`);return f.rebuildProjection(),f.element2D.prepareUpdate().update().updateRenderer(),f};JXG$1.registerElement("sphere3d",JXG$1.createSphere3D);JXG$1.Surface3D=function(n,t,o,r,u,d,C,I){this.constructor(n.board,I,Const.OBJECT_TYPE_SURFACE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"surface3d"),this.board.finalizeAdding(this),this.F=t,this.X=o,this.Y=r,this.Z=u,this.F!==null&&(this.X=function(f,A){return this.F(f,A)[0]},this.Y=function(f,A){return this.F(f,A)[1]},this.Z=function(f,A){return this.F(f,A)[2]}),this.range_u=d,this.range_v=C,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Surface3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Surface3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Surface3D.prototype,{updateDataArray:function(){var n=JXG$1.evaluate(this.visProp.stepsu),t=JXG$1.evaluate(this.visProp.stepsv),o=JXG$1.evaluate(this.range_u),r=JXG$1.evaluate(this.range_v),u,d;return this.F!==null?u=this.F:u=[this.X,this.Y,this.Z],o.push(n),r.push(t),d=this.view.getMesh(u,o,r),{X:d[0],Y:d[1]}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(n){n.length===0&&n.unshift(.5*(this.range_u[0]+this.range_u[1]),.5*(this.range_v[0]+this.range_v[1]))},projectCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectCoordsToParametric(n,this,t)},projectScreenCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectScreenCoordsToParametric(n,this,t)}});JXG$1.createParametricSurface3D=function(n,t,o){var r=t[0],u,d,C,I,f,A,G,B;return t.length===4?(u=t[1],f=t[2],A=t[3],d=null,C=null,I=null):(d=t[1],C=t[2],I=t[3],f=t[4],A=t[5],u=null),G=JXG$1.copyAttributes(o,n.options,"surface3d"),B=new JXG$1.Surface3D(r,u,d,C,I,f,A,G),G=B.setAttr2D(G),B.element2D=r.create("curve",[[],[]],G),B.element2D.view=r,B.element2D.updateDataArray=function(){var Z=B.updateDataArray();this.dataX=Z.X,this.dataY=Z.Y},B.addChild(B.element2D),B.inherits.push(B.element2D),B.element2D.setParents(B),B.element2D.prepareUpdate().update(),n.isSuspendedUpdate||B.element2D.updateVisibility().updateRenderer(),B};JXG$1.registerElement("parametricsurface3d",JXG$1.createParametricSurface3D);JXG$1.createFunctiongraph3D=function(n,t,o){var r=t[0],u=function(A,G){return A},d=function(A,G){return G},C=JXG$1.createFunction(t[1],n,"x, y"),I=t[2],f=t[3];return r.create("parametricsurface3d",[u,d,C,I,f],o)};JXG$1.registerElement("functiongraph3d",JXG$1.createFunctiongraph3D);let size=.75,color="#000";JXG$1.themes.mono_thin={board:{showInfobox:!1,showCopyright:!0,defaultAxes:{x:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[1,0]}},y:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[0,1]}}}},navbar:{strokeColor:"#bbb",fillColor:"none"},elements:{strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none",strokeOpacity:.6,highlightStrokeOpacity:1},angle:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3,label:{strokeColor:color}},arc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},axis:{},boxplot:{strokeWidth:size,strokeColor:color,fillColor:color,fillOpacity:.2,highlightStrokeWidth:size,highlightStrokeColor:color,highlightFillColor:color,highlightFillOpacity:.1},circle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcirclearc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},circumcirclesector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},comb:{strokeColor:color,strokeWidth:size},conic:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none"},curve:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},grid:{strokeWidth:size},hatch:{strokeColor:color,strokeWidth:size},incircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},inequality:{fillColor:"#aaaaaa55",fillOpacity:.2},integral:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaa33",fillOpacity:.3,highlightFillOpacity:.3,curveLeft:{color},baseLeft:{color},curveRight:{color},baseRight:{color}},label:{strokeColor:color},line:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},normal:{strokeColor:color},parallel:{strokeColor:color},perpendicular:{strokeColor:color},perpendicularsegment:{strokeColor:color},point:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},polygon:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaaa33",fillOpacity:.3,highlightFillOpacity:.3,vertices:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},borders:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size}},sector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},semicircle:{center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},slider:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color,baseline:{strokeWidth:size,strokeColor:color,highlightStrokeColor:color},label:{strokeColor:color},highline:{strokeWidth:3*size,name:"",strokeColor:color,highlightStrokeColor:color},ticks:{strokeColor:color}},slopefield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8},tapemeasure:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},ticks:{strokeWidth:size}},text:{strokeColor:color},tracecurve:{strokeColor:color},turtle:{strokeWidth:size,strokeColor:color,arrow:{strokeWidth:2*size,strokeColor:"#aaaaaa55"}},vectorfield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8}};JXG$1.COORDS_BY_SCREEN;JXG$1.COORDS_BY_USER;JXG$1.Dump;JXG$1.Expect;JXG$1.JSXGraph;JXG$1.Math;JXG$1.Options;JXG$1.boards;JXG$1.elements;JXG$1.palette;JXG$1.paletteWong;JXG$1.Board;JXG$1.Chart;JXG$1.Circle;JXG$1.Complex;JXG$1.Composition;JXG$1.Coords;JXG$1.CoordsElement;JXG$1.Curve;JXG$1.GeometryElement;JXG$1.Group;JXG$1.Image;JXG$1.JessieCode;JXG$1.PrefixParser;JXG$1.Line;JXG$1.Point;JXG$1.Polygon;JXG$1.Text;JXG$1.Ticks;JXG$1.Transformation;JXG$1.Turtle;JXG$1.View3D;JXG$1.LMS2rgb;JXG$1.addEvent;JXG$1.autoDigits;JXG$1.autoHighlight;JXG$1.bind;JXG$1.capitalize;JXG$1.clearVisPropOld;JXG$1.clone;JXG$1.cloneAndCopy;JXG$1.cmpArrays;JXG$1.coordsArrayToMatrix;JXG$1.copyAttributes;JXG$1.createEvalFunction;JXG$1.createFunction;JXG$1.createHTMLSlider;JXG$1.darkenColor;JXG$1.debug;JXG$1.debugInt;JXG$1.debugLine;JXG$1.debugWST;JXG$1.deepCopy;JXG$1.def;JXG$1.deprecated;JXG$1.eliminateDuplicates;JXG$1.escapeHTML;JXG$1.evalSlider;JXG$1.evaluate;JXG$1.filterElements;JXG$1.getBoardByContainerId;JXG$1.getCSSTransformMatrix;JXG$1.getCSSTransform;JXG$1.getDimensions;JXG$1.getOffset;JXG$1.getPosition;JXG$1.getProp;JXG$1.hex2rgb;JXG$1.hsv2rgb;JXG$1.isAndroid;JXG$1.isApple;JXG$1.isArray;JXG$1.isDesktop;JXG$1.isInArray;JXG$1.isInObject;JXG$1.isMetroApp;JXG$1.isMobile;JXG$1.isMozilla;JXG$1.isBoard;JXG$1.isName;JXG$1.isNode;JXG$1.isNumber;JXG$1.isObject;JXG$1.isPoint;JXG$1.isPoint3D;JXG$1.isPointType;JXG$1.isPointType3D;JXG$1.isString;JXG$1.isTouchDevice;JXG$1.isTransformationOrArray;JXG$1.isWebWorker;JXG$1.isWebkitAndroid;JXG$1.isWebkitApple;JXG$1.keys;JXG$1.lightenColor;JXG$1.merge;JXG$1.normalizePointFace;JXG$1.providePoints;JXG$1.registerElement;JXG$1.registerReader;JXG$1.removeAllEvents;JXG$1.removeElementFromArray;JXG$1.removeEvent;JXG$1.rgb2LMS;JXG$1.rgb2bw;JXG$1.rgb2cb;JXG$1.rgb2css;JXG$1.rgb2hex;JXG$1.rgb2hsv;JXG$1.rgbParser;JXG$1.rgba2rgbo;JXG$1.rgbo2rgba;JXG$1.sanitizeHTML;JXG$1.shortcut;JXG$1.str2Bool;JXG$1.supportsCanvas;JXG$1.supportsPointerEvents;JXG$1.supportsSVG;JXG$1.supportsVML;JXG$1.swap;JXG$1.timedChunk;JXG$1.toFixed;JXG$1.toFullscreen;JXG$1.toJSON;JXG$1.trim;JXG$1.trimNumber;JXG$1.truncate;JXG$1.unescapeHTML;JXG$1.uniqueArray;JXG$1.useBlackWhiteOptions;JXG$1.useStandardOptions;JXG$1.warn;JXG$1.isBrowser?window.JXG=JXG$1:JXG$1.isWebWorker()&&(self.JXG=JXG$1);function Graph({data:n}){const t=reactExports.useRef(null),o=reactExports.useRef(null);return reactExports.useEffect(()=>(o.current||(o.current=JXG$1.JSXGraph.initBoard(t.current,{boundingbox:[-10,10,10,-10],axis:!0,showCopyright:!1,showNavigation:!0,pan:{enabled:!0,needShift:!1},zoom:{enabled:!0,wheel:!0,needShift:!1,min:.1,max:10},keepaspectratio:!1}),o.current.create("text",[0,9,"Position Graph"],{fontSize:16,fixed:!0,anchorX:"middle"})),()=>{o.current&&(JXG$1.JSXGraph.freeBoard(o.current),o.current=null)}),[]),reactExports.useEffect(()=>{if(!o.current||n.length===0)return;o.current.objects.currentPoint&&o.current.removeObject(o.current.objects.currentPoint);const r=n[n.length-1];o.current.create("point",[r.x,r.y],{name:"Current",size:2,color:"red",fixed:!0,id:"currentPoint"});const u=Math.max(...n.map(I=>Math.abs(I.x)),1)*1.1,d=Math.max(...n.map(I=>Math.abs(I.y)),1)*1.1,C=o.current.getBoundingBox();(u>C[2]||d>C[1])&&o.current.setBoundingBox([-u,d,u,-d],!1),o.current.update()},[n]),jsxRuntimeExports.jsx("div",{className:"graph-container",children:jsxRuntimeExports.jsx("div",{ref:t,style:{width:"100%",height:"100%",minHeight:"200px",backgroundColor:"#fff"},id:"jsxgraph-board"})})}function Conversation({initialMessage:n="Hello! How can I help you with physics today?"}){const[t,o]=reactExports.useState([{role:"ai",content:n}]),[r,u]=reactExports.useState(""),[d,C]=reactExports.useState(!1),I=async A=>{if(A.preventDefault(),r.trim()===""){alert("Please enter a question.");return}o(Z=>[...Z,{role:"user",content:r}]),u(""),C(!0);const G=["gemma3","gemma3:1b"];let B=null;for(const Z of G)try{console.log(`Sending request to Ollama with ${Z}...`);const w=await fetch("http://localhost:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:Z,prompt:r,stream:!1})});if(!w.ok)throw new Error(`HTTP error! Status: ${w.status}`);B=(await w.json()).response||"I couldn't process that.",o(Y=>[...Y,{role:"ai",content:B}]);break}catch(w){console.warn(`Failed with ${Z}: ${w.message}`)}B||o(Z=>[...Z,{role:"ai",content:"Error: No available models. Ensure Ollama is running with a model loaded."}]),C(!1)},f=t.slice(-10).map((A,G)=>jsxRuntimeExports.jsx("div",{className:A.role==="ai"?"ai-message":"user-message",children:jsxRuntimeExports.jsxs("p",{children:[A.role==="ai"?"AI:":"You:"," ",A.content]})},G));return jsxRuntimeExports.jsxs("div",{className:"conversation-container",children:[jsxRuntimeExports.jsx("div",{className:"conversation-box",children:f}),jsxRuntimeExports.jsxs("div",{className:"input-section",children:[jsxRuntimeExports.jsx("textarea",{className:"input-textarea",value:r,onChange:A=>u(A.target.value),placeholder:"Enter your physics question...",disabled:d}),jsxRuntimeExports.jsx("button",{className:"process-button",onClick:I,disabled:d,children:d?"Processing...":"Process"})]})]})}function App(){const[n,t]=reactExports.useState({name:"Projectile Motion",objects:[{type:"sphere",mass:1,radius:.5,position:[0,.5,0],velocity:[1,10,0],color:"red"}],gravity:[0,-9.81,0]}),[o,r]=reactExports.useState([]);reactExports.useRef(null);const u=d=>{const C=[...o,d].slice(-100);r(C),console.log("Ball position:",{x:d.x.toFixed(2),y:d.y.toFixed(2),t:d.t.toFixed(2)})};return jsxRuntimeExports.jsxs("div",{className:"main",children:[jsxRuntimeExports.jsx("header",{children:jsxRuntimeExports.jsx("div",{children:"Physics Visualizer"})}),jsxRuntimeExports.jsx(PanelGroup,{direction:"vertical",children:jsxRuntimeExports.jsx(Panel,{className:"main-panel",defaultSize:90,children:jsxRuntimeExports.jsxs(PanelGroup,{direction:"horizontal",children:[jsxRuntimeExports.jsx(Panel,{className:"component-section",defaultSize:15,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx("h2",{children:"Objects"}),jsxRuntimeExports.jsxs("div",{className:"physics-parameters",children:[jsxRuntimeExports.jsx("h3",{children:n.name}),jsxRuntimeExports.jsxs("div",{className:"physics-object",children:[jsxRuntimeExports.jsx("h4",{children:n.objects[0].type}),jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsxs("li",{children:["Mass: ",n.objects[0].mass," kg"]}),jsxRuntimeExports.jsxs("li",{children:["Radius: ",n.objects[0].radius," m"]}),jsxRuntimeExports.jsxs("li",{children:["Initial Velocity: [",n.objects[0].velocity.join(", "),"] m/s"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"physics-environment",children:[jsxRuntimeExports.jsx("h4",{children:"Environment"}),jsxRuntimeExports.jsx("ul",{children:jsxRuntimeExports.jsxs("li",{children:["Gravity: [",n.gravity.join(", "),"] m/s"]})})]})]})]})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsx(Panel,{className:"visualization-section",defaultSize:30,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx("h2",{children:"3D/2D Visualization"}),jsxRuntimeExports.jsx("div",{style:{height:"calc(100% - 40px)"},children:jsxRuntimeExports.jsx(Visualizer,{scene:n,onPositionUpdate:u})})]})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsx(Panel,{className:"graph-section",defaultSize:30,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx("h2",{children:"Graph"}),jsxRuntimeExports.jsx("div",{style:{height:"calc(100% - 40px)"},children:jsxRuntimeExports.jsx(Graph,{data:o})})]})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsx(Panel,{className:"solution-section",defaultSize:25,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx("h2",{children:"AI Solution"}),jsxRuntimeExports.jsx(Conversation,{})]})})]})})})]})}clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
