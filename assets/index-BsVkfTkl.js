var FC=Object.defineProperty;var LC=(u,n,d)=>n in u?FC(u,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[n]=d;var Bd=(u,n,d)=>LC(u,typeof n!="symbol"?n+"":n,d);function _mergeNamespaces(u,n){for(var d=0;d<n.length;d++){const C=n[d];if(typeof C!="string"&&!Array.isArray(C)){for(const I in C)if(I!=="default"&&!(I in u)){const f=Object.getOwnPropertyDescriptor(C,I);f&&Object.defineProperty(u,I,f.get?f:{enumerable:!0,get:()=>C[I]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))C(I);new MutationObserver(I=>{for(const f of I)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&C(y)}).observe(document,{childList:!0,subtree:!0});function d(I){const f={};return I.integrity&&(f.integrity=I.integrity),I.referrerPolicy&&(f.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?f.credentials="include":I.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function C(I){if(I.ep)return;I.ep=!0;const f=d(I);fetch(I.href,f)}})();function getDefaultExportFromCjs(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function getAugmentedNamespace(u){if(u.__esModule)return u;var n=u.default;if(typeof n=="function"){var d=function C(){return this instanceof C?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};d.prototype=n.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(u).forEach(function(C){var I=Object.getOwnPropertyDescriptor(u,C);Object.defineProperty(d,C,I.get?I:{enumerable:!0,get:function(){return u[C]}})}),d}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var u=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function d(C,I,f){var y=null;if(f!==void 0&&(y=""+f),I.key!==void 0&&(y=""+I.key),"key"in I){f={};for(var B in I)B!=="key"&&(f[B]=I[B])}else f=I;return I=f.ref,{$$typeof:u,type:C,key:y,ref:I!==void 0?I:null,props:f}}return reactJsxRuntime_production.Fragment=n,reactJsxRuntime_production.jsx=d,reactJsxRuntime_production.jsxs=d,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var u=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),y=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),Z=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),V=Symbol.iterator;function T(be){return be===null||typeof be!="object"?null:(be=V&&be[V]||be["@@iterator"],typeof be=="function"?be:null)}var H={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,O={};function $(be,Be,Ne){this.props=be,this.context=Be,this.refs=O,this.updater=Ne||H}$.prototype.isReactComponent={},$.prototype.setState=function(be,Be){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Be,"setState")},$.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function U(){}U.prototype=$.prototype;function ee(be,Be,Ne){this.props=be,this.context=Be,this.refs=O,this.updater=Ne||H}var Q=ee.prototype=new U;Q.constructor=ee,F(Q,$.prototype),Q.isPureReactComponent=!0;var ie=Array.isArray,ne={H:null,A:null,T:null,S:null},le=Object.prototype.hasOwnProperty;function ae(be,Be,Ne,Ae,Re,We){return Ne=We.ref,{$$typeof:u,type:be,key:Be,ref:Ne!==void 0?Ne:null,props:We}}function ce(be,Be){return ae(be.type,Be,void 0,void 0,void 0,be.props)}function ge(be){return typeof be=="object"&&be!==null&&be.$$typeof===u}function he(be){var Be={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(Ne){return Be[Ne]})}var Ie=/\/+/g;function fe(be,Be){return typeof be=="object"&&be!==null&&be.key!=null?he(""+be.key):Be.toString(36)}function me(){}function Ge(be){switch(be.status){case"fulfilled":return be.value;case"rejected":throw be.reason;default:switch(typeof be.status=="string"?be.then(me,me):(be.status="pending",be.then(function(Be){be.status==="pending"&&(be.status="fulfilled",be.value=Be)},function(Be){be.status==="pending"&&(be.status="rejected",be.reason=Be)})),be.status){case"fulfilled":return be.value;case"rejected":throw be.reason}}throw be}function Ze(be,Be,Ne,Ae,Re){var We=typeof be;(We==="undefined"||We==="boolean")&&(be=null);var De=!1;if(be===null)De=!0;else switch(We){case"bigint":case"string":case"number":De=!0;break;case"object":switch(be.$$typeof){case u:case n:De=!0;break;case M:return De=be._init,Ze(De(be._payload),Be,Ne,Ae,Re)}}if(De)return Re=Re(be),De=Ae===""?"."+fe(be,0):Ae,ie(Re)?(Ne="",De!=null&&(Ne=De.replace(Ie,"$&/")+"/"),Ze(Re,Be,Ne,"",function(Rt){return Rt})):Re!=null&&(ge(Re)&&(Re=ce(Re,Ne+(Re.key==null||be&&be.key===Re.key?"":(""+Re.key).replace(Ie,"$&/")+"/")+De)),Be.push(Re)),1;De=0;var Fe=Ae===""?".":Ae+":";if(ie(be))for(var Ke=0;Ke<be.length;Ke++)Ae=be[Ke],We=Fe+fe(Ae,Ke),De+=Ze(Ae,Be,Ne,We,Re);else if(Ke=T(be),typeof Ke=="function")for(be=Ke.call(be),Ke=0;!(Ae=be.next()).done;)Ae=Ae.value,We=Fe+fe(Ae,Ke++),De+=Ze(Ae,Be,Ne,We,Re);else if(We==="object"){if(typeof be.then=="function")return Ze(Ge(be),Be,Ne,Ae,Re);throw Be=String(be),Error("Objects are not valid as a React child (found: "+(Be==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Be)+"). If you meant to render a collection of children, use an array instead.")}return De}function ye(be,Be,Ne){if(be==null)return be;var Ae=[],Re=0;return Ze(be,Ae,"","",function(We){return Be.call(Ne,We,Re++)}),Ae}function Ee(be){if(be._status===-1){var Be=be._result;Be=Be(),Be.then(function(Ne){(be._status===0||be._status===-1)&&(be._status=1,be._result=Ne)},function(Ne){(be._status===0||be._status===-1)&&(be._status=2,be._result=Ne)}),be._status===-1&&(be._status=0,be._result=Be)}if(be._status===1)return be._result.default;throw be._result}var Ve=typeof reportError=="function"?reportError:function(be){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Be=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof be=="object"&&be!==null&&typeof be.message=="string"?String(be.message):String(be),error:be});if(!window.dispatchEvent(Be))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",be);return}console.error(be)};function Ye(){}return react_production.Children={map:ye,forEach:function(be,Be,Ne){ye(be,function(){Be.apply(this,arguments)},Ne)},count:function(be){var Be=0;return ye(be,function(){Be++}),Be},toArray:function(be){return ye(be,function(Be){return Be})||[]},only:function(be){if(!ge(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},react_production.Component=$,react_production.Fragment=d,react_production.Profiler=I,react_production.PureComponent=ee,react_production.StrictMode=C,react_production.Suspense=_,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ne,react_production.act=function(){throw Error("act(...) is not supported in production builds of React.")},react_production.cache=function(be){return function(){return be.apply(null,arguments)}},react_production.cloneElement=function(be,Be,Ne){if(be==null)throw Error("The argument must be a React element, but you passed "+be+".");var Ae=F({},be.props),Re=be.key,We=void 0;if(Be!=null)for(De in Be.ref!==void 0&&(We=void 0),Be.key!==void 0&&(Re=""+Be.key),Be)!le.call(Be,De)||De==="key"||De==="__self"||De==="__source"||De==="ref"&&Be.ref===void 0||(Ae[De]=Be[De]);var De=arguments.length-2;if(De===1)Ae.children=Ne;else if(1<De){for(var Fe=Array(De),Ke=0;Ke<De;Ke++)Fe[Ke]=arguments[Ke+2];Ae.children=Fe}return ae(be.type,Re,void 0,void 0,We,Ae)},react_production.createContext=function(be){return be={$$typeof:y,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null},be.Provider=be,be.Consumer={$$typeof:f,_context:be},be},react_production.createElement=function(be,Be,Ne){var Ae,Re={},We=null;if(Be!=null)for(Ae in Be.key!==void 0&&(We=""+Be.key),Be)le.call(Be,Ae)&&Ae!=="key"&&Ae!=="__self"&&Ae!=="__source"&&(Re[Ae]=Be[Ae]);var De=arguments.length-2;if(De===1)Re.children=Ne;else if(1<De){for(var Fe=Array(De),Ke=0;Ke<De;Ke++)Fe[Ke]=arguments[Ke+2];Re.children=Fe}if(be&&be.defaultProps)for(Ae in De=be.defaultProps,De)Re[Ae]===void 0&&(Re[Ae]=De[Ae]);return ae(be,We,void 0,void 0,null,Re)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(be){return{$$typeof:B,render:be}},react_production.isValidElement=ge,react_production.lazy=function(be){return{$$typeof:M,_payload:{_status:-1,_result:be},_init:Ee}},react_production.memo=function(be,Be){return{$$typeof:Z,type:be,compare:Be===void 0?null:Be}},react_production.startTransition=function(be){var Be=ne.T,Ne={};ne.T=Ne;try{var Ae=be(),Re=ne.S;Re!==null&&Re(Ne,Ae),typeof Ae=="object"&&Ae!==null&&typeof Ae.then=="function"&&Ae.then(Ye,Ve)}catch(We){Ve(We)}finally{ne.T=Be}},react_production.unstable_useCacheRefresh=function(){return ne.H.useCacheRefresh()},react_production.use=function(be){return ne.H.use(be)},react_production.useActionState=function(be,Be,Ne){return ne.H.useActionState(be,Be,Ne)},react_production.useCallback=function(be,Be){return ne.H.useCallback(be,Be)},react_production.useContext=function(be){return ne.H.useContext(be)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(be,Be){return ne.H.useDeferredValue(be,Be)},react_production.useEffect=function(be,Be){return ne.H.useEffect(be,Be)},react_production.useId=function(){return ne.H.useId()},react_production.useImperativeHandle=function(be,Be,Ne){return ne.H.useImperativeHandle(be,Be,Ne)},react_production.useInsertionEffect=function(be,Be){return ne.H.useInsertionEffect(be,Be)},react_production.useLayoutEffect=function(be,Be){return ne.H.useLayoutEffect(be,Be)},react_production.useMemo=function(be,Be){return ne.H.useMemo(be,Be)},react_production.useOptimistic=function(be,Be){return ne.H.useOptimistic(be,Be)},react_production.useReducer=function(be,Be,Ne){return ne.H.useReducer(be,Be,Ne)},react_production.useRef=function(be){return ne.H.useRef(be)},react_production.useState=function(be){return ne.H.useState(be)},react_production.useSyncExternalStore=function(be,Be,Ne){return ne.H.useSyncExternalStore(be,Be,Ne)},react_production.useTransition=function(){return ne.H.useTransition()},react_production.version="19.0.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,function(u){function n(ye,Ee){var Ve=ye.length;ye.push(Ee);e:for(;0<Ve;){var Ye=Ve-1>>>1,be=ye[Ye];if(0<I(be,Ee))ye[Ye]=Ee,ye[Ve]=be,Ve=Ye;else break e}}function d(ye){return ye.length===0?null:ye[0]}function C(ye){if(ye.length===0)return null;var Ee=ye[0],Ve=ye.pop();if(Ve!==Ee){ye[0]=Ve;e:for(var Ye=0,be=ye.length,Be=be>>>1;Ye<Be;){var Ne=2*(Ye+1)-1,Ae=ye[Ne],Re=Ne+1,We=ye[Re];if(0>I(Ae,Ve))Re<be&&0>I(We,Ae)?(ye[Ye]=We,ye[Re]=Ve,Ye=Re):(ye[Ye]=Ae,ye[Ne]=Ve,Ye=Ne);else if(Re<be&&0>I(We,Ve))ye[Ye]=We,ye[Re]=Ve,Ye=Re;else break e}}return Ee}function I(ye,Ee){var Ve=ye.sortIndex-Ee.sortIndex;return Ve!==0?Ve:ye.id-Ee.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var f=performance;u.unstable_now=function(){return f.now()}}else{var y=Date,B=y.now();u.unstable_now=function(){return y.now()-B}}var _=[],Z=[],M=1,V=null,T=3,H=!1,F=!1,O=!1,$=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;function Q(ye){for(var Ee=d(Z);Ee!==null;){if(Ee.callback===null)C(Z);else if(Ee.startTime<=ye)C(Z),Ee.sortIndex=Ee.expirationTime,n(_,Ee);else break;Ee=d(Z)}}function ie(ye){if(O=!1,Q(ye),!F)if(d(_)!==null)F=!0,Ge();else{var Ee=d(Z);Ee!==null&&Ze(ie,Ee.startTime-ye)}}var ne=!1,le=-1,ae=5,ce=-1;function ge(){return!(u.unstable_now()-ce<ae)}function he(){if(ne){var ye=u.unstable_now();ce=ye;var Ee=!0;try{e:{F=!1,O&&(O=!1,U(le),le=-1),H=!0;var Ve=T;try{t:{for(Q(ye),V=d(_);V!==null&&!(V.expirationTime>ye&&ge());){var Ye=V.callback;if(typeof Ye=="function"){V.callback=null,T=V.priorityLevel;var be=Ye(V.expirationTime<=ye);if(ye=u.unstable_now(),typeof be=="function"){V.callback=be,Q(ye),Ee=!0;break t}V===d(_)&&C(_),Q(ye)}else C(_);V=d(_)}if(V!==null)Ee=!0;else{var Be=d(Z);Be!==null&&Ze(ie,Be.startTime-ye),Ee=!1}}break e}finally{V=null,T=Ve,H=!1}Ee=void 0}}finally{Ee?Ie():ne=!1}}}var Ie;if(typeof ee=="function")Ie=function(){ee(he)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,me=fe.port2;fe.port1.onmessage=he,Ie=function(){me.postMessage(null)}}else Ie=function(){$(he,0)};function Ge(){ne||(ne=!0,Ie())}function Ze(ye,Ee){le=$(function(){ye(u.unstable_now())},Ee)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(ye){ye.callback=null},u.unstable_continueExecution=function(){F||H||(F=!0,Ge())},u.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<ye?Math.floor(1e3/ye):5},u.unstable_getCurrentPriorityLevel=function(){return T},u.unstable_getFirstCallbackNode=function(){return d(_)},u.unstable_next=function(ye){switch(T){case 1:case 2:case 3:var Ee=3;break;default:Ee=T}var Ve=T;T=Ee;try{return ye()}finally{T=Ve}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(ye,Ee){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var Ve=T;T=ye;try{return Ee()}finally{T=Ve}},u.unstable_scheduleCallback=function(ye,Ee,Ve){var Ye=u.unstable_now();switch(typeof Ve=="object"&&Ve!==null?(Ve=Ve.delay,Ve=typeof Ve=="number"&&0<Ve?Ye+Ve:Ye):Ve=Ye,ye){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Ve+be,ye={id:M++,callback:Ee,priorityLevel:ye,startTime:Ve,expirationTime:be,sortIndex:-1},Ve>Ye?(ye.sortIndex=Ve,n(Z,ye),d(_)===null&&ye===d(Z)&&(O?(U(le),le=-1):O=!0,Ze(ie,Ve-Ye))):(ye.sortIndex=be,n(_,ye),F||H||(F=!0,Ge())),ye},u.unstable_shouldYield=ge,u.unstable_wrapCallback=function(ye){var Ee=T;return function(){var Ve=T;T=Ee;try{return ye.apply(this,arguments)}finally{T=Ve}}}}(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var u=requireReact();function n(_){var Z="https://react.dev/errors/"+_;if(1<arguments.length){Z+="?args[]="+encodeURIComponent(arguments[1]);for(var M=2;M<arguments.length;M++)Z+="&args[]="+encodeURIComponent(arguments[M])}return"Minified React error #"+_+"; visit "+Z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(){}var C={d:{f:d,r:function(){throw Error(n(522))},D:d,C:d,L:d,m:d,X:d,S:d,M:d},p:0,findDOMNode:null},I=Symbol.for("react.portal");function f(_,Z,M){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:V==null?null:""+V,children:_,containerInfo:Z,implementation:M}}var y=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function B(_,Z){if(_==="font")return"";if(typeof Z=="string")return Z==="use-credentials"?Z:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,reactDom_production.createPortal=function(_,Z){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Z||Z.nodeType!==1&&Z.nodeType!==9&&Z.nodeType!==11)throw Error(n(299));return f(_,Z,null,M)},reactDom_production.flushSync=function(_){var Z=y.T,M=C.p;try{if(y.T=null,C.p=2,_)return _()}finally{y.T=Z,C.p=M,C.d.f()}},reactDom_production.preconnect=function(_,Z){typeof _=="string"&&(Z?(Z=Z.crossOrigin,Z=typeof Z=="string"?Z==="use-credentials"?Z:"":void 0):Z=null,C.d.C(_,Z))},reactDom_production.prefetchDNS=function(_){typeof _=="string"&&C.d.D(_)},reactDom_production.preinit=function(_,Z){if(typeof _=="string"&&Z&&typeof Z.as=="string"){var M=Z.as,V=B(M,Z.crossOrigin),T=typeof Z.integrity=="string"?Z.integrity:void 0,H=typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0;M==="style"?C.d.S(_,typeof Z.precedence=="string"?Z.precedence:void 0,{crossOrigin:V,integrity:T,fetchPriority:H}):M==="script"&&C.d.X(_,{crossOrigin:V,integrity:T,fetchPriority:H,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}},reactDom_production.preinitModule=function(_,Z){if(typeof _=="string")if(typeof Z=="object"&&Z!==null){if(Z.as==null||Z.as==="script"){var M=B(Z.as,Z.crossOrigin);C.d.M(_,{crossOrigin:M,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}}else Z==null&&C.d.M(_)},reactDom_production.preload=function(_,Z){if(typeof _=="string"&&typeof Z=="object"&&Z!==null&&typeof Z.as=="string"){var M=Z.as,V=B(M,Z.crossOrigin);C.d.L(_,M,{crossOrigin:V,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0,type:typeof Z.type=="string"?Z.type:void 0,fetchPriority:typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0,referrerPolicy:typeof Z.referrerPolicy=="string"?Z.referrerPolicy:void 0,imageSrcSet:typeof Z.imageSrcSet=="string"?Z.imageSrcSet:void 0,imageSizes:typeof Z.imageSizes=="string"?Z.imageSizes:void 0,media:typeof Z.media=="string"?Z.media:void 0})}},reactDom_production.preloadModule=function(_,Z){if(typeof _=="string")if(Z){var M=B(Z.as,Z.crossOrigin);C.d.m(_,{as:typeof Z.as=="string"&&Z.as!=="script"?Z.as:void 0,crossOrigin:M,integrity:typeof Z.integrity=="string"?Z.integrity:void 0})}else C.d.m(_)},reactDom_production.requestFormReset=function(_){C.d.r(_)},reactDom_production.unstable_batchedUpdates=function(_,Z){return _(Z)},reactDom_production.useFormState=function(_,Z,M){return y.H.useFormState(_,Z,M)},reactDom_production.useFormStatus=function(){return y.H.useHostTransitionStatus()},reactDom_production.version="19.0.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var u=requireScheduler(),n=requireReact(),d=requireReactDom();function C(N){var Y="https://react.dev/errors/"+N;if(1<arguments.length){Y+="?args[]="+encodeURIComponent(arguments[1]);for(var K=2;K<arguments.length;K++)Y+="&args[]="+encodeURIComponent(arguments[K])}return"Minified React error #"+N+"; visit "+Y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function I(N){return!(!N||N.nodeType!==1&&N.nodeType!==9&&N.nodeType!==11)}var f=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),B=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),T=Symbol.for("react.consumer"),H=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),Q=Symbol.for("react.offscreen"),ie=Symbol.for("react.memo_cache_sentinel"),ne=Symbol.iterator;function le(N){return N===null||typeof N!="object"?null:(N=ne&&N[ne]||N["@@iterator"],typeof N=="function"?N:null)}var ae=Symbol.for("react.client.reference");function ce(N){if(N==null)return null;if(typeof N=="function")return N.$$typeof===ae?null:N.displayName||N.name||null;if(typeof N=="string")return N;switch(N){case _:return"Fragment";case B:return"Portal";case M:return"Profiler";case Z:return"StrictMode";case O:return"Suspense";case $:return"SuspenseList"}if(typeof N=="object")switch(N.$$typeof){case H:return(N.displayName||"Context")+".Provider";case T:return(N._context.displayName||"Context")+".Consumer";case F:var Y=N.render;return N=N.displayName,N||(N=Y.displayName||Y.name||"",N=N!==""?"ForwardRef("+N+")":"ForwardRef"),N;case U:return Y=N.displayName||null,Y!==null?Y:ce(N.type)||"Memo";case ee:Y=N._payload,N=N._init;try{return ce(N(Y))}catch{}}return null}var ge=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he=Object.assign,Ie,fe;function me(N){if(Ie===void 0)try{throw Error()}catch(K){var Y=K.stack.trim().match(/\n( *(at )?)/);Ie=Y&&Y[1]||"",fe=-1<K.stack.indexOf(`
    at`)?" (<anonymous>)":-1<K.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ie+N+fe}var Ge=!1;function Ze(N,Y){if(!N||Ge)return"";Ge=!0;var K=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var te={DetermineComponentFrameRoot:function(){try{if(Y){var Vt=function(){throw Error()};if(Object.defineProperty(Vt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Vt,[])}catch(yt){var gt=yt}Reflect.construct(N,[],Vt)}else{try{Vt.call()}catch(yt){gt=yt}N.call(Vt.prototype)}}else{try{throw Error()}catch(yt){gt=yt}(Vt=N())&&typeof Vt.catch=="function"&&Vt.catch(function(){})}}catch(yt){if(yt&&gt&&typeof yt.stack=="string")return[yt.stack,gt.stack]}return[null,null]}};te.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var oe=Object.getOwnPropertyDescriptor(te.DetermineComponentFrameRoot,"name");oe&&oe.configurable&&Object.defineProperty(te.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var ue=te.DetermineComponentFrameRoot(),pe=ue[0],xe=ue[1];if(pe&&xe){var Te=pe.split(`
`),Oe=xe.split(`
`);for(oe=te=0;te<Te.length&&!Te[te].includes("DetermineComponentFrameRoot");)te++;for(;oe<Oe.length&&!Oe[oe].includes("DetermineComponentFrameRoot");)oe++;if(te===Te.length||oe===Oe.length)for(te=Te.length-1,oe=Oe.length-1;1<=te&&0<=oe&&Te[te]!==Oe[oe];)oe--;for(;1<=te&&0<=oe;te--,oe--)if(Te[te]!==Oe[oe]){if(te!==1||oe!==1)do if(te--,oe--,0>oe||Te[te]!==Oe[oe]){var Bt=`
`+Te[te].replace(" at new "," at ");return N.displayName&&Bt.includes("<anonymous>")&&(Bt=Bt.replace("<anonymous>",N.displayName)),Bt}while(1<=te&&0<=oe);break}}}finally{Ge=!1,Error.prepareStackTrace=K}return(K=N?N.displayName||N.name:"")?me(K):""}function ye(N){switch(N.tag){case 26:case 27:case 5:return me(N.type);case 16:return me("Lazy");case 13:return me("Suspense");case 19:return me("SuspenseList");case 0:case 15:return N=Ze(N.type,!1),N;case 11:return N=Ze(N.type.render,!1),N;case 1:return N=Ze(N.type,!0),N;default:return""}}function Ee(N){try{var Y="";do Y+=ye(N),N=N.return;while(N);return Y}catch(K){return`
Error generating stack: `+K.message+`
`+K.stack}}function Ve(N){var Y=N,K=N;if(N.alternate)for(;Y.return;)Y=Y.return;else{N=Y;do Y=N,(Y.flags&4098)!==0&&(K=Y.return),N=Y.return;while(N)}return Y.tag===3?K:null}function Ye(N){if(N.tag===13){var Y=N.memoizedState;if(Y===null&&(N=N.alternate,N!==null&&(Y=N.memoizedState)),Y!==null)return Y.dehydrated}return null}function be(N){if(Ve(N)!==N)throw Error(C(188))}function Be(N){var Y=N.alternate;if(!Y){if(Y=Ve(N),Y===null)throw Error(C(188));return Y!==N?null:N}for(var K=N,te=Y;;){var oe=K.return;if(oe===null)break;var ue=oe.alternate;if(ue===null){if(te=oe.return,te!==null){K=te;continue}break}if(oe.child===ue.child){for(ue=oe.child;ue;){if(ue===K)return be(oe),N;if(ue===te)return be(oe),Y;ue=ue.sibling}throw Error(C(188))}if(K.return!==te.return)K=oe,te=ue;else{for(var pe=!1,xe=oe.child;xe;){if(xe===K){pe=!0,K=oe,te=ue;break}if(xe===te){pe=!0,te=oe,K=ue;break}xe=xe.sibling}if(!pe){for(xe=ue.child;xe;){if(xe===K){pe=!0,K=ue,te=oe;break}if(xe===te){pe=!0,te=ue,K=oe;break}xe=xe.sibling}if(!pe)throw Error(C(189))}}if(K.alternate!==te)throw Error(C(190))}if(K.tag!==3)throw Error(C(188));return K.stateNode.current===K?N:Y}function Ne(N){var Y=N.tag;if(Y===5||Y===26||Y===27||Y===6)return N;for(N=N.child;N!==null;){if(Y=Ne(N),Y!==null)return Y;N=N.sibling}return null}var Ae=Array.isArray,Re=d.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We={pending:!1,data:null,method:null,action:null},De=[],Fe=-1;function Ke(N){return{current:N}}function Rt(N){0>Fe||(N.current=De[Fe],De[Fe]=null,Fe--)}function dt(N,Y){Fe++,De[Fe]=N.current,N.current=Y}var Ut=Ke(null),rt=Ke(null),nt=Ke(null),we=Ke(null);function Jt(N,Y){switch(dt(nt,Y),dt(rt,N),dt(Ut,null),N=Y.nodeType,N){case 9:case 11:Y=(Y=Y.documentElement)&&(Y=Y.namespaceURI)?Vd(Y):0;break;default:if(N=N===8?Y.parentNode:Y,Y=N.tagName,N=N.namespaceURI)N=Vd(N),Y=Ed(N,Y);else switch(Y){case"svg":Y=1;break;case"math":Y=2;break;default:Y=0}}Rt(Ut),dt(Ut,Y)}function It(){Rt(Ut),Rt(rt),Rt(nt)}function Ht(N){N.memoizedState!==null&&dt(we,N);var Y=Ut.current,K=Ed(Y,N.type);Y!==K&&(dt(rt,N),dt(Ut,K))}function mt(N){rt.current===N&&(Rt(Ut),Rt(rt)),we.current===N&&(Rt(we),cu._currentValue=We)}var ni=Object.prototype.hasOwnProperty,kt=u.unstable_scheduleCallback,Me=u.unstable_cancelCallback,ve=u.unstable_shouldYield,et=u.unstable_requestPaint,ht=u.unstable_now,Xt=u.unstable_getCurrentPriorityLevel,Ue=u.unstable_ImmediatePriority,ft=u.unstable_UserBlockingPriority,Dt=u.unstable_NormalPriority,jt=u.unstable_LowPriority,ii=u.unstable_IdlePriority,it=u.log,Gt=u.unstable_setDisableYieldValue,Zt=null,Nt=null;function _t(N){if(Nt&&typeof Nt.onCommitFiberRoot=="function")try{Nt.onCommitFiberRoot(Zt,N,void 0,(N.current.flags&128)===128)}catch{}}function _e(N){if(typeof it=="function"&&Gt(N),Nt&&typeof Nt.setStrictMode=="function")try{Nt.setStrictMode(Zt,N)}catch{}}var Pe=Math.clz32?Math.clz32:Kt,Je=Math.log,ze=Math.LN2;function Kt(N){return N>>>=0,N===0?32:31-(Je(N)/ze|0)|0}var ct=128,bt=4194304;function Tt(N){var Y=N&42;if(Y!==0)return Y;switch(N&-N){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return N&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return N&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return N}}function $t(N,Y){var K=N.pendingLanes;if(K===0)return 0;var te=0,oe=N.suspendedLanes,ue=N.pingedLanes,pe=N.warmLanes;N=N.finishedLanes!==0;var xe=K&134217727;return xe!==0?(K=xe&~oe,K!==0?te=Tt(K):(ue&=xe,ue!==0?te=Tt(ue):N||(pe=xe&~pe,pe!==0&&(te=Tt(pe))))):(xe=K&~oe,xe!==0?te=Tt(xe):ue!==0?te=Tt(ue):N||(pe=K&~pe,pe!==0&&(te=Tt(pe)))),te===0?0:Y!==0&&Y!==te&&(Y&oe)===0&&(oe=te&-te,pe=Y&-Y,oe>=pe||oe===32&&(pe&4194176)!==0)?Y:te}function si(N,Y){return(N.pendingLanes&~(N.suspendedLanes&~N.pingedLanes)&Y)===0}function Bi(N,Y){switch(N){case 1:case 2:case 4:case 8:return Y+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return Y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ki(){var N=ct;return ct<<=1,(ct&4194176)===0&&(ct=128),N}function Gi(){var N=bt;return bt<<=1,(bt&62914560)===0&&(bt=4194304),N}function _i(N){for(var Y=[],K=0;31>K;K++)Y.push(N);return Y}function Di(N,Y){N.pendingLanes|=Y,Y!==268435456&&(N.suspendedLanes=0,N.pingedLanes=0,N.warmLanes=0)}function Fn(N,Y,K,te,oe,ue){var pe=N.pendingLanes;N.pendingLanes=K,N.suspendedLanes=0,N.pingedLanes=0,N.warmLanes=0,N.expiredLanes&=K,N.entangledLanes&=K,N.errorRecoveryDisabledLanes&=K,N.shellSuspendCounter=0;var xe=N.entanglements,Te=N.expirationTimes,Oe=N.hiddenUpdates;for(K=pe&~K;0<K;){var Bt=31-Pe(K),Vt=1<<Bt;xe[Bt]=0,Te[Bt]=-1;var gt=Oe[Bt];if(gt!==null)for(Oe[Bt]=null,Bt=0;Bt<gt.length;Bt++){var yt=gt[Bt];yt!==null&&(yt.lane&=-536870913)}K&=~Vt}te!==0&&no(N,te,0),ue!==0&&oe===0&&N.tag!==0&&(N.suspendedLanes|=ue&~(pe&~Y))}function no(N,Y,K){N.pendingLanes|=Y,N.suspendedLanes&=~Y;var te=31-Pe(Y);N.entangledLanes|=Y,N.entanglements[te]=N.entanglements[te]|1073741824|K&4194218}function Tn(N,Y){var K=N.entangledLanes|=Y;for(N=N.entanglements;K;){var te=31-Pe(K),oe=1<<te;oe&Y|N[te]&Y&&(N[te]|=Y),K&=~oe}}function Ln(N){return N&=-N,2<N?8<N?(N&134217727)!==0?32:268435456:8:2}function qn(){var N=Re.p;return N!==0?N:(N=window.event,N===void 0?32:qd(N.type))}function vs(N,Y){var K=Re.p;try{return Re.p=N,Y()}finally{Re.p=K}}var sn=Math.random().toString(36).slice(2),on="__reactFiber$"+sn,pi="__reactProps$"+sn,so="__reactContainer$"+sn,Ir="__reactEvents$"+sn,oc="__reactListeners$"+sn,rc="__reactHandles$"+sn,ac="__reactResources$"+sn,Wo="__reactMarker$"+sn;function Qr(N){delete N[on],delete N[pi],delete N[Ir],delete N[oc],delete N[rc]}function oo(N){var Y=N[on];if(Y)return Y;for(var K=N.parentNode;K;){if(Y=K[so]||K[on]){if(K=Y.alternate,Y.child!==null||K!==null&&K.child!==null)for(N=Td(N);N!==null;){if(K=N[on])return K;N=Td(N)}return Y}N=K,K=N.parentNode}return null}function Se(N){if(N=N[on]||N[so]){var Y=N.tag;if(Y===5||Y===6||Y===13||Y===26||Y===27||Y===3)return N}return null}function Le(N){var Y=N.tag;if(Y===5||Y===26||Y===27||Y===6)return N.stateNode;throw Error(C(33))}function ot(N){var Y=N[ac];return Y||(Y=N[ac]={hoistableStyles:new Map,hoistableScripts:new Map}),Y}function tt(N){N[Wo]=!0}var $e=new Set,Mt={};function Qt(N,Y){ei(N,Y),ei(N+"Capture",Y)}function ei(N,Y){for(Mt[N]=Y,N=0;N<Y.length;N++)$e.add(Y[N])}var qt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),di=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ci={},li={};function Ni(N){return ni.call(li,N)?!0:ni.call(Ci,N)?!1:di.test(N)?li[N]=!0:(Ci[N]=!0,!1)}function Vi(N,Y,K){if(Ni(Y))if(K===null)N.removeAttribute(Y);else{switch(typeof K){case"undefined":case"function":case"symbol":N.removeAttribute(Y);return;case"boolean":var te=Y.toLowerCase().slice(0,5);if(te!=="data-"&&te!=="aria-"){N.removeAttribute(Y);return}}N.setAttribute(Y,""+K)}}function rn(N,Y,K){if(K===null)N.removeAttribute(Y);else{switch(typeof K){case"undefined":case"function":case"symbol":case"boolean":N.removeAttribute(Y);return}N.setAttribute(Y,""+K)}}function Ti(N,Y,K,te){if(te===null)N.removeAttribute(K);else{switch(typeof te){case"undefined":case"function":case"symbol":case"boolean":N.removeAttribute(K);return}N.setAttributeNS(Y,K,""+te)}}function mi(N){switch(typeof N){case"bigint":case"boolean":case"number":case"string":case"undefined":return N;case"object":return N;default:return""}}function ci(N){var Y=N.type;return(N=N.nodeName)&&N.toLowerCase()==="input"&&(Y==="checkbox"||Y==="radio")}function _n(N){var Y=ci(N)?"checked":"value",K=Object.getOwnPropertyDescriptor(N.constructor.prototype,Y),te=""+N[Y];if(!N.hasOwnProperty(Y)&&typeof K<"u"&&typeof K.get=="function"&&typeof K.set=="function"){var oe=K.get,ue=K.set;return Object.defineProperty(N,Y,{configurable:!0,get:function(){return oe.call(this)},set:function(pe){te=""+pe,ue.call(this,pe)}}),Object.defineProperty(N,Y,{enumerable:K.enumerable}),{getValue:function(){return te},setValue:function(pe){te=""+pe},stopTracking:function(){N._valueTracker=null,delete N[Y]}}}}function Ei(N){N._valueTracker||(N._valueTracker=_n(N))}function hs(N){if(!N)return!1;var Y=N._valueTracker;if(!Y)return!0;var K=Y.getValue(),te="";return N&&(te=ci(N)?N.checked?"true":"false":N.value),N=te,N!==K?(Y.setValue(N),!0):!1}function Vs(N){if(N=N||(typeof document<"u"?document:void 0),typeof N>"u")return null;try{return N.activeElement||N.body}catch{return N.body}}var es=/[\n"\\]/g;function Jn(N){return N.replace(es,function(Y){return"\\"+Y.charCodeAt(0).toString(16)+" "})}function Oi(N,Y,K,te,oe,ue,pe,xe){N.name="",pe!=null&&typeof pe!="function"&&typeof pe!="symbol"&&typeof pe!="boolean"?N.type=pe:N.removeAttribute("type"),Y!=null?pe==="number"?(Y===0&&N.value===""||N.value!=Y)&&(N.value=""+mi(Y)):N.value!==""+mi(Y)&&(N.value=""+mi(Y)):pe!=="submit"&&pe!=="reset"||N.removeAttribute("value"),Y!=null?On(N,pe,mi(Y)):K!=null?On(N,pe,mi(K)):te!=null&&N.removeAttribute("value"),oe==null&&ue!=null&&(N.defaultChecked=!!ue),oe!=null&&(N.checked=oe&&typeof oe!="function"&&typeof oe!="symbol"),xe!=null&&typeof xe!="function"&&typeof xe!="symbol"&&typeof xe!="boolean"?N.name=""+mi(xe):N.removeAttribute("name")}function ts(N,Y,K,te,oe,ue,pe,xe){if(ue!=null&&typeof ue!="function"&&typeof ue!="symbol"&&typeof ue!="boolean"&&(N.type=ue),Y!=null||K!=null){if(!(ue!=="submit"&&ue!=="reset"||Y!=null))return;K=K!=null?""+mi(K):"",Y=Y!=null?""+mi(Y):K,xe||Y===N.value||(N.value=Y),N.defaultValue=Y}te=te??oe,te=typeof te!="function"&&typeof te!="symbol"&&!!te,N.checked=xe?N.checked:!!te,N.defaultChecked=!!te,pe!=null&&typeof pe!="function"&&typeof pe!="symbol"&&typeof pe!="boolean"&&(N.name=pe)}function On(N,Y,K){Y==="number"&&Vs(N.ownerDocument)===N||N.defaultValue===""+K||(N.defaultValue=""+K)}function mn(N,Y,K,te){if(N=N.options,Y){Y={};for(var oe=0;oe<K.length;oe++)Y["$"+K[oe]]=!0;for(K=0;K<N.length;K++)oe=Y.hasOwnProperty("$"+N[K].value),N[K].selected!==oe&&(N[K].selected=oe),oe&&te&&(N[K].defaultSelected=!0)}else{for(K=""+mi(K),Y=null,oe=0;oe<N.length;oe++){if(N[oe].value===K){N[oe].selected=!0,te&&(N[oe].defaultSelected=!0);return}Y!==null||N[oe].disabled||(Y=N[oe])}Y!==null&&(Y.selected=!0)}}function Kn(N,Y,K){if(Y!=null&&(Y=""+mi(Y),Y!==N.value&&(N.value=Y),K==null)){N.defaultValue!==Y&&(N.defaultValue=Y);return}N.defaultValue=K!=null?""+mi(K):""}function ro(N,Y,K,te){if(Y==null){if(te!=null){if(K!=null)throw Error(C(92));if(Ae(te)){if(1<te.length)throw Error(C(93));te=te[0]}K=te}K==null&&(K=""),Y=K}K=mi(Y),N.defaultValue=K,te=N.textContent,te===K&&te!==""&&te!==null&&(N.value=te)}function ds(N,Y){if(Y){var K=N.firstChild;if(K&&K===N.lastChild&&K.nodeType===3){K.nodeValue=Y;return}}N.textContent=Y}var lc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pl(N,Y,K){var te=Y.indexOf("--")===0;K==null||typeof K=="boolean"||K===""?te?N.setProperty(Y,""):Y==="float"?N.cssFloat="":N[Y]="":te?N.setProperty(Y,K):typeof K!="number"||K===0||lc.has(Y)?Y==="float"?N.cssFloat=K:N[Y]=(""+K).trim():N[Y]=K+"px"}function ng(N,Y,K){if(Y!=null&&typeof Y!="object")throw Error(C(62));if(N=N.style,K!=null){for(var te in K)!K.hasOwnProperty(te)||Y!=null&&Y.hasOwnProperty(te)||(te.indexOf("--")===0?N.setProperty(te,""):te==="float"?N.cssFloat="":N[te]="");for(var oe in Y)te=Y[oe],Y.hasOwnProperty(oe)&&K[oe]!==te&&pl(N,oe,te)}else for(var ue in Y)Y.hasOwnProperty(ue)&&pl(N,ue,Y[ue])}function ml(N){if(N.indexOf("-")===-1)return!1;switch(N){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Iu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Al(N){return Iu.test(""+N)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":N}var cc=null;function bl(N){return N=N.target||N.srcElement||window,N.correspondingUseElement&&(N=N.correspondingUseElement),N.nodeType===3?N.parentNode:N}var qr=null,ea=null;function gc(N){var Y=Se(N);if(Y&&(N=Y.stateNode)){var K=N[pi]||null;e:switch(N=Y.stateNode,Y.type){case"input":if(Oi(N,K.value,K.defaultValue,K.defaultValue,K.checked,K.defaultChecked,K.type,K.name),Y=K.name,K.type==="radio"&&Y!=null){for(K=N;K.parentNode;)K=K.parentNode;for(K=K.querySelectorAll('input[name="'+Jn(""+Y)+'"][type="radio"]'),Y=0;Y<K.length;Y++){var te=K[Y];if(te!==N&&te.form===N.form){var oe=te[pi]||null;if(!oe)throw Error(C(90));Oi(te,oe.value,oe.defaultValue,oe.defaultValue,oe.checked,oe.defaultChecked,oe.type,oe.name)}}for(Y=0;Y<K.length;Y++)te=K[Y],te.form===N.form&&hs(te)}break e;case"textarea":Kn(N,K.value,K.defaultValue);break e;case"select":Y=K.value,Y!=null&&mn(N,!!K.multiple,Y,!1)}}}var uc=!1;function sg(N,Y,K){if(uc)return N(Y,K);uc=!0;try{var te=N(Y);return te}finally{if(uc=!1,(qr!==null||ea!==null)&&(xa(),qr&&(Y=qr,N=ea,ea=qr=null,gc(Y),N)))for(Y=0;Y<N.length;Y++)gc(N[Y])}}function Za(N,Y){var K=N.stateNode;if(K===null)return null;var te=K[pi]||null;if(te===null)return null;K=te[Y];e:switch(Y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(te=!te.disabled)||(N=N.type,te=!(N==="button"||N==="input"||N==="select"||N==="textarea")),N=!te;break e;default:N=!1}if(N)return null;if(K&&typeof K!="function")throw Error(C(231,Y,typeof K));return K}var yl=!1;if(qt)try{var Ma={};Object.defineProperty(Ma,"passive",{get:function(){yl=!0}}),window.addEventListener("test",Ma,Ma),window.removeEventListener("test",Ma,Ma)}catch{yl=!1}var Yo=null,og=null,hc=null;function rg(){if(hc)return hc;var N,Y=og,K=Y.length,te,oe="value"in Yo?Yo.value:Yo.textContent,ue=oe.length;for(N=0;N<K&&Y[N]===oe[N];N++);var pe=K-N;for(te=1;te<=pe&&Y[K-te]===oe[ue-te];te++);return hc=oe.slice(N,1<te?1-te:void 0)}function fr(N){var Y=N.keyCode;return"charCode"in N?(N=N.charCode,N===0&&Y===13&&(N=13)):N=Y,N===10&&(N=13),32<=N||N===13?N:0}function Na(){return!0}function Gl(){return!1}function Cs(N){function Y(K,te,oe,ue,pe){this._reactName=K,this._targetInst=oe,this.type=te,this.nativeEvent=ue,this.target=pe,this.currentTarget=null;for(var xe in N)N.hasOwnProperty(xe)&&(K=N[xe],this[xe]=K?K(ue):ue[xe]);return this.isDefaultPrevented=(ue.defaultPrevented!=null?ue.defaultPrevented:ue.returnValue===!1)?Na:Gl,this.isPropagationStopped=Gl,this}return he(Y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var K=this.nativeEvent;K&&(K.preventDefault?K.preventDefault():typeof K.returnValue!="unknown"&&(K.returnValue=!1),this.isDefaultPrevented=Na)},stopPropagation:function(){var K=this.nativeEvent;K&&(K.stopPropagation?K.stopPropagation():typeof K.cancelBubble!="unknown"&&(K.cancelBubble=!0),this.isPropagationStopped=Na)},persist:function(){},isPersistent:Na}),Y}var pr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(N){return N.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Va=Cs(pr),Ea=he({},pr,{view:0,detail:0}),fu=Cs(Ea),To,Wa,Ya,Ta=he({},Ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bl,button:0,buttons:0,relatedTarget:function(N){return N.relatedTarget===void 0?N.fromElement===N.srcElement?N.toElement:N.fromElement:N.relatedTarget},movementX:function(N){return"movementX"in N?N.movementX:(N!==Ya&&(Ya&&N.type==="mousemove"?(To=N.screenX-Ya.screenX,Wa=N.screenY-Ya.screenY):Wa=To=0,Ya=N),To)},movementY:function(N){return"movementY"in N?N.movementY:Wa}}),ag=Cs(Ta),pu=he({},Ta,{dataTransfer:0}),Lh=Cs(pu),Un=he({},Ea,{relatedTarget:0}),dc=Cs(Un),mu=he({},pr,{animationName:0,elapsedTime:0,pseudoElement:0}),Au=Cs(mu),bu=he({},pr,{clipboardData:function(N){return"clipboardData"in N?N.clipboardData:window.clipboardData}}),yu=Cs(bu),vl=he({},pr,{data:0}),Cc=Cs(vl),Gu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lg(N){var Y=this.nativeEvent;return Y.getModifierState?Y.getModifierState(N):(N=Bu[N])?!!Y[N]:!1}function Bl(){return lg}var Su=he({},Ea,{key:function(N){if(N.key){var Y=Gu[N.key]||N.key;if(Y!=="Unidentified")return Y}return N.type==="keypress"?(N=fr(N),N===13?"Enter":String.fromCharCode(N)):N.type==="keydown"||N.type==="keyup"?vu[N.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bl,charCode:function(N){return N.type==="keypress"?fr(N):0},keyCode:function(N){return N.type==="keydown"||N.type==="keyup"?N.keyCode:0},which:function(N){return N.type==="keypress"?fr(N):N.type==="keydown"||N.type==="keyup"?N.keyCode:0}}),cg=Cs(Su),gg=he({},Ta,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ic=Cs(gg),xu=he({},Ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bl}),ug=Cs(xu),Xu=he({},pr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jo=Cs(Xu),hg=he({},Ta,{deltaX:function(N){return"deltaX"in N?N.deltaX:"wheelDeltaX"in N?-N.wheelDeltaX:0},deltaY:function(N){return"deltaY"in N?N.deltaY:"wheelDeltaY"in N?-N.wheelDeltaY:"wheelDelta"in N?-N.wheelDelta:0},deltaZ:0,deltaMode:0}),Kh=Cs(hg),Ru=he({},pr,{newState:0,oldState:0}),mr=Cs(Ru),Ho=[9,13,27,32],Sl=qt&&"CompositionEvent"in window,ta=null;qt&&"documentMode"in document&&(ta=document.documentMode);var xl=qt&&"TextEvent"in window&&!ta,Xl=qt&&(!Sl||ta&&8<ta&&11>=ta),Ar=" ",$n=!1;function Rl(N,Y){switch(N){case"keyup":return Ho.indexOf(Y.keyCode)!==-1;case"keydown":return Y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dg(N){return N=N.detail,typeof N=="object"&&"data"in N?N.data:null}var br=!1;function _l(N,Y){switch(N){case"compositionend":return dg(Y);case"keypress":return Y.which!==32?null:($n=!0,Ar);case"textInput":return N=Y.data,N===Ar&&$n?null:N;default:return null}}function Cg(N,Y){if(br)return N==="compositionend"||!Sl&&Rl(N,Y)?(N=rg(),hc=og=Yo=null,br=!1,N):null;switch(N){case"paste":return null;case"keypress":if(!(Y.ctrlKey||Y.altKey||Y.metaKey)||Y.ctrlKey&&Y.altKey){if(Y.char&&1<Y.char.length)return Y.char;if(Y.which)return String.fromCharCode(Y.which)}return null;case"compositionend":return Xl&&Y.locale!=="ko"?null:Y.data;default:return null}}var fc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ig(N){var Y=N&&N.nodeName&&N.nodeName.toLowerCase();return Y==="input"?!!fc[N.type]:Y==="textarea"}function Bs(N,Y,K,te){qr?ea?ea.push(te):ea=[te]:qr=te,Y=Rh(Y,"onChange"),0<Y.length&&(K=new Va("onChange","change",null,K,te),N.push({event:K,listeners:Y}))}var Ja=null,ia=null;function _u(N){_d(N,0)}function wl(N){var Y=Le(N);if(hs(Y))return N}function pc(N,Y){if(N==="change")return Y}var mc=!1;if(qt){var Ac;if(qt){var Ha="oninput"in document;if(!Ha){var za=document.createElement("div");za.setAttribute("oninput","return;"),Ha=typeof za.oninput=="function"}Ac=Ha}else Ac=!1;mc=Ac&&(!document.documentMode||9<document.documentMode)}function dn(){Ja&&(Ja.detachEvent("onpropertychange",wu),ia=Ja=null)}function wu(N){if(N.propertyName==="value"&&wl(ia)){var Y=[];Bs(Y,ia,N,bl(N)),sg(_u,Y)}}function Ph(N,Y,K){N==="focusin"?(dn(),Ja=Y,ia=K,Ja.attachEvent("onpropertychange",wu)):N==="focusout"&&dn()}function Zu(N){if(N==="selectionchange"||N==="keyup"||N==="keydown")return wl(ia)}function Zl(N,Y){if(N==="click")return wl(Y)}function yr(N,Y){if(N==="input"||N==="change")return wl(Y)}function Mu(N,Y){return N===Y&&(N!==0||1/N===1/Y)||N!==N&&Y!==Y}var Ss=typeof Object.is=="function"?Object.is:Mu;function ao(N,Y){if(Ss(N,Y))return!0;if(typeof N!="object"||N===null||typeof Y!="object"||Y===null)return!1;var K=Object.keys(N),te=Object.keys(Y);if(K.length!==te.length)return!1;for(te=0;te<K.length;te++){var oe=K[te];if(!ni.call(Y,oe)||!Ss(N[oe],Y[oe]))return!1}return!0}function xs(N){for(;N&&N.firstChild;)N=N.firstChild;return N}function fg(N,Y){var K=xs(N);N=0;for(var te;K;){if(K.nodeType===3){if(te=N+K.textContent.length,N<=Y&&te>=Y)return{node:K,offset:Y-N};N=te}e:{for(;K;){if(K.nextSibling){K=K.nextSibling;break e}K=K.parentNode}K=void 0}K=xs(K)}}function pg(N,Y){return N&&Y?N===Y?!0:N&&N.nodeType===3?!1:Y&&Y.nodeType===3?pg(N,Y.parentNode):"contains"in N?N.contains(Y):N.compareDocumentPosition?!!(N.compareDocumentPosition(Y)&16):!1:!1}function mg(N){N=N!=null&&N.ownerDocument!=null&&N.ownerDocument.defaultView!=null?N.ownerDocument.defaultView:window;for(var Y=Vs(N.document);Y instanceof N.HTMLIFrameElement;){try{var K=typeof Y.contentWindow.location.href=="string"}catch{K=!1}if(K)N=Y.contentWindow;else break;Y=Vs(N.document)}return Y}function Ml(N){var Y=N&&N.nodeName&&N.nodeName.toLowerCase();return Y&&(Y==="input"&&(N.type==="text"||N.type==="search"||N.type==="tel"||N.type==="url"||N.type==="password")||Y==="textarea"||N.contentEditable==="true")}function Ag(N,Y){var K=mg(Y);Y=N.focusedElem;var te=N.selectionRange;if(K!==Y&&Y&&Y.ownerDocument&&pg(Y.ownerDocument.documentElement,Y)){if(te!==null&&Ml(Y)){if(N=te.start,K=te.end,K===void 0&&(K=N),"selectionStart"in Y)Y.selectionStart=N,Y.selectionEnd=Math.min(K,Y.value.length);else if(K=(N=Y.ownerDocument||document)&&N.defaultView||window,K.getSelection){K=K.getSelection();var oe=Y.textContent.length,ue=Math.min(te.start,oe);te=te.end===void 0?ue:Math.min(te.end,oe),!K.extend&&ue>te&&(oe=te,te=ue,ue=oe),oe=fg(Y,ue);var pe=fg(Y,te);oe&&pe&&(K.rangeCount!==1||K.anchorNode!==oe.node||K.anchorOffset!==oe.offset||K.focusNode!==pe.node||K.focusOffset!==pe.offset)&&(N=N.createRange(),N.setStart(oe.node,oe.offset),K.removeAllRanges(),ue>te?(K.addRange(N),K.extend(pe.node,pe.offset)):(N.setEnd(pe.node,pe.offset),K.addRange(N)))}}for(N=[],K=Y;K=K.parentNode;)K.nodeType===1&&N.push({element:K,left:K.scrollLeft,top:K.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<N.length;Y++)K=N[Y],K.element.scrollLeft=K.left,K.element.scrollTop=K.top}}var bc=qt&&"documentMode"in document&&11>=document.documentMode,na=null,bg=null,Fa=null,yc=!1;function Ls(N,Y,K){var te=K.window===K?K.document:K.nodeType===9?K:K.ownerDocument;yc||na==null||na!==Vs(te)||(te=na,"selectionStart"in te&&Ml(te)?te={start:te.selectionStart,end:te.selectionEnd}:(te=(te.ownerDocument&&te.ownerDocument.defaultView||window).getSelection(),te={anchorNode:te.anchorNode,anchorOffset:te.anchorOffset,focusNode:te.focusNode,focusOffset:te.focusOffset}),Fa&&ao(Fa,te)||(Fa=te,te=Rh(bg,"onSelect"),0<te.length&&(Y=new Va("onSelect","select",null,Y,K),N.push({event:Y,listeners:te}),Y.target=na)))}function zo(N,Y){var K={};return K[N.toLowerCase()]=Y.toLowerCase(),K["Webkit"+N]="webkit"+Y,K["Moz"+N]="moz"+Y,K}var sa={animationend:zo("Animation","AnimationEnd"),animationiteration:zo("Animation","AnimationIteration"),animationstart:zo("Animation","AnimationStart"),transitionrun:zo("Transition","TransitionRun"),transitionstart:zo("Transition","TransitionStart"),transitioncancel:zo("Transition","TransitionCancel"),transitionend:zo("Transition","TransitionEnd")},yg={},Gc={};qt&&(Gc=document.createElement("div").style,"AnimationEvent"in window||(delete sa.animationend.animation,delete sa.animationiteration.animation,delete sa.animationstart.animation),"TransitionEvent"in window||delete sa.transitionend.transition);function wn(N){if(yg[N])return yg[N];if(!sa[N])return N;var Y=sa[N],K;for(K in Y)if(Y.hasOwnProperty(K)&&K in Gc)return yg[N]=Y[K];return N}var Gg=wn("animationend"),Xs=wn("animationiteration"),vg=wn("animationstart"),Fo=wn("transitionrun"),La=wn("transitionstart"),Gr=wn("transitioncancel"),vc=wn("transitionend"),Bc=new Map,Lo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Ks(N,Y){Bc.set(N,Y),Qt(Y,[N])}var jn=[],bo=0,Ko=0;function Nl(){for(var N=bo,Y=Ko=bo=0;Y<N;){var K=jn[Y];jn[Y++]=null;var te=jn[Y];jn[Y++]=null;var oe=jn[Y];jn[Y++]=null;var ue=jn[Y];if(jn[Y++]=null,te!==null&&oe!==null){var pe=te.pending;pe===null?oe.next=oe:(oe.next=pe.next,pe.next=oe),te.pending=oe}ue!==0&&El(K,oe,ue)}}function Vl(N,Y,K,te){jn[bo++]=N,jn[bo++]=Y,jn[bo++]=K,jn[bo++]=te,Ko|=te,N.lanes|=te,N=N.alternate,N!==null&&(N.lanes|=te)}function oa(N,Y,K,te){return Vl(N,Y,K,te),Wl(N)}function Po(N,Y){return Vl(N,null,null,Y),Wl(N)}function El(N,Y,K){N.lanes|=K;var te=N.alternate;te!==null&&(te.lanes|=K);for(var oe=!1,ue=N.return;ue!==null;)ue.childLanes|=K,te=ue.alternate,te!==null&&(te.childLanes|=K),ue.tag===22&&(N=ue.stateNode,N===null||N._visibility&1||(oe=!0)),N=ue,ue=ue.return;oe&&Y!==null&&N.tag===3&&(ue=N.stateNode,oe=31-Pe(K),ue=ue.hiddenUpdates,N=ue[oe],N===null?ue[oe]=[Y]:N.push(Y),Y.lane=K|536870912)}function Wl(N){if(50<eo)throw eo=0,hr=null,Error(C(185));for(var Y=N.return;Y!==null;)N=Y,Y=N.return;return N.tag===3?N.stateNode:null}var vr={},Sc=new WeakMap;function Rs(N,Y){if(typeof N=="object"&&N!==null){var K=Sc.get(N);return K!==void 0?K:(Y={value:N,source:Y,stack:Ee(Y)},Sc.set(N,Y),Y)}return{value:N,source:Y,stack:Ee(Y)}}var ra=[],Br=0,ns=null,Yl=0,an=[],Es=0,ko=null,yo=1,Do="";function Is(N,Y){ra[Br++]=Yl,ra[Br++]=ns,ns=N,Yl=Y}function Bg(N,Y,K){an[Es++]=yo,an[Es++]=Do,an[Es++]=ko,ko=N;var te=yo;N=Do;var oe=32-Pe(te)-1;te&=~(1<<oe),K+=1;var ue=32-Pe(Y)+oe;if(30<ue){var pe=oe-oe%5;ue=(te&(1<<pe)-1).toString(32),te>>=pe,oe-=pe,yo=1<<32-Pe(Y)+oe|K<<oe|te,Do=ue+N}else yo=1<<ue|K<<oe|te,Do=N}function Tl(N){N.return!==null&&(Is(N,1),Bg(N,1,0))}function Sr(N){for(;N===ns;)ns=ra[--Br],ra[Br]=null,Yl=ra[--Br],ra[Br]=null;for(;N===ko;)ko=an[--Es],an[Es]=null,Do=an[--Es],an[Es]=null,yo=an[--Es],an[Es]=null}var ss=null,Pn=null,Ji=!1,Ps=null,ks=!1,Jl=Error(C(519));function aa(N){var Y=Error(C(418,""));throw Go(Rs(Y,N)),Jl}function Nu(N){var Y=N.stateNode,K=N.type,te=N.memoizedProps;switch(Y[on]=N,Y[pi]=te,K){case"dialog":zi("cancel",Y),zi("close",Y);break;case"iframe":case"object":case"embed":zi("load",Y);break;case"video":case"audio":for(K=0;K<su.length;K++)zi(su[K],Y);break;case"source":zi("error",Y);break;case"img":case"image":case"link":zi("error",Y),zi("load",Y);break;case"details":zi("toggle",Y);break;case"input":zi("invalid",Y),ts(Y,te.value,te.defaultValue,te.checked,te.defaultChecked,te.type,te.name,!0),Ei(Y);break;case"select":zi("invalid",Y);break;case"textarea":zi("invalid",Y),ro(Y,te.value,te.defaultValue,te.children),Ei(Y)}K=te.children,typeof K!="string"&&typeof K!="number"&&typeof K!="bigint"||Y.textContent===""+K||te.suppressHydrationWarning===!0||Nd(Y.textContent,K)?(te.popover!=null&&(zi("beforetoggle",Y),zi("toggle",Y)),te.onScroll!=null&&zi("scroll",Y),te.onScrollEnd!=null&&zi("scrollend",Y),te.onClick!=null&&(Y.onclick=_h),Y=!0):Y=!1,Y||aa(N)}function Vu(N){for(ss=N.return;ss;)switch(ss.tag){case 3:case 27:ks=!0;return;case 5:case 13:ks=!1;return;default:ss=ss.return}}function Ka(N){if(N!==ss)return!1;if(!Ji)return Vu(N),Ji=!0,!1;var Y=!1,K;if((K=N.tag!==3&&N.tag!==27)&&((K=N.tag===5)&&(K=N.type,K=!(K!=="form"&&K!=="button")||ud(N.type,N.memoizedProps)),K=!K),K&&(Y=!0),Y&&Pn&&aa(N),Vu(N),N.tag===13){if(N=N.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(C(317));e:{for(N=N.nextSibling,Y=0;N;){if(N.nodeType===8)if(K=N.data,K==="/$"){if(Y===0){Pn=Cr(N.nextSibling);break e}Y--}else K!=="$"&&K!=="$!"&&K!=="$?"||Y++;N=N.nextSibling}Pn=null}}else Pn=ss?Cr(N.stateNode.nextSibling):null;return!0}function Pa(){Pn=ss=null,Ji=!1}function Go(N){Ps===null?Ps=[N]:Ps.push(N)}var xr=Error(C(460)),Sg=Error(C(474)),xc={then:function(){}};function Eu(N){return N=N.status,N==="fulfilled"||N==="rejected"}function Hl(){}function Xr(N,Y,K){switch(K=N[K],K===void 0?N.push(Y):K!==Y&&(Y.then(Hl,Hl),Y=K),Y.status){case"fulfilled":return Y.value;case"rejected":throw N=Y.reason,N===xr?Error(C(483)):N;default:if(typeof Y.status=="string")Y.then(Hl,Hl);else{if(N=Qi,N!==null&&100<N.shellSuspendCounter)throw Error(C(482));N=Y,N.status="pending",N.then(function(te){if(Y.status==="pending"){var oe=Y;oe.status="fulfilled",oe.value=te}},function(te){if(Y.status==="pending"){var oe=Y;oe.status="rejected",oe.reason=te}})}switch(Y.status){case"fulfilled":return Y.value;case"rejected":throw N=Y.reason,N===xr?Error(C(483)):N}throw ka=Y,xr}}var ka=null;function Pi(){if(ka===null)throw Error(C(459));var N=ka;return ka=null,N}var Rr=null,zl=0;function Fl(N){var Y=zl;return zl+=1,Rr===null&&(Rr=[]),Xr(Rr,N,Y)}function Ll(N,Y){Y=Y.props.ref,N.ref=Y!==void 0?Y:null}function Xc(N,Y){throw Y.$$typeof===f?Error(C(525)):(N=Object.prototype.toString.call(Y),Error(C(31,N==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":N)))}function Wu(N){var Y=N._init;return Y(N._payload)}function Yu(N){function Y(Qe,ke){if(N){var st=Qe.deletions;st===null?(Qe.deletions=[ke],Qe.flags|=16):st.push(ke)}}function K(Qe,ke){if(!N)return null;for(;ke!==null;)Y(Qe,ke),ke=ke.sibling;return null}function te(Qe){for(var ke=new Map;Qe!==null;)Qe.key!==null?ke.set(Qe.key,Qe):ke.set(Qe.index,Qe),Qe=Qe.sibling;return ke}function oe(Qe,ke){return Qe=As(Qe,ke),Qe.index=0,Qe.sibling=null,Qe}function ue(Qe,ke,st){return Qe.index=st,N?(st=Qe.alternate,st!==null?(st=st.index,st<ke?(Qe.flags|=33554434,ke):st):(Qe.flags|=33554434,ke)):(Qe.flags|=1048576,ke)}function pe(Qe){return N&&Qe.alternate===null&&(Qe.flags|=33554434),Qe}function xe(Qe,ke,st,wt){return ke===null||ke.tag!==6?(ke=Vn(st,Qe.mode,wt),ke.return=Qe,ke):(ke=oe(ke,st),ke.return=Qe,ke)}function Te(Qe,ke,st,wt){var oi=st.type;return oi===_?Bt(Qe,ke,st.props.children,wt,st.key):ke!==null&&(ke.elementType===oi||typeof oi=="object"&&oi!==null&&oi.$$typeof===ee&&Wu(oi)===ke.type)?(ke=oe(ke,st.props),Ll(ke,st),ke.return=Qe,ke):(ke=al(st.type,st.key,st.props,null,Qe.mode,wt),Ll(ke,st),ke.return=Qe,ke)}function Oe(Qe,ke,st,wt){return ke===null||ke.tag!==4||ke.stateNode.containerInfo!==st.containerInfo||ke.stateNode.implementation!==st.implementation?(ke=tc(st,Qe.mode,wt),ke.return=Qe,ke):(ke=oe(ke,st.children||[]),ke.return=Qe,ke)}function Bt(Qe,ke,st,wt,oi){return ke===null||ke.tag!==7?(ke=Dr(st,Qe.mode,wt,oi),ke.return=Qe,ke):(ke=oe(ke,st),ke.return=Qe,ke)}function Vt(Qe,ke,st){if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return ke=Vn(""+ke,Qe.mode,st),ke.return=Qe,ke;if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case y:return st=al(ke.type,ke.key,ke.props,null,Qe.mode,st),Ll(st,ke),st.return=Qe,st;case B:return ke=tc(ke,Qe.mode,st),ke.return=Qe,ke;case ee:var wt=ke._init;return ke=wt(ke._payload),Vt(Qe,ke,st)}if(Ae(ke)||le(ke))return ke=Dr(ke,Qe.mode,st,null),ke.return=Qe,ke;if(typeof ke.then=="function")return Vt(Qe,Fl(ke),st);if(ke.$$typeof===H)return Vt(Qe,Kc(Qe,ke),st);Xc(Qe,ke)}return null}function gt(Qe,ke,st,wt){var oi=ke!==null?ke.key:null;if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return oi!==null?null:xe(Qe,ke,""+st,wt);if(typeof st=="object"&&st!==null){switch(st.$$typeof){case y:return st.key===oi?Te(Qe,ke,st,wt):null;case B:return st.key===oi?Oe(Qe,ke,st,wt):null;case ee:return oi=st._init,st=oi(st._payload),gt(Qe,ke,st,wt)}if(Ae(st)||le(st))return oi!==null?null:Bt(Qe,ke,st,wt,null);if(typeof st.then=="function")return gt(Qe,ke,Fl(st),wt);if(st.$$typeof===H)return gt(Qe,ke,Kc(Qe,st),wt);Xc(Qe,st)}return null}function yt(Qe,ke,st,wt,oi){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return Qe=Qe.get(st)||null,xe(ke,Qe,""+wt,oi);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case y:return Qe=Qe.get(wt.key===null?st:wt.key)||null,Te(ke,Qe,wt,oi);case B:return Qe=Qe.get(wt.key===null?st:wt.key)||null,Oe(ke,Qe,wt,oi);case ee:var Yi=wt._init;return wt=Yi(wt._payload),yt(Qe,ke,st,wt,oi)}if(Ae(wt)||le(wt))return Qe=Qe.get(st)||null,Bt(ke,Qe,wt,oi,null);if(typeof wt.then=="function")return yt(Qe,ke,st,Fl(wt),oi);if(wt.$$typeof===H)return yt(Qe,ke,st,Kc(ke,wt),oi);Xc(ke,wt)}return null}function ai(Qe,ke,st,wt){for(var oi=null,Yi=null,gi=ke,fi=ke=0,us=null;gi!==null&&fi<st.length;fi++){gi.index>fi?(us=gi,gi=null):us=gi.sibling;var ki=gt(Qe,gi,st[fi],wt);if(ki===null){gi===null&&(gi=us);break}N&&gi&&ki.alternate===null&&Y(Qe,gi),ke=ue(ki,ke,fi),Yi===null?oi=ki:Yi.sibling=ki,Yi=ki,gi=us}if(fi===st.length)return K(Qe,gi),Ji&&Is(Qe,fi),oi;if(gi===null){for(;fi<st.length;fi++)gi=Vt(Qe,st[fi],wt),gi!==null&&(ke=ue(gi,ke,fi),Yi===null?oi=gi:Yi.sibling=gi,Yi=gi);return Ji&&Is(Qe,fi),oi}for(gi=te(gi);fi<st.length;fi++)us=yt(gi,Qe,fi,st[fi],wt),us!==null&&(N&&us.alternate!==null&&gi.delete(us.key===null?fi:us.key),ke=ue(us,ke,fi),Yi===null?oi=us:Yi.sibling=us,Yi=us);return N&&gi.forEach(function(fl){return Y(Qe,fl)}),Ji&&Is(Qe,fi),oi}function vi(Qe,ke,st,wt){if(st==null)throw Error(C(151));for(var oi=null,Yi=null,gi=ke,fi=ke=0,us=null,ki=st.next();gi!==null&&!ki.done;fi++,ki=st.next()){gi.index>fi?(us=gi,gi=null):us=gi.sibling;var fl=gt(Qe,gi,ki.value,wt);if(fl===null){gi===null&&(gi=us);break}N&&gi&&fl.alternate===null&&Y(Qe,gi),ke=ue(fl,ke,fi),Yi===null?oi=fl:Yi.sibling=fl,Yi=fl,gi=us}if(ki.done)return K(Qe,gi),Ji&&Is(Qe,fi),oi;if(gi===null){for(;!ki.done;fi++,ki=st.next())ki=Vt(Qe,ki.value,wt),ki!==null&&(ke=ue(ki,ke,fi),Yi===null?oi=ki:Yi.sibling=ki,Yi=ki);return Ji&&Is(Qe,fi),oi}for(gi=te(gi);!ki.done;fi++,ki=st.next())ki=yt(gi,Qe,fi,ki.value,wt),ki!==null&&(N&&ki.alternate!==null&&gi.delete(ki.key===null?fi:ki.key),ke=ue(ki,ke,fi),Yi===null?oi=ki:Yi.sibling=ki,Yi=ki);return N&&gi.forEach(function(zC){return Y(Qe,zC)}),Ji&&Is(Qe,fi),oi}function Yn(Qe,ke,st,wt){if(typeof st=="object"&&st!==null&&st.type===_&&st.key===null&&(st=st.props.children),typeof st=="object"&&st!==null){switch(st.$$typeof){case y:e:{for(var oi=st.key;ke!==null;){if(ke.key===oi){if(oi=st.type,oi===_){if(ke.tag===7){K(Qe,ke.sibling),wt=oe(ke,st.props.children),wt.return=Qe,Qe=wt;break e}}else if(ke.elementType===oi||typeof oi=="object"&&oi!==null&&oi.$$typeof===ee&&Wu(oi)===ke.type){K(Qe,ke.sibling),wt=oe(ke,st.props),Ll(wt,st),wt.return=Qe,Qe=wt;break e}K(Qe,ke);break}else Y(Qe,ke);ke=ke.sibling}st.type===_?(wt=Dr(st.props.children,Qe.mode,wt,st.key),wt.return=Qe,Qe=wt):(wt=al(st.type,st.key,st.props,null,Qe.mode,wt),Ll(wt,st),wt.return=Qe,Qe=wt)}return pe(Qe);case B:e:{for(oi=st.key;ke!==null;){if(ke.key===oi)if(ke.tag===4&&ke.stateNode.containerInfo===st.containerInfo&&ke.stateNode.implementation===st.implementation){K(Qe,ke.sibling),wt=oe(ke,st.children||[]),wt.return=Qe,Qe=wt;break e}else{K(Qe,ke);break}else Y(Qe,ke);ke=ke.sibling}wt=tc(st,Qe.mode,wt),wt.return=Qe,Qe=wt}return pe(Qe);case ee:return oi=st._init,st=oi(st._payload),Yn(Qe,ke,st,wt)}if(Ae(st))return ai(Qe,ke,st,wt);if(le(st)){if(oi=le(st),typeof oi!="function")throw Error(C(150));return st=oi.call(st),vi(Qe,ke,st,wt)}if(typeof st.then=="function")return Yn(Qe,ke,Fl(st),wt);if(st.$$typeof===H)return Yn(Qe,ke,Kc(Qe,st),wt);Xc(Qe,st)}return typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint"?(st=""+st,ke!==null&&ke.tag===6?(K(Qe,ke.sibling),wt=oe(ke,st),wt.return=Qe,Qe=wt):(K(Qe,ke),wt=Vn(st,Qe.mode,wt),wt.return=Qe,Qe=wt),pe(Qe)):K(Qe,ke)}return function(Qe,ke,st,wt){try{zl=0;var oi=Yn(Qe,ke,st,wt);return Rr=null,oi}catch(gi){if(gi===xr)throw gi;var Yi=Xn(29,gi,null,Qe.mode);return Yi.lanes=wt,Yi.return=Qe,Yi}finally{}}}var Oo=Yu(!0),Uo=Yu(!1),la=Ke(null),ca=Ke(0);function _r(N,Y){N=ur,dt(ca,N),dt(la,Y),ur=N|Y.baseLanes}function Rc(){dt(ca,ur),dt(la,la.current)}function Kl(){ur=ca.current,Rt(la),Rt(ca)}var _s=Ke(null),vo=null;function $o(N){var Y=N.alternate;dt(Zn,Zn.current&1),dt(_s,N),vo===null&&(Y===null||la.current!==null||Y.memoizedState!==null)&&(vo=N)}function xg(N){if(N.tag===22){if(dt(Zn,Zn.current),dt(_s,N),vo===null){var Y=N.alternate;Y!==null&&Y.memoizedState!==null&&(vo=N)}}else jo()}function jo(){dt(Zn,Zn.current),dt(_s,_s.current)}function Bo(N){Rt(_s),vo===N&&(vo=null),Rt(Zn)}var Zn=Ke(0);function Da(N){for(var Y=N;Y!==null;){if(Y.tag===13){var K=Y.memoizedState;if(K!==null&&(K=K.dehydrated,K===null||K.data==="$?"||K.data==="$!"))return Y}else if(Y.tag===19&&Y.memoizedProps.revealOrder!==void 0){if((Y.flags&128)!==0)return Y}else if(Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===N)break;for(;Y.sibling===null;){if(Y.return===null||Y.return===N)return null;Y=Y.return}Y.sibling.return=Y.return,Y=Y.sibling}return null}var wi=typeof AbortController<"u"?AbortController:function(){var N=[],Y=this.signal={aborted:!1,addEventListener:function(K,te){N.push(te)}};this.abort=function(){Y.aborted=!0,N.forEach(function(K){return K()})}},kh=u.unstable_scheduleCallback,Ws=u.unstable_NormalPriority,yn={$$typeof:H,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xg(){return{controller:new wi,data:new Map,refCount:0}}function wr(N){N.refCount--,N.refCount===0&&kh(Ws,function(){N.controller.abort()})}var So=null,Zr=0,ha=0,Mr=null;function Dh(N,Y){if(So===null){var K=So=[];Zr=0,ha=id(),Mr={status:"pending",value:void 0,then:function(te){K.push(te)}}}return Zr++,Y.then(Rg,Rg),Y}function Rg(){if(--Zr===0&&So!==null){Mr!==null&&(Mr.status="fulfilled");var N=So;So=null,ha=0,Mr=null;for(var Y=0;Y<N.length;Y++)(0,N[Y])()}}function Nr(N,Y){var K=[],te={status:"pending",value:null,reason:null,then:function(oe){K.push(oe)}};return N.then(function(){te.status="fulfilled",te.value=Y;for(var oe=0;oe<K.length;oe++)(0,K[oe])(Y)},function(oe){for(te.status="rejected",te.reason=oe,oe=0;oe<K.length;oe++)(0,K[oe])(void 0)}),te}var _c=ge.S;ge.S=function(N,Y){typeof Y=="object"&&Y!==null&&typeof Y.then=="function"&&Dh(N,Y),_c!==null&&_c(N,Y)};var Qo=Ke(null);function Pl(){var N=Qo.current;return N!==null?N:Qi.pooledCache}function Oa(N,Y){Y===null?dt(Qo,Qo.current):dt(Qo,Y.pool)}function qo(){var N=Pl();return N===null?null:{parent:yn._currentValue,pool:N}}var er=0,Si=null,Ui=null,Mn=null,Ii=!1,Vr=!1,Er=!1,Ua=0,Wr=0,$a=null,Oh=0;function An(){throw Error(C(321))}function da(N,Y){if(Y===null)return!1;for(var K=0;K<Y.length&&K<N.length;K++)if(!Ss(N[K],Y[K]))return!1;return!0}function _g(N,Y,K,te,oe,ue){return er=ue,Si=Y,Y.memoizedState=null,Y.updateQueue=null,Y.lanes=0,ge.H=N===null||N.memoizedState===null?Tr:ir,Er=!1,ue=K(te,oe),Er=!1,Vr&&(ue=Ju(Y,K,te,oe)),Tu(N),ue}function Tu(N){ge.H=Xo;var Y=Ui!==null&&Ui.next!==null;if(er=0,Mn=Ui=Si=null,Ii=!1,Wr=0,$a=null,Y)throw Error(C(300));N===null||Hn||(N=N.dependencies,N!==null&&tl(N)&&(Hn=!0))}function Ju(N,Y,K,te){Si=N;var oe=0;do{if(Vr&&($a=null),Wr=0,Vr=!1,25<=oe)throw Error(C(301));if(oe+=1,Mn=Ui=null,N.updateQueue!=null){var ue=N.updateQueue;ue.lastEffect=null,ue.events=null,ue.stores=null,ue.memoCache!=null&&(ue.memoCache.index=0)}ge.H=pa,ue=Y(K,te)}while(Vr);return ue}function Uh(){var N=ge.H,Y=N.useState()[0];return Y=typeof Y.then=="function"?Dl(Y):Y,N=N.useState()[0],(Ui!==null?Ui.memoizedState:null)!==N&&(Si.flags|=1024),Y}function wg(){var N=Ua!==0;return Ua=0,N}function kl(N,Y,K){Y.updateQueue=N.updateQueue,Y.flags&=-2053,N.lanes&=~K}function wc(N){if(Ii){for(N=N.memoizedState;N!==null;){var Y=N.queue;Y!==null&&(Y.pending=null),N=N.next}Ii=!1}er=0,Mn=Ui=Si=null,Vr=!1,Wr=Ua=0,$a=null}function Qn(){var N={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mn===null?Si.memoizedState=Mn=N:Mn=Mn.next=N,Mn}function Gn(){if(Ui===null){var N=Si.alternate;N=N!==null?N.memoizedState:null}else N=Ui.next;var Y=Mn===null?Si.memoizedState:Mn.next;if(Y!==null)Mn=Y,Ui=N;else{if(N===null)throw Si.alternate===null?Error(C(467)):Error(C(310));Ui=N,N={memoizedState:Ui.memoizedState,baseState:Ui.baseState,baseQueue:Ui.baseQueue,queue:Ui.queue,next:null},Mn===null?Si.memoizedState=Mn=N:Mn=Mn.next=N}return Mn}var Zc;Zc=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Dl(N){var Y=Wr;return Wr+=1,$a===null&&($a=[]),N=Xr($a,N,Y),Y=Si,(Mn===null?Y.memoizedState:Mn.next)===null&&(Y=Y.alternate,ge.H=Y===null||Y.memoizedState===null?Tr:ir),N}function ja(N){if(N!==null&&typeof N=="object"){if(typeof N.then=="function")return Dl(N);if(N.$$typeof===H)return os(N)}throw Error(C(438,String(N)))}function lo(N){var Y=null,K=Si.updateQueue;if(K!==null&&(Y=K.memoCache),Y==null){var te=Si.alternate;te!==null&&(te=te.updateQueue,te!==null&&(te=te.memoCache,te!=null&&(Y={data:te.data.map(function(oe){return oe.slice()}),index:0})))}if(Y==null&&(Y={data:[],index:0}),K===null&&(K=Zc(),Si.updateQueue=K),K.memoCache=Y,K=Y.data[Y.index],K===void 0)for(K=Y.data[Y.index]=Array(N),te=0;te<N;te++)K[te]=ie;return Y.index++,K}function Cn(N,Y){return typeof Y=="function"?Y(N):Y}function co(N){var Y=Gn();return ws(Y,Ui,N)}function ws(N,Y,K){var te=N.queue;if(te===null)throw Error(C(311));te.lastRenderedReducer=K;var oe=N.baseQueue,ue=te.pending;if(ue!==null){if(oe!==null){var pe=oe.next;oe.next=ue.next,ue.next=pe}Y.baseQueue=oe=ue,te.pending=null}if(ue=N.baseState,oe===null)N.memoizedState=ue;else{Y=oe.next;var xe=pe=null,Te=null,Oe=Y,Bt=!1;do{var Vt=Oe.lane&-536870913;if(Vt!==Oe.lane?(ui&Vt)===Vt:(er&Vt)===Vt){var gt=Oe.revertLane;if(gt===0)Te!==null&&(Te=Te.next={lane:0,revertLane:0,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),Vt===ha&&(Bt=!0);else if((er&gt)===gt){Oe=Oe.next,gt===ha&&(Bt=!0);continue}else Vt={lane:0,revertLane:Oe.revertLane,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},Te===null?(xe=Te=Vt,pe=ue):Te=Te.next=Vt,Si.lanes|=gt,po|=gt;Vt=Oe.action,Er&&K(ue,Vt),ue=Oe.hasEagerState?Oe.eagerState:K(ue,Vt)}else gt={lane:Vt,revertLane:Oe.revertLane,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},Te===null?(xe=Te=gt,pe=ue):Te=Te.next=gt,Si.lanes|=Vt,po|=Vt;Oe=Oe.next}while(Oe!==null&&Oe!==Y);if(Te===null?pe=ue:Te.next=xe,!Ss(ue,N.memoizedState)&&(Hn=!0,Bt&&(K=Mr,K!==null)))throw K;N.memoizedState=ue,N.baseState=pe,N.baseQueue=Te,te.lastRenderedState=ue}return oe===null&&(te.lanes=0),[N.memoizedState,te.dispatch]}function Mc(N){var Y=Gn(),K=Y.queue;if(K===null)throw Error(C(311));K.lastRenderedReducer=N;var te=K.dispatch,oe=K.pending,ue=Y.memoizedState;if(oe!==null){K.pending=null;var pe=oe=oe.next;do ue=N(ue,pe.action),pe=pe.next;while(pe!==oe);Ss(ue,Y.memoizedState)||(Hn=!0),Y.memoizedState=ue,Y.baseQueue===null&&(Y.baseState=ue),K.lastRenderedState=ue}return[ue,te]}function Hu(N,Y,K){var te=Si,oe=Gn(),ue=Ji;if(ue){if(K===void 0)throw Error(C(407));K=K()}else K=Y();var pe=!Ss((Ui||oe).memoizedState,K);if(pe&&(oe.memoizedState=K,Hn=!0),oe=oe.queue,Vg(zu.bind(null,te,oe,N),[N]),oe.getSnapshot!==Y||pe||Mn!==null&&Mn.memoizedState.tag&1){if(te.flags|=2048,xo(9,Yr.bind(null,te,oe,K,Y),{destroy:void 0},null),Qi===null)throw Error(C(349));ue||(er&60)!==0||fs(te,Y,K)}return K}function fs(N,Y,K){N.flags|=16384,N={getSnapshot:Y,value:K},Y=Si.updateQueue,Y===null?(Y=Zc(),Si.updateQueue=Y,Y.stores=[N]):(K=Y.stores,K===null?Y.stores=[N]:K.push(N))}function Yr(N,Y,K,te){Y.value=K,Y.getSnapshot=te,Fu(Y)&&Lu(N)}function zu(N,Y,K){return K(function(){Fu(Y)&&Lu(N)})}function Fu(N){var Y=N.getSnapshot;N=N.value;try{var K=Y();return!Ss(N,K)}catch{return!0}}function Lu(N){var Y=Po(N,2);Y!==null&&Wn(Y,N,2)}function Zg(N){var Y=Qn();if(typeof N=="function"){var K=N;if(N=K(),Er){_e(!0);try{K()}finally{_e(!1)}}}return Y.memoizedState=Y.baseState=N,Y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cn,lastRenderedState:N},Y}function Mg(N,Y,K,te){return N.baseState=K,ws(N,Ui,typeof te=="function"?te:Cn)}function $h(N,Y,K,te,oe){if(Yc(N))throw Error(C(485));if(N=Y.action,N!==null){var ue={payload:oe,action:N,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(pe){ue.listeners.push(pe)}};ge.T!==null?K(!0):ue.isTransition=!1,te(ue),K=Y.pending,K===null?(ue.next=Y.pending=ue,Ng(Y,ue)):(ue.next=K.next,Y.pending=K.next=ue)}}function Ng(N,Y){var K=Y.action,te=Y.payload,oe=N.state;if(Y.isTransition){var ue=ge.T,pe={};ge.T=pe;try{var xe=K(oe,te),Te=ge.S;Te!==null&&Te(pe,xe),Ku(N,Y,xe)}catch(Oe){tr(N,Y,Oe)}finally{ge.T=ue}}else try{ue=K(oe,te),Ku(N,Y,ue)}catch(Oe){tr(N,Y,Oe)}}function Ku(N,Y,K){K!==null&&typeof K=="object"&&typeof K.then=="function"?K.then(function(te){Ca(N,Y,te)},function(te){return tr(N,Y,te)}):Ca(N,Y,K)}function Ca(N,Y,K){Y.status="fulfilled",Y.value=K,Pu(Y),N.state=K,Y=N.pending,Y!==null&&(K=Y.next,K===Y?N.pending=null:(K=K.next,Y.next=K,Ng(N,K)))}function tr(N,Y,K){var te=N.pending;if(N.pending=null,te!==null){te=te.next;do Y.status="rejected",Y.reason=K,Pu(Y),Y=Y.next;while(Y!==te)}N.action=null}function Pu(N){N=N.listeners;for(var Y=0;Y<N.length;Y++)(0,N[Y])()}function ku(N,Y){return Y}function Du(N,Y){if(Ji){var K=Qi.formState;if(K!==null){e:{var te=Si;if(Ji){if(Pn){t:{for(var oe=Pn,ue=ks;oe.nodeType!==8;){if(!ue){oe=null;break t}if(oe=Cr(oe.nextSibling),oe===null){oe=null;break t}}ue=oe.data,oe=ue==="F!"||ue==="F"?oe:null}if(oe){Pn=Cr(oe.nextSibling),te=oe.data==="F!";break e}}aa(te)}te=!1}te&&(Y=K[0])}}return K=Qn(),K.memoizedState=K.baseState=Y,te={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ku,lastRenderedState:Y},K.queue=te,K=Tg.bind(null,Si,te),te.dispatch=K,te=Zg(!1),ue=Ol.bind(null,Si,!1,te.queue),te=Qn(),oe={state:Y,dispatch:null,action:N,pending:null},te.queue=oe,K=$h.bind(null,Si,oe,ue,K),oe.dispatch=K,te.memoizedState=N,[Y,K,!1]}function Qa(N){var Y=Gn();return Ou(Y,Ui,N)}function Ou(N,Y,K){Y=ws(N,Y,ku)[0],N=co(Cn)[0],Y=typeof Y=="object"&&Y!==null&&typeof Y.then=="function"?Dl(Y):Y;var te=Gn(),oe=te.queue,ue=oe.dispatch;return K!==te.memoizedState&&(Si.flags|=2048,xo(9,jh.bind(null,oe,K),{destroy:void 0},null)),[Y,ue,N]}function jh(N,Y){N.action=Y}function Uu(N){var Y=Gn(),K=Ui;if(K!==null)return Ou(Y,K,N);Gn(),Y=Y.memoizedState,K=Gn();var te=K.queue.dispatch;return K.memoizedState=N,[Y,te,!1]}function xo(N,Y,K,te){return N={tag:N,create:Y,inst:K,deps:te,next:null},Y=Si.updateQueue,Y===null&&(Y=Zc(),Si.updateQueue=Y),K=Y.lastEffect,K===null?Y.lastEffect=N.next=N:(te=K.next,K.next=N,N.next=te,Y.lastEffect=N),N}function $u(){return Gn().memoizedState}function Nc(N,Y,K,te){var oe=Qn();Si.flags|=N,oe.memoizedState=xo(1|Y,K,{destroy:void 0},te===void 0?null:te)}function Vc(N,Y,K,te){var oe=Gn();te=te===void 0?null:te;var ue=oe.memoizedState.inst;Ui!==null&&te!==null&&da(te,Ui.memoizedState.deps)?oe.memoizedState=xo(Y,K,ue,te):(Si.flags|=N,oe.memoizedState=xo(1|Y,K,ue,te))}function ju(N,Y){Nc(8390656,8,N,Y)}function Vg(N,Y){Vc(2048,8,N,Y)}function Qu(N,Y){return Vc(4,2,N,Y)}function qu(N,Y){return Vc(4,4,N,Y)}function eh(N,Y){if(typeof Y=="function"){N=N();var K=Y(N);return function(){typeof K=="function"?K():Y(null)}}if(Y!=null)return N=N(),Y.current=N,function(){Y.current=null}}function th(N,Y,K){K=K!=null?K.concat([N]):null,Vc(4,4,eh.bind(null,Y,N),K)}function Eg(){}function ih(N,Y){var K=Gn();Y=Y===void 0?null:Y;var te=K.memoizedState;return Y!==null&&da(Y,te[1])?te[0]:(K.memoizedState=[N,Y],N)}function nh(N,Y){var K=Gn();Y=Y===void 0?null:Y;var te=K.memoizedState;if(Y!==null&&da(Y,te[1]))return te[0];if(te=N(),Er){_e(!0);try{N()}finally{_e(!1)}}return K.memoizedState=[te,Y],te}function Ec(N,Y,K){return K===void 0||(er&1073741824)!==0?N.memoizedState=Y:(N.memoizedState=K,N=zs(),Si.lanes|=N,po|=N,K)}function sh(N,Y,K,te){return Ss(K,Y)?K:la.current!==null?(N=Ec(N,K,te),Ss(N,Y)||(Hn=!0),N):(er&42)===0?(Hn=!0,N.memoizedState=K):(N=zs(),Si.lanes|=N,po|=N,Y)}function oh(N,Y,K,te,oe){var ue=Re.p;Re.p=ue!==0&&8>ue?ue:8;var pe=ge.T,xe={};ge.T=xe,Ol(N,!1,Y,K);try{var Te=oe(),Oe=ge.S;if(Oe!==null&&Oe(xe,Te),Te!==null&&typeof Te=="object"&&typeof Te.then=="function"){var Bt=Nr(Te,te);fa(N,Y,Bt,ys(N))}else fa(N,Y,te,ys(N))}catch(Vt){fa(N,Y,{then:function(){},status:"rejected",reason:Vt},ys())}finally{Re.p=ue,ge.T=pe}}function Qh(){}function Wg(N,Y,K,te){if(N.tag!==5)throw Error(C(476));var oe=rh(N).queue;oh(N,oe,Y,We,K===null?Qh:function(){return ah(N),K(te)})}function rh(N){var Y=N.memoizedState;if(Y!==null)return Y;Y={memoizedState:We,baseState:We,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cn,lastRenderedState:We},next:null};var K={};return Y.next={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cn,lastRenderedState:K},next:null},N.memoizedState=Y,N=N.alternate,N!==null&&(N.memoizedState=Y),Y}function ah(N){var Y=rh(N).next.queue;fa(N,Y,{},ys())}function Wc(){return os(cu)}function Yg(){return Gn().memoizedState}function lh(){return Gn().memoizedState}function ch(N){for(var Y=N.return;Y!==null;){switch(Y.tag){case 24:case 3:var K=ys();N=Js(K);var te=Hs(Y,N,K);te!==null&&(Wn(te,Y,K),zr(te,Y,K)),Y={cache:Xg()},N.payload=Y;return}Y=Y.return}}function gh(N,Y,K){var te=ys();K={lane:te,revertLane:0,action:K,hasEagerState:!1,eagerState:null,next:null},Yc(N)?uh(Y,K):(K=oa(N,Y,K,te),K!==null&&(Wn(K,N,te),hh(K,Y,te)))}function Tg(N,Y,K){var te=ys();fa(N,Y,K,te)}function fa(N,Y,K,te){var oe={lane:te,revertLane:0,action:K,hasEagerState:!1,eagerState:null,next:null};if(Yc(N))uh(Y,oe);else{var ue=N.alternate;if(N.lanes===0&&(ue===null||ue.lanes===0)&&(ue=Y.lastRenderedReducer,ue!==null))try{var pe=Y.lastRenderedState,xe=ue(pe,K);if(oe.hasEagerState=!0,oe.eagerState=xe,Ss(xe,pe))return Vl(N,Y,oe,0),Qi===null&&Nl(),!1}catch{}finally{}if(K=oa(N,Y,oe,te),K!==null)return Wn(K,N,te),hh(K,Y,te),!0}return!1}function Ol(N,Y,K,te){if(te={lane:2,revertLane:id(),action:te,hasEagerState:!1,eagerState:null,next:null},Yc(N)){if(Y)throw Error(C(479))}else Y=oa(N,K,te,2),Y!==null&&Wn(Y,N,2)}function Yc(N){var Y=N.alternate;return N===Si||Y!==null&&Y===Si}function uh(N,Y){Vr=Ii=!0;var K=N.pending;K===null?Y.next=Y:(Y.next=K.next,K.next=Y),N.pending=Y}function hh(N,Y,K){if((K&4194176)!==0){var te=Y.lanes;te&=N.pendingLanes,K|=te,Y.lanes=K,Tn(N,K)}}var Xo={readContext:os,use:ja,useCallback:An,useContext:An,useEffect:An,useImperativeHandle:An,useLayoutEffect:An,useInsertionEffect:An,useMemo:An,useReducer:An,useRef:An,useState:An,useDebugValue:An,useDeferredValue:An,useTransition:An,useSyncExternalStore:An,useId:An};Xo.useCacheRefresh=An,Xo.useMemoCache=An,Xo.useHostTransitionStatus=An,Xo.useFormState=An,Xo.useActionState=An,Xo.useOptimistic=An;var Tr={readContext:os,use:ja,useCallback:function(N,Y){return Qn().memoizedState=[N,Y===void 0?null:Y],N},useContext:os,useEffect:ju,useImperativeHandle:function(N,Y,K){K=K!=null?K.concat([N]):null,Nc(4194308,4,eh.bind(null,Y,N),K)},useLayoutEffect:function(N,Y){return Nc(4194308,4,N,Y)},useInsertionEffect:function(N,Y){Nc(4,2,N,Y)},useMemo:function(N,Y){var K=Qn();Y=Y===void 0?null:Y;var te=N();if(Er){_e(!0);try{N()}finally{_e(!1)}}return K.memoizedState=[te,Y],te},useReducer:function(N,Y,K){var te=Qn();if(K!==void 0){var oe=K(Y);if(Er){_e(!0);try{K(Y)}finally{_e(!1)}}}else oe=Y;return te.memoizedState=te.baseState=oe,N={pending:null,lanes:0,dispatch:null,lastRenderedReducer:N,lastRenderedState:oe},te.queue=N,N=N.dispatch=gh.bind(null,Si,N),[te.memoizedState,N]},useRef:function(N){var Y=Qn();return N={current:N},Y.memoizedState=N},useState:function(N){N=Zg(N);var Y=N.queue,K=Tg.bind(null,Si,Y);return Y.dispatch=K,[N.memoizedState,K]},useDebugValue:Eg,useDeferredValue:function(N,Y){var K=Qn();return Ec(K,N,Y)},useTransition:function(){var N=Zg(!1);return N=oh.bind(null,Si,N.queue,!0,!1),Qn().memoizedState=N,[!1,N]},useSyncExternalStore:function(N,Y,K){var te=Si,oe=Qn();if(Ji){if(K===void 0)throw Error(C(407));K=K()}else{if(K=Y(),Qi===null)throw Error(C(349));(ui&60)!==0||fs(te,Y,K)}oe.memoizedState=K;var ue={value:K,getSnapshot:Y};return oe.queue=ue,ju(zu.bind(null,te,ue,N),[N]),te.flags|=2048,xo(9,Yr.bind(null,te,ue,K,Y),{destroy:void 0},null),K},useId:function(){var N=Qn(),Y=Qi.identifierPrefix;if(Ji){var K=Do,te=yo;K=(te&~(1<<32-Pe(te)-1)).toString(32)+K,Y=":"+Y+"R"+K,K=Ua++,0<K&&(Y+="H"+K.toString(32)),Y+=":"}else K=Oh++,Y=":"+Y+"r"+K.toString(32)+":";return N.memoizedState=Y},useCacheRefresh:function(){return Qn().memoizedState=ch.bind(null,Si)}};Tr.useMemoCache=lo,Tr.useHostTransitionStatus=Wc,Tr.useFormState=Du,Tr.useActionState=Du,Tr.useOptimistic=function(N){var Y=Qn();Y.memoizedState=Y.baseState=N;var K={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return Y.queue=K,Y=Ol.bind(null,Si,!0,K),K.dispatch=Y,[N,Y]};var ir={readContext:os,use:ja,useCallback:ih,useContext:os,useEffect:Vg,useImperativeHandle:th,useInsertionEffect:Qu,useLayoutEffect:qu,useMemo:nh,useReducer:co,useRef:$u,useState:function(){return co(Cn)},useDebugValue:Eg,useDeferredValue:function(N,Y){var K=Gn();return sh(K,Ui.memoizedState,N,Y)},useTransition:function(){var N=co(Cn)[0],Y=Gn().memoizedState;return[typeof N=="boolean"?N:Dl(N),Y]},useSyncExternalStore:Hu,useId:Yg};ir.useCacheRefresh=lh,ir.useMemoCache=lo,ir.useHostTransitionStatus=Wc,ir.useFormState=Qa,ir.useActionState=Qa,ir.useOptimistic=function(N,Y){var K=Gn();return Mg(K,Ui,N,Y)};var pa={readContext:os,use:ja,useCallback:ih,useContext:os,useEffect:Vg,useImperativeHandle:th,useInsertionEffect:Qu,useLayoutEffect:qu,useMemo:nh,useReducer:Mc,useRef:$u,useState:function(){return Mc(Cn)},useDebugValue:Eg,useDeferredValue:function(N,Y){var K=Gn();return Ui===null?Ec(K,N,Y):sh(K,Ui.memoizedState,N,Y)},useTransition:function(){var N=Mc(Cn)[0],Y=Gn().memoizedState;return[typeof N=="boolean"?N:Dl(N),Y]},useSyncExternalStore:Hu,useId:Yg};pa.useCacheRefresh=lh,pa.useMemoCache=lo,pa.useHostTransitionStatus=Wc,pa.useFormState=Uu,pa.useActionState=Uu,pa.useOptimistic=function(N,Y){var K=Gn();return Ui!==null?Mg(K,Ui,N,Y):(K.baseState=N,[N,K.queue.dispatch])};function Jg(N,Y,K,te){Y=N.memoizedState,K=K(te,Y),K=K==null?Y:he({},Y,K),N.memoizedState=K,N.lanes===0&&(N.updateQueue.baseState=K)}var Hg={isMounted:function(N){return(N=N._reactInternals)?Ve(N)===N:!1},enqueueSetState:function(N,Y,K){N=N._reactInternals;var te=ys(),oe=Js(te);oe.payload=Y,K!=null&&(oe.callback=K),Y=Hs(N,oe,te),Y!==null&&(Wn(Y,N,te),zr(Y,N,te))},enqueueReplaceState:function(N,Y,K){N=N._reactInternals;var te=ys(),oe=Js(te);oe.tag=1,oe.payload=Y,K!=null&&(oe.callback=K),Y=Hs(N,oe,te),Y!==null&&(Wn(Y,N,te),zr(Y,N,te))},enqueueForceUpdate:function(N,Y){N=N._reactInternals;var K=ys(),te=Js(K);te.tag=2,Y!=null&&(te.callback=Y),Y=Hs(N,te,K),Y!==null&&(Wn(Y,N,K),zr(Y,N,K))}};function dh(N,Y,K,te,oe,ue,pe){return N=N.stateNode,typeof N.shouldComponentUpdate=="function"?N.shouldComponentUpdate(te,ue,pe):Y.prototype&&Y.prototype.isPureReactComponent?!ao(K,te)||!ao(oe,ue):!0}function Ch(N,Y,K,te){N=Y.state,typeof Y.componentWillReceiveProps=="function"&&Y.componentWillReceiveProps(K,te),typeof Y.UNSAFE_componentWillReceiveProps=="function"&&Y.UNSAFE_componentWillReceiveProps(K,te),Y.state!==N&&Hg.enqueueReplaceState(Y,Y.state,null)}function Aa(N,Y){var K=Y;if("ref"in Y){K={};for(var te in Y)te!=="ref"&&(K[te]=Y[te])}if(N=N.defaultProps){K===Y&&(K=he({},K));for(var oe in N)K[oe]===void 0&&(K[oe]=N[oe])}return K}var Tc=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",N);return}console.error(N)};function Ih(N){Tc(N)}function fh(N){console.error(N)}function ph(N){Tc(N)}function Jc(N,Y){try{var K=N.onUncaughtError;K(Y.value,{componentStack:Y.stack})}catch(te){setTimeout(function(){throw te})}}function mh(N,Y,K){try{var te=N.onCaughtError;te(K.value,{componentStack:K.stack,errorBoundary:Y.tag===1?Y.stateNode:null})}catch(oe){setTimeout(function(){throw oe})}}function zg(N,Y,K){return K=Js(K),K.tag=3,K.payload={element:null},K.callback=function(){Jc(N,Y)},K}function Fg(N){return N=Js(N),N.tag=3,N}function Ah(N,Y,K,te){var oe=K.type.getDerivedStateFromError;if(typeof oe=="function"){var ue=te.value;N.payload=function(){return oe(ue)},N.callback=function(){mh(Y,K,te)}}var pe=K.stateNode;pe!==null&&typeof pe.componentDidCatch=="function"&&(N.callback=function(){mh(Y,K,te),typeof oe!="function"&&(En===null?En=new Set([this]):En.add(this));var xe=te.stack;this.componentDidCatch(te.value,{componentStack:xe!==null?xe:""})})}function qh(N,Y,K,te,oe){if(K.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){if(Y=K.alternate,Y!==null&&$l(Y,K,oe,!0),K=_s.current,K!==null){switch(K.tag){case 13:return vo===null?sc():K.alternate===null&&hn===0&&(hn=3),K.flags&=-257,K.flags|=65536,K.lanes=oe,te===xc?K.flags|=16384:(Y=K.updateQueue,Y===null?K.updateQueue=new Set([te]):Y.add(te),yi(N,te,oe)),!1;case 22:return K.flags|=65536,te===xc?K.flags|=16384:(Y=K.updateQueue,Y===null?(Y={transitions:null,markerInstances:null,retryQueue:new Set([te])},K.updateQueue=Y):(K=Y.retryQueue,K===null?Y.retryQueue=new Set([te]):K.add(te)),yi(N,te,oe)),!1}throw Error(C(435,K.tag))}return yi(N,te,oe),sc(),!1}if(Ji)return Y=_s.current,Y!==null?((Y.flags&65536)===0&&(Y.flags|=256),Y.flags|=65536,Y.lanes=oe,te!==Jl&&(N=Error(C(422),{cause:te}),Go(Rs(N,K)))):(te!==Jl&&(Y=Error(C(423),{cause:te}),Go(Rs(Y,K))),N=N.current.alternate,N.flags|=65536,oe&=-oe,N.lanes|=oe,te=Rs(te,K),oe=zg(N.stateNode,te,oe),nl(N,oe),hn!==4&&(hn=2)),!1;var ue=Error(C(520),{cause:te});if(ue=Rs(ue,K),nc===null?nc=[ue]:nc.push(ue),hn!==4&&(hn=2),Y===null)return!0;te=Rs(te,K),K=Y;do{switch(K.tag){case 3:return K.flags|=65536,N=oe&-oe,K.lanes|=N,N=zg(K.stateNode,te,N),nl(K,N),!1;case 1:if(Y=K.type,ue=K.stateNode,(K.flags&128)===0&&(typeof Y.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(En===null||!En.has(ue))))return K.flags|=65536,oe&=-oe,K.lanes|=oe,oe=Fg(oe),Ah(oe,N,K,te),nl(K,oe),!1}K=K.return}while(K!==null);return!1}var Ys=Error(C(461)),Hn=!1;function zn(N,Y,K,te){Y.child=N===null?Uo(Y,null,K,te):Oo(Y,N.child,K,te)}function Lg(N,Y,K,te,oe){K=K.render;var ue=Y.ref;if("ref"in te){var pe={};for(var xe in te)xe!=="ref"&&(pe[xe]=te[xe])}else pe=te;return ya(Y),te=_g(N,Y,K,pe,ue,oe),xe=wg(),N!==null&&!Hn?(kl(N,Y,oe),vn(N,Y,oe)):(Ji&&xe&&Tl(Y),Y.flags|=1,zn(N,Y,te,oe),Y.child)}function Kg(N,Y,K,te,oe){if(N===null){var ue=K.type;return typeof ue=="function"&&!cr(ue)&&ue.defaultProps===void 0&&K.compare===null?(Y.tag=15,Y.type=ue,Pg(N,Y,ue,te,oe)):(N=al(K.type,null,te,Y,Y.mode,oe),N.ref=Y.ref,N.return=Y,Y.child=N)}if(ue=N.child,!Qg(N,oe)){var pe=ue.memoizedProps;if(K=K.compare,K=K!==null?K:ao,K(pe,te)&&N.ref===Y.ref)return vn(N,Y,oe)}return Y.flags|=1,N=As(ue,te),N.ref=Y.ref,N.return=Y,Y.child=N}function Pg(N,Y,K,te,oe){if(N!==null){var ue=N.memoizedProps;if(ao(ue,te)&&N.ref===Y.ref)if(Hn=!1,Y.pendingProps=te=ue,Qg(N,oe))(N.flags&131072)!==0&&(Hn=!0);else return Y.lanes=N.lanes,vn(N,Y,oe)}return Dg(N,Y,K,te,oe)}function bh(N,Y,K){var te=Y.pendingProps,oe=te.children,ue=(Y.stateNode._pendingVisibility&2)!==0,pe=N!==null?N.memoizedState:null;if(qa(N,Y),te.mode==="hidden"||ue){if((Y.flags&128)!==0){if(te=pe!==null?pe.baseLanes|K:K,N!==null){for(oe=Y.child=N.child,ue=0;oe!==null;)ue=ue|oe.lanes|oe.childLanes,oe=oe.sibling;Y.childLanes=ue&~te}else Y.childLanes=0,Y.child=null;return kg(N,Y,te,K)}if((K&536870912)!==0)Y.memoizedState={baseLanes:0,cachePool:null},N!==null&&Oa(Y,pe!==null?pe.cachePool:null),pe!==null?_r(Y,pe):Rc(),xg(Y);else return Y.lanes=Y.childLanes=536870912,kg(N,Y,pe!==null?pe.baseLanes|K:K,K)}else pe!==null?(Oa(Y,pe.cachePool),_r(Y,pe),jo(),Y.memoizedState=null):(N!==null&&Oa(Y,null),Rc(),jo());return zn(N,Y,oe,K),Y.child}function kg(N,Y,K,te){var oe=Pl();return oe=oe===null?null:{parent:yn._currentValue,pool:oe},Y.memoizedState={baseLanes:K,cachePool:oe},N!==null&&Oa(Y,null),Rc(),xg(Y),N!==null&&$l(N,Y,te,!0),null}function qa(N,Y){var K=Y.ref;if(K===null)N!==null&&N.ref!==null&&(Y.flags|=2097664);else{if(typeof K!="function"&&typeof K!="object")throw Error(C(284));(N===null||N.ref!==K)&&(Y.flags|=2097664)}}function Dg(N,Y,K,te,oe){return ya(Y),K=_g(N,Y,K,te,void 0,oe),te=wg(),N!==null&&!Hn?(kl(N,Y,oe),vn(N,Y,oe)):(Ji&&te&&Tl(Y),Y.flags|=1,zn(N,Y,K,oe),Y.child)}function yh(N,Y,K,te,oe,ue){return ya(Y),Y.updateQueue=null,K=Ju(Y,te,K,oe),Tu(N),te=wg(),N!==null&&!Hn?(kl(N,Y,ue),vn(N,Y,ue)):(Ji&&te&&Tl(Y),Y.flags|=1,zn(N,Y,K,ue),Y.child)}function Gh(N,Y,K,te,oe){if(ya(Y),Y.stateNode===null){var ue=vr,pe=K.contextType;typeof pe=="object"&&pe!==null&&(ue=os(pe)),ue=new K(te,ue),Y.memoizedState=ue.state!==null&&ue.state!==void 0?ue.state:null,ue.updater=Hg,Y.stateNode=ue,ue._reactInternals=Y,ue=Y.stateNode,ue.props=te,ue.state=Y.memoizedState,ue.refs={},ps(Y),pe=K.contextType,ue.context=typeof pe=="object"&&pe!==null?os(pe):vr,ue.state=Y.memoizedState,pe=K.getDerivedStateFromProps,typeof pe=="function"&&(Jg(Y,K,pe,te),ue.state=Y.memoizedState),typeof K.getDerivedStateFromProps=="function"||typeof ue.getSnapshotBeforeUpdate=="function"||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(pe=ue.state,typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount(),pe!==ue.state&&Hg.enqueueReplaceState(ue,ue.state,null),uo(Y,te,ue,oe),rs(),ue.state=Y.memoizedState),typeof ue.componentDidMount=="function"&&(Y.flags|=4194308),te=!0}else if(N===null){ue=Y.stateNode;var xe=Y.memoizedProps,Te=Aa(K,xe);ue.props=Te;var Oe=ue.context,Bt=K.contextType;pe=vr,typeof Bt=="object"&&Bt!==null&&(pe=os(Bt));var Vt=K.getDerivedStateFromProps;Bt=typeof Vt=="function"||typeof ue.getSnapshotBeforeUpdate=="function",xe=Y.pendingProps!==xe,Bt||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(xe||Oe!==pe)&&Ch(Y,ue,te,pe),Nn=!1;var gt=Y.memoizedState;ue.state=gt,uo(Y,te,ue,oe),rs(),Oe=Y.memoizedState,xe||gt!==Oe||Nn?(typeof Vt=="function"&&(Jg(Y,K,Vt,te),Oe=Y.memoizedState),(Te=Nn||dh(Y,K,Te,te,gt,Oe,pe))?(Bt||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(Y.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(Y.flags|=4194308),Y.memoizedProps=te,Y.memoizedState=Oe),ue.props=te,ue.state=Oe,ue.context=pe,te=Te):(typeof ue.componentDidMount=="function"&&(Y.flags|=4194308),te=!1)}else{ue=Y.stateNode,Pc(N,Y),pe=Y.memoizedProps,Bt=Aa(K,pe),ue.props=Bt,Vt=Y.pendingProps,gt=ue.context,Oe=K.contextType,Te=vr,typeof Oe=="object"&&Oe!==null&&(Te=os(Oe)),xe=K.getDerivedStateFromProps,(Oe=typeof xe=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(pe!==Vt||gt!==Te)&&Ch(Y,ue,te,Te),Nn=!1,gt=Y.memoizedState,ue.state=gt,uo(Y,te,ue,oe),rs();var yt=Y.memoizedState;pe!==Vt||gt!==yt||Nn||N!==null&&N.dependencies!==null&&tl(N.dependencies)?(typeof xe=="function"&&(Jg(Y,K,xe,te),yt=Y.memoizedState),(Bt=Nn||dh(Y,K,Bt,te,gt,yt,Te)||N!==null&&N.dependencies!==null&&tl(N.dependencies))?(Oe||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(te,yt,Te),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(te,yt,Te)),typeof ue.componentDidUpdate=="function"&&(Y.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(Y.flags|=1024)):(typeof ue.componentDidUpdate!="function"||pe===N.memoizedProps&&gt===N.memoizedState||(Y.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||pe===N.memoizedProps&&gt===N.memoizedState||(Y.flags|=1024),Y.memoizedProps=te,Y.memoizedState=yt),ue.props=te,ue.state=yt,ue.context=Te,te=Bt):(typeof ue.componentDidUpdate!="function"||pe===N.memoizedProps&&gt===N.memoizedState||(Y.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||pe===N.memoizedProps&&gt===N.memoizedState||(Y.flags|=1024),te=!1)}return ue=te,qa(N,Y),te=(Y.flags&128)!==0,ue||te?(ue=Y.stateNode,K=te&&typeof K.getDerivedStateFromError!="function"?null:ue.render(),Y.flags|=1,N!==null&&te?(Y.child=Oo(Y,N.child,null,oe),Y.child=Oo(Y,null,K,oe)):zn(N,Y,K,oe),Y.memoizedState=ue.state,N=Y.child):N=vn(N,Y,oe),N}function Og(N,Y,K,te){return Pa(),Y.flags|=256,zn(N,Y,K,te),Y.child}var Ug={dehydrated:null,treeContext:null,retryLane:0};function kn(N){return{baseLanes:N,cachePool:qo()}}function Hc(N,Y,K){return N=N!==null?N.childLanes&~K:0,Y&&(N|=bs),N}function vh(N,Y,K){var te=Y.pendingProps,oe=!1,ue=(Y.flags&128)!==0,pe;if((pe=ue)||(pe=N!==null&&N.memoizedState===null?!1:(Zn.current&2)!==0),pe&&(oe=!0,Y.flags&=-129),pe=(Y.flags&32)!==0,Y.flags&=-33,N===null){if(Ji){if(oe?$o(Y):jo(),Ji){var xe=Pn,Te;if(Te=xe){e:{for(Te=xe,xe=ks;Te.nodeType!==8;){if(!xe){xe=null;break e}if(Te=Cr(Te.nextSibling),Te===null){xe=null;break e}}xe=Te}xe!==null?(Y.memoizedState={dehydrated:xe,treeContext:ko!==null?{id:yo,overflow:Do}:null,retryLane:536870912},Te=Xn(18,null,null,0),Te.stateNode=xe,Te.return=Y,Y.child=Te,ss=Y,Pn=null,Te=!0):Te=!1}Te||aa(Y)}if(xe=Y.memoizedState,xe!==null&&(xe=xe.dehydrated,xe!==null))return xe.data==="$!"?Y.lanes=16:Y.lanes=536870912,null;Bo(Y)}return xe=te.children,te=te.fallback,oe?(jo(),oe=Y.mode,xe=jg({mode:"hidden",children:xe},oe),te=Dr(te,oe,K,null),xe.return=Y,te.return=Y,xe.sibling=te,Y.child=xe,oe=Y.child,oe.memoizedState=kn(K),oe.childLanes=Hc(N,pe,K),Y.memoizedState=Ug,te):($o(Y),$g(Y,xe))}if(Te=N.memoizedState,Te!==null&&(xe=Te.dehydrated,xe!==null)){if(ue)Y.flags&256?($o(Y),Y.flags&=-257,Y=zc(N,Y,K)):Y.memoizedState!==null?(jo(),Y.child=N.child,Y.flags|=128,Y=null):(jo(),oe=te.fallback,xe=Y.mode,te=jg({mode:"visible",children:te.children},xe),oe=Dr(oe,xe,K,null),oe.flags|=2,te.return=Y,oe.return=Y,te.sibling=oe,Y.child=te,Oo(Y,N.child,null,K),te=Y.child,te.memoizedState=kn(K),te.childLanes=Hc(N,pe,K),Y.memoizedState=Ug,Y=oe);else if($o(Y),xe.data==="$!"){if(pe=xe.nextSibling&&xe.nextSibling.dataset,pe)var Oe=pe.dgst;pe=Oe,te=Error(C(419)),te.stack="",te.digest=pe,Go({value:te,source:null,stack:null}),Y=zc(N,Y,K)}else if(Hn||$l(N,Y,K,!1),pe=(K&N.childLanes)!==0,Hn||pe){if(pe=Qi,pe!==null){if(te=K&-K,(te&42)!==0)te=1;else switch(te){case 2:te=1;break;case 8:te=4;break;case 32:te=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:te=64;break;case 268435456:te=134217728;break;default:te=0}if(te=(te&(pe.suspendedLanes|K))!==0?0:te,te!==0&&te!==Te.retryLane)throw Te.retryLane=te,Po(N,te),Wn(pe,N,te),Ys}xe.data==="$?"||sc(),Y=zc(N,Y,K)}else xe.data==="$?"?(Y.flags|=128,Y.child=N.child,Y=Ra.bind(null,N),xe._reactRetry=Y,Y=null):(N=Te.treeContext,Pn=Cr(xe.nextSibling),ss=Y,Ji=!0,Ps=null,ks=!1,N!==null&&(an[Es++]=yo,an[Es++]=Do,an[Es++]=ko,yo=N.id,Do=N.overflow,ko=Y),Y=$g(Y,te.children),Y.flags|=4096);return Y}return oe?(jo(),oe=te.fallback,xe=Y.mode,Te=N.child,Oe=Te.sibling,te=As(Te,{mode:"hidden",children:te.children}),te.subtreeFlags=Te.subtreeFlags&31457280,Oe!==null?oe=As(Oe,oe):(oe=Dr(oe,xe,K,null),oe.flags|=2),oe.return=Y,te.return=Y,te.sibling=oe,Y.child=te,te=oe,oe=Y.child,xe=N.child.memoizedState,xe===null?xe=kn(K):(Te=xe.cachePool,Te!==null?(Oe=yn._currentValue,Te=Te.parent!==Oe?{parent:Oe,pool:Oe}:Te):Te=qo(),xe={baseLanes:xe.baseLanes|K,cachePool:Te}),oe.memoizedState=xe,oe.childLanes=Hc(N,pe,K),Y.memoizedState=Ug,te):($o(Y),K=N.child,N=K.sibling,K=As(K,{mode:"visible",children:te.children}),K.return=Y,K.sibling=null,N!==null&&(pe=Y.deletions,pe===null?(Y.deletions=[N],Y.flags|=16):pe.push(N)),Y.child=K,Y.memoizedState=null,K)}function $g(N,Y){return Y=jg({mode:"visible",children:Y},N.mode),Y.return=N,N.child=Y}function jg(N,Y){return eu(N,Y,0,null)}function zc(N,Y,K){return Oo(Y,N.child,null,K),N=$g(Y,Y.pendingProps.children),N.flags|=2,Y.memoizedState=null,N}function Fc(N,Y,K){N.lanes|=Y;var te=N.alternate;te!==null&&(te.lanes|=Y),Ts(N.return,Y,K)}function Jr(N,Y,K,te,oe){var ue=N.memoizedState;ue===null?N.memoizedState={isBackwards:Y,rendering:null,renderingStartTime:0,last:te,tail:K,tailMode:oe}:(ue.isBackwards=Y,ue.rendering=null,ue.renderingStartTime=0,ue.last=te,ue.tail=K,ue.tailMode=oe)}function ba(N,Y,K){var te=Y.pendingProps,oe=te.revealOrder,ue=te.tail;if(zn(N,Y,te.children,K),te=Zn.current,(te&2)!==0)te=te&1|2,Y.flags|=128;else{if(N!==null&&(N.flags&128)!==0)e:for(N=Y.child;N!==null;){if(N.tag===13)N.memoizedState!==null&&Fc(N,K,Y);else if(N.tag===19)Fc(N,K,Y);else if(N.child!==null){N.child.return=N,N=N.child;continue}if(N===Y)break e;for(;N.sibling===null;){if(N.return===null||N.return===Y)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}te&=1}switch(dt(Zn,te),oe){case"forwards":for(K=Y.child,oe=null;K!==null;)N=K.alternate,N!==null&&Da(N)===null&&(oe=K),K=K.sibling;K=oe,K===null?(oe=Y.child,Y.child=null):(oe=K.sibling,K.sibling=null),Jr(Y,!1,oe,K,ue);break;case"backwards":for(K=null,oe=Y.child,Y.child=null;oe!==null;){if(N=oe.alternate,N!==null&&Da(N)===null){Y.child=oe;break}N=oe.sibling,oe.sibling=K,K=oe,oe=N}Jr(Y,!0,K,null,ue);break;case"together":Jr(Y,!1,null,null,void 0);break;default:Y.memoizedState=null}return Y.child}function vn(N,Y,K){if(N!==null&&(Y.dependencies=N.dependencies),po|=Y.lanes,(K&Y.childLanes)===0)if(N!==null){if($l(N,Y,K,!1),(K&Y.childLanes)===0)return null}else return null;if(N!==null&&Y.child!==N.child)throw Error(C(153));if(Y.child!==null){for(N=Y.child,K=As(N,N.pendingProps),Y.child=K,K.return=Y;N.sibling!==null;)N=N.sibling,K=K.sibling=As(N,N.pendingProps),K.return=Y;K.sibling=null}return Y.child}function Qg(N,Y){return(N.lanes&Y)!==0?!0:(N=N.dependencies,!!(N!==null&&tl(N)))}function ed(N,Y,K){switch(Y.tag){case 3:Jt(Y,Y.stateNode.containerInfo),Hr(Y,yn,N.memoizedState.cache),Pa();break;case 27:case 5:Ht(Y);break;case 4:Jt(Y,Y.stateNode.containerInfo);break;case 10:Hr(Y,Y.type,Y.memoizedProps.value);break;case 13:var te=Y.memoizedState;if(te!==null)return te.dehydrated!==null?($o(Y),Y.flags|=128,null):(K&Y.child.childLanes)!==0?vh(N,Y,K):($o(Y),N=vn(N,Y,K),N!==null?N.sibling:null);$o(Y);break;case 19:var oe=(N.flags&128)!==0;if(te=(K&Y.childLanes)!==0,te||($l(N,Y,K,!1),te=(K&Y.childLanes)!==0),oe){if(te)return ba(N,Y,K);Y.flags|=128}if(oe=Y.memoizedState,oe!==null&&(oe.rendering=null,oe.tail=null,oe.lastEffect=null),dt(Zn,Zn.current),te)break;return null;case 22:case 23:return Y.lanes=0,bh(N,Y,K);case 24:Hr(Y,yn,N.memoizedState.cache)}return vn(N,Y,K)}function Ul(N,Y,K){if(N!==null)if(N.memoizedProps!==Y.pendingProps)Hn=!0;else{if(!Qg(N,K)&&(Y.flags&128)===0)return Hn=!1,ed(N,Y,K);Hn=(N.flags&131072)!==0}else Hn=!1,Ji&&(Y.flags&1048576)!==0&&Bg(Y,Yl,Y.index);switch(Y.lanes=0,Y.tag){case 16:e:{N=Y.pendingProps;var te=Y.elementType,oe=te._init;if(te=oe(te._payload),Y.type=te,typeof te=="function")cr(te)?(N=Aa(te,N),Y.tag=1,Y=Gh(null,Y,te,N,K)):(Y.tag=0,Y=Dg(null,Y,te,N,K));else{if(te!=null){if(oe=te.$$typeof,oe===F){Y.tag=11,Y=Lg(null,Y,te,N,K);break e}else if(oe===U){Y.tag=14,Y=Kg(null,Y,te,N,K);break e}}throw Y=ce(te)||te,Error(C(306,Y,""))}}return Y;case 0:return Dg(N,Y,Y.type,Y.pendingProps,K);case 1:return te=Y.type,oe=Aa(te,Y.pendingProps),Gh(N,Y,te,oe,K);case 3:e:{if(Jt(Y,Y.stateNode.containerInfo),N===null)throw Error(C(387));var ue=Y.pendingProps;oe=Y.memoizedState,te=oe.element,Pc(N,Y),uo(Y,ue,null,K);var pe=Y.memoizedState;if(ue=pe.cache,Hr(Y,yn,ue),ue!==oe.cache&&Lc(Y,[yn],K,!0),rs(),ue=pe.element,oe.isDehydrated)if(oe={element:ue,isDehydrated:!1,cache:pe.cache},Y.updateQueue.baseState=oe,Y.memoizedState=oe,Y.flags&256){Y=Og(N,Y,ue,K);break e}else if(ue!==te){te=Rs(Error(C(424)),Y),Go(te),Y=Og(N,Y,ue,K);break e}else for(Pn=Cr(Y.stateNode.containerInfo.firstChild),ss=Y,Ji=!0,Ps=null,ks=!0,K=Uo(Y,null,ue,K),Y.child=K;K;)K.flags=K.flags&-3|4096,K=K.sibling;else{if(Pa(),ue===te){Y=vn(N,Y,K);break e}zn(N,Y,ue,K)}Y=Y.child}return Y;case 26:return qa(N,Y),N===null?(K=Fd(Y.type,null,Y.pendingProps,null))?Y.memoizedState=K:Ji||(K=Y.type,N=Y.pendingProps,te=wh(nt.current).createElement(K),te[on]=Y,te[pi]=N,Gs(te,K,N),tt(te),Y.stateNode=te):Y.memoizedState=Fd(Y.type,N.memoizedProps,Y.pendingProps,N.memoizedState),null;case 27:return Ht(Y),N===null&&Ji&&(te=Y.stateNode=Jd(Y.type,Y.pendingProps,nt.current),ss=Y,ks=!0,Pn=Cr(te.firstChild)),te=Y.pendingProps.children,N!==null||Ji?zn(N,Y,te,K):Y.child=Oo(Y,null,te,K),qa(N,Y),Y.child;case 5:return N===null&&Ji&&((oe=te=Pn)&&(te=pC(te,Y.type,Y.pendingProps,ks),te!==null?(Y.stateNode=te,ss=Y,Pn=Cr(te.firstChild),ks=!1,oe=!0):oe=!1),oe||aa(Y)),Ht(Y),oe=Y.type,ue=Y.pendingProps,pe=N!==null?N.memoizedProps:null,te=ue.children,ud(oe,ue)?te=null:pe!==null&&ud(oe,pe)&&(Y.flags|=32),Y.memoizedState!==null&&(oe=_g(N,Y,Uh,null,null,K),cu._currentValue=oe),qa(N,Y),zn(N,Y,te,K),Y.child;case 6:return N===null&&Ji&&((N=K=Pn)&&(K=mC(K,Y.pendingProps,ks),K!==null?(Y.stateNode=K,ss=Y,Pn=null,N=!0):N=!1),N||aa(Y)),null;case 13:return vh(N,Y,K);case 4:return Jt(Y,Y.stateNode.containerInfo),te=Y.pendingProps,N===null?Y.child=Oo(Y,null,te,K):zn(N,Y,te,K),Y.child;case 11:return Lg(N,Y,Y.type,Y.pendingProps,K);case 7:return zn(N,Y,Y.pendingProps,K),Y.child;case 8:return zn(N,Y,Y.pendingProps.children,K),Y.child;case 12:return zn(N,Y,Y.pendingProps.children,K),Y.child;case 10:return te=Y.pendingProps,Hr(Y,Y.type,te.value),zn(N,Y,te.children,K),Y.child;case 9:return oe=Y.type._context,te=Y.pendingProps.children,ya(Y),oe=os(oe),te=te(oe),Y.flags|=1,zn(N,Y,te,K),Y.child;case 14:return Kg(N,Y,Y.type,Y.pendingProps,K);case 15:return Pg(N,Y,Y.type,Y.pendingProps,K);case 19:return ba(N,Y,K);case 22:return bh(N,Y,K);case 24:return ya(Y),te=os(yn),N===null?(oe=Pl(),oe===null&&(oe=Qi,ue=Xg(),oe.pooledCache=ue,ue.refCount++,ue!==null&&(oe.pooledCacheLanes|=K),oe=ue),Y.memoizedState={parent:te,cache:oe},ps(Y),Hr(Y,yn,oe)):((N.lanes&K)!==0&&(Pc(N,Y),uo(Y,null,null,K),rs()),oe=N.memoizedState,ue=Y.memoizedState,oe.parent!==te?(oe={parent:te,cache:te},Y.memoizedState=oe,Y.lanes===0&&(Y.memoizedState=Y.updateQueue.baseState=oe),Hr(Y,yn,te)):(te=ue.cache,Hr(Y,yn,te),te!==oe.cache&&Lc(Y,[yn],K,!0))),zn(N,Y,Y.pendingProps.children,K),Y.child;case 29:throw Y.pendingProps}throw Error(C(156,Y.tag))}var el=Ke(null),Ro=null,go=null;function Hr(N,Y,K){dt(el,Y._currentValue),Y._currentValue=K}function nr(N){N._currentValue=el.current,Rt(el)}function Ts(N,Y,K){for(;N!==null;){var te=N.alternate;if((N.childLanes&Y)!==Y?(N.childLanes|=Y,te!==null&&(te.childLanes|=Y)):te!==null&&(te.childLanes&Y)!==Y&&(te.childLanes|=Y),N===K)break;N=N.return}}function Lc(N,Y,K,te){var oe=N.child;for(oe!==null&&(oe.return=N);oe!==null;){var ue=oe.dependencies;if(ue!==null){var pe=oe.child;ue=ue.firstContext;e:for(;ue!==null;){var xe=ue;ue=oe;for(var Te=0;Te<Y.length;Te++)if(xe.context===Y[Te]){ue.lanes|=K,xe=ue.alternate,xe!==null&&(xe.lanes|=K),Ts(ue.return,K,N),te||(pe=null);break e}ue=xe.next}}else if(oe.tag===18){if(pe=oe.return,pe===null)throw Error(C(341));pe.lanes|=K,ue=pe.alternate,ue!==null&&(ue.lanes|=K),Ts(pe,K,N),pe=null}else pe=oe.child;if(pe!==null)pe.return=oe;else for(pe=oe;pe!==null;){if(pe===N){pe=null;break}if(oe=pe.sibling,oe!==null){oe.return=pe.return,pe=oe;break}pe=pe.return}oe=pe}}function $l(N,Y,K,te){N=null;for(var oe=Y,ue=!1;oe!==null;){if(!ue){if((oe.flags&524288)!==0)ue=!0;else if((oe.flags&262144)!==0)break}if(oe.tag===10){var pe=oe.alternate;if(pe===null)throw Error(C(387));if(pe=pe.memoizedProps,pe!==null){var xe=oe.type;Ss(oe.pendingProps.value,pe.value)||(N!==null?N.push(xe):N=[xe])}}else if(oe===we.current){if(pe=oe.alternate,pe===null)throw Error(C(387));pe.memoizedState.memoizedState!==oe.memoizedState.memoizedState&&(N!==null?N.push(cu):N=[cu])}oe=oe.return}N!==null&&Lc(Y,N,K,te),Y.flags|=262144}function tl(N){for(N=N.firstContext;N!==null;){if(!Ss(N.context._currentValue,N.memoizedValue))return!0;N=N.next}return!1}function ya(N){Ro=N,go=null,N=N.dependencies,N!==null&&(N.firstContext=null)}function os(N){return il(Ro,N)}function Kc(N,Y){return Ro===null&&ya(N),il(N,Y)}function il(N,Y){var K=Y._currentValue;if(Y={context:Y,memoizedValue:K,next:null},go===null){if(N===null)throw Error(C(308));go=Y,N.dependencies={lanes:0,firstContext:Y},N.flags|=524288}else go=go.next=Y;return K}var Nn=!1;function ps(N){N.updateQueue={baseState:N.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Pc(N,Y){N=N.updateQueue,Y.updateQueue===N&&(Y.updateQueue={baseState:N.baseState,firstBaseUpdate:N.firstBaseUpdate,lastBaseUpdate:N.lastBaseUpdate,shared:N.shared,callbacks:null})}function Js(N){return{lane:N,tag:0,payload:null,callback:null,next:null}}function Hs(N,Y,K){var te=N.updateQueue;if(te===null)return null;if(te=te.shared,(bi&2)!==0){var oe=te.pending;return oe===null?Y.next=Y:(Y.next=oe.next,oe.next=Y),te.pending=Y,Y=Wl(N),El(N,null,K),Y}return Vl(N,te,Y,K),Wl(N)}function zr(N,Y,K){if(Y=Y.updateQueue,Y!==null&&(Y=Y.shared,(K&4194176)!==0)){var te=Y.lanes;te&=N.pendingLanes,K|=te,Y.lanes=K,Tn(N,K)}}function nl(N,Y){var K=N.updateQueue,te=N.alternate;if(te!==null&&(te=te.updateQueue,K===te)){var oe=null,ue=null;if(K=K.firstBaseUpdate,K!==null){do{var pe={lane:K.lane,tag:K.tag,payload:K.payload,callback:null,next:null};ue===null?oe=ue=pe:ue=ue.next=pe,K=K.next}while(K!==null);ue===null?oe=ue=Y:ue=ue.next=Y}else oe=ue=Y;K={baseState:te.baseState,firstBaseUpdate:oe,lastBaseUpdate:ue,shared:te.shared,callbacks:te.callbacks},N.updateQueue=K;return}N=K.lastBaseUpdate,N===null?K.firstBaseUpdate=Y:N.next=Y,K.lastBaseUpdate=Y}var Zs=!1;function rs(){if(Zs){var N=Mr;if(N!==null)throw N}}function uo(N,Y,K,te){Zs=!1;var oe=N.updateQueue;Nn=!1;var ue=oe.firstBaseUpdate,pe=oe.lastBaseUpdate,xe=oe.shared.pending;if(xe!==null){oe.shared.pending=null;var Te=xe,Oe=Te.next;Te.next=null,pe===null?ue=Oe:pe.next=Oe,pe=Te;var Bt=N.alternate;Bt!==null&&(Bt=Bt.updateQueue,xe=Bt.lastBaseUpdate,xe!==pe&&(xe===null?Bt.firstBaseUpdate=Oe:xe.next=Oe,Bt.lastBaseUpdate=Te))}if(ue!==null){var Vt=oe.baseState;pe=0,Bt=Oe=Te=null,xe=ue;do{var gt=xe.lane&-536870913,yt=gt!==xe.lane;if(yt?(ui&gt)===gt:(te&gt)===gt){gt!==0&&gt===ha&&(Zs=!0),Bt!==null&&(Bt=Bt.next={lane:0,tag:xe.tag,payload:xe.payload,callback:null,next:null});e:{var ai=N,vi=xe;gt=Y;var Yn=K;switch(vi.tag){case 1:if(ai=vi.payload,typeof ai=="function"){Vt=ai.call(Yn,Vt,gt);break e}Vt=ai;break e;case 3:ai.flags=ai.flags&-65537|128;case 0:if(ai=vi.payload,gt=typeof ai=="function"?ai.call(Yn,Vt,gt):ai,gt==null)break e;Vt=he({},Vt,gt);break e;case 2:Nn=!0}}gt=xe.callback,gt!==null&&(N.flags|=64,yt&&(N.flags|=8192),yt=oe.callbacks,yt===null?oe.callbacks=[gt]:yt.push(gt))}else yt={lane:gt,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},Bt===null?(Oe=Bt=yt,Te=Vt):Bt=Bt.next=yt,pe|=gt;if(xe=xe.next,xe===null){if(xe=oe.shared.pending,xe===null)break;yt=xe,xe=yt.next,yt.next=null,oe.lastBaseUpdate=yt,oe.shared.pending=null}}while(!0);Bt===null&&(Te=Vt),oe.baseState=Te,oe.firstBaseUpdate=Oe,oe.lastBaseUpdate=Bt,ue===null&&(oe.shared.lanes=0),po|=pe,N.lanes=pe,N.memoizedState=Vt}}function _o(N,Y){if(typeof N!="function")throw Error(C(191,N));N.call(Y)}function wo(N,Y){var K=N.callbacks;if(K!==null)for(N.callbacks=null,N=0;N<K.length;N++)_o(K[N],Y)}function Bn(N,Y){try{var K=Y.updateQueue,te=K!==null?K.lastEffect:null;if(te!==null){var oe=te.next;K=oe;do{if((K.tag&N)===N){te=void 0;var ue=K.create,pe=K.inst;te=ue(),pe.destroy=te}K=K.next}while(K!==oe)}}catch(xe){Pt(Y,Y.return,xe)}}function Ds(N,Y,K){try{var te=Y.updateQueue,oe=te!==null?te.lastEffect:null;if(oe!==null){var ue=oe.next;te=ue;do{if((te.tag&N)===N){var pe=te.inst,xe=pe.destroy;if(xe!==void 0){pe.destroy=void 0,oe=Y;var Te=K;try{xe()}catch(Oe){Pt(oe,Te,Oe)}}}te=te.next}while(te!==ue)}}catch(Oe){Pt(Y,Y.return,Oe)}}function sr(N){var Y=N.updateQueue;if(Y!==null){var K=N.stateNode;try{wo(Y,K)}catch(te){Pt(N,N.return,te)}}}function jl(N,Y,K){K.props=Aa(N.type,N.memoizedProps),K.state=N.memoizedState;try{K.componentWillUnmount()}catch(te){Pt(N,Y,te)}}function Sn(N,Y){try{var K=N.ref;if(K!==null){var te=N.stateNode;switch(N.tag){case 26:case 27:case 5:var oe=te;break;default:oe=te}typeof K=="function"?N.refCleanup=K(oe):K.current=oe}}catch(ue){Pt(N,Y,ue)}}function ji(N,Y){var K=N.ref,te=N.refCleanup;if(K!==null)if(typeof te=="function")try{te()}catch(oe){Pt(N,Y,oe)}finally{N.refCleanup=null,N=N.alternate,N!=null&&(N.refCleanup=null)}else if(typeof K=="function")try{K(null)}catch(oe){Pt(N,Y,oe)}else K.current=null}function Hi(N){var Y=N.type,K=N.memoizedProps,te=N.stateNode;try{e:switch(Y){case"button":case"input":case"select":case"textarea":K.autoFocus&&te.focus();break e;case"img":K.src?te.src=K.src:K.srcSet&&(te.srcset=K.srcSet)}}catch(oe){Pt(N,N.return,oe)}}function Os(N,Y,K){try{var te=N.stateNode;hC(te,N.type,K,Y),te[pi]=Y}catch(oe){Pt(N,N.return,oe)}}function ho(N){return N.tag===5||N.tag===3||N.tag===26||N.tag===27||N.tag===4}function Ql(N){e:for(;;){for(;N.sibling===null;){if(N.return===null||ho(N.return))return null;N=N.return}for(N.sibling.return=N.return,N=N.sibling;N.tag!==5&&N.tag!==6&&N.tag!==27&&N.tag!==18;){if(N.flags&2||N.child===null||N.tag===4)continue e;N.child.return=N,N=N.child}if(!(N.flags&2))return N.stateNode}}function Ms(N,Y,K){var te=N.tag;if(te===5||te===6)N=N.stateNode,Y?K.nodeType===8?K.parentNode.insertBefore(N,Y):K.insertBefore(N,Y):(K.nodeType===8?(Y=K.parentNode,Y.insertBefore(N,K)):(Y=K,Y.appendChild(N)),K=K._reactRootContainer,K!=null||Y.onclick!==null||(Y.onclick=_h));else if(te!==4&&te!==27&&(N=N.child,N!==null))for(Ms(N,Y,K),N=N.sibling;N!==null;)Ms(N,Y,K),N=N.sibling}function or(N,Y,K){var te=N.tag;if(te===5||te===6)N=N.stateNode,Y?K.insertBefore(N,Y):K.appendChild(N);else if(te!==4&&te!==27&&(N=N.child,N!==null))for(or(N,Y,K),N=N.sibling;N!==null;)or(N,Y,K),N=N.sibling}var Co=!1,gn=!1,Fr=!1,kc=typeof WeakSet=="function"?WeakSet:Set,xn=null,Dc=!1;function sl(N,Y){if(N=N.containerInfo,cd=Wh,N=mg(N),Ml(N)){if("selectionStart"in N)var K={start:N.selectionStart,end:N.selectionEnd};else e:{K=(K=N.ownerDocument)&&K.defaultView||window;var te=K.getSelection&&K.getSelection();if(te&&te.rangeCount!==0){K=te.anchorNode;var oe=te.anchorOffset,ue=te.focusNode;te=te.focusOffset;try{K.nodeType,ue.nodeType}catch{K=null;break e}var pe=0,xe=-1,Te=-1,Oe=0,Bt=0,Vt=N,gt=null;t:for(;;){for(var yt;Vt!==K||oe!==0&&Vt.nodeType!==3||(xe=pe+oe),Vt!==ue||te!==0&&Vt.nodeType!==3||(Te=pe+te),Vt.nodeType===3&&(pe+=Vt.nodeValue.length),(yt=Vt.firstChild)!==null;)gt=Vt,Vt=yt;for(;;){if(Vt===N)break t;if(gt===K&&++Oe===oe&&(xe=pe),gt===ue&&++Bt===te&&(Te=pe),(yt=Vt.nextSibling)!==null)break;Vt=gt,gt=Vt.parentNode}Vt=yt}K=xe===-1||Te===-1?null:{start:xe,end:Te}}else K=null}K=K||{start:0,end:0}}else K=null;for(gd={focusedElem:N,selectionRange:K},Wh=!1,xn=Y;xn!==null;)if(Y=xn,N=Y.child,(Y.subtreeFlags&1028)!==0&&N!==null)N.return=Y,xn=N;else for(;xn!==null;){switch(Y=xn,ue=Y.alternate,N=Y.flags,Y.tag){case 0:break;case 11:case 15:break;case 1:if((N&1024)!==0&&ue!==null){N=void 0,K=Y,oe=ue.memoizedProps,ue=ue.memoizedState,te=K.stateNode;try{var ai=Aa(K.type,oe,K.elementType===K.type);N=te.getSnapshotBeforeUpdate(ai,ue),te.__reactInternalSnapshotBeforeUpdate=N}catch(vi){Pt(K,K.return,vi)}}break;case 3:if((N&1024)!==0){if(N=Y.stateNode.containerInfo,K=N.nodeType,K===9)Cd(N);else if(K===1)switch(N.nodeName){case"HEAD":case"HTML":case"BODY":Cd(N);break;default:N.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((N&1024)!==0)throw Error(C(163))}if(N=Y.sibling,N!==null){N.return=Y.return,xn=N;break}xn=Y.return}return ai=Dc,Dc=!1,ai}function ol(N,Y,K){var te=K.flags;switch(K.tag){case 0:case 11:case 15:Zo(N,K),te&4&&Bn(5,K);break;case 1:if(Zo(N,K),te&4)if(N=K.stateNode,Y===null)try{N.componentDidMount()}catch(xe){Pt(K,K.return,xe)}else{var oe=Aa(K.type,Y.memoizedProps);Y=Y.memoizedState;try{N.componentDidUpdate(oe,Y,N.__reactInternalSnapshotBeforeUpdate)}catch(xe){Pt(K,K.return,xe)}}te&64&&sr(K),te&512&&Sn(K,K.return);break;case 3:if(Zo(N,K),te&64&&(te=K.updateQueue,te!==null)){if(N=null,K.child!==null)switch(K.child.tag){case 27:case 5:N=K.child.stateNode;break;case 1:N=K.child.stateNode}try{wo(te,N)}catch(xe){Pt(K,K.return,xe)}}break;case 26:Zo(N,K),te&512&&Sn(K,K.return);break;case 27:case 5:Zo(N,K),Y===null&&te&4&&Hi(K),te&512&&Sn(K,K.return);break;case 12:Zo(N,K);break;case 13:Zo(N,K),te&4&&Bh(N,K);break;case 22:if(oe=K.memoizedState!==null||Co,!oe){Y=Y!==null&&Y.memoizedState!==null||gn;var ue=Co,pe=gn;Co=oe,(gn=Y)&&!pe?fo(N,K,(K.subtreeFlags&8772)!==0):Zo(N,K),Co=ue,gn=pe}te&512&&(K.memoizedProps.mode==="manual"?Sn(K,K.return):ji(K,K.return));break;default:Zo(N,K)}}function Oc(N){var Y=N.alternate;Y!==null&&(N.alternate=null,Oc(Y)),N.child=null,N.deletions=null,N.sibling=null,N.tag===5&&(Y=N.stateNode,Y!==null&&Qr(Y)),N.stateNode=null,N.return=null,N.dependencies=null,N.memoizedProps=null,N.memoizedState=null,N.pendingProps=null,N.stateNode=null,N.updateQueue=null}var un=null,Dn=!1;function as(N,Y,K){for(K=K.child;K!==null;)Uc(N,Y,K),K=K.sibling}function Uc(N,Y,K){if(Nt&&typeof Nt.onCommitFiberUnmount=="function")try{Nt.onCommitFiberUnmount(Zt,K)}catch{}switch(K.tag){case 26:gn||ji(K,Y),as(N,Y,K),K.memoizedState?K.memoizedState.count--:K.stateNode&&(K=K.stateNode,K.parentNode.removeChild(K));break;case 27:gn||ji(K,Y);var te=un,oe=Dn;for(un=K.stateNode,as(N,Y,K),K=K.stateNode,Y=K.attributes;Y.length;)K.removeAttributeNode(Y[0]);Qr(K),un=te,Dn=oe;break;case 5:gn||ji(K,Y);case 6:oe=un;var ue=Dn;if(un=null,as(N,Y,K),un=oe,Dn=ue,un!==null)if(Dn)try{N=un,te=K.stateNode,N.nodeType===8?N.parentNode.removeChild(te):N.removeChild(te)}catch(pe){Pt(K,Y,pe)}else try{un.removeChild(K.stateNode)}catch(pe){Pt(K,Y,pe)}break;case 18:un!==null&&(Dn?(Y=un,K=K.stateNode,Y.nodeType===8?dd(Y.parentNode,K):Y.nodeType===1&&dd(Y,K),du(Y)):dd(un,K.stateNode));break;case 4:te=un,oe=Dn,un=K.stateNode.containerInfo,Dn=!0,as(N,Y,K),un=te,Dn=oe;break;case 0:case 11:case 14:case 15:gn||Ds(2,K,Y),gn||Ds(4,K,Y),as(N,Y,K);break;case 1:gn||(ji(K,Y),te=K.stateNode,typeof te.componentWillUnmount=="function"&&jl(K,Y,te)),as(N,Y,K);break;case 21:as(N,Y,K);break;case 22:gn||ji(K,Y),gn=(te=gn)||K.memoizedState!==null,as(N,Y,K),gn=te;break;default:as(N,Y,K)}}function Bh(N,Y){if(Y.memoizedState===null&&(N=Y.alternate,N!==null&&(N=N.memoizedState,N!==null&&(N=N.dehydrated,N!==null))))try{du(N)}catch(K){Pt(Y,Y.return,K)}}function ql(N){switch(N.tag){case 13:case 19:var Y=N.stateNode;return Y===null&&(Y=N.stateNode=new kc),Y;case 22:return N=N.stateNode,Y=N._retryCache,Y===null&&(Y=N._retryCache=new kc),Y;default:throw Error(C(435,N.tag))}}function ec(N,Y){var K=ql(N);Y.forEach(function(te){var oe=at.bind(null,N,te);K.has(te)||(K.add(te),te.then(oe,oe))})}function ms(N,Y){var K=Y.deletions;if(K!==null)for(var te=0;te<K.length;te++){var oe=K[te],ue=N,pe=Y,xe=pe;e:for(;xe!==null;){switch(xe.tag){case 27:case 5:un=xe.stateNode,Dn=!1;break e;case 3:un=xe.stateNode.containerInfo,Dn=!0;break e;case 4:un=xe.stateNode.containerInfo,Dn=!0;break e}xe=xe.return}if(un===null)throw Error(C(160));Uc(ue,pe,oe),un=null,Dn=!1,ue=oe.alternate,ue!==null&&(ue.return=null),oe.return=null}if(Y.subtreeFlags&13878)for(Y=Y.child;Y!==null;)Ga(Y,N),Y=Y.sibling}var ls=null;function Ga(N,Y){var K=N.alternate,te=N.flags;switch(N.tag){case 0:case 11:case 14:case 15:ms(Y,N),cs(N),te&4&&(Ds(3,N,N.return),Bn(3,N),Ds(5,N,N.return));break;case 1:ms(Y,N),cs(N),te&512&&(gn||K===null||ji(K,K.return)),te&64&&Co&&(N=N.updateQueue,N!==null&&(te=N.callbacks,te!==null&&(K=N.shared.hiddenCallbacks,N.shared.hiddenCallbacks=K===null?te:K.concat(te))));break;case 26:var oe=ls;if(ms(Y,N),cs(N),te&512&&(gn||K===null||ji(K,K.return)),te&4){var ue=K!==null?K.memoizedState:null;if(te=N.memoizedState,K===null)if(te===null)if(N.stateNode===null){e:{te=N.type,K=N.memoizedProps,oe=oe.ownerDocument||oe;t:switch(te){case"title":ue=oe.getElementsByTagName("title")[0],(!ue||ue[Wo]||ue[on]||ue.namespaceURI==="http://www.w3.org/2000/svg"||ue.hasAttribute("itemprop"))&&(ue=oe.createElement(te),oe.head.insertBefore(ue,oe.querySelector("head > title"))),Gs(ue,te,K),ue[on]=N,tt(ue),te=ue;break e;case"link":var pe=Pd("link","href",oe).get(te+(K.href||""));if(pe){for(var xe=0;xe<pe.length;xe++)if(ue=pe[xe],ue.getAttribute("href")===(K.href==null?null:K.href)&&ue.getAttribute("rel")===(K.rel==null?null:K.rel)&&ue.getAttribute("title")===(K.title==null?null:K.title)&&ue.getAttribute("crossorigin")===(K.crossOrigin==null?null:K.crossOrigin)){pe.splice(xe,1);break t}}ue=oe.createElement(te),Gs(ue,te,K),oe.head.appendChild(ue);break;case"meta":if(pe=Pd("meta","content",oe).get(te+(K.content||""))){for(xe=0;xe<pe.length;xe++)if(ue=pe[xe],ue.getAttribute("content")===(K.content==null?null:""+K.content)&&ue.getAttribute("name")===(K.name==null?null:K.name)&&ue.getAttribute("property")===(K.property==null?null:K.property)&&ue.getAttribute("http-equiv")===(K.httpEquiv==null?null:K.httpEquiv)&&ue.getAttribute("charset")===(K.charSet==null?null:K.charSet)){pe.splice(xe,1);break t}}ue=oe.createElement(te),Gs(ue,te,K),oe.head.appendChild(ue);break;default:throw Error(C(468,te))}ue[on]=N,tt(ue),te=ue}N.stateNode=te}else kd(oe,N.type,N.stateNode);else N.stateNode=Kd(oe,te,N.memoizedProps);else ue!==te?(ue===null?K.stateNode!==null&&(K=K.stateNode,K.parentNode.removeChild(K)):ue.count--,te===null?kd(oe,N.type,N.stateNode):Kd(oe,te,N.memoizedProps)):te===null&&N.stateNode!==null&&Os(N,N.memoizedProps,K.memoizedProps)}break;case 27:if(te&4&&N.alternate===null){oe=N.stateNode,ue=N.memoizedProps;try{for(var Te=oe.firstChild;Te;){var Oe=Te.nextSibling,Bt=Te.nodeName;Te[Wo]||Bt==="HEAD"||Bt==="BODY"||Bt==="SCRIPT"||Bt==="STYLE"||Bt==="LINK"&&Te.rel.toLowerCase()==="stylesheet"||oe.removeChild(Te),Te=Oe}for(var Vt=N.type,gt=oe.attributes;gt.length;)oe.removeAttributeNode(gt[0]);Gs(oe,Vt,ue),oe[on]=N,oe[pi]=ue}catch(ai){Pt(N,N.return,ai)}}case 5:if(ms(Y,N),cs(N),te&512&&(gn||K===null||ji(K,K.return)),N.flags&32){oe=N.stateNode;try{ds(oe,"")}catch(ai){Pt(N,N.return,ai)}}te&4&&N.stateNode!=null&&(oe=N.memoizedProps,Os(N,oe,K!==null?K.memoizedProps:oe)),te&1024&&(Fr=!0);break;case 6:if(ms(Y,N),cs(N),te&4){if(N.stateNode===null)throw Error(C(162));te=N.memoizedProps,K=N.stateNode;try{K.nodeValue=te}catch(ai){Pt(N,N.return,ai)}}break;case 3:if(Nh=null,oe=ls,ls=Zh(Y.containerInfo),ms(Y,N),ls=oe,cs(N),te&4&&K!==null&&K.memoizedState.isDehydrated)try{du(Y.containerInfo)}catch(ai){Pt(N,N.return,ai)}Fr&&(Fr=!1,Lr(N));break;case 4:te=ls,ls=Zh(N.stateNode.containerInfo),ms(Y,N),cs(N),ls=te;break;case 12:ms(Y,N),cs(N);break;case 13:ms(Y,N),cs(N),N.child.flags&8192&&N.memoizedState!==null!=(K!==null&&K.memoizedState!==null)&&(xi=ht()),te&4&&(te=N.updateQueue,te!==null&&(N.updateQueue=null,ec(N,te)));break;case 22:if(te&512&&(gn||K===null||ji(K,K.return)),Te=N.memoizedState!==null,Oe=K!==null&&K.memoizedState!==null,Bt=Co,Vt=gn,Co=Bt||Te,gn=Vt||Oe,ms(Y,N),gn=Vt,Co=Bt,cs(N),Y=N.stateNode,Y._current=N,Y._visibility&=-3,Y._visibility|=Y._pendingVisibility&2,te&8192&&(Y._visibility=Te?Y._visibility&-2:Y._visibility|1,Te&&(Y=Co||gn,K===null||Oe||Y||Io(N)),N.memoizedProps===null||N.memoizedProps.mode!=="manual"))e:for(K=null,Y=N;;){if(Y.tag===5||Y.tag===26||Y.tag===27){if(K===null){Oe=K=Y;try{if(oe=Oe.stateNode,Te)ue=oe.style,typeof ue.setProperty=="function"?ue.setProperty("display","none","important"):ue.display="none";else{pe=Oe.stateNode,xe=Oe.memoizedProps.style;var yt=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;pe.style.display=yt==null||typeof yt=="boolean"?"":(""+yt).trim()}}catch(ai){Pt(Oe,Oe.return,ai)}}}else if(Y.tag===6){if(K===null){Oe=Y;try{Oe.stateNode.nodeValue=Te?"":Oe.memoizedProps}catch(ai){Pt(Oe,Oe.return,ai)}}}else if((Y.tag!==22&&Y.tag!==23||Y.memoizedState===null||Y===N)&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===N)break e;for(;Y.sibling===null;){if(Y.return===null||Y.return===N)break e;K===Y&&(K=null),Y=Y.return}K===Y&&(K=null),Y.sibling.return=Y.return,Y=Y.sibling}te&4&&(te=N.updateQueue,te!==null&&(K=te.retryQueue,K!==null&&(te.retryQueue=null,ec(N,K))));break;case 19:ms(Y,N),cs(N),te&4&&(te=N.updateQueue,te!==null&&(N.updateQueue=null,ec(N,te)));break;case 21:break;default:ms(Y,N),cs(N)}}function cs(N){var Y=N.flags;if(Y&2){try{if(N.tag!==27){e:{for(var K=N.return;K!==null;){if(ho(K)){var te=K;break e}K=K.return}throw Error(C(160))}switch(te.tag){case 27:var oe=te.stateNode,ue=Ql(N);or(N,ue,oe);break;case 5:var pe=te.stateNode;te.flags&32&&(ds(pe,""),te.flags&=-33);var xe=Ql(N);or(N,xe,pe);break;case 3:case 4:var Te=te.stateNode.containerInfo,Oe=Ql(N);Ms(N,Oe,Te);break;default:throw Error(C(161))}}}catch(Bt){Pt(N,N.return,Bt)}N.flags&=-3}Y&4096&&(N.flags&=-4097)}function Lr(N){if(N.subtreeFlags&1024)for(N=N.child;N!==null;){var Y=N;Lr(Y),Y.tag===5&&Y.flags&1024&&Y.stateNode.reset(),N=N.sibling}}function Zo(N,Y){if(Y.subtreeFlags&8772)for(Y=Y.child;Y!==null;)ol(N,Y.alternate,Y),Y=Y.sibling}function Io(N){for(N=N.child;N!==null;){var Y=N;switch(Y.tag){case 0:case 11:case 14:case 15:Ds(4,Y,Y.return),Io(Y);break;case 1:ji(Y,Y.return);var K=Y.stateNode;typeof K.componentWillUnmount=="function"&&jl(Y,Y.return,K),Io(Y);break;case 26:case 27:case 5:ji(Y,Y.return),Io(Y);break;case 22:ji(Y,Y.return),Y.memoizedState===null&&Io(Y);break;default:Io(Y)}N=N.sibling}}function fo(N,Y,K){for(K=K&&(Y.subtreeFlags&8772)!==0,Y=Y.child;Y!==null;){var te=Y.alternate,oe=N,ue=Y,pe=ue.flags;switch(ue.tag){case 0:case 11:case 15:fo(oe,ue,K),Bn(4,ue);break;case 1:if(fo(oe,ue,K),te=ue,oe=te.stateNode,typeof oe.componentDidMount=="function")try{oe.componentDidMount()}catch(Oe){Pt(te,te.return,Oe)}if(te=ue,oe=te.updateQueue,oe!==null){var xe=te.stateNode;try{var Te=oe.shared.hiddenCallbacks;if(Te!==null)for(oe.shared.hiddenCallbacks=null,oe=0;oe<Te.length;oe++)_o(Te[oe],xe)}catch(Oe){Pt(te,te.return,Oe)}}K&&pe&64&&sr(ue),Sn(ue,ue.return);break;case 26:case 27:case 5:fo(oe,ue,K),K&&te===null&&pe&4&&Hi(ue),Sn(ue,ue.return);break;case 12:fo(oe,ue,K);break;case 13:fo(oe,ue,K),K&&pe&4&&Bh(oe,ue);break;case 22:ue.memoizedState===null&&fo(oe,ue,K),Sn(ue,ue.return);break;default:fo(oe,ue,K)}Y=Y.sibling}}function Ns(N,Y){var K=null;N!==null&&N.memoizedState!==null&&N.memoizedState.cachePool!==null&&(K=N.memoizedState.cachePool.pool),N=null,Y.memoizedState!==null&&Y.memoizedState.cachePool!==null&&(N=Y.memoizedState.cachePool.pool),N!==K&&(N!=null&&N.refCount++,K!=null&&wr(K))}function Us(N,Y){N=null,Y.alternate!==null&&(N=Y.alternate.memoizedState.cache),Y=Y.memoizedState.cache,Y!==N&&(Y.refCount++,N!=null&&wr(N))}function ln(N,Y,K,te){if(Y.subtreeFlags&10256)for(Y=Y.child;Y!==null;)rr(N,Y,K,te),Y=Y.sibling}function rr(N,Y,K,te){var oe=Y.flags;switch(Y.tag){case 0:case 11:case 15:ln(N,Y,K,te),oe&2048&&Bn(9,Y);break;case 3:ln(N,Y,K,te),oe&2048&&(N=null,Y.alternate!==null&&(N=Y.alternate.memoizedState.cache),Y=Y.memoizedState.cache,Y!==N&&(Y.refCount++,N!=null&&wr(N)));break;case 12:if(oe&2048){ln(N,Y,K,te),N=Y.stateNode;try{var ue=Y.memoizedProps,pe=ue.id,xe=ue.onPostCommit;typeof xe=="function"&&xe(pe,Y.alternate===null?"mount":"update",N.passiveEffectDuration,-0)}catch(Te){Pt(Y,Y.return,Te)}}else ln(N,Y,K,te);break;case 23:break;case 22:ue=Y.stateNode,Y.memoizedState!==null?ue._visibility&4?ln(N,Y,K,te):Fi(N,Y):ue._visibility&4?ln(N,Y,K,te):(ue._visibility|=4,Ai(N,Y,K,te,(Y.subtreeFlags&10256)!==0)),oe&2048&&Ns(Y.alternate,Y);break;case 24:ln(N,Y,K,te),oe&2048&&Us(Y.alternate,Y);break;default:ln(N,Y,K,te)}}function Ai(N,Y,K,te,oe){for(oe=oe&&(Y.subtreeFlags&10256)!==0,Y=Y.child;Y!==null;){var ue=N,pe=Y,xe=K,Te=te,Oe=pe.flags;switch(pe.tag){case 0:case 11:case 15:Ai(ue,pe,xe,Te,oe),Bn(8,pe);break;case 23:break;case 22:var Bt=pe.stateNode;pe.memoizedState!==null?Bt._visibility&4?Ai(ue,pe,xe,Te,oe):Fi(ue,pe):(Bt._visibility|=4,Ai(ue,pe,xe,Te,oe)),oe&&Oe&2048&&Ns(pe.alternate,pe);break;case 24:Ai(ue,pe,xe,Te,oe),oe&&Oe&2048&&Us(pe.alternate,pe);break;default:Ai(ue,pe,xe,Te,oe)}Y=Y.sibling}}function Fi(N,Y){if(Y.subtreeFlags&10256)for(Y=Y.child;Y!==null;){var K=N,te=Y,oe=te.flags;switch(te.tag){case 22:Fi(K,te),oe&2048&&Ns(te.alternate,te);break;case 24:Fi(K,te),oe&2048&&Us(te.alternate,te);break;default:Fi(K,te)}Y=Y.sibling}}var In=8192;function ar(N){if(N.subtreeFlags&In)for(N=N.child;N!==null;)va(N),N=N.sibling}function va(N){switch(N.tag){case 26:ar(N),N.flags&In&&N.memoizedState!==null&&ZC(ls,N.memoizedState,N.memoizedProps);break;case 5:ar(N);break;case 3:case 4:var Y=ls;ls=Zh(N.stateNode.containerInfo),ar(N),ls=Y;break;case 22:N.memoizedState===null&&(Y=N.alternate,Y!==null&&Y.memoizedState!==null?(Y=In,In=16777216,ar(N),In=Y):ar(N));break;default:ar(N)}}function Kr(N){var Y=N.alternate;if(Y!==null&&(N=Y.child,N!==null)){Y.child=null;do Y=N.sibling,N.sibling=null,N=Y;while(N!==null)}}function Pr(N){var Y=N.deletions;if((N.flags&16)!==0){if(Y!==null)for(var K=0;K<Y.length;K++){var te=Y[K];xn=te,Sh(te,N)}Kr(N)}if(N.subtreeFlags&10256)for(N=N.child;N!==null;)rl(N),N=N.sibling}function rl(N){switch(N.tag){case 0:case 11:case 15:Pr(N),N.flags&2048&&Ds(9,N,N.return);break;case 3:Pr(N);break;case 12:Pr(N);break;case 22:var Y=N.stateNode;N.memoizedState!==null&&Y._visibility&4&&(N.return===null||N.return.tag!==13)?(Y._visibility&=-5,lr(N)):Pr(N);break;default:Pr(N)}}function lr(N){var Y=N.deletions;if((N.flags&16)!==0){if(Y!==null)for(var K=0;K<Y.length;K++){var te=Y[K];xn=te,Sh(te,N)}Kr(N)}for(N=N.child;N!==null;){switch(Y=N,Y.tag){case 0:case 11:case 15:Ds(8,Y,Y.return),lr(Y);break;case 22:K=Y.stateNode,K._visibility&4&&(K._visibility&=-5,lr(Y));break;default:lr(Y)}N=N.sibling}}function Sh(N,Y){for(;xn!==null;){var K=xn;switch(K.tag){case 0:case 11:case 15:Ds(8,K,Y);break;case 23:case 22:if(K.memoizedState!==null&&K.memoizedState.cachePool!==null){var te=K.memoizedState.cachePool.pool;te!=null&&te.refCount++}break;case 24:wr(K.memoizedState.cache)}if(te=K.child,te!==null)te.return=K,xn=te;else e:for(K=N;xn!==null;){te=xn;var oe=te.sibling,ue=te.return;if(Oc(te),te===K){xn=null;break e}if(oe!==null){oe.return=ue,xn=oe;break e}xn=ue}}}function qg(N,Y,K,te){this.tag=N,this.key=K,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=Y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=te,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xn(N,Y,K,te){return new qg(N,Y,K,te)}function cr(N){return N=N.prototype,!(!N||!N.isReactComponent)}function As(N,Y){var K=N.alternate;return K===null?(K=Xn(N.tag,Y,N.key,N.mode),K.elementType=N.elementType,K.type=N.type,K.stateNode=N.stateNode,K.alternate=N,N.alternate=K):(K.pendingProps=Y,K.type=N.type,K.flags=0,K.subtreeFlags=0,K.deletions=null),K.flags=N.flags&31457280,K.childLanes=N.childLanes,K.lanes=N.lanes,K.child=N.child,K.memoizedProps=N.memoizedProps,K.memoizedState=N.memoizedState,K.updateQueue=N.updateQueue,Y=N.dependencies,K.dependencies=Y===null?null:{lanes:Y.lanes,firstContext:Y.firstContext},K.sibling=N.sibling,K.index=N.index,K.ref=N.ref,K.refCleanup=N.refCleanup,K}function kr(N,Y){N.flags&=31457282;var K=N.alternate;return K===null?(N.childLanes=0,N.lanes=Y,N.child=null,N.subtreeFlags=0,N.memoizedProps=null,N.memoizedState=null,N.updateQueue=null,N.dependencies=null,N.stateNode=null):(N.childLanes=K.childLanes,N.lanes=K.lanes,N.child=K.child,N.subtreeFlags=0,N.deletions=null,N.memoizedProps=K.memoizedProps,N.memoizedState=K.memoizedState,N.updateQueue=K.updateQueue,N.type=K.type,Y=K.dependencies,N.dependencies=Y===null?null:{lanes:Y.lanes,firstContext:Y.firstContext}),N}function al(N,Y,K,te,oe,ue){var pe=0;if(te=N,typeof N=="function")cr(N)&&(pe=1);else if(typeof N=="string")pe=_C(N,K,Ut.current)?26:N==="html"||N==="head"||N==="body"?27:5;else e:switch(N){case _:return Dr(K.children,oe,ue,Y);case Z:pe=8,oe|=24;break;case M:return N=Xn(12,K,Y,oe|2),N.elementType=M,N.lanes=ue,N;case O:return N=Xn(13,K,Y,oe),N.elementType=O,N.lanes=ue,N;case $:return N=Xn(19,K,Y,oe),N.elementType=$,N.lanes=ue,N;case Q:return eu(K,oe,ue,Y);default:if(typeof N=="object"&&N!==null)switch(N.$$typeof){case V:case H:pe=10;break e;case T:pe=9;break e;case F:pe=11;break e;case U:pe=14;break e;case ee:pe=16,te=null;break e}pe=29,K=Error(C(130,N===null?"null":typeof N,"")),te=null}return Y=Xn(pe,K,Y,oe),Y.elementType=N,Y.type=te,Y.lanes=ue,Y}function Dr(N,Y,K,te){return N=Xn(7,N,te,Y),N.lanes=K,N}function eu(N,Y,K,te){N=Xn(22,N,te,Y),N.elementType=Q,N.lanes=K;var oe={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var ue=oe._current;if(ue===null)throw Error(C(456));if((oe._pendingVisibility&2)===0){var pe=Po(ue,2);pe!==null&&(oe._pendingVisibility|=2,Wn(pe,ue,2))}},attach:function(){var ue=oe._current;if(ue===null)throw Error(C(456));if((oe._pendingVisibility&2)!==0){var pe=Po(ue,2);pe!==null&&(oe._pendingVisibility&=-3,Wn(pe,ue,2))}}};return N.stateNode=oe,N}function Vn(N,Y,K){return N=Xn(6,N,null,Y),N.lanes=K,N}function tc(N,Y,K){return Y=Xn(4,N.children!==null?N.children:[],N.key,Y),Y.lanes=K,Y.stateNode={containerInfo:N.containerInfo,pendingChildren:null,implementation:N.implementation},Y}function $s(N){N.flags|=4}function Or(N,Y){if(Y.type!=="stylesheet"||(Y.state.loading&4)!==0)N.flags&=-16777217;else if(N.flags|=16777216,!Dd(Y)){if(Y=_s.current,Y!==null&&((ui&4194176)===ui?vo!==null:(ui&62914560)!==ui&&(ui&536870912)===0||Y!==vo))throw ka=xc,Sg;N.flags|=8192}}function js(N,Y){Y!==null&&(N.flags|=4),N.flags&16384&&(Y=N.tag!==22?Gi():536870912,N.lanes|=Y,No|=Y)}function ic(N,Y){if(!Ji)switch(N.tailMode){case"hidden":Y=N.tail;for(var K=null;Y!==null;)Y.alternate!==null&&(K=Y),Y=Y.sibling;K===null?N.tail=null:K.sibling=null;break;case"collapsed":K=N.tail;for(var te=null;K!==null;)K.alternate!==null&&(te=K),K=K.sibling;te===null?Y||N.tail===null?N.tail=null:N.tail.sibling=null:te.sibling=null}}function pn(N){var Y=N.alternate!==null&&N.alternate.child===N.child,K=0,te=0;if(Y)for(var oe=N.child;oe!==null;)K|=oe.lanes|oe.childLanes,te|=oe.subtreeFlags&31457280,te|=oe.flags&31457280,oe.return=N,oe=oe.sibling;else for(oe=N.child;oe!==null;)K|=oe.lanes|oe.childLanes,te|=oe.subtreeFlags,te|=oe.flags,oe.return=N,oe=oe.sibling;return N.subtreeFlags|=te,N.childLanes=K,Y}function td(N,Y,K){var te=Y.pendingProps;switch(Sr(Y),Y.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(Y),null;case 1:return pn(Y),null;case 3:return K=Y.stateNode,te=null,N!==null&&(te=N.memoizedState.cache),Y.memoizedState.cache!==te&&(Y.flags|=2048),nr(yn),It(),K.pendingContext&&(K.context=K.pendingContext,K.pendingContext=null),(N===null||N.child===null)&&(Ka(Y)?$s(Y):N===null||N.memoizedState.isDehydrated&&(Y.flags&256)===0||(Y.flags|=1024,Ps!==null&&(to(Ps),Ps=null))),pn(Y),null;case 26:return K=Y.memoizedState,N===null?($s(Y),K!==null?(pn(Y),Or(Y,K)):(pn(Y),Y.flags&=-16777217)):K?K!==N.memoizedState?($s(Y),pn(Y),Or(Y,K)):(pn(Y),Y.flags&=-16777217):(N.memoizedProps!==te&&$s(Y),pn(Y),Y.flags&=-16777217),null;case 27:mt(Y),K=nt.current;var oe=Y.type;if(N!==null&&Y.stateNode!=null)N.memoizedProps!==te&&$s(Y);else{if(!te){if(Y.stateNode===null)throw Error(C(166));return pn(Y),null}N=Ut.current,Ka(Y)?Nu(Y):(N=Jd(oe,te,K),Y.stateNode=N,$s(Y))}return pn(Y),null;case 5:if(mt(Y),K=Y.type,N!==null&&Y.stateNode!=null)N.memoizedProps!==te&&$s(Y);else{if(!te){if(Y.stateNode===null)throw Error(C(166));return pn(Y),null}if(N=Ut.current,Ka(Y))Nu(Y);else{switch(oe=wh(nt.current),N){case 1:N=oe.createElementNS("http://www.w3.org/2000/svg",K);break;case 2:N=oe.createElementNS("http://www.w3.org/1998/Math/MathML",K);break;default:switch(K){case"svg":N=oe.createElementNS("http://www.w3.org/2000/svg",K);break;case"math":N=oe.createElementNS("http://www.w3.org/1998/Math/MathML",K);break;case"script":N=oe.createElement("div"),N.innerHTML="<script><\/script>",N=N.removeChild(N.firstChild);break;case"select":N=typeof te.is=="string"?oe.createElement("select",{is:te.is}):oe.createElement("select"),te.multiple?N.multiple=!0:te.size&&(N.size=te.size);break;default:N=typeof te.is=="string"?oe.createElement(K,{is:te.is}):oe.createElement(K)}}N[on]=Y,N[pi]=te;e:for(oe=Y.child;oe!==null;){if(oe.tag===5||oe.tag===6)N.appendChild(oe.stateNode);else if(oe.tag!==4&&oe.tag!==27&&oe.child!==null){oe.child.return=oe,oe=oe.child;continue}if(oe===Y)break e;for(;oe.sibling===null;){if(oe.return===null||oe.return===Y)break e;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}Y.stateNode=N;e:switch(Gs(N,K,te),K){case"button":case"input":case"select":case"textarea":N=!!te.autoFocus;break e;case"img":N=!0;break e;default:N=!1}N&&$s(Y)}}return pn(Y),Y.flags&=-16777217,null;case 6:if(N&&Y.stateNode!=null)N.memoizedProps!==te&&$s(Y);else{if(typeof te!="string"&&Y.stateNode===null)throw Error(C(166));if(N=nt.current,Ka(Y)){if(N=Y.stateNode,K=Y.memoizedProps,te=null,oe=ss,oe!==null)switch(oe.tag){case 27:case 5:te=oe.memoizedProps}N[on]=Y,N=!!(N.nodeValue===K||te!==null&&te.suppressHydrationWarning===!0||Nd(N.nodeValue,K)),N||aa(Y)}else N=wh(N).createTextNode(te),N[on]=Y,Y.stateNode=N}return pn(Y),null;case 13:if(te=Y.memoizedState,N===null||N.memoizedState!==null&&N.memoizedState.dehydrated!==null){if(oe=Ka(Y),te!==null&&te.dehydrated!==null){if(N===null){if(!oe)throw Error(C(318));if(oe=Y.memoizedState,oe=oe!==null?oe.dehydrated:null,!oe)throw Error(C(317));oe[on]=Y}else Pa(),(Y.flags&128)===0&&(Y.memoizedState=null),Y.flags|=4;pn(Y),oe=!1}else Ps!==null&&(to(Ps),Ps=null),oe=!0;if(!oe)return Y.flags&256?(Bo(Y),Y):(Bo(Y),null)}if(Bo(Y),(Y.flags&128)!==0)return Y.lanes=K,Y;if(K=te!==null,N=N!==null&&N.memoizedState!==null,K){te=Y.child,oe=null,te.alternate!==null&&te.alternate.memoizedState!==null&&te.alternate.memoizedState.cachePool!==null&&(oe=te.alternate.memoizedState.cachePool.pool);var ue=null;te.memoizedState!==null&&te.memoizedState.cachePool!==null&&(ue=te.memoizedState.cachePool.pool),ue!==oe&&(te.flags|=2048)}return K!==N&&K&&(Y.child.flags|=8192),js(Y,Y.updateQueue),pn(Y),null;case 4:return It(),N===null&&rd(Y.stateNode.containerInfo),pn(Y),null;case 10:return nr(Y.type),pn(Y),null;case 19:if(Rt(Zn),oe=Y.memoizedState,oe===null)return pn(Y),null;if(te=(Y.flags&128)!==0,ue=oe.rendering,ue===null)if(te)ic(oe,!1);else{if(hn!==0||N!==null&&(N.flags&128)!==0)for(N=Y.child;N!==null;){if(ue=Da(N),ue!==null){for(Y.flags|=128,ic(oe,!1),N=ue.updateQueue,Y.updateQueue=N,js(Y,N),Y.subtreeFlags=0,N=K,K=Y.child;K!==null;)kr(K,N),K=K.sibling;return dt(Zn,Zn.current&1|2),Y.child}N=N.sibling}oe.tail!==null&&ht()>Mi&&(Y.flags|=128,te=!0,ic(oe,!1),Y.lanes=4194304)}else{if(!te)if(N=Da(ue),N!==null){if(Y.flags|=128,te=!0,N=N.updateQueue,Y.updateQueue=N,js(Y,N),ic(oe,!0),oe.tail===null&&oe.tailMode==="hidden"&&!ue.alternate&&!Ji)return pn(Y),null}else 2*ht()-oe.renderingStartTime>Mi&&K!==536870912&&(Y.flags|=128,te=!0,ic(oe,!1),Y.lanes=4194304);oe.isBackwards?(ue.sibling=Y.child,Y.child=ue):(N=oe.last,N!==null?N.sibling=ue:Y.child=ue,oe.last=ue)}return oe.tail!==null?(Y=oe.tail,oe.rendering=Y,oe.tail=Y.sibling,oe.renderingStartTime=ht(),Y.sibling=null,N=Zn.current,dt(Zn,te?N&1|2:N&1),Y):(pn(Y),null);case 22:case 23:return Bo(Y),Kl(),te=Y.memoizedState!==null,N!==null?N.memoizedState!==null!==te&&(Y.flags|=8192):te&&(Y.flags|=8192),te?(K&536870912)!==0&&(Y.flags&128)===0&&(pn(Y),Y.subtreeFlags&6&&(Y.flags|=8192)):pn(Y),K=Y.updateQueue,K!==null&&js(Y,K.retryQueue),K=null,N!==null&&N.memoizedState!==null&&N.memoizedState.cachePool!==null&&(K=N.memoizedState.cachePool.pool),te=null,Y.memoizedState!==null&&Y.memoizedState.cachePool!==null&&(te=Y.memoizedState.cachePool.pool),te!==K&&(Y.flags|=2048),N!==null&&Rt(Qo),null;case 24:return K=null,N!==null&&(K=N.memoizedState.cache),Y.memoizedState.cache!==K&&(Y.flags|=2048),nr(yn),pn(Y),null;case 25:return null}throw Error(C(156,Y.tag))}function bn(N,Y){switch(Sr(Y),Y.tag){case 1:return N=Y.flags,N&65536?(Y.flags=N&-65537|128,Y):null;case 3:return nr(yn),It(),N=Y.flags,(N&65536)!==0&&(N&128)===0?(Y.flags=N&-65537|128,Y):null;case 26:case 27:case 5:return mt(Y),null;case 13:if(Bo(Y),N=Y.memoizedState,N!==null&&N.dehydrated!==null){if(Y.alternate===null)throw Error(C(340));Pa()}return N=Y.flags,N&65536?(Y.flags=N&-65537|128,Y):null;case 19:return Rt(Zn),null;case 4:return It(),null;case 10:return nr(Y.type),null;case 22:case 23:return Bo(Y),Kl(),N!==null&&Rt(Qo),N=Y.flags,N&65536?(Y.flags=N&-65537|128,Y):null;case 24:return nr(yn),null;case 25:return null;default:return null}}function tu(N,Y){switch(Sr(Y),Y.tag){case 3:nr(yn),It();break;case 26:case 27:case 5:mt(Y);break;case 4:It();break;case 13:Bo(Y);break;case 19:Rt(Zn);break;case 10:nr(Y.type);break;case 22:case 23:Bo(Y),Kl(),N!==null&&Rt(Qo);break;case 24:nr(yn)}}var Ba={getCacheForType:function(N){var Y=os(yn),K=Y.data.get(N);return K===void 0&&(K=N(),Y.data.set(N,K)),K}},gr=typeof WeakMap=="function"?WeakMap:Map,bi=0,Qi=null,Xi=null,ui=0,tn=0,Li=null,Rn=!1,gs=!1,Ur=!1,ur=0,hn=0,po=0,Mo=0,ll=0,bs=0,No=0,nc=null,Zi=null,qi=!1,xi=0,Mi=1/0,$i=null,En=null,Qs=!1,qs=null,Sa=0,Ao=0,fn=null,eo=0,hr=null;function ys(){if((bi&2)!==0&&ui!==0)return ui&-ui;if(ge.T!==null){var N=ha;return N!==0?N:id()}return qn()}function zs(){bs===0&&(bs=(ui&536870912)===0||Ji?Ki():536870912);var N=_s.current;return N!==null&&(N.flags|=32),bs}function Wn(N,Y,K){(N===Qi&&tn===2||N.cancelPendingCommit!==null)&&(dr(N,0),Fs(N,ui,bs,!1)),Di(N,K),((bi&2)===0||N!==Qi)&&(N===Qi&&((bi&2)===0&&(Mo|=K),hn===4&&Fs(N,ui,bs,!1)),nn(N))}function cl(N,Y,K){if((bi&6)!==0)throw Error(C(327));var te=!K&&(Y&60)===0&&(Y&N.expiredLanes)===0||si(N,Y),oe=te?J(N,Y):Xa(N,Y,!0),ue=te;do{if(oe===0){gs&&!te&&Fs(N,Y,0,!1);break}else if(oe===6)Fs(N,Y,0,!Rn);else{if(K=N.current.alternate,ue&&!iu(K)){oe=Xa(N,Y,!1),ue=!1;continue}if(oe===2){if(ue=Y,N.errorRecoveryDisabledLanes&ue)var pe=0;else pe=N.pendingLanes&-536870913,pe=pe!==0?pe:pe&536870912?536870912:0;if(pe!==0){Y=pe;e:{var xe=N;oe=nc;var Te=xe.current.memoizedState.isDehydrated;if(Te&&(dr(xe,pe).flags|=256),pe=Xa(xe,pe,!1),pe!==2){if(Ur&&!Te){xe.errorRecoveryDisabledLanes|=ue,Mo|=ue,oe=4;break e}ue=Zi,Zi=oe,ue!==null&&to(ue)}oe=pe}if(ue=!1,oe!==2)continue}}if(oe===1){dr(N,0),Fs(N,Y,0,!0);break}e:{switch(te=N,oe){case 0:case 1:throw Error(C(345));case 4:if((Y&4194176)===Y){Fs(te,Y,bs,!Rn);break e}break;case 2:Zi=null;break;case 3:case 5:break;default:throw Error(C(329))}if(te.finishedWork=K,te.finishedLanes=Y,(Y&62914560)===Y&&(ue=xi+300-ht(),10<ue)){if(Fs(te,Y,bs,!Rn),$t(te,0)!==0)break e;te.timeoutHandle=Wd($c.bind(null,te,K,Zi,$i,qi,Y,bs,Mo,No,Rn,2,-0,0),ue);break e}$c(te,K,Zi,$i,qi,Y,bs,Mo,No,Rn,0,-0,0)}}break}while(!0);nn(N)}function to(N){Zi===null?Zi=N:Zi.push.apply(Zi,N)}function $c(N,Y,K,te,oe,ue,pe,xe,Te,Oe,Bt,Vt,gt){var yt=Y.subtreeFlags;if((yt&8192||(yt&16785408)===16785408)&&(lu={stylesheets:null,count:0,unsuspend:wC},va(Y),Y=MC(),Y!==null)){N.cancelPendingCommit=Y(He.bind(null,N,K,te,oe,pe,xe,Te,1,Vt,gt)),Fs(N,ue,pe,!Oe);return}He(N,K,te,oe,pe,xe,Te,Bt,Vt,gt)}function iu(N){for(var Y=N;;){var K=Y.tag;if((K===0||K===11||K===15)&&Y.flags&16384&&(K=Y.updateQueue,K!==null&&(K=K.stores,K!==null)))for(var te=0;te<K.length;te++){var oe=K[te],ue=oe.getSnapshot;oe=oe.value;try{if(!Ss(ue(),oe))return!1}catch{return!1}}if(K=Y.child,Y.subtreeFlags&16384&&K!==null)K.return=Y,Y=K;else{if(Y===N)break;for(;Y.sibling===null;){if(Y.return===null||Y.return===N)return!0;Y=Y.return}Y.sibling.return=Y.return,Y=Y.sibling}}return!0}function Fs(N,Y,K,te){Y&=~ll,Y&=~Mo,N.suspendedLanes|=Y,N.pingedLanes&=~Y,te&&(N.warmLanes|=Y),te=N.expirationTimes;for(var oe=Y;0<oe;){var ue=31-Pe(oe),pe=1<<ue;te[ue]=-1,oe&=~pe}K!==0&&no(N,K,Y)}function xa(){return(bi&6)===0?(Wi(0),!1):!0}function Vo(){if(Xi!==null){if(tn===0)var N=Xi.return;else N=Xi,go=Ro=null,wc(N),Rr=null,zl=0,N=Xi;for(;N!==null;)tu(N.alternate,N),N=N.return;Xi=null}}function dr(N,Y){N.finishedWork=null,N.finishedLanes=0;var K=N.timeoutHandle;K!==-1&&(N.timeoutHandle=-1,CC(K)),K=N.cancelPendingCommit,K!==null&&(N.cancelPendingCommit=null,K()),Vo(),Qi=N,Xi=K=As(N.current,null),ui=Y,tn=0,Li=null,Rn=!1,gs=si(N,Y),Ur=!1,No=bs=ll=Mo=po=hn=0,Zi=nc=null,qi=!1,(Y&8)!==0&&(Y|=Y&32);var te=N.entangledLanes;if(te!==0)for(N=N.entanglements,te&=Y;0<te;){var oe=31-Pe(te),ue=1<<oe;Y|=N[oe],te&=~ue}return ur=Y,Nl(),K}function $r(N,Y){Si=null,ge.H=Xo,Y===xr?(Y=Pi(),tn=3):Y===Sg?(Y=Pi(),tn=4):tn=Y===Ys?8:Y!==null&&typeof Y=="object"&&typeof Y.then=="function"?6:1,Li=Y,Xi===null&&(hn=1,Jc(N,Rs(Y,N.current)))}function gl(){var N=ge.H;return ge.H=Xo,N===null?Xo:N}function Qc(){var N=ge.A;return ge.A=Ba,N}function sc(){hn=4,Rn||(ui&4194176)!==ui&&_s.current!==null||(gs=!0),(po&134217727)===0&&(Mo&134217727)===0||Qi===null||Fs(Qi,ui,bs,!1)}function Xa(N,Y,K){var te=bi;bi|=2;var oe=gl(),ue=Qc();(Qi!==N||ui!==Y)&&($i=null,dr(N,Y)),Y=!1;var pe=hn;e:do try{if(tn!==0&&Xi!==null){var xe=Xi,Te=Li;switch(tn){case 8:Vo(),pe=6;break e;case 3:case 2:case 6:_s.current===null&&(Y=!0);var Oe=tn;if(tn=0,Li=null,de(N,xe,Te,Oe),K&&gs){pe=0;break e}break;default:Oe=tn,tn=0,Li=null,de(N,xe,Te,Oe)}}nu(),pe=hn;break}catch(Bt){$r(N,Bt)}while(!0);return Y&&N.shellSuspendCounter++,go=Ro=null,bi=te,ge.H=oe,ge.A=ue,Xi===null&&(Qi=null,ui=0,Nl()),pe}function nu(){for(;Xi!==null;)se(Xi)}function J(N,Y){var K=bi;bi|=2;var te=gl(),oe=Qc();Qi!==N||ui!==Y?($i=null,Mi=ht()+500,dr(N,Y)):gs=si(N,Y);e:do try{if(tn!==0&&Xi!==null){Y=Xi;var ue=Li;t:switch(tn){case 1:tn=0,Li=null,de(N,Y,ue,1);break;case 2:if(Eu(ue)){tn=0,Li=null,re(Y);break}Y=function(){tn===2&&Qi===N&&(tn=7),nn(N)},ue.then(Y,Y);break e;case 3:tn=7;break e;case 4:tn=5;break e;case 7:Eu(ue)?(tn=0,Li=null,re(Y)):(tn=0,Li=null,de(N,Y,ue,7));break;case 5:var pe=null;switch(Xi.tag){case 26:pe=Xi.memoizedState;case 5:case 27:var xe=Xi;if(!pe||Dd(pe)){tn=0,Li=null;var Te=xe.sibling;if(Te!==null)Xi=Te;else{var Oe=xe.return;Oe!==null?(Xi=Oe,Ce(Oe)):Xi=null}break t}}tn=0,Li=null,de(N,Y,ue,5);break;case 6:tn=0,Li=null,de(N,Y,ue,6);break;case 8:Vo(),hn=6;break e;default:throw Error(C(462))}}z();break}catch(Bt){$r(N,Bt)}while(!0);return go=Ro=null,ge.H=te,ge.A=oe,bi=K,Xi!==null?0:(Qi=null,ui=0,Nl(),hn)}function z(){for(;Xi!==null&&!ve();)se(Xi)}function se(N){var Y=Ul(N.alternate,N,ur);N.memoizedProps=N.pendingProps,Y===null?Ce(N):Xi=Y}function re(N){var Y=N,K=Y.alternate;switch(Y.tag){case 15:case 0:Y=yh(K,Y,Y.pendingProps,Y.type,void 0,ui);break;case 11:Y=yh(K,Y,Y.pendingProps,Y.type.render,Y.ref,ui);break;case 5:wc(Y);default:tu(K,Y),Y=Xi=kr(Y,ur),Y=Ul(K,Y,ur)}N.memoizedProps=N.pendingProps,Y===null?Ce(N):Xi=Y}function de(N,Y,K,te){go=Ro=null,wc(Y),Rr=null,zl=0;var oe=Y.return;try{if(qh(N,oe,Y,K,ui)){hn=1,Jc(N,Rs(K,N.current)),Xi=null;return}}catch(ue){if(oe!==null)throw Xi=oe,ue;hn=1,Jc(N,Rs(K,N.current)),Xi=null;return}Y.flags&32768?(Ji||te===1?N=!0:gs||(ui&536870912)!==0?N=!1:(Rn=N=!0,(te===2||te===3||te===6)&&(te=_s.current,te!==null&&te.tag===13&&(te.flags|=16384))),Xe(Y,N)):Ce(Y)}function Ce(N){var Y=N;do{if((Y.flags&32768)!==0){Xe(Y,Rn);return}N=Y.return;var K=td(Y.alternate,Y,ur);if(K!==null){Xi=K;return}if(Y=Y.sibling,Y!==null){Xi=Y;return}Xi=Y=N}while(Y!==null);hn===0&&(hn=5)}function Xe(N,Y){do{var K=bn(N.alternate,N);if(K!==null){K.flags&=32767,Xi=K;return}if(K=N.return,K!==null&&(K.flags|=32768,K.subtreeFlags=0,K.deletions=null),!Y&&(N=N.sibling,N!==null)){Xi=N;return}Xi=N=K}while(N!==null);hn=6,Xi=null}function He(N,Y,K,te,oe,ue,pe,xe,Te,Oe){var Bt=ge.T,Vt=Re.p;try{Re.p=2,ge.T=null,qe(N,Y,K,te,Vt,oe,ue,pe,xe,Te,Oe)}finally{ge.T=Bt,Re.p=Vt}}function qe(N,Y,K,te,oe,ue,pe,xe){do Ot();while(qs!==null);if((bi&6)!==0)throw Error(C(327));var Te=N.finishedWork;if(te=N.finishedLanes,Te===null)return null;if(N.finishedWork=null,N.finishedLanes=0,Te===N.current)throw Error(C(177));N.callbackNode=null,N.callbackPriority=0,N.cancelPendingCommit=null;var Oe=Te.lanes|Te.childLanes;if(Oe|=Ko,Fn(N,te,Oe,ue,pe,xe),N===Qi&&(Xi=Qi=null,ui=0),(Te.subtreeFlags&10256)===0&&(Te.flags&10256)===0||Qs||(Qs=!0,Ao=Oe,fn=K,je(Dt,function(){return Ot(),null})),K=(Te.flags&15990)!==0,(Te.subtreeFlags&15990)!==0||K?(K=ge.T,ge.T=null,ue=Re.p,Re.p=2,pe=bi,bi|=4,sl(N,Te),Ga(Te,N),Ag(gd,N.containerInfo),Wh=!!cd,gd=cd=null,N.current=Te,ol(N,Te.alternate,Te),et(),bi=pe,Re.p=ue,ge.T=K):N.current=Te,Qs?(Qs=!1,qs=N,Sa=te):vt(N,Oe),Oe=N.pendingLanes,Oe===0&&(En=null),_t(Te.stateNode),nn(N),Y!==null)for(oe=N.onRecoverableError,Te=0;Te<Y.length;Te++)Oe=Y[Te],oe(Oe.value,{componentStack:Oe.stack});return(Sa&3)!==0&&Ot(),Oe=N.pendingLanes,(te&4194218)!==0&&(Oe&42)!==0?N===hr?eo++:(eo=0,hr=N):eo=0,Wi(0),null}function vt(N,Y){(N.pooledCacheLanes&=Y)===0&&(Y=N.pooledCache,Y!=null&&(N.pooledCache=null,wr(Y)))}function Ot(){if(qs!==null){var N=qs,Y=Ao;Ao=0;var K=Ln(Sa),te=ge.T,oe=Re.p;try{if(Re.p=32>K?32:K,ge.T=null,qs===null)var ue=!1;else{K=fn,fn=null;var pe=qs,xe=Sa;if(qs=null,Sa=0,(bi&6)!==0)throw Error(C(331));var Te=bi;if(bi|=4,rl(pe.current),rr(pe,pe.current,xe,K),bi=Te,Wi(0,!1),Nt&&typeof Nt.onPostCommitFiberRoot=="function")try{Nt.onPostCommitFiberRoot(Zt,pe)}catch{}ue=!0}return ue}finally{Re.p=oe,ge.T=te,vt(N,Y)}}return!1}function ti(N,Y,K){Y=Rs(K,Y),Y=zg(N.stateNode,Y,2),N=Hs(N,Y,2),N!==null&&(Di(N,2),nn(N))}function Pt(N,Y,K){if(N.tag===3)ti(N,N,K);else for(;Y!==null;){if(Y.tag===3){ti(Y,N,K);break}else if(Y.tag===1){var te=Y.stateNode;if(typeof Y.type.getDerivedStateFromError=="function"||typeof te.componentDidCatch=="function"&&(En===null||!En.has(te))){N=Rs(K,N),K=Fg(2),te=Hs(Y,K,2),te!==null&&(Ah(K,te,Y,N),Di(te,2),nn(te));break}}Y=Y.return}}function yi(N,Y,K){var te=N.pingCache;if(te===null){te=N.pingCache=new gr;var oe=new Set;te.set(Y,oe)}else oe=te.get(Y),oe===void 0&&(oe=new Set,te.set(Y,oe));oe.has(K)||(Ur=!0,oe.add(K),N=io.bind(null,N,Y,K),Y.then(N,N))}function io(N,Y,K){var te=N.pingCache;te!==null&&te.delete(Y),N.pingedLanes|=N.suspendedLanes&K,N.warmLanes&=~K,Qi===N&&(ui&K)===K&&(hn===4||hn===3&&(ui&62914560)===ui&&300>ht()-xi?(bi&2)===0&&dr(N,0):ll|=K,No===ui&&(No=0)),nn(N)}function ul(N,Y){Y===0&&(Y=Gi()),N=Po(N,Y),N!==null&&(Di(N,Y),nn(N))}function Ra(N){var Y=N.memoizedState,K=0;Y!==null&&(K=Y.retryLane),ul(N,K)}function at(N,Y){var K=0;switch(N.tag){case 13:var te=N.stateNode,oe=N.memoizedState;oe!==null&&(K=oe.retryLane);break;case 19:te=N.stateNode;break;case 22:te=N.stateNode._retryCache;break;default:throw Error(C(314))}te!==null&&te.delete(Y),ul(N,K)}function je(N,Y){return kt(N,Y)}var ut=null,zt=null,ri=!1,en=!1,hi=!1,Ri=0;function nn(N){N!==zt&&N.next===null&&(zt===null?ut=zt=N:zt=zt.next=N),en=!0,ri||(ri=!0,oC(jr))}function Wi(N,Y){if(!hi&&en){hi=!0;do for(var K=!1,te=ut;te!==null;){if(N!==0){var oe=te.pendingLanes;if(oe===0)var ue=0;else{var pe=te.suspendedLanes,xe=te.pingedLanes;ue=(1<<31-Pe(42|N)+1)-1,ue&=oe&~(pe&~xe),ue=ue&201326677?ue&201326677|1:ue?ue|2:0}ue!==0&&(K=!0,xd(te,ue))}else ue=ui,ue=$t(te,te===Qi?ue:0),(ue&3)===0||si(te,ue)||(K=!0,xd(te,ue));te=te.next}while(K);hi=!1}}function jr(){en=ri=!1;var N=0;Ri!==0&&(dC()&&(N=Ri),Ri=0);for(var Y=ht(),K=null,te=ut;te!==null;){var oe=te.next,ue=xh(te,Y);ue===0?(te.next=null,K===null?ut=oe:K.next=oe,oe===null&&(zt=K)):(K=te,(N!==0||(ue&3)!==0)&&(en=!0)),te=oe}Wi(N)}function xh(N,Y){for(var K=N.suspendedLanes,te=N.pingedLanes,oe=N.expirationTimes,ue=N.pendingLanes&-62914561;0<ue;){var pe=31-Pe(ue),xe=1<<pe,Te=oe[pe];Te===-1?((xe&K)===0||(xe&te)!==0)&&(oe[pe]=Bi(xe,Y)):Te<=Y&&(N.expiredLanes|=xe),ue&=~xe}if(Y=Qi,K=ui,K=$t(N,N===Y?K:0),te=N.callbackNode,K===0||N===Y&&tn===2||N.cancelPendingCommit!==null)return te!==null&&te!==null&&Me(te),N.callbackNode=null,N.callbackPriority=0;if((K&3)===0||si(N,K)){if(Y=K&-K,Y===N.callbackPriority)return Y;switch(te!==null&&Me(te),Ln(K)){case 2:case 8:K=ft;break;case 32:K=Dt;break;case 268435456:K=ii;break;default:K=Dt}return te=Sd.bind(null,N),K=kt(K,te),N.callbackPriority=Y,N.callbackNode=K,Y}return te!==null&&te!==null&&Me(te),N.callbackPriority=2,N.callbackNode=null,2}function Sd(N,Y){var K=N.callbackNode;if(Ot()&&N.callbackNode!==K)return null;var te=ui;return te=$t(N,N===Qi?te:0),te===0?null:(cl(N,te,Y),xh(N,ht()),N.callbackNode!=null&&N.callbackNode===K?Sd.bind(null,N):null)}function xd(N,Y){if(Ot())return null;cl(N,Y,!0)}function oC(N){IC(function(){(bi&6)!==0?kt(Ue,N):N()})}function id(){return Ri===0&&(Ri=Ki()),Ri}function Xd(N){return N==null||typeof N=="symbol"||typeof N=="boolean"?null:typeof N=="function"?N:Al(""+N)}function Rd(N,Y){var K=Y.ownerDocument.createElement("input");return K.name=Y.name,K.value=Y.value,N.id&&K.setAttribute("form",N.id),Y.parentNode.insertBefore(K,Y),N=new FormData(N),K.parentNode.removeChild(K),N}function rC(N,Y,K,te,oe){if(Y==="submit"&&K&&K.stateNode===oe){var ue=Xd((oe[pi]||null).action),pe=te.submitter;pe&&(Y=(Y=pe[pi]||null)?Xd(Y.formAction):pe.getAttribute("formAction"),Y!==null&&(ue=Y,pe=null));var xe=new Va("action","action",null,te,oe);N.push({event:xe,listeners:[{instance:null,listener:function(){if(te.defaultPrevented){if(Ri!==0){var Te=pe?Rd(oe,pe):new FormData(oe);Wg(K,{pending:!0,data:Te,method:oe.method,action:ue},null,Te)}}else typeof ue=="function"&&(xe.preventDefault(),Te=pe?Rd(oe,pe):new FormData(oe),Wg(K,{pending:!0,data:Te,method:oe.method,action:ue},ue,Te))},currentTarget:oe}]})}}for(var nd=0;nd<Lo.length;nd++){var sd=Lo[nd],aC=sd.toLowerCase(),lC=sd[0].toUpperCase()+sd.slice(1);Ks(aC,"on"+lC)}Ks(Gg,"onAnimationEnd"),Ks(Xs,"onAnimationIteration"),Ks(vg,"onAnimationStart"),Ks("dblclick","onDoubleClick"),Ks("focusin","onFocus"),Ks("focusout","onBlur"),Ks(Fo,"onTransitionRun"),Ks(La,"onTransitionStart"),Ks(Gr,"onTransitionCancel"),Ks(vc,"onTransitionEnd"),ei("onMouseEnter",["mouseout","mouseover"]),ei("onMouseLeave",["mouseout","mouseover"]),ei("onPointerEnter",["pointerout","pointerover"]),ei("onPointerLeave",["pointerout","pointerover"]),Qt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(su));function _d(N,Y){Y=(Y&4)!==0;for(var K=0;K<N.length;K++){var te=N[K],oe=te.event;te=te.listeners;e:{var ue=void 0;if(Y)for(var pe=te.length-1;0<=pe;pe--){var xe=te[pe],Te=xe.instance,Oe=xe.currentTarget;if(xe=xe.listener,Te!==ue&&oe.isPropagationStopped())break e;ue=xe,oe.currentTarget=Oe;try{ue(oe)}catch(Bt){Tc(Bt)}oe.currentTarget=null,ue=Te}else for(pe=0;pe<te.length;pe++){if(xe=te[pe],Te=xe.instance,Oe=xe.currentTarget,xe=xe.listener,Te!==ue&&oe.isPropagationStopped())break e;ue=xe,oe.currentTarget=Oe;try{ue(oe)}catch(Bt){Tc(Bt)}oe.currentTarget=null,ue=Te}}}}function zi(N,Y){var K=Y[Ir];K===void 0&&(K=Y[Ir]=new Set);var te=N+"__bubble";K.has(te)||(wd(Y,N,2,!1),K.add(te))}function od(N,Y,K){var te=0;Y&&(te|=4),wd(K,N,te,Y)}var Xh="_reactListening"+Math.random().toString(36).slice(2);function rd(N){if(!N[Xh]){N[Xh]=!0,$e.forEach(function(K){K!=="selectionchange"&&(cC.has(K)||od(K,!1,N),od(K,!0,N))});var Y=N.nodeType===9?N:N.ownerDocument;Y===null||Y[Xh]||(Y[Xh]=!0,od("selectionchange",!1,Y))}}function wd(N,Y,K,te){switch(qd(Y)){case 2:var oe=EC;break;case 8:oe=WC;break;default:oe=Ad}K=oe.bind(null,Y,K,N),oe=void 0,!yl||Y!=="touchstart"&&Y!=="touchmove"&&Y!=="wheel"||(oe=!0),te?oe!==void 0?N.addEventListener(Y,K,{capture:!0,passive:oe}):N.addEventListener(Y,K,!0):oe!==void 0?N.addEventListener(Y,K,{passive:oe}):N.addEventListener(Y,K,!1)}function ad(N,Y,K,te,oe){var ue=te;if((Y&1)===0&&(Y&2)===0&&te!==null)e:for(;;){if(te===null)return;var pe=te.tag;if(pe===3||pe===4){var xe=te.stateNode.containerInfo;if(xe===oe||xe.nodeType===8&&xe.parentNode===oe)break;if(pe===4)for(pe=te.return;pe!==null;){var Te=pe.tag;if((Te===3||Te===4)&&(Te=pe.stateNode.containerInfo,Te===oe||Te.nodeType===8&&Te.parentNode===oe))return;pe=pe.return}for(;xe!==null;){if(pe=oo(xe),pe===null)return;if(Te=pe.tag,Te===5||Te===6||Te===26||Te===27){te=ue=pe;continue e}xe=xe.parentNode}}te=te.return}sg(function(){var Oe=ue,Bt=bl(K),Vt=[];e:{var gt=Bc.get(N);if(gt!==void 0){var yt=Va,ai=N;switch(N){case"keypress":if(fr(K)===0)break e;case"keydown":case"keyup":yt=cg;break;case"focusin":ai="focus",yt=dc;break;case"focusout":ai="blur",yt=dc;break;case"beforeblur":case"afterblur":yt=dc;break;case"click":if(K.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=Lh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=ug;break;case Gg:case Xs:case vg:yt=Au;break;case vc:yt=Jo;break;case"scroll":case"scrollend":yt=fu;break;case"wheel":yt=Kh;break;case"copy":case"cut":case"paste":yt=yu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=Ic;break;case"toggle":case"beforetoggle":yt=mr}var vi=(Y&4)!==0,Yn=!vi&&(N==="scroll"||N==="scrollend"),Qe=vi?gt!==null?gt+"Capture":null:gt;vi=[];for(var ke=Oe,st;ke!==null;){var wt=ke;if(st=wt.stateNode,wt=wt.tag,wt!==5&&wt!==26&&wt!==27||st===null||Qe===null||(wt=Za(ke,Qe),wt!=null&&vi.push(ou(ke,wt,st))),Yn)break;ke=ke.return}0<vi.length&&(gt=new yt(gt,ai,null,K,Bt),Vt.push({event:gt,listeners:vi}))}}if((Y&7)===0){e:{if(gt=N==="mouseover"||N==="pointerover",yt=N==="mouseout"||N==="pointerout",gt&&K!==cc&&(ai=K.relatedTarget||K.fromElement)&&(oo(ai)||ai[so]))break e;if((yt||gt)&&(gt=Bt.window===Bt?Bt:(gt=Bt.ownerDocument)?gt.defaultView||gt.parentWindow:window,yt?(ai=K.relatedTarget||K.toElement,yt=Oe,ai=ai?oo(ai):null,ai!==null&&(Yn=Ve(ai),vi=ai.tag,ai!==Yn||vi!==5&&vi!==27&&vi!==6)&&(ai=null)):(yt=null,ai=Oe),yt!==ai)){if(vi=ag,wt="onMouseLeave",Qe="onMouseEnter",ke="mouse",(N==="pointerout"||N==="pointerover")&&(vi=Ic,wt="onPointerLeave",Qe="onPointerEnter",ke="pointer"),Yn=yt==null?gt:Le(yt),st=ai==null?gt:Le(ai),gt=new vi(wt,ke+"leave",yt,K,Bt),gt.target=Yn,gt.relatedTarget=st,wt=null,oo(Bt)===Oe&&(vi=new vi(Qe,ke+"enter",ai,K,Bt),vi.target=st,vi.relatedTarget=Yn,wt=vi),Yn=wt,yt&&ai)t:{for(vi=yt,Qe=ai,ke=0,st=vi;st;st=qc(st))ke++;for(st=0,wt=Qe;wt;wt=qc(wt))st++;for(;0<ke-st;)vi=qc(vi),ke--;for(;0<st-ke;)Qe=qc(Qe),st--;for(;ke--;){if(vi===Qe||Qe!==null&&vi===Qe.alternate)break t;vi=qc(vi),Qe=qc(Qe)}vi=null}else vi=null;yt!==null&&Zd(Vt,gt,yt,vi,!1),ai!==null&&Yn!==null&&Zd(Vt,Yn,ai,vi,!0)}}e:{if(gt=Oe?Le(Oe):window,yt=gt.nodeName&&gt.nodeName.toLowerCase(),yt==="select"||yt==="input"&&gt.type==="file")var oi=pc;else if(Ig(gt))if(mc)oi=yr;else{oi=Zu;var Yi=Ph}else yt=gt.nodeName,!yt||yt.toLowerCase()!=="input"||gt.type!=="checkbox"&&gt.type!=="radio"?Oe&&ml(Oe.elementType)&&(oi=pc):oi=Zl;if(oi&&(oi=oi(N,Oe))){Bs(Vt,oi,K,Bt);break e}Yi&&Yi(N,gt,Oe),N==="focusout"&&Oe&&gt.type==="number"&&Oe.memoizedProps.value!=null&&On(gt,"number",gt.value)}switch(Yi=Oe?Le(Oe):window,N){case"focusin":(Ig(Yi)||Yi.contentEditable==="true")&&(na=Yi,bg=Oe,Fa=null);break;case"focusout":Fa=bg=na=null;break;case"mousedown":yc=!0;break;case"contextmenu":case"mouseup":case"dragend":yc=!1,Ls(Vt,K,Bt);break;case"selectionchange":if(bc)break;case"keydown":case"keyup":Ls(Vt,K,Bt)}var gi;if(Sl)e:{switch(N){case"compositionstart":var fi="onCompositionStart";break e;case"compositionend":fi="onCompositionEnd";break e;case"compositionupdate":fi="onCompositionUpdate";break e}fi=void 0}else br?Rl(N,K)&&(fi="onCompositionEnd"):N==="keydown"&&K.keyCode===229&&(fi="onCompositionStart");fi&&(Xl&&K.locale!=="ko"&&(br||fi!=="onCompositionStart"?fi==="onCompositionEnd"&&br&&(gi=rg()):(Yo=Bt,og="value"in Yo?Yo.value:Yo.textContent,br=!0)),Yi=Rh(Oe,fi),0<Yi.length&&(fi=new Cc(fi,N,null,K,Bt),Vt.push({event:fi,listeners:Yi}),gi?fi.data=gi:(gi=dg(K),gi!==null&&(fi.data=gi)))),(gi=xl?_l(N,K):Cg(N,K))&&(fi=Rh(Oe,"onBeforeInput"),0<fi.length&&(Yi=new Cc("onBeforeInput","beforeinput",null,K,Bt),Vt.push({event:Yi,listeners:fi}),Yi.data=gi)),rC(Vt,N,Oe,K,Bt)}_d(Vt,Y)})}function ou(N,Y,K){return{instance:N,listener:Y,currentTarget:K}}function Rh(N,Y){for(var K=Y+"Capture",te=[];N!==null;){var oe=N,ue=oe.stateNode;oe=oe.tag,oe!==5&&oe!==26&&oe!==27||ue===null||(oe=Za(N,K),oe!=null&&te.unshift(ou(N,oe,ue)),oe=Za(N,Y),oe!=null&&te.push(ou(N,oe,ue))),N=N.return}return te}function qc(N){if(N===null)return null;do N=N.return;while(N&&N.tag!==5&&N.tag!==27);return N||null}function Zd(N,Y,K,te,oe){for(var ue=Y._reactName,pe=[];K!==null&&K!==te;){var xe=K,Te=xe.alternate,Oe=xe.stateNode;if(xe=xe.tag,Te!==null&&Te===te)break;xe!==5&&xe!==26&&xe!==27||Oe===null||(Te=Oe,oe?(Oe=Za(K,ue),Oe!=null&&pe.unshift(ou(K,Oe,Te))):oe||(Oe=Za(K,ue),Oe!=null&&pe.push(ou(K,Oe,Te)))),K=K.return}pe.length!==0&&N.push({event:Y,listeners:pe})}var gC=/\r\n?/g,uC=/\u0000|\uFFFD/g;function Md(N){return(typeof N=="string"?N:""+N).replace(gC,`
`).replace(uC,"")}function Nd(N,Y){return Y=Md(Y),Md(N)===Y}function _h(){}function cn(N,Y,K,te,oe,ue){switch(K){case"children":typeof te=="string"?Y==="body"||Y==="textarea"&&te===""||ds(N,te):(typeof te=="number"||typeof te=="bigint")&&Y!=="body"&&ds(N,""+te);break;case"className":rn(N,"class",te);break;case"tabIndex":rn(N,"tabindex",te);break;case"dir":case"role":case"viewBox":case"width":case"height":rn(N,K,te);break;case"style":ng(N,te,ue);break;case"data":if(Y!=="object"){rn(N,"data",te);break}case"src":case"href":if(te===""&&(Y!=="a"||K!=="href")){N.removeAttribute(K);break}if(te==null||typeof te=="function"||typeof te=="symbol"||typeof te=="boolean"){N.removeAttribute(K);break}te=Al(""+te),N.setAttribute(K,te);break;case"action":case"formAction":if(typeof te=="function"){N.setAttribute(K,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof ue=="function"&&(K==="formAction"?(Y!=="input"&&cn(N,Y,"name",oe.name,oe,null),cn(N,Y,"formEncType",oe.formEncType,oe,null),cn(N,Y,"formMethod",oe.formMethod,oe,null),cn(N,Y,"formTarget",oe.formTarget,oe,null)):(cn(N,Y,"encType",oe.encType,oe,null),cn(N,Y,"method",oe.method,oe,null),cn(N,Y,"target",oe.target,oe,null)));if(te==null||typeof te=="symbol"||typeof te=="boolean"){N.removeAttribute(K);break}te=Al(""+te),N.setAttribute(K,te);break;case"onClick":te!=null&&(N.onclick=_h);break;case"onScroll":te!=null&&zi("scroll",N);break;case"onScrollEnd":te!=null&&zi("scrollend",N);break;case"dangerouslySetInnerHTML":if(te!=null){if(typeof te!="object"||!("__html"in te))throw Error(C(61));if(K=te.__html,K!=null){if(oe.children!=null)throw Error(C(60));N.innerHTML=K}}break;case"multiple":N.multiple=te&&typeof te!="function"&&typeof te!="symbol";break;case"muted":N.muted=te&&typeof te!="function"&&typeof te!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(te==null||typeof te=="function"||typeof te=="boolean"||typeof te=="symbol"){N.removeAttribute("xlink:href");break}K=Al(""+te),N.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",K);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":te!=null&&typeof te!="function"&&typeof te!="symbol"?N.setAttribute(K,""+te):N.removeAttribute(K);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":te&&typeof te!="function"&&typeof te!="symbol"?N.setAttribute(K,""):N.removeAttribute(K);break;case"capture":case"download":te===!0?N.setAttribute(K,""):te!==!1&&te!=null&&typeof te!="function"&&typeof te!="symbol"?N.setAttribute(K,te):N.removeAttribute(K);break;case"cols":case"rows":case"size":case"span":te!=null&&typeof te!="function"&&typeof te!="symbol"&&!isNaN(te)&&1<=te?N.setAttribute(K,te):N.removeAttribute(K);break;case"rowSpan":case"start":te==null||typeof te=="function"||typeof te=="symbol"||isNaN(te)?N.removeAttribute(K):N.setAttribute(K,te);break;case"popover":zi("beforetoggle",N),zi("toggle",N),Vi(N,"popover",te);break;case"xlinkActuate":Ti(N,"http://www.w3.org/1999/xlink","xlink:actuate",te);break;case"xlinkArcrole":Ti(N,"http://www.w3.org/1999/xlink","xlink:arcrole",te);break;case"xlinkRole":Ti(N,"http://www.w3.org/1999/xlink","xlink:role",te);break;case"xlinkShow":Ti(N,"http://www.w3.org/1999/xlink","xlink:show",te);break;case"xlinkTitle":Ti(N,"http://www.w3.org/1999/xlink","xlink:title",te);break;case"xlinkType":Ti(N,"http://www.w3.org/1999/xlink","xlink:type",te);break;case"xmlBase":Ti(N,"http://www.w3.org/XML/1998/namespace","xml:base",te);break;case"xmlLang":Ti(N,"http://www.w3.org/XML/1998/namespace","xml:lang",te);break;case"xmlSpace":Ti(N,"http://www.w3.org/XML/1998/namespace","xml:space",te);break;case"is":Vi(N,"is",te);break;case"innerText":case"textContent":break;default:(!(2<K.length)||K[0]!=="o"&&K[0]!=="O"||K[1]!=="n"&&K[1]!=="N")&&(K=Cu.get(K)||K,Vi(N,K,te))}}function ld(N,Y,K,te,oe,ue){switch(K){case"style":ng(N,te,ue);break;case"dangerouslySetInnerHTML":if(te!=null){if(typeof te!="object"||!("__html"in te))throw Error(C(61));if(K=te.__html,K!=null){if(oe.children!=null)throw Error(C(60));N.innerHTML=K}}break;case"children":typeof te=="string"?ds(N,te):(typeof te=="number"||typeof te=="bigint")&&ds(N,""+te);break;case"onScroll":te!=null&&zi("scroll",N);break;case"onScrollEnd":te!=null&&zi("scrollend",N);break;case"onClick":te!=null&&(N.onclick=_h);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Mt.hasOwnProperty(K))e:{if(K[0]==="o"&&K[1]==="n"&&(oe=K.endsWith("Capture"),Y=K.slice(2,oe?K.length-7:void 0),ue=N[pi]||null,ue=ue!=null?ue[K]:null,typeof ue=="function"&&N.removeEventListener(Y,ue,oe),typeof te=="function")){typeof ue!="function"&&ue!==null&&(K in N?N[K]=null:N.hasAttribute(K)&&N.removeAttribute(K)),N.addEventListener(Y,te,oe);break e}K in N?N[K]=te:te===!0?N.setAttribute(K,""):Vi(N,K,te)}}}function Gs(N,Y,K){switch(Y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zi("error",N),zi("load",N);var te=!1,oe=!1,ue;for(ue in K)if(K.hasOwnProperty(ue)){var pe=K[ue];if(pe!=null)switch(ue){case"src":te=!0;break;case"srcSet":oe=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,Y));default:cn(N,Y,ue,pe,K,null)}}oe&&cn(N,Y,"srcSet",K.srcSet,K,null),te&&cn(N,Y,"src",K.src,K,null);return;case"input":zi("invalid",N);var xe=ue=pe=oe=null,Te=null,Oe=null;for(te in K)if(K.hasOwnProperty(te)){var Bt=K[te];if(Bt!=null)switch(te){case"name":oe=Bt;break;case"type":pe=Bt;break;case"checked":Te=Bt;break;case"defaultChecked":Oe=Bt;break;case"value":ue=Bt;break;case"defaultValue":xe=Bt;break;case"children":case"dangerouslySetInnerHTML":if(Bt!=null)throw Error(C(137,Y));break;default:cn(N,Y,te,Bt,K,null)}}ts(N,ue,xe,Te,Oe,pe,oe,!1),Ei(N);return;case"select":zi("invalid",N),te=pe=ue=null;for(oe in K)if(K.hasOwnProperty(oe)&&(xe=K[oe],xe!=null))switch(oe){case"value":ue=xe;break;case"defaultValue":pe=xe;break;case"multiple":te=xe;default:cn(N,Y,oe,xe,K,null)}Y=ue,K=pe,N.multiple=!!te,Y!=null?mn(N,!!te,Y,!1):K!=null&&mn(N,!!te,K,!0);return;case"textarea":zi("invalid",N),ue=oe=te=null;for(pe in K)if(K.hasOwnProperty(pe)&&(xe=K[pe],xe!=null))switch(pe){case"value":te=xe;break;case"defaultValue":oe=xe;break;case"children":ue=xe;break;case"dangerouslySetInnerHTML":if(xe!=null)throw Error(C(91));break;default:cn(N,Y,pe,xe,K,null)}ro(N,te,oe,ue),Ei(N);return;case"option":for(Te in K)if(K.hasOwnProperty(Te)&&(te=K[Te],te!=null))switch(Te){case"selected":N.selected=te&&typeof te!="function"&&typeof te!="symbol";break;default:cn(N,Y,Te,te,K,null)}return;case"dialog":zi("cancel",N),zi("close",N);break;case"iframe":case"object":zi("load",N);break;case"video":case"audio":for(te=0;te<su.length;te++)zi(su[te],N);break;case"image":zi("error",N),zi("load",N);break;case"details":zi("toggle",N);break;case"embed":case"source":case"link":zi("error",N),zi("load",N);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Oe in K)if(K.hasOwnProperty(Oe)&&(te=K[Oe],te!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,Y));default:cn(N,Y,Oe,te,K,null)}return;default:if(ml(Y)){for(Bt in K)K.hasOwnProperty(Bt)&&(te=K[Bt],te!==void 0&&ld(N,Y,Bt,te,K,void 0));return}}for(xe in K)K.hasOwnProperty(xe)&&(te=K[xe],te!=null&&cn(N,Y,xe,te,K,null))}function hC(N,Y,K,te){switch(Y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var oe=null,ue=null,pe=null,xe=null,Te=null,Oe=null,Bt=null;for(yt in K){var Vt=K[yt];if(K.hasOwnProperty(yt)&&Vt!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":Te=Vt;default:te.hasOwnProperty(yt)||cn(N,Y,yt,null,te,Vt)}}for(var gt in te){var yt=te[gt];if(Vt=K[gt],te.hasOwnProperty(gt)&&(yt!=null||Vt!=null))switch(gt){case"type":ue=yt;break;case"name":oe=yt;break;case"checked":Oe=yt;break;case"defaultChecked":Bt=yt;break;case"value":pe=yt;break;case"defaultValue":xe=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(C(137,Y));break;default:yt!==Vt&&cn(N,Y,gt,yt,te,Vt)}}Oi(N,pe,xe,Te,Oe,Bt,ue,oe);return;case"select":yt=pe=xe=gt=null;for(ue in K)if(Te=K[ue],K.hasOwnProperty(ue)&&Te!=null)switch(ue){case"value":break;case"multiple":yt=Te;default:te.hasOwnProperty(ue)||cn(N,Y,ue,null,te,Te)}for(oe in te)if(ue=te[oe],Te=K[oe],te.hasOwnProperty(oe)&&(ue!=null||Te!=null))switch(oe){case"value":gt=ue;break;case"defaultValue":xe=ue;break;case"multiple":pe=ue;default:ue!==Te&&cn(N,Y,oe,ue,te,Te)}Y=xe,K=pe,te=yt,gt!=null?mn(N,!!K,gt,!1):!!te!=!!K&&(Y!=null?mn(N,!!K,Y,!0):mn(N,!!K,K?[]:"",!1));return;case"textarea":yt=gt=null;for(xe in K)if(oe=K[xe],K.hasOwnProperty(xe)&&oe!=null&&!te.hasOwnProperty(xe))switch(xe){case"value":break;case"children":break;default:cn(N,Y,xe,null,te,oe)}for(pe in te)if(oe=te[pe],ue=K[pe],te.hasOwnProperty(pe)&&(oe!=null||ue!=null))switch(pe){case"value":gt=oe;break;case"defaultValue":yt=oe;break;case"children":break;case"dangerouslySetInnerHTML":if(oe!=null)throw Error(C(91));break;default:oe!==ue&&cn(N,Y,pe,oe,te,ue)}Kn(N,gt,yt);return;case"option":for(var ai in K)if(gt=K[ai],K.hasOwnProperty(ai)&&gt!=null&&!te.hasOwnProperty(ai))switch(ai){case"selected":N.selected=!1;break;default:cn(N,Y,ai,null,te,gt)}for(Te in te)if(gt=te[Te],yt=K[Te],te.hasOwnProperty(Te)&&gt!==yt&&(gt!=null||yt!=null))switch(Te){case"selected":N.selected=gt&&typeof gt!="function"&&typeof gt!="symbol";break;default:cn(N,Y,Te,gt,te,yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vi in K)gt=K[vi],K.hasOwnProperty(vi)&&gt!=null&&!te.hasOwnProperty(vi)&&cn(N,Y,vi,null,te,gt);for(Oe in te)if(gt=te[Oe],yt=K[Oe],te.hasOwnProperty(Oe)&&gt!==yt&&(gt!=null||yt!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":if(gt!=null)throw Error(C(137,Y));break;default:cn(N,Y,Oe,gt,te,yt)}return;default:if(ml(Y)){for(var Yn in K)gt=K[Yn],K.hasOwnProperty(Yn)&&gt!==void 0&&!te.hasOwnProperty(Yn)&&ld(N,Y,Yn,void 0,te,gt);for(Bt in te)gt=te[Bt],yt=K[Bt],!te.hasOwnProperty(Bt)||gt===yt||gt===void 0&&yt===void 0||ld(N,Y,Bt,gt,te,yt);return}}for(var Qe in K)gt=K[Qe],K.hasOwnProperty(Qe)&&gt!=null&&!te.hasOwnProperty(Qe)&&cn(N,Y,Qe,null,te,gt);for(Vt in te)gt=te[Vt],yt=K[Vt],!te.hasOwnProperty(Vt)||gt===yt||gt==null&&yt==null||cn(N,Y,Vt,gt,te,yt)}var cd=null,gd=null;function wh(N){return N.nodeType===9?N:N.ownerDocument}function Vd(N){switch(N){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ed(N,Y){if(N===0)switch(Y){case"svg":return 1;case"math":return 2;default:return 0}return N===1&&Y==="foreignObject"?0:N}function ud(N,Y){return N==="textarea"||N==="noscript"||typeof Y.children=="string"||typeof Y.children=="number"||typeof Y.children=="bigint"||typeof Y.dangerouslySetInnerHTML=="object"&&Y.dangerouslySetInnerHTML!==null&&Y.dangerouslySetInnerHTML.__html!=null}var hd=null;function dC(){var N=window.event;return N&&N.type==="popstate"?N===hd?!1:(hd=N,!0):(hd=null,!1)}var Wd=typeof setTimeout=="function"?setTimeout:void 0,CC=typeof clearTimeout=="function"?clearTimeout:void 0,Yd=typeof Promise=="function"?Promise:void 0,IC=typeof queueMicrotask=="function"?queueMicrotask:typeof Yd<"u"?function(N){return Yd.resolve(null).then(N).catch(fC)}:Wd;function fC(N){setTimeout(function(){throw N})}function dd(N,Y){var K=Y,te=0;do{var oe=K.nextSibling;if(N.removeChild(K),oe&&oe.nodeType===8)if(K=oe.data,K==="/$"){if(te===0){N.removeChild(oe),du(Y);return}te--}else K!=="$"&&K!=="$?"&&K!=="$!"||te++;K=oe}while(K);du(Y)}function Cd(N){var Y=N.firstChild;for(Y&&Y.nodeType===10&&(Y=Y.nextSibling);Y;){var K=Y;switch(Y=Y.nextSibling,K.nodeName){case"HTML":case"HEAD":case"BODY":Cd(K),Qr(K);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(K.rel.toLowerCase()==="stylesheet")continue}N.removeChild(K)}}function pC(N,Y,K,te){for(;N.nodeType===1;){var oe=K;if(N.nodeName.toLowerCase()!==Y.toLowerCase()){if(!te&&(N.nodeName!=="INPUT"||N.type!=="hidden"))break}else if(te){if(!N[Wo])switch(Y){case"meta":if(!N.hasAttribute("itemprop"))break;return N;case"link":if(ue=N.getAttribute("rel"),ue==="stylesheet"&&N.hasAttribute("data-precedence"))break;if(ue!==oe.rel||N.getAttribute("href")!==(oe.href==null?null:oe.href)||N.getAttribute("crossorigin")!==(oe.crossOrigin==null?null:oe.crossOrigin)||N.getAttribute("title")!==(oe.title==null?null:oe.title))break;return N;case"style":if(N.hasAttribute("data-precedence"))break;return N;case"script":if(ue=N.getAttribute("src"),(ue!==(oe.src==null?null:oe.src)||N.getAttribute("type")!==(oe.type==null?null:oe.type)||N.getAttribute("crossorigin")!==(oe.crossOrigin==null?null:oe.crossOrigin))&&ue&&N.hasAttribute("async")&&!N.hasAttribute("itemprop"))break;return N;default:return N}}else if(Y==="input"&&N.type==="hidden"){var ue=oe.name==null?null:""+oe.name;if(oe.type==="hidden"&&N.getAttribute("name")===ue)return N}else return N;if(N=Cr(N.nextSibling),N===null)break}return null}function mC(N,Y,K){if(Y==="")return null;for(;N.nodeType!==3;)if((N.nodeType!==1||N.nodeName!=="INPUT"||N.type!=="hidden")&&!K||(N=Cr(N.nextSibling),N===null))return null;return N}function Cr(N){for(;N!=null;N=N.nextSibling){var Y=N.nodeType;if(Y===1||Y===3)break;if(Y===8){if(Y=N.data,Y==="$"||Y==="$!"||Y==="$?"||Y==="F!"||Y==="F")break;if(Y==="/$")return null}}return N}function Td(N){N=N.previousSibling;for(var Y=0;N;){if(N.nodeType===8){var K=N.data;if(K==="$"||K==="$!"||K==="$?"){if(Y===0)return N;Y--}else K==="/$"&&Y++}N=N.previousSibling}return null}function Jd(N,Y,K){switch(Y=wh(K),N){case"html":if(N=Y.documentElement,!N)throw Error(C(452));return N;case"head":if(N=Y.head,!N)throw Error(C(453));return N;case"body":if(N=Y.body,!N)throw Error(C(454));return N;default:throw Error(C(451))}}var Eo=new Map,Hd=new Set;function Zh(N){return typeof N.getRootNode=="function"?N.getRootNode():N.ownerDocument}var _a=Re.d;Re.d={f:AC,r:bC,D:yC,C:GC,L:vC,m:BC,X:xC,S:SC,M:XC};function AC(){var N=_a.f(),Y=xa();return N||Y}function bC(N){var Y=Se(N);Y!==null&&Y.tag===5&&Y.type==="form"?ah(Y):_a.r(N)}var eg=typeof document>"u"?null:document;function zd(N,Y,K){var te=eg;if(te&&typeof Y=="string"&&Y){var oe=Jn(Y);oe='link[rel="'+N+'"][href="'+oe+'"]',typeof K=="string"&&(oe+='[crossorigin="'+K+'"]'),Hd.has(oe)||(Hd.add(oe),N={rel:N,crossOrigin:K,href:Y},te.querySelector(oe)===null&&(Y=te.createElement("link"),Gs(Y,"link",N),tt(Y),te.head.appendChild(Y)))}}function yC(N){_a.D(N),zd("dns-prefetch",N,null)}function GC(N,Y){_a.C(N,Y),zd("preconnect",N,Y)}function vC(N,Y,K){_a.L(N,Y,K);var te=eg;if(te&&N&&Y){var oe='link[rel="preload"][as="'+Jn(Y)+'"]';Y==="image"&&K&&K.imageSrcSet?(oe+='[imagesrcset="'+Jn(K.imageSrcSet)+'"]',typeof K.imageSizes=="string"&&(oe+='[imagesizes="'+Jn(K.imageSizes)+'"]')):oe+='[href="'+Jn(N)+'"]';var ue=oe;switch(Y){case"style":ue=tg(N);break;case"script":ue=ig(N)}Eo.has(ue)||(N=he({rel:"preload",href:Y==="image"&&K&&K.imageSrcSet?void 0:N,as:Y},K),Eo.set(ue,N),te.querySelector(oe)!==null||Y==="style"&&te.querySelector(ru(ue))||Y==="script"&&te.querySelector(au(ue))||(Y=te.createElement("link"),Gs(Y,"link",N),tt(Y),te.head.appendChild(Y)))}}function BC(N,Y){_a.m(N,Y);var K=eg;if(K&&N){var te=Y&&typeof Y.as=="string"?Y.as:"script",oe='link[rel="modulepreload"][as="'+Jn(te)+'"][href="'+Jn(N)+'"]',ue=oe;switch(te){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":ue=ig(N)}if(!Eo.has(ue)&&(N=he({rel:"modulepreload",href:N},Y),Eo.set(ue,N),K.querySelector(oe)===null)){switch(te){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(K.querySelector(au(ue)))return}te=K.createElement("link"),Gs(te,"link",N),tt(te),K.head.appendChild(te)}}}function SC(N,Y,K){_a.S(N,Y,K);var te=eg;if(te&&N){var oe=ot(te).hoistableStyles,ue=tg(N);Y=Y||"default";var pe=oe.get(ue);if(!pe){var xe={loading:0,preload:null};if(pe=te.querySelector(ru(ue)))xe.loading=5;else{N=he({rel:"stylesheet",href:N,"data-precedence":Y},K),(K=Eo.get(ue))&&Id(N,K);var Te=pe=te.createElement("link");tt(Te),Gs(Te,"link",N),Te._p=new Promise(function(Oe,Bt){Te.onload=Oe,Te.onerror=Bt}),Te.addEventListener("load",function(){xe.loading|=1}),Te.addEventListener("error",function(){xe.loading|=2}),xe.loading|=4,Mh(pe,Y,te)}pe={type:"stylesheet",instance:pe,count:1,state:xe},oe.set(ue,pe)}}}function xC(N,Y){_a.X(N,Y);var K=eg;if(K&&N){var te=ot(K).hoistableScripts,oe=ig(N),ue=te.get(oe);ue||(ue=K.querySelector(au(oe)),ue||(N=he({src:N,async:!0},Y),(Y=Eo.get(oe))&&fd(N,Y),ue=K.createElement("script"),tt(ue),Gs(ue,"link",N),K.head.appendChild(ue)),ue={type:"script",instance:ue,count:1,state:null},te.set(oe,ue))}}function XC(N,Y){_a.M(N,Y);var K=eg;if(K&&N){var te=ot(K).hoistableScripts,oe=ig(N),ue=te.get(oe);ue||(ue=K.querySelector(au(oe)),ue||(N=he({src:N,async:!0,type:"module"},Y),(Y=Eo.get(oe))&&fd(N,Y),ue=K.createElement("script"),tt(ue),Gs(ue,"link",N),K.head.appendChild(ue)),ue={type:"script",instance:ue,count:1,state:null},te.set(oe,ue))}}function Fd(N,Y,K,te){var oe=(oe=nt.current)?Zh(oe):null;if(!oe)throw Error(C(446));switch(N){case"meta":case"title":return null;case"style":return typeof K.precedence=="string"&&typeof K.href=="string"?(Y=tg(K.href),K=ot(oe).hoistableStyles,te=K.get(Y),te||(te={type:"style",instance:null,count:0,state:null},K.set(Y,te)),te):{type:"void",instance:null,count:0,state:null};case"link":if(K.rel==="stylesheet"&&typeof K.href=="string"&&typeof K.precedence=="string"){N=tg(K.href);var ue=ot(oe).hoistableStyles,pe=ue.get(N);if(pe||(oe=oe.ownerDocument||oe,pe={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},ue.set(N,pe),(ue=oe.querySelector(ru(N)))&&!ue._p&&(pe.instance=ue,pe.state.loading=5),Eo.has(N)||(K={rel:"preload",as:"style",href:K.href,crossOrigin:K.crossOrigin,integrity:K.integrity,media:K.media,hrefLang:K.hrefLang,referrerPolicy:K.referrerPolicy},Eo.set(N,K),ue||RC(oe,N,K,pe.state))),Y&&te===null)throw Error(C(528,""));return pe}if(Y&&te!==null)throw Error(C(529,""));return null;case"script":return Y=K.async,K=K.src,typeof K=="string"&&Y&&typeof Y!="function"&&typeof Y!="symbol"?(Y=ig(K),K=ot(oe).hoistableScripts,te=K.get(Y),te||(te={type:"script",instance:null,count:0,state:null},K.set(Y,te)),te):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,N))}}function tg(N){return'href="'+Jn(N)+'"'}function ru(N){return'link[rel="stylesheet"]['+N+"]"}function Ld(N){return he({},N,{"data-precedence":N.precedence,precedence:null})}function RC(N,Y,K,te){N.querySelector('link[rel="preload"][as="style"]['+Y+"]")?te.loading=1:(Y=N.createElement("link"),te.preload=Y,Y.addEventListener("load",function(){return te.loading|=1}),Y.addEventListener("error",function(){return te.loading|=2}),Gs(Y,"link",K),tt(Y),N.head.appendChild(Y))}function ig(N){return'[src="'+Jn(N)+'"]'}function au(N){return"script[async]"+N}function Kd(N,Y,K){if(Y.count++,Y.instance===null)switch(Y.type){case"style":var te=N.querySelector('style[data-href~="'+Jn(K.href)+'"]');if(te)return Y.instance=te,tt(te),te;var oe=he({},K,{"data-href":K.href,"data-precedence":K.precedence,href:null,precedence:null});return te=(N.ownerDocument||N).createElement("style"),tt(te),Gs(te,"style",oe),Mh(te,K.precedence,N),Y.instance=te;case"stylesheet":oe=tg(K.href);var ue=N.querySelector(ru(oe));if(ue)return Y.state.loading|=4,Y.instance=ue,tt(ue),ue;te=Ld(K),(oe=Eo.get(oe))&&Id(te,oe),ue=(N.ownerDocument||N).createElement("link"),tt(ue);var pe=ue;return pe._p=new Promise(function(xe,Te){pe.onload=xe,pe.onerror=Te}),Gs(ue,"link",te),Y.state.loading|=4,Mh(ue,K.precedence,N),Y.instance=ue;case"script":return ue=ig(K.src),(oe=N.querySelector(au(ue)))?(Y.instance=oe,tt(oe),oe):(te=K,(oe=Eo.get(ue))&&(te=he({},K),fd(te,oe)),N=N.ownerDocument||N,oe=N.createElement("script"),tt(oe),Gs(oe,"link",te),N.head.appendChild(oe),Y.instance=oe);case"void":return null;default:throw Error(C(443,Y.type))}else Y.type==="stylesheet"&&(Y.state.loading&4)===0&&(te=Y.instance,Y.state.loading|=4,Mh(te,K.precedence,N));return Y.instance}function Mh(N,Y,K){for(var te=K.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),oe=te.length?te[te.length-1]:null,ue=oe,pe=0;pe<te.length;pe++){var xe=te[pe];if(xe.dataset.precedence===Y)ue=xe;else if(ue!==oe)break}ue?ue.parentNode.insertBefore(N,ue.nextSibling):(Y=K.nodeType===9?K.head:K,Y.insertBefore(N,Y.firstChild))}function Id(N,Y){N.crossOrigin==null&&(N.crossOrigin=Y.crossOrigin),N.referrerPolicy==null&&(N.referrerPolicy=Y.referrerPolicy),N.title==null&&(N.title=Y.title)}function fd(N,Y){N.crossOrigin==null&&(N.crossOrigin=Y.crossOrigin),N.referrerPolicy==null&&(N.referrerPolicy=Y.referrerPolicy),N.integrity==null&&(N.integrity=Y.integrity)}var Nh=null;function Pd(N,Y,K){if(Nh===null){var te=new Map,oe=Nh=new Map;oe.set(K,te)}else oe=Nh,te=oe.get(K),te||(te=new Map,oe.set(K,te));if(te.has(N))return te;for(te.set(N,null),K=K.getElementsByTagName(N),oe=0;oe<K.length;oe++){var ue=K[oe];if(!(ue[Wo]||ue[on]||N==="link"&&ue.getAttribute("rel")==="stylesheet")&&ue.namespaceURI!=="http://www.w3.org/2000/svg"){var pe=ue.getAttribute(Y)||"";pe=N+pe;var xe=te.get(pe);xe?xe.push(ue):te.set(pe,[ue])}}return te}function kd(N,Y,K){N=N.ownerDocument||N,N.head.insertBefore(K,Y==="title"?N.querySelector("head > title"):null)}function _C(N,Y,K){if(K===1||Y.itemProp!=null)return!1;switch(N){case"meta":case"title":return!0;case"style":if(typeof Y.precedence!="string"||typeof Y.href!="string"||Y.href==="")break;return!0;case"link":if(typeof Y.rel!="string"||typeof Y.href!="string"||Y.href===""||Y.onLoad||Y.onError)break;switch(Y.rel){case"stylesheet":return N=Y.disabled,typeof Y.precedence=="string"&&N==null;default:return!0}case"script":if(Y.async&&typeof Y.async!="function"&&typeof Y.async!="symbol"&&!Y.onLoad&&!Y.onError&&Y.src&&typeof Y.src=="string")return!0}return!1}function Dd(N){return!(N.type==="stylesheet"&&(N.state.loading&3)===0)}var lu=null;function wC(){}function ZC(N,Y,K){if(lu===null)throw Error(C(475));var te=lu;if(Y.type==="stylesheet"&&(typeof K.media!="string"||matchMedia(K.media).matches!==!1)&&(Y.state.loading&4)===0){if(Y.instance===null){var oe=tg(K.href),ue=N.querySelector(ru(oe));if(ue){N=ue._p,N!==null&&typeof N=="object"&&typeof N.then=="function"&&(te.count++,te=Vh.bind(te),N.then(te,te)),Y.state.loading|=4,Y.instance=ue,tt(ue);return}ue=N.ownerDocument||N,K=Ld(K),(oe=Eo.get(oe))&&Id(K,oe),ue=ue.createElement("link"),tt(ue);var pe=ue;pe._p=new Promise(function(xe,Te){pe.onload=xe,pe.onerror=Te}),Gs(ue,"link",K),Y.instance=ue}te.stylesheets===null&&(te.stylesheets=new Map),te.stylesheets.set(Y,N),(N=Y.state.preload)&&(Y.state.loading&3)===0&&(te.count++,Y=Vh.bind(te),N.addEventListener("load",Y),N.addEventListener("error",Y))}}function MC(){if(lu===null)throw Error(C(475));var N=lu;return N.stylesheets&&N.count===0&&pd(N,N.stylesheets),0<N.count?function(Y){var K=setTimeout(function(){if(N.stylesheets&&pd(N,N.stylesheets),N.unsuspend){var te=N.unsuspend;N.unsuspend=null,te()}},6e4);return N.unsuspend=Y,function(){N.unsuspend=null,clearTimeout(K)}}:null}function Vh(){if(this.count--,this.count===0){if(this.stylesheets)pd(this,this.stylesheets);else if(this.unsuspend){var N=this.unsuspend;this.unsuspend=null,N()}}}var Eh=null;function pd(N,Y){N.stylesheets=null,N.unsuspend!==null&&(N.count++,Eh=new Map,Y.forEach(NC,N),Eh=null,Vh.call(N))}function NC(N,Y){if(!(Y.state.loading&4)){var K=Eh.get(N);if(K)var te=K.get(null);else{K=new Map,Eh.set(N,K);for(var oe=N.querySelectorAll("link[data-precedence],style[data-precedence]"),ue=0;ue<oe.length;ue++){var pe=oe[ue];(pe.nodeName==="LINK"||pe.getAttribute("media")!=="not all")&&(K.set(pe.dataset.precedence,pe),te=pe)}te&&K.set(null,te)}oe=Y.instance,pe=oe.getAttribute("data-precedence"),ue=K.get(pe)||te,ue===te&&K.set(null,oe),K.set(pe,oe),this.count++,te=Vh.bind(this),oe.addEventListener("load",te),oe.addEventListener("error",te),ue?ue.parentNode.insertBefore(oe,ue.nextSibling):(N=N.nodeType===9?N.head:N,N.insertBefore(oe,N.firstChild)),Y.state.loading|=4}}var cu={$$typeof:H,Provider:null,Consumer:null,_currentValue:We,_currentValue2:We,_threadCount:0};function VC(N,Y,K,te,oe,ue,pe,xe){this.tag=1,this.containerInfo=N,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_i(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_i(0),this.hiddenUpdates=_i(null),this.identifierPrefix=te,this.onUncaughtError=oe,this.onCaughtError=ue,this.onRecoverableError=pe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=xe,this.incompleteTransitions=new Map}function Od(N,Y,K,te,oe,ue,pe,xe,Te,Oe,Bt,Vt){return N=new VC(N,Y,K,pe,xe,Te,Oe,Vt),Y=1,ue===!0&&(Y|=24),ue=Xn(3,null,null,Y),N.current=ue,ue.stateNode=N,Y=Xg(),Y.refCount++,N.pooledCache=Y,Y.refCount++,ue.memoizedState={element:te,isDehydrated:K,cache:Y},ps(ue),N}function Ud(N){return N?(N=vr,N):vr}function $d(N,Y,K,te,oe,ue){oe=Ud(oe),te.context===null?te.context=oe:te.pendingContext=oe,te=Js(Y),te.payload={element:K},ue=ue===void 0?null:ue,ue!==null&&(te.callback=ue),K=Hs(N,te,Y),K!==null&&(Wn(K,N,Y),zr(K,N,Y))}function jd(N,Y){if(N=N.memoizedState,N!==null&&N.dehydrated!==null){var K=N.retryLane;N.retryLane=K!==0&&K<Y?K:Y}}function md(N,Y){jd(N,Y),(N=N.alternate)&&jd(N,Y)}function Qd(N){if(N.tag===13){var Y=Po(N,67108864);Y!==null&&Wn(Y,N,67108864),md(N,67108864)}}var Wh=!0;function EC(N,Y,K,te){var oe=ge.T;ge.T=null;var ue=Re.p;try{Re.p=2,Ad(N,Y,K,te)}finally{Re.p=ue,ge.T=oe}}function WC(N,Y,K,te){var oe=ge.T;ge.T=null;var ue=Re.p;try{Re.p=8,Ad(N,Y,K,te)}finally{Re.p=ue,ge.T=oe}}function Ad(N,Y,K,te){if(Wh){var oe=bd(te);if(oe===null)ad(N,Y,te,Yh,K),eC(N,te);else if(TC(oe,N,Y,K,te))te.stopPropagation();else if(eC(N,te),Y&4&&-1<YC.indexOf(N)){for(;oe!==null;){var ue=Se(oe);if(ue!==null)switch(ue.tag){case 3:if(ue=ue.stateNode,ue.current.memoizedState.isDehydrated){var pe=Tt(ue.pendingLanes);if(pe!==0){var xe=ue;for(xe.pendingLanes|=2,xe.entangledLanes|=2;pe;){var Te=1<<31-Pe(pe);xe.entanglements[1]|=Te,pe&=~Te}nn(ue),(bi&6)===0&&(Mi=ht()+500,Wi(0))}}break;case 13:xe=Po(ue,2),xe!==null&&Wn(xe,ue,2),xa(),md(ue,2)}if(ue=bd(te),ue===null&&ad(N,Y,te,Yh,K),ue===oe)break;oe=ue}oe!==null&&te.stopPropagation()}else ad(N,Y,te,null,K)}}function bd(N){return N=bl(N),yd(N)}var Yh=null;function yd(N){if(Yh=null,N=oo(N),N!==null){var Y=Ve(N);if(Y===null)N=null;else{var K=Y.tag;if(K===13){if(N=Ye(Y),N!==null)return N;N=null}else if(K===3){if(Y.stateNode.current.memoizedState.isDehydrated)return Y.tag===3?Y.stateNode.containerInfo:null;N=null}else Y!==N&&(N=null)}}return Yh=N,null}function qd(N){switch(N){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Xt()){case Ue:return 2;case ft:return 8;case Dt:case jt:return 32;case ii:return 268435456;default:return 32}default:return 32}}var Gd=!1,hl=null,dl=null,Cl=null,gu=new Map,uu=new Map,Il=[],YC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function eC(N,Y){switch(N){case"focusin":case"focusout":hl=null;break;case"dragenter":case"dragleave":dl=null;break;case"mouseover":case"mouseout":Cl=null;break;case"pointerover":case"pointerout":gu.delete(Y.pointerId);break;case"gotpointercapture":case"lostpointercapture":uu.delete(Y.pointerId)}}function hu(N,Y,K,te,oe,ue){return N===null||N.nativeEvent!==ue?(N={blockedOn:Y,domEventName:K,eventSystemFlags:te,nativeEvent:ue,targetContainers:[oe]},Y!==null&&(Y=Se(Y),Y!==null&&Qd(Y)),N):(N.eventSystemFlags|=te,Y=N.targetContainers,oe!==null&&Y.indexOf(oe)===-1&&Y.push(oe),N)}function TC(N,Y,K,te,oe){switch(Y){case"focusin":return hl=hu(hl,N,Y,K,te,oe),!0;case"dragenter":return dl=hu(dl,N,Y,K,te,oe),!0;case"mouseover":return Cl=hu(Cl,N,Y,K,te,oe),!0;case"pointerover":var ue=oe.pointerId;return gu.set(ue,hu(gu.get(ue)||null,N,Y,K,te,oe)),!0;case"gotpointercapture":return ue=oe.pointerId,uu.set(ue,hu(uu.get(ue)||null,N,Y,K,te,oe)),!0}return!1}function tC(N){var Y=oo(N.target);if(Y!==null){var K=Ve(Y);if(K!==null){if(Y=K.tag,Y===13){if(Y=Ye(K),Y!==null){N.blockedOn=Y,vs(N.priority,function(){if(K.tag===13){var te=ys(),oe=Po(K,te);oe!==null&&Wn(oe,K,te),md(K,te)}});return}}else if(Y===3&&K.stateNode.current.memoizedState.isDehydrated){N.blockedOn=K.tag===3?K.stateNode.containerInfo:null;return}}}N.blockedOn=null}function Th(N){if(N.blockedOn!==null)return!1;for(var Y=N.targetContainers;0<Y.length;){var K=bd(N.nativeEvent);if(K===null){K=N.nativeEvent;var te=new K.constructor(K.type,K);cc=te,K.target.dispatchEvent(te),cc=null}else return Y=Se(K),Y!==null&&Qd(Y),N.blockedOn=K,!1;Y.shift()}return!0}function iC(N,Y,K){Th(N)&&K.delete(Y)}function JC(){Gd=!1,hl!==null&&Th(hl)&&(hl=null),dl!==null&&Th(dl)&&(dl=null),Cl!==null&&Th(Cl)&&(Cl=null),gu.forEach(iC),uu.forEach(iC)}function Jh(N,Y){N.blockedOn===Y&&(N.blockedOn=null,Gd||(Gd=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,JC)))}var Hh=null;function nC(N){Hh!==N&&(Hh=N,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){Hh===N&&(Hh=null);for(var Y=0;Y<N.length;Y+=3){var K=N[Y],te=N[Y+1],oe=N[Y+2];if(typeof te!="function"){if(yd(te||K)===null)continue;break}var ue=Se(K);ue!==null&&(N.splice(Y,3),Y-=3,Wg(ue,{pending:!0,data:oe,method:K.method,action:te},te,oe))}}))}function du(N){function Y(Te){return Jh(Te,N)}hl!==null&&Jh(hl,N),dl!==null&&Jh(dl,N),Cl!==null&&Jh(Cl,N),gu.forEach(Y),uu.forEach(Y);for(var K=0;K<Il.length;K++){var te=Il[K];te.blockedOn===N&&(te.blockedOn=null)}for(;0<Il.length&&(K=Il[0],K.blockedOn===null);)tC(K),K.blockedOn===null&&Il.shift();if(K=(N.ownerDocument||N).$$reactFormReplay,K!=null)for(te=0;te<K.length;te+=3){var oe=K[te],ue=K[te+1],pe=oe[pi]||null;if(typeof ue=="function")pe||nC(K);else if(pe){var xe=null;if(ue&&ue.hasAttribute("formAction")){if(oe=ue,pe=ue[pi]||null)xe=pe.formAction;else if(yd(oe)!==null)continue}else xe=pe.action;typeof xe=="function"?K[te+1]=xe:(K.splice(te,3),te-=3),nC(K)}}}function vd(N){this._internalRoot=N}zh.prototype.render=vd.prototype.render=function(N){var Y=this._internalRoot;if(Y===null)throw Error(C(409));var K=Y.current,te=ys();$d(K,te,N,Y,null,null)},zh.prototype.unmount=vd.prototype.unmount=function(){var N=this._internalRoot;if(N!==null){this._internalRoot=null;var Y=N.containerInfo;N.tag===0&&Ot(),$d(N.current,2,null,N,null,null),xa(),Y[so]=null}};function zh(N){this._internalRoot=N}zh.prototype.unstable_scheduleHydration=function(N){if(N){var Y=qn();N={blockedOn:null,target:N,priority:Y};for(var K=0;K<Il.length&&Y!==0&&Y<Il[K].priority;K++);Il.splice(K,0,N),K===0&&tC(N)}};var sC=n.version;if(sC!=="19.0.0")throw Error(C(527,sC,"19.0.0"));Re.findDOMNode=function(N){var Y=N._reactInternals;if(Y===void 0)throw typeof N.render=="function"?Error(C(188)):(N=Object.keys(N).join(","),Error(C(268,N)));return N=Be(Y),N=N!==null?Ne(N):null,N=N===null?null:N.stateNode,N};var HC={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:ge,findFiberByHostInstance:oo,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fh.isDisabled&&Fh.supportsFiber)try{Zt=Fh.inject(HC),Nt=Fh}catch{}}return reactDomClient_production.createRoot=function(N,Y){if(!I(N))throw Error(C(299));var K=!1,te="",oe=Ih,ue=fh,pe=ph,xe=null;return Y!=null&&(Y.unstable_strictMode===!0&&(K=!0),Y.identifierPrefix!==void 0&&(te=Y.identifierPrefix),Y.onUncaughtError!==void 0&&(oe=Y.onUncaughtError),Y.onCaughtError!==void 0&&(ue=Y.onCaughtError),Y.onRecoverableError!==void 0&&(pe=Y.onRecoverableError),Y.unstable_transitionCallbacks!==void 0&&(xe=Y.unstable_transitionCallbacks)),Y=Od(N,1,!1,null,null,K,te,oe,ue,pe,xe,null),N[so]=Y.current,rd(N.nodeType===8?N.parentNode:N),new vd(Y)},reactDomClient_production.hydrateRoot=function(N,Y,K){if(!I(N))throw Error(C(299));var te=!1,oe="",ue=Ih,pe=fh,xe=ph,Te=null,Oe=null;return K!=null&&(K.unstable_strictMode===!0&&(te=!0),K.identifierPrefix!==void 0&&(oe=K.identifierPrefix),K.onUncaughtError!==void 0&&(ue=K.onUncaughtError),K.onCaughtError!==void 0&&(pe=K.onCaughtError),K.onRecoverableError!==void 0&&(xe=K.onRecoverableError),K.unstable_transitionCallbacks!==void 0&&(Te=K.unstable_transitionCallbacks),K.formState!==void 0&&(Oe=K.formState)),Y=Od(N,1,!0,Y,K??null,te,oe,ue,pe,xe,Te,Oe),Y.context=Ud(null),K=Y.current,te=ys(),oe=Js(te),oe.callback=null,Hs(K,oe,te),Y.current.lanes=te,Di(Y,te),nn(Y),N[so]=Y.current,rd(N),new zh(Y)},reactDomClient_production.version="19.0.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const{createElement:createElement$1,createContext,forwardRef,useCallback,useContext,useEffect,useImperativeHandle,useLayoutEffect,useMemo,useRef,useState}=React$1,useId=React$1[`useId${Math.random()}`.slice(0,5)],useLayoutEffect_do_not_use_directly=useLayoutEffect,PanelGroupContext=createContext(null);PanelGroupContext.displayName="PanelGroupContext";const useIsomorphicLayoutEffect$1=useLayoutEffect_do_not_use_directly,wrappedUseId=typeof useId=="function"?useId:()=>null;let counter=0;function useUniqueId(u=null){const n=wrappedUseId(),d=useRef(u||n||null);return d.current===null&&(d.current=""+counter++),u??d.current}function PanelWithForwardedRef({children:u,className:n="",collapsedSize:d,collapsible:C,defaultSize:I,forwardedRef:f,id:y,maxSize:B,minSize:_,onCollapse:Z,onExpand:M,onResize:V,order:T,style:H,tagName:F="div",...O}){const $=useContext(PanelGroupContext);if($===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:U,expandPanel:ee,getPanelSize:Q,getPanelStyle:ie,groupId:ne,isPanelCollapsed:le,reevaluatePanelConstraints:ae,registerPanel:ce,resizePanel:ge,unregisterPanel:he}=$,Ie=useUniqueId(y),fe=useRef({callbacks:{onCollapse:Z,onExpand:M,onResize:V},constraints:{collapsedSize:d,collapsible:C,defaultSize:I,maxSize:B,minSize:_},id:Ie,idIsFromProps:y!==void 0,order:T});useRef({didLogMissingDefaultSizeWarning:!1}),useIsomorphicLayoutEffect$1(()=>{const{callbacks:Ge,constraints:Ze}=fe.current,ye={...Ze};fe.current.id=Ie,fe.current.idIsFromProps=y!==void 0,fe.current.order=T,Ge.onCollapse=Z,Ge.onExpand=M,Ge.onResize=V,Ze.collapsedSize=d,Ze.collapsible=C,Ze.defaultSize=I,Ze.maxSize=B,Ze.minSize=_,(ye.collapsedSize!==Ze.collapsedSize||ye.collapsible!==Ze.collapsible||ye.maxSize!==Ze.maxSize||ye.minSize!==Ze.minSize)&&ae(fe.current,ye)}),useIsomorphicLayoutEffect$1(()=>{const Ge=fe.current;return ce(Ge),()=>{he(Ge)}},[T,Ie,ce,he]),useImperativeHandle(f,()=>({collapse:()=>{U(fe.current)},expand:Ge=>{ee(fe.current,Ge)},getId(){return Ie},getSize(){return Q(fe.current)},isCollapsed(){return le(fe.current)},isExpanded(){return!le(fe.current)},resize:Ge=>{ge(fe.current,Ge)}}),[U,ee,Q,le,Ie,ge]);const me=ie(fe.current,I);return createElement$1(F,{...O,children:u,className:n,id:y,style:{...me,...H},"data-panel":"","data-panel-collapsible":C||void 0,"data-panel-group-id":ne,"data-panel-id":Ie,"data-panel-size":parseFloat(""+me.flexGrow).toFixed(1)})}const Panel=forwardRef((u,n)=>createElement$1(PanelWithForwardedRef,{...u,forwardedRef:n}));PanelWithForwardedRef.displayName="Panel";Panel.displayName="forwardRef(Panel)";let currentCursorStyle=null,styleElement=null;function getCursorStyle(u,n){if(n){const d=(n&EXCEEDED_HORIZONTAL_MIN)!==0,C=(n&EXCEEDED_HORIZONTAL_MAX)!==0,I=(n&EXCEEDED_VERTICAL_MIN)!==0,f=(n&EXCEEDED_VERTICAL_MAX)!==0;if(d)return I?"se-resize":f?"ne-resize":"e-resize";if(C)return I?"sw-resize":f?"nw-resize":"w-resize";if(I)return"s-resize";if(f)return"n-resize"}switch(u){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function resetGlobalCursorStyle(){styleElement!==null&&(document.head.removeChild(styleElement),currentCursorStyle=null,styleElement=null)}function setGlobalCursorStyle(u,n){const d=getCursorStyle(u,n);currentCursorStyle!==d&&(currentCursorStyle=d,styleElement===null&&(styleElement=document.createElement("style"),document.head.appendChild(styleElement)),styleElement.innerHTML=`*{cursor: ${d}!important;}`)}function isKeyDown(u){return u.type==="keydown"}function isPointerEvent(u){return u.type.startsWith("pointer")}function isMouseEvent$1(u){return u.type.startsWith("mouse")}function getResizeEventCoordinates(u){if(isPointerEvent(u)){if(u.isPrimary)return{x:u.clientX,y:u.clientY}}else if(isMouseEvent$1(u))return{x:u.clientX,y:u.clientY};return{x:1/0,y:1/0}}function getInputType(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function intersects$1(u,n,d){return u.x<n.x+n.width&&u.x+u.width>n.x&&u.y<n.y+n.height&&u.y+u.height>n.y}function compare(u,n){if(u===n)throw new Error("Cannot compare node with itself");const d={a:get_ancestors(u),b:get_ancestors(n)};let C;for(;d.a.at(-1)===d.b.at(-1);)u=d.a.pop(),n=d.b.pop(),C=u;assert(C,"Stacking order can only be calculated for elements with a common ancestor");const I={a:get_z_index(find_stacking_context(d.a)),b:get_z_index(find_stacking_context(d.b))};if(I.a===I.b){const f=C.childNodes,y={a:d.a.at(-1),b:d.b.at(-1)};let B=f.length;for(;B--;){const _=f[B];if(_===y.a)return 1;if(_===y.b)return-1}}return Math.sign(I.a-I.b)}const props=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function is_flex_item(u){var n;const d=getComputedStyle((n=get_parent(u))!==null&&n!==void 0?n:u).display;return d==="flex"||d==="inline-flex"}function creates_stacking_context(u){const n=getComputedStyle(u);return!!(n.position==="fixed"||n.zIndex!=="auto"&&(n.position!=="static"||is_flex_item(u))||+n.opacity<1||"transform"in n&&n.transform!=="none"||"webkitTransform"in n&&n.webkitTransform!=="none"||"mixBlendMode"in n&&n.mixBlendMode!=="normal"||"filter"in n&&n.filter!=="none"||"webkitFilter"in n&&n.webkitFilter!=="none"||"isolation"in n&&n.isolation==="isolate"||props.test(n.willChange)||n.webkitOverflowScrolling==="touch")}function find_stacking_context(u){let n=u.length;for(;n--;){const d=u[n];if(assert(d,"Missing node"),creates_stacking_context(d))return d}return null}function get_z_index(u){return u&&Number(getComputedStyle(u).zIndex)||0}function get_ancestors(u){const n=[];for(;u;)n.push(u),u=get_parent(u);return n}function get_parent(u){const{parentNode:n}=u;return n&&n instanceof ShadowRoot?n.host:n}const EXCEEDED_HORIZONTAL_MIN=1,EXCEEDED_HORIZONTAL_MAX=2,EXCEEDED_VERTICAL_MIN=4,EXCEEDED_VERTICAL_MAX=8,isCoarsePointer=getInputType()==="coarse";let intersectingHandles=[],isPointerDown=!1,ownerDocumentCounts=new Map,panelConstraintFlags=new Map;const registeredResizeHandlers=new Set;function registerResizeHandle(u,n,d,C,I){var f;const{ownerDocument:y}=n,B={direction:d,element:n,hitAreaMargins:C,setResizeHandlerState:I},_=(f=ownerDocumentCounts.get(y))!==null&&f!==void 0?f:0;return ownerDocumentCounts.set(y,_+1),registeredResizeHandlers.add(B),updateListeners(),function(){var M;panelConstraintFlags.delete(u),registeredResizeHandlers.delete(B);const V=(M=ownerDocumentCounts.get(y))!==null&&M!==void 0?M:1;if(ownerDocumentCounts.set(y,V-1),updateListeners(),V===1&&ownerDocumentCounts.delete(y),intersectingHandles.includes(B)){const T=intersectingHandles.indexOf(B);T>=0&&intersectingHandles.splice(T,1),updateCursor(),I("up",!0,null)}}}function handlePointerDown(u){const{target:n}=u,{x:d,y:C}=getResizeEventCoordinates(u);isPointerDown=!0,recalculateIntersectingHandles({target:n,x:d,y:C}),updateListeners(),intersectingHandles.length>0&&(updateResizeHandlerStates("down",u),u.preventDefault(),u.stopPropagation())}function handlePointerMove(u){const{x:n,y:d}=getResizeEventCoordinates(u);if(isPointerDown&&u.buttons===0&&(isPointerDown=!1,updateResizeHandlerStates("up",u)),!isPointerDown){const{target:C}=u;recalculateIntersectingHandles({target:C,x:n,y:d})}updateResizeHandlerStates("move",u),updateCursor(),intersectingHandles.length>0&&u.preventDefault()}function handlePointerUp(u){const{target:n}=u,{x:d,y:C}=getResizeEventCoordinates(u);panelConstraintFlags.clear(),isPointerDown=!1,intersectingHandles.length>0&&u.preventDefault(),updateResizeHandlerStates("up",u),recalculateIntersectingHandles({target:n,x:d,y:C}),updateCursor(),updateListeners()}function recalculateIntersectingHandles({target:u,x:n,y:d}){intersectingHandles.splice(0);let C=null;(u instanceof HTMLElement||u instanceof SVGElement)&&(C=u),registeredResizeHandlers.forEach(I=>{const{element:f,hitAreaMargins:y}=I,B=f.getBoundingClientRect(),{bottom:_,left:Z,right:M,top:V}=B,T=isCoarsePointer?y.coarse:y.fine;if(n>=Z-T&&n<=M+T&&d>=V-T&&d<=_+T){if(C!==null&&document.contains(C)&&f!==C&&!f.contains(C)&&!C.contains(f)&&compare(C,f)>0){let F=C,O=!1;for(;F&&!F.contains(f);){if(intersects$1(F.getBoundingClientRect(),B)){O=!0;break}F=F.parentElement}if(O)return}intersectingHandles.push(I)}})}function reportConstraintsViolation(u,n){panelConstraintFlags.set(u,n)}function updateCursor(){let u=!1,n=!1;intersectingHandles.forEach(C=>{const{direction:I}=C;I==="horizontal"?u=!0:n=!0});let d=0;panelConstraintFlags.forEach(C=>{d|=C}),u&&n?setGlobalCursorStyle("intersection",d):u?setGlobalCursorStyle("horizontal",d):n?setGlobalCursorStyle("vertical",d):resetGlobalCursorStyle()}function updateListeners(){ownerDocumentCounts.forEach((u,n)=>{const{body:d}=n;d.removeEventListener("contextmenu",handlePointerUp),d.removeEventListener("pointerdown",handlePointerDown),d.removeEventListener("pointerleave",handlePointerMove),d.removeEventListener("pointermove",handlePointerMove)}),window.removeEventListener("pointerup",handlePointerUp),window.removeEventListener("pointercancel",handlePointerUp),registeredResizeHandlers.size>0&&(isPointerDown?(intersectingHandles.length>0&&ownerDocumentCounts.forEach((u,n)=>{const{body:d}=n;u>0&&(d.addEventListener("contextmenu",handlePointerUp),d.addEventListener("pointerleave",handlePointerMove),d.addEventListener("pointermove",handlePointerMove))}),window.addEventListener("pointerup",handlePointerUp),window.addEventListener("pointercancel",handlePointerUp)):ownerDocumentCounts.forEach((u,n)=>{const{body:d}=n;u>0&&(d.addEventListener("pointerdown",handlePointerDown,{capture:!0}),d.addEventListener("pointermove",handlePointerMove))}))}function updateResizeHandlerStates(u,n){registeredResizeHandlers.forEach(d=>{const{setResizeHandlerState:C}=d,I=intersectingHandles.includes(d);C(u,I,n)})}function useForceUpdate(){const[u,n]=useState(0);return useCallback(()=>n(d=>d+1),[])}function assert(u,n){if(!u)throw console.error(n),Error(n)}const PRECISION=10;function fuzzyCompareNumbers(u,n,d=PRECISION){return u.toFixed(d)===n.toFixed(d)?0:u>n?1:-1}function fuzzyNumbersEqual$1(u,n,d=PRECISION){return fuzzyCompareNumbers(u,n,d)===0}function fuzzyNumbersEqual(u,n,d){return fuzzyCompareNumbers(u,n,d)===0}function fuzzyLayoutsEqual(u,n,d){if(u.length!==n.length)return!1;for(let C=0;C<u.length;C++){const I=u[C],f=n[C];if(!fuzzyNumbersEqual(I,f,d))return!1}return!0}function resizePanel({panelConstraints:u,panelIndex:n,size:d}){const C=u[n];assert(C!=null,`Panel constraints not found for index ${n}`);let{collapsedSize:I=0,collapsible:f,maxSize:y=100,minSize:B=0}=C;if(fuzzyCompareNumbers(d,B)<0)if(f){const _=(I+B)/2;fuzzyCompareNumbers(d,_)<0?d=I:d=B}else d=B;return d=Math.min(y,d),d=parseFloat(d.toFixed(PRECISION)),d}function adjustLayoutByDelta({delta:u,initialLayout:n,panelConstraints:d,pivotIndices:C,prevLayout:I,trigger:f}){if(fuzzyNumbersEqual(u,0))return n;const y=[...n],[B,_]=C;assert(B!=null,"Invalid first pivot index"),assert(_!=null,"Invalid second pivot index");let Z=0;if(f==="keyboard"){{const V=u<0?_:B,T=d[V];assert(T,`Panel constraints not found for index ${V}`);const{collapsedSize:H=0,collapsible:F,minSize:O=0}=T;if(F){const $=n[V];if(assert($!=null,`Previous layout not found for panel index ${V}`),fuzzyNumbersEqual($,H)){const U=O-$;fuzzyCompareNumbers(U,Math.abs(u))>0&&(u=u<0?0-U:U)}}}{const V=u<0?B:_,T=d[V];assert(T,`No panel constraints found for index ${V}`);const{collapsedSize:H=0,collapsible:F,minSize:O=0}=T;if(F){const $=n[V];if(assert($!=null,`Previous layout not found for panel index ${V}`),fuzzyNumbersEqual($,O)){const U=$-H;fuzzyCompareNumbers(U,Math.abs(u))>0&&(u=u<0?0-U:U)}}}}{const V=u<0?1:-1;let T=u<0?_:B,H=0;for(;;){const O=n[T];assert(O!=null,`Previous layout not found for panel index ${T}`);const U=resizePanel({panelConstraints:d,panelIndex:T,size:100})-O;if(H+=U,T+=V,T<0||T>=d.length)break}const F=Math.min(Math.abs(u),Math.abs(H));u=u<0?0-F:F}{let T=u<0?B:_;for(;T>=0&&T<d.length;){const H=Math.abs(u)-Math.abs(Z),F=n[T];assert(F!=null,`Previous layout not found for panel index ${T}`);const O=F-H,$=resizePanel({panelConstraints:d,panelIndex:T,size:O});if(!fuzzyNumbersEqual(F,$)&&(Z+=F-$,y[T]=$,Z.toPrecision(3).localeCompare(Math.abs(u).toPrecision(3),void 0,{numeric:!0})>=0))break;u<0?T--:T++}}if(fuzzyLayoutsEqual(I,y))return I;{const V=u<0?_:B,T=n[V];assert(T!=null,`Previous layout not found for panel index ${V}`);const H=T+Z,F=resizePanel({panelConstraints:d,panelIndex:V,size:H});if(y[V]=F,!fuzzyNumbersEqual(F,H)){let O=H-F,U=u<0?_:B;for(;U>=0&&U<d.length;){const ee=y[U];assert(ee!=null,`Previous layout not found for panel index ${U}`);const Q=ee+O,ie=resizePanel({panelConstraints:d,panelIndex:U,size:Q});if(fuzzyNumbersEqual(ee,ie)||(O-=ie-ee,y[U]=ie),fuzzyNumbersEqual(O,0))break;u>0?U--:U++}}}const M=y.reduce((V,T)=>T+V,0);return fuzzyNumbersEqual(M,100)?y:I}function calculateAriaValues({layout:u,panelsArray:n,pivotIndices:d}){let C=0,I=100,f=0,y=0;const B=d[0];assert(B!=null,"No pivot index found"),n.forEach((V,T)=>{const{constraints:H}=V,{maxSize:F=100,minSize:O=0}=H;T===B?(C=O,I=F):(f+=O,y+=F)});const _=Math.min(I,100-f),Z=Math.max(C,100-y),M=u[B];return{valueMax:_,valueMin:Z,valueNow:M}}function getResizeHandleElementsForGroup(u,n=document){return Array.from(n.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${u}"]`))}function getResizeHandleElementIndex(u,n,d=document){const I=getResizeHandleElementsForGroup(u,d).findIndex(f=>f.getAttribute("data-panel-resize-handle-id")===n);return I??null}function determinePivotIndices(u,n,d){const C=getResizeHandleElementIndex(u,n,d);return C!=null?[C,C+1]:[-1,-1]}function getPanelGroupElement(u,n=document){var d;if(n instanceof HTMLElement&&(n==null||(d=n.dataset)===null||d===void 0?void 0:d.panelGroupId)==u)return n;const C=n.querySelector(`[data-panel-group][data-panel-group-id="${u}"]`);return C||null}function getResizeHandleElement(u,n=document){const d=n.querySelector(`[data-panel-resize-handle-id="${u}"]`);return d||null}function getResizeHandlePanelIds(u,n,d,C=document){var I,f,y,B;const _=getResizeHandleElement(n,C),Z=getResizeHandleElementsForGroup(u,C),M=_?Z.indexOf(_):-1,V=(I=(f=d[M])===null||f===void 0?void 0:f.id)!==null&&I!==void 0?I:null,T=(y=(B=d[M+1])===null||B===void 0?void 0:B.id)!==null&&y!==void 0?y:null;return[V,T]}function useWindowSplitterPanelGroupBehavior({committedValuesRef:u,eagerValuesRef:n,groupId:d,layout:C,panelDataArray:I,panelGroupElement:f,setLayout:y}){useRef({didWarnAboutMissingResizeHandle:!1}),useIsomorphicLayoutEffect$1(()=>{if(!f)return;const B=getResizeHandleElementsForGroup(d,f);for(let _=0;_<I.length-1;_++){const{valueMax:Z,valueMin:M,valueNow:V}=calculateAriaValues({layout:C,panelsArray:I,pivotIndices:[_,_+1]}),T=B[_];if(T!=null){const H=I[_];assert(H,`No panel data found for index "${_}"`),T.setAttribute("aria-controls",H.id),T.setAttribute("aria-valuemax",""+Math.round(Z)),T.setAttribute("aria-valuemin",""+Math.round(M)),T.setAttribute("aria-valuenow",V!=null?""+Math.round(V):"")}}return()=>{B.forEach((_,Z)=>{_.removeAttribute("aria-controls"),_.removeAttribute("aria-valuemax"),_.removeAttribute("aria-valuemin"),_.removeAttribute("aria-valuenow")})}},[d,C,I,f]),useEffect(()=>{if(!f)return;const B=n.current;assert(B,"Eager values not found");const{panelDataArray:_}=B,Z=getPanelGroupElement(d,f);assert(Z!=null,`No group found for id "${d}"`);const M=getResizeHandleElementsForGroup(d,f);assert(M,`No resize handles found for group id "${d}"`);const V=M.map(T=>{const H=T.getAttribute("data-panel-resize-handle-id");assert(H,"Resize handle element has no handle id attribute");const[F,O]=getResizeHandlePanelIds(d,H,_,f);if(F==null||O==null)return()=>{};const $=U=>{if(!U.defaultPrevented)switch(U.key){case"Enter":{U.preventDefault();const ee=_.findIndex(Q=>Q.id===F);if(ee>=0){const Q=_[ee];assert(Q,`No panel data found for index ${ee}`);const ie=C[ee],{collapsedSize:ne=0,collapsible:le,minSize:ae=0}=Q.constraints;if(ie!=null&&le){const ce=adjustLayoutByDelta({delta:fuzzyNumbersEqual(ie,ne)?ae-ne:ne-ie,initialLayout:C,panelConstraints:_.map(ge=>ge.constraints),pivotIndices:determinePivotIndices(d,H,f),prevLayout:C,trigger:"keyboard"});C!==ce&&y(ce)}}break}}};return T.addEventListener("keydown",$),()=>{T.removeEventListener("keydown",$)}});return()=>{V.forEach(T=>T())}},[f,u,n,d,C,I,y])}function areEqual(u,n){if(u.length!==n.length)return!1;for(let d=0;d<u.length;d++)if(u[d]!==n[d])return!1;return!0}function getResizeEventCursorPosition(u,n){const d=u==="horizontal",{x:C,y:I}=getResizeEventCoordinates(n);return d?C:I}function calculateDragOffsetPercentage(u,n,d,C,I){const f=d==="horizontal",y=getResizeHandleElement(n,I);assert(y,`No resize handle element found for id "${n}"`);const B=y.getAttribute("data-panel-group-id");assert(B,"Resize handle element has no group id attribute");let{initialCursorPosition:_}=C;const Z=getResizeEventCursorPosition(d,u),M=getPanelGroupElement(B,I);assert(M,`No group element found for id "${B}"`);const V=M.getBoundingClientRect(),T=f?V.width:V.height;return(Z-_)/T*100}function calculateDeltaPercentage(u,n,d,C,I,f){if(isKeyDown(u)){const y=d==="horizontal";let B=0;u.shiftKey?B=100:I!=null?B=I:B=10;let _=0;switch(u.key){case"ArrowDown":_=y?0:B;break;case"ArrowLeft":_=y?-B:0;break;case"ArrowRight":_=y?B:0;break;case"ArrowUp":_=y?0:-B;break;case"End":_=100;break;case"Home":_=-100;break}return _}else return C==null?0:calculateDragOffsetPercentage(u,n,d,C,f)}function calculateUnsafeDefaultLayout({panelDataArray:u}){const n=Array(u.length),d=u.map(f=>f.constraints);let C=0,I=100;for(let f=0;f<u.length;f++){const y=d[f];assert(y,`Panel constraints not found for index ${f}`);const{defaultSize:B}=y;B!=null&&(C++,n[f]=B,I-=B)}for(let f=0;f<u.length;f++){const y=d[f];assert(y,`Panel constraints not found for index ${f}`);const{defaultSize:B}=y;if(B!=null)continue;const _=u.length-C,Z=I/_;C++,n[f]=Z,I-=Z}return n}function callPanelCallbacks(u,n,d){n.forEach((C,I)=>{const f=u[I];assert(f,`Panel data not found for index ${I}`);const{callbacks:y,constraints:B,id:_}=f,{collapsedSize:Z=0,collapsible:M}=B,V=d[_];if(V==null||C!==V){d[_]=C;const{onCollapse:T,onExpand:H,onResize:F}=y;F&&F(C,V),M&&(T||H)&&(H&&(V==null||fuzzyNumbersEqual$1(V,Z))&&!fuzzyNumbersEqual$1(C,Z)&&H(),T&&(V==null||!fuzzyNumbersEqual$1(V,Z))&&fuzzyNumbersEqual$1(C,Z)&&T())}})}function compareLayouts(u,n){if(u.length!==n.length)return!1;for(let d=0;d<u.length;d++)if(u[d]!=n[d])return!1;return!0}function computePanelFlexBoxStyle({defaultSize:u,dragState:n,layout:d,panelData:C,panelIndex:I,precision:f=3}){const y=d[I];let B;return y==null?B=u!=null?u.toPrecision(f):"1":C.length===1?B="1":B=y.toPrecision(f),{flexBasis:0,flexGrow:B,flexShrink:1,overflow:"hidden",pointerEvents:n!==null?"none":void 0}}function debounce(u,n=10){let d=null;return(...I)=>{d!==null&&clearTimeout(d),d=setTimeout(()=>{u(...I)},n)}}function initializeDefaultStorage(u){try{if(typeof localStorage<"u")u.getItem=n=>localStorage.getItem(n),u.setItem=(n,d)=>{localStorage.setItem(n,d)};else throw new Error("localStorage not supported in this environment")}catch(n){console.error(n),u.getItem=()=>null,u.setItem=()=>{}}}function getPanelGroupKey(u){return`react-resizable-panels:${u}`}function getPanelKey(u){return u.map(n=>{const{constraints:d,id:C,idIsFromProps:I,order:f}=n;return I?C:f?`${f}:${JSON.stringify(d)}`:JSON.stringify(d)}).sort((n,d)=>n.localeCompare(d)).join(",")}function loadSerializedPanelGroupState(u,n){try{const d=getPanelGroupKey(u),C=n.getItem(d);if(C){const I=JSON.parse(C);if(typeof I=="object"&&I!=null)return I}}catch{}return null}function loadPanelGroupState(u,n,d){var C,I;const f=(C=loadSerializedPanelGroupState(u,d))!==null&&C!==void 0?C:{},y=getPanelKey(n);return(I=f[y])!==null&&I!==void 0?I:null}function savePanelGroupState(u,n,d,C,I){var f;const y=getPanelGroupKey(u),B=getPanelKey(n),_=(f=loadSerializedPanelGroupState(u,I))!==null&&f!==void 0?f:{};_[B]={expandToSizes:Object.fromEntries(d.entries()),layout:C};try{I.setItem(y,JSON.stringify(_))}catch(Z){console.error(Z)}}function validatePanelGroupLayout({layout:u,panelConstraints:n}){const d=[...u],C=d.reduce((f,y)=>f+y,0);if(d.length!==n.length)throw Error(`Invalid ${n.length} panel layout: ${d.map(f=>`${f}%`).join(", ")}`);if(!fuzzyNumbersEqual(C,100)&&d.length>0)for(let f=0;f<n.length;f++){const y=d[f];assert(y!=null,`No layout data found for index ${f}`);const B=100/C*y;d[f]=B}let I=0;for(let f=0;f<n.length;f++){const y=d[f];assert(y!=null,`No layout data found for index ${f}`);const B=resizePanel({panelConstraints:n,panelIndex:f,size:y});y!=B&&(I+=y-B,d[f]=B)}if(!fuzzyNumbersEqual(I,0))for(let f=0;f<n.length;f++){const y=d[f];assert(y!=null,`No layout data found for index ${f}`);const B=y+I,_=resizePanel({panelConstraints:n,panelIndex:f,size:B});if(y!==_&&(I-=_-y,d[f]=_,fuzzyNumbersEqual(I,0)))break}return d}const LOCAL_STORAGE_DEBOUNCE_INTERVAL=100,defaultStorage={getItem:u=>(initializeDefaultStorage(defaultStorage),defaultStorage.getItem(u)),setItem:(u,n)=>{initializeDefaultStorage(defaultStorage),defaultStorage.setItem(u,n)}},debounceMap={};function PanelGroupWithForwardedRef({autoSaveId:u=null,children:n,className:d="",direction:C,forwardedRef:I,id:f=null,onLayout:y=null,keyboardResizeBy:B=null,storage:_=defaultStorage,style:Z,tagName:M="div",...V}){const T=useUniqueId(f),H=useRef(null),[F,O]=useState(null),[$,U]=useState([]),ee=useForceUpdate(),Q=useRef({}),ie=useRef(new Map),ne=useRef(0),le=useRef({autoSaveId:u,direction:C,dragState:F,id:T,keyboardResizeBy:B,onLayout:y,storage:_}),ae=useRef({layout:$,panelDataArray:[],panelDataArrayChanged:!1});useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),useImperativeHandle(I,()=>({getId:()=>le.current.id,getLayout:()=>{const{layout:Ae}=ae.current;return Ae},setLayout:Ae=>{const{onLayout:Re}=le.current,{layout:We,panelDataArray:De}=ae.current,Fe=validatePanelGroupLayout({layout:Ae,panelConstraints:De.map(Ke=>Ke.constraints)});areEqual(We,Fe)||(U(Fe),ae.current.layout=Fe,Re&&Re(Fe),callPanelCallbacks(De,Fe,Q.current))}}),[]),useIsomorphicLayoutEffect$1(()=>{le.current.autoSaveId=u,le.current.direction=C,le.current.dragState=F,le.current.id=T,le.current.onLayout=y,le.current.storage=_}),useWindowSplitterPanelGroupBehavior({committedValuesRef:le,eagerValuesRef:ae,groupId:T,layout:$,panelDataArray:ae.current.panelDataArray,setLayout:U,panelGroupElement:H.current}),useEffect(()=>{const{panelDataArray:Ae}=ae.current;if(u){if($.length===0||$.length!==Ae.length)return;let Re=debounceMap[u];Re==null&&(Re=debounce(savePanelGroupState,LOCAL_STORAGE_DEBOUNCE_INTERVAL),debounceMap[u]=Re);const We=[...Ae],De=new Map(ie.current);Re(u,We,De,$,_)}},[u,$,_]),useEffect(()=>{});const ce=useCallback(Ae=>{const{onLayout:Re}=le.current,{layout:We,panelDataArray:De}=ae.current;if(Ae.constraints.collapsible){const Fe=De.map(Ut=>Ut.constraints),{collapsedSize:Ke=0,panelSize:Rt,pivotIndices:dt}=panelDataHelper(De,Ae,We);if(assert(Rt!=null,`Panel size not found for panel "${Ae.id}"`),!fuzzyNumbersEqual$1(Rt,Ke)){ie.current.set(Ae.id,Rt);const rt=findPanelDataIndex(De,Ae)===De.length-1?Rt-Ke:Ke-Rt,nt=adjustLayoutByDelta({delta:rt,initialLayout:We,panelConstraints:Fe,pivotIndices:dt,prevLayout:We,trigger:"imperative-api"});compareLayouts(We,nt)||(U(nt),ae.current.layout=nt,Re&&Re(nt),callPanelCallbacks(De,nt,Q.current))}}},[]),ge=useCallback((Ae,Re)=>{const{onLayout:We}=le.current,{layout:De,panelDataArray:Fe}=ae.current;if(Ae.constraints.collapsible){const Ke=Fe.map(we=>we.constraints),{collapsedSize:Rt=0,panelSize:dt=0,minSize:Ut=0,pivotIndices:rt}=panelDataHelper(Fe,Ae,De),nt=Re??Ut;if(fuzzyNumbersEqual$1(dt,Rt)){const we=ie.current.get(Ae.id),Jt=we!=null&&we>=nt?we:nt,Ht=findPanelDataIndex(Fe,Ae)===Fe.length-1?dt-Jt:Jt-dt,mt=adjustLayoutByDelta({delta:Ht,initialLayout:De,panelConstraints:Ke,pivotIndices:rt,prevLayout:De,trigger:"imperative-api"});compareLayouts(De,mt)||(U(mt),ae.current.layout=mt,We&&We(mt),callPanelCallbacks(Fe,mt,Q.current))}}},[]),he=useCallback(Ae=>{const{layout:Re,panelDataArray:We}=ae.current,{panelSize:De}=panelDataHelper(We,Ae,Re);return assert(De!=null,`Panel size not found for panel "${Ae.id}"`),De},[]),Ie=useCallback((Ae,Re)=>{const{panelDataArray:We}=ae.current,De=findPanelDataIndex(We,Ae);return computePanelFlexBoxStyle({defaultSize:Re,dragState:F,layout:$,panelData:We,panelIndex:De})},[F,$]),fe=useCallback(Ae=>{const{layout:Re,panelDataArray:We}=ae.current,{collapsedSize:De=0,collapsible:Fe,panelSize:Ke}=panelDataHelper(We,Ae,Re);return assert(Ke!=null,`Panel size not found for panel "${Ae.id}"`),Fe===!0&&fuzzyNumbersEqual$1(Ke,De)},[]),me=useCallback(Ae=>{const{layout:Re,panelDataArray:We}=ae.current,{collapsedSize:De=0,collapsible:Fe,panelSize:Ke}=panelDataHelper(We,Ae,Re);return assert(Ke!=null,`Panel size not found for panel "${Ae.id}"`),!Fe||fuzzyCompareNumbers(Ke,De)>0},[]),Ge=useCallback(Ae=>{const{panelDataArray:Re}=ae.current;Re.push(Ae),Re.sort((We,De)=>{const Fe=We.order,Ke=De.order;return Fe==null&&Ke==null?0:Fe==null?-1:Ke==null?1:Fe-Ke}),ae.current.panelDataArrayChanged=!0,ee()},[ee]);useIsomorphicLayoutEffect$1(()=>{if(ae.current.panelDataArrayChanged){ae.current.panelDataArrayChanged=!1;const{autoSaveId:Ae,onLayout:Re,storage:We}=le.current,{layout:De,panelDataArray:Fe}=ae.current;let Ke=null;if(Ae){const dt=loadPanelGroupState(Ae,Fe,We);dt&&(ie.current=new Map(Object.entries(dt.expandToSizes)),Ke=dt.layout)}Ke==null&&(Ke=calculateUnsafeDefaultLayout({panelDataArray:Fe}));const Rt=validatePanelGroupLayout({layout:Ke,panelConstraints:Fe.map(dt=>dt.constraints)});areEqual(De,Rt)||(U(Rt),ae.current.layout=Rt,Re&&Re(Rt),callPanelCallbacks(Fe,Rt,Q.current))}}),useIsomorphicLayoutEffect$1(()=>{const Ae=ae.current;return()=>{Ae.layout=[]}},[]);const Ze=useCallback(Ae=>{let Re=!1;const We=H.current;return We&&window.getComputedStyle(We,null).getPropertyValue("direction")==="rtl"&&(Re=!0),function(Fe){Fe.preventDefault();const Ke=H.current;if(!Ke)return()=>null;const{direction:Rt,dragState:dt,id:Ut,keyboardResizeBy:rt,onLayout:nt}=le.current,{layout:we,panelDataArray:Jt}=ae.current,{initialLayout:It}=dt??{},Ht=determinePivotIndices(Ut,Ae,Ke);let mt=calculateDeltaPercentage(Fe,Ae,Rt,dt,rt,Ke);const ni=Rt==="horizontal";ni&&Re&&(mt=-mt);const kt=Jt.map(et=>et.constraints),Me=adjustLayoutByDelta({delta:mt,initialLayout:It??we,panelConstraints:kt,pivotIndices:Ht,prevLayout:we,trigger:isKeyDown(Fe)?"keyboard":"mouse-or-touch"}),ve=!compareLayouts(we,Me);(isPointerEvent(Fe)||isMouseEvent$1(Fe))&&ne.current!=mt&&(ne.current=mt,!ve&&mt!==0?ni?reportConstraintsViolation(Ae,mt<0?EXCEEDED_HORIZONTAL_MIN:EXCEEDED_HORIZONTAL_MAX):reportConstraintsViolation(Ae,mt<0?EXCEEDED_VERTICAL_MIN:EXCEEDED_VERTICAL_MAX):reportConstraintsViolation(Ae,0)),ve&&(U(Me),ae.current.layout=Me,nt&&nt(Me),callPanelCallbacks(Jt,Me,Q.current))}},[]),ye=useCallback((Ae,Re)=>{const{onLayout:We}=le.current,{layout:De,panelDataArray:Fe}=ae.current,Ke=Fe.map(we=>we.constraints),{panelSize:Rt,pivotIndices:dt}=panelDataHelper(Fe,Ae,De);assert(Rt!=null,`Panel size not found for panel "${Ae.id}"`);const rt=findPanelDataIndex(Fe,Ae)===Fe.length-1?Rt-Re:Re-Rt,nt=adjustLayoutByDelta({delta:rt,initialLayout:De,panelConstraints:Ke,pivotIndices:dt,prevLayout:De,trigger:"imperative-api"});compareLayouts(De,nt)||(U(nt),ae.current.layout=nt,We&&We(nt),callPanelCallbacks(Fe,nt,Q.current))},[]),Ee=useCallback((Ae,Re)=>{const{layout:We,panelDataArray:De}=ae.current,{collapsedSize:Fe=0,collapsible:Ke}=Re,{collapsedSize:Rt=0,collapsible:dt,maxSize:Ut=100,minSize:rt=0}=Ae.constraints,{panelSize:nt}=panelDataHelper(De,Ae,We);nt!=null&&(Ke&&dt&&fuzzyNumbersEqual$1(nt,Fe)?fuzzyNumbersEqual$1(Fe,Rt)||ye(Ae,Rt):nt<rt?ye(Ae,rt):nt>Ut&&ye(Ae,Ut))},[ye]),Ve=useCallback((Ae,Re)=>{const{direction:We}=le.current,{layout:De}=ae.current;if(!H.current)return;const Fe=getResizeHandleElement(Ae,H.current);assert(Fe,`Drag handle element not found for id "${Ae}"`);const Ke=getResizeEventCursorPosition(We,Re);O({dragHandleId:Ae,dragHandleRect:Fe.getBoundingClientRect(),initialCursorPosition:Ke,initialLayout:De})},[]),Ye=useCallback(()=>{O(null)},[]),be=useCallback(Ae=>{const{panelDataArray:Re}=ae.current,We=findPanelDataIndex(Re,Ae);We>=0&&(Re.splice(We,1),delete Q.current[Ae.id],ae.current.panelDataArrayChanged=!0,ee())},[ee]),Be=useMemo(()=>({collapsePanel:ce,direction:C,dragState:F,expandPanel:ge,getPanelSize:he,getPanelStyle:Ie,groupId:T,isPanelCollapsed:fe,isPanelExpanded:me,reevaluatePanelConstraints:Ee,registerPanel:Ge,registerResizeHandle:Ze,resizePanel:ye,startDragging:Ve,stopDragging:Ye,unregisterPanel:be,panelGroupElement:H.current}),[ce,F,C,ge,he,Ie,T,fe,me,Ee,Ge,Ze,ye,Ve,Ye,be]),Ne={display:"flex",flexDirection:C==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return createElement$1(PanelGroupContext.Provider,{value:Be},createElement$1(M,{...V,children:n,className:d,id:f,ref:H,style:{...Ne,...Z},"data-panel-group":"","data-panel-group-direction":C,"data-panel-group-id":T}))}const PanelGroup=forwardRef((u,n)=>createElement$1(PanelGroupWithForwardedRef,{...u,forwardedRef:n}));PanelGroupWithForwardedRef.displayName="PanelGroup";PanelGroup.displayName="forwardRef(PanelGroup)";function findPanelDataIndex(u,n){return u.findIndex(d=>d===n||d.id===n.id)}function panelDataHelper(u,n,d){const C=findPanelDataIndex(u,n),f=C===u.length-1?[C-1,C]:[C,C+1],y=d[C];return{...n.constraints,panelSize:y,pivotIndices:f}}function useWindowSplitterResizeHandlerBehavior({disabled:u,handleId:n,resizeHandler:d,panelGroupElement:C}){useEffect(()=>{if(u||d==null||C==null)return;const I=getResizeHandleElement(n,C);if(I==null)return;const f=y=>{if(!y.defaultPrevented)switch(y.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{y.preventDefault(),d(y);break}case"F6":{y.preventDefault();const B=I.getAttribute("data-panel-group-id");assert(B,`No group element found for id "${B}"`);const _=getResizeHandleElementsForGroup(B,C),Z=getResizeHandleElementIndex(B,n,C);assert(Z!==null,`No resize element found for id "${n}"`);const M=y.shiftKey?Z>0?Z-1:_.length-1:Z+1<_.length?Z+1:0;_[M].focus();break}}};return I.addEventListener("keydown",f),()=>{I.removeEventListener("keydown",f)}},[C,u,n,d])}function PanelResizeHandle({children:u=null,className:n="",disabled:d=!1,hitAreaMargins:C,id:I,onBlur:f,onDragging:y,onFocus:B,style:_={},tabIndex:Z=0,tagName:M="div",...V}){var T,H;const F=useRef(null),O=useRef({onDragging:y});useEffect(()=>{O.current.onDragging=y});const $=useContext(PanelGroupContext);if($===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:U,groupId:ee,registerResizeHandle:Q,startDragging:ie,stopDragging:ne,panelGroupElement:le}=$,ae=useUniqueId(I),[ce,ge]=useState("inactive"),[he,Ie]=useState(!1),[fe,me]=useState(null),Ge=useRef({state:ce});useIsomorphicLayoutEffect$1(()=>{Ge.current.state=ce}),useEffect(()=>{if(d)me(null);else{const Ve=Q(ae);me(()=>Ve)}},[d,ae,Q]);const Ze=(T=C==null?void 0:C.coarse)!==null&&T!==void 0?T:15,ye=(H=C==null?void 0:C.fine)!==null&&H!==void 0?H:5;return useEffect(()=>{if(d||fe==null)return;const Ve=F.current;return assert(Ve,"Element ref not attached"),registerResizeHandle(ae,Ve,U,{coarse:Ze,fine:ye},(be,Be,Ne)=>{if(Be)switch(be){case"down":{ge("drag"),assert(Ne,'Expected event to be defined for "down" action'),ie(ae,Ne);const{onDragging:Ae}=O.current;Ae&&Ae(!0);break}case"move":{const{state:Ae}=Ge.current;Ae!=="drag"&&ge("hover"),assert(Ne,'Expected event to be defined for "move" action'),fe(Ne);break}case"up":{ge("hover"),ne();const{onDragging:Ae}=O.current;Ae&&Ae(!1);break}}else ge("inactive")})},[Ze,U,d,ye,Q,ae,fe,ie,ne]),useWindowSplitterResizeHandlerBehavior({disabled:d,handleId:ae,resizeHandler:fe,panelGroupElement:le}),createElement$1(M,{...V,children:u,className:n,id:I,onBlur:()=>{Ie(!1),f==null||f()},onFocus:()=>{Ie(!0),B==null||B()},ref:F,role:"separator",style:{...{touchAction:"none",userSelect:"none"},..._},tabIndex:Z,"data-panel-group-direction":U,"data-panel-group-id":ee,"data-resize-handle":"","data-resize-handle-active":ce==="drag"?"pointer":he?"keyboard":void 0,"data-resize-handle-state":ce,"data-panel-resize-handle-enabled":!d,"data-panel-resize-handle-id":ae})}PanelResizeHandle.displayName="PanelResizeHandle";/*!
 * Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2024 Fonticons, Inc.
 */function _defineProperty$1(u,n,d){return(n=_toPropertyKey(n))in u?Object.defineProperty(u,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[n]=d,u}function ownKeys$1(u,n){var d=Object.keys(u);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(u);n&&(C=C.filter(function(I){return Object.getOwnPropertyDescriptor(u,I).enumerable})),d.push.apply(d,C)}return d}function _objectSpread2$1(u){for(var n=1;n<arguments.length;n++){var d=arguments[n]!=null?arguments[n]:{};n%2?ownKeys$1(Object(d),!0).forEach(function(C){_defineProperty$1(u,C,d[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(d)):ownKeys$1(Object(d)).forEach(function(C){Object.defineProperty(u,C,Object.getOwnPropertyDescriptor(d,C))})}return u}function _toPrimitive(u,n){if(typeof u!="object"||!u)return u;var d=u[Symbol.toPrimitive];if(d!==void 0){var C=d.call(u,n);if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(u)}function _toPropertyKey(u){var n=_toPrimitive(u,"string");return typeof n=="symbol"?n:n+""}const noop=()=>{};let _WINDOW={},_DOCUMENT={},_MUTATION_OBSERVER=null,_PERFORMANCE={mark:noop,measure:noop};try{typeof window<"u"&&(_WINDOW=window),typeof document<"u"&&(_DOCUMENT=document),typeof MutationObserver<"u"&&(_MUTATION_OBSERVER=MutationObserver),typeof performance<"u"&&(_PERFORMANCE=performance)}catch{}const{userAgent=""}=_WINDOW.navigator||{},WINDOW=_WINDOW,DOCUMENT=_DOCUMENT,MUTATION_OBSERVER=_MUTATION_OBSERVER,PERFORMANCE=_PERFORMANCE;WINDOW.document;const IS_DOM=!!DOCUMENT.documentElement&&!!DOCUMENT.head&&typeof DOCUMENT.addEventListener=="function"&&typeof DOCUMENT.createElement=="function",IS_IE=~userAgent.indexOf("MSIE")||~userAgent.indexOf("Trident/");var p$1=/fa(s|r|l|t|d|dr|dl|dt|b|k|kd|ss|sr|sl|st|sds|sdr|sdl|sdt)?[\-\ ]/,g$1=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,S={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fab:"brands","fa-brands":"brands"},duotone:{fa:"solid",fad:"solid","fa-solid":"solid","fa-duotone":"solid",fadr:"regular","fa-regular":"regular",fadl:"light","fa-light":"light",fadt:"thin","fa-thin":"thin"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid",fasdr:"regular","fa-regular":"regular",fasdl:"light","fa-light":"light",fasdt:"thin","fa-thin":"thin"}},A={GROUP:"duotone-group",PRIMARY:"primary",SECONDARY:"secondary"},P=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone"],s$1="classic",t="duotone",r$1="sharp",o="sharp-duotone",L=[s$1,t,r$1,o],G={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},duotone:{900:"fad",400:"fadr",300:"fadl",100:"fadt"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds",400:"fasdr",300:"fasdl",100:"fasdt"}},lt={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad",400:"fadr",normal:"fadr",300:"fadl",100:"fadt"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds",400:"fasdr",normal:"fasdr",300:"fasdl",100:"fasdt"}},pt=new Map([["classic",{defaultShortPrefixId:"fas",defaultStyleId:"solid",styleIds:["solid","regular","light","thin","brands"],futureStyleIds:[],defaultFontWeight:900}],["sharp",{defaultShortPrefixId:"fass",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["duotone",{defaultShortPrefixId:"fad",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp-duotone",{defaultShortPrefixId:"fasds",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}]]),xt={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",brands:"fab"},duotone:{solid:"fad",regular:"fadr",light:"fadl",thin:"fadt"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds",regular:"fasdr",light:"fasdl",thin:"fasdt"}},Ft=["fak","fa-kit","fakd","fa-kit-duotone"],St={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},At=["kit"],Ct={kit:{"fa-kit":"fak"}},Lt=["fak","fakd"],Wt={kit:{fak:"fa-kit"}},Et={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}},t$1={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},r$1$1=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone"],bt$1=["fak","fa-kit","fakd","fa-kit-duotone"],Yt={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},ua={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},duotone:{"fa-regular":"fadr","fa-light":"fadl","fa-thin":"fadt"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds","fa-regular":"fasdr","fa-light":"fasdl","fa-thin":"fasdt"}},I$1={classic:["fas","far","fal","fat","fad"],duotone:["fadr","fadl","fadt"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds","fasdr","fasdl","fasdt"]},ga={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},duotone:{fadr:"fa-regular",fadl:"fa-light",fadt:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid",fasdr:"fa-regular",fasdl:"fa-light",fasdt:"fa-thin"}},x$1=["fa-solid","fa-regular","fa-light","fa-thin","fa-duotone","fa-brands"],Ia=["fa","fas","far","fal","fat","fad","fadr","fadl","fadt","fab","fass","fasr","fasl","fast","fasds","fasdr","fasdl","fasdt",...r$1$1,...x$1],m$1$1=["solid","regular","light","thin","duotone","brands"],c$1$1=[1,2,3,4,5,6,7,8,9,10],F$1=c$1$1.concat([11,12,13,14,15,16,17,18,19,20]),ma=[...Object.keys(I$1),...m$1$1,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",t$1.GROUP,t$1.SWAP_OPACITY,t$1.PRIMARY,t$1.SECONDARY].concat(c$1$1.map(u=>"".concat(u,"x"))).concat(F$1.map(u=>"w-".concat(u))),wa={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}};const NAMESPACE_IDENTIFIER="___FONT_AWESOME___",UNITS_IN_GRID=16,DEFAULT_CSS_PREFIX="fa",DEFAULT_REPLACEMENT_CLASS="svg-inline--fa",DATA_FA_I2SVG="data-fa-i2svg",DATA_FA_PSEUDO_ELEMENT="data-fa-pseudo-element",DATA_FA_PSEUDO_ELEMENT_PENDING="data-fa-pseudo-element-pending",DATA_PREFIX="data-prefix",DATA_ICON="data-icon",HTML_CLASS_I2SVG_BASE_CLASS="fontawesome-i2svg",MUTATION_APPROACH_ASYNC="async",TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS=["HTML","HEAD","STYLE","SCRIPT"],PRODUCTION$1=(()=>{try{return!0}catch{return!1}})();function familyProxy(u){return new Proxy(u,{get(n,d){return d in n?n[d]:n[s$1]}})}const _PREFIX_TO_STYLE=_objectSpread2$1({},S);_PREFIX_TO_STYLE[s$1]=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},{"fa-duotone":"duotone"}),S[s$1]),St.kit),St["kit-duotone"]);const PREFIX_TO_STYLE=familyProxy(_PREFIX_TO_STYLE),_STYLE_TO_PREFIX=_objectSpread2$1({},xt);_STYLE_TO_PREFIX[s$1]=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},{duotone:"fad"}),_STYLE_TO_PREFIX[s$1]),Et.kit),Et["kit-duotone"]);const STYLE_TO_PREFIX=familyProxy(_STYLE_TO_PREFIX),_PREFIX_TO_LONG_STYLE=_objectSpread2$1({},ga);_PREFIX_TO_LONG_STYLE[s$1]=_objectSpread2$1(_objectSpread2$1({},_PREFIX_TO_LONG_STYLE[s$1]),Wt.kit);const PREFIX_TO_LONG_STYLE=familyProxy(_PREFIX_TO_LONG_STYLE),_LONG_STYLE_TO_PREFIX=_objectSpread2$1({},ua);_LONG_STYLE_TO_PREFIX[s$1]=_objectSpread2$1(_objectSpread2$1({},_LONG_STYLE_TO_PREFIX[s$1]),Ct.kit);familyProxy(_LONG_STYLE_TO_PREFIX);const ICON_SELECTION_SYNTAX_PATTERN=p$1,LAYERS_TEXT_CLASSNAME="fa-layers-text",FONT_FAMILY_PATTERN=g$1,_FONT_WEIGHT_TO_PREFIX=_objectSpread2$1({},G);familyProxy(_FONT_WEIGHT_TO_PREFIX);const ATTRIBUTES_WATCHED_FOR_MUTATION=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],DUOTONE_CLASSES=A,RESERVED_CLASSES=[...At,...ma],initial=WINDOW.FontAwesomeConfig||{};function getAttrConfig(u){var n=DOCUMENT.querySelector("script["+u+"]");if(n)return n.getAttribute(u)}function coerce(u){return u===""?!0:u==="false"?!1:u==="true"?!0:u}DOCUMENT&&typeof DOCUMENT.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(n=>{let[d,C]=n;const I=coerce(getAttrConfig(d));I!=null&&(initial[C]=I)});const _default={styleDefault:"solid",familyDefault:s$1,cssPrefix:DEFAULT_CSS_PREFIX,replacementClass:DEFAULT_REPLACEMENT_CLASS,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};initial.familyPrefix&&(initial.cssPrefix=initial.familyPrefix);const _config=_objectSpread2$1(_objectSpread2$1({},_default),initial);_config.autoReplaceSvg||(_config.observeMutations=!1);const config={};Object.keys(_default).forEach(u=>{Object.defineProperty(config,u,{enumerable:!0,set:function(n){_config[u]=n,_onChangeCb.forEach(d=>d(config))},get:function(){return _config[u]}})});Object.defineProperty(config,"familyPrefix",{enumerable:!0,set:function(u){_config.cssPrefix=u,_onChangeCb.forEach(n=>n(config))},get:function(){return _config.cssPrefix}});WINDOW.FontAwesomeConfig=config;const _onChangeCb=[];function onChange(u){return _onChangeCb.push(u),()=>{_onChangeCb.splice(_onChangeCb.indexOf(u),1)}}const d$2=UNITS_IN_GRID,meaninglessTransform={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function insertCss(u){if(!u||!IS_DOM)return;const n=DOCUMENT.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=u;const d=DOCUMENT.head.childNodes;let C=null;for(let I=d.length-1;I>-1;I--){const f=d[I],y=(f.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(y)>-1&&(C=f)}return DOCUMENT.head.insertBefore(n,C),u}const idPool="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function nextUniqueId(){let u=12,n="";for(;u-- >0;)n+=idPool[Math.random()*62|0];return n}function toArray(u){const n=[];for(let d=(u||[]).length>>>0;d--;)n[d]=u[d];return n}function classArray(u){return u.classList?toArray(u.classList):(u.getAttribute("class")||"").split(" ").filter(n=>n)}function htmlEscape(u){return"".concat(u).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function joinAttributes(u){return Object.keys(u||{}).reduce((n,d)=>n+"".concat(d,'="').concat(htmlEscape(u[d]),'" '),"").trim()}function joinStyles(u){return Object.keys(u||{}).reduce((n,d)=>n+"".concat(d,": ").concat(u[d].trim(),";"),"")}function transformIsMeaningful(u){return u.size!==meaninglessTransform.size||u.x!==meaninglessTransform.x||u.y!==meaninglessTransform.y||u.rotate!==meaninglessTransform.rotate||u.flipX||u.flipY}function transformForSvg(u){let{transform:n,containerWidth:d,iconWidth:C}=u;const I={transform:"translate(".concat(d/2," 256)")},f="translate(".concat(n.x*32,", ").concat(n.y*32,") "),y="scale(".concat(n.size/16*(n.flipX?-1:1),", ").concat(n.size/16*(n.flipY?-1:1),") "),B="rotate(".concat(n.rotate," 0 0)"),_={transform:"".concat(f," ").concat(y," ").concat(B)},Z={transform:"translate(".concat(C/2*-1," -256)")};return{outer:I,inner:_,path:Z}}function transformForCss(u){let{transform:n,width:d=UNITS_IN_GRID,height:C=UNITS_IN_GRID,startCentered:I=!1}=u,f="";return I&&IS_IE?f+="translate(".concat(n.x/d$2-d/2,"em, ").concat(n.y/d$2-C/2,"em) "):I?f+="translate(calc(-50% + ".concat(n.x/d$2,"em), calc(-50% + ").concat(n.y/d$2,"em)) "):f+="translate(".concat(n.x/d$2,"em, ").concat(n.y/d$2,"em) "),f+="scale(".concat(n.size/d$2*(n.flipX?-1:1),", ").concat(n.size/d$2*(n.flipY?-1:1),") "),f+="rotate(".concat(n.rotate,"deg) "),f}var baseStyles=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-regular: normal 400 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-light: normal 300 1em/1 "Font Awesome 6 Duotone";
  --fa-font-duotone-thin: normal 100 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-regular: normal 400 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-light: normal 300 1em/1 "Font Awesome 6 Sharp Duotone";
  --fa-font-sharp-duotone-thin: normal 100 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}`;function css(){const u=DEFAULT_CSS_PREFIX,n=DEFAULT_REPLACEMENT_CLASS,d=config.cssPrefix,C=config.replacementClass;let I=baseStyles;if(d!==u||C!==n){const f=new RegExp("\\.".concat(u,"\\-"),"g"),y=new RegExp("\\--".concat(u,"\\-"),"g"),B=new RegExp("\\.".concat(n),"g");I=I.replace(f,".".concat(d,"-")).replace(y,"--".concat(d,"-")).replace(B,".".concat(C))}return I}let _cssInserted=!1;function ensureCss(){config.autoAddCss&&!_cssInserted&&(insertCss(css()),_cssInserted=!0)}var InjectCSS={mixout(){return{dom:{css,insertCss:ensureCss}}},hooks(){return{beforeDOMElementCreation(){ensureCss()},beforeI2svg(){ensureCss()}}}};const w=WINDOW||{};w[NAMESPACE_IDENTIFIER]||(w[NAMESPACE_IDENTIFIER]={});w[NAMESPACE_IDENTIFIER].styles||(w[NAMESPACE_IDENTIFIER].styles={});w[NAMESPACE_IDENTIFIER].hooks||(w[NAMESPACE_IDENTIFIER].hooks={});w[NAMESPACE_IDENTIFIER].shims||(w[NAMESPACE_IDENTIFIER].shims=[]);var namespace=w[NAMESPACE_IDENTIFIER];const functions=[],listener=function(){DOCUMENT.removeEventListener("DOMContentLoaded",listener),loaded=1,functions.map(u=>u())};let loaded=!1;IS_DOM&&(loaded=(DOCUMENT.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(DOCUMENT.readyState),loaded||DOCUMENT.addEventListener("DOMContentLoaded",listener));function domready(u){IS_DOM&&(loaded?setTimeout(u,0):functions.push(u))}function toHtml(u){const{tag:n,attributes:d={},children:C=[]}=u;return typeof u=="string"?htmlEscape(u):"<".concat(n," ").concat(joinAttributes(d),">").concat(C.map(toHtml).join(""),"</").concat(n,">")}function iconFromMapping(u,n,d){if(u&&u[n]&&u[n][d])return{prefix:n,iconName:d,icon:u[n][d]}}var reduce=function(n,d,C,I){var f=Object.keys(n),y=f.length,B=d,_,Z,M;for(C===void 0?(_=1,M=n[f[0]]):(_=0,M=C);_<y;_++)Z=f[_],M=B(M,n[Z],Z,n);return M};function ucs2decode(u){const n=[];let d=0;const C=u.length;for(;d<C;){const I=u.charCodeAt(d++);if(I>=55296&&I<=56319&&d<C){const f=u.charCodeAt(d++);(f&64512)==56320?n.push(((I&1023)<<10)+(f&1023)+65536):(n.push(I),d--)}else n.push(I)}return n}function toHex(u){const n=ucs2decode(u);return n.length===1?n[0].toString(16):null}function codePointAt(u,n){const d=u.length;let C=u.charCodeAt(n),I;return C>=55296&&C<=56319&&d>n+1&&(I=u.charCodeAt(n+1),I>=56320&&I<=57343)?(C-55296)*1024+I-56320+65536:C}function normalizeIcons(u){return Object.keys(u).reduce((n,d)=>{const C=u[d];return!!C.icon?n[C.iconName]=C.icon:n[d]=C,n},{})}function defineIcons(u,n){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:C=!1}=d,I=normalizeIcons(n);typeof namespace.hooks.addPack=="function"&&!C?namespace.hooks.addPack(u,normalizeIcons(n)):namespace.styles[u]=_objectSpread2$1(_objectSpread2$1({},namespace.styles[u]||{}),I),u==="fas"&&defineIcons("fa",n)}const{styles:styles$1,shims:shims$1}=namespace,FAMILY_NAMES=Object.keys(PREFIX_TO_LONG_STYLE),PREFIXES_FOR_FAMILY=FAMILY_NAMES.reduce((u,n)=>(u[n]=Object.keys(PREFIX_TO_LONG_STYLE[n]),u),{});let _defaultUsablePrefix=null,_byUnicode={},_byLigature={},_byOldName={},_byOldUnicode={},_byAlias={};function isReserved(u){return~RESERVED_CLASSES.indexOf(u)}function getIconName(u,n){const d=n.split("-"),C=d[0],I=d.slice(1).join("-");return C===u&&I!==""&&!isReserved(I)?I:null}const build=()=>{const u=C=>reduce(styles$1,(I,f,y)=>(I[y]=reduce(f,C,{}),I),{});_byUnicode=u((C,I,f)=>(I[3]&&(C[I[3]]=f),I[2]&&I[2].filter(B=>typeof B=="number").forEach(B=>{C[B.toString(16)]=f}),C)),_byLigature=u((C,I,f)=>(C[f]=f,I[2]&&I[2].filter(B=>typeof B=="string").forEach(B=>{C[B]=f}),C)),_byAlias=u((C,I,f)=>{const y=I[2];return C[f]=f,y.forEach(B=>{C[B]=f}),C});const n="far"in styles$1||config.autoFetchSvg,d=reduce(shims$1,(C,I)=>{const f=I[0];let y=I[1];const B=I[2];return y==="far"&&!n&&(y="fas"),typeof f=="string"&&(C.names[f]={prefix:y,iconName:B}),typeof f=="number"&&(C.unicodes[f.toString(16)]={prefix:y,iconName:B}),C},{names:{},unicodes:{}});_byOldName=d.names,_byOldUnicode=d.unicodes,_defaultUsablePrefix=getCanonicalPrefix(config.styleDefault,{family:config.familyDefault})};onChange(u=>{_defaultUsablePrefix=getCanonicalPrefix(u.styleDefault,{family:config.familyDefault})});build();function byUnicode(u,n){return(_byUnicode[u]||{})[n]}function byLigature(u,n){return(_byLigature[u]||{})[n]}function byAlias(u,n){return(_byAlias[u]||{})[n]}function byOldName(u){return _byOldName[u]||{prefix:null,iconName:null}}function byOldUnicode(u){const n=_byOldUnicode[u],d=byUnicode("fas",u);return n||(d?{prefix:"fas",iconName:d}:null)||{prefix:null,iconName:null}}function getDefaultUsablePrefix(){return _defaultUsablePrefix}const emptyCanonicalIcon=()=>({prefix:null,iconName:null,rest:[]});function getFamilyId(u){let n=s$1;const d=FAMILY_NAMES.reduce((C,I)=>(C[I]="".concat(config.cssPrefix,"-").concat(I),C),{});return L.forEach(C=>{(u.includes(d[C])||u.some(I=>PREFIXES_FOR_FAMILY[C].includes(I)))&&(n=C)}),n}function getCanonicalPrefix(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:d=s$1}=n,C=PREFIX_TO_STYLE[d][u];if(d===t&&!u)return"fad";const I=STYLE_TO_PREFIX[d][u]||STYLE_TO_PREFIX[d][C],f=u in namespace.styles?u:null;return I||f||null}function moveNonFaClassesToRest(u){let n=[],d=null;return u.forEach(C=>{const I=getIconName(config.cssPrefix,C);I?d=I:C&&n.push(C)}),{iconName:d,rest:n}}function sortedUniqueValues(u){return u.sort().filter((n,d,C)=>C.indexOf(n)===d)}function getCanonicalIcon(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:d=!1}=n;let C=null;const I=Ia.concat(bt$1),f=sortedUniqueValues(u.filter(V=>I.includes(V))),y=sortedUniqueValues(u.filter(V=>!Ia.includes(V))),B=f.filter(V=>(C=V,!P.includes(V))),[_=null]=B,Z=getFamilyId(f),M=_objectSpread2$1(_objectSpread2$1({},moveNonFaClassesToRest(y)),{},{prefix:getCanonicalPrefix(_,{family:Z})});return _objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},M),getDefaultCanonicalPrefix({values:u,family:Z,styles:styles$1,config,canonical:M,givenPrefix:C})),applyShimAndAlias(d,C,M))}function applyShimAndAlias(u,n,d){let{prefix:C,iconName:I}=d;if(u||!C||!I)return{prefix:C,iconName:I};const f=n==="fa"?byOldName(I):{},y=byAlias(C,I);return I=f.iconName||y||I,C=f.prefix||C,C==="far"&&!styles$1.far&&styles$1.fas&&!config.autoFetchSvg&&(C="fas"),{prefix:C,iconName:I}}const newCanonicalFamilies=L.filter(u=>u!==s$1||u!==t),newCanonicalStyles=Object.keys(ga).filter(u=>u!==s$1).map(u=>Object.keys(ga[u])).flat();function getDefaultCanonicalPrefix(u){const{values:n,family:d,canonical:C,givenPrefix:I="",styles:f={},config:y={}}=u,B=d===t,_=n.includes("fa-duotone")||n.includes("fad"),Z=y.familyDefault==="duotone",M=C.prefix==="fad"||C.prefix==="fa-duotone";if(!B&&(_||Z||M)&&(C.prefix="fad"),(n.includes("fa-brands")||n.includes("fab"))&&(C.prefix="fab"),!C.prefix&&newCanonicalFamilies.includes(d)&&(Object.keys(f).find(T=>newCanonicalStyles.includes(T))||y.autoFetchSvg)){const T=pt.get(d).defaultShortPrefixId;C.prefix=T,C.iconName=byAlias(C.prefix,C.iconName)||C.iconName}return(C.prefix==="fa"||I==="fa")&&(C.prefix=getDefaultUsablePrefix()||"fas"),C}class Library{constructor(){this.definitions={}}add(){for(var n=arguments.length,d=new Array(n),C=0;C<n;C++)d[C]=arguments[C];const I=d.reduce(this._pullDefinitions,{});Object.keys(I).forEach(f=>{this.definitions[f]=_objectSpread2$1(_objectSpread2$1({},this.definitions[f]||{}),I[f]),defineIcons(f,I[f]);const y=PREFIX_TO_LONG_STYLE[s$1][f];y&&defineIcons(y,I[f]),build()})}reset(){this.definitions={}}_pullDefinitions(n,d){const C=d.prefix&&d.iconName&&d.icon?{0:d}:d;return Object.keys(C).map(I=>{const{prefix:f,iconName:y,icon:B}=C[I],_=B[2];n[f]||(n[f]={}),_.length>0&&_.forEach(Z=>{typeof Z=="string"&&(n[f][Z]=B)}),n[f][y]=B}),n}}let _plugins=[],_hooks={};const providers={},defaultProviderKeys=Object.keys(providers);function registerPlugins(u,n){let{mixoutsTo:d}=n;return _plugins=u,_hooks={},Object.keys(providers).forEach(C=>{defaultProviderKeys.indexOf(C)===-1&&delete providers[C]}),_plugins.forEach(C=>{const I=C.mixout?C.mixout():{};if(Object.keys(I).forEach(f=>{typeof I[f]=="function"&&(d[f]=I[f]),typeof I[f]=="object"&&Object.keys(I[f]).forEach(y=>{d[f]||(d[f]={}),d[f][y]=I[f][y]})}),C.hooks){const f=C.hooks();Object.keys(f).forEach(y=>{_hooks[y]||(_hooks[y]=[]),_hooks[y].push(f[y])})}C.provides&&C.provides(providers)}),d}function chainHooks(u,n){for(var d=arguments.length,C=new Array(d>2?d-2:0),I=2;I<d;I++)C[I-2]=arguments[I];return(_hooks[u]||[]).forEach(y=>{n=y.apply(null,[n,...C])}),n}function callHooks(u){for(var n=arguments.length,d=new Array(n>1?n-1:0),C=1;C<n;C++)d[C-1]=arguments[C];(_hooks[u]||[]).forEach(f=>{f.apply(null,d)})}function callProvided(){const u=arguments[0],n=Array.prototype.slice.call(arguments,1);return providers[u]?providers[u].apply(null,n):void 0}function findIconDefinition(u){u.prefix==="fa"&&(u.prefix="fas");let{iconName:n}=u;const d=u.prefix||getDefaultUsablePrefix();if(n)return n=byAlias(d,n)||n,iconFromMapping(library.definitions,d,n)||iconFromMapping(namespace.styles,d,n)}const library=new Library,noAuto=()=>{config.autoReplaceSvg=!1,config.observeMutations=!1,callHooks("noAuto")},dom={i2svg:function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return IS_DOM?(callHooks("beforeI2svg",u),callProvided("pseudoElements2svg",u),callProvided("i2svg",u)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:n}=u;config.autoReplaceSvg===!1&&(config.autoReplaceSvg=!0),config.observeMutations=!0,domready(()=>{autoReplace({autoReplaceSvgRoot:n}),callHooks("watch",u)})}},parse={icon:u=>{if(u===null)return null;if(typeof u=="object"&&u.prefix&&u.iconName)return{prefix:u.prefix,iconName:byAlias(u.prefix,u.iconName)||u.iconName};if(Array.isArray(u)&&u.length===2){const n=u[1].indexOf("fa-")===0?u[1].slice(3):u[1],d=getCanonicalPrefix(u[0]);return{prefix:d,iconName:byAlias(d,n)||n}}if(typeof u=="string"&&(u.indexOf("".concat(config.cssPrefix,"-"))>-1||u.match(ICON_SELECTION_SYNTAX_PATTERN))){const n=getCanonicalIcon(u.split(" "),{skipLookups:!0});return{prefix:n.prefix||getDefaultUsablePrefix(),iconName:byAlias(n.prefix,n.iconName)||n.iconName}}if(typeof u=="string"){const n=getDefaultUsablePrefix();return{prefix:n,iconName:byAlias(n,u)||u}}}},api={noAuto,config,dom,parse,library,findIconDefinition,toHtml},autoReplace=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:n=DOCUMENT}=u;(Object.keys(namespace.styles).length>0||config.autoFetchSvg)&&IS_DOM&&config.autoReplaceSvg&&api.dom.i2svg({node:n})};function domVariants(u,n){return Object.defineProperty(u,"abstract",{get:n}),Object.defineProperty(u,"html",{get:function(){return u.abstract.map(d=>toHtml(d))}}),Object.defineProperty(u,"node",{get:function(){if(!IS_DOM)return;const d=DOCUMENT.createElement("div");return d.innerHTML=u.html,d.children}}),u}function asIcon(u){let{children:n,main:d,mask:C,attributes:I,styles:f,transform:y}=u;if(transformIsMeaningful(y)&&d.found&&!C.found){const{width:B,height:_}=d,Z={x:B/_/2,y:.5};I.style=joinStyles(_objectSpread2$1(_objectSpread2$1({},f),{},{"transform-origin":"".concat(Z.x+y.x/16,"em ").concat(Z.y+y.y/16,"em")}))}return[{tag:"svg",attributes:I,children:n}]}function asSymbol(u){let{prefix:n,iconName:d,children:C,attributes:I,symbol:f}=u;const y=f===!0?"".concat(n,"-").concat(config.cssPrefix,"-").concat(d):f;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:_objectSpread2$1(_objectSpread2$1({},I),{},{id:y}),children:C}]}]}function makeInlineSvgAbstract(u){const{icons:{main:n,mask:d},prefix:C,iconName:I,transform:f,symbol:y,title:B,maskId:_,titleId:Z,extra:M,watchable:V=!1}=u,{width:T,height:H}=d.found?d:n,F=Lt.includes(C),O=[config.replacementClass,I?"".concat(config.cssPrefix,"-").concat(I):""].filter(ne=>M.classes.indexOf(ne)===-1).filter(ne=>ne!==""||!!ne).concat(M.classes).join(" ");let $={children:[],attributes:_objectSpread2$1(_objectSpread2$1({},M.attributes),{},{"data-prefix":C,"data-icon":I,class:O,role:M.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(T," ").concat(H)})};const U=F&&!~M.classes.indexOf("fa-fw")?{width:"".concat(T/H*16*.0625,"em")}:{};V&&($.attributes[DATA_FA_I2SVG]=""),B&&($.children.push({tag:"title",attributes:{id:$.attributes["aria-labelledby"]||"title-".concat(Z||nextUniqueId())},children:[B]}),delete $.attributes.title);const ee=_objectSpread2$1(_objectSpread2$1({},$),{},{prefix:C,iconName:I,main:n,mask:d,maskId:_,transform:f,symbol:y,styles:_objectSpread2$1(_objectSpread2$1({},U),M.styles)}),{children:Q,attributes:ie}=d.found&&n.found?callProvided("generateAbstractMask",ee)||{children:[],attributes:{}}:callProvided("generateAbstractIcon",ee)||{children:[],attributes:{}};return ee.children=Q,ee.attributes=ie,y?asSymbol(ee):asIcon(ee)}function makeLayersTextAbstract(u){const{content:n,width:d,height:C,transform:I,title:f,extra:y,watchable:B=!1}=u,_=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},y.attributes),f?{title:f}:{}),{},{class:y.classes.join(" ")});B&&(_[DATA_FA_I2SVG]="");const Z=_objectSpread2$1({},y.styles);transformIsMeaningful(I)&&(Z.transform=transformForCss({transform:I,startCentered:!0,width:d,height:C}),Z["-webkit-transform"]=Z.transform);const M=joinStyles(Z);M.length>0&&(_.style=M);const V=[];return V.push({tag:"span",attributes:_,children:[n]}),f&&V.push({tag:"span",attributes:{class:"sr-only"},children:[f]}),V}function makeLayersCounterAbstract(u){const{content:n,title:d,extra:C}=u,I=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},C.attributes),d?{title:d}:{}),{},{class:C.classes.join(" ")}),f=joinStyles(C.styles);f.length>0&&(I.style=f);const y=[];return y.push({tag:"span",attributes:I,children:[n]}),d&&y.push({tag:"span",attributes:{class:"sr-only"},children:[d]}),y}const{styles:styles$1$1}=namespace;function asFoundIcon(u){const n=u[0],d=u[1],[C]=u.slice(4);let I=null;return Array.isArray(C)?I={tag:"g",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.GROUP)},children:[{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.SECONDARY),fill:"currentColor",d:C[0]}},{tag:"path",attributes:{class:"".concat(config.cssPrefix,"-").concat(DUOTONE_CLASSES.PRIMARY),fill:"currentColor",d:C[1]}}]}:I={tag:"path",attributes:{fill:"currentColor",d:C}},{found:!0,width:n,height:d,icon:I}}const missingIconResolutionMixin={found:!1,width:512,height:512};function maybeNotifyMissing(u,n){!PRODUCTION$1&&!config.showMissingIcons&&u&&console.error('Icon with name "'.concat(u,'" and prefix "').concat(n,'" is missing.'))}function findIcon(u,n){let d=n;return n==="fa"&&config.styleDefault!==null&&(n=getDefaultUsablePrefix()),new Promise((C,I)=>{if(d==="fa"){const f=byOldName(u)||{};u=f.iconName||u,n=f.prefix||n}if(u&&n&&styles$1$1[n]&&styles$1$1[n][u]){const f=styles$1$1[n][u];return C(asFoundIcon(f))}maybeNotifyMissing(u,n),C(_objectSpread2$1(_objectSpread2$1({},missingIconResolutionMixin),{},{icon:config.showMissingIcons&&u?callProvided("missingIconAbstract")||{}:{}}))})}const noop$1=()=>{},p$2=config.measurePerformance&&PERFORMANCE&&PERFORMANCE.mark&&PERFORMANCE.measure?PERFORMANCE:{mark:noop$1,measure:noop$1},preamble='FA "6.7.2"',begin=u=>(p$2.mark("".concat(preamble," ").concat(u," begins")),()=>end(u)),end=u=>{p$2.mark("".concat(preamble," ").concat(u," ends")),p$2.measure("".concat(preamble," ").concat(u),"".concat(preamble," ").concat(u," begins"),"".concat(preamble," ").concat(u," ends"))};var perf={begin,end};const noop$2=()=>{};function isWatched(u){return typeof(u.getAttribute?u.getAttribute(DATA_FA_I2SVG):null)=="string"}function hasPrefixAndIcon(u){const n=u.getAttribute?u.getAttribute(DATA_PREFIX):null,d=u.getAttribute?u.getAttribute(DATA_ICON):null;return n&&d}function hasBeenReplaced(u){return u&&u.classList&&u.classList.contains&&u.classList.contains(config.replacementClass)}function getMutator(){return config.autoReplaceSvg===!0?mutators.replace:mutators[config.autoReplaceSvg]||mutators.replace}function createElementNS$1(u){return DOCUMENT.createElementNS("http://www.w3.org/2000/svg",u)}function createElement(u){return DOCUMENT.createElement(u)}function convertSVG(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:d=u.tag==="svg"?createElementNS$1:createElement}=n;if(typeof u=="string")return DOCUMENT.createTextNode(u);const C=d(u.tag);return Object.keys(u.attributes||[]).forEach(function(f){C.setAttribute(f,u.attributes[f])}),(u.children||[]).forEach(function(f){C.appendChild(convertSVG(f,{ceFn:d}))}),C}function nodeAsComment(u){let n=" ".concat(u.outerHTML," ");return n="".concat(n,"Font Awesome fontawesome.com "),n}const mutators={replace:function(u){const n=u[0];if(n.parentNode)if(u[1].forEach(d=>{n.parentNode.insertBefore(convertSVG(d),n)}),n.getAttribute(DATA_FA_I2SVG)===null&&config.keepOriginalSource){let d=DOCUMENT.createComment(nodeAsComment(n));n.parentNode.replaceChild(d,n)}else n.remove()},nest:function(u){const n=u[0],d=u[1];if(~classArray(n).indexOf(config.replacementClass))return mutators.replace(u);const C=new RegExp("".concat(config.cssPrefix,"-.*"));if(delete d[0].attributes.id,d[0].attributes.class){const f=d[0].attributes.class.split(" ").reduce((y,B)=>(B===config.replacementClass||B.match(C)?y.toSvg.push(B):y.toNode.push(B),y),{toNode:[],toSvg:[]});d[0].attributes.class=f.toSvg.join(" "),f.toNode.length===0?n.removeAttribute("class"):n.setAttribute("class",f.toNode.join(" "))}const I=d.map(f=>toHtml(f)).join(`
`);n.setAttribute(DATA_FA_I2SVG,""),n.innerHTML=I}};function performOperationSync(u){u()}function perform(u,n){const d=typeof n=="function"?n:noop$2;if(u.length===0)d();else{let C=performOperationSync;config.mutateApproach===MUTATION_APPROACH_ASYNC&&(C=WINDOW.requestAnimationFrame||performOperationSync),C(()=>{const I=getMutator(),f=perf.begin("mutate");u.map(I),f(),d()})}}let disabled=!1;function disableObservation(){disabled=!0}function enableObservation(){disabled=!1}let mo=null;function observe(u){if(!MUTATION_OBSERVER||!config.observeMutations)return;const{treeCallback:n=noop$2,nodeCallback:d=noop$2,pseudoElementsCallback:C=noop$2,observeMutationsRoot:I=DOCUMENT}=u;mo=new MUTATION_OBSERVER(f=>{if(disabled)return;const y=getDefaultUsablePrefix();toArray(f).forEach(B=>{if(B.type==="childList"&&B.addedNodes.length>0&&!isWatched(B.addedNodes[0])&&(config.searchPseudoElements&&C(B.target),n(B.target)),B.type==="attributes"&&B.target.parentNode&&config.searchPseudoElements&&C(B.target.parentNode),B.type==="attributes"&&isWatched(B.target)&&~ATTRIBUTES_WATCHED_FOR_MUTATION.indexOf(B.attributeName))if(B.attributeName==="class"&&hasPrefixAndIcon(B.target)){const{prefix:_,iconName:Z}=getCanonicalIcon(classArray(B.target));B.target.setAttribute(DATA_PREFIX,_||y),Z&&B.target.setAttribute(DATA_ICON,Z)}else hasBeenReplaced(B.target)&&d(B.target)})}),IS_DOM&&mo.observe(I,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function disconnect(){mo&&mo.disconnect()}function styleParser(u){const n=u.getAttribute("style");let d=[];return n&&(d=n.split(";").reduce((C,I)=>{const f=I.split(":"),y=f[0],B=f.slice(1);return y&&B.length>0&&(C[y]=B.join(":").trim()),C},{})),d}function classParser(u){const n=u.getAttribute("data-prefix"),d=u.getAttribute("data-icon"),C=u.innerText!==void 0?u.innerText.trim():"";let I=getCanonicalIcon(classArray(u));return I.prefix||(I.prefix=getDefaultUsablePrefix()),n&&d&&(I.prefix=n,I.iconName=d),I.iconName&&I.prefix||(I.prefix&&C.length>0&&(I.iconName=byLigature(I.prefix,u.innerText)||byUnicode(I.prefix,toHex(u.innerText))),!I.iconName&&config.autoFetchSvg&&u.firstChild&&u.firstChild.nodeType===Node.TEXT_NODE&&(I.iconName=u.firstChild.data)),I}function attributesParser(u){const n=toArray(u.attributes).reduce((I,f)=>(I.name!=="class"&&I.name!=="style"&&(I[f.name]=f.value),I),{}),d=u.getAttribute("title"),C=u.getAttribute("data-fa-title-id");return config.autoA11y&&(d?n["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(C||nextUniqueId()):(n["aria-hidden"]="true",n.focusable="false")),n}function blankMeta(){return{iconName:null,title:null,titleId:null,prefix:null,transform:meaninglessTransform,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function parseMeta(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:d,prefix:C,rest:I}=classParser(u),f=attributesParser(u),y=chainHooks("parseNodeAttributes",{},u);let B=n.styleParser?styleParser(u):[];return _objectSpread2$1({iconName:d,title:u.getAttribute("title"),titleId:u.getAttribute("data-fa-title-id"),prefix:C,transform:meaninglessTransform,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:I,styles:B,attributes:f}},y)}const{styles:styles$2}=namespace;function generateMutation(u){const n=config.autoReplaceSvg==="nest"?parseMeta(u,{styleParser:!1}):parseMeta(u);return~n.extra.classes.indexOf(LAYERS_TEXT_CLASSNAME)?callProvided("generateLayersText",u,n):callProvided("generateSvgReplacementMutation",u,n)}function getKnownPrefixes(){return[...Ft,...Ia]}function onTree(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!IS_DOM)return Promise.resolve();const d=DOCUMENT.documentElement.classList,C=M=>d.add("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(M)),I=M=>d.remove("".concat(HTML_CLASS_I2SVG_BASE_CLASS,"-").concat(M)),f=config.autoFetchSvg?getKnownPrefixes():P.concat(Object.keys(styles$2));f.includes("fa")||f.push("fa");const y=[".".concat(LAYERS_TEXT_CLASSNAME,":not([").concat(DATA_FA_I2SVG,"])")].concat(f.map(M=>".".concat(M,":not([").concat(DATA_FA_I2SVG,"])"))).join(", ");if(y.length===0)return Promise.resolve();let B=[];try{B=toArray(u.querySelectorAll(y))}catch{}if(B.length>0)C("pending"),I("complete");else return Promise.resolve();const _=perf.begin("onTree"),Z=B.reduce((M,V)=>{try{const T=generateMutation(V);T&&M.push(T)}catch(T){PRODUCTION$1||T.name==="MissingIcon"&&console.error(T)}return M},[]);return new Promise((M,V)=>{Promise.all(Z).then(T=>{perform(T,()=>{C("active"),C("complete"),I("pending"),typeof n=="function"&&n(),_(),M()})}).catch(T=>{_(),V(T)})})}function onNode(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;generateMutation(u).then(d=>{d&&perform([d],n)})}function resolveIcons(u){return function(n){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const C=(n||{}).icon?n:findIconDefinition(n||{});let{mask:I}=d;return I&&(I=(I||{}).icon?I:findIconDefinition(I||{})),u(C,_objectSpread2$1(_objectSpread2$1({},d),{},{mask:I}))}}const render=function(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:d=meaninglessTransform,symbol:C=!1,mask:I=null,maskId:f=null,title:y=null,titleId:B=null,classes:_=[],attributes:Z={},styles:M={}}=n;if(!u)return;const{prefix:V,iconName:T,icon:H}=u;return domVariants(_objectSpread2$1({type:"icon"},u),()=>(callHooks("beforeDOMElementCreation",{iconDefinition:u,params:n}),config.autoA11y&&(y?Z["aria-labelledby"]="".concat(config.replacementClass,"-title-").concat(B||nextUniqueId()):(Z["aria-hidden"]="true",Z.focusable="false")),makeInlineSvgAbstract({icons:{main:asFoundIcon(H),mask:I?asFoundIcon(I.icon):{found:!1,width:null,height:null,icon:{}}},prefix:V,iconName:T,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),d),symbol:C,title:y,maskId:f,titleId:B,extra:{attributes:Z,styles:M,classes:_}})))};var ReplaceElements={mixout(){return{icon:resolveIcons(render)}},hooks(){return{mutationObserverCallbacks(u){return u.treeCallback=onTree,u.nodeCallback=onNode,u}}},provides(u){u.i2svg=function(n){const{node:d=DOCUMENT,callback:C=()=>{}}=n;return onTree(d,C)},u.generateSvgReplacementMutation=function(n,d){const{iconName:C,title:I,titleId:f,prefix:y,transform:B,symbol:_,mask:Z,maskId:M,extra:V}=d;return new Promise((T,H)=>{Promise.all([findIcon(C,y),Z.iconName?findIcon(Z.iconName,Z.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(F=>{let[O,$]=F;T([n,makeInlineSvgAbstract({icons:{main:O,mask:$},prefix:y,iconName:C,transform:B,symbol:_,maskId:M,title:I,titleId:f,extra:V,watchable:!0})])}).catch(H)})},u.generateAbstractIcon=function(n){let{children:d,attributes:C,main:I,transform:f,styles:y}=n;const B=joinStyles(y);B.length>0&&(C.style=B);let _;return transformIsMeaningful(f)&&(_=callProvided("generateAbstractTransformGrouping",{main:I,transform:f,containerWidth:I.width,iconWidth:I.width})),d.push(_||I.icon),{children:d,attributes:C}}}},Layers$1={mixout(){return{layer(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:d=[]}=n;return domVariants({type:"layer"},()=>{callHooks("beforeDOMElementCreation",{assembler:u,params:n});let C=[];return u(I=>{Array.isArray(I)?I.map(f=>{C=C.concat(f.abstract)}):C=C.concat(I.abstract)}),[{tag:"span",attributes:{class:["".concat(config.cssPrefix,"-layers"),...d].join(" ")},children:C}]})}}}},LayersCounter={mixout(){return{counter(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:d=null,classes:C=[],attributes:I={},styles:f={}}=n;return domVariants({type:"counter",content:u},()=>(callHooks("beforeDOMElementCreation",{content:u,params:n}),makeLayersCounterAbstract({content:u.toString(),title:d,extra:{attributes:I,styles:f,classes:["".concat(config.cssPrefix,"-layers-counter"),...C]}})))}}}},LayersText={mixout(){return{text(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:d=meaninglessTransform,title:C=null,classes:I=[],attributes:f={},styles:y={}}=n;return domVariants({type:"text",content:u},()=>(callHooks("beforeDOMElementCreation",{content:u,params:n}),makeLayersTextAbstract({content:u,transform:_objectSpread2$1(_objectSpread2$1({},meaninglessTransform),d),title:C,extra:{attributes:f,styles:y,classes:["".concat(config.cssPrefix,"-layers-text"),...I]}})))}}},provides(u){u.generateLayersText=function(n,d){const{title:C,transform:I,extra:f}=d;let y=null,B=null;if(IS_IE){const _=parseInt(getComputedStyle(n).fontSize,10),Z=n.getBoundingClientRect();y=Z.width/_,B=Z.height/_}return config.autoA11y&&!C&&(f.attributes["aria-hidden"]="true"),Promise.resolve([n,makeLayersTextAbstract({content:n.innerHTML,width:y,height:B,transform:I,title:C,extra:f,watchable:!0})])}}};const CLEAN_CONTENT_PATTERN=new RegExp('"',"ug"),SECONDARY_UNICODE_RANGE=[1105920,1112319],_FONT_FAMILY_WEIGHT_TO_PREFIX=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},{FontAwesome:{normal:"fas",400:"fas"}}),lt),wa),Yt),FONT_FAMILY_WEIGHT_TO_PREFIX=Object.keys(_FONT_FAMILY_WEIGHT_TO_PREFIX).reduce((u,n)=>(u[n.toLowerCase()]=_FONT_FAMILY_WEIGHT_TO_PREFIX[n],u),{}),FONT_FAMILY_WEIGHT_FALLBACK=Object.keys(FONT_FAMILY_WEIGHT_TO_PREFIX).reduce((u,n)=>{const d=FONT_FAMILY_WEIGHT_TO_PREFIX[n];return u[n]=d[900]||[...Object.entries(d)][0][1],u},{});function hexValueFromContent(u){const n=u.replace(CLEAN_CONTENT_PATTERN,""),d=codePointAt(n,0),C=d>=SECONDARY_UNICODE_RANGE[0]&&d<=SECONDARY_UNICODE_RANGE[1],I=n.length===2?n[0]===n[1]:!1;return{value:toHex(I?n[0]:n),isSecondary:C||I}}function getPrefix$1(u,n){const d=u.replace(/^['"]|['"]$/g,"").toLowerCase(),C=parseInt(n),I=isNaN(C)?"normal":C;return(FONT_FAMILY_WEIGHT_TO_PREFIX[d]||{})[I]||FONT_FAMILY_WEIGHT_FALLBACK[d]}function replaceForPosition(u,n){const d="".concat(DATA_FA_PSEUDO_ELEMENT_PENDING).concat(n.replace(":","-"));return new Promise((C,I)=>{if(u.getAttribute(d)!==null)return C();const y=toArray(u.children).filter(T=>T.getAttribute(DATA_FA_PSEUDO_ELEMENT)===n)[0],B=WINDOW.getComputedStyle(u,n),_=B.getPropertyValue("font-family"),Z=_.match(FONT_FAMILY_PATTERN),M=B.getPropertyValue("font-weight"),V=B.getPropertyValue("content");if(y&&!Z)return u.removeChild(y),C();if(Z&&V!=="none"&&V!==""){const T=B.getPropertyValue("content");let H=getPrefix$1(_,M);const{value:F,isSecondary:O}=hexValueFromContent(T),$=Z[0].startsWith("FontAwesome");let U=byUnicode(H,F),ee=U;if($){const Q=byOldUnicode(F);Q.iconName&&Q.prefix&&(U=Q.iconName,H=Q.prefix)}if(U&&!O&&(!y||y.getAttribute(DATA_PREFIX)!==H||y.getAttribute(DATA_ICON)!==ee)){u.setAttribute(d,ee),y&&u.removeChild(y);const Q=blankMeta(),{extra:ie}=Q;ie.attributes[DATA_FA_PSEUDO_ELEMENT]=n,findIcon(U,H).then(ne=>{const le=makeInlineSvgAbstract(_objectSpread2$1(_objectSpread2$1({},Q),{},{icons:{main:ne,mask:emptyCanonicalIcon()},prefix:H,iconName:ee,extra:ie,watchable:!0})),ae=DOCUMENT.createElementNS("http://www.w3.org/2000/svg","svg");n==="::before"?u.insertBefore(ae,u.firstChild):u.appendChild(ae),ae.outerHTML=le.map(ce=>toHtml(ce)).join(`
`),u.removeAttribute(d),C()}).catch(I)}else C()}else C()})}function replace(u){return Promise.all([replaceForPosition(u,"::before"),replaceForPosition(u,"::after")])}function processable(u){return u.parentNode!==document.head&&!~TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS.indexOf(u.tagName.toUpperCase())&&!u.getAttribute(DATA_FA_PSEUDO_ELEMENT)&&(!u.parentNode||u.parentNode.tagName!=="svg")}function searchPseudoElements(u){if(IS_DOM)return new Promise((n,d)=>{const C=toArray(u.querySelectorAll("*")).filter(processable).map(replace),I=perf.begin("searchPseudoElements");disableObservation(),Promise.all(C).then(()=>{I(),enableObservation(),n()}).catch(()=>{I(),enableObservation(),d()})})}var PseudoElements={hooks(){return{mutationObserverCallbacks(u){return u.pseudoElementsCallback=searchPseudoElements,u}}},provides(u){u.pseudoElements2svg=function(n){const{node:d=DOCUMENT}=n;config.searchPseudoElements&&searchPseudoElements(d)}}};let _unwatched=!1;var MutationObserver$1={mixout(){return{dom:{unwatch(){disableObservation(),_unwatched=!0}}}},hooks(){return{bootstrap(){observe(chainHooks("mutationObserverCallbacks",{}))},noAuto(){disconnect()},watch(u){const{observeMutationsRoot:n}=u;_unwatched?enableObservation():observe(chainHooks("mutationObserverCallbacks",{observeMutationsRoot:n}))}}}};const parseTransformString=u=>{let n={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return u.toLowerCase().split(" ").reduce((d,C)=>{const I=C.toLowerCase().split("-"),f=I[0];let y=I.slice(1).join("-");if(f&&y==="h")return d.flipX=!0,d;if(f&&y==="v")return d.flipY=!0,d;if(y=parseFloat(y),isNaN(y))return d;switch(f){case"grow":d.size=d.size+y;break;case"shrink":d.size=d.size-y;break;case"left":d.x=d.x-y;break;case"right":d.x=d.x+y;break;case"up":d.y=d.y-y;break;case"down":d.y=d.y+y;break;case"rotate":d.rotate=d.rotate+y;break}return d},n)};var PowerTransforms={mixout(){return{parse:{transform:u=>parseTransformString(u)}}},hooks(){return{parseNodeAttributes(u,n){const d=n.getAttribute("data-fa-transform");return d&&(u.transform=parseTransformString(d)),u}}},provides(u){u.generateAbstractTransformGrouping=function(n){let{main:d,transform:C,containerWidth:I,iconWidth:f}=n;const y={transform:"translate(".concat(I/2," 256)")},B="translate(".concat(C.x*32,", ").concat(C.y*32,") "),_="scale(".concat(C.size/16*(C.flipX?-1:1),", ").concat(C.size/16*(C.flipY?-1:1),") "),Z="rotate(".concat(C.rotate," 0 0)"),M={transform:"".concat(B," ").concat(_," ").concat(Z)},V={transform:"translate(".concat(f/2*-1," -256)")},T={outer:y,inner:M,path:V};return{tag:"g",attributes:_objectSpread2$1({},T.outer),children:[{tag:"g",attributes:_objectSpread2$1({},T.inner),children:[{tag:d.icon.tag,children:d.icon.children,attributes:_objectSpread2$1(_objectSpread2$1({},d.icon.attributes),T.path)}]}]}}}};const ALL_SPACE={x:0,y:0,width:"100%",height:"100%"};function fillBlack(u){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return u.attributes&&(u.attributes.fill||n)&&(u.attributes.fill="black"),u}function deGroup(u){return u.tag==="g"?u.children:[u]}var Masks={hooks(){return{parseNodeAttributes(u,n){const d=n.getAttribute("data-fa-mask"),C=d?getCanonicalIcon(d.split(" ").map(I=>I.trim())):emptyCanonicalIcon();return C.prefix||(C.prefix=getDefaultUsablePrefix()),u.mask=C,u.maskId=n.getAttribute("data-fa-mask-id"),u}}},provides(u){u.generateAbstractMask=function(n){let{children:d,attributes:C,main:I,mask:f,maskId:y,transform:B}=n;const{width:_,icon:Z}=I,{width:M,icon:V}=f,T=transformForSvg({transform:B,containerWidth:M,iconWidth:_}),H={tag:"rect",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{fill:"white"})},F=Z.children?{children:Z.children.map(fillBlack)}:{},O={tag:"g",attributes:_objectSpread2$1({},T.inner),children:[fillBlack(_objectSpread2$1({tag:Z.tag,attributes:_objectSpread2$1(_objectSpread2$1({},Z.attributes),T.path)},F))]},$={tag:"g",attributes:_objectSpread2$1({},T.outer),children:[O]},U="mask-".concat(y||nextUniqueId()),ee="clip-".concat(y||nextUniqueId()),Q={tag:"mask",attributes:_objectSpread2$1(_objectSpread2$1({},ALL_SPACE),{},{id:U,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[H,$]},ie={tag:"defs",children:[{tag:"clipPath",attributes:{id:ee},children:deGroup(V)},Q]};return d.push(ie,{tag:"rect",attributes:_objectSpread2$1({fill:"currentColor","clip-path":"url(#".concat(ee,")"),mask:"url(#".concat(U,")")},ALL_SPACE)}),{children:d,attributes:C}}}},MissingIconIndicator={provides(u){let n=!1;WINDOW.matchMedia&&(n=WINDOW.matchMedia("(prefers-reduced-motion: reduce)").matches),u.missingIconAbstract=function(){const d=[],C={fill:"currentColor"},I={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};d.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},C),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});const f=_objectSpread2$1(_objectSpread2$1({},I),{},{attributeName:"opacity"}),y={tag:"circle",attributes:_objectSpread2$1(_objectSpread2$1({},C),{},{cx:"256",cy:"364",r:"28"}),children:[]};return n||y.children.push({tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},I),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},f),{},{values:"1;0;1;1;0;1;"})}),d.push(y),d.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},C),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:n?[]:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},f),{},{values:"1;0;0;0;0;1;"})}]}),n||d.push({tag:"path",attributes:_objectSpread2$1(_objectSpread2$1({},C),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:_objectSpread2$1(_objectSpread2$1({},f),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:d}}}},SvgSymbols={hooks(){return{parseNodeAttributes(u,n){const d=n.getAttribute("data-fa-symbol"),C=d===null?!1:d===""?!0:d;return u.symbol=C,u}}}},plugins=[InjectCSS,ReplaceElements,Layers$1,LayersCounter,LayersText,PseudoElements,MutationObserver$1,PowerTransforms,Masks,MissingIconIndicator,SvgSymbols];registerPlugins(plugins,{mixoutsTo:api});api.noAuto;api.config;api.library;api.dom;const parse$1=api.parse;api.findIconDefinition;api.toHtml;const icon=api.icon;api.layer;api.text;api.counter;var propTypes={exports:{}},ReactPropTypesSecret_1,hasRequiredReactPropTypesSecret;function requireReactPropTypesSecret(){if(hasRequiredReactPropTypesSecret)return ReactPropTypesSecret_1;hasRequiredReactPropTypesSecret=1;var u="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ReactPropTypesSecret_1=u,ReactPropTypesSecret_1}var factoryWithThrowingShims,hasRequiredFactoryWithThrowingShims;function requireFactoryWithThrowingShims(){if(hasRequiredFactoryWithThrowingShims)return factoryWithThrowingShims;hasRequiredFactoryWithThrowingShims=1;var u=requireReactPropTypesSecret();function n(){}function d(){}return d.resetWarningCache=n,factoryWithThrowingShims=function(){function C(y,B,_,Z,M,V){if(V!==u){var T=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw T.name="Invariant Violation",T}}C.isRequired=C;function I(){return C}var f={array:C,bigint:C,bool:C,func:C,number:C,object:C,string:C,symbol:C,any:C,arrayOf:I,element:C,elementType:C,instanceOf:I,node:C,objectOf:I,oneOf:I,oneOfType:I,shape:I,exact:I,checkPropTypes:d,resetWarningCache:n};return f.PropTypes=f,f},factoryWithThrowingShims}var hasRequiredPropTypes;function requirePropTypes(){return hasRequiredPropTypes||(hasRequiredPropTypes=1,propTypes.exports=requireFactoryWithThrowingShims()()),propTypes.exports}var propTypesExports=requirePropTypes();const PropTypes=getDefaultExportFromCjs(propTypesExports);function ownKeys(u,n){var d=Object.keys(u);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(u);n&&(C=C.filter(function(I){return Object.getOwnPropertyDescriptor(u,I).enumerable})),d.push.apply(d,C)}return d}function _objectSpread2(u){for(var n=1;n<arguments.length;n++){var d=arguments[n]!=null?arguments[n]:{};n%2?ownKeys(Object(d),!0).forEach(function(C){_defineProperty(u,C,d[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(d)):ownKeys(Object(d)).forEach(function(C){Object.defineProperty(u,C,Object.getOwnPropertyDescriptor(d,C))})}return u}function _typeof(u){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_typeof(u)}function _defineProperty(u,n,d){return n in u?Object.defineProperty(u,n,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[n]=d,u}function _objectWithoutPropertiesLoose(u,n){if(u==null)return{};var d={},C=Object.keys(u),I,f;for(f=0;f<C.length;f++)I=C[f],!(n.indexOf(I)>=0)&&(d[I]=u[I]);return d}function _objectWithoutProperties(u,n){if(u==null)return{};var d=_objectWithoutPropertiesLoose(u,n),C,I;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(u);for(I=0;I<f.length;I++)C=f[I],!(n.indexOf(C)>=0)&&Object.prototype.propertyIsEnumerable.call(u,C)&&(d[C]=u[C])}return d}function _toConsumableArray(u){return _arrayWithoutHoles(u)||_iterableToArray(u)||_unsupportedIterableToArray(u)||_nonIterableSpread()}function _arrayWithoutHoles(u){if(Array.isArray(u))return _arrayLikeToArray(u)}function _iterableToArray(u){if(typeof Symbol<"u"&&u[Symbol.iterator]!=null||u["@@iterator"]!=null)return Array.from(u)}function _unsupportedIterableToArray(u,n){if(u){if(typeof u=="string")return _arrayLikeToArray(u,n);var d=Object.prototype.toString.call(u).slice(8,-1);if(d==="Object"&&u.constructor&&(d=u.constructor.name),d==="Map"||d==="Set")return Array.from(u);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return _arrayLikeToArray(u,n)}}function _arrayLikeToArray(u,n){(n==null||n>u.length)&&(n=u.length);for(var d=0,C=new Array(n);d<n;d++)C[d]=u[d];return C}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function classList(u){var n,d=u.beat,C=u.fade,I=u.beatFade,f=u.bounce,y=u.shake,B=u.flash,_=u.spin,Z=u.spinPulse,M=u.spinReverse,V=u.pulse,T=u.fixedWidth,H=u.inverse,F=u.border,O=u.listItem,$=u.flip,U=u.size,ee=u.rotation,Q=u.pull,ie=(n={"fa-beat":d,"fa-fade":C,"fa-beat-fade":I,"fa-bounce":f,"fa-shake":y,"fa-flash":B,"fa-spin":_,"fa-spin-reverse":M,"fa-spin-pulse":Z,"fa-pulse":V,"fa-fw":T,"fa-inverse":H,"fa-border":F,"fa-li":O,"fa-flip":$===!0,"fa-flip-horizontal":$==="horizontal"||$==="both","fa-flip-vertical":$==="vertical"||$==="both"},_defineProperty(n,"fa-".concat(U),typeof U<"u"&&U!==null),_defineProperty(n,"fa-rotate-".concat(ee),typeof ee<"u"&&ee!==null&&ee!==0),_defineProperty(n,"fa-pull-".concat(Q),typeof Q<"u"&&Q!==null),_defineProperty(n,"fa-swap-opacity",u.swapOpacity),n);return Object.keys(ie).map(function(ne){return ie[ne]?ne:null}).filter(function(ne){return ne})}function _isNumerical(u){return u=u-0,u===u}function camelize(u){return _isNumerical(u)?u:(u=u.replace(/[\-_\s]+(.)?/g,function(n,d){return d?d.toUpperCase():""}),u.substr(0,1).toLowerCase()+u.substr(1))}var _excluded=["style"];function capitalize$1(u){return u.charAt(0).toUpperCase()+u.slice(1)}function styleToObject(u){return u.split(";").map(function(n){return n.trim()}).filter(function(n){return n}).reduce(function(n,d){var C=d.indexOf(":"),I=camelize(d.slice(0,C)),f=d.slice(C+1).trim();return I.startsWith("webkit")?n[capitalize$1(I)]=f:n[I]=f,n},{})}function convert(u,n){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof n=="string")return n;var C=(n.children||[]).map(function(_){return convert(u,_)}),I=Object.keys(n.attributes||{}).reduce(function(_,Z){var M=n.attributes[Z];switch(Z){case"class":_.attrs.className=M,delete n.attributes.class;break;case"style":_.attrs.style=styleToObject(M);break;default:Z.indexOf("aria-")===0||Z.indexOf("data-")===0?_.attrs[Z.toLowerCase()]=M:_.attrs[camelize(Z)]=M}return _},{attrs:{}}),f=d.style,y=f===void 0?{}:f,B=_objectWithoutProperties(d,_excluded);return I.attrs.style=_objectSpread2(_objectSpread2({},I.attrs.style),y),u.apply(void 0,[n.tag,_objectSpread2(_objectSpread2({},I.attrs),B)].concat(_toConsumableArray(C)))}var PRODUCTION=!1;try{PRODUCTION=!0}catch{}function log$1(){if(!PRODUCTION&&console&&typeof console.error=="function"){var u;(u=console).error.apply(u,arguments)}}function normalizeIconArgs(u){if(u&&_typeof(u)==="object"&&u.prefix&&u.iconName&&u.icon)return u;if(parse$1.icon)return parse$1.icon(u);if(u===null)return null;if(u&&_typeof(u)==="object"&&u.prefix&&u.iconName)return u;if(Array.isArray(u)&&u.length===2)return{prefix:u[0],iconName:u[1]};if(typeof u=="string")return{prefix:"fas",iconName:u}}function objectWithKey(u,n){return Array.isArray(n)&&n.length>0||!Array.isArray(n)&&n?_defineProperty({},u,n):{}}var defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},FontAwesomeIcon=React.forwardRef(function(u,n){var d=_objectSpread2(_objectSpread2({},defaultProps),u),C=d.icon,I=d.mask,f=d.symbol,y=d.className,B=d.title,_=d.titleId,Z=d.maskId,M=normalizeIconArgs(C),V=objectWithKey("classes",[].concat(_toConsumableArray(classList(d)),_toConsumableArray((y||"").split(" ")))),T=objectWithKey("transform",typeof d.transform=="string"?parse$1.transform(d.transform):d.transform),H=objectWithKey("mask",normalizeIconArgs(I)),F=icon(M,_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},V),T),H),{},{symbol:f,title:B,titleId:_,maskId:Z}));if(!F)return log$1("Could not find icon",M),null;var O=F.abstract,$={ref:n};return Object.keys(d).forEach(function(U){defaultProps.hasOwnProperty(U)||($[U]=d[U])}),convertCurry(O[0],$)});FontAwesomeIcon.displayName="FontAwesomeIcon";FontAwesomeIcon.propTypes={beat:PropTypes.bool,border:PropTypes.bool,beatFade:PropTypes.bool,bounce:PropTypes.bool,className:PropTypes.string,fade:PropTypes.bool,flash:PropTypes.bool,mask:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),maskId:PropTypes.string,fixedWidth:PropTypes.bool,inverse:PropTypes.bool,flip:PropTypes.oneOf([!0,!1,"horizontal","vertical","both"]),icon:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.string]),listItem:PropTypes.bool,pull:PropTypes.oneOf(["right","left"]),pulse:PropTypes.bool,rotation:PropTypes.oneOf([0,90,180,270]),shake:PropTypes.bool,size:PropTypes.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:PropTypes.bool,spinPulse:PropTypes.bool,spinReverse:PropTypes.bool,symbol:PropTypes.oneOfType([PropTypes.bool,PropTypes.string]),title:PropTypes.string,titleId:PropTypes.string,transform:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),swapOpacity:PropTypes.bool};var convertCurry=convert.bind(null,React.createElement);const logoFull="/physicsvisualizer/assets/physicsvisualizer-CncMpR-a.svg",logoMini="/physicsvisualizer/assets/icon-transparent-Be_3rhPj.svg",baseMenuItems={File:["Open","Save","Exit"],Scenes:["New Scene","2D Mechanics","3D Mechanics","Electrodynamics"],Conversation:["Clear Chat","Export Transcript"],Help:["Tutorials","About","Documentation"]};function TopMenu(){const[u,n]=reactExports.useState(null),d=I=>{n(u===I?null:I)},C=I=>{console.log(`Menu item clicked: ${typeof I=="object"?I.label:I}`),n(null)};return jsxRuntimeExports.jsxs("div",{className:"top-menu",children:[jsxRuntimeExports.jsxs("div",{id:"icon",children:[jsxRuntimeExports.jsx("img",{className:"full-logo",src:logoFull,alt:"Full logo",height:"36px"}),jsxRuntimeExports.jsx("img",{className:"mini-logo",src:logoMini,alt:"Mini logo",height:"36px"})]}),Object.entries(baseMenuItems).map(([I,f])=>jsxRuntimeExports.jsxs("div",{className:"menu-item",onClick:()=>d(I),onMouseLeave:()=>{},children:[I,u===I&&jsxRuntimeExports.jsx("div",{className:"dropdown",onMouseLeave:()=>n(null),children:f.map((y,B)=>jsxRuntimeExports.jsx("div",{className:"dropdown-item",onClick:_=>{_.stopPropagation(),C(y)},children:typeof y=="object"?y.label:y},B))})]},I))]})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="174",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,TimestampQuery={COMPUTE:"compute",RENDER:"render"};let EventDispatcher$1=class{addEventListener(n,d){this._listeners===void 0&&(this._listeners={});const C=this._listeners;C[n]===void 0&&(C[n]=[]),C[n].indexOf(d)===-1&&C[n].push(d)}hasEventListener(n,d){const C=this._listeners;return C===void 0?!1:C[n]!==void 0&&C[n].indexOf(d)!==-1}removeEventListener(n,d){const C=this._listeners;if(C===void 0)return;const I=C[n];if(I!==void 0){const f=I.indexOf(d);f!==-1&&I.splice(f,1)}}dispatchEvent(n){const d=this._listeners;if(d===void 0)return;const C=d[n.type];if(C!==void 0){n.target=this;const I=C.slice(0);for(let f=0,y=I.length;f<y;f++)I[f].call(this,n);n.target=null}}};const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const u=Math.random()*4294967295|0,n=Math.random()*4294967295|0,d=Math.random()*4294967295|0,C=Math.random()*4294967295|0;return(_lut[u&255]+_lut[u>>8&255]+_lut[u>>16&255]+_lut[u>>24&255]+"-"+_lut[n&255]+_lut[n>>8&255]+"-"+_lut[n>>16&15|64]+_lut[n>>24&255]+"-"+_lut[d&63|128]+_lut[d>>8&255]+"-"+_lut[d>>16&255]+_lut[d>>24&255]+_lut[C&255]+_lut[C>>8&255]+_lut[C>>16&255]+_lut[C>>24&255]).toLowerCase()}function clamp$1(u,n,d){return Math.max(n,Math.min(d,u))}function euclideanModulo(u,n){return(u%n+n)%n}function mapLinear(u,n,d,C,I){return C+(u-n)*(I-C)/(d-n)}function inverseLerp(u,n,d){return u!==n?(d-u)/(n-u):0}function lerp(u,n,d){return(1-d)*u+d*n}function damp(u,n,d,C){return lerp(u,n,1-Math.exp(-d*C))}function pingpong(u,n=1){return n-Math.abs(euclideanModulo(u,n*2)-n)}function smoothstep(u,n,d){return u<=n?0:u>=d?1:(u=(u-n)/(d-n),u*u*(3-2*u))}function smootherstep(u,n,d){return u<=n?0:u>=d?1:(u=(u-n)/(d-n),u*u*u*(u*(u*6-15)+10))}function randInt(u,n){return u+Math.floor(Math.random()*(n-u+1))}function randFloat(u,n){return u+Math.random()*(n-u)}function randFloatSpread(u){return u*(.5-Math.random())}function seededRandom(u){u!==void 0&&(_seed=u);let n=_seed+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}function degToRad(u){return u*DEG2RAD}function radToDeg(u){return u*RAD2DEG}function isPowerOfTwo(u){return(u&u-1)===0&&u!==0}function ceilPowerOfTwo(u){return Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function floorPowerOfTwo(u){return Math.pow(2,Math.floor(Math.log(u)/Math.LN2))}function setQuaternionFromProperEuler(u,n,d,C,I){const f=Math.cos,y=Math.sin,B=f(d/2),_=y(d/2),Z=f((n+C)/2),M=y((n+C)/2),V=f((n-C)/2),T=y((n-C)/2),H=f((C-n)/2),F=y((C-n)/2);switch(I){case"XYX":u.set(B*M,_*V,_*T,B*Z);break;case"YZY":u.set(_*T,B*M,_*V,B*Z);break;case"ZXZ":u.set(_*V,_*T,B*M,B*Z);break;case"XZX":u.set(B*M,_*F,_*H,B*Z);break;case"YXY":u.set(_*H,B*M,_*F,B*Z);break;case"ZYZ":u.set(_*F,_*H,B*M,B*Z);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+I)}}function denormalize(u,n){switch(n.constructor){case Float32Array:return u;case Uint32Array:return u/4294967295;case Uint16Array:return u/65535;case Uint8Array:return u/255;case Int32Array:return Math.max(u/2147483647,-1);case Int16Array:return Math.max(u/32767,-1);case Int8Array:return Math.max(u/127,-1);default:throw new Error("Invalid component type.")}}function normalize(u,n){switch(n.constructor){case Float32Array:return u;case Uint32Array:return Math.round(u*4294967295);case Uint16Array:return Math.round(u*65535);case Uint8Array:return Math.round(u*255);case Int32Array:return Math.round(u*2147483647);case Int16Array:return Math.round(u*32767);case Int8Array:return Math.round(u*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp:clamp$1,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(n=0,d=0){Vector2.prototype.isVector2=!0,this.x=n,this.y=d}get width(){return this.x}set width(n){this.x=n}get height(){return this.y}set height(n){this.y=n}set(n,d){return this.x=n,this.y=d,this}setScalar(n){return this.x=n,this.y=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setComponent(n,d){switch(n){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y)}copy(n){return this.x=n.x,this.y=n.y,this}add(n){return this.x+=n.x,this.y+=n.y,this}addScalar(n){return this.x+=n,this.y+=n,this}addVectors(n,d){return this.x=n.x+d.x,this.y=n.y+d.y,this}addScaledVector(n,d){return this.x+=n.x*d,this.y+=n.y*d,this}sub(n){return this.x-=n.x,this.y-=n.y,this}subScalar(n){return this.x-=n,this.y-=n,this}subVectors(n,d){return this.x=n.x-d.x,this.y=n.y-d.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divide(n){return this.x/=n.x,this.y/=n.y,this}divideScalar(n){return this.multiplyScalar(1/n)}applyMatrix3(n){const d=this.x,C=this.y,I=n.elements;return this.x=I[0]*d+I[3]*C+I[6],this.y=I[1]*d+I[4]*C+I[7],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this}clamp(n,d){return this.x=clamp$1(this.x,n.x,d.x),this.y=clamp$1(this.y,n.y,d.y),this}clampScalar(n,d){return this.x=clamp$1(this.x,n,d),this.y=clamp$1(this.y,n,d),this}clampLength(n,d){const C=this.length();return this.divideScalar(C||1).multiplyScalar(clamp$1(C,n,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(n){const d=Math.sqrt(this.lengthSq()*n.lengthSq());if(d===0)return Math.PI/2;const C=this.dot(n)/d;return Math.acos(clamp$1(C,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const d=this.x-n.x,C=this.y-n.y;return d*d+C*C}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,d){return this.x+=(n.x-this.x)*d,this.y+=(n.y-this.y)*d,this}lerpVectors(n,d,C){return this.x=n.x+(d.x-n.x)*C,this.y=n.y+(d.y-n.y)*C,this}equals(n){return n.x===this.x&&n.y===this.y}fromArray(n,d=0){return this.x=n[d],this.y=n[d+1],this}toArray(n=[],d=0){return n[d]=this.x,n[d+1]=this.y,n}fromBufferAttribute(n,d){return this.x=n.getX(d),this.y=n.getY(d),this}rotateAround(n,d){const C=Math.cos(d),I=Math.sin(d),f=this.x-n.x,y=this.y-n.y;return this.x=f*C-y*I+n.x,this.y=f*I+y*C+n.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(n,d,C,I,f,y,B,_,Z){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],n!==void 0&&this.set(n,d,C,I,f,y,B,_,Z)}set(n,d,C,I,f,y,B,_,Z){const M=this.elements;return M[0]=n,M[1]=I,M[2]=B,M[3]=d,M[4]=f,M[5]=_,M[6]=C,M[7]=y,M[8]=Z,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(n){const d=this.elements,C=n.elements;return d[0]=C[0],d[1]=C[1],d[2]=C[2],d[3]=C[3],d[4]=C[4],d[5]=C[5],d[6]=C[6],d[7]=C[7],d[8]=C[8],this}extractBasis(n,d,C){return n.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),C.setFromMatrix3Column(this,2),this}setFromMatrix4(n){const d=n.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,d){const C=n.elements,I=d.elements,f=this.elements,y=C[0],B=C[3],_=C[6],Z=C[1],M=C[4],V=C[7],T=C[2],H=C[5],F=C[8],O=I[0],$=I[3],U=I[6],ee=I[1],Q=I[4],ie=I[7],ne=I[2],le=I[5],ae=I[8];return f[0]=y*O+B*ee+_*ne,f[3]=y*$+B*Q+_*le,f[6]=y*U+B*ie+_*ae,f[1]=Z*O+M*ee+V*ne,f[4]=Z*$+M*Q+V*le,f[7]=Z*U+M*ie+V*ae,f[2]=T*O+H*ee+F*ne,f[5]=T*$+H*Q+F*le,f[8]=T*U+H*ie+F*ae,this}multiplyScalar(n){const d=this.elements;return d[0]*=n,d[3]*=n,d[6]*=n,d[1]*=n,d[4]*=n,d[7]*=n,d[2]*=n,d[5]*=n,d[8]*=n,this}determinant(){const n=this.elements,d=n[0],C=n[1],I=n[2],f=n[3],y=n[4],B=n[5],_=n[6],Z=n[7],M=n[8];return d*y*M-d*B*Z-C*f*M+C*B*_+I*f*Z-I*y*_}invert(){const n=this.elements,d=n[0],C=n[1],I=n[2],f=n[3],y=n[4],B=n[5],_=n[6],Z=n[7],M=n[8],V=M*y-B*Z,T=B*_-M*f,H=Z*f-y*_,F=d*V+C*T+I*H;if(F===0)return this.set(0,0,0,0,0,0,0,0,0);const O=1/F;return n[0]=V*O,n[1]=(I*Z-M*C)*O,n[2]=(B*C-I*y)*O,n[3]=T*O,n[4]=(M*d-I*_)*O,n[5]=(I*f-B*d)*O,n[6]=H*O,n[7]=(C*_-Z*d)*O,n[8]=(y*d-C*f)*O,this}transpose(){let n;const d=this.elements;return n=d[1],d[1]=d[3],d[3]=n,n=d[2],d[2]=d[6],d[6]=n,n=d[5],d[5]=d[7],d[7]=n,this}getNormalMatrix(n){return this.setFromMatrix4(n).invert().transpose()}transposeIntoArray(n){const d=this.elements;return n[0]=d[0],n[1]=d[3],n[2]=d[6],n[3]=d[1],n[4]=d[4],n[5]=d[7],n[6]=d[2],n[7]=d[5],n[8]=d[8],this}setUvTransform(n,d,C,I,f,y,B){const _=Math.cos(f),Z=Math.sin(f);return this.set(C*_,C*Z,-C*(_*y+Z*B)+y+n,-I*Z,I*_,-I*(-Z*y+_*B)+B+d,0,0,1),this}scale(n,d){return this.premultiply(_m3.makeScale(n,d)),this}rotate(n){return this.premultiply(_m3.makeRotation(-n)),this}translate(n,d){return this.premultiply(_m3.makeTranslation(n,d)),this}makeTranslation(n,d){return n.isVector2?this.set(1,0,n.x,0,1,n.y,0,0,1):this.set(1,0,n,0,1,d,0,0,1),this}makeRotation(n){const d=Math.cos(n),C=Math.sin(n);return this.set(d,-C,0,C,d,0,0,0,1),this}makeScale(n,d){return this.set(n,0,0,0,d,0,0,0,1),this}equals(n){const d=this.elements,C=n.elements;for(let I=0;I<9;I++)if(d[I]!==C[I])return!1;return!0}fromArray(n,d=0){for(let C=0;C<9;C++)this.elements[C]=n[C+d];return this}toArray(n=[],d=0){const C=this.elements;return n[d]=C[0],n[d+1]=C[1],n[d+2]=C[2],n[d+3]=C[3],n[d+4]=C[4],n[d+5]=C[5],n[d+6]=C[6],n[d+7]=C[7],n[d+8]=C[8],n}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(u){for(let n=u.length-1;n>=0;--n)if(u[n]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(u,n){return new TYPED_ARRAYS[u](n)}function createElementNS(u){return document.createElementNS("http://www.w3.org/1999/xhtml",u)}function createCanvasElement(){const u=createElementNS("canvas");return u.style.display="block",u}const _cache={};function warnOnce(u){u in _cache||(_cache[u]=!0,console.warn(u))}function probeAsync(u,n,d){return new Promise(function(C,I){function f(){switch(u.clientWaitSync(n,u.SYNC_FLUSH_COMMANDS_BIT,0)){case u.WAIT_FAILED:I();break;case u.TIMEOUT_EXPIRED:setTimeout(f,d);break;default:C()}}setTimeout(f,d)})}function toNormalizedProjectionMatrix(u){const n=u.elements;n[2]=.5*n[2]+.5*n[3],n[6]=.5*n[6]+.5*n[7],n[10]=.5*n[10]+.5*n[11],n[14]=.5*n[14]+.5*n[15]}function toReversedProjectionMatrix(u){const n=u.elements;n[11]===-1?(n[10]=-n[10]-1,n[14]=-n[14]):(n[10]=-n[10],n[14]=-n[14]+1)}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const u={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(I,f,y){return this.enabled===!1||f===y||!f||!y||(this.spaces[f].transfer===SRGBTransfer&&(I.r=SRGBToLinear(I.r),I.g=SRGBToLinear(I.g),I.b=SRGBToLinear(I.b)),this.spaces[f].primaries!==this.spaces[y].primaries&&(I.applyMatrix3(this.spaces[f].toXYZ),I.applyMatrix3(this.spaces[y].fromXYZ)),this.spaces[y].transfer===SRGBTransfer&&(I.r=LinearToSRGB(I.r),I.g=LinearToSRGB(I.g),I.b=LinearToSRGB(I.b))),I},fromWorkingColorSpace:function(I,f){return this.convert(I,this.workingColorSpace,f)},toWorkingColorSpace:function(I,f){return this.convert(I,f,this.workingColorSpace)},getPrimaries:function(I){return this.spaces[I].primaries},getTransfer:function(I){return I===NoColorSpace?LinearTransfer:this.spaces[I].transfer},getLuminanceCoefficients:function(I,f=this.workingColorSpace){return I.fromArray(this.spaces[f].luminanceCoefficients)},define:function(I){Object.assign(this.spaces,I)},_getMatrix:function(I,f,y){return I.copy(this.spaces[f].toXYZ).multiply(this.spaces[y].fromXYZ)},_getDrawingBufferColorSpace:function(I){return this.spaces[I].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(I=this.workingColorSpace){return this.spaces[I].workingColorSpaceConfig.unpackColorSpace}},n=[.64,.33,.3,.6,.15,.06],d=[.2126,.7152,.0722],C=[.3127,.329];return u.define({[LinearSRGBColorSpace]:{primaries:n,whitePoint:C,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:d,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:n,whitePoint:C,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:d,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),u}const ColorManagement=createColorManagement();function SRGBToLinear(u){return u<.04045?u*.0773993808:Math.pow(u*.9478672986+.0521327014,2.4)}function LinearToSRGB(u){return u<.0031308?u*12.92:1.055*Math.pow(u,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let d;if(n instanceof HTMLCanvasElement)d=n;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=n.width,_canvas.height=n.height;const C=_canvas.getContext("2d");n instanceof ImageData?C.putImageData(n,0,0):C.drawImage(n,0,0,n.width,n.height),d=_canvas}return d.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const d=createElementNS("canvas");d.width=n.width,d.height=n.height;const C=d.getContext("2d");C.drawImage(n,0,0,n.width,n.height);const I=C.getImageData(0,0,n.width,n.height),f=I.data;for(let y=0;y<f.length;y++)f[y]=SRGBToLinear(f[y]/255)*255;return C.putImageData(I,0,0),d}else if(n.data){const d=n.data.slice(0);for(let C=0;C<d.length;C++)d instanceof Uint8Array||d instanceof Uint8ClampedArray?d[C]=Math.floor(SRGBToLinear(d[C]/255)*255):d[C]=SRGBToLinear(d[C]);return{data:d,width:n.width,height:n.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}}let _sourceId=0;class Source{constructor(n=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=n,this.dataReady=!0,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const d=n===void 0||typeof n=="string";if(!d&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const C={uuid:this.uuid,url:""},I=this.data;if(I!==null){let f;if(Array.isArray(I)){f=[];for(let y=0,B=I.length;y<B;y++)I[y].isDataTexture?f.push(serializeImage(I[y].image)):f.push(serializeImage(I[y]))}else f=serializeImage(I);C.url=f}return d||(n.images[this.uuid]=C),C}}function serializeImage(u){return typeof HTMLImageElement<"u"&&u instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&u instanceof ImageBitmap?ImageUtils.getDataURL(u):u.data?{data:Array.from(u.data),width:u.width,height:u.height,type:u.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher$1{constructor(n=Texture.DEFAULT_IMAGE,d=Texture.DEFAULT_MAPPING,C=ClampToEdgeWrapping,I=ClampToEdgeWrapping,f=LinearFilter,y=LinearMipmapLinearFilter,B=RGBAFormat,_=UnsignedByteType,Z=Texture.DEFAULT_ANISOTROPY,M=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(n),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=C,this.wrapT=I,this.magFilter=f,this.minFilter=y,this.anisotropy=Z,this.format=B,this.internalFormat=null,this.type=_,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=M,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(n=null){this.source.data=n}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(n){return this.name=n.name,this.source=n.source,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.channel=n.channel,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.colorSpace=n.colorSpace,this.renderTarget=n.renderTarget,this.isRenderTargetTexture=n.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(n.userData)),this.needsUpdate=!0,this}toJSON(n){const d=n===void 0||typeof n=="string";if(!d&&n.textures[this.uuid]!==void 0)return n.textures[this.uuid];const C={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(n).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(C.userData=this.userData),d||(n.textures[this.uuid]=C),C}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(n){if(this.mapping!==UVMapping)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case RepeatWrapping:n.x=n.x-Math.floor(n.x);break;case ClampToEdgeWrapping:n.x=n.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(n.x)%2)===1?n.x=Math.ceil(n.x)-n.x:n.x=n.x-Math.floor(n.x);break}if(n.y<0||n.y>1)switch(this.wrapT){case RepeatWrapping:n.y=n.y-Math.floor(n.y);break;case ClampToEdgeWrapping:n.y=n.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(n.y)%2)===1?n.y=Math.ceil(n.y)-n.y:n.y=n.y-Math.floor(n.y);break}return this.flipY&&(n.y=1-n.y),n}set needsUpdate(n){n===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(n){n===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(n=0,d=0,C=0,I=1){Vector4.prototype.isVector4=!0,this.x=n,this.y=d,this.z=C,this.w=I}get width(){return this.z}set width(n){this.z=n}get height(){return this.w}set height(n){this.w=n}set(n,d,C,I){return this.x=n,this.y=d,this.z=C,this.w=I,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this.w=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setW(n){return this.w=n,this}setComponent(n,d){switch(n){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w!==void 0?n.w:1,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this}addVectors(n,d){return this.x=n.x+d.x,this.y=n.y+d.y,this.z=n.z+d.z,this.w=n.w+d.w,this}addScaledVector(n,d){return this.x+=n.x*d,this.y+=n.y*d,this.z+=n.z*d,this.w+=n.w*d,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this}subVectors(n,d){return this.x=n.x-d.x,this.y=n.y-d.y,this.z=n.z-d.z,this.w=n.w-d.w,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this}applyMatrix4(n){const d=this.x,C=this.y,I=this.z,f=this.w,y=n.elements;return this.x=y[0]*d+y[4]*C+y[8]*I+y[12]*f,this.y=y[1]*d+y[5]*C+y[9]*I+y[13]*f,this.z=y[2]*d+y[6]*C+y[10]*I+y[14]*f,this.w=y[3]*d+y[7]*C+y[11]*I+y[15]*f,this}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this.w/=n.w,this}divideScalar(n){return this.multiplyScalar(1/n)}setAxisAngleFromQuaternion(n){this.w=2*Math.acos(n.w);const d=Math.sqrt(1-n.w*n.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/d,this.y=n.y/d,this.z=n.z/d),this}setAxisAngleFromRotationMatrix(n){let d,C,I,f;const _=n.elements,Z=_[0],M=_[4],V=_[8],T=_[1],H=_[5],F=_[9],O=_[2],$=_[6],U=_[10];if(Math.abs(M-T)<.01&&Math.abs(V-O)<.01&&Math.abs(F-$)<.01){if(Math.abs(M+T)<.1&&Math.abs(V+O)<.1&&Math.abs(F+$)<.1&&Math.abs(Z+H+U-3)<.1)return this.set(1,0,0,0),this;d=Math.PI;const Q=(Z+1)/2,ie=(H+1)/2,ne=(U+1)/2,le=(M+T)/4,ae=(V+O)/4,ce=(F+$)/4;return Q>ie&&Q>ne?Q<.01?(C=0,I=.707106781,f=.707106781):(C=Math.sqrt(Q),I=le/C,f=ae/C):ie>ne?ie<.01?(C=.707106781,I=0,f=.707106781):(I=Math.sqrt(ie),C=le/I,f=ce/I):ne<.01?(C=.707106781,I=.707106781,f=0):(f=Math.sqrt(ne),C=ae/f,I=ce/f),this.set(C,I,f,d),this}let ee=Math.sqrt(($-F)*($-F)+(V-O)*(V-O)+(T-M)*(T-M));return Math.abs(ee)<.001&&(ee=1),this.x=($-F)/ee,this.y=(V-O)/ee,this.z=(T-M)/ee,this.w=Math.acos((Z+H+U-1)/2),this}setFromMatrixPosition(n){const d=n.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this.w=d[15],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this}clamp(n,d){return this.x=clamp$1(this.x,n.x,d.x),this.y=clamp$1(this.y,n.y,d.y),this.z=clamp$1(this.z,n.z,d.z),this.w=clamp$1(this.w,n.w,d.w),this}clampScalar(n,d){return this.x=clamp$1(this.x,n,d),this.y=clamp$1(this.y,n,d),this.z=clamp$1(this.z,n,d),this.w=clamp$1(this.w,n,d),this}clampLength(n,d){const C=this.length();return this.divideScalar(C||1).multiplyScalar(clamp$1(C,n,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,d){return this.x+=(n.x-this.x)*d,this.y+=(n.y-this.y)*d,this.z+=(n.z-this.z)*d,this.w+=(n.w-this.w)*d,this}lerpVectors(n,d,C){return this.x=n.x+(d.x-n.x)*C,this.y=n.y+(d.y-n.y)*C,this.z=n.z+(d.z-n.z)*C,this.w=n.w+(d.w-n.w)*C,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w}fromArray(n,d=0){return this.x=n[d],this.y=n[d+1],this.z=n[d+2],this.w=n[d+3],this}toArray(n=[],d=0){return n[d]=this.x,n[d+1]=this.y,n[d+2]=this.z,n[d+3]=this.w,n}fromBufferAttribute(n,d){return this.x=n.getX(d),this.y=n.getY(d),this.z=n.getZ(d),this.w=n.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher$1{constructor(n=1,d=1,C={}){super(),this.isRenderTarget=!0,this.width=n,this.height=d,this.depth=1,this.scissor=new Vector4(0,0,n,d),this.scissorTest=!1,this.viewport=new Vector4(0,0,n,d);const I={width:n,height:d,depth:1};C=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},C);const f=new Texture(I,C.mapping,C.wrapS,C.wrapT,C.magFilter,C.minFilter,C.format,C.type,C.anisotropy,C.colorSpace);f.flipY=!1,f.generateMipmaps=C.generateMipmaps,f.internalFormat=C.internalFormat,this.textures=[];const y=C.count;for(let B=0;B<y;B++)this.textures[B]=f.clone(),this.textures[B].isRenderTargetTexture=!0,this.textures[B].renderTarget=this;this.depthBuffer=C.depthBuffer,this.stencilBuffer=C.stencilBuffer,this.resolveDepthBuffer=C.resolveDepthBuffer,this.resolveStencilBuffer=C.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=C.depthTexture,this.samples=C.samples}get texture(){return this.textures[0]}set texture(n){this.textures[0]=n}set depthTexture(n){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),n!==null&&(n.renderTarget=this),this._depthTexture=n}get depthTexture(){return this._depthTexture}setSize(n,d,C=1){if(this.width!==n||this.height!==d||this.depth!==C){this.width=n,this.height=d,this.depth=C;for(let I=0,f=this.textures.length;I<f;I++)this.textures[I].image.width=n,this.textures[I].image.height=d,this.textures[I].image.depth=C;this.dispose()}this.viewport.set(0,0,n,d),this.scissor.set(0,0,n,d)}clone(){return new this.constructor().copy(this)}copy(n){this.width=n.width,this.height=n.height,this.depth=n.depth,this.scissor.copy(n.scissor),this.scissorTest=n.scissorTest,this.viewport.copy(n.viewport),this.textures.length=0;for(let d=0,C=n.textures.length;d<C;d++){this.textures[d]=n.textures[d].clone(),this.textures[d].isRenderTargetTexture=!0,this.textures[d].renderTarget=this;const I=Object.assign({},n.textures[d].image);this.textures[d].source=new Source(I)}return this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.samples=n.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(n=1,d=1,C={}){super(n,d,C),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(n=null,d=1,C=1,I=1){super(null),this.isDataArrayTexture=!0,this.image={data:n,width:d,height:C,depth:I},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(n){this.layerUpdates.add(n)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(n=1,d=1,C=1,I={}){super(n,d,I),this.isWebGLArrayRenderTarget=!0,this.depth=C,this.texture=new DataArrayTexture(null,n,d,C),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(n=null,d=1,C=1,I=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:d,height:C,depth:I},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(n=1,d=1,C=1,I={}){super(n,d,I),this.isWebGL3DRenderTarget=!0,this.depth=C,this.texture=new Data3DTexture(null,n,d,C),this.texture.isRenderTargetTexture=!0}}let Quaternion$2=class{constructor(n=0,d=0,C=0,I=1){this.isQuaternion=!0,this._x=n,this._y=d,this._z=C,this._w=I}static slerpFlat(n,d,C,I,f,y,B){let _=C[I+0],Z=C[I+1],M=C[I+2],V=C[I+3];const T=f[y+0],H=f[y+1],F=f[y+2],O=f[y+3];if(B===0){n[d+0]=_,n[d+1]=Z,n[d+2]=M,n[d+3]=V;return}if(B===1){n[d+0]=T,n[d+1]=H,n[d+2]=F,n[d+3]=O;return}if(V!==O||_!==T||Z!==H||M!==F){let $=1-B;const U=_*T+Z*H+M*F+V*O,ee=U>=0?1:-1,Q=1-U*U;if(Q>Number.EPSILON){const ne=Math.sqrt(Q),le=Math.atan2(ne,U*ee);$=Math.sin($*le)/ne,B=Math.sin(B*le)/ne}const ie=B*ee;if(_=_*$+T*ie,Z=Z*$+H*ie,M=M*$+F*ie,V=V*$+O*ie,$===1-B){const ne=1/Math.sqrt(_*_+Z*Z+M*M+V*V);_*=ne,Z*=ne,M*=ne,V*=ne}}n[d]=_,n[d+1]=Z,n[d+2]=M,n[d+3]=V}static multiplyQuaternionsFlat(n,d,C,I,f,y){const B=C[I],_=C[I+1],Z=C[I+2],M=C[I+3],V=f[y],T=f[y+1],H=f[y+2],F=f[y+3];return n[d]=B*F+M*V+_*H-Z*T,n[d+1]=_*F+M*T+Z*V-B*H,n[d+2]=Z*F+M*H+B*T-_*V,n[d+3]=M*F-B*V-_*T-Z*H,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,d,C,I){return this._x=n,this._y=d,this._z=C,this._w=I,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,d=!0){const C=n._x,I=n._y,f=n._z,y=n._order,B=Math.cos,_=Math.sin,Z=B(C/2),M=B(I/2),V=B(f/2),T=_(C/2),H=_(I/2),F=_(f/2);switch(y){case"XYZ":this._x=T*M*V+Z*H*F,this._y=Z*H*V-T*M*F,this._z=Z*M*F+T*H*V,this._w=Z*M*V-T*H*F;break;case"YXZ":this._x=T*M*V+Z*H*F,this._y=Z*H*V-T*M*F,this._z=Z*M*F-T*H*V,this._w=Z*M*V+T*H*F;break;case"ZXY":this._x=T*M*V-Z*H*F,this._y=Z*H*V+T*M*F,this._z=Z*M*F+T*H*V,this._w=Z*M*V-T*H*F;break;case"ZYX":this._x=T*M*V-Z*H*F,this._y=Z*H*V+T*M*F,this._z=Z*M*F-T*H*V,this._w=Z*M*V+T*H*F;break;case"YZX":this._x=T*M*V+Z*H*F,this._y=Z*H*V+T*M*F,this._z=Z*M*F-T*H*V,this._w=Z*M*V-T*H*F;break;case"XZY":this._x=T*M*V-Z*H*F,this._y=Z*H*V-T*M*F,this._z=Z*M*F+T*H*V,this._w=Z*M*V+T*H*F;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+y)}return d===!0&&this._onChangeCallback(),this}setFromAxisAngle(n,d){const C=d/2,I=Math.sin(C);return this._x=n.x*I,this._y=n.y*I,this._z=n.z*I,this._w=Math.cos(C),this._onChangeCallback(),this}setFromRotationMatrix(n){const d=n.elements,C=d[0],I=d[4],f=d[8],y=d[1],B=d[5],_=d[9],Z=d[2],M=d[6],V=d[10],T=C+B+V;if(T>0){const H=.5/Math.sqrt(T+1);this._w=.25/H,this._x=(M-_)*H,this._y=(f-Z)*H,this._z=(y-I)*H}else if(C>B&&C>V){const H=2*Math.sqrt(1+C-B-V);this._w=(M-_)/H,this._x=.25*H,this._y=(I+y)/H,this._z=(f+Z)/H}else if(B>V){const H=2*Math.sqrt(1+B-C-V);this._w=(f-Z)/H,this._x=(I+y)/H,this._y=.25*H,this._z=(_+M)/H}else{const H=2*Math.sqrt(1+V-C-B);this._w=(y-I)/H,this._x=(f+Z)/H,this._y=(_+M)/H,this._z=.25*H}return this._onChangeCallback(),this}setFromUnitVectors(n,d){let C=n.dot(d)+1;return C<Number.EPSILON?(C=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=C):(this._x=0,this._y=-n.z,this._z=n.y,this._w=C)):(this._x=n.y*d.z-n.z*d.y,this._y=n.z*d.x-n.x*d.z,this._z=n.x*d.y-n.y*d.x,this._w=C),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(clamp$1(this.dot(n),-1,1)))}rotateTowards(n,d){const C=this.angleTo(n);if(C===0)return this;const I=Math.min(1,d/C);return this.slerp(n,I),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,d){const C=n._x,I=n._y,f=n._z,y=n._w,B=d._x,_=d._y,Z=d._z,M=d._w;return this._x=C*M+y*B+I*Z-f*_,this._y=I*M+y*_+f*B-C*Z,this._z=f*M+y*Z+C*_-I*B,this._w=y*M-C*B-I*_-f*Z,this._onChangeCallback(),this}slerp(n,d){if(d===0)return this;if(d===1)return this.copy(n);const C=this._x,I=this._y,f=this._z,y=this._w;let B=y*n._w+C*n._x+I*n._y+f*n._z;if(B<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,B=-B):this.copy(n),B>=1)return this._w=y,this._x=C,this._y=I,this._z=f,this;const _=1-B*B;if(_<=Number.EPSILON){const H=1-d;return this._w=H*y+d*this._w,this._x=H*C+d*this._x,this._y=H*I+d*this._y,this._z=H*f+d*this._z,this.normalize(),this}const Z=Math.sqrt(_),M=Math.atan2(Z,B),V=Math.sin((1-d)*M)/Z,T=Math.sin(d*M)/Z;return this._w=y*V+this._w*T,this._x=C*V+this._x*T,this._y=I*V+this._y*T,this._z=f*V+this._z*T,this._onChangeCallback(),this}slerpQuaternions(n,d,C){return this.copy(n).slerp(d,C)}random(){const n=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),C=Math.random(),I=Math.sqrt(1-C),f=Math.sqrt(C);return this.set(I*Math.sin(n),I*Math.cos(n),f*Math.sin(d),f*Math.cos(d))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,d=0){return this._x=n[d],this._y=n[d+1],this._z=n[d+2],this._w=n[d+3],this._onChangeCallback(),this}toArray(n=[],d=0){return n[d]=this._x,n[d+1]=this._y,n[d+2]=this._z,n[d+3]=this._w,n}fromBufferAttribute(n,d){return this._x=n.getX(d),this._y=n.getY(d),this._z=n.getZ(d),this._w=n.getW(d),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Vector3{constructor(n=0,d=0,C=0){Vector3.prototype.isVector3=!0,this.x=n,this.y=d,this.z=C}set(n,d,C){return C===void 0&&(C=this.z),this.x=n,this.y=d,this.z=C,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setComponent(n,d){switch(n){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this}addVectors(n,d){return this.x=n.x+d.x,this.y=n.y+d.y,this.z=n.z+d.z,this}addScaledVector(n,d){return this.x+=n.x*d,this.y+=n.y*d,this.z+=n.z*d,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this}subVectors(n,d){return this.x=n.x-d.x,this.y=n.y-d.y,this.z=n.z-d.z,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this}multiplyVectors(n,d){return this.x=n.x*d.x,this.y=n.y*d.y,this.z=n.z*d.z,this}applyEuler(n){return this.applyQuaternion(_quaternion$4.setFromEuler(n))}applyAxisAngle(n,d){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(n,d))}applyMatrix3(n){const d=this.x,C=this.y,I=this.z,f=n.elements;return this.x=f[0]*d+f[3]*C+f[6]*I,this.y=f[1]*d+f[4]*C+f[7]*I,this.z=f[2]*d+f[5]*C+f[8]*I,this}applyNormalMatrix(n){return this.applyMatrix3(n).normalize()}applyMatrix4(n){const d=this.x,C=this.y,I=this.z,f=n.elements,y=1/(f[3]*d+f[7]*C+f[11]*I+f[15]);return this.x=(f[0]*d+f[4]*C+f[8]*I+f[12])*y,this.y=(f[1]*d+f[5]*C+f[9]*I+f[13])*y,this.z=(f[2]*d+f[6]*C+f[10]*I+f[14])*y,this}applyQuaternion(n){const d=this.x,C=this.y,I=this.z,f=n.x,y=n.y,B=n.z,_=n.w,Z=2*(y*I-B*C),M=2*(B*d-f*I),V=2*(f*C-y*d);return this.x=d+_*Z+y*V-B*M,this.y=C+_*M+B*Z-f*V,this.z=I+_*V+f*M-y*Z,this}project(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)}unproject(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)}transformDirection(n){const d=this.x,C=this.y,I=this.z,f=n.elements;return this.x=f[0]*d+f[4]*C+f[8]*I,this.y=f[1]*d+f[5]*C+f[9]*I,this.z=f[2]*d+f[6]*C+f[10]*I,this.normalize()}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this}divideScalar(n){return this.multiplyScalar(1/n)}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this}clamp(n,d){return this.x=clamp$1(this.x,n.x,d.x),this.y=clamp$1(this.y,n.y,d.y),this.z=clamp$1(this.z,n.z,d.z),this}clampScalar(n,d){return this.x=clamp$1(this.x,n,d),this.y=clamp$1(this.y,n,d),this.z=clamp$1(this.z,n,d),this}clampLength(n,d){const C=this.length();return this.divideScalar(C||1).multiplyScalar(clamp$1(C,n,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,d){return this.x+=(n.x-this.x)*d,this.y+=(n.y-this.y)*d,this.z+=(n.z-this.z)*d,this}lerpVectors(n,d,C){return this.x=n.x+(d.x-n.x)*C,this.y=n.y+(d.y-n.y)*C,this.z=n.z+(d.z-n.z)*C,this}cross(n){return this.crossVectors(this,n)}crossVectors(n,d){const C=n.x,I=n.y,f=n.z,y=d.x,B=d.y,_=d.z;return this.x=I*_-f*B,this.y=f*y-C*_,this.z=C*B-I*y,this}projectOnVector(n){const d=n.lengthSq();if(d===0)return this.set(0,0,0);const C=n.dot(this)/d;return this.copy(n).multiplyScalar(C)}projectOnPlane(n){return _vector$c.copy(this).projectOnVector(n),this.sub(_vector$c)}reflect(n){return this.sub(_vector$c.copy(n).multiplyScalar(2*this.dot(n)))}angleTo(n){const d=Math.sqrt(this.lengthSq()*n.lengthSq());if(d===0)return Math.PI/2;const C=this.dot(n)/d;return Math.acos(clamp$1(C,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const d=this.x-n.x,C=this.y-n.y,I=this.z-n.z;return d*d+C*C+I*I}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)}setFromSpherical(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)}setFromSphericalCoords(n,d,C){const I=Math.sin(d)*n;return this.x=I*Math.sin(C),this.y=Math.cos(d)*n,this.z=I*Math.cos(C),this}setFromCylindrical(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)}setFromCylindricalCoords(n,d,C){return this.x=n*Math.sin(d),this.y=C,this.z=n*Math.cos(d),this}setFromMatrixPosition(n){const d=n.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(n){const d=this.setFromMatrixColumn(n,0).length(),C=this.setFromMatrixColumn(n,1).length(),I=this.setFromMatrixColumn(n,2).length();return this.x=d,this.y=C,this.z=I,this}setFromMatrixColumn(n,d){return this.fromArray(n.elements,d*4)}setFromMatrix3Column(n,d){return this.fromArray(n.elements,d*3)}setFromEuler(n){return this.x=n._x,this.y=n._y,this.z=n._z,this}setFromColor(n){return this.x=n.r,this.y=n.g,this.z=n.b,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z}fromArray(n,d=0){return this.x=n[d],this.y=n[d+1],this.z=n[d+2],this}toArray(n=[],d=0){return n[d]=this.x,n[d+1]=this.y,n[d+2]=this.z,n}fromBufferAttribute(n,d){return this.x=n.getX(d),this.y=n.getY(d),this.z=n.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const n=Math.random()*Math.PI*2,d=Math.random()*2-1,C=Math.sqrt(1-d*d);return this.x=C*Math.cos(n),this.y=d,this.z=C*Math.sin(n),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new Vector3,_quaternion$4=new Quaternion$2;class Box3{constructor(n=new Vector3(1/0,1/0,1/0),d=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=d}set(n,d){return this.min.copy(n),this.max.copy(d),this}setFromArray(n){this.makeEmpty();for(let d=0,C=n.length;d<C;d+=3)this.expandByPoint(_vector$b.fromArray(n,d));return this}setFromBufferAttribute(n){this.makeEmpty();for(let d=0,C=n.count;d<C;d++)this.expandByPoint(_vector$b.fromBufferAttribute(n,d));return this}setFromPoints(n){this.makeEmpty();for(let d=0,C=n.length;d<C;d++)this.expandByPoint(n[d]);return this}setFromCenterAndSize(n,d){const C=_vector$b.copy(d).multiplyScalar(.5);return this.min.copy(n).sub(C),this.max.copy(n).add(C),this}setFromObject(n,d=!1){return this.makeEmpty(),this.expandByObject(n,d)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,d=!1){n.updateWorldMatrix(!1,!1);const C=n.geometry;if(C!==void 0){const f=C.getAttribute("position");if(d===!0&&f!==void 0&&n.isInstancedMesh!==!0)for(let y=0,B=f.count;y<B;y++)n.isMesh===!0?n.getVertexPosition(y,_vector$b):_vector$b.fromBufferAttribute(f,y),_vector$b.applyMatrix4(n.matrixWorld),this.expandByPoint(_vector$b);else n.boundingBox!==void 0?(n.boundingBox===null&&n.computeBoundingBox(),_box$4.copy(n.boundingBox)):(C.boundingBox===null&&C.computeBoundingBox(),_box$4.copy(C.boundingBox)),_box$4.applyMatrix4(n.matrixWorld),this.union(_box$4)}const I=n.children;for(let f=0,y=I.length;f<y;f++)this.expandByObject(I[f],d);return this}containsPoint(n){return n.x>=this.min.x&&n.x<=this.max.x&&n.y>=this.min.y&&n.y<=this.max.y&&n.z>=this.min.z&&n.z<=this.max.z}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,d){return d.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return n.max.x>=this.min.x&&n.min.x<=this.max.x&&n.max.y>=this.min.y&&n.min.y<=this.max.y&&n.max.z>=this.min.z&&n.min.z<=this.max.z}intersectsSphere(n){return this.clampPoint(n.center,_vector$b),_vector$b.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let d,C;return n.normal.x>0?(d=n.normal.x*this.min.x,C=n.normal.x*this.max.x):(d=n.normal.x*this.max.x,C=n.normal.x*this.min.x),n.normal.y>0?(d+=n.normal.y*this.min.y,C+=n.normal.y*this.max.y):(d+=n.normal.y*this.max.y,C+=n.normal.y*this.min.y),n.normal.z>0?(d+=n.normal.z*this.min.z,C+=n.normal.z*this.max.z):(d+=n.normal.z*this.max.z,C+=n.normal.z*this.min.z),d<=-n.constant&&C>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(n.a,_center),_v1$7.subVectors(n.b,_center),_v2$4.subVectors(n.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let d=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(d,_v0$2,_v1$7,_v2$4,_extents)||(d=[1,0,0,0,1,0,0,0,1],!satForAxes(d,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),d=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(d,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(n,d){return d.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,_vector$b).distanceTo(n)}getBoundingSphere(n){return this.isEmpty()?n.makeEmpty():(this.getCenter(n.center),n.radius=this.getSize(_vector$b).length()*.5),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(_points),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(u,n,d,C,I){for(let f=0,y=u.length-3;f<=y;f+=3){_testAxis.fromArray(u,f);const B=I.x*Math.abs(_testAxis.x)+I.y*Math.abs(_testAxis.y)+I.z*Math.abs(_testAxis.z),_=n.dot(_testAxis),Z=d.dot(_testAxis),M=C.dot(_testAxis);if(Math.max(-Math.max(_,Z,M),Math.min(_,Z,M))>B)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;let Sphere$1=class{constructor(n=new Vector3,d=-1){this.isSphere=!0,this.center=n,this.radius=d}set(n,d){return this.center.copy(n),this.radius=d,this}setFromPoints(n,d){const C=this.center;d!==void 0?C.copy(d):_box$3.setFromPoints(n).getCenter(C);let I=0;for(let f=0,y=n.length;f<y;f++)I=Math.max(I,C.distanceToSquared(n[f]));return this.radius=Math.sqrt(I),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const d=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=d*d}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,d){const C=this.center.distanceToSquared(n);return d.copy(n),C>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;_v1$6.subVectors(n,this.center);const d=_v1$6.lengthSq();if(d>this.radius*this.radius){const C=Math.sqrt(d),I=(C-this.radius)*.5;this.center.addScaledVector(_v1$6,I/C),this.radius+=I}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(_v2$3.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(_v1$6.copy(n.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(n.center).sub(_v2$3))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}};const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$2=class{constructor(n=new Vector3,d=new Vector3(0,0,-1)){this.origin=n,this.direction=d}set(n,d){return this.origin.copy(n),this.direction.copy(d),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,d){return d.copy(this.origin).addScaledVector(this.direction,n)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,_vector$a)),this}closestPointToPoint(n,d){d.subVectors(n,this.origin);const C=d.dot(this.direction);return C<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,C)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const d=_vector$a.subVectors(n,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(n):(_vector$a.copy(this.origin).addScaledVector(this.direction,d),_vector$a.distanceToSquared(n))}distanceSqToSegment(n,d,C,I){_segCenter.copy(n).add(d).multiplyScalar(.5),_segDir.copy(d).sub(n).normalize(),_diff.copy(this.origin).sub(_segCenter);const f=n.distanceTo(d)*.5,y=-this.direction.dot(_segDir),B=_diff.dot(this.direction),_=-_diff.dot(_segDir),Z=_diff.lengthSq(),M=Math.abs(1-y*y);let V,T,H,F;if(M>0)if(V=y*_-B,T=y*B-_,F=f*M,V>=0)if(T>=-F)if(T<=F){const O=1/M;V*=O,T*=O,H=V*(V+y*T+2*B)+T*(y*V+T+2*_)+Z}else T=f,V=Math.max(0,-(y*T+B)),H=-V*V+T*(T+2*_)+Z;else T=-f,V=Math.max(0,-(y*T+B)),H=-V*V+T*(T+2*_)+Z;else T<=-F?(V=Math.max(0,-(-y*f+B)),T=V>0?-f:Math.min(Math.max(-f,-_),f),H=-V*V+T*(T+2*_)+Z):T<=F?(V=0,T=Math.min(Math.max(-f,-_),f),H=T*(T+2*_)+Z):(V=Math.max(0,-(y*f+B)),T=V>0?f:Math.min(Math.max(-f,-_),f),H=-V*V+T*(T+2*_)+Z);else T=y>0?-f:f,V=Math.max(0,-(y*T+B)),H=-V*V+T*(T+2*_)+Z;return C&&C.copy(this.origin).addScaledVector(this.direction,V),I&&I.copy(_segCenter).addScaledVector(_segDir,T),H}intersectSphere(n,d){_vector$a.subVectors(n.center,this.origin);const C=_vector$a.dot(this.direction),I=_vector$a.dot(_vector$a)-C*C,f=n.radius*n.radius;if(I>f)return null;const y=Math.sqrt(f-I),B=C-y,_=C+y;return _<0?null:B<0?this.at(_,d):this.at(B,d)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const d=n.normal.dot(this.direction);if(d===0)return n.distanceToPoint(this.origin)===0?0:null;const C=-(this.origin.dot(n.normal)+n.constant)/d;return C>=0?C:null}intersectPlane(n,d){const C=this.distanceToPlane(n);return C===null?null:this.at(C,d)}intersectsPlane(n){const d=n.distanceToPoint(this.origin);return d===0||n.normal.dot(this.direction)*d<0}intersectBox(n,d){let C,I,f,y,B,_;const Z=1/this.direction.x,M=1/this.direction.y,V=1/this.direction.z,T=this.origin;return Z>=0?(C=(n.min.x-T.x)*Z,I=(n.max.x-T.x)*Z):(C=(n.max.x-T.x)*Z,I=(n.min.x-T.x)*Z),M>=0?(f=(n.min.y-T.y)*M,y=(n.max.y-T.y)*M):(f=(n.max.y-T.y)*M,y=(n.min.y-T.y)*M),C>y||f>I||((f>C||isNaN(C))&&(C=f),(y<I||isNaN(I))&&(I=y),V>=0?(B=(n.min.z-T.z)*V,_=(n.max.z-T.z)*V):(B=(n.max.z-T.z)*V,_=(n.min.z-T.z)*V),C>_||B>I)||((B>C||C!==C)&&(C=B),(_<I||I!==I)&&(I=_),I<0)?null:this.at(C>=0?C:I,d)}intersectsBox(n){return this.intersectBox(n,_vector$a)!==null}intersectTriangle(n,d,C,I,f){_edge1.subVectors(d,n),_edge2.subVectors(C,n),_normal$1.crossVectors(_edge1,_edge2);let y=this.direction.dot(_normal$1),B;if(y>0){if(I)return null;B=1}else if(y<0)B=-1,y=-y;else return null;_diff.subVectors(this.origin,n);const _=B*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(_<0)return null;const Z=B*this.direction.dot(_edge1.cross(_diff));if(Z<0||_+Z>y)return null;const M=-B*_diff.dot(_normal$1);return M<0?null:this.at(M/y,f)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n!==void 0&&this.set(n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$)}set(n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$){const U=this.elements;return U[0]=n,U[4]=d,U[8]=C,U[12]=I,U[1]=f,U[5]=y,U[9]=B,U[13]=_,U[2]=Z,U[6]=M,U[10]=V,U[14]=T,U[3]=H,U[7]=F,U[11]=O,U[15]=$,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(n){const d=this.elements,C=n.elements;return d[0]=C[0],d[1]=C[1],d[2]=C[2],d[3]=C[3],d[4]=C[4],d[5]=C[5],d[6]=C[6],d[7]=C[7],d[8]=C[8],d[9]=C[9],d[10]=C[10],d[11]=C[11],d[12]=C[12],d[13]=C[13],d[14]=C[14],d[15]=C[15],this}copyPosition(n){const d=this.elements,C=n.elements;return d[12]=C[12],d[13]=C[13],d[14]=C[14],this}setFromMatrix3(n){const d=n.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(n,d,C){return n.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),C.setFromMatrixColumn(this,2),this}makeBasis(n,d,C){return this.set(n.x,d.x,C.x,0,n.y,d.y,C.y,0,n.z,d.z,C.z,0,0,0,0,1),this}extractRotation(n){const d=this.elements,C=n.elements,I=1/_v1$5.setFromMatrixColumn(n,0).length(),f=1/_v1$5.setFromMatrixColumn(n,1).length(),y=1/_v1$5.setFromMatrixColumn(n,2).length();return d[0]=C[0]*I,d[1]=C[1]*I,d[2]=C[2]*I,d[3]=0,d[4]=C[4]*f,d[5]=C[5]*f,d[6]=C[6]*f,d[7]=0,d[8]=C[8]*y,d[9]=C[9]*y,d[10]=C[10]*y,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(n){const d=this.elements,C=n.x,I=n.y,f=n.z,y=Math.cos(C),B=Math.sin(C),_=Math.cos(I),Z=Math.sin(I),M=Math.cos(f),V=Math.sin(f);if(n.order==="XYZ"){const T=y*M,H=y*V,F=B*M,O=B*V;d[0]=_*M,d[4]=-_*V,d[8]=Z,d[1]=H+F*Z,d[5]=T-O*Z,d[9]=-B*_,d[2]=O-T*Z,d[6]=F+H*Z,d[10]=y*_}else if(n.order==="YXZ"){const T=_*M,H=_*V,F=Z*M,O=Z*V;d[0]=T+O*B,d[4]=F*B-H,d[8]=y*Z,d[1]=y*V,d[5]=y*M,d[9]=-B,d[2]=H*B-F,d[6]=O+T*B,d[10]=y*_}else if(n.order==="ZXY"){const T=_*M,H=_*V,F=Z*M,O=Z*V;d[0]=T-O*B,d[4]=-y*V,d[8]=F+H*B,d[1]=H+F*B,d[5]=y*M,d[9]=O-T*B,d[2]=-y*Z,d[6]=B,d[10]=y*_}else if(n.order==="ZYX"){const T=y*M,H=y*V,F=B*M,O=B*V;d[0]=_*M,d[4]=F*Z-H,d[8]=T*Z+O,d[1]=_*V,d[5]=O*Z+T,d[9]=H*Z-F,d[2]=-Z,d[6]=B*_,d[10]=y*_}else if(n.order==="YZX"){const T=y*_,H=y*Z,F=B*_,O=B*Z;d[0]=_*M,d[4]=O-T*V,d[8]=F*V+H,d[1]=V,d[5]=y*M,d[9]=-B*M,d[2]=-Z*M,d[6]=H*V+F,d[10]=T-O*V}else if(n.order==="XZY"){const T=y*_,H=y*Z,F=B*_,O=B*Z;d[0]=_*M,d[4]=-V,d[8]=Z*M,d[1]=T*V+O,d[5]=y*M,d[9]=H*V-F,d[2]=F*V-H,d[6]=B*M,d[10]=O*V+T}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(n){return this.compose(_zero,n,_one)}lookAt(n,d,C){const I=this.elements;return _z.subVectors(n,d),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(C,_z),_x.lengthSq()===0&&(Math.abs(C.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(C,_z)),_x.normalize(),_y.crossVectors(_z,_x),I[0]=_x.x,I[4]=_y.x,I[8]=_z.x,I[1]=_x.y,I[5]=_y.y,I[9]=_z.y,I[2]=_x.z,I[6]=_y.z,I[10]=_z.z,this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,d){const C=n.elements,I=d.elements,f=this.elements,y=C[0],B=C[4],_=C[8],Z=C[12],M=C[1],V=C[5],T=C[9],H=C[13],F=C[2],O=C[6],$=C[10],U=C[14],ee=C[3],Q=C[7],ie=C[11],ne=C[15],le=I[0],ae=I[4],ce=I[8],ge=I[12],he=I[1],Ie=I[5],fe=I[9],me=I[13],Ge=I[2],Ze=I[6],ye=I[10],Ee=I[14],Ve=I[3],Ye=I[7],be=I[11],Be=I[15];return f[0]=y*le+B*he+_*Ge+Z*Ve,f[4]=y*ae+B*Ie+_*Ze+Z*Ye,f[8]=y*ce+B*fe+_*ye+Z*be,f[12]=y*ge+B*me+_*Ee+Z*Be,f[1]=M*le+V*he+T*Ge+H*Ve,f[5]=M*ae+V*Ie+T*Ze+H*Ye,f[9]=M*ce+V*fe+T*ye+H*be,f[13]=M*ge+V*me+T*Ee+H*Be,f[2]=F*le+O*he+$*Ge+U*Ve,f[6]=F*ae+O*Ie+$*Ze+U*Ye,f[10]=F*ce+O*fe+$*ye+U*be,f[14]=F*ge+O*me+$*Ee+U*Be,f[3]=ee*le+Q*he+ie*Ge+ne*Ve,f[7]=ee*ae+Q*Ie+ie*Ze+ne*Ye,f[11]=ee*ce+Q*fe+ie*ye+ne*be,f[15]=ee*ge+Q*me+ie*Ee+ne*Be,this}multiplyScalar(n){const d=this.elements;return d[0]*=n,d[4]*=n,d[8]*=n,d[12]*=n,d[1]*=n,d[5]*=n,d[9]*=n,d[13]*=n,d[2]*=n,d[6]*=n,d[10]*=n,d[14]*=n,d[3]*=n,d[7]*=n,d[11]*=n,d[15]*=n,this}determinant(){const n=this.elements,d=n[0],C=n[4],I=n[8],f=n[12],y=n[1],B=n[5],_=n[9],Z=n[13],M=n[2],V=n[6],T=n[10],H=n[14],F=n[3],O=n[7],$=n[11],U=n[15];return F*(+f*_*V-I*Z*V-f*B*T+C*Z*T+I*B*H-C*_*H)+O*(+d*_*H-d*Z*T+f*y*T-I*y*H+I*Z*M-f*_*M)+$*(+d*Z*V-d*B*H-f*y*V+C*y*H+f*B*M-C*Z*M)+U*(-I*B*M-d*_*V+d*B*T+I*y*V-C*y*T+C*_*M)}transpose(){const n=this.elements;let d;return d=n[1],n[1]=n[4],n[4]=d,d=n[2],n[2]=n[8],n[8]=d,d=n[6],n[6]=n[9],n[9]=d,d=n[3],n[3]=n[12],n[12]=d,d=n[7],n[7]=n[13],n[13]=d,d=n[11],n[11]=n[14],n[14]=d,this}setPosition(n,d,C){const I=this.elements;return n.isVector3?(I[12]=n.x,I[13]=n.y,I[14]=n.z):(I[12]=n,I[13]=d,I[14]=C),this}invert(){const n=this.elements,d=n[0],C=n[1],I=n[2],f=n[3],y=n[4],B=n[5],_=n[6],Z=n[7],M=n[8],V=n[9],T=n[10],H=n[11],F=n[12],O=n[13],$=n[14],U=n[15],ee=V*$*Z-O*T*Z+O*_*H-B*$*H-V*_*U+B*T*U,Q=F*T*Z-M*$*Z-F*_*H+y*$*H+M*_*U-y*T*U,ie=M*O*Z-F*V*Z+F*B*H-y*O*H-M*B*U+y*V*U,ne=F*V*_-M*O*_-F*B*T+y*O*T+M*B*$-y*V*$,le=d*ee+C*Q+I*ie+f*ne;if(le===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ae=1/le;return n[0]=ee*ae,n[1]=(O*T*f-V*$*f-O*I*H+C*$*H+V*I*U-C*T*U)*ae,n[2]=(B*$*f-O*_*f+O*I*Z-C*$*Z-B*I*U+C*_*U)*ae,n[3]=(V*_*f-B*T*f-V*I*Z+C*T*Z+B*I*H-C*_*H)*ae,n[4]=Q*ae,n[5]=(M*$*f-F*T*f+F*I*H-d*$*H-M*I*U+d*T*U)*ae,n[6]=(F*_*f-y*$*f-F*I*Z+d*$*Z+y*I*U-d*_*U)*ae,n[7]=(y*T*f-M*_*f+M*I*Z-d*T*Z-y*I*H+d*_*H)*ae,n[8]=ie*ae,n[9]=(F*V*f-M*O*f-F*C*H+d*O*H+M*C*U-d*V*U)*ae,n[10]=(y*O*f-F*B*f+F*C*Z-d*O*Z-y*C*U+d*B*U)*ae,n[11]=(M*B*f-y*V*f-M*C*Z+d*V*Z+y*C*H-d*B*H)*ae,n[12]=ne*ae,n[13]=(M*O*I-F*V*I+F*C*T-d*O*T-M*C*$+d*V*$)*ae,n[14]=(F*B*I-y*O*I-F*C*_+d*O*_+y*C*$-d*B*$)*ae,n[15]=(y*V*I-M*B*I+M*C*_-d*V*_-y*C*T+d*B*T)*ae,this}scale(n){const d=this.elements,C=n.x,I=n.y,f=n.z;return d[0]*=C,d[4]*=I,d[8]*=f,d[1]*=C,d[5]*=I,d[9]*=f,d[2]*=C,d[6]*=I,d[10]*=f,d[3]*=C,d[7]*=I,d[11]*=f,this}getMaxScaleOnAxis(){const n=this.elements,d=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],C=n[4]*n[4]+n[5]*n[5]+n[6]*n[6],I=n[8]*n[8]+n[9]*n[9]+n[10]*n[10];return Math.sqrt(Math.max(d,C,I))}makeTranslation(n,d,C){return n.isVector3?this.set(1,0,0,n.x,0,1,0,n.y,0,0,1,n.z,0,0,0,1):this.set(1,0,0,n,0,1,0,d,0,0,1,C,0,0,0,1),this}makeRotationX(n){const d=Math.cos(n),C=Math.sin(n);return this.set(1,0,0,0,0,d,-C,0,0,C,d,0,0,0,0,1),this}makeRotationY(n){const d=Math.cos(n),C=Math.sin(n);return this.set(d,0,C,0,0,1,0,0,-C,0,d,0,0,0,0,1),this}makeRotationZ(n){const d=Math.cos(n),C=Math.sin(n);return this.set(d,-C,0,0,C,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(n,d){const C=Math.cos(d),I=Math.sin(d),f=1-C,y=n.x,B=n.y,_=n.z,Z=f*y,M=f*B;return this.set(Z*y+C,Z*B-I*_,Z*_+I*B,0,Z*B+I*_,M*B+C,M*_-I*y,0,Z*_-I*B,M*_+I*y,f*_*_+C,0,0,0,0,1),this}makeScale(n,d,C){return this.set(n,0,0,0,0,d,0,0,0,0,C,0,0,0,0,1),this}makeShear(n,d,C,I,f,y){return this.set(1,C,f,0,n,1,y,0,d,I,1,0,0,0,0,1),this}compose(n,d,C){const I=this.elements,f=d._x,y=d._y,B=d._z,_=d._w,Z=f+f,M=y+y,V=B+B,T=f*Z,H=f*M,F=f*V,O=y*M,$=y*V,U=B*V,ee=_*Z,Q=_*M,ie=_*V,ne=C.x,le=C.y,ae=C.z;return I[0]=(1-(O+U))*ne,I[1]=(H+ie)*ne,I[2]=(F-Q)*ne,I[3]=0,I[4]=(H-ie)*le,I[5]=(1-(T+U))*le,I[6]=($+ee)*le,I[7]=0,I[8]=(F+Q)*ae,I[9]=($-ee)*ae,I[10]=(1-(T+O))*ae,I[11]=0,I[12]=n.x,I[13]=n.y,I[14]=n.z,I[15]=1,this}decompose(n,d,C){const I=this.elements;let f=_v1$5.set(I[0],I[1],I[2]).length();const y=_v1$5.set(I[4],I[5],I[6]).length(),B=_v1$5.set(I[8],I[9],I[10]).length();this.determinant()<0&&(f=-f),n.x=I[12],n.y=I[13],n.z=I[14],_m1$2.copy(this);const Z=1/f,M=1/y,V=1/B;return _m1$2.elements[0]*=Z,_m1$2.elements[1]*=Z,_m1$2.elements[2]*=Z,_m1$2.elements[4]*=M,_m1$2.elements[5]*=M,_m1$2.elements[6]*=M,_m1$2.elements[8]*=V,_m1$2.elements[9]*=V,_m1$2.elements[10]*=V,d.setFromRotationMatrix(_m1$2),C.x=f,C.y=y,C.z=B,this}makePerspective(n,d,C,I,f,y,B=WebGLCoordinateSystem){const _=this.elements,Z=2*f/(d-n),M=2*f/(C-I),V=(d+n)/(d-n),T=(C+I)/(C-I);let H,F;if(B===WebGLCoordinateSystem)H=-(y+f)/(y-f),F=-2*y*f/(y-f);else if(B===WebGPUCoordinateSystem)H=-y/(y-f),F=-y*f/(y-f);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+B);return _[0]=Z,_[4]=0,_[8]=V,_[12]=0,_[1]=0,_[5]=M,_[9]=T,_[13]=0,_[2]=0,_[6]=0,_[10]=H,_[14]=F,_[3]=0,_[7]=0,_[11]=-1,_[15]=0,this}makeOrthographic(n,d,C,I,f,y,B=WebGLCoordinateSystem){const _=this.elements,Z=1/(d-n),M=1/(C-I),V=1/(y-f),T=(d+n)*Z,H=(C+I)*M;let F,O;if(B===WebGLCoordinateSystem)F=(y+f)*V,O=-2*V;else if(B===WebGPUCoordinateSystem)F=f*V,O=-1*V;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+B);return _[0]=2*Z,_[4]=0,_[8]=0,_[12]=-T,_[1]=0,_[5]=2*M,_[9]=0,_[13]=-H,_[2]=0,_[6]=0,_[10]=O,_[14]=-F,_[3]=0,_[7]=0,_[11]=0,_[15]=1,this}equals(n){const d=this.elements,C=n.elements;for(let I=0;I<16;I++)if(d[I]!==C[I])return!1;return!0}fromArray(n,d=0){for(let C=0;C<16;C++)this.elements[C]=n[C+d];return this}toArray(n=[],d=0){const C=this.elements;return n[d]=C[0],n[d+1]=C[1],n[d+2]=C[2],n[d+3]=C[3],n[d+4]=C[4],n[d+5]=C[5],n[d+6]=C[6],n[d+7]=C[7],n[d+8]=C[8],n[d+9]=C[9],n[d+10]=C[10],n[d+11]=C[11],n[d+12]=C[12],n[d+13]=C[13],n[d+14]=C[14],n[d+15]=C[15],n}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion$2;class Euler{constructor(n=0,d=0,C=0,I=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=n,this._y=d,this._z=C,this._order=I}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get order(){return this._order}set order(n){this._order=n,this._onChangeCallback()}set(n,d,C,I=this._order){return this._x=n,this._y=d,this._z=C,this._order=I,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this}setFromRotationMatrix(n,d=this._order,C=!0){const I=n.elements,f=I[0],y=I[4],B=I[8],_=I[1],Z=I[5],M=I[9],V=I[2],T=I[6],H=I[10];switch(d){case"XYZ":this._y=Math.asin(clamp$1(B,-1,1)),Math.abs(B)<.9999999?(this._x=Math.atan2(-M,H),this._z=Math.atan2(-y,f)):(this._x=Math.atan2(T,Z),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$1(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(B,H),this._z=Math.atan2(_,Z)):(this._y=Math.atan2(-V,f),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$1(T,-1,1)),Math.abs(T)<.9999999?(this._y=Math.atan2(-V,H),this._z=Math.atan2(-y,Z)):(this._y=0,this._z=Math.atan2(_,f));break;case"ZYX":this._y=Math.asin(-clamp$1(V,-1,1)),Math.abs(V)<.9999999?(this._x=Math.atan2(T,H),this._z=Math.atan2(_,f)):(this._x=0,this._z=Math.atan2(-y,Z));break;case"YZX":this._z=Math.asin(clamp$1(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-M,Z),this._y=Math.atan2(-V,f)):(this._x=0,this._y=Math.atan2(B,H));break;case"XZY":this._z=Math.asin(-clamp$1(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(T,Z),this._y=Math.atan2(B,f)):(this._x=Math.atan2(-M,H),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,C===!0&&this._onChangeCallback(),this}setFromQuaternion(n,d,C){return _matrix$2.makeRotationFromQuaternion(n),this.setFromRotationMatrix(_matrix$2,d,C)}setFromVector3(n,d=this._order){return this.set(n.x,n.y,n.z,d)}reorder(n){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,n)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order}fromArray(n){return this._x=n[0],this._y=n[1],this._z=n[2],n[3]!==void 0&&(this._order=n[3]),this._onChangeCallback(),this}toArray(n=[],d=0){return n[d]=this._x,n[d+1]=this._y,n[d+2]=this._z,n[d+3]=this._order,n}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}isEnabled(n){return(this.mask&(1<<n|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$2,_m1$1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$2,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher$1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const n=new Vector3,d=new Euler,C=new Quaternion$2,I=new Vector3(1,1,1);function f(){C.setFromEuler(d,!1)}function y(){d.setFromQuaternion(C,void 0,!1)}d._onChange(f),C._onChange(y),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:C},scale:{configurable:!0,enumerable:!0,value:I},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(n){return this.quaternion.premultiply(n),this}setRotationFromAxisAngle(n,d){this.quaternion.setFromAxisAngle(n,d)}setRotationFromEuler(n){this.quaternion.setFromEuler(n,!0)}setRotationFromMatrix(n){this.quaternion.setFromRotationMatrix(n)}setRotationFromQuaternion(n){this.quaternion.copy(n)}rotateOnAxis(n,d){return _q1.setFromAxisAngle(n,d),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(n,d){return _q1.setFromAxisAngle(n,d),this.quaternion.premultiply(_q1),this}rotateX(n){return this.rotateOnAxis(_xAxis,n)}rotateY(n){return this.rotateOnAxis(_yAxis,n)}rotateZ(n){return this.rotateOnAxis(_zAxis,n)}translateOnAxis(n,d){return _v1$4.copy(n).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(d)),this}translateX(n){return this.translateOnAxis(_xAxis,n)}translateY(n){return this.translateOnAxis(_yAxis,n)}translateZ(n){return this.translateOnAxis(_zAxis,n)}localToWorld(n){return this.updateWorldMatrix(!0,!1),n.applyMatrix4(this.matrixWorld)}worldToLocal(n){return this.updateWorldMatrix(!0,!1),n.applyMatrix4(_m1$1$1.copy(this.matrixWorld).invert())}lookAt(n,d,C){n.isVector3?_target.copy(n):_target.set(n,d,C);const I=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1$1.lookAt(_position$3,_target,this.up):_m1$1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1$1),I&&(_m1$1$1.extractRotation(I.matrixWorld),_q1.setFromRotationMatrix(_m1$1$1),this.quaternion.premultiply(_q1.invert()))}add(n){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(n.removeFromParent(),n.parent=this,this.children.push(n),n.dispatchEvent(_addedEvent),_childaddedEvent.child=n,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)}remove(n){if(arguments.length>1){for(let C=0;C<arguments.length;C++)this.remove(arguments[C]);return this}const d=this.children.indexOf(n);return d!==-1&&(n.parent=null,this.children.splice(d,1),n.dispatchEvent(_removedEvent),_childremovedEvent.child=n,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const n=this.parent;return n!==null&&n.remove(this),this}clear(){return this.remove(...this.children)}attach(n){return this.updateWorldMatrix(!0,!1),_m1$1$1.copy(this.matrixWorld).invert(),n.parent!==null&&(n.parent.updateWorldMatrix(!0,!1),_m1$1$1.multiply(n.parent.matrixWorld)),n.applyMatrix4(_m1$1$1),n.removeFromParent(),n.parent=this,this.children.push(n),n.updateWorldMatrix(!1,!0),n.dispatchEvent(_addedEvent),_childaddedEvent.child=n,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(n){return this.getObjectByProperty("id",n)}getObjectByName(n){return this.getObjectByProperty("name",n)}getObjectByProperty(n,d){if(this[n]===d)return this;for(let C=0,I=this.children.length;C<I;C++){const y=this.children[C].getObjectByProperty(n,d);if(y!==void 0)return y}}getObjectsByProperty(n,d,C=[]){this[n]===d&&C.push(this);const I=this.children;for(let f=0,y=I.length;f<y;f++)I[f].getObjectsByProperty(n,d,C);return C}getWorldPosition(n){return this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,n,_scale$2),n}getWorldScale(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,n),n}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return n.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(n){n(this);const d=this.children;for(let C=0,I=d.length;C<I;C++)d[C].traverse(n)}traverseVisible(n){if(this.visible===!1)return;n(this);const d=this.children;for(let C=0,I=d.length;C<I;C++)d[C].traverseVisible(n)}traverseAncestors(n){const d=this.parent;d!==null&&(n(d),d.traverseAncestors(n))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,n=!0);const d=this.children;for(let C=0,I=d.length;C<I;C++)d[C].updateMatrixWorld(n)}updateWorldMatrix(n,d){const C=this.parent;if(n===!0&&C!==null&&C.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),d===!0){const I=this.children;for(let f=0,y=I.length;f<y;f++)I[f].updateWorldMatrix(!1,!0)}}toJSON(n){const d=n===void 0||typeof n=="string",C={};d&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},C.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const I={};I.uuid=this.uuid,I.type=this.type,this.name!==""&&(I.name=this.name),this.castShadow===!0&&(I.castShadow=!0),this.receiveShadow===!0&&(I.receiveShadow=!0),this.visible===!1&&(I.visible=!1),this.frustumCulled===!1&&(I.frustumCulled=!1),this.renderOrder!==0&&(I.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(I.userData=this.userData),I.layers=this.layers.mask,I.matrix=this.matrix.toArray(),I.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(I.matrixAutoUpdate=!1),this.isInstancedMesh&&(I.type="InstancedMesh",I.count=this.count,I.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(I.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(I.type="BatchedMesh",I.perObjectFrustumCulled=this.perObjectFrustumCulled,I.sortObjects=this.sortObjects,I.drawRanges=this._drawRanges,I.reservedRanges=this._reservedRanges,I.visibility=this._visibility,I.active=this._active,I.bounds=this._bounds.map(B=>({boxInitialized:B.boxInitialized,boxMin:B.box.min.toArray(),boxMax:B.box.max.toArray(),sphereInitialized:B.sphereInitialized,sphereRadius:B.sphere.radius,sphereCenter:B.sphere.center.toArray()})),I.maxInstanceCount=this._maxInstanceCount,I.maxVertexCount=this._maxVertexCount,I.maxIndexCount=this._maxIndexCount,I.geometryInitialized=this._geometryInitialized,I.geometryCount=this._geometryCount,I.matricesTexture=this._matricesTexture.toJSON(n),this._colorsTexture!==null&&(I.colorsTexture=this._colorsTexture.toJSON(n)),this.boundingSphere!==null&&(I.boundingSphere={center:I.boundingSphere.center.toArray(),radius:I.boundingSphere.radius}),this.boundingBox!==null&&(I.boundingBox={min:I.boundingBox.min.toArray(),max:I.boundingBox.max.toArray()}));function f(B,_){return B[_.uuid]===void 0&&(B[_.uuid]=_.toJSON(n)),_.uuid}if(this.isScene)this.background&&(this.background.isColor?I.background=this.background.toJSON():this.background.isTexture&&(I.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(I.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){I.geometry=f(n.geometries,this.geometry);const B=this.geometry.parameters;if(B!==void 0&&B.shapes!==void 0){const _=B.shapes;if(Array.isArray(_))for(let Z=0,M=_.length;Z<M;Z++){const V=_[Z];f(n.shapes,V)}else f(n.shapes,_)}}if(this.isSkinnedMesh&&(I.bindMode=this.bindMode,I.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(f(n.skeletons,this.skeleton),I.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const B=[];for(let _=0,Z=this.material.length;_<Z;_++)B.push(f(n.materials,this.material[_]));I.material=B}else I.material=f(n.materials,this.material);if(this.children.length>0){I.children=[];for(let B=0;B<this.children.length;B++)I.children.push(this.children[B].toJSON(n).object)}if(this.animations.length>0){I.animations=[];for(let B=0;B<this.animations.length;B++){const _=this.animations[B];I.animations.push(f(n.animations,_))}}if(d){const B=y(n.geometries),_=y(n.materials),Z=y(n.textures),M=y(n.images),V=y(n.shapes),T=y(n.skeletons),H=y(n.animations),F=y(n.nodes);B.length>0&&(C.geometries=B),_.length>0&&(C.materials=_),Z.length>0&&(C.textures=Z),M.length>0&&(C.images=M),V.length>0&&(C.shapes=V),T.length>0&&(C.skeletons=T),H.length>0&&(C.animations=H),F.length>0&&(C.nodes=F)}return C.object=I,C;function y(B){const _=[];for(const Z in B){const M=B[Z];delete M.metadata,_.push(M)}return _}}clone(n){return new this.constructor().copy(this,n)}copy(n,d=!0){if(this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldAutoUpdate=n.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.animations=n.animations.slice(),this.userData=JSON.parse(JSON.stringify(n.userData)),d===!0)for(let C=0;C<n.children.length;C++){const I=n.children[C];this.add(I.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$2=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;class Triangle{constructor(n=new Vector3,d=new Vector3,C=new Vector3){this.a=n,this.b=d,this.c=C}static getNormal(n,d,C,I){I.subVectors(C,d),_v0$1.subVectors(n,d),I.cross(_v0$1);const f=I.lengthSq();return f>0?I.multiplyScalar(1/Math.sqrt(f)):I.set(0,0,0)}static getBarycoord(n,d,C,I,f){_v0$1.subVectors(I,d),_v1$3.subVectors(C,d),_v2$2.subVectors(n,d);const y=_v0$1.dot(_v0$1),B=_v0$1.dot(_v1$3),_=_v0$1.dot(_v2$2),Z=_v1$3.dot(_v1$3),M=_v1$3.dot(_v2$2),V=y*Z-B*B;if(V===0)return f.set(0,0,0),null;const T=1/V,H=(Z*_-B*M)*T,F=(y*M-B*_)*T;return f.set(1-H-F,F,H)}static containsPoint(n,d,C,I){return this.getBarycoord(n,d,C,I,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(n,d,C,I,f,y,B,_){return this.getBarycoord(n,d,C,I,_v3$2)===null?(_.x=0,_.y=0,"z"in _&&(_.z=0),"w"in _&&(_.w=0),null):(_.setScalar(0),_.addScaledVector(f,_v3$2.x),_.addScaledVector(y,_v3$2.y),_.addScaledVector(B,_v3$2.z),_)}static getInterpolatedAttribute(n,d,C,I,f,y){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(n,d),_v41.fromBufferAttribute(n,C),_v42.fromBufferAttribute(n,I),y.setScalar(0),y.addScaledVector(_v40,f.x),y.addScaledVector(_v41,f.y),y.addScaledVector(_v42,f.z),y}static isFrontFacing(n,d,C,I){return _v0$1.subVectors(C,d),_v1$3.subVectors(n,d),_v0$1.cross(_v1$3).dot(I)<0}set(n,d,C){return this.a.copy(n),this.b.copy(d),this.c.copy(C),this}setFromPointsAndIndices(n,d,C,I){return this.a.copy(n[d]),this.b.copy(n[C]),this.c.copy(n[I]),this}setFromAttributeAndIndices(n,d,C,I){return this.a.fromBufferAttribute(n,d),this.b.fromBufferAttribute(n,C),this.c.fromBufferAttribute(n,I),this}clone(){return new this.constructor().copy(this)}copy(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(n){return n.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(n){return Triangle.getNormal(this.a,this.b,this.c,n)}getPlane(n){return n.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(n,d){return Triangle.getBarycoord(n,this.a,this.b,this.c,d)}getInterpolation(n,d,C,I,f){return Triangle.getInterpolation(n,this.a,this.b,this.c,d,C,I,f)}containsPoint(n){return Triangle.containsPoint(n,this.a,this.b,this.c)}isFrontFacing(n){return Triangle.isFrontFacing(this.a,this.b,this.c,n)}intersectsBox(n){return n.intersectsTriangle(this)}closestPointToPoint(n,d){const C=this.a,I=this.b,f=this.c;let y,B;_vab.subVectors(I,C),_vac.subVectors(f,C),_vap.subVectors(n,C);const _=_vab.dot(_vap),Z=_vac.dot(_vap);if(_<=0&&Z<=0)return d.copy(C);_vbp.subVectors(n,I);const M=_vab.dot(_vbp),V=_vac.dot(_vbp);if(M>=0&&V<=M)return d.copy(I);const T=_*V-M*Z;if(T<=0&&_>=0&&M<=0)return y=_/(_-M),d.copy(C).addScaledVector(_vab,y);_vcp.subVectors(n,f);const H=_vab.dot(_vcp),F=_vac.dot(_vcp);if(F>=0&&H<=F)return d.copy(f);const O=H*Z-_*F;if(O<=0&&Z>=0&&F<=0)return B=Z/(Z-F),d.copy(C).addScaledVector(_vac,B);const $=M*F-H*V;if($<=0&&V-M>=0&&H-F>=0)return _vbc.subVectors(f,I),B=(V-M)/(V-M+(H-F)),d.copy(I).addScaledVector(_vbc,B);const U=1/($+O+T);return y=O*U,B=T*U,d.copy(C).addScaledVector(_vab,y).addScaledVector(_vac,B)}equals(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(u,n,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?u+(n-u)*6*d:d<1/2?n:d<2/3?u+(n-u)*6*(2/3-d):u}class Color{constructor(n,d,C){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,d,C)}set(n,d,C){if(d===void 0&&C===void 0){const I=n;I&&I.isColor?this.copy(I):typeof I=="number"?this.setHex(I):typeof I=="string"&&this.setStyle(I)}else this.setRGB(n,d,C);return this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,d=SRGBColorSpace){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,ColorManagement.toWorkingColorSpace(this,d),this}setRGB(n,d,C,I=ColorManagement.workingColorSpace){return this.r=n,this.g=d,this.b=C,ColorManagement.toWorkingColorSpace(this,I),this}setHSL(n,d,C,I=ColorManagement.workingColorSpace){if(n=euclideanModulo(n,1),d=clamp$1(d,0,1),C=clamp$1(C,0,1),d===0)this.r=this.g=this.b=C;else{const f=C<=.5?C*(1+d):C+d-C*d,y=2*C-f;this.r=hue2rgb(y,f,n+1/3),this.g=hue2rgb(y,f,n),this.b=hue2rgb(y,f,n-1/3)}return ColorManagement.toWorkingColorSpace(this,I),this}setStyle(n,d=SRGBColorSpace){function C(f){f!==void 0&&parseFloat(f)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let I;if(I=/^(\w+)\(([^\)]*)\)/.exec(n)){let f;const y=I[1],B=I[2];switch(y){case"rgb":case"rgba":if(f=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return C(f[4]),this.setRGB(Math.min(255,parseInt(f[1],10))/255,Math.min(255,parseInt(f[2],10))/255,Math.min(255,parseInt(f[3],10))/255,d);if(f=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return C(f[4]),this.setRGB(Math.min(100,parseInt(f[1],10))/100,Math.min(100,parseInt(f[2],10))/100,Math.min(100,parseInt(f[3],10))/100,d);break;case"hsl":case"hsla":if(f=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return C(f[4]),this.setHSL(parseFloat(f[1])/360,parseFloat(f[2])/100,parseFloat(f[3])/100,d);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(I=/^\#([A-Fa-f\d]+)$/.exec(n)){const f=I[1],y=f.length;if(y===3)return this.setRGB(parseInt(f.charAt(0),16)/15,parseInt(f.charAt(1),16)/15,parseInt(f.charAt(2),16)/15,d);if(y===6)return this.setHex(parseInt(f,16),d);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&n.length>0)return this.setColorName(n,d);return this}setColorName(n,d=SRGBColorSpace){const C=_colorKeywords[n.toLowerCase()];return C!==void 0?this.setHex(C,d):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=SRGBToLinear(n.r),this.g=SRGBToLinear(n.g),this.b=SRGBToLinear(n.b),this}copyLinearToSRGB(n){return this.r=LinearToSRGB(n.r),this.g=LinearToSRGB(n.g),this.b=LinearToSRGB(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),n),Math.round(clamp$1(_color.r*255,0,255))*65536+Math.round(clamp$1(_color.g*255,0,255))*256+Math.round(clamp$1(_color.b*255,0,255))}getHexString(n=SRGBColorSpace){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,d=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),d);const C=_color.r,I=_color.g,f=_color.b,y=Math.max(C,I,f),B=Math.min(C,I,f);let _,Z;const M=(B+y)/2;if(B===y)_=0,Z=0;else{const V=y-B;switch(Z=M<=.5?V/(y+B):V/(2-y-B),y){case C:_=(I-f)/V+(I<f?6:0);break;case I:_=(f-C)/V+2;break;case f:_=(C-I)/V+4;break}_/=6}return n.h=_,n.s=Z,n.l=M,n}getRGB(n,d=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),d),n.r=_color.r,n.g=_color.g,n.b=_color.b,n}getStyle(n=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),n);const d=_color.r,C=_color.g,I=_color.b;return n!==SRGBColorSpace?`color(${n} ${d.toFixed(3)} ${C.toFixed(3)} ${I.toFixed(3)})`:`rgb(${Math.round(d*255)},${Math.round(C*255)},${Math.round(I*255)})`}offsetHSL(n,d,C){return this.getHSL(_hslA),this.setHSL(_hslA.h+n,_hslA.s+d,_hslA.l+C)}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,d){return this.r=n.r+d.r,this.g=n.g+d.g,this.b=n.b+d.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,d){return this.r+=(n.r-this.r)*d,this.g+=(n.g-this.g)*d,this.b+=(n.b-this.b)*d,this}lerpColors(n,d,C){return this.r=n.r+(d.r-n.r)*C,this.g=n.g+(d.g-n.g)*C,this.b=n.b+(d.b-n.b)*C,this}lerpHSL(n,d){this.getHSL(_hslA),n.getHSL(_hslB);const C=lerp(_hslA.h,_hslB.h,d),I=lerp(_hslA.s,_hslB.s,d),f=lerp(_hslA.l,_hslB.l,d);return this.setHSL(C,I,f),this}setFromVector3(n){return this.r=n.x,this.g=n.y,this.b=n.z,this}applyMatrix3(n){const d=this.r,C=this.g,I=this.b,f=n.elements;return this.r=f[0]*d+f[3]*C+f[6]*I,this.g=f[1]*d+f[4]*C+f[7]*I,this.b=f[2]*d+f[5]*C+f[8]*I,this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,d=0){return this.r=n[d],this.g=n[d+1],this.b=n[d+2],this}toArray(n=[],d=0){return n[d]=this.r,n[d+1]=this.g,n[d+2]=this.b,n}fromBufferAttribute(n,d){return this.r=n.getX(d),this.g=n.getY(d),this.b=n.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher$1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const d in n){const C=n[d];if(C===void 0){console.warn(`THREE.Material: parameter '${d}' has value of undefined.`);continue}const I=this[d];if(I===void 0){console.warn(`THREE.Material: '${d}' is not a property of THREE.${this.type}.`);continue}I&&I.isColor?I.set(C):I&&I.isVector3&&C&&C.isVector3?I.copy(C):this[d]=C}}toJSON(n){const d=n===void 0||typeof n=="string";d&&(n={textures:{},images:{}});const C={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};C.uuid=this.uuid,C.type=this.type,this.name!==""&&(C.name=this.name),this.color&&this.color.isColor&&(C.color=this.color.getHex()),this.roughness!==void 0&&(C.roughness=this.roughness),this.metalness!==void 0&&(C.metalness=this.metalness),this.sheen!==void 0&&(C.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(C.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(C.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(C.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(C.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(C.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(C.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(C.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(C.shininess=this.shininess),this.clearcoat!==void 0&&(C.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(C.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(C.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(C.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(C.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,C.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(C.dispersion=this.dispersion),this.iridescence!==void 0&&(C.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(C.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(C.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(C.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(C.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.anisotropy!==void 0&&(C.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(C.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(C.anisotropyMap=this.anisotropyMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(C.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(C.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(C.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(C.lightMap=this.lightMap.toJSON(n).uuid,C.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(C.aoMap=this.aoMap.toJSON(n).uuid,C.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(C.bumpMap=this.bumpMap.toJSON(n).uuid,C.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(C.normalMap=this.normalMap.toJSON(n).uuid,C.normalMapType=this.normalMapType,C.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(C.displacementMap=this.displacementMap.toJSON(n).uuid,C.displacementScale=this.displacementScale,C.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(C.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(C.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(C.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(C.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(C.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(C.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(C.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(C.combine=this.combine)),this.envMapRotation!==void 0&&(C.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(C.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(C.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(C.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(C.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(C.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(C.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(C.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(C.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(C.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(C.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(C.size=this.size),this.shadowSide!==null&&(C.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(C.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(C.blending=this.blending),this.side!==FrontSide&&(C.side=this.side),this.vertexColors===!0&&(C.vertexColors=!0),this.opacity<1&&(C.opacity=this.opacity),this.transparent===!0&&(C.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(C.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(C.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(C.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(C.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(C.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(C.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(C.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(C.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(C.depthFunc=this.depthFunc),this.depthTest===!1&&(C.depthTest=this.depthTest),this.depthWrite===!1&&(C.depthWrite=this.depthWrite),this.colorWrite===!1&&(C.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(C.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(C.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(C.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(C.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(C.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(C.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(C.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(C.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(C.rotation=this.rotation),this.polygonOffset===!0&&(C.polygonOffset=!0),this.polygonOffsetFactor!==0&&(C.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(C.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(C.linewidth=this.linewidth),this.dashSize!==void 0&&(C.dashSize=this.dashSize),this.gapSize!==void 0&&(C.gapSize=this.gapSize),this.scale!==void 0&&(C.scale=this.scale),this.dithering===!0&&(C.dithering=!0),this.alphaTest>0&&(C.alphaTest=this.alphaTest),this.alphaHash===!0&&(C.alphaHash=!0),this.alphaToCoverage===!0&&(C.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(C.premultipliedAlpha=!0),this.forceSinglePass===!0&&(C.forceSinglePass=!0),this.wireframe===!0&&(C.wireframe=!0),this.wireframeLinewidth>1&&(C.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(C.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(C.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(C.flatShading=!0),this.visible===!1&&(C.visible=!1),this.toneMapped===!1&&(C.toneMapped=!1),this.fog===!1&&(C.fog=!1),Object.keys(this.userData).length>0&&(C.userData=this.userData);function I(f){const y=[];for(const B in f){const _=f[B];delete _.metadata,y.push(_)}return y}if(d){const f=I(n.textures),y=I(n.images);f.length>0&&(C.textures=f),y.length>0&&(C.images=y)}return C}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.blendColor.copy(n.blendColor),this.blendAlpha=n.blendAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const d=n.clippingPlanes;let C=null;if(d!==null){const I=d.length;C=new Array(I);for(let f=0;f!==I;++f)C[f]=d[f].clone()}return this.clippingPlanes=C,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaHash=n.alphaHash,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.forceSinglePass=n.forceSinglePass,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}const _tables=_generateTables();function _generateTables(){const u=new ArrayBuffer(4),n=new Float32Array(u),d=new Uint32Array(u),C=new Uint32Array(512),I=new Uint32Array(512);for(let _=0;_<256;++_){const Z=_-127;Z<-27?(C[_]=0,C[_|256]=32768,I[_]=24,I[_|256]=24):Z<-14?(C[_]=1024>>-Z-14,C[_|256]=1024>>-Z-14|32768,I[_]=-Z-1,I[_|256]=-Z-1):Z<=15?(C[_]=Z+15<<10,C[_|256]=Z+15<<10|32768,I[_]=13,I[_|256]=13):Z<128?(C[_]=31744,C[_|256]=64512,I[_]=24,I[_|256]=24):(C[_]=31744,C[_|256]=64512,I[_]=13,I[_|256]=13)}const f=new Uint32Array(2048),y=new Uint32Array(64),B=new Uint32Array(64);for(let _=1;_<1024;++_){let Z=_<<13,M=0;for(;(Z&8388608)===0;)Z<<=1,M-=8388608;Z&=-8388609,M+=947912704,f[_]=Z|M}for(let _=1024;_<2048;++_)f[_]=939524096+(_-1024<<13);for(let _=1;_<31;++_)y[_]=_<<23;y[31]=1199570944,y[32]=2147483648;for(let _=33;_<63;++_)y[_]=2147483648+(_-32<<23);y[63]=3347054592;for(let _=1;_<64;++_)_!==32&&(B[_]=1024);return{floatView:n,uint32View:d,baseTable:C,shiftTable:I,mantissaTable:f,exponentTable:y,offsetTable:B}}function toHalfFloat(u){Math.abs(u)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),u=clamp$1(u,-65504,65504),_tables.floatView[0]=u;const n=_tables.uint32View[0],d=n>>23&511;return _tables.baseTable[d]+((n&8388607)>>_tables.shiftTable[d])}function fromHalfFloat(u){const n=u>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[n]+(u&1023)]+_tables.exponentTable[n],_tables.floatView[0]}class DataUtils{static toHalfFloat(n){return toHalfFloat(n)}static fromHalfFloat(n){return fromHalfFloat(n)}}const _vector$9=new Vector3,_vector2$1=new Vector2;let _id$2=0;class BufferAttribute{constructor(n,d,C=!1){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=n,this.itemSize=d,this.count=n!==void 0?n.length/d:0,this.normalized=C,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}addUpdateRange(n,d){this.updateRanges.push({start:n,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this.gpuType=n.gpuType,this}copyAt(n,d,C){n*=this.itemSize,C*=d.itemSize;for(let I=0,f=this.itemSize;I<f;I++)this.array[n+I]=d.array[C+I];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let d=0,C=this.count;d<C;d++)_vector2$1.fromBufferAttribute(this,d),_vector2$1.applyMatrix3(n),this.setXY(d,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let d=0,C=this.count;d<C;d++)_vector$9.fromBufferAttribute(this,d),_vector$9.applyMatrix3(n),this.setXYZ(d,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(n){for(let d=0,C=this.count;d<C;d++)_vector$9.fromBufferAttribute(this,d),_vector$9.applyMatrix4(n),this.setXYZ(d,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(n){for(let d=0,C=this.count;d<C;d++)_vector$9.fromBufferAttribute(this,d),_vector$9.applyNormalMatrix(n),this.setXYZ(d,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(n){for(let d=0,C=this.count;d<C;d++)_vector$9.fromBufferAttribute(this,d),_vector$9.transformDirection(n),this.setXYZ(d,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(n,d=0){return this.array.set(n,d),this}getComponent(n,d){let C=this.array[n*this.itemSize+d];return this.normalized&&(C=denormalize(C,this.array)),C}setComponent(n,d,C){return this.normalized&&(C=normalize(C,this.array)),this.array[n*this.itemSize+d]=C,this}getX(n){let d=this.array[n*this.itemSize];return this.normalized&&(d=denormalize(d,this.array)),d}setX(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize]=d,this}getY(n){let d=this.array[n*this.itemSize+1];return this.normalized&&(d=denormalize(d,this.array)),d}setY(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+1]=d,this}getZ(n){let d=this.array[n*this.itemSize+2];return this.normalized&&(d=denormalize(d,this.array)),d}setZ(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+2]=d,this}getW(n){let d=this.array[n*this.itemSize+3];return this.normalized&&(d=denormalize(d,this.array)),d}setW(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+3]=d,this}setXY(n,d,C){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array)),this.array[n+0]=d,this.array[n+1]=C,this}setXYZ(n,d,C,I){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array)),this.array[n+0]=d,this.array[n+1]=C,this.array[n+2]=I,this}setXYZW(n,d,C,I,f){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array),f=normalize(f,this.array)),this.array[n+0]=d,this.array[n+1]=C,this.array[n+2]=I,this.array[n+3]=f,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==StaticDrawUsage&&(n.usage=this.usage),n}}class Int8BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Int8Array(n),d,C)}}class Uint8BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Uint8Array(n),d,C)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Uint8ClampedArray(n),d,C)}}class Int16BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Int16Array(n),d,C)}}class Uint16BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Uint16Array(n),d,C)}}class Int32BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Int32Array(n),d,C)}}class Uint32BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Uint32Array(n),d,C)}}class Float16BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Uint16Array(n),d,C),this.isFloat16BufferAttribute=!0}getX(n){let d=fromHalfFloat(this.array[n*this.itemSize]);return this.normalized&&(d=denormalize(d,this.array)),d}setX(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize]=toHalfFloat(d),this}getY(n){let d=fromHalfFloat(this.array[n*this.itemSize+1]);return this.normalized&&(d=denormalize(d,this.array)),d}setY(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+1]=toHalfFloat(d),this}getZ(n){let d=fromHalfFloat(this.array[n*this.itemSize+2]);return this.normalized&&(d=denormalize(d,this.array)),d}setZ(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+2]=toHalfFloat(d),this}getW(n){let d=fromHalfFloat(this.array[n*this.itemSize+3]);return this.normalized&&(d=denormalize(d,this.array)),d}setW(n,d){return this.normalized&&(d=normalize(d,this.array)),this.array[n*this.itemSize+3]=toHalfFloat(d),this}setXY(n,d,C){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array)),this.array[n+0]=toHalfFloat(d),this.array[n+1]=toHalfFloat(C),this}setXYZ(n,d,C,I){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array)),this.array[n+0]=toHalfFloat(d),this.array[n+1]=toHalfFloat(C),this.array[n+2]=toHalfFloat(I),this}setXYZW(n,d,C,I,f){return n*=this.itemSize,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array),f=normalize(f,this.array)),this.array[n+0]=toHalfFloat(d),this.array[n+1]=toHalfFloat(C),this.array[n+2]=toHalfFloat(I),this.array[n+3]=toHalfFloat(f),this}}class Float32BufferAttribute extends BufferAttribute{constructor(n,d,C){super(new Float32Array(n),d,C)}}let _id$1=0;const _m1$3=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher$1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(n){return Array.isArray(n)?this.index=new(arrayNeedsUint32(n)?Uint32BufferAttribute:Uint16BufferAttribute)(n,1):this.index=n,this}setIndirect(n){return this.indirect=n,this}getIndirect(){return this.indirect}getAttribute(n){return this.attributes[n]}setAttribute(n,d){return this.attributes[n]=d,this}deleteAttribute(n){return delete this.attributes[n],this}hasAttribute(n){return this.attributes[n]!==void 0}addGroup(n,d,C=0){this.groups.push({start:n,count:d,materialIndex:C})}clearGroups(){this.groups=[]}setDrawRange(n,d){this.drawRange.start=n,this.drawRange.count=d}applyMatrix4(n){const d=this.attributes.position;d!==void 0&&(d.applyMatrix4(n),d.needsUpdate=!0);const C=this.attributes.normal;if(C!==void 0){const f=new Matrix3().getNormalMatrix(n);C.applyNormalMatrix(f),C.needsUpdate=!0}const I=this.attributes.tangent;return I!==void 0&&(I.transformDirection(n),I.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(n){return _m1$3.makeRotationFromQuaternion(n),this.applyMatrix4(_m1$3),this}rotateX(n){return _m1$3.makeRotationX(n),this.applyMatrix4(_m1$3),this}rotateY(n){return _m1$3.makeRotationY(n),this.applyMatrix4(_m1$3),this}rotateZ(n){return _m1$3.makeRotationZ(n),this.applyMatrix4(_m1$3),this}translate(n,d,C){return _m1$3.makeTranslation(n,d,C),this.applyMatrix4(_m1$3),this}scale(n,d,C){return _m1$3.makeScale(n,d,C),this.applyMatrix4(_m1$3),this}lookAt(n){return _obj.lookAt(n),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(n){const d=this.getAttribute("position");if(d===void 0){const C=[];for(let I=0,f=n.length;I<f;I++){const y=n[I];C.push(y.x,y.y,y.z||0)}this.setAttribute("position",new Float32BufferAttribute(C,3))}else{const C=Math.min(n.length,d.count);for(let I=0;I<C;I++){const f=n[I];d.setXYZ(I,f.x,f.y,f.z||0)}n.length>d.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),d.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const n=this.attributes.position,d=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(n!==void 0){if(this.boundingBox.setFromBufferAttribute(n),d)for(let C=0,I=d.length;C<I;C++){const f=d[C];_box$2.setFromBufferAttribute(f),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere$1);const n=this.attributes.position,d=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(n){const C=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(n),d)for(let f=0,y=d.length;f<y;f++){const B=d[f];_boxMorphTargets.setFromBufferAttribute(B),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(C);let I=0;for(let f=0,y=n.count;f<y;f++)_vector$8.fromBufferAttribute(n,f),I=Math.max(I,C.distanceToSquared(_vector$8));if(d)for(let f=0,y=d.length;f<y;f++){const B=d[f],_=this.morphTargetsRelative;for(let Z=0,M=B.count;Z<M;Z++)_vector$8.fromBufferAttribute(B,Z),_&&(_offset.fromBufferAttribute(n,Z),_vector$8.add(_offset)),I=Math.max(I,C.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(I),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const n=this.index,d=this.attributes;if(n===null||d.position===void 0||d.normal===void 0||d.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const C=d.position,I=d.normal,f=d.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*C.count),4));const y=this.getAttribute("tangent"),B=[],_=[];for(let ce=0;ce<C.count;ce++)B[ce]=new Vector3,_[ce]=new Vector3;const Z=new Vector3,M=new Vector3,V=new Vector3,T=new Vector2,H=new Vector2,F=new Vector2,O=new Vector3,$=new Vector3;function U(ce,ge,he){Z.fromBufferAttribute(C,ce),M.fromBufferAttribute(C,ge),V.fromBufferAttribute(C,he),T.fromBufferAttribute(f,ce),H.fromBufferAttribute(f,ge),F.fromBufferAttribute(f,he),M.sub(Z),V.sub(Z),H.sub(T),F.sub(T);const Ie=1/(H.x*F.y-F.x*H.y);isFinite(Ie)&&(O.copy(M).multiplyScalar(F.y).addScaledVector(V,-H.y).multiplyScalar(Ie),$.copy(V).multiplyScalar(H.x).addScaledVector(M,-F.x).multiplyScalar(Ie),B[ce].add(O),B[ge].add(O),B[he].add(O),_[ce].add($),_[ge].add($),_[he].add($))}let ee=this.groups;ee.length===0&&(ee=[{start:0,count:n.count}]);for(let ce=0,ge=ee.length;ce<ge;++ce){const he=ee[ce],Ie=he.start,fe=he.count;for(let me=Ie,Ge=Ie+fe;me<Ge;me+=3)U(n.getX(me+0),n.getX(me+1),n.getX(me+2))}const Q=new Vector3,ie=new Vector3,ne=new Vector3,le=new Vector3;function ae(ce){ne.fromBufferAttribute(I,ce),le.copy(ne);const ge=B[ce];Q.copy(ge),Q.sub(ne.multiplyScalar(ne.dot(ge))).normalize(),ie.crossVectors(le,ge);const Ie=ie.dot(_[ce])<0?-1:1;y.setXYZW(ce,Q.x,Q.y,Q.z,Ie)}for(let ce=0,ge=ee.length;ce<ge;++ce){const he=ee[ce],Ie=he.start,fe=he.count;for(let me=Ie,Ge=Ie+fe;me<Ge;me+=3)ae(n.getX(me+0)),ae(n.getX(me+1)),ae(n.getX(me+2))}}computeVertexNormals(){const n=this.index,d=this.getAttribute("position");if(d!==void 0){let C=this.getAttribute("normal");if(C===void 0)C=new BufferAttribute(new Float32Array(d.count*3),3),this.setAttribute("normal",C);else for(let T=0,H=C.count;T<H;T++)C.setXYZ(T,0,0,0);const I=new Vector3,f=new Vector3,y=new Vector3,B=new Vector3,_=new Vector3,Z=new Vector3,M=new Vector3,V=new Vector3;if(n)for(let T=0,H=n.count;T<H;T+=3){const F=n.getX(T+0),O=n.getX(T+1),$=n.getX(T+2);I.fromBufferAttribute(d,F),f.fromBufferAttribute(d,O),y.fromBufferAttribute(d,$),M.subVectors(y,f),V.subVectors(I,f),M.cross(V),B.fromBufferAttribute(C,F),_.fromBufferAttribute(C,O),Z.fromBufferAttribute(C,$),B.add(M),_.add(M),Z.add(M),C.setXYZ(F,B.x,B.y,B.z),C.setXYZ(O,_.x,_.y,_.z),C.setXYZ($,Z.x,Z.y,Z.z)}else for(let T=0,H=d.count;T<H;T+=3)I.fromBufferAttribute(d,T+0),f.fromBufferAttribute(d,T+1),y.fromBufferAttribute(d,T+2),M.subVectors(y,f),V.subVectors(I,f),M.cross(V),C.setXYZ(T+0,M.x,M.y,M.z),C.setXYZ(T+1,M.x,M.y,M.z),C.setXYZ(T+2,M.x,M.y,M.z);this.normalizeNormals(),C.needsUpdate=!0}}normalizeNormals(){const n=this.attributes.normal;for(let d=0,C=n.count;d<C;d++)_vector$8.fromBufferAttribute(n,d),_vector$8.normalize(),n.setXYZ(d,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function n(B,_){const Z=B.array,M=B.itemSize,V=B.normalized,T=new Z.constructor(_.length*M);let H=0,F=0;for(let O=0,$=_.length;O<$;O++){B.isInterleavedBufferAttribute?H=_[O]*B.data.stride+B.offset:H=_[O]*M;for(let U=0;U<M;U++)T[F++]=Z[H++]}return new BufferAttribute(T,M,V)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const d=new BufferGeometry,C=this.index.array,I=this.attributes;for(const B in I){const _=I[B],Z=n(_,C);d.setAttribute(B,Z)}const f=this.morphAttributes;for(const B in f){const _=[],Z=f[B];for(let M=0,V=Z.length;M<V;M++){const T=Z[M],H=n(T,C);_.push(H)}d.morphAttributes[B]=_}d.morphTargetsRelative=this.morphTargetsRelative;const y=this.groups;for(let B=0,_=y.length;B<_;B++){const Z=y[B];d.addGroup(Z.start,Z.count,Z.materialIndex)}return d}toJSON(){const n={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),this.parameters!==void 0){const _=this.parameters;for(const Z in _)_[Z]!==void 0&&(n[Z]=_[Z]);return n}n.data={attributes:{}};const d=this.index;d!==null&&(n.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});const C=this.attributes;for(const _ in C){const Z=C[_];n.data.attributes[_]=Z.toJSON(n.data)}const I={};let f=!1;for(const _ in this.morphAttributes){const Z=this.morphAttributes[_],M=[];for(let V=0,T=Z.length;V<T;V++){const H=Z[V];M.push(H.toJSON(n.data))}M.length>0&&(I[_]=M,f=!0)}f&&(n.data.morphAttributes=I,n.data.morphTargetsRelative=this.morphTargetsRelative);const y=this.groups;y.length>0&&(n.data.groups=JSON.parse(JSON.stringify(y)));const B=this.boundingSphere;return B!==null&&(n.data.boundingSphere={center:B.center.toArray(),radius:B.radius}),n}clone(){return new this.constructor().copy(this)}copy(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const d={};this.name=n.name;const C=n.index;C!==null&&this.setIndex(C.clone(d));const I=n.attributes;for(const Z in I){const M=I[Z];this.setAttribute(Z,M.clone(d))}const f=n.morphAttributes;for(const Z in f){const M=[],V=f[Z];for(let T=0,H=V.length;T<H;T++)M.push(V[T].clone(d));this.morphAttributes[Z]=M}this.morphTargetsRelative=n.morphTargetsRelative;const y=n.groups;for(let Z=0,M=y.length;Z<M;Z++){const V=y[Z];this.addGroup(V.start,V.count,V.materialIndex)}const B=n.boundingBox;B!==null&&(this.boundingBox=B.clone());const _=n.boundingSphere;return _!==null&&(this.boundingSphere=_.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$2,_sphere$6=new Sphere$1,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(n=new BufferGeometry,d=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=d,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(n,d){return super.copy(n,d),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}updateMorphTargets(){const d=this.geometry.morphAttributes,C=Object.keys(d);if(C.length>0){const I=d[C[0]];if(I!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,y=I.length;f<y;f++){const B=I[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[B]=f}}}}getVertexPosition(n,d){const C=this.geometry,I=C.attributes.position,f=C.morphAttributes.position,y=C.morphTargetsRelative;d.fromBufferAttribute(I,n);const B=this.morphTargetInfluences;if(f&&B){_morphA.set(0,0,0);for(let _=0,Z=f.length;_<Z;_++){const M=B[_],V=f[_];M!==0&&(_tempA.fromBufferAttribute(V,n),y?_morphA.addScaledVector(_tempA,M):_morphA.addScaledVector(_tempA.sub(d),M))}d.add(_morphA)}return d}raycast(n,d){const C=this.geometry,I=this.material,f=this.matrixWorld;I!==void 0&&(C.boundingSphere===null&&C.computeBoundingSphere(),_sphere$6.copy(C.boundingSphere),_sphere$6.applyMatrix4(f),_ray$3.copy(n.ray).recast(n.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(n.far-n.near)**2))&&(_inverseMatrix$3.copy(f).invert(),_ray$3.copy(n.ray).applyMatrix4(_inverseMatrix$3),!(C.boundingBox!==null&&_ray$3.intersectsBox(C.boundingBox)===!1)&&this._computeIntersections(n,d,_ray$3)))}_computeIntersections(n,d,C){let I;const f=this.geometry,y=this.material,B=f.index,_=f.attributes.position,Z=f.attributes.uv,M=f.attributes.uv1,V=f.attributes.normal,T=f.groups,H=f.drawRange;if(B!==null)if(Array.isArray(y))for(let F=0,O=T.length;F<O;F++){const $=T[F],U=y[$.materialIndex],ee=Math.max($.start,H.start),Q=Math.min(B.count,Math.min($.start+$.count,H.start+H.count));for(let ie=ee,ne=Q;ie<ne;ie+=3){const le=B.getX(ie),ae=B.getX(ie+1),ce=B.getX(ie+2);I=checkGeometryIntersection(this,U,n,C,Z,M,V,le,ae,ce),I&&(I.faceIndex=Math.floor(ie/3),I.face.materialIndex=$.materialIndex,d.push(I))}}else{const F=Math.max(0,H.start),O=Math.min(B.count,H.start+H.count);for(let $=F,U=O;$<U;$+=3){const ee=B.getX($),Q=B.getX($+1),ie=B.getX($+2);I=checkGeometryIntersection(this,y,n,C,Z,M,V,ee,Q,ie),I&&(I.faceIndex=Math.floor($/3),d.push(I))}}else if(_!==void 0)if(Array.isArray(y))for(let F=0,O=T.length;F<O;F++){const $=T[F],U=y[$.materialIndex],ee=Math.max($.start,H.start),Q=Math.min(_.count,Math.min($.start+$.count,H.start+H.count));for(let ie=ee,ne=Q;ie<ne;ie+=3){const le=ie,ae=ie+1,ce=ie+2;I=checkGeometryIntersection(this,U,n,C,Z,M,V,le,ae,ce),I&&(I.faceIndex=Math.floor(ie/3),I.face.materialIndex=$.materialIndex,d.push(I))}}else{const F=Math.max(0,H.start),O=Math.min(_.count,H.start+H.count);for(let $=F,U=O;$<U;$+=3){const ee=$,Q=$+1,ie=$+2;I=checkGeometryIntersection(this,y,n,C,Z,M,V,ee,Q,ie),I&&(I.faceIndex=Math.floor($/3),d.push(I))}}}}function checkIntersection$1(u,n,d,C,I,f,y,B){let _;if(n.side===BackSide?_=C.intersectTriangle(y,f,I,!0,B):_=C.intersectTriangle(I,f,y,n.side===FrontSide,B),_===null)return null;_intersectionPointWorld.copy(B),_intersectionPointWorld.applyMatrix4(u.matrixWorld);const Z=d.ray.origin.distanceTo(_intersectionPointWorld);return Z<d.near||Z>d.far?null:{distance:Z,point:_intersectionPointWorld.clone(),object:u}}function checkGeometryIntersection(u,n,d,C,I,f,y,B,_,Z){u.getVertexPosition(B,_vA$1),u.getVertexPosition(_,_vB$1),u.getVertexPosition(Z,_vC$1);const M=checkIntersection$1(u,n,d,C,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(M){const V=new Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,V),I&&(M.uv=Triangle.getInterpolatedAttribute(I,B,_,Z,V,new Vector2)),f&&(M.uv1=Triangle.getInterpolatedAttribute(f,B,_,Z,V,new Vector2)),y&&(M.normal=Triangle.getInterpolatedAttribute(y,B,_,Z,V,new Vector3),M.normal.dot(C.direction)>0&&M.normal.multiplyScalar(-1));const T={a:B,b:_,c:Z,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,T.normal),M.face=T,M.barycoord=V}return M}class BoxGeometry extends BufferGeometry{constructor(n=1,d=1,C=1,I=1,f=1,y=1){super(),this.type="BoxGeometry",this.parameters={width:n,height:d,depth:C,widthSegments:I,heightSegments:f,depthSegments:y};const B=this;I=Math.floor(I),f=Math.floor(f),y=Math.floor(y);const _=[],Z=[],M=[],V=[];let T=0,H=0;F("z","y","x",-1,-1,C,d,n,y,f,0),F("z","y","x",1,-1,C,d,-n,y,f,1),F("x","z","y",1,1,n,C,d,I,y,2),F("x","z","y",1,-1,n,C,-d,I,y,3),F("x","y","z",1,-1,n,d,C,I,f,4),F("x","y","z",-1,-1,n,d,-C,I,f,5),this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(Z,3)),this.setAttribute("normal",new Float32BufferAttribute(M,3)),this.setAttribute("uv",new Float32BufferAttribute(V,2));function F(O,$,U,ee,Q,ie,ne,le,ae,ce,ge){const he=ie/ae,Ie=ne/ce,fe=ie/2,me=ne/2,Ge=le/2,Ze=ae+1,ye=ce+1;let Ee=0,Ve=0;const Ye=new Vector3;for(let be=0;be<ye;be++){const Be=be*Ie-me;for(let Ne=0;Ne<Ze;Ne++){const Ae=Ne*he-fe;Ye[O]=Ae*ee,Ye[$]=Be*Q,Ye[U]=Ge,Z.push(Ye.x,Ye.y,Ye.z),Ye[O]=0,Ye[$]=0,Ye[U]=le>0?1:-1,M.push(Ye.x,Ye.y,Ye.z),V.push(Ne/ae),V.push(1-be/ce),Ee+=1}}for(let be=0;be<ce;be++)for(let Be=0;Be<ae;Be++){const Ne=T+Be+Ze*be,Ae=T+Be+Ze*(be+1),Re=T+(Be+1)+Ze*(be+1),We=T+(Be+1)+Ze*be;_.push(Ne,Ae,We),_.push(Ae,Re,We),Ve+=6}B.addGroup(H,Ve,ge),H+=Ve,T+=Ee}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new BoxGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)}}function cloneUniforms(u){const n={};for(const d in u){n[d]={};for(const C in u[d]){const I=u[d][C];I&&(I.isColor||I.isMatrix3||I.isMatrix4||I.isVector2||I.isVector3||I.isVector4||I.isTexture||I.isQuaternion)?I.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),n[d][C]=null):n[d][C]=I.clone():Array.isArray(I)?n[d][C]=I.slice():n[d][C]=I}}return n}function mergeUniforms(u){const n={};for(let d=0;d<u.length;d++){const C=cloneUniforms(u[d]);for(const I in C)n[I]=C[I]}return n}function cloneUniformsGroups(u){const n=[];for(let d=0;d<u.length;d++)n.push(u[d].clone());return n}function getUnlitUniformColorSpace(u){const n=u.getRenderTarget();return n===null?u.outputColorSpace:n.isXRRenderTarget===!0?n.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(n){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,n!==void 0&&this.setValues(n)}copy(n){return super.copy(n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=cloneUniforms(n.uniforms),this.uniformsGroups=cloneUniformsGroups(n.uniformsGroups),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.fog=n.fog,this.lights=n.lights,this.clipping=n.clipping,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this}toJSON(n){const d=super.toJSON(n);d.glslVersion=this.glslVersion,d.uniforms={};for(const I in this.uniforms){const y=this.uniforms[I].value;y&&y.isTexture?d.uniforms[I]={type:"t",value:y.toJSON(n).uuid}:y&&y.isColor?d.uniforms[I]={type:"c",value:y.getHex()}:y&&y.isVector2?d.uniforms[I]={type:"v2",value:y.toArray()}:y&&y.isVector3?d.uniforms[I]={type:"v3",value:y.toArray()}:y&&y.isVector4?d.uniforms[I]={type:"v4",value:y.toArray()}:y&&y.isMatrix3?d.uniforms[I]={type:"m3",value:y.toArray()}:y&&y.isMatrix4?d.uniforms[I]={type:"m4",value:y.toArray()}:d.uniforms[I]={value:y}}Object.keys(this.defines).length>0&&(d.defines=this.defines),d.vertexShader=this.vertexShader,d.fragmentShader=this.fragmentShader,d.lights=this.lights,d.clipping=this.clipping;const C={};for(const I in this.extensions)this.extensions[I]===!0&&(C[I]=!0);return Object.keys(C).length>0&&(d.extensions=C),d}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(n,d){return super.copy(n,d),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,d){super.updateWorldMatrix(n,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(n=50,d=1,C=.1,I=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=C,this.far=I,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,d){return super.copy(n,d),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const d=.5*this.getFilmHeight()/n;this.fov=RAD2DEG*2*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(n,d,C){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),d.set(_v3$1.x,_v3$1.y).multiplyScalar(-n/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),C.set(_v3$1.x,_v3$1.y).multiplyScalar(-n/_v3$1.z)}getViewSize(n,d){return this.getViewBounds(n,_minTarget,_maxTarget),d.subVectors(_maxTarget,_minTarget)}setViewOffset(n,d,C,I,f,y){this.aspect=n/d,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=d,this.view.offsetX=C,this.view.offsetY=I,this.view.width=f,this.view.height=y,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let d=n*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,C=2*d,I=this.aspect*C,f=-.5*I;const y=this.view;if(this.view!==null&&this.view.enabled){const _=y.fullWidth,Z=y.fullHeight;f+=y.offsetX*I/_,d-=y.offsetY*C/Z,I*=y.width/_,C*=y.height/Z}const B=this.filmOffset;B!==0&&(f+=n*B/this.getFilmWidth()),this.projectionMatrix.makePerspective(f,f+I,d,d-C,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const d=super.toJSON(n);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,this.view!==null&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(n,d,C){super(),this.type="CubeCamera",this.renderTarget=C,this.coordinateSystem=null,this.activeMipmapLevel=0;const I=new PerspectiveCamera(fov,aspect,n,d);I.layers=this.layers,this.add(I);const f=new PerspectiveCamera(fov,aspect,n,d);f.layers=this.layers,this.add(f);const y=new PerspectiveCamera(fov,aspect,n,d);y.layers=this.layers,this.add(y);const B=new PerspectiveCamera(fov,aspect,n,d);B.layers=this.layers,this.add(B);const _=new PerspectiveCamera(fov,aspect,n,d);_.layers=this.layers,this.add(_);const Z=new PerspectiveCamera(fov,aspect,n,d);Z.layers=this.layers,this.add(Z)}updateCoordinateSystem(){const n=this.coordinateSystem,d=this.children.concat(),[C,I,f,y,B,_]=d;for(const Z of d)this.remove(Z);if(n===WebGLCoordinateSystem)C.up.set(0,1,0),C.lookAt(1,0,0),I.up.set(0,1,0),I.lookAt(-1,0,0),f.up.set(0,0,-1),f.lookAt(0,1,0),y.up.set(0,0,1),y.lookAt(0,-1,0),B.up.set(0,1,0),B.lookAt(0,0,1),_.up.set(0,1,0),_.lookAt(0,0,-1);else if(n===WebGPUCoordinateSystem)C.up.set(0,-1,0),C.lookAt(-1,0,0),I.up.set(0,-1,0),I.lookAt(1,0,0),f.up.set(0,0,1),f.lookAt(0,1,0),y.up.set(0,0,-1),y.lookAt(0,-1,0),B.up.set(0,-1,0),B.lookAt(0,0,1),_.up.set(0,-1,0),_.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+n);for(const Z of d)this.add(Z),Z.updateMatrixWorld()}update(n,d){this.parent===null&&this.updateMatrixWorld();const{renderTarget:C,activeMipmapLevel:I}=this;this.coordinateSystem!==n.coordinateSystem&&(this.coordinateSystem=n.coordinateSystem,this.updateCoordinateSystem());const[f,y,B,_,Z,M]=this.children,V=n.getRenderTarget(),T=n.getActiveCubeFace(),H=n.getActiveMipmapLevel(),F=n.xr.enabled;n.xr.enabled=!1;const O=C.texture.generateMipmaps;C.texture.generateMipmaps=!1,n.setRenderTarget(C,0,I),n.render(d,f),n.setRenderTarget(C,1,I),n.render(d,y),n.setRenderTarget(C,2,I),n.render(d,B),n.setRenderTarget(C,3,I),n.render(d,_),n.setRenderTarget(C,4,I),n.render(d,Z),C.texture.generateMipmaps=O,n.setRenderTarget(C,5,I),n.render(d,M),n.setRenderTarget(V,T,H),n.xr.enabled=F,C.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(n,d,C,I,f,y,B,_,Z,M){n=n!==void 0?n:[],d=d!==void 0?d:CubeReflectionMapping,super(n,d,C,I,f,y,B,_,Z,M),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(n){this.image=n}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(n=1,d={}){super(n,n,d),this.isWebGLCubeRenderTarget=!0;const C={width:n,height:n,depth:1},I=[C,C,C,C,C,C];this.texture=new CubeTexture(I,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=d.generateMipmaps!==void 0?d.generateMipmaps:!1,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:LinearFilter}fromEquirectangularTexture(n,d){this.texture.type=d.type,this.texture.colorSpace=d.colorSpace,this.texture.generateMipmaps=d.generateMipmaps,this.texture.minFilter=d.minFilter,this.texture.magFilter=d.magFilter;const C={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},I=new BoxGeometry(5,5,5),f=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(C.uniforms),vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,side:BackSide,blending:NoBlending});f.uniforms.tEquirect.value=d;const y=new Mesh(I,f),B=d.minFilter;return d.minFilter===LinearMipmapLinearFilter&&(d.minFilter=LinearFilter),new CubeCamera(1,10,this).update(n,y),d.minFilter=B,y.geometry.dispose(),y.material.dispose(),this}clear(n,d,C,I){const f=n.getRenderTarget();for(let y=0;y<6;y++)n.setRenderTarget(this,y),n.clear(d,C,I);n.setRenderTarget(f)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(n){return this._targetRay!==null&&this._targetRay.dispatchEvent(n),this._grip!==null&&this._grip.dispatchEvent(n),this._hand!==null&&this._hand.dispatchEvent(n),this}connect(n){if(n&&n.hand){const d=this._hand;if(d)for(const C of n.hand.values())this._getHandJoint(d,C)}return this.dispatchEvent({type:"connected",data:n}),this}disconnect(n){return this.dispatchEvent({type:"disconnected",data:n}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(n,d,C){let I=null,f=null,y=null;const B=this._targetRay,_=this._grip,Z=this._hand;if(n&&d.session.visibilityState!=="visible-blurred"){if(Z&&n.hand){y=!0;for(const O of n.hand.values()){const $=d.getJointPose(O,C),U=this._getHandJoint(Z,O);$!==null&&(U.matrix.fromArray($.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.matrixWorldNeedsUpdate=!0,U.jointRadius=$.radius),U.visible=$!==null}const M=Z.joints["index-finger-tip"],V=Z.joints["thumb-tip"],T=M.position.distanceTo(V.position),H=.02,F=.005;Z.inputState.pinching&&T>H+F?(Z.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!Z.inputState.pinching&&T<=H-F&&(Z.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else _!==null&&n.gripSpace&&(f=d.getPose(n.gripSpace,C),f!==null&&(_.matrix.fromArray(f.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,f.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(f.linearVelocity)):_.hasLinearVelocity=!1,f.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(f.angularVelocity)):_.hasAngularVelocity=!1));B!==null&&(I=d.getPose(n.targetRaySpace,C),I===null&&f!==null&&(I=f),I!==null&&(B.matrix.fromArray(I.transform.matrix),B.matrix.decompose(B.position,B.rotation,B.scale),B.matrixWorldNeedsUpdate=!0,I.linearVelocity?(B.hasLinearVelocity=!0,B.linearVelocity.copy(I.linearVelocity)):B.hasLinearVelocity=!1,I.angularVelocity?(B.hasAngularVelocity=!0,B.angularVelocity.copy(I.angularVelocity)):B.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return B!==null&&(B.visible=I!==null),_!==null&&(_.visible=f!==null),Z!==null&&(Z.visible=y!==null),this}_getHandJoint(n,d){if(n.joints[d.jointName]===void 0){const C=new Group;C.matrixAutoUpdate=!1,C.visible=!1,n.joints[d.jointName]=C,n.add(C)}return n.joints[d.jointName]}}class FogExp2{constructor(n,d=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(n),this.density=d}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(n,d=1,C=1e3){this.isFog=!0,this.name="",this.color=new Color(n),this.near=d,this.far=C}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(n,d){return super.copy(n,d),n.background!==null&&(this.background=n.background.clone()),n.environment!==null&&(this.environment=n.environment.clone()),n.fog!==null&&(this.fog=n.fog.clone()),this.backgroundBlurriness=n.backgroundBlurriness,this.backgroundIntensity=n.backgroundIntensity,this.backgroundRotation.copy(n.backgroundRotation),this.environmentIntensity=n.environmentIntensity,this.environmentRotation.copy(n.environmentRotation),n.overrideMaterial!==null&&(this.overrideMaterial=n.overrideMaterial.clone()),this.matrixAutoUpdate=n.matrixAutoUpdate,this}toJSON(n){const d=super.toJSON(n);return this.fog!==null&&(d.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(d.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(d.object.backgroundIntensity=this.backgroundIntensity),d.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(d.object.environmentIntensity=this.environmentIntensity),d.object.environmentRotation=this.environmentRotation.toArray(),d}}class InterleavedBuffer{constructor(n,d){this.isInterleavedBuffer=!0,this.array=n,this.stride=d,this.count=n!==void 0?n.length/d:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}addUpdateRange(n,d){this.updateRanges.push({start:n,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,d,C){n*=this.stride,C*=d.stride;for(let I=0,f=this.stride;I<f;I++)this.array[n+I]=d.array[C+I];return this}set(n,d=0){return this.array.set(n,d),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const d=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),C=new this.constructor(d,this.stride);return C.setUsage(this.usage),C}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new Vector3;class InterleavedBufferAttribute{constructor(n,d,C,I=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=n,this.itemSize=d,this.offset=C,this.normalized=I}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(n){this.data.needsUpdate=n}applyMatrix4(n){for(let d=0,C=this.data.count;d<C;d++)_vector$7.fromBufferAttribute(this,d),_vector$7.applyMatrix4(n),this.setXYZ(d,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(n){for(let d=0,C=this.count;d<C;d++)_vector$7.fromBufferAttribute(this,d),_vector$7.applyNormalMatrix(n),this.setXYZ(d,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(n){for(let d=0,C=this.count;d<C;d++)_vector$7.fromBufferAttribute(this,d),_vector$7.transformDirection(n),this.setXYZ(d,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(n,d){let C=this.array[n*this.data.stride+this.offset+d];return this.normalized&&(C=denormalize(C,this.array)),C}setComponent(n,d,C){return this.normalized&&(C=normalize(C,this.array)),this.data.array[n*this.data.stride+this.offset+d]=C,this}setX(n,d){return this.normalized&&(d=normalize(d,this.array)),this.data.array[n*this.data.stride+this.offset]=d,this}setY(n,d){return this.normalized&&(d=normalize(d,this.array)),this.data.array[n*this.data.stride+this.offset+1]=d,this}setZ(n,d){return this.normalized&&(d=normalize(d,this.array)),this.data.array[n*this.data.stride+this.offset+2]=d,this}setW(n,d){return this.normalized&&(d=normalize(d,this.array)),this.data.array[n*this.data.stride+this.offset+3]=d,this}getX(n){let d=this.data.array[n*this.data.stride+this.offset];return this.normalized&&(d=denormalize(d,this.array)),d}getY(n){let d=this.data.array[n*this.data.stride+this.offset+1];return this.normalized&&(d=denormalize(d,this.array)),d}getZ(n){let d=this.data.array[n*this.data.stride+this.offset+2];return this.normalized&&(d=denormalize(d,this.array)),d}getW(n){let d=this.data.array[n*this.data.stride+this.offset+3];return this.normalized&&(d=denormalize(d,this.array)),d}setXY(n,d,C){return n=n*this.data.stride+this.offset,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array)),this.data.array[n+0]=d,this.data.array[n+1]=C,this}setXYZ(n,d,C,I){return n=n*this.data.stride+this.offset,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array)),this.data.array[n+0]=d,this.data.array[n+1]=C,this.data.array[n+2]=I,this}setXYZW(n,d,C,I,f){return n=n*this.data.stride+this.offset,this.normalized&&(d=normalize(d,this.array),C=normalize(C,this.array),I=normalize(I,this.array),f=normalize(f,this.array)),this.data.array[n+0]=d,this.data.array[n+1]=C,this.data.array[n+2]=I,this.data.array[n+3]=f,this}clone(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let C=0;C<this.count;C++){const I=C*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)d.push(this.data.array[I+f])}return new BufferAttribute(new this.array.constructor(d),this.itemSize,this.normalized)}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new InterleavedBufferAttribute(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let C=0;C<this.count;C++){const I=C*this.data.stride+this.offset;for(let f=0;f<this.itemSize;f++)d.push(this.data.array[I+f])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:d,normalized:this.normalized}}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(n){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(n=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const d=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),C=new InterleavedBuffer(d,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(C,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(C,2,3,!1))}this.geometry=_geometry,this.material=n,this.center=new Vector2(.5,.5)}raycast(n,d){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const C=this.material.rotation;let I,f;C!==0&&(f=Math.cos(C),I=Math.sin(C));const y=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,y,_worldScale,I,f),transformVertex(_vB.set(.5,-.5,0),_mvPosition,y,_worldScale,I,f),transformVertex(_vC.set(.5,.5,0),_mvPosition,y,_worldScale,I,f),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let B=n.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(B===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,y,_worldScale,I,f),_uvB.set(0,1),B=n.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),B===null))return;const _=n.ray.origin.distanceTo(_intersectPoint);_<n.near||_>n.far||d.push({distance:_,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(n,d){return super.copy(n,d),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}}function transformVertex(u,n,d,C,I,f){_alignedPosition.subVectors(u,d).addScalar(.5).multiply(C),I!==void 0?(_rotatedPosition.x=f*_alignedPosition.x-I*_alignedPosition.y,_rotatedPosition.y=I*_alignedPosition.x+f*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),u.copy(n),u.x+=_rotatedPosition.x,u.y+=_rotatedPosition.y,u.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const d=n.levels;for(let C=0,I=d.length;C<I;C++){const f=d[C];this.addLevel(f.object.clone(),f.distance,f.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,d=0,C=0){d=Math.abs(d);const I=this.levels;let f;for(f=0;f<I.length&&!(d<I[f].distance);f++);return I.splice(f,0,{distance:d,hysteresis:C,object:n}),this.add(n),this}removeLevel(n){const d=this.levels;for(let C=0;C<d.length;C++)if(d[C].distance===n){const I=d.splice(C,1);return this.remove(I[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const d=this.levels;if(d.length>0){let C,I;for(C=1,I=d.length;C<I;C++){let f=d[C].distance;if(d[C].object.visible&&(f-=f*d[C].hysteresis),n<f)break}return d[C-1].object}return null}raycast(n,d){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const I=n.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(I).raycast(n,d)}}update(n){const d=this.levels;if(d.length>1){_v1$2.setFromMatrixPosition(n.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const C=_v1$2.distanceTo(_v2$1)/n.zoom;d[0].object.visible=!0;let I,f;for(I=1,f=d.length;I<f;I++){let y=d[I].distance;if(d[I].object.visible&&(y-=y*d[I].hysteresis),C>=y)d[I-1].object.visible=!1,d[I].object.visible=!0;else break}for(this._currentLevel=I-1;I<f;I++)d[I].object.visible=!1}}toJSON(n){const d=super.toJSON(n);this.autoUpdate===!1&&(d.object.autoUpdate=!1),d.object.levels=[];const C=this.levels;for(let I=0,f=C.length;I<f;I++){const y=C[I];d.object.levels.push({object:y.object.uuid,distance:y.distance,hysteresis:y.hysteresis})}return d}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$5=new Sphere$1,_inverseMatrix$2=new Matrix4,_ray$2=new Ray$2;class SkinnedMesh extends Mesh{constructor(n,d){super(n,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const n=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const d=n.getAttribute("position");for(let C=0;C<d.count;C++)this.getVertexPosition(C,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const n=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere$1),this.boundingSphere.makeEmpty();const d=n.getAttribute("position");for(let C=0;C<d.count;C++)this.getVertexPosition(C,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(n,d){return super.copy(n,d),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}raycast(n,d){const C=this.material,I=this.matrixWorld;C!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(I),n.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(I).invert(),_ray$2.copy(n.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(n,d,_ray$2)))}getVertexPosition(n,d){return super.getVertexPosition(n,d),this.applyBoneTransform(n,d),d}bind(n,d){this.skeleton=n,d===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Vector4,d=this.geometry.attributes.skinWeight;for(let C=0,I=d.count;C<I;C++){n.fromBufferAttribute(d,C);const f=1/n.manhattanLength();f!==1/0?n.multiplyScalar(f):n.set(1,0,0,0),d.setXYZW(C,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(n,d){const C=this.skeleton,I=this.geometry;_skinIndex.fromBufferAttribute(I.attributes.skinIndex,n),_skinWeight.fromBufferAttribute(I.attributes.skinWeight,n),_basePosition.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(let f=0;f<4;f++){const y=_skinWeight.getComponent(f);if(y!==0){const B=_skinIndex.getComponent(f);_matrix4.multiplyMatrices(C.bones[B].matrixWorld,C.boneInverses[B]),d.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),y)}}return d.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(n=null,d=1,C=1,I,f,y,B,_,Z=NearestFilter,M=NearestFilter,V,T){super(null,y,B,_,Z,M,I,f,V,T),this.isDataTexture=!0,this.image={data:n,width:d,height:C},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(n=[],d=[]){this.uuid=generateUUID(),this.bones=n.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const n=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(n.length*16),d.length===0)this.calculateInverses();else if(n.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let C=0,I=this.bones.length;C<I;C++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let n=0,d=this.bones.length;n<d;n++){const C=new Matrix4;this.bones[n]&&C.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(C)}}pose(){for(let n=0,d=this.bones.length;n<d;n++){const C=this.bones[n];C&&C.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,d=this.bones.length;n<d;n++){const C=this.bones[n];C&&(C.parent&&C.parent.isBone?(C.matrix.copy(C.parent.matrixWorld).invert(),C.matrix.multiply(C.matrixWorld)):C.matrix.copy(C.matrixWorld),C.matrix.decompose(C.position,C.quaternion,C.scale))}}update(){const n=this.bones,d=this.boneInverses,C=this.boneMatrices,I=this.boneTexture;for(let f=0,y=n.length;f<y;f++){const B=n[f]?n[f].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(B,d[f]),_offsetMatrix.toArray(C,f*16)}I!==null&&(I.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let n=Math.sqrt(this.bones.length*4);n=Math.ceil(n/4)*4,n=Math.max(n,4);const d=new Float32Array(n*n*4);d.set(this.boneMatrices);const C=new DataTexture(d,n,n,RGBAFormat,FloatType);return C.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=C,this}getBoneByName(n){for(let d=0,C=this.bones.length;d<C;d++){const I=this.bones[d];if(I.name===n)return I}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,d){this.uuid=n.uuid;for(let C=0,I=n.bones.length;C<I;C++){const f=n.bones[C];let y=d[f];y===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",f),y=new Bone),this.bones.push(y),this.boneInverses.push(new Matrix4().fromArray(n.boneInverses[C]))}return this.init(),this}toJSON(){const n={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;const d=this.bones,C=this.boneInverses;for(let I=0,f=d.length;I<f;I++){const y=d[I];n.bones.push(y.uuid);const B=C[I];n.boneInverses.push(B.toArray())}return n}}class InstancedBufferAttribute extends BufferAttribute{constructor(n,d,C,I=1){super(n,d,C),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=I}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere$1;class InstancedMesh extends Mesh{constructor(n,d,C){super(n,d),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(C*16),16),this.instanceColor=null,this.morphTexture=null,this.count=C,this.boundingBox=null,this.boundingSphere=null;for(let I=0;I<C;I++)this.setMatrixAt(I,_identity)}computeBoundingBox(){const n=this.geometry,d=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),n.boundingBox===null&&n.computeBoundingBox(),this.boundingBox.makeEmpty();for(let C=0;C<d;C++)this.getMatrixAt(C,_instanceLocalMatrix),_box3.copy(n.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const n=this.geometry,d=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere$1),n.boundingSphere===null&&n.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let C=0;C<d;C++)this.getMatrixAt(C,_instanceLocalMatrix),_sphere$4.copy(n.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(n,d){return super.copy(n,d),this.instanceMatrix.copy(n.instanceMatrix),n.morphTexture!==null&&(this.morphTexture=n.morphTexture.clone()),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}getColorAt(n,d){d.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,d){d.fromArray(this.instanceMatrix.array,n*16)}getMorphAt(n,d){const C=d.morphTargetInfluences,I=this.morphTexture.source.data.data,f=C.length+1,y=n*f+1;for(let B=0;B<C.length;B++)C[B]=I[y+B]}raycast(n,d){const C=this.matrixWorld,I=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(C),n.ray.intersectsSphere(_sphere$4)!==!1))for(let f=0;f<I;f++){this.getMatrixAt(f,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(C,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(n,_instanceIntersects);for(let y=0,B=_instanceIntersects.length;y<B;y++){const _=_instanceIntersects[y];_.instanceId=f,_.object=this,d.push(_)}_instanceIntersects.length=0}}setColorAt(n,d){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),d.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,d){d.toArray(this.instanceMatrix.array,n*16)}setMorphAt(n,d){const C=d.morphTargetInfluences,I=C.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(I*this.count),I,this.count,RedFormat,FloatType));const f=this.morphTexture.source.data.data;let y=0;for(let Z=0;Z<C.length;Z++)y+=C[Z];const B=this.geometry.morphTargetsRelative?1:1-y,_=I*n;f[_]=B,f.set(C,_+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(n=new Vector3(1,0,0),d=0){this.isPlane=!0,this.normal=n,this.constant=d}set(n,d){return this.normal.copy(n),this.constant=d,this}setComponents(n,d,C,I){return this.normal.set(n,d,C),this.constant=I,this}setFromNormalAndCoplanarPoint(n,d){return this.normal.copy(n),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(n,d,C){const I=_vector1.subVectors(C,d).cross(_vector2.subVectors(n,d)).normalize();return this.setFromNormalAndCoplanarPoint(I,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,d){return d.copy(n).addScaledVector(this.normal,-this.distanceToPoint(n))}intersectLine(n,d){const C=n.delta(_vector1),I=this.normal.dot(C);if(I===0)return this.distanceToPoint(n.start)===0?d.copy(n.start):null;const f=-(n.start.dot(this.normal)+this.constant)/I;return f<0||f>1?null:d.copy(n.start).addScaledVector(C,f)}intersectsLine(n){const d=this.distanceToPoint(n.start),C=this.distanceToPoint(n.end);return d<0&&C>0||C<0&&d>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,d){const C=d||_normalMatrix.getNormalMatrix(n),I=this.coplanarPoint(_vector1).applyMatrix4(n),f=this.normal.applyMatrix3(C).normalize();return this.constant=-I.dot(f),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$3=new Sphere$1,_vector$6=new Vector3;class Frustum{constructor(n=new Plane,d=new Plane,C=new Plane,I=new Plane,f=new Plane,y=new Plane){this.planes=[n,d,C,I,f,y]}set(n,d,C,I,f,y){const B=this.planes;return B[0].copy(n),B[1].copy(d),B[2].copy(C),B[3].copy(I),B[4].copy(f),B[5].copy(y),this}copy(n){const d=this.planes;for(let C=0;C<6;C++)d[C].copy(n.planes[C]);return this}setFromProjectionMatrix(n,d=WebGLCoordinateSystem){const C=this.planes,I=n.elements,f=I[0],y=I[1],B=I[2],_=I[3],Z=I[4],M=I[5],V=I[6],T=I[7],H=I[8],F=I[9],O=I[10],$=I[11],U=I[12],ee=I[13],Q=I[14],ie=I[15];if(C[0].setComponents(_-f,T-Z,$-H,ie-U).normalize(),C[1].setComponents(_+f,T+Z,$+H,ie+U).normalize(),C[2].setComponents(_+y,T+M,$+F,ie+ee).normalize(),C[3].setComponents(_-y,T-M,$-F,ie-ee).normalize(),C[4].setComponents(_-B,T-V,$-O,ie-Q).normalize(),d===WebGLCoordinateSystem)C[5].setComponents(_+B,T+V,$+O,ie+Q).normalize();else if(d===WebGPUCoordinateSystem)C[5].setComponents(B,V,O,Q).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+d);return this}intersectsObject(n){if(n.boundingSphere!==void 0)n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$3.copy(n.boundingSphere).applyMatrix4(n.matrixWorld);else{const d=n.geometry;d.boundingSphere===null&&d.computeBoundingSphere(),_sphere$3.copy(d.boundingSphere).applyMatrix4(n.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(n){return _sphere$3.center.set(0,0,0),_sphere$3.radius=.7071067811865476,_sphere$3.applyMatrix4(n.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(n){const d=this.planes,C=n.center,I=-n.radius;for(let f=0;f<6;f++)if(d[f].distanceToPoint(C)<I)return!1;return!0}intersectsBox(n){const d=this.planes;for(let C=0;C<6;C++){const I=d[C];if(_vector$6.x=I.normal.x>0?n.max.x:n.min.x,_vector$6.y=I.normal.y>0?n.max.y:n.min.y,_vector$6.z=I.normal.z>0?n.max.z:n.min.z,I.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(n){const d=this.planes;for(let C=0;C<6;C++)if(d[C].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ascIdSort(u,n){return u-n}function sortOpaque(u,n){return u.z-n.z}function sortTransparent(u,n){return n.z-u.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(n,d,C,I){const f=this.pool,y=this.list;this.index>=f.length&&f.push({start:-1,count:-1,z:-1,index:-1});const B=f[this.index];y.push(B),this.index++,B.start=n,B.count=d,B.z=C,B.index=I}reset(){this.list.length=0,this.index=0}}const _matrix$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum=new Frustum,_box$1=new Box3,_sphere$2=new Sphere$1,_vector$5=new Vector3,_forward=new Vector3,_temp=new Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(u,n,d=0){const C=n.itemSize;if(u.isInterleavedBufferAttribute||u.array.constructor!==n.array.constructor){const I=u.count;for(let f=0;f<I;f++)for(let y=0;y<C;y++)n.setComponent(f+d,y,u.getComponent(f,y))}else n.array.set(u.array,d*C);n.needsUpdate=!0}function copyArrayContents(u,n){if(u.constructor!==n.constructor){const d=Math.min(u.length,n.length);for(let C=0;C<d;C++)n[C]=u[C]}else{const d=Math.min(u.length,n.length);n.set(new u.constructor(u.buffer,0,d))}}class BatchedMesh extends Mesh{constructor(n,d,C=d*2,I){super(new BufferGeometry,I),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=n,this._maxVertexCount=d,this._maxIndexCount=C,this._multiDrawCounts=new Int32Array(n),this._multiDrawStarts=new Int32Array(n),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let n=Math.sqrt(this._maxInstanceCount*4);n=Math.ceil(n/4)*4,n=Math.max(n,4);const d=new Float32Array(n*n*4),C=new DataTexture(d,n,n,RGBAFormat,FloatType);this._matricesTexture=C}_initIndirectTexture(){let n=Math.sqrt(this._maxInstanceCount);n=Math.ceil(n);const d=new Uint32Array(n*n),C=new DataTexture(d,n,n,RedIntegerFormat,UnsignedIntType);this._indirectTexture=C}_initColorsTexture(){let n=Math.sqrt(this._maxInstanceCount);n=Math.ceil(n);const d=new Float32Array(n*n*4).fill(1),C=new DataTexture(d,n,n,RGBAFormat,FloatType);C.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=C}_initializeGeometry(n){const d=this.geometry,C=this._maxVertexCount,I=this._maxIndexCount;if(this._geometryInitialized===!1){for(const f in n.attributes){const y=n.getAttribute(f),{array:B,itemSize:_,normalized:Z}=y,M=new B.constructor(C*_),V=new BufferAttribute(M,_,Z);d.setAttribute(f,V)}if(n.getIndex()!==null){const f=C>65535?new Uint32Array(I):new Uint16Array(I);d.setIndex(new BufferAttribute(f,1))}this._geometryInitialized=!0}}_validateGeometry(n){const d=this.geometry;if(!!n.getIndex()!=!!d.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const C in d.attributes){if(!n.hasAttribute(C))throw new Error(`THREE.BatchedMesh: Added geometry missing "${C}". All geometries must have consistent attributes.`);const I=n.getAttribute(C),f=d.getAttribute(C);if(I.itemSize!==f.itemSize||I.normalized!==f.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(n){const d=this._instanceInfo;if(n<0||n>=d.length||d[n].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${n}. Instance is either out of range or has been deleted.`)}validateGeometryId(n){const d=this._geometryInfo;if(n<0||n>=d.length||d[n].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${n}. Geometry is either out of range or has been deleted.`)}setCustomSort(n){return this.customSort=n,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const n=this.boundingBox,d=this._instanceInfo;n.makeEmpty();for(let C=0,I=d.length;C<I;C++){if(d[C].active===!1)continue;const f=d[C].geometryIndex;this.getMatrixAt(C,_matrix$1),this.getBoundingBoxAt(f,_box$1).applyMatrix4(_matrix$1),n.union(_box$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere$1);const n=this.boundingSphere,d=this._instanceInfo;n.makeEmpty();for(let C=0,I=d.length;C<I;C++){if(d[C].active===!1)continue;const f=d[C].geometryIndex;this.getMatrixAt(C,_matrix$1),this.getBoundingSphereAt(f,_sphere$2).applyMatrix4(_matrix$1),n.union(_sphere$2)}}addInstance(n){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const C={visible:!0,active:!0,geometryIndex:n};let I=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),I=this._availableInstanceIds.shift(),this._instanceInfo[I]=C):(I=this._instanceInfo.length,this._instanceInfo.push(C));const f=this._matricesTexture;_matrix$1.identity().toArray(f.image.data,I*16),f.needsUpdate=!0;const y=this._colorsTexture;return y&&(_whiteColor.toArray(y.image.data,I*4),y.needsUpdate=!0),this._visibilityChanged=!0,I}addGeometry(n,d=-1,C=-1){this._initializeGeometry(n),this._validateGeometry(n);const I={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},f=this._geometryInfo;I.vertexStart=this._nextVertexStart,I.reservedVertexCount=d===-1?n.getAttribute("position").count:d;const y=n.getIndex();if(y!==null&&(I.indexStart=this._nextIndexStart,I.reservedIndexCount=C===-1?y.count:C),I.indexStart!==-1&&I.indexStart+I.reservedIndexCount>this._maxIndexCount||I.vertexStart+I.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let _;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),_=this._availableGeometryIds.shift(),f[_]=I):(_=this._geometryCount,this._geometryCount++,f.push(I)),this.setGeometryAt(_,n),this._nextIndexStart=I.indexStart+I.reservedIndexCount,this._nextVertexStart=I.vertexStart+I.reservedVertexCount,_}setGeometryAt(n,d){if(n>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(d);const C=this.geometry,I=C.getIndex()!==null,f=C.getIndex(),y=d.getIndex(),B=this._geometryInfo[n];if(I&&y.count>B.reservedIndexCount||d.attributes.position.count>B.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const _=B.vertexStart,Z=B.reservedVertexCount;B.vertexCount=d.getAttribute("position").count;for(const M in C.attributes){const V=d.getAttribute(M),T=C.getAttribute(M);copyAttributeData(V,T,_);const H=V.itemSize;for(let F=V.count,O=Z;F<O;F++){const $=_+F;for(let U=0;U<H;U++)T.setComponent($,U,0)}T.needsUpdate=!0,T.addUpdateRange(_*H,Z*H)}if(I){const M=B.indexStart,V=B.reservedIndexCount;B.indexCount=d.getIndex().count;for(let T=0;T<y.count;T++)f.setX(M+T,_+y.getX(T));for(let T=y.count,H=V;T<H;T++)f.setX(M+T,_);f.needsUpdate=!0,f.addUpdateRange(M,B.reservedIndexCount)}return B.start=I?B.indexStart:B.vertexStart,B.count=I?B.indexCount:B.vertexCount,B.boundingBox=null,d.boundingBox!==null&&(B.boundingBox=d.boundingBox.clone()),B.boundingSphere=null,d.boundingSphere!==null&&(B.boundingSphere=d.boundingSphere.clone()),this._visibilityChanged=!0,n}deleteGeometry(n){const d=this._geometryInfo;if(n>=d.length||d[n].active===!1)return this;const C=this._instanceInfo;for(let I=0,f=C.length;I<f;I++)C[I].active&&C[I].geometryIndex===n&&this.deleteInstance(I);return d[n].active=!1,this._availableGeometryIds.push(n),this._visibilityChanged=!0,this}deleteInstance(n){return this.validateInstanceId(n),this._instanceInfo[n].active=!1,this._availableInstanceIds.push(n),this._visibilityChanged=!0,this}optimize(){let n=0,d=0;const C=this._geometryInfo,I=C.map((y,B)=>B).sort((y,B)=>C[y].vertexStart-C[B].vertexStart),f=this.geometry;for(let y=0,B=C.length;y<B;y++){const _=I[y],Z=C[_];if(Z.active!==!1){if(f.index!==null){if(Z.indexStart!==d){const{indexStart:M,vertexStart:V,reservedIndexCount:T}=Z,H=f.index,F=H.array,O=n-V;for(let $=M;$<M+T;$++)F[$]=F[$]+O;H.array.copyWithin(d,M,M+T),H.addUpdateRange(d,T),Z.indexStart=d}d+=Z.reservedIndexCount}if(Z.vertexStart!==n){const{vertexStart:M,reservedVertexCount:V}=Z,T=f.attributes;for(const H in T){const F=T[H],{array:O,itemSize:$}=F;O.copyWithin(n*$,M*$,(M+V)*$),F.addUpdateRange(n*$,V*$)}Z.vertexStart=n}n+=Z.reservedVertexCount,Z.start=f.index?Z.indexStart:Z.vertexStart,this._nextIndexStart=f.index?Z.indexStart+Z.reservedIndexCount:0,this._nextVertexStart=Z.vertexStart+Z.reservedVertexCount}}return this}getBoundingBoxAt(n,d){if(n>=this._geometryCount)return null;const C=this.geometry,I=this._geometryInfo[n];if(I.boundingBox===null){const f=new Box3,y=C.index,B=C.attributes.position;for(let _=I.start,Z=I.start+I.count;_<Z;_++){let M=_;y&&(M=y.getX(M)),f.expandByPoint(_vector$5.fromBufferAttribute(B,M))}I.boundingBox=f}return d.copy(I.boundingBox),d}getBoundingSphereAt(n,d){if(n>=this._geometryCount)return null;const C=this.geometry,I=this._geometryInfo[n];if(I.boundingSphere===null){const f=new Sphere$1;this.getBoundingBoxAt(n,_box$1),_box$1.getCenter(f.center);const y=C.index,B=C.attributes.position;let _=0;for(let Z=I.start,M=I.start+I.count;Z<M;Z++){let V=Z;y&&(V=y.getX(V)),_vector$5.fromBufferAttribute(B,V),_=Math.max(_,f.center.distanceToSquared(_vector$5))}f.radius=Math.sqrt(_),I.boundingSphere=f}return d.copy(I.boundingSphere),d}setMatrixAt(n,d){this.validateInstanceId(n);const C=this._matricesTexture,I=this._matricesTexture.image.data;return d.toArray(I,n*16),C.needsUpdate=!0,this}getMatrixAt(n,d){return this.validateInstanceId(n),d.fromArray(this._matricesTexture.image.data,n*16)}setColorAt(n,d){return this.validateInstanceId(n),this._colorsTexture===null&&this._initColorsTexture(),d.toArray(this._colorsTexture.image.data,n*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(n,d){return this.validateInstanceId(n),d.fromArray(this._colorsTexture.image.data,n*4)}setVisibleAt(n,d){return this.validateInstanceId(n),this._instanceInfo[n].visible===d?this:(this._instanceInfo[n].visible=d,this._visibilityChanged=!0,this)}getVisibleAt(n){return this.validateInstanceId(n),this._instanceInfo[n].visible}setGeometryIdAt(n,d){return this.validateInstanceId(n),this.validateGeometryId(d),this._instanceInfo[n].geometryIndex=d,this}getGeometryIdAt(n){return this.validateInstanceId(n),this._instanceInfo[n].geometryIndex}getGeometryRangeAt(n,d={}){this.validateGeometryId(n);const C=this._geometryInfo[n];return d.vertexStart=C.vertexStart,d.vertexCount=C.vertexCount,d.reservedVertexCount=C.reservedVertexCount,d.indexStart=C.indexStart,d.indexCount=C.indexCount,d.reservedIndexCount=C.reservedIndexCount,d.start=C.start,d.count=C.count,d}setInstanceCount(n){const d=this._availableInstanceIds,C=this._instanceInfo;for(d.sort(ascIdSort);d[d.length-1]===C.length;)C.pop(),d.pop();if(n<C.length)throw new Error(`BatchedMesh: Instance ids outside the range ${n} are being used. Cannot shrink instance count.`);const I=new Int32Array(n),f=new Int32Array(n);copyArrayContents(this._multiDrawCounts,I),copyArrayContents(this._multiDrawStarts,f),this._multiDrawCounts=I,this._multiDrawStarts=f,this._maxInstanceCount=n;const y=this._indirectTexture,B=this._matricesTexture,_=this._colorsTexture;y.dispose(),this._initIndirectTexture(),copyArrayContents(y.image.data,this._indirectTexture.image.data),B.dispose(),this._initMatricesTexture(),copyArrayContents(B.image.data,this._matricesTexture.image.data),_&&(_.dispose(),this._initColorsTexture(),copyArrayContents(_.image.data,this._colorsTexture.image.data))}setGeometrySize(n,d){const C=[...this._geometryInfo].filter(B=>B.active);if(Math.max(...C.map(B=>B.vertexStart+B.reservedVertexCount))>n)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${d}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...C.map(_=>_.indexStart+_.reservedIndexCount))>d)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${d}. Cannot shrink further.`);const f=this.geometry;f.dispose(),this._maxVertexCount=n,this._maxIndexCount=d,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(f));const y=this.geometry;f.index&&copyArrayContents(f.index.array,y.index.array);for(const B in f.attributes)copyArrayContents(f.attributes[B].array,y.attributes[B].array)}raycast(n,d){const C=this._instanceInfo,I=this._geometryInfo,f=this.matrixWorld,y=this.geometry;_mesh.material=this.material,_mesh.geometry.index=y.index,_mesh.geometry.attributes=y.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere$1);for(let B=0,_=C.length;B<_;B++){if(!C[B].visible||!C[B].active)continue;const Z=C[B].geometryIndex,M=I[Z];_mesh.geometry.setDrawRange(M.start,M.count),this.getMatrixAt(B,_mesh.matrixWorld).premultiply(f),this.getBoundingBoxAt(Z,_mesh.geometry.boundingBox),this.getBoundingSphereAt(Z,_mesh.geometry.boundingSphere),_mesh.raycast(n,_batchIntersects);for(let V=0,T=_batchIntersects.length;V<T;V++){const H=_batchIntersects[V];H.object=this,H.batchId=B,d.push(H)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(n){return super.copy(n),this.geometry=n.geometry.clone(),this.perObjectFrustumCulled=n.perObjectFrustumCulled,this.sortObjects=n.sortObjects,this.boundingBox=n.boundingBox!==null?n.boundingBox.clone():null,this.boundingSphere=n.boundingSphere!==null?n.boundingSphere.clone():null,this._geometryInfo=n._geometryInfo.map(d=>({...d,boundingBox:d.boundingBox!==null?d.boundingBox.clone():null,boundingSphere:d.boundingSphere!==null?d.boundingSphere.clone():null})),this._instanceInfo=n._instanceInfo.map(d=>({...d})),this._maxInstanceCount=n._maxInstanceCount,this._maxVertexCount=n._maxVertexCount,this._maxIndexCount=n._maxIndexCount,this._geometryInitialized=n._geometryInitialized,this._geometryCount=n._geometryCount,this._multiDrawCounts=n._multiDrawCounts.slice(),this._multiDrawStarts=n._multiDrawStarts.slice(),this._matricesTexture=n._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=n._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(n,d,C,I,f){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const y=I.getIndex(),B=y===null?1:y.array.BYTES_PER_ELEMENT,_=this._instanceInfo,Z=this._multiDrawStarts,M=this._multiDrawCounts,V=this._geometryInfo,T=this.perObjectFrustumCulled,H=this._indirectTexture,F=H.image.data;T&&(_matrix$1.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_matrix$1,n.coordinateSystem));let O=0;if(this.sortObjects){_matrix$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(C.matrixWorld).applyMatrix4(_matrix$1),_forward.set(0,0,-1).transformDirection(C.matrixWorld).transformDirection(_matrix$1);for(let ee=0,Q=_.length;ee<Q;ee++)if(_[ee].visible&&_[ee].active){const ie=_[ee].geometryIndex;this.getMatrixAt(ee,_matrix$1),this.getBoundingSphereAt(ie,_sphere$2).applyMatrix4(_matrix$1);let ne=!1;if(T&&(ne=!_frustum.intersectsSphere(_sphere$2)),!ne){const le=V[ie],ae=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push(le.start,le.count,ae,ee)}}const $=_renderList.list,U=this.customSort;U===null?$.sort(f.transparent?sortTransparent:sortOpaque):U.call(this,$,C);for(let ee=0,Q=$.length;ee<Q;ee++){const ie=$[ee];Z[O]=ie.start*B,M[O]=ie.count,F[O]=ie.index,O++}_renderList.reset()}else for(let $=0,U=_.length;$<U;$++)if(_[$].visible&&_[$].active){const ee=_[$].geometryIndex;let Q=!1;if(T&&(this.getMatrixAt($,_matrix$1),this.getBoundingSphereAt(ee,_sphere$2).applyMatrix4(_matrix$1),Q=!_frustum.intersectsSphere(_sphere$2)),!Q){const ie=V[ee];Z[O]=ie.start*B,M[O]=ie.count,F[O]=$,O++}}H.needsUpdate=!0,this._multiDrawCount=O,this._visibilityChanged=!1}onBeforeShadow(n,d,C,I,f,y){this.onBeforeRender(n,null,I,f,y)}}class LineBasicMaterial extends Material{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}}const _vStart=new Vector3,_vEnd=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$2,_sphere$1=new Sphere$1,_intersectPointOnRay=new Vector3,_intersectPointOnSegment=new Vector3;class Line extends Object3D{constructor(n=new BufferGeometry,d=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=d,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(n,d){return super.copy(n,d),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const d=n.attributes.position,C=[0];for(let I=1,f=d.count;I<f;I++)_vStart.fromBufferAttribute(d,I-1),_vEnd.fromBufferAttribute(d,I),C[I]=C[I-1],C[I]+=_vStart.distanceTo(_vEnd);n.setAttribute("lineDistance",new Float32BufferAttribute(C,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,d){const C=this.geometry,I=this.matrixWorld,f=n.params.Line.threshold,y=C.drawRange;if(C.boundingSphere===null&&C.computeBoundingSphere(),_sphere$1.copy(C.boundingSphere),_sphere$1.applyMatrix4(I),_sphere$1.radius+=f,n.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(I).invert(),_ray$1.copy(n.ray).applyMatrix4(_inverseMatrix$1);const B=f/((this.scale.x+this.scale.y+this.scale.z)/3),_=B*B,Z=this.isLineSegments?2:1,M=C.index,T=C.attributes.position;if(M!==null){const H=Math.max(0,y.start),F=Math.min(M.count,y.start+y.count);for(let O=H,$=F-1;O<$;O+=Z){const U=M.getX(O),ee=M.getX(O+1),Q=checkIntersection(this,n,_ray$1,_,U,ee,O);Q&&d.push(Q)}if(this.isLineLoop){const O=M.getX(F-1),$=M.getX(H),U=checkIntersection(this,n,_ray$1,_,O,$,F-1);U&&d.push(U)}}else{const H=Math.max(0,y.start),F=Math.min(T.count,y.start+y.count);for(let O=H,$=F-1;O<$;O+=Z){const U=checkIntersection(this,n,_ray$1,_,O,O+1,O);U&&d.push(U)}if(this.isLineLoop){const O=checkIntersection(this,n,_ray$1,_,F-1,H,F-1);O&&d.push(O)}}}updateMorphTargets(){const d=this.geometry.morphAttributes,C=Object.keys(d);if(C.length>0){const I=d[C[0]];if(I!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,y=I.length;f<y;f++){const B=I[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[B]=f}}}}}function checkIntersection(u,n,d,C,I,f,y){const B=u.geometry.attributes.position;if(_vStart.fromBufferAttribute(B,I),_vEnd.fromBufferAttribute(B,f),d.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>C)return;_intersectPointOnRay.applyMatrix4(u.matrixWorld);const Z=n.ray.origin.distanceTo(_intersectPointOnRay);if(!(Z<n.near||Z>n.far))return{distance:Z,point:_intersectPointOnSegment.clone().applyMatrix4(u.matrixWorld),index:y,face:null,faceIndex:null,barycoord:null,object:u}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(n,d){super(n,d),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const d=n.attributes.position,C=[];for(let I=0,f=d.count;I<f;I+=2)_start.fromBufferAttribute(d,I),_end.fromBufferAttribute(d,I+1),C[I]=I===0?0:C[I-1],C[I+1]=C[I]+_start.distanceTo(_end);n.setAttribute("lineDistance",new Float32BufferAttribute(C,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(n,d){super(n,d),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}const _inverseMatrix=new Matrix4,_ray$4=new Ray$2,_sphere=new Sphere$1,_position$2=new Vector3;class Points extends Object3D{constructor(n=new BufferGeometry,d=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=d,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(n,d){return super.copy(n,d),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}raycast(n,d){const C=this.geometry,I=this.matrixWorld,f=n.params.Points.threshold,y=C.drawRange;if(C.boundingSphere===null&&C.computeBoundingSphere(),_sphere.copy(C.boundingSphere),_sphere.applyMatrix4(I),_sphere.radius+=f,n.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(I).invert(),_ray$4.copy(n.ray).applyMatrix4(_inverseMatrix);const B=f/((this.scale.x+this.scale.y+this.scale.z)/3),_=B*B,Z=C.index,V=C.attributes.position;if(Z!==null){const T=Math.max(0,y.start),H=Math.min(Z.count,y.start+y.count);for(let F=T,O=H;F<O;F++){const $=Z.getX(F);_position$2.fromBufferAttribute(V,$),testPoint(_position$2,$,_,I,n,d,this)}}else{const T=Math.max(0,y.start),H=Math.min(V.count,y.start+y.count);for(let F=T,O=H;F<O;F++)_position$2.fromBufferAttribute(V,F),testPoint(_position$2,F,_,I,n,d,this)}}updateMorphTargets(){const d=this.geometry.morphAttributes,C=Object.keys(d);if(C.length>0){const I=d[C[0]];if(I!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,y=I.length;f<y;f++){const B=I[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[B]=f}}}}}function testPoint(u,n,d,C,I,f,y){const B=_ray$4.distanceSqToPoint(u);if(B<d){const _=new Vector3;_ray$4.closestPointToPoint(u,_),_.applyMatrix4(C);const Z=I.ray.origin.distanceTo(_);if(Z<I.near||Z>I.far)return;f.push({distance:Z,distanceToRay:Math.sqrt(B),point:_,index:n,face:null,faceIndex:null,barycoord:null,object:y})}}class VideoTexture extends Texture{constructor(n,d,C,I,f,y,B,_,Z){super(n,d,C,I,f,y,B,_,Z),this.isVideoTexture=!0,this.minFilter=y!==void 0?y:LinearFilter,this.magFilter=f!==void 0?f:LinearFilter,this.generateMipmaps=!1;const M=this;function V(){M.needsUpdate=!0,n.requestVideoFrameCallback(V)}"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback(V)}clone(){return new this.constructor(this.image).copy(this)}update(){const n=this.image;"requestVideoFrameCallback"in n===!1&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class VideoFrameTexture extends VideoTexture{constructor(n,d,C,I,f,y,B,_){super({},n,d,C,I,f,y,B,_),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(n){this.image=n,this.needsUpdate=!0}}class FramebufferTexture extends Texture{constructor(n,d){super({width:n,height:d}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(n,d,C,I,f,y,B,_,Z,M,V,T){super(null,y,B,_,Z,M,I,f,V,T),this.isCompressedTexture=!0,this.image={width:d,height:C},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(n,d,C,I,f,y){super(n,d,C,f,y),this.isCompressedArrayTexture=!0,this.image.depth=I,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(n){this.layerUpdates.add(n)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(n,d,C){super(void 0,n[0].width,n[0].height,d,C,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=n}}class CanvasTexture extends Texture{constructor(n,d,C,I,f,y,B,_,Z){super(n,d,C,I,f,y,B,_,Z),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(n,d,C,I,f,y,B,_,Z,M=DepthFormat){if(M!==DepthFormat&&M!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");C===void 0&&M===DepthFormat&&(C=UnsignedIntType),C===void 0&&M===DepthStencilFormat&&(C=UnsignedInt248Type),super(null,I,f,y,B,_,M,C,Z),this.isDepthTexture=!0,this.image={width:n,height:d},this.magFilter=B!==void 0?B:NearestFilter,this.minFilter=_!==void 0?_:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(n){return super.copy(n),this.source=new Source(Object.assign({},n.image)),this.compareFunction=n.compareFunction,this}toJSON(n){const d=super.toJSON(n);return this.compareFunction!==null&&(d.compareFunction=this.compareFunction),d}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(n,d){const C=this.getUtoTmapping(n);return this.getPoint(C,d)}getPoints(n=5){const d=[];for(let C=0;C<=n;C++)d.push(this.getPoint(C/n));return d}getSpacedPoints(n=5){const d=[];for(let C=0;C<=n;C++)d.push(this.getPointAt(C/n));return d}getLength(){const n=this.getLengths();return n[n.length-1]}getLengths(n=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const d=[];let C,I=this.getPoint(0),f=0;d.push(0);for(let y=1;y<=n;y++)C=this.getPoint(y/n),f+=C.distanceTo(I),d.push(f),I=C;return this.cacheArcLengths=d,d}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(n,d=null){const C=this.getLengths();let I=0;const f=C.length;let y;d?y=d:y=n*C[f-1];let B=0,_=f-1,Z;for(;B<=_;)if(I=Math.floor(B+(_-B)/2),Z=C[I]-y,Z<0)B=I+1;else if(Z>0)_=I-1;else{_=I;break}if(I=_,C[I]===y)return I/(f-1);const M=C[I],T=C[I+1]-M,H=(y-M)/T;return(I+H)/(f-1)}getTangent(n,d){let I=n-1e-4,f=n+1e-4;I<0&&(I=0),f>1&&(f=1);const y=this.getPoint(I),B=this.getPoint(f),_=d||(y.isVector2?new Vector2:new Vector3);return _.copy(B).sub(y).normalize(),_}getTangentAt(n,d){const C=this.getUtoTmapping(n);return this.getTangent(C,d)}computeFrenetFrames(n,d=!1){const C=new Vector3,I=[],f=[],y=[],B=new Vector3,_=new Matrix4;for(let H=0;H<=n;H++){const F=H/n;I[H]=this.getTangentAt(F,new Vector3)}f[0]=new Vector3,y[0]=new Vector3;let Z=Number.MAX_VALUE;const M=Math.abs(I[0].x),V=Math.abs(I[0].y),T=Math.abs(I[0].z);M<=Z&&(Z=M,C.set(1,0,0)),V<=Z&&(Z=V,C.set(0,1,0)),T<=Z&&C.set(0,0,1),B.crossVectors(I[0],C).normalize(),f[0].crossVectors(I[0],B),y[0].crossVectors(I[0],f[0]);for(let H=1;H<=n;H++){if(f[H]=f[H-1].clone(),y[H]=y[H-1].clone(),B.crossVectors(I[H-1],I[H]),B.length()>Number.EPSILON){B.normalize();const F=Math.acos(clamp$1(I[H-1].dot(I[H]),-1,1));f[H].applyMatrix4(_.makeRotationAxis(B,F))}y[H].crossVectors(I[H],f[H])}if(d===!0){let H=Math.acos(clamp$1(f[0].dot(f[n]),-1,1));H/=n,I[0].dot(B.crossVectors(f[0],f[n]))>0&&(H=-H);for(let F=1;F<=n;F++)f[F].applyMatrix4(_.makeRotationAxis(I[F],H*F)),y[F].crossVectors(I[F],f[F])}return{tangents:I,normals:f,binormals:y}}clone(){return new this.constructor().copy(this)}copy(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}toJSON(){const n={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n}fromJSON(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(n=0,d=0,C=1,I=1,f=0,y=Math.PI*2,B=!1,_=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=n,this.aY=d,this.xRadius=C,this.yRadius=I,this.aStartAngle=f,this.aEndAngle=y,this.aClockwise=B,this.aRotation=_}getPoint(n,d=new Vector2){const C=d,I=Math.PI*2;let f=this.aEndAngle-this.aStartAngle;const y=Math.abs(f)<Number.EPSILON;for(;f<0;)f+=I;for(;f>I;)f-=I;f<Number.EPSILON&&(y?f=0:f=I),this.aClockwise===!0&&!y&&(f===I?f=-I:f=f-I);const B=this.aStartAngle+n*f;let _=this.aX+this.xRadius*Math.cos(B),Z=this.aY+this.yRadius*Math.sin(B);if(this.aRotation!==0){const M=Math.cos(this.aRotation),V=Math.sin(this.aRotation),T=_-this.aX,H=Z-this.aY;_=T*M-H*V+this.aX,Z=T*V+H*M+this.aY}return C.set(_,Z)}copy(n){return super.copy(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}toJSON(){const n=super.toJSON();return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n}fromJSON(n){return super.fromJSON(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(n,d,C,I,f,y){super(n,d,C,C,I,f,y),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let u=0,n=0,d=0,C=0;function I(f,y,B,_){u=f,n=B,d=-3*f+3*y-2*B-_,C=2*f-2*y+B+_}return{initCatmullRom:function(f,y,B,_,Z){I(y,B,Z*(B-f),Z*(_-y))},initNonuniformCatmullRom:function(f,y,B,_,Z,M,V){let T=(y-f)/Z-(B-f)/(Z+M)+(B-y)/M,H=(B-y)/M-(_-y)/(M+V)+(_-B)/V;T*=M,H*=M,I(y,B,T,H)},calc:function(f){const y=f*f,B=y*f;return u+n*f+d*y+C*B}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(n=[],d=!1,C="centripetal",I=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=n,this.closed=d,this.curveType=C,this.tension=I}getPoint(n,d=new Vector3){const C=d,I=this.points,f=I.length,y=(f-(this.closed?0:1))*n;let B=Math.floor(y),_=y-B;this.closed?B+=B>0?0:(Math.floor(Math.abs(B)/f)+1)*f:_===0&&B===f-1&&(B=f-2,_=1);let Z,M;this.closed||B>0?Z=I[(B-1)%f]:(tmp.subVectors(I[0],I[1]).add(I[0]),Z=tmp);const V=I[B%f],T=I[(B+1)%f];if(this.closed||B+2<f?M=I[(B+2)%f]:(tmp.subVectors(I[f-1],I[f-2]).add(I[f-1]),M=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const H=this.curveType==="chordal"?.5:.25;let F=Math.pow(Z.distanceToSquared(V),H),O=Math.pow(V.distanceToSquared(T),H),$=Math.pow(T.distanceToSquared(M),H);O<1e-4&&(O=1),F<1e-4&&(F=O),$<1e-4&&($=O),px.initNonuniformCatmullRom(Z.x,V.x,T.x,M.x,F,O,$),py.initNonuniformCatmullRom(Z.y,V.y,T.y,M.y,F,O,$),pz.initNonuniformCatmullRom(Z.z,V.z,T.z,M.z,F,O,$)}else this.curveType==="catmullrom"&&(px.initCatmullRom(Z.x,V.x,T.x,M.x,this.tension),py.initCatmullRom(Z.y,V.y,T.y,M.y,this.tension),pz.initCatmullRom(Z.z,V.z,T.z,M.z,this.tension));return C.set(px.calc(_),py.calc(_),pz.calc(_)),C}copy(n){super.copy(n),this.points=[];for(let d=0,C=n.points.length;d<C;d++){const I=n.points[d];this.points.push(I.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let d=0,C=this.points.length;d<C;d++){const I=this.points[d];n.points.push(I.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let d=0,C=n.points.length;d<C;d++){const I=n.points[d];this.points.push(new Vector3().fromArray(I))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function CatmullRom(u,n,d,C,I){const f=(C-n)*.5,y=(I-d)*.5,B=u*u,_=u*B;return(2*d-2*C+f+y)*_+(-3*d+3*C-2*f-y)*B+f*u+d}function QuadraticBezierP0(u,n){const d=1-u;return d*d*n}function QuadraticBezierP1(u,n){return 2*(1-u)*u*n}function QuadraticBezierP2(u,n){return u*u*n}function QuadraticBezier(u,n,d,C){return QuadraticBezierP0(u,n)+QuadraticBezierP1(u,d)+QuadraticBezierP2(u,C)}function CubicBezierP0(u,n){const d=1-u;return d*d*d*n}function CubicBezierP1(u,n){const d=1-u;return 3*d*d*u*n}function CubicBezierP2(u,n){return 3*(1-u)*u*u*n}function CubicBezierP3(u,n){return u*u*u*n}function CubicBezier(u,n,d,C,I){return CubicBezierP0(u,n)+CubicBezierP1(u,d)+CubicBezierP2(u,C)+CubicBezierP3(u,I)}class CubicBezierCurve extends Curve{constructor(n=new Vector2,d=new Vector2,C=new Vector2,I=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=n,this.v1=d,this.v2=C,this.v3=I}getPoint(n,d=new Vector2){const C=d,I=this.v0,f=this.v1,y=this.v2,B=this.v3;return C.set(CubicBezier(n,I.x,f.x,y.x,B.x),CubicBezier(n,I.y,f.y,y.y,B.y)),C}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class CubicBezierCurve3 extends Curve{constructor(n=new Vector3,d=new Vector3,C=new Vector3,I=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=n,this.v1=d,this.v2=C,this.v3=I}getPoint(n,d=new Vector3){const C=d,I=this.v0,f=this.v1,y=this.v2,B=this.v3;return C.set(CubicBezier(n,I.x,f.x,y.x,B.x),CubicBezier(n,I.y,f.y,y.y,B.y),CubicBezier(n,I.z,f.z,y.z,B.z)),C}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class LineCurve extends Curve{constructor(n=new Vector2,d=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=n,this.v2=d}getPoint(n,d=new Vector2){const C=d;return n===1?C.copy(this.v2):(C.copy(this.v2).sub(this.v1),C.multiplyScalar(n).add(this.v1)),C}getPointAt(n,d){return this.getPoint(n,d)}getTangent(n,d=new Vector2){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(n,d){return this.getTangent(n,d)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class LineCurve3 extends Curve{constructor(n=new Vector3,d=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=n,this.v2=d}getPoint(n,d=new Vector3){const C=d;return n===1?C.copy(this.v2):(C.copy(this.v2).sub(this.v1),C.multiplyScalar(n).add(this.v1)),C}getPointAt(n,d){return this.getPoint(n,d)}getTangent(n,d=new Vector3){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(n,d){return this.getTangent(n,d)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class QuadraticBezierCurve extends Curve{constructor(n=new Vector2,d=new Vector2,C=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=n,this.v1=d,this.v2=C}getPoint(n,d=new Vector2){const C=d,I=this.v0,f=this.v1,y=this.v2;return C.set(QuadraticBezier(n,I.x,f.x,y.x),QuadraticBezier(n,I.y,f.y,y.y)),C}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(n=new Vector3,d=new Vector3,C=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=n,this.v1=d,this.v2=C}getPoint(n,d=new Vector3){const C=d,I=this.v0,f=this.v1,y=this.v2;return C.set(QuadraticBezier(n,I.x,f.x,y.x),QuadraticBezier(n,I.y,f.y,y.y),QuadraticBezier(n,I.z,f.z,y.z)),C}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class SplineCurve extends Curve{constructor(n=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=n}getPoint(n,d=new Vector2){const C=d,I=this.points,f=(I.length-1)*n,y=Math.floor(f),B=f-y,_=I[y===0?y:y-1],Z=I[y],M=I[y>I.length-2?I.length-1:y+1],V=I[y>I.length-3?I.length-1:y+2];return C.set(CatmullRom(B,_.x,Z.x,M.x,V.x),CatmullRom(B,_.y,Z.y,M.y,V.y)),C}copy(n){super.copy(n),this.points=[];for(let d=0,C=n.points.length;d<C;d++){const I=n.points[d];this.points.push(I.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let d=0,C=this.points.length;d<C;d++){const I=this.points[d];n.points.push(I.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let d=0,C=n.points.length;d<C;d++){const I=n.points[d];this.points.push(new Vector2().fromArray(I))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(n){this.curves.push(n)}closePath(){const n=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);if(!n.equals(d)){const C=n.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves[C](d,n))}return this}getPoint(n,d){const C=n*this.getLength(),I=this.getCurveLengths();let f=0;for(;f<I.length;){if(I[f]>=C){const y=I[f]-C,B=this.curves[f],_=B.getLength(),Z=_===0?0:1-y/_;return B.getPointAt(Z,d)}f++}return null}getLength(){const n=this.getCurveLengths();return n[n.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let d=0;for(let C=0,I=this.curves.length;C<I;C++)d+=this.curves[C].getLength(),n.push(d);return this.cacheLengths=n,n}getSpacedPoints(n=40){const d=[];for(let C=0;C<=n;C++)d.push(this.getPoint(C/n));return this.autoClose&&d.push(d[0]),d}getPoints(n=12){const d=[];let C;for(let I=0,f=this.curves;I<f.length;I++){const y=f[I],B=y.isEllipseCurve?n*2:y.isLineCurve||y.isLineCurve3?1:y.isSplineCurve?n*y.points.length:n,_=y.getPoints(B);for(let Z=0;Z<_.length;Z++){const M=_[Z];C&&C.equals(M)||(d.push(M),C=M)}}return this.autoClose&&d.length>1&&!d[d.length-1].equals(d[0])&&d.push(d[0]),d}copy(n){super.copy(n),this.curves=[];for(let d=0,C=n.curves.length;d<C;d++){const I=n.curves[d];this.curves.push(I.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let d=0,C=this.curves.length;d<C;d++){const I=this.curves[d];n.curves.push(I.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let d=0,C=n.curves.length;d<C;d++){const I=n.curves[d];this.curves.push(new Curves[I.type]().fromJSON(I))}return this}}class Path extends CurvePath{constructor(n){super(),this.type="Path",this.currentPoint=new Vector2,n&&this.setFromPoints(n)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let d=1,C=n.length;d<C;d++)this.lineTo(n[d].x,n[d].y);return this}moveTo(n,d){return this.currentPoint.set(n,d),this}lineTo(n,d){const C=new LineCurve(this.currentPoint.clone(),new Vector2(n,d));return this.curves.push(C),this.currentPoint.set(n,d),this}quadraticCurveTo(n,d,C,I){const f=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(n,d),new Vector2(C,I));return this.curves.push(f),this.currentPoint.set(C,I),this}bezierCurveTo(n,d,C,I,f,y){const B=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(n,d),new Vector2(C,I),new Vector2(f,y));return this.curves.push(B),this.currentPoint.set(f,y),this}splineThru(n){const d=[this.currentPoint.clone()].concat(n),C=new SplineCurve(d);return this.curves.push(C),this.currentPoint.copy(n[n.length-1]),this}arc(n,d,C,I,f,y){const B=this.currentPoint.x,_=this.currentPoint.y;return this.absarc(n+B,d+_,C,I,f,y),this}absarc(n,d,C,I,f,y){return this.absellipse(n,d,C,C,I,f,y),this}ellipse(n,d,C,I,f,y,B,_){const Z=this.currentPoint.x,M=this.currentPoint.y;return this.absellipse(n+Z,d+M,C,I,f,y,B,_),this}absellipse(n,d,C,I,f,y,B,_){const Z=new EllipseCurve(n,d,C,I,f,y,B,_);if(this.curves.length>0){const V=Z.getPoint(0);V.equals(this.currentPoint)||this.lineTo(V.x,V.y)}this.curves.push(Z);const M=Z.getPoint(1);return this.currentPoint.copy(M),this}copy(n){return super.copy(n),this.currentPoint.copy(n.currentPoint),this}toJSON(){const n=super.toJSON();return n.currentPoint=this.currentPoint.toArray(),n}fromJSON(n){return super.fromJSON(n),this.currentPoint.fromArray(n.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(n=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],d=12,C=0,I=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:n,segments:d,phiStart:C,phiLength:I},d=Math.floor(d),I=clamp$1(I,0,Math.PI*2);const f=[],y=[],B=[],_=[],Z=[],M=1/d,V=new Vector3,T=new Vector2,H=new Vector3,F=new Vector3,O=new Vector3;let $=0,U=0;for(let ee=0;ee<=n.length-1;ee++)switch(ee){case 0:$=n[ee+1].x-n[ee].x,U=n[ee+1].y-n[ee].y,H.x=U*1,H.y=-$,H.z=U*0,O.copy(H),H.normalize(),_.push(H.x,H.y,H.z);break;case n.length-1:_.push(O.x,O.y,O.z);break;default:$=n[ee+1].x-n[ee].x,U=n[ee+1].y-n[ee].y,H.x=U*1,H.y=-$,H.z=U*0,F.copy(H),H.x+=O.x,H.y+=O.y,H.z+=O.z,H.normalize(),_.push(H.x,H.y,H.z),O.copy(F)}for(let ee=0;ee<=d;ee++){const Q=C+ee*M*I,ie=Math.sin(Q),ne=Math.cos(Q);for(let le=0;le<=n.length-1;le++){V.x=n[le].x*ie,V.y=n[le].y,V.z=n[le].x*ne,y.push(V.x,V.y,V.z),T.x=ee/d,T.y=le/(n.length-1),B.push(T.x,T.y);const ae=_[3*le+0]*ie,ce=_[3*le+1],ge=_[3*le+0]*ne;Z.push(ae,ce,ge)}}for(let ee=0;ee<d;ee++)for(let Q=0;Q<n.length-1;Q++){const ie=Q+ee*n.length,ne=ie,le=ie+n.length,ae=ie+n.length+1,ce=ie+1;f.push(ne,le,ce),f.push(ae,ce,le)}this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("uv",new Float32BufferAttribute(B,2)),this.setAttribute("normal",new Float32BufferAttribute(Z,3))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new LatheGeometry(n.points,n.segments,n.phiStart,n.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(n=1,d=1,C=4,I=8){const f=new Path;f.absarc(0,-d/2,n,Math.PI*1.5,0),f.absarc(0,d/2,n,0,Math.PI*.5),super(f.getPoints(C),I),this.type="CapsuleGeometry",this.parameters={radius:n,length:d,capSegments:C,radialSegments:I}}static fromJSON(n){return new CapsuleGeometry(n.radius,n.length,n.capSegments,n.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(n=1,d=32,C=0,I=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:d,thetaStart:C,thetaLength:I},d=Math.max(3,d);const f=[],y=[],B=[],_=[],Z=new Vector3,M=new Vector2;y.push(0,0,0),B.push(0,0,1),_.push(.5,.5);for(let V=0,T=3;V<=d;V++,T+=3){const H=C+V/d*I;Z.x=n*Math.cos(H),Z.y=n*Math.sin(H),y.push(Z.x,Z.y,Z.z),B.push(0,0,1),M.x=(y[T]/n+1)/2,M.y=(y[T+1]/n+1)/2,_.push(M.x,M.y)}for(let V=1;V<=d;V++)f.push(V,V+1,0);this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("normal",new Float32BufferAttribute(B,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new CircleGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(n=1,d=1,C=1,I=32,f=1,y=!1,B=0,_=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:n,radiusBottom:d,height:C,radialSegments:I,heightSegments:f,openEnded:y,thetaStart:B,thetaLength:_};const Z=this;I=Math.floor(I),f=Math.floor(f);const M=[],V=[],T=[],H=[];let F=0;const O=[],$=C/2;let U=0;ee(),y===!1&&(n>0&&Q(!0),d>0&&Q(!1)),this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(H,2));function ee(){const ie=new Vector3,ne=new Vector3;let le=0;const ae=(d-n)/C;for(let ce=0;ce<=f;ce++){const ge=[],he=ce/f,Ie=he*(d-n)+n;for(let fe=0;fe<=I;fe++){const me=fe/I,Ge=me*_+B,Ze=Math.sin(Ge),ye=Math.cos(Ge);ne.x=Ie*Ze,ne.y=-he*C+$,ne.z=Ie*ye,V.push(ne.x,ne.y,ne.z),ie.set(Ze,ae,ye).normalize(),T.push(ie.x,ie.y,ie.z),H.push(me,1-he),ge.push(F++)}O.push(ge)}for(let ce=0;ce<I;ce++)for(let ge=0;ge<f;ge++){const he=O[ge][ce],Ie=O[ge+1][ce],fe=O[ge+1][ce+1],me=O[ge][ce+1];(n>0||ge!==0)&&(M.push(he,Ie,me),le+=3),(d>0||ge!==f-1)&&(M.push(Ie,fe,me),le+=3)}Z.addGroup(U,le,0),U+=le}function Q(ie){const ne=F,le=new Vector2,ae=new Vector3;let ce=0;const ge=ie===!0?n:d,he=ie===!0?1:-1;for(let fe=1;fe<=I;fe++)V.push(0,$*he,0),T.push(0,he,0),H.push(.5,.5),F++;const Ie=F;for(let fe=0;fe<=I;fe++){const Ge=fe/I*_+B,Ze=Math.cos(Ge),ye=Math.sin(Ge);ae.x=ge*ye,ae.y=$*he,ae.z=ge*Ze,V.push(ae.x,ae.y,ae.z),T.push(0,he,0),le.x=Ze*.5+.5,le.y=ye*.5*he+.5,H.push(le.x,le.y),F++}for(let fe=0;fe<I;fe++){const me=ne+fe,Ge=Ie+fe;ie===!0?M.push(Ge,Ge+1,me):M.push(Ge+1,Ge,me),ce+=3}Z.addGroup(U,ce,ie===!0?1:2),U+=ce}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new CylinderGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(n=1,d=1,C=32,I=1,f=!1,y=0,B=Math.PI*2){super(0,n,d,C,I,f,y,B),this.type="ConeGeometry",this.parameters={radius:n,height:d,radialSegments:C,heightSegments:I,openEnded:f,thetaStart:y,thetaLength:B}}static fromJSON(n){return new ConeGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(n=[],d=[],C=1,I=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:d,radius:C,detail:I};const f=[],y=[];B(I),Z(C),M(),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(f.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(y,2)),I===0?this.computeVertexNormals():this.normalizeNormals();function B(ee){const Q=new Vector3,ie=new Vector3,ne=new Vector3;for(let le=0;le<d.length;le+=3)H(d[le+0],Q),H(d[le+1],ie),H(d[le+2],ne),_(Q,ie,ne,ee)}function _(ee,Q,ie,ne){const le=ne+1,ae=[];for(let ce=0;ce<=le;ce++){ae[ce]=[];const ge=ee.clone().lerp(ie,ce/le),he=Q.clone().lerp(ie,ce/le),Ie=le-ce;for(let fe=0;fe<=Ie;fe++)fe===0&&ce===le?ae[ce][fe]=ge:ae[ce][fe]=ge.clone().lerp(he,fe/Ie)}for(let ce=0;ce<le;ce++)for(let ge=0;ge<2*(le-ce)-1;ge++){const he=Math.floor(ge/2);ge%2===0?(T(ae[ce][he+1]),T(ae[ce+1][he]),T(ae[ce][he])):(T(ae[ce][he+1]),T(ae[ce+1][he+1]),T(ae[ce+1][he]))}}function Z(ee){const Q=new Vector3;for(let ie=0;ie<f.length;ie+=3)Q.x=f[ie+0],Q.y=f[ie+1],Q.z=f[ie+2],Q.normalize().multiplyScalar(ee),f[ie+0]=Q.x,f[ie+1]=Q.y,f[ie+2]=Q.z}function M(){const ee=new Vector3;for(let Q=0;Q<f.length;Q+=3){ee.x=f[Q+0],ee.y=f[Q+1],ee.z=f[Q+2];const ie=$(ee)/2/Math.PI+.5,ne=U(ee)/Math.PI+.5;y.push(ie,1-ne)}F(),V()}function V(){for(let ee=0;ee<y.length;ee+=6){const Q=y[ee+0],ie=y[ee+2],ne=y[ee+4],le=Math.max(Q,ie,ne),ae=Math.min(Q,ie,ne);le>.9&&ae<.1&&(Q<.2&&(y[ee+0]+=1),ie<.2&&(y[ee+2]+=1),ne<.2&&(y[ee+4]+=1))}}function T(ee){f.push(ee.x,ee.y,ee.z)}function H(ee,Q){const ie=ee*3;Q.x=n[ie+0],Q.y=n[ie+1],Q.z=n[ie+2]}function F(){const ee=new Vector3,Q=new Vector3,ie=new Vector3,ne=new Vector3,le=new Vector2,ae=new Vector2,ce=new Vector2;for(let ge=0,he=0;ge<f.length;ge+=9,he+=6){ee.set(f[ge+0],f[ge+1],f[ge+2]),Q.set(f[ge+3],f[ge+4],f[ge+5]),ie.set(f[ge+6],f[ge+7],f[ge+8]),le.set(y[he+0],y[he+1]),ae.set(y[he+2],y[he+3]),ce.set(y[he+4],y[he+5]),ne.copy(ee).add(Q).add(ie).divideScalar(3);const Ie=$(ne);O(le,he+0,ee,Ie),O(ae,he+2,Q,Ie),O(ce,he+4,ie,Ie)}}function O(ee,Q,ie,ne){ne<0&&ee.x===1&&(y[Q]=ee.x-1),ie.x===0&&ie.z===0&&(y[Q]=ne/2/Math.PI+.5)}function $(ee){return Math.atan2(ee.z,-ee.x)}function U(ee){return Math.atan2(-ee.y,Math.sqrt(ee.x*ee.x+ee.z*ee.z))}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new PolyhedronGeometry(n.vertices,n.indices,n.radius,n.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(n=1,d=0){const C=(1+Math.sqrt(5))/2,I=1/C,f=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-I,-C,0,-I,C,0,I,-C,0,I,C,-I,-C,0,-I,C,0,I,-C,0,I,C,0,-C,0,-I,C,0,-I,-C,0,I,C,0,I],y=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(f,y,n,d),this.type="DodecahedronGeometry",this.parameters={radius:n,detail:d}}static fromJSON(n){return new DodecahedronGeometry(n.radius,n.detail)}}const _v0$3=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(n=null,d=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:n,thresholdAngle:d},n!==null){const I=Math.pow(10,4),f=Math.cos(DEG2RAD*d),y=n.getIndex(),B=n.getAttribute("position"),_=y?y.count:B.count,Z=[0,0,0],M=["a","b","c"],V=new Array(3),T={},H=[];for(let F=0;F<_;F+=3){y?(Z[0]=y.getX(F),Z[1]=y.getX(F+1),Z[2]=y.getX(F+2)):(Z[0]=F,Z[1]=F+1,Z[2]=F+2);const{a:O,b:$,c:U}=_triangle;if(O.fromBufferAttribute(B,Z[0]),$.fromBufferAttribute(B,Z[1]),U.fromBufferAttribute(B,Z[2]),_triangle.getNormal(_normal),V[0]=`${Math.round(O.x*I)},${Math.round(O.y*I)},${Math.round(O.z*I)}`,V[1]=`${Math.round($.x*I)},${Math.round($.y*I)},${Math.round($.z*I)}`,V[2]=`${Math.round(U.x*I)},${Math.round(U.y*I)},${Math.round(U.z*I)}`,!(V[0]===V[1]||V[1]===V[2]||V[2]===V[0]))for(let ee=0;ee<3;ee++){const Q=(ee+1)%3,ie=V[ee],ne=V[Q],le=_triangle[M[ee]],ae=_triangle[M[Q]],ce=`${ie}_${ne}`,ge=`${ne}_${ie}`;ge in T&&T[ge]?(_normal.dot(T[ge].normal)<=f&&(H.push(le.x,le.y,le.z),H.push(ae.x,ae.y,ae.z)),T[ge]=null):ce in T||(T[ce]={index0:Z[ee],index1:Z[Q],normal:_normal.clone()})}}for(const F in T)if(T[F]){const{index0:O,index1:$}=T[F];_v0$3.fromBufferAttribute(B,O),_v1$1.fromBufferAttribute(B,$),H.push(_v0$3.x,_v0$3.y,_v0$3.z),H.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(H,3))}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}}let Shape$2=class extends Path{constructor(n){super(n),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(n){const d=[];for(let C=0,I=this.holes.length;C<I;C++)d[C]=this.holes[C].getPoints(n);return d}extractPoints(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}}copy(n){super.copy(n),this.holes=[];for(let d=0,C=n.holes.length;d<C;d++){const I=n.holes[d];this.holes.push(I.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let d=0,C=this.holes.length;d<C;d++){const I=this.holes[d];n.holes.push(I.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let d=0,C=n.holes.length;d<C;d++){const I=n.holes[d];this.holes.push(new Path().fromJSON(I))}return this}};class Earcut{static triangulate(n,d,C=2){const I=d&&d.length,f=I?d[0]*C:n.length;let y=linkedList(n,0,f,C,!0);const B=[];if(!y||y.next===y.prev)return B;let _,Z,M,V,T,H,F;if(I&&(y=eliminateHoles(n,d,y,C)),n.length>80*C){_=M=n[0],Z=V=n[1];for(let O=C;O<f;O+=C)T=n[O],H=n[O+1],T<_&&(_=T),H<Z&&(Z=H),T>M&&(M=T),H>V&&(V=H);F=Math.max(M-_,V-Z),F=F!==0?32767/F:0}return earcutLinked(y,B,C,_,Z,F,0),B}}function linkedList(u,n,d,C,I){let f,y;if(I===signedArea(u,n,d,C)>0)for(f=n;f<d;f+=C)y=insertNode(f,u[f],u[f+1],y);else for(f=d-C;f>=n;f-=C)y=insertNode(f,u[f],u[f+1],y);return y&&equals(y,y.next)&&(removeNode(y),y=y.next),y}function filterPoints(u,n){if(!u)return u;n||(n=u);let d=u,C;do if(C=!1,!d.steiner&&(equals(d,d.next)||area(d.prev,d,d.next)===0)){if(removeNode(d),d=n=d.prev,d===d.next)break;C=!0}else d=d.next;while(C||d!==n);return n}function earcutLinked(u,n,d,C,I,f,y){if(!u)return;!y&&f&&indexCurve(u,C,I,f);let B=u,_,Z;for(;u.prev!==u.next;){if(_=u.prev,Z=u.next,f?isEarHashed(u,C,I,f):isEar(u)){n.push(_.i/d|0),n.push(u.i/d|0),n.push(Z.i/d|0),removeNode(u),u=Z.next,B=Z.next;continue}if(u=Z,u===B){y?y===1?(u=cureLocalIntersections(filterPoints(u),n,d),earcutLinked(u,n,d,C,I,f,2)):y===2&&splitEarcut(u,n,d,C,I,f):earcutLinked(filterPoints(u),n,d,C,I,f,1);break}}}function isEar(u){const n=u.prev,d=u,C=u.next;if(area(n,d,C)>=0)return!1;const I=n.x,f=d.x,y=C.x,B=n.y,_=d.y,Z=C.y,M=I<f?I<y?I:y:f<y?f:y,V=B<_?B<Z?B:Z:_<Z?_:Z,T=I>f?I>y?I:y:f>y?f:y,H=B>_?B>Z?B:Z:_>Z?_:Z;let F=C.next;for(;F!==n;){if(F.x>=M&&F.x<=T&&F.y>=V&&F.y<=H&&pointInTriangle(I,B,f,_,y,Z,F.x,F.y)&&area(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function isEarHashed(u,n,d,C){const I=u.prev,f=u,y=u.next;if(area(I,f,y)>=0)return!1;const B=I.x,_=f.x,Z=y.x,M=I.y,V=f.y,T=y.y,H=B<_?B<Z?B:Z:_<Z?_:Z,F=M<V?M<T?M:T:V<T?V:T,O=B>_?B>Z?B:Z:_>Z?_:Z,$=M>V?M>T?M:T:V>T?V:T,U=zOrder(H,F,n,d,C),ee=zOrder(O,$,n,d,C);let Q=u.prevZ,ie=u.nextZ;for(;Q&&Q.z>=U&&ie&&ie.z<=ee;){if(Q.x>=H&&Q.x<=O&&Q.y>=F&&Q.y<=$&&Q!==I&&Q!==y&&pointInTriangle(B,M,_,V,Z,T,Q.x,Q.y)&&area(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ie.x>=H&&ie.x<=O&&ie.y>=F&&ie.y<=$&&ie!==I&&ie!==y&&pointInTriangle(B,M,_,V,Z,T,ie.x,ie.y)&&area(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;Q&&Q.z>=U;){if(Q.x>=H&&Q.x<=O&&Q.y>=F&&Q.y<=$&&Q!==I&&Q!==y&&pointInTriangle(B,M,_,V,Z,T,Q.x,Q.y)&&area(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ie&&ie.z<=ee;){if(ie.x>=H&&ie.x<=O&&ie.y>=F&&ie.y<=$&&ie!==I&&ie!==y&&pointInTriangle(B,M,_,V,Z,T,ie.x,ie.y)&&area(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function cureLocalIntersections(u,n,d){let C=u;do{const I=C.prev,f=C.next.next;!equals(I,f)&&intersects(I,C,C.next,f)&&locallyInside(I,f)&&locallyInside(f,I)&&(n.push(I.i/d|0),n.push(C.i/d|0),n.push(f.i/d|0),removeNode(C),removeNode(C.next),C=u=f),C=C.next}while(C!==u);return filterPoints(C)}function splitEarcut(u,n,d,C,I,f){let y=u;do{let B=y.next.next;for(;B!==y.prev;){if(y.i!==B.i&&isValidDiagonal(y,B)){let _=splitPolygon(y,B);y=filterPoints(y,y.next),_=filterPoints(_,_.next),earcutLinked(y,n,d,C,I,f,0),earcutLinked(_,n,d,C,I,f,0);return}B=B.next}y=y.next}while(y!==u)}function eliminateHoles(u,n,d,C){const I=[];let f,y,B,_,Z;for(f=0,y=n.length;f<y;f++)B=n[f]*C,_=f<y-1?n[f+1]*C:u.length,Z=linkedList(u,B,_,C,!1),Z===Z.next&&(Z.steiner=!0),I.push(getLeftmost(Z));for(I.sort(compareX),f=0;f<I.length;f++)d=eliminateHole(I[f],d);return d}function compareX(u,n){return u.x-n.x}function eliminateHole(u,n){const d=findHoleBridge(u,n);if(!d)return n;const C=splitPolygon(d,u);return filterPoints(C,C.next),filterPoints(d,d.next)}function findHoleBridge(u,n){let d=n,C=-1/0,I;const f=u.x,y=u.y;do{if(y<=d.y&&y>=d.next.y&&d.next.y!==d.y){const T=d.x+(y-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(T<=f&&T>C&&(C=T,I=d.x<d.next.x?d:d.next,T===f))return I}d=d.next}while(d!==n);if(!I)return null;const B=I,_=I.x,Z=I.y;let M=1/0,V;d=I;do f>=d.x&&d.x>=_&&f!==d.x&&pointInTriangle(y<Z?f:C,y,_,Z,y<Z?C:f,y,d.x,d.y)&&(V=Math.abs(y-d.y)/(f-d.x),locallyInside(d,u)&&(V<M||V===M&&(d.x>I.x||d.x===I.x&&sectorContainsSector(I,d)))&&(I=d,M=V)),d=d.next;while(d!==B);return I}function sectorContainsSector(u,n){return area(u.prev,u,n.prev)<0&&area(n.next,u,u.next)<0}function indexCurve(u,n,d,C){let I=u;do I.z===0&&(I.z=zOrder(I.x,I.y,n,d,C)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==u);I.prevZ.nextZ=null,I.prevZ=null,sortLinked(I)}function sortLinked(u){let n,d,C,I,f,y,B,_,Z=1;do{for(d=u,u=null,f=null,y=0;d;){for(y++,C=d,B=0,n=0;n<Z&&(B++,C=C.nextZ,!!C);n++);for(_=Z;B>0||_>0&&C;)B!==0&&(_===0||!C||d.z<=C.z)?(I=d,d=d.nextZ,B--):(I=C,C=C.nextZ,_--),f?f.nextZ=I:u=I,I.prevZ=f,f=I;d=C}f.nextZ=null,Z*=2}while(y>1);return u}function zOrder(u,n,d,C,I){return u=(u-d)*I|0,n=(n-C)*I|0,u=(u|u<<8)&16711935,u=(u|u<<4)&252645135,u=(u|u<<2)&858993459,u=(u|u<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,u|n<<1}function getLeftmost(u){let n=u,d=u;do(n.x<d.x||n.x===d.x&&n.y<d.y)&&(d=n),n=n.next;while(n!==u);return d}function pointInTriangle(u,n,d,C,I,f,y,B){return(I-y)*(n-B)>=(u-y)*(f-B)&&(u-y)*(C-B)>=(d-y)*(n-B)&&(d-y)*(f-B)>=(I-y)*(C-B)}function isValidDiagonal(u,n){return u.next.i!==n.i&&u.prev.i!==n.i&&!intersectsPolygon(u,n)&&(locallyInside(u,n)&&locallyInside(n,u)&&middleInside(u,n)&&(area(u.prev,u,n.prev)||area(u,n.prev,n))||equals(u,n)&&area(u.prev,u,u.next)>0&&area(n.prev,n,n.next)>0)}function area(u,n,d){return(n.y-u.y)*(d.x-n.x)-(n.x-u.x)*(d.y-n.y)}function equals(u,n){return u.x===n.x&&u.y===n.y}function intersects(u,n,d,C){const I=sign(area(u,n,d)),f=sign(area(u,n,C)),y=sign(area(d,C,u)),B=sign(area(d,C,n));return!!(I!==f&&y!==B||I===0&&onSegment(u,d,n)||f===0&&onSegment(u,C,n)||y===0&&onSegment(d,u,C)||B===0&&onSegment(d,n,C))}function onSegment(u,n,d){return n.x<=Math.max(u.x,d.x)&&n.x>=Math.min(u.x,d.x)&&n.y<=Math.max(u.y,d.y)&&n.y>=Math.min(u.y,d.y)}function sign(u){return u>0?1:u<0?-1:0}function intersectsPolygon(u,n){let d=u;do{if(d.i!==u.i&&d.next.i!==u.i&&d.i!==n.i&&d.next.i!==n.i&&intersects(d,d.next,u,n))return!0;d=d.next}while(d!==u);return!1}function locallyInside(u,n){return area(u.prev,u,u.next)<0?area(u,n,u.next)>=0&&area(u,u.prev,n)>=0:area(u,n,u.prev)<0||area(u,u.next,n)<0}function middleInside(u,n){let d=u,C=!1;const I=(u.x+n.x)/2,f=(u.y+n.y)/2;do d.y>f!=d.next.y>f&&d.next.y!==d.y&&I<(d.next.x-d.x)*(f-d.y)/(d.next.y-d.y)+d.x&&(C=!C),d=d.next;while(d!==u);return C}function splitPolygon(u,n){const d=new Node$1(u.i,u.x,u.y),C=new Node$1(n.i,n.x,n.y),I=u.next,f=n.prev;return u.next=n,n.prev=u,d.next=I,I.prev=d,C.next=d,d.prev=C,f.next=C,C.prev=f,C}function insertNode(u,n,d,C){const I=new Node$1(u,n,d);return C?(I.next=C.next,I.prev=C,C.next.prev=I,C.next=I):(I.prev=I,I.next=I),I}function removeNode(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Node$1(u,n,d){this.i=u,this.x=n,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(u,n,d,C){let I=0;for(let f=n,y=d-C;f<d;f+=C)I+=(u[y]-u[f])*(u[f+1]+u[y+1]),y=f;return I}class ShapeUtils{static area(n){const d=n.length;let C=0;for(let I=d-1,f=0;f<d;I=f++)C+=n[I].x*n[f].y-n[f].x*n[I].y;return C*.5}static isClockWise(n){return ShapeUtils.area(n)<0}static triangulateShape(n,d){const C=[],I=[],f=[];removeDupEndPts(n),addContour(C,n);let y=n.length;d.forEach(removeDupEndPts);for(let _=0;_<d.length;_++)I.push(y),y+=d[_].length,addContour(C,d[_]);const B=Earcut.triangulate(C,I);for(let _=0;_<B.length;_+=3)f.push(B.slice(_,_+3));return f}}function removeDupEndPts(u){const n=u.length;n>2&&u[n-1].equals(u[0])&&u.pop()}function addContour(u,n){for(let d=0;d<n.length;d++)u.push(n[d].x),u.push(n[d].y)}class ExtrudeGeometry extends BufferGeometry{constructor(n=new Shape$2([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),d={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:d},n=Array.isArray(n)?n:[n];const C=this,I=[],f=[];for(let B=0,_=n.length;B<_;B++){const Z=n[B];y(Z)}this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2)),this.computeVertexNormals();function y(B){const _=[],Z=d.curveSegments!==void 0?d.curveSegments:12,M=d.steps!==void 0?d.steps:1,V=d.depth!==void 0?d.depth:1;let T=d.bevelEnabled!==void 0?d.bevelEnabled:!0,H=d.bevelThickness!==void 0?d.bevelThickness:.2,F=d.bevelSize!==void 0?d.bevelSize:H-.1,O=d.bevelOffset!==void 0?d.bevelOffset:0,$=d.bevelSegments!==void 0?d.bevelSegments:3;const U=d.extrudePath,ee=d.UVGenerator!==void 0?d.UVGenerator:WorldUVGenerator;let Q,ie=!1,ne,le,ae,ce;U&&(Q=U.getSpacedPoints(M),ie=!0,T=!1,ne=U.computeFrenetFrames(M,!1),le=new Vector3,ae=new Vector3,ce=new Vector3),T||($=0,H=0,F=0,O=0);const ge=B.extractPoints(Z);let he=ge.shape;const Ie=ge.holes;if(!ShapeUtils.isClockWise(he)){he=he.reverse();for(let rt=0,nt=Ie.length;rt<nt;rt++){const we=Ie[rt];ShapeUtils.isClockWise(we)&&(Ie[rt]=we.reverse())}}const me=ShapeUtils.triangulateShape(he,Ie),Ge=he;for(let rt=0,nt=Ie.length;rt<nt;rt++){const we=Ie[rt];he=he.concat(we)}function Ze(rt,nt,we){return nt||console.error("THREE.ExtrudeGeometry: vec does not exist"),rt.clone().addScaledVector(nt,we)}const ye=he.length,Ee=me.length;function Ve(rt,nt,we){let Jt,It,Ht;const mt=rt.x-nt.x,ni=rt.y-nt.y,kt=we.x-rt.x,Me=we.y-rt.y,ve=mt*mt+ni*ni,et=mt*Me-ni*kt;if(Math.abs(et)>Number.EPSILON){const ht=Math.sqrt(ve),Xt=Math.sqrt(kt*kt+Me*Me),Ue=nt.x-ni/ht,ft=nt.y+mt/ht,Dt=we.x-Me/Xt,jt=we.y+kt/Xt,ii=((Dt-Ue)*Me-(jt-ft)*kt)/(mt*Me-ni*kt);Jt=Ue+mt*ii-rt.x,It=ft+ni*ii-rt.y;const it=Jt*Jt+It*It;if(it<=2)return new Vector2(Jt,It);Ht=Math.sqrt(it/2)}else{let ht=!1;mt>Number.EPSILON?kt>Number.EPSILON&&(ht=!0):mt<-Number.EPSILON?kt<-Number.EPSILON&&(ht=!0):Math.sign(ni)===Math.sign(Me)&&(ht=!0),ht?(Jt=-ni,It=mt,Ht=Math.sqrt(ve)):(Jt=mt,It=ni,Ht=Math.sqrt(ve/2))}return new Vector2(Jt/Ht,It/Ht)}const Ye=[];for(let rt=0,nt=Ge.length,we=nt-1,Jt=rt+1;rt<nt;rt++,we++,Jt++)we===nt&&(we=0),Jt===nt&&(Jt=0),Ye[rt]=Ve(Ge[rt],Ge[we],Ge[Jt]);const be=[];let Be,Ne=Ye.concat();for(let rt=0,nt=Ie.length;rt<nt;rt++){const we=Ie[rt];Be=[];for(let Jt=0,It=we.length,Ht=It-1,mt=Jt+1;Jt<It;Jt++,Ht++,mt++)Ht===It&&(Ht=0),mt===It&&(mt=0),Be[Jt]=Ve(we[Jt],we[Ht],we[mt]);be.push(Be),Ne=Ne.concat(Be)}for(let rt=0;rt<$;rt++){const nt=rt/$,we=H*Math.cos(nt*Math.PI/2),Jt=F*Math.sin(nt*Math.PI/2)+O;for(let It=0,Ht=Ge.length;It<Ht;It++){const mt=Ze(Ge[It],Ye[It],Jt);Fe(mt.x,mt.y,-we)}for(let It=0,Ht=Ie.length;It<Ht;It++){const mt=Ie[It];Be=be[It];for(let ni=0,kt=mt.length;ni<kt;ni++){const Me=Ze(mt[ni],Be[ni],Jt);Fe(Me.x,Me.y,-we)}}}const Ae=F+O;for(let rt=0;rt<ye;rt++){const nt=T?Ze(he[rt],Ne[rt],Ae):he[rt];ie?(ae.copy(ne.normals[0]).multiplyScalar(nt.x),le.copy(ne.binormals[0]).multiplyScalar(nt.y),ce.copy(Q[0]).add(ae).add(le),Fe(ce.x,ce.y,ce.z)):Fe(nt.x,nt.y,0)}for(let rt=1;rt<=M;rt++)for(let nt=0;nt<ye;nt++){const we=T?Ze(he[nt],Ne[nt],Ae):he[nt];ie?(ae.copy(ne.normals[rt]).multiplyScalar(we.x),le.copy(ne.binormals[rt]).multiplyScalar(we.y),ce.copy(Q[rt]).add(ae).add(le),Fe(ce.x,ce.y,ce.z)):Fe(we.x,we.y,V/M*rt)}for(let rt=$-1;rt>=0;rt--){const nt=rt/$,we=H*Math.cos(nt*Math.PI/2),Jt=F*Math.sin(nt*Math.PI/2)+O;for(let It=0,Ht=Ge.length;It<Ht;It++){const mt=Ze(Ge[It],Ye[It],Jt);Fe(mt.x,mt.y,V+we)}for(let It=0,Ht=Ie.length;It<Ht;It++){const mt=Ie[It];Be=be[It];for(let ni=0,kt=mt.length;ni<kt;ni++){const Me=Ze(mt[ni],Be[ni],Jt);ie?Fe(Me.x,Me.y+Q[M-1].y,Q[M-1].x+we):Fe(Me.x,Me.y,V+we)}}}Re(),We();function Re(){const rt=I.length/3;if(T){let nt=0,we=ye*nt;for(let Jt=0;Jt<Ee;Jt++){const It=me[Jt];Ke(It[2]+we,It[1]+we,It[0]+we)}nt=M+$*2,we=ye*nt;for(let Jt=0;Jt<Ee;Jt++){const It=me[Jt];Ke(It[0]+we,It[1]+we,It[2]+we)}}else{for(let nt=0;nt<Ee;nt++){const we=me[nt];Ke(we[2],we[1],we[0])}for(let nt=0;nt<Ee;nt++){const we=me[nt];Ke(we[0]+ye*M,we[1]+ye*M,we[2]+ye*M)}}C.addGroup(rt,I.length/3-rt,0)}function We(){const rt=I.length/3;let nt=0;De(Ge,nt),nt+=Ge.length;for(let we=0,Jt=Ie.length;we<Jt;we++){const It=Ie[we];De(It,nt),nt+=It.length}C.addGroup(rt,I.length/3-rt,1)}function De(rt,nt){let we=rt.length;for(;--we>=0;){const Jt=we;let It=we-1;It<0&&(It=rt.length-1);for(let Ht=0,mt=M+$*2;Ht<mt;Ht++){const ni=ye*Ht,kt=ye*(Ht+1),Me=nt+Jt+ni,ve=nt+It+ni,et=nt+It+kt,ht=nt+Jt+kt;Rt(Me,ve,et,ht)}}}function Fe(rt,nt,we){_.push(rt),_.push(nt),_.push(we)}function Ke(rt,nt,we){dt(rt),dt(nt),dt(we);const Jt=I.length/3,It=ee.generateTopUV(C,I,Jt-3,Jt-2,Jt-1);Ut(It[0]),Ut(It[1]),Ut(It[2])}function Rt(rt,nt,we,Jt){dt(rt),dt(nt),dt(Jt),dt(nt),dt(we),dt(Jt);const It=I.length/3,Ht=ee.generateSideWallUV(C,I,It-6,It-3,It-2,It-1);Ut(Ht[0]),Ut(Ht[1]),Ut(Ht[3]),Ut(Ht[1]),Ut(Ht[2]),Ut(Ht[3])}function dt(rt){I.push(_[rt*3+0]),I.push(_[rt*3+1]),I.push(_[rt*3+2])}function Ut(rt){f.push(rt.x),f.push(rt.y)}}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON(),d=this.parameters.shapes,C=this.parameters.options;return toJSON$1(d,C,n)}static fromJSON(n,d){const C=[];for(let f=0,y=n.shapes.length;f<y;f++){const B=d[n.shapes[f]];C.push(B)}const I=n.options.extrudePath;return I!==void 0&&(n.options.extrudePath=new Curves[I.type]().fromJSON(I)),new ExtrudeGeometry(C,n.options)}}const WorldUVGenerator={generateTopUV:function(u,n,d,C,I){const f=n[d*3],y=n[d*3+1],B=n[C*3],_=n[C*3+1],Z=n[I*3],M=n[I*3+1];return[new Vector2(f,y),new Vector2(B,_),new Vector2(Z,M)]},generateSideWallUV:function(u,n,d,C,I,f){const y=n[d*3],B=n[d*3+1],_=n[d*3+2],Z=n[C*3],M=n[C*3+1],V=n[C*3+2],T=n[I*3],H=n[I*3+1],F=n[I*3+2],O=n[f*3],$=n[f*3+1],U=n[f*3+2];return Math.abs(B-M)<Math.abs(y-Z)?[new Vector2(y,1-_),new Vector2(Z,1-V),new Vector2(T,1-F),new Vector2(O,1-U)]:[new Vector2(B,1-_),new Vector2(M,1-V),new Vector2(H,1-F),new Vector2($,1-U)]}};function toJSON$1(u,n,d){if(d.shapes=[],Array.isArray(u))for(let C=0,I=u.length;C<I;C++){const f=u[C];d.shapes.push(f.uuid)}else d.shapes.push(u.uuid);return d.options=Object.assign({},n),n.extrudePath!==void 0&&(d.options.extrudePath=n.extrudePath.toJSON()),d}class IcosahedronGeometry extends PolyhedronGeometry{constructor(n=1,d=0){const C=(1+Math.sqrt(5))/2,I=[-1,C,0,1,C,0,-1,-C,0,1,-C,0,0,-1,C,0,1,C,0,-1,-C,0,1,-C,C,0,-1,C,0,1,-C,0,-1,-C,0,1],f=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(I,f,n,d),this.type="IcosahedronGeometry",this.parameters={radius:n,detail:d}}static fromJSON(n){return new IcosahedronGeometry(n.radius,n.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(n=1,d=0){const C=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],I=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(C,I,n,d),this.type="OctahedronGeometry",this.parameters={radius:n,detail:d}}static fromJSON(n){return new OctahedronGeometry(n.radius,n.detail)}}class PlaneGeometry extends BufferGeometry{constructor(n=1,d=1,C=1,I=1){super(),this.type="PlaneGeometry",this.parameters={width:n,height:d,widthSegments:C,heightSegments:I};const f=n/2,y=d/2,B=Math.floor(C),_=Math.floor(I),Z=B+1,M=_+1,V=n/B,T=d/_,H=[],F=[],O=[],$=[];for(let U=0;U<M;U++){const ee=U*T-y;for(let Q=0;Q<Z;Q++){const ie=Q*V-f;F.push(ie,-ee,0),O.push(0,0,1),$.push(Q/B),$.push(1-U/_)}}for(let U=0;U<_;U++)for(let ee=0;ee<B;ee++){const Q=ee+Z*U,ie=ee+Z*(U+1),ne=ee+1+Z*(U+1),le=ee+1+Z*U;H.push(Q,ie,le),H.push(ie,ne,le)}this.setIndex(H),this.setAttribute("position",new Float32BufferAttribute(F,3)),this.setAttribute("normal",new Float32BufferAttribute(O,3)),this.setAttribute("uv",new Float32BufferAttribute($,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new PlaneGeometry(n.width,n.height,n.widthSegments,n.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(n=.5,d=1,C=32,I=1,f=0,y=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:n,outerRadius:d,thetaSegments:C,phiSegments:I,thetaStart:f,thetaLength:y},C=Math.max(3,C),I=Math.max(1,I);const B=[],_=[],Z=[],M=[];let V=n;const T=(d-n)/I,H=new Vector3,F=new Vector2;for(let O=0;O<=I;O++){for(let $=0;$<=C;$++){const U=f+$/C*y;H.x=V*Math.cos(U),H.y=V*Math.sin(U),_.push(H.x,H.y,H.z),Z.push(0,0,1),F.x=(H.x/d+1)/2,F.y=(H.y/d+1)/2,M.push(F.x,F.y)}V+=T}for(let O=0;O<I;O++){const $=O*(C+1);for(let U=0;U<C;U++){const ee=U+$,Q=ee,ie=ee+C+1,ne=ee+C+2,le=ee+1;B.push(Q,ie,le),B.push(ie,ne,le)}}this.setIndex(B),this.setAttribute("position",new Float32BufferAttribute(_,3)),this.setAttribute("normal",new Float32BufferAttribute(Z,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new RingGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(n=new Shape$2([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:n,curveSegments:d};const C=[],I=[],f=[],y=[];let B=0,_=0;if(Array.isArray(n)===!1)Z(n);else for(let M=0;M<n.length;M++)Z(n[M]),this.addGroup(B,_,M),B+=_,_=0;this.setIndex(C),this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2));function Z(M){const V=I.length/3,T=M.extractPoints(d);let H=T.shape;const F=T.holes;ShapeUtils.isClockWise(H)===!1&&(H=H.reverse());for(let $=0,U=F.length;$<U;$++){const ee=F[$];ShapeUtils.isClockWise(ee)===!0&&(F[$]=ee.reverse())}const O=ShapeUtils.triangulateShape(H,F);for(let $=0,U=F.length;$<U;$++){const ee=F[$];H=H.concat(ee)}for(let $=0,U=H.length;$<U;$++){const ee=H[$];I.push(ee.x,ee.y,0),f.push(0,0,1),y.push(ee.x,ee.y)}for(let $=0,U=O.length;$<U;$++){const ee=O[$],Q=ee[0]+V,ie=ee[1]+V,ne=ee[2]+V;C.push(Q,ie,ne),_+=3}}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON(),d=this.parameters.shapes;return toJSON(d,n)}static fromJSON(n,d){const C=[];for(let I=0,f=n.shapes.length;I<f;I++){const y=d[n.shapes[I]];C.push(y)}return new ShapeGeometry(C,n.curveSegments)}}function toJSON(u,n){if(n.shapes=[],Array.isArray(u))for(let d=0,C=u.length;d<C;d++){const I=u[d];n.shapes.push(I.uuid)}else n.shapes.push(u.uuid);return n}class SphereGeometry extends BufferGeometry{constructor(n=1,d=32,C=16,I=0,f=Math.PI*2,y=0,B=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:d,heightSegments:C,phiStart:I,phiLength:f,thetaStart:y,thetaLength:B},d=Math.max(3,Math.floor(d)),C=Math.max(2,Math.floor(C));const _=Math.min(y+B,Math.PI);let Z=0;const M=[],V=new Vector3,T=new Vector3,H=[],F=[],O=[],$=[];for(let U=0;U<=C;U++){const ee=[],Q=U/C;let ie=0;U===0&&y===0?ie=.5/d:U===C&&_===Math.PI&&(ie=-.5/d);for(let ne=0;ne<=d;ne++){const le=ne/d;V.x=-n*Math.cos(I+le*f)*Math.sin(y+Q*B),V.y=n*Math.cos(y+Q*B),V.z=n*Math.sin(I+le*f)*Math.sin(y+Q*B),F.push(V.x,V.y,V.z),T.copy(V).normalize(),O.push(T.x,T.y,T.z),$.push(le+ie,1-Q),ee.push(Z++)}M.push(ee)}for(let U=0;U<C;U++)for(let ee=0;ee<d;ee++){const Q=M[U][ee+1],ie=M[U][ee],ne=M[U+1][ee],le=M[U+1][ee+1];(U!==0||y>0)&&H.push(Q,ie,le),(U!==C-1||_<Math.PI)&&H.push(ie,ne,le)}this.setIndex(H),this.setAttribute("position",new Float32BufferAttribute(F,3)),this.setAttribute("normal",new Float32BufferAttribute(O,3)),this.setAttribute("uv",new Float32BufferAttribute($,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new SphereGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(n=1,d=0){const C=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],I=[2,1,0,0,3,2,1,3,0,2,3,1];super(C,I,n,d),this.type="TetrahedronGeometry",this.parameters={radius:n,detail:d}}static fromJSON(n){return new TetrahedronGeometry(n.radius,n.detail)}}class TorusGeometry extends BufferGeometry{constructor(n=1,d=.4,C=12,I=48,f=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:d,radialSegments:C,tubularSegments:I,arc:f},C=Math.floor(C),I=Math.floor(I);const y=[],B=[],_=[],Z=[],M=new Vector3,V=new Vector3,T=new Vector3;for(let H=0;H<=C;H++)for(let F=0;F<=I;F++){const O=F/I*f,$=H/C*Math.PI*2;V.x=(n+d*Math.cos($))*Math.cos(O),V.y=(n+d*Math.cos($))*Math.sin(O),V.z=d*Math.sin($),B.push(V.x,V.y,V.z),M.x=n*Math.cos(O),M.y=n*Math.sin(O),T.subVectors(V,M).normalize(),_.push(T.x,T.y,T.z),Z.push(F/I),Z.push(H/C)}for(let H=1;H<=C;H++)for(let F=1;F<=I;F++){const O=(I+1)*H+F-1,$=(I+1)*(H-1)+F-1,U=(I+1)*(H-1)+F,ee=(I+1)*H+F;y.push(O,$,ee),y.push($,U,ee)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(B,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(Z,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(n=1,d=.4,C=64,I=8,f=2,y=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:n,tube:d,tubularSegments:C,radialSegments:I,p:f,q:y},C=Math.floor(C),I=Math.floor(I);const B=[],_=[],Z=[],M=[],V=new Vector3,T=new Vector3,H=new Vector3,F=new Vector3,O=new Vector3,$=new Vector3,U=new Vector3;for(let Q=0;Q<=C;++Q){const ie=Q/C*f*Math.PI*2;ee(ie,f,y,n,H),ee(ie+.01,f,y,n,F),$.subVectors(F,H),U.addVectors(F,H),O.crossVectors($,U),U.crossVectors(O,$),O.normalize(),U.normalize();for(let ne=0;ne<=I;++ne){const le=ne/I*Math.PI*2,ae=-d*Math.cos(le),ce=d*Math.sin(le);V.x=H.x+(ae*U.x+ce*O.x),V.y=H.y+(ae*U.y+ce*O.y),V.z=H.z+(ae*U.z+ce*O.z),_.push(V.x,V.y,V.z),T.subVectors(V,H).normalize(),Z.push(T.x,T.y,T.z),M.push(Q/C),M.push(ne/I)}}for(let Q=1;Q<=C;Q++)for(let ie=1;ie<=I;ie++){const ne=(I+1)*(Q-1)+(ie-1),le=(I+1)*Q+(ie-1),ae=(I+1)*Q+ie,ce=(I+1)*(Q-1)+ie;B.push(ne,le,ce),B.push(le,ae,ce)}this.setIndex(B),this.setAttribute("position",new Float32BufferAttribute(_,3)),this.setAttribute("normal",new Float32BufferAttribute(Z,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2));function ee(Q,ie,ne,le,ae){const ce=Math.cos(Q),ge=Math.sin(Q),he=ne/ie*Q,Ie=Math.cos(he);ae.x=le*(2+Ie)*.5*ce,ae.y=le*(2+Ie)*ge*.5,ae.z=le*Math.sin(he)*.5}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new TorusKnotGeometry(n.radius,n.tube,n.tubularSegments,n.radialSegments,n.p,n.q)}}class TubeGeometry extends BufferGeometry{constructor(n=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),d=64,C=1,I=8,f=!1){super(),this.type="TubeGeometry",this.parameters={path:n,tubularSegments:d,radius:C,radialSegments:I,closed:f};const y=n.computeFrenetFrames(d,f);this.tangents=y.tangents,this.normals=y.normals,this.binormals=y.binormals;const B=new Vector3,_=new Vector3,Z=new Vector2;let M=new Vector3;const V=[],T=[],H=[],F=[];O(),this.setIndex(F),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(H,2));function O(){for(let Q=0;Q<d;Q++)$(Q);$(f===!1?d:0),ee(),U()}function $(Q){M=n.getPointAt(Q/d,M);const ie=y.normals[Q],ne=y.binormals[Q];for(let le=0;le<=I;le++){const ae=le/I*Math.PI*2,ce=Math.sin(ae),ge=-Math.cos(ae);_.x=ge*ie.x+ce*ne.x,_.y=ge*ie.y+ce*ne.y,_.z=ge*ie.z+ce*ne.z,_.normalize(),T.push(_.x,_.y,_.z),B.x=M.x+C*_.x,B.y=M.y+C*_.y,B.z=M.z+C*_.z,V.push(B.x,B.y,B.z)}}function U(){for(let Q=1;Q<=d;Q++)for(let ie=1;ie<=I;ie++){const ne=(I+1)*(Q-1)+(ie-1),le=(I+1)*Q+(ie-1),ae=(I+1)*Q+ie,ce=(I+1)*(Q-1)+ie;F.push(ne,le,ce),F.push(le,ae,ce)}}function ee(){for(let Q=0;Q<=d;Q++)for(let ie=0;ie<=I;ie++)Z.x=Q/d,Z.y=ie/I,H.push(Z.x,Z.y)}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON();return n.path=this.parameters.path.toJSON(),n}static fromJSON(n){return new TubeGeometry(new Curves[n.path.type]().fromJSON(n.path),n.tubularSegments,n.radius,n.radialSegments,n.closed)}}class WireframeGeometry extends BufferGeometry{constructor(n=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:n},n!==null){const d=[],C=new Set,I=new Vector3,f=new Vector3;if(n.index!==null){const y=n.attributes.position,B=n.index;let _=n.groups;_.length===0&&(_=[{start:0,count:B.count,materialIndex:0}]);for(let Z=0,M=_.length;Z<M;++Z){const V=_[Z],T=V.start,H=V.count;for(let F=T,O=T+H;F<O;F+=3)for(let $=0;$<3;$++){const U=B.getX(F+$),ee=B.getX(F+($+1)%3);I.fromBufferAttribute(y,U),f.fromBufferAttribute(y,ee),isUniqueEdge(I,f,C)===!0&&(d.push(I.x,I.y,I.z),d.push(f.x,f.y,f.z))}}}else{const y=n.attributes.position;for(let B=0,_=y.count/3;B<_;B++)for(let Z=0;Z<3;Z++){const M=3*B+Z,V=3*B+(Z+1)%3;I.fromBufferAttribute(y,M),f.fromBufferAttribute(y,V),isUniqueEdge(I,f,C)===!0&&(d.push(I.x,I.y,I.z),d.push(f.x,f.y,f.z))}}this.setAttribute("position",new Float32BufferAttribute(d,3))}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}}function isUniqueEdge(u,n,d){const C=`${u.x},${u.y},${u.z}-${n.x},${n.y},${n.z}`,I=`${n.x},${n.y},${n.z}-${u.x},${u.y},${u.z}`;return d.has(C)===!0||d.has(I)===!0?!1:(d.add(C),d.add(I),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(n){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.fog=n.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(n){super(n),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(n){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$1(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(d){this.ior=(1+.4*d)/(1-.4*d)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(n)}get anisotropy(){return this._anisotropy}set anisotropy(n){this._anisotropy>0!=n>0&&this.version++,this._anisotropy=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get dispersion(){return this._dispersion}set dispersion(n){this._dispersion>0!=n>0&&this.version++,this._dispersion=n}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=n.anisotropy,this.anisotropyRotation=n.anisotropyRotation,this.anisotropyMap=n.anisotropyMap,this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.dispersion=n.dispersion,this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(n){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class MeshToonMaterial extends Material{constructor(n){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}class MeshNormalMaterial extends Material{constructor(n){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.flatShading=n.flatShading,this}}class MeshLambertMaterial extends Material{constructor(n){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class MeshDepthMaterial extends Material{constructor(n){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(n)}copy(n){return super.copy(n),this.depthPacking=n.depthPacking,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(n){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(n)}copy(n){return super.copy(n),this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(n){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.flatShading=n.flatShading,this.fog=n.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(n){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}copy(n){return super.copy(n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this}}function convertArray(u,n,d){return!u||!d&&u.constructor===n?u:typeof n.BYTES_PER_ELEMENT=="number"?new n(u):Array.prototype.slice.call(u)}function isTypedArray(u){return ArrayBuffer.isView(u)&&!(u instanceof DataView)}function getKeyframeOrder(u){function n(I,f){return u[I]-u[f]}const d=u.length,C=new Array(d);for(let I=0;I!==d;++I)C[I]=I;return C.sort(n),C}function sortedArray(u,n,d){const C=u.length,I=new u.constructor(C);for(let f=0,y=0;y!==C;++f){const B=d[f]*n;for(let _=0;_!==n;++_)I[y++]=u[B+_]}return I}function flattenJSON(u,n,d,C){let I=1,f=u[0];for(;f!==void 0&&f[C]===void 0;)f=u[I++];if(f===void 0)return;let y=f[C];if(y!==void 0)if(Array.isArray(y))do y=f[C],y!==void 0&&(n.push(f.time),d.push(...y)),f=u[I++];while(f!==void 0);else if(y.toArray!==void 0)do y=f[C],y!==void 0&&(n.push(f.time),y.toArray(d,d.length)),f=u[I++];while(f!==void 0);else do y=f[C],y!==void 0&&(n.push(f.time),d.push(y)),f=u[I++];while(f!==void 0)}function subclip(u,n,d,C,I=30){const f=u.clone();f.name=n;const y=[];for(let _=0;_<f.tracks.length;++_){const Z=f.tracks[_],M=Z.getValueSize(),V=[],T=[];for(let H=0;H<Z.times.length;++H){const F=Z.times[H]*I;if(!(F<d||F>=C)){V.push(Z.times[H]);for(let O=0;O<M;++O)T.push(Z.values[H*M+O])}}V.length!==0&&(Z.times=convertArray(V,Z.times.constructor),Z.values=convertArray(T,Z.values.constructor),y.push(Z))}f.tracks=y;let B=1/0;for(let _=0;_<f.tracks.length;++_)B>f.tracks[_].times[0]&&(B=f.tracks[_].times[0]);for(let _=0;_<f.tracks.length;++_)f.tracks[_].shift(-1*B);return f.resetDuration(),f}function makeClipAdditive(u,n=0,d=u,C=30){C<=0&&(C=30);const I=d.tracks.length,f=n/C;for(let y=0;y<I;++y){const B=d.tracks[y],_=B.ValueTypeName;if(_==="bool"||_==="string")continue;const Z=u.tracks.find(function(U){return U.name===B.name&&U.ValueTypeName===_});if(Z===void 0)continue;let M=0;const V=B.getValueSize();B.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(M=V/3);let T=0;const H=Z.getValueSize();Z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(T=H/3);const F=B.times.length-1;let O;if(f<=B.times[0]){const U=M,ee=V-M;O=B.values.slice(U,ee)}else if(f>=B.times[F]){const U=F*V+M,ee=U+V-M;O=B.values.slice(U,ee)}else{const U=B.createInterpolant(),ee=M,Q=V-M;U.evaluate(f),O=U.resultBuffer.slice(ee,Q)}_==="quaternion"&&new Quaternion$2().fromArray(O).normalize().conjugate().toArray(O);const $=Z.times.length;for(let U=0;U<$;++U){const ee=U*H+T;if(_==="quaternion")Quaternion$2.multiplyQuaternionsFlat(Z.values,ee,O,0,Z.values,ee);else{const Q=H-T*2;for(let ie=0;ie<Q;++ie)Z.values[ee+ie]-=O[ie]}}}return u.blendMode=AdditiveAnimationBlendMode,u}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(n,d,C,I){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=I!==void 0?I:new d.constructor(C),this.sampleValues=d,this.valueSize=C,this.settings=null,this.DefaultSettings_={}}evaluate(n){const d=this.parameterPositions;let C=this._cachedIndex,I=d[C],f=d[C-1];e:{t:{let y;i:{n:if(!(n<I)){for(let B=C+2;;){if(I===void 0){if(n<f)break n;return C=d.length,this._cachedIndex=C,this.copySampleValue_(C-1)}if(C===B)break;if(f=I,I=d[++C],n<I)break t}y=d.length;break i}if(!(n>=f)){const B=d[1];n<B&&(C=2,f=B);for(let _=C-2;;){if(f===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(C===_)break;if(I=f,f=d[--C-1],n>=f)break t}y=C,C=0;break i}break e}for(;C<y;){const B=C+y>>>1;n<d[B]?y=B:C=B+1}if(I=d[C],f=d[C-1],f===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(I===void 0)return C=d.length,this._cachedIndex=C,this.copySampleValue_(C-1)}this._cachedIndex=C,this.intervalChanged_(C,f,I)}return this.interpolate_(C,f,n,I)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const d=this.resultBuffer,C=this.sampleValues,I=this.valueSize,f=n*I;for(let y=0;y!==I;++y)d[y]=C[f+y];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(n,d,C,I){super(n,d,C,I),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(n,d,C){const I=this.parameterPositions;let f=n-2,y=n+1,B=I[f],_=I[y];if(B===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:f=n,B=2*d-C;break;case WrapAroundEnding:f=I.length-2,B=d+I[f]-I[f+1];break;default:f=n,B=C}if(_===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:y=n,_=2*C-d;break;case WrapAroundEnding:y=1,_=C+I[1]-I[0];break;default:y=n-1,_=d}const Z=(C-d)*.5,M=this.valueSize;this._weightPrev=Z/(d-B),this._weightNext=Z/(_-C),this._offsetPrev=f*M,this._offsetNext=y*M}interpolate_(n,d,C,I){const f=this.resultBuffer,y=this.sampleValues,B=this.valueSize,_=n*B,Z=_-B,M=this._offsetPrev,V=this._offsetNext,T=this._weightPrev,H=this._weightNext,F=(C-d)/(I-d),O=F*F,$=O*F,U=-T*$+2*T*O-T*F,ee=(1+T)*$+(-1.5-2*T)*O+(-.5+T)*F+1,Q=(-1-H)*$+(1.5+H)*O+.5*F,ie=H*$-H*O;for(let ne=0;ne!==B;++ne)f[ne]=U*y[M+ne]+ee*y[Z+ne]+Q*y[_+ne]+ie*y[V+ne];return f}}class LinearInterpolant extends Interpolant{constructor(n,d,C,I){super(n,d,C,I)}interpolate_(n,d,C,I){const f=this.resultBuffer,y=this.sampleValues,B=this.valueSize,_=n*B,Z=_-B,M=(C-d)/(I-d),V=1-M;for(let T=0;T!==B;++T)f[T]=y[Z+T]*V+y[_+T]*M;return f}}class DiscreteInterpolant extends Interpolant{constructor(n,d,C,I){super(n,d,C,I)}interpolate_(n){return this.copySampleValue_(n-1)}}class KeyframeTrack{constructor(n,d,C,I){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(d===void 0||d.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=convertArray(d,this.TimeBufferType),this.values=convertArray(C,this.ValueBufferType),this.setInterpolation(I||this.DefaultInterpolation)}static toJSON(n){const d=n.constructor;let C;if(d.toJSON!==this.toJSON)C=d.toJSON(n);else{C={name:n.name,times:convertArray(n.times,Array),values:convertArray(n.values,Array)};const I=n.getInterpolation();I!==n.DefaultInterpolation&&(C.interpolation=I)}return C.type=n.ValueTypeName,C}InterpolantFactoryMethodDiscrete(n){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new LinearInterpolant(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new CubicInterpolant(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let d;switch(n){case InterpolateDiscrete:d=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:d=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:d=this.InterpolantFactoryMethodSmooth;break}if(d===void 0){const C="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(C);return console.warn("THREE.KeyframeTrack:",C),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const d=this.times;for(let C=0,I=d.length;C!==I;++C)d[C]+=n}return this}scale(n){if(n!==1){const d=this.times;for(let C=0,I=d.length;C!==I;++C)d[C]*=n}return this}trim(n,d){const C=this.times,I=C.length;let f=0,y=I-1;for(;f!==I&&C[f]<n;)++f;for(;y!==-1&&C[y]>d;)--y;if(++y,f!==0||y!==I){f>=y&&(y=Math.max(y,1),f=y-1);const B=this.getValueSize();this.times=C.slice(f,y),this.values=this.values.slice(f*B,y*B)}return this}validate(){let n=!0;const d=this.getValueSize();d-Math.floor(d)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const C=this.times,I=this.values,f=C.length;f===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let y=null;for(let B=0;B!==f;B++){const _=C[B];if(typeof _=="number"&&isNaN(_)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,B,_),n=!1;break}if(y!==null&&y>_){console.error("THREE.KeyframeTrack: Out of order keys.",this,B,_,y),n=!1;break}y=_}if(I!==void 0&&isTypedArray(I))for(let B=0,_=I.length;B!==_;++B){const Z=I[B];if(isNaN(Z)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,B,Z),n=!1;break}}return n}optimize(){const n=this.times.slice(),d=this.values.slice(),C=this.getValueSize(),I=this.getInterpolation()===InterpolateSmooth,f=n.length-1;let y=1;for(let B=1;B<f;++B){let _=!1;const Z=n[B],M=n[B+1];if(Z!==M&&(B!==1||Z!==n[0]))if(I)_=!0;else{const V=B*C,T=V-C,H=V+C;for(let F=0;F!==C;++F){const O=d[V+F];if(O!==d[T+F]||O!==d[H+F]){_=!0;break}}}if(_){if(B!==y){n[y]=n[B];const V=B*C,T=y*C;for(let H=0;H!==C;++H)d[T+H]=d[V+H]}++y}}if(f>0){n[y]=n[f];for(let B=f*C,_=y*C,Z=0;Z!==C;++Z)d[_+Z]=d[B+Z];++y}return y!==n.length?(this.times=n.slice(0,y),this.values=d.slice(0,y*C)):(this.times=n,this.values=d),this}clone(){const n=this.times.slice(),d=this.values.slice(),C=this.constructor,I=new C(this.name,n,d);return I.createInterpolant=this.createInterpolant,I}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(n,d,C){super(n,d,C)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(n,d,C,I){super(n,d,C,I)}interpolate_(n,d,C,I){const f=this.resultBuffer,y=this.sampleValues,B=this.valueSize,_=(C-d)/(I-d);let Z=n*B;for(let M=Z+B;Z!==M;Z+=4)Quaternion$2.slerpFlat(f,0,y,Z-B,y,Z,_);return f}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(n){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),n)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(n,d,C){super(n,d,C)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(n="",d=-1,C=[],I=NormalAnimationBlendMode){this.name=n,this.tracks=C,this.duration=d,this.blendMode=I,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(n){const d=[],C=n.tracks,I=1/(n.fps||1);for(let y=0,B=C.length;y!==B;++y)d.push(parseKeyframeTrack(C[y]).scale(I));const f=new this(n.name,n.duration,d,n.blendMode);return f.uuid=n.uuid,f}static toJSON(n){const d=[],C=n.tracks,I={name:n.name,duration:n.duration,tracks:d,uuid:n.uuid,blendMode:n.blendMode};for(let f=0,y=C.length;f!==y;++f)d.push(KeyframeTrack.toJSON(C[f]));return I}static CreateFromMorphTargetSequence(n,d,C,I){const f=d.length,y=[];for(let B=0;B<f;B++){let _=[],Z=[];_.push((B+f-1)%f,B,(B+1)%f),Z.push(0,1,0);const M=getKeyframeOrder(_);_=sortedArray(_,1,M),Z=sortedArray(Z,1,M),!I&&_[0]===0&&(_.push(f),Z.push(Z[0])),y.push(new NumberKeyframeTrack(".morphTargetInfluences["+d[B].name+"]",_,Z).scale(1/C))}return new this(n,-1,y)}static findByName(n,d){let C=n;if(!Array.isArray(n)){const I=n;C=I.geometry&&I.geometry.animations||I.animations}for(let I=0;I<C.length;I++)if(C[I].name===d)return C[I];return null}static CreateClipsFromMorphTargetSequences(n,d,C){const I={},f=/^([\w-]*?)([\d]+)$/;for(let B=0,_=n.length;B<_;B++){const Z=n[B],M=Z.name.match(f);if(M&&M.length>1){const V=M[1];let T=I[V];T||(I[V]=T=[]),T.push(Z)}}const y=[];for(const B in I)y.push(this.CreateFromMorphTargetSequence(B,I[B],d,C));return y}static parseAnimation(n,d){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const C=function(V,T,H,F,O){if(H.length!==0){const $=[],U=[];flattenJSON(H,$,U,F),$.length!==0&&O.push(new V(T,$,U))}},I=[],f=n.name||"default",y=n.fps||30,B=n.blendMode;let _=n.length||-1;const Z=n.hierarchy||[];for(let V=0;V<Z.length;V++){const T=Z[V].keys;if(!(!T||T.length===0))if(T[0].morphTargets){const H={};let F;for(F=0;F<T.length;F++)if(T[F].morphTargets)for(let O=0;O<T[F].morphTargets.length;O++)H[T[F].morphTargets[O]]=-1;for(const O in H){const $=[],U=[];for(let ee=0;ee!==T[F].morphTargets.length;++ee){const Q=T[F];$.push(Q.time),U.push(Q.morphTarget===O?1:0)}I.push(new NumberKeyframeTrack(".morphTargetInfluence["+O+"]",$,U))}_=H.length*y}else{const H=".bones["+d[V].name+"]";C(VectorKeyframeTrack,H+".position",T,"pos",I),C(QuaternionKeyframeTrack,H+".quaternion",T,"rot",I),C(VectorKeyframeTrack,H+".scale",T,"scl",I)}}return I.length===0?null:new this(f,_,I,B)}resetDuration(){const n=this.tracks;let d=0;for(let C=0,I=n.length;C!==I;++C){const f=this.tracks[C];d=Math.max(d,f.times[f.times.length-1])}return this.duration=d,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let d=0;d<this.tracks.length;d++)n=n&&this.tracks[d].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let d=0;d<this.tracks.length;d++)n.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(u){switch(u.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+u)}function parseKeyframeTrack(u){if(u.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=getTrackTypeForValueTypeName(u.type);if(u.times===void 0){const d=[],C=[];flattenJSON(u.keys,d,C,"value"),u.times=d,u.values=C}return n.parse!==void 0?n.parse(u):new n(u.name,u.times,u.values,u.interpolation)}const Cache={enabled:!1,files:{},add:function(u,n){this.enabled!==!1&&(this.files[u]=n)},get:function(u){if(this.enabled!==!1)return this.files[u]},remove:function(u){delete this.files[u]},clear:function(){this.files={}}};class LoadingManager{constructor(n,d,C){const I=this;let f=!1,y=0,B=0,_;const Z=[];this.onStart=void 0,this.onLoad=n,this.onProgress=d,this.onError=C,this.itemStart=function(M){B++,f===!1&&I.onStart!==void 0&&I.onStart(M,y,B),f=!0},this.itemEnd=function(M){y++,I.onProgress!==void 0&&I.onProgress(M,y,B),y===B&&(f=!1,I.onLoad!==void 0&&I.onLoad())},this.itemError=function(M){I.onError!==void 0&&I.onError(M)},this.resolveURL=function(M){return _?_(M):M},this.setURLModifier=function(M){return _=M,this},this.addHandler=function(M,V){return Z.push(M,V),this},this.removeHandler=function(M){const V=Z.indexOf(M);return V!==-1&&Z.splice(V,2),this},this.getHandler=function(M){for(let V=0,T=Z.length;V<T;V+=2){const H=Z[V],F=Z[V+1];if(H.global&&(H.lastIndex=0),H.test(M))return F}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(n){this.manager=n!==void 0?n:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,d){const C=this;return new Promise(function(I,f){C.load(n,I,d,f)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(n,d){super(n),this.response=d}}class FileLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const f=Cache.get(n);if(f!==void 0)return this.manager.itemStart(n),setTimeout(()=>{d&&d(f),this.manager.itemEnd(n)},0),f;if(loading[n]!==void 0){loading[n].push({onLoad:d,onProgress:C,onError:I});return}loading[n]=[],loading[n].push({onLoad:d,onProgress:C,onError:I});const y=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),B=this.mimeType,_=this.responseType;fetch(y).then(Z=>{if(Z.status===200||Z.status===0){if(Z.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||Z.body===void 0||Z.body.getReader===void 0)return Z;const M=loading[n],V=Z.body.getReader(),T=Z.headers.get("X-File-Size")||Z.headers.get("Content-Length"),H=T?parseInt(T):0,F=H!==0;let O=0;const $=new ReadableStream({start(U){ee();function ee(){V.read().then(({done:Q,value:ie})=>{if(Q)U.close();else{O+=ie.byteLength;const ne=new ProgressEvent("progress",{lengthComputable:F,loaded:O,total:H});for(let le=0,ae=M.length;le<ae;le++){const ce=M[le];ce.onProgress&&ce.onProgress(ne)}U.enqueue(ie),ee()}},Q=>{U.error(Q)})}}});return new Response($)}else throw new HttpError(`fetch for "${Z.url}" responded with ${Z.status}: ${Z.statusText}`,Z)}).then(Z=>{switch(_){case"arraybuffer":return Z.arrayBuffer();case"blob":return Z.blob();case"document":return Z.text().then(M=>new DOMParser().parseFromString(M,B));case"json":return Z.json();default:if(B===void 0)return Z.text();{const V=/charset="?([^;"\s]*)"?/i.exec(B),T=V&&V[1]?V[1].toLowerCase():void 0,H=new TextDecoder(T);return Z.arrayBuffer().then(F=>H.decode(F))}}}).then(Z=>{Cache.add(n,Z);const M=loading[n];delete loading[n];for(let V=0,T=M.length;V<T;V++){const H=M[V];H.onLoad&&H.onLoad(Z)}}).catch(Z=>{const M=loading[n];if(M===void 0)throw this.manager.itemError(n),Z;delete loading[n];for(let V=0,T=M.length;V<T;V++){const H=M[V];H.onError&&H.onError(Z)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}}class AnimationLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=new FileLoader(this.manager);y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials),y.load(n,function(B){try{d(f.parse(JSON.parse(B)))}catch(_){I?I(_):console.error(_),f.manager.itemError(n)}},C,I)}parse(n){const d=[];for(let C=0;C<n.length;C++){const I=AnimationClip.parse(n[C]);d.push(I)}return d}}class CompressedTextureLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=[],B=new CompressedTexture,_=new FileLoader(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(f.withCredentials);let Z=0;function M(V){_.load(n[V],function(T){const H=f.parse(T,!0);y[V]={width:H.width,height:H.height,format:H.format,mipmaps:H.mipmaps},Z+=1,Z===6&&(H.mipmapCount===1&&(B.minFilter=LinearFilter),B.image=y,B.format=H.format,B.needsUpdate=!0,d&&d(B))},C,I)}if(Array.isArray(n))for(let V=0,T=n.length;V<T;++V)M(V);else _.load(n,function(V){const T=f.parse(V,!0);if(T.isCubemap){const H=T.mipmaps.length/T.mipmapCount;for(let F=0;F<H;F++){y[F]={mipmaps:[]};for(let O=0;O<T.mipmapCount;O++)y[F].mipmaps.push(T.mipmaps[F*T.mipmapCount+O]),y[F].format=T.format,y[F].width=T.width,y[F].height=T.height}B.image=y}else B.image.width=T.width,B.image.height=T.height,B.mipmaps=T.mipmaps;T.mipmapCount===1&&(B.minFilter=LinearFilter),B.format=T.format,B.needsUpdate=!0,d&&d(B)},C,I);return B}}class ImageLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const f=this,y=Cache.get(n);if(y!==void 0)return f.manager.itemStart(n),setTimeout(function(){d&&d(y),f.manager.itemEnd(n)},0),y;const B=createElementNS("img");function _(){M(),Cache.add(n,this),d&&d(this),f.manager.itemEnd(n)}function Z(V){M(),I&&I(V),f.manager.itemError(n),f.manager.itemEnd(n)}function M(){B.removeEventListener("load",_,!1),B.removeEventListener("error",Z,!1)}return B.addEventListener("load",_,!1),B.addEventListener("error",Z,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(B.crossOrigin=this.crossOrigin),f.manager.itemStart(n),B.src=n,B}}class CubeTextureLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=new CubeTexture;f.colorSpace=SRGBColorSpace;const y=new ImageLoader(this.manager);y.setCrossOrigin(this.crossOrigin),y.setPath(this.path);let B=0;function _(Z){y.load(n[Z],function(M){f.images[Z]=M,B++,B===6&&(f.needsUpdate=!0,d&&d(f))},void 0,I)}for(let Z=0;Z<n.length;++Z)_(Z);return f}}class DataTextureLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=new DataTexture,B=new FileLoader(this.manager);return B.setResponseType("arraybuffer"),B.setRequestHeader(this.requestHeader),B.setPath(this.path),B.setWithCredentials(f.withCredentials),B.load(n,function(_){let Z;try{Z=f.parse(_)}catch(M){if(I!==void 0)I(M);else{console.error(M);return}}Z.image!==void 0?y.image=Z.image:Z.data!==void 0&&(y.image.width=Z.width,y.image.height=Z.height,y.image.data=Z.data),y.wrapS=Z.wrapS!==void 0?Z.wrapS:ClampToEdgeWrapping,y.wrapT=Z.wrapT!==void 0?Z.wrapT:ClampToEdgeWrapping,y.magFilter=Z.magFilter!==void 0?Z.magFilter:LinearFilter,y.minFilter=Z.minFilter!==void 0?Z.minFilter:LinearFilter,y.anisotropy=Z.anisotropy!==void 0?Z.anisotropy:1,Z.colorSpace!==void 0&&(y.colorSpace=Z.colorSpace),Z.flipY!==void 0&&(y.flipY=Z.flipY),Z.format!==void 0&&(y.format=Z.format),Z.type!==void 0&&(y.type=Z.type),Z.mipmaps!==void 0&&(y.mipmaps=Z.mipmaps,y.minFilter=LinearMipmapLinearFilter),Z.mipmapCount===1&&(y.minFilter=LinearFilter),Z.generateMipmaps!==void 0&&(y.generateMipmaps=Z.generateMipmaps),y.needsUpdate=!0,d&&d(y,Z)},C,I),y}}class TextureLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=new Texture,y=new ImageLoader(this.manager);return y.setCrossOrigin(this.crossOrigin),y.setPath(this.path),y.load(n,function(B){f.image=B,f.needsUpdate=!0,d!==void 0&&d(f)},C,I),f}}class Light extends Object3D{constructor(n,d=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(n),this.intensity=d}dispose(){}copy(n,d){return super.copy(n,d),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const d=super.toJSON(n);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,this.groundColor!==void 0&&(d.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(d.object.distance=this.distance),this.angle!==void 0&&(d.object.angle=this.angle),this.decay!==void 0&&(d.object.decay=this.decay),this.penumbra!==void 0&&(d.object.penumbra=this.penumbra),this.shadow!==void 0&&(d.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(d.object.target=this.target.uuid),d}}class HemisphereLight extends Light{constructor(n,d,C){super(n,C),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(d)}copy(n,d){return super.copy(n,d),this.groundColor.copy(n.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(n){this.camera=n,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const d=this.camera,C=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(n.matrixWorld),d.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(n.target.matrixWorld),d.lookAt(_lookTarget$1),d.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),C.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),C.multiply(_projScreenMatrix$1)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.intensity=n.intensity,this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.intensity!==1&&(n.intensity=this.intensity),this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const d=this.camera,C=RAD2DEG*2*n.angle*this.focus,I=this.mapSize.width/this.mapSize.height,f=n.distance||d.far;(C!==d.fov||I!==d.aspect||f!==d.far)&&(d.fov=C,d.aspect=I,d.far=f,d.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}}class SpotLight extends Light{constructor(n,d,C=0,I=Math.PI/3,f=0,y=2){super(n,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=C,this.angle=I,this.penumbra=f,this.decay=y,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,d){return super.copy(n,d),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(n,d=0){const C=this.camera,I=this.matrix,f=n.distance||C.far;f!==C.far&&(C.far=f,C.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(n.matrixWorld),C.position.copy(_lightPositionWorld),_lookTarget.copy(C.position),_lookTarget.add(this._cubeDirections[d]),C.up.copy(this._cubeUps[d]),C.lookAt(_lookTarget),C.updateMatrixWorld(),I.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(n,d,C=0,I=2){super(n,d),this.isPointLight=!0,this.type="PointLight",this.distance=C,this.decay=I,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,d){return super.copy(n,d),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(n=-1,d=1,C=1,I=-1,f=.1,y=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=d,this.top=C,this.bottom=I,this.near=f,this.far=y,this.updateProjectionMatrix()}copy(n,d){return super.copy(n,d),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,d,C,I,f,y){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=d,this.view.offsetX=C,this.view.offsetY=I,this.view.width=f,this.view.height=y,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),C=(this.right+this.left)/2,I=(this.top+this.bottom)/2;let f=C-n,y=C+n,B=I+d,_=I-d;if(this.view!==null&&this.view.enabled){const Z=(this.right-this.left)/this.view.fullWidth/this.zoom,M=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f+=Z*this.view.offsetX,y=f+Z*this.view.width,B-=M*this.view.offsetY,_=B-M*this.view.height}this.projectionMatrix.makeOrthographic(f,y,B,_,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const d=super.toJSON(n);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,this.view!==null&&(d.object.view=Object.assign({},this.view)),d}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(n,d){super(n,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}class AmbientLight extends Light{constructor(n,d){super(n,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(n,d,C=10,I=10){super(n,d),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=C,this.height=I}get power(){return this.intensity*this.width*this.height*Math.PI}set power(n){this.intensity=n/(this.width*this.height*Math.PI)}copy(n){return super.copy(n),this.width=n.width,this.height=n.height,this}toJSON(n){const d=super.toJSON(n);return d.object.width=this.width,d.object.height=this.height,d}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let n=0;n<9;n++)this.coefficients.push(new Vector3)}set(n){for(let d=0;d<9;d++)this.coefficients[d].copy(n[d]);return this}zero(){for(let n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this}getAt(n,d){const C=n.x,I=n.y,f=n.z,y=this.coefficients;return d.copy(y[0]).multiplyScalar(.282095),d.addScaledVector(y[1],.488603*I),d.addScaledVector(y[2],.488603*f),d.addScaledVector(y[3],.488603*C),d.addScaledVector(y[4],1.092548*(C*I)),d.addScaledVector(y[5],1.092548*(I*f)),d.addScaledVector(y[6],.315392*(3*f*f-1)),d.addScaledVector(y[7],1.092548*(C*f)),d.addScaledVector(y[8],.546274*(C*C-I*I)),d}getIrradianceAt(n,d){const C=n.x,I=n.y,f=n.z,y=this.coefficients;return d.copy(y[0]).multiplyScalar(.886227),d.addScaledVector(y[1],2*.511664*I),d.addScaledVector(y[2],2*.511664*f),d.addScaledVector(y[3],2*.511664*C),d.addScaledVector(y[4],2*.429043*C*I),d.addScaledVector(y[5],2*.429043*I*f),d.addScaledVector(y[6],.743125*f*f-.247708),d.addScaledVector(y[7],2*.429043*C*f),d.addScaledVector(y[8],.429043*(C*C-I*I)),d}add(n){for(let d=0;d<9;d++)this.coefficients[d].add(n.coefficients[d]);return this}addScaledSH(n,d){for(let C=0;C<9;C++)this.coefficients[C].addScaledVector(n.coefficients[C],d);return this}scale(n){for(let d=0;d<9;d++)this.coefficients[d].multiplyScalar(n);return this}lerp(n,d){for(let C=0;C<9;C++)this.coefficients[C].lerp(n.coefficients[C],d);return this}equals(n){for(let d=0;d<9;d++)if(!this.coefficients[d].equals(n.coefficients[d]))return!1;return!0}copy(n){return this.set(n.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(n,d=0){const C=this.coefficients;for(let I=0;I<9;I++)C[I].fromArray(n,d+I*3);return this}toArray(n=[],d=0){const C=this.coefficients;for(let I=0;I<9;I++)C[I].toArray(n,d+I*3);return n}static getBasisAt(n,d){const C=n.x,I=n.y,f=n.z;d[0]=.282095,d[1]=.488603*I,d[2]=.488603*f,d[3]=.488603*C,d[4]=1.092548*C*I,d[5]=1.092548*I*f,d[6]=.315392*(3*f*f-1),d[7]=1.092548*C*f,d[8]=.546274*(C*C-I*I)}}class LightProbe extends Light{constructor(n=new SphericalHarmonics3,d=1){super(void 0,d),this.isLightProbe=!0,this.sh=n}copy(n){return super.copy(n),this.sh.copy(n.sh),this}fromJSON(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this}toJSON(n){const d=super.toJSON(n);return d.object.sh=this.sh.toArray(),d}}class MaterialLoader extends Loader{constructor(n){super(n),this.textures={}}load(n,d,C,I){const f=this,y=new FileLoader(f.manager);y.setPath(f.path),y.setRequestHeader(f.requestHeader),y.setWithCredentials(f.withCredentials),y.load(n,function(B){try{d(f.parse(JSON.parse(B)))}catch(_){I?I(_):console.error(_),f.manager.itemError(n)}},C,I)}parse(n){const d=this.textures;function C(f){return d[f]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",f),d[f]}const I=this.createMaterialFromType(n.type);if(n.uuid!==void 0&&(I.uuid=n.uuid),n.name!==void 0&&(I.name=n.name),n.color!==void 0&&I.color!==void 0&&I.color.setHex(n.color),n.roughness!==void 0&&(I.roughness=n.roughness),n.metalness!==void 0&&(I.metalness=n.metalness),n.sheen!==void 0&&(I.sheen=n.sheen),n.sheenColor!==void 0&&(I.sheenColor=new Color().setHex(n.sheenColor)),n.sheenRoughness!==void 0&&(I.sheenRoughness=n.sheenRoughness),n.emissive!==void 0&&I.emissive!==void 0&&I.emissive.setHex(n.emissive),n.specular!==void 0&&I.specular!==void 0&&I.specular.setHex(n.specular),n.specularIntensity!==void 0&&(I.specularIntensity=n.specularIntensity),n.specularColor!==void 0&&I.specularColor!==void 0&&I.specularColor.setHex(n.specularColor),n.shininess!==void 0&&(I.shininess=n.shininess),n.clearcoat!==void 0&&(I.clearcoat=n.clearcoat),n.clearcoatRoughness!==void 0&&(I.clearcoatRoughness=n.clearcoatRoughness),n.dispersion!==void 0&&(I.dispersion=n.dispersion),n.iridescence!==void 0&&(I.iridescence=n.iridescence),n.iridescenceIOR!==void 0&&(I.iridescenceIOR=n.iridescenceIOR),n.iridescenceThicknessRange!==void 0&&(I.iridescenceThicknessRange=n.iridescenceThicknessRange),n.transmission!==void 0&&(I.transmission=n.transmission),n.thickness!==void 0&&(I.thickness=n.thickness),n.attenuationDistance!==void 0&&(I.attenuationDistance=n.attenuationDistance),n.attenuationColor!==void 0&&I.attenuationColor!==void 0&&I.attenuationColor.setHex(n.attenuationColor),n.anisotropy!==void 0&&(I.anisotropy=n.anisotropy),n.anisotropyRotation!==void 0&&(I.anisotropyRotation=n.anisotropyRotation),n.fog!==void 0&&(I.fog=n.fog),n.flatShading!==void 0&&(I.flatShading=n.flatShading),n.blending!==void 0&&(I.blending=n.blending),n.combine!==void 0&&(I.combine=n.combine),n.side!==void 0&&(I.side=n.side),n.shadowSide!==void 0&&(I.shadowSide=n.shadowSide),n.opacity!==void 0&&(I.opacity=n.opacity),n.transparent!==void 0&&(I.transparent=n.transparent),n.alphaTest!==void 0&&(I.alphaTest=n.alphaTest),n.alphaHash!==void 0&&(I.alphaHash=n.alphaHash),n.depthFunc!==void 0&&(I.depthFunc=n.depthFunc),n.depthTest!==void 0&&(I.depthTest=n.depthTest),n.depthWrite!==void 0&&(I.depthWrite=n.depthWrite),n.colorWrite!==void 0&&(I.colorWrite=n.colorWrite),n.blendSrc!==void 0&&(I.blendSrc=n.blendSrc),n.blendDst!==void 0&&(I.blendDst=n.blendDst),n.blendEquation!==void 0&&(I.blendEquation=n.blendEquation),n.blendSrcAlpha!==void 0&&(I.blendSrcAlpha=n.blendSrcAlpha),n.blendDstAlpha!==void 0&&(I.blendDstAlpha=n.blendDstAlpha),n.blendEquationAlpha!==void 0&&(I.blendEquationAlpha=n.blendEquationAlpha),n.blendColor!==void 0&&I.blendColor!==void 0&&I.blendColor.setHex(n.blendColor),n.blendAlpha!==void 0&&(I.blendAlpha=n.blendAlpha),n.stencilWriteMask!==void 0&&(I.stencilWriteMask=n.stencilWriteMask),n.stencilFunc!==void 0&&(I.stencilFunc=n.stencilFunc),n.stencilRef!==void 0&&(I.stencilRef=n.stencilRef),n.stencilFuncMask!==void 0&&(I.stencilFuncMask=n.stencilFuncMask),n.stencilFail!==void 0&&(I.stencilFail=n.stencilFail),n.stencilZFail!==void 0&&(I.stencilZFail=n.stencilZFail),n.stencilZPass!==void 0&&(I.stencilZPass=n.stencilZPass),n.stencilWrite!==void 0&&(I.stencilWrite=n.stencilWrite),n.wireframe!==void 0&&(I.wireframe=n.wireframe),n.wireframeLinewidth!==void 0&&(I.wireframeLinewidth=n.wireframeLinewidth),n.wireframeLinecap!==void 0&&(I.wireframeLinecap=n.wireframeLinecap),n.wireframeLinejoin!==void 0&&(I.wireframeLinejoin=n.wireframeLinejoin),n.rotation!==void 0&&(I.rotation=n.rotation),n.linewidth!==void 0&&(I.linewidth=n.linewidth),n.dashSize!==void 0&&(I.dashSize=n.dashSize),n.gapSize!==void 0&&(I.gapSize=n.gapSize),n.scale!==void 0&&(I.scale=n.scale),n.polygonOffset!==void 0&&(I.polygonOffset=n.polygonOffset),n.polygonOffsetFactor!==void 0&&(I.polygonOffsetFactor=n.polygonOffsetFactor),n.polygonOffsetUnits!==void 0&&(I.polygonOffsetUnits=n.polygonOffsetUnits),n.dithering!==void 0&&(I.dithering=n.dithering),n.alphaToCoverage!==void 0&&(I.alphaToCoverage=n.alphaToCoverage),n.premultipliedAlpha!==void 0&&(I.premultipliedAlpha=n.premultipliedAlpha),n.forceSinglePass!==void 0&&(I.forceSinglePass=n.forceSinglePass),n.visible!==void 0&&(I.visible=n.visible),n.toneMapped!==void 0&&(I.toneMapped=n.toneMapped),n.userData!==void 0&&(I.userData=n.userData),n.vertexColors!==void 0&&(typeof n.vertexColors=="number"?I.vertexColors=n.vertexColors>0:I.vertexColors=n.vertexColors),n.uniforms!==void 0)for(const f in n.uniforms){const y=n.uniforms[f];switch(I.uniforms[f]={},y.type){case"t":I.uniforms[f].value=C(y.value);break;case"c":I.uniforms[f].value=new Color().setHex(y.value);break;case"v2":I.uniforms[f].value=new Vector2().fromArray(y.value);break;case"v3":I.uniforms[f].value=new Vector3().fromArray(y.value);break;case"v4":I.uniforms[f].value=new Vector4().fromArray(y.value);break;case"m3":I.uniforms[f].value=new Matrix3().fromArray(y.value);break;case"m4":I.uniforms[f].value=new Matrix4().fromArray(y.value);break;default:I.uniforms[f].value=y.value}}if(n.defines!==void 0&&(I.defines=n.defines),n.vertexShader!==void 0&&(I.vertexShader=n.vertexShader),n.fragmentShader!==void 0&&(I.fragmentShader=n.fragmentShader),n.glslVersion!==void 0&&(I.glslVersion=n.glslVersion),n.extensions!==void 0)for(const f in n.extensions)I.extensions[f]=n.extensions[f];if(n.lights!==void 0&&(I.lights=n.lights),n.clipping!==void 0&&(I.clipping=n.clipping),n.size!==void 0&&(I.size=n.size),n.sizeAttenuation!==void 0&&(I.sizeAttenuation=n.sizeAttenuation),n.map!==void 0&&(I.map=C(n.map)),n.matcap!==void 0&&(I.matcap=C(n.matcap)),n.alphaMap!==void 0&&(I.alphaMap=C(n.alphaMap)),n.bumpMap!==void 0&&(I.bumpMap=C(n.bumpMap)),n.bumpScale!==void 0&&(I.bumpScale=n.bumpScale),n.normalMap!==void 0&&(I.normalMap=C(n.normalMap)),n.normalMapType!==void 0&&(I.normalMapType=n.normalMapType),n.normalScale!==void 0){let f=n.normalScale;Array.isArray(f)===!1&&(f=[f,f]),I.normalScale=new Vector2().fromArray(f)}return n.displacementMap!==void 0&&(I.displacementMap=C(n.displacementMap)),n.displacementScale!==void 0&&(I.displacementScale=n.displacementScale),n.displacementBias!==void 0&&(I.displacementBias=n.displacementBias),n.roughnessMap!==void 0&&(I.roughnessMap=C(n.roughnessMap)),n.metalnessMap!==void 0&&(I.metalnessMap=C(n.metalnessMap)),n.emissiveMap!==void 0&&(I.emissiveMap=C(n.emissiveMap)),n.emissiveIntensity!==void 0&&(I.emissiveIntensity=n.emissiveIntensity),n.specularMap!==void 0&&(I.specularMap=C(n.specularMap)),n.specularIntensityMap!==void 0&&(I.specularIntensityMap=C(n.specularIntensityMap)),n.specularColorMap!==void 0&&(I.specularColorMap=C(n.specularColorMap)),n.envMap!==void 0&&(I.envMap=C(n.envMap)),n.envMapRotation!==void 0&&I.envMapRotation.fromArray(n.envMapRotation),n.envMapIntensity!==void 0&&(I.envMapIntensity=n.envMapIntensity),n.reflectivity!==void 0&&(I.reflectivity=n.reflectivity),n.refractionRatio!==void 0&&(I.refractionRatio=n.refractionRatio),n.lightMap!==void 0&&(I.lightMap=C(n.lightMap)),n.lightMapIntensity!==void 0&&(I.lightMapIntensity=n.lightMapIntensity),n.aoMap!==void 0&&(I.aoMap=C(n.aoMap)),n.aoMapIntensity!==void 0&&(I.aoMapIntensity=n.aoMapIntensity),n.gradientMap!==void 0&&(I.gradientMap=C(n.gradientMap)),n.clearcoatMap!==void 0&&(I.clearcoatMap=C(n.clearcoatMap)),n.clearcoatRoughnessMap!==void 0&&(I.clearcoatRoughnessMap=C(n.clearcoatRoughnessMap)),n.clearcoatNormalMap!==void 0&&(I.clearcoatNormalMap=C(n.clearcoatNormalMap)),n.clearcoatNormalScale!==void 0&&(I.clearcoatNormalScale=new Vector2().fromArray(n.clearcoatNormalScale)),n.iridescenceMap!==void 0&&(I.iridescenceMap=C(n.iridescenceMap)),n.iridescenceThicknessMap!==void 0&&(I.iridescenceThicknessMap=C(n.iridescenceThicknessMap)),n.transmissionMap!==void 0&&(I.transmissionMap=C(n.transmissionMap)),n.thicknessMap!==void 0&&(I.thicknessMap=C(n.thicknessMap)),n.anisotropyMap!==void 0&&(I.anisotropyMap=C(n.anisotropyMap)),n.sheenColorMap!==void 0&&(I.sheenColorMap=C(n.sheenColorMap)),n.sheenRoughnessMap!==void 0&&(I.sheenRoughnessMap=C(n.sheenRoughnessMap)),I}setTextures(n){return this.textures=n,this}createMaterialFromType(n){return MaterialLoader.createMaterialFromType(n)}static createMaterialFromType(n){const d={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new d[n]}}class LoaderUtils{static decodeText(n){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(n);let d="";for(let C=0,I=n.length;C<I;C++)d+=String.fromCharCode(n[C]);try{return decodeURIComponent(escape(d))}catch{return d}}static extractUrlBase(n){const d=n.lastIndexOf("/");return d===-1?"./":n.slice(0,d+1)}static resolveURL(n,d){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(d)&&/^\//.test(n)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:d+n)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(n){return super.copy(n),this.instanceCount=n.instanceCount,this}toJSON(){const n=super.toJSON();return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}}class BufferGeometryLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=new FileLoader(f.manager);y.setPath(f.path),y.setRequestHeader(f.requestHeader),y.setWithCredentials(f.withCredentials),y.load(n,function(B){try{d(f.parse(JSON.parse(B)))}catch(_){I?I(_):console.error(_),f.manager.itemError(n)}},C,I)}parse(n){const d={},C={};function I(H,F){if(d[F]!==void 0)return d[F];const $=H.interleavedBuffers[F],U=f(H,$.buffer),ee=getTypedArray($.type,U),Q=new InterleavedBuffer(ee,$.stride);return Q.uuid=$.uuid,d[F]=Q,Q}function f(H,F){if(C[F]!==void 0)return C[F];const $=H.arrayBuffers[F],U=new Uint32Array($).buffer;return C[F]=U,U}const y=n.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,B=n.data.index;if(B!==void 0){const H=getTypedArray(B.type,B.array);y.setIndex(new BufferAttribute(H,1))}const _=n.data.attributes;for(const H in _){const F=_[H];let O;if(F.isInterleavedBufferAttribute){const $=I(n.data,F.data);O=new InterleavedBufferAttribute($,F.itemSize,F.offset,F.normalized)}else{const $=getTypedArray(F.type,F.array),U=F.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;O=new U($,F.itemSize,F.normalized)}F.name!==void 0&&(O.name=F.name),F.usage!==void 0&&O.setUsage(F.usage),y.setAttribute(H,O)}const Z=n.data.morphAttributes;if(Z)for(const H in Z){const F=Z[H],O=[];for(let $=0,U=F.length;$<U;$++){const ee=F[$];let Q;if(ee.isInterleavedBufferAttribute){const ie=I(n.data,ee.data);Q=new InterleavedBufferAttribute(ie,ee.itemSize,ee.offset,ee.normalized)}else{const ie=getTypedArray(ee.type,ee.array);Q=new BufferAttribute(ie,ee.itemSize,ee.normalized)}ee.name!==void 0&&(Q.name=ee.name),O.push(Q)}y.morphAttributes[H]=O}n.data.morphTargetsRelative&&(y.morphTargetsRelative=!0);const V=n.data.groups||n.data.drawcalls||n.data.offsets;if(V!==void 0)for(let H=0,F=V.length;H!==F;++H){const O=V[H];y.addGroup(O.start,O.count,O.materialIndex)}const T=n.data.boundingSphere;if(T!==void 0){const H=new Vector3;T.center!==void 0&&H.fromArray(T.center),y.boundingSphere=new Sphere$1(H,T.radius)}return n.name&&(y.name=n.name),n.userData&&(y.userData=n.userData),y}}class ObjectLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=this.path===""?LoaderUtils.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||y;const B=new FileLoader(this.manager);B.setPath(this.path),B.setRequestHeader(this.requestHeader),B.setWithCredentials(this.withCredentials),B.load(n,function(_){let Z=null;try{Z=JSON.parse(_)}catch(V){I!==void 0&&I(V),console.error("THREE:ObjectLoader: Can't parse "+n+".",V.message);return}const M=Z.metadata;if(M===void 0||M.type===void 0||M.type.toLowerCase()==="geometry"){I!==void 0&&I(new Error("THREE.ObjectLoader: Can't load "+n)),console.error("THREE.ObjectLoader: Can't load "+n);return}f.parse(Z,d)},C,I)}async loadAsync(n,d){const C=this,I=this.path===""?LoaderUtils.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||I;const f=new FileLoader(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials);const y=await f.loadAsync(n,d),B=JSON.parse(y),_=B.metadata;if(_===void 0||_.type===void 0||_.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+n);return await C.parseAsync(B)}parse(n,d){const C=this.parseAnimations(n.animations),I=this.parseShapes(n.shapes),f=this.parseGeometries(n.geometries,I),y=this.parseImages(n.images,function(){d!==void 0&&d(Z)}),B=this.parseTextures(n.textures,y),_=this.parseMaterials(n.materials,B),Z=this.parseObject(n.object,f,_,B,C),M=this.parseSkeletons(n.skeletons,Z);if(this.bindSkeletons(Z,M),this.bindLightTargets(Z),d!==void 0){let V=!1;for(const T in y)if(y[T].data instanceof HTMLImageElement){V=!0;break}V===!1&&d(Z)}return Z}async parseAsync(n){const d=this.parseAnimations(n.animations),C=this.parseShapes(n.shapes),I=this.parseGeometries(n.geometries,C),f=await this.parseImagesAsync(n.images),y=this.parseTextures(n.textures,f),B=this.parseMaterials(n.materials,y),_=this.parseObject(n.object,I,B,y,d),Z=this.parseSkeletons(n.skeletons,_);return this.bindSkeletons(_,Z),this.bindLightTargets(_),_}parseShapes(n){const d={};if(n!==void 0)for(let C=0,I=n.length;C<I;C++){const f=new Shape$2().fromJSON(n[C]);d[f.uuid]=f}return d}parseSkeletons(n,d){const C={},I={};if(d.traverse(function(f){f.isBone&&(I[f.uuid]=f)}),n!==void 0)for(let f=0,y=n.length;f<y;f++){const B=new Skeleton().fromJSON(n[f],I);C[B.uuid]=B}return C}parseGeometries(n,d){const C={};if(n!==void 0){const I=new BufferGeometryLoader;for(let f=0,y=n.length;f<y;f++){let B;const _=n[f];switch(_.type){case"BufferGeometry":case"InstancedBufferGeometry":B=I.parse(_);break;default:_.type in Geometries?B=Geometries[_.type].fromJSON(_,d):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${_.type}"`)}B.uuid=_.uuid,_.name!==void 0&&(B.name=_.name),_.userData!==void 0&&(B.userData=_.userData),C[_.uuid]=B}}return C}parseMaterials(n,d){const C={},I={};if(n!==void 0){const f=new MaterialLoader;f.setTextures(d);for(let y=0,B=n.length;y<B;y++){const _=n[y];C[_.uuid]===void 0&&(C[_.uuid]=f.parse(_)),I[_.uuid]=C[_.uuid]}}return I}parseAnimations(n){const d={};if(n!==void 0)for(let C=0;C<n.length;C++){const I=n[C],f=AnimationClip.parse(I);d[f.uuid]=f}return d}parseImages(n,d){const C=this,I={};let f;function y(_){return C.manager.itemStart(_),f.load(_,function(){C.manager.itemEnd(_)},void 0,function(){C.manager.itemError(_),C.manager.itemEnd(_)})}function B(_){if(typeof _=="string"){const Z=_,M=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Z)?Z:C.resourcePath+Z;return y(M)}else return _.data?{data:getTypedArray(_.type,_.data),width:_.width,height:_.height}:null}if(n!==void 0&&n.length>0){const _=new LoadingManager(d);f=new ImageLoader(_),f.setCrossOrigin(this.crossOrigin);for(let Z=0,M=n.length;Z<M;Z++){const V=n[Z],T=V.url;if(Array.isArray(T)){const H=[];for(let F=0,O=T.length;F<O;F++){const $=T[F],U=B($);U!==null&&(U instanceof HTMLImageElement?H.push(U):H.push(new DataTexture(U.data,U.width,U.height)))}I[V.uuid]=new Source(H)}else{const H=B(V.url);I[V.uuid]=new Source(H)}}}return I}async parseImagesAsync(n){const d=this,C={};let I;async function f(y){if(typeof y=="string"){const B=y,_=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(B)?B:d.resourcePath+B;return await I.loadAsync(_)}else return y.data?{data:getTypedArray(y.type,y.data),width:y.width,height:y.height}:null}if(n!==void 0&&n.length>0){I=new ImageLoader(this.manager),I.setCrossOrigin(this.crossOrigin);for(let y=0,B=n.length;y<B;y++){const _=n[y],Z=_.url;if(Array.isArray(Z)){const M=[];for(let V=0,T=Z.length;V<T;V++){const H=Z[V],F=await f(H);F!==null&&(F instanceof HTMLImageElement?M.push(F):M.push(new DataTexture(F.data,F.width,F.height)))}C[_.uuid]=new Source(M)}else{const M=await f(_.url);C[_.uuid]=new Source(M)}}}return C}parseTextures(n,d){function C(f,y){return typeof f=="number"?f:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",f),y[f])}const I={};if(n!==void 0)for(let f=0,y=n.length;f<y;f++){const B=n[f];B.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',B.uuid),d[B.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",B.image);const _=d[B.image],Z=_.data;let M;Array.isArray(Z)?(M=new CubeTexture,Z.length===6&&(M.needsUpdate=!0)):(Z&&Z.data?M=new DataTexture:M=new Texture,Z&&(M.needsUpdate=!0)),M.source=_,M.uuid=B.uuid,B.name!==void 0&&(M.name=B.name),B.mapping!==void 0&&(M.mapping=C(B.mapping,TEXTURE_MAPPING)),B.channel!==void 0&&(M.channel=B.channel),B.offset!==void 0&&M.offset.fromArray(B.offset),B.repeat!==void 0&&M.repeat.fromArray(B.repeat),B.center!==void 0&&M.center.fromArray(B.center),B.rotation!==void 0&&(M.rotation=B.rotation),B.wrap!==void 0&&(M.wrapS=C(B.wrap[0],TEXTURE_WRAPPING),M.wrapT=C(B.wrap[1],TEXTURE_WRAPPING)),B.format!==void 0&&(M.format=B.format),B.internalFormat!==void 0&&(M.internalFormat=B.internalFormat),B.type!==void 0&&(M.type=B.type),B.colorSpace!==void 0&&(M.colorSpace=B.colorSpace),B.minFilter!==void 0&&(M.minFilter=C(B.minFilter,TEXTURE_FILTER)),B.magFilter!==void 0&&(M.magFilter=C(B.magFilter,TEXTURE_FILTER)),B.anisotropy!==void 0&&(M.anisotropy=B.anisotropy),B.flipY!==void 0&&(M.flipY=B.flipY),B.generateMipmaps!==void 0&&(M.generateMipmaps=B.generateMipmaps),B.premultiplyAlpha!==void 0&&(M.premultiplyAlpha=B.premultiplyAlpha),B.unpackAlignment!==void 0&&(M.unpackAlignment=B.unpackAlignment),B.compareFunction!==void 0&&(M.compareFunction=B.compareFunction),B.userData!==void 0&&(M.userData=B.userData),I[B.uuid]=M}return I}parseObject(n,d,C,I,f){let y;function B(T){return d[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",T),d[T]}function _(T){if(T!==void 0){if(Array.isArray(T)){const H=[];for(let F=0,O=T.length;F<O;F++){const $=T[F];C[$]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",$),H.push(C[$])}return H}return C[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",T),C[T]}}function Z(T){return I[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",T),I[T]}let M,V;switch(n.type){case"Scene":y=new Scene,n.background!==void 0&&(Number.isInteger(n.background)?y.background=new Color(n.background):y.background=Z(n.background)),n.environment!==void 0&&(y.environment=Z(n.environment)),n.fog!==void 0&&(n.fog.type==="Fog"?y.fog=new Fog(n.fog.color,n.fog.near,n.fog.far):n.fog.type==="FogExp2"&&(y.fog=new FogExp2(n.fog.color,n.fog.density)),n.fog.name!==""&&(y.fog.name=n.fog.name)),n.backgroundBlurriness!==void 0&&(y.backgroundBlurriness=n.backgroundBlurriness),n.backgroundIntensity!==void 0&&(y.backgroundIntensity=n.backgroundIntensity),n.backgroundRotation!==void 0&&y.backgroundRotation.fromArray(n.backgroundRotation),n.environmentIntensity!==void 0&&(y.environmentIntensity=n.environmentIntensity),n.environmentRotation!==void 0&&y.environmentRotation.fromArray(n.environmentRotation);break;case"PerspectiveCamera":y=new PerspectiveCamera(n.fov,n.aspect,n.near,n.far),n.focus!==void 0&&(y.focus=n.focus),n.zoom!==void 0&&(y.zoom=n.zoom),n.filmGauge!==void 0&&(y.filmGauge=n.filmGauge),n.filmOffset!==void 0&&(y.filmOffset=n.filmOffset),n.view!==void 0&&(y.view=Object.assign({},n.view));break;case"OrthographicCamera":y=new OrthographicCamera(n.left,n.right,n.top,n.bottom,n.near,n.far),n.zoom!==void 0&&(y.zoom=n.zoom),n.view!==void 0&&(y.view=Object.assign({},n.view));break;case"AmbientLight":y=new AmbientLight(n.color,n.intensity);break;case"DirectionalLight":y=new DirectionalLight(n.color,n.intensity),y.target=n.target||"";break;case"PointLight":y=new PointLight(n.color,n.intensity,n.distance,n.decay);break;case"RectAreaLight":y=new RectAreaLight(n.color,n.intensity,n.width,n.height);break;case"SpotLight":y=new SpotLight(n.color,n.intensity,n.distance,n.angle,n.penumbra,n.decay),y.target=n.target||"";break;case"HemisphereLight":y=new HemisphereLight(n.color,n.groundColor,n.intensity);break;case"LightProbe":y=new LightProbe().fromJSON(n);break;case"SkinnedMesh":M=B(n.geometry),V=_(n.material),y=new SkinnedMesh(M,V),n.bindMode!==void 0&&(y.bindMode=n.bindMode),n.bindMatrix!==void 0&&y.bindMatrix.fromArray(n.bindMatrix),n.skeleton!==void 0&&(y.skeleton=n.skeleton);break;case"Mesh":M=B(n.geometry),V=_(n.material),y=new Mesh(M,V);break;case"InstancedMesh":M=B(n.geometry),V=_(n.material);const T=n.count,H=n.instanceMatrix,F=n.instanceColor;y=new InstancedMesh(M,V,T),y.instanceMatrix=new InstancedBufferAttribute(new Float32Array(H.array),16),F!==void 0&&(y.instanceColor=new InstancedBufferAttribute(new Float32Array(F.array),F.itemSize));break;case"BatchedMesh":M=B(n.geometry),V=_(n.material),y=new BatchedMesh(n.maxInstanceCount,n.maxVertexCount,n.maxIndexCount,V),y.geometry=M,y.perObjectFrustumCulled=n.perObjectFrustumCulled,y.sortObjects=n.sortObjects,y._drawRanges=n.drawRanges,y._reservedRanges=n.reservedRanges,y._visibility=n.visibility,y._active=n.active,y._bounds=n.bounds.map(O=>{const $=new Box3;$.min.fromArray(O.boxMin),$.max.fromArray(O.boxMax);const U=new Sphere$1;return U.radius=O.sphereRadius,U.center.fromArray(O.sphereCenter),{boxInitialized:O.boxInitialized,box:$,sphereInitialized:O.sphereInitialized,sphere:U}}),y._maxInstanceCount=n.maxInstanceCount,y._maxVertexCount=n.maxVertexCount,y._maxIndexCount=n.maxIndexCount,y._geometryInitialized=n.geometryInitialized,y._geometryCount=n.geometryCount,y._matricesTexture=Z(n.matricesTexture.uuid),n.colorsTexture!==void 0&&(y._colorsTexture=Z(n.colorsTexture.uuid));break;case"LOD":y=new LOD;break;case"Line":y=new Line(B(n.geometry),_(n.material));break;case"LineLoop":y=new LineLoop(B(n.geometry),_(n.material));break;case"LineSegments":y=new LineSegments(B(n.geometry),_(n.material));break;case"PointCloud":case"Points":y=new Points(B(n.geometry),_(n.material));break;case"Sprite":y=new Sprite(_(n.material));break;case"Group":y=new Group;break;case"Bone":y=new Bone;break;default:y=new Object3D}if(y.uuid=n.uuid,n.name!==void 0&&(y.name=n.name),n.matrix!==void 0?(y.matrix.fromArray(n.matrix),n.matrixAutoUpdate!==void 0&&(y.matrixAutoUpdate=n.matrixAutoUpdate),y.matrixAutoUpdate&&y.matrix.decompose(y.position,y.quaternion,y.scale)):(n.position!==void 0&&y.position.fromArray(n.position),n.rotation!==void 0&&y.rotation.fromArray(n.rotation),n.quaternion!==void 0&&y.quaternion.fromArray(n.quaternion),n.scale!==void 0&&y.scale.fromArray(n.scale)),n.up!==void 0&&y.up.fromArray(n.up),n.castShadow!==void 0&&(y.castShadow=n.castShadow),n.receiveShadow!==void 0&&(y.receiveShadow=n.receiveShadow),n.shadow&&(n.shadow.intensity!==void 0&&(y.shadow.intensity=n.shadow.intensity),n.shadow.bias!==void 0&&(y.shadow.bias=n.shadow.bias),n.shadow.normalBias!==void 0&&(y.shadow.normalBias=n.shadow.normalBias),n.shadow.radius!==void 0&&(y.shadow.radius=n.shadow.radius),n.shadow.mapSize!==void 0&&y.shadow.mapSize.fromArray(n.shadow.mapSize),n.shadow.camera!==void 0&&(y.shadow.camera=this.parseObject(n.shadow.camera))),n.visible!==void 0&&(y.visible=n.visible),n.frustumCulled!==void 0&&(y.frustumCulled=n.frustumCulled),n.renderOrder!==void 0&&(y.renderOrder=n.renderOrder),n.userData!==void 0&&(y.userData=n.userData),n.layers!==void 0&&(y.layers.mask=n.layers),n.children!==void 0){const T=n.children;for(let H=0;H<T.length;H++)y.add(this.parseObject(T[H],d,C,I,f))}if(n.animations!==void 0){const T=n.animations;for(let H=0;H<T.length;H++){const F=T[H];y.animations.push(f[F])}}if(n.type==="LOD"){n.autoUpdate!==void 0&&(y.autoUpdate=n.autoUpdate);const T=n.levels;for(let H=0;H<T.length;H++){const F=T[H],O=y.getObjectByProperty("uuid",F.object);O!==void 0&&y.addLevel(O,F.distance,F.hysteresis)}}return y}bindSkeletons(n,d){Object.keys(d).length!==0&&n.traverse(function(C){if(C.isSkinnedMesh===!0&&C.skeleton!==void 0){const I=d[C.skeleton];I===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",C.skeleton):C.bind(I,C.bindMatrix)}})}bindLightTargets(n){n.traverse(function(d){if(d.isDirectionalLight||d.isSpotLight){const C=d.target,I=n.getObjectByProperty("uuid",C);I!==void 0?d.target=I:d.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,d,C,I){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const f=this,y=Cache.get(n);if(y!==void 0){if(f.manager.itemStart(n),y.then){y.then(Z=>{d&&d(Z),f.manager.itemEnd(n)}).catch(Z=>{I&&I(Z)});return}return setTimeout(function(){d&&d(y),f.manager.itemEnd(n)},0),y}const B={};B.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",B.headers=this.requestHeader;const _=fetch(n,B).then(function(Z){return Z.blob()}).then(function(Z){return createImageBitmap(Z,Object.assign(f.options,{colorSpaceConversion:"none"}))}).then(function(Z){return Cache.add(n,Z),d&&d(Z),f.manager.itemEnd(n),Z}).catch(function(Z){I&&I(Z),Cache.remove(n),f.manager.itemError(n),f.manager.itemEnd(n)});Cache.add(n,_),f.manager.itemStart(n)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(n){_context=n}}class AudioLoader extends Loader{constructor(n){super(n)}load(n,d,C,I){const f=this,y=new FileLoader(this.manager);y.setResponseType("arraybuffer"),y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials),y.load(n,function(_){try{const Z=_.slice(0);AudioContext.getContext().decodeAudioData(Z,function(V){d(V)}).catch(B)}catch(Z){B(Z)}},C,I);function B(_){I?I(_):console.error(_),f.manager.itemError(n)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(n){const d=this._cache;if(d.focus!==n.focus||d.fov!==n.fov||d.aspect!==n.aspect*this.aspect||d.near!==n.near||d.far!==n.far||d.zoom!==n.zoom||d.eyeSep!==this.eyeSep){d.focus=n.focus,d.fov=n.fov,d.aspect=n.aspect*this.aspect,d.near=n.near,d.far=n.far,d.zoom=n.zoom,d.eyeSep=this.eyeSep,_projectionMatrix.copy(n.projectionMatrix);const I=d.eyeSep/2,f=I*d.near/d.focus,y=d.near*Math.tan(DEG2RAD*d.fov*.5)/d.zoom;let B,_;_eyeLeft.elements[12]=-I,_eyeRight.elements[12]=I,B=-y*d.aspect+f,_=y*d.aspect+f,_projectionMatrix.elements[0]=2*d.near/(_-B),_projectionMatrix.elements[8]=(_+B)/(_-B),this.cameraL.projectionMatrix.copy(_projectionMatrix),B=-y*d.aspect-f,_=y*d.aspect-f,_projectionMatrix.elements[0]=2*d.near/(_-B),_projectionMatrix.elements[8]=(_+B)/(_-B),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(n=[]){super(),this.isArrayCamera=!0,this.cameras=n,this.index=0}}class Clock{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const d=now();n=(d-this.oldTime)/1e3,this.oldTime=d,this.elapsedTime+=n}return n}}function now(){return performance.now()}const _position$1=new Vector3,_quaternion$1=new Quaternion$2,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const d=this.context.listener,C=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),d.positionX){const I=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(_position$1.x,I),d.positionY.linearRampToValueAtTime(_position$1.y,I),d.positionZ.linearRampToValueAtTime(_position$1.z,I),d.forwardX.linearRampToValueAtTime(_orientation$1.x,I),d.forwardY.linearRampToValueAtTime(_orientation$1.y,I),d.forwardZ.linearRampToValueAtTime(_orientation$1.z,I),d.upX.linearRampToValueAtTime(C.x,I),d.upY.linearRampToValueAtTime(C.y,I),d.upZ.linearRampToValueAtTime(C.z,I)}else d.setPosition(_position$1.x,_position$1.y,_position$1.z),d.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,C.x,C.y,C.z)}}class Audio extends Object3D{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const d=this.context.createBufferSource();return d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(n=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+n),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,d=this.filters.length;n<d;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,d=this.filters.length;n<d;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){return this.detune=n,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}copy(n,d){return super.copy(n,d),n.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=n.autoplay,this.buffer=n.buffer,this.detune=n.detune,this.loop=n.loop,this.loopStart=n.loopStart,this.loopEnd=n.loopEnd,this.offset=n.offset,this.duration=n.duration,this.playbackRate=n.playbackRate,this.hasPlaybackControl=n.hasPlaybackControl,this.sourceType=n.sourceType,this.filters=n.filters.slice(),this)}clone(n){return new this.constructor(this.listener).copy(this,n)}}const _position=new Vector3,_quaternion=new Quaternion$2,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(n){super(n),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(n){return this.panner.refDistance=n,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(n){return this.panner.rolloffFactor=n,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(n){return this.panner.distanceModel=n,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(n){return this.panner.maxDistance=n,this}setDirectionalCone(n,d,C){return this.panner.coneInnerAngle=n,this.panner.coneOuterAngle=d,this.panner.coneOuterGain=C,this}updateMatrixWorld(n){if(super.updateMatrixWorld(n),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const d=this.panner;if(d.positionX){const C=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(_position.x,C),d.positionY.linearRampToValueAtTime(_position.y,C),d.positionZ.linearRampToValueAtTime(_position.z,C),d.orientationX.linearRampToValueAtTime(_orientation.x,C),d.orientationY.linearRampToValueAtTime(_orientation.y,C),d.orientationZ.linearRampToValueAtTime(_orientation.z,C)}else d.setPosition(_position.x,_position.y,_position.z),d.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(n,d=2048){this.analyser=n.context.createAnalyser(),this.analyser.fftSize=d,this.data=new Uint8Array(this.analyser.frequencyBinCount),n.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let n=0;const d=this.getFrequencyData();for(let C=0;C<d.length;C++)n+=d[C];return n/d.length}}class PropertyMixer{constructor(n,d,C){this.binding=n,this.valueSize=C;let I,f,y;switch(d){case"quaternion":I=this._slerp,f=this._slerpAdditive,y=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(C*6),this._workIndex=5;break;case"string":case"bool":I=this._select,f=this._select,y=this._setAdditiveIdentityOther,this.buffer=new Array(C*5);break;default:I=this._lerp,f=this._lerpAdditive,y=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(C*5)}this._mixBufferRegion=I,this._mixBufferRegionAdditive=f,this._setIdentity=y,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(n,d){const C=this.buffer,I=this.valueSize,f=n*I+I;let y=this.cumulativeWeight;if(y===0){for(let B=0;B!==I;++B)C[f+B]=C[B];y=d}else{y+=d;const B=d/y;this._mixBufferRegion(C,f,0,B,I)}this.cumulativeWeight=y}accumulateAdditive(n){const d=this.buffer,C=this.valueSize,I=C*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(d,I,0,n,C),this.cumulativeWeightAdditive+=n}apply(n){const d=this.valueSize,C=this.buffer,I=n*d+d,f=this.cumulativeWeight,y=this.cumulativeWeightAdditive,B=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,f<1){const _=d*this._origIndex;this._mixBufferRegion(C,I,_,1-f,d)}y>0&&this._mixBufferRegionAdditive(C,I,this._addIndex*d,1,d);for(let _=d,Z=d+d;_!==Z;++_)if(C[_]!==C[_+d]){B.setValue(C,I);break}}saveOriginalState(){const n=this.binding,d=this.buffer,C=this.valueSize,I=C*this._origIndex;n.getValue(d,I);for(let f=C,y=I;f!==y;++f)d[f]=d[I+f%C];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const n=this.valueSize*3;this.binding.setValue(this.buffer,n)}_setAdditiveIdentityNumeric(){const n=this._addIndex*this.valueSize,d=n+this.valueSize;for(let C=n;C<d;C++)this.buffer[C]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const n=this._origIndex*this.valueSize,d=this._addIndex*this.valueSize;for(let C=0;C<this.valueSize;C++)this.buffer[d+C]=this.buffer[n+C]}_select(n,d,C,I,f){if(I>=.5)for(let y=0;y!==f;++y)n[d+y]=n[C+y]}_slerp(n,d,C,I){Quaternion$2.slerpFlat(n,d,n,d,n,C,I)}_slerpAdditive(n,d,C,I,f){const y=this._workIndex*f;Quaternion$2.multiplyQuaternionsFlat(n,y,n,d,n,C),Quaternion$2.slerpFlat(n,d,n,d,n,y,I)}_lerp(n,d,C,I,f){const y=1-I;for(let B=0;B!==f;++B){const _=d+B;n[_]=n[_]*y+n[C+B]*I}}_lerpAdditive(n,d,C,I,f){for(let y=0;y!==f;++y){const B=d+y;n[B]=n[B]+n[C+y]*I}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(n,d,C){const I=C||PropertyBinding.parseTrackName(d);this._targetGroup=n,this._bindings=n.subscribe_(d,I)}getValue(n,d){this.bind();const C=this._targetGroup.nCachedObjects_,I=this._bindings[C];I!==void 0&&I.getValue(n,d)}setValue(n,d){const C=this._bindings;for(let I=this._targetGroup.nCachedObjects_,f=C.length;I!==f;++I)C[I].setValue(n,d)}bind(){const n=this._bindings;for(let d=this._targetGroup.nCachedObjects_,C=n.length;d!==C;++d)n[d].bind()}unbind(){const n=this._bindings;for(let d=this._targetGroup.nCachedObjects_,C=n.length;d!==C;++d)n[d].unbind()}}class PropertyBinding{constructor(n,d,C){this.path=d,this.parsedPath=C||PropertyBinding.parseTrackName(d),this.node=PropertyBinding.findNode(n,this.parsedPath.nodeName),this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(n,d,C){return n&&n.isAnimationObjectGroup?new PropertyBinding.Composite(n,d,C):new PropertyBinding(n,d,C)}static sanitizeNodeName(n){return n.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(n){const d=_trackRe.exec(n);if(d===null)throw new Error("PropertyBinding: Cannot parse trackName: "+n);const C={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},I=C.nodeName&&C.nodeName.lastIndexOf(".");if(I!==void 0&&I!==-1){const f=C.nodeName.substring(I+1);_supportedObjectNames.indexOf(f)!==-1&&(C.nodeName=C.nodeName.substring(0,I),C.objectName=f)}if(C.propertyName===null||C.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+n);return C}static findNode(n,d){if(d===void 0||d===""||d==="."||d===-1||d===n.name||d===n.uuid)return n;if(n.skeleton){const C=n.skeleton.getBoneByName(d);if(C!==void 0)return C}if(n.children){const C=function(f){for(let y=0;y<f.length;y++){const B=f[y];if(B.name===d||B.uuid===d)return B;const _=C(B.children);if(_)return _}return null},I=C(n.children);if(I)return I}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(n,d){n[d]=this.targetObject[this.propertyName]}_getValue_array(n,d){const C=this.resolvedProperty;for(let I=0,f=C.length;I!==f;++I)n[d++]=C[I]}_getValue_arrayElement(n,d){n[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(n,d){this.resolvedProperty.toArray(n,d)}_setValue_direct(n,d){this.targetObject[this.propertyName]=n[d]}_setValue_direct_setNeedsUpdate(n,d){this.targetObject[this.propertyName]=n[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(n,d){this.targetObject[this.propertyName]=n[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,d){const C=this.resolvedProperty;for(let I=0,f=C.length;I!==f;++I)C[I]=n[d++]}_setValue_array_setNeedsUpdate(n,d){const C=this.resolvedProperty;for(let I=0,f=C.length;I!==f;++I)C[I]=n[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,d){const C=this.resolvedProperty;for(let I=0,f=C.length;I!==f;++I)C[I]=n[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(n,d){this.resolvedProperty[this.propertyIndex]=n[d]}_setValue_arrayElement_setNeedsUpdate(n,d){this.resolvedProperty[this.propertyIndex]=n[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(n,d){this.resolvedProperty[this.propertyIndex]=n[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(n,d){this.resolvedProperty.fromArray(n,d)}_setValue_fromArray_setNeedsUpdate(n,d){this.resolvedProperty.fromArray(n,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(n,d){this.resolvedProperty.fromArray(n,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(n,d){this.bind(),this.getValue(n,d)}_setValue_unbound(n,d){this.bind(),this.setValue(n,d)}bind(){let n=this.node;const d=this.parsedPath,C=d.objectName,I=d.propertyName;let f=d.propertyIndex;if(n||(n=PropertyBinding.findNode(this.rootNode,d.nodeName),this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!n){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(C){let Z=d.objectIndex;switch(C){case"materials":if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}n=n.material.materials;break;case"bones":if(!n.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}n=n.skeleton.bones;for(let M=0;M<n.length;M++)if(n[M].name===Z){Z=M;break}break;case"map":if("map"in n){n=n.map;break}if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}n=n.material.map;break;default:if(n[C]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}n=n[C]}if(Z!==void 0){if(n[Z]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);return}n=n[Z]}}const y=n[I];if(y===void 0){const Z=d.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+Z+"."+I+" but it wasn't found.",n);return}let B=this.Versioning.None;this.targetObject=n,n.isMaterial===!0?B=this.Versioning.NeedsUpdate:n.isObject3D===!0&&(B=this.Versioning.MatrixWorldNeedsUpdate);let _=this.BindingType.Direct;if(f!==void 0){if(I==="morphTargetInfluences"){if(!n.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!n.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}n.morphTargetDictionary[f]!==void 0&&(f=n.morphTargetDictionary[f])}_=this.BindingType.ArrayElement,this.resolvedProperty=y,this.propertyIndex=f}else y.fromArray!==void 0&&y.toArray!==void 0?(_=this.BindingType.HasFromToArray,this.resolvedProperty=y):Array.isArray(y)?(_=this.BindingType.EntireArray,this.resolvedProperty=y):this.propertyName=I;this.getValue=this.GetterByBindingType[_],this.setValue=this.SetterByBindingTypeAndVersioning[_][B]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const n={};this._indicesByUUID=n;for(let C=0,I=arguments.length;C!==I;++C)n[arguments[C].uuid]=C;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}add(){const n=this._objects,d=this._indicesByUUID,C=this._paths,I=this._parsedPaths,f=this._bindings,y=f.length;let B,_=n.length,Z=this.nCachedObjects_;for(let M=0,V=arguments.length;M!==V;++M){const T=arguments[M],H=T.uuid;let F=d[H];if(F===void 0){F=_++,d[H]=F,n.push(T);for(let O=0,$=y;O!==$;++O)f[O].push(new PropertyBinding(T,C[O],I[O]))}else if(F<Z){B=n[F];const O=--Z,$=n[O];d[$.uuid]=F,n[F]=$,d[H]=O,n[O]=T;for(let U=0,ee=y;U!==ee;++U){const Q=f[U],ie=Q[O];let ne=Q[F];Q[F]=ie,ne===void 0&&(ne=new PropertyBinding(T,C[U],I[U])),Q[O]=ne}}else n[F]!==B&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=Z}remove(){const n=this._objects,d=this._indicesByUUID,C=this._bindings,I=C.length;let f=this.nCachedObjects_;for(let y=0,B=arguments.length;y!==B;++y){const _=arguments[y],Z=_.uuid,M=d[Z];if(M!==void 0&&M>=f){const V=f++,T=n[V];d[T.uuid]=M,n[M]=T,d[Z]=V,n[V]=_;for(let H=0,F=I;H!==F;++H){const O=C[H],$=O[V],U=O[M];O[M]=$,O[V]=U}}}this.nCachedObjects_=f}uncache(){const n=this._objects,d=this._indicesByUUID,C=this._bindings,I=C.length;let f=this.nCachedObjects_,y=n.length;for(let B=0,_=arguments.length;B!==_;++B){const Z=arguments[B],M=Z.uuid,V=d[M];if(V!==void 0)if(delete d[M],V<f){const T=--f,H=n[T],F=--y,O=n[F];d[H.uuid]=V,n[V]=H,d[O.uuid]=T,n[T]=O,n.pop();for(let $=0,U=I;$!==U;++$){const ee=C[$],Q=ee[T],ie=ee[F];ee[V]=Q,ee[T]=ie,ee.pop()}}else{const T=--y,H=n[T];T>0&&(d[H.uuid]=V),n[V]=H,n.pop();for(let F=0,O=I;F!==O;++F){const $=C[F];$[V]=$[T],$.pop()}}}this.nCachedObjects_=f}subscribe_(n,d){const C=this._bindingsIndicesByPath;let I=C[n];const f=this._bindings;if(I!==void 0)return f[I];const y=this._paths,B=this._parsedPaths,_=this._objects,Z=_.length,M=this.nCachedObjects_,V=new Array(Z);I=f.length,C[n]=I,y.push(n),B.push(d),f.push(V);for(let T=M,H=_.length;T!==H;++T){const F=_[T];V[T]=new PropertyBinding(F,n,d)}return V}unsubscribe_(n){const d=this._bindingsIndicesByPath,C=d[n];if(C!==void 0){const I=this._paths,f=this._parsedPaths,y=this._bindings,B=y.length-1,_=y[B],Z=n[B];d[Z]=C,y[C]=_,y.pop(),f[C]=f[B],f.pop(),I[C]=I[B],I.pop()}}}class AnimationAction{constructor(n,d,C=null,I=d.blendMode){this._mixer=n,this._clip=d,this._localRoot=C,this.blendMode=I;const f=d.tracks,y=f.length,B=new Array(y),_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let Z=0;Z!==y;++Z){const M=f[Z].createInterpolant(null);B[Z]=M,M.settings=_}this._interpolantSettings=_,this._interpolants=B,this._propertyBindings=new Array(y),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(n){return this._startTime=n,this}setLoop(n,d){return this.loop=n,this.repetitions=d,this}setEffectiveWeight(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(n){return this._scheduleFading(n,0,1)}fadeOut(n){return this._scheduleFading(n,1,0)}crossFadeFrom(n,d,C){if(n.fadeOut(d),this.fadeIn(d),C){const I=this._clip.duration,f=n._clip.duration,y=f/I,B=I/f;n.warp(1,y,d),this.warp(B,1,d)}return this}crossFadeTo(n,d,C){return n.crossFadeFrom(this,d,C)}stopFading(){const n=this._weightInterpolant;return n!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}setEffectiveTimeScale(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(n){return this.timeScale=this._clip.duration/n,this.stopWarping()}syncWith(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()}halt(n){return this.warp(this._effectiveTimeScale,0,n)}warp(n,d,C){const I=this._mixer,f=I.time,y=this.timeScale;let B=this._timeScaleInterpolant;B===null&&(B=I._lendControlInterpolant(),this._timeScaleInterpolant=B);const _=B.parameterPositions,Z=B.sampleValues;return _[0]=f,_[1]=f+C,Z[0]=n/y,Z[1]=d/y,this}stopWarping(){const n=this._timeScaleInterpolant;return n!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(n,d,C,I){if(!this.enabled){this._updateWeight(n);return}const f=this._startTime;if(f!==null){const _=(n-f)*C;_<0||C===0?d=0:(this._startTime=null,d=C*_)}d*=this._updateTimeScale(n);const y=this._updateTime(d),B=this._updateWeight(n);if(B>0){const _=this._interpolants,Z=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let M=0,V=_.length;M!==V;++M)_[M].evaluate(y),Z[M].accumulateAdditive(B);break;case NormalAnimationBlendMode:default:for(let M=0,V=_.length;M!==V;++M)_[M].evaluate(y),Z[M].accumulate(I,B)}}}_updateWeight(n){let d=0;if(this.enabled){d=this.weight;const C=this._weightInterpolant;if(C!==null){const I=C.evaluate(n)[0];d*=I,n>C.parameterPositions[1]&&(this.stopFading(),I===0&&(this.enabled=!1))}}return this._effectiveWeight=d,d}_updateTimeScale(n){let d=0;if(!this.paused){d=this.timeScale;const C=this._timeScaleInterpolant;if(C!==null){const I=C.evaluate(n)[0];d*=I,n>C.parameterPositions[1]&&(this.stopWarping(),d===0?this.paused=!0:this.timeScale=d)}}return this._effectiveTimeScale=d,d}_updateTime(n){const d=this._clip.duration,C=this.loop;let I=this.time+n,f=this._loopCount;const y=C===LoopPingPong;if(n===0)return f===-1?I:y&&(f&1)===1?d-I:I;if(C===LoopOnce){f===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(I>=d)I=d;else if(I<0)I=0;else{this.time=I;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=I,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(f===-1&&(n>=0?(f=0,this._setEndings(!0,this.repetitions===0,y)):this._setEndings(this.repetitions===0,!0,y)),I>=d||I<0){const B=Math.floor(I/d);I-=d*B,f+=Math.abs(B);const _=this.repetitions-f;if(_<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,I=n>0?d:0,this.time=I,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(_===1){const Z=n<0;this._setEndings(Z,!Z,y)}else this._setEndings(!1,!1,y);this._loopCount=f,this.time=I,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:B})}}else this.time=I;if(y&&(f&1)===1)return d-I}return I}_setEndings(n,d,C){const I=this._interpolantSettings;C?(I.endingStart=ZeroSlopeEnding,I.endingEnd=ZeroSlopeEnding):(n?I.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:I.endingStart=WrapAroundEnding,d?I.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:I.endingEnd=WrapAroundEnding)}_scheduleFading(n,d,C){const I=this._mixer,f=I.time;let y=this._weightInterpolant;y===null&&(y=I._lendControlInterpolant(),this._weightInterpolant=y);const B=y.parameterPositions,_=y.sampleValues;return B[0]=f,_[0]=d,B[1]=f+n,_[1]=C,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher$1{constructor(n){super(),this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(n,d){const C=n._localRoot||this._root,I=n._clip.tracks,f=I.length,y=n._propertyBindings,B=n._interpolants,_=C.uuid,Z=this._bindingsByRootAndName;let M=Z[_];M===void 0&&(M={},Z[_]=M);for(let V=0;V!==f;++V){const T=I[V],H=T.name;let F=M[H];if(F!==void 0)++F.referenceCount,y[V]=F;else{if(F=y[V],F!==void 0){F._cacheIndex===null&&(++F.referenceCount,this._addInactiveBinding(F,_,H));continue}const O=d&&d._propertyBindings[V].binding.parsedPath;F=new PropertyMixer(PropertyBinding.create(C,H,O),T.ValueTypeName,T.getValueSize()),++F.referenceCount,this._addInactiveBinding(F,_,H),y[V]=F}B[V].resultBuffer=F.buffer}}_activateAction(n){if(!this._isActiveAction(n)){if(n._cacheIndex===null){const C=(n._localRoot||this._root).uuid,I=n._clip.uuid,f=this._actionsByClip[I];this._bindAction(n,f&&f.knownActions[0]),this._addInactiveAction(n,I,C)}const d=n._propertyBindings;for(let C=0,I=d.length;C!==I;++C){const f=d[C];f.useCount++===0&&(this._lendBinding(f),f.saveOriginalState())}this._lendAction(n)}}_deactivateAction(n){if(this._isActiveAction(n)){const d=n._propertyBindings;for(let C=0,I=d.length;C!==I;++C){const f=d[C];--f.useCount===0&&(f.restoreOriginalState(),this._takeBackBinding(f))}this._takeBackAction(n)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}}_isActiveAction(n){const d=n._cacheIndex;return d!==null&&d<this._nActiveActions}_addInactiveAction(n,d,C){const I=this._actions,f=this._actionsByClip;let y=f[d];if(y===void 0)y={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,f[d]=y;else{const B=y.knownActions;n._byClipCacheIndex=B.length,B.push(n)}n._cacheIndex=I.length,I.push(n),y.actionByRoot[C]=n}_removeInactiveAction(n){const d=this._actions,C=d[d.length-1],I=n._cacheIndex;C._cacheIndex=I,d[I]=C,d.pop(),n._cacheIndex=null;const f=n._clip.uuid,y=this._actionsByClip,B=y[f],_=B.knownActions,Z=_[_.length-1],M=n._byClipCacheIndex;Z._byClipCacheIndex=M,_[M]=Z,_.pop(),n._byClipCacheIndex=null;const V=B.actionByRoot,T=(n._localRoot||this._root).uuid;delete V[T],_.length===0&&delete y[f],this._removeInactiveBindingsForAction(n)}_removeInactiveBindingsForAction(n){const d=n._propertyBindings;for(let C=0,I=d.length;C!==I;++C){const f=d[C];--f.referenceCount===0&&this._removeInactiveBinding(f)}}_lendAction(n){const d=this._actions,C=n._cacheIndex,I=this._nActiveActions++,f=d[I];n._cacheIndex=I,d[I]=n,f._cacheIndex=C,d[C]=f}_takeBackAction(n){const d=this._actions,C=n._cacheIndex,I=--this._nActiveActions,f=d[I];n._cacheIndex=I,d[I]=n,f._cacheIndex=C,d[C]=f}_addInactiveBinding(n,d,C){const I=this._bindingsByRootAndName,f=this._bindings;let y=I[d];y===void 0&&(y={},I[d]=y),y[C]=n,n._cacheIndex=f.length,f.push(n)}_removeInactiveBinding(n){const d=this._bindings,C=n.binding,I=C.rootNode.uuid,f=C.path,y=this._bindingsByRootAndName,B=y[I],_=d[d.length-1],Z=n._cacheIndex;_._cacheIndex=Z,d[Z]=_,d.pop(),delete B[f],Object.keys(B).length===0&&delete y[I]}_lendBinding(n){const d=this._bindings,C=n._cacheIndex,I=this._nActiveBindings++,f=d[I];n._cacheIndex=I,d[I]=n,f._cacheIndex=C,d[C]=f}_takeBackBinding(n){const d=this._bindings,C=n._cacheIndex,I=--this._nActiveBindings,f=d[I];n._cacheIndex=I,d[I]=n,f._cacheIndex=C,d[C]=f}_lendControlInterpolant(){const n=this._controlInterpolants,d=this._nActiveControlInterpolants++;let C=n[d];return C===void 0&&(C=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),C.__cacheIndex=d,n[d]=C),C}_takeBackControlInterpolant(n){const d=this._controlInterpolants,C=n.__cacheIndex,I=--this._nActiveControlInterpolants,f=d[I];n.__cacheIndex=I,d[I]=n,f.__cacheIndex=C,d[C]=f}clipAction(n,d,C){const I=d||this._root,f=I.uuid;let y=typeof n=="string"?AnimationClip.findByName(I,n):n;const B=y!==null?y.uuid:n,_=this._actionsByClip[B];let Z=null;if(C===void 0&&(y!==null?C=y.blendMode:C=NormalAnimationBlendMode),_!==void 0){const V=_.actionByRoot[f];if(V!==void 0&&V.blendMode===C)return V;Z=_.knownActions[0],y===null&&(y=Z._clip)}if(y===null)return null;const M=new AnimationAction(this,y,d,C);return this._bindAction(M,Z),this._addInactiveAction(M,B,f),M}existingAction(n,d){const C=d||this._root,I=C.uuid,f=typeof n=="string"?AnimationClip.findByName(C,n):n,y=f?f.uuid:n,B=this._actionsByClip[y];return B!==void 0&&B.actionByRoot[I]||null}stopAllAction(){const n=this._actions,d=this._nActiveActions;for(let C=d-1;C>=0;--C)n[C].stop();return this}update(n){n*=this.timeScale;const d=this._actions,C=this._nActiveActions,I=this.time+=n,f=Math.sign(n),y=this._accuIndex^=1;for(let Z=0;Z!==C;++Z)d[Z]._update(I,n,f,y);const B=this._bindings,_=this._nActiveBindings;for(let Z=0;Z!==_;++Z)B[Z].apply(y);return this}setTime(n){this.time=0;for(let d=0;d<this._actions.length;d++)this._actions[d].time=0;return this.update(n)}getRoot(){return this._root}uncacheClip(n){const d=this._actions,C=n.uuid,I=this._actionsByClip,f=I[C];if(f!==void 0){const y=f.knownActions;for(let B=0,_=y.length;B!==_;++B){const Z=y[B];this._deactivateAction(Z);const M=Z._cacheIndex,V=d[d.length-1];Z._cacheIndex=null,Z._byClipCacheIndex=null,V._cacheIndex=M,d[M]=V,d.pop(),this._removeInactiveBindingsForAction(Z)}delete I[C]}}uncacheRoot(n){const d=n.uuid,C=this._actionsByClip;for(const y in C){const B=C[y].actionByRoot,_=B[d];_!==void 0&&(this._deactivateAction(_),this._removeInactiveAction(_))}const I=this._bindingsByRootAndName,f=I[d];if(f!==void 0)for(const y in f){const B=f[y];B.restoreOriginalState(),this._removeInactiveBinding(B)}}uncacheAction(n,d){const C=this.existingAction(n,d);C!==null&&(this._deactivateAction(C),this._removeInactiveAction(C))}}class RenderTarget3D extends RenderTarget{constructor(n=1,d=1,C=1,I={}){super(n,d,I),this.isRenderTarget3D=!0,this.depth=C,this.texture=new Data3DTexture(null,n,d,C),this.texture.isRenderTargetTexture=!0}}class RenderTargetArray extends RenderTarget{constructor(n=1,d=1,C=1,I={}){super(n,d,I),this.isRenderTargetArray=!0,this.depth=C,this.texture=new DataArrayTexture(null,n,d,C),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(n){this.value=n}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id$3=0;class UniformsGroup extends EventDispatcher$1{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id$3++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(n){return this.uniforms.push(n),this}remove(n){const d=this.uniforms.indexOf(n);return d!==-1&&this.uniforms.splice(d,1),this}setName(n){return this.name=n,this}setUsage(n){return this.usage=n,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(n){this.name=n.name,this.usage=n.usage;const d=n.uniforms;this.uniforms.length=0;for(let C=0,I=d.length;C<I;C++){const f=Array.isArray(d[C])?d[C]:[d[C]];for(let y=0;y<f.length;y++)this.uniforms.push(f[y].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(n,d,C=1){super(n,d),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=C}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}clone(n){const d=super.clone(n);return d.meshPerAttribute=this.meshPerAttribute,d}toJSON(n){const d=super.toJSON(n);return d.isInstancedInterleavedBuffer=!0,d.meshPerAttribute=this.meshPerAttribute,d}}class GLBufferAttribute{constructor(n,d,C,I,f){this.isGLBufferAttribute=!0,this.name="",this.buffer=n,this.type=d,this.itemSize=C,this.elementSize=I,this.count=f,this.version=0}set needsUpdate(n){n===!0&&this.version++}setBuffer(n){return this.buffer=n,this}setType(n,d){return this.type=n,this.elementSize=d,this}setItemSize(n){return this.itemSize=n,this}setCount(n){return this.count=n,this}}const _matrix=new Matrix4;class Raycaster{constructor(n,d,C=0,I=1/0){this.ray=new Ray$2(n,d),this.near=C,this.far=I,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,d){this.ray.set(n,d)}setFromCamera(n,d){d.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(d.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(d).sub(this.ray.origin).normalize(),this.camera=d):d.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(d.near+d.far)/(d.near-d.far)).unproject(d),this.ray.direction.set(0,0,-1).transformDirection(d.matrixWorld),this.camera=d):console.error("THREE.Raycaster: Unsupported camera type: "+d.type)}setFromXRController(n){return _matrix.identity().extractRotation(n.matrixWorld),this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix),this}intersectObject(n,d=!0,C=[]){return intersect$2(n,this,C,d),C.sort(ascSort),C}intersectObjects(n,d=!0,C=[]){for(let I=0,f=n.length;I<f;I++)intersect$2(n[I],this,C,d);return C.sort(ascSort),C}}function ascSort(u,n){return u.distance-n.distance}function intersect$2(u,n,d,C){let I=!0;if(u.layers.test(n.layers)&&u.raycast(n,d)===!1&&(I=!1),I===!0&&C===!0){const f=u.children;for(let y=0,B=f.length;y<B;y++)intersect$2(f[y],n,d,!0)}}class Spherical{constructor(n=1,d=0,C=0){this.radius=n,this.phi=d,this.theta=C}set(n,d,C){return this.radius=n,this.phi=d,this.theta=C,this}copy(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this}makeSafe(){return this.phi=clamp$1(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,d,C){return this.radius=Math.sqrt(n*n+d*d+C*C),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,C),this.phi=Math.acos(clamp$1(d/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(n=1,d=0,C=0){this.radius=n,this.theta=d,this.y=C}set(n,d,C){return this.radius=n,this.theta=d,this.y=C,this}copy(n){return this.radius=n.radius,this.theta=n.theta,this.y=n.y,this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,d,C){return this.radius=Math.sqrt(n*n+C*C),this.theta=Math.atan2(n,C),this.y=d,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(n,d,C,I){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],n!==void 0&&this.set(n,d,C,I)}identity(){return this.set(1,0,0,1),this}fromArray(n,d=0){for(let C=0;C<4;C++)this.elements[C]=n[C+d];return this}set(n,d,C,I){const f=this.elements;return f[0]=n,f[2]=d,f[1]=C,f[3]=I,this}}const _vector$4=new Vector2;class Box2{constructor(n=new Vector2(1/0,1/0),d=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=n,this.max=d}set(n,d){return this.min.copy(n),this.max.copy(d),this}setFromPoints(n){this.makeEmpty();for(let d=0,C=n.length;d<C;d++)this.expandByPoint(n[d]);return this}setFromCenterAndSize(n,d){const C=_vector$4.copy(d).multiplyScalar(.5);return this.min.copy(n).sub(C),this.max.copy(n).add(C),this}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(n){return this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}containsPoint(n){return n.x>=this.min.x&&n.x<=this.max.x&&n.y>=this.min.y&&n.y<=this.max.y}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y}getParameter(n,d){return d.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(n){return n.max.x>=this.min.x&&n.min.x<=this.max.x&&n.max.y>=this.min.y&&n.min.y<=this.max.y}clampPoint(n,d){return d.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,_vector$4).distanceTo(n)}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(n=new Vector3,d=new Vector3){this.start=n,this.end=d}set(n,d){return this.start.copy(n),this.end.copy(d),this}copy(n){return this.start.copy(n.start),this.end.copy(n.end),this}getCenter(n){return n.addVectors(this.start,this.end).multiplyScalar(.5)}delta(n){return n.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(n,d){return this.delta(d).multiplyScalar(n).add(this.start)}closestPointToPointParameter(n,d){_startP.subVectors(n,this.start),_startEnd.subVectors(this.end,this.start);const C=_startEnd.dot(_startEnd);let f=_startEnd.dot(_startP)/C;return d&&(f=clamp$1(f,0,1)),f}closestPointToPoint(n,d,C){const I=this.closestPointToPointParameter(n,d);return this.delta(C).multiplyScalar(I).add(this.start)}applyMatrix4(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this}equals(n){return n.start.equals(this.start)&&n.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(n,d){super(),this.light=n,this.matrixAutoUpdate=!1,this.color=d,this.type="SpotLightHelper";const C=new BufferGeometry,I=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let y=0,B=1,_=32;y<_;y++,B++){const Z=y/_*Math.PI*2,M=B/_*Math.PI*2;I.push(Math.cos(Z),Math.sin(Z),1,Math.cos(M),Math.sin(M),1)}C.setAttribute("position",new Float32BufferAttribute(I,3));const f=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(C,f),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const n=this.light.distance?this.light.distance:1e3,d=n*Math.tan(this.light.angle);this.cone.scale.set(d,d,n),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(n){const d=getBoneList(n),C=new BufferGeometry,I=[],f=[],y=new Color(0,0,1),B=new Color(0,1,0);for(let Z=0;Z<d.length;Z++){const M=d[Z];M.parent&&M.parent.isBone&&(I.push(0,0,0),I.push(0,0,0),f.push(y.r,y.g,y.b),f.push(B.r,B.g,B.b))}C.setAttribute("position",new Float32BufferAttribute(I,3)),C.setAttribute("color",new Float32BufferAttribute(f,3));const _=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(C,_),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=n,this.bones=d,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(n){const d=this.bones,C=this.geometry,I=C.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let f=0,y=0;f<d.length;f++){const B=d[f];B.parent&&B.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,B.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),I.setXYZ(y,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,B.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),I.setXYZ(y+1,_vector$2.x,_vector$2.y,_vector$2.z),y+=2)}C.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(u){const n=[];u.isBone===!0&&n.push(u);for(let d=0;d<u.children.length;d++)n.push(...getBoneList(u.children[d]));return n}class PointLightHelper extends Mesh{constructor(n,d,C){const I=new SphereGeometry(d,4,2),f=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(I,f),this.light=n,this.color=C,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(n,d,C){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=C,this.type="HemisphereLightHelper";const I=new OctahedronGeometry(d);I.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const f=I.getAttribute("position"),y=new Float32Array(f.count*3);I.setAttribute("color",new BufferAttribute(y,3)),this.add(new Mesh(I,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const n=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const d=n.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let C=0,I=d.count;C<I;C++){const f=C<I/2?_color1:_color2;d.setXYZ(C,f.r,f.g,f.b)}d.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),n.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(n=10,d=10,C=4473924,I=8947848){C=new Color(C),I=new Color(I);const f=d/2,y=n/d,B=n/2,_=[],Z=[];for(let T=0,H=0,F=-B;T<=d;T++,F+=y){_.push(-B,0,F,B,0,F),_.push(F,0,-B,F,0,B);const O=T===f?C:I;O.toArray(Z,H),H+=3,O.toArray(Z,H),H+=3,O.toArray(Z,H),H+=3,O.toArray(Z,H),H+=3}const M=new BufferGeometry;M.setAttribute("position",new Float32BufferAttribute(_,3)),M.setAttribute("color",new Float32BufferAttribute(Z,3));const V=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(M,V),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(n=10,d=16,C=8,I=64,f=4473924,y=8947848){f=new Color(f),y=new Color(y);const B=[],_=[];if(d>1)for(let V=0;V<d;V++){const T=V/d*(Math.PI*2),H=Math.sin(T)*n,F=Math.cos(T)*n;B.push(0,0,0),B.push(H,0,F);const O=V&1?f:y;_.push(O.r,O.g,O.b),_.push(O.r,O.g,O.b)}for(let V=0;V<C;V++){const T=V&1?f:y,H=n-n/C*V;for(let F=0;F<I;F++){let O=F/I*(Math.PI*2),$=Math.sin(O)*H,U=Math.cos(O)*H;B.push($,0,U),_.push(T.r,T.g,T.b),O=(F+1)/I*(Math.PI*2),$=Math.sin(O)*H,U=Math.cos(O)*H,B.push($,0,U),_.push(T.r,T.g,T.b)}}const Z=new BufferGeometry;Z.setAttribute("position",new Float32BufferAttribute(B,3)),Z.setAttribute("color",new Float32BufferAttribute(_,3));const M=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(Z,M),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(n,d,C){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=C,this.type="DirectionalLightHelper",d===void 0&&(d=1);let I=new BufferGeometry;I.setAttribute("position",new Float32BufferAttribute([-d,d,0,d,d,0,d,-d,0,-d,-d,0,-d,d,0],3));const f=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(I,f),this.add(this.lightPlane),I=new BufferGeometry,I.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(I,f),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(n){const d=new BufferGeometry,C=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),I=[],f=[],y={};B("n1","n2"),B("n2","n4"),B("n4","n3"),B("n3","n1"),B("f1","f2"),B("f2","f4"),B("f4","f3"),B("f3","f1"),B("n1","f1"),B("n2","f2"),B("n3","f3"),B("n4","f4"),B("p","n1"),B("p","n2"),B("p","n3"),B("p","n4"),B("u1","u2"),B("u2","u3"),B("u3","u1"),B("c","t"),B("p","c"),B("cn1","cn2"),B("cn3","cn4"),B("cf1","cf2"),B("cf3","cf4");function B(F,O){_(F),_(O)}function _(F){I.push(0,0,0),f.push(0,0,0),y[F]===void 0&&(y[F]=[]),y[F].push(I.length/3-1)}d.setAttribute("position",new Float32BufferAttribute(I,3)),d.setAttribute("color",new Float32BufferAttribute(f,3)),super(d,C),this.type="CameraHelper",this.camera=n,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=y,this.update();const Z=new Color(16755200),M=new Color(16711680),V=new Color(43775),T=new Color(16777215),H=new Color(3355443);this.setColors(Z,M,V,T,H)}setColors(n,d,C,I,f){const B=this.geometry.getAttribute("color");B.setXYZ(0,n.r,n.g,n.b),B.setXYZ(1,n.r,n.g,n.b),B.setXYZ(2,n.r,n.g,n.b),B.setXYZ(3,n.r,n.g,n.b),B.setXYZ(4,n.r,n.g,n.b),B.setXYZ(5,n.r,n.g,n.b),B.setXYZ(6,n.r,n.g,n.b),B.setXYZ(7,n.r,n.g,n.b),B.setXYZ(8,n.r,n.g,n.b),B.setXYZ(9,n.r,n.g,n.b),B.setXYZ(10,n.r,n.g,n.b),B.setXYZ(11,n.r,n.g,n.b),B.setXYZ(12,n.r,n.g,n.b),B.setXYZ(13,n.r,n.g,n.b),B.setXYZ(14,n.r,n.g,n.b),B.setXYZ(15,n.r,n.g,n.b),B.setXYZ(16,n.r,n.g,n.b),B.setXYZ(17,n.r,n.g,n.b),B.setXYZ(18,n.r,n.g,n.b),B.setXYZ(19,n.r,n.g,n.b),B.setXYZ(20,n.r,n.g,n.b),B.setXYZ(21,n.r,n.g,n.b),B.setXYZ(22,n.r,n.g,n.b),B.setXYZ(23,n.r,n.g,n.b),B.setXYZ(24,d.r,d.g,d.b),B.setXYZ(25,d.r,d.g,d.b),B.setXYZ(26,d.r,d.g,d.b),B.setXYZ(27,d.r,d.g,d.b),B.setXYZ(28,d.r,d.g,d.b),B.setXYZ(29,d.r,d.g,d.b),B.setXYZ(30,d.r,d.g,d.b),B.setXYZ(31,d.r,d.g,d.b),B.setXYZ(32,C.r,C.g,C.b),B.setXYZ(33,C.r,C.g,C.b),B.setXYZ(34,C.r,C.g,C.b),B.setXYZ(35,C.r,C.g,C.b),B.setXYZ(36,C.r,C.g,C.b),B.setXYZ(37,C.r,C.g,C.b),B.setXYZ(38,I.r,I.g,I.b),B.setXYZ(39,I.r,I.g,I.b),B.setXYZ(40,f.r,f.g,f.b),B.setXYZ(41,f.r,f.g,f.b),B.setXYZ(42,f.r,f.g,f.b),B.setXYZ(43,f.r,f.g,f.b),B.setXYZ(44,f.r,f.g,f.b),B.setXYZ(45,f.r,f.g,f.b),B.setXYZ(46,f.r,f.g,f.b),B.setXYZ(47,f.r,f.g,f.b),B.setXYZ(48,f.r,f.g,f.b),B.setXYZ(49,f.r,f.g,f.b),B.needsUpdate=!0}update(){const n=this.geometry,d=this.pointMap,C=1,I=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const f=this.camera.coordinateSystem===WebGLCoordinateSystem?-1:0;setPoint("c",d,n,_camera,0,0,f),setPoint("t",d,n,_camera,0,0,1),setPoint("n1",d,n,_camera,-1,-1,f),setPoint("n2",d,n,_camera,C,-1,f),setPoint("n3",d,n,_camera,-1,I,f),setPoint("n4",d,n,_camera,C,I,f),setPoint("f1",d,n,_camera,-1,-1,1),setPoint("f2",d,n,_camera,C,-1,1),setPoint("f3",d,n,_camera,-1,I,1),setPoint("f4",d,n,_camera,C,I,1),setPoint("u1",d,n,_camera,C*.7,I*1.1,f),setPoint("u2",d,n,_camera,-1*.7,I*1.1,f),setPoint("u3",d,n,_camera,0,I*2,f),setPoint("cf1",d,n,_camera,-1,0,1),setPoint("cf2",d,n,_camera,C,0,1),setPoint("cf3",d,n,_camera,0,-1,1),setPoint("cf4",d,n,_camera,0,I,1),setPoint("cn1",d,n,_camera,-1,0,f),setPoint("cn2",d,n,_camera,C,0,f),setPoint("cn3",d,n,_camera,0,-1,f),setPoint("cn4",d,n,_camera,0,I,f),n.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(u,n,d,C,I,f,y){_vector.set(I,f,y).unproject(C);const B=n[u];if(B!==void 0){const _=d.getAttribute("position");for(let Z=0,M=B.length;Z<M;Z++)_.setXYZ(B[Z],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(n,d=16776960){const C=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),I=new Float32Array(8*3),f=new BufferGeometry;f.setIndex(new BufferAttribute(C,1)),f.setAttribute("position",new BufferAttribute(I,3)),super(f,new LineBasicMaterial({color:d,toneMapped:!1})),this.object=n,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const n=_box.min,d=_box.max,C=this.geometry.attributes.position,I=C.array;I[0]=d.x,I[1]=d.y,I[2]=d.z,I[3]=n.x,I[4]=d.y,I[5]=d.z,I[6]=n.x,I[7]=n.y,I[8]=d.z,I[9]=d.x,I[10]=n.y,I[11]=d.z,I[12]=d.x,I[13]=d.y,I[14]=n.z,I[15]=n.x,I[16]=d.y,I[17]=n.z,I[18]=n.x,I[19]=n.y,I[20]=n.z,I[21]=d.x,I[22]=n.y,I[23]=n.z,C.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(n){return this.object=n,this.update(),this}copy(n,d){return super.copy(n,d),this.object=n.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(n,d=16776960){const C=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),I=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],f=new BufferGeometry;f.setIndex(new BufferAttribute(C,1)),f.setAttribute("position",new Float32BufferAttribute(I,3)),super(f,new LineBasicMaterial({color:d,toneMapped:!1})),this.box=n,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(n){const d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(n))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(n,d=1,C=16776960){const I=C,f=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],y=new BufferGeometry;y.setAttribute("position",new Float32BufferAttribute(f,3)),y.computeBoundingSphere(),super(y,new LineBasicMaterial({color:I,toneMapped:!1})),this.type="PlaneHelper",this.plane=n,this.size=d;const B=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],_=new BufferGeometry;_.setAttribute("position",new Float32BufferAttribute(B,3)),_.computeBoundingSphere(),this.add(new Mesh(_,new MeshBasicMaterial({color:I,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(n){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(n=new Vector3(0,0,1),d=new Vector3(0,0,0),C=1,I=16776960,f=C*.2,y=f*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(d),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:I,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:I,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(C,f,y)}setDirection(n){if(n.y>.99999)this.quaternion.set(0,0,0,1);else if(n.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(n.z,0,-n.x).normalize();const d=Math.acos(n.y);this.quaternion.setFromAxisAngle(_axis,d)}}setLength(n,d=n*.2,C=d*.2){this.line.scale.set(1,Math.max(1e-4,n-d),1),this.line.updateMatrix(),this.cone.scale.set(C,d,C),this.cone.position.y=n,this.cone.updateMatrix()}setColor(n){this.line.material.color.set(n),this.cone.material.color.set(n)}copy(n){return super.copy(n,!1),this.line.copy(n.line),this.cone.copy(n.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(n=1){const d=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],C=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],I=new BufferGeometry;I.setAttribute("position",new Float32BufferAttribute(d,3)),I.setAttribute("color",new Float32BufferAttribute(C,3));const f=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(I,f),this.type="AxesHelper"}setColors(n,d,C){const I=new Color,f=this.geometry.attributes.color.array;return I.set(n),I.toArray(f,0),I.toArray(f,3),I.set(d),I.toArray(f,6),I.toArray(f,9),I.set(C),I.toArray(f,12),I.toArray(f,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(n,d){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(n,d),this}lineTo(n,d){return this.currentPath.lineTo(n,d),this}quadraticCurveTo(n,d,C,I){return this.currentPath.quadraticCurveTo(n,d,C,I),this}bezierCurveTo(n,d,C,I,f,y){return this.currentPath.bezierCurveTo(n,d,C,I,f,y),this}splineThru(n){return this.currentPath.splineThru(n),this}toShapes(n){function d(U){const ee=[];for(let Q=0,ie=U.length;Q<ie;Q++){const ne=U[Q],le=new Shape$2;le.curves=ne.curves,ee.push(le)}return ee}function C(U,ee){const Q=ee.length;let ie=!1;for(let ne=Q-1,le=0;le<Q;ne=le++){let ae=ee[ne],ce=ee[le],ge=ce.x-ae.x,he=ce.y-ae.y;if(Math.abs(he)>Number.EPSILON){if(he<0&&(ae=ee[le],ge=-ge,ce=ee[ne],he=-he),U.y<ae.y||U.y>ce.y)continue;if(U.y===ae.y){if(U.x===ae.x)return!0}else{const Ie=he*(U.x-ae.x)-ge*(U.y-ae.y);if(Ie===0)return!0;if(Ie<0)continue;ie=!ie}}else{if(U.y!==ae.y)continue;if(ce.x<=U.x&&U.x<=ae.x||ae.x<=U.x&&U.x<=ce.x)return!0}}return ie}const I=ShapeUtils.isClockWise,f=this.subPaths;if(f.length===0)return[];let y,B,_;const Z=[];if(f.length===1)return B=f[0],_=new Shape$2,_.curves=B.curves,Z.push(_),Z;let M=!I(f[0].getPoints());M=n?!M:M;const V=[],T=[];let H=[],F=0,O;T[F]=void 0,H[F]=[];for(let U=0,ee=f.length;U<ee;U++)B=f[U],O=B.getPoints(),y=I(O),y=n?!y:y,y?(!M&&T[F]&&F++,T[F]={s:new Shape$2,p:O},T[F].s.curves=B.curves,M&&F++,H[F]=[]):H[F].push({h:B,p:O[0]});if(!T[0])return d(f);if(T.length>1){let U=!1,ee=0;for(let Q=0,ie=T.length;Q<ie;Q++)V[Q]=[];for(let Q=0,ie=T.length;Q<ie;Q++){const ne=H[Q];for(let le=0;le<ne.length;le++){const ae=ne[le];let ce=!0;for(let ge=0;ge<T.length;ge++)C(ae.p,T[ge].p)&&(Q!==ge&&ee++,ce?(ce=!1,V[ge].push(ae)):U=!0);ce&&V[Q].push(ae)}}ee>0&&U===!1&&(H=V)}let $;for(let U=0,ee=T.length;U<ee;U++){_=T[U].s,Z.push(_),$=H[U];for(let Q=0,ie=$.length;Q<ie;Q++)_.holes.push($[Q].h)}return Z}}class Controls extends EventDispatcher$1{constructor(n,d=null){super(),this.object=n,this.domElement=d,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function contain(u,n){const d=u.image&&u.image.width?u.image.width/u.image.height:1;return d>n?(u.repeat.x=1,u.repeat.y=d/n,u.offset.x=0,u.offset.y=(1-u.repeat.y)/2):(u.repeat.x=n/d,u.repeat.y=1,u.offset.x=(1-u.repeat.x)/2,u.offset.y=0),u}function cover(u,n){const d=u.image&&u.image.width?u.image.width/u.image.height:1;return d>n?(u.repeat.x=n/d,u.repeat.y=1,u.offset.x=(1-u.repeat.x)/2,u.offset.y=0):(u.repeat.x=1,u.repeat.y=d/n,u.offset.x=0,u.offset.y=(1-u.repeat.y)/2),u}function fill(u){return u.repeat.x=1,u.repeat.y=1,u.offset.x=0,u.offset.y=0,u}function getByteLength(u,n,d,C){const I=getTextureTypeByteLength(C);switch(d){case AlphaFormat:return u*n;case LuminanceFormat:return u*n;case LuminanceAlphaFormat:return u*n*2;case RedFormat:return u*n/I.components*I.byteLength;case RedIntegerFormat:return u*n/I.components*I.byteLength;case RGFormat:return u*n*2/I.components*I.byteLength;case RGIntegerFormat:return u*n*2/I.components*I.byteLength;case RGBFormat:return u*n*3/I.components*I.byteLength;case RGBAFormat:return u*n*4/I.components*I.byteLength;case RGBAIntegerFormat:return u*n*4/I.components*I.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((u+3)/4)*Math.floor((n+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((u+3)/4)*Math.floor((n+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(u,16)*Math.max(n,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(u,8)*Math.max(n,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((u+3)/4)*Math.floor((n+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((u+3)/4)*Math.floor((n+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((u+3)/4)*Math.floor((n+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((u+4)/5)*Math.floor((n+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((u+4)/5)*Math.floor((n+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((u+5)/6)*Math.floor((n+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((u+5)/6)*Math.floor((n+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((u+7)/8)*Math.floor((n+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((u+7)/8)*Math.floor((n+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((u+7)/8)*Math.floor((n+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((u+9)/10)*Math.floor((n+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((u+9)/10)*Math.floor((n+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((u+9)/10)*Math.floor((n+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((u+9)/10)*Math.floor((n+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((u+11)/12)*Math.floor((n+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((u+11)/12)*Math.floor((n+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(u/4)*Math.ceil(n/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(u/4)*Math.ceil(n/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(u/4)*Math.ceil(n/4)*16}throw new Error(`Unable to determine texture byte length for ${d} format.`)}function getTextureTypeByteLength(u){switch(u){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${u}.`)}class TextureUtils{static contain(n,d){return contain(n,d)}static cover(n,d){return cover(n,d)}static fill(n){return fill(n)}static getByteLength(n,d,C,I){return getByteLength(n,d,C,I)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function WebGLAnimation(){let u=null,n=!1,d=null,C=null;function I(f,y){d(f,y),C=u.requestAnimationFrame(I)}return{start:function(){n!==!0&&d!==null&&(C=u.requestAnimationFrame(I),n=!0)},stop:function(){u.cancelAnimationFrame(C),n=!1},setAnimationLoop:function(f){d=f},setContext:function(f){u=f}}}function WebGLAttributes(u){const n=new WeakMap;function d(B,_){const Z=B.array,M=B.usage,V=Z.byteLength,T=u.createBuffer();u.bindBuffer(_,T),u.bufferData(_,Z,M),B.onUploadCallback();let H;if(Z instanceof Float32Array)H=u.FLOAT;else if(Z instanceof Uint16Array)B.isFloat16BufferAttribute?H=u.HALF_FLOAT:H=u.UNSIGNED_SHORT;else if(Z instanceof Int16Array)H=u.SHORT;else if(Z instanceof Uint32Array)H=u.UNSIGNED_INT;else if(Z instanceof Int32Array)H=u.INT;else if(Z instanceof Int8Array)H=u.BYTE;else if(Z instanceof Uint8Array)H=u.UNSIGNED_BYTE;else if(Z instanceof Uint8ClampedArray)H=u.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Z);return{buffer:T,type:H,bytesPerElement:Z.BYTES_PER_ELEMENT,version:B.version,size:V}}function C(B,_,Z){const M=_.array,V=_.updateRanges;if(u.bindBuffer(Z,B),V.length===0)u.bufferSubData(Z,0,M);else{V.sort((H,F)=>H.start-F.start);let T=0;for(let H=1;H<V.length;H++){const F=V[T],O=V[H];O.start<=F.start+F.count+1?F.count=Math.max(F.count,O.start+O.count-F.start):(++T,V[T]=O)}V.length=T+1;for(let H=0,F=V.length;H<F;H++){const O=V[H];u.bufferSubData(Z,O.start*M.BYTES_PER_ELEMENT,M,O.start,O.count)}_.clearUpdateRanges()}_.onUploadCallback()}function I(B){return B.isInterleavedBufferAttribute&&(B=B.data),n.get(B)}function f(B){B.isInterleavedBufferAttribute&&(B=B.data);const _=n.get(B);_&&(u.deleteBuffer(_.buffer),n.delete(B))}function y(B,_){if(B.isInterleavedBufferAttribute&&(B=B.data),B.isGLBufferAttribute){const M=n.get(B);(!M||M.version<B.version)&&n.set(B,{buffer:B.buffer,type:B.type,bytesPerElement:B.elementSize,version:B.version});return}const Z=n.get(B);if(Z===void 0)n.set(B,d(B,_));else if(Z.version<B.version){if(Z.size!==B.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");C(Z.buffer,B,_),Z.version=B.version}}return{get:I,remove:f,update:y}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(u,n,d,C,I,f,y){const B=new Color(0);let _=f===!0?0:1,Z,M,V=null,T=0,H=null;function F(Q){let ie=Q.isScene===!0?Q.background:null;return ie&&ie.isTexture&&(ie=(Q.backgroundBlurriness>0?d:n).get(ie)),ie}function O(Q){let ie=!1;const ne=F(Q);ne===null?U(B,_):ne&&ne.isColor&&(U(ne,1),ie=!0);const le=u.xr.getEnvironmentBlendMode();le==="additive"?C.buffers.color.setClear(0,0,0,1,y):le==="alpha-blend"&&C.buffers.color.setClear(0,0,0,0,y),(u.autoClear||ie)&&(C.buffers.depth.setTest(!0),C.buffers.depth.setMask(!0),C.buffers.color.setMask(!0),u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil))}function $(Q,ie){const ne=F(ie);ne&&(ne.isCubeTexture||ne.mapping===CubeUVReflectionMapping)?(M===void 0&&(M=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),M.geometry.deleteAttribute("normal"),M.geometry.deleteAttribute("uv"),M.onBeforeRender=function(le,ae,ce){this.matrixWorld.copyPosition(ce.matrixWorld)},Object.defineProperty(M.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),I.update(M)),_e1$1.copy(ie.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,ne.isCubeTexture&&ne.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),M.material.uniforms.envMap.value=ne,M.material.uniforms.flipEnvMap.value=ne.isCubeTexture&&ne.isRenderTargetTexture===!1?-1:1,M.material.uniforms.backgroundBlurriness.value=ie.backgroundBlurriness,M.material.uniforms.backgroundIntensity.value=ie.backgroundIntensity,M.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),M.material.toneMapped=ColorManagement.getTransfer(ne.colorSpace)!==SRGBTransfer,(V!==ne||T!==ne.version||H!==u.toneMapping)&&(M.material.needsUpdate=!0,V=ne,T=ne.version,H=u.toneMapping),M.layers.enableAll(),Q.unshift(M,M.geometry,M.material,0,0,null)):ne&&ne.isTexture&&(Z===void 0&&(Z=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),Z.geometry.deleteAttribute("normal"),Object.defineProperty(Z.material,"map",{get:function(){return this.uniforms.t2D.value}}),I.update(Z)),Z.material.uniforms.t2D.value=ne,Z.material.uniforms.backgroundIntensity.value=ie.backgroundIntensity,Z.material.toneMapped=ColorManagement.getTransfer(ne.colorSpace)!==SRGBTransfer,ne.matrixAutoUpdate===!0&&ne.updateMatrix(),Z.material.uniforms.uvTransform.value.copy(ne.matrix),(V!==ne||T!==ne.version||H!==u.toneMapping)&&(Z.material.needsUpdate=!0,V=ne,T=ne.version,H=u.toneMapping),Z.layers.enableAll(),Q.unshift(Z,Z.geometry,Z.material,0,0,null))}function U(Q,ie){Q.getRGB(_rgb,getUnlitUniformColorSpace(u)),C.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,ie,y)}function ee(){M!==void 0&&(M.geometry.dispose(),M.material.dispose(),M=void 0),Z!==void 0&&(Z.geometry.dispose(),Z.material.dispose(),Z=void 0)}return{getClearColor:function(){return B},setClearColor:function(Q,ie=1){B.set(Q),_=ie,U(B,_)},getClearAlpha:function(){return _},setClearAlpha:function(Q){_=Q,U(B,_)},render:O,addToRenderList:$,dispose:ee}}function WebGLBindingStates(u,n){const d=u.getParameter(u.MAX_VERTEX_ATTRIBS),C={},I=T(null);let f=I,y=!1;function B(he,Ie,fe,me,Ge){let Ze=!1;const ye=V(me,fe,Ie);f!==ye&&(f=ye,Z(f.object)),Ze=H(he,me,fe,Ge),Ze&&F(he,me,fe,Ge),Ge!==null&&n.update(Ge,u.ELEMENT_ARRAY_BUFFER),(Ze||y)&&(y=!1,ie(he,Ie,fe,me),Ge!==null&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n.get(Ge).buffer))}function _(){return u.createVertexArray()}function Z(he){return u.bindVertexArray(he)}function M(he){return u.deleteVertexArray(he)}function V(he,Ie,fe){const me=fe.wireframe===!0;let Ge=C[he.id];Ge===void 0&&(Ge={},C[he.id]=Ge);let Ze=Ge[Ie.id];Ze===void 0&&(Ze={},Ge[Ie.id]=Ze);let ye=Ze[me];return ye===void 0&&(ye=T(_()),Ze[me]=ye),ye}function T(he){const Ie=[],fe=[],me=[];for(let Ge=0;Ge<d;Ge++)Ie[Ge]=0,fe[Ge]=0,me[Ge]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ie,enabledAttributes:fe,attributeDivisors:me,object:he,attributes:{},index:null}}function H(he,Ie,fe,me){const Ge=f.attributes,Ze=Ie.attributes;let ye=0;const Ee=fe.getAttributes();for(const Ve in Ee)if(Ee[Ve].location>=0){const be=Ge[Ve];let Be=Ze[Ve];if(Be===void 0&&(Ve==="instanceMatrix"&&he.instanceMatrix&&(Be=he.instanceMatrix),Ve==="instanceColor"&&he.instanceColor&&(Be=he.instanceColor)),be===void 0||be.attribute!==Be||Be&&be.data!==Be.data)return!0;ye++}return f.attributesNum!==ye||f.index!==me}function F(he,Ie,fe,me){const Ge={},Ze=Ie.attributes;let ye=0;const Ee=fe.getAttributes();for(const Ve in Ee)if(Ee[Ve].location>=0){let be=Ze[Ve];be===void 0&&(Ve==="instanceMatrix"&&he.instanceMatrix&&(be=he.instanceMatrix),Ve==="instanceColor"&&he.instanceColor&&(be=he.instanceColor));const Be={};Be.attribute=be,be&&be.data&&(Be.data=be.data),Ge[Ve]=Be,ye++}f.attributes=Ge,f.attributesNum=ye,f.index=me}function O(){const he=f.newAttributes;for(let Ie=0,fe=he.length;Ie<fe;Ie++)he[Ie]=0}function $(he){U(he,0)}function U(he,Ie){const fe=f.newAttributes,me=f.enabledAttributes,Ge=f.attributeDivisors;fe[he]=1,me[he]===0&&(u.enableVertexAttribArray(he),me[he]=1),Ge[he]!==Ie&&(u.vertexAttribDivisor(he,Ie),Ge[he]=Ie)}function ee(){const he=f.newAttributes,Ie=f.enabledAttributes;for(let fe=0,me=Ie.length;fe<me;fe++)Ie[fe]!==he[fe]&&(u.disableVertexAttribArray(fe),Ie[fe]=0)}function Q(he,Ie,fe,me,Ge,Ze,ye){ye===!0?u.vertexAttribIPointer(he,Ie,fe,Ge,Ze):u.vertexAttribPointer(he,Ie,fe,me,Ge,Ze)}function ie(he,Ie,fe,me){O();const Ge=me.attributes,Ze=fe.getAttributes(),ye=Ie.defaultAttributeValues;for(const Ee in Ze){const Ve=Ze[Ee];if(Ve.location>=0){let Ye=Ge[Ee];if(Ye===void 0&&(Ee==="instanceMatrix"&&he.instanceMatrix&&(Ye=he.instanceMatrix),Ee==="instanceColor"&&he.instanceColor&&(Ye=he.instanceColor)),Ye!==void 0){const be=Ye.normalized,Be=Ye.itemSize,Ne=n.get(Ye);if(Ne===void 0)continue;const Ae=Ne.buffer,Re=Ne.type,We=Ne.bytesPerElement,De=Re===u.INT||Re===u.UNSIGNED_INT||Ye.gpuType===IntType;if(Ye.isInterleavedBufferAttribute){const Fe=Ye.data,Ke=Fe.stride,Rt=Ye.offset;if(Fe.isInstancedInterleavedBuffer){for(let dt=0;dt<Ve.locationSize;dt++)U(Ve.location+dt,Fe.meshPerAttribute);he.isInstancedMesh!==!0&&me._maxInstanceCount===void 0&&(me._maxInstanceCount=Fe.meshPerAttribute*Fe.count)}else for(let dt=0;dt<Ve.locationSize;dt++)$(Ve.location+dt);u.bindBuffer(u.ARRAY_BUFFER,Ae);for(let dt=0;dt<Ve.locationSize;dt++)Q(Ve.location+dt,Be/Ve.locationSize,Re,be,Ke*We,(Rt+Be/Ve.locationSize*dt)*We,De)}else{if(Ye.isInstancedBufferAttribute){for(let Fe=0;Fe<Ve.locationSize;Fe++)U(Ve.location+Fe,Ye.meshPerAttribute);he.isInstancedMesh!==!0&&me._maxInstanceCount===void 0&&(me._maxInstanceCount=Ye.meshPerAttribute*Ye.count)}else for(let Fe=0;Fe<Ve.locationSize;Fe++)$(Ve.location+Fe);u.bindBuffer(u.ARRAY_BUFFER,Ae);for(let Fe=0;Fe<Ve.locationSize;Fe++)Q(Ve.location+Fe,Be/Ve.locationSize,Re,be,Be*We,Be/Ve.locationSize*Fe*We,De)}}else if(ye!==void 0){const be=ye[Ee];if(be!==void 0)switch(be.length){case 2:u.vertexAttrib2fv(Ve.location,be);break;case 3:u.vertexAttrib3fv(Ve.location,be);break;case 4:u.vertexAttrib4fv(Ve.location,be);break;default:u.vertexAttrib1fv(Ve.location,be)}}}}ee()}function ne(){ce();for(const he in C){const Ie=C[he];for(const fe in Ie){const me=Ie[fe];for(const Ge in me)M(me[Ge].object),delete me[Ge];delete Ie[fe]}delete C[he]}}function le(he){if(C[he.id]===void 0)return;const Ie=C[he.id];for(const fe in Ie){const me=Ie[fe];for(const Ge in me)M(me[Ge].object),delete me[Ge];delete Ie[fe]}delete C[he.id]}function ae(he){for(const Ie in C){const fe=C[Ie];if(fe[he.id]===void 0)continue;const me=fe[he.id];for(const Ge in me)M(me[Ge].object),delete me[Ge];delete fe[he.id]}}function ce(){ge(),y=!0,f!==I&&(f=I,Z(f.object))}function ge(){I.geometry=null,I.program=null,I.wireframe=!1}return{setup:B,reset:ce,resetDefaultState:ge,dispose:ne,releaseStatesOfGeometry:le,releaseStatesOfProgram:ae,initAttributes:O,enableAttribute:$,disableUnusedAttributes:ee}}function WebGLBufferRenderer(u,n,d){let C;function I(Z){C=Z}function f(Z,M){u.drawArrays(C,Z,M),d.update(M,C,1)}function y(Z,M,V){V!==0&&(u.drawArraysInstanced(C,Z,M,V),d.update(M,C,V))}function B(Z,M,V){if(V===0)return;n.get("WEBGL_multi_draw").multiDrawArraysWEBGL(C,Z,0,M,0,V);let H=0;for(let F=0;F<V;F++)H+=M[F];d.update(H,C,1)}function _(Z,M,V,T){if(V===0)return;const H=n.get("WEBGL_multi_draw");if(H===null)for(let F=0;F<Z.length;F++)y(Z[F],M[F],T[F]);else{H.multiDrawArraysInstancedWEBGL(C,Z,0,M,0,T,0,V);let F=0;for(let O=0;O<V;O++)F+=M[O]*T[O];d.update(F,C,1)}}this.setMode=I,this.render=f,this.renderInstances=y,this.renderMultiDraw=B,this.renderMultiDrawInstances=_}function WebGLCapabilities(u,n,d,C){let I;function f(){if(I!==void 0)return I;if(n.has("EXT_texture_filter_anisotropic")===!0){const ae=n.get("EXT_texture_filter_anisotropic");I=u.getParameter(ae.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else I=0;return I}function y(ae){return!(ae!==RGBAFormat&&C.convert(ae)!==u.getParameter(u.IMPLEMENTATION_COLOR_READ_FORMAT))}function B(ae){const ce=ae===HalfFloatType&&(n.has("EXT_color_buffer_half_float")||n.has("EXT_color_buffer_float"));return!(ae!==UnsignedByteType&&C.convert(ae)!==u.getParameter(u.IMPLEMENTATION_COLOR_READ_TYPE)&&ae!==FloatType&&!ce)}function _(ae){if(ae==="highp"){if(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision>0)return"highp";ae="mediump"}return ae==="mediump"&&u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let Z=d.precision!==void 0?d.precision:"highp";const M=_(Z);M!==Z&&(console.warn("THREE.WebGLRenderer:",Z,"not supported, using",M,"instead."),Z=M);const V=d.logarithmicDepthBuffer===!0,T=d.reverseDepthBuffer===!0&&n.has("EXT_clip_control"),H=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),F=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),O=u.getParameter(u.MAX_TEXTURE_SIZE),$=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),U=u.getParameter(u.MAX_VERTEX_ATTRIBS),ee=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),Q=u.getParameter(u.MAX_VARYING_VECTORS),ie=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),ne=F>0,le=u.getParameter(u.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:f,getMaxPrecision:_,textureFormatReadable:y,textureTypeReadable:B,precision:Z,logarithmicDepthBuffer:V,reverseDepthBuffer:T,maxTextures:H,maxVertexTextures:F,maxTextureSize:O,maxCubemapSize:$,maxAttributes:U,maxVertexUniforms:ee,maxVaryings:Q,maxFragmentUniforms:ie,vertexTextures:ne,maxSamples:le}}function WebGLClipping(u){const n=this;let d=null,C=0,I=!1,f=!1;const y=new Plane,B=new Matrix3,_={value:null,needsUpdate:!1};this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(V,T){const H=V.length!==0||T||C!==0||I;return I=T,C=V.length,H},this.beginShadows=function(){f=!0,M(null)},this.endShadows=function(){f=!1},this.setGlobalState=function(V,T){d=M(V,T,0)},this.setState=function(V,T,H){const F=V.clippingPlanes,O=V.clipIntersection,$=V.clipShadows,U=u.get(V);if(!I||F===null||F.length===0||f&&!$)f?M(null):Z();else{const ee=f?0:C,Q=ee*4;let ie=U.clippingState||null;_.value=ie,ie=M(F,T,Q,H);for(let ne=0;ne!==Q;++ne)ie[ne]=d[ne];U.clippingState=ie,this.numIntersection=O?this.numPlanes:0,this.numPlanes+=ee}};function Z(){_.value!==d&&(_.value=d,_.needsUpdate=C>0),n.numPlanes=C,n.numIntersection=0}function M(V,T,H,F){const O=V!==null?V.length:0;let $=null;if(O!==0){if($=_.value,F!==!0||$===null){const U=H+O*4,ee=T.matrixWorldInverse;B.getNormalMatrix(ee),($===null||$.length<U)&&($=new Float32Array(U));for(let Q=0,ie=H;Q!==O;++Q,ie+=4)y.copy(V[Q]).applyMatrix4(ee,B),y.normal.toArray($,ie),$[ie+3]=y.constant}_.value=$,_.needsUpdate=!0}return n.numPlanes=O,n.numIntersection=0,$}}function WebGLCubeMaps(u){let n=new WeakMap;function d(y,B){return B===EquirectangularReflectionMapping?y.mapping=CubeReflectionMapping:B===EquirectangularRefractionMapping&&(y.mapping=CubeRefractionMapping),y}function C(y){if(y&&y.isTexture){const B=y.mapping;if(B===EquirectangularReflectionMapping||B===EquirectangularRefractionMapping)if(n.has(y)){const _=n.get(y).texture;return d(_,y.mapping)}else{const _=y.image;if(_&&_.height>0){const Z=new WebGLCubeRenderTarget(_.height);return Z.fromEquirectangularTexture(u,y),n.set(y,Z),y.addEventListener("dispose",I),d(Z.texture,y.mapping)}else return null}}return y}function I(y){const B=y.target;B.removeEventListener("dispose",I);const _=n.get(B);_!==void 0&&(n.delete(B),_.dispose())}function f(){n=new WeakMap}return{get:C,dispose:f}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1)],_origin=new Vector3;class PMREMGenerator{constructor(n){this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(n,d=0,C=.1,I=100,f={}){const{size:y=256,position:B=_origin}=f;_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(y);const _=this._allocateTargets();return _.depthBuffer=!0,this._sceneToCubeUV(n,C,I,_,B),d>0&&this._blur(_,0,0,d),this._applyPMREM(_),this._cleanup(_),_}fromEquirectangular(n,d=null){return this._fromTexture(n,d)}fromCubemap(n,d=null){return this._fromTexture(n,d)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(n){this._lodMax=Math.floor(Math.log2(n)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let n=0;n<this._lodPlanes.length;n++)this._lodPlanes[n].dispose()}_cleanup(n){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,n.scissorTest=!1,_setViewport(n,0,0,n.width,n.height)}_fromTexture(n,d){n.mapping===CubeReflectionMapping||n.mapping===CubeRefractionMapping?this._setSize(n.image.length===0?16:n.image[0].width||n.image[0].image.width):this._setSize(n.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const C=d||this._allocateTargets();return this._textureToCubeUV(n,C),this._applyPMREM(C),this._cleanup(C),C}_allocateTargets(){const n=3*Math.max(this._cubeSize,112),d=4*this._cubeSize,C={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},I=_createRenderTarget(n,d,C);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==n||this._pingPongRenderTarget.height!==d){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(n,d,C);const{_lodMax:f}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(f)),this._blurMaterial=_getBlurShader(f,n,d)}return I}_compileMaterial(n){const d=new Mesh(this._lodPlanes[0],n);this._renderer.compile(d,_flatCamera)}_sceneToCubeUV(n,d,C,I,f){const _=new PerspectiveCamera(90,1,d,C),Z=[1,-1,1,1,1,1],M=[1,1,1,-1,-1,-1],V=this._renderer,T=V.autoClear,H=V.toneMapping;V.getClearColor(_clearColor),V.toneMapping=NoToneMapping,V.autoClear=!1;const F=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),O=new Mesh(new BoxGeometry,F);let $=!1;const U=n.background;U?U.isColor&&(F.color.copy(U),n.background=null,$=!0):(F.color.copy(_clearColor),$=!0);for(let ee=0;ee<6;ee++){const Q=ee%3;Q===0?(_.up.set(0,Z[ee],0),_.position.set(f.x,f.y,f.z),_.lookAt(f.x+M[ee],f.y,f.z)):Q===1?(_.up.set(0,0,Z[ee]),_.position.set(f.x,f.y,f.z),_.lookAt(f.x,f.y+M[ee],f.z)):(_.up.set(0,Z[ee],0),_.position.set(f.x,f.y,f.z),_.lookAt(f.x,f.y,f.z+M[ee]));const ie=this._cubeSize;_setViewport(I,Q*ie,ee>2?ie:0,ie,ie),V.setRenderTarget(I),$&&V.render(O,_),V.render(n,_)}O.geometry.dispose(),O.material.dispose(),V.toneMapping=H,V.autoClear=T,n.background=U}_textureToCubeUV(n,d){const C=this._renderer,I=n.mapping===CubeReflectionMapping||n.mapping===CubeRefractionMapping;I?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=n.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const f=I?this._cubemapMaterial:this._equirectMaterial,y=new Mesh(this._lodPlanes[0],f),B=f.uniforms;B.envMap.value=n;const _=this._cubeSize;_setViewport(d,0,0,3*_,2*_),C.setRenderTarget(d),C.render(y,_flatCamera)}_applyPMREM(n){const d=this._renderer,C=d.autoClear;d.autoClear=!1;const I=this._lodPlanes.length;for(let f=1;f<I;f++){const y=Math.sqrt(this._sigmas[f]*this._sigmas[f]-this._sigmas[f-1]*this._sigmas[f-1]),B=_axisDirections[(I-f-1)%_axisDirections.length];this._blur(n,f-1,f,y,B)}d.autoClear=C}_blur(n,d,C,I,f){const y=this._pingPongRenderTarget;this._halfBlur(n,y,d,C,I,"latitudinal",f),this._halfBlur(y,n,C,C,I,"longitudinal",f)}_halfBlur(n,d,C,I,f,y,B){const _=this._renderer,Z=this._blurMaterial;y!=="latitudinal"&&y!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const M=3,V=new Mesh(this._lodPlanes[I],Z),T=Z.uniforms,H=this._sizeLods[C]-1,F=isFinite(f)?Math.PI/(2*H):2*Math.PI/(2*MAX_SAMPLES-1),O=f/F,$=isFinite(f)?1+Math.floor(M*O):MAX_SAMPLES;$>MAX_SAMPLES&&console.warn(`sigmaRadians, ${f}, is too large and will clip, as it requested ${$} samples when the maximum is set to ${MAX_SAMPLES}`);const U=[];let ee=0;for(let ae=0;ae<MAX_SAMPLES;++ae){const ce=ae/O,ge=Math.exp(-ce*ce/2);U.push(ge),ae===0?ee+=ge:ae<$&&(ee+=2*ge)}for(let ae=0;ae<U.length;ae++)U[ae]=U[ae]/ee;T.envMap.value=n.texture,T.samples.value=$,T.weights.value=U,T.latitudinal.value=y==="latitudinal",B&&(T.poleAxis.value=B);const{_lodMax:Q}=this;T.dTheta.value=F,T.mipInt.value=Q-C;const ie=this._sizeLods[I],ne=3*ie*(I>Q-LOD_MIN?I-Q+LOD_MIN:0),le=4*(this._cubeSize-ie);_setViewport(d,ne,le,3*ie,2*ie),_.setRenderTarget(d),_.render(V,_flatCamera)}}function _createPlanes(u){const n=[],d=[],C=[];let I=u;const f=u-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let y=0;y<f;y++){const B=Math.pow(2,I);d.push(B);let _=1/B;y>u-LOD_MIN?_=EXTRA_LOD_SIGMA[y-u+LOD_MIN-1]:y===0&&(_=0),C.push(_);const Z=1/(B-2),M=-Z,V=1+Z,T=[M,M,V,M,V,V,M,M,V,V,M,V],H=6,F=6,O=3,$=2,U=1,ee=new Float32Array(O*F*H),Q=new Float32Array($*F*H),ie=new Float32Array(U*F*H);for(let le=0;le<H;le++){const ae=le%3*2/3-1,ce=le>2?0:-1,ge=[ae,ce,0,ae+2/3,ce,0,ae+2/3,ce+1,0,ae,ce,0,ae+2/3,ce+1,0,ae,ce+1,0];ee.set(ge,O*F*le),Q.set(T,$*F*le);const he=[le,le,le,le,le,le];ie.set(he,U*F*le)}const ne=new BufferGeometry;ne.setAttribute("position",new BufferAttribute(ee,O)),ne.setAttribute("uv",new BufferAttribute(Q,$)),ne.setAttribute("faceIndex",new BufferAttribute(ie,U)),n.push(ne),I>LOD_MIN&&I--}return{lodPlanes:n,sizeLods:d,sigmas:C}}function _createRenderTarget(u,n,d){const C=new WebGLRenderTarget(u,n,d);return C.texture.mapping=CubeUVReflectionMapping,C.texture.name="PMREM.cubeUv",C.scissorTest=!0,C}function _setViewport(u,n,d,C,I){u.viewport.set(n,d,C,I),u.scissor.set(n,d,C,I)}function _getBlurShader(u,n,d){const C=new Float32Array(MAX_SAMPLES),I=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/n,CUBEUV_TEXEL_HEIGHT:1/d,CUBEUV_MAX_MIP:`${u}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:C},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:I}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(u){let n=new WeakMap,d=null;function C(B){if(B&&B.isTexture){const _=B.mapping,Z=_===EquirectangularReflectionMapping||_===EquirectangularRefractionMapping,M=_===CubeReflectionMapping||_===CubeRefractionMapping;if(Z||M){let V=n.get(B);const T=V!==void 0?V.texture.pmremVersion:0;if(B.isRenderTargetTexture&&B.pmremVersion!==T)return d===null&&(d=new PMREMGenerator(u)),V=Z?d.fromEquirectangular(B,V):d.fromCubemap(B,V),V.texture.pmremVersion=B.pmremVersion,n.set(B,V),V.texture;if(V!==void 0)return V.texture;{const H=B.image;return Z&&H&&H.height>0||M&&H&&I(H)?(d===null&&(d=new PMREMGenerator(u)),V=Z?d.fromEquirectangular(B):d.fromCubemap(B),V.texture.pmremVersion=B.pmremVersion,n.set(B,V),B.addEventListener("dispose",f),V.texture):null}}}return B}function I(B){let _=0;const Z=6;for(let M=0;M<Z;M++)B[M]!==void 0&&_++;return _===Z}function f(B){const _=B.target;_.removeEventListener("dispose",f);const Z=n.get(_);Z!==void 0&&(n.delete(_),Z.dispose())}function y(){n=new WeakMap,d!==null&&(d.dispose(),d=null)}return{get:C,dispose:y}}function WebGLExtensions(u){const n={};function d(C){if(n[C]!==void 0)return n[C];let I;switch(C){case"WEBGL_depth_texture":I=u.getExtension("WEBGL_depth_texture")||u.getExtension("MOZ_WEBGL_depth_texture")||u.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":I=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":I=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":I=u.getExtension("WEBGL_compressed_texture_pvrtc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:I=u.getExtension(C)}return n[C]=I,I}return{has:function(C){return d(C)!==null},init:function(){d("EXT_color_buffer_float"),d("WEBGL_clip_cull_distance"),d("OES_texture_float_linear"),d("EXT_color_buffer_half_float"),d("WEBGL_multisampled_render_to_texture"),d("WEBGL_render_shared_exponent")},get:function(C){const I=d(C);return I===null&&warnOnce("THREE.WebGLRenderer: "+C+" extension not supported."),I}}}function WebGLGeometries(u,n,d,C){const I={},f=new WeakMap;function y(V){const T=V.target;T.index!==null&&n.remove(T.index);for(const F in T.attributes)n.remove(T.attributes[F]);T.removeEventListener("dispose",y),delete I[T.id];const H=f.get(T);H&&(n.remove(H),f.delete(T)),C.releaseStatesOfGeometry(T),T.isInstancedBufferGeometry===!0&&delete T._maxInstanceCount,d.memory.geometries--}function B(V,T){return I[T.id]===!0||(T.addEventListener("dispose",y),I[T.id]=!0,d.memory.geometries++),T}function _(V){const T=V.attributes;for(const H in T)n.update(T[H],u.ARRAY_BUFFER)}function Z(V){const T=[],H=V.index,F=V.attributes.position;let O=0;if(H!==null){const ee=H.array;O=H.version;for(let Q=0,ie=ee.length;Q<ie;Q+=3){const ne=ee[Q+0],le=ee[Q+1],ae=ee[Q+2];T.push(ne,le,le,ae,ae,ne)}}else if(F!==void 0){const ee=F.array;O=F.version;for(let Q=0,ie=ee.length/3-1;Q<ie;Q+=3){const ne=Q+0,le=Q+1,ae=Q+2;T.push(ne,le,le,ae,ae,ne)}}else return;const $=new(arrayNeedsUint32(T)?Uint32BufferAttribute:Uint16BufferAttribute)(T,1);$.version=O;const U=f.get(V);U&&n.remove(U),f.set(V,$)}function M(V){const T=f.get(V);if(T){const H=V.index;H!==null&&T.version<H.version&&Z(V)}else Z(V);return f.get(V)}return{get:B,update:_,getWireframeAttribute:M}}function WebGLIndexedBufferRenderer(u,n,d){let C;function I(T){C=T}let f,y;function B(T){f=T.type,y=T.bytesPerElement}function _(T,H){u.drawElements(C,H,f,T*y),d.update(H,C,1)}function Z(T,H,F){F!==0&&(u.drawElementsInstanced(C,H,f,T*y,F),d.update(H,C,F))}function M(T,H,F){if(F===0)return;n.get("WEBGL_multi_draw").multiDrawElementsWEBGL(C,H,0,f,T,0,F);let $=0;for(let U=0;U<F;U++)$+=H[U];d.update($,C,1)}function V(T,H,F,O){if(F===0)return;const $=n.get("WEBGL_multi_draw");if($===null)for(let U=0;U<T.length;U++)Z(T[U]/y,H[U],O[U]);else{$.multiDrawElementsInstancedWEBGL(C,H,0,f,T,0,O,0,F);let U=0;for(let ee=0;ee<F;ee++)U+=H[ee]*O[ee];d.update(U,C,1)}}this.setMode=I,this.setIndex=B,this.render=_,this.renderInstances=Z,this.renderMultiDraw=M,this.renderMultiDrawInstances=V}function WebGLInfo(u){const n={geometries:0,textures:0},d={frame:0,calls:0,triangles:0,points:0,lines:0};function C(f,y,B){switch(d.calls++,y){case u.TRIANGLES:d.triangles+=B*(f/3);break;case u.LINES:d.lines+=B*(f/2);break;case u.LINE_STRIP:d.lines+=B*(f-1);break;case u.LINE_LOOP:d.lines+=B*f;break;case u.POINTS:d.points+=B*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",y);break}}function I(){d.calls=0,d.triangles=0,d.points=0,d.lines=0}return{memory:n,render:d,programs:null,autoReset:!0,reset:I,update:C}}function WebGLMorphtargets(u,n,d){const C=new WeakMap,I=new Vector4;function f(y,B,_){const Z=y.morphTargetInfluences,M=B.morphAttributes.position||B.morphAttributes.normal||B.morphAttributes.color,V=M!==void 0?M.length:0;let T=C.get(B);if(T===void 0||T.count!==V){let he=function(){ce.dispose(),C.delete(B),B.removeEventListener("dispose",he)};var H=he;T!==void 0&&T.texture.dispose();const F=B.morphAttributes.position!==void 0,O=B.morphAttributes.normal!==void 0,$=B.morphAttributes.color!==void 0,U=B.morphAttributes.position||[],ee=B.morphAttributes.normal||[],Q=B.morphAttributes.color||[];let ie=0;F===!0&&(ie=1),O===!0&&(ie=2),$===!0&&(ie=3);let ne=B.attributes.position.count*ie,le=1;ne>n.maxTextureSize&&(le=Math.ceil(ne/n.maxTextureSize),ne=n.maxTextureSize);const ae=new Float32Array(ne*le*4*V),ce=new DataArrayTexture(ae,ne,le,V);ce.type=FloatType,ce.needsUpdate=!0;const ge=ie*4;for(let Ie=0;Ie<V;Ie++){const fe=U[Ie],me=ee[Ie],Ge=Q[Ie],Ze=ne*le*4*Ie;for(let ye=0;ye<fe.count;ye++){const Ee=ye*ge;F===!0&&(I.fromBufferAttribute(fe,ye),ae[Ze+Ee+0]=I.x,ae[Ze+Ee+1]=I.y,ae[Ze+Ee+2]=I.z,ae[Ze+Ee+3]=0),O===!0&&(I.fromBufferAttribute(me,ye),ae[Ze+Ee+4]=I.x,ae[Ze+Ee+5]=I.y,ae[Ze+Ee+6]=I.z,ae[Ze+Ee+7]=0),$===!0&&(I.fromBufferAttribute(Ge,ye),ae[Ze+Ee+8]=I.x,ae[Ze+Ee+9]=I.y,ae[Ze+Ee+10]=I.z,ae[Ze+Ee+11]=Ge.itemSize===4?I.w:1)}}T={count:V,texture:ce,size:new Vector2(ne,le)},C.set(B,T),B.addEventListener("dispose",he)}if(y.isInstancedMesh===!0&&y.morphTexture!==null)_.getUniforms().setValue(u,"morphTexture",y.morphTexture,d);else{let F=0;for(let $=0;$<Z.length;$++)F+=Z[$];const O=B.morphTargetsRelative?1:1-F;_.getUniforms().setValue(u,"morphTargetBaseInfluence",O),_.getUniforms().setValue(u,"morphTargetInfluences",Z)}_.getUniforms().setValue(u,"morphTargetsTexture",T.texture,d),_.getUniforms().setValue(u,"morphTargetsTextureSize",T.size)}return{update:f}}function WebGLObjects(u,n,d,C){let I=new WeakMap;function f(_){const Z=C.render.frame,M=_.geometry,V=n.get(_,M);if(I.get(V)!==Z&&(n.update(V),I.set(V,Z)),_.isInstancedMesh&&(_.hasEventListener("dispose",B)===!1&&_.addEventListener("dispose",B),I.get(_)!==Z&&(d.update(_.instanceMatrix,u.ARRAY_BUFFER),_.instanceColor!==null&&d.update(_.instanceColor,u.ARRAY_BUFFER),I.set(_,Z))),_.isSkinnedMesh){const T=_.skeleton;I.get(T)!==Z&&(T.update(),I.set(T,Z))}return V}function y(){I=new WeakMap}function B(_){const Z=_.target;Z.removeEventListener("dispose",B),d.remove(Z.instanceMatrix),Z.instanceColor!==null&&d.remove(Z.instanceColor)}return{update:f,dispose:y}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(u,n,d){const C=u[0];if(C<=0||C>0)return u;const I=n*d;let f=arrayCacheF32[I];if(f===void 0&&(f=new Float32Array(I),arrayCacheF32[I]=f),n!==0){C.toArray(f,0);for(let y=1,B=0;y!==n;++y)B+=d,u[y].toArray(f,B)}return f}function arraysEqual(u,n){if(u.length!==n.length)return!1;for(let d=0,C=u.length;d<C;d++)if(u[d]!==n[d])return!1;return!0}function copyArray(u,n){for(let d=0,C=n.length;d<C;d++)u[d]=n[d]}function allocTexUnits(u,n){let d=arrayCacheI32[n];d===void 0&&(d=new Int32Array(n),arrayCacheI32[n]=d);for(let C=0;C!==n;++C)d[C]=u.allocateTextureUnit();return d}function setValueV1f(u,n){const d=this.cache;d[0]!==n&&(u.uniform1f(this.addr,n),d[0]=n)}function setValueV2f(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y)&&(u.uniform2f(this.addr,n.x,n.y),d[0]=n.x,d[1]=n.y);else{if(arraysEqual(d,n))return;u.uniform2fv(this.addr,n),copyArray(d,n)}}function setValueV3f(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z)&&(u.uniform3f(this.addr,n.x,n.y,n.z),d[0]=n.x,d[1]=n.y,d[2]=n.z);else if(n.r!==void 0)(d[0]!==n.r||d[1]!==n.g||d[2]!==n.b)&&(u.uniform3f(this.addr,n.r,n.g,n.b),d[0]=n.r,d[1]=n.g,d[2]=n.b);else{if(arraysEqual(d,n))return;u.uniform3fv(this.addr,n),copyArray(d,n)}}function setValueV4f(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z||d[3]!==n.w)&&(u.uniform4f(this.addr,n.x,n.y,n.z,n.w),d[0]=n.x,d[1]=n.y,d[2]=n.z,d[3]=n.w);else{if(arraysEqual(d,n))return;u.uniform4fv(this.addr,n),copyArray(d,n)}}function setValueM2(u,n){const d=this.cache,C=n.elements;if(C===void 0){if(arraysEqual(d,n))return;u.uniformMatrix2fv(this.addr,!1,n),copyArray(d,n)}else{if(arraysEqual(d,C))return;mat2array.set(C),u.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(d,C)}}function setValueM3(u,n){const d=this.cache,C=n.elements;if(C===void 0){if(arraysEqual(d,n))return;u.uniformMatrix3fv(this.addr,!1,n),copyArray(d,n)}else{if(arraysEqual(d,C))return;mat3array.set(C),u.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(d,C)}}function setValueM4(u,n){const d=this.cache,C=n.elements;if(C===void 0){if(arraysEqual(d,n))return;u.uniformMatrix4fv(this.addr,!1,n),copyArray(d,n)}else{if(arraysEqual(d,C))return;mat4array.set(C),u.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(d,C)}}function setValueV1i(u,n){const d=this.cache;d[0]!==n&&(u.uniform1i(this.addr,n),d[0]=n)}function setValueV2i(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y)&&(u.uniform2i(this.addr,n.x,n.y),d[0]=n.x,d[1]=n.y);else{if(arraysEqual(d,n))return;u.uniform2iv(this.addr,n),copyArray(d,n)}}function setValueV3i(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z)&&(u.uniform3i(this.addr,n.x,n.y,n.z),d[0]=n.x,d[1]=n.y,d[2]=n.z);else{if(arraysEqual(d,n))return;u.uniform3iv(this.addr,n),copyArray(d,n)}}function setValueV4i(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z||d[3]!==n.w)&&(u.uniform4i(this.addr,n.x,n.y,n.z,n.w),d[0]=n.x,d[1]=n.y,d[2]=n.z,d[3]=n.w);else{if(arraysEqual(d,n))return;u.uniform4iv(this.addr,n),copyArray(d,n)}}function setValueV1ui(u,n){const d=this.cache;d[0]!==n&&(u.uniform1ui(this.addr,n),d[0]=n)}function setValueV2ui(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y)&&(u.uniform2ui(this.addr,n.x,n.y),d[0]=n.x,d[1]=n.y);else{if(arraysEqual(d,n))return;u.uniform2uiv(this.addr,n),copyArray(d,n)}}function setValueV3ui(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z)&&(u.uniform3ui(this.addr,n.x,n.y,n.z),d[0]=n.x,d[1]=n.y,d[2]=n.z);else{if(arraysEqual(d,n))return;u.uniform3uiv(this.addr,n),copyArray(d,n)}}function setValueV4ui(u,n){const d=this.cache;if(n.x!==void 0)(d[0]!==n.x||d[1]!==n.y||d[2]!==n.z||d[3]!==n.w)&&(u.uniform4ui(this.addr,n.x,n.y,n.z,n.w),d[0]=n.x,d[1]=n.y,d[2]=n.z,d[3]=n.w);else{if(arraysEqual(d,n))return;u.uniform4uiv(this.addr,n),copyArray(d,n)}}function setValueT1(u,n,d){const C=this.cache,I=d.allocateTextureUnit();C[0]!==I&&(u.uniform1i(this.addr,I),C[0]=I);let f;this.type===u.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,f=emptyShadowTexture):f=emptyTexture,d.setTexture2D(n||f,I)}function setValueT3D1(u,n,d){const C=this.cache,I=d.allocateTextureUnit();C[0]!==I&&(u.uniform1i(this.addr,I),C[0]=I),d.setTexture3D(n||empty3dTexture,I)}function setValueT6(u,n,d){const C=this.cache,I=d.allocateTextureUnit();C[0]!==I&&(u.uniform1i(this.addr,I),C[0]=I),d.setTextureCube(n||emptyCubeTexture,I)}function setValueT2DArray1(u,n,d){const C=this.cache,I=d.allocateTextureUnit();C[0]!==I&&(u.uniform1i(this.addr,I),C[0]=I),d.setTexture2DArray(n||emptyArrayTexture,I)}function getSingularSetter(u){switch(u){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(u,n){u.uniform1fv(this.addr,n)}function setValueV2fArray(u,n){const d=flatten(n,this.size,2);u.uniform2fv(this.addr,d)}function setValueV3fArray(u,n){const d=flatten(n,this.size,3);u.uniform3fv(this.addr,d)}function setValueV4fArray(u,n){const d=flatten(n,this.size,4);u.uniform4fv(this.addr,d)}function setValueM2Array(u,n){const d=flatten(n,this.size,4);u.uniformMatrix2fv(this.addr,!1,d)}function setValueM3Array(u,n){const d=flatten(n,this.size,9);u.uniformMatrix3fv(this.addr,!1,d)}function setValueM4Array(u,n){const d=flatten(n,this.size,16);u.uniformMatrix4fv(this.addr,!1,d)}function setValueV1iArray(u,n){u.uniform1iv(this.addr,n)}function setValueV2iArray(u,n){u.uniform2iv(this.addr,n)}function setValueV3iArray(u,n){u.uniform3iv(this.addr,n)}function setValueV4iArray(u,n){u.uniform4iv(this.addr,n)}function setValueV1uiArray(u,n){u.uniform1uiv(this.addr,n)}function setValueV2uiArray(u,n){u.uniform2uiv(this.addr,n)}function setValueV3uiArray(u,n){u.uniform3uiv(this.addr,n)}function setValueV4uiArray(u,n){u.uniform4uiv(this.addr,n)}function setValueT1Array(u,n,d){const C=this.cache,I=n.length,f=allocTexUnits(d,I);arraysEqual(C,f)||(u.uniform1iv(this.addr,f),copyArray(C,f));for(let y=0;y!==I;++y)d.setTexture2D(n[y]||emptyTexture,f[y])}function setValueT3DArray(u,n,d){const C=this.cache,I=n.length,f=allocTexUnits(d,I);arraysEqual(C,f)||(u.uniform1iv(this.addr,f),copyArray(C,f));for(let y=0;y!==I;++y)d.setTexture3D(n[y]||empty3dTexture,f[y])}function setValueT6Array(u,n,d){const C=this.cache,I=n.length,f=allocTexUnits(d,I);arraysEqual(C,f)||(u.uniform1iv(this.addr,f),copyArray(C,f));for(let y=0;y!==I;++y)d.setTextureCube(n[y]||emptyCubeTexture,f[y])}function setValueT2DArrayArray(u,n,d){const C=this.cache,I=n.length,f=allocTexUnits(d,I);arraysEqual(C,f)||(u.uniform1iv(this.addr,f),copyArray(C,f));for(let y=0;y!==I;++y)d.setTexture2DArray(n[y]||emptyArrayTexture,f[y])}function getPureArraySetter(u){switch(u){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(n,d,C){this.id=n,this.addr=C,this.cache=[],this.type=d.type,this.setValue=getSingularSetter(d.type)}}class PureArrayUniform{constructor(n,d,C){this.id=n,this.addr=C,this.cache=[],this.type=d.type,this.size=d.size,this.setValue=getPureArraySetter(d.type)}}class StructuredUniform{constructor(n){this.id=n,this.seq=[],this.map={}}setValue(n,d,C){const I=this.seq;for(let f=0,y=I.length;f!==y;++f){const B=I[f];B.setValue(n,d[B.id],C)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(u,n){u.seq.push(n),u.map[n.id]=n}function parseUniform(u,n,d){const C=u.name,I=C.length;for(RePathPart.lastIndex=0;;){const f=RePathPart.exec(C),y=RePathPart.lastIndex;let B=f[1];const _=f[2]==="]",Z=f[3];if(_&&(B=B|0),Z===void 0||Z==="["&&y+2===I){addUniform(d,Z===void 0?new SingleUniform(B,u,n):new PureArrayUniform(B,u,n));break}else{let V=d.map[B];V===void 0&&(V=new StructuredUniform(B),addUniform(d,V)),d=V}}}class WebGLUniforms{constructor(n,d){this.seq=[],this.map={};const C=n.getProgramParameter(d,n.ACTIVE_UNIFORMS);for(let I=0;I<C;++I){const f=n.getActiveUniform(d,I),y=n.getUniformLocation(d,f.name);parseUniform(f,y,this)}}setValue(n,d,C,I){const f=this.map[d];f!==void 0&&f.setValue(n,C,I)}setOptional(n,d,C){const I=d[C];I!==void 0&&this.setValue(n,C,I)}static upload(n,d,C,I){for(let f=0,y=d.length;f!==y;++f){const B=d[f],_=C[B.id];_.needsUpdate!==!1&&B.setValue(n,_.value,I)}}static seqWithValue(n,d){const C=[];for(let I=0,f=n.length;I!==f;++I){const y=n[I];y.id in d&&C.push(y)}return C}}function WebGLShader(u,n,d){const C=u.createShader(n);return u.shaderSource(C,d),u.compileShader(C),C}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(u,n){const d=u.split(`
`),C=[],I=Math.max(n-6,0),f=Math.min(n+6,d.length);for(let y=I;y<f;y++){const B=y+1;C.push(`${B===n?">":" "} ${B}: ${d[y]}`)}return C.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(u){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,u);const n=`mat3( ${_m0.elements.map(d=>d.toFixed(4))} )`;switch(ColorManagement.getTransfer(u)){case LinearTransfer:return[n,"LinearTransferOETF"];case SRGBTransfer:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",u),[n,"LinearTransferOETF"]}}function getShaderErrors(u,n,d){const C=u.getShaderParameter(n,u.COMPILE_STATUS),I=u.getShaderInfoLog(n).trim();if(C&&I==="")return"";const f=/ERROR: 0:(\d+)/.exec(I);if(f){const y=parseInt(f[1]);return d.toUpperCase()+`

`+I+`

`+handleSource(u.getShaderSource(n),y)}else return I}function getTexelEncodingFunction(u,n){const d=getEncodingComponents(n);return[`vec4 ${u}( vec4 value ) {`,`	return ${d[1]}( vec4( value.rgb * ${d[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(u,n){let d;switch(n){case LinearToneMapping:d="Linear";break;case ReinhardToneMapping:d="Reinhard";break;case CineonToneMapping:d="Cineon";break;case ACESFilmicToneMapping:d="ACESFilmic";break;case AgXToneMapping:d="AgX";break;case NeutralToneMapping:d="Neutral";break;case CustomToneMapping:d="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),d="Linear"}return"vec3 "+u+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}const _v0=new Vector3;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0);const u=_v0.x.toFixed(4),n=_v0.y.toFixed(4),d=_v0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${u}, ${n}, ${d} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(u){return[u.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",u.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(u){const n=[];for(const d in u){const C=u[d];C!==!1&&n.push("#define "+d+" "+C)}return n.join(`
`)}function fetchAttributeLocations(u,n){const d={},C=u.getProgramParameter(n,u.ACTIVE_ATTRIBUTES);for(let I=0;I<C;I++){const f=u.getActiveAttrib(n,I),y=f.name;let B=1;f.type===u.FLOAT_MAT2&&(B=2),f.type===u.FLOAT_MAT3&&(B=3),f.type===u.FLOAT_MAT4&&(B=4),d[y]={type:f.type,location:u.getAttribLocation(n,y),locationSize:B}}return d}function filterEmptyLine(u){return u!==""}function replaceLightNums(u,n){const d=n.numSpotLightShadows+n.numSpotLightMaps-n.numSpotLightShadowsWithMaps;return u.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,n.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,d).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,n.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function replaceClippingPlaneNums(u,n){return u.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(u){return u.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(u,n){let d=ShaderChunk[n];if(d===void 0){const C=shaderChunkMap.get(n);if(C!==void 0)d=ShaderChunk[C],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',n,C);else throw new Error("Can not resolve #include <"+n+">")}return resolveIncludes(d)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(u){return u.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(u,n,d,C){let I="";for(let f=parseInt(n);f<parseInt(d);f++)I+=C.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return I}function generatePrecision(u){let n=`precision ${u.precision} float;
	precision ${u.precision} int;
	precision ${u.precision} sampler2D;
	precision ${u.precision} samplerCube;
	precision ${u.precision} sampler3D;
	precision ${u.precision} sampler2DArray;
	precision ${u.precision} sampler2DShadow;
	precision ${u.precision} samplerCubeShadow;
	precision ${u.precision} sampler2DArrayShadow;
	precision ${u.precision} isampler2D;
	precision ${u.precision} isampler3D;
	precision ${u.precision} isamplerCube;
	precision ${u.precision} isampler2DArray;
	precision ${u.precision} usampler2D;
	precision ${u.precision} usampler3D;
	precision ${u.precision} usamplerCube;
	precision ${u.precision} usampler2DArray;
	`;return u.precision==="highp"?n+=`
#define HIGH_PRECISION`:u.precision==="mediump"?n+=`
#define MEDIUM_PRECISION`:u.precision==="lowp"&&(n+=`
#define LOW_PRECISION`),n}function generateShadowMapTypeDefine(u){let n="SHADOWMAP_TYPE_BASIC";return u.shadowMapType===PCFShadowMap?n="SHADOWMAP_TYPE_PCF":u.shadowMapType===PCFSoftShadowMap?n="SHADOWMAP_TYPE_PCF_SOFT":u.shadowMapType===VSMShadowMap&&(n="SHADOWMAP_TYPE_VSM"),n}function generateEnvMapTypeDefine(u){let n="ENVMAP_TYPE_CUBE";if(u.envMap)switch(u.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:n="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:n="ENVMAP_TYPE_CUBE_UV";break}return n}function generateEnvMapModeDefine(u){let n="ENVMAP_MODE_REFLECTION";if(u.envMap)switch(u.envMapMode){case CubeRefractionMapping:n="ENVMAP_MODE_REFRACTION";break}return n}function generateEnvMapBlendingDefine(u){let n="ENVMAP_BLENDING_NONE";if(u.envMap)switch(u.combine){case MultiplyOperation:n="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:n="ENVMAP_BLENDING_MIX";break;case AddOperation:n="ENVMAP_BLENDING_ADD";break}return n}function generateCubeUVSize(u){const n=u.envMapCubeUVHeight;if(n===null)return null;const d=Math.log2(n)-2,C=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,d),7*16)),texelHeight:C,maxMip:d}}function WebGLProgram(u,n,d,C){const I=u.getContext(),f=d.defines;let y=d.vertexShader,B=d.fragmentShader;const _=generateShadowMapTypeDefine(d),Z=generateEnvMapTypeDefine(d),M=generateEnvMapModeDefine(d),V=generateEnvMapBlendingDefine(d),T=generateCubeUVSize(d),H=generateVertexExtensions(d),F=generateDefines(f),O=I.createProgram();let $,U,ee=d.glslVersion?"#version "+d.glslVersion+`
`:"";d.isRawShaderMaterial?($=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,F].filter(filterEmptyLine).join(`
`),$.length>0&&($+=`
`),U=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,F].filter(filterEmptyLine).join(`
`),U.length>0&&(U+=`
`)):($=[generatePrecision(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,F,d.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",d.batching?"#define USE_BATCHING":"",d.batchingColor?"#define USE_BATCHING_COLOR":"",d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.instancingMorph?"#define USE_INSTANCING_MORPH":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+M:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.displacementMap?"#define USE_DISPLACEMENTMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.mapUv?"#define MAP_UV "+d.mapUv:"",d.alphaMapUv?"#define ALPHAMAP_UV "+d.alphaMapUv:"",d.lightMapUv?"#define LIGHTMAP_UV "+d.lightMapUv:"",d.aoMapUv?"#define AOMAP_UV "+d.aoMapUv:"",d.emissiveMapUv?"#define EMISSIVEMAP_UV "+d.emissiveMapUv:"",d.bumpMapUv?"#define BUMPMAP_UV "+d.bumpMapUv:"",d.normalMapUv?"#define NORMALMAP_UV "+d.normalMapUv:"",d.displacementMapUv?"#define DISPLACEMENTMAP_UV "+d.displacementMapUv:"",d.metalnessMapUv?"#define METALNESSMAP_UV "+d.metalnessMapUv:"",d.roughnessMapUv?"#define ROUGHNESSMAP_UV "+d.roughnessMapUv:"",d.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+d.anisotropyMapUv:"",d.clearcoatMapUv?"#define CLEARCOATMAP_UV "+d.clearcoatMapUv:"",d.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+d.clearcoatNormalMapUv:"",d.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+d.clearcoatRoughnessMapUv:"",d.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+d.iridescenceMapUv:"",d.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+d.iridescenceThicknessMapUv:"",d.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+d.sheenColorMapUv:"",d.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+d.sheenRoughnessMapUv:"",d.specularMapUv?"#define SPECULARMAP_UV "+d.specularMapUv:"",d.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+d.specularColorMapUv:"",d.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+d.specularIntensityMapUv:"",d.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+d.transmissionMapUv:"",d.thicknessMapUv?"#define THICKNESSMAP_UV "+d.thicknessMapUv:"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&d.flatShading===!1?"#define USE_MORPHNORMALS":"",d.morphColors?"#define USE_MORPHCOLORS":"",d.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+d.morphTextureStride:"",d.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+d.morphTargetsCount:"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+_:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),U=[generatePrecision(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,F,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",d.map?"#define USE_MAP":"",d.matcap?"#define USE_MATCAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+Z:"",d.envMap?"#define "+M:"",d.envMap?"#define "+V:"",T?"#define CUBEUV_TEXEL_WIDTH "+T.texelWidth:"",T?"#define CUBEUV_TEXEL_HEIGHT "+T.texelHeight:"",T?"#define CUBEUV_MAX_MIP "+T.maxMip+".0":"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoat?"#define USE_CLEARCOAT":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.dispersion?"#define USE_DISPERSION":"",d.iridescence?"#define USE_IRIDESCENCE":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaTest?"#define USE_ALPHATEST":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.sheen?"#define USE_SHEEN":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors||d.instancingColor||d.batchingColor?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+_:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",d.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",d.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",d.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",d.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",d.toneMapping):"",d.dithering?"#define DITHERING":"",d.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",d.outputColorSpace),getLuminanceFunction(),d.useDepthPacking?"#define DEPTH_PACKING "+d.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),y=resolveIncludes(y),y=replaceLightNums(y,d),y=replaceClippingPlaneNums(y,d),B=resolveIncludes(B),B=replaceLightNums(B,d),B=replaceClippingPlaneNums(B,d),y=unrollLoops(y),B=unrollLoops(B),d.isRawShaderMaterial!==!0&&(ee=`#version 300 es
`,$=[H,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+$,U=["#define varying in",d.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",d.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+U);const Q=ee+$+y,ie=ee+U+B,ne=WebGLShader(I,I.VERTEX_SHADER,Q),le=WebGLShader(I,I.FRAGMENT_SHADER,ie);I.attachShader(O,ne),I.attachShader(O,le),d.index0AttributeName!==void 0?I.bindAttribLocation(O,0,d.index0AttributeName):d.morphTargets===!0&&I.bindAttribLocation(O,0,"position"),I.linkProgram(O);function ae(Ie){if(u.debug.checkShaderErrors){const fe=I.getProgramInfoLog(O).trim(),me=I.getShaderInfoLog(ne).trim(),Ge=I.getShaderInfoLog(le).trim();let Ze=!0,ye=!0;if(I.getProgramParameter(O,I.LINK_STATUS)===!1)if(Ze=!1,typeof u.debug.onShaderError=="function")u.debug.onShaderError(I,O,ne,le);else{const Ee=getShaderErrors(I,ne,"vertex"),Ve=getShaderErrors(I,le,"fragment");console.error("THREE.WebGLProgram: Shader Error "+I.getError()+" - VALIDATE_STATUS "+I.getProgramParameter(O,I.VALIDATE_STATUS)+`

Material Name: `+Ie.name+`
Material Type: `+Ie.type+`

Program Info Log: `+fe+`
`+Ee+`
`+Ve)}else fe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",fe):(me===""||Ge==="")&&(ye=!1);ye&&(Ie.diagnostics={runnable:Ze,programLog:fe,vertexShader:{log:me,prefix:$},fragmentShader:{log:Ge,prefix:U}})}I.deleteShader(ne),I.deleteShader(le),ce=new WebGLUniforms(I,O),ge=fetchAttributeLocations(I,O)}let ce;this.getUniforms=function(){return ce===void 0&&ae(this),ce};let ge;this.getAttributes=function(){return ge===void 0&&ae(this),ge};let he=d.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return he===!1&&(he=I.getProgramParameter(O,COMPLETION_STATUS_KHR)),he},this.destroy=function(){C.releaseStatesOfProgram(this),I.deleteProgram(O),this.program=void 0},this.type=d.shaderType,this.name=d.shaderName,this.id=programIdCount++,this.cacheKey=n,this.usedTimes=1,this.program=O,this.vertexShader=ne,this.fragmentShader=le,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(n){const d=n.vertexShader,C=n.fragmentShader,I=this._getShaderStage(d),f=this._getShaderStage(C),y=this._getShaderCacheForMaterial(n);return y.has(I)===!1&&(y.add(I),I.usedTimes++),y.has(f)===!1&&(y.add(f),f.usedTimes++),this}remove(n){const d=this.materialCache.get(n);for(const C of d)C.usedTimes--,C.usedTimes===0&&this.shaderCache.delete(C.code);return this.materialCache.delete(n),this}getVertexShaderID(n){return this._getShaderStage(n.vertexShader).id}getFragmentShaderID(n){return this._getShaderStage(n.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(n){const d=this.materialCache;let C=d.get(n);return C===void 0&&(C=new Set,d.set(n,C)),C}_getShaderStage(n){const d=this.shaderCache;let C=d.get(n);return C===void 0&&(C=new WebGLShaderStage(n),d.set(n,C)),C}}class WebGLShaderStage{constructor(n){this.id=_id++,this.code=n,this.usedTimes=0}}function WebGLPrograms(u,n,d,C,I,f,y){const B=new Layers,_=new WebGLShaderCache,Z=new Set,M=[],V=I.logarithmicDepthBuffer,T=I.vertexTextures;let H=I.precision;const F={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function O(ge){return Z.add(ge),ge===0?"uv":`uv${ge}`}function $(ge,he,Ie,fe,me){const Ge=fe.fog,Ze=me.geometry,ye=ge.isMeshStandardMaterial?fe.environment:null,Ee=(ge.isMeshStandardMaterial?d:n).get(ge.envMap||ye),Ve=Ee&&Ee.mapping===CubeUVReflectionMapping?Ee.image.height:null,Ye=F[ge.type];ge.precision!==null&&(H=I.getMaxPrecision(ge.precision),H!==ge.precision&&console.warn("THREE.WebGLProgram.getParameters:",ge.precision,"not supported, using",H,"instead."));const be=Ze.morphAttributes.position||Ze.morphAttributes.normal||Ze.morphAttributes.color,Be=be!==void 0?be.length:0;let Ne=0;Ze.morphAttributes.position!==void 0&&(Ne=1),Ze.morphAttributes.normal!==void 0&&(Ne=2),Ze.morphAttributes.color!==void 0&&(Ne=3);let Ae,Re,We,De;if(Ye){const Gi=ShaderLib[Ye];Ae=Gi.vertexShader,Re=Gi.fragmentShader}else Ae=ge.vertexShader,Re=ge.fragmentShader,_.update(ge),We=_.getVertexShaderID(ge),De=_.getFragmentShaderID(ge);const Fe=u.getRenderTarget(),Ke=u.state.buffers.depth.getReversed(),Rt=me.isInstancedMesh===!0,dt=me.isBatchedMesh===!0,Ut=!!ge.map,rt=!!ge.matcap,nt=!!Ee,we=!!ge.aoMap,Jt=!!ge.lightMap,It=!!ge.bumpMap,Ht=!!ge.normalMap,mt=!!ge.displacementMap,ni=!!ge.emissiveMap,kt=!!ge.metalnessMap,Me=!!ge.roughnessMap,ve=ge.anisotropy>0,et=ge.clearcoat>0,ht=ge.dispersion>0,Xt=ge.iridescence>0,Ue=ge.sheen>0,ft=ge.transmission>0,Dt=ve&&!!ge.anisotropyMap,jt=et&&!!ge.clearcoatMap,ii=et&&!!ge.clearcoatNormalMap,it=et&&!!ge.clearcoatRoughnessMap,Gt=Xt&&!!ge.iridescenceMap,Zt=Xt&&!!ge.iridescenceThicknessMap,Nt=Ue&&!!ge.sheenColorMap,_t=Ue&&!!ge.sheenRoughnessMap,_e=!!ge.specularMap,Pe=!!ge.specularColorMap,Je=!!ge.specularIntensityMap,ze=ft&&!!ge.transmissionMap,Kt=ft&&!!ge.thicknessMap,ct=!!ge.gradientMap,bt=!!ge.alphaMap,Tt=ge.alphaTest>0,$t=!!ge.alphaHash,si=!!ge.extensions;let Bi=NoToneMapping;ge.toneMapped&&(Fe===null||Fe.isXRRenderTarget===!0)&&(Bi=u.toneMapping);const Ki={shaderID:Ye,shaderType:ge.type,shaderName:ge.name,vertexShader:Ae,fragmentShader:Re,defines:ge.defines,customVertexShaderID:We,customFragmentShaderID:De,isRawShaderMaterial:ge.isRawShaderMaterial===!0,glslVersion:ge.glslVersion,precision:H,batching:dt,batchingColor:dt&&me._colorsTexture!==null,instancing:Rt,instancingColor:Rt&&me.instanceColor!==null,instancingMorph:Rt&&me.morphTexture!==null,supportsVertexTextures:T,outputColorSpace:Fe===null?u.outputColorSpace:Fe.isXRRenderTarget===!0?Fe.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!ge.alphaToCoverage,map:Ut,matcap:rt,envMap:nt,envMapMode:nt&&Ee.mapping,envMapCubeUVHeight:Ve,aoMap:we,lightMap:Jt,bumpMap:It,normalMap:Ht,displacementMap:T&&mt,emissiveMap:ni,normalMapObjectSpace:Ht&&ge.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:Ht&&ge.normalMapType===TangentSpaceNormalMap,metalnessMap:kt,roughnessMap:Me,anisotropy:ve,anisotropyMap:Dt,clearcoat:et,clearcoatMap:jt,clearcoatNormalMap:ii,clearcoatRoughnessMap:it,dispersion:ht,iridescence:Xt,iridescenceMap:Gt,iridescenceThicknessMap:Zt,sheen:Ue,sheenColorMap:Nt,sheenRoughnessMap:_t,specularMap:_e,specularColorMap:Pe,specularIntensityMap:Je,transmission:ft,transmissionMap:ze,thicknessMap:Kt,gradientMap:ct,opaque:ge.transparent===!1&&ge.blending===NormalBlending&&ge.alphaToCoverage===!1,alphaMap:bt,alphaTest:Tt,alphaHash:$t,combine:ge.combine,mapUv:Ut&&O(ge.map.channel),aoMapUv:we&&O(ge.aoMap.channel),lightMapUv:Jt&&O(ge.lightMap.channel),bumpMapUv:It&&O(ge.bumpMap.channel),normalMapUv:Ht&&O(ge.normalMap.channel),displacementMapUv:mt&&O(ge.displacementMap.channel),emissiveMapUv:ni&&O(ge.emissiveMap.channel),metalnessMapUv:kt&&O(ge.metalnessMap.channel),roughnessMapUv:Me&&O(ge.roughnessMap.channel),anisotropyMapUv:Dt&&O(ge.anisotropyMap.channel),clearcoatMapUv:jt&&O(ge.clearcoatMap.channel),clearcoatNormalMapUv:ii&&O(ge.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:it&&O(ge.clearcoatRoughnessMap.channel),iridescenceMapUv:Gt&&O(ge.iridescenceMap.channel),iridescenceThicknessMapUv:Zt&&O(ge.iridescenceThicknessMap.channel),sheenColorMapUv:Nt&&O(ge.sheenColorMap.channel),sheenRoughnessMapUv:_t&&O(ge.sheenRoughnessMap.channel),specularMapUv:_e&&O(ge.specularMap.channel),specularColorMapUv:Pe&&O(ge.specularColorMap.channel),specularIntensityMapUv:Je&&O(ge.specularIntensityMap.channel),transmissionMapUv:ze&&O(ge.transmissionMap.channel),thicknessMapUv:Kt&&O(ge.thicknessMap.channel),alphaMapUv:bt&&O(ge.alphaMap.channel),vertexTangents:!!Ze.attributes.tangent&&(Ht||ve),vertexColors:ge.vertexColors,vertexAlphas:ge.vertexColors===!0&&!!Ze.attributes.color&&Ze.attributes.color.itemSize===4,pointsUvs:me.isPoints===!0&&!!Ze.attributes.uv&&(Ut||bt),fog:!!Ge,useFog:ge.fog===!0,fogExp2:!!Ge&&Ge.isFogExp2,flatShading:ge.flatShading===!0,sizeAttenuation:ge.sizeAttenuation===!0,logarithmicDepthBuffer:V,reverseDepthBuffer:Ke,skinning:me.isSkinnedMesh===!0,morphTargets:Ze.morphAttributes.position!==void 0,morphNormals:Ze.morphAttributes.normal!==void 0,morphColors:Ze.morphAttributes.color!==void 0,morphTargetsCount:Be,morphTextureStride:Ne,numDirLights:he.directional.length,numPointLights:he.point.length,numSpotLights:he.spot.length,numSpotLightMaps:he.spotLightMap.length,numRectAreaLights:he.rectArea.length,numHemiLights:he.hemi.length,numDirLightShadows:he.directionalShadowMap.length,numPointLightShadows:he.pointShadowMap.length,numSpotLightShadows:he.spotShadowMap.length,numSpotLightShadowsWithMaps:he.numSpotLightShadowsWithMaps,numLightProbes:he.numLightProbes,numClippingPlanes:y.numPlanes,numClipIntersection:y.numIntersection,dithering:ge.dithering,shadowMapEnabled:u.shadowMap.enabled&&Ie.length>0,shadowMapType:u.shadowMap.type,toneMapping:Bi,decodeVideoTexture:Ut&&ge.map.isVideoTexture===!0&&ColorManagement.getTransfer(ge.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:ni&&ge.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(ge.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:ge.premultipliedAlpha,doubleSided:ge.side===DoubleSide,flipSided:ge.side===BackSide,useDepthPacking:ge.depthPacking>=0,depthPacking:ge.depthPacking||0,index0AttributeName:ge.index0AttributeName,extensionClipCullDistance:si&&ge.extensions.clipCullDistance===!0&&C.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(si&&ge.extensions.multiDraw===!0||dt)&&C.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:C.has("KHR_parallel_shader_compile"),customProgramCacheKey:ge.customProgramCacheKey()};return Ki.vertexUv1s=Z.has(1),Ki.vertexUv2s=Z.has(2),Ki.vertexUv3s=Z.has(3),Z.clear(),Ki}function U(ge){const he=[];if(ge.shaderID?he.push(ge.shaderID):(he.push(ge.customVertexShaderID),he.push(ge.customFragmentShaderID)),ge.defines!==void 0)for(const Ie in ge.defines)he.push(Ie),he.push(ge.defines[Ie]);return ge.isRawShaderMaterial===!1&&(ee(he,ge),Q(he,ge),he.push(u.outputColorSpace)),he.push(ge.customProgramCacheKey),he.join()}function ee(ge,he){ge.push(he.precision),ge.push(he.outputColorSpace),ge.push(he.envMapMode),ge.push(he.envMapCubeUVHeight),ge.push(he.mapUv),ge.push(he.alphaMapUv),ge.push(he.lightMapUv),ge.push(he.aoMapUv),ge.push(he.bumpMapUv),ge.push(he.normalMapUv),ge.push(he.displacementMapUv),ge.push(he.emissiveMapUv),ge.push(he.metalnessMapUv),ge.push(he.roughnessMapUv),ge.push(he.anisotropyMapUv),ge.push(he.clearcoatMapUv),ge.push(he.clearcoatNormalMapUv),ge.push(he.clearcoatRoughnessMapUv),ge.push(he.iridescenceMapUv),ge.push(he.iridescenceThicknessMapUv),ge.push(he.sheenColorMapUv),ge.push(he.sheenRoughnessMapUv),ge.push(he.specularMapUv),ge.push(he.specularColorMapUv),ge.push(he.specularIntensityMapUv),ge.push(he.transmissionMapUv),ge.push(he.thicknessMapUv),ge.push(he.combine),ge.push(he.fogExp2),ge.push(he.sizeAttenuation),ge.push(he.morphTargetsCount),ge.push(he.morphAttributeCount),ge.push(he.numDirLights),ge.push(he.numPointLights),ge.push(he.numSpotLights),ge.push(he.numSpotLightMaps),ge.push(he.numHemiLights),ge.push(he.numRectAreaLights),ge.push(he.numDirLightShadows),ge.push(he.numPointLightShadows),ge.push(he.numSpotLightShadows),ge.push(he.numSpotLightShadowsWithMaps),ge.push(he.numLightProbes),ge.push(he.shadowMapType),ge.push(he.toneMapping),ge.push(he.numClippingPlanes),ge.push(he.numClipIntersection),ge.push(he.depthPacking)}function Q(ge,he){B.disableAll(),he.supportsVertexTextures&&B.enable(0),he.instancing&&B.enable(1),he.instancingColor&&B.enable(2),he.instancingMorph&&B.enable(3),he.matcap&&B.enable(4),he.envMap&&B.enable(5),he.normalMapObjectSpace&&B.enable(6),he.normalMapTangentSpace&&B.enable(7),he.clearcoat&&B.enable(8),he.iridescence&&B.enable(9),he.alphaTest&&B.enable(10),he.vertexColors&&B.enable(11),he.vertexAlphas&&B.enable(12),he.vertexUv1s&&B.enable(13),he.vertexUv2s&&B.enable(14),he.vertexUv3s&&B.enable(15),he.vertexTangents&&B.enable(16),he.anisotropy&&B.enable(17),he.alphaHash&&B.enable(18),he.batching&&B.enable(19),he.dispersion&&B.enable(20),he.batchingColor&&B.enable(21),ge.push(B.mask),B.disableAll(),he.fog&&B.enable(0),he.useFog&&B.enable(1),he.flatShading&&B.enable(2),he.logarithmicDepthBuffer&&B.enable(3),he.reverseDepthBuffer&&B.enable(4),he.skinning&&B.enable(5),he.morphTargets&&B.enable(6),he.morphNormals&&B.enable(7),he.morphColors&&B.enable(8),he.premultipliedAlpha&&B.enable(9),he.shadowMapEnabled&&B.enable(10),he.doubleSided&&B.enable(11),he.flipSided&&B.enable(12),he.useDepthPacking&&B.enable(13),he.dithering&&B.enable(14),he.transmission&&B.enable(15),he.sheen&&B.enable(16),he.opaque&&B.enable(17),he.pointsUvs&&B.enable(18),he.decodeVideoTexture&&B.enable(19),he.decodeVideoTextureEmissive&&B.enable(20),he.alphaToCoverage&&B.enable(21),ge.push(B.mask)}function ie(ge){const he=F[ge.type];let Ie;if(he){const fe=ShaderLib[he];Ie=UniformsUtils.clone(fe.uniforms)}else Ie=ge.uniforms;return Ie}function ne(ge,he){let Ie;for(let fe=0,me=M.length;fe<me;fe++){const Ge=M[fe];if(Ge.cacheKey===he){Ie=Ge,++Ie.usedTimes;break}}return Ie===void 0&&(Ie=new WebGLProgram(u,he,ge,f),M.push(Ie)),Ie}function le(ge){if(--ge.usedTimes===0){const he=M.indexOf(ge);M[he]=M[M.length-1],M.pop(),ge.destroy()}}function ae(ge){_.remove(ge)}function ce(){_.dispose()}return{getParameters:$,getProgramCacheKey:U,getUniforms:ie,acquireProgram:ne,releaseProgram:le,releaseShaderCache:ae,programs:M,dispose:ce}}function WebGLProperties(){let u=new WeakMap;function n(y){return u.has(y)}function d(y){let B=u.get(y);return B===void 0&&(B={},u.set(y,B)),B}function C(y){u.delete(y)}function I(y,B,_){u.get(y)[B]=_}function f(){u=new WeakMap}return{has:n,get:d,remove:C,update:I,dispose:f}}function painterSortStable(u,n){return u.groupOrder!==n.groupOrder?u.groupOrder-n.groupOrder:u.renderOrder!==n.renderOrder?u.renderOrder-n.renderOrder:u.material.id!==n.material.id?u.material.id-n.material.id:u.z!==n.z?u.z-n.z:u.id-n.id}function reversePainterSortStable(u,n){return u.groupOrder!==n.groupOrder?u.groupOrder-n.groupOrder:u.renderOrder!==n.renderOrder?u.renderOrder-n.renderOrder:u.z!==n.z?n.z-u.z:u.id-n.id}function WebGLRenderList(){const u=[];let n=0;const d=[],C=[],I=[];function f(){n=0,d.length=0,C.length=0,I.length=0}function y(V,T,H,F,O,$){let U=u[n];return U===void 0?(U={id:V.id,object:V,geometry:T,material:H,groupOrder:F,renderOrder:V.renderOrder,z:O,group:$},u[n]=U):(U.id=V.id,U.object=V,U.geometry=T,U.material=H,U.groupOrder=F,U.renderOrder=V.renderOrder,U.z=O,U.group=$),n++,U}function B(V,T,H,F,O,$){const U=y(V,T,H,F,O,$);H.transmission>0?C.push(U):H.transparent===!0?I.push(U):d.push(U)}function _(V,T,H,F,O,$){const U=y(V,T,H,F,O,$);H.transmission>0?C.unshift(U):H.transparent===!0?I.unshift(U):d.unshift(U)}function Z(V,T){d.length>1&&d.sort(V||painterSortStable),C.length>1&&C.sort(T||reversePainterSortStable),I.length>1&&I.sort(T||reversePainterSortStable)}function M(){for(let V=n,T=u.length;V<T;V++){const H=u[V];if(H.id===null)break;H.id=null,H.object=null,H.geometry=null,H.material=null,H.group=null}}return{opaque:d,transmissive:C,transparent:I,init:f,push:B,unshift:_,finish:M,sort:Z}}function WebGLRenderLists(){let u=new WeakMap;function n(C,I){const f=u.get(C);let y;return f===void 0?(y=new WebGLRenderList,u.set(C,[y])):I>=f.length?(y=new WebGLRenderList,f.push(y)):y=f[I],y}function d(){u=new WeakMap}return{get:n,dispose:d}}function UniformsCache(){const u={};return{get:function(n){if(u[n.id]!==void 0)return u[n.id];let d;switch(n.type){case"DirectionalLight":d={direction:new Vector3,color:new Color};break;case"SpotLight":d={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":d={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":d={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":d={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return u[n.id]=d,d}}}function ShadowUniformsCache(){const u={};return{get:function(n){if(u[n.id]!==void 0)return u[n.id];let d;switch(n.type){case"DirectionalLight":d={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":d={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":d={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return u[n.id]=d,d}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(u,n){return(n.castShadow?2:0)-(u.castShadow?2:0)+(n.map?1:0)-(u.map?1:0)}function WebGLLights(u){const n=new UniformsCache,d=ShadowUniformsCache(),C={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let Z=0;Z<9;Z++)C.probe.push(new Vector3);const I=new Vector3,f=new Matrix4,y=new Matrix4;function B(Z){let M=0,V=0,T=0;for(let ge=0;ge<9;ge++)C.probe[ge].set(0,0,0);let H=0,F=0,O=0,$=0,U=0,ee=0,Q=0,ie=0,ne=0,le=0,ae=0;Z.sort(shadowCastingAndTexturingLightsFirst);for(let ge=0,he=Z.length;ge<he;ge++){const Ie=Z[ge],fe=Ie.color,me=Ie.intensity,Ge=Ie.distance,Ze=Ie.shadow&&Ie.shadow.map?Ie.shadow.map.texture:null;if(Ie.isAmbientLight)M+=fe.r*me,V+=fe.g*me,T+=fe.b*me;else if(Ie.isLightProbe){for(let ye=0;ye<9;ye++)C.probe[ye].addScaledVector(Ie.sh.coefficients[ye],me);ae++}else if(Ie.isDirectionalLight){const ye=n.get(Ie);if(ye.color.copy(Ie.color).multiplyScalar(Ie.intensity),Ie.castShadow){const Ee=Ie.shadow,Ve=d.get(Ie);Ve.shadowIntensity=Ee.intensity,Ve.shadowBias=Ee.bias,Ve.shadowNormalBias=Ee.normalBias,Ve.shadowRadius=Ee.radius,Ve.shadowMapSize=Ee.mapSize,C.directionalShadow[H]=Ve,C.directionalShadowMap[H]=Ze,C.directionalShadowMatrix[H]=Ie.shadow.matrix,ee++}C.directional[H]=ye,H++}else if(Ie.isSpotLight){const ye=n.get(Ie);ye.position.setFromMatrixPosition(Ie.matrixWorld),ye.color.copy(fe).multiplyScalar(me),ye.distance=Ge,ye.coneCos=Math.cos(Ie.angle),ye.penumbraCos=Math.cos(Ie.angle*(1-Ie.penumbra)),ye.decay=Ie.decay,C.spot[O]=ye;const Ee=Ie.shadow;if(Ie.map&&(C.spotLightMap[ne]=Ie.map,ne++,Ee.updateMatrices(Ie),Ie.castShadow&&le++),C.spotLightMatrix[O]=Ee.matrix,Ie.castShadow){const Ve=d.get(Ie);Ve.shadowIntensity=Ee.intensity,Ve.shadowBias=Ee.bias,Ve.shadowNormalBias=Ee.normalBias,Ve.shadowRadius=Ee.radius,Ve.shadowMapSize=Ee.mapSize,C.spotShadow[O]=Ve,C.spotShadowMap[O]=Ze,ie++}O++}else if(Ie.isRectAreaLight){const ye=n.get(Ie);ye.color.copy(fe).multiplyScalar(me),ye.halfWidth.set(Ie.width*.5,0,0),ye.halfHeight.set(0,Ie.height*.5,0),C.rectArea[$]=ye,$++}else if(Ie.isPointLight){const ye=n.get(Ie);if(ye.color.copy(Ie.color).multiplyScalar(Ie.intensity),ye.distance=Ie.distance,ye.decay=Ie.decay,Ie.castShadow){const Ee=Ie.shadow,Ve=d.get(Ie);Ve.shadowIntensity=Ee.intensity,Ve.shadowBias=Ee.bias,Ve.shadowNormalBias=Ee.normalBias,Ve.shadowRadius=Ee.radius,Ve.shadowMapSize=Ee.mapSize,Ve.shadowCameraNear=Ee.camera.near,Ve.shadowCameraFar=Ee.camera.far,C.pointShadow[F]=Ve,C.pointShadowMap[F]=Ze,C.pointShadowMatrix[F]=Ie.shadow.matrix,Q++}C.point[F]=ye,F++}else if(Ie.isHemisphereLight){const ye=n.get(Ie);ye.skyColor.copy(Ie.color).multiplyScalar(me),ye.groundColor.copy(Ie.groundColor).multiplyScalar(me),C.hemi[U]=ye,U++}}$>0&&(u.has("OES_texture_float_linear")===!0?(C.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,C.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(C.rectAreaLTC1=UniformsLib.LTC_HALF_1,C.rectAreaLTC2=UniformsLib.LTC_HALF_2)),C.ambient[0]=M,C.ambient[1]=V,C.ambient[2]=T;const ce=C.hash;(ce.directionalLength!==H||ce.pointLength!==F||ce.spotLength!==O||ce.rectAreaLength!==$||ce.hemiLength!==U||ce.numDirectionalShadows!==ee||ce.numPointShadows!==Q||ce.numSpotShadows!==ie||ce.numSpotMaps!==ne||ce.numLightProbes!==ae)&&(C.directional.length=H,C.spot.length=O,C.rectArea.length=$,C.point.length=F,C.hemi.length=U,C.directionalShadow.length=ee,C.directionalShadowMap.length=ee,C.pointShadow.length=Q,C.pointShadowMap.length=Q,C.spotShadow.length=ie,C.spotShadowMap.length=ie,C.directionalShadowMatrix.length=ee,C.pointShadowMatrix.length=Q,C.spotLightMatrix.length=ie+ne-le,C.spotLightMap.length=ne,C.numSpotLightShadowsWithMaps=le,C.numLightProbes=ae,ce.directionalLength=H,ce.pointLength=F,ce.spotLength=O,ce.rectAreaLength=$,ce.hemiLength=U,ce.numDirectionalShadows=ee,ce.numPointShadows=Q,ce.numSpotShadows=ie,ce.numSpotMaps=ne,ce.numLightProbes=ae,C.version=nextVersion++)}function _(Z,M){let V=0,T=0,H=0,F=0,O=0;const $=M.matrixWorldInverse;for(let U=0,ee=Z.length;U<ee;U++){const Q=Z[U];if(Q.isDirectionalLight){const ie=C.directional[V];ie.direction.setFromMatrixPosition(Q.matrixWorld),I.setFromMatrixPosition(Q.target.matrixWorld),ie.direction.sub(I),ie.direction.transformDirection($),V++}else if(Q.isSpotLight){const ie=C.spot[H];ie.position.setFromMatrixPosition(Q.matrixWorld),ie.position.applyMatrix4($),ie.direction.setFromMatrixPosition(Q.matrixWorld),I.setFromMatrixPosition(Q.target.matrixWorld),ie.direction.sub(I),ie.direction.transformDirection($),H++}else if(Q.isRectAreaLight){const ie=C.rectArea[F];ie.position.setFromMatrixPosition(Q.matrixWorld),ie.position.applyMatrix4($),y.identity(),f.copy(Q.matrixWorld),f.premultiply($),y.extractRotation(f),ie.halfWidth.set(Q.width*.5,0,0),ie.halfHeight.set(0,Q.height*.5,0),ie.halfWidth.applyMatrix4(y),ie.halfHeight.applyMatrix4(y),F++}else if(Q.isPointLight){const ie=C.point[T];ie.position.setFromMatrixPosition(Q.matrixWorld),ie.position.applyMatrix4($),T++}else if(Q.isHemisphereLight){const ie=C.hemi[O];ie.direction.setFromMatrixPosition(Q.matrixWorld),ie.direction.transformDirection($),O++}}}return{setup:B,setupView:_,state:C}}function WebGLRenderState(u){const n=new WebGLLights(u),d=[],C=[];function I(M){Z.camera=M,d.length=0,C.length=0}function f(M){d.push(M)}function y(M){C.push(M)}function B(){n.setup(d)}function _(M){n.setupView(d,M)}const Z={lightsArray:d,shadowsArray:C,camera:null,lights:n,transmissionRenderTarget:{}};return{init:I,state:Z,setupLights:B,setupLightsView:_,pushLight:f,pushShadow:y}}function WebGLRenderStates(u){let n=new WeakMap;function d(I,f=0){const y=n.get(I);let B;return y===void 0?(B=new WebGLRenderState(u),n.set(I,[B])):f>=y.length?(B=new WebGLRenderState(u),y.push(B)):B=y[f],B}function C(){n=new WeakMap}return{get:d,dispose:C}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(u,n,d){let C=new Frustum;const I=new Vector2,f=new Vector2,y=new Vector4,B=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),_=new MeshDistanceMaterial,Z={},M=d.maxTextureSize,V={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},T=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),H=T.clone();H.defines.HORIZONTAL_PASS=1;const F=new BufferGeometry;F.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const O=new Mesh(F,T),$=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let U=this.type;this.render=function(le,ae,ce){if($.enabled===!1||$.autoUpdate===!1&&$.needsUpdate===!1||le.length===0)return;const ge=u.getRenderTarget(),he=u.getActiveCubeFace(),Ie=u.getActiveMipmapLevel(),fe=u.state;fe.setBlending(NoBlending),fe.buffers.color.setClear(1,1,1,1),fe.buffers.depth.setTest(!0),fe.setScissorTest(!1);const me=U!==VSMShadowMap&&this.type===VSMShadowMap,Ge=U===VSMShadowMap&&this.type!==VSMShadowMap;for(let Ze=0,ye=le.length;Ze<ye;Ze++){const Ee=le[Ze],Ve=Ee.shadow;if(Ve===void 0){console.warn("THREE.WebGLShadowMap:",Ee,"has no shadow.");continue}if(Ve.autoUpdate===!1&&Ve.needsUpdate===!1)continue;I.copy(Ve.mapSize);const Ye=Ve.getFrameExtents();if(I.multiply(Ye),f.copy(Ve.mapSize),(I.x>M||I.y>M)&&(I.x>M&&(f.x=Math.floor(M/Ye.x),I.x=f.x*Ye.x,Ve.mapSize.x=f.x),I.y>M&&(f.y=Math.floor(M/Ye.y),I.y=f.y*Ye.y,Ve.mapSize.y=f.y)),Ve.map===null||me===!0||Ge===!0){const Be=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Ve.map!==null&&Ve.map.dispose(),Ve.map=new WebGLRenderTarget(I.x,I.y,Be),Ve.map.texture.name=Ee.name+".shadowMap",Ve.camera.updateProjectionMatrix()}u.setRenderTarget(Ve.map),u.clear();const be=Ve.getViewportCount();for(let Be=0;Be<be;Be++){const Ne=Ve.getViewport(Be);y.set(f.x*Ne.x,f.y*Ne.y,f.x*Ne.z,f.y*Ne.w),fe.viewport(y),Ve.updateMatrices(Ee,Be),C=Ve.getFrustum(),ie(ae,ce,Ve.camera,Ee,this.type)}Ve.isPointLightShadow!==!0&&this.type===VSMShadowMap&&ee(Ve,ce),Ve.needsUpdate=!1}U=this.type,$.needsUpdate=!1,u.setRenderTarget(ge,he,Ie)};function ee(le,ae){const ce=n.update(O);T.defines.VSM_SAMPLES!==le.blurSamples&&(T.defines.VSM_SAMPLES=le.blurSamples,H.defines.VSM_SAMPLES=le.blurSamples,T.needsUpdate=!0,H.needsUpdate=!0),le.mapPass===null&&(le.mapPass=new WebGLRenderTarget(I.x,I.y)),T.uniforms.shadow_pass.value=le.map.texture,T.uniforms.resolution.value=le.mapSize,T.uniforms.radius.value=le.radius,u.setRenderTarget(le.mapPass),u.clear(),u.renderBufferDirect(ae,null,ce,T,O,null),H.uniforms.shadow_pass.value=le.mapPass.texture,H.uniforms.resolution.value=le.mapSize,H.uniforms.radius.value=le.radius,u.setRenderTarget(le.map),u.clear(),u.renderBufferDirect(ae,null,ce,H,O,null)}function Q(le,ae,ce,ge){let he=null;const Ie=ce.isPointLight===!0?le.customDistanceMaterial:le.customDepthMaterial;if(Ie!==void 0)he=Ie;else if(he=ce.isPointLight===!0?_:B,u.localClippingEnabled&&ae.clipShadows===!0&&Array.isArray(ae.clippingPlanes)&&ae.clippingPlanes.length!==0||ae.displacementMap&&ae.displacementScale!==0||ae.alphaMap&&ae.alphaTest>0||ae.map&&ae.alphaTest>0){const fe=he.uuid,me=ae.uuid;let Ge=Z[fe];Ge===void 0&&(Ge={},Z[fe]=Ge);let Ze=Ge[me];Ze===void 0&&(Ze=he.clone(),Ge[me]=Ze,ae.addEventListener("dispose",ne)),he=Ze}if(he.visible=ae.visible,he.wireframe=ae.wireframe,ge===VSMShadowMap?he.side=ae.shadowSide!==null?ae.shadowSide:ae.side:he.side=ae.shadowSide!==null?ae.shadowSide:V[ae.side],he.alphaMap=ae.alphaMap,he.alphaTest=ae.alphaTest,he.map=ae.map,he.clipShadows=ae.clipShadows,he.clippingPlanes=ae.clippingPlanes,he.clipIntersection=ae.clipIntersection,he.displacementMap=ae.displacementMap,he.displacementScale=ae.displacementScale,he.displacementBias=ae.displacementBias,he.wireframeLinewidth=ae.wireframeLinewidth,he.linewidth=ae.linewidth,ce.isPointLight===!0&&he.isMeshDistanceMaterial===!0){const fe=u.properties.get(he);fe.light=ce}return he}function ie(le,ae,ce,ge,he){if(le.visible===!1)return;if(le.layers.test(ae.layers)&&(le.isMesh||le.isLine||le.isPoints)&&(le.castShadow||le.receiveShadow&&he===VSMShadowMap)&&(!le.frustumCulled||C.intersectsObject(le))){le.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,le.matrixWorld);const me=n.update(le),Ge=le.material;if(Array.isArray(Ge)){const Ze=me.groups;for(let ye=0,Ee=Ze.length;ye<Ee;ye++){const Ve=Ze[ye],Ye=Ge[Ve.materialIndex];if(Ye&&Ye.visible){const be=Q(le,Ye,ge,he);le.onBeforeShadow(u,le,ae,ce,me,be,Ve),u.renderBufferDirect(ce,null,me,be,le,Ve),le.onAfterShadow(u,le,ae,ce,me,be,Ve)}}}else if(Ge.visible){const Ze=Q(le,Ge,ge,he);le.onBeforeShadow(u,le,ae,ce,me,Ze,null),u.renderBufferDirect(ce,null,me,Ze,le,null),le.onAfterShadow(u,le,ae,ce,me,Ze,null)}}const fe=le.children;for(let me=0,Ge=fe.length;me<Ge;me++)ie(fe[me],ae,ce,ge,he)}function ne(le){le.target.removeEventListener("dispose",ne);for(const ce in Z){const ge=Z[ce],he=le.target.uuid;he in ge&&(ge[he].dispose(),delete ge[he])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(u,n){function d(){let ze=!1;const Kt=new Vector4;let ct=null;const bt=new Vector4(0,0,0,0);return{setMask:function(Tt){ct!==Tt&&!ze&&(u.colorMask(Tt,Tt,Tt,Tt),ct=Tt)},setLocked:function(Tt){ze=Tt},setClear:function(Tt,$t,si,Bi,Ki){Ki===!0&&(Tt*=Bi,$t*=Bi,si*=Bi),Kt.set(Tt,$t,si,Bi),bt.equals(Kt)===!1&&(u.clearColor(Tt,$t,si,Bi),bt.copy(Kt))},reset:function(){ze=!1,ct=null,bt.set(-1,0,0,0)}}}function C(){let ze=!1,Kt=!1,ct=null,bt=null,Tt=null;return{setReversed:function($t){if(Kt!==$t){const si=n.get("EXT_clip_control");Kt?si.clipControlEXT(si.LOWER_LEFT_EXT,si.ZERO_TO_ONE_EXT):si.clipControlEXT(si.LOWER_LEFT_EXT,si.NEGATIVE_ONE_TO_ONE_EXT);const Bi=Tt;Tt=null,this.setClear(Bi)}Kt=$t},getReversed:function(){return Kt},setTest:function($t){$t?Fe(u.DEPTH_TEST):Ke(u.DEPTH_TEST)},setMask:function($t){ct!==$t&&!ze&&(u.depthMask($t),ct=$t)},setFunc:function($t){if(Kt&&($t=reversedFuncs[$t]),bt!==$t){switch($t){case NeverDepth:u.depthFunc(u.NEVER);break;case AlwaysDepth:u.depthFunc(u.ALWAYS);break;case LessDepth:u.depthFunc(u.LESS);break;case LessEqualDepth:u.depthFunc(u.LEQUAL);break;case EqualDepth:u.depthFunc(u.EQUAL);break;case GreaterEqualDepth:u.depthFunc(u.GEQUAL);break;case GreaterDepth:u.depthFunc(u.GREATER);break;case NotEqualDepth:u.depthFunc(u.NOTEQUAL);break;default:u.depthFunc(u.LEQUAL)}bt=$t}},setLocked:function($t){ze=$t},setClear:function($t){Tt!==$t&&(Kt&&($t=1-$t),u.clearDepth($t),Tt=$t)},reset:function(){ze=!1,ct=null,bt=null,Tt=null,Kt=!1}}}function I(){let ze=!1,Kt=null,ct=null,bt=null,Tt=null,$t=null,si=null,Bi=null,Ki=null;return{setTest:function(Gi){ze||(Gi?Fe(u.STENCIL_TEST):Ke(u.STENCIL_TEST))},setMask:function(Gi){Kt!==Gi&&!ze&&(u.stencilMask(Gi),Kt=Gi)},setFunc:function(Gi,_i,Di){(ct!==Gi||bt!==_i||Tt!==Di)&&(u.stencilFunc(Gi,_i,Di),ct=Gi,bt=_i,Tt=Di)},setOp:function(Gi,_i,Di){($t!==Gi||si!==_i||Bi!==Di)&&(u.stencilOp(Gi,_i,Di),$t=Gi,si=_i,Bi=Di)},setLocked:function(Gi){ze=Gi},setClear:function(Gi){Ki!==Gi&&(u.clearStencil(Gi),Ki=Gi)},reset:function(){ze=!1,Kt=null,ct=null,bt=null,Tt=null,$t=null,si=null,Bi=null,Ki=null}}}const f=new d,y=new C,B=new I,_=new WeakMap,Z=new WeakMap;let M={},V={},T=new WeakMap,H=[],F=null,O=!1,$=null,U=null,ee=null,Q=null,ie=null,ne=null,le=null,ae=new Color(0,0,0),ce=0,ge=!1,he=null,Ie=null,fe=null,me=null,Ge=null;const Ze=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ye=!1,Ee=0;const Ve=u.getParameter(u.VERSION);Ve.indexOf("WebGL")!==-1?(Ee=parseFloat(/^WebGL (\d)/.exec(Ve)[1]),ye=Ee>=1):Ve.indexOf("OpenGL ES")!==-1&&(Ee=parseFloat(/^OpenGL ES (\d)/.exec(Ve)[1]),ye=Ee>=2);let Ye=null,be={};const Be=u.getParameter(u.SCISSOR_BOX),Ne=u.getParameter(u.VIEWPORT),Ae=new Vector4().fromArray(Be),Re=new Vector4().fromArray(Ne);function We(ze,Kt,ct,bt){const Tt=new Uint8Array(4),$t=u.createTexture();u.bindTexture(ze,$t),u.texParameteri(ze,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(ze,u.TEXTURE_MAG_FILTER,u.NEAREST);for(let si=0;si<ct;si++)ze===u.TEXTURE_3D||ze===u.TEXTURE_2D_ARRAY?u.texImage3D(Kt,0,u.RGBA,1,1,bt,0,u.RGBA,u.UNSIGNED_BYTE,Tt):u.texImage2D(Kt+si,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,Tt);return $t}const De={};De[u.TEXTURE_2D]=We(u.TEXTURE_2D,u.TEXTURE_2D,1),De[u.TEXTURE_CUBE_MAP]=We(u.TEXTURE_CUBE_MAP,u.TEXTURE_CUBE_MAP_POSITIVE_X,6),De[u.TEXTURE_2D_ARRAY]=We(u.TEXTURE_2D_ARRAY,u.TEXTURE_2D_ARRAY,1,1),De[u.TEXTURE_3D]=We(u.TEXTURE_3D,u.TEXTURE_3D,1,1),f.setClear(0,0,0,1),y.setClear(1),B.setClear(0),Fe(u.DEPTH_TEST),y.setFunc(LessEqualDepth),It(!1),Ht(CullFaceBack),Fe(u.CULL_FACE),we(NoBlending);function Fe(ze){M[ze]!==!0&&(u.enable(ze),M[ze]=!0)}function Ke(ze){M[ze]!==!1&&(u.disable(ze),M[ze]=!1)}function Rt(ze,Kt){return V[ze]!==Kt?(u.bindFramebuffer(ze,Kt),V[ze]=Kt,ze===u.DRAW_FRAMEBUFFER&&(V[u.FRAMEBUFFER]=Kt),ze===u.FRAMEBUFFER&&(V[u.DRAW_FRAMEBUFFER]=Kt),!0):!1}function dt(ze,Kt){let ct=H,bt=!1;if(ze){ct=T.get(Kt),ct===void 0&&(ct=[],T.set(Kt,ct));const Tt=ze.textures;if(ct.length!==Tt.length||ct[0]!==u.COLOR_ATTACHMENT0){for(let $t=0,si=Tt.length;$t<si;$t++)ct[$t]=u.COLOR_ATTACHMENT0+$t;ct.length=Tt.length,bt=!0}}else ct[0]!==u.BACK&&(ct[0]=u.BACK,bt=!0);bt&&u.drawBuffers(ct)}function Ut(ze){return F!==ze?(u.useProgram(ze),F=ze,!0):!1}const rt={[AddEquation]:u.FUNC_ADD,[SubtractEquation]:u.FUNC_SUBTRACT,[ReverseSubtractEquation]:u.FUNC_REVERSE_SUBTRACT};rt[MinEquation]=u.MIN,rt[MaxEquation]=u.MAX;const nt={[ZeroFactor]:u.ZERO,[OneFactor]:u.ONE,[SrcColorFactor]:u.SRC_COLOR,[SrcAlphaFactor]:u.SRC_ALPHA,[SrcAlphaSaturateFactor]:u.SRC_ALPHA_SATURATE,[DstColorFactor]:u.DST_COLOR,[DstAlphaFactor]:u.DST_ALPHA,[OneMinusSrcColorFactor]:u.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:u.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:u.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:u.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:u.CONSTANT_COLOR,[OneMinusConstantColorFactor]:u.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:u.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:u.ONE_MINUS_CONSTANT_ALPHA};function we(ze,Kt,ct,bt,Tt,$t,si,Bi,Ki,Gi){if(ze===NoBlending){O===!0&&(Ke(u.BLEND),O=!1);return}if(O===!1&&(Fe(u.BLEND),O=!0),ze!==CustomBlending){if(ze!==$||Gi!==ge){if((U!==AddEquation||ie!==AddEquation)&&(u.blendEquation(u.FUNC_ADD),U=AddEquation,ie=AddEquation),Gi)switch(ze){case NormalBlending:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.ONE,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}else switch(ze){case NormalBlending:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}ee=null,Q=null,ne=null,le=null,ae.set(0,0,0),ce=0,$=ze,ge=Gi}return}Tt=Tt||Kt,$t=$t||ct,si=si||bt,(Kt!==U||Tt!==ie)&&(u.blendEquationSeparate(rt[Kt],rt[Tt]),U=Kt,ie=Tt),(ct!==ee||bt!==Q||$t!==ne||si!==le)&&(u.blendFuncSeparate(nt[ct],nt[bt],nt[$t],nt[si]),ee=ct,Q=bt,ne=$t,le=si),(Bi.equals(ae)===!1||Ki!==ce)&&(u.blendColor(Bi.r,Bi.g,Bi.b,Ki),ae.copy(Bi),ce=Ki),$=ze,ge=!1}function Jt(ze,Kt){ze.side===DoubleSide?Ke(u.CULL_FACE):Fe(u.CULL_FACE);let ct=ze.side===BackSide;Kt&&(ct=!ct),It(ct),ze.blending===NormalBlending&&ze.transparent===!1?we(NoBlending):we(ze.blending,ze.blendEquation,ze.blendSrc,ze.blendDst,ze.blendEquationAlpha,ze.blendSrcAlpha,ze.blendDstAlpha,ze.blendColor,ze.blendAlpha,ze.premultipliedAlpha),y.setFunc(ze.depthFunc),y.setTest(ze.depthTest),y.setMask(ze.depthWrite),f.setMask(ze.colorWrite);const bt=ze.stencilWrite;B.setTest(bt),bt&&(B.setMask(ze.stencilWriteMask),B.setFunc(ze.stencilFunc,ze.stencilRef,ze.stencilFuncMask),B.setOp(ze.stencilFail,ze.stencilZFail,ze.stencilZPass)),ni(ze.polygonOffset,ze.polygonOffsetFactor,ze.polygonOffsetUnits),ze.alphaToCoverage===!0?Fe(u.SAMPLE_ALPHA_TO_COVERAGE):Ke(u.SAMPLE_ALPHA_TO_COVERAGE)}function It(ze){he!==ze&&(ze?u.frontFace(u.CW):u.frontFace(u.CCW),he=ze)}function Ht(ze){ze!==CullFaceNone?(Fe(u.CULL_FACE),ze!==Ie&&(ze===CullFaceBack?u.cullFace(u.BACK):ze===CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK))):Ke(u.CULL_FACE),Ie=ze}function mt(ze){ze!==fe&&(ye&&u.lineWidth(ze),fe=ze)}function ni(ze,Kt,ct){ze?(Fe(u.POLYGON_OFFSET_FILL),(me!==Kt||Ge!==ct)&&(u.polygonOffset(Kt,ct),me=Kt,Ge=ct)):Ke(u.POLYGON_OFFSET_FILL)}function kt(ze){ze?Fe(u.SCISSOR_TEST):Ke(u.SCISSOR_TEST)}function Me(ze){ze===void 0&&(ze=u.TEXTURE0+Ze-1),Ye!==ze&&(u.activeTexture(ze),Ye=ze)}function ve(ze,Kt,ct){ct===void 0&&(Ye===null?ct=u.TEXTURE0+Ze-1:ct=Ye);let bt=be[ct];bt===void 0&&(bt={type:void 0,texture:void 0},be[ct]=bt),(bt.type!==ze||bt.texture!==Kt)&&(Ye!==ct&&(u.activeTexture(ct),Ye=ct),u.bindTexture(ze,Kt||De[ze]),bt.type=ze,bt.texture=Kt)}function et(){const ze=be[Ye];ze!==void 0&&ze.type!==void 0&&(u.bindTexture(ze.type,null),ze.type=void 0,ze.texture=void 0)}function ht(){try{u.compressedTexImage2D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Xt(){try{u.compressedTexImage3D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Ue(){try{u.texSubImage2D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function ft(){try{u.texSubImage3D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Dt(){try{u.compressedTexSubImage2D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function jt(){try{u.compressedTexSubImage3D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function ii(){try{u.texStorage2D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function it(){try{u.texStorage3D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Gt(){try{u.texImage2D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Zt(){try{u.texImage3D(...arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Nt(ze){Ae.equals(ze)===!1&&(u.scissor(ze.x,ze.y,ze.z,ze.w),Ae.copy(ze))}function _t(ze){Re.equals(ze)===!1&&(u.viewport(ze.x,ze.y,ze.z,ze.w),Re.copy(ze))}function _e(ze,Kt){let ct=Z.get(Kt);ct===void 0&&(ct=new WeakMap,Z.set(Kt,ct));let bt=ct.get(ze);bt===void 0&&(bt=u.getUniformBlockIndex(Kt,ze.name),ct.set(ze,bt))}function Pe(ze,Kt){const bt=Z.get(Kt).get(ze);_.get(Kt)!==bt&&(u.uniformBlockBinding(Kt,bt,ze.__bindingPointIndex),_.set(Kt,bt))}function Je(){u.disable(u.BLEND),u.disable(u.CULL_FACE),u.disable(u.DEPTH_TEST),u.disable(u.POLYGON_OFFSET_FILL),u.disable(u.SCISSOR_TEST),u.disable(u.STENCIL_TEST),u.disable(u.SAMPLE_ALPHA_TO_COVERAGE),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ONE,u.ZERO),u.blendFuncSeparate(u.ONE,u.ZERO,u.ONE,u.ZERO),u.blendColor(0,0,0,0),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(u.LESS),y.setReversed(!1),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(u.ALWAYS,0,4294967295),u.stencilOp(u.KEEP,u.KEEP,u.KEEP),u.clearStencil(0),u.cullFace(u.BACK),u.frontFace(u.CCW),u.polygonOffset(0,0),u.activeTexture(u.TEXTURE0),u.bindFramebuffer(u.FRAMEBUFFER,null),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),M={},Ye=null,be={},V={},T=new WeakMap,H=[],F=null,O=!1,$=null,U=null,ee=null,Q=null,ie=null,ne=null,le=null,ae=new Color(0,0,0),ce=0,ge=!1,he=null,Ie=null,fe=null,me=null,Ge=null,Ae.set(0,0,u.canvas.width,u.canvas.height),Re.set(0,0,u.canvas.width,u.canvas.height),f.reset(),y.reset(),B.reset()}return{buffers:{color:f,depth:y,stencil:B},enable:Fe,disable:Ke,bindFramebuffer:Rt,drawBuffers:dt,useProgram:Ut,setBlending:we,setMaterial:Jt,setFlipSided:It,setCullFace:Ht,setLineWidth:mt,setPolygonOffset:ni,setScissorTest:kt,activeTexture:Me,bindTexture:ve,unbindTexture:et,compressedTexImage2D:ht,compressedTexImage3D:Xt,texImage2D:Gt,texImage3D:Zt,updateUBOMapping:_e,uniformBlockBinding:Pe,texStorage2D:ii,texStorage3D:it,texSubImage2D:Ue,texSubImage3D:ft,compressedTexSubImage2D:Dt,compressedTexSubImage3D:jt,scissor:Nt,viewport:_t,reset:Je}}function WebGLTextures(u,n,d,C,I,f,y){const B=n.has("WEBGL_multisampled_render_to_texture")?n.get("WEBGL_multisampled_render_to_texture"):null,_=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),Z=new Vector2,M=new WeakMap;let V;const T=new WeakMap;let H=!1;try{H=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function F(Me,ve){return H?new OffscreenCanvas(Me,ve):createElementNS("canvas")}function O(Me,ve,et){let ht=1;const Xt=kt(Me);if((Xt.width>et||Xt.height>et)&&(ht=et/Math.max(Xt.width,Xt.height)),ht<1)if(typeof HTMLImageElement<"u"&&Me instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Me instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Me instanceof ImageBitmap||typeof VideoFrame<"u"&&Me instanceof VideoFrame){const Ue=Math.floor(ht*Xt.width),ft=Math.floor(ht*Xt.height);V===void 0&&(V=F(Ue,ft));const Dt=ve?F(Ue,ft):V;return Dt.width=Ue,Dt.height=ft,Dt.getContext("2d").drawImage(Me,0,0,Ue,ft),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xt.width+"x"+Xt.height+") to ("+Ue+"x"+ft+")."),Dt}else return"data"in Me&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xt.width+"x"+Xt.height+")."),Me;return Me}function $(Me){return Me.generateMipmaps}function U(Me){u.generateMipmap(Me)}function ee(Me){return Me.isWebGLCubeRenderTarget?u.TEXTURE_CUBE_MAP:Me.isWebGL3DRenderTarget?u.TEXTURE_3D:Me.isWebGLArrayRenderTarget||Me.isCompressedArrayTexture?u.TEXTURE_2D_ARRAY:u.TEXTURE_2D}function Q(Me,ve,et,ht,Xt=!1){if(Me!==null){if(u[Me]!==void 0)return u[Me];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Me+"'")}let Ue=ve;if(ve===u.RED&&(et===u.FLOAT&&(Ue=u.R32F),et===u.HALF_FLOAT&&(Ue=u.R16F),et===u.UNSIGNED_BYTE&&(Ue=u.R8)),ve===u.RED_INTEGER&&(et===u.UNSIGNED_BYTE&&(Ue=u.R8UI),et===u.UNSIGNED_SHORT&&(Ue=u.R16UI),et===u.UNSIGNED_INT&&(Ue=u.R32UI),et===u.BYTE&&(Ue=u.R8I),et===u.SHORT&&(Ue=u.R16I),et===u.INT&&(Ue=u.R32I)),ve===u.RG&&(et===u.FLOAT&&(Ue=u.RG32F),et===u.HALF_FLOAT&&(Ue=u.RG16F),et===u.UNSIGNED_BYTE&&(Ue=u.RG8)),ve===u.RG_INTEGER&&(et===u.UNSIGNED_BYTE&&(Ue=u.RG8UI),et===u.UNSIGNED_SHORT&&(Ue=u.RG16UI),et===u.UNSIGNED_INT&&(Ue=u.RG32UI),et===u.BYTE&&(Ue=u.RG8I),et===u.SHORT&&(Ue=u.RG16I),et===u.INT&&(Ue=u.RG32I)),ve===u.RGB_INTEGER&&(et===u.UNSIGNED_BYTE&&(Ue=u.RGB8UI),et===u.UNSIGNED_SHORT&&(Ue=u.RGB16UI),et===u.UNSIGNED_INT&&(Ue=u.RGB32UI),et===u.BYTE&&(Ue=u.RGB8I),et===u.SHORT&&(Ue=u.RGB16I),et===u.INT&&(Ue=u.RGB32I)),ve===u.RGBA_INTEGER&&(et===u.UNSIGNED_BYTE&&(Ue=u.RGBA8UI),et===u.UNSIGNED_SHORT&&(Ue=u.RGBA16UI),et===u.UNSIGNED_INT&&(Ue=u.RGBA32UI),et===u.BYTE&&(Ue=u.RGBA8I),et===u.SHORT&&(Ue=u.RGBA16I),et===u.INT&&(Ue=u.RGBA32I)),ve===u.RGB&&et===u.UNSIGNED_INT_5_9_9_9_REV&&(Ue=u.RGB9_E5),ve===u.RGBA){const ft=Xt?LinearTransfer:ColorManagement.getTransfer(ht);et===u.FLOAT&&(Ue=u.RGBA32F),et===u.HALF_FLOAT&&(Ue=u.RGBA16F),et===u.UNSIGNED_BYTE&&(Ue=ft===SRGBTransfer?u.SRGB8_ALPHA8:u.RGBA8),et===u.UNSIGNED_SHORT_4_4_4_4&&(Ue=u.RGBA4),et===u.UNSIGNED_SHORT_5_5_5_1&&(Ue=u.RGB5_A1)}return(Ue===u.R16F||Ue===u.R32F||Ue===u.RG16F||Ue===u.RG32F||Ue===u.RGBA16F||Ue===u.RGBA32F)&&n.get("EXT_color_buffer_float"),Ue}function ie(Me,ve){let et;return Me?ve===null||ve===UnsignedIntType||ve===UnsignedInt248Type?et=u.DEPTH24_STENCIL8:ve===FloatType?et=u.DEPTH32F_STENCIL8:ve===UnsignedShortType&&(et=u.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ve===null||ve===UnsignedIntType||ve===UnsignedInt248Type?et=u.DEPTH_COMPONENT24:ve===FloatType?et=u.DEPTH_COMPONENT32F:ve===UnsignedShortType&&(et=u.DEPTH_COMPONENT16),et}function ne(Me,ve){return $(Me)===!0||Me.isFramebufferTexture&&Me.minFilter!==NearestFilter&&Me.minFilter!==LinearFilter?Math.log2(Math.max(ve.width,ve.height))+1:Me.mipmaps!==void 0&&Me.mipmaps.length>0?Me.mipmaps.length:Me.isCompressedTexture&&Array.isArray(Me.image)?ve.mipmaps.length:1}function le(Me){const ve=Me.target;ve.removeEventListener("dispose",le),ce(ve),ve.isVideoTexture&&M.delete(ve)}function ae(Me){const ve=Me.target;ve.removeEventListener("dispose",ae),he(ve)}function ce(Me){const ve=C.get(Me);if(ve.__webglInit===void 0)return;const et=Me.source,ht=T.get(et);if(ht){const Xt=ht[ve.__cacheKey];Xt.usedTimes--,Xt.usedTimes===0&&ge(Me),Object.keys(ht).length===0&&T.delete(et)}C.remove(Me)}function ge(Me){const ve=C.get(Me);u.deleteTexture(ve.__webglTexture);const et=Me.source,ht=T.get(et);delete ht[ve.__cacheKey],y.memory.textures--}function he(Me){const ve=C.get(Me);if(Me.depthTexture&&(Me.depthTexture.dispose(),C.remove(Me.depthTexture)),Me.isWebGLCubeRenderTarget)for(let ht=0;ht<6;ht++){if(Array.isArray(ve.__webglFramebuffer[ht]))for(let Xt=0;Xt<ve.__webglFramebuffer[ht].length;Xt++)u.deleteFramebuffer(ve.__webglFramebuffer[ht][Xt]);else u.deleteFramebuffer(ve.__webglFramebuffer[ht]);ve.__webglDepthbuffer&&u.deleteRenderbuffer(ve.__webglDepthbuffer[ht])}else{if(Array.isArray(ve.__webglFramebuffer))for(let ht=0;ht<ve.__webglFramebuffer.length;ht++)u.deleteFramebuffer(ve.__webglFramebuffer[ht]);else u.deleteFramebuffer(ve.__webglFramebuffer);if(ve.__webglDepthbuffer&&u.deleteRenderbuffer(ve.__webglDepthbuffer),ve.__webglMultisampledFramebuffer&&u.deleteFramebuffer(ve.__webglMultisampledFramebuffer),ve.__webglColorRenderbuffer)for(let ht=0;ht<ve.__webglColorRenderbuffer.length;ht++)ve.__webglColorRenderbuffer[ht]&&u.deleteRenderbuffer(ve.__webglColorRenderbuffer[ht]);ve.__webglDepthRenderbuffer&&u.deleteRenderbuffer(ve.__webglDepthRenderbuffer)}const et=Me.textures;for(let ht=0,Xt=et.length;ht<Xt;ht++){const Ue=C.get(et[ht]);Ue.__webglTexture&&(u.deleteTexture(Ue.__webglTexture),y.memory.textures--),C.remove(et[ht])}C.remove(Me)}let Ie=0;function fe(){Ie=0}function me(){const Me=Ie;return Me>=I.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Me+" texture units while this GPU supports only "+I.maxTextures),Ie+=1,Me}function Ge(Me){const ve=[];return ve.push(Me.wrapS),ve.push(Me.wrapT),ve.push(Me.wrapR||0),ve.push(Me.magFilter),ve.push(Me.minFilter),ve.push(Me.anisotropy),ve.push(Me.internalFormat),ve.push(Me.format),ve.push(Me.type),ve.push(Me.generateMipmaps),ve.push(Me.premultiplyAlpha),ve.push(Me.flipY),ve.push(Me.unpackAlignment),ve.push(Me.colorSpace),ve.join()}function Ze(Me,ve){const et=C.get(Me);if(Me.isVideoTexture&&mt(Me),Me.isRenderTargetTexture===!1&&Me.version>0&&et.__version!==Me.version){const ht=Me.image;if(ht===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ht.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Re(et,Me,ve);return}}d.bindTexture(u.TEXTURE_2D,et.__webglTexture,u.TEXTURE0+ve)}function ye(Me,ve){const et=C.get(Me);if(Me.version>0&&et.__version!==Me.version){Re(et,Me,ve);return}d.bindTexture(u.TEXTURE_2D_ARRAY,et.__webglTexture,u.TEXTURE0+ve)}function Ee(Me,ve){const et=C.get(Me);if(Me.version>0&&et.__version!==Me.version){Re(et,Me,ve);return}d.bindTexture(u.TEXTURE_3D,et.__webglTexture,u.TEXTURE0+ve)}function Ve(Me,ve){const et=C.get(Me);if(Me.version>0&&et.__version!==Me.version){We(et,Me,ve);return}d.bindTexture(u.TEXTURE_CUBE_MAP,et.__webglTexture,u.TEXTURE0+ve)}const Ye={[RepeatWrapping]:u.REPEAT,[ClampToEdgeWrapping]:u.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:u.MIRRORED_REPEAT},be={[NearestFilter]:u.NEAREST,[NearestMipmapNearestFilter]:u.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:u.NEAREST_MIPMAP_LINEAR,[LinearFilter]:u.LINEAR,[LinearMipmapNearestFilter]:u.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:u.LINEAR_MIPMAP_LINEAR},Be={[NeverCompare]:u.NEVER,[AlwaysCompare]:u.ALWAYS,[LessCompare]:u.LESS,[LessEqualCompare]:u.LEQUAL,[EqualCompare]:u.EQUAL,[GreaterEqualCompare]:u.GEQUAL,[GreaterCompare]:u.GREATER,[NotEqualCompare]:u.NOTEQUAL};function Ne(Me,ve){if(ve.type===FloatType&&n.has("OES_texture_float_linear")===!1&&(ve.magFilter===LinearFilter||ve.magFilter===LinearMipmapNearestFilter||ve.magFilter===NearestMipmapLinearFilter||ve.magFilter===LinearMipmapLinearFilter||ve.minFilter===LinearFilter||ve.minFilter===LinearMipmapNearestFilter||ve.minFilter===NearestMipmapLinearFilter||ve.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),u.texParameteri(Me,u.TEXTURE_WRAP_S,Ye[ve.wrapS]),u.texParameteri(Me,u.TEXTURE_WRAP_T,Ye[ve.wrapT]),(Me===u.TEXTURE_3D||Me===u.TEXTURE_2D_ARRAY)&&u.texParameteri(Me,u.TEXTURE_WRAP_R,Ye[ve.wrapR]),u.texParameteri(Me,u.TEXTURE_MAG_FILTER,be[ve.magFilter]),u.texParameteri(Me,u.TEXTURE_MIN_FILTER,be[ve.minFilter]),ve.compareFunction&&(u.texParameteri(Me,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.texParameteri(Me,u.TEXTURE_COMPARE_FUNC,Be[ve.compareFunction])),n.has("EXT_texture_filter_anisotropic")===!0){if(ve.magFilter===NearestFilter||ve.minFilter!==NearestMipmapLinearFilter&&ve.minFilter!==LinearMipmapLinearFilter||ve.type===FloatType&&n.has("OES_texture_float_linear")===!1)return;if(ve.anisotropy>1||C.get(ve).__currentAnisotropy){const et=n.get("EXT_texture_filter_anisotropic");u.texParameterf(Me,et.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ve.anisotropy,I.getMaxAnisotropy())),C.get(ve).__currentAnisotropy=ve.anisotropy}}}function Ae(Me,ve){let et=!1;Me.__webglInit===void 0&&(Me.__webglInit=!0,ve.addEventListener("dispose",le));const ht=ve.source;let Xt=T.get(ht);Xt===void 0&&(Xt={},T.set(ht,Xt));const Ue=Ge(ve);if(Ue!==Me.__cacheKey){Xt[Ue]===void 0&&(Xt[Ue]={texture:u.createTexture(),usedTimes:0},y.memory.textures++,et=!0),Xt[Ue].usedTimes++;const ft=Xt[Me.__cacheKey];ft!==void 0&&(Xt[Me.__cacheKey].usedTimes--,ft.usedTimes===0&&ge(ve)),Me.__cacheKey=Ue,Me.__webglTexture=Xt[Ue].texture}return et}function Re(Me,ve,et){let ht=u.TEXTURE_2D;(ve.isDataArrayTexture||ve.isCompressedArrayTexture)&&(ht=u.TEXTURE_2D_ARRAY),ve.isData3DTexture&&(ht=u.TEXTURE_3D);const Xt=Ae(Me,ve),Ue=ve.source;d.bindTexture(ht,Me.__webglTexture,u.TEXTURE0+et);const ft=C.get(Ue);if(Ue.version!==ft.__version||Xt===!0){d.activeTexture(u.TEXTURE0+et);const Dt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),jt=ve.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(ve.colorSpace),ii=ve.colorSpace===NoColorSpace||Dt===jt?u.NONE:u.BROWSER_DEFAULT_WEBGL;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,ve.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ve.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,ve.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,ii);let it=O(ve.image,!1,I.maxTextureSize);it=ni(ve,it);const Gt=f.convert(ve.format,ve.colorSpace),Zt=f.convert(ve.type);let Nt=Q(ve.internalFormat,Gt,Zt,ve.colorSpace,ve.isVideoTexture);Ne(ht,ve);let _t;const _e=ve.mipmaps,Pe=ve.isVideoTexture!==!0,Je=ft.__version===void 0||Xt===!0,ze=Ue.dataReady,Kt=ne(ve,it);if(ve.isDepthTexture)Nt=ie(ve.format===DepthStencilFormat,ve.type),Je&&(Pe?d.texStorage2D(u.TEXTURE_2D,1,Nt,it.width,it.height):d.texImage2D(u.TEXTURE_2D,0,Nt,it.width,it.height,0,Gt,Zt,null));else if(ve.isDataTexture)if(_e.length>0){Pe&&Je&&d.texStorage2D(u.TEXTURE_2D,Kt,Nt,_e[0].width,_e[0].height);for(let ct=0,bt=_e.length;ct<bt;ct++)_t=_e[ct],Pe?ze&&d.texSubImage2D(u.TEXTURE_2D,ct,0,0,_t.width,_t.height,Gt,Zt,_t.data):d.texImage2D(u.TEXTURE_2D,ct,Nt,_t.width,_t.height,0,Gt,Zt,_t.data);ve.generateMipmaps=!1}else Pe?(Je&&d.texStorage2D(u.TEXTURE_2D,Kt,Nt,it.width,it.height),ze&&d.texSubImage2D(u.TEXTURE_2D,0,0,0,it.width,it.height,Gt,Zt,it.data)):d.texImage2D(u.TEXTURE_2D,0,Nt,it.width,it.height,0,Gt,Zt,it.data);else if(ve.isCompressedTexture)if(ve.isCompressedArrayTexture){Pe&&Je&&d.texStorage3D(u.TEXTURE_2D_ARRAY,Kt,Nt,_e[0].width,_e[0].height,it.depth);for(let ct=0,bt=_e.length;ct<bt;ct++)if(_t=_e[ct],ve.format!==RGBAFormat)if(Gt!==null)if(Pe){if(ze)if(ve.layerUpdates.size>0){const Tt=getByteLength(_t.width,_t.height,ve.format,ve.type);for(const $t of ve.layerUpdates){const si=_t.data.subarray($t*Tt/_t.data.BYTES_PER_ELEMENT,($t+1)*Tt/_t.data.BYTES_PER_ELEMENT);d.compressedTexSubImage3D(u.TEXTURE_2D_ARRAY,ct,0,0,$t,_t.width,_t.height,1,Gt,si)}ve.clearLayerUpdates()}else d.compressedTexSubImage3D(u.TEXTURE_2D_ARRAY,ct,0,0,0,_t.width,_t.height,it.depth,Gt,_t.data)}else d.compressedTexImage3D(u.TEXTURE_2D_ARRAY,ct,Nt,_t.width,_t.height,it.depth,0,_t.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Pe?ze&&d.texSubImage3D(u.TEXTURE_2D_ARRAY,ct,0,0,0,_t.width,_t.height,it.depth,Gt,Zt,_t.data):d.texImage3D(u.TEXTURE_2D_ARRAY,ct,Nt,_t.width,_t.height,it.depth,0,Gt,Zt,_t.data)}else{Pe&&Je&&d.texStorage2D(u.TEXTURE_2D,Kt,Nt,_e[0].width,_e[0].height);for(let ct=0,bt=_e.length;ct<bt;ct++)_t=_e[ct],ve.format!==RGBAFormat?Gt!==null?Pe?ze&&d.compressedTexSubImage2D(u.TEXTURE_2D,ct,0,0,_t.width,_t.height,Gt,_t.data):d.compressedTexImage2D(u.TEXTURE_2D,ct,Nt,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pe?ze&&d.texSubImage2D(u.TEXTURE_2D,ct,0,0,_t.width,_t.height,Gt,Zt,_t.data):d.texImage2D(u.TEXTURE_2D,ct,Nt,_t.width,_t.height,0,Gt,Zt,_t.data)}else if(ve.isDataArrayTexture)if(Pe){if(Je&&d.texStorage3D(u.TEXTURE_2D_ARRAY,Kt,Nt,it.width,it.height,it.depth),ze)if(ve.layerUpdates.size>0){const ct=getByteLength(it.width,it.height,ve.format,ve.type);for(const bt of ve.layerUpdates){const Tt=it.data.subarray(bt*ct/it.data.BYTES_PER_ELEMENT,(bt+1)*ct/it.data.BYTES_PER_ELEMENT);d.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,bt,it.width,it.height,1,Gt,Zt,Tt)}ve.clearLayerUpdates()}else d.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,0,it.width,it.height,it.depth,Gt,Zt,it.data)}else d.texImage3D(u.TEXTURE_2D_ARRAY,0,Nt,it.width,it.height,it.depth,0,Gt,Zt,it.data);else if(ve.isData3DTexture)Pe?(Je&&d.texStorage3D(u.TEXTURE_3D,Kt,Nt,it.width,it.height,it.depth),ze&&d.texSubImage3D(u.TEXTURE_3D,0,0,0,0,it.width,it.height,it.depth,Gt,Zt,it.data)):d.texImage3D(u.TEXTURE_3D,0,Nt,it.width,it.height,it.depth,0,Gt,Zt,it.data);else if(ve.isFramebufferTexture){if(Je)if(Pe)d.texStorage2D(u.TEXTURE_2D,Kt,Nt,it.width,it.height);else{let ct=it.width,bt=it.height;for(let Tt=0;Tt<Kt;Tt++)d.texImage2D(u.TEXTURE_2D,Tt,Nt,ct,bt,0,Gt,Zt,null),ct>>=1,bt>>=1}}else if(_e.length>0){if(Pe&&Je){const ct=kt(_e[0]);d.texStorage2D(u.TEXTURE_2D,Kt,Nt,ct.width,ct.height)}for(let ct=0,bt=_e.length;ct<bt;ct++)_t=_e[ct],Pe?ze&&d.texSubImage2D(u.TEXTURE_2D,ct,0,0,Gt,Zt,_t):d.texImage2D(u.TEXTURE_2D,ct,Nt,Gt,Zt,_t);ve.generateMipmaps=!1}else if(Pe){if(Je){const ct=kt(it);d.texStorage2D(u.TEXTURE_2D,Kt,Nt,ct.width,ct.height)}ze&&d.texSubImage2D(u.TEXTURE_2D,0,0,0,Gt,Zt,it)}else d.texImage2D(u.TEXTURE_2D,0,Nt,Gt,Zt,it);$(ve)&&U(ht),ft.__version=Ue.version,ve.onUpdate&&ve.onUpdate(ve)}Me.__version=ve.version}function We(Me,ve,et){if(ve.image.length!==6)return;const ht=Ae(Me,ve),Xt=ve.source;d.bindTexture(u.TEXTURE_CUBE_MAP,Me.__webglTexture,u.TEXTURE0+et);const Ue=C.get(Xt);if(Xt.version!==Ue.__version||ht===!0){d.activeTexture(u.TEXTURE0+et);const ft=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),Dt=ve.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(ve.colorSpace),jt=ve.colorSpace===NoColorSpace||ft===Dt?u.NONE:u.BROWSER_DEFAULT_WEBGL;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,ve.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ve.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,ve.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,jt);const ii=ve.isCompressedTexture||ve.image[0].isCompressedTexture,it=ve.image[0]&&ve.image[0].isDataTexture,Gt=[];for(let bt=0;bt<6;bt++)!ii&&!it?Gt[bt]=O(ve.image[bt],!0,I.maxCubemapSize):Gt[bt]=it?ve.image[bt].image:ve.image[bt],Gt[bt]=ni(ve,Gt[bt]);const Zt=Gt[0],Nt=f.convert(ve.format,ve.colorSpace),_t=f.convert(ve.type),_e=Q(ve.internalFormat,Nt,_t,ve.colorSpace),Pe=ve.isVideoTexture!==!0,Je=Ue.__version===void 0||ht===!0,ze=Xt.dataReady;let Kt=ne(ve,Zt);Ne(u.TEXTURE_CUBE_MAP,ve);let ct;if(ii){Pe&&Je&&d.texStorage2D(u.TEXTURE_CUBE_MAP,Kt,_e,Zt.width,Zt.height);for(let bt=0;bt<6;bt++){ct=Gt[bt].mipmaps;for(let Tt=0;Tt<ct.length;Tt++){const $t=ct[Tt];ve.format!==RGBAFormat?Nt!==null?Pe?ze&&d.compressedTexSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt,0,0,$t.width,$t.height,Nt,$t.data):d.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt,_e,$t.width,$t.height,0,$t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pe?ze&&d.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt,0,0,$t.width,$t.height,Nt,_t,$t.data):d.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt,_e,$t.width,$t.height,0,Nt,_t,$t.data)}}}else{if(ct=ve.mipmaps,Pe&&Je){ct.length>0&&Kt++;const bt=kt(Gt[0]);d.texStorage2D(u.TEXTURE_CUBE_MAP,Kt,_e,bt.width,bt.height)}for(let bt=0;bt<6;bt++)if(it){Pe?ze&&d.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0,0,0,Gt[bt].width,Gt[bt].height,Nt,_t,Gt[bt].data):d.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0,_e,Gt[bt].width,Gt[bt].height,0,Nt,_t,Gt[bt].data);for(let Tt=0;Tt<ct.length;Tt++){const si=ct[Tt].image[bt].image;Pe?ze&&d.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt+1,0,0,si.width,si.height,Nt,_t,si.data):d.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt+1,_e,si.width,si.height,0,Nt,_t,si.data)}}else{Pe?ze&&d.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0,0,0,Nt,_t,Gt[bt]):d.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0,_e,Nt,_t,Gt[bt]);for(let Tt=0;Tt<ct.length;Tt++){const $t=ct[Tt];Pe?ze&&d.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt+1,0,0,Nt,_t,$t.image[bt]):d.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Tt+1,_e,Nt,_t,$t.image[bt])}}}$(ve)&&U(u.TEXTURE_CUBE_MAP),Ue.__version=Xt.version,ve.onUpdate&&ve.onUpdate(ve)}Me.__version=ve.version}function De(Me,ve,et,ht,Xt,Ue){const ft=f.convert(et.format,et.colorSpace),Dt=f.convert(et.type),jt=Q(et.internalFormat,ft,Dt,et.colorSpace),ii=C.get(ve),it=C.get(et);if(it.__renderTarget=ve,!ii.__hasExternalTextures){const Gt=Math.max(1,ve.width>>Ue),Zt=Math.max(1,ve.height>>Ue);Xt===u.TEXTURE_3D||Xt===u.TEXTURE_2D_ARRAY?d.texImage3D(Xt,Ue,jt,Gt,Zt,ve.depth,0,ft,Dt,null):d.texImage2D(Xt,Ue,jt,Gt,Zt,0,ft,Dt,null)}d.bindFramebuffer(u.FRAMEBUFFER,Me),Ht(ve)?B.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,ht,Xt,it.__webglTexture,0,It(ve)):(Xt===u.TEXTURE_2D||Xt>=u.TEXTURE_CUBE_MAP_POSITIVE_X&&Xt<=u.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&u.framebufferTexture2D(u.FRAMEBUFFER,ht,Xt,it.__webglTexture,Ue),d.bindFramebuffer(u.FRAMEBUFFER,null)}function Fe(Me,ve,et){if(u.bindRenderbuffer(u.RENDERBUFFER,Me),ve.depthBuffer){const ht=ve.depthTexture,Xt=ht&&ht.isDepthTexture?ht.type:null,Ue=ie(ve.stencilBuffer,Xt),ft=ve.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,Dt=It(ve);Ht(ve)?B.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,Dt,Ue,ve.width,ve.height):et?u.renderbufferStorageMultisample(u.RENDERBUFFER,Dt,Ue,ve.width,ve.height):u.renderbufferStorage(u.RENDERBUFFER,Ue,ve.width,ve.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,ft,u.RENDERBUFFER,Me)}else{const ht=ve.textures;for(let Xt=0;Xt<ht.length;Xt++){const Ue=ht[Xt],ft=f.convert(Ue.format,Ue.colorSpace),Dt=f.convert(Ue.type),jt=Q(Ue.internalFormat,ft,Dt,Ue.colorSpace),ii=It(ve);et&&Ht(ve)===!1?u.renderbufferStorageMultisample(u.RENDERBUFFER,ii,jt,ve.width,ve.height):Ht(ve)?B.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,ii,jt,ve.width,ve.height):u.renderbufferStorage(u.RENDERBUFFER,jt,ve.width,ve.height)}}u.bindRenderbuffer(u.RENDERBUFFER,null)}function Ke(Me,ve){if(ve&&ve.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(d.bindFramebuffer(u.FRAMEBUFFER,Me),!(ve.depthTexture&&ve.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ht=C.get(ve.depthTexture);ht.__renderTarget=ve,(!ht.__webglTexture||ve.depthTexture.image.width!==ve.width||ve.depthTexture.image.height!==ve.height)&&(ve.depthTexture.image.width=ve.width,ve.depthTexture.image.height=ve.height,ve.depthTexture.needsUpdate=!0),Ze(ve.depthTexture,0);const Xt=ht.__webglTexture,Ue=It(ve);if(ve.depthTexture.format===DepthFormat)Ht(ve)?B.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,Xt,0,Ue):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,Xt,0);else if(ve.depthTexture.format===DepthStencilFormat)Ht(ve)?B.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,Xt,0,Ue):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,Xt,0);else throw new Error("Unknown depthTexture format")}function Rt(Me){const ve=C.get(Me),et=Me.isWebGLCubeRenderTarget===!0;if(ve.__boundDepthTexture!==Me.depthTexture){const ht=Me.depthTexture;if(ve.__depthDisposeCallback&&ve.__depthDisposeCallback(),ht){const Xt=()=>{delete ve.__boundDepthTexture,delete ve.__depthDisposeCallback,ht.removeEventListener("dispose",Xt)};ht.addEventListener("dispose",Xt),ve.__depthDisposeCallback=Xt}ve.__boundDepthTexture=ht}if(Me.depthTexture&&!ve.__autoAllocateDepthBuffer){if(et)throw new Error("target.depthTexture not supported in Cube render targets");Ke(ve.__webglFramebuffer,Me)}else if(et){ve.__webglDepthbuffer=[];for(let ht=0;ht<6;ht++)if(d.bindFramebuffer(u.FRAMEBUFFER,ve.__webglFramebuffer[ht]),ve.__webglDepthbuffer[ht]===void 0)ve.__webglDepthbuffer[ht]=u.createRenderbuffer(),Fe(ve.__webglDepthbuffer[ht],Me,!1);else{const Xt=Me.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,Ue=ve.__webglDepthbuffer[ht];u.bindRenderbuffer(u.RENDERBUFFER,Ue),u.framebufferRenderbuffer(u.FRAMEBUFFER,Xt,u.RENDERBUFFER,Ue)}}else if(d.bindFramebuffer(u.FRAMEBUFFER,ve.__webglFramebuffer),ve.__webglDepthbuffer===void 0)ve.__webglDepthbuffer=u.createRenderbuffer(),Fe(ve.__webglDepthbuffer,Me,!1);else{const ht=Me.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,Xt=ve.__webglDepthbuffer;u.bindRenderbuffer(u.RENDERBUFFER,Xt),u.framebufferRenderbuffer(u.FRAMEBUFFER,ht,u.RENDERBUFFER,Xt)}d.bindFramebuffer(u.FRAMEBUFFER,null)}function dt(Me,ve,et){const ht=C.get(Me);ve!==void 0&&De(ht.__webglFramebuffer,Me,Me.texture,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,0),et!==void 0&&Rt(Me)}function Ut(Me){const ve=Me.texture,et=C.get(Me),ht=C.get(ve);Me.addEventListener("dispose",ae);const Xt=Me.textures,Ue=Me.isWebGLCubeRenderTarget===!0,ft=Xt.length>1;if(ft||(ht.__webglTexture===void 0&&(ht.__webglTexture=u.createTexture()),ht.__version=ve.version,y.memory.textures++),Ue){et.__webglFramebuffer=[];for(let Dt=0;Dt<6;Dt++)if(ve.mipmaps&&ve.mipmaps.length>0){et.__webglFramebuffer[Dt]=[];for(let jt=0;jt<ve.mipmaps.length;jt++)et.__webglFramebuffer[Dt][jt]=u.createFramebuffer()}else et.__webglFramebuffer[Dt]=u.createFramebuffer()}else{if(ve.mipmaps&&ve.mipmaps.length>0){et.__webglFramebuffer=[];for(let Dt=0;Dt<ve.mipmaps.length;Dt++)et.__webglFramebuffer[Dt]=u.createFramebuffer()}else et.__webglFramebuffer=u.createFramebuffer();if(ft)for(let Dt=0,jt=Xt.length;Dt<jt;Dt++){const ii=C.get(Xt[Dt]);ii.__webglTexture===void 0&&(ii.__webglTexture=u.createTexture(),y.memory.textures++)}if(Me.samples>0&&Ht(Me)===!1){et.__webglMultisampledFramebuffer=u.createFramebuffer(),et.__webglColorRenderbuffer=[],d.bindFramebuffer(u.FRAMEBUFFER,et.__webglMultisampledFramebuffer);for(let Dt=0;Dt<Xt.length;Dt++){const jt=Xt[Dt];et.__webglColorRenderbuffer[Dt]=u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,et.__webglColorRenderbuffer[Dt]);const ii=f.convert(jt.format,jt.colorSpace),it=f.convert(jt.type),Gt=Q(jt.internalFormat,ii,it,jt.colorSpace,Me.isXRRenderTarget===!0),Zt=It(Me);u.renderbufferStorageMultisample(u.RENDERBUFFER,Zt,Gt,Me.width,Me.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+Dt,u.RENDERBUFFER,et.__webglColorRenderbuffer[Dt])}u.bindRenderbuffer(u.RENDERBUFFER,null),Me.depthBuffer&&(et.__webglDepthRenderbuffer=u.createRenderbuffer(),Fe(et.__webglDepthRenderbuffer,Me,!0)),d.bindFramebuffer(u.FRAMEBUFFER,null)}}if(Ue){d.bindTexture(u.TEXTURE_CUBE_MAP,ht.__webglTexture),Ne(u.TEXTURE_CUBE_MAP,ve);for(let Dt=0;Dt<6;Dt++)if(ve.mipmaps&&ve.mipmaps.length>0)for(let jt=0;jt<ve.mipmaps.length;jt++)De(et.__webglFramebuffer[Dt][jt],Me,ve,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+Dt,jt);else De(et.__webglFramebuffer[Dt],Me,ve,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+Dt,0);$(ve)&&U(u.TEXTURE_CUBE_MAP),d.unbindTexture()}else if(ft){for(let Dt=0,jt=Xt.length;Dt<jt;Dt++){const ii=Xt[Dt],it=C.get(ii);d.bindTexture(u.TEXTURE_2D,it.__webglTexture),Ne(u.TEXTURE_2D,ii),De(et.__webglFramebuffer,Me,ii,u.COLOR_ATTACHMENT0+Dt,u.TEXTURE_2D,0),$(ii)&&U(u.TEXTURE_2D)}d.unbindTexture()}else{let Dt=u.TEXTURE_2D;if((Me.isWebGL3DRenderTarget||Me.isWebGLArrayRenderTarget)&&(Dt=Me.isWebGL3DRenderTarget?u.TEXTURE_3D:u.TEXTURE_2D_ARRAY),d.bindTexture(Dt,ht.__webglTexture),Ne(Dt,ve),ve.mipmaps&&ve.mipmaps.length>0)for(let jt=0;jt<ve.mipmaps.length;jt++)De(et.__webglFramebuffer[jt],Me,ve,u.COLOR_ATTACHMENT0,Dt,jt);else De(et.__webglFramebuffer,Me,ve,u.COLOR_ATTACHMENT0,Dt,0);$(ve)&&U(Dt),d.unbindTexture()}Me.depthBuffer&&Rt(Me)}function rt(Me){const ve=Me.textures;for(let et=0,ht=ve.length;et<ht;et++){const Xt=ve[et];if($(Xt)){const Ue=ee(Me),ft=C.get(Xt).__webglTexture;d.bindTexture(Ue,ft),U(Ue),d.unbindTexture()}}}const nt=[],we=[];function Jt(Me){if(Me.samples>0){if(Ht(Me)===!1){const ve=Me.textures,et=Me.width,ht=Me.height;let Xt=u.COLOR_BUFFER_BIT;const Ue=Me.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,ft=C.get(Me),Dt=ve.length>1;if(Dt)for(let jt=0;jt<ve.length;jt++)d.bindFramebuffer(u.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+jt,u.RENDERBUFFER,null),d.bindFramebuffer(u.FRAMEBUFFER,ft.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+jt,u.TEXTURE_2D,null,0);d.bindFramebuffer(u.READ_FRAMEBUFFER,ft.__webglMultisampledFramebuffer),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,ft.__webglFramebuffer);for(let jt=0;jt<ve.length;jt++){if(Me.resolveDepthBuffer&&(Me.depthBuffer&&(Xt|=u.DEPTH_BUFFER_BIT),Me.stencilBuffer&&Me.resolveStencilBuffer&&(Xt|=u.STENCIL_BUFFER_BIT)),Dt){u.framebufferRenderbuffer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,ft.__webglColorRenderbuffer[jt]);const ii=C.get(ve[jt]).__webglTexture;u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,ii,0)}u.blitFramebuffer(0,0,et,ht,0,0,et,ht,Xt,u.NEAREST),_===!0&&(nt.length=0,we.length=0,nt.push(u.COLOR_ATTACHMENT0+jt),Me.depthBuffer&&Me.resolveDepthBuffer===!1&&(nt.push(Ue),we.push(Ue),u.invalidateFramebuffer(u.DRAW_FRAMEBUFFER,we)),u.invalidateFramebuffer(u.READ_FRAMEBUFFER,nt))}if(d.bindFramebuffer(u.READ_FRAMEBUFFER,null),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),Dt)for(let jt=0;jt<ve.length;jt++){d.bindFramebuffer(u.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+jt,u.RENDERBUFFER,ft.__webglColorRenderbuffer[jt]);const ii=C.get(ve[jt]).__webglTexture;d.bindFramebuffer(u.FRAMEBUFFER,ft.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+jt,u.TEXTURE_2D,ii,0)}d.bindFramebuffer(u.DRAW_FRAMEBUFFER,ft.__webglMultisampledFramebuffer)}else if(Me.depthBuffer&&Me.resolveDepthBuffer===!1&&_){const ve=Me.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT;u.invalidateFramebuffer(u.DRAW_FRAMEBUFFER,[ve])}}}function It(Me){return Math.min(I.maxSamples,Me.samples)}function Ht(Me){const ve=C.get(Me);return Me.samples>0&&n.has("WEBGL_multisampled_render_to_texture")===!0&&ve.__useRenderToTexture!==!1}function mt(Me){const ve=y.render.frame;M.get(Me)!==ve&&(M.set(Me,ve),Me.update())}function ni(Me,ve){const et=Me.colorSpace,ht=Me.format,Xt=Me.type;return Me.isCompressedTexture===!0||Me.isVideoTexture===!0||et!==LinearSRGBColorSpace&&et!==NoColorSpace&&(ColorManagement.getTransfer(et)===SRGBTransfer?(ht!==RGBAFormat||Xt!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",et)),ve}function kt(Me){return typeof HTMLImageElement<"u"&&Me instanceof HTMLImageElement?(Z.width=Me.naturalWidth||Me.width,Z.height=Me.naturalHeight||Me.height):typeof VideoFrame<"u"&&Me instanceof VideoFrame?(Z.width=Me.displayWidth,Z.height=Me.displayHeight):(Z.width=Me.width,Z.height=Me.height),Z}this.allocateTextureUnit=me,this.resetTextureUnits=fe,this.setTexture2D=Ze,this.setTexture2DArray=ye,this.setTexture3D=Ee,this.setTextureCube=Ve,this.rebindTextures=dt,this.setupRenderTarget=Ut,this.updateRenderTargetMipmap=rt,this.updateMultisampleRenderTarget=Jt,this.setupDepthRenderbuffer=Rt,this.setupFrameBufferTexture=De,this.useMultisampledRTT=Ht}function WebGLUtils(u,n){function d(C,I=NoColorSpace){let f;const y=ColorManagement.getTransfer(I);if(C===UnsignedByteType)return u.UNSIGNED_BYTE;if(C===UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(C===UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(C===UnsignedInt5999Type)return u.UNSIGNED_INT_5_9_9_9_REV;if(C===ByteType)return u.BYTE;if(C===ShortType)return u.SHORT;if(C===UnsignedShortType)return u.UNSIGNED_SHORT;if(C===IntType)return u.INT;if(C===UnsignedIntType)return u.UNSIGNED_INT;if(C===FloatType)return u.FLOAT;if(C===HalfFloatType)return u.HALF_FLOAT;if(C===AlphaFormat)return u.ALPHA;if(C===RGBFormat)return u.RGB;if(C===RGBAFormat)return u.RGBA;if(C===LuminanceFormat)return u.LUMINANCE;if(C===LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(C===DepthFormat)return u.DEPTH_COMPONENT;if(C===DepthStencilFormat)return u.DEPTH_STENCIL;if(C===RedFormat)return u.RED;if(C===RedIntegerFormat)return u.RED_INTEGER;if(C===RGFormat)return u.RG;if(C===RGIntegerFormat)return u.RG_INTEGER;if(C===RGBAIntegerFormat)return u.RGBA_INTEGER;if(C===RGB_S3TC_DXT1_Format||C===RGBA_S3TC_DXT1_Format||C===RGBA_S3TC_DXT3_Format||C===RGBA_S3TC_DXT5_Format)if(y===SRGBTransfer)if(f=n.get("WEBGL_compressed_texture_s3tc_srgb"),f!==null){if(C===RGB_S3TC_DXT1_Format)return f.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(C===RGBA_S3TC_DXT1_Format)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(C===RGBA_S3TC_DXT3_Format)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(C===RGBA_S3TC_DXT5_Format)return f.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(f=n.get("WEBGL_compressed_texture_s3tc"),f!==null){if(C===RGB_S3TC_DXT1_Format)return f.COMPRESSED_RGB_S3TC_DXT1_EXT;if(C===RGBA_S3TC_DXT1_Format)return f.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(C===RGBA_S3TC_DXT3_Format)return f.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(C===RGBA_S3TC_DXT5_Format)return f.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(C===RGB_PVRTC_4BPPV1_Format||C===RGB_PVRTC_2BPPV1_Format||C===RGBA_PVRTC_4BPPV1_Format||C===RGBA_PVRTC_2BPPV1_Format)if(f=n.get("WEBGL_compressed_texture_pvrtc"),f!==null){if(C===RGB_PVRTC_4BPPV1_Format)return f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(C===RGB_PVRTC_2BPPV1_Format)return f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(C===RGBA_PVRTC_4BPPV1_Format)return f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(C===RGBA_PVRTC_2BPPV1_Format)return f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(C===RGB_ETC1_Format||C===RGB_ETC2_Format||C===RGBA_ETC2_EAC_Format)if(f=n.get("WEBGL_compressed_texture_etc"),f!==null){if(C===RGB_ETC1_Format||C===RGB_ETC2_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ETC2:f.COMPRESSED_RGB8_ETC2;if(C===RGBA_ETC2_EAC_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:f.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(C===RGBA_ASTC_4x4_Format||C===RGBA_ASTC_5x4_Format||C===RGBA_ASTC_5x5_Format||C===RGBA_ASTC_6x5_Format||C===RGBA_ASTC_6x6_Format||C===RGBA_ASTC_8x5_Format||C===RGBA_ASTC_8x6_Format||C===RGBA_ASTC_8x8_Format||C===RGBA_ASTC_10x5_Format||C===RGBA_ASTC_10x6_Format||C===RGBA_ASTC_10x8_Format||C===RGBA_ASTC_10x10_Format||C===RGBA_ASTC_12x10_Format||C===RGBA_ASTC_12x12_Format)if(f=n.get("WEBGL_compressed_texture_astc"),f!==null){if(C===RGBA_ASTC_4x4_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:f.COMPRESSED_RGBA_ASTC_4x4_KHR;if(C===RGBA_ASTC_5x4_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:f.COMPRESSED_RGBA_ASTC_5x4_KHR;if(C===RGBA_ASTC_5x5_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:f.COMPRESSED_RGBA_ASTC_5x5_KHR;if(C===RGBA_ASTC_6x5_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:f.COMPRESSED_RGBA_ASTC_6x5_KHR;if(C===RGBA_ASTC_6x6_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:f.COMPRESSED_RGBA_ASTC_6x6_KHR;if(C===RGBA_ASTC_8x5_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:f.COMPRESSED_RGBA_ASTC_8x5_KHR;if(C===RGBA_ASTC_8x6_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:f.COMPRESSED_RGBA_ASTC_8x6_KHR;if(C===RGBA_ASTC_8x8_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:f.COMPRESSED_RGBA_ASTC_8x8_KHR;if(C===RGBA_ASTC_10x5_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:f.COMPRESSED_RGBA_ASTC_10x5_KHR;if(C===RGBA_ASTC_10x6_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:f.COMPRESSED_RGBA_ASTC_10x6_KHR;if(C===RGBA_ASTC_10x8_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:f.COMPRESSED_RGBA_ASTC_10x8_KHR;if(C===RGBA_ASTC_10x10_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:f.COMPRESSED_RGBA_ASTC_10x10_KHR;if(C===RGBA_ASTC_12x10_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:f.COMPRESSED_RGBA_ASTC_12x10_KHR;if(C===RGBA_ASTC_12x12_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:f.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(C===RGBA_BPTC_Format||C===RGB_BPTC_SIGNED_Format||C===RGB_BPTC_UNSIGNED_Format)if(f=n.get("EXT_texture_compression_bptc"),f!==null){if(C===RGBA_BPTC_Format)return y===SRGBTransfer?f.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:f.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(C===RGB_BPTC_SIGNED_Format)return f.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(C===RGB_BPTC_UNSIGNED_Format)return f.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(C===RED_RGTC1_Format||C===SIGNED_RED_RGTC1_Format||C===RED_GREEN_RGTC2_Format||C===SIGNED_RED_GREEN_RGTC2_Format)if(f=n.get("EXT_texture_compression_rgtc"),f!==null){if(C===RGBA_BPTC_Format)return f.COMPRESSED_RED_RGTC1_EXT;if(C===SIGNED_RED_RGTC1_Format)return f.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(C===RED_GREEN_RGTC2_Format)return f.COMPRESSED_RED_GREEN_RGTC2_EXT;if(C===SIGNED_RED_GREEN_RGTC2_Format)return f.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return C===UnsignedInt248Type?u.UNSIGNED_INT_24_8:u[C]!==void 0?u[C]:null}return{convert:d}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(n,d,C){if(this.texture===null){const I=new Texture,f=n.properties.get(I);f.__webglTexture=d.texture,(d.depthNear!==C.depthNear||d.depthFar!==C.depthFar)&&(this.depthNear=d.depthNear,this.depthFar=d.depthFar),this.texture=I}}getMesh(n){if(this.texture!==null&&this.mesh===null){const d=n.cameras[0].viewport,C=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:d.z},depthHeight:{value:d.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),C)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher$1{constructor(n,d){super();const C=this;let I=null,f=1,y=null,B="local-floor",_=1,Z=null,M=null,V=null,T=null,H=null,F=null;const O=new WebXRDepthSensing,$=d.getContextAttributes();let U=null,ee=null;const Q=[],ie=[],ne=new Vector2;let le=null;const ae=new PerspectiveCamera;ae.viewport=new Vector4;const ce=new PerspectiveCamera;ce.viewport=new Vector4;const ge=[ae,ce],he=new ArrayCamera;let Ie=null,fe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Re){let We=Q[Re];return We===void 0&&(We=new WebXRController,Q[Re]=We),We.getTargetRaySpace()},this.getControllerGrip=function(Re){let We=Q[Re];return We===void 0&&(We=new WebXRController,Q[Re]=We),We.getGripSpace()},this.getHand=function(Re){let We=Q[Re];return We===void 0&&(We=new WebXRController,Q[Re]=We),We.getHandSpace()};function me(Re){const We=ie.indexOf(Re.inputSource);if(We===-1)return;const De=Q[We];De!==void 0&&(De.update(Re.inputSource,Re.frame,Z||y),De.dispatchEvent({type:Re.type,data:Re.inputSource}))}function Ge(){I.removeEventListener("select",me),I.removeEventListener("selectstart",me),I.removeEventListener("selectend",me),I.removeEventListener("squeeze",me),I.removeEventListener("squeezestart",me),I.removeEventListener("squeezeend",me),I.removeEventListener("end",Ge),I.removeEventListener("inputsourceschange",Ze);for(let Re=0;Re<Q.length;Re++){const We=ie[Re];We!==null&&(ie[Re]=null,Q[Re].disconnect(We))}Ie=null,fe=null,O.reset(),n.setRenderTarget(U),H=null,T=null,V=null,I=null,ee=null,Ae.stop(),C.isPresenting=!1,n.setPixelRatio(le),n.setSize(ne.width,ne.height,!1),C.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Re){f=Re,C.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Re){B=Re,C.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return Z||y},this.setReferenceSpace=function(Re){Z=Re},this.getBaseLayer=function(){return T!==null?T:H},this.getBinding=function(){return V},this.getFrame=function(){return F},this.getSession=function(){return I},this.setSession=async function(Re){if(I=Re,I!==null){if(U=n.getRenderTarget(),I.addEventListener("select",me),I.addEventListener("selectstart",me),I.addEventListener("selectend",me),I.addEventListener("squeeze",me),I.addEventListener("squeezestart",me),I.addEventListener("squeezeend",me),I.addEventListener("end",Ge),I.addEventListener("inputsourceschange",Ze),$.xrCompatible!==!0&&await d.makeXRCompatible(),le=n.getPixelRatio(),n.getSize(ne),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let De=null,Fe=null,Ke=null;$.depth&&(Ke=$.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,De=$.stencil?DepthStencilFormat:DepthFormat,Fe=$.stencil?UnsignedInt248Type:UnsignedIntType);const Rt={colorFormat:d.RGBA8,depthFormat:Ke,scaleFactor:f};V=new XRWebGLBinding(I,d),T=V.createProjectionLayer(Rt),I.updateRenderState({layers:[T]}),n.setPixelRatio(1),n.setSize(T.textureWidth,T.textureHeight,!1),ee=new WebGLRenderTarget(T.textureWidth,T.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(T.textureWidth,T.textureHeight,Fe,void 0,void 0,void 0,void 0,void 0,void 0,De),stencilBuffer:$.stencil,colorSpace:n.outputColorSpace,samples:$.antialias?4:0,resolveDepthBuffer:T.ignoreDepthValues===!1,resolveStencilBuffer:T.ignoreDepthValues===!1})}else{const De={antialias:$.antialias,alpha:!0,depth:$.depth,stencil:$.stencil,framebufferScaleFactor:f};H=new XRWebGLLayer(I,d,De),I.updateRenderState({baseLayer:H}),n.setPixelRatio(1),n.setSize(H.framebufferWidth,H.framebufferHeight,!1),ee=new WebGLRenderTarget(H.framebufferWidth,H.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:n.outputColorSpace,stencilBuffer:$.stencil,resolveDepthBuffer:H.ignoreDepthValues===!1,resolveStencilBuffer:H.ignoreDepthValues===!1})}ee.isXRRenderTarget=!0,this.setFoveation(_),Z=null,y=await I.requestReferenceSpace(B),Ae.setContext(I),Ae.start(),C.isPresenting=!0,C.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(I!==null)return I.environmentBlendMode},this.getDepthTexture=function(){return O.getDepthTexture()};function Ze(Re){for(let We=0;We<Re.removed.length;We++){const De=Re.removed[We],Fe=ie.indexOf(De);Fe>=0&&(ie[Fe]=null,Q[Fe].disconnect(De))}for(let We=0;We<Re.added.length;We++){const De=Re.added[We];let Fe=ie.indexOf(De);if(Fe===-1){for(let Rt=0;Rt<Q.length;Rt++)if(Rt>=ie.length){ie.push(De),Fe=Rt;break}else if(ie[Rt]===null){ie[Rt]=De,Fe=Rt;break}if(Fe===-1)break}const Ke=Q[Fe];Ke&&Ke.connect(De)}}const ye=new Vector3,Ee=new Vector3;function Ve(Re,We,De){ye.setFromMatrixPosition(We.matrixWorld),Ee.setFromMatrixPosition(De.matrixWorld);const Fe=ye.distanceTo(Ee),Ke=We.projectionMatrix.elements,Rt=De.projectionMatrix.elements,dt=Ke[14]/(Ke[10]-1),Ut=Ke[14]/(Ke[10]+1),rt=(Ke[9]+1)/Ke[5],nt=(Ke[9]-1)/Ke[5],we=(Ke[8]-1)/Ke[0],Jt=(Rt[8]+1)/Rt[0],It=dt*we,Ht=dt*Jt,mt=Fe/(-we+Jt),ni=mt*-we;if(We.matrixWorld.decompose(Re.position,Re.quaternion,Re.scale),Re.translateX(ni),Re.translateZ(mt),Re.matrixWorld.compose(Re.position,Re.quaternion,Re.scale),Re.matrixWorldInverse.copy(Re.matrixWorld).invert(),Ke[10]===-1)Re.projectionMatrix.copy(We.projectionMatrix),Re.projectionMatrixInverse.copy(We.projectionMatrixInverse);else{const kt=dt+mt,Me=Ut+mt,ve=It-ni,et=Ht+(Fe-ni),ht=rt*Ut/Me*kt,Xt=nt*Ut/Me*kt;Re.projectionMatrix.makePerspective(ve,et,ht,Xt,kt,Me),Re.projectionMatrixInverse.copy(Re.projectionMatrix).invert()}}function Ye(Re,We){We===null?Re.matrixWorld.copy(Re.matrix):Re.matrixWorld.multiplyMatrices(We.matrixWorld,Re.matrix),Re.matrixWorldInverse.copy(Re.matrixWorld).invert()}this.updateCamera=function(Re){if(I===null)return;let We=Re.near,De=Re.far;O.texture!==null&&(O.depthNear>0&&(We=O.depthNear),O.depthFar>0&&(De=O.depthFar)),he.near=ce.near=ae.near=We,he.far=ce.far=ae.far=De,(Ie!==he.near||fe!==he.far)&&(I.updateRenderState({depthNear:he.near,depthFar:he.far}),Ie=he.near,fe=he.far),ae.layers.mask=Re.layers.mask|2,ce.layers.mask=Re.layers.mask|4,he.layers.mask=ae.layers.mask|ce.layers.mask;const Fe=Re.parent,Ke=he.cameras;Ye(he,Fe);for(let Rt=0;Rt<Ke.length;Rt++)Ye(Ke[Rt],Fe);Ke.length===2?Ve(he,ae,ce):he.projectionMatrix.copy(ae.projectionMatrix),be(Re,he,Fe)};function be(Re,We,De){De===null?Re.matrix.copy(We.matrixWorld):(Re.matrix.copy(De.matrixWorld),Re.matrix.invert(),Re.matrix.multiply(We.matrixWorld)),Re.matrix.decompose(Re.position,Re.quaternion,Re.scale),Re.updateMatrixWorld(!0),Re.projectionMatrix.copy(We.projectionMatrix),Re.projectionMatrixInverse.copy(We.projectionMatrixInverse),Re.isPerspectiveCamera&&(Re.fov=RAD2DEG*2*Math.atan(1/Re.projectionMatrix.elements[5]),Re.zoom=1)}this.getCamera=function(){return he},this.getFoveation=function(){if(!(T===null&&H===null))return _},this.setFoveation=function(Re){_=Re,T!==null&&(T.fixedFoveation=Re),H!==null&&H.fixedFoveation!==void 0&&(H.fixedFoveation=Re)},this.hasDepthSensing=function(){return O.texture!==null},this.getDepthSensingMesh=function(){return O.getMesh(he)};let Be=null;function Ne(Re,We){if(M=We.getViewerPose(Z||y),F=We,M!==null){const De=M.views;H!==null&&(n.setRenderTargetFramebuffer(ee,H.framebuffer),n.setRenderTarget(ee));let Fe=!1;De.length!==he.cameras.length&&(he.cameras.length=0,Fe=!0);for(let dt=0;dt<De.length;dt++){const Ut=De[dt];let rt=null;if(H!==null)rt=H.getViewport(Ut);else{const we=V.getViewSubImage(T,Ut);rt=we.viewport,dt===0&&(n.setRenderTargetTextures(ee,we.colorTexture,T.ignoreDepthValues?void 0:we.depthStencilTexture),n.setRenderTarget(ee))}let nt=ge[dt];nt===void 0&&(nt=new PerspectiveCamera,nt.layers.enable(dt),nt.viewport=new Vector4,ge[dt]=nt),nt.matrix.fromArray(Ut.transform.matrix),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale),nt.projectionMatrix.fromArray(Ut.projectionMatrix),nt.projectionMatrixInverse.copy(nt.projectionMatrix).invert(),nt.viewport.set(rt.x,rt.y,rt.width,rt.height),dt===0&&(he.matrix.copy(nt.matrix),he.matrix.decompose(he.position,he.quaternion,he.scale)),Fe===!0&&he.cameras.push(nt)}const Ke=I.enabledFeatures;if(Ke&&Ke.includes("depth-sensing")&&I.depthUsage=="gpu-optimized"&&V){const dt=V.getDepthInformation(De[0]);dt&&dt.isValid&&dt.texture&&O.init(n,dt,I.renderState)}}for(let De=0;De<Q.length;De++){const Fe=ie[De],Ke=Q[De];Fe!==null&&Ke!==void 0&&Ke.update(Fe,We,Z||y)}Be&&Be(Re,We),We.detectedPlanes&&C.dispatchEvent({type:"planesdetected",data:We}),F=null}const Ae=new WebGLAnimation;Ae.setAnimationLoop(Ne),this.setAnimationLoop=function(Re){Be=Re},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(u,n){function d($,U){$.matrixAutoUpdate===!0&&$.updateMatrix(),U.value.copy($.matrix)}function C($,U){U.color.getRGB($.fogColor.value,getUnlitUniformColorSpace(u)),U.isFog?($.fogNear.value=U.near,$.fogFar.value=U.far):U.isFogExp2&&($.fogDensity.value=U.density)}function I($,U,ee,Q,ie){U.isMeshBasicMaterial||U.isMeshLambertMaterial?f($,U):U.isMeshToonMaterial?(f($,U),V($,U)):U.isMeshPhongMaterial?(f($,U),M($,U)):U.isMeshStandardMaterial?(f($,U),T($,U),U.isMeshPhysicalMaterial&&H($,U,ie)):U.isMeshMatcapMaterial?(f($,U),F($,U)):U.isMeshDepthMaterial?f($,U):U.isMeshDistanceMaterial?(f($,U),O($,U)):U.isMeshNormalMaterial?f($,U):U.isLineBasicMaterial?(y($,U),U.isLineDashedMaterial&&B($,U)):U.isPointsMaterial?_($,U,ee,Q):U.isSpriteMaterial?Z($,U):U.isShadowMaterial?($.color.value.copy(U.color),$.opacity.value=U.opacity):U.isShaderMaterial&&(U.uniformsNeedUpdate=!1)}function f($,U){$.opacity.value=U.opacity,U.color&&$.diffuse.value.copy(U.color),U.emissive&&$.emissive.value.copy(U.emissive).multiplyScalar(U.emissiveIntensity),U.map&&($.map.value=U.map,d(U.map,$.mapTransform)),U.alphaMap&&($.alphaMap.value=U.alphaMap,d(U.alphaMap,$.alphaMapTransform)),U.bumpMap&&($.bumpMap.value=U.bumpMap,d(U.bumpMap,$.bumpMapTransform),$.bumpScale.value=U.bumpScale,U.side===BackSide&&($.bumpScale.value*=-1)),U.normalMap&&($.normalMap.value=U.normalMap,d(U.normalMap,$.normalMapTransform),$.normalScale.value.copy(U.normalScale),U.side===BackSide&&$.normalScale.value.negate()),U.displacementMap&&($.displacementMap.value=U.displacementMap,d(U.displacementMap,$.displacementMapTransform),$.displacementScale.value=U.displacementScale,$.displacementBias.value=U.displacementBias),U.emissiveMap&&($.emissiveMap.value=U.emissiveMap,d(U.emissiveMap,$.emissiveMapTransform)),U.specularMap&&($.specularMap.value=U.specularMap,d(U.specularMap,$.specularMapTransform)),U.alphaTest>0&&($.alphaTest.value=U.alphaTest);const ee=n.get(U),Q=ee.envMap,ie=ee.envMapRotation;Q&&($.envMap.value=Q,_e1.copy(ie),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,Q.isCubeTexture&&Q.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),$.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),$.flipEnvMap.value=Q.isCubeTexture&&Q.isRenderTargetTexture===!1?-1:1,$.reflectivity.value=U.reflectivity,$.ior.value=U.ior,$.refractionRatio.value=U.refractionRatio),U.lightMap&&($.lightMap.value=U.lightMap,$.lightMapIntensity.value=U.lightMapIntensity,d(U.lightMap,$.lightMapTransform)),U.aoMap&&($.aoMap.value=U.aoMap,$.aoMapIntensity.value=U.aoMapIntensity,d(U.aoMap,$.aoMapTransform))}function y($,U){$.diffuse.value.copy(U.color),$.opacity.value=U.opacity,U.map&&($.map.value=U.map,d(U.map,$.mapTransform))}function B($,U){$.dashSize.value=U.dashSize,$.totalSize.value=U.dashSize+U.gapSize,$.scale.value=U.scale}function _($,U,ee,Q){$.diffuse.value.copy(U.color),$.opacity.value=U.opacity,$.size.value=U.size*ee,$.scale.value=Q*.5,U.map&&($.map.value=U.map,d(U.map,$.uvTransform)),U.alphaMap&&($.alphaMap.value=U.alphaMap,d(U.alphaMap,$.alphaMapTransform)),U.alphaTest>0&&($.alphaTest.value=U.alphaTest)}function Z($,U){$.diffuse.value.copy(U.color),$.opacity.value=U.opacity,$.rotation.value=U.rotation,U.map&&($.map.value=U.map,d(U.map,$.mapTransform)),U.alphaMap&&($.alphaMap.value=U.alphaMap,d(U.alphaMap,$.alphaMapTransform)),U.alphaTest>0&&($.alphaTest.value=U.alphaTest)}function M($,U){$.specular.value.copy(U.specular),$.shininess.value=Math.max(U.shininess,1e-4)}function V($,U){U.gradientMap&&($.gradientMap.value=U.gradientMap)}function T($,U){$.metalness.value=U.metalness,U.metalnessMap&&($.metalnessMap.value=U.metalnessMap,d(U.metalnessMap,$.metalnessMapTransform)),$.roughness.value=U.roughness,U.roughnessMap&&($.roughnessMap.value=U.roughnessMap,d(U.roughnessMap,$.roughnessMapTransform)),U.envMap&&($.envMapIntensity.value=U.envMapIntensity)}function H($,U,ee){$.ior.value=U.ior,U.sheen>0&&($.sheenColor.value.copy(U.sheenColor).multiplyScalar(U.sheen),$.sheenRoughness.value=U.sheenRoughness,U.sheenColorMap&&($.sheenColorMap.value=U.sheenColorMap,d(U.sheenColorMap,$.sheenColorMapTransform)),U.sheenRoughnessMap&&($.sheenRoughnessMap.value=U.sheenRoughnessMap,d(U.sheenRoughnessMap,$.sheenRoughnessMapTransform))),U.clearcoat>0&&($.clearcoat.value=U.clearcoat,$.clearcoatRoughness.value=U.clearcoatRoughness,U.clearcoatMap&&($.clearcoatMap.value=U.clearcoatMap,d(U.clearcoatMap,$.clearcoatMapTransform)),U.clearcoatRoughnessMap&&($.clearcoatRoughnessMap.value=U.clearcoatRoughnessMap,d(U.clearcoatRoughnessMap,$.clearcoatRoughnessMapTransform)),U.clearcoatNormalMap&&($.clearcoatNormalMap.value=U.clearcoatNormalMap,d(U.clearcoatNormalMap,$.clearcoatNormalMapTransform),$.clearcoatNormalScale.value.copy(U.clearcoatNormalScale),U.side===BackSide&&$.clearcoatNormalScale.value.negate())),U.dispersion>0&&($.dispersion.value=U.dispersion),U.iridescence>0&&($.iridescence.value=U.iridescence,$.iridescenceIOR.value=U.iridescenceIOR,$.iridescenceThicknessMinimum.value=U.iridescenceThicknessRange[0],$.iridescenceThicknessMaximum.value=U.iridescenceThicknessRange[1],U.iridescenceMap&&($.iridescenceMap.value=U.iridescenceMap,d(U.iridescenceMap,$.iridescenceMapTransform)),U.iridescenceThicknessMap&&($.iridescenceThicknessMap.value=U.iridescenceThicknessMap,d(U.iridescenceThicknessMap,$.iridescenceThicknessMapTransform))),U.transmission>0&&($.transmission.value=U.transmission,$.transmissionSamplerMap.value=ee.texture,$.transmissionSamplerSize.value.set(ee.width,ee.height),U.transmissionMap&&($.transmissionMap.value=U.transmissionMap,d(U.transmissionMap,$.transmissionMapTransform)),$.thickness.value=U.thickness,U.thicknessMap&&($.thicknessMap.value=U.thicknessMap,d(U.thicknessMap,$.thicknessMapTransform)),$.attenuationDistance.value=U.attenuationDistance,$.attenuationColor.value.copy(U.attenuationColor)),U.anisotropy>0&&($.anisotropyVector.value.set(U.anisotropy*Math.cos(U.anisotropyRotation),U.anisotropy*Math.sin(U.anisotropyRotation)),U.anisotropyMap&&($.anisotropyMap.value=U.anisotropyMap,d(U.anisotropyMap,$.anisotropyMapTransform))),$.specularIntensity.value=U.specularIntensity,$.specularColor.value.copy(U.specularColor),U.specularColorMap&&($.specularColorMap.value=U.specularColorMap,d(U.specularColorMap,$.specularColorMapTransform)),U.specularIntensityMap&&($.specularIntensityMap.value=U.specularIntensityMap,d(U.specularIntensityMap,$.specularIntensityMapTransform))}function F($,U){U.matcap&&($.matcap.value=U.matcap)}function O($,U){const ee=n.get(U).light;$.referencePosition.value.setFromMatrixPosition(ee.matrixWorld),$.nearDistance.value=ee.shadow.camera.near,$.farDistance.value=ee.shadow.camera.far}return{refreshFogUniforms:C,refreshMaterialUniforms:I}}function WebGLUniformsGroups(u,n,d,C){let I={},f={},y=[];const B=u.getParameter(u.MAX_UNIFORM_BUFFER_BINDINGS);function _(ee,Q){const ie=Q.program;C.uniformBlockBinding(ee,ie)}function Z(ee,Q){let ie=I[ee.id];ie===void 0&&(F(ee),ie=M(ee),I[ee.id]=ie,ee.addEventListener("dispose",$));const ne=Q.program;C.updateUBOMapping(ee,ne);const le=n.render.frame;f[ee.id]!==le&&(T(ee),f[ee.id]=le)}function M(ee){const Q=V();ee.__bindingPointIndex=Q;const ie=u.createBuffer(),ne=ee.__size,le=ee.usage;return u.bindBuffer(u.UNIFORM_BUFFER,ie),u.bufferData(u.UNIFORM_BUFFER,ne,le),u.bindBuffer(u.UNIFORM_BUFFER,null),u.bindBufferBase(u.UNIFORM_BUFFER,Q,ie),ie}function V(){for(let ee=0;ee<B;ee++)if(y.indexOf(ee)===-1)return y.push(ee),ee;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function T(ee){const Q=I[ee.id],ie=ee.uniforms,ne=ee.__cache;u.bindBuffer(u.UNIFORM_BUFFER,Q);for(let le=0,ae=ie.length;le<ae;le++){const ce=Array.isArray(ie[le])?ie[le]:[ie[le]];for(let ge=0,he=ce.length;ge<he;ge++){const Ie=ce[ge];if(H(Ie,le,ge,ne)===!0){const fe=Ie.__offset,me=Array.isArray(Ie.value)?Ie.value:[Ie.value];let Ge=0;for(let Ze=0;Ze<me.length;Ze++){const ye=me[Ze],Ee=O(ye);typeof ye=="number"||typeof ye=="boolean"?(Ie.__data[0]=ye,u.bufferSubData(u.UNIFORM_BUFFER,fe+Ge,Ie.__data)):ye.isMatrix3?(Ie.__data[0]=ye.elements[0],Ie.__data[1]=ye.elements[1],Ie.__data[2]=ye.elements[2],Ie.__data[3]=0,Ie.__data[4]=ye.elements[3],Ie.__data[5]=ye.elements[4],Ie.__data[6]=ye.elements[5],Ie.__data[7]=0,Ie.__data[8]=ye.elements[6],Ie.__data[9]=ye.elements[7],Ie.__data[10]=ye.elements[8],Ie.__data[11]=0):(ye.toArray(Ie.__data,Ge),Ge+=Ee.storage/Float32Array.BYTES_PER_ELEMENT)}u.bufferSubData(u.UNIFORM_BUFFER,fe,Ie.__data)}}}u.bindBuffer(u.UNIFORM_BUFFER,null)}function H(ee,Q,ie,ne){const le=ee.value,ae=Q+"_"+ie;if(ne[ae]===void 0)return typeof le=="number"||typeof le=="boolean"?ne[ae]=le:ne[ae]=le.clone(),!0;{const ce=ne[ae];if(typeof le=="number"||typeof le=="boolean"){if(ce!==le)return ne[ae]=le,!0}else if(ce.equals(le)===!1)return ce.copy(le),!0}return!1}function F(ee){const Q=ee.uniforms;let ie=0;const ne=16;for(let ae=0,ce=Q.length;ae<ce;ae++){const ge=Array.isArray(Q[ae])?Q[ae]:[Q[ae]];for(let he=0,Ie=ge.length;he<Ie;he++){const fe=ge[he],me=Array.isArray(fe.value)?fe.value:[fe.value];for(let Ge=0,Ze=me.length;Ge<Ze;Ge++){const ye=me[Ge],Ee=O(ye),Ve=ie%ne,Ye=Ve%Ee.boundary,be=Ve+Ye;ie+=Ye,be!==0&&ne-be<Ee.storage&&(ie+=ne-be),fe.__data=new Float32Array(Ee.storage/Float32Array.BYTES_PER_ELEMENT),fe.__offset=ie,ie+=Ee.storage}}}const le=ie%ne;return le>0&&(ie+=ne-le),ee.__size=ie,ee.__cache={},this}function O(ee){const Q={boundary:0,storage:0};return typeof ee=="number"||typeof ee=="boolean"?(Q.boundary=4,Q.storage=4):ee.isVector2?(Q.boundary=8,Q.storage=8):ee.isVector3||ee.isColor?(Q.boundary=16,Q.storage=12):ee.isVector4?(Q.boundary=16,Q.storage=16):ee.isMatrix3?(Q.boundary=48,Q.storage=48):ee.isMatrix4?(Q.boundary=64,Q.storage=64):ee.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ee),Q}function $(ee){const Q=ee.target;Q.removeEventListener("dispose",$);const ie=y.indexOf(Q.__bindingPointIndex);y.splice(ie,1),u.deleteBuffer(I[Q.id]),delete I[Q.id],delete f[Q.id]}function U(){for(const ee in I)u.deleteBuffer(I[ee]);y=[],I={},f={}}return{bind:_,update:Z,dispose:U}}class WebGLRenderer{constructor(n={}){const{canvas:d=createCanvasElement(),context:C=null,depth:I=!0,stencil:f=!1,alpha:y=!1,antialias:B=!1,premultipliedAlpha:_=!0,preserveDrawingBuffer:Z=!1,powerPreference:M="default",failIfMajorPerformanceCaveat:V=!1,reverseDepthBuffer:T=!1}=n;this.isWebGLRenderer=!0;let H;if(C!==null){if(typeof WebGLRenderingContext<"u"&&C instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");H=C.getContextAttributes().alpha}else H=y;const F=new Uint32Array(4),O=new Int32Array(4);let $=null,U=null;const ee=[],Q=[];this.domElement=d,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const ie=this;let ne=!1,le=0,ae=0,ce=null,ge=-1,he=null;const Ie=new Vector4,fe=new Vector4;let me=null;const Ge=new Color(0);let Ze=0,ye=d.width,Ee=d.height,Ve=1,Ye=null,be=null;const Be=new Vector4(0,0,ye,Ee),Ne=new Vector4(0,0,ye,Ee);let Ae=!1;const Re=new Frustum;let We=!1,De=!1;this.transmissionResolutionScale=1;const Fe=new Matrix4,Ke=new Matrix4,Rt=new Vector3,dt=new Vector4,Ut={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let rt=!1;function nt(){return ce===null?Ve:1}let we=C;function Jt(Se,Le){return d.getContext(Se,Le)}try{const Se={alpha:!0,depth:I,stencil:f,antialias:B,premultipliedAlpha:_,preserveDrawingBuffer:Z,powerPreference:M,failIfMajorPerformanceCaveat:V};if("setAttribute"in d&&d.setAttribute("data-engine",`three.js r${REVISION}`),d.addEventListener("webglcontextlost",bt,!1),d.addEventListener("webglcontextrestored",Tt,!1),d.addEventListener("webglcontextcreationerror",$t,!1),we===null){const Le="webgl2";if(we=Jt(Le,Se),we===null)throw Jt(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Se){throw console.error("THREE.WebGLRenderer: "+Se.message),Se}let It,Ht,mt,ni,kt,Me,ve,et,ht,Xt,Ue,ft,Dt,jt,ii,it,Gt,Zt,Nt,_t,_e,Pe,Je,ze;function Kt(){It=new WebGLExtensions(we),It.init(),Pe=new WebGLUtils(we,It),Ht=new WebGLCapabilities(we,It,n,Pe),mt=new WebGLState(we,It),Ht.reverseDepthBuffer&&T&&mt.buffers.depth.setReversed(!0),ni=new WebGLInfo(we),kt=new WebGLProperties,Me=new WebGLTextures(we,It,mt,kt,Ht,Pe,ni),ve=new WebGLCubeMaps(ie),et=new WebGLCubeUVMaps(ie),ht=new WebGLAttributes(we),Je=new WebGLBindingStates(we,ht),Xt=new WebGLGeometries(we,ht,ni,Je),Ue=new WebGLObjects(we,Xt,ht,ni),Nt=new WebGLMorphtargets(we,Ht,Me),it=new WebGLClipping(kt),ft=new WebGLPrograms(ie,ve,et,It,Ht,Je,it),Dt=new WebGLMaterials(ie,kt),jt=new WebGLRenderLists,ii=new WebGLRenderStates(It),Zt=new WebGLBackground(ie,ve,et,mt,Ue,H,_),Gt=new WebGLShadowMap(ie,Ue,Ht),ze=new WebGLUniformsGroups(we,ni,Ht,mt),_t=new WebGLBufferRenderer(we,It,ni),_e=new WebGLIndexedBufferRenderer(we,It,ni),ni.programs=ft.programs,ie.capabilities=Ht,ie.extensions=It,ie.properties=kt,ie.renderLists=jt,ie.shadowMap=Gt,ie.state=mt,ie.info=ni}Kt();const ct=new WebXRManager(ie,we);this.xr=ct,this.getContext=function(){return we},this.getContextAttributes=function(){return we.getContextAttributes()},this.forceContextLoss=function(){const Se=It.get("WEBGL_lose_context");Se&&Se.loseContext()},this.forceContextRestore=function(){const Se=It.get("WEBGL_lose_context");Se&&Se.restoreContext()},this.getPixelRatio=function(){return Ve},this.setPixelRatio=function(Se){Se!==void 0&&(Ve=Se,this.setSize(ye,Ee,!1))},this.getSize=function(Se){return Se.set(ye,Ee)},this.setSize=function(Se,Le,ot=!0){if(ct.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ye=Se,Ee=Le,d.width=Math.floor(Se*Ve),d.height=Math.floor(Le*Ve),ot===!0&&(d.style.width=Se+"px",d.style.height=Le+"px"),this.setViewport(0,0,Se,Le)},this.getDrawingBufferSize=function(Se){return Se.set(ye*Ve,Ee*Ve).floor()},this.setDrawingBufferSize=function(Se,Le,ot){ye=Se,Ee=Le,Ve=ot,d.width=Math.floor(Se*ot),d.height=Math.floor(Le*ot),this.setViewport(0,0,Se,Le)},this.getCurrentViewport=function(Se){return Se.copy(Ie)},this.getViewport=function(Se){return Se.copy(Be)},this.setViewport=function(Se,Le,ot,tt){Se.isVector4?Be.set(Se.x,Se.y,Se.z,Se.w):Be.set(Se,Le,ot,tt),mt.viewport(Ie.copy(Be).multiplyScalar(Ve).round())},this.getScissor=function(Se){return Se.copy(Ne)},this.setScissor=function(Se,Le,ot,tt){Se.isVector4?Ne.set(Se.x,Se.y,Se.z,Se.w):Ne.set(Se,Le,ot,tt),mt.scissor(fe.copy(Ne).multiplyScalar(Ve).round())},this.getScissorTest=function(){return Ae},this.setScissorTest=function(Se){mt.setScissorTest(Ae=Se)},this.setOpaqueSort=function(Se){Ye=Se},this.setTransparentSort=function(Se){be=Se},this.getClearColor=function(Se){return Se.copy(Zt.getClearColor())},this.setClearColor=function(){Zt.setClearColor(...arguments)},this.getClearAlpha=function(){return Zt.getClearAlpha()},this.setClearAlpha=function(){Zt.setClearAlpha(...arguments)},this.clear=function(Se=!0,Le=!0,ot=!0){let tt=0;if(Se){let $e=!1;if(ce!==null){const Mt=ce.texture.format;$e=Mt===RGBAIntegerFormat||Mt===RGIntegerFormat||Mt===RedIntegerFormat}if($e){const Mt=ce.texture.type,Qt=Mt===UnsignedByteType||Mt===UnsignedIntType||Mt===UnsignedShortType||Mt===UnsignedInt248Type||Mt===UnsignedShort4444Type||Mt===UnsignedShort5551Type,ei=Zt.getClearColor(),qt=Zt.getClearAlpha(),di=ei.r,Ci=ei.g,li=ei.b;Qt?(F[0]=di,F[1]=Ci,F[2]=li,F[3]=qt,we.clearBufferuiv(we.COLOR,0,F)):(O[0]=di,O[1]=Ci,O[2]=li,O[3]=qt,we.clearBufferiv(we.COLOR,0,O))}else tt|=we.COLOR_BUFFER_BIT}Le&&(tt|=we.DEPTH_BUFFER_BIT),ot&&(tt|=we.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),we.clear(tt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){d.removeEventListener("webglcontextlost",bt,!1),d.removeEventListener("webglcontextrestored",Tt,!1),d.removeEventListener("webglcontextcreationerror",$t,!1),Zt.dispose(),jt.dispose(),ii.dispose(),kt.dispose(),ve.dispose(),et.dispose(),Ue.dispose(),Je.dispose(),ze.dispose(),ft.dispose(),ct.dispose(),ct.removeEventListener("sessionstart",Fn),ct.removeEventListener("sessionend",no),Tn.stop()};function bt(Se){Se.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ne=!0}function Tt(){console.log("THREE.WebGLRenderer: Context Restored."),ne=!1;const Se=ni.autoReset,Le=Gt.enabled,ot=Gt.autoUpdate,tt=Gt.needsUpdate,$e=Gt.type;Kt(),ni.autoReset=Se,Gt.enabled=Le,Gt.autoUpdate=ot,Gt.needsUpdate=tt,Gt.type=$e}function $t(Se){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Se.statusMessage)}function si(Se){const Le=Se.target;Le.removeEventListener("dispose",si),Bi(Le)}function Bi(Se){Ki(Se),kt.remove(Se)}function Ki(Se){const Le=kt.get(Se).programs;Le!==void 0&&(Le.forEach(function(ot){ft.releaseProgram(ot)}),Se.isShaderMaterial&&ft.releaseShaderCache(Se))}this.renderBufferDirect=function(Se,Le,ot,tt,$e,Mt){Le===null&&(Le=Ut);const Qt=$e.isMesh&&$e.matrixWorld.determinant()<0,ei=oc(Se,Le,ot,tt,$e);mt.setMaterial(tt,Qt);let qt=ot.index,di=1;if(tt.wireframe===!0){if(qt=Xt.getWireframeAttribute(ot),qt===void 0)return;di=2}const Ci=ot.drawRange,li=ot.attributes.position;let Ni=Ci.start*di,Vi=(Ci.start+Ci.count)*di;Mt!==null&&(Ni=Math.max(Ni,Mt.start*di),Vi=Math.min(Vi,(Mt.start+Mt.count)*di)),qt!==null?(Ni=Math.max(Ni,0),Vi=Math.min(Vi,qt.count)):li!=null&&(Ni=Math.max(Ni,0),Vi=Math.min(Vi,li.count));const rn=Vi-Ni;if(rn<0||rn===1/0)return;Je.setup($e,tt,ei,ot,qt);let Ti,mi=_t;if(qt!==null&&(Ti=ht.get(qt),mi=_e,mi.setIndex(Ti)),$e.isMesh)tt.wireframe===!0?(mt.setLineWidth(tt.wireframeLinewidth*nt()),mi.setMode(we.LINES)):mi.setMode(we.TRIANGLES);else if($e.isLine){let ci=tt.linewidth;ci===void 0&&(ci=1),mt.setLineWidth(ci*nt()),$e.isLineSegments?mi.setMode(we.LINES):$e.isLineLoop?mi.setMode(we.LINE_LOOP):mi.setMode(we.LINE_STRIP)}else $e.isPoints?mi.setMode(we.POINTS):$e.isSprite&&mi.setMode(we.TRIANGLES);if($e.isBatchedMesh)if($e._multiDrawInstances!==null)warnOnce("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),mi.renderMultiDrawInstances($e._multiDrawStarts,$e._multiDrawCounts,$e._multiDrawCount,$e._multiDrawInstances);else if(It.get("WEBGL_multi_draw"))mi.renderMultiDraw($e._multiDrawStarts,$e._multiDrawCounts,$e._multiDrawCount);else{const ci=$e._multiDrawStarts,_n=$e._multiDrawCounts,Ei=$e._multiDrawCount,hs=qt?ht.get(qt).bytesPerElement:1,Vs=kt.get(tt).currentProgram.getUniforms();for(let es=0;es<Ei;es++)Vs.setValue(we,"_gl_DrawID",es),mi.render(ci[es]/hs,_n[es])}else if($e.isInstancedMesh)mi.renderInstances(Ni,rn,$e.count);else if(ot.isInstancedBufferGeometry){const ci=ot._maxInstanceCount!==void 0?ot._maxInstanceCount:1/0,_n=Math.min(ot.instanceCount,ci);mi.renderInstances(Ni,rn,_n)}else mi.render(Ni,rn)};function Gi(Se,Le,ot){Se.transparent===!0&&Se.side===DoubleSide&&Se.forceSinglePass===!1?(Se.side=BackSide,Se.needsUpdate=!0,pi(Se,Le,ot),Se.side=FrontSide,Se.needsUpdate=!0,pi(Se,Le,ot),Se.side=DoubleSide):pi(Se,Le,ot)}this.compile=function(Se,Le,ot=null){ot===null&&(ot=Se),U=ii.get(ot),U.init(Le),Q.push(U),ot.traverseVisible(function($e){$e.isLight&&$e.layers.test(Le.layers)&&(U.pushLight($e),$e.castShadow&&U.pushShadow($e))}),Se!==ot&&Se.traverseVisible(function($e){$e.isLight&&$e.layers.test(Le.layers)&&(U.pushLight($e),$e.castShadow&&U.pushShadow($e))}),U.setupLights();const tt=new Set;return Se.traverse(function($e){if(!($e.isMesh||$e.isPoints||$e.isLine||$e.isSprite))return;const Mt=$e.material;if(Mt)if(Array.isArray(Mt))for(let Qt=0;Qt<Mt.length;Qt++){const ei=Mt[Qt];Gi(ei,ot,$e),tt.add(ei)}else Gi(Mt,ot,$e),tt.add(Mt)}),U=Q.pop(),tt},this.compileAsync=function(Se,Le,ot=null){const tt=this.compile(Se,Le,ot);return new Promise($e=>{function Mt(){if(tt.forEach(function(Qt){kt.get(Qt).currentProgram.isReady()&&tt.delete(Qt)}),tt.size===0){$e(Se);return}setTimeout(Mt,10)}It.get("KHR_parallel_shader_compile")!==null?Mt():setTimeout(Mt,10)})};let _i=null;function Di(Se){_i&&_i(Se)}function Fn(){Tn.stop()}function no(){Tn.start()}const Tn=new WebGLAnimation;Tn.setAnimationLoop(Di),typeof self<"u"&&Tn.setContext(self),this.setAnimationLoop=function(Se){_i=Se,ct.setAnimationLoop(Se),Se===null?Tn.stop():Tn.start()},ct.addEventListener("sessionstart",Fn),ct.addEventListener("sessionend",no),this.render=function(Se,Le){if(Le!==void 0&&Le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ne===!0)return;if(Se.matrixWorldAutoUpdate===!0&&Se.updateMatrixWorld(),Le.parent===null&&Le.matrixWorldAutoUpdate===!0&&Le.updateMatrixWorld(),ct.enabled===!0&&ct.isPresenting===!0&&(ct.cameraAutoUpdate===!0&&ct.updateCamera(Le),Le=ct.getCamera()),Se.isScene===!0&&Se.onBeforeRender(ie,Se,Le,ce),U=ii.get(Se,Q.length),U.init(Le),Q.push(U),Ke.multiplyMatrices(Le.projectionMatrix,Le.matrixWorldInverse),Re.setFromProjectionMatrix(Ke),De=this.localClippingEnabled,We=it.init(this.clippingPlanes,De),$=jt.get(Se,ee.length),$.init(),ee.push($),ct.enabled===!0&&ct.isPresenting===!0){const Mt=ie.xr.getDepthSensingMesh();Mt!==null&&Ln(Mt,Le,-1/0,ie.sortObjects)}Ln(Se,Le,0,ie.sortObjects),$.finish(),ie.sortObjects===!0&&$.sort(Ye,be),rt=ct.enabled===!1||ct.isPresenting===!1||ct.hasDepthSensing()===!1,rt&&Zt.addToRenderList($,Se),this.info.render.frame++,We===!0&&it.beginShadows();const ot=U.state.shadowsArray;Gt.render(ot,Se,Le),We===!0&&it.endShadows(),this.info.autoReset===!0&&this.info.reset();const tt=$.opaque,$e=$.transmissive;if(U.setupLights(),Le.isArrayCamera){const Mt=Le.cameras;if($e.length>0)for(let Qt=0,ei=Mt.length;Qt<ei;Qt++){const qt=Mt[Qt];vs(tt,$e,Se,qt)}rt&&Zt.render(Se);for(let Qt=0,ei=Mt.length;Qt<ei;Qt++){const qt=Mt[Qt];qn($,Se,qt,qt.viewport)}}else $e.length>0&&vs(tt,$e,Se,Le),rt&&Zt.render(Se),qn($,Se,Le);ce!==null&&ae===0&&(Me.updateMultisampleRenderTarget(ce),Me.updateRenderTargetMipmap(ce)),Se.isScene===!0&&Se.onAfterRender(ie,Se,Le),Je.resetDefaultState(),ge=-1,he=null,Q.pop(),Q.length>0?(U=Q[Q.length-1],We===!0&&it.setGlobalState(ie.clippingPlanes,U.state.camera)):U=null,ee.pop(),ee.length>0?$=ee[ee.length-1]:$=null};function Ln(Se,Le,ot,tt){if(Se.visible===!1)return;if(Se.layers.test(Le.layers)){if(Se.isGroup)ot=Se.renderOrder;else if(Se.isLOD)Se.autoUpdate===!0&&Se.update(Le);else if(Se.isLight)U.pushLight(Se),Se.castShadow&&U.pushShadow(Se);else if(Se.isSprite){if(!Se.frustumCulled||Re.intersectsSprite(Se)){tt&&dt.setFromMatrixPosition(Se.matrixWorld).applyMatrix4(Ke);const Qt=Ue.update(Se),ei=Se.material;ei.visible&&$.push(Se,Qt,ei,ot,dt.z,null)}}else if((Se.isMesh||Se.isLine||Se.isPoints)&&(!Se.frustumCulled||Re.intersectsObject(Se))){const Qt=Ue.update(Se),ei=Se.material;if(tt&&(Se.boundingSphere!==void 0?(Se.boundingSphere===null&&Se.computeBoundingSphere(),dt.copy(Se.boundingSphere.center)):(Qt.boundingSphere===null&&Qt.computeBoundingSphere(),dt.copy(Qt.boundingSphere.center)),dt.applyMatrix4(Se.matrixWorld).applyMatrix4(Ke)),Array.isArray(ei)){const qt=Qt.groups;for(let di=0,Ci=qt.length;di<Ci;di++){const li=qt[di],Ni=ei[li.materialIndex];Ni&&Ni.visible&&$.push(Se,Qt,Ni,ot,dt.z,li)}}else ei.visible&&$.push(Se,Qt,ei,ot,dt.z,null)}}const Mt=Se.children;for(let Qt=0,ei=Mt.length;Qt<ei;Qt++)Ln(Mt[Qt],Le,ot,tt)}function qn(Se,Le,ot,tt){const $e=Se.opaque,Mt=Se.transmissive,Qt=Se.transparent;U.setupLightsView(ot),We===!0&&it.setGlobalState(ie.clippingPlanes,ot),tt&&mt.viewport(Ie.copy(tt)),$e.length>0&&sn($e,Le,ot),Mt.length>0&&sn(Mt,Le,ot),Qt.length>0&&sn(Qt,Le,ot),mt.buffers.depth.setTest(!0),mt.buffers.depth.setMask(!0),mt.buffers.color.setMask(!0),mt.setPolygonOffset(!1)}function vs(Se,Le,ot,tt){if((ot.isScene===!0?ot.overrideMaterial:null)!==null)return;U.state.transmissionRenderTarget[tt.id]===void 0&&(U.state.transmissionRenderTarget[tt.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:It.has("EXT_color_buffer_half_float")||It.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:f,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const Mt=U.state.transmissionRenderTarget[tt.id],Qt=tt.viewport||Ie;Mt.setSize(Qt.z*ie.transmissionResolutionScale,Qt.w*ie.transmissionResolutionScale);const ei=ie.getRenderTarget();ie.setRenderTarget(Mt),ie.getClearColor(Ge),Ze=ie.getClearAlpha(),Ze<1&&ie.setClearColor(16777215,.5),ie.clear(),rt&&Zt.render(ot);const qt=ie.toneMapping;ie.toneMapping=NoToneMapping;const di=tt.viewport;if(tt.viewport!==void 0&&(tt.viewport=void 0),U.setupLightsView(tt),We===!0&&it.setGlobalState(ie.clippingPlanes,tt),sn(Se,ot,tt),Me.updateMultisampleRenderTarget(Mt),Me.updateRenderTargetMipmap(Mt),It.has("WEBGL_multisampled_render_to_texture")===!1){let Ci=!1;for(let li=0,Ni=Le.length;li<Ni;li++){const Vi=Le[li],rn=Vi.object,Ti=Vi.geometry,mi=Vi.material,ci=Vi.group;if(mi.side===DoubleSide&&rn.layers.test(tt.layers)){const _n=mi.side;mi.side=BackSide,mi.needsUpdate=!0,on(rn,ot,tt,Ti,mi,ci),mi.side=_n,mi.needsUpdate=!0,Ci=!0}}Ci===!0&&(Me.updateMultisampleRenderTarget(Mt),Me.updateRenderTargetMipmap(Mt))}ie.setRenderTarget(ei),ie.setClearColor(Ge,Ze),di!==void 0&&(tt.viewport=di),ie.toneMapping=qt}function sn(Se,Le,ot){const tt=Le.isScene===!0?Le.overrideMaterial:null;for(let $e=0,Mt=Se.length;$e<Mt;$e++){const Qt=Se[$e],ei=Qt.object,qt=Qt.geometry,di=tt===null?Qt.material:tt,Ci=Qt.group;ei.layers.test(ot.layers)&&on(ei,Le,ot,qt,di,Ci)}}function on(Se,Le,ot,tt,$e,Mt){Se.onBeforeRender(ie,Le,ot,tt,$e,Mt),Se.modelViewMatrix.multiplyMatrices(ot.matrixWorldInverse,Se.matrixWorld),Se.normalMatrix.getNormalMatrix(Se.modelViewMatrix),$e.onBeforeRender(ie,Le,ot,tt,Se,Mt),$e.transparent===!0&&$e.side===DoubleSide&&$e.forceSinglePass===!1?($e.side=BackSide,$e.needsUpdate=!0,ie.renderBufferDirect(ot,Le,tt,$e,Se,Mt),$e.side=FrontSide,$e.needsUpdate=!0,ie.renderBufferDirect(ot,Le,tt,$e,Se,Mt),$e.side=DoubleSide):ie.renderBufferDirect(ot,Le,tt,$e,Se,Mt),Se.onAfterRender(ie,Le,ot,tt,$e,Mt)}function pi(Se,Le,ot){Le.isScene!==!0&&(Le=Ut);const tt=kt.get(Se),$e=U.state.lights,Mt=U.state.shadowsArray,Qt=$e.state.version,ei=ft.getParameters(Se,$e.state,Mt,Le,ot),qt=ft.getProgramCacheKey(ei);let di=tt.programs;tt.environment=Se.isMeshStandardMaterial?Le.environment:null,tt.fog=Le.fog,tt.envMap=(Se.isMeshStandardMaterial?et:ve).get(Se.envMap||tt.environment),tt.envMapRotation=tt.environment!==null&&Se.envMap===null?Le.environmentRotation:Se.envMapRotation,di===void 0&&(Se.addEventListener("dispose",si),di=new Map,tt.programs=di);let Ci=di.get(qt);if(Ci!==void 0){if(tt.currentProgram===Ci&&tt.lightsStateVersion===Qt)return Ir(Se,ei),Ci}else ei.uniforms=ft.getUniforms(Se),Se.onBeforeCompile(ei,ie),Ci=ft.acquireProgram(ei,qt),di.set(qt,Ci),tt.uniforms=ei.uniforms;const li=tt.uniforms;return(!Se.isShaderMaterial&&!Se.isRawShaderMaterial||Se.clipping===!0)&&(li.clippingPlanes=it.uniform),Ir(Se,ei),tt.needsLights=ac(Se),tt.lightsStateVersion=Qt,tt.needsLights&&(li.ambientLightColor.value=$e.state.ambient,li.lightProbe.value=$e.state.probe,li.directionalLights.value=$e.state.directional,li.directionalLightShadows.value=$e.state.directionalShadow,li.spotLights.value=$e.state.spot,li.spotLightShadows.value=$e.state.spotShadow,li.rectAreaLights.value=$e.state.rectArea,li.ltc_1.value=$e.state.rectAreaLTC1,li.ltc_2.value=$e.state.rectAreaLTC2,li.pointLights.value=$e.state.point,li.pointLightShadows.value=$e.state.pointShadow,li.hemisphereLights.value=$e.state.hemi,li.directionalShadowMap.value=$e.state.directionalShadowMap,li.directionalShadowMatrix.value=$e.state.directionalShadowMatrix,li.spotShadowMap.value=$e.state.spotShadowMap,li.spotLightMatrix.value=$e.state.spotLightMatrix,li.spotLightMap.value=$e.state.spotLightMap,li.pointShadowMap.value=$e.state.pointShadowMap,li.pointShadowMatrix.value=$e.state.pointShadowMatrix),tt.currentProgram=Ci,tt.uniformsList=null,Ci}function so(Se){if(Se.uniformsList===null){const Le=Se.currentProgram.getUniforms();Se.uniformsList=WebGLUniforms.seqWithValue(Le.seq,Se.uniforms)}return Se.uniformsList}function Ir(Se,Le){const ot=kt.get(Se);ot.outputColorSpace=Le.outputColorSpace,ot.batching=Le.batching,ot.batchingColor=Le.batchingColor,ot.instancing=Le.instancing,ot.instancingColor=Le.instancingColor,ot.instancingMorph=Le.instancingMorph,ot.skinning=Le.skinning,ot.morphTargets=Le.morphTargets,ot.morphNormals=Le.morphNormals,ot.morphColors=Le.morphColors,ot.morphTargetsCount=Le.morphTargetsCount,ot.numClippingPlanes=Le.numClippingPlanes,ot.numIntersection=Le.numClipIntersection,ot.vertexAlphas=Le.vertexAlphas,ot.vertexTangents=Le.vertexTangents,ot.toneMapping=Le.toneMapping}function oc(Se,Le,ot,tt,$e){Le.isScene!==!0&&(Le=Ut),Me.resetTextureUnits();const Mt=Le.fog,Qt=tt.isMeshStandardMaterial?Le.environment:null,ei=ce===null?ie.outputColorSpace:ce.isXRRenderTarget===!0?ce.texture.colorSpace:LinearSRGBColorSpace,qt=(tt.isMeshStandardMaterial?et:ve).get(tt.envMap||Qt),di=tt.vertexColors===!0&&!!ot.attributes.color&&ot.attributes.color.itemSize===4,Ci=!!ot.attributes.tangent&&(!!tt.normalMap||tt.anisotropy>0),li=!!ot.morphAttributes.position,Ni=!!ot.morphAttributes.normal,Vi=!!ot.morphAttributes.color;let rn=NoToneMapping;tt.toneMapped&&(ce===null||ce.isXRRenderTarget===!0)&&(rn=ie.toneMapping);const Ti=ot.morphAttributes.position||ot.morphAttributes.normal||ot.morphAttributes.color,mi=Ti!==void 0?Ti.length:0,ci=kt.get(tt),_n=U.state.lights;if(We===!0&&(De===!0||Se!==he)){const mn=Se===he&&tt.id===ge;it.setState(tt,Se,mn)}let Ei=!1;tt.version===ci.__version?(ci.needsLights&&ci.lightsStateVersion!==_n.state.version||ci.outputColorSpace!==ei||$e.isBatchedMesh&&ci.batching===!1||!$e.isBatchedMesh&&ci.batching===!0||$e.isBatchedMesh&&ci.batchingColor===!0&&$e.colorTexture===null||$e.isBatchedMesh&&ci.batchingColor===!1&&$e.colorTexture!==null||$e.isInstancedMesh&&ci.instancing===!1||!$e.isInstancedMesh&&ci.instancing===!0||$e.isSkinnedMesh&&ci.skinning===!1||!$e.isSkinnedMesh&&ci.skinning===!0||$e.isInstancedMesh&&ci.instancingColor===!0&&$e.instanceColor===null||$e.isInstancedMesh&&ci.instancingColor===!1&&$e.instanceColor!==null||$e.isInstancedMesh&&ci.instancingMorph===!0&&$e.morphTexture===null||$e.isInstancedMesh&&ci.instancingMorph===!1&&$e.morphTexture!==null||ci.envMap!==qt||tt.fog===!0&&ci.fog!==Mt||ci.numClippingPlanes!==void 0&&(ci.numClippingPlanes!==it.numPlanes||ci.numIntersection!==it.numIntersection)||ci.vertexAlphas!==di||ci.vertexTangents!==Ci||ci.morphTargets!==li||ci.morphNormals!==Ni||ci.morphColors!==Vi||ci.toneMapping!==rn||ci.morphTargetsCount!==mi)&&(Ei=!0):(Ei=!0,ci.__version=tt.version);let hs=ci.currentProgram;Ei===!0&&(hs=pi(tt,Le,$e));let Vs=!1,es=!1,Jn=!1;const Oi=hs.getUniforms(),ts=ci.uniforms;if(mt.useProgram(hs.program)&&(Vs=!0,es=!0,Jn=!0),tt.id!==ge&&(ge=tt.id,es=!0),Vs||he!==Se){mt.buffers.depth.getReversed()?(Fe.copy(Se.projectionMatrix),toNormalizedProjectionMatrix(Fe),toReversedProjectionMatrix(Fe),Oi.setValue(we,"projectionMatrix",Fe)):Oi.setValue(we,"projectionMatrix",Se.projectionMatrix),Oi.setValue(we,"viewMatrix",Se.matrixWorldInverse);const Kn=Oi.map.cameraPosition;Kn!==void 0&&Kn.setValue(we,Rt.setFromMatrixPosition(Se.matrixWorld)),Ht.logarithmicDepthBuffer&&Oi.setValue(we,"logDepthBufFC",2/(Math.log(Se.far+1)/Math.LN2)),(tt.isMeshPhongMaterial||tt.isMeshToonMaterial||tt.isMeshLambertMaterial||tt.isMeshBasicMaterial||tt.isMeshStandardMaterial||tt.isShaderMaterial)&&Oi.setValue(we,"isOrthographic",Se.isOrthographicCamera===!0),he!==Se&&(he=Se,es=!0,Jn=!0)}if($e.isSkinnedMesh){Oi.setOptional(we,$e,"bindMatrix"),Oi.setOptional(we,$e,"bindMatrixInverse");const mn=$e.skeleton;mn&&(mn.boneTexture===null&&mn.computeBoneTexture(),Oi.setValue(we,"boneTexture",mn.boneTexture,Me))}$e.isBatchedMesh&&(Oi.setOptional(we,$e,"batchingTexture"),Oi.setValue(we,"batchingTexture",$e._matricesTexture,Me),Oi.setOptional(we,$e,"batchingIdTexture"),Oi.setValue(we,"batchingIdTexture",$e._indirectTexture,Me),Oi.setOptional(we,$e,"batchingColorTexture"),$e._colorsTexture!==null&&Oi.setValue(we,"batchingColorTexture",$e._colorsTexture,Me));const On=ot.morphAttributes;if((On.position!==void 0||On.normal!==void 0||On.color!==void 0)&&Nt.update($e,ot,hs),(es||ci.receiveShadow!==$e.receiveShadow)&&(ci.receiveShadow=$e.receiveShadow,Oi.setValue(we,"receiveShadow",$e.receiveShadow)),tt.isMeshGouraudMaterial&&tt.envMap!==null&&(ts.envMap.value=qt,ts.flipEnvMap.value=qt.isCubeTexture&&qt.isRenderTargetTexture===!1?-1:1),tt.isMeshStandardMaterial&&tt.envMap===null&&Le.environment!==null&&(ts.envMapIntensity.value=Le.environmentIntensity),es&&(Oi.setValue(we,"toneMappingExposure",ie.toneMappingExposure),ci.needsLights&&rc(ts,Jn),Mt&&tt.fog===!0&&Dt.refreshFogUniforms(ts,Mt),Dt.refreshMaterialUniforms(ts,tt,Ve,Ee,U.state.transmissionRenderTarget[Se.id]),WebGLUniforms.upload(we,so(ci),ts,Me)),tt.isShaderMaterial&&tt.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(we,so(ci),ts,Me),tt.uniformsNeedUpdate=!1),tt.isSpriteMaterial&&Oi.setValue(we,"center",$e.center),Oi.setValue(we,"modelViewMatrix",$e.modelViewMatrix),Oi.setValue(we,"normalMatrix",$e.normalMatrix),Oi.setValue(we,"modelMatrix",$e.matrixWorld),tt.isShaderMaterial||tt.isRawShaderMaterial){const mn=tt.uniformsGroups;for(let Kn=0,ro=mn.length;Kn<ro;Kn++){const ds=mn[Kn];ze.update(ds,hs),ze.bind(ds,hs)}}return hs}function rc(Se,Le){Se.ambientLightColor.needsUpdate=Le,Se.lightProbe.needsUpdate=Le,Se.directionalLights.needsUpdate=Le,Se.directionalLightShadows.needsUpdate=Le,Se.pointLights.needsUpdate=Le,Se.pointLightShadows.needsUpdate=Le,Se.spotLights.needsUpdate=Le,Se.spotLightShadows.needsUpdate=Le,Se.rectAreaLights.needsUpdate=Le,Se.hemisphereLights.needsUpdate=Le}function ac(Se){return Se.isMeshLambertMaterial||Se.isMeshToonMaterial||Se.isMeshPhongMaterial||Se.isMeshStandardMaterial||Se.isShadowMaterial||Se.isShaderMaterial&&Se.lights===!0}this.getActiveCubeFace=function(){return le},this.getActiveMipmapLevel=function(){return ae},this.getRenderTarget=function(){return ce},this.setRenderTargetTextures=function(Se,Le,ot){kt.get(Se.texture).__webglTexture=Le,kt.get(Se.depthTexture).__webglTexture=ot;const tt=kt.get(Se);tt.__hasExternalTextures=!0,tt.__autoAllocateDepthBuffer=ot===void 0,tt.__autoAllocateDepthBuffer||It.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),tt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Se,Le){const ot=kt.get(Se);ot.__webglFramebuffer=Le,ot.__useDefaultFramebuffer=Le===void 0};const Wo=we.createFramebuffer();this.setRenderTarget=function(Se,Le=0,ot=0){ce=Se,le=Le,ae=ot;let tt=!0,$e=null,Mt=!1,Qt=!1;if(Se){const qt=kt.get(Se);if(qt.__useDefaultFramebuffer!==void 0)mt.bindFramebuffer(we.FRAMEBUFFER,null),tt=!1;else if(qt.__webglFramebuffer===void 0)Me.setupRenderTarget(Se);else if(qt.__hasExternalTextures)Me.rebindTextures(Se,kt.get(Se.texture).__webglTexture,kt.get(Se.depthTexture).__webglTexture);else if(Se.depthBuffer){const li=Se.depthTexture;if(qt.__boundDepthTexture!==li){if(li!==null&&kt.has(li)&&(Se.width!==li.image.width||Se.height!==li.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Me.setupDepthRenderbuffer(Se)}}const di=Se.texture;(di.isData3DTexture||di.isDataArrayTexture||di.isCompressedArrayTexture)&&(Qt=!0);const Ci=kt.get(Se).__webglFramebuffer;Se.isWebGLCubeRenderTarget?(Array.isArray(Ci[Le])?$e=Ci[Le][ot]:$e=Ci[Le],Mt=!0):Se.samples>0&&Me.useMultisampledRTT(Se)===!1?$e=kt.get(Se).__webglMultisampledFramebuffer:Array.isArray(Ci)?$e=Ci[ot]:$e=Ci,Ie.copy(Se.viewport),fe.copy(Se.scissor),me=Se.scissorTest}else Ie.copy(Be).multiplyScalar(Ve).floor(),fe.copy(Ne).multiplyScalar(Ve).floor(),me=Ae;if(ot!==0&&($e=Wo),mt.bindFramebuffer(we.FRAMEBUFFER,$e)&&tt&&mt.drawBuffers(Se,$e),mt.viewport(Ie),mt.scissor(fe),mt.setScissorTest(me),Mt){const qt=kt.get(Se.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_CUBE_MAP_POSITIVE_X+Le,qt.__webglTexture,ot)}else if(Qt){const qt=kt.get(Se.texture),di=Le;we.framebufferTextureLayer(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,qt.__webglTexture,ot,di)}else if(Se!==null&&ot!==0){const qt=kt.get(Se.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,qt.__webglTexture,ot)}ge=-1},this.readRenderTargetPixels=function(Se,Le,ot,tt,$e,Mt,Qt){if(!(Se&&Se.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ei=kt.get(Se).__webglFramebuffer;if(Se.isWebGLCubeRenderTarget&&Qt!==void 0&&(ei=ei[Qt]),ei){mt.bindFramebuffer(we.FRAMEBUFFER,ei);try{const qt=Se.texture,di=qt.format,Ci=qt.type;if(!Ht.textureFormatReadable(di)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ht.textureTypeReadable(Ci)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Le>=0&&Le<=Se.width-tt&&ot>=0&&ot<=Se.height-$e&&we.readPixels(Le,ot,tt,$e,Pe.convert(di),Pe.convert(Ci),Mt)}finally{const qt=ce!==null?kt.get(ce).__webglFramebuffer:null;mt.bindFramebuffer(we.FRAMEBUFFER,qt)}}},this.readRenderTargetPixelsAsync=async function(Se,Le,ot,tt,$e,Mt,Qt){if(!(Se&&Se.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ei=kt.get(Se).__webglFramebuffer;if(Se.isWebGLCubeRenderTarget&&Qt!==void 0&&(ei=ei[Qt]),ei){const qt=Se.texture,di=qt.format,Ci=qt.type;if(!Ht.textureFormatReadable(di))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ht.textureTypeReadable(Ci))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Le>=0&&Le<=Se.width-tt&&ot>=0&&ot<=Se.height-$e){mt.bindFramebuffer(we.FRAMEBUFFER,ei);const li=we.createBuffer();we.bindBuffer(we.PIXEL_PACK_BUFFER,li),we.bufferData(we.PIXEL_PACK_BUFFER,Mt.byteLength,we.STREAM_READ),we.readPixels(Le,ot,tt,$e,Pe.convert(di),Pe.convert(Ci),0);const Ni=ce!==null?kt.get(ce).__webglFramebuffer:null;mt.bindFramebuffer(we.FRAMEBUFFER,Ni);const Vi=we.fenceSync(we.SYNC_GPU_COMMANDS_COMPLETE,0);return we.flush(),await probeAsync(we,Vi,4),we.bindBuffer(we.PIXEL_PACK_BUFFER,li),we.getBufferSubData(we.PIXEL_PACK_BUFFER,0,Mt),we.deleteBuffer(li),we.deleteSync(Vi),Mt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Se,Le=null,ot=0){Se.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Le=arguments[0]||null,Se=arguments[1]);const tt=Math.pow(2,-ot),$e=Math.floor(Se.image.width*tt),Mt=Math.floor(Se.image.height*tt),Qt=Le!==null?Le.x:0,ei=Le!==null?Le.y:0;Me.setTexture2D(Se,0),we.copyTexSubImage2D(we.TEXTURE_2D,ot,0,0,Qt,ei,$e,Mt),mt.unbindTexture()};const Qr=we.createFramebuffer(),oo=we.createFramebuffer();this.copyTextureToTexture=function(Se,Le,ot=null,tt=null,$e=0,Mt=null){Se.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),tt=arguments[0]||null,Se=arguments[1],Le=arguments[2],Mt=arguments[3]||0,ot=null),Mt===null&&($e!==0?(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Mt=$e,$e=0):Mt=0);let Qt,ei,qt,di,Ci,li,Ni,Vi,rn;const Ti=Se.isCompressedTexture?Se.mipmaps[Mt]:Se.image;if(ot!==null)Qt=ot.max.x-ot.min.x,ei=ot.max.y-ot.min.y,qt=ot.isBox3?ot.max.z-ot.min.z:1,di=ot.min.x,Ci=ot.min.y,li=ot.isBox3?ot.min.z:0;else{const On=Math.pow(2,-$e);Qt=Math.floor(Ti.width*On),ei=Math.floor(Ti.height*On),Se.isDataArrayTexture?qt=Ti.depth:Se.isData3DTexture?qt=Math.floor(Ti.depth*On):qt=1,di=0,Ci=0,li=0}tt!==null?(Ni=tt.x,Vi=tt.y,rn=tt.z):(Ni=0,Vi=0,rn=0);const mi=Pe.convert(Le.format),ci=Pe.convert(Le.type);let _n;Le.isData3DTexture?(Me.setTexture3D(Le,0),_n=we.TEXTURE_3D):Le.isDataArrayTexture||Le.isCompressedArrayTexture?(Me.setTexture2DArray(Le,0),_n=we.TEXTURE_2D_ARRAY):(Me.setTexture2D(Le,0),_n=we.TEXTURE_2D),we.pixelStorei(we.UNPACK_FLIP_Y_WEBGL,Le.flipY),we.pixelStorei(we.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),we.pixelStorei(we.UNPACK_ALIGNMENT,Le.unpackAlignment);const Ei=we.getParameter(we.UNPACK_ROW_LENGTH),hs=we.getParameter(we.UNPACK_IMAGE_HEIGHT),Vs=we.getParameter(we.UNPACK_SKIP_PIXELS),es=we.getParameter(we.UNPACK_SKIP_ROWS),Jn=we.getParameter(we.UNPACK_SKIP_IMAGES);we.pixelStorei(we.UNPACK_ROW_LENGTH,Ti.width),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,Ti.height),we.pixelStorei(we.UNPACK_SKIP_PIXELS,di),we.pixelStorei(we.UNPACK_SKIP_ROWS,Ci),we.pixelStorei(we.UNPACK_SKIP_IMAGES,li);const Oi=Se.isDataArrayTexture||Se.isData3DTexture,ts=Le.isDataArrayTexture||Le.isData3DTexture;if(Se.isDepthTexture){const On=kt.get(Se),mn=kt.get(Le),Kn=kt.get(On.__renderTarget),ro=kt.get(mn.__renderTarget);mt.bindFramebuffer(we.READ_FRAMEBUFFER,Kn.__webglFramebuffer),mt.bindFramebuffer(we.DRAW_FRAMEBUFFER,ro.__webglFramebuffer);for(let ds=0;ds<qt;ds++)Oi&&(we.framebufferTextureLayer(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,kt.get(Se).__webglTexture,$e,li+ds),we.framebufferTextureLayer(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,kt.get(Le).__webglTexture,Mt,rn+ds)),we.blitFramebuffer(di,Ci,Qt,ei,Ni,Vi,Qt,ei,we.DEPTH_BUFFER_BIT,we.NEAREST);mt.bindFramebuffer(we.READ_FRAMEBUFFER,null),mt.bindFramebuffer(we.DRAW_FRAMEBUFFER,null)}else if($e!==0||Se.isRenderTargetTexture||kt.has(Se)){const On=kt.get(Se),mn=kt.get(Le);mt.bindFramebuffer(we.READ_FRAMEBUFFER,Qr),mt.bindFramebuffer(we.DRAW_FRAMEBUFFER,oo);for(let Kn=0;Kn<qt;Kn++)Oi?we.framebufferTextureLayer(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,On.__webglTexture,$e,li+Kn):we.framebufferTexture2D(we.READ_FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,On.__webglTexture,$e),ts?we.framebufferTextureLayer(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,mn.__webglTexture,Mt,rn+Kn):we.framebufferTexture2D(we.DRAW_FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_2D,mn.__webglTexture,Mt),$e!==0?we.blitFramebuffer(di,Ci,Qt,ei,Ni,Vi,Qt,ei,we.COLOR_BUFFER_BIT,we.NEAREST):ts?we.copyTexSubImage3D(_n,Mt,Ni,Vi,rn+Kn,di,Ci,Qt,ei):we.copyTexSubImage2D(_n,Mt,Ni,Vi,di,Ci,Qt,ei);mt.bindFramebuffer(we.READ_FRAMEBUFFER,null),mt.bindFramebuffer(we.DRAW_FRAMEBUFFER,null)}else ts?Se.isDataTexture||Se.isData3DTexture?we.texSubImage3D(_n,Mt,Ni,Vi,rn,Qt,ei,qt,mi,ci,Ti.data):Le.isCompressedArrayTexture?we.compressedTexSubImage3D(_n,Mt,Ni,Vi,rn,Qt,ei,qt,mi,Ti.data):we.texSubImage3D(_n,Mt,Ni,Vi,rn,Qt,ei,qt,mi,ci,Ti):Se.isDataTexture?we.texSubImage2D(we.TEXTURE_2D,Mt,Ni,Vi,Qt,ei,mi,ci,Ti.data):Se.isCompressedTexture?we.compressedTexSubImage2D(we.TEXTURE_2D,Mt,Ni,Vi,Ti.width,Ti.height,mi,Ti.data):we.texSubImage2D(we.TEXTURE_2D,Mt,Ni,Vi,Qt,ei,mi,ci,Ti);we.pixelStorei(we.UNPACK_ROW_LENGTH,Ei),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,hs),we.pixelStorei(we.UNPACK_SKIP_PIXELS,Vs),we.pixelStorei(we.UNPACK_SKIP_ROWS,es),we.pixelStorei(we.UNPACK_SKIP_IMAGES,Jn),Mt===0&&Le.generateMipmaps&&we.generateMipmap(_n),mt.unbindTexture()},this.copyTextureToTexture3D=function(Se,Le,ot=null,tt=null,$e=0){return Se.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ot=arguments[0]||null,tt=arguments[1]||null,Se=arguments[2],Le=arguments[3],$e=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Se,Le,ot,tt,$e)},this.initRenderTarget=function(Se){kt.get(Se).__webglFramebuffer===void 0&&Me.setupRenderTarget(Se)},this.initTexture=function(Se){Se.isCubeTexture?Me.setTextureCube(Se,0):Se.isData3DTexture?Me.setTexture3D(Se,0):Se.isDataArrayTexture||Se.isCompressedArrayTexture?Me.setTexture2DArray(Se,0):Me.setTexture2D(Se,0),mt.unbindTexture()},this.resetState=function(){le=0,ae=0,ce=null,mt.reset(),Je.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n;const d=this.getContext();d.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(n),d.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}const THREE=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AgXToneMapping,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,AttachedBindMode,Audio,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,BatchedMesh,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,ConstantAlphaFactor,ConstantColorFactor,Controls,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DetachedBindMode,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher:EventDispatcher$1,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace,LinearToneMapping,LinearTransfer,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix2,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeutralToneMapping,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusConstantAlphaFactor,OneMinusConstantColorFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion:Quaternion$2,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGBDepthPacking,RGBFormat,RGBIntegerFormat,RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGDepthPacking,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray:Ray$2,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RenderTarget,RenderTarget3D,RenderTargetArray,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace,SRGBTransfer,Scene,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape:Shape$2,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere:Sphere$1,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TextureUtils,TimestampQuery,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedInt5999Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoFrameTexture,VideoTexture,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WebXRController,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,createCanvasElement},Symbol.toStringTag,{value:"Module"}));var constants$1={exports:{}},reactReconcilerConstants_production={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconcilerConstants_production;function requireReactReconcilerConstants_production(){return hasRequiredReactReconcilerConstants_production||(hasRequiredReactReconcilerConstants_production=1,reactReconcilerConstants_production.ConcurrentRoot=1,reactReconcilerConstants_production.ContinuousEventPriority=8,reactReconcilerConstants_production.DefaultEventPriority=32,reactReconcilerConstants_production.DiscreteEventPriority=2,reactReconcilerConstants_production.IdleEventPriority=268435456,reactReconcilerConstants_production.LegacyRoot=0,reactReconcilerConstants_production.NoEventPriority=0),reactReconcilerConstants_production}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants$1.exports=requireReactReconcilerConstants_production()),constants$1.exports}var constantsExports=requireConstants(),withSelector={exports:{}},withSelector_production={},shim={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production;function requireUseSyncExternalStoreShim_production(){if(hasRequiredUseSyncExternalStoreShim_production)return useSyncExternalStoreShim_production;hasRequiredUseSyncExternalStoreShim_production=1;var u=requireReact();function n(V,T){return V===T&&(V!==0||1/V===1/T)||V!==V&&T!==T}var d=typeof Object.is=="function"?Object.is:n,C=u.useState,I=u.useEffect,f=u.useLayoutEffect,y=u.useDebugValue;function B(V,T){var H=T(),F=C({inst:{value:H,getSnapshot:T}}),O=F[0].inst,$=F[1];return f(function(){O.value=H,O.getSnapshot=T,_(O)&&$({inst:O})},[V,H,T]),I(function(){return _(O)&&$({inst:O}),V(function(){_(O)&&$({inst:O})})},[V]),y(H),H}function _(V){var T=V.getSnapshot;V=V.value;try{var H=T();return!d(V,H)}catch{return!0}}function Z(V,T){return T()}var M=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Z:B;return useSyncExternalStoreShim_production.useSyncExternalStore=u.useSyncExternalStore!==void 0?u.useSyncExternalStore:M,useSyncExternalStoreShim_production}var hasRequiredShim;function requireShim(){return hasRequiredShim||(hasRequiredShim=1,shim.exports=requireUseSyncExternalStoreShim_production()),shim.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredWithSelector_production;function requireWithSelector_production(){if(hasRequiredWithSelector_production)return withSelector_production;hasRequiredWithSelector_production=1;var u=requireReact(),n=requireShim();function d(Z,M){return Z===M&&(Z!==0||1/Z===1/M)||Z!==Z&&M!==M}var C=typeof Object.is=="function"?Object.is:d,I=n.useSyncExternalStore,f=u.useRef,y=u.useEffect,B=u.useMemo,_=u.useDebugValue;return withSelector_production.useSyncExternalStoreWithSelector=function(Z,M,V,T,H){var F=f(null);if(F.current===null){var O={hasValue:!1,value:null};F.current=O}else O=F.current;F=B(function(){function U(le){if(!ee){if(ee=!0,Q=le,le=T(le),H!==void 0&&O.hasValue){var ae=O.value;if(H(ae,le))return ie=ae}return ie=le}if(ae=ie,C(Q,le))return ae;var ce=T(le);return H!==void 0&&H(ae,ce)?(Q=le,ae):(Q=le,ie=ce)}var ee=!1,Q,ie,ne=V===void 0?null:V;return[function(){return U(M())},ne===null?void 0:function(){return U(ne())}]},[M,V,T,H]);var $=I(Z,F[0],F[1]);return y(function(){O.hasValue=!0,O.value=$},[$]),_($),$},withSelector_production}var hasRequiredWithSelector;function requireWithSelector(){return hasRequiredWithSelector||(hasRequiredWithSelector=1,withSelector.exports=requireWithSelector_production()),withSelector.exports}var withSelectorExports=requireWithSelector();const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),createStoreImpl=u=>{let n;const d=new Set,C=(Z,M)=>{const V=typeof Z=="function"?Z(n):Z;if(!Object.is(V,n)){const T=n;n=M??(typeof V!="object"||V===null)?V:Object.assign({},n,V),d.forEach(H=>H(n,T))}},I=()=>n,B={setState:C,getState:I,getInitialState:()=>_,subscribe:Z=>(d.add(Z),()=>d.delete(Z))},_=n=u(C,I,B);return B},createStore$1=u=>u?createStoreImpl(u):createStoreImpl,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports,identity=u=>u;function useStoreWithEqualityFn(u,n=identity,d){const C=useSyncExternalStoreWithSelector(u.subscribe,u.getState,u.getInitialState,n,d);return React.useDebugValue(C),C}const createWithEqualityFnImpl=(u,n)=>{const d=createStore$1(u),C=(I,f=n)=>useStoreWithEqualityFn(d,I,f);return Object.assign(C,d),C},createWithEqualityFn=(u,n)=>u?createWithEqualityFnImpl(u,n):createWithEqualityFnImpl;var reactReconciler={exports:{}},reactReconciler_production={exports:{}};/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconciler_production;function requireReactReconciler_production(){return hasRequiredReactReconciler_production||(hasRequiredReactReconciler_production=1,function(u){u.exports=function(n){function d(J,z,se,re){return new Yu(J,z,se,re)}function C(){}function I(J){var z="https://react.dev/errors/"+J;if(1<arguments.length){z+="?args[]="+encodeURIComponent(arguments[1]);for(var se=2;se<arguments.length;se++)z+="&args[]="+encodeURIComponent(arguments[se])}return"Minified React error #"+J+"; visit "+z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(J){return J===null||typeof J!="object"?null:(J=Ui&&J[Ui]||J["@@iterator"],typeof J=="function"?J:null)}function y(J){if(J==null)return null;if(typeof J=="function")return J.$$typeof===Mn?null:J.displayName||J.name||null;if(typeof J=="string")return J;switch(J){case Zr:return"Fragment";case So:return"Portal";case Mr:return"Profiler";case ha:return"StrictMode";case Qo:return"Suspense";case Pl:return"SuspenseList"}if(typeof J=="object")switch(J.$$typeof){case Nr:return(J.displayName||"Context")+".Provider";case Rg:return(J._context.displayName||"Context")+".Consumer";case _c:var z=J.render;return J=J.displayName,J||(J=z.displayName||z.name||"",J=J!==""?"ForwardRef("+J+")":"ForwardRef"),J;case Oa:return z=J.displayName||null,z!==null?z:y(J.type)||"Memo";case qo:z=J._payload,J=J._init;try{return y(J(z))}catch{}}return null}function B(J){if(Vr===void 0)try{throw Error()}catch(se){var z=se.stack.trim().match(/\n( *(at )?)/);Vr=z&&z[1]||"",Er=-1<se.stack.indexOf(`
    at`)?" (<anonymous>)":-1<se.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vr+J+Er}function _(J,z){if(!J||Ua)return"";Ua=!0;var se=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var re={DetermineComponentFrameRoot:function(){try{if(z){var ti=function(){throw Error()};if(Object.defineProperty(ti.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ti,[])}catch(yi){var Pt=yi}Reflect.construct(J,[],ti)}else{try{ti.call()}catch(yi){Pt=yi}J.call(ti.prototype)}}else{try{throw Error()}catch(yi){Pt=yi}(ti=J())&&typeof ti.catch=="function"&&ti.catch(function(){})}}catch(yi){if(yi&&Pt&&typeof yi.stack=="string")return[yi.stack,Pt.stack]}return[null,null]}};re.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var de=Object.getOwnPropertyDescriptor(re.DetermineComponentFrameRoot,"name");de&&de.configurable&&Object.defineProperty(re.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Ce=re.DetermineComponentFrameRoot(),Xe=Ce[0],He=Ce[1];if(Xe&&He){var qe=Xe.split(`
`),vt=He.split(`
`);for(de=re=0;re<qe.length&&!qe[re].includes("DetermineComponentFrameRoot");)re++;for(;de<vt.length&&!vt[de].includes("DetermineComponentFrameRoot");)de++;if(re===qe.length||de===vt.length)for(re=qe.length-1,de=vt.length-1;1<=re&&0<=de&&qe[re]!==vt[de];)de--;for(;1<=re&&0<=de;re--,de--)if(qe[re]!==vt[de]){if(re!==1||de!==1)do if(re--,de--,0>de||qe[re]!==vt[de]){var Ot=`
`+qe[re].replace(" at new "," at ");return J.displayName&&Ot.includes("<anonymous>")&&(Ot=Ot.replace("<anonymous>",J.displayName)),Ot}while(1<=re&&0<=de);break}}}finally{Ua=!1,Error.prepareStackTrace=se}return(se=J?J.displayName||J.name:"")?B(se):""}function Z(J){switch(J.tag){case 26:case 27:case 5:return B(J.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 15:return J=_(J.type,!1),J;case 11:return J=_(J.type.render,!1),J;case 1:return J=_(J.type,!0),J;default:return""}}function M(J){try{var z="";do z+=Z(J),J=J.return;while(J);return z}catch(se){return`
Error generating stack: `+se.message+`
`+se.stack}}function V(J){var z=J,se=J;if(J.alternate)for(;z.return;)z=z.return;else{J=z;do z=J,(z.flags&4098)!==0&&(se=z.return),J=z.return;while(J)}return z.tag===3?se:null}function T(J){if(V(J)!==J)throw Error(I(188))}function H(J){var z=J.alternate;if(!z){if(z=V(J),z===null)throw Error(I(188));return z!==J?null:J}for(var se=J,re=z;;){var de=se.return;if(de===null)break;var Ce=de.alternate;if(Ce===null){if(re=de.return,re!==null){se=re;continue}break}if(de.child===Ce.child){for(Ce=de.child;Ce;){if(Ce===se)return T(de),J;if(Ce===re)return T(de),z;Ce=Ce.sibling}throw Error(I(188))}if(se.return!==re.return)se=de,re=Ce;else{for(var Xe=!1,He=de.child;He;){if(He===se){Xe=!0,se=de,re=Ce;break}if(He===re){Xe=!0,re=de,se=Ce;break}He=He.sibling}if(!Xe){for(He=Ce.child;He;){if(He===se){Xe=!0,se=Ce,re=de;break}if(He===re){Xe=!0,re=Ce,se=de;break}He=He.sibling}if(!Xe)throw Error(I(189))}}if(se.alternate!==re)throw Error(I(190))}if(se.tag!==3)throw Error(I(188));return se.stateNode.current===se?J:z}function F(J){var z=J.tag;if(z===5||z===26||z===27||z===6)return J;for(J=J.child;J!==null;){if(z=F(J),z!==null)return z;J=J.sibling}return null}function O(J){var z=J.tag;if(z===5||z===26||z===27||z===6)return J;for(J=J.child;J!==null;){if(J.tag!==4&&(z=O(J),z!==null))return z;J=J.sibling}return null}function $(J){return{current:J}}function U(J){0>Jr||(J.current=Fc[Jr],Fc[Jr]=null,Jr--)}function ee(J,z){Jr++,Fc[Jr]=J.current,J.current=z}function Q(J){return J>>>=0,J===0?32:31-(Qg(J)/ed|0)|0}function ie(J){var z=J&42;if(z!==0)return z;switch(J&-J){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return J&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return J&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return J}}function ne(J,z){var se=J.pendingLanes;if(se===0)return 0;var re=0,de=J.suspendedLanes,Ce=J.pingedLanes,Xe=J.warmLanes;J=J.finishedLanes!==0;var He=se&134217727;return He!==0?(se=He&~de,se!==0?re=ie(se):(Ce&=He,Ce!==0?re=ie(Ce):J||(Xe=He&~Xe,Xe!==0&&(re=ie(Xe))))):(He=se&~de,He!==0?re=ie(He):Ce!==0?re=ie(Ce):J||(Xe=se&~Xe,Xe!==0&&(re=ie(Xe)))),re===0?0:z!==0&&z!==re&&(z&de)===0&&(de=re&-re,Xe=z&-z,de>=Xe||de===32&&(Xe&4194176)!==0)?z:re}function le(J,z){return(J.pendingLanes&~(J.suspendedLanes&~J.pingedLanes)&z)===0}function ae(J,z){switch(J){case 1:case 2:case 4:case 8:return z+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return z+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ce(){var J=Ul;return Ul<<=1,(Ul&4194176)===0&&(Ul=128),J}function ge(){var J=el;return el<<=1,(el&62914560)===0&&(el=4194304),J}function he(J){for(var z=[],se=0;31>se;se++)z.push(J);return z}function Ie(J,z){J.pendingLanes|=z,z!==268435456&&(J.suspendedLanes=0,J.pingedLanes=0,J.warmLanes=0)}function fe(J,z,se,re,de,Ce){var Xe=J.pendingLanes;J.pendingLanes=se,J.suspendedLanes=0,J.pingedLanes=0,J.warmLanes=0,J.expiredLanes&=se,J.entangledLanes&=se,J.errorRecoveryDisabledLanes&=se,J.shellSuspendCounter=0;var He=J.entanglements,qe=J.expirationTimes,vt=J.hiddenUpdates;for(se=Xe&~se;0<se;){var Ot=31-vn(se),ti=1<<Ot;He[Ot]=0,qe[Ot]=-1;var Pt=vt[Ot];if(Pt!==null)for(vt[Ot]=null,Ot=0;Ot<Pt.length;Ot++){var yi=Pt[Ot];yi!==null&&(yi.lane&=-536870913)}se&=~ti}re!==0&&me(J,re,0),Ce!==0&&de===0&&J.tag!==0&&(J.suspendedLanes|=Ce&~(Xe&~z))}function me(J,z,se){J.pendingLanes|=z,J.suspendedLanes&=~z;var re=31-vn(z);J.entangledLanes|=z,J.entanglements[re]=J.entanglements[re]|1073741824|se&4194218}function Ge(J,z){var se=J.entangledLanes|=z;for(J=J.entanglements;se;){var re=31-vn(se),de=1<<re;de&z|J[re]&z&&(J[re]|=z),se&=~de}}function Ze(J){return J&=-J,2<J?8<J?(J&134217727)!==0?32:268435456:8:2}function ye(J){if(Nn&&typeof Nn.onCommitFiberRoot=="function")try{Nn.onCommitFiberRoot(il,J,void 0,(J.current.flags&128)===128)}catch{}}function Ee(J){if(typeof os=="function"&&Kc(J),Nn&&typeof Nn.setStrictMode=="function")try{Nn.setStrictMode(il,J)}catch{}}function Ve(J,z){return J===z&&(J!==0||1/J===1/z)||J!==J&&z!==z}function Ye(J,z){if(typeof J=="object"&&J!==null){var se=Pc.get(J);return se!==void 0?se:(z={value:J,source:z,stack:M(z)},Pc.set(J,z),z)}return{value:J,source:z,stack:M(z)}}function be(J,z){Js[Hs++]=nl,Js[Hs++]=zr,zr=J,nl=z}function Be(J,z,se){Zs[rs++]=_o,Zs[rs++]=wo,Zs[rs++]=uo,uo=J;var re=_o;J=wo;var de=32-vn(re)-1;re&=~(1<<de),se+=1;var Ce=32-vn(z)+de;if(30<Ce){var Xe=de-de%5;Ce=(re&(1<<Xe)-1).toString(32),re>>=Xe,de-=Xe,_o=1<<32-vn(z)+de|se<<de|re,wo=Ce+J}else _o=1<<Ce|se<<de|re,wo=J}function Ne(J){J.return!==null&&(be(J,1),Be(J,1,0))}function Ae(J){for(;J===zr;)zr=Js[--Hs],Js[Hs]=null,nl=Js[--Hs],Js[Hs]=null;for(;J===uo;)uo=Zs[--rs],Zs[rs]=null,wo=Zs[--rs],Zs[rs]=null,_o=Zs[--rs],Zs[rs]=null}function Re(J,z){ee(sr,z),ee(Ds,J),ee(Bn,null),J=_g(z),U(Bn),ee(Bn,J)}function We(){U(Bn),U(Ds),U(sr)}function De(J){J.memoizedState!==null&&ee(jl,J);var z=Bn.current,se=Tu(z,J.type);z!==se&&(ee(Ds,J),ee(Bn,se))}function Fe(J){Ds.current===J&&(U(Bn),U(Ds)),jl.current===J&&(U(jl),lo?tr._currentValue=Ca:tr._currentValue2=Ca)}function Ke(J){var z=Error(I(418,""));throw nt(Ye(z,J)),Ql}function Rt(J,z){if(!ws)throw Error(I(175));Aa(J.stateNode,J.type,J.memoizedProps,z,J)||Ke(J)}function dt(J){for(Sn=J.return;Sn;)switch(Sn.tag){case 3:case 27:ho=!0;return;case 5:case 13:ho=!1;return;default:Sn=Sn.return}}function Ut(J){if(!ws||J!==Sn)return!1;if(!Hi)return dt(J),Hi=!0,!1;var z=!1;if(kn?J.tag!==3&&J.tag!==27&&(J.tag!==5||Fg(J.type)&&!Qn(J.type,J.memoizedProps))&&(z=!0):J.tag!==3&&(J.tag!==5||Fg(J.type)&&!Qn(J.type,J.memoizedProps))&&(z=!0),z&&ji&&Ke(J),dt(J),J.tag===13){if(!ws)throw Error(I(316));if(J=J.memoizedState,J=J!==null?J.dehydrated:null,!J)throw Error(I(317));ji=fh(J)}else ji=Sn?Tr(J.stateNode):null;return!0}function rt(){ws&&(ji=Sn=null,Hi=!1)}function nt(J){Os===null?Os=[J]:Os.push(J)}function we(){for(var J=or,z=Co=or=0;z<J;){var se=Ms[z];Ms[z++]=null;var re=Ms[z];Ms[z++]=null;var de=Ms[z];Ms[z++]=null;var Ce=Ms[z];if(Ms[z++]=null,re!==null&&de!==null){var Xe=re.pending;Xe===null?de.next=de:(de.next=Xe.next,Xe.next=de),re.pending=de}Ce!==0&&mt(se,de,Ce)}}function Jt(J,z,se,re){Ms[or++]=J,Ms[or++]=z,Ms[or++]=se,Ms[or++]=re,Co|=re,J.lanes|=re,J=J.alternate,J!==null&&(J.lanes|=re)}function It(J,z,se,re){return Jt(J,z,se,re),ni(J)}function Ht(J,z){return Jt(J,null,null,z),ni(J)}function mt(J,z,se){J.lanes|=se;var re=J.alternate;re!==null&&(re.lanes|=se);for(var de=!1,Ce=J.return;Ce!==null;)Ce.childLanes|=se,re=Ce.alternate,re!==null&&(re.childLanes|=se),Ce.tag===22&&(J=Ce.stateNode,J===null||J._visibility&1||(de=!0)),J=Ce,Ce=Ce.return;de&&z!==null&&J.tag===3&&(Ce=J.stateNode,de=31-vn(se),Ce=Ce.hiddenUpdates,J=Ce[de],J===null?Ce[de]=[z]:J.push(z),z.lane=se|536870912)}function ni(J){if(50<Xa)throw Xa=0,nu=null,Error(I(185));for(var z=J.return;z!==null;)J=z,z=J.return;return J.tag===3?J.stateNode:null}function kt(J){J!==Fr&&J.next===null&&(Fr===null?gn=Fr=J:Fr=Fr.next=J),xn=!0,kc||(kc=!0,Ue(ve))}function Me(J,z){if(!Dc&&xn){Dc=!0;do for(var se=!1,re=gn;re!==null;){if(J!==0){var de=re.pendingLanes;if(de===0)var Ce=0;else{var Xe=re.suspendedLanes,He=re.pingedLanes;Ce=(1<<31-vn(42|J)+1)-1,Ce&=de&~(Xe&~He),Ce=Ce&201326677?Ce&201326677|1:Ce?Ce|2:0}Ce!==0&&(se=!0,Xt(re,Ce))}else Ce=Mi,Ce=ne(re,re===qi?Ce:0),(Ce&3)===0||le(re,Ce)||(se=!0,Xt(re,Ce));re=re.next}while(se);Dc=!1}}function ve(){xn=kc=!1;var J=0;sl!==0&&(Fu()&&(J=sl),sl=0);for(var z=Ts(),se=null,re=gn;re!==null;){var de=re.next,Ce=et(re,z);Ce===0?(re.next=null,se===null?gn=de:se.next=de,de===null&&(Fr=se)):(se=re,(J!==0||(Ce&3)!==0)&&(xn=!0)),re=de}Me(J)}function et(J,z){for(var se=J.suspendedLanes,re=J.pingedLanes,de=J.expirationTimes,Ce=J.pendingLanes&-62914561;0<Ce;){var Xe=31-vn(Ce),He=1<<Xe,qe=de[Xe];qe===-1?((He&se)===0||(He&re)!==0)&&(de[Xe]=ae(He,z)):qe<=z&&(J.expiredLanes|=He),Ce&=~He}if(z=qi,se=Mi,se=ne(J,J===z?se:0),re=J.callbackNode,se===0||J===z&&$i===2||J.cancelPendingCommit!==null)return re!==null&&re!==null&&go(re),J.callbackNode=null,J.callbackPriority=0;if((se&3)===0||le(J,se)){if(z=se&-se,z===J.callbackPriority)return z;switch(re!==null&&go(re),Ze(se)){case 2:case 8:se=$l;break;case 32:se=tl;break;case 268435456:se=ya;break;default:se=tl}return re=ht.bind(null,J),se=Ro(se,re),J.callbackPriority=z,J.callbackNode=se,z}return re!==null&&re!==null&&go(re),J.callbackPriority=2,J.callbackNode=null,2}function ht(J,z){var se=J.callbackNode;if(Xr()&&J.callbackNode!==se)return null;var re=Mi;return re=ne(J,J===qi?re:0),re===0?null:(Es(J,re,z),et(J,Ts()),J.callbackNode!=null&&J.callbackNode===se?ht.bind(null,J):null)}function Xt(J,z){if(Xr())return null;Es(J,z,!0)}function Ue(J){ku?Du(function(){(Zi&6)!==0?Ro(Lc,J):J()}):Ro(Lc,J)}function ft(){return sl===0&&(sl=ce()),sl}function Dt(J,z){if(ol===null){var se=ol=[];Oc=0,un=ft(),Dn={status:"pending",value:void 0,then:function(re){se.push(re)}}}return Oc++,z.then(jt,jt),z}function jt(){if(--Oc===0&&ol!==null){Dn!==null&&(Dn.status="fulfilled");var J=ol;ol=null,un=0,Dn=null;for(var z=0;z<J.length;z++)(0,J[z])()}}function ii(J,z){var se=[],re={status:"pending",value:null,reason:null,then:function(de){se.push(de)}};return J.then(function(){re.status="fulfilled",re.value=z;for(var de=0;de<se.length;de++)(0,se[de])(z)},function(de){for(re.status="rejected",re.reason=de,de=0;de<se.length;de++)(0,se[de])(void 0)}),re}function it(J){J.updateQueue={baseState:J.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gt(J,z){J=J.updateQueue,z.updateQueue===J&&(z.updateQueue={baseState:J.baseState,firstBaseUpdate:J.firstBaseUpdate,lastBaseUpdate:J.lastBaseUpdate,shared:J.shared,callbacks:null})}function Zt(J){return{lane:J,tag:0,payload:null,callback:null,next:null}}function Nt(J,z,se){var re=J.updateQueue;if(re===null)return null;if(re=re.shared,(Zi&2)!==0){var de=re.pending;return de===null?z.next=z:(z.next=de.next,de.next=z),re.pending=z,z=ni(J),mt(J,null,se),z}return Jt(J,re,z,se),ni(J)}function _t(J,z,se){if(z=z.updateQueue,z!==null&&(z=z.shared,(se&4194176)!==0)){var re=z.lanes;re&=J.pendingLanes,se|=re,z.lanes=se,Ge(J,se)}}function _e(J,z){var se=J.updateQueue,re=J.alternate;if(re!==null&&(re=re.updateQueue,se===re)){var de=null,Ce=null;if(se=se.firstBaseUpdate,se!==null){do{var Xe={lane:se.lane,tag:se.tag,payload:se.payload,callback:null,next:null};Ce===null?de=Ce=Xe:Ce=Ce.next=Xe,se=se.next}while(se!==null);Ce===null?de=Ce=z:Ce=Ce.next=z}else de=Ce=z;se={baseState:re.baseState,firstBaseUpdate:de,lastBaseUpdate:Ce,shared:re.shared,callbacks:re.callbacks},J.updateQueue=se;return}J=se.lastBaseUpdate,J===null?se.firstBaseUpdate=z:J.next=z,se.lastBaseUpdate=z}function Pe(){if(Uc){var J=Dn;if(J!==null)throw J}}function Je(J,z,se,re){Uc=!1;var de=J.updateQueue;as=!1;var Ce=de.firstBaseUpdate,Xe=de.lastBaseUpdate,He=de.shared.pending;if(He!==null){de.shared.pending=null;var qe=He,vt=qe.next;qe.next=null,Xe===null?Ce=vt:Xe.next=vt,Xe=qe;var Ot=J.alternate;Ot!==null&&(Ot=Ot.updateQueue,He=Ot.lastBaseUpdate,He!==Xe&&(He===null?Ot.firstBaseUpdate=vt:He.next=vt,Ot.lastBaseUpdate=qe))}if(Ce!==null){var ti=de.baseState;Xe=0,Ot=vt=qe=null,He=Ce;do{var Pt=He.lane&-536870913,yi=Pt!==He.lane;if(yi?(Mi&Pt)===Pt:(re&Pt)===Pt){Pt!==0&&Pt===un&&(Uc=!0),Ot!==null&&(Ot=Ot.next={lane:0,tag:He.tag,payload:He.payload,callback:null,next:null});e:{var io=J,ul=He;Pt=z;var Ra=se;switch(ul.tag){case 1:if(io=ul.payload,typeof io=="function"){ti=io.call(Ra,ti,Pt);break e}ti=io;break e;case 3:io.flags=io.flags&-65537|128;case 0:if(io=ul.payload,Pt=typeof io=="function"?io.call(Ra,ti,Pt):io,Pt==null)break e;ti=yn({},ti,Pt);break e;case 2:as=!0}}Pt=He.callback,Pt!==null&&(J.flags|=64,yi&&(J.flags|=8192),yi=de.callbacks,yi===null?de.callbacks=[Pt]:yi.push(Pt))}else yi={lane:Pt,tag:He.tag,payload:He.payload,callback:He.callback,next:null},Ot===null?(vt=Ot=yi,qe=ti):Ot=Ot.next=yi,Xe|=Pt;if(He=He.next,He===null){if(He=de.shared.pending,He===null)break;yi=He,He=yi.next,yi.next=null,de.lastBaseUpdate=yi,de.shared.pending=null}}while(!0);Ot===null&&(qe=ti),de.baseState=qe,de.firstBaseUpdate=vt,de.lastBaseUpdate=Ot,Ce===null&&(de.shared.lanes=0),eo|=Xe,J.lanes=Xe,J.memoizedState=ti}}function ze(J,z){if(typeof J!="function")throw Error(I(191,J));J.call(z)}function Kt(J,z){var se=J.callbacks;if(se!==null)for(J.callbacks=null,J=0;J<se.length;J++)ze(se[J],z)}function ct(J,z){if(ps(J,z))return!0;if(typeof J!="object"||J===null||typeof z!="object"||z===null)return!1;var se=Object.keys(J),re=Object.keys(z);if(se.length!==re.length)return!1;for(re=0;re<se.length;re++){var de=se[re];if(!Bh.call(z,de)||!ps(J[de],z[de]))return!1}return!0}function bt(J){return J=J.status,J==="fulfilled"||J==="rejected"}function Tt(){}function $t(J,z,se){switch(se=J[se],se===void 0?J.push(z):se!==z&&(z.then(Tt,Tt),z=se),z.status){case"fulfilled":return z.value;case"rejected":throw J=z.reason,J===ql?Error(I(483)):J;default:if(typeof z.status=="string")z.then(Tt,Tt);else{if(J=qi,J!==null&&100<J.shellSuspendCounter)throw Error(I(482));J=z,J.status="pending",J.then(function(re){if(z.status==="pending"){var de=z;de.status="fulfilled",de.value=re}},function(re){if(z.status==="pending"){var de=z;de.status="rejected",de.reason=re}})}switch(z.status){case"fulfilled":return z.value;case"rejected":throw J=z.reason,J===ql?Error(I(483)):J}throw ls=z,ql}}function si(){if(ls===null)throw Error(I(459));var J=ls;return ls=null,J}function Bi(J){var z=cs;return cs+=1,Ga===null&&(Ga=[]),$t(Ga,J,z)}function Ki(J,z){z=z.props.ref,J.ref=z!==void 0?z:null}function Gi(J,z){throw z.$$typeof===Xg?Error(I(525)):(J=Object.prototype.toString.call(z),Error(I(31,J==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":J)))}function _i(J){var z=J._init;return z(J._payload)}function Di(J){function z(at,je){if(J){var ut=at.deletions;ut===null?(at.deletions=[je],at.flags|=16):ut.push(je)}}function se(at,je){if(!J)return null;for(;je!==null;)z(at,je),je=je.sibling;return null}function re(at){for(var je=new Map;at!==null;)at.key!==null?je.set(at.key,at):je.set(at.index,at),at=at.sibling;return je}function de(at,je){return at=Uo(at,je),at.index=0,at.sibling=null,at}function Ce(at,je,ut){return at.index=ut,J?(ut=at.alternate,ut!==null?(ut=ut.index,ut<je?(at.flags|=33554434,je):ut):(at.flags|=33554434,je)):(at.flags|=1048576,je)}function Xe(at){return J&&at.alternate===null&&(at.flags|=33554434),at}function He(at,je,ut,zt){return je===null||je.tag!==6?(je=Kl(ut,at.mode,zt),je.return=at,je):(je=de(je,ut),je.return=at,je)}function qe(at,je,ut,zt){var ri=ut.type;return ri===Zr?Ot(at,je,ut.props.children,zt,ut.key):je!==null&&(je.elementType===ri||typeof ri=="object"&&ri!==null&&ri.$$typeof===qo&&_i(ri)===je.type)?(je=de(je,ut.props),Ki(je,ut),je.return=at,je):(je=ca(ut.type,ut.key,ut.props,null,at.mode,zt),Ki(je,ut),je.return=at,je)}function vt(at,je,ut,zt){return je===null||je.tag!==4||je.stateNode.containerInfo!==ut.containerInfo||je.stateNode.implementation!==ut.implementation?(je=_s(ut,at.mode,zt),je.return=at,je):(je=de(je,ut.children||[]),je.return=at,je)}function Ot(at,je,ut,zt,ri){return je===null||je.tag!==7?(je=_r(ut,at.mode,zt,ri),je.return=at,je):(je=de(je,ut),je.return=at,je)}function ti(at,je,ut){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return je=Kl(""+je,at.mode,ut),je.return=at,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case wr:return ut=ca(je.type,je.key,je.props,null,at.mode,ut),Ki(ut,je),ut.return=at,ut;case So:return je=_s(je,at.mode,ut),je.return=at,je;case qo:var zt=je._init;return je=zt(je._payload),ti(at,je,ut)}if(Wr(je)||f(je))return je=_r(je,at.mode,ut,null),je.return=at,je;if(typeof je.then=="function")return ti(at,Bi(je),ut);if(je.$$typeof===Nr)return ti(at,Rl(at,je),ut);Gi(at,je)}return null}function Pt(at,je,ut,zt){var ri=je!==null?je.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return ri!==null?null:He(at,je,""+ut,zt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case wr:return ut.key===ri?qe(at,je,ut,zt):null;case So:return ut.key===ri?vt(at,je,ut,zt):null;case qo:return ri=ut._init,ut=ri(ut._payload),Pt(at,je,ut,zt)}if(Wr(ut)||f(ut))return ri!==null?null:Ot(at,je,ut,zt,null);if(typeof ut.then=="function")return Pt(at,je,Bi(ut),zt);if(ut.$$typeof===Nr)return Pt(at,je,Rl(at,ut),zt);Gi(at,ut)}return null}function yi(at,je,ut,zt,ri){if(typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint")return at=at.get(ut)||null,He(je,at,""+zt,ri);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case wr:return at=at.get(zt.key===null?ut:zt.key)||null,qe(je,at,zt,ri);case So:return at=at.get(zt.key===null?ut:zt.key)||null,vt(je,at,zt,ri);case qo:var en=zt._init;return zt=en(zt._payload),yi(at,je,ut,zt,ri)}if(Wr(zt)||f(zt))return at=at.get(ut)||null,Ot(je,at,zt,ri,null);if(typeof zt.then=="function")return yi(at,je,ut,Bi(zt),ri);if(zt.$$typeof===Nr)return yi(at,je,ut,Rl(je,zt),ri);Gi(je,zt)}return null}function io(at,je,ut,zt){for(var ri=null,en=null,hi=je,Ri=je=0,nn=null;hi!==null&&Ri<ut.length;Ri++){hi.index>Ri?(nn=hi,hi=null):nn=hi.sibling;var Wi=Pt(at,hi,ut[Ri],zt);if(Wi===null){hi===null&&(hi=nn);break}J&&hi&&Wi.alternate===null&&z(at,hi),je=Ce(Wi,je,Ri),en===null?ri=Wi:en.sibling=Wi,en=Wi,hi=nn}if(Ri===ut.length)return se(at,hi),Hi&&be(at,Ri),ri;if(hi===null){for(;Ri<ut.length;Ri++)hi=ti(at,ut[Ri],zt),hi!==null&&(je=Ce(hi,je,Ri),en===null?ri=hi:en.sibling=hi,en=hi);return Hi&&be(at,Ri),ri}for(hi=re(hi);Ri<ut.length;Ri++)nn=yi(hi,at,Ri,ut[Ri],zt),nn!==null&&(J&&nn.alternate!==null&&hi.delete(nn.key===null?Ri:nn.key),je=Ce(nn,je,Ri),en===null?ri=nn:en.sibling=nn,en=nn);return J&&hi.forEach(function(jr){return z(at,jr)}),Hi&&be(at,Ri),ri}function ul(at,je,ut,zt){if(ut==null)throw Error(I(151));for(var ri=null,en=null,hi=je,Ri=je=0,nn=null,Wi=ut.next();hi!==null&&!Wi.done;Ri++,Wi=ut.next()){hi.index>Ri?(nn=hi,hi=null):nn=hi.sibling;var jr=Pt(at,hi,Wi.value,zt);if(jr===null){hi===null&&(hi=nn);break}J&&hi&&jr.alternate===null&&z(at,hi),je=Ce(jr,je,Ri),en===null?ri=jr:en.sibling=jr,en=jr,hi=nn}if(Wi.done)return se(at,hi),Hi&&be(at,Ri),ri;if(hi===null){for(;!Wi.done;Ri++,Wi=ut.next())Wi=ti(at,Wi.value,zt),Wi!==null&&(je=Ce(Wi,je,Ri),en===null?ri=Wi:en.sibling=Wi,en=Wi);return Hi&&be(at,Ri),ri}for(hi=re(hi);!Wi.done;Ri++,Wi=ut.next())Wi=yi(hi,at,Ri,Wi.value,zt),Wi!==null&&(J&&Wi.alternate!==null&&hi.delete(Wi.key===null?Ri:Wi.key),je=Ce(Wi,je,Ri),en===null?ri=Wi:en.sibling=Wi,en=Wi);return J&&hi.forEach(function(xh){return z(at,xh)}),Hi&&be(at,Ri),ri}function Ra(at,je,ut,zt){if(typeof ut=="object"&&ut!==null&&ut.type===Zr&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case wr:e:{for(var ri=ut.key;je!==null;){if(je.key===ri){if(ri=ut.type,ri===Zr){if(je.tag===7){se(at,je.sibling),zt=de(je,ut.props.children),zt.return=at,at=zt;break e}}else if(je.elementType===ri||typeof ri=="object"&&ri!==null&&ri.$$typeof===qo&&_i(ri)===je.type){se(at,je.sibling),zt=de(je,ut.props),Ki(zt,ut),zt.return=at,at=zt;break e}se(at,je);break}else z(at,je);je=je.sibling}ut.type===Zr?(zt=_r(ut.props.children,at.mode,zt,ut.key),zt.return=at,at=zt):(zt=ca(ut.type,ut.key,ut.props,null,at.mode,zt),Ki(zt,ut),zt.return=at,at=zt)}return Xe(at);case So:e:{for(ri=ut.key;je!==null;){if(je.key===ri)if(je.tag===4&&je.stateNode.containerInfo===ut.containerInfo&&je.stateNode.implementation===ut.implementation){se(at,je.sibling),zt=de(je,ut.children||[]),zt.return=at,at=zt;break e}else{se(at,je);break}else z(at,je);je=je.sibling}zt=_s(ut,at.mode,zt),zt.return=at,at=zt}return Xe(at);case qo:return ri=ut._init,ut=ri(ut._payload),Ra(at,je,ut,zt)}if(Wr(ut))return io(at,je,ut,zt);if(f(ut)){if(ri=f(ut),typeof ri!="function")throw Error(I(150));return ut=ri.call(ut),ul(at,je,ut,zt)}if(typeof ut.then=="function")return Ra(at,je,Bi(ut),zt);if(ut.$$typeof===Nr)return Ra(at,je,Rl(at,ut),zt);Gi(at,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint"?(ut=""+ut,je!==null&&je.tag===6?(se(at,je.sibling),zt=de(je,ut),zt.return=at,at=zt):(se(at,je),zt=Kl(ut,at.mode,zt),zt.return=at,at=zt),Xe(at)):se(at,je)}return function(at,je,ut,zt){try{cs=0;var ri=Ra(at,je,ut,zt);return Ga=null,ri}catch(hi){if(hi===ql)throw hi;var en=d(29,hi,null,at.mode);return en.lanes=zt,en.return=at,en}finally{}}}function Fn(J,z){J=Ao,ee(fo,J),ee(Io,z),Ao=J|z.baseLanes}function no(){ee(fo,Ao),ee(Io,Io.current)}function Tn(){Ao=fo.current,U(Io),U(fo)}function Ln(J){var z=J.alternate;ee(ln,ln.current&1),ee(Ns,J),Us===null&&(z===null||Io.current!==null||z.memoizedState!==null)&&(Us=J)}function qn(J){if(J.tag===22){if(ee(ln,ln.current),ee(Ns,J),Us===null){var z=J.alternate;z!==null&&z.memoizedState!==null&&(Us=J)}}else vs()}function vs(){ee(ln,ln.current),ee(Ns,Ns.current)}function sn(J){U(Ns),Us===J&&(Us=null),U(ln)}function on(J){for(var z=J;z!==null;){if(z.tag===13){var se=z.memoizedState;if(se!==null&&(se=se.dehydrated,se===null||fa(se)||Ol(se)))return z}else if(z.tag===19&&z.memoizedProps.revealOrder!==void 0){if((z.flags&128)!==0)return z}else if(z.child!==null){z.child.return=z,z=z.child;continue}if(z===J)break;for(;z.sibling===null;){if(z.return===null||z.return===J)return null;z=z.return}z.sibling.return=z.return,z=z.sibling}return null}function pi(){throw Error(I(321))}function so(J,z){if(z===null)return!1;for(var se=0;se<z.length&&se<J.length;se++)if(!ps(J[se],z[se]))return!1;return!0}function Ir(J,z,se,re,de,Ce){return rr=Ce,Ai=z,z.memoizedState=null,z.updateQueue=null,z.lanes=0,Ii.H=J===null||J.memoizedState===null?cr:As,Kr=!1,Ce=se(re,de),Kr=!1,va&&(Ce=rc(z,se,re,de)),oc(J),Ce}function oc(J){Ii.H=Xn;var z=Fi!==null&&Fi.next!==null;if(rr=0,In=Fi=Ai=null,ar=!1,rl=0,lr=null,z)throw Error(I(300));J===null||Vn||(J=J.dependencies,J!==null&&Xl(J)&&(Vn=!0))}function rc(J,z,se,re){Ai=J;var de=0;do{if(va&&(lr=null),rl=0,va=!1,25<=de)throw Error(I(301));if(de+=1,In=Fi=null,J.updateQueue!=null){var Ce=J.updateQueue;Ce.lastEffect=null,Ce.events=null,Ce.stores=null,Ce.memoCache!=null&&(Ce.memoCache.index=0)}Ii.H=kr,Ce=z(se,re)}while(va);return Ce}function ac(){var J=Ii.H,z=J.useState()[0];return z=typeof z.then=="function"?ot(z):z,J=J.useState()[0],(Fi!==null?Fi.memoizedState:null)!==J&&(Ai.flags|=1024),z}function Wo(){var J=Pr!==0;return Pr=0,J}function Qr(J,z,se){z.updateQueue=J.updateQueue,z.flags&=-2053,J.lanes&=~se}function oo(J){if(ar){for(J=J.memoizedState;J!==null;){var z=J.queue;z!==null&&(z.pending=null),J=J.next}ar=!1}rr=0,In=Fi=Ai=null,va=!1,rl=Pr=0,lr=null}function Se(){var J={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return In===null?Ai.memoizedState=In=J:In=In.next=J,In}function Le(){if(Fi===null){var J=Ai.alternate;J=J!==null?J.memoizedState:null}else J=Fi.next;var z=In===null?Ai.memoizedState:In.next;if(z!==null)In=z,Fi=J;else{if(J===null)throw Ai.alternate===null?Error(I(467)):Error(I(310));Fi=J,J={memoizedState:Fi.memoizedState,baseState:Fi.baseState,baseQueue:Fi.baseQueue,queue:Fi.queue,next:null},In===null?Ai.memoizedState=In=J:In=In.next=J}return In}function ot(J){var z=rl;return rl+=1,lr===null&&(lr=[]),J=$t(lr,J,z),z=Ai,(In===null?z.memoizedState:In.next)===null&&(z=z.alternate,Ii.H=z===null||z.memoizedState===null?cr:As),J}function tt(J){if(J!==null&&typeof J=="object"){if(typeof J.then=="function")return ot(J);if(J.$$typeof===Nr)return $n(J)}throw Error(I(438,String(J)))}function $e(J){var z=null,se=Ai.updateQueue;if(se!==null&&(z=se.memoCache),z==null){var re=Ai.alternate;re!==null&&(re=re.updateQueue,re!==null&&(re=re.memoCache,re!=null&&(z={data:re.data.map(function(de){return de.slice()}),index:0})))}if(z==null&&(z={data:[],index:0}),se===null&&(se=qg(),Ai.updateQueue=se),se.memoCache=z,se=z.data[z.index],se===void 0)for(se=z.data[z.index]=Array(J),re=0;re<J;re++)se[re]=Si;return z.index++,se}function Mt(J,z){return typeof z=="function"?z(J):z}function Qt(J){var z=Le();return ei(z,Fi,J)}function ei(J,z,se){var re=J.queue;if(re===null)throw Error(I(311));re.lastRenderedReducer=se;var de=J.baseQueue,Ce=re.pending;if(Ce!==null){if(de!==null){var Xe=de.next;de.next=Ce.next,Ce.next=Xe}z.baseQueue=de=Ce,re.pending=null}if(Ce=J.baseState,de===null)J.memoizedState=Ce;else{z=de.next;var He=Xe=null,qe=null,vt=z,Ot=!1;do{var ti=vt.lane&-536870913;if(ti!==vt.lane?(Mi&ti)===ti:(rr&ti)===ti){var Pt=vt.revertLane;if(Pt===0)qe!==null&&(qe=qe.next={lane:0,revertLane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),ti===un&&(Ot=!0);else if((rr&Pt)===Pt){vt=vt.next,Pt===un&&(Ot=!0);continue}else ti={lane:0,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},qe===null?(He=qe=ti,Xe=Ce):qe=qe.next=ti,Ai.lanes|=Pt,eo|=Pt;ti=vt.action,Kr&&se(Ce,ti),Ce=vt.hasEagerState?vt.eagerState:se(Ce,ti)}else Pt={lane:ti,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},qe===null?(He=qe=Pt,Xe=Ce):qe=qe.next=Pt,Ai.lanes|=ti,eo|=ti;vt=vt.next}while(vt!==null&&vt!==z);if(qe===null?Xe=Ce:qe.next=He,!ps(Ce,J.memoizedState)&&(Vn=!0,Ot&&(se=Dn,se!==null)))throw se;J.memoizedState=Ce,J.baseState=Xe,J.baseQueue=qe,re.lastRenderedState=Ce}return de===null&&(re.lanes=0),[J.memoizedState,re.dispatch]}function qt(J){var z=Le(),se=z.queue;if(se===null)throw Error(I(311));se.lastRenderedReducer=J;var re=se.dispatch,de=se.pending,Ce=z.memoizedState;if(de!==null){se.pending=null;var Xe=de=de.next;do Ce=J(Ce,Xe.action),Xe=Xe.next;while(Xe!==de);ps(Ce,z.memoizedState)||(Vn=!0),z.memoizedState=Ce,z.baseQueue===null&&(z.baseState=Ce),se.lastRenderedState=Ce}return[Ce,re]}function di(J,z,se){var re=Ai,de=Le(),Ce=Hi;if(Ce){if(se===void 0)throw Error(I(407));se=se()}else se=z();var Xe=!ps((Fi||de).memoizedState,se);if(Xe&&(de.memoizedState=se,Vn=!0),de=de.queue,ml(Ni.bind(null,re,de,J),[J]),de.getSnapshot!==z||Xe||In!==null&&In.memoizedState.tag&1){if(re.flags|=2048,ro(9,li.bind(null,re,de,se,z),{destroy:void 0},null),qi===null)throw Error(I(349));Ce||(rr&60)!==0||Ci(re,z,se)}return se}function Ci(J,z,se){J.flags|=16384,J={getSnapshot:z,value:se},z=Ai.updateQueue,z===null?(z=qg(),Ai.updateQueue=z,z.stores=[J]):(se=z.stores,se===null?z.stores=[J]:se.push(J))}function li(J,z,se,re){z.value=se,z.getSnapshot=re,Vi(z)&&rn(J)}function Ni(J,z,se){return se(function(){Vi(z)&&rn(J)})}function Vi(J){var z=J.getSnapshot;J=J.value;try{var se=z();return!ps(J,se)}catch{return!0}}function rn(J){var z=Ht(J,2);z!==null&&an(z,J,2)}function Ti(J){var z=Se();if(typeof J=="function"){var se=J;if(J=se(),Kr){Ee(!0);try{se()}finally{Ee(!1)}}}return z.memoizedState=z.baseState=J,z.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mt,lastRenderedState:J},z}function mi(J,z,se,re){return J.baseState=se,ei(J,Fi,typeof re=="function"?re:Mt)}function ci(J,z,se,re,de){if(Gl(J))throw Error(I(485));if(J=z.action,J!==null){var Ce={payload:de,action:J,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Xe){Ce.listeners.push(Xe)}};Ii.T!==null?se(!0):Ce.isTransition=!1,re(Ce),se=z.pending,se===null?(Ce.next=z.pending=Ce,_n(z,Ce)):(Ce.next=se.next,z.pending=se.next=Ce)}}function _n(J,z){var se=z.action,re=z.payload,de=J.state;if(z.isTransition){var Ce=Ii.T,Xe={};Ii.T=Xe;try{var He=se(de,re),qe=Ii.S;qe!==null&&qe(Xe,He),Ei(J,z,He)}catch(vt){Vs(J,z,vt)}finally{Ii.T=Ce}}else try{Ce=se(de,re),Ei(J,z,Ce)}catch(vt){Vs(J,z,vt)}}function Ei(J,z,se){se!==null&&typeof se=="object"&&typeof se.then=="function"?se.then(function(re){hs(J,z,re)},function(re){return Vs(J,z,re)}):hs(J,z,se)}function hs(J,z,se){z.status="fulfilled",z.value=se,es(z),J.state=se,z=J.pending,z!==null&&(se=z.next,se===z?J.pending=null:(se=se.next,z.next=se,_n(J,se)))}function Vs(J,z,se){var re=J.pending;if(J.pending=null,re!==null){re=re.next;do z.status="rejected",z.reason=se,es(z),z=z.next;while(z!==re)}J.action=null}function es(J){J=J.listeners;for(var z=0;z<J.length;z++)(0,J[z])()}function Jn(J,z){return z}function Oi(J,z){if(Hi){var se=qi.formState;if(se!==null){e:{var re=Ai;if(Hi){if(ji){var de=hh(ji,ho);if(de){ji=Tr(de),re=Xo(de);break e}}Ke(re)}re=!1}re&&(z=se[0])}}se=Se(),se.memoizedState=se.baseState=z,re={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:z},se.queue=re,se=rg.bind(null,Ai,re),re.dispatch=se,re=Ti(!1);var Ce=Na.bind(null,Ai,!1,re.queue);return re=Se(),de={state:z,dispatch:null,action:J,pending:null},re.queue=de,se=ci.bind(null,Ai,de,Ce,se),de.dispatch=se,re.memoizedState=J,[z,se,!1]}function ts(J){var z=Le();return On(z,Fi,J)}function On(J,z,se){z=ei(J,z,Jn)[0],J=Qt(Mt)[0],z=typeof z=="object"&&z!==null&&typeof z.then=="function"?ot(z):z;var re=Le(),de=re.queue,Ce=de.dispatch;return se!==re.memoizedState&&(Ai.flags|=2048,ro(9,mn.bind(null,de,se),{destroy:void 0},null)),[z,Ce,J]}function mn(J,z){J.action=z}function Kn(J){var z=Le(),se=Fi;if(se!==null)return On(z,se,J);Le(),z=z.memoizedState,se=Le();var re=se.queue.dispatch;return se.memoizedState=J,[z,re,!1]}function ro(J,z,se,re){return J={tag:J,create:z,inst:se,deps:re,next:null},z=Ai.updateQueue,z===null&&(z=qg(),Ai.updateQueue=z),se=z.lastEffect,se===null?z.lastEffect=J.next=J:(re=se.next,se.next=J,J.next=re,z.lastEffect=J),J}function ds(){return Le().memoizedState}function lc(J,z,se,re){var de=Se();Ai.flags|=J,de.memoizedState=ro(1|z,se,{destroy:void 0},re===void 0?null:re)}function pl(J,z,se,re){var de=Le();re=re===void 0?null:re;var Ce=de.memoizedState.inst;Fi!==null&&re!==null&&so(re,Fi.memoizedState.deps)?de.memoizedState=ro(z,se,Ce,re):(Ai.flags|=J,de.memoizedState=ro(1|z,se,Ce,re))}function ng(J,z){lc(8390656,8,J,z)}function ml(J,z){pl(2048,8,J,z)}function Cu(J,z){return pl(4,2,J,z)}function Iu(J,z){return pl(4,4,J,z)}function Al(J,z){if(typeof z=="function"){J=J();var se=z(J);return function(){typeof se=="function"?se():z(null)}}if(z!=null)return J=J(),z.current=J,function(){z.current=null}}function cc(J,z,se){se=se!=null?se.concat([J]):null,pl(4,4,Al.bind(null,z,J),se)}function bl(){}function qr(J,z){var se=Le();z=z===void 0?null:z;var re=se.memoizedState;return z!==null&&so(z,re[1])?re[0]:(se.memoizedState=[J,z],J)}function ea(J,z){var se=Le();z=z===void 0?null:z;var re=se.memoizedState;if(z!==null&&so(z,re[1]))return re[0];if(re=J(),Kr){Ee(!0);try{J()}finally{Ee(!1)}}return se.memoizedState=[re,z],re}function gc(J,z,se){return se===void 0||(rr&1073741824)!==0?J.memoizedState=z:(J.memoizedState=se,J=Yl(),Ai.lanes|=J,eo|=J,se)}function uc(J,z,se,re){return ps(se,z)?se:Io.current!==null?(J=gc(J,se,re),ps(J,z)||(Vn=!0),J):(rr&42)===0?(Vn=!0,J.memoizedState=se):(J=Yl(),Ai.lanes|=J,eo|=J,z)}function sg(J,z,se,re,de){var Ce=Yr();fs(Ce!==0&&8>Ce?Ce:8);var Xe=Ii.T,He={};Ii.T=He,Na(J,!1,z,se);try{var qe=de(),vt=Ii.S;if(vt!==null&&vt(He,qe),qe!==null&&typeof qe=="object"&&typeof qe.then=="function"){var Ot=ii(qe,re);fr(J,z,Ot,ns(J))}else fr(J,z,re,ns(J))}catch(ti){fr(J,z,{then:function(){},status:"rejected",reason:ti},ns())}finally{fs(Ce),Ii.T=Xe}}function Za(J){var z=J.memoizedState;if(z!==null)return z;z={memoizedState:Ca,baseState:Ca,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mt,lastRenderedState:Ca},next:null};var se={};return z.next={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mt,lastRenderedState:se},next:null},J.memoizedState=z,J=J.alternate,J!==null&&(J.memoizedState=z),z}function yl(){return $n(tr)}function Ma(){return Le().memoizedState}function Yo(){return Le().memoizedState}function og(J){for(var z=J.return;z!==null;){switch(z.tag){case 24:case 3:var se=ns();J=Zt(se);var re=Nt(z,J,se);re!==null&&(an(re,z,se),_t(re,z,se)),z={cache:br()},J.payload=z;return}z=z.return}}function hc(J,z,se){var re=ns();se={lane:re,revertLane:0,action:se,hasEagerState:!1,eagerState:null,next:null},Gl(J)?Cs(z,se):(se=It(J,z,se,re),se!==null&&(an(se,J,re),pr(se,z,re)))}function rg(J,z,se){var re=ns();fr(J,z,se,re)}function fr(J,z,se,re){var de={lane:re,revertLane:0,action:se,hasEagerState:!1,eagerState:null,next:null};if(Gl(J))Cs(z,de);else{var Ce=J.alternate;if(J.lanes===0&&(Ce===null||Ce.lanes===0)&&(Ce=z.lastRenderedReducer,Ce!==null))try{var Xe=z.lastRenderedState,He=Ce(Xe,se);if(de.hasEagerState=!0,de.eagerState=He,ps(He,Xe))return Jt(J,z,de,0),qi===null&&we(),!1}catch{}finally{}if(se=It(J,z,de,re),se!==null)return an(se,J,re),pr(se,z,re),!0}return!1}function Na(J,z,se,re){if(re={lane:2,revertLane:ft(),action:re,hasEagerState:!1,eagerState:null,next:null},Gl(J)){if(z)throw Error(I(479))}else z=It(J,se,re,2),z!==null&&an(z,J,2)}function Gl(J){var z=J.alternate;return J===Ai||z!==null&&z===Ai}function Cs(J,z){va=ar=!0;var se=J.pending;se===null?z.next=z:(z.next=se.next,se.next=z),J.pending=z}function pr(J,z,se){if((se&4194176)!==0){var re=z.lanes;re&=J.pendingLanes,se|=re,z.lanes=se,Ge(J,se)}}function Va(J,z,se,re){z=J.memoizedState,se=se(re,z),se=se==null?z:yn({},z,se),J.memoizedState=se,J.lanes===0&&(J.updateQueue.baseState=se)}function Ea(J,z,se,re,de,Ce,Xe){return J=J.stateNode,typeof J.shouldComponentUpdate=="function"?J.shouldComponentUpdate(re,Ce,Xe):z.prototype&&z.prototype.isPureReactComponent?!ct(se,re)||!ct(de,Ce):!0}function fu(J,z,se,re){J=z.state,typeof z.componentWillReceiveProps=="function"&&z.componentWillReceiveProps(se,re),typeof z.UNSAFE_componentWillReceiveProps=="function"&&z.UNSAFE_componentWillReceiveProps(se,re),z.state!==J&&al.enqueueReplaceState(z,z.state,null)}function To(J,z){var se=z;if("ref"in z){se={};for(var re in z)re!=="ref"&&(se[re]=z[re])}if(J=J.defaultProps){se===z&&(se=yn({},se));for(var de in J)se[de]===void 0&&(se[de]=J[de])}return se}function Wa(J,z){try{var se=J.onUncaughtError;se(z.value,{componentStack:z.stack})}catch(re){setTimeout(function(){throw re})}}function Ya(J,z,se){try{var re=J.onCaughtError;re(se.value,{componentStack:se.stack,errorBoundary:z.tag===1?z.stateNode:null})}catch(de){setTimeout(function(){throw de})}}function Ta(J,z,se){return se=Zt(se),se.tag=3,se.payload={element:null},se.callback=function(){Wa(J,z)},se}function ag(J){return J=Zt(J),J.tag=3,J}function pu(J,z,se,re){var de=se.type.getDerivedStateFromError;if(typeof de=="function"){var Ce=re.value;J.payload=function(){return de(Ce)},J.callback=function(){Ya(z,se,re)}}var Xe=se.stateNode;Xe!==null&&typeof Xe.componentDidCatch=="function"&&(J.callback=function(){Ya(z,se,re),typeof de!="function"&&(Vo===null?Vo=new Set([this]):Vo.add(this));var He=re.stack;this.componentDidCatch(re.value,{componentStack:He!==null?He:""})})}function Lh(J,z,se,re,de){if(se.flags|=32768,re!==null&&typeof re=="object"&&typeof re.then=="function"){if(z=se.alternate,z!==null&&xl(z,se,de,!0),se=Ns.current,se!==null){switch(se.tag){case 13:return Us===null?ks():se.alternate===null&&fn===0&&(fn=3),se.flags&=-257,se.flags|=65536,se.lanes=de,re===ms?se.flags|=16384:(z=se.updateQueue,z===null?se.updateQueue=new Set([re]):z.add(re),Rr(J,re,de)),!1;case 22:return se.flags|=65536,re===ms?se.flags|=16384:(z=se.updateQueue,z===null?(z={transitions:null,markerInstances:null,retryQueue:new Set([re])},se.updateQueue=z):(se=z.retryQueue,se===null?z.retryQueue=new Set([re]):se.add(re)),Rr(J,re,de)),!1}throw Error(I(435,se.tag))}return Rr(J,re,de),ks(),!1}if(Hi)return z=Ns.current,z!==null?((z.flags&65536)===0&&(z.flags|=256),z.flags|=65536,z.lanes=de,re!==Ql&&(J=Error(I(422),{cause:re}),nt(Ye(J,se)))):(re!==Ql&&(z=Error(I(423),{cause:re}),nt(Ye(z,se))),J=J.current.alternate,J.flags|=65536,de&=-de,J.lanes|=de,re=Ye(re,se),de=Ta(J.stateNode,re,de),_e(J,de),fn!==4&&(fn=2)),!1;var Ce=Error(I(520),{cause:re});if(Ce=Ye(Ce,se),cl===null?cl=[Ce]:cl.push(Ce),fn!==4&&(fn=2),z===null)return!0;re=Ye(re,se),se=z;do{switch(se.tag){case 3:return se.flags|=65536,J=de&-de,se.lanes|=J,J=Ta(se.stateNode,re,J),_e(se,J),!1;case 1:if(z=se.type,Ce=se.stateNode,(se.flags&128)===0&&(typeof z.getDerivedStateFromError=="function"||Ce!==null&&typeof Ce.componentDidCatch=="function"&&(Vo===null||!Vo.has(Ce))))return se.flags|=65536,de&=-de,se.lanes|=de,de=ag(de),pu(de,J,se,re),_e(se,de),!1}se=se.return}while(se!==null);return!1}function Un(J,z,se,re){z.child=J===null?Zo(z,null,se,re):Lr(z,J.child,se,re)}function dc(J,z,se,re,de){se=se.render;var Ce=z.ref;if("ref"in re){var Xe={};for(var He in re)He!=="ref"&&(Xe[He]=re[He])}else Xe=re;return Ar(z),re=Ir(J,z,se,Xe,Ce,de),He=Wo(),J!==null&&!Vn?(Qr(J,z,de),Jo(J,z,de)):(Hi&&He&&Ne(z),z.flags|=1,Un(J,z,re,de),z.child)}function mu(J,z,se,re,de){if(J===null){var Ce=se.type;return typeof Ce=="function"&&!Oo(Ce)&&Ce.defaultProps===void 0&&se.compare===null?(z.tag=15,z.type=Ce,Au(J,z,Ce,re,de)):(J=ca(se.type,null,re,z,z.mode,de),J.ref=z.ref,J.return=z,z.child=J)}if(Ce=J.child,!hg(J,de)){var Xe=Ce.memoizedProps;if(se=se.compare,se=se!==null?se:ct,se(Xe,re)&&J.ref===z.ref)return Jo(J,z,de)}return z.flags|=1,J=Uo(Ce,re),J.ref=z.ref,J.return=z,z.child=J}function Au(J,z,se,re,de){if(J!==null){var Ce=J.memoizedProps;if(ct(Ce,re)&&J.ref===z.ref)if(Vn=!1,z.pendingProps=re=Ce,hg(J,de))(J.flags&131072)!==0&&(Vn=!0);else return z.lanes=J.lanes,Jo(J,z,de)}return Cc(J,z,se,re,de)}function bu(J,z,se){var re=z.pendingProps,de=re.children,Ce=(z.stateNode._pendingVisibility&2)!==0,Xe=J!==null?J.memoizedState:null;if(vl(J,z),re.mode==="hidden"||Ce){if((z.flags&128)!==0){if(re=Xe!==null?Xe.baseLanes|se:se,J!==null){for(de=z.child=J.child,Ce=0;de!==null;)Ce=Ce|de.lanes|de.childLanes,de=de.sibling;z.childLanes=Ce&~re}else z.childLanes=0,z.child=null;return yu(J,z,re,se)}if((se&536870912)!==0)z.memoizedState={baseLanes:0,cachePool:null},J!==null&&fc(z,Xe!==null?Xe.cachePool:null),Xe!==null?Fn(z,Xe):no(),qn(z);else return z.lanes=z.childLanes=536870912,yu(J,z,Xe!==null?Xe.baseLanes|se:se,se)}else Xe!==null?(fc(z,Xe.cachePool),Fn(z,Xe),vs(),z.memoizedState=null):(J!==null&&fc(z,null),no(),vs());return Un(J,z,de,se),z.child}function yu(J,z,se,re){var de=Cg();return de=de===null?null:{parent:lo?bn._currentValue:bn._currentValue2,pool:de},z.memoizedState={baseLanes:se,cachePool:de},J!==null&&fc(z,null),no(),qn(z),J!==null&&xl(J,z,re,!0),null}function vl(J,z){var se=z.ref;if(se===null)J!==null&&J.ref!==null&&(z.flags|=2097664);else{if(typeof se!="function"&&typeof se!="object")throw Error(I(284));(J===null||J.ref!==se)&&(z.flags|=2097664)}}function Cc(J,z,se,re,de){return Ar(z),se=Ir(J,z,se,re,void 0,de),re=Wo(),J!==null&&!Vn?(Qr(J,z,de),Jo(J,z,de)):(Hi&&re&&Ne(z),z.flags|=1,Un(J,z,se,de),z.child)}function Gu(J,z,se,re,de,Ce){return Ar(z),z.updateQueue=null,se=rc(z,re,se,de),oc(J),re=Wo(),J!==null&&!Vn?(Qr(J,z,Ce),Jo(J,z,Ce)):(Hi&&re&&Ne(z),z.flags|=1,Un(J,z,se,Ce),z.child)}function vu(J,z,se,re,de){if(Ar(z),z.stateNode===null){var Ce=ba,Xe=se.contextType;typeof Xe=="object"&&Xe!==null&&(Ce=$n(Xe)),Ce=new se(re,Ce),z.memoizedState=Ce.state!==null&&Ce.state!==void 0?Ce.state:null,Ce.updater=al,z.stateNode=Ce,Ce._reactInternals=z,Ce=z.stateNode,Ce.props=re,Ce.state=z.memoizedState,Ce.refs={},it(z),Xe=se.contextType,Ce.context=typeof Xe=="object"&&Xe!==null?$n(Xe):ba,Ce.state=z.memoizedState,Xe=se.getDerivedStateFromProps,typeof Xe=="function"&&(Va(z,se,Xe,re),Ce.state=z.memoizedState),typeof se.getDerivedStateFromProps=="function"||typeof Ce.getSnapshotBeforeUpdate=="function"||typeof Ce.UNSAFE_componentWillMount!="function"&&typeof Ce.componentWillMount!="function"||(Xe=Ce.state,typeof Ce.componentWillMount=="function"&&Ce.componentWillMount(),typeof Ce.UNSAFE_componentWillMount=="function"&&Ce.UNSAFE_componentWillMount(),Xe!==Ce.state&&al.enqueueReplaceState(Ce,Ce.state,null),Je(z,re,Ce,de),Pe(),Ce.state=z.memoizedState),typeof Ce.componentDidMount=="function"&&(z.flags|=4194308),re=!0}else if(J===null){Ce=z.stateNode;var He=z.memoizedProps,qe=To(se,He);Ce.props=qe;var vt=Ce.context,Ot=se.contextType;Xe=ba,typeof Ot=="object"&&Ot!==null&&(Xe=$n(Ot));var ti=se.getDerivedStateFromProps;Ot=typeof ti=="function"||typeof Ce.getSnapshotBeforeUpdate=="function",He=z.pendingProps!==He,Ot||typeof Ce.UNSAFE_componentWillReceiveProps!="function"&&typeof Ce.componentWillReceiveProps!="function"||(He||vt!==Xe)&&fu(z,Ce,re,Xe),as=!1;var Pt=z.memoizedState;Ce.state=Pt,Je(z,re,Ce,de),Pe(),vt=z.memoizedState,He||Pt!==vt||as?(typeof ti=="function"&&(Va(z,se,ti,re),vt=z.memoizedState),(qe=as||Ea(z,se,qe,re,Pt,vt,Xe))?(Ot||typeof Ce.UNSAFE_componentWillMount!="function"&&typeof Ce.componentWillMount!="function"||(typeof Ce.componentWillMount=="function"&&Ce.componentWillMount(),typeof Ce.UNSAFE_componentWillMount=="function"&&Ce.UNSAFE_componentWillMount()),typeof Ce.componentDidMount=="function"&&(z.flags|=4194308)):(typeof Ce.componentDidMount=="function"&&(z.flags|=4194308),z.memoizedProps=re,z.memoizedState=vt),Ce.props=re,Ce.state=vt,Ce.context=Xe,re=qe):(typeof Ce.componentDidMount=="function"&&(z.flags|=4194308),re=!1)}else{Ce=z.stateNode,Gt(J,z),Xe=z.memoizedProps,Ot=To(se,Xe),Ce.props=Ot,ti=z.pendingProps,Pt=Ce.context,vt=se.contextType,qe=ba,typeof vt=="object"&&vt!==null&&(qe=$n(vt)),He=se.getDerivedStateFromProps,(vt=typeof He=="function"||typeof Ce.getSnapshotBeforeUpdate=="function")||typeof Ce.UNSAFE_componentWillReceiveProps!="function"&&typeof Ce.componentWillReceiveProps!="function"||(Xe!==ti||Pt!==qe)&&fu(z,Ce,re,qe),as=!1,Pt=z.memoizedState,Ce.state=Pt,Je(z,re,Ce,de),Pe();var yi=z.memoizedState;Xe!==ti||Pt!==yi||as||J!==null&&J.dependencies!==null&&Xl(J.dependencies)?(typeof He=="function"&&(Va(z,se,He,re),yi=z.memoizedState),(Ot=as||Ea(z,se,Ot,re,Pt,yi,qe)||J!==null&&J.dependencies!==null&&Xl(J.dependencies))?(vt||typeof Ce.UNSAFE_componentWillUpdate!="function"&&typeof Ce.componentWillUpdate!="function"||(typeof Ce.componentWillUpdate=="function"&&Ce.componentWillUpdate(re,yi,qe),typeof Ce.UNSAFE_componentWillUpdate=="function"&&Ce.UNSAFE_componentWillUpdate(re,yi,qe)),typeof Ce.componentDidUpdate=="function"&&(z.flags|=4),typeof Ce.getSnapshotBeforeUpdate=="function"&&(z.flags|=1024)):(typeof Ce.componentDidUpdate!="function"||Xe===J.memoizedProps&&Pt===J.memoizedState||(z.flags|=4),typeof Ce.getSnapshotBeforeUpdate!="function"||Xe===J.memoizedProps&&Pt===J.memoizedState||(z.flags|=1024),z.memoizedProps=re,z.memoizedState=yi),Ce.props=re,Ce.state=yi,Ce.context=qe,re=Ot):(typeof Ce.componentDidUpdate!="function"||Xe===J.memoizedProps&&Pt===J.memoizedState||(z.flags|=4),typeof Ce.getSnapshotBeforeUpdate!="function"||Xe===J.memoizedProps&&Pt===J.memoizedState||(z.flags|=1024),re=!1)}return Ce=re,vl(J,z),re=(z.flags&128)!==0,Ce||re?(Ce=z.stateNode,se=re&&typeof se.getDerivedStateFromError!="function"?null:Ce.render(),z.flags|=1,J!==null&&re?(z.child=Lr(z,J.child,null,de),z.child=Lr(z,null,se,de)):Un(J,z,se,de),z.memoizedState=Ce.state,J=z.child):J=Jo(J,z,de),J}function Bu(J,z,se,re){return rt(),z.flags|=256,Un(J,z,se,re),z.child}function lg(J){return{baseLanes:J,cachePool:Ig()}}function Bl(J,z,se){return J=J!==null?J.childLanes&~se:0,z&&(J|=zs),J}function Su(J,z,se){var re=z.pendingProps,de=!1,Ce=(z.flags&128)!==0,Xe;if((Xe=Ce)||(Xe=J!==null&&J.memoizedState===null?!1:(ln.current&2)!==0),Xe&&(de=!0,z.flags&=-129),Xe=(z.flags&32)!==0,z.flags&=-33,J===null){if(Hi){if(de?Ln(z):vs(),Hi){var He=ji,qe;(qe=He)&&(He=Ch(He,ho),He!==null?(z.memoizedState={dehydrated:He,treeContext:uo!==null?{id:_o,overflow:wo}:null,retryLane:536870912},qe=d(18,null,null,0),qe.stateNode=He,qe.return=z,z.child=qe,Sn=z,ji=null,qe=!0):qe=!1),qe||Ke(z)}if(He=z.memoizedState,He!==null&&(He=He.dehydrated,He!==null))return Ol(He)?z.lanes=16:z.lanes=536870912,null;sn(z)}return He=re.children,re=re.fallback,de?(vs(),de=z.mode,He=gg({mode:"hidden",children:He},de),re=_r(re,de,se,null),He.return=z,re.return=z,He.sibling=re,z.child=He,de=z.child,de.memoizedState=lg(se),de.childLanes=Bl(J,Xe,se),z.memoizedState=tc,re):(Ln(z),cg(z,He))}if(qe=J.memoizedState,qe!==null&&(He=qe.dehydrated,He!==null)){if(Ce)z.flags&256?(Ln(z),z.flags&=-257,z=Ic(J,z,se)):z.memoizedState!==null?(vs(),z.child=J.child,z.flags|=128,z=null):(vs(),de=re.fallback,He=z.mode,re=gg({mode:"visible",children:re.children},He),de=_r(de,He,se,null),de.flags|=2,re.return=z,de.return=z,re.sibling=de,z.child=re,Lr(z,J.child,null,se),re=z.child,re.memoizedState=lg(se),re.childLanes=Bl(J,Xe,se),z.memoizedState=tc,z=de);else if(Ln(z),Ol(He))Xe=Yc(He).digest,re=Error(I(419)),re.stack="",re.digest=Xe,nt({value:re,source:null,stack:null}),z=Ic(J,z,se);else if(Vn||xl(J,z,se,!1),Xe=(se&J.childLanes)!==0,Vn||Xe){if(Xe=qi,Xe!==null){if(re=se&-se,(re&42)!==0)re=1;else switch(re){case 2:re=1;break;case 8:re=4;break;case 32:re=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:re=64;break;case 268435456:re=134217728;break;default:re=0}if(re=(re&(Xe.suspendedLanes|se))!==0?0:re,re!==0&&re!==qe.retryLane)throw qe.retryLane=re,Ht(J,re),an(Xe,J,re),eu}fa(He)||ks(),z=Ic(J,z,se)}else fa(He)?(z.flags|=128,z.child=J.child,z=Ll.bind(null,J),uh(He,z),z=null):(J=qe.treeContext,ws&&(ji=Jg(He),Sn=z,Hi=!0,Os=null,ho=!1,J!==null&&(Zs[rs++]=_o,Zs[rs++]=wo,Zs[rs++]=uo,_o=J.id,wo=J.overflow,uo=z)),z=cg(z,re.children),z.flags|=4096);return z}return de?(vs(),de=re.fallback,He=z.mode,qe=J.child,Ce=qe.sibling,re=Uo(qe,{mode:"hidden",children:re.children}),re.subtreeFlags=qe.subtreeFlags&31457280,Ce!==null?de=Uo(Ce,de):(de=_r(de,He,se,null),de.flags|=2),de.return=z,re.return=z,re.sibling=de,z.child=re,re=de,de=z.child,He=J.child.memoizedState,He===null?He=lg(se):(qe=He.cachePool,qe!==null?(Ce=lo?bn._currentValue:bn._currentValue2,qe=qe.parent!==Ce?{parent:Ce,pool:Ce}:qe):qe=Ig(),He={baseLanes:He.baseLanes|se,cachePool:qe}),de.memoizedState=He,de.childLanes=Bl(J,Xe,se),z.memoizedState=tc,re):(Ln(z),se=J.child,J=se.sibling,se=Uo(se,{mode:"visible",children:re.children}),se.return=z,se.sibling=null,J!==null&&(Xe=z.deletions,Xe===null?(z.deletions=[J],z.flags|=16):Xe.push(J)),z.child=se,z.memoizedState=null,se)}function cg(J,z){return z=gg({mode:"visible",children:z},J.mode),z.return=J,J.child=z}function gg(J,z){return Rc(J,z,0,null)}function Ic(J,z,se){return Lr(z,J.child,null,se),J=cg(z,z.pendingProps.children),J.flags|=2,z.memoizedState=null,J}function xu(J,z,se){J.lanes|=z;var re=J.alternate;re!==null&&(re.lanes|=z),Sl(J.return,z,se)}function ug(J,z,se,re,de){var Ce=J.memoizedState;Ce===null?J.memoizedState={isBackwards:z,rendering:null,renderingStartTime:0,last:re,tail:se,tailMode:de}:(Ce.isBackwards=z,Ce.rendering=null,Ce.renderingStartTime=0,Ce.last=re,Ce.tail=se,Ce.tailMode=de)}function Xu(J,z,se){var re=z.pendingProps,de=re.revealOrder,Ce=re.tail;if(Un(J,z,re.children,se),re=ln.current,(re&2)!==0)re=re&1|2,z.flags|=128;else{if(J!==null&&(J.flags&128)!==0)e:for(J=z.child;J!==null;){if(J.tag===13)J.memoizedState!==null&&xu(J,se,z);else if(J.tag===19)xu(J,se,z);else if(J.child!==null){J.child.return=J,J=J.child;continue}if(J===z)break e;for(;J.sibling===null;){if(J.return===null||J.return===z)break e;J=J.return}J.sibling.return=J.return,J=J.sibling}re&=1}switch(ee(ln,re),de){case"forwards":for(se=z.child,de=null;se!==null;)J=se.alternate,J!==null&&on(J)===null&&(de=se),se=se.sibling;se=de,se===null?(de=z.child,z.child=null):(de=se.sibling,se.sibling=null),ug(z,!1,de,se,Ce);break;case"backwards":for(se=null,de=z.child,z.child=null;de!==null;){if(J=de.alternate,J!==null&&on(J)===null){z.child=de;break}J=de.sibling,de.sibling=se,se=de,de=J}ug(z,!0,se,null,Ce);break;case"together":ug(z,!1,null,null,void 0);break;default:z.memoizedState=null}return z.child}function Jo(J,z,se){if(J!==null&&(z.dependencies=J.dependencies),eo|=z.lanes,(se&z.childLanes)===0)if(J!==null){if(xl(J,z,se,!1),(se&z.childLanes)===0)return null}else return null;if(J!==null&&z.child!==J.child)throw Error(I(153));if(z.child!==null){for(J=z.child,se=Uo(J,J.pendingProps),z.child=se,se.return=z;J.sibling!==null;)J=J.sibling,se=se.sibling=Uo(J,J.pendingProps),se.return=z;se.sibling=null}return z.child}function hg(J,z){return(J.lanes&z)!==0?!0:(J=J.dependencies,!!(J!==null&&Xl(J)))}function Kh(J,z,se){switch(z.tag){case 3:Re(z,z.stateNode.containerInfo),mr(z,bn,J.memoizedState.cache),rt();break;case 27:case 5:De(z);break;case 4:Re(z,z.stateNode.containerInfo);break;case 10:mr(z,z.type,z.memoizedProps.value);break;case 13:var re=z.memoizedState;if(re!==null)return re.dehydrated!==null?(Ln(z),z.flags|=128,null):(se&z.child.childLanes)!==0?Su(J,z,se):(Ln(z),J=Jo(J,z,se),J!==null?J.sibling:null);Ln(z);break;case 19:var de=(J.flags&128)!==0;if(re=(se&z.childLanes)!==0,re||(xl(J,z,se,!1),re=(se&z.childLanes)!==0),de){if(re)return Xu(J,z,se);z.flags|=128}if(de=z.memoizedState,de!==null&&(de.rendering=null,de.tail=null,de.lastEffect=null),ee(ln,ln.current),re)break;return null;case 22:case 23:return z.lanes=0,bu(J,z,se);case 24:mr(z,bn,J.memoizedState.cache)}return Jo(J,z,se)}function Ru(J,z,se){if(J!==null)if(J.memoizedProps!==z.pendingProps)Vn=!0;else{if(!hg(J,se)&&(z.flags&128)===0)return Vn=!1,Kh(J,z,se);Vn=(J.flags&131072)!==0}else Vn=!1,Hi&&(z.flags&1048576)!==0&&Be(z,nl,z.index);switch(z.lanes=0,z.tag){case 16:e:{J=z.pendingProps;var re=z.elementType,de=re._init;if(re=de(re._payload),z.type=re,typeof re=="function")Oo(re)?(J=To(re,J),z.tag=1,z=vu(null,z,re,J,se)):(z.tag=0,z=Cc(null,z,re,J,se));else{if(re!=null){if(de=re.$$typeof,de===_c){z.tag=11,z=dc(null,z,re,J,se);break e}else if(de===Oa){z.tag=14,z=mu(null,z,re,J,se);break e}}throw z=y(re)||re,Error(I(306,z,""))}}return z;case 0:return Cc(J,z,z.type,z.pendingProps,se);case 1:return re=z.type,de=To(re,z.pendingProps),vu(J,z,re,de,se);case 3:e:{if(Re(z,z.stateNode.containerInfo),J===null)throw Error(I(387));var Ce=z.pendingProps;de=z.memoizedState,re=de.element,Gt(J,z),Je(z,Ce,null,se);var Xe=z.memoizedState;if(Ce=Xe.cache,mr(z,bn,Ce),Ce!==de.cache&&ta(z,[bn],se,!0),Pe(),Ce=Xe.element,ws&&de.isDehydrated)if(de={element:Ce,isDehydrated:!1,cache:Xe.cache},z.updateQueue.baseState=de,z.memoizedState=de,z.flags&256){z=Bu(J,z,Ce,se);break e}else if(Ce!==re){re=Ye(Error(I(424)),z),nt(re),z=Bu(J,z,Ce,se);break e}else for(ws&&(ji=pa(z.stateNode.containerInfo),Sn=z,Hi=!0,Os=null,ho=!0),se=Zo(z,null,Ce,se),z.child=se;se;)se.flags=se.flags&-3|4096,se=se.sibling;else{if(rt(),Ce===re){z=Jo(J,z,se);break e}Un(J,z,Ce,se)}z=z.child}return z;case 26:if(Ys)return vl(J,z),J===null?(se=Lg(z.type,null,z.pendingProps,null))?z.memoizedState=se:Hi||(z.stateNode=Dg(z.type,z.pendingProps,sr.current,z)):z.memoizedState=Lg(z.type,J.memoizedProps,z.pendingProps,J.memoizedState),null;case 27:if(kn)return De(z),J===null&&kn&&Hi&&(re=z.stateNode=Hc(z.type,z.pendingProps,sr.current,Bn.current,!1),Sn=z,ho=!0,ji=ir(re)),re=z.pendingProps.children,J!==null||Hi?Un(J,z,re,se):z.child=Lr(z,null,re,se),vl(J,z),z.child;case 5:return J===null&&Hi&&(Ah(z.type,z.pendingProps,Bn.current),(de=re=ji)&&(re=Hg(re,z.type,z.pendingProps,ho),re!==null?(z.stateNode=re,Sn=z,ji=ir(re),ho=!1,de=!0):de=!1),de||Ke(z)),De(z),de=z.type,Ce=z.pendingProps,Xe=J!==null?J.memoizedProps:null,re=Ce.children,Qn(de,Ce)?re=null:Xe!==null&&Qn(de,Xe)&&(z.flags|=32),z.memoizedState!==null&&(de=Ir(J,z,ac,null,null,se),lo?tr._currentValue=de:tr._currentValue2=de),vl(J,z),Un(J,z,re,se),z.child;case 6:return J===null&&Hi&&(qh(z.pendingProps,Bn.current),(J=se=ji)&&(se=dh(se,z.pendingProps,ho),se!==null?(z.stateNode=se,Sn=z,ji=null,J=!0):J=!1),J||Ke(z)),null;case 13:return Su(J,z,se);case 4:return Re(z,z.stateNode.containerInfo),re=z.pendingProps,J===null?z.child=Lr(z,null,re,se):Un(J,z,re,se),z.child;case 11:return dc(J,z,z.type,z.pendingProps,se);case 7:return Un(J,z,z.pendingProps,se),z.child;case 8:return Un(J,z,z.pendingProps.children,se),z.child;case 12:return Un(J,z,z.pendingProps.children,se),z.child;case 10:return re=z.pendingProps,mr(z,z.type,re.value),Un(J,z,re.children,se),z.child;case 9:return de=z.type._context,re=z.pendingProps.children,Ar(z),de=$n(de),re=re(de),z.flags|=1,Un(J,z,re,se),z.child;case 14:return mu(J,z,z.type,z.pendingProps,se);case 15:return Au(J,z,z.type,z.pendingProps,se);case 19:return Xu(J,z,se);case 22:return bu(J,z,se);case 24:return Ar(z),re=$n(bn),J===null?(de=Cg(),de===null&&(de=qi,Ce=br(),de.pooledCache=Ce,Ce.refCount++,Ce!==null&&(de.pooledCacheLanes|=se),de=Ce),z.memoizedState={parent:re,cache:de},it(z),mr(z,bn,de)):((J.lanes&se)!==0&&(Gt(J,z),Je(z,null,null,se),Pe()),de=J.memoizedState,Ce=z.memoizedState,de.parent!==re?(de={parent:re,cache:re},z.memoizedState=de,z.lanes===0&&(z.memoizedState=z.updateQueue.baseState=de),mr(z,bn,re)):(re=Ce.cache,mr(z,bn,re),re!==de.cache&&ta(z,[bn],se,!0))),Un(J,z,z.pendingProps.children,se),z.child;case 29:throw z.pendingProps}throw Error(I(156,z.tag))}function mr(J,z,se){lo?(ee($s,z._currentValue),z._currentValue=se):(ee($s,z._currentValue2),z._currentValue2=se)}function Ho(J){var z=$s.current;lo?J._currentValue=z:J._currentValue2=z,U($s)}function Sl(J,z,se){for(;J!==null;){var re=J.alternate;if((J.childLanes&z)!==z?(J.childLanes|=z,re!==null&&(re.childLanes|=z)):re!==null&&(re.childLanes&z)!==z&&(re.childLanes|=z),J===se)break;J=J.return}}function ta(J,z,se,re){var de=J.child;for(de!==null&&(de.return=J);de!==null;){var Ce=de.dependencies;if(Ce!==null){var Xe=de.child;Ce=Ce.firstContext;e:for(;Ce!==null;){var He=Ce;Ce=de;for(var qe=0;qe<z.length;qe++)if(He.context===z[qe]){Ce.lanes|=se,He=Ce.alternate,He!==null&&(He.lanes|=se),Sl(Ce.return,se,J),re||(Xe=null);break e}Ce=He.next}}else if(de.tag===18){if(Xe=de.return,Xe===null)throw Error(I(341));Xe.lanes|=se,Ce=Xe.alternate,Ce!==null&&(Ce.lanes|=se),Sl(Xe,se,J),Xe=null}else Xe=de.child;if(Xe!==null)Xe.return=de;else for(Xe=de;Xe!==null;){if(Xe===J){Xe=null;break}if(de=Xe.sibling,de!==null){de.return=Xe.return,Xe=de;break}Xe=Xe.return}de=Xe}}function xl(J,z,se,re){J=null;for(var de=z,Ce=!1;de!==null;){if(!Ce){if((de.flags&524288)!==0)Ce=!0;else if((de.flags&262144)!==0)break}if(de.tag===10){var Xe=de.alternate;if(Xe===null)throw Error(I(387));if(Xe=Xe.memoizedProps,Xe!==null){var He=de.type;ps(de.pendingProps.value,Xe.value)||(J!==null?J.push(He):J=[He])}}else if(de===jl.current){if(Xe=de.alternate,Xe===null)throw Error(I(387));Xe.memoizedState.memoizedState!==de.memoizedState.memoizedState&&(J!==null?J.push(tr):J=[tr])}de=de.return}J!==null&&ta(z,J,se,re),z.flags|=262144}function Xl(J){for(J=J.firstContext;J!==null;){var z=J.context;if(!ps(lo?z._currentValue:z._currentValue2,J.memoizedValue))return!0;J=J.next}return!1}function Ar(J){Or=J,js=null,J=J.dependencies,J!==null&&(J.firstContext=null)}function $n(J){return dg(Or,J)}function Rl(J,z){return Or===null&&Ar(J),dg(J,z)}function dg(J,z){var se=lo?z._currentValue:z._currentValue2;if(z={context:z,memoizedValue:se,next:null},js===null){if(J===null)throw Error(I(308));js=z,J.dependencies={lanes:0,firstContext:z},J.flags|=524288}else js=js.next=z;return se}function br(){return{controller:new ic,data:new Map,refCount:0}}function _l(J){J.refCount--,J.refCount===0&&pn(td,function(){J.controller.abort()})}function Cg(){var J=Ba.current;return J!==null?J:qi.pooledCache}function fc(J,z){z===null?ee(Ba,Ba.current):ee(Ba,z.pool)}function Ig(){var J=Cg();return J===null?null:{parent:lo?bn._currentValue:bn._currentValue2,pool:J}}function Bs(J){J.flags|=4}function Ja(J,z){if(J!==null&&J.child===z.child)return!1;if((z.flags&16)!==0)return!0;for(J=z.child;J!==null;){if((J.flags&13878)!==0||(J.subtreeFlags&13878)!==0)return!0;J=J.sibling}return!1}function ia(J,z,se,re){if(Cn)for(se=z.child;se!==null;){if(se.tag===5||se.tag===6)kl(J,se.stateNode);else if(!(se.tag===4||kn&&se.tag===27)&&se.child!==null){se.child.return=se,se=se.child;continue}if(se===z)break;for(;se.sibling===null;){if(se.return===null||se.return===z)return;se=se.return}se.sibling.return=se.return,se=se.sibling}else if(co)for(var de=z.child;de!==null;){if(de.tag===5){var Ce=de.stateNode;se&&re&&(Ce=gh(Ce,de.type,de.memoizedProps)),kl(J,Ce)}else if(de.tag===6)Ce=de.stateNode,se&&re&&(Ce=Tg(Ce,de.memoizedProps)),kl(J,Ce);else if(de.tag!==4){if(de.tag===22&&de.memoizedState!==null)Ce=de.child,Ce!==null&&(Ce.return=de),ia(J,de,!0,!0);else if(de.child!==null){de.child.return=de,de=de.child;continue}}if(de===z)break;for(;de.sibling===null;){if(de.return===null||de.return===z)return;de=de.return}de.sibling.return=de.return,de=de.sibling}}function _u(J,z,se,re){if(co)for(var de=z.child;de!==null;){if(de.tag===5){var Ce=de.stateNode;se&&re&&(Ce=gh(Ce,de.type,de.memoizedProps)),Yg(J,Ce)}else if(de.tag===6)Ce=de.stateNode,se&&re&&(Ce=Tg(Ce,de.memoizedProps)),Yg(J,Ce);else if(de.tag!==4){if(de.tag===22&&de.memoizedState!==null)Ce=de.child,Ce!==null&&(Ce.return=de),_u(J,de,!(de.memoizedProps!==null&&de.memoizedProps.mode==="manual"),!0);else if(de.child!==null){de.child.return=de,de=de.child;continue}}if(de===z)break;for(;de.sibling===null;){if(de.return===null||de.return===z)return;de=de.return}de.sibling.return=de.return,de=de.sibling}}function wl(J,z){if(co&&Ja(J,z)){J=z.stateNode;var se=J.containerInfo,re=Wc();_u(re,z,!1,!1),J.pendingChildren=re,Bs(z),lh(se,re)}}function pc(J,z,se,re){if(Cn)J.memoizedProps!==re&&Bs(z);else if(co){var de=J.stateNode,Ce=J.memoizedProps;if((J=Ja(J,z))||Ce!==re){var Xe=Bn.current;Ce=ah(de,se,Ce,re,!J,null),Ce===de?z.stateNode=de:(wc(Ce,se,re,Xe)&&Bs(z),z.stateNode=Ce,J?ia(Ce,z,!1,!1):Bs(z))}else z.stateNode=de}}function mc(J,z,se){if(Zg(z,se)){if(J.flags|=16777216,!Mg(z,se))if(Pn())J.flags|=8192;else throw ls=ms,ec}else J.flags&=-16777217}function Ac(J,z){if(Gh(z)){if(J.flags|=16777216,!Og(z))if(Pn())J.flags|=8192;else throw ls=ms,ec}else J.flags&=-16777217}function Ha(J,z){z!==null&&(J.flags|=4),J.flags&16384&&(z=J.tag!==22?ge():536870912,J.lanes|=z,Wn|=z)}function za(J,z){if(!Hi)switch(J.tailMode){case"hidden":z=J.tail;for(var se=null;z!==null;)z.alternate!==null&&(se=z),z=z.sibling;se===null?J.tail=null:se.sibling=null;break;case"collapsed":se=J.tail;for(var re=null;se!==null;)se.alternate!==null&&(re=se),se=se.sibling;re===null?z||J.tail===null?J.tail=null:J.tail.sibling=null:re.sibling=null}}function dn(J){var z=J.alternate!==null&&J.alternate.child===J.child,se=0,re=0;if(z)for(var de=J.child;de!==null;)se|=de.lanes|de.childLanes,re|=de.subtreeFlags&31457280,re|=de.flags&31457280,de.return=J,de=de.sibling;else for(de=J.child;de!==null;)se|=de.lanes|de.childLanes,re|=de.subtreeFlags,re|=de.flags,de.return=J,de=de.sibling;return J.subtreeFlags|=re,J.childLanes=se,z}function wu(J,z,se){var re=z.pendingProps;switch(Ae(z),z.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(z),null;case 1:return dn(z),null;case 3:return se=z.stateNode,re=null,J!==null&&(re=J.memoizedState.cache),z.memoizedState.cache!==re&&(z.flags|=2048),Ho(bn),We(),se.pendingContext&&(se.context=se.pendingContext,se.pendingContext=null),(J===null||J.child===null)&&(Ut(z)?Bs(z):J===null||J.memoizedState.isDehydrated&&(z.flags&256)===0||(z.flags|=1024,Os!==null&&(ko(Os),Os=null))),wl(J,z),dn(z),null;case 26:if(Ys){se=z.type;var de=z.memoizedState;return J===null?(Bs(z),de!==null?(dn(z),Ac(z,de)):(dn(z),mc(z,se,re))):de?de!==J.memoizedState?(Bs(z),dn(z),Ac(z,de)):(dn(z),z.flags&=-16777217):(Cn?J.memoizedProps!==re&&Bs(z):pc(J,z,se,re),dn(z),mc(z,se,re)),null}case 27:if(kn){if(Fe(z),se=sr.current,de=z.type,J!==null&&z.stateNode!=null)Cn?J.memoizedProps!==re&&Bs(z):pc(J,z,de,re);else{if(!re){if(z.stateNode===null)throw Error(I(166));return dn(z),null}J=Bn.current,Ut(z)?Rt(z,J):(J=Hc(de,re,se,J,!0),z.stateNode=J,Bs(z))}return dn(z),null}case 5:if(Fe(z),se=z.type,J!==null&&z.stateNode!=null)pc(J,z,se,re);else{if(!re){if(z.stateNode===null)throw Error(I(166));return dn(z),null}J=Bn.current,Ut(z)?Rt(z,J):(de=wg(se,re,sr.current,J,z),ia(de,z,!1,!1),z.stateNode=de,wc(de,se,re,J)&&Bs(z))}return dn(z),mc(z,z.type,z.pendingProps),null;case 6:if(J&&z.stateNode!=null)se=J.memoizedProps,Cn?se!==re&&Bs(z):co&&(se!==re?(z.stateNode=Gn(re,sr.current,Bn.current,z),Bs(z)):z.stateNode=J.stateNode);else{if(typeof re!="string"&&z.stateNode===null)throw Error(I(166));if(J=sr.current,se=Bn.current,Ut(z)){if(!ws)throw Error(I(176));if(J=z.stateNode,se=z.memoizedProps,re=null,de=Sn,de!==null)switch(de.tag){case 27:case 5:re=de.memoizedProps}Tc(J,se,z,re)||Ke(z)}else z.stateNode=Gn(re,J,se,z)}return dn(z),null;case 13:if(re=z.memoizedState,J===null||J.memoizedState!==null&&J.memoizedState.dehydrated!==null){if(de=Ut(z),re!==null&&re.dehydrated!==null){if(J===null){if(!de)throw Error(I(318));if(!ws)throw Error(I(344));if(de=z.memoizedState,de=de!==null?de.dehydrated:null,!de)throw Error(I(317));Ih(de,z)}else rt(),(z.flags&128)===0&&(z.memoizedState=null),z.flags|=4;dn(z),de=!1}else Os!==null&&(ko(Os),Os=null),de=!0;if(!de)return z.flags&256?(sn(z),z):(sn(z),null)}if(sn(z),(z.flags&128)!==0)return z.lanes=se,z;if(se=re!==null,J=J!==null&&J.memoizedState!==null,se){re=z.child,de=null,re.alternate!==null&&re.alternate.memoizedState!==null&&re.alternate.memoizedState.cachePool!==null&&(de=re.alternate.memoizedState.cachePool.pool);var Ce=null;re.memoizedState!==null&&re.memoizedState.cachePool!==null&&(Ce=re.memoizedState.cachePool.pool),Ce!==de&&(re.flags|=2048)}return se!==J&&se&&(z.child.flags|=8192),Ha(z,z.updateQueue),dn(z),null;case 4:return We(),wl(J,z),J===null&&Hu(z.stateNode.containerInfo),dn(z),null;case 10:return Ho(z.type),dn(z),null;case 19:if(U(ln),de=z.memoizedState,de===null)return dn(z),null;if(re=(z.flags&128)!==0,Ce=de.rendering,Ce===null)if(re)za(de,!1);else{if(fn!==0||J!==null&&(J.flags&128)!==0)for(J=z.child;J!==null;){if(Ce=on(J),Ce!==null){for(z.flags|=128,za(de,!1),J=Ce.updateQueue,z.updateQueue=J,Ha(z,J),z.subtreeFlags=0,J=se,se=z.child;se!==null;)la(se,J),se=se.sibling;return ee(ln,ln.current&1|2),z.child}J=J.sibling}de.tail!==null&&Ts()>Fs&&(z.flags|=128,re=!0,za(de,!1),z.lanes=4194304)}else{if(!re)if(J=on(Ce),J!==null){if(z.flags|=128,re=!0,J=J.updateQueue,z.updateQueue=J,Ha(z,J),za(de,!0),de.tail===null&&de.tailMode==="hidden"&&!Ce.alternate&&!Hi)return dn(z),null}else 2*Ts()-de.renderingStartTime>Fs&&se!==536870912&&(z.flags|=128,re=!0,za(de,!1),z.lanes=4194304);de.isBackwards?(Ce.sibling=z.child,z.child=Ce):(J=de.last,J!==null?J.sibling=Ce:z.child=Ce,de.last=Ce)}return de.tail!==null?(z=de.tail,de.rendering=z,de.tail=z.sibling,de.renderingStartTime=Ts(),z.sibling=null,J=ln.current,ee(ln,re?J&1|2:J&1),z):(dn(z),null);case 22:case 23:return sn(z),Tn(),re=z.memoizedState!==null,J!==null?J.memoizedState!==null!==re&&(z.flags|=8192):re&&(z.flags|=8192),re?(se&536870912)!==0&&(z.flags&128)===0&&(dn(z),z.subtreeFlags&6&&(z.flags|=8192)):dn(z),se=z.updateQueue,se!==null&&Ha(z,se.retryQueue),se=null,J!==null&&J.memoizedState!==null&&J.memoizedState.cachePool!==null&&(se=J.memoizedState.cachePool.pool),re=null,z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(re=z.memoizedState.cachePool.pool),re!==se&&(z.flags|=2048),J!==null&&U(Ba),null;case 24:return se=null,J!==null&&(se=J.memoizedState.cache),z.memoizedState.cache!==se&&(z.flags|=2048),Ho(bn),dn(z),null;case 25:return null}throw Error(I(156,z.tag))}function Ph(J,z){switch(Ae(z),z.tag){case 1:return J=z.flags,J&65536?(z.flags=J&-65537|128,z):null;case 3:return Ho(bn),We(),J=z.flags,(J&65536)!==0&&(J&128)===0?(z.flags=J&-65537|128,z):null;case 26:case 27:case 5:return Fe(z),null;case 13:if(sn(z),J=z.memoizedState,J!==null&&J.dehydrated!==null){if(z.alternate===null)throw Error(I(340));rt()}return J=z.flags,J&65536?(z.flags=J&-65537|128,z):null;case 19:return U(ln),null;case 4:return We(),null;case 10:return Ho(z.type),null;case 22:case 23:return sn(z),Tn(),J!==null&&U(Ba),J=z.flags,J&65536?(z.flags=J&-65537|128,z):null;case 24:return Ho(bn),null;case 25:return null;default:return null}}function Zu(J,z){switch(Ae(z),z.tag){case 3:Ho(bn),We();break;case 26:case 27:case 5:Fe(z);break;case 4:We();break;case 13:sn(z);break;case 19:U(ln);break;case 10:Ho(z.type);break;case 22:case 23:sn(z),Tn(),J!==null&&U(Ba);break;case 24:Ho(bn)}}function Zl(J,z){try{var se=z.updateQueue,re=se!==null?se.lastEffect:null;if(re!==null){var de=re.next;se=de;do{if((se.tag&J)===J){re=void 0;var Ce=se.create,Xe=se.inst;re=Ce(),Xe.destroy=re}se=se.next}while(se!==de)}}catch(He){Pi(z,z.return,He)}}function yr(J,z,se){try{var re=z.updateQueue,de=re!==null?re.lastEffect:null;if(de!==null){var Ce=de.next;re=Ce;do{if((re.tag&J)===J){var Xe=re.inst,He=Xe.destroy;if(He!==void 0){Xe.destroy=void 0,de=z;var qe=se;try{He()}catch(vt){Pi(de,qe,vt)}}}re=re.next}while(re!==Ce)}}catch(vt){Pi(z,z.return,vt)}}function Mu(J){var z=J.updateQueue;if(z!==null){var se=J.stateNode;try{Kt(z,se)}catch(re){Pi(J,J.return,re)}}}function Ss(J,z,se){se.props=To(J.type,J.memoizedProps),se.state=J.memoizedState;try{se.componentWillUnmount()}catch(re){Pi(J,z,re)}}function ao(J,z){try{var se=J.ref;if(se!==null){var re=J.stateNode;switch(J.tag){case 26:case 27:case 5:var de=da(re);break;default:de=re}typeof se=="function"?J.refCleanup=se(de):se.current=de}}catch(Ce){Pi(J,z,Ce)}}function xs(J,z){var se=J.ref,re=J.refCleanup;if(se!==null)if(typeof re=="function")try{re()}catch(de){Pi(J,z,de)}finally{J.refCleanup=null,J=J.alternate,J!=null&&(J.refCleanup=null)}else if(typeof se=="function")try{se(null)}catch(de){Pi(J,z,de)}else se.current=null}function fg(J){var z=J.type,se=J.memoizedProps,re=J.stateNode;try{qu(re,z,se,J)}catch(de){Pi(J,J.return,de)}}function pg(J,z,se){try{eh(J.stateNode,J.type,se,z,J)}catch(re){Pi(J,J.return,re)}}function mg(J){return J.tag===5||J.tag===3||(Ys?J.tag===26:!1)||(kn?J.tag===27:!1)||J.tag===4}function Ml(J){e:for(;;){for(;J.sibling===null;){if(J.return===null||mg(J.return))return null;J=J.return}for(J.sibling.return=J.return,J=J.sibling;J.tag!==5&&J.tag!==6&&(!kn||J.tag!==27)&&J.tag!==18;){if(J.flags&2||J.child===null||J.tag===4)continue e;J.child.return=J,J=J.child}if(!(J.flags&2))return J.stateNode}}function Ag(J,z,se){var re=J.tag;if(re===5||re===6)J=J.stateNode,z?Eg(se,J,z):Vg(se,J);else if(!(re===4||kn&&re===27)&&(J=J.child,J!==null))for(Ag(J,z,se),J=J.sibling;J!==null;)Ag(J,z,se),J=J.sibling}function bc(J,z,se){var re=J.tag;if(re===5||re===6)J=J.stateNode,z?th(se,J,z):ju(se,J);else if(!(re===4||kn&&re===27)&&(J=J.child,J!==null))for(bc(J,z,se),J=J.sibling;J!==null;)bc(J,z,se),J=J.sibling}function na(J,z,se){J=J.containerInfo;try{ch(J,se)}catch(re){Pi(z,z.return,re)}}function bg(J,z){for(Ju(J.containerInfo),ui=z;ui!==null;)if(J=ui,z=J.child,(J.subtreeFlags&1028)!==0&&z!==null)z.return=J,ui=z;else for(;ui!==null;){J=ui;var se=J.alternate;switch(z=J.flags,J.tag){case 0:break;case 11:case 15:break;case 1:if((z&1024)!==0&&se!==null){z=void 0;var re=J,de=se.memoizedProps;se=se.memoizedState;var Ce=re.stateNode;try{var Xe=To(re.type,de,re.elementType===re.type);z=Ce.getSnapshotBeforeUpdate(Xe,se),Ce.__reactInternalSnapshotBeforeUpdate=z}catch(He){Pi(re,re.return,He)}}break;case 3:(z&1024)!==0&&Cn&&rh(J.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((z&1024)!==0)throw Error(I(163))}if(z=J.sibling,z!==null){z.return=J.return,ui=z;break}ui=J.return}return Xe=tn,tn=!1,Xe}function Fa(J,z,se){var re=se.flags;switch(se.tag){case 0:case 11:case 15:Fo(J,se),re&4&&Zl(5,se);break;case 1:if(Fo(J,se),re&4)if(J=se.stateNode,z===null)try{J.componentDidMount()}catch(He){Pi(se,se.return,He)}else{var de=To(se.type,z.memoizedProps);z=z.memoizedState;try{J.componentDidUpdate(de,z,J.__reactInternalSnapshotBeforeUpdate)}catch(He){Pi(se,se.return,He)}}re&64&&Mu(se),re&512&&ao(se,se.return);break;case 3:if(Fo(J,se),re&64&&(re=se.updateQueue,re!==null)){if(J=null,se.child!==null)switch(se.child.tag){case 27:case 5:J=da(se.child.stateNode);break;case 1:J=se.child.stateNode}try{Kt(re,J)}catch(He){Pi(se,se.return,He)}}break;case 26:if(Ys){Fo(J,se),re&512&&ao(se,se.return);break}case 27:case 5:Fo(J,se),z===null&&re&4&&fg(se),re&512&&ao(se,se.return);break;case 12:Fo(J,se);break;case 13:Fo(J,se),re&4&&sa(J,se);break;case 22:if(de=se.memoizedState!==null||gr,!de){z=z!==null&&z.memoizedState!==null||bi;var Ce=gr,Xe=bi;gr=de,(bi=z)&&!Xe?Gr(J,se,(se.subtreeFlags&8772)!==0):Fo(J,se),gr=Ce,bi=Xe}re&512&&(se.memoizedProps.mode==="manual"?ao(se,se.return):xs(se,se.return));break;default:Fo(J,se)}}function yc(J){var z=J.alternate;z!==null&&(J.alternate=null,yc(z)),J.child=null,J.deletions=null,J.sibling=null,J.tag===5&&(z=J.stateNode,z!==null&&Lu(z)),J.stateNode=null,J.return=null,J.dependencies=null,J.memoizedProps=null,J.memoizedState=null,J.pendingProps=null,J.stateNode=null,J.updateQueue=null}function Ls(J,z,se){for(se=se.child;se!==null;)zo(J,z,se),se=se.sibling}function zo(J,z,se){if(Nn&&typeof Nn.onCommitFiberUnmount=="function")try{Nn.onCommitFiberUnmount(il,se)}catch{}switch(se.tag){case 26:if(Ys){bi||xs(se,z),Ls(J,z,se),se.memoizedState?Pg(se.memoizedState):se.stateNode&&qa(se.stateNode);break}case 27:if(kn){bi||xs(se,z);var re=Li,de=Rn;Li=se.stateNode,Ls(J,z,se),jg(se.stateNode),Li=re,Rn=de;break}case 5:bi||xs(se,z);case 6:if(Cn){if(re=Li,de=Rn,Li=null,Ls(J,z,se),Li=re,Rn=de,Li!==null)if(Rn)try{nh(Li,se.stateNode)}catch(Ce){Pi(se,z,Ce)}else try{ih(Li,se.stateNode)}catch(Ce){Pi(se,z,Ce)}}else Ls(J,z,se);break;case 18:Cn&&Li!==null&&(Rn?zg(Li,se.stateNode):mh(Li,se.stateNode));break;case 4:Cn?(re=Li,de=Rn,Li=se.stateNode.containerInfo,Rn=!0,Ls(J,z,se),Li=re,Rn=de):(co&&na(se.stateNode,se,Wc()),Ls(J,z,se));break;case 0:case 11:case 14:case 15:bi||yr(2,se,z),bi||yr(4,se,z),Ls(J,z,se);break;case 1:bi||(xs(se,z),re=se.stateNode,typeof re.componentWillUnmount=="function"&&Ss(se,z,re)),Ls(J,z,se);break;case 21:Ls(J,z,se);break;case 22:bi||xs(se,z),bi=(re=bi)||se.memoizedState!==null,Ls(J,z,se),bi=re;break;default:Ls(J,z,se)}}function sa(J,z){if(ws&&z.memoizedState===null&&(J=z.alternate,J!==null&&(J=J.memoizedState,J!==null&&(J=J.dehydrated,J!==null))))try{Jc(J)}catch(se){Pi(z,z.return,se)}}function yg(J){switch(J.tag){case 13:case 19:var z=J.stateNode;return z===null&&(z=J.stateNode=new Xi),z;case 22:return J=J.stateNode,z=J._retryCache,z===null&&(z=J._retryCache=new Xi),z;default:throw Error(I(435,J.tag))}}function Gc(J,z){var se=yg(J);z.forEach(function(re){var de=Xc.bind(null,J,re);se.has(re)||(se.add(re),re.then(de,de))})}function wn(J,z){var se=z.deletions;if(se!==null)for(var re=0;re<se.length;re++){var de=se[re],Ce=J,Xe=z;if(Cn){var He=Xe;e:for(;He!==null;){switch(He.tag){case 27:case 5:Li=He.stateNode,Rn=!1;break e;case 3:Li=He.stateNode.containerInfo,Rn=!0;break e;case 4:Li=He.stateNode.containerInfo,Rn=!0;break e}He=He.return}if(Li===null)throw Error(I(160));zo(Ce,Xe,de),Li=null,Rn=!1}else zo(Ce,Xe,de);Ce=de.alternate,Ce!==null&&(Ce.return=null),de.return=null}if(z.subtreeFlags&13878)for(z=z.child;z!==null;)Gg(z,J),z=z.sibling}function Gg(J,z){var se=J.alternate,re=J.flags;switch(J.tag){case 0:case 11:case 14:case 15:wn(z,J),Xs(J),re&4&&(yr(3,J,J.return),Zl(3,J),yr(5,J,J.return));break;case 1:wn(z,J),Xs(J),re&512&&(bi||se===null||xs(se,se.return)),re&64&&gr&&(J=J.updateQueue,J!==null&&(re=J.callbacks,re!==null&&(se=J.shared.hiddenCallbacks,J.shared.hiddenCallbacks=se===null?re:se.concat(re))));break;case 26:if(Ys){var de=gs;wn(z,J),Xs(J),re&512&&(bi||se===null||xs(se,se.return)),re&4&&(re=se!==null?se.memoizedState:null,z=J.memoizedState,se===null?z===null?J.stateNode===null?J.stateNode=bh(de,J.type,J.memoizedProps,J):kg(de,J.type,J.stateNode):J.stateNode=Kg(de,z,J.memoizedProps):re!==z?(re===null?se.stateNode!==null&&qa(se.stateNode):Pg(re),z===null?kg(de,J.type,J.stateNode):Kg(de,z,J.memoizedProps)):z===null&&J.stateNode!==null&&pg(J,J.memoizedProps,se.memoizedProps));break}case 27:if(kn&&re&4&&J.alternate===null){de=J.stateNode;var Ce=J.memoizedProps;try{vh(de),$g(J.type,Ce,de,J)}catch(Ot){Pi(J,J.return,Ot)}}case 5:if(wn(z,J),Xs(J),re&512&&(bi||se===null||xs(se,se.return)),Cn){if(J.flags&32){z=J.stateNode;try{Ec(z)}catch(Ot){Pi(J,J.return,Ot)}}re&4&&J.stateNode!=null&&(z=J.memoizedProps,pg(J,z,se!==null?se.memoizedProps:z)),re&1024&&(Qi=!0)}break;case 6:if(wn(z,J),Xs(J),re&4&&Cn){if(J.stateNode===null)throw Error(I(162));re=J.memoizedProps,se=se!==null?se.memoizedProps:re,z=J.stateNode;try{Qu(z,se,re)}catch(Ot){Pi(J,J.return,Ot)}}break;case 3:if(Ys?(yh(),de=gs,gs=zn(z.containerInfo),wn(z,J),gs=de):wn(z,J),Xs(J),re&4){if(Cn&&ws&&se!==null&&se.memoizedState.isDehydrated)try{ph(z.containerInfo)}catch(Ot){Pi(J,J.return,Ot)}if(co){re=z.containerInfo,se=z.pendingChildren;try{ch(re,se)}catch(Ot){Pi(J,J.return,Ot)}}}Qi&&(Qi=!1,vg(J));break;case 4:Ys?(se=gs,gs=zn(J.stateNode.containerInfo),wn(z,J),Xs(J),gs=se):(wn(z,J),Xs(J)),re&4&&co&&na(J.stateNode,J,J.stateNode.pendingChildren);break;case 12:wn(z,J),Xs(J);break;case 13:wn(z,J),Xs(J),J.child.flags&8192&&J.memoizedState!==null!=(se!==null&&se.memoizedState!==null)&&(iu=Ts()),re&4&&(re=J.updateQueue,re!==null&&(J.updateQueue=null,Gc(J,re)));break;case 22:re&512&&(bi||se===null||xs(se,se.return)),de=J.memoizedState!==null;var Xe=se!==null&&se.memoizedState!==null,He=gr,qe=bi;if(gr=He||de,bi=qe||Xe,wn(z,J),bi=qe,gr=He,Xs(J),z=J.stateNode,z._current=J,z._visibility&=-3,z._visibility|=z._pendingVisibility&2,re&8192&&(z._visibility=de?z._visibility&-2:z._visibility|1,de&&(z=gr||bi,se===null||Xe||z||La(J)),Cn&&(J.memoizedProps===null||J.memoizedProps.mode!=="manual"))){e:if(se=null,Cn)for(z=J;;){if(z.tag===5||Ys&&z.tag===26||kn&&z.tag===27){if(se===null){Xe=se=z;try{Ce=Xe.stateNode,de?sh(Ce):Qh(Xe.stateNode,Xe.memoizedProps)}catch(Ot){Pi(Xe,Xe.return,Ot)}}}else if(z.tag===6){if(se===null){Xe=z;try{var vt=Xe.stateNode;de?oh(vt):Wg(vt,Xe.memoizedProps)}catch(Ot){Pi(Xe,Xe.return,Ot)}}}else if((z.tag!==22&&z.tag!==23||z.memoizedState===null||z===J)&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===J)break e;for(;z.sibling===null;){if(z.return===null||z.return===J)break e;se===z&&(se=null),z=z.return}se===z&&(se=null),z.sibling.return=z.return,z=z.sibling}}re&4&&(re=J.updateQueue,re!==null&&(se=re.retryQueue,se!==null&&(re.retryQueue=null,Gc(J,se))));break;case 19:wn(z,J),Xs(J),re&4&&(re=J.updateQueue,re!==null&&(J.updateQueue=null,Gc(J,re)));break;case 21:break;default:wn(z,J),Xs(J)}}function Xs(J){var z=J.flags;if(z&2){try{if(Cn&&(!kn||J.tag!==27)){e:{for(var se=J.return;se!==null;){if(mg(se)){var re=se;break e}se=se.return}throw Error(I(160))}switch(re.tag){case 27:if(kn){var de=re.stateNode,Ce=Ml(J);bc(J,Ce,de);break}case 5:var Xe=re.stateNode;re.flags&32&&(Ec(Xe),re.flags&=-33);var He=Ml(J);bc(J,He,Xe);break;case 3:case 4:var qe=re.stateNode.containerInfo,vt=Ml(J);Ag(J,vt,qe);break;default:throw Error(I(161))}}}catch(Ot){Pi(J,J.return,Ot)}J.flags&=-3}z&4096&&(J.flags&=-4097)}function vg(J){if(J.subtreeFlags&1024)for(J=J.child;J!==null;){var z=J;vg(z),z.tag===5&&z.flags&1024&&Pu(z.stateNode),J=J.sibling}}function Fo(J,z){if(z.subtreeFlags&8772)for(z=z.child;z!==null;)Fa(J,z.alternate,z),z=z.sibling}function La(J){for(J=J.child;J!==null;){var z=J;switch(z.tag){case 0:case 11:case 14:case 15:yr(4,z,z.return),La(z);break;case 1:xs(z,z.return);var se=z.stateNode;typeof se.componentWillUnmount=="function"&&Ss(z,z.return,se),La(z);break;case 26:case 27:case 5:xs(z,z.return),La(z);break;case 22:xs(z,z.return),z.memoizedState===null&&La(z);break;default:La(z)}J=J.sibling}}function Gr(J,z,se){for(se=se&&(z.subtreeFlags&8772)!==0,z=z.child;z!==null;){var re=z.alternate,de=J,Ce=z,Xe=Ce.flags;switch(Ce.tag){case 0:case 11:case 15:Gr(de,Ce,se),Zl(4,Ce);break;case 1:if(Gr(de,Ce,se),re=Ce,de=re.stateNode,typeof de.componentDidMount=="function")try{de.componentDidMount()}catch(vt){Pi(re,re.return,vt)}if(re=Ce,de=re.updateQueue,de!==null){var He=re.stateNode;try{var qe=de.shared.hiddenCallbacks;if(qe!==null)for(de.shared.hiddenCallbacks=null,de=0;de<qe.length;de++)ze(qe[de],He)}catch(vt){Pi(re,re.return,vt)}}se&&Xe&64&&Mu(Ce),ao(Ce,Ce.return);break;case 26:case 27:case 5:Gr(de,Ce,se),se&&re===null&&Xe&4&&fg(Ce),ao(Ce,Ce.return);break;case 12:Gr(de,Ce,se);break;case 13:Gr(de,Ce,se),se&&Xe&4&&sa(de,Ce);break;case 22:Ce.memoizedState===null&&Gr(de,Ce,se),ao(Ce,Ce.return);break;default:Gr(de,Ce,se)}z=z.sibling}}function vc(J,z){var se=null;J!==null&&J.memoizedState!==null&&J.memoizedState.cachePool!==null&&(se=J.memoizedState.cachePool.pool),J=null,z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(J=z.memoizedState.cachePool.pool),J!==se&&(J!=null&&J.refCount++,se!=null&&_l(se))}function Bc(J,z){J=null,z.alternate!==null&&(J=z.alternate.memoizedState.cache),z=z.memoizedState.cache,z!==J&&(z.refCount++,J!=null&&_l(J))}function Lo(J,z,se,re){if(z.subtreeFlags&10256)for(z=z.child;z!==null;)Ks(J,z,se,re),z=z.sibling}function Ks(J,z,se,re){var de=z.flags;switch(z.tag){case 0:case 11:case 15:Lo(J,z,se,re),de&2048&&Zl(9,z);break;case 3:Lo(J,z,se,re),de&2048&&(J=null,z.alternate!==null&&(J=z.alternate.memoizedState.cache),z=z.memoizedState.cache,z!==J&&(z.refCount++,J!=null&&_l(J)));break;case 12:if(de&2048){Lo(J,z,se,re),J=z.stateNode;try{var Ce=z.memoizedProps,Xe=Ce.id,He=Ce.onPostCommit;typeof He=="function"&&He(Xe,z.alternate===null?"mount":"update",J.passiveEffectDuration,-0)}catch(qe){Pi(z,z.return,qe)}}else Lo(J,z,se,re);break;case 23:break;case 22:Ce=z.stateNode,z.memoizedState!==null?Ce._visibility&4?Lo(J,z,se,re):bo(J,z):Ce._visibility&4?Lo(J,z,se,re):(Ce._visibility|=4,jn(J,z,se,re,(z.subtreeFlags&10256)!==0)),de&2048&&vc(z.alternate,z);break;case 24:Lo(J,z,se,re),de&2048&&Bc(z.alternate,z);break;default:Lo(J,z,se,re)}}function jn(J,z,se,re,de){for(de=de&&(z.subtreeFlags&10256)!==0,z=z.child;z!==null;){var Ce=J,Xe=z,He=se,qe=re,vt=Xe.flags;switch(Xe.tag){case 0:case 11:case 15:jn(Ce,Xe,He,qe,de),Zl(8,Xe);break;case 23:break;case 22:var Ot=Xe.stateNode;Xe.memoizedState!==null?Ot._visibility&4?jn(Ce,Xe,He,qe,de):bo(Ce,Xe):(Ot._visibility|=4,jn(Ce,Xe,He,qe,de)),de&&vt&2048&&vc(Xe.alternate,Xe);break;case 24:jn(Ce,Xe,He,qe,de),de&&vt&2048&&Bc(Xe.alternate,Xe);break;default:jn(Ce,Xe,He,qe,de)}z=z.sibling}}function bo(J,z){if(z.subtreeFlags&10256)for(z=z.child;z!==null;){var se=J,re=z,de=re.flags;switch(re.tag){case 22:bo(se,re),de&2048&&vc(re.alternate,re);break;case 24:bo(se,re),de&2048&&Bc(re.alternate,re);break;default:bo(se,re)}z=z.sibling}}function Ko(J){if(J.subtreeFlags&Ur)for(J=J.child;J!==null;)Nl(J),J=J.sibling}function Nl(J){switch(J.tag){case 26:Ko(J),J.flags&Ur&&(J.memoizedState!==null?Ug(gs,J.memoizedState,J.memoizedProps):Ng(J.type,J.memoizedProps));break;case 5:Ko(J),J.flags&Ur&&Ng(J.type,J.memoizedProps);break;case 3:case 4:if(Ys){var z=gs;gs=zn(J.stateNode.containerInfo),Ko(J),gs=z}else Ko(J);break;case 22:J.memoizedState===null&&(z=J.alternate,z!==null&&z.memoizedState!==null?(z=Ur,Ur=16777216,Ko(J),Ur=z):Ko(J));break;default:Ko(J)}}function Vl(J){var z=J.alternate;if(z!==null&&(J=z.child,J!==null)){z.child=null;do z=J.sibling,J.sibling=null,J=z;while(J!==null)}}function oa(J){var z=J.deletions;if((J.flags&16)!==0){if(z!==null)for(var se=0;se<z.length;se++){var re=z[se];ui=re,Wl(re,J)}Vl(J)}if(J.subtreeFlags&10256)for(J=J.child;J!==null;)Po(J),J=J.sibling}function Po(J){switch(J.tag){case 0:case 11:case 15:oa(J),J.flags&2048&&yr(9,J,J.return);break;case 3:oa(J);break;case 12:oa(J);break;case 22:var z=J.stateNode;J.memoizedState!==null&&z._visibility&4&&(J.return===null||J.return.tag!==13)?(z._visibility&=-5,El(J)):oa(J);break;default:oa(J)}}function El(J){var z=J.deletions;if((J.flags&16)!==0){if(z!==null)for(var se=0;se<z.length;se++){var re=z[se];ui=re,Wl(re,J)}Vl(J)}for(J=J.child;J!==null;){switch(z=J,z.tag){case 0:case 11:case 15:yr(8,z,z.return),El(z);break;case 22:se=z.stateNode,se._visibility&4&&(se._visibility&=-5,El(z));break;default:El(z)}J=J.sibling}}function Wl(J,z){for(;ui!==null;){var se=ui;switch(se.tag){case 0:case 11:case 15:yr(8,se,z);break;case 23:case 22:if(se.memoizedState!==null&&se.memoizedState.cachePool!==null){var re=se.memoizedState.cachePool.pool;re!=null&&re.refCount++}break;case 24:_l(se.memoizedState.cache)}if(re=se.child,re!==null)re.return=se,ui=re;else e:for(se=J;ui!==null;){re=ui;var de=re.sibling,Ce=re.return;if(yc(re),re===se){ui=null;break e}if(de!==null){de.return=Ce,ui=de;break e}ui=Ce}}}function vr(J){var z=Mc(J);if(z!=null){if(typeof z.memoizedProps["data-testname"]!="string")throw Error(I(364));return z}if(J=Ou(J),J===null)throw Error(I(362));return J.stateNode.current}function Sc(J,z){var se=J.tag;switch(z.$$typeof){case hn:if(J.type===z.value)return!0;break;case po:e:{for(z=z.value,J=[J,0],se=0;se<J.length;){var re=J[se++],de=re.tag,Ce=J[se++],Xe=z[Ce];if(de!==5&&de!==26&&de!==27||!xo(re)){for(;Xe!=null&&Sc(re,Xe);)Ce++,Xe=z[Ce];if(Ce===z.length){z=!0;break e}else for(re=re.child;re!==null;)J.push(re,Ce),re=re.sibling}}z=!1}return z;case Mo:if((se===5||se===26||se===27)&&$u(J.stateNode,z.value))return!0;break;case bs:if((se===5||se===6||se===26||se===27)&&(J=Uu(J),J!==null&&0<=J.indexOf(z.value)))return!0;break;case ll:if((se===5||se===26||se===27)&&(J=J.memoizedProps["data-testname"],typeof J=="string"&&J.toLowerCase()===z.value.toLowerCase()))return!0;break;default:throw Error(I(365))}return!1}function Rs(J){switch(J.$$typeof){case hn:return"<"+(y(J.value)||"Unknown")+">";case po:return":has("+(Rs(J)||"")+")";case Mo:return'[role="'+J.value+'"]';case bs:return'"'+J.value+'"';case ll:return'[data-testname="'+J.value+'"]';default:throw Error(I(365))}}function ra(J,z){var se=[];J=[J,0];for(var re=0;re<J.length;){var de=J[re++],Ce=de.tag,Xe=J[re++],He=z[Xe];if(Ce!==5&&Ce!==26&&Ce!==27||!xo(de)){for(;He!=null&&Sc(de,He);)Xe++,He=z[Xe];if(Xe===z.length)se.push(de);else for(de=de.child;de!==null;)J.push(de,Xe),de=de.sibling}}return se}function Br(J,z){if(!Qa)throw Error(I(363));J=vr(J),J=ra(J,z),z=[],J=Array.from(J);for(var se=0;se<J.length;){var re=J[se++],de=re.tag;if(de===5||de===26||de===27)xo(re)||z.push(re.stateNode);else for(re=re.child;re!==null;)J.push(re),re=re.sibling}return z}function ns(){if((Zi&2)!==0&&Mi!==0)return Mi&-Mi;if(Ii.T!==null){var J=un;return J!==0?J:ft()}return zu()}function Yl(){zs===0&&(zs=(Mi&536870912)===0||Hi?ce():536870912);var J=Ns.current;return J!==null&&(J.flags|=32),zs}function an(J,z,se){(J===qi&&$i===2||J.cancelPendingCommit!==null)&&(Sr(J,0),Is(J,Mi,zs,!1)),Ie(J,se),((Zi&2)===0||J!==qi)&&(J===qi&&((Zi&2)===0&&(hr|=se),fn===4&&Is(J,Mi,zs,!1)),kt(J))}function Es(J,z,se){if((Zi&6)!==0)throw Error(I(327));var re=!se&&(z&60)===0&&(z&J.expiredLanes)===0||le(J,z),de=re?Nu(J,z):Jl(J,z,!0),Ce=re;do{if(de===0){qs&&!re&&Is(J,z,0,!1);break}else if(de===6)Is(J,z,0,!Qs);else{if(se=J.current.alternate,Ce&&!Do(se)){de=Jl(J,z,!1),Ce=!1;continue}if(de===2){if(Ce=z,J.errorRecoveryDisabledLanes&Ce)var Xe=0;else Xe=J.pendingLanes&-536870913,Xe=Xe!==0?Xe:Xe&536870912?536870912:0;if(Xe!==0){z=Xe;e:{var He=J;de=cl;var qe=ws&&He.current.memoizedState.isDehydrated;if(qe&&(Sr(He,Xe).flags|=256),Xe=Jl(He,Xe,!1),Xe!==2){if(Sa&&!qe){He.errorRecoveryDisabledLanes|=Ce,hr|=Ce,de=4;break e}Ce=to,to=de,Ce!==null&&ko(Ce)}de=Xe}if(Ce=!1,de!==2)continue}}if(de===1){Sr(J,0),Is(J,z,0,!0);break}e:{switch(re=J,de){case 0:case 1:throw Error(I(345));case 4:if((z&4194176)===z){Is(re,z,zs,!Qs);break e}break;case 2:to=null;break;case 3:case 5:break;default:throw Error(I(329))}if(re.finishedWork=se,re.finishedLanes=z,(z&62914560)===z&&(Ce=iu+300-Ts(),10<Ce)){if(Is(re,z,zs,!Qs),ne(re,0)!==0)break e;re.timeoutHandle=Zc(yo.bind(null,re,se,to,xa,$c,z,zs,hr,Wn,Qs,2,-0,0),Ce);break e}yo(re,se,to,xa,$c,z,zs,hr,Wn,Qs,0,-0,0)}}break}while(!0);kt(J)}function ko(J){to===null?to=J:to.push.apply(to,J)}function yo(J,z,se,re,de,Ce,Xe,He,qe,vt,Ot,ti,Pt){var yi=z.subtreeFlags;if((yi&8192||(yi&16785408)===16785408)&&($h(),Nl(z),z=Ku(),z!==null)){J.cancelPendingCommit=z(xc.bind(null,J,se,re,de,Xe,He,qe,1,ti,Pt)),Is(J,Ce,Xe,!vt);return}xc(J,se,re,de,Xe,He,qe,Ot,ti,Pt)}function Do(J){for(var z=J;;){var se=z.tag;if((se===0||se===11||se===15)&&z.flags&16384&&(se=z.updateQueue,se!==null&&(se=se.stores,se!==null)))for(var re=0;re<se.length;re++){var de=se[re],Ce=de.getSnapshot;de=de.value;try{if(!ps(Ce(),de))return!1}catch{return!1}}if(se=z.child,z.subtreeFlags&16384&&se!==null)se.return=z,z=se;else{if(z===J)break;for(;z.sibling===null;){if(z.return===null||z.return===J)return!0;z=z.return}z.sibling.return=z.return,z=z.sibling}}return!0}function Is(J,z,se,re){z&=~ys,z&=~hr,J.suspendedLanes|=z,J.pingedLanes&=~z,re&&(J.warmLanes|=z),re=J.expirationTimes;for(var de=z;0<de;){var Ce=31-vn(de),Xe=1<<Ce;re[Ce]=-1,de&=~Xe}se!==0&&me(J,se,z)}function Bg(){return(Zi&6)===0?(Me(0),!1):!0}function Tl(){if(xi!==null){if($i===0)var J=xi.return;else J=xi,js=Or=null,oo(J),Ga=null,cs=0,J=xi;for(;J!==null;)Zu(J.alternate,J),J=J.return;xi=null}}function Sr(J,z){J.finishedWork=null,J.finishedLanes=0;var se=J.timeoutHandle;se!==ja&&(J.timeoutHandle=ja,Dl(se)),se=J.cancelPendingCommit,se!==null&&(J.cancelPendingCommit=null,se()),Tl(),qi=J,xi=se=Uo(J.current,null),Mi=z,$i=0,En=null,Qs=!1,qs=le(J,z),Sa=!1,Wn=zs=ys=hr=eo=fn=0,to=cl=null,$c=!1,(z&8)!==0&&(z|=z&32);var re=J.entangledLanes;if(re!==0)for(J=J.entanglements,re&=z;0<re;){var de=31-vn(re),Ce=1<<de;z|=J[de],re&=~Ce}return Ao=z,we(),se}function ss(J,z){Ai=null,Ii.H=Xn,z===ql?(z=si(),$i=3):z===ec?(z=si(),$i=4):$i=z===eu?8:z!==null&&typeof z=="object"&&typeof z.then=="function"?6:1,En=z,xi===null&&(fn=1,Wa(J,Ye(z,J.current)))}function Pn(){var J=Ns.current;return J===null?!0:(Mi&4194176)===Mi?Us===null:(Mi&62914560)===Mi||(Mi&536870912)!==0?J===Us:!1}function Ji(){var J=Ii.H;return Ii.H=Xn,J===null?Xn:J}function Ps(){var J=Ii.A;return Ii.A=ur,J}function ks(){fn=4,Qs||(Mi&4194176)!==Mi&&Ns.current!==null||(qs=!0),(eo&134217727)===0&&(hr&134217727)===0||qi===null||Is(qi,Mi,zs,!1)}function Jl(J,z,se){var re=Zi;Zi|=2;var de=Ji(),Ce=Ps();(qi!==J||Mi!==z)&&(xa=null,Sr(J,z)),z=!1;var Xe=fn;e:do try{if($i!==0&&xi!==null){var He=xi,qe=En;switch($i){case 8:Tl(),Xe=6;break e;case 3:case 2:case 6:Ns.current===null&&(z=!0);var vt=$i;if($i=0,En=null,Go(J,He,qe,vt),se&&qs){Xe=0;break e}break;default:vt=$i,$i=0,En=null,Go(J,He,qe,vt)}}aa(),Xe=fn;break}catch(Ot){ss(J,Ot)}while(!0);return z&&J.shellSuspendCounter++,js=Or=null,Zi=re,Ii.H=de,Ii.A=Ce,xi===null&&(qi=null,Mi=0,we()),Xe}function aa(){for(;xi!==null;)Ka(xi)}function Nu(J,z){var se=Zi;Zi|=2;var re=Ji(),de=Ps();qi!==J||Mi!==z?(xa=null,Fs=Ts()+500,Sr(J,z)):qs=le(J,z);e:do try{if($i!==0&&xi!==null){z=xi;var Ce=En;t:switch($i){case 1:$i=0,En=null,Go(J,z,Ce,1);break;case 2:if(bt(Ce)){$i=0,En=null,Pa(z);break}z=function(){$i===2&&qi===J&&($i=7),kt(J)},Ce.then(z,z);break e;case 3:$i=7;break e;case 4:$i=5;break e;case 7:bt(Ce)?($i=0,En=null,Pa(z)):($i=0,En=null,Go(J,z,Ce,7));break;case 5:var Xe=null;switch(xi.tag){case 26:Xe=xi.memoizedState;case 5:case 27:var He=xi,qe=He.type,vt=He.pendingProps;if(Xe?Og(Xe):Mg(qe,vt)){$i=0,En=null;var Ot=He.sibling;if(Ot!==null)xi=Ot;else{var ti=He.return;ti!==null?(xi=ti,xr(ti)):xi=null}break t}}$i=0,En=null,Go(J,z,Ce,5);break;case 6:$i=0,En=null,Go(J,z,Ce,6);break;case 8:Tl(),fn=6;break e;default:throw Error(I(462))}}Vu();break}catch(Pt){ss(J,Pt)}while(!0);return js=Or=null,Ii.H=re,Ii.A=de,Zi=se,xi!==null?0:(qi=null,Mi=0,we(),fn)}function Vu(){for(;xi!==null&&!Hr();)Ka(xi)}function Ka(J){var z=Ru(J.alternate,J,Ao);J.memoizedProps=J.pendingProps,z===null?xr(J):xi=z}function Pa(J){var z=J,se=z.alternate;switch(z.tag){case 15:case 0:z=Gu(se,z,z.pendingProps,z.type,void 0,Mi);break;case 11:z=Gu(se,z,z.pendingProps,z.type.render,z.ref,Mi);break;case 5:oo(z);default:Zu(se,z),z=xi=la(z,Ao),z=Ru(se,z,Ao)}J.memoizedProps=J.pendingProps,z===null?xr(J):xi=z}function Go(J,z,se,re){js=Or=null,oo(z),Ga=null,cs=0;var de=z.return;try{if(Lh(J,de,z,se,Mi)){fn=1,Wa(J,Ye(se,J.current)),xi=null;return}}catch(Ce){if(de!==null)throw xi=de,Ce;fn=1,Wa(J,Ye(se,J.current)),xi=null;return}z.flags&32768?(Hi||re===1?J=!0:qs||(Mi&536870912)!==0?J=!1:(Qs=J=!0,(re===2||re===3||re===6)&&(re=Ns.current,re!==null&&re.tag===13&&(re.flags|=16384))),Sg(z,J)):xr(z)}function xr(J){var z=J;do{if((z.flags&32768)!==0){Sg(z,Qs);return}J=z.return;var se=wu(z.alternate,z,Ao);if(se!==null){xi=se;return}if(z=z.sibling,z!==null){xi=z;return}xi=z=J}while(z!==null);fn===0&&(fn=5)}function Sg(J,z){do{var se=Ph(J.alternate,J);if(se!==null){se.flags&=32767,xi=se;return}if(se=J.return,se!==null&&(se.flags|=32768,se.subtreeFlags=0,se.deletions=null),!z&&(J=J.sibling,J!==null)){xi=J;return}xi=J=se}while(J!==null);fn=6,xi=null}function xc(J,z,se,re,de,Ce,Xe,He,qe,vt){var Ot=Ii.T,ti=Yr();try{fs(2),Ii.T=null,Eu(J,z,se,re,ti,de,Ce,Xe,He,qe,vt)}finally{Ii.T=Ot,fs(ti)}}function Eu(J,z,se,re,de,Ce,Xe,He){do Xr();while($r!==null);if((Zi&6)!==0)throw Error(I(327));var qe=J.finishedWork;if(re=J.finishedLanes,qe===null)return null;if(J.finishedWork=null,J.finishedLanes=0,qe===J.current)throw Error(I(177));J.callbackNode=null,J.callbackPriority=0,J.cancelPendingCommit=null;var vt=qe.lanes|qe.childLanes;if(vt|=Co,fe(J,re,vt,Ce,Xe,He),J===qi&&(xi=qi=null,Mi=0),(qe.subtreeFlags&10256)===0&&(qe.flags&10256)===0||dr||(dr=!0,Qc=vt,sc=se,Wu(tl,function(){return Xr(),null})),se=(qe.flags&15990)!==0,(qe.subtreeFlags&15990)!==0||se?(se=Ii.T,Ii.T=null,Ce=Yr(),fs(2),Xe=Zi,Zi|=4,bg(J,qe),Gg(qe,J),Uh(J.containerInfo),J.current=qe,Fa(J,qe.alternate,qe),nr(),Zi=Xe,fs(Ce),Ii.T=se):J.current=qe,dr?(dr=!1,$r=J,gl=re):Hl(J,vt),vt=J.pendingLanes,vt===0&&(Vo=null),ye(qe.stateNode),kt(J),z!==null)for(de=J.onRecoverableError,qe=0;qe<z.length;qe++)vt=z[qe],de(vt.value,{componentStack:vt.stack});return(gl&3)!==0&&Xr(),vt=J.pendingLanes,(re&4194218)!==0&&(vt&42)!==0?J===nu?Xa++:(Xa=0,nu=J):Xa=0,Me(0),null}function Hl(J,z){(J.pooledCacheLanes&=z)===0&&(z=J.pooledCache,z!=null&&(J.pooledCache=null,_l(z)))}function Xr(){if($r!==null){var J=$r,z=Qc;Qc=0;var se=Ze(gl),re=32>se?32:se;se=Ii.T;var de=Yr();try{if(fs(re),Ii.T=null,$r===null)var Ce=!1;else{re=sc,sc=null;var Xe=$r,He=gl;if($r=null,gl=0,(Zi&6)!==0)throw Error(I(331));var qe=Zi;if(Zi|=4,Po(Xe.current),Ks(Xe,Xe.current,He,re),Zi=qe,Me(0,!1),Nn&&typeof Nn.onPostCommitFiberRoot=="function")try{Nn.onPostCommitFiberRoot(il,Xe)}catch{}Ce=!0}return Ce}finally{fs(de),Ii.T=se,Hl(J,z)}}return!1}function ka(J,z,se){z=Ye(se,z),z=Ta(J.stateNode,z,2),J=Nt(J,z,2),J!==null&&(Ie(J,2),kt(J))}function Pi(J,z,se){if(J.tag===3)ka(J,J,se);else for(;z!==null;){if(z.tag===3){ka(z,J,se);break}else if(z.tag===1){var re=z.stateNode;if(typeof z.type.getDerivedStateFromError=="function"||typeof re.componentDidCatch=="function"&&(Vo===null||!Vo.has(re))){J=Ye(se,J),se=ag(2),re=Nt(z,se,2),re!==null&&(pu(se,re,z,J),Ie(re,2),kt(re));break}}z=z.return}}function Rr(J,z,se){var re=J.pingCache;if(re===null){re=J.pingCache=new nc;var de=new Set;re.set(z,de)}else de=re.get(z),de===void 0&&(de=new Set,re.set(z,de));de.has(se)||(Sa=!0,de.add(se),J=zl.bind(null,J,z,se),z.then(J,J))}function zl(J,z,se){var re=J.pingCache;re!==null&&re.delete(z),J.pingedLanes|=J.suspendedLanes&se,J.warmLanes&=~se,qi===J&&(Mi&se)===se&&(fn===4||fn===3&&(Mi&62914560)===Mi&&300>Ts()-iu?(Zi&2)===0&&Sr(J,0):ys|=se,Wn===Mi&&(Wn=0)),kt(J)}function Fl(J,z){z===0&&(z=ge()),J=Ht(J,z),J!==null&&(Ie(J,z),kt(J))}function Ll(J){var z=J.memoizedState,se=0;z!==null&&(se=z.retryLane),Fl(J,se)}function Xc(J,z){var se=0;switch(J.tag){case 13:var re=J.stateNode,de=J.memoizedState;de!==null&&(se=de.retryLane);break;case 19:re=J.stateNode;break;case 22:re=J.stateNode._retryCache;break;default:throw Error(I(314))}re!==null&&re.delete(z),Fl(J,se)}function Wu(J,z){return Ro(J,z)}function Yu(J,z,se,re){this.tag=J,this.key=se,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=z,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=re,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oo(J){return J=J.prototype,!(!J||!J.isReactComponent)}function Uo(J,z){var se=J.alternate;return se===null?(se=d(J.tag,z,J.key,J.mode),se.elementType=J.elementType,se.type=J.type,se.stateNode=J.stateNode,se.alternate=J,J.alternate=se):(se.pendingProps=z,se.type=J.type,se.flags=0,se.subtreeFlags=0,se.deletions=null),se.flags=J.flags&31457280,se.childLanes=J.childLanes,se.lanes=J.lanes,se.child=J.child,se.memoizedProps=J.memoizedProps,se.memoizedState=J.memoizedState,se.updateQueue=J.updateQueue,z=J.dependencies,se.dependencies=z===null?null:{lanes:z.lanes,firstContext:z.firstContext},se.sibling=J.sibling,se.index=J.index,se.ref=J.ref,se.refCleanup=J.refCleanup,se}function la(J,z){J.flags&=31457282;var se=J.alternate;return se===null?(J.childLanes=0,J.lanes=z,J.child=null,J.subtreeFlags=0,J.memoizedProps=null,J.memoizedState=null,J.updateQueue=null,J.dependencies=null,J.stateNode=null):(J.childLanes=se.childLanes,J.lanes=se.lanes,J.child=se.child,J.subtreeFlags=0,J.deletions=null,J.memoizedProps=se.memoizedProps,J.memoizedState=se.memoizedState,J.updateQueue=se.updateQueue,J.type=se.type,z=se.dependencies,J.dependencies=z===null?null:{lanes:z.lanes,firstContext:z.firstContext}),J}function ca(J,z,se,re,de,Ce){var Xe=0;if(re=J,typeof J=="function")Oo(J)&&(Xe=1);else if(typeof J=="string")Xe=Ys&&kn?Hn(J,se,Bn.current)?26:zc(J)?27:5:Ys?Hn(J,se,Bn.current)?26:5:kn&&zc(J)?27:5;else e:switch(J){case Zr:return _r(se.children,de,Ce,z);case ha:Xe=8,de|=24;break;case Mr:return J=d(12,se,z,de|2),J.elementType=Mr,J.lanes=Ce,J;case Qo:return J=d(13,se,z,de),J.elementType=Qo,J.lanes=Ce,J;case Pl:return J=d(19,se,z,de),J.elementType=Pl,J.lanes=Ce,J;case er:return Rc(se,de,Ce,z);default:if(typeof J=="object"&&J!==null)switch(J.$$typeof){case Dh:case Nr:Xe=10;break e;case Rg:Xe=9;break e;case _c:Xe=11;break e;case Oa:Xe=14;break e;case qo:Xe=16,re=null;break e}Xe=29,se=Error(I(130,J===null?"null":typeof J,"")),re=null}return z=d(Xe,se,z,de),z.elementType=J,z.type=re,z.lanes=Ce,z}function _r(J,z,se,re){return J=d(7,J,re,z),J.lanes=se,J}function Rc(J,z,se,re){J=d(22,J,re,z),J.elementType=er,J.lanes=se;var de={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var Ce=de._current;if(Ce===null)throw Error(I(456));if((de._pendingVisibility&2)===0){var Xe=Ht(Ce,2);Xe!==null&&(de._pendingVisibility|=2,an(Xe,Ce,2))}},attach:function(){var Ce=de._current;if(Ce===null)throw Error(I(456));if((de._pendingVisibility&2)!==0){var Xe=Ht(Ce,2);Xe!==null&&(de._pendingVisibility&=-3,an(Xe,Ce,2))}}};return J.stateNode=de,J}function Kl(J,z,se){return J=d(6,J,null,z),J.lanes=se,J}function _s(J,z,se){return z=d(4,J.children!==null?J.children:[],J.key,z),z.lanes=se,z.stateNode={containerInfo:J.containerInfo,pendingChildren:null,implementation:J.implementation},z}function vo(J,z,se,re,de,Ce,Xe,He){this.tag=1,this.containerInfo=J,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ja,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=he(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=he(0),this.hiddenUpdates=he(null),this.identifierPrefix=re,this.onUncaughtError=de,this.onCaughtError=Ce,this.onRecoverableError=Xe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=He,this.incompleteTransitions=new Map}function $o(J,z,se,re,de,Ce,Xe,He,qe,vt,Ot,ti){return J=new vo(J,z,se,Xe,He,qe,vt,ti),z=1,Ce===!0&&(z|=24),Ce=d(3,null,null,z),J.current=Ce,Ce.stateNode=J,z=br(),z.refCount++,J.pooledCache=z,z.refCount++,Ce.memoizedState={element:re,isDehydrated:se,cache:z},it(Ce),J}function xg(J){return J?(J=ba,J):ba}function jo(J){var z=J._reactInternals;if(z===void 0)throw typeof J.render=="function"?Error(I(188)):(J=Object.keys(J).join(","),Error(I(268,J)));return J=H(z),J=J!==null?F(J):null,J===null?null:da(J.stateNode)}function Bo(J,z,se,re,de,Ce){de=xg(de),re.context===null?re.context=de:re.pendingContext=de,re=Zt(z),re.payload={element:se},Ce=Ce===void 0?null:Ce,Ce!==null&&(re.callback=Ce),se=Nt(J,re,z),se!==null&&(an(se,J,z),_t(se,J,z))}function Zn(J,z){if(J=J.memoizedState,J!==null&&J.dehydrated!==null){var se=J.retryLane;J.retryLane=se!==0&&se<z?se:z}}function Da(J,z){Zn(J,z),(J=J.alternate)&&Zn(J,z)}var wi={},kh=requireReact(),Ws=requireScheduler(),yn=Object.assign,Xg=Symbol.for("react.element"),wr=Symbol.for("react.transitional.element"),So=Symbol.for("react.portal"),Zr=Symbol.for("react.fragment"),ha=Symbol.for("react.strict_mode"),Mr=Symbol.for("react.profiler"),Dh=Symbol.for("react.provider"),Rg=Symbol.for("react.consumer"),Nr=Symbol.for("react.context"),_c=Symbol.for("react.forward_ref"),Qo=Symbol.for("react.suspense"),Pl=Symbol.for("react.suspense_list"),Oa=Symbol.for("react.memo"),qo=Symbol.for("react.lazy"),er=Symbol.for("react.offscreen"),Si=Symbol.for("react.memo_cache_sentinel"),Ui=Symbol.iterator,Mn=Symbol.for("react.client.reference"),Ii=kh.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Vr,Er,Ua=!1,Wr=Array.isArray,$a=n.rendererVersion,Oh=n.rendererPackageName,An=n.extraDevToolsConfig,da=n.getPublicInstance,_g=n.getRootHostContext,Tu=n.getChildHostContext,Ju=n.prepareForCommit,Uh=n.resetAfterCommit,wg=n.createInstance,kl=n.appendInitialChild,wc=n.finalizeInitialChildren,Qn=n.shouldSetTextContent,Gn=n.createTextInstance,Zc=n.scheduleTimeout,Dl=n.cancelTimeout,ja=n.noTimeout,lo=n.isPrimaryRenderer;n.warnsIfNotActing;var Cn=n.supportsMutation,co=n.supportsPersistence,ws=n.supportsHydration,Mc=n.getInstanceFromNode;n.beforeActiveInstanceBlur,n.afterActiveInstanceBlur;var Hu=n.preparePortalMount;n.prepareScopeUpdate,n.getInstanceFromScope;var fs=n.setCurrentUpdatePriority,Yr=n.getCurrentUpdatePriority,zu=n.resolveUpdatePriority;n.resolveEventType,n.resolveEventTimeStamp;var Fu=n.shouldAttemptEagerTransition,Lu=n.detachDeletedInstance;n.requestPostPaintCallback;var Zg=n.maySuspendCommit,Mg=n.preloadInstance,$h=n.startSuspendingCommit,Ng=n.suspendInstance,Ku=n.waitForCommitToBeReady,Ca=n.NotPendingTransition,tr=n.HostTransitionContext,Pu=n.resetFormInstance;n.bindToConsole;var ku=n.supportsMicrotasks,Du=n.scheduleMicrotask,Qa=n.supportsTestSelectors,Ou=n.findFiberRoot,jh=n.getBoundingRect,Uu=n.getTextContent,xo=n.isHiddenSubtree,$u=n.matchAccessibilityRole,Nc=n.setFocusIfFocusable,Vc=n.setupIntersectionObserver,ju=n.appendChild,Vg=n.appendChildToContainer,Qu=n.commitTextUpdate,qu=n.commitMount,eh=n.commitUpdate,th=n.insertBefore,Eg=n.insertInContainerBefore,ih=n.removeChild,nh=n.removeChildFromContainer,Ec=n.resetTextContent,sh=n.hideInstance,oh=n.hideTextInstance,Qh=n.unhideInstance,Wg=n.unhideTextInstance,rh=n.clearContainer,ah=n.cloneInstance,Wc=n.createContainerChildSet,Yg=n.appendChildToContainerChildSet,lh=n.finalizeContainerChildren,ch=n.replaceContainerChildren,gh=n.cloneHiddenInstance,Tg=n.cloneHiddenTextInstance,fa=n.isSuspenseInstancePending,Ol=n.isSuspenseInstanceFallback,Yc=n.getSuspenseInstanceFallbackErrorDetails,uh=n.registerSuspenseInstanceRetry,hh=n.canHydrateFormStateMarker,Xo=n.isFormStateMarkerMatching,Tr=n.getNextHydratableSibling,ir=n.getFirstHydratableChild,pa=n.getFirstHydratableChildWithinContainer,Jg=n.getFirstHydratableChildWithinSuspenseInstance,Hg=n.canHydrateInstance,dh=n.canHydrateTextInstance,Ch=n.canHydrateSuspenseInstance,Aa=n.hydrateInstance,Tc=n.hydrateTextInstance,Ih=n.hydrateSuspenseInstance,fh=n.getNextHydratableInstanceAfterSuspenseInstance,ph=n.commitHydratedContainer,Jc=n.commitHydratedSuspenseInstance,mh=n.clearSuspenseBoundary,zg=n.clearSuspenseBoundaryFromContainer,Fg=n.shouldDeleteUnhydratedTailInstances;n.diffHydratedPropsForDevWarnings,n.diffHydratedTextForDevWarnings,n.describeHydratableInstanceForDevWarnings;var Ah=n.validateHydratableInstance,qh=n.validateHydratableTextInstance,Ys=n.supportsResources,Hn=n.isHostHoistableType,zn=n.getHoistableRoot,Lg=n.getResource,Kg=n.acquireResource,Pg=n.releaseResource,bh=n.hydrateHoistable,kg=n.mountHoistable,qa=n.unmountHoistable,Dg=n.createHoistableInstance,yh=n.prepareToCommitHoistables,Gh=n.mayResourceSuspendCommit,Og=n.preloadResource,Ug=n.suspendResource,kn=n.supportsSingletons,Hc=n.resolveSingletonInstance,vh=n.clearSingleton,$g=n.acquireSingletonInstance,jg=n.releaseSingletonInstance,zc=n.isHostSingletonType,Fc=[],Jr=-1,ba={},vn=Math.clz32?Math.clz32:Q,Qg=Math.log,ed=Math.LN2,Ul=128,el=4194304,Ro=Ws.unstable_scheduleCallback,go=Ws.unstable_cancelCallback,Hr=Ws.unstable_shouldYield,nr=Ws.unstable_requestPaint,Ts=Ws.unstable_now,Lc=Ws.unstable_ImmediatePriority,$l=Ws.unstable_UserBlockingPriority,tl=Ws.unstable_NormalPriority,ya=Ws.unstable_IdlePriority,os=Ws.log,Kc=Ws.unstable_setDisableYieldValue,il=null,Nn=null,ps=typeof Object.is=="function"?Object.is:Ve,Pc=new WeakMap,Js=[],Hs=0,zr=null,nl=0,Zs=[],rs=0,uo=null,_o=1,wo="",Bn=$(null),Ds=$(null),sr=$(null),jl=$(null),Sn=null,ji=null,Hi=!1,Os=null,ho=!1,Ql=Error(I(519)),Ms=[],or=0,Co=0,gn=null,Fr=null,kc=!1,xn=!1,Dc=!1,sl=0,ol=null,Oc=0,un=0,Dn=null,as=!1,Uc=!1,Bh=Object.prototype.hasOwnProperty,ql=Error(I(460)),ec=Error(I(474)),ms={then:function(){}},ls=null,Ga=null,cs=0,Lr=Di(!0),Zo=Di(!1),Io=$(null),fo=$(0),Ns=$(null),Us=null,ln=$(0),rr=0,Ai=null,Fi=null,In=null,ar=!1,va=!1,Kr=!1,Pr=0,rl=0,lr=null,Sh=0,qg=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Xn={readContext:$n,use:tt,useCallback:pi,useContext:pi,useEffect:pi,useImperativeHandle:pi,useLayoutEffect:pi,useInsertionEffect:pi,useMemo:pi,useReducer:pi,useRef:pi,useState:pi,useDebugValue:pi,useDeferredValue:pi,useTransition:pi,useSyncExternalStore:pi,useId:pi};Xn.useCacheRefresh=pi,Xn.useMemoCache=pi,Xn.useHostTransitionStatus=pi,Xn.useFormState=pi,Xn.useActionState=pi,Xn.useOptimistic=pi;var cr={readContext:$n,use:tt,useCallback:function(J,z){return Se().memoizedState=[J,z===void 0?null:z],J},useContext:$n,useEffect:ng,useImperativeHandle:function(J,z,se){se=se!=null?se.concat([J]):null,lc(4194308,4,Al.bind(null,z,J),se)},useLayoutEffect:function(J,z){return lc(4194308,4,J,z)},useInsertionEffect:function(J,z){lc(4,2,J,z)},useMemo:function(J,z){var se=Se();z=z===void 0?null:z;var re=J();if(Kr){Ee(!0);try{J()}finally{Ee(!1)}}return se.memoizedState=[re,z],re},useReducer:function(J,z,se){var re=Se();if(se!==void 0){var de=se(z);if(Kr){Ee(!0);try{se(z)}finally{Ee(!1)}}}else de=z;return re.memoizedState=re.baseState=de,J={pending:null,lanes:0,dispatch:null,lastRenderedReducer:J,lastRenderedState:de},re.queue=J,J=J.dispatch=hc.bind(null,Ai,J),[re.memoizedState,J]},useRef:function(J){var z=Se();return J={current:J},z.memoizedState=J},useState:function(J){J=Ti(J);var z=J.queue,se=rg.bind(null,Ai,z);return z.dispatch=se,[J.memoizedState,se]},useDebugValue:bl,useDeferredValue:function(J,z){var se=Se();return gc(se,J,z)},useTransition:function(){var J=Ti(!1);return J=sg.bind(null,Ai,J.queue,!0,!1),Se().memoizedState=J,[!1,J]},useSyncExternalStore:function(J,z,se){var re=Ai,de=Se();if(Hi){if(se===void 0)throw Error(I(407));se=se()}else{if(se=z(),qi===null)throw Error(I(349));(Mi&60)!==0||Ci(re,z,se)}de.memoizedState=se;var Ce={value:se,getSnapshot:z};return de.queue=Ce,ng(Ni.bind(null,re,Ce,J),[J]),re.flags|=2048,ro(9,li.bind(null,re,Ce,se,z),{destroy:void 0},null),se},useId:function(){var J=Se(),z=qi.identifierPrefix;if(Hi){var se=wo,re=_o;se=(re&~(1<<32-vn(re)-1)).toString(32)+se,z=":"+z+"R"+se,se=Pr++,0<se&&(z+="H"+se.toString(32)),z+=":"}else se=Sh++,z=":"+z+"r"+se.toString(32)+":";return J.memoizedState=z},useCacheRefresh:function(){return Se().memoizedState=og.bind(null,Ai)}};cr.useMemoCache=$e,cr.useHostTransitionStatus=yl,cr.useFormState=Oi,cr.useActionState=Oi,cr.useOptimistic=function(J){var z=Se();z.memoizedState=z.baseState=J;var se={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return z.queue=se,z=Na.bind(null,Ai,!0,se),se.dispatch=z,[J,z]};var As={readContext:$n,use:tt,useCallback:qr,useContext:$n,useEffect:ml,useImperativeHandle:cc,useInsertionEffect:Cu,useLayoutEffect:Iu,useMemo:ea,useReducer:Qt,useRef:ds,useState:function(){return Qt(Mt)},useDebugValue:bl,useDeferredValue:function(J,z){var se=Le();return uc(se,Fi.memoizedState,J,z)},useTransition:function(){var J=Qt(Mt)[0],z=Le().memoizedState;return[typeof J=="boolean"?J:ot(J),z]},useSyncExternalStore:di,useId:Ma};As.useCacheRefresh=Yo,As.useMemoCache=$e,As.useHostTransitionStatus=yl,As.useFormState=ts,As.useActionState=ts,As.useOptimistic=function(J,z){var se=Le();return mi(se,Fi,J,z)};var kr={readContext:$n,use:tt,useCallback:qr,useContext:$n,useEffect:ml,useImperativeHandle:cc,useInsertionEffect:Cu,useLayoutEffect:Iu,useMemo:ea,useReducer:qt,useRef:ds,useState:function(){return qt(Mt)},useDebugValue:bl,useDeferredValue:function(J,z){var se=Le();return Fi===null?gc(se,J,z):uc(se,Fi.memoizedState,J,z)},useTransition:function(){var J=qt(Mt)[0],z=Le().memoizedState;return[typeof J=="boolean"?J:ot(J),z]},useSyncExternalStore:di,useId:Ma};kr.useCacheRefresh=Yo,kr.useMemoCache=$e,kr.useHostTransitionStatus=yl,kr.useFormState=Kn,kr.useActionState=Kn,kr.useOptimistic=function(J,z){var se=Le();return Fi!==null?mi(se,Fi,J,z):(se.baseState=J,[J,se.queue.dispatch])};var al={isMounted:function(J){return(J=J._reactInternals)?V(J)===J:!1},enqueueSetState:function(J,z,se){J=J._reactInternals;var re=ns(),de=Zt(re);de.payload=z,se!=null&&(de.callback=se),z=Nt(J,de,re),z!==null&&(an(z,J,re),_t(z,J,re))},enqueueReplaceState:function(J,z,se){J=J._reactInternals;var re=ns(),de=Zt(re);de.tag=1,de.payload=z,se!=null&&(de.callback=se),z=Nt(J,de,re),z!==null&&(an(z,J,re),_t(z,J,re))},enqueueForceUpdate:function(J,z){J=J._reactInternals;var se=ns(),re=Zt(se);re.tag=2,z!=null&&(re.callback=z),z=Nt(J,re,se),z!==null&&(an(z,J,se),_t(z,J,se))}},Dr=typeof reportError=="function"?reportError:function(J){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof J=="object"&&J!==null&&typeof J.message=="string"?String(J.message):String(J),error:J});if(!window.dispatchEvent(z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",J);return}console.error(J)},eu=Error(I(461)),Vn=!1,tc={dehydrated:null,treeContext:null,retryLane:0},$s=$(null),Or=null,js=null,ic=typeof AbortController<"u"?AbortController:function(){var J=[],z=this.signal={aborted:!1,addEventListener:function(se,re){J.push(re)}};this.abort=function(){z.aborted=!0,J.forEach(function(se){return se()})}},pn=Ws.unstable_scheduleCallback,td=Ws.unstable_NormalPriority,bn={$$typeof:Nr,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},tu=Ii.S;Ii.S=function(J,z){typeof z=="object"&&z!==null&&typeof z.then=="function"&&Dt(J,z),tu!==null&&tu(J,z)};var Ba=$(null),gr=!1,bi=!1,Qi=!1,Xi=typeof WeakSet=="function"?WeakSet:Set,ui=null,tn=!1,Li=null,Rn=!1,gs=null,Ur=8192,ur={getCacheForType:function(J){var z=$n(bn),se=z.data.get(J);return se===void 0&&(se=J(),z.data.set(J,se)),se}},hn=0,po=1,Mo=2,ll=3,bs=4;if(typeof Symbol=="function"&&Symbol.for){var No=Symbol.for;hn=No("selector.component"),po=No("selector.has_pseudo_class"),Mo=No("selector.role"),ll=No("selector.test_id"),bs=No("selector.text")}var nc=typeof WeakMap=="function"?WeakMap:Map,Zi=0,qi=null,xi=null,Mi=0,$i=0,En=null,Qs=!1,qs=!1,Sa=!1,Ao=0,fn=0,eo=0,hr=0,ys=0,zs=0,Wn=0,cl=null,to=null,$c=!1,iu=0,Fs=1/0,xa=null,Vo=null,dr=!1,$r=null,gl=0,Qc=0,sc=null,Xa=0,nu=null;return wi.attemptContinuousHydration=function(J){if(J.tag===13){var z=Ht(J,67108864);z!==null&&an(z,J,67108864),Da(J,67108864)}},wi.attemptHydrationAtCurrentPriority=function(J){if(J.tag===13){var z=ns(),se=Ht(J,z);se!==null&&an(se,J,z),Da(J,z)}},wi.attemptSynchronousHydration=function(J){switch(J.tag){case 3:if(J=J.stateNode,J.current.memoizedState.isDehydrated){var z=ie(J.pendingLanes);if(z!==0){for(J.pendingLanes|=2,J.entangledLanes|=2;z;){var se=1<<31-vn(z);J.entanglements[1]|=se,z&=~se}kt(J),(Zi&6)===0&&(Fs=Ts()+500,Me(0))}}break;case 13:z=Ht(J,2),z!==null&&an(z,J,2),Bg(),Da(J,2)}},wi.batchedUpdates=function(J,z){return J(z)},wi.createComponentSelector=function(J){return{$$typeof:hn,value:J}},wi.createContainer=function(J,z,se,re,de,Ce,Xe,He,qe,vt){return $o(J,z,!1,null,se,re,Ce,Xe,He,qe,vt,null)},wi.createHasPseudoClassSelector=function(J){return{$$typeof:po,value:J}},wi.createHydrationContainer=function(J,z,se,re,de,Ce,Xe,He,qe,vt,Ot,ti,Pt){return J=$o(se,re,!0,J,de,Ce,He,qe,vt,Ot,ti,Pt),J.context=xg(null),se=J.current,re=ns(),de=Zt(re),de.callback=z??null,Nt(se,de,re),J.current.lanes=re,Ie(J,re),kt(J),J},wi.createPortal=function(J,z,se){var re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:So,key:re==null?null:""+re,children:J,containerInfo:z,implementation:se}},wi.createRoleSelector=function(J){return{$$typeof:Mo,value:J}},wi.createTestNameSelector=function(J){return{$$typeof:ll,value:J}},wi.createTextSelector=function(J){return{$$typeof:bs,value:J}},wi.defaultOnCaughtError=function(J){console.error(J)},wi.defaultOnRecoverableError=function(J){Dr(J)},wi.defaultOnUncaughtError=function(J){Dr(J)},wi.deferredUpdates=function(J){var z=Ii.T,se=Yr();try{return fs(32),Ii.T=null,J()}finally{fs(se),Ii.T=z}},wi.discreteUpdates=function(J,z,se,re,de){var Ce=Ii.T,Xe=Yr();try{return fs(2),Ii.T=null,J(z,se,re,de)}finally{fs(Xe),Ii.T=Ce,Zi===0&&(Fs=Ts()+500)}},wi.findAllNodes=Br,wi.findBoundingRects=function(J,z){if(!Qa)throw Error(I(363));z=Br(J,z),J=[];for(var se=0;se<z.length;se++)J.push(jh(z[se]));for(z=J.length-1;0<z;z--){se=J[z];for(var re=se.x,de=re+se.width,Ce=se.y,Xe=Ce+se.height,He=z-1;0<=He;He--)if(z!==He){var qe=J[He],vt=qe.x,Ot=vt+qe.width,ti=qe.y,Pt=ti+qe.height;if(re>=vt&&Ce>=ti&&de<=Ot&&Xe<=Pt){J.splice(z,1);break}else if(re!==vt||se.width!==qe.width||Pt<Ce||ti>Xe){if(!(Ce!==ti||se.height!==qe.height||Ot<re||vt>de)){vt>re&&(qe.width+=vt-re,qe.x=re),Ot<de&&(qe.width=de-vt),J.splice(z,1);break}}else{ti>Ce&&(qe.height+=ti-Ce,qe.y=Ce),Pt<Xe&&(qe.height=Xe-ti),J.splice(z,1);break}}}return J},wi.findHostInstance=jo,wi.findHostInstanceWithNoPortals=function(J){return J=H(J),J=J!==null?O(J):null,J===null?null:da(J.stateNode)},wi.findHostInstanceWithWarning=function(J){return jo(J)},wi.flushPassiveEffects=Xr,wi.flushSyncFromReconciler=function(J){var z=Zi;Zi|=1;var se=Ii.T,re=Yr();try{if(fs(2),Ii.T=null,J)return J()}finally{fs(re),Ii.T=se,Zi=z,(Zi&6)===0&&Me(0)}},wi.flushSyncWork=Bg,wi.focusWithin=function(J,z){if(!Qa)throw Error(I(363));for(J=vr(J),z=ra(J,z),z=Array.from(z),J=0;J<z.length;){var se=z[J++],re=se.tag;if(!xo(se)){if((re===5||re===26||re===27)&&Nc(se.stateNode))return!0;for(se=se.child;se!==null;)z.push(se),se=se.sibling}}return!1},wi.getFindAllNodesFailureDescription=function(J,z){if(!Qa)throw Error(I(363));var se=0,re=[];J=[vr(J),0];for(var de=0;de<J.length;){var Ce=J[de++],Xe=Ce.tag,He=J[de++],qe=z[He];if((Xe!==5&&Xe!==26&&Xe!==27||!xo(Ce))&&(Sc(Ce,qe)&&(re.push(Rs(qe)),He++,He>se&&(se=He)),He<z.length))for(Ce=Ce.child;Ce!==null;)J.push(Ce,He),Ce=Ce.sibling}if(se<z.length){for(J=[];se<z.length;se++)J.push(Rs(z[se]));return`findAllNodes was able to match part of the selector:
  `+(re.join(" > ")+`

No matching component was found for:
  `)+J.join(" > ")}return null},wi.getPublicRootInstance=function(J){if(J=J.current,!J.child)return null;switch(J.child.tag){case 27:case 5:return da(J.child.stateNode);default:return J.child.stateNode}},wi.injectIntoDevTools=function(){var J={bundleType:0,version:$a,rendererPackageName:Oh,currentDispatcherRef:Ii,findFiberByHostInstance:Mc,reconcilerVersion:"19.0.0"};if(An!==null&&(J.rendererConfig=An),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")J=!1;else{var z=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(z.isDisabled||!z.supportsFiber)J=!0;else{try{il=z.inject(J),Nn=z}catch{}J=!!z.checkDCE}}return J},wi.isAlreadyRendering=function(){return!1},wi.observeVisibleRects=function(J,z,se,re){if(!Qa)throw Error(I(363));J=Br(J,z);var de=Vc(J,se,re).disconnect;return{disconnect:function(){de()}}},wi.shouldError=function(){return null},wi.shouldSuspend=function(){return!1},wi.startHostTransition=function(J,z,se,re){if(J.tag!==5)throw Error(I(476));var de=Za(J).queue;sg(J,de,z,Ca,se===null?C:function(){var Ce=Za(J).next.queue;return fr(J,Ce,{},ns()),se(re)})},wi.updateContainer=function(J,z,se,re){var de=z.current,Ce=ns();return Bo(de,Ce,J,z,se,re),Ce},wi.updateContainerSync=function(J,z,se,re){return z.tag===0&&Xr(),Bo(z.current,2,J,z,se,re),2},wi},u.exports.default=u.exports,Object.defineProperty(u.exports,"__esModule",{value:!0})}(reactReconciler_production)),reactReconciler_production.exports}var hasRequiredReactReconciler;function requireReactReconciler(){return hasRequiredReactReconciler||(hasRequiredReactReconciler=1,reactReconciler.exports=requireReactReconciler_production()),reactReconciler.exports}var reactReconcilerExports=requireReactReconciler();const Reconciler=getDefaultExportFromCjs(reactReconcilerExports);var schedulerExports=requireScheduler();function i$1(u,n,d){if(!u)return;if(d(u)===!0)return u;let C=n?u.return:u.child;for(;C;){const I=i$1(C,n,d);if(I)return I;C=n?null:C.sibling}}function l(u){try{return Object.defineProperties(u,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return u}}const a$2=l(reactExports.createContext(null));let m$1=class extends reactExports.Component{render(){return reactExports.createElement(a$2.Provider,{value:this._reactInternals},this.props.children)}};function c$2(){const u=reactExports.useContext(a$2);if(u===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const n=reactExports.useId();return reactExports.useMemo(()=>{for(const d of[u,u==null?void 0:u.alternate]){if(!d)continue;const C=i$1(d,!1,I=>{let f=I.memoizedState;for(;f;){if(f.memoizedState===n)return!0;f=f.next}});if(C)return C}},[u,n])}const p=Symbol.for("react.context"),b$2=u=>u!==null&&typeof u=="object"&&"$$typeof"in u&&u.$$typeof===p;function h(){const u=c$2(),[n]=reactExports.useState(()=>new Map);n.clear();let d=u;for(;d;){const C=d.type;b$2(C)&&C!==a$2&&!n.has(C)&&n.set(C,reactExports.use(l(C))),d=d.return}return n}function x(){const u=h();return reactExports.useMemo(()=>Array.from(u.keys()).reduce((n,d)=>C=>reactExports.createElement(n,null,reactExports.createElement(d.Provider,{...C,value:u.get(d)})),n=>reactExports.createElement(m$1,{...n})),[u])}function findInitialRoot(u){let n=u.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const isOrthographicCamera=u=>u&&u.isOrthographicCamera,isRef=u=>u&&u.hasOwnProperty("current"),isColorRepresentation=u=>u!=null&&(typeof u=="string"||typeof u=="number"||u.isColor),useIsomorphicLayoutEffect=((u,n)=>typeof window<"u"&&(((u=window.document)==null?void 0:u.createElement)||((n=window.navigator)==null?void 0:n.product)==="ReactNative"))()?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(u){const n=reactExports.useRef(u);return useIsomorphicLayoutEffect(()=>void(n.current=u),[u]),n}function useBridge(){const u=c$2(),n=x();return reactExports.useMemo(()=>({children:d})=>{const I=!!i$1(u,!0,f=>f.type===reactExports.StrictMode)?reactExports.StrictMode:reactExports.Fragment;return jsxRuntimeExports.jsx(I,{children:jsxRuntimeExports.jsx(n,{children:d})})},[u,n])}function Block({set:u}){return useIsomorphicLayoutEffect(()=>(u(new Promise(()=>null)),()=>u(!1)),[u]),null}const ErrorBoundary=(u=>(u=class extends reactExports.Component{constructor(...d){super(...d),this.state={error:!1}}componentDidCatch(d){this.props.set(d)}render(){return this.state.error?null:this.props.children}},u.getDerivedStateFromError=()=>({error:!0}),u))();function calculateDpr(u){var n;const d=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(u)?Math.min(Math.max(u[0],d),u[1]):u}function getRootState(u){var n;return(n=u.__r3f)==null?void 0:n.root.getState()}const is={obj:u=>u===Object(u)&&!is.arr(u)&&typeof u!="function",fun:u=>typeof u=="function",str:u=>typeof u=="string",num:u=>typeof u=="number",boo:u=>typeof u=="boolean",und:u=>u===void 0,nul:u=>u===null,arr:u=>Array.isArray(u),equ(u,n,{arrays:d="shallow",objects:C="reference",strict:I=!0}={}){if(typeof u!=typeof n||!!u!=!!n)return!1;if(is.str(u)||is.num(u)||is.boo(u))return u===n;const f=is.obj(u);if(f&&C==="reference")return u===n;const y=is.arr(u);if(y&&d==="reference")return u===n;if((y||f)&&u===n)return!0;let B;for(B in u)if(!(B in n))return!1;if(f&&d==="shallow"&&C==="shallow"){for(B in I?n:u)if(!is.equ(u[B],n[B],{strict:I,objects:"reference"}))return!1}else for(B in I?n:u)if(u[B]!==n[B])return!1;if(is.und(B)){if(y&&u.length===0&&n.length===0||f&&Object.keys(u).length===0&&Object.keys(n).length===0)return!0;if(u!==n)return!1}return!0}};function dispose(u){u.type!=="Scene"&&(u.dispose==null||u.dispose());for(const n in u){const d=u[n];(d==null?void 0:d.type)!=="Scene"&&(d==null||d.dispose==null||d.dispose())}}const REACT_INTERNAL_PROPS=["children","key","ref"];function getInstanceProps(u){const n={};for(const d in u)REACT_INTERNAL_PROPS.includes(d)||(n[d]=u[d]);return n}function prepare$1(u,n,d,C){const I=u;let f=I==null?void 0:I.__r3f;return f||(f={root:n,type:d,parent:null,children:[],props:getInstanceProps(C),object:I,eventCount:0,handlers:{},isHidden:!1},I&&(I.__r3f=f)),f}function resolve(u,n){let d=u[n];if(!n.includes("-"))return{root:u,key:n,target:d};d=u;for(const I of n.split("-")){var C;n=I,u=d,d=(C=d)==null?void 0:C[n]}return{root:u,key:n,target:d}}const INDEX_REGEX=/-\d+$/;function attach(u,n){if(is.str(n.props.attach)){if(INDEX_REGEX.test(n.props.attach)){const I=n.props.attach.replace(INDEX_REGEX,""),{root:f,key:y}=resolve(u.object,I);Array.isArray(f[y])||(f[y]=[])}const{root:d,key:C}=resolve(u.object,n.props.attach);n.previousAttach=d[C],d[C]=n.object}else is.fun(n.props.attach)&&(n.previousAttach=n.props.attach(u.object,n.object))}function detach(u,n){if(is.str(n.props.attach)){const{root:d,key:C}=resolve(u.object,n.props.attach),I=n.previousAttach;I===void 0?delete d[C]:d[C]=I}else n.previousAttach==null||n.previousAttach(u.object,n.object);delete n.previousAttach}const RESERVED_PROPS=[...REACT_INTERNAL_PROPS,"args","dispose","attach","object","onUpdate","dispose"],MEMOIZED_PROTOTYPES=new Map;function getMemoizedPrototype(u){let n=MEMOIZED_PROTOTYPES.get(u.constructor);try{n||(n=new u.constructor,MEMOIZED_PROTOTYPES.set(u.constructor,n))}catch{}return n}function diffProps(u,n){const d={};for(const C in n)if(!RESERVED_PROPS.includes(C)&&!is.equ(n[C],u.props[C])){d[C]=n[C];for(const I in n)I.startsWith(`${C}-`)&&(d[I]=n[I])}for(const C in u.props){if(RESERVED_PROPS.includes(C)||n.hasOwnProperty(C))continue;const{root:I,key:f}=resolve(u.object,C);if(I.constructor&&I.constructor.length===0){const y=getMemoizedPrototype(I);is.und(y)||(d[f]=y[f])}else d[f]=0}return d}const colorMaps=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],EVENT_REGEX=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function applyProps(u,n){var d;const C=u.__r3f,I=C&&findInitialRoot(C).getState(),f=C==null?void 0:C.eventCount;for(const B in n){let _=n[B];if(RESERVED_PROPS.includes(B))continue;if(C&&EVENT_REGEX.test(B)){typeof _=="function"?C.handlers[B]=_:delete C.handlers[B],C.eventCount=Object.keys(C.handlers).length;continue}if(_===void 0)continue;let{root:Z,key:M,target:V}=resolve(u,B);if(V instanceof Layers&&_ instanceof Layers)V.mask=_.mask;else if(V instanceof Color&&isColorRepresentation(_))V.set(_);else if(V!==null&&typeof V=="object"&&typeof V.set=="function"&&typeof V.copy=="function"&&_!=null&&_.constructor&&V.constructor===_.constructor)V.copy(_);else if(V!==null&&typeof V=="object"&&typeof V.set=="function"&&Array.isArray(_))typeof V.fromArray=="function"?V.fromArray(_):V.set(..._);else if(V!==null&&typeof V=="object"&&typeof V.set=="function"&&typeof _=="number")typeof V.setScalar=="function"?V.setScalar(_):V.set(_);else{var y;Z[M]=_,I&&!I.linear&&colorMaps.includes(M)&&(y=Z[M])!=null&&y.isTexture&&Z[M].format===RGBAFormat&&Z[M].type===UnsignedByteType&&(Z[M].colorSpace=SRGBColorSpace)}}if(C!=null&&C.parent&&I!=null&&I.internal&&(d=C.object)!=null&&d.isObject3D&&f!==C.eventCount){const B=C.object,_=I.internal.interaction.indexOf(B);_>-1&&I.internal.interaction.splice(_,1),C.eventCount&&B.raycast!==null&&I.internal.interaction.push(B)}return C&&C.props.attach===void 0&&(C.object.isBufferGeometry?C.props.attach="geometry":C.object.isMaterial&&(C.props.attach="material")),C&&invalidateInstance(C),u}function invalidateInstance(u){var n;if(!u.parent)return;u.props.onUpdate==null||u.props.onUpdate(u.object);const d=(n=u.root)==null||n.getState==null?void 0:n.getState();d&&d.internal.frames===0&&d.invalidate()}function updateCamera(u,n){u.manual||(isOrthographicCamera(u)?(u.left=n.width/-2,u.right=n.width/2,u.top=n.height/2,u.bottom=n.height/-2):u.aspect=n.width/n.height,u.updateProjectionMatrix())}const isObject3D=u=>u==null?void 0:u.isObject3D;function makeId(u){return(u.eventObject||u.object).uuid+"/"+u.index+u.instanceId}function releaseInternalPointerCapture(u,n,d,C){const I=d.get(n);I&&(d.delete(n),d.size===0&&(u.delete(C),I.target.releasePointerCapture(C)))}function removeInteractivity(u,n){const{internal:d}=u.getState();d.interaction=d.interaction.filter(C=>C!==n),d.initialHits=d.initialHits.filter(C=>C!==n),d.hovered.forEach((C,I)=>{(C.eventObject===n||C.object===n)&&d.hovered.delete(I)}),d.capturedMap.forEach((C,I)=>{releaseInternalPointerCapture(d.capturedMap,n,C,I)})}function createEvents(u){function n(_){const{internal:Z}=u.getState(),M=_.offsetX-Z.initialClick[0],V=_.offsetY-Z.initialClick[1];return Math.round(Math.sqrt(M*M+V*V))}function d(_){return _.filter(Z=>["Move","Over","Enter","Out","Leave"].some(M=>{var V;return(V=Z.__r3f)==null?void 0:V.handlers["onPointer"+M]}))}function C(_,Z){const M=u.getState(),V=new Set,T=[],H=Z?Z(M.internal.interaction):M.internal.interaction;for(let U=0;U<H.length;U++){const ee=getRootState(H[U]);ee&&(ee.raycaster.camera=void 0)}M.previousRoot||M.events.compute==null||M.events.compute(_,M);function F(U){const ee=getRootState(U);if(!ee||!ee.events.enabled||ee.raycaster.camera===null)return[];if(ee.raycaster.camera===void 0){var Q;ee.events.compute==null||ee.events.compute(_,ee,(Q=ee.previousRoot)==null?void 0:Q.getState()),ee.raycaster.camera===void 0&&(ee.raycaster.camera=null)}return ee.raycaster.camera?ee.raycaster.intersectObject(U,!0):[]}let O=H.flatMap(F).sort((U,ee)=>{const Q=getRootState(U.object),ie=getRootState(ee.object);return!Q||!ie?U.distance-ee.distance:ie.events.priority-Q.events.priority||U.distance-ee.distance}).filter(U=>{const ee=makeId(U);return V.has(ee)?!1:(V.add(ee),!0)});M.events.filter&&(O=M.events.filter(O,M));for(const U of O){let ee=U.object;for(;ee;){var $;($=ee.__r3f)!=null&&$.eventCount&&T.push({...U,eventObject:ee}),ee=ee.parent}}if("pointerId"in _&&M.internal.capturedMap.has(_.pointerId))for(let U of M.internal.capturedMap.get(_.pointerId).values())V.has(makeId(U.intersection))||T.push(U.intersection);return T}function I(_,Z,M,V){if(_.length){const T={stopped:!1};for(const H of _){let F=getRootState(H.object);if(F||H.object.traverseAncestors(O=>{const $=getRootState(O);if($)return F=$,!1}),F){const{raycaster:O,pointer:$,camera:U,internal:ee}=F,Q=new Vector3($.x,$.y,0).unproject(U),ie=ge=>{var he,Ie;return(he=(Ie=ee.capturedMap.get(ge))==null?void 0:Ie.has(H.eventObject))!=null?he:!1},ne=ge=>{const he={intersection:H,target:Z.target};ee.capturedMap.has(ge)?ee.capturedMap.get(ge).set(H.eventObject,he):ee.capturedMap.set(ge,new Map([[H.eventObject,he]])),Z.target.setPointerCapture(ge)},le=ge=>{const he=ee.capturedMap.get(ge);he&&releaseInternalPointerCapture(ee.capturedMap,H.eventObject,he,ge)};let ae={};for(let ge in Z){let he=Z[ge];typeof he!="function"&&(ae[ge]=he)}let ce={...H,...ae,pointer:$,intersections:_,stopped:T.stopped,delta:M,unprojectedPoint:Q,ray:O.ray,camera:U,stopPropagation(){const ge="pointerId"in Z&&ee.capturedMap.get(Z.pointerId);if((!ge||ge.has(H.eventObject))&&(ce.stopped=T.stopped=!0,ee.hovered.size&&Array.from(ee.hovered.values()).find(he=>he.eventObject===H.eventObject))){const he=_.slice(0,_.indexOf(H));f([...he,H])}},target:{hasPointerCapture:ie,setPointerCapture:ne,releasePointerCapture:le},currentTarget:{hasPointerCapture:ie,setPointerCapture:ne,releasePointerCapture:le},nativeEvent:Z};if(V(ce),T.stopped===!0)break}}}return _}function f(_){const{internal:Z}=u.getState();for(const M of Z.hovered.values())if(!_.length||!_.find(V=>V.object===M.object&&V.index===M.index&&V.instanceId===M.instanceId)){const T=M.eventObject.__r3f;if(Z.hovered.delete(makeId(M)),T!=null&&T.eventCount){const H=T.handlers,F={...M,intersections:_};H.onPointerOut==null||H.onPointerOut(F),H.onPointerLeave==null||H.onPointerLeave(F)}}}function y(_,Z){for(let M=0;M<Z.length;M++){const V=Z[M].__r3f;V==null||V.handlers.onPointerMissed==null||V.handlers.onPointerMissed(_)}}function B(_){switch(_){case"onPointerLeave":case"onPointerCancel":return()=>f([]);case"onLostPointerCapture":return Z=>{const{internal:M}=u.getState();"pointerId"in Z&&M.capturedMap.has(Z.pointerId)&&requestAnimationFrame(()=>{M.capturedMap.has(Z.pointerId)&&(M.capturedMap.delete(Z.pointerId),f([]))})}}return function(M){const{onPointerMissed:V,internal:T}=u.getState();T.lastEvent.current=M;const H=_==="onPointerMove",F=_==="onClick"||_==="onContextMenu"||_==="onDoubleClick",$=C(M,H?d:void 0),U=F?n(M):0;_==="onPointerDown"&&(T.initialClick=[M.offsetX,M.offsetY],T.initialHits=$.map(Q=>Q.eventObject)),F&&!$.length&&U<=2&&(y(M,T.interaction),V&&V(M)),H&&f($);function ee(Q){const ie=Q.eventObject,ne=ie.__r3f;if(!(ne!=null&&ne.eventCount))return;const le=ne.handlers;if(H){if(le.onPointerOver||le.onPointerEnter||le.onPointerOut||le.onPointerLeave){const ae=makeId(Q),ce=T.hovered.get(ae);ce?ce.stopped&&Q.stopPropagation():(T.hovered.set(ae,Q),le.onPointerOver==null||le.onPointerOver(Q),le.onPointerEnter==null||le.onPointerEnter(Q))}le.onPointerMove==null||le.onPointerMove(Q)}else{const ae=le[_];ae?(!F||T.initialHits.includes(ie))&&(y(M,T.interaction.filter(ce=>!T.initialHits.includes(ce))),ae(Q)):F&&T.initialHits.includes(ie)&&y(M,T.interaction.filter(ce=>!T.initialHits.includes(ce)))}}I($,M,U,ee)}}return{handlePointer:B}}const isRenderer=u=>!!(u!=null&&u.render),context=reactExports.createContext(null),createStore=(u,n)=>{const d=createWithEqualityFn((B,_)=>{const Z=new Vector3,M=new Vector3,V=new Vector3;function T(U=_().camera,ee=M,Q=_().size){const{width:ie,height:ne,top:le,left:ae}=Q,ce=ie/ne;ee.isVector3?V.copy(ee):V.set(...ee);const ge=U.getWorldPosition(Z).distanceTo(V);if(isOrthographicCamera(U))return{width:ie/U.zoom,height:ne/U.zoom,top:le,left:ae,factor:1,distance:ge,aspect:ce};{const he=U.fov*Math.PI/180,Ie=2*Math.tan(he/2)*ge,fe=Ie*(ie/ne);return{width:fe,height:Ie,top:le,left:ae,factor:ie/fe,distance:ge,aspect:ce}}}let H;const F=U=>B(ee=>({performance:{...ee.performance,current:U}})),O=new Vector2;return{set:B,get:_,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(U=1)=>u(_(),U),advance:(U,ee)=>n(U,ee,_()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:O,mouse:O,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const U=_();H&&clearTimeout(H),U.performance.current!==U.performance.min&&F(U.performance.min),H=setTimeout(()=>F(_().performance.max),U.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:T},setEvents:U=>B(ee=>({...ee,events:{...ee.events,...U}})),setSize:(U,ee,Q=0,ie=0)=>{const ne=_().camera,le={width:U,height:ee,top:Q,left:ie};B(ae=>({size:le,viewport:{...ae.viewport,...T(ne,M,le)}}))},setDpr:U=>B(ee=>{const Q=calculateDpr(U);return{viewport:{...ee.viewport,dpr:Q,initialDpr:ee.viewport.initialDpr||Q}}}),setFrameloop:(U="always")=>{const ee=_().clock;ee.stop(),ee.elapsedTime=0,U!=="never"&&(ee.start(),ee.elapsedTime=0),B(()=>({frameloop:U}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:reactExports.createRef(),active:!1,frames:0,priority:0,subscribe:(U,ee,Q)=>{const ie=_().internal;return ie.priority=ie.priority+(ee>0?1:0),ie.subscribers.push({ref:U,priority:ee,store:Q}),ie.subscribers=ie.subscribers.sort((ne,le)=>ne.priority-le.priority),()=>{const ne=_().internal;ne!=null&&ne.subscribers&&(ne.priority=ne.priority-(ee>0?1:0),ne.subscribers=ne.subscribers.filter(le=>le.ref!==U))}}}}}),C=d.getState();let I=C.size,f=C.viewport.dpr,y=C.camera;return d.subscribe(()=>{const{camera:B,size:_,viewport:Z,gl:M,set:V}=d.getState();if(_.width!==I.width||_.height!==I.height||Z.dpr!==f){I=_,f=Z.dpr,updateCamera(B,_),Z.dpr>0&&M.setPixelRatio(Z.dpr);const T=typeof HTMLCanvasElement<"u"&&M.domElement instanceof HTMLCanvasElement;M.setSize(_.width,_.height,T)}B!==y&&(y=B,V(T=>({viewport:{...T.viewport,...T.viewport.getCurrentViewport(B)}})))}),d.subscribe(B=>u(B)),d};function useStore(){const u=reactExports.useContext(context);if(!u)throw new Error("R3F: Hooks can only be used within the Canvas component!");return u}function useThree(u=d=>d,n){return useStore()(u,n)}function useFrame(u,n=0){const d=useStore(),C=d.getState().internal.subscribe,I=useMutableCallback(u);return useIsomorphicLayoutEffect(()=>C(I,n,d),[n,C,d]),null}function createReconciler(u){const n=Reconciler(u);return n.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version}),n}const NoEventPriority=0,catalogue={},PREFIX_REGEX=/^three(?=[A-Z])/,toPascalCase=u=>`${u[0].toUpperCase()}${u.slice(1)}`;let i=0;const isConstructor=u=>typeof u=="function";function extend(u){if(isConstructor(u)){const n=`${i++}`;return catalogue[n]=u,n}else Object.assign(catalogue,u)}function validateInstance(u,n){const d=toPascalCase(u),C=catalogue[d];if(u!=="primitive"&&!C)throw new Error(`R3F: ${d} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(u==="primitive"&&!n.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(n.args!==void 0&&!Array.isArray(n.args))throw new Error("R3F: The args prop must be an array!")}function createInstance(u,n,d){var C;return u=toPascalCase(u)in catalogue?u:u.replace(PREFIX_REGEX,""),validateInstance(u,n),u==="primitive"&&(C=n.object)!=null&&C.__r3f&&delete n.object.__r3f,prepare$1(n.object,d,u,n)}function hideInstance(u){if(!u.isHidden){var n;u.props.attach&&(n=u.parent)!=null&&n.object?detach(u.parent,u):isObject3D(u.object)&&(u.object.visible=!1),u.isHidden=!0,invalidateInstance(u)}}function unhideInstance(u){if(u.isHidden){var n;u.props.attach&&(n=u.parent)!=null&&n.object?attach(u.parent,u):isObject3D(u.object)&&u.props.visible!==!1&&(u.object.visible=!0),u.isHidden=!1,invalidateInstance(u)}}function handleContainerEffects(u,n,d){const C=n.root.getState();if(!(!u.parent&&u.object!==C.scene)){if(!n.object){var I,f;const y=catalogue[toPascalCase(n.type)];n.object=(I=n.props.object)!=null?I:new y(...(f=n.props.args)!=null?f:[]),n.object.__r3f=n}if(applyProps(n.object,n.props),n.props.attach)attach(u,n);else if(isObject3D(n.object)&&isObject3D(u.object)){const y=u.object.children.indexOf(d==null?void 0:d.object);if(d&&y!==-1){const B=u.object.children.indexOf(n.object);if(B!==-1){u.object.children.splice(B,1);const _=B<y?y-1:y;u.object.children.splice(_,0,n.object)}else n.object.parent=u.object,u.object.children.splice(y,0,n.object),n.object.dispatchEvent({type:"added"}),u.object.dispatchEvent({type:"childadded",child:n.object})}else u.object.add(n.object)}for(const y of n.children)handleContainerEffects(n,y);invalidateInstance(n)}}function appendChild(u,n){n&&(n.parent=u,u.children.push(n),handleContainerEffects(u,n))}function insertBefore(u,n,d){if(!n||!d)return;n.parent=u;const C=u.children.indexOf(d);C!==-1?u.children.splice(C,0,n):u.children.push(n),handleContainerEffects(u,n,d)}function disposeOnIdle(u){if(typeof u.dispose=="function"){const n=()=>{try{u.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?n():schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,n)}}function removeChild(u,n,d){if(!n)return;n.parent=null;const C=u.children.indexOf(n);C!==-1&&u.children.splice(C,1),n.props.attach?detach(u,n):isObject3D(n.object)&&isObject3D(u.object)&&(u.object.remove(n.object),removeInteractivity(findInitialRoot(n),n.object));const I=n.props.dispose!==null&&d!==!1;for(let f=n.children.length-1;f>=0;f--){const y=n.children[f];removeChild(n,y,I)}n.children.length=0,delete n.object.__r3f,I&&n.type!=="primitive"&&n.object.type!=="Scene"&&disposeOnIdle(n.object),d===void 0&&invalidateInstance(n)}function setFiberRef(u,n){for(const d of[u,u.alternate])if(d!==null)if(typeof d.ref=="function"){d.refCleanup==null||d.refCleanup();const C=d.ref(n);typeof C=="function"&&(d.refCleanup=C)}else d.ref&&(d.ref.current=n)}const reconstructed=[];function swapInstances(){for(const[d]of reconstructed){const C=d.parent;if(C){d.props.attach?detach(C,d):isObject3D(d.object)&&isObject3D(C.object)&&C.object.remove(d.object);for(const I of d.children)I.props.attach?detach(d,I):isObject3D(I.object)&&isObject3D(d.object)&&d.object.remove(I.object)}d.isHidden&&unhideInstance(d),d.object.__r3f&&delete d.object.__r3f,d.type!=="primitive"&&disposeOnIdle(d.object)}for(const[d,C,I]of reconstructed){d.props=C;const f=d.parent;if(f){var u,n;const y=catalogue[toPascalCase(d.type)];d.object=(u=d.props.object)!=null?u:new y(...(n=d.props.args)!=null?n:[]),d.object.__r3f=d,setFiberRef(I,d.object),applyProps(d.object,d.props),d.props.attach?attach(f,d):isObject3D(d.object)&&isObject3D(f.object)&&f.object.add(d.object);for(const B of d.children)B.props.attach?attach(d,B):isObject3D(B.object)&&isObject3D(d.object)&&d.object.add(B.object);invalidateInstance(d)}}reconstructed.length=0}const handleTextInstance=()=>{},NO_CONTEXT={};let currentUpdatePriority=NoEventPriority;const NoFlags=0,Update=4,reconciler=createReconciler({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance,removeChild,appendChild,appendInitialChild:appendChild,insertBefore,appendChildToContainer(u,n){const d=u.getState().scene.__r3f;!n||!d||appendChild(d,n)},removeChildFromContainer(u,n){const d=u.getState().scene.__r3f;!n||!d||removeChild(d,n)},insertInContainerBefore(u,n,d){const C=u.getState().scene.__r3f;!n||!d||!C||insertBefore(C,n,d)},getRootHostContext:()=>NO_CONTEXT,getChildHostContext:()=>NO_CONTEXT,commitUpdate(u,n,d,C,I){var f,y,B;validateInstance(n,C);let _=!1;if((u.type==="primitive"&&d.object!==C.object||((f=C.args)==null?void 0:f.length)!==((y=d.args)==null?void 0:y.length)||(B=C.args)!=null&&B.some((M,V)=>{var T;return M!==((T=d.args)==null?void 0:T[V])}))&&(_=!0),_)reconstructed.push([u,{...C},I]);else{const M=diffProps(u,C);Object.keys(M).length&&(Object.assign(u.props,M),applyProps(u.object,M))}(I.sibling===null||(I.flags&Update)===NoFlags)&&swapInstances()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:u=>u==null?void 0:u.object,prepareForCommit:()=>null,preparePortalMount:u=>prepare$1(u.getState().scene,u,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance,unhideInstance,createTextInstance:handleTextInstance,hideTextInstance:handleTextInstance,unhideTextInstance:handleTextInstance,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:reactExports.createContext(null),setCurrentUpdatePriority(u){currentUpdatePriority=u},getCurrentUpdatePriority(){return currentUpdatePriority},resolveUpdatePriority(){var u;if(currentUpdatePriority!==NoEventPriority)return currentUpdatePriority;switch(typeof window<"u"&&((u=window.event)==null?void 0:u.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}},resetFormInstance(){}}),_roots=new Map,shallowLoose={objects:"shallow",strict:!1};function computeInitialSize(u,n){if(!n&&typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement&&u.parentElement){const{width:d,height:C,top:I,left:f}=u.parentElement.getBoundingClientRect();return{width:d,height:C,top:I,left:f}}else if(!n&&typeof OffscreenCanvas<"u"&&u instanceof OffscreenCanvas)return{width:u.width,height:u.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...n}}function createRoot(u){const n=_roots.get(u),d=n==null?void 0:n.fiber,C=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const I=typeof reportError=="function"?reportError:console.error,f=C||createStore(invalidate,advance),y=d||reconciler.createContainer(f,constantsExports.ConcurrentRoot,null,!1,null,"",I,I,I,null);n||_roots.set(u,{fiber:y,store:f});let B,_,Z=!1,M=null;return{async configure(V={}){let T;M=new Promise(Be=>T=Be);let{gl:H,size:F,scene:O,events:$,onCreated:U,shadows:ee=!1,linear:Q=!1,flat:ie=!1,legacy:ne=!1,orthographic:le=!1,frameloop:ae="always",dpr:ce=[1,2],performance:ge,raycaster:he,camera:Ie,onPointerMissed:fe}=V,me=f.getState(),Ge=me.gl;if(!me.gl){const Be={canvas:u,powerPreference:"high-performance",antialias:!0,alpha:!0},Ne=typeof H=="function"?await H(Be):H;isRenderer(Ne)?Ge=Ne:Ge=new WebGLRenderer({...Be,...H}),me.set({gl:Ge})}let Ze=me.raycaster;Ze||me.set({raycaster:Ze=new Raycaster});const{params:ye,...Ee}=he||{};if(is.equ(Ee,Ze,shallowLoose)||applyProps(Ze,{...Ee}),is.equ(ye,Ze.params,shallowLoose)||applyProps(Ze,{params:{...Ze.params,...ye}}),!me.camera||me.camera===_&&!is.equ(_,Ie,shallowLoose)){_=Ie;const Be=Ie==null?void 0:Ie.isCamera,Ne=Be?Ie:le?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);Be||(Ne.position.z=5,Ie&&(applyProps(Ne,Ie),Ne.manual||("aspect"in Ie||"left"in Ie||"right"in Ie||"bottom"in Ie||"top"in Ie)&&(Ne.manual=!0,Ne.updateProjectionMatrix())),!me.camera&&!(Ie!=null&&Ie.rotation)&&Ne.lookAt(0,0,0)),me.set({camera:Ne}),Ze.camera=Ne}if(!me.scene){let Be;O!=null&&O.isScene?(Be=O,prepare$1(Be,f,"",{})):(Be=new Scene,prepare$1(Be,f,"",{}),O&&applyProps(Be,O)),me.set({scene:Be})}$&&!me.events.handlers&&me.set({events:$(f)});const Ve=computeInitialSize(u,F);if(is.equ(Ve,me.size,shallowLoose)||me.setSize(Ve.width,Ve.height,Ve.top,Ve.left),ce&&me.viewport.dpr!==calculateDpr(ce)&&me.setDpr(ce),me.frameloop!==ae&&me.setFrameloop(ae),me.onPointerMissed||me.set({onPointerMissed:fe}),ge&&!is.equ(ge,me.performance,shallowLoose)&&me.set(Be=>({performance:{...Be.performance,...ge}})),!me.xr){var Ye;const Be=(Re,We)=>{const De=f.getState();De.frameloop!=="never"&&advance(Re,!0,De,We)},Ne=()=>{const Re=f.getState();Re.gl.xr.enabled=Re.gl.xr.isPresenting,Re.gl.xr.setAnimationLoop(Re.gl.xr.isPresenting?Be:null),Re.gl.xr.isPresenting||invalidate(Re)},Ae={connect(){const Re=f.getState().gl;Re.xr.addEventListener("sessionstart",Ne),Re.xr.addEventListener("sessionend",Ne)},disconnect(){const Re=f.getState().gl;Re.xr.removeEventListener("sessionstart",Ne),Re.xr.removeEventListener("sessionend",Ne)}};typeof((Ye=Ge.xr)==null?void 0:Ye.addEventListener)=="function"&&Ae.connect(),me.set({xr:Ae})}if(Ge.shadowMap){const Be=Ge.shadowMap.enabled,Ne=Ge.shadowMap.type;if(Ge.shadowMap.enabled=!!ee,is.boo(ee))Ge.shadowMap.type=PCFSoftShadowMap;else if(is.str(ee)){var be;const Ae={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};Ge.shadowMap.type=(be=Ae[ee])!=null?be:PCFSoftShadowMap}else is.obj(ee)&&Object.assign(Ge.shadowMap,ee);(Be!==Ge.shadowMap.enabled||Ne!==Ge.shadowMap.type)&&(Ge.shadowMap.needsUpdate=!0)}return ColorManagement.enabled=!ne,Z||(Ge.outputColorSpace=Q?LinearSRGBColorSpace:SRGBColorSpace,Ge.toneMapping=ie?NoToneMapping:ACESFilmicToneMapping),me.legacy!==ne&&me.set(()=>({legacy:ne})),me.linear!==Q&&me.set(()=>({linear:Q})),me.flat!==ie&&me.set(()=>({flat:ie})),H&&!is.fun(H)&&!isRenderer(H)&&!is.equ(H,Ge,shallowLoose)&&applyProps(Ge,H),B=U,Z=!0,T(),this},render(V){return!Z&&!M&&this.configure(),M.then(()=>{reconciler.updateContainer(jsxRuntimeExports.jsx(Provider,{store:f,children:V,onCreated:B,rootElement:u}),y,null,()=>{})}),f},unmount(){unmountComponentAtNode(u)}}}function Provider({store:u,children:n,onCreated:d,rootElement:C}){return useIsomorphicLayoutEffect(()=>{const I=u.getState();I.set(f=>({internal:{...f.internal,active:!0}})),d&&d(I),u.getState().events.connected||I.events.connect==null||I.events.connect(C)},[]),jsxRuntimeExports.jsx(context.Provider,{value:u,children:n})}function unmountComponentAtNode(u,n){const d=_roots.get(u),C=d==null?void 0:d.fiber;if(C){const I=d==null?void 0:d.store.getState();I&&(I.internal.active=!1),reconciler.updateContainer(null,C,null,()=>{I&&setTimeout(()=>{try{var f,y,B,_;I.events.disconnect==null||I.events.disconnect(),(f=I.gl)==null||(y=f.renderLists)==null||y.dispose==null||y.dispose(),(B=I.gl)==null||B.forceContextLoss==null||B.forceContextLoss(),(_=I.gl)!=null&&_.xr&&I.xr.disconnect(),dispose(I.scene),_roots.delete(u)}catch{}},500)})}}const globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;function run(u,n){if(u.size)for(const{callback:d}of u.values())d(n)}function flushGlobalEffects(u,n){switch(u){case"before":return run(globalEffects,n);case"after":return run(globalAfterEffects,n);case"tail":return run(globalTailEffects,n)}}let subscribers,subscription;function update(u,n,d){let C=n.clock.getDelta();n.frameloop==="never"&&typeof u=="number"&&(C=u-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=u),subscribers=n.internal.subscribers;for(let I=0;I<subscribers.length;I++)subscription=subscribers[I],subscription.ref.current(subscription.store.getState(),C,d);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}let running=!1,useFrameInProgress=!1,repeat,frame,state;function loop(u){frame=requestAnimationFrame(loop),running=!0,repeat=0,flushGlobalEffects("before",u),useFrameInProgress=!0;for(const d of _roots.values()){var n;state=d.store.getState(),state.internal.active&&(state.frameloop==="always"||state.internal.frames>0)&&!((n=state.gl.xr)!=null&&n.isPresenting)&&(repeat+=update(u,state))}if(useFrameInProgress=!1,flushGlobalEffects("after",u),repeat===0)return flushGlobalEffects("tail",u),running=!1,cancelAnimationFrame(frame)}function invalidate(u,n=1){var d;if(!u)return _roots.forEach(C=>invalidate(C.store.getState(),n));(d=u.gl.xr)!=null&&d.isPresenting||!u.internal.active||u.frameloop==="never"||(n>1?u.internal.frames=Math.min(60,u.internal.frames+n):useFrameInProgress?u.internal.frames=2:u.internal.frames=1,running||(running=!0,requestAnimationFrame(loop)))}function advance(u,n=!0,d,C){if(n&&flushGlobalEffects("before",u),d)update(u,d,C);else for(const I of _roots.values())update(u,I.store.getState());n&&flushGlobalEffects("after",u)}const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(u){const{handlePointer:n}=createEvents(u);return{priority:1,enabled:!0,compute(d,C,I){C.pointer.set(d.offsetX/C.size.width*2-1,-(d.offsetY/C.size.height)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((d,C)=>({...d,[C]:n(C)}),{}),update:()=>{var d;const{events:C,internal:I}=u.getState();(d=I.lastEvent)!=null&&d.current&&C.handlers&&C.handlers.onPointerMove(I.lastEvent.current)},connect:d=>{const{set:C,events:I}=u.getState();if(I.disconnect==null||I.disconnect(),C(f=>({events:{...f.events,connected:d}})),I.handlers)for(const f in I.handlers){const y=I.handlers[f],[B,_]=DOM_EVENTS[f];d.addEventListener(B,y,{passive:_})}},disconnect:()=>{const{set:d,events:C}=u.getState();if(C.connected){if(C.handlers)for(const I in C.handlers){const f=C.handlers[I],[y]=DOM_EVENTS[I];C.connected.removeEventListener(y,f)}d(I=>({events:{...I.events,connected:void 0}}))}}}}function g(u,n){let d;return(...C)=>{window.clearTimeout(d),d=window.setTimeout(()=>u(...C),n)}}function j({debounce:u,scroll:n,polyfill:d,offsetSize:C}={debounce:0,scroll:!1,offsetSize:!1}){const I=d||(typeof window>"u"?class{}:window.ResizeObserver);if(!I)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[f,y]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),B=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:f,orientationHandler:null}),_=u?typeof u=="number"?u:u.scroll:null,Z=u?typeof u=="number"?u:u.resize:null,M=reactExports.useRef(!1);reactExports.useEffect(()=>(M.current=!0,()=>void(M.current=!1)));const[V,T,H]=reactExports.useMemo(()=>{const U=()=>{if(!B.current.element)return;const{left:ee,top:Q,width:ie,height:ne,bottom:le,right:ae,x:ce,y:ge}=B.current.element.getBoundingClientRect(),he={left:ee,top:Q,width:ie,height:ne,bottom:le,right:ae,x:ce,y:ge};B.current.element instanceof HTMLElement&&C&&(he.height=B.current.element.offsetHeight,he.width=B.current.element.offsetWidth),Object.freeze(he),M.current&&!D(B.current.lastBounds,he)&&y(B.current.lastBounds=he)};return[U,Z?g(U,Z):U,_?g(U,_):U]},[y,C,_,Z]);function F(){B.current.scrollContainers&&(B.current.scrollContainers.forEach(U=>U.removeEventListener("scroll",H,!0)),B.current.scrollContainers=null),B.current.resizeObserver&&(B.current.resizeObserver.disconnect(),B.current.resizeObserver=null),B.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",B.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",B.current.orientationHandler))}function O(){B.current.element&&(B.current.resizeObserver=new I(H),B.current.resizeObserver.observe(B.current.element),n&&B.current.scrollContainers&&B.current.scrollContainers.forEach(U=>U.addEventListener("scroll",H,{capture:!0,passive:!0})),B.current.orientationHandler=()=>{H()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",B.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",B.current.orientationHandler))}const $=U=>{!U||U===B.current.element||(F(),B.current.element=U,B.current.scrollContainers=E(U),O())};return X(H,!!n),W(T),reactExports.useEffect(()=>{F(),O()},[n,H,T]),reactExports.useEffect(()=>F,[]),[$,f,V]}function W(u){reactExports.useEffect(()=>{const n=u;return window.addEventListener("resize",n),()=>void window.removeEventListener("resize",n)},[u])}function X(u,n){reactExports.useEffect(()=>{if(n){const d=u;return window.addEventListener("scroll",d,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",d,!0)}},[u,n])}function E(u){const n=[];if(!u||u===document.body)return n;const{overflow:d,overflowX:C,overflowY:I}=window.getComputedStyle(u);return[d,C,I].some(f=>f==="auto"||f==="scroll")&&n.push(u),[...n,...E(u.parentElement)]}const k=["x","y","top","bottom","left","right","width","height"],D=(u,n)=>k.every(d=>u[d]===n[d]);function CanvasImpl({ref:u,children:n,fallback:d,resize:C,style:I,gl:f,events:y=createPointerEvents,eventSource:B,eventPrefix:_,shadows:Z,linear:M,flat:V,legacy:T,orthographic:H,frameloop:F,dpr:O,performance:$,raycaster:U,camera:ee,scene:Q,onPointerMissed:ie,onCreated:ne,...le}){reactExports.useMemo(()=>extend(THREE),[]);const ae=useBridge(),[ce,ge]=j({scroll:!0,debounce:{scroll:50,resize:0},...C}),he=reactExports.useRef(null),Ie=reactExports.useRef(null);reactExports.useImperativeHandle(u,()=>he.current);const fe=useMutableCallback(ie),[me,Ge]=reactExports.useState(!1),[Ze,ye]=reactExports.useState(!1);if(me)throw me;if(Ze)throw Ze;const Ee=reactExports.useRef(null);useIsomorphicLayoutEffect(()=>{const Ye=he.current;if(ge.width>0&&ge.height>0&&Ye){Ee.current||(Ee.current=createRoot(Ye));async function be(){await Ee.current.configure({gl:f,scene:Q,events:y,shadows:Z,linear:M,flat:V,legacy:T,orthographic:H,frameloop:F,dpr:O,performance:$,raycaster:U,camera:ee,size:ge,onPointerMissed:(...Be)=>fe.current==null?void 0:fe.current(...Be),onCreated:Be=>{Be.events.connect==null||Be.events.connect(B?isRef(B)?B.current:B:Ie.current),_&&Be.setEvents({compute:(Ne,Ae)=>{const Re=Ne[_+"X"],We=Ne[_+"Y"];Ae.pointer.set(Re/Ae.size.width*2-1,-(We/Ae.size.height)*2+1),Ae.raycaster.setFromCamera(Ae.pointer,Ae.camera)}}),ne==null||ne(Be)}}),Ee.current.render(jsxRuntimeExports.jsx(ae,{children:jsxRuntimeExports.jsx(ErrorBoundary,{set:ye,children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Block,{set:Ge}),children:n??null})})}))}be()}}),reactExports.useEffect(()=>{const Ye=he.current;if(Ye)return()=>unmountComponentAtNode(Ye)},[]);const Ve=B?"none":"auto";return jsxRuntimeExports.jsx("div",{ref:Ie,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Ve,...I},...le,children:jsxRuntimeExports.jsx("div",{ref:ce,style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:he,style:{display:"block"},children:d})})})}function Canvas(u){return jsxRuntimeExports.jsx(m$1,{children:jsxRuntimeExports.jsx(CanvasImpl,{...u})})}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(n,d,C){return Function.prototype.apply.call(n,d,C)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:ReflectOwnKeys=function(n){return Object.getOwnPropertyNames(n)};function ProcessEmitWarning(u){console&&console.warn&&console.warn(u)}var NumberIsNaN=Number.isNaN||function(n){return n!==n};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(u){if(typeof u!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof u)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(u){if(typeof u!="number"||u<0||NumberIsNaN(u))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+u+".");defaultMaxListeners=u}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function _getMaxListeners(u){return u._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:u._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(n){for(var d=[],C=1;C<arguments.length;C++)d.push(arguments[C]);var I=n==="error",f=this._events;if(f!==void 0)I=I&&f.error===void 0;else if(!I)return!1;if(I){var y;if(d.length>0&&(y=d[0]),y instanceof Error)throw y;var B=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw B.context=y,B}var _=f[n];if(_===void 0)return!1;if(typeof _=="function")ReflectApply(_,this,d);else for(var Z=_.length,M=arrayClone(_,Z),C=0;C<Z;++C)ReflectApply(M[C],this,d);return!0};function _addListener(u,n,d,C){var I,f,y;if(checkListener(d),f=u._events,f===void 0?(f=u._events=Object.create(null),u._eventsCount=0):(f.newListener!==void 0&&(u.emit("newListener",n,d.listener?d.listener:d),f=u._events),y=f[n]),y===void 0)y=f[n]=d,++u._eventsCount;else if(typeof y=="function"?y=f[n]=C?[d,y]:[y,d]:C?y.unshift(d):y.push(d),I=_getMaxListeners(u),I>0&&y.length>I&&!y.warned){y.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=u,B.type=n,B.count=y.length,ProcessEmitWarning(B)}return u}EventEmitter$1.prototype.addListener=function(n,d){return _addListener(this,n,d,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(n,d){return _addListener(this,n,d,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(u,n,d){var C={fired:!1,wrapFn:void 0,target:u,type:n,listener:d},I=onceWrapper.bind(C);return I.listener=d,C.wrapFn=I,I}EventEmitter$1.prototype.once=function(n,d){return checkListener(d),this.on(n,_onceWrap(this,n,d)),this};EventEmitter$1.prototype.prependOnceListener=function(n,d){return checkListener(d),this.prependListener(n,_onceWrap(this,n,d)),this};EventEmitter$1.prototype.removeListener=function(n,d){var C,I,f,y,B;if(checkListener(d),I=this._events,I===void 0)return this;if(C=I[n],C===void 0)return this;if(C===d||C.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete I[n],I.removeListener&&this.emit("removeListener",n,C.listener||d));else if(typeof C!="function"){for(f=-1,y=C.length-1;y>=0;y--)if(C[y]===d||C[y].listener===d){B=C[y].listener,f=y;break}if(f<0)return this;f===0?C.shift():spliceOne(C,f),C.length===1&&(I[n]=C[0]),I.removeListener!==void 0&&this.emit("removeListener",n,B||d)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(n){var d,C,I;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[n]),this;if(arguments.length===0){var f=Object.keys(C),y;for(I=0;I<f.length;++I)y=f[I],y!=="removeListener"&&this.removeAllListeners(y);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=C[n],typeof d=="function")this.removeListener(n,d);else if(d!==void 0)for(I=d.length-1;I>=0;I--)this.removeListener(n,d[I]);return this};function _listeners(u,n,d){var C=u._events;if(C===void 0)return[];var I=C[n];return I===void 0?[]:typeof I=="function"?d?[I.listener||I]:[I]:d?unwrapListeners(I):arrayClone(I,I.length)}EventEmitter$1.prototype.listeners=function(n){return _listeners(this,n,!0)};EventEmitter$1.prototype.rawListeners=function(n){return _listeners(this,n,!1)};EventEmitter$1.listenerCount=function(u,n){return typeof u.listenerCount=="function"?u.listenerCount(n):listenerCount.call(u,n)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(u){var n=this._events;if(n!==void 0){var d=n[u];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(u,n){for(var d=new Array(n),C=0;C<n;++C)d[C]=u[C];return d}function spliceOne(u,n){for(;n+1<u.length;n++)u[n]=u[n+1];u.pop()}function unwrapListeners(u){for(var n=new Array(u.length),d=0;d<n.length;++d)n[d]=u[d].listener||u[d];return n}function once(u,n){return new Promise(function(d,C){function I(y){u.removeListener(n,f),C(y)}function f(){typeof u.removeListener=="function"&&u.removeListener("error",I),d([].slice.call(arguments))}eventTargetAgnosticAddListener(u,n,f,{once:!0}),n!=="error"&&addErrorHandlerIfEventEmitter(u,I,{once:!0})})}function addErrorHandlerIfEventEmitter(u,n,d){typeof u.on=="function"&&eventTargetAgnosticAddListener(u,"error",n,d)}function eventTargetAgnosticAddListener(u,n,d,C){if(typeof u.on=="function")C.once?u.once(n,d):u.on(n,d);else if(typeof u.addEventListener=="function")u.addEventListener(n,function I(f){C.once&&u.removeEventListener(n,I),d(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof u)}var EventEmitter$1$1=events.exports;function decodeBase64(u,n){var d=atob(u);if(n){for(var C=new Uint8Array(d.length),I=0,f=d.length;I<f;++I)C[I]=d.charCodeAt(I);return String.fromCharCode.apply(null,new Uint16Array(C.buffer))}return d}function createURL(u,n,d){var C=n===void 0?null:n,I=d===void 0?!1:d,f=decodeBase64(u,I),y=f.indexOf(`
`,10)+1,B=f.substring(y)+(C?"//# sourceMappingURL="+C:""),_=new Blob([B],{type:"application/javascript"});return URL.createObjectURL(_)}function createBase64WorkerFactory(u,n,d){var C;return function(f){return C=C||createURL(u,n,d),new Worker(C,f)}}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class CannonWorkerAPI extends EventEmitter$1$1{constructor(d){let{allowSleep:C=!1,axisIndex:I=0,broadphase:f="Naive",defaultContactMaterial:y={contactEquationStiffness:1e6},frictionGravity:B=null,gravity:_=[0,-9.81,0],iterations:Z=5,quatNormalizeFast:M=!1,quatNormalizeSkip:V=0,size:T=1e3,solver:H="GS",tolerance:F=.001}=d;super();Bd(this,"messageQueue",[]);Bd(this,"worker",null);this.config={allowSleep:C,axisIndex:I,broadphase:f,defaultContactMaterial:y,frictionGravity:B,gravity:_,iterations:Z,quatNormalizeFast:M,quatNormalizeSkip:V,size:T,solver:H,tolerance:F},this.buffers={positions:new Float32Array(T*3),quaternions:new Float32Array(T*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(d){this.config.axisIndex=d,this.postMessage({op:"setAxisIndex",props:d})}get broadphase(){return this.config.broadphase}set broadphase(d){this.config.broadphase=d,this.postMessage({op:"setBroadphase",props:d})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(d){this.config.frictionGravity=d,this.postMessage({op:"setFrictionGravity",props:d})}get gravity(){return this.config.gravity}set gravity(d){this.config.gravity=d,this.postMessage({op:"setGravity",props:d})}get iterations(){return this.config.iterations}set iterations(d){this.config.iterations=d,this.postMessage({op:"setIterations",props:d})}get tolerance(){return this.config.tolerance}set tolerance(d){this.config.tolerance=d,this.postMessage({op:"setTolerance",props:d})}addBodies(d){let{props:C,type:I,uuid:f}=d;this.postMessage({op:"addBodies",props:C,type:I,uuid:f})}addConstraint(d){let{props:[C,I,f],type:y,uuid:B}=d;this.postMessage({op:"addConstraint",props:[C,I,f],type:y,uuid:B})}addContactMaterial(d){let{props:C,uuid:I}=d;this.postMessage({op:"addContactMaterial",props:C,uuid:I})}addRay(d){let{props:C,uuid:I}=d;this.postMessage({op:"addRay",props:C,uuid:I})}addRaycastVehicle(d){let{props:[C,I,f,y,B,_],uuid:Z}=d;this.postMessage({op:"addRaycastVehicle",props:[C,I,f,y,B,_],uuid:Z})}addSpring(d){let{props:[C,I,f],uuid:y}=d;this.postMessage({op:"addSpring",props:[C,I,f],uuid:y})}applyForce(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyForce",props:C,uuid:I})}applyImpulse(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyImpulse",props:C,uuid:I})}applyLocalForce(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyLocalForce",props:C,uuid:I})}applyLocalImpulse(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyLocalImpulse",props:C,uuid:I})}applyRaycastVehicleEngineForce(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyRaycastVehicleEngineForce",props:C,uuid:I})}applyTorque(d){let{props:C,uuid:I}=d;this.postMessage({op:"applyTorque",props:C,uuid:I})}connect(){this.worker=new WorkerFactory,this.worker.onmessage=d=>{if(d.data.op==="frame"){this.buffers.positions=d.data.positions,this.buffers.quaternions=d.data.quaternions,this.emit(d.data.op,d.data);return}this.emit(d.data.type,d.data)};for(const d of this.messageQueue)this.worker.postMessage(d);this.messageQueue.length=0}disableConstraint(d){let{uuid:C}=d;this.postMessage({op:"disableConstraint",uuid:C})}disableConstraintMotor(d){let{uuid:C}=d;this.postMessage({op:"disableConstraintMotor",uuid:C})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(d){let{uuid:C}=d;this.postMessage({op:"enableConstraint",uuid:C})}enableConstraintMotor(d){let{uuid:C}=d;this.postMessage({op:"enableConstraintMotor",uuid:C})}init(){const{allowSleep:d,axisIndex:C,broadphase:I,defaultContactMaterial:f,frictionGravity:y,gravity:B,iterations:_,quatNormalizeFast:Z,quatNormalizeSkip:M,solver:V,tolerance:T}=this.config;this.postMessage({op:"init",props:{allowSleep:d,axisIndex:C,broadphase:I,defaultContactMaterial:f,frictionGravity:y,gravity:B,iterations:_,quatNormalizeFast:Z,quatNormalizeSkip:M,solver:V,tolerance:T}})}removeBodies(d){let{uuid:C}=d;this.postMessage({op:"removeBodies",uuid:C})}removeConstraint(d){let{uuid:C}=d;this.postMessage({op:"removeConstraint",uuid:C})}removeContactMaterial(d){let{uuid:C}=d;this.postMessage({op:"removeContactMaterial",uuid:C})}removeRay(d){let{uuid:C}=d;this.postMessage({op:"removeRay",uuid:C})}removeRaycastVehicle(d){let{uuid:C}=d;this.postMessage({op:"removeRaycastVehicle",uuid:C})}removeSpring(d){let{uuid:C}=d;this.postMessage({op:"removeSpring",uuid:C})}setAllowSleep(d){let{props:C,uuid:I}=d;this.postMessage({op:"setAllowSleep",props:C,uuid:I})}setAngularDamping(d){let{props:C,uuid:I}=d;this.postMessage({op:"setAngularDamping",props:C,uuid:I})}setAngularFactor(d){let{props:C,uuid:I}=d;this.postMessage({op:"setAngularFactor",props:C,uuid:I})}setAngularVelocity(d){let{props:C,uuid:I}=d;this.postMessage({op:"setAngularVelocity",props:C,uuid:I})}setCollisionFilterGroup(d){let{props:C,uuid:I}=d;this.postMessage({op:"setCollisionFilterGroup",props:C,uuid:I})}setCollisionFilterMask(d){let{props:C,uuid:I}=d;this.postMessage({op:"setCollisionFilterMask",props:C,uuid:I})}setCollisionResponse(d){let{props:C,uuid:I}=d;this.postMessage({op:"setCollisionResponse",props:C,uuid:I})}setConstraintMotorMaxForce(d){let{props:C,uuid:I}=d;this.postMessage({op:"setConstraintMotorMaxForce",props:C,uuid:I})}setConstraintMotorSpeed(d){let{props:C,uuid:I}=d;this.postMessage({op:"setConstraintMotorSpeed",props:C,uuid:I})}setFixedRotation(d){let{props:C,uuid:I}=d;this.postMessage({op:"setFixedRotation",props:C,uuid:I})}setIsTrigger(d){let{props:C,uuid:I}=d;this.postMessage({op:"setIsTrigger",props:C,uuid:I})}setLinearDamping(d){let{props:C,uuid:I}=d;this.postMessage({op:"setLinearDamping",props:C,uuid:I})}setLinearFactor(d){let{props:C,uuid:I}=d;this.postMessage({op:"setLinearFactor",props:C,uuid:I})}setMass(d){let{props:C,uuid:I}=d;this.postMessage({op:"setMass",props:C,uuid:I})}setMaterial(d){let{props:C,uuid:I}=d;this.postMessage({op:"setMaterial",props:C,uuid:I})}setPosition(d){let{props:C,uuid:I}=d;this.postMessage({op:"setPosition",props:C,uuid:I})}setQuaternion(d){let{props:[C,I,f,y],uuid:B}=d;this.postMessage({op:"setQuaternion",props:[C,I,f,y],uuid:B})}setRaycastVehicleBrake(d){let{props:C,uuid:I}=d;this.postMessage({op:"setRaycastVehicleBrake",props:C,uuid:I})}setRaycastVehicleSteeringValue(d){let{props:C,uuid:I}=d;this.postMessage({op:"setRaycastVehicleSteeringValue",props:C,uuid:I})}setRotation(d){let{props:C,uuid:I}=d;this.postMessage({op:"setRotation",props:C,uuid:I})}setSleepSpeedLimit(d){let{props:C,uuid:I}=d;this.postMessage({op:"setSleepSpeedLimit",props:C,uuid:I})}setSleepTimeLimit(d){let{props:C,uuid:I}=d;this.postMessage({op:"setSleepTimeLimit",props:C,uuid:I})}setSpringDamping(d){let{props:C,uuid:I}=d;this.postMessage({op:"setSpringDamping",props:C,uuid:I})}setSpringRestLength(d){let{props:C,uuid:I}=d;this.postMessage({op:"setSpringRestLength",props:C,uuid:I})}setSpringStiffness(d){let{props:C,uuid:I}=d;this.postMessage({op:"setSpringStiffness",props:C,uuid:I})}setUserData(d){let{props:C,uuid:I}=d;this.postMessage({op:"setUserData",props:C,uuid:I})}setVelocity(d){let{props:C,uuid:I}=d;this.postMessage({op:"setVelocity",props:C,uuid:I})}sleep(d){let{uuid:C}=d;this.postMessage({op:"sleep",uuid:C})}step(d){var C;const{buffers:{positions:I,quaternions:f}}=this;!I.byteLength&&!f.byteLength||(C=this.worker)==null||C.postMessage({op:"step",positions:I,props:d,quaternions:f},[I.buffer,f.buffer])}subscribe(d){let{props:{id:C,target:I,type:f},uuid:y}=d;this.postMessage({op:"subscribe",props:{id:C,target:I,type:f},uuid:y})}terminate(){var d;(d=this.worker)==null||d.terminate(),this.worker=null}unsubscribe(d){let{props:C}=d;this.postMessage({op:"unsubscribe",props:C})}wakeUp(d){let{uuid:C}=d;this.postMessage({op:"wakeUp",uuid:C})}postMessage(d){if(this.worker)return this.worker.postMessage(d);this.messageQueue.push(d)}}class Mat3$1{constructor(n){n===void 0&&(n=[0,0,0,0,0,0,0,0,0]),this.elements=n}identity(){const n=this.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1}setZero(){const n=this.elements;n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0}setTrace(n){const d=this.elements;d[0]=n.x,d[4]=n.y,d[8]=n.z}getTrace(n){n===void 0&&(n=new Vec3$1);const d=this.elements;return n.x=d[0],n.y=d[4],n.z=d[8],n}vmult(n,d){d===void 0&&(d=new Vec3$1);const C=this.elements,I=n.x,f=n.y,y=n.z;return d.x=C[0]*I+C[1]*f+C[2]*y,d.y=C[3]*I+C[4]*f+C[5]*y,d.z=C[6]*I+C[7]*f+C[8]*y,d}smult(n){for(let d=0;d<this.elements.length;d++)this.elements[d]*=n}mmult(n,d){d===void 0&&(d=new Mat3$1);const C=this.elements,I=n.elements,f=d.elements,y=C[0],B=C[1],_=C[2],Z=C[3],M=C[4],V=C[5],T=C[6],H=C[7],F=C[8],O=I[0],$=I[1],U=I[2],ee=I[3],Q=I[4],ie=I[5],ne=I[6],le=I[7],ae=I[8];return f[0]=y*O+B*ee+_*ne,f[1]=y*$+B*Q+_*le,f[2]=y*U+B*ie+_*ae,f[3]=Z*O+M*ee+V*ne,f[4]=Z*$+M*Q+V*le,f[5]=Z*U+M*ie+V*ae,f[6]=T*O+H*ee+F*ne,f[7]=T*$+H*Q+F*le,f[8]=T*U+H*ie+F*ae,d}scale(n,d){d===void 0&&(d=new Mat3$1);const C=this.elements,I=d.elements;for(let f=0;f!==3;f++)I[3*f+0]=n.x*C[3*f+0],I[3*f+1]=n.y*C[3*f+1],I[3*f+2]=n.z*C[3*f+2];return d}solve(n,d){d===void 0&&(d=new Vec3$1);const C=3,I=4,f=[];let y,B;for(y=0;y<C*I;y++)f.push(0);for(y=0;y<3;y++)for(B=0;B<3;B++)f[y+I*B]=this.elements[y+3*B];f[3+4*0]=n.x,f[3+4*1]=n.y,f[3+4*2]=n.z;let _=3;const Z=_;let M;const V=4;let T;do{if(y=Z-_,f[y+I*y]===0){for(B=y+1;B<Z;B++)if(f[y+I*B]!==0){M=V;do T=V-M,f[T+I*y]+=f[T+I*B];while(--M);break}}if(f[y+I*y]!==0)for(B=y+1;B<Z;B++){const H=f[y+I*B]/f[y+I*y];M=V;do T=V-M,f[T+I*B]=T<=y?0:f[T+I*B]-f[T+I*y]*H;while(--M)}}while(--_);if(d.z=f[2*I+3]/f[2*I+2],d.y=(f[1*I+3]-f[1*I+2]*d.z)/f[1*I+1],d.x=(f[0*I+3]-f[0*I+2]*d.z-f[0*I+1]*d.y)/f[0*I+0],isNaN(d.x)||isNaN(d.y)||isNaN(d.z)||d.x===1/0||d.y===1/0||d.z===1/0)throw`Could not solve equation! Got x=[${d.toString()}], b=[${n.toString()}], A=[${this.toString()}]`;return d}e(n,d,C){if(C===void 0)return this.elements[d+3*n];this.elements[d+3*n]=C}copy(n){for(let d=0;d<n.elements.length;d++)this.elements[d]=n.elements[d];return this}toString(){let n="";const d=",";for(let C=0;C<9;C++)n+=this.elements[C]+d;return n}reverse(n){n===void 0&&(n=new Mat3$1);const d=3,C=6,I=reverse_eqns$1;let f,y;for(f=0;f<3;f++)for(y=0;y<3;y++)I[f+C*y]=this.elements[f+3*y];I[3+6*0]=1,I[3+6*1]=0,I[3+6*2]=0,I[4+6*0]=0,I[4+6*1]=1,I[4+6*2]=0,I[5+6*0]=0,I[5+6*1]=0,I[5+6*2]=1;let B=3;const _=B;let Z;const M=C;let V;do{if(f=_-B,I[f+C*f]===0){for(y=f+1;y<_;y++)if(I[f+C*y]!==0){Z=M;do V=M-Z,I[V+C*f]+=I[V+C*y];while(--Z);break}}if(I[f+C*f]!==0)for(y=f+1;y<_;y++){const T=I[f+C*y]/I[f+C*f];Z=M;do V=M-Z,I[V+C*y]=V<=f?0:I[V+C*y]-I[V+C*f]*T;while(--Z)}}while(--B);f=2;do{y=f-1;do{const T=I[f+C*y]/I[f+C*f];Z=C;do V=C-Z,I[V+C*y]=I[V+C*y]-I[V+C*f]*T;while(--Z)}while(y--)}while(--f);f=2;do{const T=1/I[f+C*f];Z=C;do V=C-Z,I[V+C*f]=I[V+C*f]*T;while(--Z)}while(f--);f=2;do{y=2;do{if(V=I[d+y+C*f],isNaN(V)||V===1/0)throw`Could not reverse! A=[${this.toString()}]`;n.e(f,y,V)}while(y--)}while(f--);return n}setRotationFromQuaternion(n){const d=n.x,C=n.y,I=n.z,f=n.w,y=d+d,B=C+C,_=I+I,Z=d*y,M=d*B,V=d*_,T=C*B,H=C*_,F=I*_,O=f*y,$=f*B,U=f*_,ee=this.elements;return ee[3*0+0]=1-(T+F),ee[3*0+1]=M-U,ee[3*0+2]=V+$,ee[3*1+0]=M+U,ee[3*1+1]=1-(Z+F),ee[3*1+2]=H-O,ee[3*2+0]=V-$,ee[3*2+1]=H+O,ee[3*2+2]=1-(Z+T),this}transpose(n){n===void 0&&(n=new Mat3$1);const d=this.elements,C=n.elements;let I;return C[0]=d[0],C[4]=d[4],C[8]=d[8],I=d[1],C[1]=d[3],C[3]=I,I=d[2],C[2]=d[6],C[6]=I,I=d[5],C[5]=d[7],C[7]=I,n}}const reverse_eqns$1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3$1{constructor(n,d,C){n===void 0&&(n=0),d===void 0&&(d=0),C===void 0&&(C=0),this.x=n,this.y=d,this.z=C}cross(n,d){d===void 0&&(d=new Vec3$1);const C=n.x,I=n.y,f=n.z,y=this.x,B=this.y,_=this.z;return d.x=B*f-_*I,d.y=_*C-y*f,d.z=y*I-B*C,d}set(n,d,C){return this.x=n,this.y=d,this.z=C,this}setZero(){this.x=this.y=this.z=0}vadd(n,d){if(d)d.x=n.x+this.x,d.y=n.y+this.y,d.z=n.z+this.z;else return new Vec3$1(this.x+n.x,this.y+n.y,this.z+n.z)}vsub(n,d){if(d)d.x=this.x-n.x,d.y=this.y-n.y,d.z=this.z-n.z;else return new Vec3$1(this.x-n.x,this.y-n.y,this.z-n.z)}crossmat(){return new Mat3$1([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const n=this.x,d=this.y,C=this.z,I=Math.sqrt(n*n+d*d+C*C);if(I>0){const f=1/I;this.x*=f,this.y*=f,this.z*=f}else this.x=0,this.y=0,this.z=0;return I}unit(n){n===void 0&&(n=new Vec3$1);const d=this.x,C=this.y,I=this.z;let f=Math.sqrt(d*d+C*C+I*I);return f>0?(f=1/f,n.x=d*f,n.y=C*f,n.z=I*f):(n.x=1,n.y=0,n.z=0),n}length(){const n=this.x,d=this.y,C=this.z;return Math.sqrt(n*n+d*d+C*C)}lengthSquared(){return this.dot(this)}distanceTo(n){const d=this.x,C=this.y,I=this.z,f=n.x,y=n.y,B=n.z;return Math.sqrt((f-d)*(f-d)+(y-C)*(y-C)+(B-I)*(B-I))}distanceSquared(n){const d=this.x,C=this.y,I=this.z,f=n.x,y=n.y,B=n.z;return(f-d)*(f-d)+(y-C)*(y-C)+(B-I)*(B-I)}scale(n,d){d===void 0&&(d=new Vec3$1);const C=this.x,I=this.y,f=this.z;return d.x=n*C,d.y=n*I,d.z=n*f,d}vmul(n,d){return d===void 0&&(d=new Vec3$1),d.x=n.x*this.x,d.y=n.y*this.y,d.z=n.z*this.z,d}addScaledVector(n,d,C){return C===void 0&&(C=new Vec3$1),C.x=this.x+n*d.x,C.y=this.y+n*d.y,C.z=this.z+n*d.z,C}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(n){return n===void 0&&(n=new Vec3$1),n.x=-this.x,n.y=-this.y,n.z=-this.z,n}tangents(n,d){const C=this.length();if(C>0){const I=Vec3_tangents_n$1,f=1/C;I.set(this.x*f,this.y*f,this.z*f);const y=Vec3_tangents_randVec$1;Math.abs(I.x)<.9?(y.set(1,0,0),I.cross(y,n)):(y.set(0,1,0),I.cross(y,n)),I.cross(n,d)}else n.set(1,0,0),d.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}lerp(n,d,C){const I=this.x,f=this.y,y=this.z;C.x=I+(n.x-I)*d,C.y=f+(n.y-f)*d,C.z=y+(n.z-y)*d}almostEquals(n,d){return d===void 0&&(d=1e-6),!(Math.abs(this.x-n.x)>d||Math.abs(this.y-n.y)>d||Math.abs(this.z-n.z)>d)}almostZero(n){return n===void 0&&(n=1e-6),!(Math.abs(this.x)>n||Math.abs(this.y)>n||Math.abs(this.z)>n)}isAntiparallelTo(n,d){return this.negate(antip_neg$1),antip_neg$1.almostEquals(n,d)}clone(){return new Vec3$1(this.x,this.y,this.z)}}Vec3$1.ZERO=new Vec3$1(0,0,0);Vec3$1.UNIT_X=new Vec3$1(1,0,0);Vec3$1.UNIT_Y=new Vec3$1(0,1,0);Vec3$1.UNIT_Z=new Vec3$1(0,0,1);const Vec3_tangents_n$1=new Vec3$1,Vec3_tangents_randVec$1=new Vec3$1,antip_neg$1=new Vec3$1;class AABB$1{constructor(n){n===void 0&&(n={}),this.lowerBound=new Vec3$1,this.upperBound=new Vec3$1,n.lowerBound&&this.lowerBound.copy(n.lowerBound),n.upperBound&&this.upperBound.copy(n.upperBound)}setFromPoints(n,d,C,I){const f=this.lowerBound,y=this.upperBound,B=C;f.copy(n[0]),B&&B.vmult(f,f),y.copy(f);for(let _=1;_<n.length;_++){let Z=n[_];B&&(B.vmult(Z,tmp$1$1),Z=tmp$1$1),Z.x>y.x&&(y.x=Z.x),Z.x<f.x&&(f.x=Z.x),Z.y>y.y&&(y.y=Z.y),Z.y<f.y&&(f.y=Z.y),Z.z>y.z&&(y.z=Z.z),Z.z<f.z&&(f.z=Z.z)}return d&&(d.vadd(f,f),d.vadd(y,y)),I&&(f.x-=I,f.y-=I,f.z-=I,y.x+=I,y.y+=I,y.z+=I),this}copy(n){return this.lowerBound.copy(n.lowerBound),this.upperBound.copy(n.upperBound),this}clone(){return new AABB$1().copy(this)}extend(n){this.lowerBound.x=Math.min(this.lowerBound.x,n.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,n.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,n.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,n.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,n.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,n.upperBound.z)}overlaps(n){const d=this.lowerBound,C=this.upperBound,I=n.lowerBound,f=n.upperBound,y=I.x<=C.x&&C.x<=f.x||d.x<=f.x&&f.x<=C.x,B=I.y<=C.y&&C.y<=f.y||d.y<=f.y&&f.y<=C.y,_=I.z<=C.z&&C.z<=f.z||d.z<=f.z&&f.z<=C.z;return y&&B&&_}volume(){const n=this.lowerBound,d=this.upperBound;return(d.x-n.x)*(d.y-n.y)*(d.z-n.z)}contains(n){const d=this.lowerBound,C=this.upperBound,I=n.lowerBound,f=n.upperBound;return d.x<=I.x&&C.x>=f.x&&d.y<=I.y&&C.y>=f.y&&d.z<=I.z&&C.z>=f.z}getCorners(n,d,C,I,f,y,B,_){const Z=this.lowerBound,M=this.upperBound;n.copy(Z),d.set(M.x,Z.y,Z.z),C.set(M.x,M.y,Z.z),I.set(Z.x,M.y,M.z),f.set(M.x,Z.y,M.z),y.set(Z.x,M.y,Z.z),B.set(Z.x,Z.y,M.z),_.copy(M)}toLocalFrame(n,d){const C=transformIntoFrame_corners$1,I=C[0],f=C[1],y=C[2],B=C[3],_=C[4],Z=C[5],M=C[6],V=C[7];this.getCorners(I,f,y,B,_,Z,M,V);for(let T=0;T!==8;T++){const H=C[T];n.pointToLocal(H,H)}return d.setFromPoints(C)}toWorldFrame(n,d){const C=transformIntoFrame_corners$1,I=C[0],f=C[1],y=C[2],B=C[3],_=C[4],Z=C[5],M=C[6],V=C[7];this.getCorners(I,f,y,B,_,Z,M,V);for(let T=0;T!==8;T++){const H=C[T];n.pointToWorld(H,H)}return d.setFromPoints(C)}overlapsRay(n){const{direction:d,from:C}=n,I=1/d.x,f=1/d.y,y=1/d.z,B=(this.lowerBound.x-C.x)*I,_=(this.upperBound.x-C.x)*I,Z=(this.lowerBound.y-C.y)*f,M=(this.upperBound.y-C.y)*f,V=(this.lowerBound.z-C.z)*y,T=(this.upperBound.z-C.z)*y,H=Math.max(Math.max(Math.min(B,_),Math.min(Z,M)),Math.min(V,T)),F=Math.min(Math.min(Math.max(B,_),Math.max(Z,M)),Math.max(V,T));return!(F<0||H>F)}}const tmp$1$1=new Vec3$1,transformIntoFrame_corners$1=[new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1];class Quaternion$1{constructor(n,d,C,I){n===void 0&&(n=0),d===void 0&&(d=0),C===void 0&&(C=0),I===void 0&&(I=1),this.x=n,this.y=d,this.z=C,this.w=I}set(n,d,C,I){return this.x=n,this.y=d,this.z=C,this.w=I,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(n,d){const C=Math.sin(d*.5);return this.x=n.x*C,this.y=n.y*C,this.z=n.z*C,this.w=Math.cos(d*.5),this}toAxisAngle(n){n===void 0&&(n=new Vec3$1),this.normalize();const d=2*Math.acos(this.w),C=Math.sqrt(1-this.w*this.w);return C<.001?(n.x=this.x,n.y=this.y,n.z=this.z):(n.x=this.x/C,n.y=this.y/C,n.z=this.z/C),[n,d]}setFromVectors(n,d){if(n.isAntiparallelTo(d)){const C=sfv_t1$1,I=sfv_t2$1;n.tangents(C,I),this.setFromAxisAngle(C,Math.PI)}else{const C=n.cross(d);this.x=C.x,this.y=C.y,this.z=C.z,this.w=Math.sqrt(n.length()**2*d.length()**2)+n.dot(d),this.normalize()}return this}mult(n,d){d===void 0&&(d=new Quaternion$1);const C=this.x,I=this.y,f=this.z,y=this.w,B=n.x,_=n.y,Z=n.z,M=n.w;return d.x=C*M+y*B+I*Z-f*_,d.y=I*M+y*_+f*B-C*Z,d.z=f*M+y*Z+C*_-I*B,d.w=y*M-C*B-I*_-f*Z,d}inverse(n){n===void 0&&(n=new Quaternion$1);const d=this.x,C=this.y,I=this.z,f=this.w;this.conjugate(n);const y=1/(d*d+C*C+I*I+f*f);return n.x*=y,n.y*=y,n.z*=y,n.w*=y,n}conjugate(n){return n===void 0&&(n=new Quaternion$1),n.x=-this.x,n.y=-this.y,n.z=-this.z,n.w=this.w,n}normalize(){let n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(n=1/n,this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}normalizeFast(){const n=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}vmult(n,d){d===void 0&&(d=new Vec3$1);const C=n.x,I=n.y,f=n.z,y=this.x,B=this.y,_=this.z,Z=this.w,M=Z*C+B*f-_*I,V=Z*I+_*C-y*f,T=Z*f+y*I-B*C,H=-y*C-B*I-_*f;return d.x=M*Z+H*-y+V*-_-T*-B,d.y=V*Z+H*-B+T*-y-M*-_,d.z=T*Z+H*-_+M*-B-V*-y,d}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this}toEuler(n,d){d===void 0&&(d="YZX");let C,I,f;const y=this.x,B=this.y,_=this.z,Z=this.w;switch(d){case"YZX":const M=y*B+_*Z;if(M>.499&&(C=2*Math.atan2(y,Z),I=Math.PI/2,f=0),M<-.499&&(C=-2*Math.atan2(y,Z),I=-Math.PI/2,f=0),C===void 0){const V=y*y,T=B*B,H=_*_;C=Math.atan2(2*B*Z-2*y*_,1-2*T-2*H),I=Math.asin(2*M),f=Math.atan2(2*y*Z-2*B*_,1-2*V-2*H)}break;default:throw new Error(`Euler order ${d} not supported yet.`)}n.y=C,n.z=I,n.x=f}setFromEuler(n,d,C,I){I===void 0&&(I="XYZ");const f=Math.cos(n/2),y=Math.cos(d/2),B=Math.cos(C/2),_=Math.sin(n/2),Z=Math.sin(d/2),M=Math.sin(C/2);return I==="XYZ"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B-_*Z*M):I==="YXZ"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B+_*Z*M):I==="ZXY"?(this.x=_*y*B-f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B-_*Z*M):I==="ZYX"?(this.x=_*y*B-f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B+_*Z*M):I==="YZX"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B-_*Z*M):I==="XZY"&&(this.x=_*y*B-f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B+_*Z*M),this}clone(){return new Quaternion$1(this.x,this.y,this.z,this.w)}slerp(n,d,C){C===void 0&&(C=new Quaternion$1);const I=this.x,f=this.y,y=this.z,B=this.w;let _=n.x,Z=n.y,M=n.z,V=n.w,T,H,F,O,$;return H=I*_+f*Z+y*M+B*V,H<0&&(H=-H,_=-_,Z=-Z,M=-M,V=-V),1-H>1e-6?(T=Math.acos(H),F=Math.sin(T),O=Math.sin((1-d)*T)/F,$=Math.sin(d*T)/F):(O=1-d,$=d),C.x=O*I+$*_,C.y=O*f+$*Z,C.z=O*y+$*M,C.w=O*B+$*V,C}integrate(n,d,C,I){I===void 0&&(I=new Quaternion$1);const f=n.x*C.x,y=n.y*C.y,B=n.z*C.z,_=this.x,Z=this.y,M=this.z,V=this.w,T=d*.5;return I.x+=T*(f*V+y*M-B*Z),I.y+=T*(y*V+B*_-f*M),I.z+=T*(B*V+f*Z-y*_),I.w+=T*(-f*_-y*Z-B*M),I}}const sfv_t1$1=new Vec3$1,sfv_t2$1=new Vec3$1,SHAPE_TYPES$1={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape$1{constructor(n){n===void 0&&(n={}),this.id=Shape$1.idCounter++,this.type=n.type||0,this.boundingSphereRadius=0,this.collisionResponse=n.collisionResponse?n.collisionResponse:!0,this.collisionFilterGroup=n.collisionFilterGroup!==void 0?n.collisionFilterGroup:1,this.collisionFilterMask=n.collisionFilterMask!==void 0?n.collisionFilterMask:-1,this.material=n.material?n.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(n,d){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(n,d,C,I){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape$1.idCounter=0;Shape$1.types=SHAPE_TYPES$1;class Transform$1{constructor(n){n===void 0&&(n={}),this.position=new Vec3$1,this.quaternion=new Quaternion$1,n.position&&this.position.copy(n.position),n.quaternion&&this.quaternion.copy(n.quaternion)}pointToLocal(n,d){return Transform$1.pointToLocalFrame(this.position,this.quaternion,n,d)}pointToWorld(n,d){return Transform$1.pointToWorldFrame(this.position,this.quaternion,n,d)}vectorToWorldFrame(n,d){return d===void 0&&(d=new Vec3$1),this.quaternion.vmult(n,d),d}static pointToLocalFrame(n,d,C,I){return I===void 0&&(I=new Vec3$1),C.vsub(n,I),d.conjugate(tmpQuat$1$1),tmpQuat$1$1.vmult(I,I),I}static pointToWorldFrame(n,d,C,I){return I===void 0&&(I=new Vec3$1),d.vmult(C,I),I.vadd(n,I),I}static vectorToWorldFrame(n,d,C){return C===void 0&&(C=new Vec3$1),n.vmult(d,C),C}static vectorToLocalFrame(n,d,C,I){return I===void 0&&(I=new Vec3$1),d.w*=-1,d.vmult(C,I),d.w*=-1,I}}const tmpQuat$1$1=new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Quaternion$1;new AABB$1;new Mat3$1;new Mat3$1;new Mat3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;class RaycastResult$1{constructor(){this.rayFromWorld=new Vec3$1,this.rayToWorld=new Vec3$1,this.hitNormalWorld=new Vec3$1,this.hitPointWorld=new Vec3$1,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(n,d,C,I,f,y,B){this.rayFromWorld.copy(n),this.rayToWorld.copy(d),this.hitNormalWorld.copy(C),this.hitPointWorld.copy(I),this.shape=f,this.body=y,this.distance=B}}let _Shape$types$SPHERE$1,_Shape$types$PLANE$1,_Shape$types$BOX$1,_Shape$types$CYLINDER$1,_Shape$types$CONVEXPO$1,_Shape$types$HEIGHTFI$1,_Shape$types$TRIMESH$1;const RAY_MODES$1={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE$1=Shape$1.types.SPHERE;_Shape$types$PLANE$1=Shape$1.types.PLANE;_Shape$types$BOX$1=Shape$1.types.BOX;_Shape$types$CYLINDER$1=Shape$1.types.CYLINDER;_Shape$types$CONVEXPO$1=Shape$1.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI$1=Shape$1.types.HEIGHTFIELD;_Shape$types$TRIMESH$1=Shape$1.types.TRIMESH;class Ray$1{get[_Shape$types$SPHERE$1](){return this._intersectSphere}get[_Shape$types$PLANE$1](){return this._intersectPlane}get[_Shape$types$BOX$1](){return this._intersectBox}get[_Shape$types$CYLINDER$1](){return this._intersectConvex}get[_Shape$types$CONVEXPO$1](){return this._intersectConvex}get[_Shape$types$HEIGHTFI$1](){return this._intersectHeightfield}get[_Shape$types$TRIMESH$1](){return this._intersectTrimesh}constructor(n,d){n===void 0&&(n=new Vec3$1),d===void 0&&(d=new Vec3$1),this.from=n.clone(),this.to=d.clone(),this.direction=new Vec3$1,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray$1.ANY,this.result=new RaycastResult$1,this.hasHit=!1,this.callback=C=>{}}intersectWorld(n,d){return this.mode=d.mode||Ray$1.ANY,this.result=d.result||new RaycastResult$1,this.skipBackfaces=!!d.skipBackfaces,this.collisionFilterMask=typeof d.collisionFilterMask<"u"?d.collisionFilterMask:-1,this.collisionFilterGroup=typeof d.collisionFilterGroup<"u"?d.collisionFilterGroup:-1,this.checkCollisionResponse=typeof d.checkCollisionResponse<"u"?d.checkCollisionResponse:!0,d.from&&this.from.copy(d.from),d.to&&this.to.copy(d.to),this.callback=d.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1$1),tmpArray$1.length=0,n.broadphase.aabbQuery(n,tmpAABB$1$1,tmpArray$1),this.intersectBodies(tmpArray$1),this.hasHit}intersectBody(n,d){d&&(this.result=d,this.updateDirection());const C=this.checkCollisionResponse;if(C&&!n.collisionResponse||(this.collisionFilterGroup&n.collisionFilterMask)===0||(n.collisionFilterGroup&this.collisionFilterMask)===0)return;const I=intersectBody_xi$1,f=intersectBody_qi$1;for(let y=0,B=n.shapes.length;y<B;y++){const _=n.shapes[y];if(!(C&&!_.collisionResponse)&&(n.quaternion.mult(n.shapeOrientations[y],f),n.quaternion.vmult(n.shapeOffsets[y],I),I.vadd(n.position,I),this.intersectShape(_,f,I,n),this.result.shouldStop))break}}intersectBodies(n,d){d&&(this.result=d,this.updateDirection());for(let C=0,I=n.length;!this.result.shouldStop&&C<I;C++)this.intersectBody(n[C])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(n,d,C,I){const f=this.from;if(distanceFromIntersection$1(f,this.direction,C)>n.boundingSphereRadius)return;const B=this[n.type];B&&B.call(this,n,d,C,I,n)}_intersectBox(n,d,C,I,f){return this._intersectConvex(n.convexPolyhedronRepresentation,d,C,I,f)}_intersectPlane(n,d,C,I,f){const y=this.from,B=this.to,_=this.direction,Z=new Vec3$1(0,0,1);d.vmult(Z,Z);const M=new Vec3$1;y.vsub(C,M);const V=M.dot(Z);B.vsub(C,M);const T=M.dot(Z);if(V*T>0||y.distanceTo(B)<V)return;const H=Z.dot(_);if(Math.abs(H)<this.precision)return;const F=new Vec3$1,O=new Vec3$1,$=new Vec3$1;y.vsub(C,F);const U=-Z.dot(F)/H;_.scale(U,O),y.vadd(O,$),this.reportIntersection(Z,$,f,I,-1)}getAABB(n){const{lowerBound:d,upperBound:C}=n,I=this.to,f=this.from;d.x=Math.min(I.x,f.x),d.y=Math.min(I.y,f.y),d.z=Math.min(I.z,f.z),C.x=Math.max(I.x,f.x),C.y=Math.max(I.y,f.y),C.z=Math.max(I.z,f.z)}_intersectHeightfield(n,d,C,I,f){n.data,n.elementSize;const y=intersectHeightfield_localRay$1;y.from.copy(this.from),y.to.copy(this.to),Transform$1.pointToLocalFrame(C,d,y.from,y.from),Transform$1.pointToLocalFrame(C,d,y.to,y.to),y.updateDirection();const B=intersectHeightfield_index$1;let _,Z,M,V;_=Z=0,M=V=n.data.length-1;const T=new AABB$1;y.getAABB(T),n.getIndexOfPosition(T.lowerBound.x,T.lowerBound.y,B,!0),_=Math.max(_,B[0]),Z=Math.max(Z,B[1]),n.getIndexOfPosition(T.upperBound.x,T.upperBound.y,B,!0),M=Math.min(M,B[0]+1),V=Math.min(V,B[1]+1);for(let H=_;H<M;H++)for(let F=Z;F<V;F++){if(this.result.shouldStop)return;if(n.getAabbAtIndex(H,F,T),!!T.overlapsRay(y)){if(n.getConvexTrianglePillar(H,F,!1),Transform$1.pointToWorldFrame(C,d,n.pillarOffset,worldPillarOffset$1),this._intersectConvex(n.pillarConvex,d,worldPillarOffset$1,I,f,intersectConvexOptions$1),this.result.shouldStop)return;n.getConvexTrianglePillar(H,F,!0),Transform$1.pointToWorldFrame(C,d,n.pillarOffset,worldPillarOffset$1),this._intersectConvex(n.pillarConvex,d,worldPillarOffset$1,I,f,intersectConvexOptions$1)}}}_intersectSphere(n,d,C,I,f){const y=this.from,B=this.to,_=n.radius,Z=(B.x-y.x)**2+(B.y-y.y)**2+(B.z-y.z)**2,M=2*((B.x-y.x)*(y.x-C.x)+(B.y-y.y)*(y.y-C.y)+(B.z-y.z)*(y.z-C.z)),V=(y.x-C.x)**2+(y.y-C.y)**2+(y.z-C.z)**2-_**2,T=M**2-4*Z*V,H=Ray_intersectSphere_intersectionPoint$1,F=Ray_intersectSphere_normal$1;if(!(T<0))if(T===0)y.lerp(B,T,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1);else{const O=(-M-Math.sqrt(T))/(2*Z),$=(-M+Math.sqrt(T))/(2*Z);if(O>=0&&O<=1&&(y.lerp(B,O,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1)),this.result.shouldStop)return;$>=0&&$<=1&&(y.lerp(B,$,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1))}}_intersectConvex(n,d,C,I,f,y){const B=intersectConvex_normal$1,_=intersectConvex_vector$1,Z=y&&y.faceList||null,M=n.faces,V=n.vertices,T=n.faceNormals,H=this.direction,F=this.from,O=this.to,$=F.distanceTo(O),U=Z?Z.length:M.length,ee=this.result;for(let Q=0;!ee.shouldStop&&Q<U;Q++){const ie=Z?Z[Q]:Q,ne=M[ie],le=T[ie],ae=d,ce=C;_.copy(V[ne[0]]),ae.vmult(_,_),_.vadd(ce,_),_.vsub(F,_),ae.vmult(le,B);const ge=H.dot(B);if(Math.abs(ge)<this.precision)continue;const he=B.dot(_)/ge;if(!(he<0)){H.scale(he,intersectPoint$1),intersectPoint$1.vadd(F,intersectPoint$1),a$1.copy(V[ne[0]]),ae.vmult(a$1,a$1),ce.vadd(a$1,a$1);for(let Ie=1;!ee.shouldStop&&Ie<ne.length-1;Ie++){b$1.copy(V[ne[Ie]]),c$1.copy(V[ne[Ie+1]]),ae.vmult(b$1,b$1),ae.vmult(c$1,c$1),ce.vadd(b$1,b$1),ce.vadd(c$1,c$1);const fe=intersectPoint$1.distanceTo(F);!(Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1))||fe>$||this.reportIntersection(B,intersectPoint$1,f,I,ie)}}}}_intersectTrimesh(n,d,C,I,f,y){const B=intersectTrimesh_normal$1,_=intersectTrimesh_triangles$1,Z=intersectTrimesh_treeTransform$1,M=intersectConvex_vector$1,V=intersectTrimesh_localDirection$1,T=intersectTrimesh_localFrom$1,H=intersectTrimesh_localTo$1,F=intersectTrimesh_worldIntersectPoint$1,O=intersectTrimesh_worldNormal$1,$=n.indices;n.vertices;const U=this.from,ee=this.to,Q=this.direction;Z.position.copy(C),Z.quaternion.copy(d),Transform$1.vectorToLocalFrame(C,d,Q,V),Transform$1.pointToLocalFrame(C,d,U,T),Transform$1.pointToLocalFrame(C,d,ee,H),H.x*=n.scale.x,H.y*=n.scale.y,H.z*=n.scale.z,T.x*=n.scale.x,T.y*=n.scale.y,T.z*=n.scale.z,H.vsub(T,V),V.normalize();const ie=T.distanceSquared(H);n.tree.rayQuery(this,Z,_);for(let ne=0,le=_.length;!this.result.shouldStop&&ne!==le;ne++){const ae=_[ne];n.getNormal(ae,B),n.getVertex($[ae*3],a$1),a$1.vsub(T,M);const ce=V.dot(B),ge=B.dot(M)/ce;if(ge<0)continue;V.scale(ge,intersectPoint$1),intersectPoint$1.vadd(T,intersectPoint$1),n.getVertex($[ae*3+1],b$1),n.getVertex($[ae*3+2],c$1);const he=intersectPoint$1.distanceSquared(T);!(Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1))||he>ie||(Transform$1.vectorToWorldFrame(d,B,O),Transform$1.pointToWorldFrame(C,d,intersectPoint$1,F),this.reportIntersection(O,F,f,I,ae))}_.length=0}reportIntersection(n,d,C,I,f){const y=this.from,B=this.to,_=y.distanceTo(d),Z=this.result;if(!(this.skipBackfaces&&n.dot(this.direction)>0))switch(Z.hitFaceIndex=typeof f<"u"?f:-1,this.mode){case Ray$1.ALL:this.hasHit=!0,Z.set(y,B,n,d,C,I,_),Z.hasHit=!0,this.callback(Z);break;case Ray$1.CLOSEST:(_<Z.distance||!Z.hasHit)&&(this.hasHit=!0,Z.hasHit=!0,Z.set(y,B,n,d,C,I,_));break;case Ray$1.ANY:this.hasHit=!0,Z.hasHit=!0,Z.set(y,B,n,d,C,I,_),Z.shouldStop=!0;break}}static pointInTriangle(n,d,C,I){I.vsub(d,v0$1),C.vsub(d,v1$1),n.vsub(d,v2$1);const f=v0$1.dot(v0$1),y=v0$1.dot(v1$1),B=v0$1.dot(v2$1),_=v1$1.dot(v1$1),Z=v1$1.dot(v2$1);let M,V;return(M=_*B-y*Z)>=0&&(V=f*Z-y*B)>=0&&M+V<f*_-y*y}}Ray$1.CLOSEST=RAY_MODES$1.CLOSEST;Ray$1.ANY=RAY_MODES$1.ANY;Ray$1.ALL=RAY_MODES$1.ALL;const tmpAABB$1$1=new AABB$1,tmpArray$1=[],v1$1=new Vec3$1,v2$1=new Vec3$1,intersectBody_xi$1=new Vec3$1,intersectBody_qi$1=new Quaternion$1,intersectPoint$1=new Vec3$1,a$1=new Vec3$1,b$1=new Vec3$1,c$1=new Vec3$1;new Vec3$1;new RaycastResult$1;const intersectConvexOptions$1={faceList:[0]},worldPillarOffset$1=new Vec3$1,intersectHeightfield_localRay$1=new Ray$1,intersectHeightfield_index$1=[],Ray_intersectSphere_intersectionPoint$1=new Vec3$1,Ray_intersectSphere_normal$1=new Vec3$1,intersectConvex_normal$1=new Vec3$1;new Vec3$1;new Vec3$1;const intersectConvex_vector$1=new Vec3$1,intersectTrimesh_normal$1=new Vec3$1,intersectTrimesh_localDirection$1=new Vec3$1,intersectTrimesh_localFrom$1=new Vec3$1,intersectTrimesh_localTo$1=new Vec3$1,intersectTrimesh_worldNormal$1=new Vec3$1,intersectTrimesh_worldIntersectPoint$1=new Vec3$1;new AABB$1;const intersectTrimesh_triangles$1=[],intersectTrimesh_treeTransform$1=new Transform$1,v0$1=new Vec3$1,intersect$1=new Vec3$1;function distanceFromIntersection$1(u,n,d){d.vsub(u,v0$1);const C=v0$1.dot(n);return n.scale(C,intersect$1),intersect$1.vadd(u,intersect$1),d.distanceTo(intersect$1)}new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Ray$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1(1,0,0),new Vec3$1(0,1,0),new Vec3$1(0,0,1);new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Transform$1;new AABB$1;Shape$1.types.SPHERE,Shape$1.types.SPHERE|Shape$1.types.PLANE,Shape$1.types.BOX|Shape$1.types.BOX,Shape$1.types.SPHERE|Shape$1.types.BOX,Shape$1.types.PLANE|Shape$1.types.BOX,Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.PLANE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.BOX|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.HEIGHTFIELD,Shape$1.types.BOX|Shape$1.types.HEIGHTFIELD,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.HEIGHTFIELD,Shape$1.types.PARTICLE|Shape$1.types.SPHERE,Shape$1.types.PLANE|Shape$1.types.PARTICLE,Shape$1.types.BOX|Shape$1.types.PARTICLE,Shape$1.types.PARTICLE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.CYLINDER,Shape$1.types.PLANE|Shape$1.types.CYLINDER,Shape$1.types.BOX|Shape$1.types.CYLINDER,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.CYLINDER,Shape$1.types.HEIGHTFIELD|Shape$1.types.CYLINDER,Shape$1.types.PARTICLE|Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.TRIMESH,Shape$1.types.PLANE|Shape$1.types.TRIMESH;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Ray$1;const performance$1=globalThis.performance||{};if(!performance$1.now){let u=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(u=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-u}new Vec3$1;class Mat3{constructor(n){n===void 0&&(n=[0,0,0,0,0,0,0,0,0]),this.elements=n}identity(){const n=this.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1}setZero(){const n=this.elements;n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0}setTrace(n){const d=this.elements;d[0]=n.x,d[4]=n.y,d[8]=n.z}getTrace(n){n===void 0&&(n=new Vec3);const d=this.elements;return n.x=d[0],n.y=d[4],n.z=d[8],n}vmult(n,d){d===void 0&&(d=new Vec3);const C=this.elements,I=n.x,f=n.y,y=n.z;return d.x=C[0]*I+C[1]*f+C[2]*y,d.y=C[3]*I+C[4]*f+C[5]*y,d.z=C[6]*I+C[7]*f+C[8]*y,d}smult(n){for(let d=0;d<this.elements.length;d++)this.elements[d]*=n}mmult(n,d){d===void 0&&(d=new Mat3);const C=this.elements,I=n.elements,f=d.elements,y=C[0],B=C[1],_=C[2],Z=C[3],M=C[4],V=C[5],T=C[6],H=C[7],F=C[8],O=I[0],$=I[1],U=I[2],ee=I[3],Q=I[4],ie=I[5],ne=I[6],le=I[7],ae=I[8];return f[0]=y*O+B*ee+_*ne,f[1]=y*$+B*Q+_*le,f[2]=y*U+B*ie+_*ae,f[3]=Z*O+M*ee+V*ne,f[4]=Z*$+M*Q+V*le,f[5]=Z*U+M*ie+V*ae,f[6]=T*O+H*ee+F*ne,f[7]=T*$+H*Q+F*le,f[8]=T*U+H*ie+F*ae,d}scale(n,d){d===void 0&&(d=new Mat3);const C=this.elements,I=d.elements;for(let f=0;f!==3;f++)I[3*f+0]=n.x*C[3*f+0],I[3*f+1]=n.y*C[3*f+1],I[3*f+2]=n.z*C[3*f+2];return d}solve(n,d){d===void 0&&(d=new Vec3);const C=3,I=4,f=[];let y,B;for(y=0;y<C*I;y++)f.push(0);for(y=0;y<3;y++)for(B=0;B<3;B++)f[y+I*B]=this.elements[y+3*B];f[3+4*0]=n.x,f[3+4*1]=n.y,f[3+4*2]=n.z;let _=3;const Z=_;let M;const V=4;let T;do{if(y=Z-_,f[y+I*y]===0){for(B=y+1;B<Z;B++)if(f[y+I*B]!==0){M=V;do T=V-M,f[T+I*y]+=f[T+I*B];while(--M);break}}if(f[y+I*y]!==0)for(B=y+1;B<Z;B++){const H=f[y+I*B]/f[y+I*y];M=V;do T=V-M,f[T+I*B]=T<=y?0:f[T+I*B]-f[T+I*y]*H;while(--M)}}while(--_);if(d.z=f[2*I+3]/f[2*I+2],d.y=(f[1*I+3]-f[1*I+2]*d.z)/f[1*I+1],d.x=(f[0*I+3]-f[0*I+2]*d.z-f[0*I+1]*d.y)/f[0*I+0],isNaN(d.x)||isNaN(d.y)||isNaN(d.z)||d.x===1/0||d.y===1/0||d.z===1/0)throw`Could not solve equation! Got x=[${d.toString()}], b=[${n.toString()}], A=[${this.toString()}]`;return d}e(n,d,C){if(C===void 0)return this.elements[d+3*n];this.elements[d+3*n]=C}copy(n){for(let d=0;d<n.elements.length;d++)this.elements[d]=n.elements[d];return this}toString(){let n="";const d=",";for(let C=0;C<9;C++)n+=this.elements[C]+d;return n}reverse(n){n===void 0&&(n=new Mat3);const d=3,C=6,I=reverse_eqns;let f,y;for(f=0;f<3;f++)for(y=0;y<3;y++)I[f+C*y]=this.elements[f+3*y];I[3+6*0]=1,I[3+6*1]=0,I[3+6*2]=0,I[4+6*0]=0,I[4+6*1]=1,I[4+6*2]=0,I[5+6*0]=0,I[5+6*1]=0,I[5+6*2]=1;let B=3;const _=B;let Z;const M=C;let V;do{if(f=_-B,I[f+C*f]===0){for(y=f+1;y<_;y++)if(I[f+C*y]!==0){Z=M;do V=M-Z,I[V+C*f]+=I[V+C*y];while(--Z);break}}if(I[f+C*f]!==0)for(y=f+1;y<_;y++){const T=I[f+C*y]/I[f+C*f];Z=M;do V=M-Z,I[V+C*y]=V<=f?0:I[V+C*y]-I[V+C*f]*T;while(--Z)}}while(--B);f=2;do{y=f-1;do{const T=I[f+C*y]/I[f+C*f];Z=C;do V=C-Z,I[V+C*y]=I[V+C*y]-I[V+C*f]*T;while(--Z)}while(y--)}while(--f);f=2;do{const T=1/I[f+C*f];Z=C;do V=C-Z,I[V+C*f]=I[V+C*f]*T;while(--Z)}while(f--);f=2;do{y=2;do{if(V=I[d+y+C*f],isNaN(V)||V===1/0)throw`Could not reverse! A=[${this.toString()}]`;n.e(f,y,V)}while(y--)}while(f--);return n}setRotationFromQuaternion(n){const d=n.x,C=n.y,I=n.z,f=n.w,y=d+d,B=C+C,_=I+I,Z=d*y,M=d*B,V=d*_,T=C*B,H=C*_,F=I*_,O=f*y,$=f*B,U=f*_,ee=this.elements;return ee[3*0+0]=1-(T+F),ee[3*0+1]=M-U,ee[3*0+2]=V+$,ee[3*1+0]=M+U,ee[3*1+1]=1-(Z+F),ee[3*1+2]=H-O,ee[3*2+0]=V-$,ee[3*2+1]=H+O,ee[3*2+2]=1-(Z+T),this}transpose(n){n===void 0&&(n=new Mat3);const d=this.elements,C=n.elements;let I;return C[0]=d[0],C[4]=d[4],C[8]=d[8],I=d[1],C[1]=d[3],C[3]=I,I=d[2],C[2]=d[6],C[6]=I,I=d[5],C[5]=d[7],C[7]=I,n}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(n,d,C){n===void 0&&(n=0),d===void 0&&(d=0),C===void 0&&(C=0),this.x=n,this.y=d,this.z=C}cross(n,d){d===void 0&&(d=new Vec3);const C=n.x,I=n.y,f=n.z,y=this.x,B=this.y,_=this.z;return d.x=B*f-_*I,d.y=_*C-y*f,d.z=y*I-B*C,d}set(n,d,C){return this.x=n,this.y=d,this.z=C,this}setZero(){this.x=this.y=this.z=0}vadd(n,d){if(d)d.x=n.x+this.x,d.y=n.y+this.y,d.z=n.z+this.z;else return new Vec3(this.x+n.x,this.y+n.y,this.z+n.z)}vsub(n,d){if(d)d.x=this.x-n.x,d.y=this.y-n.y,d.z=this.z-n.z;else return new Vec3(this.x-n.x,this.y-n.y,this.z-n.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const n=this.x,d=this.y,C=this.z,I=Math.sqrt(n*n+d*d+C*C);if(I>0){const f=1/I;this.x*=f,this.y*=f,this.z*=f}else this.x=0,this.y=0,this.z=0;return I}unit(n){n===void 0&&(n=new Vec3);const d=this.x,C=this.y,I=this.z;let f=Math.sqrt(d*d+C*C+I*I);return f>0?(f=1/f,n.x=d*f,n.y=C*f,n.z=I*f):(n.x=1,n.y=0,n.z=0),n}length(){const n=this.x,d=this.y,C=this.z;return Math.sqrt(n*n+d*d+C*C)}lengthSquared(){return this.dot(this)}distanceTo(n){const d=this.x,C=this.y,I=this.z,f=n.x,y=n.y,B=n.z;return Math.sqrt((f-d)*(f-d)+(y-C)*(y-C)+(B-I)*(B-I))}distanceSquared(n){const d=this.x,C=this.y,I=this.z,f=n.x,y=n.y,B=n.z;return(f-d)*(f-d)+(y-C)*(y-C)+(B-I)*(B-I)}scale(n,d){d===void 0&&(d=new Vec3);const C=this.x,I=this.y,f=this.z;return d.x=n*C,d.y=n*I,d.z=n*f,d}vmul(n,d){return d===void 0&&(d=new Vec3),d.x=n.x*this.x,d.y=n.y*this.y,d.z=n.z*this.z,d}addScaledVector(n,d,C){return C===void 0&&(C=new Vec3),C.x=this.x+n*d.x,C.y=this.y+n*d.y,C.z=this.z+n*d.z,C}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(n){return n===void 0&&(n=new Vec3),n.x=-this.x,n.y=-this.y,n.z=-this.z,n}tangents(n,d){const C=this.length();if(C>0){const I=Vec3_tangents_n,f=1/C;I.set(this.x*f,this.y*f,this.z*f);const y=Vec3_tangents_randVec;Math.abs(I.x)<.9?(y.set(1,0,0),I.cross(y,n)):(y.set(0,1,0),I.cross(y,n)),I.cross(n,d)}else n.set(1,0,0),d.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}lerp(n,d,C){const I=this.x,f=this.y,y=this.z;C.x=I+(n.x-I)*d,C.y=f+(n.y-f)*d,C.z=y+(n.z-y)*d}almostEquals(n,d){return d===void 0&&(d=1e-6),!(Math.abs(this.x-n.x)>d||Math.abs(this.y-n.y)>d||Math.abs(this.z-n.z)>d)}almostZero(n){return n===void 0&&(n=1e-6),!(Math.abs(this.x)>n||Math.abs(this.y)>n||Math.abs(this.z)>n)}isAntiparallelTo(n,d){return this.negate(antip_neg),antip_neg.almostEquals(n,d)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(n){n===void 0&&(n={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,n.lowerBound&&this.lowerBound.copy(n.lowerBound),n.upperBound&&this.upperBound.copy(n.upperBound)}setFromPoints(n,d,C,I){const f=this.lowerBound,y=this.upperBound,B=C;f.copy(n[0]),B&&B.vmult(f,f),y.copy(f);for(let _=1;_<n.length;_++){let Z=n[_];B&&(B.vmult(Z,tmp$1),Z=tmp$1),Z.x>y.x&&(y.x=Z.x),Z.x<f.x&&(f.x=Z.x),Z.y>y.y&&(y.y=Z.y),Z.y<f.y&&(f.y=Z.y),Z.z>y.z&&(y.z=Z.z),Z.z<f.z&&(f.z=Z.z)}return d&&(d.vadd(f,f),d.vadd(y,y)),I&&(f.x-=I,f.y-=I,f.z-=I,y.x+=I,y.y+=I,y.z+=I),this}copy(n){return this.lowerBound.copy(n.lowerBound),this.upperBound.copy(n.upperBound),this}clone(){return new AABB().copy(this)}extend(n){this.lowerBound.x=Math.min(this.lowerBound.x,n.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,n.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,n.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,n.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,n.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,n.upperBound.z)}overlaps(n){const d=this.lowerBound,C=this.upperBound,I=n.lowerBound,f=n.upperBound,y=I.x<=C.x&&C.x<=f.x||d.x<=f.x&&f.x<=C.x,B=I.y<=C.y&&C.y<=f.y||d.y<=f.y&&f.y<=C.y,_=I.z<=C.z&&C.z<=f.z||d.z<=f.z&&f.z<=C.z;return y&&B&&_}volume(){const n=this.lowerBound,d=this.upperBound;return(d.x-n.x)*(d.y-n.y)*(d.z-n.z)}contains(n){const d=this.lowerBound,C=this.upperBound,I=n.lowerBound,f=n.upperBound;return d.x<=I.x&&C.x>=f.x&&d.y<=I.y&&C.y>=f.y&&d.z<=I.z&&C.z>=f.z}getCorners(n,d,C,I,f,y,B,_){const Z=this.lowerBound,M=this.upperBound;n.copy(Z),d.set(M.x,Z.y,Z.z),C.set(M.x,M.y,Z.z),I.set(Z.x,M.y,M.z),f.set(M.x,Z.y,M.z),y.set(Z.x,M.y,Z.z),B.set(Z.x,Z.y,M.z),_.copy(M)}toLocalFrame(n,d){const C=transformIntoFrame_corners,I=C[0],f=C[1],y=C[2],B=C[3],_=C[4],Z=C[5],M=C[6],V=C[7];this.getCorners(I,f,y,B,_,Z,M,V);for(let T=0;T!==8;T++){const H=C[T];n.pointToLocal(H,H)}return d.setFromPoints(C)}toWorldFrame(n,d){const C=transformIntoFrame_corners,I=C[0],f=C[1],y=C[2],B=C[3],_=C[4],Z=C[5],M=C[6],V=C[7];this.getCorners(I,f,y,B,_,Z,M,V);for(let T=0;T!==8;T++){const H=C[T];n.pointToWorld(H,H)}return d.setFromPoints(C)}overlapsRay(n){const{direction:d,from:C}=n,I=1/d.x,f=1/d.y,y=1/d.z,B=(this.lowerBound.x-C.x)*I,_=(this.upperBound.x-C.x)*I,Z=(this.lowerBound.y-C.y)*f,M=(this.upperBound.y-C.y)*f,V=(this.lowerBound.z-C.z)*y,T=(this.upperBound.z-C.z)*y,H=Math.max(Math.max(Math.min(B,_),Math.min(Z,M)),Math.min(V,T)),F=Math.min(Math.min(Math.max(B,_),Math.max(Z,M)),Math.max(V,T));return!(F<0||H>F)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class Quaternion{constructor(n,d,C,I){n===void 0&&(n=0),d===void 0&&(d=0),C===void 0&&(C=0),I===void 0&&(I=1),this.x=n,this.y=d,this.z=C,this.w=I}set(n,d,C,I){return this.x=n,this.y=d,this.z=C,this.w=I,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(n,d){const C=Math.sin(d*.5);return this.x=n.x*C,this.y=n.y*C,this.z=n.z*C,this.w=Math.cos(d*.5),this}toAxisAngle(n){n===void 0&&(n=new Vec3),this.normalize();const d=2*Math.acos(this.w),C=Math.sqrt(1-this.w*this.w);return C<.001?(n.x=this.x,n.y=this.y,n.z=this.z):(n.x=this.x/C,n.y=this.y/C,n.z=this.z/C),[n,d]}setFromVectors(n,d){if(n.isAntiparallelTo(d)){const C=sfv_t1,I=sfv_t2;n.tangents(C,I),this.setFromAxisAngle(C,Math.PI)}else{const C=n.cross(d);this.x=C.x,this.y=C.y,this.z=C.z,this.w=Math.sqrt(n.length()**2*d.length()**2)+n.dot(d),this.normalize()}return this}mult(n,d){d===void 0&&(d=new Quaternion);const C=this.x,I=this.y,f=this.z,y=this.w,B=n.x,_=n.y,Z=n.z,M=n.w;return d.x=C*M+y*B+I*Z-f*_,d.y=I*M+y*_+f*B-C*Z,d.z=f*M+y*Z+C*_-I*B,d.w=y*M-C*B-I*_-f*Z,d}inverse(n){n===void 0&&(n=new Quaternion);const d=this.x,C=this.y,I=this.z,f=this.w;this.conjugate(n);const y=1/(d*d+C*C+I*I+f*f);return n.x*=y,n.y*=y,n.z*=y,n.w*=y,n}conjugate(n){return n===void 0&&(n=new Quaternion),n.x=-this.x,n.y=-this.y,n.z=-this.z,n.w=this.w,n}normalize(){let n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(n=1/n,this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}normalizeFast(){const n=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}vmult(n,d){d===void 0&&(d=new Vec3);const C=n.x,I=n.y,f=n.z,y=this.x,B=this.y,_=this.z,Z=this.w,M=Z*C+B*f-_*I,V=Z*I+_*C-y*f,T=Z*f+y*I-B*C,H=-y*C-B*I-_*f;return d.x=M*Z+H*-y+V*-_-T*-B,d.y=V*Z+H*-B+T*-y-M*-_,d.z=T*Z+H*-_+M*-B-V*-y,d}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this}toEuler(n,d){d===void 0&&(d="YZX");let C,I,f;const y=this.x,B=this.y,_=this.z,Z=this.w;switch(d){case"YZX":const M=y*B+_*Z;if(M>.499&&(C=2*Math.atan2(y,Z),I=Math.PI/2,f=0),M<-.499&&(C=-2*Math.atan2(y,Z),I=-Math.PI/2,f=0),C===void 0){const V=y*y,T=B*B,H=_*_;C=Math.atan2(2*B*Z-2*y*_,1-2*T-2*H),I=Math.asin(2*M),f=Math.atan2(2*y*Z-2*B*_,1-2*V-2*H)}break;default:throw new Error(`Euler order ${d} not supported yet.`)}n.y=C,n.z=I,n.x=f}setFromEuler(n,d,C,I){I===void 0&&(I="XYZ");const f=Math.cos(n/2),y=Math.cos(d/2),B=Math.cos(C/2),_=Math.sin(n/2),Z=Math.sin(d/2),M=Math.sin(C/2);return I==="XYZ"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B-_*Z*M):I==="YXZ"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B+_*Z*M):I==="ZXY"?(this.x=_*y*B-f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B-_*Z*M):I==="ZYX"?(this.x=_*y*B-f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B+_*Z*M):I==="YZX"?(this.x=_*y*B+f*Z*M,this.y=f*Z*B+_*y*M,this.z=f*y*M-_*Z*B,this.w=f*y*B-_*Z*M):I==="XZY"&&(this.x=_*y*B-f*Z*M,this.y=f*Z*B-_*y*M,this.z=f*y*M+_*Z*B,this.w=f*y*B+_*Z*M),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(n,d,C){C===void 0&&(C=new Quaternion);const I=this.x,f=this.y,y=this.z,B=this.w;let _=n.x,Z=n.y,M=n.z,V=n.w,T,H,F,O,$;return H=I*_+f*Z+y*M+B*V,H<0&&(H=-H,_=-_,Z=-Z,M=-M,V=-V),1-H>1e-6?(T=Math.acos(H),F=Math.sin(T),O=Math.sin((1-d)*T)/F,$=Math.sin(d*T)/F):(O=1-d,$=d),C.x=O*I+$*_,C.y=O*f+$*Z,C.z=O*y+$*M,C.w=O*B+$*V,C}integrate(n,d,C,I){I===void 0&&(I=new Quaternion);const f=n.x*C.x,y=n.y*C.y,B=n.z*C.z,_=this.x,Z=this.y,M=this.z,V=this.w,T=d*.5;return I.x+=T*(f*V+y*M-B*Z),I.y+=T*(y*V+B*_-f*M),I.z+=T*(B*V+f*Z-y*_),I.w+=T*(-f*_-y*Z-B*M),I}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(n){n===void 0&&(n={}),this.id=Shape.idCounter++,this.type=n.type||0,this.boundingSphereRadius=0,this.collisionResponse=n.collisionResponse?n.collisionResponse:!0,this.collisionFilterGroup=n.collisionFilterGroup!==void 0?n.collisionFilterGroup:1,this.collisionFilterMask=n.collisionFilterMask!==void 0?n.collisionFilterMask:-1,this.material=n.material?n.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(n,d){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(n,d,C,I){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(n){n===void 0&&(n={}),this.position=new Vec3,this.quaternion=new Quaternion,n.position&&this.position.copy(n.position),n.quaternion&&this.quaternion.copy(n.quaternion)}pointToLocal(n,d){return Transform.pointToLocalFrame(this.position,this.quaternion,n,d)}pointToWorld(n,d){return Transform.pointToWorldFrame(this.position,this.quaternion,n,d)}vectorToWorldFrame(n,d){return d===void 0&&(d=new Vec3),this.quaternion.vmult(n,d),d}static pointToLocalFrame(n,d,C,I){return I===void 0&&(I=new Vec3),C.vsub(n,I),d.conjugate(tmpQuat$1),tmpQuat$1.vmult(I,I),I}static pointToWorldFrame(n,d,C,I){return I===void 0&&(I=new Vec3),d.vmult(C,I),I.vadd(n,I),I}static vectorToWorldFrame(n,d,C){return C===void 0&&(C=new Vec3),n.vmult(d,C),C}static vectorToLocalFrame(n,d,C,I){return I===void 0&&(I=new Vec3),d.w*=-1,d.vmult(C,I),d.w*=-1,I}}const tmpQuat$1=new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Quaternion;new AABB;new Mat3;new Mat3;new Mat3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(n,d,C,I,f,y,B){this.rayFromWorld.copy(n),this.rayToWorld.copy(d),this.hitNormalWorld.copy(C),this.hitPointWorld.copy(I),this.shape=f,this.body=y,this.distance=B}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(n,d){n===void 0&&(n=new Vec3),d===void 0&&(d=new Vec3),this.from=n.clone(),this.to=d.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=C=>{}}intersectWorld(n,d){return this.mode=d.mode||Ray.ANY,this.result=d.result||new RaycastResult,this.skipBackfaces=!!d.skipBackfaces,this.collisionFilterMask=typeof d.collisionFilterMask<"u"?d.collisionFilterMask:-1,this.collisionFilterGroup=typeof d.collisionFilterGroup<"u"?d.collisionFilterGroup:-1,this.checkCollisionResponse=typeof d.checkCollisionResponse<"u"?d.checkCollisionResponse:!0,d.from&&this.from.copy(d.from),d.to&&this.to.copy(d.to),this.callback=d.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,n.broadphase.aabbQuery(n,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(n,d){d&&(this.result=d,this.updateDirection());const C=this.checkCollisionResponse;if(C&&!n.collisionResponse||(this.collisionFilterGroup&n.collisionFilterMask)===0||(n.collisionFilterGroup&this.collisionFilterMask)===0)return;const I=intersectBody_xi,f=intersectBody_qi;for(let y=0,B=n.shapes.length;y<B;y++){const _=n.shapes[y];if(!(C&&!_.collisionResponse)&&(n.quaternion.mult(n.shapeOrientations[y],f),n.quaternion.vmult(n.shapeOffsets[y],I),I.vadd(n.position,I),this.intersectShape(_,f,I,n),this.result.shouldStop))break}}intersectBodies(n,d){d&&(this.result=d,this.updateDirection());for(let C=0,I=n.length;!this.result.shouldStop&&C<I;C++)this.intersectBody(n[C])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(n,d,C,I){const f=this.from;if(distanceFromIntersection(f,this.direction,C)>n.boundingSphereRadius)return;const B=this[n.type];B&&B.call(this,n,d,C,I,n)}_intersectBox(n,d,C,I,f){return this._intersectConvex(n.convexPolyhedronRepresentation,d,C,I,f)}_intersectPlane(n,d,C,I,f){const y=this.from,B=this.to,_=this.direction,Z=new Vec3(0,0,1);d.vmult(Z,Z);const M=new Vec3;y.vsub(C,M);const V=M.dot(Z);B.vsub(C,M);const T=M.dot(Z);if(V*T>0||y.distanceTo(B)<V)return;const H=Z.dot(_);if(Math.abs(H)<this.precision)return;const F=new Vec3,O=new Vec3,$=new Vec3;y.vsub(C,F);const U=-Z.dot(F)/H;_.scale(U,O),y.vadd(O,$),this.reportIntersection(Z,$,f,I,-1)}getAABB(n){const{lowerBound:d,upperBound:C}=n,I=this.to,f=this.from;d.x=Math.min(I.x,f.x),d.y=Math.min(I.y,f.y),d.z=Math.min(I.z,f.z),C.x=Math.max(I.x,f.x),C.y=Math.max(I.y,f.y),C.z=Math.max(I.z,f.z)}_intersectHeightfield(n,d,C,I,f){n.data,n.elementSize;const y=intersectHeightfield_localRay;y.from.copy(this.from),y.to.copy(this.to),Transform.pointToLocalFrame(C,d,y.from,y.from),Transform.pointToLocalFrame(C,d,y.to,y.to),y.updateDirection();const B=intersectHeightfield_index;let _,Z,M,V;_=Z=0,M=V=n.data.length-1;const T=new AABB;y.getAABB(T),n.getIndexOfPosition(T.lowerBound.x,T.lowerBound.y,B,!0),_=Math.max(_,B[0]),Z=Math.max(Z,B[1]),n.getIndexOfPosition(T.upperBound.x,T.upperBound.y,B,!0),M=Math.min(M,B[0]+1),V=Math.min(V,B[1]+1);for(let H=_;H<M;H++)for(let F=Z;F<V;F++){if(this.result.shouldStop)return;if(n.getAabbAtIndex(H,F,T),!!T.overlapsRay(y)){if(n.getConvexTrianglePillar(H,F,!1),Transform.pointToWorldFrame(C,d,n.pillarOffset,worldPillarOffset),this._intersectConvex(n.pillarConvex,d,worldPillarOffset,I,f,intersectConvexOptions),this.result.shouldStop)return;n.getConvexTrianglePillar(H,F,!0),Transform.pointToWorldFrame(C,d,n.pillarOffset,worldPillarOffset),this._intersectConvex(n.pillarConvex,d,worldPillarOffset,I,f,intersectConvexOptions)}}}_intersectSphere(n,d,C,I,f){const y=this.from,B=this.to,_=n.radius,Z=(B.x-y.x)**2+(B.y-y.y)**2+(B.z-y.z)**2,M=2*((B.x-y.x)*(y.x-C.x)+(B.y-y.y)*(y.y-C.y)+(B.z-y.z)*(y.z-C.z)),V=(y.x-C.x)**2+(y.y-C.y)**2+(y.z-C.z)**2-_**2,T=M**2-4*Z*V,H=Ray_intersectSphere_intersectionPoint,F=Ray_intersectSphere_normal;if(!(T<0))if(T===0)y.lerp(B,T,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1);else{const O=(-M-Math.sqrt(T))/(2*Z),$=(-M+Math.sqrt(T))/(2*Z);if(O>=0&&O<=1&&(y.lerp(B,O,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1)),this.result.shouldStop)return;$>=0&&$<=1&&(y.lerp(B,$,H),H.vsub(C,F),F.normalize(),this.reportIntersection(F,H,f,I,-1))}}_intersectConvex(n,d,C,I,f,y){const B=intersectConvex_normal,_=intersectConvex_vector,Z=y&&y.faceList||null,M=n.faces,V=n.vertices,T=n.faceNormals,H=this.direction,F=this.from,O=this.to,$=F.distanceTo(O),U=Z?Z.length:M.length,ee=this.result;for(let Q=0;!ee.shouldStop&&Q<U;Q++){const ie=Z?Z[Q]:Q,ne=M[ie],le=T[ie],ae=d,ce=C;_.copy(V[ne[0]]),ae.vmult(_,_),_.vadd(ce,_),_.vsub(F,_),ae.vmult(le,B);const ge=H.dot(B);if(Math.abs(ge)<this.precision)continue;const he=B.dot(_)/ge;if(!(he<0)){H.scale(he,intersectPoint),intersectPoint.vadd(F,intersectPoint),a.copy(V[ne[0]]),ae.vmult(a,a),ce.vadd(a,a);for(let Ie=1;!ee.shouldStop&&Ie<ne.length-1;Ie++){b.copy(V[ne[Ie]]),c.copy(V[ne[Ie+1]]),ae.vmult(b,b),ae.vmult(c,c),ce.vadd(b,b),ce.vadd(c,c);const fe=intersectPoint.distanceTo(F);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||fe>$||this.reportIntersection(B,intersectPoint,f,I,ie)}}}}_intersectTrimesh(n,d,C,I,f,y){const B=intersectTrimesh_normal,_=intersectTrimesh_triangles,Z=intersectTrimesh_treeTransform,M=intersectConvex_vector,V=intersectTrimesh_localDirection,T=intersectTrimesh_localFrom,H=intersectTrimesh_localTo,F=intersectTrimesh_worldIntersectPoint,O=intersectTrimesh_worldNormal,$=n.indices;n.vertices;const U=this.from,ee=this.to,Q=this.direction;Z.position.copy(C),Z.quaternion.copy(d),Transform.vectorToLocalFrame(C,d,Q,V),Transform.pointToLocalFrame(C,d,U,T),Transform.pointToLocalFrame(C,d,ee,H),H.x*=n.scale.x,H.y*=n.scale.y,H.z*=n.scale.z,T.x*=n.scale.x,T.y*=n.scale.y,T.z*=n.scale.z,H.vsub(T,V),V.normalize();const ie=T.distanceSquared(H);n.tree.rayQuery(this,Z,_);for(let ne=0,le=_.length;!this.result.shouldStop&&ne!==le;ne++){const ae=_[ne];n.getNormal(ae,B),n.getVertex($[ae*3],a),a.vsub(T,M);const ce=V.dot(B),ge=B.dot(M)/ce;if(ge<0)continue;V.scale(ge,intersectPoint),intersectPoint.vadd(T,intersectPoint),n.getVertex($[ae*3+1],b),n.getVertex($[ae*3+2],c);const he=intersectPoint.distanceSquared(T);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||he>ie||(Transform.vectorToWorldFrame(d,B,O),Transform.pointToWorldFrame(C,d,intersectPoint,F),this.reportIntersection(O,F,f,I,ae))}_.length=0}reportIntersection(n,d,C,I,f){const y=this.from,B=this.to,_=y.distanceTo(d),Z=this.result;if(!(this.skipBackfaces&&n.dot(this.direction)>0))switch(Z.hitFaceIndex=typeof f<"u"?f:-1,this.mode){case Ray.ALL:this.hasHit=!0,Z.set(y,B,n,d,C,I,_),Z.hasHit=!0,this.callback(Z);break;case Ray.CLOSEST:(_<Z.distance||!Z.hasHit)&&(this.hasHit=!0,Z.hasHit=!0,Z.set(y,B,n,d,C,I,_));break;case Ray.ANY:this.hasHit=!0,Z.hasHit=!0,Z.set(y,B,n,d,C,I,_),Z.shouldStop=!0;break}}static pointInTriangle(n,d,C,I){I.vsub(d,v0),C.vsub(d,v1),n.vsub(d,v2);const f=v0.dot(v0),y=v0.dot(v1),B=v0.dot(v2),_=v1.dot(v1),Z=v1.dot(v2);let M,V;return(M=_*B-y*Z)>=0&&(V=f*Z-y*B)>=0&&M+V<f*_-y*y}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3;new Vec3;new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(u,n,d){d.vsub(u,v0);const C=v0.dot(n);return n.scale(C,intersect),intersect.vadd(u,intersect),d.distanceTo(intersect)}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Ray;new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Transform;new AABB;Shape.types.SPHERE,Shape.types.SPHERE|Shape.types.PLANE,Shape.types.BOX|Shape.types.BOX,Shape.types.SPHERE|Shape.types.BOX,Shape.types.PLANE|Shape.types.BOX,Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.HEIGHTFIELD,Shape.types.BOX|Shape.types.HEIGHTFIELD,Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,Shape.types.PARTICLE|Shape.types.SPHERE,Shape.types.PLANE|Shape.types.PARTICLE,Shape.types.BOX|Shape.types.PARTICLE,Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.CYLINDER,Shape.types.PLANE|Shape.types.CYLINDER,Shape.types.BOX|Shape.types.CYLINDER,Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,Shape.types.PARTICLE|Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.TRIMESH,Shape.types.PLANE|Shape.types.TRIMESH;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Ray;const performance$2=globalThis.performance||{};if(!performance$2.now){let u=Date.now();performance$2.timing&&performance$2.timing.navigationStart&&(u=performance$2.timing.navigationStart),performance$2.now=()=>Date.now()-u}new Vec3;const debugContext=reactExports.createContext(null),useDebugContext=()=>reactExports.useContext(debugContext),physicsContext=reactExports.createContext(null),usePhysicsContext=()=>{const u=reactExports.useContext(physicsContext);if(!u)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return u};new Vector3(1,1,1);new Vector3;new Matrix4;const temp=new Object3D;function useForwardedRef(u){const n=reactExports.useRef(null);return u&&typeof u!="function"?u:n}function capitalize(u){return u.charAt(0).toUpperCase()+u.slice(1)}function getUUID(u,n){const d=n===void 0?"":`/${n}`;return typeof u=="function"?null:u&&u.current&&`${u.current.uuid}${d}`}const e=new Euler,q$1=new Quaternion$2,quaternionToRotation=u=>n=>u(e.setFromQuaternion(q$1.fromArray(n)).toArray());let incrementingId=0;function subscribe(u,n,d,C,I,f){return f===void 0&&(f="bodies"),y=>{const B=incrementingId++;d[B]={[C]:y};const _=getUUID(u,I);return _&&n.subscribe({props:{id:B,target:f,type:C},uuid:_}),()=>{delete d[B],n.unsubscribe({props:B})}}}function prepare(u,n){let{position:d=[0,0,0],rotation:C=[0,0,0],userData:I={}}=n;u.userData=I,u.position.set(...d),u.rotation.set(...C),u.updateMatrix()}function setupCollision(u,n,d){let{onCollide:C,onCollideBegin:I,onCollideEnd:f}=n;u[d]={collide:C,collideBegin:I,collideEnd:f}}function useBody(u,n,d,C,I){C===void 0&&(C=null),I===void 0&&(I=[]);const f=useForwardedRef(C),{events:y,refs:B,scaleOverrides:_,subscriptions:Z,worker:M}=usePhysicsContext(),V=useDebugContext();reactExports.useLayoutEffect(()=>{f.current||(f.current=new Object3D);const H=f.current,F=M,O=H instanceof InstancedMesh?(H.instanceMatrix.setUsage(DynamicDrawUsage),H.count):1,$=H instanceof InstancedMesh?new Array(O).fill(0).map((ee,Q)=>`${H.uuid}/${Q}`):[H.uuid],U=H instanceof InstancedMesh?$.map((ee,Q)=>{const ie=n(Q);return prepare(temp,ie),H.setMatrixAt(Q,temp.matrix),H.instanceMatrix.needsUpdate=!0,B[ee]=H,V==null||V.add(ee,ie,u),setupCollision(y,ie,ee),{...ie,args:d(ie.args)}}):$.map((ee,Q)=>{const ie=n(Q);return prepare(H,ie),B[ee]=H,V==null||V.add(ee,ie,u),setupCollision(y,ie,ee),{...ie,args:d(ie.args)}});return F.addBodies({props:U.map(ee=>{let{onCollide:Q,onCollideBegin:ie,onCollideEnd:ne,...le}=ee;return{onCollide:!!Q,...le}}),type:u,uuid:$}),()=>{$.forEach(ee=>{delete B[ee],V==null||V.remove(ee),delete y[ee]}),F.removeBodies({uuid:$})}},I);const T=reactExports.useMemo(()=>{const H=(Q,ie)=>{const ne=`set${capitalize(Q)}`;return{set:le=>{const ae=getUUID(f,ie);ae&&M[ne]({props:le,uuid:ae})},subscribe:subscribe(f,M,Z,Q,ie)}},F=Q=>({copy:ne=>{let{w:le,x:ae,y:ce,z:ge}=ne;const he=getUUID(f,Q);he&&M.setQuaternion({props:[ae,ce,ge,le],uuid:he})},set:(ne,le,ae,ce)=>{const ge=getUUID(f,Q);ge&&M.setQuaternion({props:[ne,le,ae,ce],uuid:ge})},subscribe:subscribe(f,M,Z,"quaternion",Q)}),O=Q=>({copy:ie=>{let{x:ne,y:le,z:ae}=ie;const ce=getUUID(f,Q);ce&&M.setRotation({props:[ne,le,ae],uuid:ce})},set:(ie,ne,le)=>{const ae=getUUID(f,Q);ae&&M.setRotation({props:[ie,ne,le],uuid:ae})},subscribe:ie=>{const ne=incrementingId++,le="bodies",ae="quaternion",ce=getUUID(f,Q);return Z[ne]={[ae]:quaternionToRotation(ie)},ce&&M.subscribe({props:{id:ne,target:le,type:ae},uuid:ce}),()=>{delete Z[ne],M.unsubscribe({props:ne})}}}),$=(Q,ie)=>{const ne=`set${capitalize(Q)}`;return{copy:le=>{let{x:ae,y:ce,z:ge}=le;const he=getUUID(f,ie);he&&M[ne]({props:[ae,ce,ge],uuid:he})},set:(le,ae,ce)=>{const ge=getUUID(f,ie);ge&&M[ne]({props:[le,ae,ce],uuid:ge})},subscribe:subscribe(f,M,Z,Q,ie)}};function U(Q){return{allowSleep:H("allowSleep",Q),angularDamping:H("angularDamping",Q),angularFactor:$("angularFactor",Q),angularVelocity:$("angularVelocity",Q),applyForce(ie,ne){const le=getUUID(f,Q);le&&M.applyForce({props:[ie,ne],uuid:le})},applyImpulse(ie,ne){const le=getUUID(f,Q);le&&M.applyImpulse({props:[ie,ne],uuid:le})},applyLocalForce(ie,ne){const le=getUUID(f,Q);le&&M.applyLocalForce({props:[ie,ne],uuid:le})},applyLocalImpulse(ie,ne){const le=getUUID(f,Q);le&&M.applyLocalImpulse({props:[ie,ne],uuid:le})},applyTorque(ie){const ne=getUUID(f,Q);ne&&M.applyTorque({props:[ie],uuid:ne})},collisionFilterGroup:H("collisionFilterGroup",Q),collisionFilterMask:H("collisionFilterMask",Q),collisionResponse:H("collisionResponse",Q),fixedRotation:H("fixedRotation",Q),isTrigger:H("isTrigger",Q),linearDamping:H("linearDamping",Q),linearFactor:$("linearFactor",Q),mass:H("mass",Q),material:H("material",Q),position:$("position",Q),quaternion:F(Q),rotation:O(Q),scaleOverride(ie){const ne=getUUID(f,Q);ne&&(_[ne]=new Vector3(...ie))},sleep(){const ie=getUUID(f,Q);ie&&M.sleep({uuid:ie})},sleepSpeedLimit:H("sleepSpeedLimit",Q),sleepTimeLimit:H("sleepTimeLimit",Q),userData:H("userData",Q),velocity:$("velocity",Q),wakeUp(){const ie=getUUID(f,Q);ie&&M.wakeUp({uuid:ie})}}}const ee={};return{...U(void 0),at:Q=>ee[Q]||(ee[Q]=U(Q))}},[]);return[f,T]}function usePlane(u,n,d){return useBody("Plane",u,()=>[],n,d)}function useBox(u,n,d){const C=[1,1,1];return useBody("Box",u,function(I){return I===void 0&&(I=C),I},n,d)}function useCylinder(u,n,d){return useBody("Cylinder",u,function(C){return C===void 0&&(C=[]),C},n,d)}function useSphere(u,n,d){return useBody("Sphere",u,function(C){if(C===void 0&&(C=[1]),!Array.isArray(C))throw new Error("useSphere args must be an array");return[C[0]]},n,d)}const v=new Vector3,s=new Vector3(1,1,1),q=new Quaternion$2,m=new Matrix4;function apply(u,n,d,C,I){return C===void 0&&(C=s),u!==void 0?(m.compose(v.fromArray(n,u*3),q.fromArray(d,u*4),C),I&&(I.matrixAutoUpdate=!1,I.matrix.copy(m)),m):m.identity()}const unique=()=>{const u=[];return n=>u.includes(n)?!1:!!u.push(n)};function PhysicsProvider(u){let{allowSleep:n=!1,axisIndex:d=0,broadphase:C="Naive",children:I,defaultContactMaterial:f={contactEquationStiffness:1e6},frictionGravity:y=null,gravity:B=[0,-9.81,0],isPaused:_=!1,iterations:Z=5,maxSubSteps:M=10,quatNormalizeFast:V=!1,quatNormalizeSkip:T=0,shouldInvalidate:H=!0,size:F=1e3,solver:O="GS",stepSize:$=1/60,tolerance:U=.001}=u;const{invalidate:ee}=useThree(),[{bodies:Q,events:ie,refs:ne,scaleOverrides:le,subscriptions:ae,worker:ce}]=reactExports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new CannonWorkerAPI({allowSleep:n,axisIndex:d,broadphase:C,defaultContactMaterial:f,frictionGravity:y,gravity:B,iterations:Z,quatNormalizeFast:V,quatNormalizeSkip:T,size:F,solver:O,tolerance:U})}));let ge=0;const he=reactExports.useCallback((Ee,Ve)=>{_||(ge+=Ve,ce.step({maxSubSteps:M,stepSize:$,timeSinceLastCalled:ge}),ge=0)},[_,M,$]),Ie=Ee=>{var Ve;let{body:Ye,contact:{bi:be,bj:Be,...Ne},target:Ae,...Re}=Ee;const We=(Ve=ie[Ae])==null?void 0:Ve.collide;We&&We({body:ne[Ye],contact:{bi:ne[be],bj:ne[Be],...Ne},target:ne[Ae],...Re})},fe=Ee=>{var Ve,Ye;let{bodyA:be,bodyB:Be}=Ee;const Ne=(Ve=ie[be])==null?void 0:Ve.collideBegin;Ne&&Ne({body:ne[Be],op:"event",target:ne[be],type:"collideBegin"});const Ae=(Ye=ie[Be])==null?void 0:Ye.collideBegin;Ae&&Ae({body:ne[be],op:"event",target:ne[Be],type:"collideBegin"})},me=Ee=>{var Ve,Ye;let{bodyA:be,bodyB:Be}=Ee;const Ne=(Ve=ie[be])==null?void 0:Ve.collideEnd;Ne&&Ne({body:ne[Be],op:"event",target:ne[be],type:"collideEnd"});const Ae=(Ye=ie[Be])==null?void 0:Ye.collideEnd;Ae&&Ae({body:ne[be],op:"event",target:ne[Be],type:"collideEnd"})},Ge=Ee=>{let{active:Ve,bodies:Ye=[],observations:be,positions:Be,quaternions:Ne}=Ee;for(let Ae=0;Ae<Ye.length;Ae++)Q[Ye[Ae]]=Ae;if(be.forEach(Ae=>{let[Re,We,De]=Ae;const Ke=(ae[Re]||{})[De];Ke&&Ke(We)}),!!Ve){for(const Ae of Object.values(ne).filter(unique()))if(Ae instanceof InstancedMesh)for(let Re=0;Re<Ae.count;Re++){const We=`${Ae.uuid}/${Re}`,De=Q[We];De!==void 0&&(Ae.setMatrixAt(Re,apply(De,Be,Ne,le[We])),Ae.instanceMatrix.needsUpdate=!0)}else{const Re=le[Ae.uuid]||Ae.scale;apply(Q[Ae.uuid],Be,Ne,Re,Ae)}H&&ee()}},Ze=Ee=>{var Ve;let{body:Ye,ray:{uuid:be,...Be},...Ne}=Ee;const Ae=(Ve=ie[be])==null?void 0:Ve.rayhit;Ae&&Ae({body:Ye?ne[Ye]:null,ray:{uuid:be,...Be},...Ne})};useFrame(he),reactExports.useEffect(()=>(ce.connect(),ce.init(),ce.on("collide",Ie),ce.on("collideBegin",fe),ce.on("collideEnd",me),ce.on("frame",Ge),ce.on("rayhit",Ze),()=>{ce.terminate(),ce.removeAllListeners()}),[]),reactExports.useEffect(()=>{ce.axisIndex=d},[d]),reactExports.useEffect(()=>{ce.broadphase=C},[C]),reactExports.useEffect(()=>{ce.gravity=B},[B]),reactExports.useEffect(()=>{ce.iterations=Z},[Z]),reactExports.useEffect(()=>{ce.tolerance=U},[U]);const ye=reactExports.useMemo(()=>({bodies:Q,events:ie,refs:ne,scaleOverrides:le,subscriptions:ae,worker:ce}),[Q,ie,ne,ae,ce]);return jsxRuntimeExports.jsx(physicsContext.Provider,{value:ye,children:I})}function _extends(){return _extends=Object.assign?Object.assign.bind():function(u){for(var n=1;n<arguments.length;n++){var d=arguments[n];for(var C in d)({}).hasOwnProperty.call(d,C)&&(u[C]=d[C])}return u},_extends.apply(null,arguments)}var __defProp$1=Object.defineProperty,__defNormalProp$1=(u,n,d)=>n in u?__defProp$1(u,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[n]=d,__publicField$1=(u,n,d)=>(__defNormalProp$1(u,n+"",d),d);class EventDispatcher{constructor(){__publicField$1(this,"_listeners")}addEventListener(n,d){this._listeners===void 0&&(this._listeners={});const C=this._listeners;C[n]===void 0&&(C[n]=[]),C[n].indexOf(d)===-1&&C[n].push(d)}hasEventListener(n,d){if(this._listeners===void 0)return!1;const C=this._listeners;return C[n]!==void 0&&C[n].indexOf(d)!==-1}removeEventListener(n,d){if(this._listeners===void 0)return;const I=this._listeners[n];if(I!==void 0){const f=I.indexOf(d);f!==-1&&I.splice(f,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const C=this._listeners[n.type];if(C!==void 0){n.target=this;const I=C.slice(0);for(let f=0,y=I.length;f<y;f++)I[f].call(this,n);n.target=null}}}var __defProp=Object.defineProperty,__defNormalProp=(u,n,d)=>n in u?__defProp(u,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[n]=d,__publicField=(u,n,d)=>(__defNormalProp(u,typeof n!="symbol"?n+"":n,d),d);const _ray=new Ray$2,_plane=new Plane,TILT_LIMIT=Math.cos(70*(Math.PI/180)),moduloWrapAround=(u,n)=>(u%n+n)%n;let OrbitControls$1=class extends EventDispatcher{constructor(n,d){super(),__publicField(this,"object"),__publicField(this,"domElement"),__publicField(this,"enabled",!0),__publicField(this,"target",new Vector3),__publicField(this,"minDistance",0),__publicField(this,"maxDistance",1/0),__publicField(this,"minZoom",0),__publicField(this,"maxZoom",1/0),__publicField(this,"minPolarAngle",0),__publicField(this,"maxPolarAngle",Math.PI),__publicField(this,"minAzimuthAngle",-1/0),__publicField(this,"maxAzimuthAngle",1/0),__publicField(this,"enableDamping",!1),__publicField(this,"dampingFactor",.05),__publicField(this,"enableZoom",!0),__publicField(this,"zoomSpeed",1),__publicField(this,"enableRotate",!0),__publicField(this,"rotateSpeed",1),__publicField(this,"enablePan",!0),__publicField(this,"panSpeed",1),__publicField(this,"screenSpacePanning",!0),__publicField(this,"keyPanSpeed",7),__publicField(this,"zoomToCursor",!1),__publicField(this,"autoRotate",!1),__publicField(this,"autoRotateSpeed",2),__publicField(this,"reverseOrbit",!1),__publicField(this,"reverseHorizontalOrbit",!1),__publicField(this,"reverseVerticalOrbit",!1),__publicField(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),__publicField(this,"mouseButtons",{LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN}),__publicField(this,"touches",{ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN}),__publicField(this,"target0"),__publicField(this,"position0"),__publicField(this,"zoom0"),__publicField(this,"_domElementKeyEvents",null),__publicField(this,"getPolarAngle"),__publicField(this,"getAzimuthalAngle"),__publicField(this,"setPolarAngle"),__publicField(this,"setAzimuthalAngle"),__publicField(this,"getDistance"),__publicField(this,"getZoomScale"),__publicField(this,"listenToKeyEvents"),__publicField(this,"stopListenToKeyEvents"),__publicField(this,"saveState"),__publicField(this,"reset"),__publicField(this,"update"),__publicField(this,"connect"),__publicField(this,"dispose"),__publicField(this,"dollyIn"),__publicField(this,"dollyOut"),__publicField(this,"getScale"),__publicField(this,"setScale"),this.object=n,this.domElement=d,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>M.phi,this.getAzimuthalAngle=()=>M.theta,this.setPolarAngle=_e=>{let Pe=moduloWrapAround(_e,2*Math.PI),Je=M.phi;Je<0&&(Je+=2*Math.PI),Pe<0&&(Pe+=2*Math.PI);let ze=Math.abs(Pe-Je);2*Math.PI-ze<ze&&(Pe<Je?Pe+=2*Math.PI:Je+=2*Math.PI),V.phi=Pe-Je,C.update()},this.setAzimuthalAngle=_e=>{let Pe=moduloWrapAround(_e,2*Math.PI),Je=M.theta;Je<0&&(Je+=2*Math.PI),Pe<0&&(Pe+=2*Math.PI);let ze=Math.abs(Pe-Je);2*Math.PI-ze<ze&&(Pe<Je?Pe+=2*Math.PI:Je+=2*Math.PI),V.theta=Pe-Je,C.update()},this.getDistance=()=>C.object.position.distanceTo(C.target),this.listenToKeyEvents=_e=>{_e.addEventListener("keydown",Dt),this._domElementKeyEvents=_e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Dt),this._domElementKeyEvents=null},this.saveState=()=>{C.target0.copy(C.target),C.position0.copy(C.object.position),C.zoom0=C.object.zoom},this.reset=()=>{C.target.copy(C.target0),C.object.position.copy(C.position0),C.object.zoom=C.zoom0,C.object.updateProjectionMatrix(),C.dispatchEvent(I),C.update(),_=B.NONE},this.update=(()=>{const _e=new Vector3,Pe=new Vector3(0,1,0),Je=new Quaternion$2().setFromUnitVectors(n.up,Pe),ze=Je.clone().invert(),Kt=new Vector3,ct=new Quaternion$2,bt=2*Math.PI;return function(){const $t=C.object.position;Je.setFromUnitVectors(n.up,Pe),ze.copy(Je).invert(),_e.copy($t).sub(C.target),_e.applyQuaternion(Je),M.setFromVector3(_e),C.autoRotate&&_===B.NONE&&Ge(fe()),C.enableDamping?(M.theta+=V.theta*C.dampingFactor,M.phi+=V.phi*C.dampingFactor):(M.theta+=V.theta,M.phi+=V.phi);let si=C.minAzimuthAngle,Bi=C.maxAzimuthAngle;isFinite(si)&&isFinite(Bi)&&(si<-Math.PI?si+=bt:si>Math.PI&&(si-=bt),Bi<-Math.PI?Bi+=bt:Bi>Math.PI&&(Bi-=bt),si<=Bi?M.theta=Math.max(si,Math.min(Bi,M.theta)):M.theta=M.theta>(si+Bi)/2?Math.max(si,M.theta):Math.min(Bi,M.theta)),M.phi=Math.max(C.minPolarAngle,Math.min(C.maxPolarAngle,M.phi)),M.makeSafe(),C.enableDamping===!0?C.target.addScaledVector(H,C.dampingFactor):C.target.add(H),C.zoomToCursor&&ge||C.object.isOrthographicCamera?M.radius=Ae(M.radius):M.radius=Ae(M.radius*T),_e.setFromSpherical(M),_e.applyQuaternion(ze),$t.copy(C.target).add(_e),C.object.matrixAutoUpdate||C.object.updateMatrix(),C.object.lookAt(C.target),C.enableDamping===!0?(V.theta*=1-C.dampingFactor,V.phi*=1-C.dampingFactor,H.multiplyScalar(1-C.dampingFactor)):(V.set(0,0,0),H.set(0,0,0));let Ki=!1;if(C.zoomToCursor&&ge){let Gi=null;if(C.object instanceof PerspectiveCamera&&C.object.isPerspectiveCamera){const _i=_e.length();Gi=Ae(_i*T);const Di=_i-Gi;C.object.position.addScaledVector(ae,Di),C.object.updateMatrixWorld()}else if(C.object.isOrthographicCamera){const _i=new Vector3(ce.x,ce.y,0);_i.unproject(C.object),C.object.zoom=Math.max(C.minZoom,Math.min(C.maxZoom,C.object.zoom/T)),C.object.updateProjectionMatrix(),Ki=!0;const Di=new Vector3(ce.x,ce.y,0);Di.unproject(C.object),C.object.position.sub(Di).add(_i),C.object.updateMatrixWorld(),Gi=_e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),C.zoomToCursor=!1;Gi!==null&&(C.screenSpacePanning?C.target.set(0,0,-1).transformDirection(C.object.matrix).multiplyScalar(Gi).add(C.object.position):(_ray.origin.copy(C.object.position),_ray.direction.set(0,0,-1).transformDirection(C.object.matrix),Math.abs(C.object.up.dot(_ray.direction))<TILT_LIMIT?n.lookAt(C.target):(_plane.setFromNormalAndCoplanarPoint(C.object.up,C.target),_ray.intersectPlane(_plane,C.target))))}else C.object instanceof OrthographicCamera&&C.object.isOrthographicCamera&&(Ki=T!==1,Ki&&(C.object.zoom=Math.max(C.minZoom,Math.min(C.maxZoom,C.object.zoom/T)),C.object.updateProjectionMatrix()));return T=1,ge=!1,Ki||Kt.distanceToSquared(C.object.position)>Z||8*(1-ct.dot(C.object.quaternion))>Z?(C.dispatchEvent(I),Kt.copy(C.object.position),ct.copy(C.object.quaternion),Ki=!1,!0):!1}})(),this.connect=_e=>{C.domElement=_e,C.domElement.style.touchAction="none",C.domElement.addEventListener("contextmenu",it),C.domElement.addEventListener("pointerdown",ve),C.domElement.addEventListener("pointercancel",ht),C.domElement.addEventListener("wheel",ft)},this.dispose=()=>{var _e,Pe,Je,ze,Kt,ct;C.domElement&&(C.domElement.style.touchAction="auto"),(_e=C.domElement)==null||_e.removeEventListener("contextmenu",it),(Pe=C.domElement)==null||Pe.removeEventListener("pointerdown",ve),(Je=C.domElement)==null||Je.removeEventListener("pointercancel",ht),(ze=C.domElement)==null||ze.removeEventListener("wheel",ft),(Kt=C.domElement)==null||Kt.ownerDocument.removeEventListener("pointermove",et),(ct=C.domElement)==null||ct.ownerDocument.removeEventListener("pointerup",ht),C._domElementKeyEvents!==null&&C._domElementKeyEvents.removeEventListener("keydown",Dt)};const C=this,I={type:"change"},f={type:"start"},y={type:"end"},B={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let _=B.NONE;const Z=1e-6,M=new Spherical,V=new Spherical;let T=1;const H=new Vector3,F=new Vector2,O=new Vector2,$=new Vector2,U=new Vector2,ee=new Vector2,Q=new Vector2,ie=new Vector2,ne=new Vector2,le=new Vector2,ae=new Vector3,ce=new Vector2;let ge=!1;const he=[],Ie={};function fe(){return 2*Math.PI/60/60*C.autoRotateSpeed}function me(){return Math.pow(.95,C.zoomSpeed)}function Ge(_e){C.reverseOrbit||C.reverseHorizontalOrbit?V.theta+=_e:V.theta-=_e}function Ze(_e){C.reverseOrbit||C.reverseVerticalOrbit?V.phi+=_e:V.phi-=_e}const ye=(()=>{const _e=new Vector3;return function(Je,ze){_e.setFromMatrixColumn(ze,0),_e.multiplyScalar(-Je),H.add(_e)}})(),Ee=(()=>{const _e=new Vector3;return function(Je,ze){C.screenSpacePanning===!0?_e.setFromMatrixColumn(ze,1):(_e.setFromMatrixColumn(ze,0),_e.crossVectors(C.object.up,_e)),_e.multiplyScalar(Je),H.add(_e)}})(),Ve=(()=>{const _e=new Vector3;return function(Je,ze){const Kt=C.domElement;if(Kt&&C.object instanceof PerspectiveCamera&&C.object.isPerspectiveCamera){const ct=C.object.position;_e.copy(ct).sub(C.target);let bt=_e.length();bt*=Math.tan(C.object.fov/2*Math.PI/180),ye(2*Je*bt/Kt.clientHeight,C.object.matrix),Ee(2*ze*bt/Kt.clientHeight,C.object.matrix)}else Kt&&C.object instanceof OrthographicCamera&&C.object.isOrthographicCamera?(ye(Je*(C.object.right-C.object.left)/C.object.zoom/Kt.clientWidth,C.object.matrix),Ee(ze*(C.object.top-C.object.bottom)/C.object.zoom/Kt.clientHeight,C.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),C.enablePan=!1)}})();function Ye(_e){C.object instanceof PerspectiveCamera&&C.object.isPerspectiveCamera||C.object instanceof OrthographicCamera&&C.object.isOrthographicCamera?T=_e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),C.enableZoom=!1)}function be(_e){Ye(T/_e)}function Be(_e){Ye(T*_e)}function Ne(_e){if(!C.zoomToCursor||!C.domElement)return;ge=!0;const Pe=C.domElement.getBoundingClientRect(),Je=_e.clientX-Pe.left,ze=_e.clientY-Pe.top,Kt=Pe.width,ct=Pe.height;ce.x=Je/Kt*2-1,ce.y=-(ze/ct)*2+1,ae.set(ce.x,ce.y,1).unproject(C.object).sub(C.object.position).normalize()}function Ae(_e){return Math.max(C.minDistance,Math.min(C.maxDistance,_e))}function Re(_e){F.set(_e.clientX,_e.clientY)}function We(_e){Ne(_e),ie.set(_e.clientX,_e.clientY)}function De(_e){U.set(_e.clientX,_e.clientY)}function Fe(_e){O.set(_e.clientX,_e.clientY),$.subVectors(O,F).multiplyScalar(C.rotateSpeed);const Pe=C.domElement;Pe&&(Ge(2*Math.PI*$.x/Pe.clientHeight),Ze(2*Math.PI*$.y/Pe.clientHeight)),F.copy(O),C.update()}function Ke(_e){ne.set(_e.clientX,_e.clientY),le.subVectors(ne,ie),le.y>0?be(me()):le.y<0&&Be(me()),ie.copy(ne),C.update()}function Rt(_e){ee.set(_e.clientX,_e.clientY),Q.subVectors(ee,U).multiplyScalar(C.panSpeed),Ve(Q.x,Q.y),U.copy(ee),C.update()}function dt(_e){Ne(_e),_e.deltaY<0?Be(me()):_e.deltaY>0&&be(me()),C.update()}function Ut(_e){let Pe=!1;switch(_e.code){case C.keys.UP:Ve(0,C.keyPanSpeed),Pe=!0;break;case C.keys.BOTTOM:Ve(0,-C.keyPanSpeed),Pe=!0;break;case C.keys.LEFT:Ve(C.keyPanSpeed,0),Pe=!0;break;case C.keys.RIGHT:Ve(-C.keyPanSpeed,0),Pe=!0;break}Pe&&(_e.preventDefault(),C.update())}function rt(){if(he.length==1)F.set(he[0].pageX,he[0].pageY);else{const _e=.5*(he[0].pageX+he[1].pageX),Pe=.5*(he[0].pageY+he[1].pageY);F.set(_e,Pe)}}function nt(){if(he.length==1)U.set(he[0].pageX,he[0].pageY);else{const _e=.5*(he[0].pageX+he[1].pageX),Pe=.5*(he[0].pageY+he[1].pageY);U.set(_e,Pe)}}function we(){const _e=he[0].pageX-he[1].pageX,Pe=he[0].pageY-he[1].pageY,Je=Math.sqrt(_e*_e+Pe*Pe);ie.set(0,Je)}function Jt(){C.enableZoom&&we(),C.enablePan&&nt()}function It(){C.enableZoom&&we(),C.enableRotate&&rt()}function Ht(_e){if(he.length==1)O.set(_e.pageX,_e.pageY);else{const Je=_t(_e),ze=.5*(_e.pageX+Je.x),Kt=.5*(_e.pageY+Je.y);O.set(ze,Kt)}$.subVectors(O,F).multiplyScalar(C.rotateSpeed);const Pe=C.domElement;Pe&&(Ge(2*Math.PI*$.x/Pe.clientHeight),Ze(2*Math.PI*$.y/Pe.clientHeight)),F.copy(O)}function mt(_e){if(he.length==1)ee.set(_e.pageX,_e.pageY);else{const Pe=_t(_e),Je=.5*(_e.pageX+Pe.x),ze=.5*(_e.pageY+Pe.y);ee.set(Je,ze)}Q.subVectors(ee,U).multiplyScalar(C.panSpeed),Ve(Q.x,Q.y),U.copy(ee)}function ni(_e){const Pe=_t(_e),Je=_e.pageX-Pe.x,ze=_e.pageY-Pe.y,Kt=Math.sqrt(Je*Je+ze*ze);ne.set(0,Kt),le.set(0,Math.pow(ne.y/ie.y,C.zoomSpeed)),be(le.y),ie.copy(ne)}function kt(_e){C.enableZoom&&ni(_e),C.enablePan&&mt(_e)}function Me(_e){C.enableZoom&&ni(_e),C.enableRotate&&Ht(_e)}function ve(_e){var Pe,Je;C.enabled!==!1&&(he.length===0&&((Pe=C.domElement)==null||Pe.ownerDocument.addEventListener("pointermove",et),(Je=C.domElement)==null||Je.ownerDocument.addEventListener("pointerup",ht)),Gt(_e),_e.pointerType==="touch"?jt(_e):Xt(_e))}function et(_e){C.enabled!==!1&&(_e.pointerType==="touch"?ii(_e):Ue(_e))}function ht(_e){var Pe,Je,ze;Zt(_e),he.length===0&&((Pe=C.domElement)==null||Pe.releasePointerCapture(_e.pointerId),(Je=C.domElement)==null||Je.ownerDocument.removeEventListener("pointermove",et),(ze=C.domElement)==null||ze.ownerDocument.removeEventListener("pointerup",ht)),C.dispatchEvent(y),_=B.NONE}function Xt(_e){let Pe;switch(_e.button){case 0:Pe=C.mouseButtons.LEFT;break;case 1:Pe=C.mouseButtons.MIDDLE;break;case 2:Pe=C.mouseButtons.RIGHT;break;default:Pe=-1}switch(Pe){case MOUSE.DOLLY:if(C.enableZoom===!1)return;We(_e),_=B.DOLLY;break;case MOUSE.ROTATE:if(_e.ctrlKey||_e.metaKey||_e.shiftKey){if(C.enablePan===!1)return;De(_e),_=B.PAN}else{if(C.enableRotate===!1)return;Re(_e),_=B.ROTATE}break;case MOUSE.PAN:if(_e.ctrlKey||_e.metaKey||_e.shiftKey){if(C.enableRotate===!1)return;Re(_e),_=B.ROTATE}else{if(C.enablePan===!1)return;De(_e),_=B.PAN}break;default:_=B.NONE}_!==B.NONE&&C.dispatchEvent(f)}function Ue(_e){if(C.enabled!==!1)switch(_){case B.ROTATE:if(C.enableRotate===!1)return;Fe(_e);break;case B.DOLLY:if(C.enableZoom===!1)return;Ke(_e);break;case B.PAN:if(C.enablePan===!1)return;Rt(_e);break}}function ft(_e){C.enabled===!1||C.enableZoom===!1||_!==B.NONE&&_!==B.ROTATE||(_e.preventDefault(),C.dispatchEvent(f),dt(_e),C.dispatchEvent(y))}function Dt(_e){C.enabled===!1||C.enablePan===!1||Ut(_e)}function jt(_e){switch(Nt(_e),he.length){case 1:switch(C.touches.ONE){case TOUCH.ROTATE:if(C.enableRotate===!1)return;rt(),_=B.TOUCH_ROTATE;break;case TOUCH.PAN:if(C.enablePan===!1)return;nt(),_=B.TOUCH_PAN;break;default:_=B.NONE}break;case 2:switch(C.touches.TWO){case TOUCH.DOLLY_PAN:if(C.enableZoom===!1&&C.enablePan===!1)return;Jt(),_=B.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(C.enableZoom===!1&&C.enableRotate===!1)return;It(),_=B.TOUCH_DOLLY_ROTATE;break;default:_=B.NONE}break;default:_=B.NONE}_!==B.NONE&&C.dispatchEvent(f)}function ii(_e){switch(Nt(_e),_){case B.TOUCH_ROTATE:if(C.enableRotate===!1)return;Ht(_e),C.update();break;case B.TOUCH_PAN:if(C.enablePan===!1)return;mt(_e),C.update();break;case B.TOUCH_DOLLY_PAN:if(C.enableZoom===!1&&C.enablePan===!1)return;kt(_e),C.update();break;case B.TOUCH_DOLLY_ROTATE:if(C.enableZoom===!1&&C.enableRotate===!1)return;Me(_e),C.update();break;default:_=B.NONE}}function it(_e){C.enabled!==!1&&_e.preventDefault()}function Gt(_e){he.push(_e)}function Zt(_e){delete Ie[_e.pointerId];for(let Pe=0;Pe<he.length;Pe++)if(he[Pe].pointerId==_e.pointerId){he.splice(Pe,1);return}}function Nt(_e){let Pe=Ie[_e.pointerId];Pe===void 0&&(Pe=new Vector2,Ie[_e.pointerId]=Pe),Pe.set(_e.pageX,_e.pageY)}function _t(_e){const Pe=_e.pointerId===he[0].pointerId?he[1]:he[0];return Ie[Pe.pointerId]}this.dollyIn=(_e=me())=>{Be(_e),C.update()},this.dollyOut=(_e=me())=>{be(_e),C.update()},this.getScale=()=>T,this.setScale=_e=>{Ye(_e),C.update()},this.getZoomScale=()=>me(),d!==void 0&&this.connect(d),this.update()}};function shaderMaterial(u,n,d,C){var I;return I=class extends ShaderMaterial{constructor(f){super({vertexShader:n,fragmentShader:d,...f});for(const y in u)this.uniforms[y]=new Uniform(u[y]),Object.defineProperty(this,y,{get(){return this.uniforms[y].value},set(B){this.uniforms[y].value=B}})}},I.key=MathUtils.generateUUID(),I}const getVersion=()=>parseInt(REVISION.replace(/\D+/g,"")),version$1=getVersion(),OrbitControls=reactExports.forwardRef(({makeDefault:u,camera:n,regress:d,domElement:C,enableDamping:I=!0,keyEvents:f=!1,onChange:y,onStart:B,onEnd:_,...Z},M)=>{const V=useThree(le=>le.invalidate),T=useThree(le=>le.camera),H=useThree(le=>le.gl),F=useThree(le=>le.events),O=useThree(le=>le.setEvents),$=useThree(le=>le.set),U=useThree(le=>le.get),ee=useThree(le=>le.performance),Q=n||T,ie=C||F.connected||H.domElement,ne=reactExports.useMemo(()=>new OrbitControls$1(Q),[Q]);return useFrame(()=>{ne.enabled&&ne.update()},-1),reactExports.useEffect(()=>(f&&ne.connect(f===!0?ie:f),ne.connect(ie),()=>void ne.dispose()),[f,ie,d,ne,V]),reactExports.useEffect(()=>{const le=ge=>{V(),d&&ee.regress(),y&&y(ge)},ae=ge=>{B&&B(ge)},ce=ge=>{_&&_(ge)};return ne.addEventListener("change",le),ne.addEventListener("start",ae),ne.addEventListener("end",ce),()=>{ne.removeEventListener("start",ae),ne.removeEventListener("end",ce),ne.removeEventListener("change",le)}},[y,B,_,ne,V,O]),reactExports.useEffect(()=>{if(u){const le=U().controls;return $({controls:ne}),()=>$({controls:le})}},[u,ne]),reactExports.createElement("primitive",_extends({ref:M,object:ne,enableDamping:I},Z))}),GridMaterial=shaderMaterial({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new Color,sectionColor:new Color,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Vector3,worldPlanePosition:new Vector3},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${version$1>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Grid=reactExports.forwardRef(({args:u,cellColor:n="#000000",sectionColor:d="#2080ff",cellSize:C=.5,sectionSize:I=1,followCamera:f=!1,infiniteGrid:y=!1,fadeDistance:B=100,fadeStrength:_=1,fadeFrom:Z=1,cellThickness:M=.5,sectionThickness:V=1,side:T=BackSide,...H},F)=>{extend({GridMaterial});const O=reactExports.useRef(null);reactExports.useImperativeHandle(F,()=>O.current,[]);const $=new Plane,U=new Vector3(0,1,0),ee=new Vector3(0,0,0);useFrame(ne=>{$.setFromNormalAndCoplanarPoint(U,ee).applyMatrix4(O.current.matrixWorld);const le=O.current.material,ae=le.uniforms.worldCamProjPosition,ce=le.uniforms.worldPlanePosition;$.projectPoint(ne.camera.position,ae.value),ce.value.set(0,0,0).applyMatrix4(O.current.matrixWorld)});const Q={cellSize:C,sectionSize:I,cellColor:n,sectionColor:d,cellThickness:M,sectionThickness:V},ie={fadeDistance:B,fadeStrength:_,fadeFrom:Z,infiniteGrid:y,followCamera:f};return reactExports.createElement("mesh",_extends({ref:O,frustumCulled:!1},H),reactExports.createElement("gridMaterial",_extends({transparent:!0,"extensions-derivatives":!0,side:T},Q,ie)),reactExports.createElement("planeGeometry",{args:u}))});var jxg={};try{typeof JXG=="object"&&!JXG.extend&&(jxg=JXG)}catch{}jxg.extend=function(u,n,d,C){var I,f;d=d||!1,C=C||!1;for(I in n)(!d||d&&n.hasOwnProperty(I))&&(C?f=I.toLowerCase():f=I,u[f]=n[I])};jxg.defineConstant=function(u,n,d,C){C=C||!1,!(C&&jxg.exists(u[n]))&&Object.defineProperty(u,n,{value:d,writable:!1,enumerable:!0,configurable:!1})};jxg.extendConstants=function(u,n,d,C){var I,f;d=d||!1,C=C||!1;for(I in n)(!d||d&&n.hasOwnProperty(I))&&(C?f=I.toUpperCase():f=I,this.defineConstant(u,f,n[I]))};jxg.extend(jxg,{boards:{},readers:{},elements:{},registerElement:function(u,n){u=u.toLowerCase(),this.elements[u]=n},registerReader:function(u,n){var d,C;for(d=0;d<n.length;d++)C=n[d].toLowerCase(),typeof this.readers[C]!="function"&&(this.readers[C]=u)},shortcut:function(u,n){return function(){return u[n].apply(this,arguments)}},getRef:function(u,n){return jxg.deprecated("JXG.getRef()","Board.select()"),u.select(n)},getReference:function(u,n){return jxg.deprecated("JXG.getReference()","Board.select()"),u.select(n)},getBoardByContainerId:function(u){var n;for(n in JXG.boards)if(JXG.boards.hasOwnProperty(n)&&JXG.boards[n].container===u)return JXG.boards[n];return null},deprecated:function(u,n){var d=u+" is deprecated.";n&&(d+=" Please use "+n+" instead."),jxg.warn(d)},warn:function(u){typeof window=="object"&&window.console&&console.warn?console.warn("WARNING:",u):typeof document=="object"&&document.getElementById("warning")&&(document.getElementById("debug").innerHTML+="WARNING: "+u+"<br />")},debugInt:function(u){var n,d;for(n=0;n<arguments.length;n++)d=arguments[n],typeof window=="object"&&window.console&&console.log?console.log(d):typeof document=="object"&&document.getElementById("debug")&&(document.getElementById("debug").innerHTML+=d+"<br/>")},debugWST:function(u){var n=new Error;jxg.debugInt.apply(this,arguments),n&&n.stack&&(jxg.debugInt("stacktrace"),jxg.debugInt(n.stack.split(`
`).slice(1).join(`
`)))},debugLine:function(u){var n=new Error;jxg.debugInt.apply(this,arguments),n&&n.stack&&jxg.debugInt("Called from",n.stack.split(`
`).slice(2,3).join(`
`))},debug:function(u){jxg.debugInt.apply(this,arguments)},themes:{}});const JXG$1=jxg;var major=1,minor=10,patch=1,version=major+"."+minor+"."+patch,constants;constants={version,licenseText:"JSXGraph v"+version+" Copyright (C) see https://jsxgraph.org",COORDS_BY_USER:1,COORDS_BY_SCREEN:2,OBJECT_TYPE_ARC:1,OBJECT_TYPE_ARROW:2,OBJECT_TYPE_AXIS:3,OBJECT_TYPE_AXISPOINT:4,OBJECT_TYPE_TICKS:5,OBJECT_TYPE_CIRCLE:6,OBJECT_TYPE_CONIC:7,OBJECT_TYPE_CURVE:8,OBJECT_TYPE_GLIDER:9,OBJECT_TYPE_IMAGE:10,OBJECT_TYPE_LINE:11,OBJECT_TYPE_POINT:12,OBJECT_TYPE_SLIDER:13,OBJECT_TYPE_CAS:14,OBJECT_TYPE_GXTCAS:15,OBJECT_TYPE_POLYGON:16,OBJECT_TYPE_SECTOR:17,OBJECT_TYPE_TEXT:18,OBJECT_TYPE_ANGLE:19,OBJECT_TYPE_INTERSECTION:20,OBJECT_TYPE_TURTLE:21,OBJECT_TYPE_VECTOR:22,OBJECT_TYPE_OPROJECT:23,OBJECT_TYPE_GRID:24,OBJECT_TYPE_TANGENT:25,OBJECT_TYPE_HTMLSLIDER:26,OBJECT_TYPE_CHECKBOX:27,OBJECT_TYPE_INPUT:28,OBJECT_TYPE_BUTTON:29,OBJECT_TYPE_TRANSFORMATION:30,OBJECT_TYPE_FOREIGNOBJECT:31,OBJECT_TYPE_VIEW3D:32,OBJECT_TYPE_POINT3D:33,OBJECT_TYPE_LINE3D:34,OBJECT_TYPE_PLANE3D:35,OBJECT_TYPE_CURVE3D:36,OBJECT_TYPE_SURFACE3D:37,OBJECT_TYPE_MEASUREMENT:38,OBJECT_TYPE_INTERSECTION_LINE3D:39,OBJECT_TYPE_SPHERE3D:40,OBJECT_TYPE_CIRCLE3D:41,OBJECT_TYPE_INTERSECTION_CIRCLE3D:42,OBJECT_TYPE_TEXT3D:43,OBJECT_CLASS_POINT:1,OBJECT_CLASS_LINE:2,OBJECT_CLASS_CIRCLE:3,OBJECT_CLASS_CURVE:4,OBJECT_CLASS_AREA:5,OBJECT_CLASS_OTHER:6,OBJECT_CLASS_TEXT:7,OBJECT_CLASS_3D:8};JXG$1.extendConstants(JXG$1,constants);const Const=constants;var undef,memoizer=function(u){var n,d;return u.memo||(n={},d=Array.prototype.join,u.memo=function(){var C=d.call(arguments);return n[C]!==undef?n[C]:n[C]=u.apply(this,arguments)}),u.memo};JXG$1.Math={eps:1e-6,relDif:function(u,n){var d=Math.abs(u),C=Math.abs(n);return C=Math.max(d,C),C===0?0:Math.abs(u-n)/C},mod:function(u,n){return u-Math.floor(u/n)*n},wrap:function(u,n,d){return n+this.mod(u-n,d-n)},clamp:function(u,n,d){return Math.min(Math.max(u,n),d)},wrapAndClamp:function(u,n,d,C){var I=.5*(n+d),f=.5*C;return this.clamp(this.wrap(u,I-f,I+f),n,d)},vector:function(u,n){var d,C;for(n=n||0,d=[],C=0;C<u;C++)d[C]=n;return d},matrix:function(u,n,d){var C,I,f;for(d=d||0,n=n||u,C=[],I=0;I<u;I++)for(C[I]=[],f=0;f<n;f++)C[I][f]=d;return C},identity:function(u,n){var d,C;for(n===undef&&typeof n!="number"&&(n=u),d=this.matrix(u,n),C=0;C<Math.min(u,n);C++)d[C][C]=1;return d},frustum:function(u,n,d,C,I,f){var y=this.matrix(4,4);return y[0][0]=I*2/(n-u),y[0][1]=0,y[0][2]=(n+u)/(n-u),y[0][3]=0,y[1][0]=0,y[1][1]=I*2/(C-d),y[1][2]=(C+d)/(C-d),y[1][3]=0,y[2][0]=0,y[2][1]=0,y[2][2]=-(f+I)/(f-I),y[2][3]=-(f*I*2)/(f-I),y[3][0]=0,y[3][1]=0,y[3][2]=-1,y[3][3]=0,y},projection:function(u,n,d,C){var I=d*Math.tan(u/2),f=I*n;return this.frustum(-f,f,-I,I,d,C)},matVecMult:function(u,n){var d,C,I,f=u.length,y=n.length,B=[];if(y===3)for(d=0;d<f;d++)B[d]=u[d][0]*n[0]+u[d][1]*n[1]+u[d][2]*n[2];else for(d=0;d<f;d++){for(C=0,I=0;I<y;I++)C+=u[d][I]*n[I];B[d]=C}return B},matMatMult:function(u,n){var d,C,I,f,y=u.length,B=y>0?n[0].length:0,_=n.length,Z=this.matrix(y,B);for(d=0;d<y;d++)for(C=0;C<B;C++){for(I=0,f=0;f<_;f++)I+=u[d][f]*n[f][C];Z[d][C]=I}return Z},transpose:function(u){var n,d,C,I,f;for(I=u.length,f=u.length>0?u[0].length:0,n=this.matrix(f,I),d=0;d<f;d++)for(C=0;C<I;C++)n[d][C]=u[C][d];return n},inverse:function(u){var n,d,C,I,f,y,B,_=u.length,Z=[],M=[],V=[];for(n=0;n<_;n++){for(Z[n]=[],d=0;d<_;d++)Z[n][d]=u[n][d];M[n]=n}for(d=0;d<_;d++){for(f=Math.abs(Z[d][d]),y=d,n=d+1;n<_;n++)Math.abs(Z[n][d])>f&&(f=Math.abs(Z[n][d]),y=n);if(f<=this.eps)return[];if(y>d){for(C=0;C<_;C++)B=Z[d][C],Z[d][C]=Z[y][C],Z[y][C]=B;B=M[d],M[d]=M[y],M[y]=B}for(I=1/Z[d][d],n=0;n<_;n++)Z[n][d]*=I;for(Z[d][d]=I,C=0;C<_;C++)if(C!==d){for(n=0;n<_;n++)n!==d&&(Z[n][C]-=Z[n][d]*Z[d][C]);Z[d][C]=-I*Z[d][C]}}for(n=0;n<_;n++){for(C=0;C<_;C++)V[M[C]]=Z[n][C];for(C=0;C<_;C++)Z[n][C]=V[C]}return Z},innerProduct:function(u,n,d){var C,I=0;for((d===undef||!JXG$1.isNumber(d))&&(d=u.length),C=0;C<d;C++)I+=u[C]*n[C];return I},crossProduct:function(u,n){return[u[1]*n[2]-u[2]*n[1],u[2]*n[0]-u[0]*n[2],u[0]*n[1]-u[1]*n[0]]},norm:function(u,n){var d,C=0;for((n===undef||!JXG$1.isNumber(n))&&(n=u.length),d=0;d<n;d++)C+=u[d]*u[d];return Math.sqrt(C)},axpy:function(u,n,d){var C,I=n.length,f=[];for(C=0;C<I;C++)f[C]=u*n[C]+d[C];return f},factorial:memoizer(function(u){return u<0?NaN:(u=Math.floor(u),u===0||u===1?1:u*this.factorial(u-1))}),binomial:memoizer(function(u,n){var d,C;if(n>u||n<0)return NaN;if(n=Math.round(n),u=Math.round(u),n===0||n===u)return 1;for(d=1,C=0;C<n;C++)d*=u-C,d/=C+1;return d}),cosh:Math.cosh||function(u){return(Math.exp(u)+Math.exp(-u))*.5},sinh:Math.sinh||function(u){return(Math.exp(u)-Math.exp(-u))*.5},acosh:Math.acosh||function(u){return Math.log(u+Math.sqrt(u*u-1))},asinh:Math.asinh||function(u){return u===-1/0?u:Math.log(u+Math.sqrt(u*u+1))},cot:function(u){return 1/Math.tan(u)},acot:function(u){return(u>=0?.5:-.5)*Math.PI-Math.atan(u)},nthroot:function(u,n){var d=1/n;return n<=0||Math.floor(n)!==n?NaN:u===0?0:u>0?Math.exp(d*Math.log(u)):n%2===1?-Math.exp(d*Math.log(-u)):NaN},cbrt:Math.cbrt||function(u){return this.nthroot(u,3)},pow:function(u,n){return u===0?n===0?1:0:Math.floor(n)===n?Math.pow(u,n):u>0?Math.exp(n*Math.log(u)):NaN},ratpow:function(u,n,d){var C;return n===0?1:d===0?NaN:(C=this.gcd(n,d),this.nthroot(this.pow(u,n/C),d/C))},log10:function(u){return Math.log(u)/Math.log(10)},log2:function(u){return Math.log(u)/Math.log(2)},log:function(u,n){return n!==void 0&&JXG$1.isNumber(n)?Math.log(u)/Math.log(n):Math.log(u)},sign:Math.sign||function(u){return u=+u,u===0||isNaN(u)?u:u>0?1:-1},squampow:function(u,n){var d;if(Math.floor(n)===n){for(d=1,n<0&&(u=1/u,n*=-1);n!==0;)n&1&&(d*=u),n>>=1,u*=u;return d}return this.pow(u,n)},gcd:function(u,n){var d,C=!0;if(u=Math.abs(u),n=Math.abs(n),!(JXG$1.isNumber(u)&&JXG$1.isNumber(n)))return NaN;for(n>u&&(d=u,u=n,n=d);C;){if(u%=n,u===0)return n;if(n%=u,n===0)return u}},lcm:function(u,n){var d;return JXG$1.isNumber(u)&&JXG$1.isNumber(n)?(d=u*n,d!==0?d/this.gcd(u,n):0):NaN},roundToStep:function(u,n,d,C){var I=u,f,y;if(!JXG$1.exists(n)&&!JXG$1.exists(d)&&!JXG$1.exists(C))return I;if(JXG$1.exists(C)&&(I=Math.min(I,C)),JXG$1.exists(d)&&(I=Math.max(I,d)),y=d||0,JXG$1.exists(n)){if(f=(I-y)/n,Number.isInteger(f))return I;f=Math.round(f),I=y+f*n}return JXG$1.exists(C)&&(I=Math.min(I,C)),JXG$1.exists(d)&&(I=Math.max(I,d)),I},erf:function(u){return this.ProbFuncs.erf(u)},erfc:function(u){return this.ProbFuncs.erfc(u)},erfi:function(u){return this.ProbFuncs.erfi(u)},ndtr:function(u){return this.ProbFuncs.ndtr(u)},ndtri:function(u){return this.ProbFuncs.ndtri(u)},hypot:function(){var u,n,d,C;for(n=arguments.length,u=0,C=0;u<n;u++)d=arguments[u],C+=d*d;return Math.sqrt(C)},hstep:function(u){return u>0?1:u<0?0:.5},gamma:function(u){var n,d,C,I,f,y=7,B=[1,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(u<.5)d=Math.PI/(Math.sin(Math.PI*u)*this.gamma(1-u));else{for(u-=1,n=B[0],f=B.length,I=1;I<f;I++)n+=B[I]/(u+I);C=u+y+.5,d=Math.sqrt(2*Math.PI)*Math.pow(C,u+.5)*Math.exp(-C)*n}return d},lt:function(u,n){return u<n},leq:function(u,n){return u<=n},gt:function(u,n){return u>n},geq:function(u,n){return u>=n},eq:function(u,n){return u===n},neq:function(u,n){return u!==n},and:function(u,n){return u&&n},not:function(u){return!u},or:function(u,n){return u||n},xor:function(u,n){return(u||n)&&!(u&&n)},decToFraction:function(u,n){var d,C,I,f,y,B,_,Z,M,V=0,T=20;for(n=JXG$1.def(n,.001),u=Math.round(u*1e12)*1e-12,C=u<0?-1:1,u=Math.abs(u),d=Math.floor(u),u-=Math.floor(u),I=0,B=1,f=y=I,M=0,_=Z=1;u-Math.floor(u)>n&&V<T;)u=1/(u-I),I=Math.floor(u),f=B+I*y,_=M+I*Z,B=y,M=Z,y=f,Z=_,V++;return[C,d,f,_]},normalize:function(u){var n,d,C=2*u[3],I=u[4]/C;return u[5]=I,u[6]=-u[1]/C,u[7]=-u[2]/C,isFinite(I)?Math.abs(I)>=1?(u[0]=(u[6]*u[6]+u[7]*u[7]-I*I)/(2*I),u[1]=-u[6]/I,u[2]=-u[7]/I,u[3]=1/(2*I),u[4]=1):(d=I<=0?-1:1,u[0]=d*(u[6]*u[6]+u[7]*u[7]-I*I)*.5,u[1]=-d*u[6],u[2]=-d*u[7],u[3]=d/2,u[4]=d*I):(n=this.hypot(u[1],u[2]),u[0]/=n,u[1]/=n,u[2]/=n,u[3]=0,u[4]=1),u},toGL:function(u){var n,d,C;if(typeof Float32Array=="function"?n=new Float32Array(16):n=new Array(16),u.length!==4&&u[0].length!==4)return n;for(d=0;d<4;d++)for(C=0;C<4;C++)n[d+4*C]=u[d][C];return n},Vieta:function(u){var n=u.length,d=[],C,I,f;for(d=u.slice(),C=1;C<n;++C){for(f=d[C],d[C]*=d[C-1],I=C-1;I>=1;--I)d[I]+=d[I-1]*f;d[0]+=f}return d}};const Mat=JXG$1.Math;JXG$1.extend(JXG$1,{isBoard:function(u){return u!==null&&typeof u=="object"&&this.isNumber(u.BOARD_MODE_NONE)&&this.isObject(u.objects)&&this.isObject(u.jc)&&this.isFunction(u.update)&&!!u.containerObj&&this.isString(u.id)},isId:function(u,n){return typeof n=="string"&&!!u.objects[n]},isName:function(u,n){return typeof n=="string"&&!!u.elementsByName[n]},isGroup:function(u,n){return typeof n=="string"&&!!u.groups[n]},isString:function(u){return typeof u=="string"},isNumber:function(u,n,d){var C=typeof u=="number"||Object.prototype.toString.call(u)==="[Object Number]";return n=n||!1,d=d===void 0?!0:d,n&&(C=C||""+parseFloat(u)===u),d||(C=C&&!isNaN(u)),C},isFunction:function(u){return typeof u=="function"},isArray:function(u){var n;return Array.isArray?n=Array.isArray(u):n=u!==null&&typeof u=="object"&&typeof u.splice=="function"&&typeof u.join=="function",n},isObject:function(u){return typeof u=="object"&&!this.isArray(u)},isDocumentOrFragment:function(u){return this.isObject(u)&&(u.nodeType===9||u.nodeType===11)},isPoint:function(u){return u!==null&&typeof u=="object"&&this.exists(u.elementClass)?u.elementClass===Const.OBJECT_CLASS_POINT:!1},isPoint3D:function(u){return u!==null&&typeof u=="object"&&this.exists(u.type)?u.type===Const.OBJECT_TYPE_POINT3D:!1},isPointType:function(u,n){var d,C;return this.isArray(n)||this.isFunction(n)&&(d=n(),this.isArray(d)&&d.length>1)?!0:(C=u.select(n),this.isPoint(C))},isPointType3D:function(u,n){var d,C;return this.isArray(n)&&n.length>=3||this.isFunction(n)&&(d=n(),this.isArray(d)&&d.length>=3)?!0:(C=u.select(n),this.isPoint3D(C))},isTransformationOrArray:function(u){if(u!==null){if(this.isArray(u)&&u.length>0)return this.isTransformationOrArray(u[0]);if(typeof u=="object")return u.type===Const.OBJECT_TYPE_TRANSFORMATION}return!1},isEmpty:function(u){return Object.keys(u).length===0},exists:function(u,n){var d=!(u==null||u===null);return n=n||!1,n?d&&u!=="":d},def:function(u,n){return this.exists(u)?u:n},str2Bool:function(u){return this.exists(u)?typeof u=="boolean"?u:this.isString(u)?u.toLowerCase()==="true":!1:!0},cssParse:function(u){var n=u;return this.isString(n)?(n=n.replace(/\s*;\s*$/g,""),n=n.replace(/\s*;\s*/g,'","'),n=n.replace(/\s*:\s*/g,'":"'),n=n.trim(),n='{"'+n+'"}',JSON.parse(n)):{}},cssStringify:function(u){var n="",d,C;if(!this.isObject(u))return"";for(d in u)u.hasOwnProperty(d)&&(C=u[d],!(!this.isString(C)&&!this.isNumber(C))&&(n+=d+":"+C+"; "));return n=n.trim(),n},createEvalFunction:function(u,n,d){var C=[],I,f,y,B={};for(f=0;f<d;f++){C[f]=JXG$1.createFunction(n[f],u);for(y in C[f].deps)B[y]=C[f].deps}return I=function(_){return C[_]()},I.deps=B,I},createFunction:function(u,n,d,C){var I=null;return this.isString(u)?I=n.jc.snippet(u,!0,d,!1):this.isFunction(u)?(I=u,I.deps=this.isObject(u.deps)?u.deps:{}):this.isNumber(u)&&(I=function(){return u},I.deps={}),I!==null&&(I.origin=u),I},providePoints:function(u,n,d,C,I){var f,y,B,_=0,Z=[],M,V;for(this.isArray(n)||(n=[n]),B=n.length,this.exists(I)&&(_=I.length),_===0&&(M=this.copyAttributes(d,u.options,C)),f=0;f<B;++f)if(_>0&&(y=Math.min(f,_-1),M=this.copyAttributes(d,u.options,C,I[y].toLowerCase())),this.isArray(n[f])&&n[f].length>1?(Z.push(u.create("point",n[f],M)),Z[Z.length-1]._is_new=!0):this.isFunction(n[f])?(V=n[f](),this.isArray(V)&&V.length>1&&(Z.push(u.create("point",[n[f]],M)),Z[Z.length-1]._is_new=!0)):Z.push(u.select(n[f])),!this.isPoint(Z[f]))return!1;return Z},providePoints3D:function(u,n,d,C,I){var f,y,B,_=0,Z=[],M,V;for(this.isArray(n)||(n=[n]),B=n.length,this.exists(I)&&(_=I.length),_===0&&(M=this.copyAttributes(d,u.board.options,C)),f=0;f<B;++f)if(_>0&&(y=Math.min(f,_-1),M=this.copyAttributes(d,u.board.options,C,I[y])),this.isArray(n[f])&&n[f].length>1?(Z.push(u.create("point3d",n[f],M)),Z[Z.length-1]._is_new=!0):this.isFunction(n[f])?(V=n[f](),this.isArray(V)&&V.length>1&&(Z.push(u.create("point3d",[n[f]],M)),Z[Z.length-1]._is_new=!0)):Z.push(u.select(n[f])),!this.isPoint3D(Z[f]))return!1;return Z},bind:function(u,n){return function(){return u.apply(n,arguments)}},evaluate:function(u){return this.isFunction(u)?u():u},indexOf:function(u,n,d){var C,I=this.exists(d);if(Array.indexOf&&!I)return u.indexOf(n);for(C=0;C<u.length;C++)if(I&&u[C][d]===n||!I&&u[C]===n)return C;return-1},eliminateDuplicates:function(u){var n,d=u.length,C=[],I={};for(n=0;n<d;n++)I[u[n]]=0;for(n in I)I.hasOwnProperty(n)&&C.push(n);return C},swap:function(u,n,d){var C;return C=u[n],u[n]=u[d],u[d]=C,u},uniqueArray:function(u){var n,d,C,I=[];if(u.length===0)return[];for(n=0;n<u.length;n++){if(C=this.isArray(u[n]),!this.exists(u[n])){u[n]="";continue}for(d=n+1;d<u.length;d++)C&&JXG$1.cmpArrays(u[n],u[d])?u[n]=[]:!C&&u[n]===u[d]&&(u[n]="")}for(d=0,n=0;n<u.length;n++)C=this.isArray(u[n]),!C&&u[n]!==""?(I[d]=u[n],d++):C&&u[n].length!==0&&(I[d]=u[n].slice(0),d++);return u=I,I},isInArray:function(u,n){return JXG$1.indexOf(u,n)>-1},coordsArrayToMatrix:function(u,n){var d,C=[],I=[];for(d=0;d<u.length;d++)n?(C.push(u[d].usrCoords[1]),I.push(u[d].usrCoords[2])):I.push([u[d].usrCoords[1],u[d].usrCoords[2]]);return n&&(I=[C,I]),I},cmpArrays:function(u,n){var d;if(u===n)return!0;if(u.length!==n.length)return!1;for(d=0;d<u.length;d++)if(this.isArray(u[d])&&this.isArray(n[d])){if(!this.cmpArrays(u[d],n[d]))return!1}else if(u[d]!==n[d])return!1;return!0},removeElementFromArray:function(u,n){var d;for(d=0;d<u.length;d++)if(u[d]===n)return u.splice(d,1),u;return u},trunc:function(u,n){return n=JXG$1.def(n,0),this.toFixed(u,n)},_decimalAdjust:function(u,n,d){return d===void 0||+d==0?Math[u](n):(n=+n,d=+d,isNaN(n)||!(typeof d=="number"&&d%1===0)?NaN:(n=n.toString().split("e"),n=Math[u](+(n[0]+"e"+(n[1]?+n[1]-d:-d))),n=n.toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+d:d))))},_round10:function(u,n){return this._decimalAdjust("round",u,n)},_floor10:function(u,n){return this._decimalAdjust("floor",u,n)},_ceil10:function(u,n){return this._decimalAdjust("ceil",u,n)},toFixed:function(u,n){return this._round10(u,-n).toFixed(n)},autoDigits:function(u){var n=Math.abs(u),d;return n>=.1?d=this.toFixed(u,2):n>=.01?d=this.toFixed(u,4):n>=1e-4?d=this.toFixed(u,6):d=u,d},parseNumber:function(u,n,d){var C;return this.isString(u)&&u.indexOf("%")>-1?(C=u.replace(/\s+%\s+/,""),parseFloat(C)*n*.01):this.isString(u)&&u.indexOf("fr")>-1?(C=u.replace(/\s+fr\s+/,""),parseFloat(C)*n):this.isString(u)&&u.indexOf("px")>-1?(C=u.replace(/\s+px\s+/,""),C=parseFloat(C),this.isFunction(d)?d(C):this.isNumber(d)?C*d:C):parseFloat(u)},parsePosition:function(u){var n,d,C="",I="";if(u=u.trim(),u!=="")for(n=u.split(/[ ,]+/),d=0;d<n.length;d++)n[d]==="left"||n[d]==="right"?C=n[d]:I=n[d];return{side:C,pos:I}},keys:function(u,n){var d=[],C;for(C in u)n?u.hasOwnProperty(C)&&d.push(C):d.push(C);return d},clone:function(u){var n={};return n.prototype=u,n},cloneAndCopy:function(u,n){var d,C=function(){};C.prototype=u;for(d in n)C[d]=n[d];return C},merge:function(u,n){var d,C,I,f;for(d in n)if(n.hasOwnProperty(d))if(I=n[d],this.isArray(I))for(u[d]||(u[d]=[]),C=0;C<I.length;C++)f=n[d][C],typeof n[d][C]=="object"?u[d][C]=this.merge(u[d][C],f):u[d][C]=n[d][C];else typeof I=="object"?(u[d]||(u[d]={}),u[d]=this.merge(u[d],I)):(typeof u=="boolean"&&(u={}),u[d]=I);return u},deepCopy:function(u,n,d){var C,I,f,y;if(d=d||!1,typeof u!="object"||u===null)return u;if(this.isArray(u))for(C=[],I=0;I<u.length;I++)f=u[I],f!==null&&typeof f=="object"?this.exists(f.board)?C[I]=f.id:C[I]=this.deepCopy(f,{},d):C[I]=f;else{C={};for(I in u)u.hasOwnProperty(I)&&(y=d?I.toLowerCase():I,f=u[I],f!==null&&typeof f=="object"?this.exists(f.board)?C[y]=f.id:C[y]=this.deepCopy(f,{},d):C[y]=f);for(I in n)n.hasOwnProperty(I)&&(y=d?I.toLowerCase():I,f=n[I],f!==null&&typeof f=="object"?this.isArray(f)||!this.exists(C[y])?C[y]=this.deepCopy(f,{},d):C[y]=this.deepCopy(C[y],f,d):C[y]=f)}return C},mergeAttr:function(u,n,d,C){var I,f,y;d=d||!0,C=C||!1;for(I in n)n.hasOwnProperty(I)&&(f=d?I.toLowerCase():I,f!==I&&u.hasOwnProperty(I)&&(u.hasOwnProperty(f)?this.mergeAttr(u[f],u[I],d):u[f]=u[I],delete u[I]),y=n[I],this.isObject(y)&&y!==null&&!this.isDocumentOrFragment(y)&&!this.exists(y.board)&&typeof y.valueOf()!="string"?((u[f]===void 0||u[f]===null||!this.isObject(u[f]))&&(u[f]={}),this.mergeAttr(u[f],y,d)):(!C||this.exists(y))&&(u[f]=y))},keysToLowerCase:function(u){var n,d,C=Object.keys(u),I=C.length,f={};if(typeof u!="object")return u;for(;I--;)n=C[I],u.hasOwnProperty(n)&&(d=u[n],typeof d=="object"&&d!==null&&!this.isArray(d)&&!this.exists(d.nodeType)&&!this.exists(d.board)?f[n.toLowerCase()]=this.keysToLowerCase(d):f[n.toLowerCase()]=d);return f},copyAttributes:function(u,n,d){var C,I,f,y,B,_,Z={circle:1,curve:1,foreignobject:1,image:1,line:1,point:1,polygon:1,text:1,ticks:1,integral:1};for(y=arguments.length,y<3||Z[d]?C=JXG$1.deepCopy(n.elements,null,!0):C={},y<4&&this.exists(d)&&this.exists(n.layer[d])&&(C.layer=n.layer[d]),B=n,_=!0,f=2;f<y;f++)if(I=arguments[f],this.exists(B[I]))B=B[I];else{_=!1;break}for(_&&(C=JXG$1.deepCopy(C,B,!0)),B=typeof u=="object"?this.keysToLowerCase(u):{},_=!0,f=3;f<y;f++)if(I=arguments[f].toLowerCase(),this.exists(B[I]))B=B[I];else{_=!1;break}if(_&&this.mergeAttr(C,B,!0),arguments[2]==="board")return C;for(B=n,_=!0,f=2;f<y;f++)if(I=arguments[f],this.exists(B[I]))B=B[I];else{_=!1;break}return _&&this.exists(B.label)&&(C.label=JXG$1.deepCopy(B.label,C.label,!0)),C.label=JXG$1.deepCopy(n.label,C.label,!0),C},copyPrototypeMethods:function(u,n,d){var C;u.prototype[d]=n.prototype.constructor;for(C in n.prototype)n.prototype.hasOwnProperty(C)&&(u.prototype[C]=n.prototype[C])},toJSON:function(u,n){var d,C,I,f,y;if(n=JXG$1.def(n,!1),JSON!==void 0&&JSON.stringify&&!n)try{return f=JSON.stringify(u),f}catch{}switch(typeof u){case"object":if(u){if(d=[],this.isArray(u)){for(I=0;I<u.length;I++)d.push(JXG$1.toJSON(u[I],n));return"["+d.join(",")+"]"}for(C in u)if(u.hasOwnProperty(C)){try{y=JXG$1.toJSON(u[C],n)}catch{y=""}n?d.push(C+":"+y):d.push('"'+C+'":'+y)}return"{"+d.join(",")+"} "}return"null";case"string":return"'"+u.replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return u.toString()}return"0"},clearVisPropOld:function(u){return u.visPropOld={cssclass:"",cssdefaultstyle:"",cssstyle:"",fillcolor:"",fillopacity:"",firstarrow:!1,fontsize:-1,lastarrow:!1,left:-1e5,linecap:"",shadow:!1,strokecolor:"",strokeopacity:"",strokewidth:"",tabindex:-1e5,transitionduration:0,top:-1e5,visible:null},u},isInObject:function(u,n){var d;for(d in u)if(u.hasOwnProperty(d)&&u[d]===n)return!0;return!1},escapeHTML:function(u){return u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(u){return u.replace(/<\/?[^>]+>/gi,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},capitalize:function(u){return u.charAt(0).toUpperCase()+u.substring(1).toLowerCase()},trimNumber:function(u){return u=u.replace(/^0+/,""),u=u.replace(/0+$/,""),(u[u.length-1]==="."||u[u.length-1]===",")&&(u=u.slice(0,-1)),(u[0]==="."||u[0]===",")&&(u="0"+u),u},filterElements:function(u,n){var d,C,I,f,y,B,_,Z=u.length,M=[];if(typeof n!="function"&&typeof n!="object")return M;for(d=0;d<Z;d++){if(_=!0,I=u[d],typeof n=="object"){for(C in n)if(n.hasOwnProperty(C)&&(f=C.toLowerCase(),typeof I[C]=="function"?y=I[C]():y=I[C],I.visProp&&typeof I.visProp[f]=="function"?B=I.visProp[f]():B=I.visProp&&I.visProp[f],typeof n[C]=="function"?_=n[C](y)||n[C](B):_=y===n[C]||B===n[C],!_))break}else typeof n=="function"&&(_=n(I));_&&M.push(I)}return M},trim:function(u){return u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},toFraction:function(u,n,d){var C=Mat.decToFraction(u,d),I="";return C[1]===0&&C[2]===0?I+="0":(C[0]<0&&(I+="-"),C[2]===0?I+=C[1]:C[2]===1&&C[3]===1||(C[1]!==0&&(I+=C[1]+" "),n===!0?I+="\\frac{"+C[2]+"}{"+C[3]+"}":I+=C[2]+"/"+C[3])),I},concat:function(u,n){var d,C=n.length;for(d=0;d<C;d++)u.push(n[d]);return u},sanitizeHTML:function(u,n){return typeof html_sanitize=="function"&&n?html_sanitize(u,function(){},function(d){return d}):(u&&typeof u=="string"&&(u=u.replace(/</g,"&lt;").replace(/>/g,"&gt;")),u)},evalSlider:function(u){return u&&u.type===Const.OBJECT_TYPE_GLIDER&&typeof u.Value=="function"?u.Value():u},stack2jsxgraph:function(u){var n;return n=u.replace(/%pi/g,"PI").replace(/%e/g,"EULER").replace(/%phi/g,"1.618033988749895").replace(/%gamma/g,"0.5772156649015329").trim(),n[0]==="["&&n[n.length-1]==="]"&&(n=n.slice(1,-1).split(/\s*,\s*/)),n}});JXG$1.extendConstants(JXG$1,{});JXG$1.extend(JXG$1,{isTouchEvent:function(u){return JXG$1.exists(u.touches)},isPointerEvent:function(u){return JXG$1.exists(u.pointerId)},isMouseEvent:function(u){return!JXG$1.isTouchEvent(u)&&!JXG$1.isPointerEvent(u)},getNumberOfTouchPoints:function(u){var n=-1;return JXG$1.isTouchEvent(u)&&(n=u.touches.length),n},isFirstTouch:function(u){var n=JXG$1.getNumberOfTouchPoints(u);return JXG$1.isPointerEvent(u)?u.isPrimary:n===1},isBrowser:typeof window=="object"&&typeof document=="object",supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch{return!1}},supportsVML:function(){return this.isBrowser&&!!document.namespaces},supportsSVG:function(){var u;return this.isBrowser?(u=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,u):!1},supportsCanvas:function(){var u=!1;return this.isNode()&&(u=!0),u||this.isBrowser&&!!document.createElement("canvas").getContext},isNode:function(){return!this.isBrowser&&typeof process<"u"&&process.release.name.search(/node|io.js/)!==-1},isWebWorker:function(){return!this.isBrowser&&typeof self=="object"&&typeof self.postMessage=="function"},supportsPointerEvents:function(){return!!(this.isBrowser&&window.navigator&&(window.PointerEvent||window.navigator.pointerEnabled||window.navigator.msPointerEnabled))},isTouchDevice:function(){return this.isBrowser&&window.ontouchstart!==void 0},isAndroid:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")>-1},isWebkitAndroid:function(){return this.isAndroid()&&navigator.userAgent.indexOf(" AppleWebKit/")>-1},isApple:function(){return JXG$1.exists(navigator)&&(navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPhone")>-1)},isWebkitApple:function(){return this.isApple()&&navigator.userAgent.search(/Mobile\/[0-9A-Za-z.]*Safari/)>-1},isMetroApp:function(){return typeof window=="object"&&window.clientInformation&&window.clientInformation.appVersion&&window.clientInformation.appVersion.indexOf("MSAppHost")>-1},isMozilla:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1},isFirefoxOS:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")===-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1&&navigator.userAgent.toLowerCase().indexOf("mobile")>-1&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1},isDesktop:function(){return!0},isMobile:function(){return!0},ieVersion:function(){var u,n,d=3;if(typeof document!="object")return 0;u=document.createElement("div"),n=u.getElementsByTagName("i");do u.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->";while(n[0]);return d>4?d:void 0}(),getDimensions:function(u,n){var d,C,I,f,y,B,_,Z,M,V=/\d+(\.\d*)?px/;if(!this.isBrowser||u===null)return{width:500,height:500};if(n=n||document,d=JXG$1.isString(u)?n.getElementById(u):u,!JXG$1.exists(d))throw new Error(`
JSXGraph: HTML container element '`+u+"' not found.");return C=d.style.display,C!=="none"&&C!==null?d.clientWidth>0&&d.clientHeight>0?{width:d.clientWidth,height:d.clientHeight}:(M=window.getComputedStyle?window.getComputedStyle(d):d.style,{width:V.test(M.width)?parseFloat(M.width):0,height:V.test(M.height)?parseFloat(M.height):0}):(I=d.style,f=I.visibility,y=I.position,B=I.display,I.visibility="hidden",I.position="absolute",I.display="block",_=d.clientWidth,Z=d.clientHeight,I.display=B,I.position=y,I.visibility=f,{width:_,height:Z})},addEvent:function(u,n,d,C,I){var f=function(){return d.apply(C,arguments)};f.origin=d,typeof C=="object"&&JXG$1.exists(C.BOARD_MODE_NONE)&&(C["x_internal"+n]=C["x_internal"+n]||[],C["x_internal"+n].push(f)),JXG$1.exists(u)&&JXG$1.exists(u.addEventListener)&&(I=I||!1,u.addEventListener(n,f,I)),JXG$1.exists(u)&&JXG$1.exists(u.attachEvent)&&u.attachEvent("on"+n,f)},removeEvent:function(u,n,d,C){var I;if(!JXG$1.exists(C)){JXG$1.debug("no such owner");return}if(!JXG$1.exists(C["x_internal"+n])){JXG$1.debug("removeEvent: no such type: "+n);return}if(!JXG$1.isArray(C["x_internal"+n])){JXG$1.debug("owner[x_internal + "+n+"] is not an array");return}if(I=JXG$1.indexOf(C["x_internal"+n],d,"origin"),I===-1){JXG$1.debug("removeEvent: no such event function in internal list: "+d);return}try{JXG$1.exists(u)&&JXG$1.exists(u.removeEventListener)&&u.removeEventListener(n,C["x_internal"+n][I],!1),JXG$1.exists(u)&&JXG$1.exists(u.detachEvent)&&u.detachEvent("on"+n,C["x_internal"+n][I])}catch{JXG$1.debug("removeEvent: event not registered in browser: ("+n+" -- "+d+")")}C["x_internal"+n].splice(I,1)},removeAllEvents:function(u,n,d){var C,I;if(d["x_internal"+n]){for(I=d["x_internal"+n].length,C=I-1;C>=0;C--)JXG$1.removeEvent(u,n,d["x_internal"+n][C].origin,d);d["x_internal"+n].length>0&&JXG$1.debug("removeAllEvents: Not all events could be removed.")}},getPosition:function(u,n,d){var C,I,f,y=0,B=0;if(u||(u=window.event),f=u.touches,JXG$1.exists(f)&&f.length===0&&(f=u.changedTouches),JXG$1.exists(n)&&JXG$1.exists(f))if(n===-1){for(I=f.length,C=0;C<I;C++)if(f[C]){u=f[C];break}}else u=f[n];return u.clientX&&(y=u.clientX,B=u.clientY),[y,B]},getOffset:function(u){var n,d=u,C=u,I=d.offsetLeft-d.scrollLeft,f=d.offsetTop-d.scrollTop;for(n=this.getCSSTransform([I,f],d),I=n[0],f=n[1],d=d.offsetParent;d;){for(I+=d.offsetLeft,f+=d.offsetTop,d.offsetParent&&(I+=d.clientLeft-d.scrollLeft,f+=d.clientTop-d.scrollTop),n=this.getCSSTransform([I,f],d),I=n[0],f=n[1],C=C.parentNode;C!==d;)I+=C.clientLeft-C.scrollLeft,f+=C.clientTop-C.scrollTop,n=this.getCSSTransform([I,f],C),I=n[0],f=n[1],C=C.parentNode;d=d.offsetParent}return[I,f]},getStyle:function(u,n){var d,C=u.ownerDocument;return C.defaultView&&C.defaultView.getComputedStyle?d=C.defaultView.getComputedStyle(u,null).getPropertyValue(n):u.currentStyle&&JXG$1.ieVersion>=9?d=u.currentStyle[n]:u.style&&(n=n.replace(/-([a-z]|[0-9])/gi,function(I,f){return f.toUpperCase()}),d=u.style[n]),d},getProp:function(u,n){var d=parseInt(this.getStyle(u,n),10);return isNaN(d)?0:d},getCSSTransform:function(u,n){var d,C,I,f,y,B,_,Z,M=["transform","webkitTransform","MozTransform","msTransform","oTransform"];for(B=M.length,d=0,I="";d<B;d++)if(JXG$1.exists(n.style[M[d]])){I=n.style[M[d]];break}if(I!==""&&(y=I.indexOf("("),y>0)){for(B=I.length,f=I.substring(y+1,B-1),Z=f.split(","),C=0,_=Z.length;C<_;C++)Z[C]=parseFloat(Z[C]);I.indexOf("matrix")===0?(u[0]+=Z[4],u[1]+=Z[5]):I.indexOf("translateX")===0?u[0]+=Z[0]:I.indexOf("translateY")===0?u[1]+=Z[0]:I.indexOf("translate")===0&&(u[0]+=Z[0],u[1]+=Z[1])}return JXG$1.exists(n.style.zoom)&&(I=n.style.zoom,I!==""&&(u[0]*=parseFloat(I),u[1]*=parseFloat(I))),u},getCSSTransformMatrix:function(u){var n,d,C,I,f,y,B,_,Z,M=u.ownerDocument,V=["transform","webkitTransform","MozTransform","msTransform","oTransform"],T=[[1,0,0],[0,1,0],[0,0,1]];if(M.defaultView&&M.defaultView.getComputedStyle)Z=M.defaultView.getComputedStyle(u,null),C=Z.getPropertyValue("-webkit-transform")||Z.getPropertyValue("-moz-transform")||Z.getPropertyValue("-ms-transform")||Z.getPropertyValue("-o-transform")||Z.getPropertyValue("transform");else for(B=V.length,n=0,C="";n<B;n++)if(JXG$1.exists(u.style[V[n]])){C=u.style[V[n]];break}if(C!==""&&(y=C.indexOf("("),y>0)){for(B=C.length,I=C.substring(y+1,B-1),f=I.split(","),d=0,_=f.length;d<_;d++)f[d]=parseFloat(f[d]);C.indexOf("matrix")===0?T=[[1,0,0],[0,f[0],f[1]],[0,f[2],f[3]]]:C.indexOf("scaleX")===0?T[1][1]=f[0]:C.indexOf("scaleY")===0?T[2][2]=f[0]:C.indexOf("scale")===0&&(T[1][1]=f[0],T[2][2]=f[1])}return JXG$1.exists(u.style.zoom)&&(C=u.style.zoom,C!==""&&(T[1][1]*=parseFloat(C),T[2][2]*=parseFloat(C))),T},timedChunk:function(u,n,d,C){var I=u.slice(),f=function(){var y=+new Date;do n.call(d,I.shift());while(I.length>0&&+new Date-y<300);I.length>0?window.setTimeout(f,1):C(u)};window.setTimeout(f,1)},scaleJSXGraphDiv:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H,F=C,O,$=[":fullscreen",":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"],U=$.length,ee;for(y=d.getElementById(u).getBoundingClientRect(),f=y.height,I=y.width,V=d.getElementById(n),Z=V._cssFullscreenStore.w,M=V._cssFullscreenStore.h,O=M/Z,Z>I*F&&(Z=I*F,M=Z*O),M>f*F&&(M=f*F,Z=M/O),B=Z,_=M,O>1,O<f/I?T=I*F/Z:T=f*F/M,H=(f-_)*.5,ee=0;ee<U;ee++)try{V.style.width=B+"px !important",V.style.height=_+"px !important",V.style.margin="0 auto",V.style.transform=V._cssFullscreenStore.transform+" matrix("+T+",0,0,"+T+",0,"+H+")";break}catch(Q){JXG$1.debug(`JXG.scaleJSXGraphDiv:
`+Q)}ee===U&&JXG$1.debug("JXG.scaleJSXGraphDiv: Could not set any CSS property.")}});JXG$1.XML={cleanWhitespace:function(u){for(var n=u.firstChild;JXG$1.exists(n);)n.nodeType===3&&!/\S/.test(n.nodeValue)?u.removeChild(n):n.nodeType===1&&this.cleanWhitespace(n),n=n.nextSibling},parse:function(u){var n,d,C;return typeof DOMParser=="function"||typeof DOMParser=="object"?C=DOMParser:C=function(){this.parseFromString=function(I){var f;return typeof ActiveXObject=="function"&&(f=new ActiveXObject("MSXML.DomDocument"),f.loadXML(I)),f}},n=new C,d=n.parseFromString(u,"text/xml"),this.cleanWhitespace(d),d}};JXG$1.XML;JXG$1.EventEmitter={eventHandlers:{},suspended:{},trigger:function(u,n){var d,C,I,f,y,B;for(y=u.length,C=0;C<y;C++)if(f=this.eventHandlers[u[C]],!this.suspended[u[C]]){if(this.suspended[u[C]]=!0,f)for(B=f.length,d=0;d<B;d++)I=f[d],I.handler.apply(I.context,n);this.suspended[u[C]]=!1}return this},on:function(u,n,d){return JXG$1.isArray(this.eventHandlers[u])||(this.eventHandlers[u]=[]),d=JXG$1.def(d,this),this.eventHandlers[u].push({handler:n,context:d}),this},off:function(u,n){var d;return!u||!JXG$1.isArray(this.eventHandlers[u])?this:(n?(d=JXG$1.indexOf(this.eventHandlers[u],n,"handler"),d>-1&&this.eventHandlers[u].splice(d,1),this.eventHandlers[u].length===0&&delete this.eventHandlers[u]):delete this.eventHandlers[u],this)},eventify:function(u){u.eventHandlers={clicks:0},u.on=this.on,u.off=this.off,u.triggerEventHandlers=this.trigger,u.trigger=this.trigger,u.suspended={}}};const EventEmitter=JXG$1.EventEmitter;JXG$1.Coords=function(u,n,d,C){this.board=d,this.usrCoords=[],this.scrCoords=[],this.emitter=!JXG$1.exists(C)||C,this.emitter&&EventEmitter.eventify(this),this.setCoordinates(u,n,!1,!0)};JXG$1.extend(JXG$1.Coords.prototype,{normalizeUsrCoords:function(){Math.abs(this.usrCoords[0])>Mat.eps&&(this.usrCoords[1]/=this.usrCoords[0],this.usrCoords[2]/=this.usrCoords[0],this.usrCoords[0]=1)},usr2screen:function(u){var n=Math.round,d=this.board,C=this.usrCoords,I=d.origin.scrCoords;u===!0?(this.scrCoords[0]=n(C[0]),this.scrCoords[1]=n(C[0]*I[1]+C[1]*d.unitX),this.scrCoords[2]=n(C[0]*I[2]-C[2]*d.unitY)):(this.scrCoords[0]=C[0],this.scrCoords[1]=C[0]*I[1]+C[1]*d.unitX,this.scrCoords[2]=C[0]*I[2]-C[2]*d.unitY)},screen2usr:function(){var u=this.board.origin.scrCoords,n=this.scrCoords,d=this.board;this.usrCoords[0]=1,this.usrCoords[1]=(n[1]-u[1])/d.unitX,this.usrCoords[2]=(u[2]-n[2])/d.unitY},distance:function(u,n){var d=0,C,I=this.usrCoords,f=this.scrCoords,y;return u===Const.COORDS_BY_USER?(C=n.usrCoords,y=I[0]-C[0],d=y*y,d>Mat.eps*Mat.eps?Number.POSITIVE_INFINITY:Mat.hypot(I[1]-C[1],I[2]-C[2])):(C=n.scrCoords,Mat.hypot(f[1]-C[1],f[2]-C[2]))},setCoordinates:function(u,n,d,C){var I=this.usrCoords,f=this.scrCoords,y=[I[0],I[1],I[2]],B=[f[0],f[1],f[2]];return u===Const.COORDS_BY_USER?(n.length===2?(I[0]=1,I[1]=n[0],I[2]=n[1]):(I[0]=n[0],I[1]=n[1],I[2]=n[2],this.normalizeUsrCoords()),this.usr2screen(d)):(n.length===2?(f[1]=n[0],f[2]=n[1]):(f[1]=n[1],f[2]=n[2]),this.screen2usr()),this.emitter&&!C&&(B[1]!==f[1]||B[2]!==f[2])&&this.triggerEventHandlers(["update"],[y,B]),this},copy:function(u,n){return n===void 0&&(n=0),this[u].slice(n)},isReal:function(){return!isNaN(this.usrCoords[1]+this.usrCoords[2])&&Math.abs(this.usrCoords[0])>Mat.eps},__evt__update:function(u,n){},__evt:function(){}});const Coords=JXG$1.Coords;JXG$1.Expect={each:function(u,n,d){var C,I,f=[];if(JXG$1.exists(u.length))for(I=u.length,C=0;C<I;C++)f.push(n.call(this,u[C],d));return f},coords:function(u,n){var d=u;return u&&u.elementClass===Const.OBJECT_CLASS_POINT?d=u.coords:u.usrCoords&&u.scrCoords&&u.usr2screen&&(d=u),n&&(d=new Coords(Const.COORDS_BY_USER,d.usrCoords,d.board)),d},coordsArray:function(u,n){var d;return JXG$1.isArray(u)?d=u:d=this.coords(u).usrCoords,d.length<3&&d.unshift(1),n&&(d=[d[0],d[1],d[2]]),d}};const Expect=JXG$1.Expect;Mat.ProbFuncs={MAXNUM:17014118346046923e22,SQRTH:.7071067811865476,SQRT2:1.4142135623730951,MAXLOG:708.3964185322641,P:[2461969814735305e-25,.5641895648310689,7.463210564422699,48.63719709856814,196.5208329560771,526.4451949954773,934.5285271719576,1027.5518868951572,557.5353353693994],Q:[13.228195115474499,86.70721408859897,354.9377788878199,975.7085017432055,1823.9091668790973,2246.3376081871097,1656.6630919416134,557.5353408177277],R:[.5641895835477551,1.275366707599781,5.019050422511805,6.160210979930536,7.4097426995044895,2.9788666537210022],S:[2.2605286322011726,9.396035249380015,12.048953980809666,17.08144507475659,9.608968090632859,3.369076451000815],T:[9.604973739870516,90.02601972038427,2232.005345946843,7003.325141128051,55592.30130103949],U:[33.56171416475031,521.3579497801527,4594.323829709801,22629.000061389095,49267.39426086359],M:128,MINV:.0078125,expx2:function(u,n){var d,C,I,f;return u=Math.abs(u),n<0&&(u=-u),I=this.MINV*Math.floor(this.M*u+.5),f=u-I,d=I*I,C=2*I*f+f*f,n<0&&(d=-d,C=-C),d+C>this.MAXLOG?1/0:(d=Math.exp(d)*Math.exp(C),d)},polevl:function(u,n,d){var C,I;if(JXG$1.exists(n.reduce))return n.reduce(function(f,y){return f*u+y},0);for(I=0,C=0;I<=d;I++)C=C*u+n[I];return C},p1evl:function(u,n,d){var C,I;if(JXG$1.exists(n.reduce))return n.reduce(function(f,y){return f*u+y},1);for(I=0,C=1;I<d;I++)C=C*u+n[I];return C},ndtr:function(u){var n,d,C;return n=u*this.SQRTH,C=Math.abs(n),C<1?d=.5+.5*this.erf(n):(d=.5*this.erfce(C),C=this.expx2(u,-1),d=d*Math.sqrt(C),n>0&&(d=1-d)),d},_underflow:function(u){return console.log("erfc","UNDERFLOW"),u<0?2:0},erfc:function(u){var n,d,C,I,f;return u<0?C=-u:C=u,C<1?1-this.erf(u):(f=-u*u,f<-this.MAXLOG?this._underflow(u):(f=this.expx2(u,-1),C<8?(n=this.polevl(C,this.P,8),d=this.p1evl(C,this.Q,8)):(n=this.polevl(C,this.R,5),d=this.p1evl(C,this.S,6)),I=f*n/d,u<0&&(I=2-I),I===0?this._underflow(u):I))},erfce:function(u){var n,d;return u<8?(n=this.polevl(u,this.P,8),d=this.p1evl(u,this.Q,8)):(n=this.polevl(u,this.R,5),d=this.p1evl(u,this.S,6)),n/d},erf:function(u){var n,d;return Math.abs(u)>1?1-this.erfc(u):(d=u*u,n=u*this.polevl(d,this.T,4)/this.p1evl(d,this.U,5),n)},s2pi:2.5066282746310007,P0:[-59.96335010141079,98.00107541859997,-56.67628574690703,13.931260938727968,-1.2391658386738125],Q0:[1.9544885833814176,4.676279128988815,86.36024213908905,-225.46268785411937,200.26021238006066,-82.03722561683334,15.90562251262117,-1.1833162112133],P1:[4.0554489230596245,31.525109459989388,57.16281922464213,44.08050738932008,14.684956192885803,2.1866330685079025,-.1402560791713545,-.03504246268278482,-.0008574567851546854],Q1:[15.779988325646675,45.39076351288792,41.3172038254672,15.04253856929075,2.504649462083094,-.14218292285478779,-.03808064076915783,-.0009332594808954574],P2:[3.2377489177694603,6.915228890689842,3.9388102529247444,1.3330346081580755,.20148538954917908,.012371663481782003,.00030158155350823543,26580697468673755e-22,6239745391849833e-24],Q2:[6.02427039364742,3.6798356385616087,1.3770209948908132,.21623699359449663,.013420400608854318,.00032801446468212774,28924786474538068e-22,6790194080099813e-24],ndtri:function(u){var n,d,C,I,f,y,B;return u<=0?-1/0:u>=1?1/0:(B=1,d=u,d>1-.1353352832366127&&(d=1-d,B=0),d>.1353352832366127?(d=d-.5,I=d*d,n=d+d*(I*this.polevl(I,this.P0,4)/this.p1evl(I,this.Q0,8)),n=n*this.s2pi,n):(n=Math.sqrt(-2*Math.log(d)),f=n-Math.log(n)/n,C=1/n,n<8?y=C*this.polevl(C,this.P1,8)/this.p1evl(C,this.Q1,8):y=C*this.polevl(C,this.P2,8)/this.p1evl(C,this.Q2,8),n=f-y,B!==0&&(n=-n),n))},erfi:function(u){return this.ndtri((u+1)*.5)*this.SQRTH}};Mat.ProbFuncs;JXG$1.Math.DoubleBits=function(){var u=new Float64Array(1),n=new Uint32Array(u.buffer),d,C,I,f,y,B,_,Z;Float64Array!==void 0&&(u[0]=1,n[1]===1072693248?(d=function(M){return u[0]=M,[n[0],n[1]]},C=function(M,V){return n[0]=M,n[1]=V,u[0]},I=function(M){return u[0]=M,n[0]},f=function(M){return u[0]=M,n[1]},this.doubleBits=d,this.pack=C,this.lo=I,this.hi=f):n[0]===1072693248&&(y=function(M){return u[0]=M,[n[1],n[0]]},B=function(M,V){return n[1]=M,n[0]=V,u[0]},_=function(M){return u[0]=M,n[1]},Z=function(M){return u[0]=M,n[0]},this.doubleBits=y,this.pack=B,this.lo=_,this.hi=Z))};JXG$1.extend(JXG$1.Math.DoubleBits.prototype,{sign:function(u){return this.hi(u)>>>31},exponent:function(u){var n=this.hi(u);return(n<<1>>>21)-1023},fraction:function(u){var n=this.lo(u),d=this.hi(u),C=d&(1<<20)-1;return d&2146435072&&(C+=1<<20),[n,C]},denormalized:function(u){var n=this.hi(u);return!(n&2146435072)}});var doubleBits=new JXG$1.Math.DoubleBits,MatInterval=function(u,n){if(u!==void 0&&n!==void 0){if(Mat.IntervalArithmetic.isInterval(u)){if(!Mat.IntervalArithmetic.isSingleton(u))throw new TypeError("JXG.Math.IntervalArithmetic: interval `lo` must be a singleton");this.lo=u.lo}else this.lo=u;if(Mat.IntervalArithmetic.isInterval(n)){if(!Mat.IntervalArithmetic.isSingleton(n))throw new TypeError("JXG.Math.IntervalArithmetic: interval `hi` must be a singleton");this.hi=n.hi}else this.hi=n}else{if(u!==void 0)return Array.isArray(u)?new MatInterval(u[0],u[1]):new MatInterval(u,u);this.lo=this.hi=0}};JXG$1.extend(MatInterval.prototype,{print:function(){console.log("[",this.lo,this.hi,"]")},set:function(u,n){return this.lo=u,this.hi=n,this},bounded:function(u,n){return this.set(Mat.IntervalArithmetic.prev(u),Mat.IntervalArithmetic.next(n))},boundedSingleton:function(u){return this.bounded(u,u)},assign:function(u,n){if(typeof u!="number"||typeof n!="number")throw new TypeError("JXG.Math.Interval#assign: arguments must be numbers");return isNaN(u)||isNaN(n)||u>n?this.setEmpty():this.set(u,n)},setEmpty:function(){return this.set(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},setWhole:function(){return this.set(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},open:function(u,n){return this.assign(Mat.IntervalArithmetic.next(u),Mat.IntervalArithmetic.prev(n))},halfOpenLeft:function(u,n){return this.assign(Mat.IntervalArithmetic.next(u),n)},halfOpenRight:function(u,n){return this.assign(u,Mat.IntervalArithmetic.prev(n))},toArray:function(){return[this.lo,this.hi]},clone:function(){return new MatInterval().set(this.lo,this.hi)}});JXG$1.Math.IntervalArithmetic={Interval:function(u,n){return new MatInterval(u,n)},isInterval:function(u){return u!==null&&typeof u=="object"&&typeof u.lo=="number"&&typeof u.hi=="number"},isSingleton:function(u){return u.lo===u.hi},add:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),new MatInterval(this.addLo(u.lo,n.lo),this.addHi(u.hi,n.hi))},sub:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),new MatInterval(this.subLo(u.lo,n.hi),this.subHi(u.hi,n.lo))},mul:function(u,n){var d,C,I,f,y;return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?this.EMPTY.clone():(d=u.lo,C=u.hi,I=n.lo,f=n.hi,y=new MatInterval,d<0?C>0?I<0?f>0?(y.lo=Math.min(this.mulLo(d,f),this.mulLo(C,I)),y.hi=Math.max(this.mulHi(d,I),this.mulHi(C,f))):(y.lo=this.mulLo(C,I),y.hi=this.mulHi(d,I)):f>0?(y.lo=this.mulLo(d,f),y.hi=this.mulHi(C,f)):(y.lo=0,y.hi=0):I<0?f>0?(y.lo=this.mulLo(d,f),y.hi=this.mulHi(d,I)):(y.lo=this.mulLo(C,f),y.hi=this.mulHi(d,I)):f>0?(y.lo=this.mulLo(d,f),y.hi=this.mulHi(C,I)):(y.lo=0,y.hi=0):C>0?I<0?f>0?(y.lo=this.mulLo(C,I),y.hi=this.mulHi(C,f)):(y.lo=this.mulLo(C,I),y.hi=this.mulHi(d,f)):f>0?(y.lo=this.mulLo(d,I),y.hi=this.mulHi(C,f)):(y.lo=0,y.hi=0):(y.lo=0,y.hi=0),y)},div:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?this.EMPTY.clone():this.zeroIn(n)?n.lo!==0?n.hi!==0?this.divZero(u):this.divNegative(u,n.lo):n.hi!==0?this.divPositive(u,n.hi):this.EMPTY.clone():this.divNonZero(u,n)},positive:function(u){return new MatInterval(u.lo,u.hi)},negative:function(u){return JXG$1.isNumber(u)?new MatInterval(-u):new MatInterval(-u.hi,-u.lo)},isEmpty:function(u){return u.lo>u.hi},isWhole:function(u){return u.lo===-1/0&&u.hi===1/0},zeroIn:function(u){return this.hasValue(u,0)},hasValue:function(u,n){return this.isEmpty(u)?!1:u.lo<=n&&n<=u.hi},hasInterval:function(u,n){return this.isEmpty(u)?!0:!this.isEmpty(n)&&n.lo<=u.lo&&u.hi<=n.hi},intervalsOverlap:function(u,n){return this.isEmpty(u)||this.isEmpty(n)?!1:u.lo<=n.lo&&n.lo<=u.hi||n.lo<=u.lo&&u.lo<=n.hi},divNonZero:function(u,n){var d=u.lo,C=u.hi,I=n.lo,f=n.hi,y=new MatInterval;return C<0?f<0?(y.lo=this.divLo(C,I),y.hi=this.divHi(d,f)):(y.lo=this.divLo(d,I),y.hi=this.divHi(C,f)):d<0?f<0?(y.lo=this.divLo(C,f),y.hi=this.divHi(d,f)):(y.lo=this.divLo(d,I),y.hi=this.divHi(C,I)):f<0?(y.lo=this.divLo(C,f),y.hi=this.divHi(d,I)):(y.lo=this.divLo(d,f),y.hi=this.divHi(C,I)),y},divPositive:function(u,n){return u.lo===0&&u.hi===0?u:this.zeroIn(u)?this.WHOLE:u.hi<0?new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(u.hi,n)):new MatInterval(this.divLo(u.lo,n),Number.POSITIVE_INFINITY)},divNegative:function(u,n){return u.lo===0&&u.hi===0?u:this.zeroIn(u)?this.WHOLE:u.hi<0?new MatInterval(this.divLo(u.hi,n),Number.POSITIVE_INFINITY):new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(u.lo,n))},divZero:function(u){return u.lo===0&&u.hi===0?u:this.WHOLE},fmod:function(u,n){var d,C;return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?this.EMPTY.clone():(d=u.lo<0?n.lo:n.hi,C=u.lo/d,C<0?C=Math.ceil(C):C=Math.floor(C),this.sub(u,this.mul(n,new MatInterval(C))))},multiplicativeInverse:function(u){return JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u)?this.EMPTY.clone():this.zeroIn(u)?u.lo!==0?u.hi!==0?this.WHOLE:new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(1,u.lo)):u.hi!==0?new MatInterval(this.divLo(1,u.hi),Number.POSITIVE_INFINITY):this.EMPTY.clone():new MatInterval(this.divLo(1,u.hi),this.divHi(1,u.lo))},pow:function(u,n){var d,C;if(JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u))return this.EMPTY.clone();if(this.isInterval(n)){if(!this.isSingleton(n))return this.EMPTY.clone();n=n.lo}return n===0?u.lo===0&&u.hi===0?this.EMPTY.clone():this.ONE.clone():n<0?this.pow(this.multiplicativeInverse(u),-n):n%1===0?u.hi<0?(d=this.powLo(-u.hi,n),C=this.powHi(-u.lo,n),(n&1)===1?new MatInterval(-C,-d):new MatInterval(d,C)):u.lo<0?(n&1)===1?new MatInterval(-this.powLo(-u.lo,n),this.powHi(u.hi,n)):new MatInterval(0,this.powHi(Math.max(-u.lo,u.hi),n)):new MatInterval(this.powLo(u.lo,n),this.powHi(u.hi,n)):(console.warn("power is not an integer, you should use nth-root instead, returning an empty interval"),this.EMPTY.clone())},sqrt:function(u){return JXG$1.isNumber(u)&&(u=this.Interval(u)),this.nthRoot(u,2)},nthRoot:function(u,n){var d,C,I,f,y;if(JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u)||n<0)return this.EMPTY.clone();if(this.isInterval(n)){if(!this.isSingleton(n))return this.EMPTY.clone();n=n.lo}return d=1/n,u.hi<0?n%1===0&&(n&1)===1?(C=this.powHi(-u.lo,d),I=this.powLo(-u.hi,d),new MatInterval(-C,-I)):this.EMPTY.clone():u.lo<0?(f=this.powHi(u.hi,d),n%1===0&&(n&1)===1?(y=-this.powHi(-u.lo,d),new MatInterval(y,f)):new MatInterval(0,f)):new MatInterval(this.powLo(u.lo,d),this.powHi(u.hi,d))},exp:function(u){return JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u)?this.EMPTY.clone():new MatInterval(this.expLo(u.lo),this.expHi(u.hi))},log:function(u){var n;return JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u)?this.EMPTY.clone():(n=u.lo<=0?Number.NEGATIVE_INFINITY:this.logLo(u.lo),new MatInterval(n,this.logHi(u.hi)))},ln:function(u){return this.log(u)},log10:function(u){return this.isEmpty(u)?this.EMPTY.clone():this.div(this.log(u),this.log(new MatInterval(10,10)))},log2:function(u){return this.isEmpty(u)?this.EMPTY.clone():this.div(this.log(u),this.log(new MatInterval(2,2)))},hull:function(u,n){var d=this.isEmpty(u),C=this.isEmpty(n);return d&&C?this.EMPTY.clone():d?n.clone():C?u.clone():new MatInterval(Math.min(u.lo,n.lo),Math.max(u.hi,n.hi))},intersection:function(u,n){var d,C;return this.isEmpty(u)||this.isEmpty(n)?this.EMPTY.clone():(d=Math.max(u.lo,n.lo),C=Math.min(u.hi,n.hi),d<=C?new MatInterval(d,C):this.EMPTY.clone())},union:function(u,n){if(!this.intervalsOverlap(u,n))throw new Error("Interval#unions do not overlap");return new MatInterval(Math.min(u.lo,n.lo),Math.max(u.hi,n.hi))},difference:function(u,n){if(this.isEmpty(u)||this.isWhole(n))return this.EMPTY.clone();if(this.intervalsOverlap(u,n)){if(u.lo<n.lo&&n.hi<u.hi)throw new Error("Interval.difference: difference creates multiple intervals");return n.lo<=u.lo&&n.hi===1/0||n.hi>=u.hi&&n.lo===-1/0?this.EMPTY.clone():n.lo<=u.lo?new MatInterval().halfOpenLeft(n.hi,u.hi):new MatInterval().halfOpenRight(u.lo,n.lo)}return u.clone()},width:function(u){return this.isEmpty(u)?0:this.subHi(u.hi,u.lo)},abs:function(u){return JXG$1.isNumber(u)&&(u=this.Interval(u)),this.isEmpty(u)?this.EMPTY.clone():u.lo>=0?u.clone():u.hi<=0?this.negative(u):new MatInterval(0,Math.max(-u.lo,u.hi))},max:function(u,n){var d=this.isEmpty(u),C=this.isEmpty(n);return d&&C?this.EMPTY.clone():d?n.clone():C?u.clone():new MatInterval(Math.max(u.lo,n.lo),Math.max(u.hi,n.hi))},min:function(u,n){var d=this.isEmpty(u),C=this.isEmpty(n);return d&&C?this.EMPTY.clone():d?n.clone():C?u.clone():new MatInterval(Math.min(u.lo,n.lo),Math.min(u.hi,n.hi))},onlyInfinity:function(u){return!isFinite(u.lo)&&u.lo===u.hi},_handleNegative:function(u){var n;return u.lo<0&&(u.lo===-1/0?(u.lo=0,u.hi=1/0):(n=Math.ceil(-u.lo/this.piTwiceLow),u.lo+=this.piTwiceLow*n,u.hi+=this.piTwiceLow*n)),u},cos:function(u){var n,d,C,I,f,y,B,_;return this.isEmpty(u)||this.onlyInfinity(u)?this.EMPTY.clone():(n=new MatInterval().set(u.lo,u.hi),this._handleNegative(n),d=this.PI_TWICE,C=this.fmod(n,d),this.width(C)>=d.lo?new MatInterval(-1,1):C.lo>=this.piHigh?(I=this.cos(this.sub(C,this.PI)),this.negative(I)):(f=C.lo,y=C.hi,B=this.cosLo(y),_=this.cosHi(f),y<=this.piLow?new MatInterval(B,_):y<=d.lo?new MatInterval(-1,Math.max(B,_)):new MatInterval(-1,1)))},sin:function(u){return this.isEmpty(u)||this.onlyInfinity(u)?this.EMPTY.clone():this.cos(this.sub(u,this.PI_HALF))},tan:function(u){var n,d,C;return this.isEmpty(u)||this.onlyInfinity(u)?this.EMPTY.clone():(n=new MatInterval().set(u.lo,u.hi),this._handleNegative(n),C=this.PI,d=this.fmod(n,C),d.lo>=this.piHalfLow&&(d=this.sub(d,C)),d.lo<=-this.piHalfLow||d.hi>=this.piHalfLow?this.WHOLE.clone():new MatInterval(this.tanLo(d.lo),this.tanHi(d.hi)))},asin:function(u){var n,d;return this.isEmpty(u)||u.hi<-1||u.lo>1?this.EMPTY.clone():(n=u.lo<=-1?-this.piHalfHigh:this.asinLo(u.lo),d=u.hi>=1?this.piHalfHigh:this.asinHi(u.hi),new MatInterval(n,d))},acos:function(u){var n,d;return this.isEmpty(u)||u.hi<-1||u.lo>1?this.EMPTY.clone():(n=u.hi>=1?0:this.acosLo(u.hi),d=u.lo<=-1?this.piHigh:this.acosHi(u.lo),new MatInterval(n,d))},acot:function(u){return this.isEmpty(u)?this.EMPTY.clone():new MatInterval(this.acotLo(u.lo),this.acotHi(u.hi))},atan:function(u){return this.isEmpty(u)?this.EMPTY.clone():new MatInterval(this.atanLo(u.lo),this.atanHi(u.hi))},sinh:function(u){return this.isEmpty(u)?this.EMPTY.clone():new MatInterval(this.sinhLo(u.lo),this.sinhHi(u.hi))},cosh:function(u){return this.isEmpty(u)?this.EMPTY.clone():u.hi<0?new MatInterval(this.coshLo(u.hi),this.coshHi(u.lo)):u.lo>=0?new MatInterval(this.coshLo(u.lo),this.coshHi(u.hi)):new MatInterval(1,this.coshHi(-u.lo>u.hi?u.lo:u.hi))},tanh:function(u){return this.isEmpty(u)?this.EMPTY.clone():new MatInterval(this.tanhLo(u.lo),this.tanhHi(u.hi))},equal:function(u,n){return this.isEmpty(u)?this.isEmpty(n):!this.isEmpty(n)&&u.lo===n.lo&&u.hi===n.hi},notEqual:function(u,n){return this.isEmpty(u)?!this.isEmpty(n):this.isEmpty(n)||u.hi<n.lo||u.lo>n.hi},lt:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?!1:u.hi<n.lo},gt:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?!1:u.lo>n.hi},leq:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?!1:u.hi<=n.lo},geq:function(u,n){return JXG$1.isNumber(u)&&(u=this.Interval(u)),JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(u)||this.isEmpty(n)?!1:u.lo>=n.hi},piLow:(3373259426+273688/(1<<21))/(1<<30),piHigh:(3373259426+273689/(1<<21))/(1<<30),piHalfLow:(3373259426+273688/(1<<21))/(1<<30)*.5,piHalfHigh:(3373259426+273689/(1<<21))/(1<<30)*.5,piTwiceLow:(3373259426+273688/(1<<21))/(1<<30)*2,piTwiceHigh:(3373259426+273689/(1<<21))/(1<<30)*2,identity:function(u){return u},_prev:function(u){return u===1/0?u:this.nextafter(u,-1/0)},_next:function(u){return u===-1/0?u:this.nextafter(u,1/0)},prev:function(u){return this._prev(u)},next:function(u){return this._next(u)},toInteger:function(u){return u<0?Math.ceil(u):Math.floor(u)},addLo:function(u,n){return this.prev(u+n)},addHi:function(u,n){return this.next(u+n)},subLo:function(u,n){return this.prev(u-n)},subHi:function(u,n){return this.next(u-n)},mulLo:function(u,n){return this.prev(u*n)},mulHi:function(u,n){return this.next(u*n)},divLo:function(u,n){return this.prev(u/n)},divHi:function(u,n){return this.next(u/n)},intLo:function(u){return this.toInteger(this.prev(u))},intHi:function(u){return this.toInteger(this.next(u))},logLo:function(u){return this.prev(Math.log(u))},logHi:function(u){return this.next(Math.log(u))},expLo:function(u){return this.prev(Math.exp(u))},expHi:function(u){return this.next(Math.exp(u))},sinLo:function(u){return this.prev(Math.sin(u))},sinHi:function(u){return this.next(Math.sin(u))},cosLo:function(u){return this.prev(Math.cos(u))},cosHi:function(u){return this.next(Math.cos(u))},tanLo:function(u){return this.prev(Math.tan(u))},tanHi:function(u){return this.next(Math.tan(u))},asinLo:function(u){return this.prev(Math.asin(u))},asinHi:function(u){return this.next(Math.asin(u))},acosLo:function(u){return this.prev(Math.acos(u))},acosHi:function(u){return this.next(Math.acos(u))},acotLo:function(u){return this.prev(Mat.acot(u))},acotHi:function(u){return this.next(Mat.acot(u))},atanLo:function(u){return this.prev(Math.atan(u))},atanHi:function(u){return this.next(Math.atan(u))},sinhLo:function(u){return this.prev(Mat.sinh(u))},sinhHi:function(u){return this.next(Mat.sinh(u))},coshLo:function(u){return this.prev(Mat.cosh(u))},coshHi:function(u){return this.next(Mat.cosh(u))},tanhLo:function(u){return this.prev(Mat.tanh(u))},tanhHi:function(u){return this.next(Mat.tanh(u))},sqrtLo:function(u){return this.prev(Math.sqrt(u))},sqrtHi:function(u){return this.next(Math.sqrt(u))},powLo:function(u,n){var d;if(n%1!==0)return this.prev(Math.pow(u,n));for(d=(n&1)===1?u:1,n>>=1;n>0;)u=this.mulLo(u,u),(n&1)===1&&(d=this.mulLo(u,d)),n>>=1;return d},powHi:function(u,n){var d;if(n%1!==0)return this.next(Math.pow(u,n));for(d=(n&1)===1?u:1,n>>=1;n>0;)u=this.mulHi(u,u),(n&1)===1&&(d=this.mulHi(u,d)),n>>=1;return d},disable:function(){this.next=this.prev=this.identity},enable:function(){this.prev=function(u){return this._prev(u)},this.next=function(u){return this._next(u)}},SMALLEST_DENORM:Math.pow(2,-1074),UINT_MAX:-1>>>0,nextafter:function(u,n){var d,C;return isNaN(u)||isNaN(n)?NaN:u===n?u:u===0?n<0?-this.SMALLEST_DENORM:this.SMALLEST_DENORM:(C=doubleBits.hi(u),d=doubleBits.lo(u),n>u==u>0?d===this.UINT_MAX?(C+=1,d=0):d+=1:d===0?(d=this.UINT_MAX,C-=1):d-=1,doubleBits.pack(d,C))}};JXG$1.Math.IntervalArithmetic.PI=new MatInterval(Mat.IntervalArithmetic.piLow,Mat.IntervalArithmetic.piHigh);JXG$1.Math.IntervalArithmetic.PI_HALF=new MatInterval(Mat.IntervalArithmetic.piHalfLow,Mat.IntervalArithmetic.piHalfHigh);JXG$1.Math.IntervalArithmetic.PI_TWICE=new MatInterval(Mat.IntervalArithmetic.piTwiceLow,Mat.IntervalArithmetic.piTwiceHigh);JXG$1.Math.IntervalArithmetic.ZERO=new MatInterval(0);JXG$1.Math.IntervalArithmetic.ONE=new MatInterval(1);JXG$1.Math.IntervalArithmetic.WHOLE=new MatInterval().setWhole();JXG$1.Math.IntervalArithmetic.EMPTY=new MatInterval().setEmpty();const Interval=JXG$1.Math.IntervalArithmetic;Mat.Extrapolate={upper:15,infty:1e4,wynnEps:function(u,n,d){var C=1e20,I=1e-15,f=1,y,B,_,Z,M,V;if(d[n]=u,n===0)V=u;else{for(Z=0,B=n;B>0;B--)_=Z,Z=d[B-1],M=d[B]-Z,Math.abs(M)<=I?d[B-1]=C:(y=(n-B+1)%2===1?f:1,d[B-1]=_*y+1/M);V=d[n%2]}return V},aitken:function(u,n,d){var C,I=1e20,f=1e-15,y,B,_,Z,M;if(d[n]=u,n<2)C=u;else{for(_=n/2,Z=1;Z<=_;Z++)M=n-2*Z,y=d[M+2]-2*d[M+1]+d[M],Math.abs(y)<f?d[M]=I:(B=d[M]-d[M+1],d[M]-=B*B/y);C=d[n%2]}return C},brezinski:function(u,n,d){var C,I=1e20,f=1e-15,y,B,_,Z,M,V,T;if(d[n]=u,n<3)C=u;else{for(M=n/3,T=n,V=1;V<=M;V++)T-=3,B=d[T+1]-d[T],_=d[T+2]-d[T+1],Z=d[T+3]-d[T+2],y=Z*(_-B)-B*(Z-_),Math.abs(y)<f?d[T]=I:d[T]=d[T+1]-B*_*(Z-_)/y;C=d[n%3]}return C},iteration:function(u,n,d,C,I){var f,y,B,_=NaN,Z,M=.5,V=[],T="finite",H=n;for(I=I||0,f=1;f<=this.upper;f++){if(H=I===0?n/(f+1):H*M,y=d(u+H,!0),B=this[C](y,f-1,V),isNaN(B)){T="NaN";break}if(y!==0&&B/y>this.infty){_=B,T="infinite";break}if(Z=B-_,Math.abs(Z)<1e-7)break;_=B}return[_,T,1-(f-1)/this.upper]},levin:function(u,n,d,C,I,f){var y=1e20,B=1e-15,_,Z,M,V,T;if(V=1/(C+n),I[n]=u/d,f[n]=1/d,n>0&&(I[n-1]=I[n]-I[n-1],f[n-1]=f[n]-f[n-1],n>1))for(M=(C+n-1)*V,_=2;_<=n;_++)Z=(C+n-_)*Math.pow(M,_-2)*V,I[n-_]=I[n-_+1]-Z*I[n-_],f[n-_]=f[n-_+1]-Z*f[n-_],V*=M;return Math.abs(f[0])<B?T=y:T=I[0]/f[0],T},iteration_levin:function(u,n,d,C){var I,f,y,B=NaN,_,Z,M,V,T=1,H=.5,F=[],O=[],$="finite",U=n,ee="u";for(C=C||0,_=d(u+n,!0),I=1;I<=this.upper;I++){if(U=C===0?n/(I+1):U*H,f=d(u+U,!0),Z=f-_,Math.abs(Z)<1?ee="u":ee="t",ee==="u"?V=(T+I)*Z:V=Z,_=f,y=this.levin(f,I-1,V,T,F,O),M=y-B,isNaN(y)){$="NaN";break}if(f!==0&&y/f>this.infty){B=y,$="infinite";break}if(Math.abs(M)<1e-7)break;B=y}return[B,$,1-(I-1)/this.upper]},limit:function(u,n,d){return this.iteration_levin(u,n,d,0)}};const Extrapolate=Mat.Extrapolate;var predefinedButcher={rk4:{s:4,A:[[0,0,0,0],[.5,0,0,0],[0,.5,0,0],[0,0,1,0]],b:[1/6,1/3,1/3,1/6],c:[0,.5,.5,1]},heun:{s:2,A:[[0,0],[1,0]],b:[.5,.5],c:[0,1]},euler:{s:1,A:[[0]],b:[1],c:[0]}};Mat.Numerics={Gauss:function(u,n){var d,C,I,f,y,B=Mat.eps,_=u.length>0?u[0].length:0;if(_!==n.length||_!==u.length)throw new Error("JXG.Math.Numerics.Gauss: Dimensions don't match. A must be a square matrix and b must be of the same length as A.");for(f=[],y=n.slice(0,_),d=0;d<_;d++)f[d]=u[d].slice(0,_);for(C=0;C<_;C++){for(d=_-1;d>C;d--)if(Math.abs(f[d][C])>B)if(Math.abs(f[C][C])<B)JXG$1.swap(f,d,C),JXG$1.swap(y,d,C);else for(f[d][C]/=f[C][C],y[d]-=f[d][C]*y[C],I=C+1;I<_;I++)f[d][I]-=f[d][C]*f[C][I];if(Math.abs(f[C][C])<B)throw new Error("JXG.Math.Numerics.Gauss(): The given matrix seems to be singular.")}return this.backwardSolve(f,y,!0),y},backwardSolve:function(u,n,d){var C,I,f,y,B;for(d?C=n:C=n.slice(0,n.length),I=u.length,f=u.length>0?u[0].length:0,y=I-1;y>=0;y--){for(B=f-1;B>y;B--)C[y]-=u[y][B]*C[B];C[y]/=u[y][y]}return C},gaussBareiss:function(u){var n,d,C,I,f,y,B,_,Z,M=Mat.eps;if(B=u.length,B<=0)return 0;for(u[0].length<B&&(B=u[0].length),_=[],I=0;I<B;I++)_[I]=u[I].slice(0,B);for(d=1,C=1,n=0;n<B-1;n++){if(y=_[n][n],Math.abs(y)<M){for(I=n+1;I<B&&!(Math.abs(_[I][n])>=M);I++);if(I===B)return 0;for(f=n;f<B;f++)Z=_[I][f],_[I][f]=_[n][f],_[n][f]=Z;C=-C,y=_[n][n]}for(I=n+1;I<B;I++)for(f=n+1;f<B;f++)Z=y*_[I][f]-_[I][n]*_[n][f],_[I][f]=Z/d;d=y}return C*_[B-1][B-1]},det:function(u){var n=u.length;return n===2&&u[0].length===2?u[0][0]*u[1][1]-u[1][0]*u[0][1]:this.gaussBareiss(u)},Jacobi:function(u){var n,d,C,I,f,y,B,_,Z=Mat.eps*Mat.eps,M=0,V=u.length,T=[[0,0,0],[0,0,0],[0,0,0]],H=[[0,0,0],[0,0,0],[0,0,0]],F=0;for(n=0;n<V;n++){for(d=0;d<V;d++)T[n][d]=0,H[n][d]=u[n][d],M+=Math.abs(H[n][d]);T[n][n]=1}if(V===1)return[H,T];if(M<=0)return[H,T];M/=V*V;do{for(_=0,d=1;d<V;d++)for(n=0;n<d;n++)if(I=Math.abs(H[n][d]),_+=I,I>=Z){for(I=Math.atan2(2*H[n][d],H[n][n]-H[d][d])*.5,f=Math.sin(I),y=Math.cos(I),C=0;C<V;C++)B=H[C][n],H[C][n]=y*B+f*H[C][d],H[C][d]=-f*B+y*H[C][d],B=T[C][n],T[C][n]=y*B+f*T[C][d],T[C][d]=-f*B+y*T[C][d];for(H[n][n]=y*H[n][n]+f*H[d][n],H[d][d]=-f*H[n][d]+y*H[d][d],H[n][d]=0,C=0;C<V;C++)H[n][C]=H[C][n],H[d][C]=H[C][d]}F+=1}while(Math.abs(_)/M>Z&&F<2e3);return[H,T]},NewtonCotes:function(u,n,d){var C,I,f,y=0,B=d&&JXG$1.isNumber(d.number_of_nodes)?d.number_of_nodes:28,_={trapez:!0,simpson:!0,milne:!0},Z=d&&d.integration_type&&_.hasOwnProperty(d.integration_type)&&_[d.integration_type]?d.integration_type:"milne",M=(u[1]-u[0])/B;switch(Z){case"trapez":for(y=(n(u[0])+n(u[1]))*.5,C=u[0],I=0;I<B-1;I++)C+=M,y+=n(C);y*=M;break;case"simpson":if(B%2>0)throw new Error("JSXGraph:  INT_SIMPSON requires config.number_of_nodes dividable by 2.");for(f=B/2,y=n(u[0])+n(u[1]),C=u[0],I=0;I<f-1;I++)C+=2*M,y+=2*n(C);for(C=u[0]-M,I=0;I<f;I++)C+=2*M,y+=4*n(C);y*=M/3;break;default:if(B%4>0)throw new Error("JSXGraph: Error in INT_MILNE: config.number_of_nodes must be a multiple of 4");for(f=B*.25,y=7*(n(u[0])+n(u[1])),C=u[0],I=0;I<f-1;I++)C+=4*M,y+=14*n(C);for(C=u[0]-3*M,I=0;I<f;I++)C+=4*M,y+=32*(n(C)+n(C+2*M));for(C=u[0]-2*M,I=0;I<f;I++)C+=4*M,y+=12*n(C);y*=2*M/45}return y},Romberg:function(u,n,d){var C,I,f,y,B,_,Z,M,V=[],T=0,H=1/0,F=d&&JXG$1.isNumber(d.max_iterations)?d.max_iterations:20,O=d&&JXG$1.isNumber(d.eps)?d.eps:d.eps||1e-7;for(C=u[0],I=u[1],f=I-C,B=1,V[0]=.5*f*(n(C)+n(I)),_=0;_<F;++_){for(y=0,f*=.5,B*=2,M=1,Z=1;Z<B;Z+=2)y+=n(C+Z*f);for(V[_+1]=.5*V[_]+y*f,T=V[_+1],Z=_-1;Z>=0;--Z)M*=4,V[Z]=V[Z+1]+(V[Z+1]-V[Z])/(M-1),T=V[Z];if(Math.abs(T-H)<O*Math.abs(T))break;H=T}return T},GaussLegendre:function(u,n,d){var C,I,f,y,B,_,Z=0,M=[],V=[],T,H,F=d&&JXG$1.isNumber(d.n)?d.n:12;if(F>18&&(F=18),M[2]=[.5773502691896257],V[2]=[1],M[4]=[.33998104358485626,.8611363115940526],V[4]=[.6521451548625461,.34785484513745385],M[6]=[.2386191860831969,.6612093864662645,.932469514203152],V[6]=[.46791393457269104,.3607615730481386,.17132449237917036],M[8]=[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],V[8]=[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],M[10]=[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],V[10]=[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],M[12]=[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],V[12]=[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],M[14]=[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],V[14]=[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],M[16]=[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499],V[16]=[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096],M[18]=[.0847750130417353,.2518862256915055,.41175116146284263,.5597708310739475,.6916870430603532,.8037049589725231,.8926024664975557,.9558239495713977,.9915651684209309],V[18]=[.1691423829631436,.16427648374583273,.15468467512626524,.14064291467065065,.12255520671147846,.10094204410628717,.07642573025488905,.0497145488949698,.02161601352648331],M[3]=[0,.7745966692414834],V[3]=[.8888888888888888,.5555555555555556],M[5]=[0,.5384693101056831,.906179845938664],V[5]=[.5688888888888889,.47862867049936647,.23692688505618908],M[7]=[0,.4058451513773972,.7415311855993945,.9491079123427585],V[7]=[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],M[9]=[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],V[9]=[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],M[11]=[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],V[11]=[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],M[13]=[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],V[13]=[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],M[15]=[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],V[15]=[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],M[17]=[0,.17848418149584785,.3512317634538763,.5126905370864769,.6576711592166907,.7815140038968014,.8802391537269859,.9506755217687678,.9905754753144174],V[17]=[.17944647035620653,.17656270536699264,.16800410215645004,.15404576107681028,.13513636846852548,.11188384719340397,.08503614831717918,.0554595293739872,.02414830286854793],C=u[0],I=u[1],y=F+1>>1,T=M[F],H=V[F],_=.5*(I-C),B=.5*(I+C),F&!0)for(Z=H[0]*n(B),f=1;f<y;++f)Z+=H[f]*(n(B+_*T[f])+n(B-_*T[f]));else for(Z=0,f=0;f<y;++f)Z+=H[f]*(n(B+_*T[f])+n(B-_*T[f]));return _*Z},_rescale_error:function(u,n,d){var C,I,f=22250738585072014e-324,y=2220446049250313e-31;return u=Math.abs(u),d!==0&&u!==0&&(C=Math.pow(200*u/d,1.5),C<1?u=d*C:u=d),n>f/(50*y)&&(I=50*y*n,I>u&&(u=I)),u},_gaussKronrod:function(u,n,d,C,I,f,y){var B=u[0],_=u[1],Z,M,V=.5*(B+_),T=.5*(_-B),H=Math.abs(T),F=n(V),O=0,$=F*f[d-1],U=Math.abs($),ee=0,Q=0,ie=0,ne,le,ae,ce,ge,he,Ie,fe=[],me=[];for(d%2===0&&(O=F*I[d/2-1]),Z=Math.floor((d-1)/2),ne=0;ne<Z;ne++)le=ne*2+1,ae=T*C[le],ce=n(V-ae),ge=n(V+ae),he=ce+ge,fe[le]=ce,me[le]=ge,O+=I[ne]*he,$+=f[le]*he,U+=f[le]*(Math.abs(ce)+Math.abs(ge));for(Z=Math.floor(d/2),ne=0;ne<Z;ne++)Ie=ne*2,ae=T*C[Ie],ce=n(V-ae),ge=n(V+ae),fe[Ie]=ce,me[Ie]=ge,$+=f[Ie]*(ce+ge),U+=f[Ie]*(Math.abs(ce)+Math.abs(ge));for(Q=$*.5,ee=f[d-1]*Math.abs(F-Q),ne=0;ne<d-1;ne++)ee+=f[ne]*(Math.abs(fe[ne]-Q)+Math.abs(me[ne]-Q));return ie=($-O)*T,$*=T,U*=H,ee*=H,M=$,y.abserr=this._rescale_error(ie,U,ee),y.resabs=U,y.resasc=ee,M},GaussKronrod15:function(u,n,d){var C=[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],I=[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694],f=[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782];return this._gaussKronrod(u,n,8,C,I,f,d)},GaussKronrod21:function(u,n,d){var C=[.9956571630258081,.9739065285171717,.9301574913557082,.8650633666889845,.7808177265864169,.6794095682990244,.5627571346686047,.4333953941292472,.2943928627014602,.14887433898163122,0],I=[.06667134430868814,.1494513491505806,.21908636251598204,.26926671930999635,.29552422471475287],f=[.011694638867371874,.032558162307964725,.054755896574351995,.07503967481091996,.0931254545836976,.10938715880229764,.12349197626206584,.13470921731147334,.14277593857706009,.14773910490133849,.1494455540029169];return this._gaussKronrod(u,n,11,C,I,f,d)},GaussKronrod31:function(u,n,d){var C=[.9980022986933971,.9879925180204854,.9677390756791391,.937273392400706,.8972645323440819,.8482065834104272,.790418501442466,.7244177313601701,.650996741297417,.5709721726085388,.4850818636402397,.3941513470775634,.29918000715316884,.20119409399743451,.1011420669187175,0],I=[.03075324199611727,.07036604748810812,.10715922046717194,.13957067792615432,.16626920581699392,.1861610000155622,.19843148532711158,.2025782419255613],f=[.005377479872923349,.015007947329316122,.02546084732671532,.03534636079137585,.04458975132476488,.05348152469092809,.06200956780067064,.06985412131872826,.07684968075772038,.08308050282313302,.08856444305621176,.09312659817082532,.09664272698362368,.09917359872179196,.10076984552387559,.10133000701479154];return this._gaussKronrod(u,n,16,C,I,f,d)},_workspace:function(u,n){return{limit:n,size:0,nrmax:0,i:0,alist:[u[0]],blist:[u[1]],rlist:[0],elist:[0],order:[0],level:[0],qpsrt:function(){var d=this.size-1,C=this.limit,I,f,y,B,_,Z=this.nrmax,M=this.order[Z];if(d<2){this.order[0]=0,this.order[1]=1,this.i=M;return}for(I=this.elist[M];Z>0&&I>this.elist[this.order[Z-1]];)this.order[Z]=this.order[Z-1],Z--;for(d<C/2+2?_=d:_=C-d+1,y=Z+1;y<_&&I<this.elist[this.order[y]];)this.order[y-1]=this.order[y],y++;for(this.order[y-1]=M,f=this.elist[d],B=_-1;B>y-2&&f>=this.elist[this.order[B]];)this.order[B+1]=this.order[B],B--;this.order[B+1]=d,M=this.order[Z],this.i=M,this.nrmax=Z},set_initial_result:function(d,C){this.size=1,this.rlist[0]=d,this.elist[0]=C},update:function(d,C,I,f,y,B,_,Z){var M=this.i,V=this.size,T=this.level[this.i]+1;Z>f?(this.alist[M]=y,this.rlist[M]=_,this.elist[M]=Z,this.level[M]=T,this.alist[V]=d,this.blist[V]=C,this.rlist[V]=I,this.elist[V]=f,this.level[V]=T):(this.blist[M]=C,this.rlist[M]=I,this.elist[M]=f,this.level[M]=T,this.alist[V]=y,this.blist[V]=B,this.rlist[V]=_,this.elist[V]=Z,this.level[V]=T),this.size++,T>this.maximum_level&&(this.maximum_level=T),this.qpsrt()},retrieve:function(){var d=this.i;return{a:this.alist[d],b:this.blist[d],r:this.rlist[d],e:this.elist[d]}},sum_results:function(){var d=this.size,C,I=0;for(C=0;C<d;C++)I+=this.rlist[C];return I},subinterval_too_small:function(d,C,I){var f=2220446049250313e-31,y=22250738585072014e-324,B=(1+100*f)*(Math.abs(C)+1e3*y);return Math.abs(d)<=B&&Math.abs(I)<=B}}},Qag:function(u,n,d){var C=2220446049250313e-31,I=this._workspace(u,1e3),f=d&&JXG$1.isNumber(d.limit)?d.limit:15,y=d&&JXG$1.isNumber(d.epsrel)?d.epsrel:1e-7,B=d&&JXG$1.isNumber(d.epsabs)?d.epsabs:1e-7,_=d&&JXG$1.isFunction(d.q)?d.q:this.GaussKronrod15,Z={},M,V,T,H,F,O,$,U,ee=0,Q=0,ie=0,ne=0,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze=0,ye=0,Ee=0,Ve=0,Ye=0,be=0,Be,Ne,Ae,Re;if(f>I.limit&&JXG$1.warn("iteration limit exceeds available workspace"),B<=0&&(y<50*Mat.eps||y<5e-29)&&JXG$1.warn("tolerance cannot be acheived with given epsabs and epsrel"),T=_.apply(this,[u,n,Z]),H=Z.abserr,F=Z.resabs,O=Z.resasc,I.set_initial_result(T,H),U=Math.max(B,y*Math.abs(T)),le=50*C*F,H<=le&&H>U)return $=T,JXG$1.warn("cannot reach tolerance because of roundoff error on first attempt"),-1/0;if(H<=U&&H!==O||H===0)return $=T,$;if(f===1)return $=T,JXG$1.warn("a maximum of one iteration was insufficient"),-1/0;M=T,V=H,ee=1;do Ze=0,ye=0,Ee=0,Ve=0,Ye=0,be=0,Ae=I.retrieve(),Ie=Ae.a,fe=Ae.b,me=Ae.r,Ge=Ae.e,ae=Ie,ce=.5*(Ie+fe),ge=ce,he=fe,Ze=_.apply(this,[[ae,ce],n,Z]),Ve=Z.abserr,Be=Z.resasc,ye=_.apply(this,[[ge,he],n,Z]),Ye=Z.abserr,Ne=Z.resasc,Ee=Ze+ye,be=Ve+Ye,V+=be-Ge,M+=Ee-me,Be!==Ve&&Ne!==Ye&&(Re=me-Ee,Math.abs(Re)<=1e-5*Math.abs(Ee)&&be>=.99*Ge&&Q++,ee>=10&&be>Ge&&ie++),U=Math.max(B,y*Math.abs(M)),V>U&&((Q>=6||ie>=20)&&(ne=2),I.subinterval_too_small(ae,ge,he)&&(ne=3)),I.update(ae,ce,Ze,Ve,ge,he,ye,Ye),Ae=I.retrieve(),Ie=Ae.a_i,fe=Ae.b_i,me=Ae.r_i,Ge=Ae.e_i,ee++;while(ee<f&&!ne&&V>U);return $=I.sum_results(),$},I:function(u,n){return this.Qag(u,n,{q:this.GaussKronrod15,limit:15,epsrel:1e-7,epsabs:1e-7})},Newton:function(u,n,d){var C,I=0,f=Mat.eps,y=u.apply(d,[n]);for(JXG$1.isArray(n)&&(n=n[0]);I<50&&Math.abs(y)>f;)C=this.D(u,d)(n),Math.abs(C)>f?n-=y/C:n+=Math.random()*.2-1,y=u.apply(d,[n]),I+=1;return n},root:function(u,n,d){return this.chandrupatla(u,n,d)},generalizedNewton:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee=0;for(this.generalizedNewton.t1memo?(I=this.generalizedNewton.t1memo,f=this.generalizedNewton.t2memo):(I=d,f=C),M=u.X(I)-n.X(f),V=u.Y(I)-n.Y(f),H=M*M+V*V,F=this.D(u.X,u),O=this.D(n.X,n),$=this.D(u.Y,u),U=this.D(n.Y,n);H>Mat.eps&&ee<10;)y=F(I),B=-O(f),_=$(I),Z=-U(f),T=y*Z-B*_,I-=(Z*M-B*V)/T,f-=(y*V-_*M)/T,M=u.X(I)-n.X(f),V=u.Y(I)-n.Y(f),H=M*M+V*V,ee+=1;return this.generalizedNewton.t1memo=I,this.generalizedNewton.t2memo=f,Math.abs(I)<Math.abs(f)?[u.X(I),u.Y(I)]:[n.X(f),n.Y(f)]},Neville:function(u){var n=[],d=function(f){return function(y,B){var _,Z,M,V=Mat.binomial,T=u.length,H=T-1,F=0,O=0;if(!B)for(M=1,_=0;_<T;_++)n[_]=V(H,_)*M,M*=-1;for(Z=y,_=0;_<T;_++){if(Z===0)return u[_][f]();M=n[_]/Z,Z-=1,F+=u[_][f]()*M,O+=M}return F/O}},C=d("X"),I=d("Y");return[C,I,0,function(){return u.length-1}]},splineDef:function(u,n){var d,C,I,f=Math.min(u.length,n.length),y=[],B=[],_=[],Z=[],M=[],V=[];if(f===2)return[0,0];for(C=0;C<f;C++)d={X:u[C],Y:n[C]},_.push(d);for(_.sort(function(T,H){return T.X-H.X}),C=0;C<f;C++)u[C]=_[C].X,n[C]=_[C].Y;for(C=0;C<f-1;C++)Z.push(u[C+1]-u[C]);for(C=0;C<f-2;C++)M.push(6*(n[C+2]-n[C+1])/Z[C+1]-6*(n[C+1]-n[C])/Z[C]);for(y.push(2*(Z[0]+Z[1])),B.push(M[0]),C=0;C<f-3;C++)I=Z[C+1]/y[C],y.push(2*(Z[C+1]+Z[C+2])-I*Z[C+1]),B.push(M[C+1]-I*B[C]);for(V[f-3]=B[f-3]/y[f-3],C=f-4;C>=0;C--)V[C]=(B[C]-Z[C+1]*V[C+1])/y[C];for(C=f-3;C>=0;C--)V[C+1]=V[C];return V[0]=0,V[f-1]=0,V},splineEval:function(u,n,d,C){var I,f,y,B,_,Z,M,V=Math.min(n.length,d.length),T=1,H=!1,F=[];for(JXG$1.isArray(u)?(T=u.length,H=!0):u=[u],I=0;I<T;I++){if(u[I]<n[0]||n[I]>n[V-1])return NaN;for(f=1;f<V&&!(u[I]<=n[f]);f++);f-=1,y=d[f],B=(d[f+1]-d[f])/(n[f+1]-n[f])-(n[f+1]-n[f])/6*(C[f+1]+2*C[f]),_=C[f]/2,Z=(C[f+1]-C[f])/(6*(n[f+1]-n[f])),M=u[I]-n[f],F.push(y+(B+(_+Z*M)*M)*M)}return H?F:F[0]},generatePolynomialTerm:function(u,n,d,C){var I,f=[];for(I=n;I>=0;I--)JXG$1.concat(f,["(",u[I].toPrecision(C),")"]),I>1?JXG$1.concat(f,["*",d,"<sup>",I,"<","/sup> + "]):I===1&&JXG$1.concat(f,["*",d," + "]);return f.join("")},lagrangePolynomial:function(u){var n=[],d=this,C=function(I,f){var y,B,_,Z,M=u.length,V=0,T=0;if(!f)for(y=0;y<M;y++){for(n[y]=1,_=u[y].X(),B=0;B<M;B++)B!==y&&(n[y]*=_-u[B].X());n[y]=1/n[y]}for(y=0;y<M;y++){if(_=u[y].X(),I===_)return u[y].Y();Z=n[y]/(I-_),T+=Z,V+=Z*u[y].Y()}return V/T};return C.getTerm=function(I,f,y){return d.lagrangePolynomialTerm(u,I,f,y)()},C.getCoefficients=function(){return d.lagrangePolynomialCoefficients(u)()},C},lagrangePolynomialTerm:function(u,n,d,C){var I=this;return function(){var f=u.length,y=[],B=!0,_,Z,M,V;for(d=d||"x",C===void 0&&(C=" * "),_=f-1,y=I.lagrangePolynomialCoefficients(u)(),Z="",M=0;M<y.length;M++)V=y[M],!(Math.abs(V)<Mat.eps)&&(JXG$1.exists(n)&&(V=JXG$1._round10(V,-n)),B?(Z+=V>0?V:"-"+-V,B=!1):Z+=V>0?" + "+V:" - "+-V,_-M>1?Z+=C+d+"^"+(_-M):_-M===1&&(Z+=C+d));return Z}},lagrangePolynomialCoefficients:function(u){return function(){var n=u.length,d=[],C=[],I=[],f,y,B,_;for(y=0;y<n;y++)I[y]=0;for(f=0;f<n;f++){for(B=u[f].Y(),_=u[f].X(),d=[],y=0;y<n;y++)y!==f&&(B/=_-u[y].X(),d.push(u[y].X()));for(C=[1].concat(Mat.Vieta(d)),y=0;y<C.length;y++)I[y]+=(y%2===1?-1:1)*C[y]*B}return I}},_initCubicPoly:function(u,n,d,C){return[u,d,-3*u+3*n-2*d-C,2*u-2*n+d+C]},CardinalSpline:function(u,n,d){var C,I=[],f,y,B,_=this;return JXG$1.isFunction(n)?B=n:B=function(){return n},d===void 0&&(d="uniform"),f=function(Z){return function(M,V){var T,H,F,O,$,U,ee,Q,ie,ne;if(u.length<2)return NaN;if(!V)for(y=B(),F={X:function(){return 2*u[0].X()-u[1].X()},Y:function(){return 2*u[0].Y()-u[1].Y()},Dist:function(le){var ae=this.X()-le.X(),ce=this.Y()-le.Y();return Mat.hypot(ae,ce)}},O={X:function(){return 2*u[u.length-1].X()-u[u.length-2].X()},Y:function(){return 2*u[u.length-1].Y()-u[u.length-2].Y()},Dist:function(le){var ae=this.X()-le.X(),ce=this.Y()-le.Y();return Mat.hypot(ae,ce)}},C=[F].concat(u,[O]),ne=C.length,I[Z]=[],T=0;T<ne-3;T++)d==="centripetal"?(ee=C[T].Dist(C[T+1]),Q=C[T+2].Dist(C[T+1]),ie=C[T+3].Dist(C[T+2]),ee=Math.sqrt(ee),Q=Math.sqrt(Q),ie=Math.sqrt(ie),Q<Mat.eps&&(Q=1),ee<Mat.eps&&(ee=Q),ie<Mat.eps&&(ie=Q),$=(C[T+1][Z]()-C[T][Z]())/ee-(C[T+2][Z]()-C[T][Z]())/(Q+ee)+(C[T+2][Z]()-C[T+1][Z]())/Q,U=(C[T+2][Z]()-C[T+1][Z]())/Q-(C[T+3][Z]()-C[T+1][Z]())/(ie+Q)+(C[T+3][Z]()-C[T+2][Z]())/ie,$*=Q,U*=Q,I[Z][T]=_._initCubicPoly(C[T+1][Z](),C[T+2][Z](),y*$,y*U)):I[Z][T]=_._initCubicPoly(C[T+1][Z](),C[T+2][Z](),y*(C[T+2][Z]()-C[T][Z]()),y*(C[T+3][Z]()-C[T+1][Z]()));return isNaN(M)?NaN:(ne=u.length,M<=0?u[0][Z]():M>=ne?u[ne-1][Z]():(T=Math.floor(M),T===M?u[T][Z]():(M-=T,H=I[Z][T],H===void 0?NaN:((H[3]*M+H[2])*M+H[1])*M+H[0])))}},[f("X"),f("Y"),0,function(){return u.length-1}]},CatmullRomSpline:function(u,n){return this.CardinalSpline(u,.5,n)},regressionPolynomial:function(u,n,d){var C,I,f,y,B,_,Z="";if(JXG$1.isPoint(u)&&JXG$1.isFunction(u.Value))I=function(){return u.Value()};else if(JXG$1.isFunction(u))I=u;else if(JXG$1.isNumber(u))I=function(){return u};else throw new Error("JSXGraph: Can't create regressionPolynomial from degree of type'"+typeof u+"'.");if(arguments.length===3&&JXG$1.isArray(n)&&JXG$1.isArray(d))B=0;else if(arguments.length===2&&JXG$1.isArray(n)&&n.length>0&&JXG$1.isPoint(n[0]))B=1;else if(arguments.length===2&&JXG$1.isArray(n)&&n.length>0&&n[0].usrCoords&&n[0].scrCoords)B=2;else throw new Error("JSXGraph: Can't create regressionPolynomial. Wrong parameters.");return _=function(M,V){var T,H,F,O,$,U,ee,Q,ie,ne=n.length;if(ie=Math.floor(I()),!V){if(B===1)for(f=[],y=[],T=0;T<ne;T++)f[T]=n[T].X(),y[T]=n[T].Y();if(B===2)for(f=[],y=[],T=0;T<ne;T++)f[T]=n[T].usrCoords[1],y[T]=n[T].usrCoords[2];if(B===0)for(f=[],y=[],T=0;T<ne;T++)JXG$1.isFunction(n[T])?f.push(n[T]()):f.push(n[T]),JXG$1.isFunction(d[T])?y.push(d[T]()):y.push(d[T]);for(F=[],H=0;H<ne;H++)F.push([1]);for(T=1;T<=ie;T++)for(H=0;H<ne;H++)F[H][T]=F[H][T-1]*f[H];$=y,O=Mat.transpose(F),U=Mat.matMatMult(O,F),ee=Mat.matVecMult(O,$),C=Mat.Numerics.Gauss(U,ee),Z=Mat.Numerics.generatePolynomialTerm(C,ie,"x",3)}for(Q=C[ie],T=ie-1;T>=0;T--)Q=Q*M+C[T];return Q},_.getTerm=function(){return Z},_},bezier:function(u){var n,d,C=function(I){return function(f,y){var B=Math.floor(f)*3,_=f%1,Z=1-_;return y||(d=3*Math.floor((u.length-1)/3),n=Math.floor(d/3)),f<0?u[0][I]():f>=n?u[d][I]():isNaN(f)?NaN:Z*Z*(Z*u[B][I]()+3*_*u[B+1][I]())+(3*Z*u[B+2][I]()+_*u[B+3][I]())*_*_}};return[C("X"),C("Y"),0,function(){return Math.floor(u.length/3)}]},bspline:function(u,n){var d,C=function(y,B){var _,Z=[];for(_=0;_<y+B+1;_++)_<B?Z[_]=0:_<=y?Z[_]=_-B+1:Z[_]=y-B+2;return Z},I=function(y,B,_,Z){var M,V,T,H,F,O=[];for(B[Z]<=y&&y<B[Z+1]?O[Z]=1:O[Z]=0,M=2;M<=_;M++)for(V=Z-M+1;V<=Z;V++)V<=Z-M+1||V<0?T=0:T=O[V],V>=Z?H=0:H=O[V+1],F=B[V+M-1]-B[V],F===0?O[V]=0:O[V]=(y-B[V])/F*T,F=B[V+M]-B[V+1],F!==0&&(O[V]+=(B[V+M]-y)/F*H);return O},f=function(y){return function(B,_){var Z,M,V,T=[],H=u.length,F=H-1,O=n;if(F<=0)return NaN;if(F+2<=O&&(O=F+1),B<=0)return u[0][y]();if(B>=F-O+2)return u[F][y]();for(V=Math.floor(B)+O-1,d=C(F,O),T=I(B,d,O,V),Z=0,M=V-O+1;M<=V;M++)M<H&&M>=0&&(Z+=u[M][y]()*T[M]);return Z}};return[f("X"),f("Y"),0,function(){return u.length-1}]},D:function(u,n){return JXG$1.exists(n)?function(d,C){var I=1e-5,f=I*2;return(u.apply(n,[d+I,C])-u.apply(n,[d-I,C]))/f}:function(d,C){var I=1e-5,f=I*2;return(u(d+I,C)-u(d-I,C))/f}},_riemannValue:function(u,n,d,C){var I,f,y,B;if(C<0&&(d!=="trapezoidal"&&(u=u+C),C*=-1,d==="lower"?d="upper":d==="upper"&&(d="lower")),B=C*.01,d==="right")I=n(u+C);else if(d==="middle")I=n(u+C*.5);else if(d==="left"||d==="trapezoidal")I=n(u);else if(d==="lower"){for(I=n(u),y=u+B;y<=u+C;y+=B)f=n(y),f<I&&(I=f);f=n(u+C),f<I&&(I=f)}else if(d==="upper"){for(I=n(u),y=u+B;y<=u+C;y+=B)f=n(y),f>I&&(I=f);f=n(u+C),f>I&&(I=f)}else d==="random"?I=n(u+C*Math.random()):d==="simpson"?I=(n(u)+4*n(u+C*.5)+n(u+C))/6:I=n(u);return I},riemann:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T,H,F,O,$=30,U=[],ee=[],Q=C,ie=0,ne,le,ae;if(JXG$1.isArray(u)?(ae=u[0],le=u[1]):le=u,n=Math.floor(n),n<=0)return[U,ee,ie];for(y=(I-C)/n,f=0;f<n;f++){if(d==="simpson"){for(ie+=this._riemannValue(Q,le,d,y)*y,O=y*.5,V=le(Q),T=le(Q+O),H=le(Q+2*O),_=(H+V-2*T)/(O*O)*.5,Z=(H-V)/(2*O),M=T,B=0;B<$;B++)F=B*y/$-O,U.push(Q+F+O),ee.push(_*F*F+Z*F+M);Q+=y,ne=H}else ne=this._riemannValue(Q,le,d,y),U.push(Q),ee.push(ne),Q+=y,d==="trapezoidal"?(H=le(Q),ie+=(ne+H)*.5*y,ne=H):ie+=ne*y,U.push(Q),ee.push(ne);U.push(Q),ee.push(ne)}for(f=0;f<n;f++){if(d==="simpson"&&ae){for(ie-=this._riemannValue(Q,ae,d,-y)*y,O=y*.5,V=ae(Q),T=ae(Q-O),H=ae(Q-2*O),_=(H+V-2*T)/(O*O)*.5,Z=(H-V)/(2*O),M=T,B=0;B<$;B++)F=B*y/$-O,U.push(Q-F-O),ee.push(_*F*F+Z*F+M);Q-=y,ne=H}else ae?ne=this._riemannValue(Q,ae,d,-y):ne=0,U.push(Q),ee.push(ne),Q-=y,ae&&(d==="trapezoidal"?(H=ae(Q),ie-=(ne+H)*.5*y,ne=H):ie-=ne*y);U.push(Q),ee.push(ne),U.push(Q),ee.push(le(Q))}return[U,ee,ie]},riemannsum:function(u,n,d,C,I){return JXG$1.deprecated("Numerics.riemannsum()","Numerics.riemann()[2]"),this.riemann(u,n,d,C,I)[2]},rungeKutta:function(u,n,d,C,I){var f,y,B,_,Z,M,V=[],T=[],H=(d[1]-d[0])/C,F=d[0],O=n.length,$=[],U=0;for(JXG$1.isString(u)&&(u=predefinedButcher[u]||predefinedButcher.euler),M=u.s,V=n.slice(),y=0;y<=C;y++){for($[U]=V.slice(),U++,_=[],B=0;B<M;B++){for(f=0;f<O;f++)T[f]=0;for(Z=0;Z<B;Z++)for(f=0;f<O;f++)T[f]+=u.A[B][Z]*H*_[Z][f];for(f=0;f<O;f++)T[f]+=V[f];_.push(I(F+u.c[B]*H,T))}for(f=0;f<O;f++)T[f]=0;for(Z=0;Z<M;Z++)for(f=0;f<O;f++)T[f]+=u.b[Z]*_[Z][f];for(f=0;f<O;f++)V[f]=V[f]+H*T[f];F+=H}return $},maxIterationsRoot:80,maxIterationsMinimize:500,findBracket:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T;if(JXG$1.isArray(n))return n;for(C=n,f=u.call(d,C),I=C===0?1:C,y=[C-.1*I,C+.1*I,C-1,C+1,C-.5*I,C+.5*I,C-.6*I,C+.6*I,C-1*I,C+1*I,C-2*I,C+2*I,C-5*I,C+5*I,C-10*I,C+10*I,C-50*I,C+50*I,C-100*I,C+100*I],T=y.length,V=0;V<T&&(B=y[V],_=u.call(d,B),!(f*_<=0));V++);return B<C&&(Z=C,C=B,B=Z,M=f,f=_,_=M),[C,f,B,_]},fzero:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q=Mat.eps,ie=this.maxIterationsRoot,ne=0;if(JXG$1.isArray(n)){if(n.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");M=this.findDomain(u,n,d),C=M[0],I=M[1],y=u.call(d,C),B=u.call(d,I)}else Z=this.findBracket(u,n,d),C=Z[0],y=Z[1],I=Z[2],B=Z[3];if(Math.abs(y)<=Q)return C;if(Math.abs(B)<=Q)return I;if(y*B>0)return JXG$1.isArray(n)?this.fminbr(u,[C,I],d):this.Newton(u,C,d);for(f=C,_=y;ne<ie;){if(V=I-C,Math.abs(_)<Math.abs(B)&&(C=I,I=f,f=C,y=B,B=_,_=y),O=2*Q*Math.abs(I)+Q*.5,ee=(f-I)*.5,Math.abs(ee)<=O||Math.abs(B)<=Q)return I;Math.abs(V)>=O&&Math.abs(y)>Math.abs(B)&&(F=f-I,C===f?(T=B/y,$=F*T,U=1-T):(U=y/_,T=B/_,H=B/y,$=H*(F*U*(U-T)-(I-C)*(T-1)),U=(U-1)*(T-1)*(H-1)),$>0?U=-U:$=-$,$<.75*F*U-Math.abs(O*U)*.5&&$<Math.abs(V*U*.5)&&(ee=$/U)),Math.abs(ee)<O&&(ee=ee>0?O:-O),C=I,y=B,I+=ee,B=u.call(d,I),(B>0&&_>0||B<0&&_<0)&&(f=C,_=y),ne++}return I},chandrupatla:function(u,n,d){var C,I,f,y,B,_=0,Z=this.maxIterationsRoot,M=1+Math.random()*.001,V=.5*M,T=Mat.eps,H=1e-5,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze,ye,Ee,Ve;if(JXG$1.isArray(n)){if(n.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");C=n[0],f=u.call(d,C),I=n[1],y=u.call(d,I)}else B=this.findBracket(u,n,d),C=B[0],f=B[1],I=B[2],y=B[3];if(f*y>0)return JXG$1.isArray(n)?this.fminbr(u,[C,I],d):this.Newton(u,C,d);F=C,O=I,ee=f,Q=y;do{if(U=F+V*(O-F),ne=u.call(d,U),Math.sign(ne)===Math.sign(ee)?($=F,F=U,ie=ee,ee=ne):($=O,O=F,ie=Q,Q=ee),F=U,ee=ne,le=F,ae=ee,Math.abs(Q)<Math.abs(ee)&&(le=O,ae=Q),ce=2*T*Math.abs(le)+.5*H,ge=ce/Math.abs(O-F),ge>.5||ae===0)break;he=(F-O)/($-O),Ie=(ee-Q)/(ie-Q),fe=1-Math.sqrt(1-he),me=Math.sqrt(he),fe<Ie&&Ie<me?(Ge=($-F)/(O-F),Ze=ee/(Q-ee),ye=ie/(Q-ie),Ee=ee/(ie-ee),Ve=Q/(ie-Q),V=Ze*ye+Ee*Ve*Ge):V=.5*M,V<ge&&(V=ge),V>1-ge&&(V=1-ge),_++}while(_<=Z);return le},findDomain:function(u,n,d){var C,I,f,y,B,_=.3819660112501453,Z=.001,M,V=20;if(!JXG$1.isArray(n)||n.length<2)throw new Error("JXG.Math.Numerics.findDomain: length of array x0 has to be at least two.");if(B=n.slice(),C=B[0],I=B[1],y=u.call(d,C),isNaN(y)){for(M=0;I-C>Z&&M<V;)f=(I-C)*_+C,y=u.call(d,f),isNaN(y)?C=f:I=f,M++;B[0]=C}if(C=B[0],I=B[1],y=u.call(d,I),isNaN(y)){for(M=0;I-C>Z&&M<V;)f=I-(I-C)*_,y=u.call(d,f),isNaN(y)?I=f:C=f,M++;B[0]=I}return B},fminbr:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie=(3-Math.sqrt(5))*.5,ne=Mat.eps,le=Mat.eps,ae=this.maxIterationsMinimize,ce=0;if(!JXG$1.isArray(n)||n.length<2)throw new Error("JXG.Math.Numerics.fminbr: length of array x0 has to be at least two.");for(V=this.findDomain(u,n,d),C=V[0],I=V[1],y=C+ie*(I-C),Z=u.call(d,y),f=y,B=y,_=Z,M=Z;ce<ae;){if(T=I-C,H=(C+I)*.5,F=le*Math.abs(f)+ne/3,Math.abs(f-H)+T*.5<=2*F)return f;O=ie*(f<H?I-f:C-f),Math.abs(f-B)>=F&&(ee=(f-B)*(_-Z),U=(f-y)*(_-M),$=(f-y)*U-(f-B)*ee,U=2*(U-ee),U>0?$=-$:U=-U,Math.abs($)<Math.abs(O*U)&&$>U*(C-f+2*F)&&$<U*(I-f-2*F)&&(O=$/U)),Math.abs(O)<F&&(O>0?O=F:O=-F),ee=f+O,Q=u.call(d,ee),Q<=_?(ee<f?I=f:C=f,y=B,B=f,f=ee,Z=M,M=_,_=Q):(ee<f?C=ee:I=ee,Q<=M||B===f?(y=B,B=ee,Z=M,M=Q):(Q<=Z||y===f||y===B)&&(y=ee,Z=Q)),ce+=1}return f},glomin:function(u,n){var d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge=1e7,Ze=Mat.eps,ye=Mat.eps*Mat.eps,Ee=Mat.eps*Mat.eps*Mat.eps;if(he=n[0],Ie=n[1],fe=u(he)<u(Ie)?he:Ie,d=Ie,me=d,C=he,ee=u(Ie),le=ee,ie=u(he),U=ie,ee<U?U=ee:me=he,Ie<=he)return U;for(M=.5*(1+16*Ee)*Ge,fe<=he||Ie<=fe?$=.5*(he+Ie):$=fe,Q=u($),Z=3,f=C-$,_=9/11,Q<U&&(me=$,U=Q);;){if(y=C-d,B=$-d,ge=Ie-C,ae=ie-Q,ce=ie-ee,F=y*y*ae-f*f*ce,V=F,H=2*(f*ce-y*ae),T=H,Z<1e6||ie<=U)for(;T*(F*(le-ie)+ge*T*(ie-U+Ze))<ge*M*F*(ge*T-F)&&(I=C+F/T,ne=u(I),ne<U&&(me=I,U=ne)),Z=1611*Z%1048576,T=1,F=(Ie-he)*1e-5*Z,!(ge<=F););else for(Z=1611*Z%1048576,T=1,F=(Ie-he)*1e-5*Z;F<ge;)T*(F*(le-ie)+ge*T*(ie-U+Ze))<ge*M*F*(ge*T-F)&&(I=C+F/T,ne=u(I),ne<U&&(me=I,U=ne)),Z=1611*Z%1048576,T=1,F=(Ie-he)*1e-5*Z;for(F=M*f*y*B,O=Math.sqrt((ie-U+Ze)/M),_=.5*(1+_),V=_*(V+2*F*O),T=T+.5*H,F=-.5*(f+(ae+2.01*ye)/(f*M)),F<O||f<0?F=C+O:F=C+F,0<V*T?I=C+V/T:I=F;I=Math.max(I,F),Ie<=I?(I=Ie,ne=le):ne=u(I),ne<U&&(me=I,U=ne),f=I-C,!(I<=F||(V=2*(ie-ne)/(Ge*f),(1+9*Ee)*f<=Math.abs(V))||.5*M*(f*f+V*V)<=ie-U+(ne-U)+2*Ze);)I=.5*(C+I),_=.9*_;if(Ie<=I)break;d=$,$=C,C=I,ee=Q,Q=ie,ie=ne}return[me,U]},polzeros:function(u,n,d,C,I){var f,y,B,_=[],Z=[],M=[],V=function($,U,ee){var Q,ie,ne=$.length-1;if(ee=ee||!1,ee)for(ie=JXG$1.C.mult(ne,$[ne]),Q=ne-1;Q>0;Q--)ie.mult(U),ie.add(JXG$1.C.mult($[Q],Q));else for(ie=JXG$1.C.copy($[ne]),Q=ne-1;Q>=0;Q--)ie.mult(U),ie.add($[Q]);return ie},T=function($,U,ee){var Q,ie,ne=$.length-1;if(ee=ee||!1,ee)for(ie=JXG$1.C.mult(ne,$[0]),Q=ne-1;Q>0;Q--)ie.mult(U),ie.add(JXG$1.C.mult($[ne-Q],Q));else for(ie=JXG$1.C.copy($[0]),Q=ne-1;Q>=0;Q--)ie.mult(U),ie.add($[ne-Q]);return ie},H=function($,U){var ee,Q,ie=$.length-1;for(Q=$[ie],ee=ie-1;ee>=0;ee--)Q=Q*U+$[ee];return Q},F=function($){var U,ee,Q=$.length-1,ie=Math.PI*2/Q,ne=Math.PI/Q*.5,le,ae,ce=[];for(le=JXG$1.C.mult(-1,$[Q-1]),le.div(JXG$1.C.mult(Q,$[Q])),ae=JXG$1.C.div(V($,le),$[Q]),ee=Math.pow(JXG$1.C.abs(ae),1/Q),ee===0&&(ee=1),U=0;U<Q;U++)$=new JXG$1.Complex(ee*Math.cos(ie*U+ne),ee*Math.sin(ie*U+ne)),ce[U]=JXG$1.C.add(le,$);return ce},O=function($,U,ee,Q){var ie,ne,le,ae=[],ce=[],ge,he,Ie=0,fe,me,Ge,Ze,ye=Q.length;for(ne=0;ne<ye;ne++)ae.push(!1);for(ne=0;ne<$.length;ne++)ce.push(JXG$1.C.abs($[ne])*(4*ne+1));for(ie=0;ie<ee&&Ie<ye;ie++)for(ne=0;ne<ye;ne++)if(!ae[ne]){if(fe=V($,Q[ne]),he=JXG$1.C.abs(Q[ne]),JXG$1.C.abs(fe)<U*H(ce,he)){if(ae[ne]=!0,Ie++,Ie===ye)break;continue}for(he>1?(ge=JXG$1.C.div(1,Q[ne]),Ze=T($,ge,!0),Ze.div(T($,ge)),Ze.mult(ge),fe=JXG$1.C.sub(ye,Ze),fe=JXG$1.C.div(Q[ne],fe)):fe.div(V($,Q[ne],!0)),me=new JXG$1.Complex(0),le=0;le<ye;le++)le!==ne&&(Ge=JXG$1.C.sub(Q[ne],Q[le]),Ge=JXG$1.C.div(1,Ge),me.add(Ge));me.mult(fe),me=JXG$1.C.sub(1,me),fe.div(me),Q[ne].sub(fe)}return ie};for(d=d||Number.EPSILON,C=C||30,y=u.length,JXG$1.isNumber(n)&&n>=0&&n<y-1&&(y=n+1),f=0;f<y;f++)_.push(new JXG$1.Complex(u[f]));for(f=0;f<y;f++)if(_[f].real!==0||_[f].imaginary!==0){B=f;break}for(f=0;f<B;f++)Z.push(new JXG$1.Complex(0));for(_=_.slice(B),y=_.length,f=y-1;f>=0&&!(_[f].real!==0||_[f].imaginary!==0);f--)_.pop();if(y=_.length,y===0)return[];if(I)for(f=0;f<y-1;f++)M.push(new JXG$1.Complex(I[f]));else M=F(_);return O(_,d,C,M),M=Z.concat(M),M.sort(function($,U){return $.real<U.real?-1:$.real>U.real?1:0}),M},RamerDouglasPeucker:function(u,n){var d=[],C=[],I,f,y,B=!0,_=function(M,V,T){var H,F,O,$,U,ee,Q,ie,ne,le,ae,ce=Mat.eps*Mat.eps,ge=1e4,he=0,Ie=V;if(T-V<2)return[-1,0];if(O=M[V].scrCoords,$=M[T].scrCoords,isNaN(O[1])||isNaN(O[2]))return[NaN,V];if(isNaN($[1])||isNaN($[2]))return[NaN,T];for(F=V+1;F<T;F++){if(U=M[F].scrCoords,isNaN(U[1])||isNaN(U[2]))return[NaN,F];ee=U[1]-O[1],Q=U[2]-O[2],ie=$[1]-O[1],ne=$[2]-O[2],ee=ee===1/0?ge:ee,Q=Q===1/0?ge:Q,ie=ie===1/0?ge:ie,ne=ne===1/0?ge:ne,ee=ee===-1/0?-1e4:ee,Q=Q===-1/0?-1e4:Q,ie=ie===-1/0?-1e4:ie,ne=ne===-1/0?-1e4:ne,le=ie*ie+ne*ne,le>ce?(ae=(ee*ie+Q*ne)/le,ae<0?ae=0:ae>1&&(ae=1),ee=ee-ae*ie,Q=Q-ae*ne,H=ee*ee+Q*Q):(ae=0,H=ee*ee+Q*Q),H>he&&(he=H,Ie=F)}return[Math.sqrt(he),Ie]},Z=function(M,V,T,H,F){var O=_(M,V,T),$=O[1];if(isNaN(O[0])){Z(M,V,$-1,H,F),F.push(M[$]);do++$;while($<=T&&isNaN(M[$].scrCoords[1]+M[$].scrCoords[2]));$<=T&&F.push(M[$]),Z(M,$+1,T,H,F)}else O[0]>H?(Z(M,V,$,H,F),Z(M,$,T,H,F)):F.push(M[T])};for(y=u.length,I=0;B;){for(;I<y&&isNaN(u[I].scrCoords[1]+u[I].scrCoords[2]);)I+=1;for(f=I+1;f<y&&!isNaN(u[f].scrCoords[1]+u[f].scrCoords[2]);)f+=1;if(f--,I<y&&f>I&&(C=[],C[0]=u[I],Z(u,I,f,n,C),d=d.concat(C)),I>=y)break;f<y-1&&d.push(u[f+1]),I=f+1}return d},RamerDouglasPeuker:function(u,n){return JXG$1.deprecated("Numerics.RamerDouglasPeuker()","Numerics.RamerDouglasPeucker()"),this.RamerDouglasPeucker(u,n)},Visvalingam:function(u,n){var d,C,I,f,y=[],B=[],_=[],Z,M,V,T,H;if(C=u.length,C<=2)return u;for(y[0]={used:!0,lft:null,node:null},Z=0,d=1;d<C-1;d++)I=Math.abs(JXG$1.Math.Numerics.det([u[d-1].usrCoords,u[d].usrCoords,u[d+1].usrCoords])),isNaN(I)||(H={v:I,idx:d},B.push(H),y[d]={used:!0,lft:Z,node:H},y[Z].rt=d,Z=d);for(y[C-1]={used:!0,rt:null,lft:Z,node:null},y[Z].rt=C-1,f=-1/0;B.length>n;)B.sort(function(F,O){return O.v-F.v}),d=B.pop().idx,y[d].used=!1,f=y[d].node.v,Z=y[d].lft,M=y[d].rt,y[Z].rt=M,y[M].lft=Z,V=y[Z].lft,V!==null&&(I=Math.abs(JXG$1.Math.Numerics.det([u[V].usrCoords,u[Z].usrCoords,u[M].usrCoords])),y[Z].node.v=I>=f?I:f),T=y[M].rt,T!==null&&(I=Math.abs(JXG$1.Math.Numerics.det([u[Z].usrCoords,u[M].usrCoords,u[T].usrCoords])),y[M].node.v=I>=f?I:f);d=0,_=[u[d]];do d=y[d].rt,_.push(u[d]);while(y[d].rt!==null);return _}};const Numerics=Mat.Numerics;Mat.Geometry={};JXG$1.extend(Mat.Geometry,{angle:function(u,n,d){var C,I,f,y,B=[],_=[],Z=[];return JXG$1.deprecated("Geometry.angle()","Geometry.rad()"),u.coords?(B[0]=u.coords.usrCoords[1],B[1]=u.coords.usrCoords[2]):(B[0]=u[0],B[1]=u[1]),n.coords?(_[0]=n.coords.usrCoords[1],_[1]=n.coords.usrCoords[2]):(_[0]=n[0],_[1]=n[1]),d.coords?(Z[0]=d.coords.usrCoords[1],Z[1]=d.coords.usrCoords[2]):(Z[0]=d[0],Z[1]=d[1]),C=B[0]-_[0],I=B[1]-_[1],f=Z[0]-_[0],y=Z[1]-_[1],Math.atan2(C*y-I*f,C*f+I*y)},trueAngle:function(u,n,d){return this.rad(u,n,d)*57.29577951308232},rad:function(u,n,d){var C,I,f,y,B,_,Z;return u.coords?(C=u.coords.usrCoords[1],I=u.coords.usrCoords[2]):(C=u[0],I=u[1]),n.coords?(f=n.coords.usrCoords[1],y=n.coords.usrCoords[2]):(f=n[0],y=n[1]),d.coords?(B=d.coords.usrCoords[1],_=d.coords.usrCoords[2]):(B=d[0],_=d[1]),Z=Math.atan2(_-y,B-f)-Math.atan2(I-y,C-f),Z<0&&(Z+=6.283185307179586),Z},angleBisector:function(u,n,d,C){var I,f,y,B=u.coords.usrCoords,_=n.coords.usrCoords,Z=d.coords.usrCoords,M,V;return JXG$1.exists(C)||(C=u.board),_[0]===0?new Coords(Const.COORDS_BY_USER,[1,(B[1]+Z[1])*.5,(B[2]+Z[2])*.5],C):(M=B[1]-_[1],V=B[2]-_[2],I=Math.atan2(V,M),M=Z[1]-_[1],V=Z[2]-_[2],f=Math.atan2(V,M),y=(I+f)*.5,I>f&&(y+=Math.PI),M=Math.cos(y)+_[1],V=Math.sin(y)+_[2],new Coords(Const.COORDS_BY_USER,[1,M,V],C))},reflection:function(u,n,d){var C,I,f,y,B,_,Z,M=n.coords.usrCoords,V=u.point1.coords.usrCoords,T=u.point2.coords.usrCoords;return JXG$1.exists(d)||(d=n.board),B=T[1]-V[1],_=T[2]-V[2],C=M[1]-V[1],I=M[2]-V[2],Z=(B*I-_*C)/(B*B+_*_),f=M[1]+2*Z*_,y=M[2]-2*Z*B,new Coords(Const.COORDS_BY_USER,[f,y],d)},rotation:function(u,n,d,C){var I,f,y,B,_,Z,M=n.coords.usrCoords,V=u.coords.usrCoords;return JXG$1.exists(C)||(C=n.board),I=M[1]-V[1],f=M[2]-V[2],y=Math.cos(d),B=Math.sin(d),_=I*y-f*B+V[1],Z=I*B+f*y+V[2],new Coords(Const.COORDS_BY_USER,[_,Z],C)},perpendicular:function(u,n,d){var C,I,f,y,B,_=u.point1.coords.usrCoords,Z=u.point2.coords.usrCoords,M=n.coords.usrCoords;return JXG$1.exists(d)||(d=n.board),n===u.point1?(C=_[1]+Z[2]-_[2],I=_[2]-Z[1]+_[1],B=_[0]*Z[0],Math.abs(B)<Mat.eps&&(C=Z[2],I=-Z[1]),y=[B,C,I],f=!0):n===u.point2?(C=Z[1]+_[2]-Z[2],I=Z[2]-_[1]+Z[1],B=_[0]*Z[0],Math.abs(B)<Mat.eps&&(C=_[2],I=-_[1]),y=[B,C,I],f=!1):Math.abs(Mat.innerProduct(M,u.stdform,3))<Mat.eps?(C=M[1]+Z[2]-M[2],I=M[2]-Z[1]+M[1],B=Z[0],Math.abs(B)<Mat.eps&&(C=Z[2],I=-Z[1]),f=!0,Math.abs(B)>Mat.eps&&Math.abs(C-M[1])<Mat.eps&&Math.abs(I-M[2])<Mat.eps&&(C=M[1]+_[2]-M[2],I=M[2]-_[1]+M[1],f=!1),y=[B,C,I]):(y=[0,u.stdform[1],u.stdform[2]],y=Mat.crossProduct(y,M),y=Mat.crossProduct(y,u.stdform),f=!0),[new Coords(Const.COORDS_BY_USER,y,d),f]},circumcenterMidpoint:function(){JXG$1.deprecated("Geometry.circumcenterMidpoint()","Geometry.circumcenter()"),this.circumcenter.apply(this,arguments)},circumcenter:function(u,n,d,C){var I,f,y,B,_=u.coords.usrCoords,Z=n.coords.usrCoords,M=d.coords.usrCoords;return JXG$1.exists(C)||(C=u.board),I=[Z[0]-_[0],-Z[2]+_[2],Z[1]-_[1]],f=[(_[0]+Z[0])*.5,(_[1]+Z[1])*.5,(_[2]+Z[2])*.5],y=Mat.crossProduct(I,f),I=[M[0]-Z[0],-M[2]+Z[2],M[1]-Z[1]],f=[(Z[0]+M[0])*.5,(Z[1]+M[1])*.5,(Z[2]+M[2])*.5],B=Mat.crossProduct(I,f),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(y,B),C)},distance:function(u,n,d){var C,I=0;for(d||(d=Math.min(u.length,n.length)),C=0;C<d;C++)I+=(u[C]-n[C])*(u[C]-n[C]);return Math.sqrt(I)},affineDistance:function(u,n,d){var C;return C=this.distance(u,n,d),C>Mat.eps&&(Math.abs(u[0])<Mat.eps||Math.abs(n[0])<Mat.eps)?1/0:C},affineRatio:function(u,n,d){var C=0,I;return JXG$1.exists(u.usrCoords)&&(u=u.usrCoords),JXG$1.exists(n.usrCoords)&&(n=n.usrCoords),JXG$1.exists(d.usrCoords)&&(d=d.usrCoords),I=n[1]-u[1],Math.abs(I)>Mat.eps?C=(d[1]-u[1])/I:C=(d[2]-u[2])/(n[2]-u[2]),C},sortVertices:function(u){for(var n,d=Expect.each(u,Expect.coordsArray),C=d.length,I=null;d[0][0]===d[C-1][0]&&d[0][1]===d[C-1][1]&&d[0][2]===d[C-1][2];)I=d.pop(),C--;return n=d[0],d.sort(function(f,y){var B=f[2]===n[2]&&f[1]===n[1]?-1/0:Math.atan2(f[2]-n[2],f[1]-n[1]),_=y[2]===n[2]&&y[1]===n[1]?-1/0:Math.atan2(y[2]-n[2],y[1]-n[1]);return B-_}),I!==null&&d.push(I),d},signedTriangle:function(u,n,d){var C=Expect.coordsArray(u),I=Expect.coordsArray(n),f=Expect.coordsArray(d);return .5*((I[1]-C[1])*(f[2]-C[2])-(I[2]-C[2])*(f[1]-C[1]))},signedPolygon:function(u,n){var d,C,I=0,f=Expect.each(u,Expect.coordsArray);for(n===void 0&&(n=!0),n?f.unshift(f[f.length-1]):f=this.sortVertices(f),C=f.length,d=1;d<C;d++)I+=f[d-1][1]*f[d][2]-f[d][1]*f[d-1][2];return .5*I},GrahamScan:function(u){var n,d=1,C=Expect.each(u,Expect.coordsArray),I=C.length;for(C=this.sortVertices(C),I=C.length,n=2;n<I;n++){for(;this.signedTriangle(C[d-1],C[d],C[n])<=0;){if(d>1)d-=1;else if(n===I-1)break;n+=1}d+=1,C=JXG$1.swap(C,d,n)}return C.slice(0,d)},calcStraight:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H;JXG$1.exists(C)||(C=10),Z=JXG$1.evaluate(u.visProp.straightfirst),M=JXG$1.evaluate(u.visProp.straightlast),Math.abs(n.scrCoords[0])<Mat.eps&&(Z=!0),Math.abs(d.scrCoords[0])<Mat.eps&&(M=!0),!(!Z&&!M)&&(V=[],V[0]=u.stdform[0]-u.stdform[1]*u.board.origin.scrCoords[1]/u.board.unitX+u.stdform[2]*u.board.origin.scrCoords[2]/u.board.unitY,V[1]=u.stdform[1]/u.board.unitX,V[2]=-u.stdform[2]/u.board.unitY,!isNaN(V[0]+V[1]+V[2])&&(I=!1,f=!1,I=!Z&&Math.abs(n.usrCoords[0])>=Mat.eps&&n.scrCoords[1]>=0&&n.scrCoords[1]<=u.board.canvasWidth&&n.scrCoords[2]>=0&&n.scrCoords[2]<=u.board.canvasHeight,f=!M&&Math.abs(d.usrCoords[0])>=Mat.eps&&d.scrCoords[1]>=0&&d.scrCoords[1]<=u.board.canvasWidth&&d.scrCoords[2]>=0&&d.scrCoords[2]<=u.board.canvasHeight,y=this.meetLineBoard(V,u.board,C),B=y[0],_=y[1],!(!I&&!f&&(!Z&&M&&!this.isSameDirection(n,d,B)&&!this.isSameDirection(n,d,_)||Z&&!M&&!this.isSameDirection(d,n,B)&&!this.isSameDirection(d,n,_)))&&(I?f||(this.isSameDir(n,d,B,_)?H=_:H=B):f?this.isSameDir(n,d,B,_)?T=B:T=_:this.isSameDir(n,d,B,_)?(T=B,H=_):(H=B,T=_),T&&n.setCoordinates(Const.COORDS_BY_USER,T.usrCoords),H&&d.setCoordinates(Const.COORDS_BY_USER,H.usrCoords))))},calcLineDelimitingPoints:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H=!1,F=!1;_=JXG$1.evaluate(u.visProp.straightfirst),Z=JXG$1.evaluate(u.visProp.straightlast),Math.abs(n.scrCoords[0])<Mat.eps&&(_=!0),Math.abs(d.scrCoords[0])<Mat.eps&&(Z=!0),M=[],M[0]=u.stdform[0]-u.stdform[1]*u.board.origin.scrCoords[1]/u.board.unitX+u.stdform[2]*u.board.origin.scrCoords[2]/u.board.unitY,M[1]=u.stdform[1]/u.board.unitX,M[2]=-u.stdform[2]/u.board.unitY,!isNaN(M[0]+M[1]+M[2])&&(H=!_,F=!Z,I=u.board.getBoundingBox(),f=u.getSlope(),f>=0?(y=this.projectPointToLine({coords:{usrCoords:[1,I[2],I[1]]}},u,u.board),B=this.projectPointToLine({coords:{usrCoords:[1,I[0],I[3]]}},u,u.board)):(y=this.projectPointToLine({coords:{usrCoords:[1,I[0],I[1]]}},u,u.board),B=this.projectPointToLine({coords:{usrCoords:[1,I[2],I[3]]}},u,u.board)),!(!H&&!F&&(!_&&!Z&&(C=n.distance(Const.COORDS_BY_USER,d),Math.abs(n.distance(Const.COORDS_BY_USER,y)+y.distance(Const.COORDS_BY_USER,d)-C)>Mat.eps||Math.abs(n.distance(Const.COORDS_BY_USER,B)+B.distance(Const.COORDS_BY_USER,d)-C)>Mat.eps)||!_&&Z&&!this.isSameDirection(n,d,y)&&!this.isSameDirection(n,d,B)||_&&!Z&&!this.isSameDirection(d,n,y)&&!this.isSameDirection(d,n,B)))&&(H?F||(this.isSameDir(n,d,y,B)?T=B:T=y):F?this.isSameDir(n,d,y,B)?V=y:V=B:this.isSameDir(n,d,y,B)?(V=y,T=B):(T=y,V=B),V&&n.setCoordinates(Const.COORDS_BY_USER,V.usrCoords),T&&d.setCoordinates(Const.COORDS_BY_USER,T.usrCoords)))},calcLabelQuadrant:function(u){var n;return u<0&&(u+=2*Math.PI),n=Math.floor((u+Math.PI/8)/(Math.PI/4))%8,["rt","urt","top","ulft","lft","llft","lrt"][n]},isSameDir:function(u,n,d,C){var I=n.usrCoords[1]-u.usrCoords[1],f=n.usrCoords[2]-u.usrCoords[2],y=C.usrCoords[1]-d.usrCoords[1],B=C.usrCoords[2]-d.usrCoords[2];return Math.abs(n.usrCoords[0])<Mat.eps&&(I=n.usrCoords[1],f=n.usrCoords[2]),Math.abs(u.usrCoords[0])<Mat.eps&&(I=-u.usrCoords[1],f=-u.usrCoords[2]),I*y+f*B>=0},isSameDirection:function(u,n,d){var C,I,f,y,B=!1;return C=n.usrCoords[1]-u.usrCoords[1],I=n.usrCoords[2]-u.usrCoords[2],f=d.usrCoords[1]-u.usrCoords[1],y=d.usrCoords[2]-u.usrCoords[2],Math.abs(C)<Mat.eps&&(C=0),Math.abs(I)<Mat.eps&&(I=0),Math.abs(f)<Mat.eps&&(f=0),Math.abs(y)<Mat.eps&&(y=0),(C>=0&&f>=0||C<=0&&f<=0)&&(B=I>=0&&y>=0||I<=0&&y<=0),B},det3p:function(u,n,d){var C,I,f;return JXG$1.isPoint(u)?C=u.Coords(!0):C=u,JXG$1.isPoint(n)?I=n.Coords(!0):I=n,JXG$1.isPoint(d)?f=d.Coords(!0):f=d,(C[1]-f[1])*(I[2]-f[2])-(I[1]-f[1])*(C[2]-f[2])},windingNumber:function(u,n,d){var C=0,I=n.length,f=u[1],y=u[2],B,_,Z,M,V,T,H=0;if(I===0)return 0;if(d=d||!1,d&&(H=1),isNaN(f)||isNaN(y)||(JXG$1.exists(n[0].coords)?(B=n[0].coords,_=n[I-1].coords):(B=n[0],_=n[I-1]),B.usrCoords[1]===f&&B.usrCoords[2]===y))return 1;for(T=0;T<I-H;T++)if(JXG$1.exists(n[T].coords)?(_=n[T].coords.usrCoords,Z=n[(T+1)%I].coords.usrCoords):(_=n[T].usrCoords,Z=n[(T+1)%I].usrCoords),!(_[0]===0||Z[0]===0||isNaN(_[1])||isNaN(Z[1])||isNaN(_[2])||isNaN(Z[2]))){if(Z[2]===y){if(Z[1]===f)return 1;if(_[2]===y&&Z[1]>f==_[1]<f)return 0}if(_[2]<y!=Z[2]<y)if(V=2*(Z[2]>_[2]?1:0)-1,_[1]>=f)if(Z[1]>f)C+=V;else{if(M=this.det3p(_,Z,u),M===0)return 0;M>0+Mat.eps==Z[2]>_[2]&&(C+=V)}else Z[1]>f&&(M=this.det3p(_,Z,u),M>0+Mat.eps==Z[2]>_[2]&&(C+=V))}return C},pnpoly:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T=d,H=!1;for(C===Const.COORDS_BY_USER?(V=new Coords(Const.COORDS_BY_USER,[u,n],this.board),Z=V.scrCoords[1],M=V.scrCoords[2]):(Z=u,M=n),_=d.length,I=0,f=_-2;I<_-1;f=I++)y=JXG$1.exists(T[I].coords)?T[I].coords:T[I],B=JXG$1.exists(T[f].coords)?T[f].coords:T[f],y.scrCoords[2]>M!=B.scrCoords[2]>M&&Z<(B.scrCoords[1]-y.scrCoords[1])*(M-y.scrCoords[2])/(B.scrCoords[2]-y.scrCoords[2])+y.scrCoords[1]&&(H=!H);return H},intersectionFunction:function(u,n,d,C,I,f){var y,B=this,_=!1,Z=!1;return _=n.elementClass===Const.OBJECT_CLASS_CURVE&&(n.type===Const.OBJECT_TYPE_ARC||n.type===Const.OBJECT_TYPE_SECTOR),Z=d.elementClass===Const.OBJECT_CLASS_CURVE&&(d.type===Const.OBJECT_TYPE_ARC||d.type===Const.OBJECT_TYPE_SECTOR),(n.elementClass===Const.OBJECT_CLASS_CURVE||d.elementClass===Const.OBJECT_CLASS_CURVE)&&(n.elementClass===Const.OBJECT_CLASS_CURVE||n.elementClass===Const.OBJECT_CLASS_CIRCLE)&&(d.elementClass===Const.OBJECT_CLASS_CURVE||d.elementClass===Const.OBJECT_CLASS_CIRCLE)?y=function(){return B.meetCurveCurve(n,d,C,I,n.board)}:n.elementClass===Const.OBJECT_CLASS_CURVE&&!_&&d.elementClass===Const.OBJECT_CLASS_LINE||d.elementClass===Const.OBJECT_CLASS_CURVE&&!Z&&n.elementClass===Const.OBJECT_CLASS_LINE?y=function(){return B.meetCurveLine(n,d,C,n.board,JXG$1.evaluate(f))}:n.type===Const.OBJECT_TYPE_POLYGON||d.type===Const.OBJECT_TYPE_POLYGON?n.elementClass===Const.OBJECT_CLASS_LINE?y=function(){var M=JXG$1.evaluate(n.visProp.straightfirst),V=JXG$1.evaluate(n.visProp.straightlast),T=JXG$1.evaluate(d.visProp.straightfirst),H=JXG$1.evaluate(d.visProp.straightlast),F;return F=!JXG$1.evaluate(f)&&(!M||!V||!T||!H),B.meetPolygonLine(d,n,C,n.board,F)}:d.elementClass===Const.OBJECT_CLASS_LINE?y=function(){var M=JXG$1.evaluate(n.visProp.straightfirst),V=JXG$1.evaluate(n.visProp.straightlast),T=JXG$1.evaluate(d.visProp.straightfirst),H=JXG$1.evaluate(d.visProp.straightlast),F;return F=!JXG$1.evaluate(f)&&(!M||!V||!T||!H),B.meetPolygonLine(n,d,C,n.board,F)}:y=function(){return B.meetPathPath(n,d,C,n.board)}:n.elementClass===Const.OBJECT_CLASS_LINE&&d.elementClass===Const.OBJECT_CLASS_LINE?y=function(){var M,V,T=JXG$1.evaluate(n.visProp.straightfirst),H=JXG$1.evaluate(n.visProp.straightlast),F=JXG$1.evaluate(d.visProp.straightfirst),O=JXG$1.evaluate(d.visProp.straightlast);return!JXG$1.evaluate(f)&&(!T||!H||!F||!O)?(M=B.meetSegmentSegment(n.point1.coords.usrCoords,n.point2.coords.usrCoords,d.point1.coords.usrCoords,d.point2.coords.usrCoords),!T&&M[1]<0||!H&&M[1]>1||!F&&M[2]<0||!O&&M[2]>1?V=[0,NaN,NaN]:V=M[0],new Coords(Const.COORDS_BY_USER,V,n.board)):B.meet(n.stdform,d.stdform,C,n.board)}:y=function(){var M=B.meet(n.stdform,d.stdform,C,n.board),V=!0,T,H,F;return JXG$1.evaluate(f)?M:n.elementClass===Const.OBJECT_CLASS_LINE&&(T=JXG$1.evaluate(n.visProp.straightfirst),H=JXG$1.evaluate(n.visProp.straightlast),(!T||!H)&&(F=B.affineRatio(n.point1.coords,n.point2.coords,M),!H&&F>1+Mat.eps||!T&&F<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],n.board):d.elementClass===Const.OBJECT_CLASS_LINE&&(T=JXG$1.evaluate(d.visProp.straightfirst),H=JXG$1.evaluate(d.visProp.straightlast),(!T||!H)&&(F=B.affineRatio(d.point1.coords,d.point2.coords,M),!H&&F>1+Mat.eps||!T&&F<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],n.board):_&&(V=B.coordsOnArc(n,M),V&&Z&&(V=B.coordsOnArc(d,M)),!V)?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],n.board):M},y},otherIntersectionFunction:function(u,n,d,C){var I,f,y,B,_=this;return y=u[0],B=u[1],f=y.board,I=function(){var Z,M,V,T,H,F=n.length,O=JXG$1.evaluate(C);for(Z=F;Z>=0;Z--){for(y.elementClass===Const.OBJECT_CLASS_CIRCLE&&[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_LINE].indexOf(B.elementClass)>=0?V=_.meet(y.stdform,B.stdform,Z,f):y.elementClass===Const.OBJECT_CLASS_CURVE&&[Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_CIRCLE].indexOf(B.elementClass)>=0?V=_.meetCurveCurve(y,B,Z,0,f,"segment"):y.elementClass===Const.OBJECT_CLASS_CURVE&&B.elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.exists(y.dataX)?V=JXG$1.Math.Geometry.meetCurveLine(y,B,Z,y.board,JXG$1.evaluate(d)):V=JXG$1.Math.Geometry.meetCurveLineContinuous(y,B,Z,y.board)),H=!1,M=0;!H&&M<F;M++)T=V.distance(JXG$1.COORDS_BY_USER,n[M].coords),T<O&&(H=!0);if(!H)return V}return V},I},intersectionFunction3D:function(u,n,d,C){var I,f=this;return n.type===Const.OBJECT_TYPE_PLANE3D?d.type===Const.OBJECT_TYPE_PLANE3D?I=()=>u.intersectionPlanePlane(n,d)[C]:d.type===Const.OBJECT_TYPE_SPHERE3D&&(I=f.meetPlaneSphere(n,d)):n.type===Const.OBJECT_TYPE_SPHERE3D&&(d.type===Const.OBJECT_TYPE_PLANE3D?I=f.meetPlaneSphere(d,n):d.type===Const.OBJECT_TYPE_SPHERE3D&&(I=f.meetSphereSphere(n,d))),I},coordsOnArc:function(u,n){var d=this.rad(u.radiuspoint,u.center,n.usrCoords.slice(1)),C=0,I=this.rad(u.radiuspoint,u.center,u.anglepoint),f=JXG$1.evaluate(u.visProp.selection);return(f==="minor"&&I>Math.PI||f==="major"&&I<Math.PI)&&(C=I,I=2*Math.PI),!(d<C||d>I)},meet:function(u,n,d,C){var I,f=Mat.eps;return Math.abs(u[3])<f&&Math.abs(n[3])<f?I=this.meetLineLine(u,n,d,C):Math.abs(u[3])>=f&&Math.abs(n[3])<f?I=this.meetLineCircle(n,u,d,C):Math.abs(u[3])<f&&Math.abs(n[3])>=f?I=this.meetLineCircle(u,n,d,C):I=this.meetCircleCircle(u,n,d,C),I},meetLineBoard:function(u,n,d){var C=[],I,f,y,B;for(JXG$1.exists(d)||(d=0),C[0]=Mat.crossProduct(u,[d,0,1]),C[1]=Mat.crossProduct(u,[d,1,0]),C[2]=Mat.crossProduct(u,[-d-n.canvasHeight,0,1]),C[3]=Mat.crossProduct(u,[-d-n.canvasWidth,1,0]),y=0;y<4;y++)if(Math.abs(C[y][0])>Mat.eps){for(B=2;B>0;B--)C[y][B]/=C[y][0];C[y][0]=1}return Math.abs(C[1][0])<Mat.eps?(I=C[0],f=C[2]):Math.abs(C[0][0])<Mat.eps?(I=C[1],f=C[3]):C[1][2]<0?(I=C[0],C[3][2]>n.canvasHeight?f=C[2]:f=C[3]):C[1][2]>n.canvasHeight?(I=C[2],C[3][2]<0?f=C[0]:f=C[3]):(I=C[1],C[3][2]<0?f=C[0]:C[3][2]>n.canvasHeight?f=C[2]:f=C[3]),[new Coords(Const.COORDS_BY_SCREEN,I.slice(1),n),new Coords(Const.COORDS_BY_SCREEN,f.slice(1),n)]},meetLineLine:function(u,n,d,C){var I=isNaN(u[5]+n[5])?[0,0,0]:Mat.crossProduct(u,n);return Math.abs(I[0])<1e-14&&(I[0]=0),new Coords(Const.COORDS_BY_USER,I,C)},meetLineCircle:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H;return n[4]<Mat.eps?Math.abs(Mat.innerProduct([1,n[6],n[7]],u,3))<Mat.eps?new Coords(Const.COORDS_BY_USER,n.slice(6,8),C):new Coords(Const.COORDS_BY_USER,[NaN,NaN],C):(y=n[0],f=n.slice(1,3),I=n[3],B=u[0],_=u.slice(1,3),Z=I,M=f[0]*_[1]-f[1]*_[0],V=I*B*B-(f[0]*_[0]+f[1]*_[1])*B+y,T=M*M-4*Z*V,T>-Mat.eps*Mat.eps?(T=Math.sqrt(Math.abs(T)),H=[(-M+T)/(2*Z),(-M-T)/(2*Z)],JXG$1.evaluate(d)===0?new Coords(Const.COORDS_BY_USER,[-H[0]*-_[1]-B*_[0],-H[0]*_[0]-B*_[1]],C):new Coords(Const.COORDS_BY_USER,[-H[1]*-_[1]-B*_[0],-H[1]*_[0]-B*_[1]],C)):new Coords(Const.COORDS_BY_USER,[0,0,0],C))},meetCircleCircle:function(u,n,d,C){var I;return u[4]<Mat.eps?Math.abs(this.distance(u.slice(6,2),n.slice(6,8))-n[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,u.slice(6,8),C):new Coords(Const.COORDS_BY_USER,[0,0,0],C):n[4]<Mat.eps?Math.abs(this.distance(n.slice(6,2),u.slice(6,8))-u[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,n.slice(6,8),C):new Coords(Const.COORDS_BY_USER,[0,0,0],C):(I=[n[3]*u[0]-u[3]*n[0],n[3]*u[1]-u[3]*n[1],n[3]*u[2]-u[3]*n[2],0,1,1/0,1/0,1/0],I=Mat.normalize(I),this.meetLineCircle(I,u,d,C))},meetCurveCurve:function(u,n,d,C,I,f){var y;return JXG$1.exists(f)&&f==="newton"?y=Numerics.generalizedNewton(u,n,JXG$1.evaluate(d),C):u.bezierDegree===3||n.bezierDegree===3?y=this.meetBezierCurveRedBlueSegments(u,n,d):y=this.meetCurveRedBlueSegments(u,n,d),new Coords(Const.COORDS_BY_USER,y,I)},meetCurveLine:function(u,n,d,C,I){var f=[0,NaN,NaN],y,B;return JXG$1.exists(C)||(C=u.board),u.elementClass===Const.OBJECT_CLASS_CURVE?(y=u,B=n):(y=n,B=u),f=this.meetCurveLineDiscrete(y,B,d,C,!I),f},meetCurveLineContinuous:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T=Mat.eps,H=Mat.eps,F,O,$,U,ee,Q,ie;for(_=this.meetCurveLineDiscrete(u,n,d,C,I),Z=_.usrCoords[1],M=_.usrCoords[2],f=function(ne){var le,ae;return ne>u.maxX()||ne<u.minX()?1/0:(le=u.X(ne)-Z,ae=u.Y(ne)-M,le*le+ae*ae)},y=function(ne){var le=n.stdform[0]+n.stdform[1]*u.X(ne)+n.stdform[2]*u.Y(ne);return le*le},F=50,O=(u.maxX()-u.minX())/F,$=u.minX(),ee=1e-4,U=NaN,Q=0;Q<F&&(B=Numerics.root(f,[Math.max($,u.minX()),Math.min($+O,u.maxX())]),ie=Math.abs(f(B)),!(ie<=ee&&(ee=ie,U=B,ee<T)));Q++)$+=O;return B=U,B=Numerics.root(y,[Math.max(B-O,u.minX()),Math.min(B+O,u.maxX())]),ie=y(B),isNaN(ie)||Math.abs(ie)>H?V=0:V=1,new Coords(Const.COORDS_BY_USER,[V,u.X(B),u.Y(B)],C)},meetCurveLineDiscrete:function(u,n,d,C,I){var f,y,B=JXG$1.evaluate(d),_,Z,M,V,T=n.point1.coords.usrCoords,H=n.point2.coords.usrCoords,F,O,$=0,U=u.numberPoints,ee=JXG$1.evaluate(n.visProp.straightfirst),Q=JXG$1.evaluate(n.visProp.straightlast);for(V=new Coords(Const.COORDS_BY_USER,[0,NaN,NaN],C),T[0]===0?T=[1,H[1]+n.stdform[2],H[2]-n.stdform[1]]:H[0]===0&&(H=[1,T[1]+n.stdform[2],T[2]-n.stdform[1]]),Z=u.points[0].usrCoords,f=1;f<U;f+=u.bezierDegree)if(_=Z.slice(0),Z=u.points[f].usrCoords,F=this.distance(_,Z),F>Mat.eps){for(u.bezierDegree===3?O=this.meetBeziersegmentBeziersegment([u.points[f-1].usrCoords.slice(1),u.points[f].usrCoords.slice(1),u.points[f+1].usrCoords.slice(1),u.points[f+2].usrCoords.slice(1)],[T.slice(1),H.slice(1)],I):O=[this.meetSegmentSegment(_,Z,T,H)],y=0;y<O.length;y++)if(M=O[y],0<=M[1]&&M[1]<=1){if($===B)return I&&(!ee&&M[2]<0||!Q&&M[2]>1)||(V=new Coords(Const.COORDS_BY_USER,M[0],C)),V;$+=1}}return V},meetCurveRedBlueSegments:function(u,n,d){var C,I,f=JXG$1.evaluate(d),y,B,_,Z,M,V,T,H=0,F=n.numberPoints,O=u.numberPoints;if(F<=1||O<=1)return[0,NaN,NaN];for(C=1;C<O;C++)for(y=u.points[C-1].usrCoords,B=u.points[C].usrCoords,V=Math.min(y[1],B[1]),T=Math.max(y[1],B[1]),Z=n.points[0].usrCoords,I=1;I<F;I++)if(_=Z,Z=n.points[I].usrCoords,Math.min(_[1],Z[1])<T&&Math.max(_[1],Z[1])>V&&(M=this.meetSegmentSegment(y,B,_,Z),M[1]>=0&&M[2]>=0&&(M[1]<1&&M[2]<1||C===O-1&&M[1]===1||I===F-1&&M[2]===1))){if(H===f)return M[0];H++}return[0,NaN,NaN]},meetSegmentSegment:function(u,n,d,C){var I,f,y,B,_=Mat.crossProduct(u,n),Z=Mat.crossProduct(d,C),M=Mat.crossProduct(_,Z);return Math.abs(M[0])<Mat.eps?[M,1/0,1/0]:(M[1]/=M[0],M[2]/=M[0],M[0]/=M[0],y=Math.abs(n[1]-n[0]*u[1])<Mat.eps?2:1,B=u[y]/u[0],I=(M[y]-B)/(n[0]!==0?n[y]/n[0]-B:n[y]),y=Math.abs(C[1]-C[0]*d[1])<Mat.eps?2:1,B=d[y]/d[0],f=(M[y]-B)/(C[0]!==0?C[y]/C[0]-B:C[y]),[M,I,f])},meetPathPath:function(u,n,d,C){var I,f,y,B,_=JXG$1.evaluate(d);return I=JXG$1.Math.Clip._getPath(u,C),y=I.length,y>0&&this.distance(I[0].coords.usrCoords,I[y-1].coords.usrCoords,3)<Mat.eps&&I.pop(),f=JXG$1.Math.Clip._getPath(n,C),y=f.length,y>0&&this.distance(f[0].coords.usrCoords,f[y-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&f.pop(),d<0||JXG$1.Math.Clip.isEmptyCase(I,f,"intersection")?new Coords(Const.COORDS_BY_USER,[0,0,0],C):(JXG$1.Math.Clip.makeDoublyLinkedList(I),JXG$1.Math.Clip.makeDoublyLinkedList(f),B=JXG$1.Math.Clip.findIntersections(I,f,C)[0],_<B.length?B[_].coords:new Coords(Const.COORDS_BY_USER,[0,0,0],C))},meetPolygonLine:function(u,n,d,C,I){var f,y=JXG$1.evaluate(d),B,_,Z=[0,0,0],M=u.borders.length,V=[];for(f=0;f<M;f++)_=u.borders[f],B=this.meetSegmentSegment(_.point1.coords.usrCoords,_.point2.coords.usrCoords,n.point1.coords.usrCoords,n.point2.coords.usrCoords),(!I||B[2]>=0&&B[2]<1)&&B[1]>=0&&B[1]<1&&V.push(B[0]);return y>=0&&y<V.length&&(Z=V[y]),new Coords(Const.COORDS_BY_USER,Z,C)},meetPlaneSphere:function(u,n){var d=function(){return u.normal[0]*n.center.X()+u.normal[1]*n.center.Y()+u.normal[2]*n.center.Z()-u.d};return[[function(){return n.center.X()-d()*u.normal[0]},function(){return n.center.Y()-d()*u.normal[1]},function(){return n.center.Z()-d()*u.normal[2]}],[()=>u.normal[0],()=>u.normal[1],()=>u.normal[2]],function(){var C=n.Radius(),I=d();return Math.sqrt(C*C-I*I)}]},meetSphereSphere:function(u,n){var d=function(){var C=u.center.distance(n.center),I=u.Radius(),f=n.Radius();return(I-f)*(I+f)/(C*C)};return[[function(){var C=d();return .5*((1-C)*u.center.X()+(1+C)*n.center.X())},function(){var C=d();return .5*((1-C)*u.center.Y()+(1+C)*n.center.Y())},function(){var C=d();return .5*((1-C)*u.center.Z()+(1+C)*n.center.Z())}],[()=>n.center.X()-u.center.X(),()=>n.center.Y()-u.center.Y(),()=>n.center.Z()-u.center.Z()],function(){var C=u.center.distance(n.center),I=u.Radius(),f=n.Radius(),y=d(),B=.5*(I*I+f*f-.5*C*C*(1+y*y));return Math.sqrt(B)}]},_bezierSplit:function(u){var n,d,C,I,f,y;return n=[(u[0][0]+u[1][0])*.5,(u[0][1]+u[1][1])*.5],d=[(u[1][0]+u[2][0])*.5,(u[1][1]+u[2][1])*.5],C=[(u[2][0]+u[3][0])*.5,(u[2][1]+u[3][1])*.5],I=[(n[0]+d[0])*.5,(n[1]+d[1])*.5],f=[(d[0]+C[0])*.5,(d[1]+C[1])*.5],y=[(I[0]+f[0])*.5,(I[1]+f[1])*.5],[[u[0],n,I,y],[y,f,C,u[3]]]},_bezierBbox:function(u){var n=[];return u.length===4?(n[0]=Math.min(u[0][0],u[1][0],u[2][0],u[3][0]),n[1]=Math.max(u[0][1],u[1][1],u[2][1],u[3][1]),n[2]=Math.max(u[0][0],u[1][0],u[2][0],u[3][0]),n[3]=Math.min(u[0][1],u[1][1],u[2][1],u[3][1])):(n[0]=Math.min(u[0][0],u[1][0]),n[1]=Math.max(u[0][1],u[1][1]),n[2]=Math.max(u[0][0],u[1][0]),n[3]=Math.min(u[0][1],u[1][1])),n},_bezierOverlap:function(u,n){return u[2]>=n[0]&&u[0]<=n[2]&&u[1]>=n[3]&&u[3]<=n[1]},_bezierListConcat:function(u,n,d,C){var I,f=JXG$1.exists(C),y=0,B=n.length,_=u.length;for(_>0&&B>0&&(u[_-1][1]===1&&n[0][1]===0||f&&u[_-1][2]===1&&n[0][2]===0)&&(y=1),I=y;I<B;I++)f&&(n[I][2]*=.5,n[I][2]+=C),n[I][1]*=.5,n[I][1]+=d,u.push(n[I])},_bezierMeetSubdivision:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O=[],$=5;return I=this._bezierBbox(n),C=this._bezierBbox(u),this._bezierOverlap(I,C)?d<$?(f=this._bezierSplit(u),_=f[0],Z=f[1],f=this._bezierSplit(n),y=f[0],B=f[1],this._bezierListConcat(O,this._bezierMeetSubdivision(_,y,d+1),0,0),this._bezierListConcat(O,this._bezierMeetSubdivision(_,B,d+1),0,.5),this._bezierListConcat(O,this._bezierMeetSubdivision(Z,y,d+1),.5,0),this._bezierListConcat(O,this._bezierMeetSubdivision(Z,B,d+1),.5,.5),O):(H=[1].concat(u[0]),F=[1].concat(u[3]),V=[1].concat(n[0]),T=[1].concat(n[3]),M=this.meetSegmentSegment(H,F,V,T),M[1]>=0&&M[2]>=0&&M[1]<=1&&M[2]<=1?[M]:[]):[]},_bezierLineMeetSubdivision:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H,F=[],O=5;return I=this._bezierBbox(n),f=this._bezierBbox(u),C&&!this._bezierOverlap(f,I)?[]:d<O?(y=this._bezierSplit(u),B=y[0],_=y[1],this._bezierListConcat(F,this._bezierLineMeetSubdivision(B,n,d+1),0),this._bezierListConcat(F,this._bezierLineMeetSubdivision(_,n,d+1),.5),F):(T=[1].concat(u[0]),H=[1].concat(u[3]),M=[1].concat(n[0]),V=[1].concat(n[1]),Z=this.meetSegmentSegment(T,H,M,V),Z[1]>=0&&Z[1]<=1&&(!C||Z[2]>=0&&Z[2]<=1)?[Z]:[])},meetBeziersegmentBeziersegment:function(u,n,d){var C,I,f;for(u.length===4&&n.length===4?C=this._bezierMeetSubdivision(u,n,0):C=this._bezierLineMeetSubdivision(u,n,0,d),C.sort(function(y,B){return(y[1]-B[1])*1e7+(y[2]-B[2])}),I=[],f=0;f<C.length;f++)(f===0||C[f][1]!==C[f-1][1]||C[f][2]!==C[f-1][2])&&I.push(C[f]);return I},meetBezierCurveRedBlueSegments:function(u,n,d){var C,I,f,y,B=JXG$1.evaluate(d),_,Z,M,V,T,H,F,O=0,$=0,U,ee,Q=[];if(n.numberPoints<n.bezierDegree+1||u.numberPoints<u.bezierDegree+1)return[0,NaN,NaN];for(u.bezierDegree===1&&n.bezierDegree===3&&(Z=u,u=n,n=Z),U=n.numberPoints-n.bezierDegree,ee=u.numberPoints-u.bezierDegree,u.type===Const.OBJECT_TYPE_SECTOR&&(O=3,ee-=3),n.type===Const.OBJECT_TYPE_SECTOR&&($=3,U-=3),I=O;I<ee;I+=u.bezierDegree)for(C=u.points,M=[C[I].usrCoords.slice(1),C[I+1].usrCoords.slice(1)],u.bezierDegree===3&&(M[2]=C[I+2].usrCoords.slice(1),M[3]=C[I+3].usrCoords.slice(1)),T=this._bezierBbox(M),f=$;f<U;f+=n.bezierDegree)if(C=n.points,V=[C[f].usrCoords.slice(1),C[f+1].usrCoords.slice(1)],n.bezierDegree===3&&(V[2]=C[f+2].usrCoords.slice(1),V[3]=C[f+3].usrCoords.slice(1)),H=this._bezierBbox(V),this._bezierOverlap(T,H)){if(F=this.meetBeziersegmentBeziersegment(M,V),F.length===0)continue;for(y=0;y<F.length;y++)_=F[y],!(_[1]<-Mat.eps||_[1]>1+Mat.eps||_[2]<-Mat.eps||_[2]>1+Mat.eps)&&Q.push(_);if(Q.length>B)return Q[B][0]}return Q.length>B?Q[B][0]:[0,NaN,NaN]},bezierSegmentEval:function(u,n){var d,C,I,f=1-u;return C=0,I=0,d=f*f*f,C+=d*n[0][0],I+=d*n[0][1],d=3*u*f*f,C+=d*n[1][0],I+=d*n[1][1],d=3*u*u*f,C+=d*n[2][0],I+=d*n[2][1],d=u*u*u,C+=d*n[3][0],I+=d*n[3][1],[1,C,I]},bezierArc:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T,H=n[1],F=n[2],O=n[0],$=[],U=[],ee,Q,ie,ne,le,ae,ce,ge,he,Ie;for(Z=this.distance(n,u),H/=O,F/=O,M=this.rad(u.slice(1),n.slice(1),d.slice(1)),I===-1&&(M=2*Math.PI-M),T=M/4,f=u,f[1]/=f[0],f[2]/=f[0],f[0]/=f[0],_=f.slice(0),C?($=[H,H+.333*(f[1]-H),H+.666*(f[1]-H),f[1]],U=[F,F+.333*(f[2]-F),F+.666*(f[2]-F),f[2]]):($=[f[1]],U=[f[2]]);M>Mat.eps;)M>T?(V=T,M-=T):(V=M,M=0),ee=Math.cos(I*V),Q=Math.sin(I*V),Ie=[[1,0,0],[H*(1-ee)+F*Q,ee,-Q],[F*(1-ee)-H*Q,Q,ee]],ge=Mat.matVecMult(Ie,f),_=[ge[0]/ge[0],ge[1]/ge[0],ge[2]/ge[0]],ie=f[1]-H,ne=f[2]-F,le=_[1]-H,ae=_[2]-F,he=Mat.hypot(ie+le,ne+ae),Math.abs(ae-ne)>Mat.eps?ce=(ie+le)*(Z/he-.5)/(ae-ne)*8/3:ce=(ne+ae)*(Z/he-.5)/(ie-le)*8/3,y=[1,f[1]-ce*ne,f[2]+ce*ie],B=[1,_[1]+ce*ae,_[2]-ce*le],JXG$1.concat($,[y[1],B[1],_[1]]),JXG$1.concat(U,[y[2],B[2],_[2]]),f=_.slice(0);return C&&(JXG$1.concat($,[_[1]+.333*(H-_[1]),_[1]+.666*(H-_[1]),H]),JXG$1.concat(U,[_[2]+.333*(F-_[2]),_[2]+.666*(F-_[2]),F])),[$,U]},projectPointToCircle:function(u,n,d){var C,I,f,y,B,_=n.center.coords.usrCoords;return JXG$1.exists(d)||(d=u.board),JXG$1.isPoint(u)?(C=u.coords.distance(Const.COORDS_BY_USER,n.center.coords),I=u.coords.usrCoords):(C=u.distance(Const.COORDS_BY_USER,n.center.coords),I=u.usrCoords),Math.abs(C)<Mat.eps&&(C=Mat.eps),B=n.Radius()/C,f=_[1]+B*(I[1]-_[1]),y=_[2]+B*(I[2]-_[2]),new Coords(Const.COORDS_BY_USER,[f,y],d)},projectPointToLine:function(u,n,d){var C=[0,n.stdform[1],n.stdform[2]],I;return JXG$1.exists(d)||(JXG$1.exists(u.coords)?d=u.board:d=n.board),JXG$1.exists(u.coords)?I=u.coords.usrCoords:I=u.usrCoords,C=Mat.crossProduct(C,I),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(C,n.stdform),d)},projectCoordsToSegment:function(u,n,d){var C,I,f=[d[1]-n[1],d[2]-n[2]],y=[u[1]-n[1],u[2]-n[2]];return Math.abs(f[0])<Mat.eps&&Math.abs(f[1])<Mat.eps?[n,0]:(C=Mat.innerProduct(y,f),I=Mat.innerProduct(f,f),C/=I,[[1,C*f[0]+n[1],C*f[1]+n[2]],C])},projectCoordsToBeziersegment:function(u,n,d){var C,I=function(f){var y=[1,n.X(d+f),n.Y(d+f)];return y[1]-=u[1],y[2]-=u[2],y[1]*y[1]+y[2]*y[2]};return C=JXG$1.Math.Numerics.fminbr(I,[0,1]),[[1,n.X(C+d),n.Y(C+d)],C]},projectPointToCurve:function(u,n,d){JXG$1.exists(d)||(d=u.board);var C=u.X(),I=u.Y(),f=u.position,y;return JXG$1.exists(f)||(f=JXG$1.evaluate(n.visProp.curvetype)==="functiongraph"?C:0),y=this.projectCoordsToCurve(C,I,f,n,d),y},projectCoordsToCurve:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze=Number.POSITIVE_INFINITY;if(JXG$1.exists(I)||(I=C.board),JXG$1.evaluate(C.visProp.curvetype)==="plot"){if(d=0,Z=Ze,C.numberPoints===0?f=[0,1,1]:f=[C.Z(0),C.X(0),C.Y(0)],C.numberPoints>1)for(T=[1,u,n],C.bezierDegree===3?_=0:O=[C.Z(0),C.X(0),C.Y(0)],B=0;B<C.numberPoints-1;B++)C.bezierDegree===3?U=this.projectCoordsToBeziersegment(T,C,_):($=[C.Z(B+1),C.X(B+1),C.Y(B+1)],U=this.projectCoordsToSegment(T,O,$)),V=U[1],H=U[0],0<=V&&V<=1?(M=this.distance(H,T),F=B+V):V<0?(H=O,M=this.distance(O,T),F=B):V>1&&B===C.numberPoints-2&&(H=$,M=this.distance(H,T),F=C.numberPoints-1),M<Z&&(Z=M,d=F,f=H),C.bezierDegree===3?(_++,B+=2):O=$;y=new Coords(Const.COORDS_BY_USER,f,I)}else{for(me=C.minX(),Ge=C.maxX(),Ie=me,fe=Ge,JXG$1.evaluate(C.visProp.curvetype)==="functiongraph"&&(le=Math.abs(n-C.Y(u)),isNaN(le)||(Ie=u-le,fe=u+le)),ee=function(ye){var Ee,Ve;return ye<me||ye>C.maxX_glob?1/0:(Ee=u-C.X(ye),Ve=n-C.Y(ye),Ee*Ee+Ve*Ve)},ne=ee(d),he=50,ae=(fe-Ie)/he,Q=Ie,B=0;B<he;B++)ie=ee(Q),(ie<ne||ne===1/0||isNaN(ne))&&(d=Q,ne=ie),Q+=ae;for(ce=ae,B=0;B<20&&isNaN(ee(d-ce));B++,ce*=.5);for(isNaN(ee(d-ce))&&(ce=0),ge=ae,B=0;B<20&&isNaN(ee(d+ge));B++,ge*=.5);isNaN(ee(d+ge))&&(ge=0),d=Numerics.fminbr(ee,[Math.max(d-ce,Ie),Math.min(d+ge,fe)]),d=d<me?me:d,d=d>Ge?Ge:d,y=new Coords(Const.COORDS_BY_USER,[C.X(d),C.Y(d)],I)}return[C.updateTransform(y),d]},projectCoordsToPolygon:function(u,n){var d,C=n.vertices.length,I=1/0,f,y,B,_;for(d=0;d<C-1;d++)y=JXG$1.Math.Geometry.projectCoordsToSegment(u,n.vertices[d].coords.usrCoords,n.vertices[d+1].coords.usrCoords),0<=y[1]&&y[1]<=1?(f=JXG$1.Math.Geometry.distance(y[0],u,3),B=y[0]):y[1]<0?(f=JXG$1.Math.Geometry.distance(n.vertices[d].coords.usrCoords,u,3),B=n.vertices[d].coords.usrCoords):(f=JXG$1.Math.Geometry.distance(n.vertices[d+1].coords.usrCoords,u,3),B=n.vertices[d+1].coords.usrCoords),f<I&&(_=B.slice(0),I=f);return _},projectPointToTurtle:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H=0,F=0,O=Number.POSITIVE_INFINITY,$=n.objects.length;for(JXG$1.exists(d)||(d=u.board),B=0;B<$;B++)Z=n.objects[B],Z.elementClass===Const.OBJECT_CLASS_CURVE&&(V=this.projectPointToCurve(u,Z),C=V[0],T=V[1],_=this.distance(C.usrCoords,u.coords.usrCoords),_<O&&(f=C.usrCoords[1],y=C.usrCoords[2],I=T,O=_,M=Z,F=H),H+=Z.numberPoints);return C=new Coords(Const.COORDS_BY_USER,[f,y],d),[M.updateTransform(C),I+F]},projectPointToPoint:function(u,n){return n.coords},projectPointToBoard:function(u,n){var d,C,I,f=n||u.board,y=[[1,1,0,0,3,0,1],[-1,2,1,0,1,2,1],[-1,1,2,2,1,2,3],[1,2,3,0,3,2,3]],B=u.coords||u,_=f.getBoundingBox();for(d=0;d<4;d++)I=y[d],I[0]*B.usrCoords[I[1]]<I[0]*_[I[2]]&&(C=Mat.crossProduct([1,_[I[3]],_[I[4]]],[1,_[I[5]],_[I[6]]]),C[3]=0,C=Mat.normalize(C),B=this.projectPointToLine({coords:B},{stdform:C},f));return B},projectCoordsToParametric:function(u,n,d){var C,I,f=0,y=200,B=d.length,_;return B===1?C=.1*(n.range[1]-n.range[0]):B===2&&(C=.1*Math.min(n.range_u[1]-n.range_u[0],n.range_v[1]-n.range_v[0])),I=C/5e6,_=function(Z,M,V,T){var H=u[0]-n.X.apply(null,V),F=u[1]-n.Y.apply(null,V),O=u[2]-n.Z.apply(null,V);return Z===1?(T[0]=V[0]-n.range[0],T[1]=-V[0]+n.range[1]):Z===2&&(T[0]=V[0]-n.range_u[0],T[1]=-V[0]+n.range_u[1],T[2]=V[1]-n.range_v[0],T[3]=-V[1]+n.range_v[1]),H*H+F*F+O*O},Mat.Nlp.FindMinimum(_,B,2*B,d,C,I,f,y),[1,n.X.apply(null,d),n.Y.apply(null,d),n.Z.apply(null,d)]},projectScreenCoordsToParametric:function(u,n,d){var C,I,f=0,y=200,B=d.length,_;return B===1?C=.1*(n.range[1]-n.range[0]):B===2&&(C=.1*Math.min(n.range_u[1]-n.range_u[0],n.range_v[1]-n.range_v[0])),I=C/5e6,_=function(Z,M,V,T){var H=[1,n.X.apply(null,V),n.Y.apply(null,V),n.Z.apply(null,V)],F=n.view.project3DTo2D(H),O=u[0]-F[1],$=u[1]-F[2];return Z===1?(T[0]=V[0]-n.range[0],T[1]=-V[0]+n.range[1]):Z===2&&(T[0]=V[0]-n.range_u[0],T[1]=-V[0]+n.range_u[1],T[2]=V[1]-n.range_v[0],T[3]=-V[1]+n.range_v[1]),O*O+$*$},Mat.Nlp.FindMinimum(_,B,2*B,d,C,I,f,y),[1,n.X.apply(null,d),n.Y.apply(null,d),n.Z.apply(null,d)]},distPointLine:function(u,n){var d=n[1],C=n[2],I=n[0],f;return Math.abs(d)+Math.abs(C)<Mat.eps?Number.POSITIVE_INFINITY:(f=d*u[1]+C*u[2]+I,d*=d,C*=C,Math.abs(f)/Math.sqrt(d+C))},distPointSegment:function(u,n,d){var C,I,f,y,B,_,Z=Mat.eps*Mat.eps,M=1e6;return C=u[1]-n[1],I=u[2]-n[2],C=C===1/0?M:C===-1/0?-1e6:C,I=I===1/0?M:I===-1/0?-1e6:I,f=d[1]-n[1],y=d[2]-n[2],f=f===1/0?M:f===-1/0?-1e6:f,y=y===1/0?M:y===-1/0?-1e6:y,B=f*f+y*y,B>Z&&(_=(C*f+I*y)/B,_<0?_=0:_>1&&(_=1),C-=_*f,I-=_*y),Mat.hypot(C,I)},reuleauxPolygon:function(u,n){var d,C=Math.PI*2,I=C/n,f=(n-1)/2,y=0,B=function(_,Z){return function(M,V){var T=(M%C+C)%C,H=Math.floor(T/I)%n;return V||(y=u[0].Dist(u[f]),d=Mat.Geometry.rad([u[0].X()+1,u[0].Y()],u[0],u[f%n])),isNaN(H)?H:(T=T*.5+H*I*.5+d,u[H][_]()+y*Math[Z](T))}};return[B("X","cos"),B("Y","sin"),0,C]},meet3Planes:function(u,n,d,C,I,f){var y=[0,0,0],B,_,Z,M,V;for(B=Mat.crossProduct(I,u),_=Mat.crossProduct(u,d),Z=Mat.crossProduct(d,I),M=Mat.innerProduct(u,Z,3),V=0;V<3;V++)y[V]=(n*Z[V]+C*B[V]+f*_[V])/M;return y},meetPlanePlane:function(u,n,d,C){var I,f,y,B=[0,0,0],_=[0,0,0];for(I=0;I<3;I++)B[I]=JXG$1.evaluate(u[I]),_[I]=JXG$1.evaluate(n[I]);for(f=Mat.crossProduct(B,_),I=0;I<3;I++)B[I]=JXG$1.evaluate(d[I]),_[I]=JXG$1.evaluate(C[I]);return y=Mat.crossProduct(B,_),Mat.crossProduct(f,y)},project3DTo3DPlane:function(u,n,d){var C=[0,0,0],I,f,y,B;return d=d||[0,0,0],I=Mat.norm(n),f=Mat.innerProduct(u,n,3),y=Mat.innerProduct(d,n,3),B=(f-y)/I,C=Mat.axpy(-B,n,u),C},getPlaneBounds:function(u,n,d,C,I){var f,y,B,_,Z,M,V;return u[2]+n[0]!==0?(Z=[[u[0],n[0]],[u[1],n[1]]],M=[C-d[0],C-d[1]],V=Numerics.Gauss(Z,M),f=V[0],y=V[1],M=[I-d[0],I-d[1]],V=Numerics.Gauss(Z,M),B=V[0],_=V[1],[f,B,y,_]):null}});const Geometry=Mat.Geometry;Mat.Quadtree=function(u,n,d){n=n||{capacity:10,pointType:"coords"},this.config={},this.config.capacity=n.capacity||10,this.config.pointType=n.pointType||"coords",this.points=[],this.xlb=u[0],this.xub=u[2],this.ylb=u[3],this.yub=u[1],this.parent=d||null,this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null};JXG$1.extend(Mat.Quadtree.prototype,{contains:function(u,n){return this.xlb<u&&u<=this.xub&&this.ylb<n&&n<=this.yub},insert:function(u){switch(this.config.pointType){case"coords":if(!this.contains(u.usrCoords[1],u.usrCoords[2]))return!1;break;case"object":if(!this.contains(u.x,u.y))return!1;break}return this.points.length<this.config.capacity&&this.northWest===null?(this.points.push(u),!0):(this.northWest===null&&this.subdivide(),this.northWest.insert(u)||this.northEast.insert(u)||this.southEast.insert(u)?!0:!!this.southWest.insert(u))},subdivide:function(){var u=this.xlb+(this.xub-this.xlb)*.5,n=this.ylb+(this.yub-this.ylb)*.5;this.northWest=new Mat.Quadtree([this.xlb,this.yub,u,n],this.config,this),this.northEast=new Mat.Quadtree([u,this.yub,this.xub,n],this.config,this),this.southEast=new Mat.Quadtree([this.xlb,n,u,this.ylb],this.config,this),this.southWest=new Mat.Quadtree([u,n,this.xub,this.ylb],this.config,this)},_query:function(u,n){var d;if(this.contains(u,n)){if(this.northWest===null)return this;if(d=this.northWest._query(u,n),d||(d=this.northEast._query(u,n),d)||(d=this.southEast._query(u,n),d)||(d=this.southWest._query(u,n),d))return d}return!1},query:function(u,n){var d,C;return JXG$1.exists(n)?(d=u,C=n):(d=u.usrCoords[1],C=u.usrCoords[2]),this._query(d,C)},hasPoint:function(u,n,d){var C,I,f;if(this.contains(u,n)){switch(f=this.points.length,this.config.pointType){case"coords":for(I=0;I<f;I++)if(Geometry.distance([u,n],this.points[I].usrCoords.slice(1),2)<d)return!0;break;case"object":for(I=0;I<f;I++)if(Geometry.distance([u,n],[this.points[I].x,this.points[I].y],2)<d)return!0;break}if(this.northWest===null)return!1;if(C=this.northWest.hasPoint(u,n,d),C||(C=this.northEast.hasPoint(u,n,d),C)||(C=this.southEast.hasPoint(u,n,d),C)||(C=this.southWest.hasPoint(u,n,d),C))return C}return!1},getAllPoints:function(){var u=[];return this.getAllPointsRecursive(u),u},getAllPointsRecursive(u){Array.prototype.push.apply(u,this.points.slice()),this.northWest!==null&&(this.northWest.getAllPointsRecursive(u),this.northEast.getAllPointsRecursive(u),this.southEast.getAllPointsRecursive(u),this.southWest.getAllPointsRecursive(u))}});const QDT=Mat.Quadtree;Mat.BoxQuadtree=function(u,n,d){var C,I,f,y;u--,this.depth=u,this.capacity=n,this.items=[],this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null,this.bbox=null,this.cx=null,this.cy=null,d&&(C=d[0],I=d[1],f=d[2],y=d[3],this.cx=(C+f)*.5,this.cy=(I+y)*.5,this.bbox=[C,I,f,y])};JXG$1.extend(Mat.BoxQuadtree.prototype,{insert:function(u){var n,d,C,I,f,y,B,_=[],Z=[],M=[],V=[],T,H,F,O;if(this.bbox===null){for(d=u.length,C=y=1/0,f=I=-1/0,n=0;n<u.length;n++)B=u[n],C=B.xlb<C?B.xlb:C,I=B.yub>I?B.yub:I,f=B.xub>f?B.xub:f,y=B.ylb<y?B.ylb:y;this.cx=(C+f)*.5,this.cy=(I+y)*.5,this.bbox=[C,I,f,y]}else C=this.bbox[0],I=this.bbox[1],f=this.bbox[2],y=this.bbox[3];if(this.depth===0||this.items.length+u.length<this.capacity)return this.items=this.items.concat(u),this;for(d=u.length,n=0;n<d;n++)B=u[n],T=B.xlb<=this.cx&&B.yub>this.cy,F=B.xlb<=this.cx&&B.ylb<=this.cy,H=B.xub>this.cx&&B.yub>this.cy,O=B.xub>this.cx&&B.ylb<=this.cy,T&&H&&O&&F?this.items.push(B):(T&&_.push(B),F&&M.push(B),H&&Z.push(B),O&&V.push(B));return this.subdivide(_,M,Z,V,C,I,f,y),this},insertItem:function(u){var n,d,C,I,f=[],y=[],B=[],_=[],Z,M,V,T;return this.bbox===null?(n=I=1/0,C=d=-1/0,n=u.xlb<n?u.xlb:n,d=u.yub>d?u.yub:d,C=u.xub>C?u.xub:C,I=u.ylb<I?u.ylb:I,this.cx=(n+C)*.5,this.cy=(d+I)*.5,this.bbox=[n,d,C,I]):(n=this.bbox[0],d=this.bbox[1],C=this.bbox[2],I=this.bbox[3]),this.depth===0||this.items.length+1<this.capacity?(this.items.push(u),this):(Z=u.xlb<=this.cx&&u.yub>this.cy,V=u.xlb<=this.cx&&u.ylb<=this.cy,M=u.xub>this.cx&&u.yub>this.cy,T=u.xub>this.cx&&u.ylb<=this.cy,Z&&M&&T&&V?this.items.push(u):(Z&&f.push(u),V&&B.push(u),M&&y.push(u),T&&_.push(u)),this.subdivide(f,B,y,_,n,d,C,I),this)},subdivide:function(u,n,d,C,I,f,y,B){return u.length>0&&(this.northWest===null&&(this.northWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[I,f,this.cx,this.cy])),this.northWest.insert(u)),n.length>0&&(this.southWest===null&&(this.southWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[I,this.cy,this.cx,B])),this.southWest.insert(n)),d.length>0&&(this.northEast===null&&(this.northEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,f,y,this.cy])),this.northEast.insert(d)),C.length>0&&(this.southEast===null&&(this.southEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,this.cy,y,B])),this.southEast.insert(C)),this},find:function(u){var n=function(f){return u[2]>=f.xlb&&u[0]<=f.xub&&u[3]<=f.yub&&u[1]>=f.ylb},d=[],C,I;for(I=this.items.length,C=0;C<I;C++)n(this.items[C])&&d.push(this.items[C]);return this.northWest!==null&&u[0]<=this.cx&u[1]>=this.cy&&JXG$1.concat(d,this.northWest.find(u)),this.southWest!==null&&u[0]<=this.cx&u[3]<=this.cy&&JXG$1.concat(d,this.southWest.find(u)),this.northEast!==null&&u[2]>=this.cx&u[1]>=this.cy&&JXG$1.concat(d,this.northEast.find(u)),this.southEast!==null&&u[2]>=this.cx&u[3]<=this.cy&&JXG$1.concat(d,this.southEast.find(u)),d},analyzeTree:function(){var u={number_items:this.items.length,depth:1},n;return this.northWest!==null&&(n=this.northWest.analyzeTree(),u.number_items+=n.number_items,u.depth=Math.max(u.depth,1+n.depth)),this.southWest!==null&&(n=this.southWest.analyzeTree(),u.number_items+=n.number_items,u.depth=Math.max(u.depth,1+n.depth)),this.northEast!==null&&(n=this.northEast.analyzeTree(),u.number_items+=n.number_items,u.depth=Math.max(u.depth,1+n.depth)),this.southEast!==null&&(n=this.southEast.analyzeTree(),u.number_items+=n.number_items,u.depth=Math.max(u.depth,1+n.depth)),u},plot:function(){var u=[],n=[],d;return u.push(this.bbox[0]),n.push(this.bbox[3]),u.push(this.bbox[2]),n.push(this.bbox[3]),u.push(this.bbox[2]),n.push(this.bbox[1]),u.push(this.bbox[0]),n.push(this.bbox[1]),u.push(this.bbox[0]),n.push(this.bbox[3]),u.push(NaN),n.push(NaN),this.northWest!==null&&(d=this.northWest.plot(),JXG$1.concat(u,d[0]),JXG$1.concat(n,d[1])),this.northEast!==null&&(d=this.northEast.plot(),JXG$1.concat(u,d[0]),JXG$1.concat(n,d[1])),this.southEast!==null&&(d=this.southEast.plot(),JXG$1.concat(u,d[0]),JXG$1.concat(n,d[1])),this.southWest!==null&&(d=this.southWest.plot(),JXG$1.concat(u,d[0]),JXG$1.concat(n,d[1])),[u,n]}});const Quadtree=Mat.BoxQuadtree;JXG$1.Math.Nlp={arr:function(u){return new Float64Array(u)},arr2:function(u,n){for(var d=0,C=new Array(u);d<u;)C[d]=this.arr(n),d++;return C},arraycopy:function(u,n,d,C,I){for(var f=0;f<I;)d[f+C]=u[f+n],f++},lastNumberOfEvaluations:0,GetLastNumberOfEvaluations:function(){return this.lastNumberOfEvaluations},Normal:0,MaxIterationsReached:1,DivergingRoundingErrors:2,FindMinimum:function(u,n,d,C,I,f,y,B,_){var Z=d+2,M,V=this.arr(n+1),T=this,H;return this.lastNumberOfEvaluations=0,_&&console.log("Experimental feature 'testForRoundingErrors' is activated."),V[0]=0,this.arraycopy(C,0,V,1,n),H=function(F,O,$,U){var ee=T.arr(F),Q,ie;return T.lastNumberOfEvaluations=T.lastNumberOfEvaluations+1,T.arraycopy($,1,ee,0,F),Q=T.arr(O),ie=u(F,O,ee,Q),T.arraycopy(Q,0,U,1,O),ie},M=this.cobylb(H,n,d,Z,V,I,f,y,B,_),this.arraycopy(V,1,C,0,n),M},cobylb:function(u,n,d,C,I,f,y,B,_,Z){var M=-1,V=.25,T=2.1,H=.5,F=1.1,O=0,$=0,U,ee=n+1,Q=d+1,ie=f,ne=0,le=!1,ae=!1,ce=0,ge=0,he=0,Ie=this.arr(1+C),fe=this.arr2(1+n,1+ee),me=this.arr2(1+n,1+n),Ge=this.arr2(1+C,1+ee),Ze=this.arr2(1+n,1+Q),ye=this.arr(1+n),Ee=this.arr(1+n),Ve=this.arr(1+n),Ye=this.arr(1+n),be=this.arr(1+n),Be,Ne,Ae,Re,We,De,Fe,Ke,Rt,dt,Ut,rt,nt,we,Jt,It,Ht,mt,ni,kt,Me,ve,et,ht,Xt,Ue,ft,Dt,jt,ii,it=!0;for(B>=2&&console.log("The initial value of RHO is "+ie+" and PARMU is set to zero."),Fe=0,We=1/ie,Be=1;Be<=n;++Be)fe[Be][ee]=I[Be],fe[Be][Be]=ie,me[Be][Be]=We;Ke=ee,Rt=!1;e:do{if(Fe>=_&&Fe>0){M=this.MaxIterationsReached;break e}for(++Fe,O=u(n,d,I,Ie),$=0,Ae=1;Ae<=d;++Ae)$=Math.max($,-Ie[Ae]);if((Fe===B-1||B===3)&&this.PrintIterationResult(Fe,O,$,I,n,B),Ie[Q]=O,Ie[C]=$,dt=!0,!Rt){for(dt=!1,Be=1;Be<=C;++Be)Ge[Be][Ke]=Ie[Be];if(Fe<=ee){if(Ke<=n)if(Ge[Q][ee]<=O)I[Ke]=fe[Ke][ee];else{for(fe[Ke][ee]=I[Ke],Ae=1;Ae<=C;++Ae)Ge[Ae][Ke]=Ge[Ae][ee],Ge[Ae][ee]=Ie[Ae];for(Ae=1;Ae<=Ke;++Ae){for(fe[Ke][Ae]=-ie,We=0,Be=Ae;Be<=Ke;++Be)We-=me[Be][Ae];me[Ke][Ae]=We}}if(Fe<=n){Ke=Fe,I[Ke]+=ie;continue e}}Rt=!0}t:do{i:do{if(!dt){for(Ut=Ge[Q][ee]+ne*Ge[C][ee],rt=ee,Ne=1;Ne<=n;++Ne)We=Ge[Q][Ne]+ne*Ge[C][Ne],We<Ut?(rt=Ne,Ut=We):We===Ut&&ne===0&&Ge[C][Ne]<Ge[C][rt]&&(rt=Ne);if(rt<=n){for(Be=1;Be<=C;++Be)We=Ge[Be][ee],Ge[Be][ee]=Ge[Be][rt],Ge[Be][rt]=We;for(Be=1;Be<=n;++Be){for(We=fe[Be][rt],fe[Be][rt]=0,fe[Be][ee]+=We,De=0,Ae=1;Ae<=n;++Ae)fe[Be][Ae]-=We,De-=me[Ae][Be];me[rt][Be]=De}}if(nt=0,Z)for(Be=1;Be<=n;++Be)for(Ne=1;Ne<=n;++Ne)We=this.DOT_PRODUCT_ROW_COL(me,Be,fe,Ne,1,n)-(Be===Ne?1:0),nt=Math.max(nt,Math.abs(We));if(nt>.1){M=this.DivergingRoundingErrors;break e}for(Ae=1;Ae<=Q;++Ae){for(Ie[Ae]=-Ge[Ae][ee],Ne=1;Ne<=n;++Ne)be[Ne]=Ge[Ae][Ne]+Ie[Ae];for(Be=1;Be<=n;++Be)Ze[Be][Ae]=(Ae===Q?-1:1)*this.DOT_PRODUCT_ROW_COL(be,-1,me,Be,1,n)}for(le=!0,ce=V*ie,we=T*ie,Ne=1;Ne<=n;++Ne){for(Jt=0,It=0,Ae=1;Ae<=n;++Ae)Jt+=me[Ne][Ae]*me[Ne][Ae],It+=fe[Ae][Ne]*fe[Ae][Ne];ye[Ne]=1/Math.sqrt(Jt),Ee[Ne]=Math.sqrt(It),(ye[Ne]<ce||Ee[Ne]>we)&&(le=!1)}if(!Rt&&!le){for(Ke=0,We=we,Ne=1;Ne<=n;++Ne)Ee[Ne]>We&&(Ke=Ne,We=Ee[Ne]);if(Ke===0)for(Ne=1;Ne<=n;++Ne)ye[Ne]<We&&(Ke=Ne,We=ye[Ne]);for(We=H*ie*ye[Ke],Ae=1;Ae<=n;++Ae)Ye[Ae]=We*me[Ke][Ae];for(Ht=0,mt=0,U=0,Ae=1;Ae<=Q;++Ae)U=this.DOT_PRODUCT_ROW_COL(Ye,-1,Ze,Ae,1,n),Ae<Q&&(We=Ge[Ae][ee],Ht=Math.max(Ht,-U-We),mt=Math.max(mt,U-We));for(ni=ne*(Ht-mt)>2*U?-1:1,We=0,Be=1;Be<=n;++Be)Ye[Be]=ni*Ye[Be],fe[Be][Ke]=Ye[Be],We+=me[Ke][Be]*Ye[Be];for(Ae=1;Ae<=n;++Ae)me[Ke][Ae]/=We;for(Ne=1;Ne<=n;++Ne){if(Ne!==Ke)for(We=this.DOT_PRODUCT_ROW_COL(me,Ne,Ye,-1,1,n),Ae=1;Ae<=n;++Ae)me[Ne][Ae]-=We*me[Ke][Ae];I[Ne]=fe[Ne][ee]+Ye[Ne]}continue e}if(ae=this.trstlp(n,d,Ze,Ie,ie,Ye),!ae){for(We=0,Ae=1;Ae<=n;++Ae)We+=Ye[Ae]*Ye[Ae];if(We<.25*ie*ie){Rt=!0;break i}}for(U=0,kt=0,Ie[Q]=0,Ae=1;Ae<=Q;++Ae)U=Ie[Ae]-this.DOT_PRODUCT_ROW_COL(Ye,-1,Ze,Ae,1,n),Ae<Q&&(kt=Math.max(kt,U));if(ge=Ge[C][ee]-kt,Me=ge>0?U/ge:0,ne<1.5*Me){for(ne=2*Me,B>=2&&console.log("Increase in PARMU to "+ne),ve=Ge[Q][ee]+ne*Ge[C][ee],Ne=1;Ne<=n;++Ne)if(We=Ge[Q][Ne]+ne*Ge[C][Ne],We<ve||We===ve&&ne===0&&Ge[C][Ne]<Ge[C][ee])continue t}for(he=ne*ge-U,Ae=1;Ae<=n;++Ae)I[Ae]=fe[Ae][ee]+Ye[Ae];Rt=!0;continue e}for(dt=!1,et=Ge[Q][ee]+ne*Ge[C][ee],ht=O+ne*$,Xt=et-ht,ne===0&&O===Ge[Q][ee]&&(he=ge,Xt=Ge[C][ee]-$),Ue=Xt<=0?1:0,Ke=0,Ne=1;Ne<=n;++Ne)We=Math.abs(this.DOT_PRODUCT_ROW_COL(me,Ne,Ye,-1,1,n)),We>Ue&&(Ke=Ne,Ue=We),Ve[Ne]=We*ye[Ne];for(ft=F*ie,Re=0,Ne=1;Ne<=n;++Ne)if(Ve[Ne]>=ce||Ve[Ne]>=ye[Ne]){if(We=Ee[Ne],Xt>0){for(We=0,Ae=1;Ae<=n;++Ae)We+=Math.pow(Ye[Ae]-fe[Ae][Ne],2);We=Math.sqrt(We)}We>ft&&(Re=Ne,ft=We)}if(Re>0&&(Ke=Re),Ke!==0){for(We=0,Be=1;Be<=n;++Be)fe[Be][Ke]=Ye[Be],We+=me[Ke][Be]*Ye[Be];for(Ae=1;Ae<=n;++Ae)me[Ke][Ae]/=We;for(Ne=1;Ne<=n;++Ne)if(Ne!==Ke)for(We=this.DOT_PRODUCT_ROW_COL(me,Ne,Ye,-1,1,n),Ae=1;Ae<=n;++Ae)me[Ne][Ae]-=We*me[Ke][Ae];for(Ae=1;Ae<=C;++Ae)Ge[Ae][Ke]=Ie[Ae];if(Xt>0&&Xt>=.1*he)continue t}}while(!1);if(!le){Rt=!1;continue t}if(ie<=y){M=this.Normal;break e}if(Dt=0,jt=0,ie*=.5,ie<=1.5*y&&(ie=y),ne>0){for(ii=0,Ae=1;Ae<=Q;++Ae){for(Dt=Ge[Ae][ee],jt=Dt,Be=1;Be<=n;++Be)Dt=Math.min(Dt,Ge[Ae][Be]),jt=Math.max(jt,Ge[Ae][Be]);Ae<=d&&Dt<.5*jt&&(We=Math.max(jt,0)-Dt,ii=ii<=0?We:Math.min(ii,We))}ii===0?ne=0:jt-Dt<ne*ii&&(ne=(jt-Dt)/ii)}B>=2&&console.log("Reduction in RHO to "+ie+"  and PARMU = "+ne),B===2&&this.PrintIterationResult(Fe,Ge[Q][ee],Ge[C][ee],this.COL(fe,ee),n,B)}while(it)}while(it);switch(M){case this.Normal:if(B>=1&&console.log("%nNormal return from subroutine COBYLA%n"),ae)return B>=1&&this.PrintIterationResult(Fe,O,$,I,n,B),M;break;case this.MaxIterationsReached:B>=1&&console.log("%nReturn from subroutine COBYLA because the MAXFUN limit has been reached.%n");break;case this.DivergingRoundingErrors:B>=1&&console.log("%nReturn from subroutine COBYLA because rounding errors are becoming damaging.%n");break}for(Ae=1;Ae<=n;++Ae)I[Ae]=fe[Ae][ee];return O=Ge[Q][ee],$=Ge[C][ee],B>=1&&this.PrintIterationResult(Fe,O,$,I,n,B),M},trstlp:function(u,n,d,C,I,f){var y=0,B=0,_=0,Z=this.arr2(1+u,1+u),M=this.arr(2+n),V=this.arr(2+n),T=this.arr(1+u),H=this.arr(1+u),F=this.arr(2+n),O=this.arr(2+n),$=n,U=0,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze,ye,Ee,Ve,Ye,be,Be,Ne,Ae,Re,We,De,Fe,Ke,Rt,dt,Ut,rt,nt,we,Jt,It=!0;for(ie=1;ie<=u;++ie)Z[ie][ie]=1,f[ie]=0;if(ee=0,Q=0,n>=1){for(ne=1;ne<=n;++ne)C[ne]>Q&&(Q=C[ne],ee=ne);for(ne=1;ne<=n;++ne)O[ne]=ne,V[ne]=Q-C[ne]}le=!0;do e:do{(!le||le&&Q===0)&&($=n+1,ee=$,O[$]=$,V[$]=0),le=!1,ae=0,ce=0,ge=0,he=0;t:do{if(Ie=$===n?Q:-this.DOT_PRODUCT_ROW_COL(f,-1,d,$,1,u),ce===0||Ie<ae?(ae=Ie,B=U,ce=3):U>B?(B=U,ce=3):--ce,ce===0)break e;if(fe=0,ee<=U){if(ee<U){me=O[ee],Ge=V[ee],ne=ee;do{for(ye=ne+1,Ee=O[ye],Ve=this.DOT_PRODUCT(this.PART(this.COL(Z,ne),1,u),this.PART(this.COL(d,Ee),1,u)),y=Mat.hypot(Ve,M[ye]),Ye=M[ye]/y,be=Ve/y,M[ye]=Ye*M[ne],M[ne]=y,ie=1;ie<=u;++ie)y=Ye*Z[ie][ye]+be*Z[ie][ne],Z[ie][ye]=Ye*Z[ie][ne]-be*Z[ie][ye],Z[ie][ne]=y;O[ne]=Ee,V[ne]=V[ye],ne=ye}while(ne<U);O[ne]=me,V[ne]=Ge}if(--U,$>n)for(y=1/M[U],ne=1;ne<=u;++ne)T[ne]=y*Z[ne][U];else for(y=this.DOT_PRODUCT_ROW_COL(T,-1,Z,U+1,1,u),ne=1;ne<=u;++ne)T[ne]-=y*Z[ne][U+1]}else{for(Ee=O[ee],ne=1;ne<=u;++ne)H[ne]=d[ne][Ee];for(Be=0,ne=u;ne>U;){for(Ve=0,Ne=0,ie=1;ie<=u;++ie)y=Z[ie][ne]*H[ie],Ve+=y,Ne+=Math.abs(y);if(Ae=Ne+.1*Math.abs(Ve),Re=Ne+.2*Math.abs(Ve),(Ne>=Ae||Ae>=Re)&&(Ve=0),Be===0)Be=Ve;else for(ye=ne+1,y=Mat.hypot(Ve,Be),Ye=Ve/y,be=Be/y,Be=y,ie=1;ie<=u;++ie)y=Ye*Z[ie][ne]+be*Z[ie][ye],Z[ie][ye]=Ye*Z[ie][ye]-be*Z[ie][ne],Z[ie][ne]=y;--ne}if(Be===0){fe=-1,ne=U;do{for(We=0,De=0,ie=1;ie<=u;++ie)y=Z[ie][ne]*H[ie],We+=y,De+=Math.abs(y);if(Ae=De+.1*Math.abs(We),Re=De+.2*Math.abs(We),De<Ae&&Ae<Re){if(y=We/M[ne],y>0&&O[ne]<=n&&(Jt=V[ne]/y,(fe<0||Jt<fe)&&(fe=Jt)),ne>=2)for(Fe=O[ne],ie=1;ie<=u;++ie)H[ie]-=y*d[ie][Fe];F[ne]=y}else F[ne]=0}while(--ne>0);if(fe<0)break e;for(ne=1;ne<=U;++ne)V[ne]=Math.max(0,V[ne]-fe*F[ne]);if(ee<U){me=O[ee],Ge=V[ee],ne=ee;do{for(ye=ne+1,Fe=O[ye],Ve=this.DOT_PRODUCT(this.PART(this.COL(Z,ne),1,u),this.PART(this.COL(d,Fe),1,u)),y=Mat.hypot(Ve,M[ye]),Ye=M[ye]/y,be=Ve/y,M[ye]=Ye*M[ne],M[ne]=y,ie=1;ie<=u;++ie)y=Ye*Z[ie][ye]+be*Z[ie][ne],Z[ie][ye]=Ye*Z[ie][ne]-be*Z[ie][ye],Z[ie][ne]=y;O[ne]=Fe,V[ne]=V[ye],ne=ye}while(ne<U);O[ne]=me,V[ne]=Ge}if(y=this.DOT_PRODUCT(this.PART(this.COL(Z,U),1,u),this.PART(this.COL(d,Ee),1,u)),y===0)break e;M[U]=y,V[ee]=0,V[U]=fe}else++U,M[U]=Be,V[ee]=V[U],V[U]=0;if(O[ee]=O[U],O[U]=Ee,$>n&&Ee!==$){for(ne=U-1,Ve=this.DOT_PRODUCT(this.PART(this.COL(Z,ne),1,u),this.PART(this.COL(d,Ee),1,u)),y=Mat.hypot(Ve,M[U]),Ye=M[U]/y,be=Ve/y,M[U]=Ye*M[ne],M[ne]=y,ie=1;ie<=u;++ie)y=Ye*Z[ie][U]+be*Z[ie][ne],Z[ie][U]=Ye*Z[ie][ne]-be*Z[ie][U],Z[ie][ne]=y;O[U]=O[ne],O[ne]=Ee,y=V[ne],V[ne]=V[U],V[U]=y}if($>n)for(y=1/M[U],ne=1;ne<=u;++ne)T[ne]=y*Z[ne][U];else for(Ee=O[U],y=(this.DOT_PRODUCT_ROW_COL(T,-1,d,Ee,1,u)-1)/M[U],ne=1;ne<=u;++ne)T[ne]-=y*Z[ne][U]}for(Ke=I*I,dt=0,Rt=0,ie=1;ie<=u;++ie)Math.abs(f[ie])>=1e-6*I&&(Ke-=f[ie]*f[ie]),dt+=f[ie]*T[ie],Rt+=T[ie]*T[ie];if(Ke<=0)break e;if(y=Math.sqrt(Rt*Ke),Math.abs(dt)>=1e-6*y&&(y=Math.sqrt(Rt*Ke+dt*dt)),he=Ke/(y+dt),ge=he,$===n){if(Ae=ge+.1*Q,Re=ge+.2*Q,ge>=Ae||Ae>=Re)break t;ge=Math.min(ge,Q)}for(ne=1;ne<=u;++ne)H[ne]=f[ne]+ge*T[ne];if($===n)for(_=Q,Q=0,ne=1;ne<=U;++ne)Ee=O[ne],y=C[Ee]-this.DOT_PRODUCT_ROW_COL(H,-1,d,Ee,1,u),Q=Math.max(Q,y);ne=U;do{for(Ut=0,rt=0,ie=1;ie<=u;++ie)y=Z[ie][ne]*H[ie],Ut+=y,rt+=Math.abs(y);if(Ae=rt+.1*Math.abs(Ut),Re=rt+.2*Math.abs(Ut),(rt>=Ae||Ae>=Re)&&(Ut=0),F[ne]=Ut/M[ne],ne>=2)for(Ee=O[ne],ie=1;ie<=u;++ie)H[ie]-=F[ne]*d[ie][Ee]}while(ne-->=2);for($>n&&(F[U]=Math.max(0,F[U])),ne=1;ne<=u;++ne)H[ne]=f[ne]+ge*T[ne];if($>U)for(nt=U+1,ne=nt;ne<=$;++ne){for(Ee=O[ne],Ze=Q-C[Ee],we=Q+Math.abs(C[Ee]),ie=1;ie<=u;++ie)y=d[ie][Ee]*H[ie],Ze+=y,we+=Math.abs(y);Ae=we+.1*Math.abs(Ze),Re=we+.2*Math.abs(Ze),(we>=Ae||Ae>=Re)&&(Ze=0),F[ne]=Ze}for(fe=1,ee=0,ne=1;ne<=$;++ne)F[ne]<0&&(y=V[ne]/(V[ne]-F[ne]),y<fe&&(fe=y,ee=ne));for(y=1-fe,ne=1;ne<=u;++ne)f[ne]=y*f[ne]+fe*H[ne];for(ne=1;ne<=$;++ne)V[ne]=Math.max(0,y*V[ne]+fe*F[ne]);$===n&&(Q=_+fe*(Q-_))}while(ee>0);if(ge===he)return!0}while(It);while($===n);return!1},PrintIterationResult:function(u,n,d,C,I,f){f>1&&console.log("NFVALS = "+u+"  F = "+n+"  MAXCV = "+d),f>1&&console.log("X = "+this.PART(C,1,I))},ROW:function(u,n){return u[n].slice()},COL:function(u,n){var d,C=u.length,I=[];for(d=0;d<C;++d)I[d]=u[d][n];return I},PART:function(u,n,d){return u.slice(n,d+1)},FORMAT:function(u){return u.join(",")},DOT_PRODUCT:function(u,n){var d,C=0,I=u.length;for(d=0;d<I;++d)C+=u[d]*n[d];return C},DOT_PRODUCT_ROW_COL:function(u,n,d,C,I,f){var y,B=0;if(n===-1)for(y=I;y<=f;++y)B+=u[y]*d[y][C];else if(C===-1)for(y=I;y<=f;++y)B+=u[n][y]*d[y];else for(y=I;y<=f;++y)B+=u[n][y]*d[y][C];return B}};JXG$1.Math.Nlp;Mat.Statistics={sum:function(u){var n,d=u.length,C=0;for(n=0;n<d;n++)C+=u[n];return C},prod:function(u){var n,d=u.length,C=1;for(n=0;n<d;n++)C*=u[n];return C},mean:function(u){return u.length>0?this.sum(u)/u.length:0},median:function(u){var n,d;return u.length>0?(ArrayBuffer.isView(u)?(n=new Float64Array(u),n.sort()):(n=u.slice(0),n.sort(function(C,I){return C-I})),d=n.length,d&1?n[parseInt(d*.5,10)]:(n[d*.5-1]+n[d*.5])*.5):0},percentile:function(u,n){var d,C,I,f,y=[],B;if(u.length>0){for(ArrayBuffer.isView(u)?(d=new Float64Array(u),d.sort()):(d=u.slice(0),d.sort(function(_,Z){return _-Z})),C=d.length,JXG$1.isArray(n)?f=n:f=[n],I=0;I<f.length;I++)B=C*f[I]*.01,parseInt(B,10)===B?y.push((d[B-1]+d[B])*.5):y.push(d[parseInt(B,10)]);return JXG$1.isArray(n)?y:y[0]}return 0},variance:function(u){var n,d,C,I=u.length;if(I>1){for(n=this.mean(u),d=0,C=0;C<I;C++)d+=(u[C]-n)*(u[C]-n);return d/(u.length-1)}return 0},sd:function(u){return Math.sqrt(this.variance(u))},weightedMean:function(u,n){if(u.length!==n.length)throw new Error("JSXGraph error (Math.Statistics.weightedMean): Array dimension mismatch.");return u.length>0?this.mean(this.multiply(u,n)):0},max:function(u){return Math.max.apply(this,u)},min:function(u){return Math.min.apply(this,u)},range:function(u){return[this.min(u),this.max(u)]},abs:function(u){var n,d,C;if(JXG$1.isArray(u))if(u.map)C=u.map(Math.abs);else for(d=u.length,C=[],n=0;n<d;n++)C[n]=Math.abs(u[n]);else ArrayBuffer.isView(u)?C=u.map(Math.abs):C=Math.abs(u);return C},add:function(u,n){var d,C,I=[];if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,d=0;d<C;d++)I[d]=u[d]+n;else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(C=n.length,d=0;d<C;d++)I[d]=u+n[d];else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),d=0;d<C;d++)I[d]=u[d]+n[d];else I=u+n;return I},div:function(u,n){var d,C,I=[];if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,d=0;d<C;d++)I[d]=u[d]/n;else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(C=n.length,d=0;d<C;d++)I[d]=u/n[d];else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),d=0;d<C;d++)I[d]=u[d]/n[d];else I=u/n;return I},divide:function(){JXG$1.deprecated("Statistics.divide()","Statistics.div()"),Mat.Statistics.div.apply(Mat.Statistics,arguments)},mod:function(u,n,d){var C,I,f=[],y=function(B,_){return B%_};if(d=JXG$1.def(d,!1),d&&(y=Mat.mod),u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n))for(I=u.length,C=0;C<I;C++)f[C]=y(u[C],n);else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(I=n.length,C=0;C<I;C++)f[C]=y(u,n[C]);else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(I=Math.min(u.length,n.length),C=0;C<I;C++)f[C]=y(u[C],n[C]);else f=y(u,n);return f},multiply:function(u,n){var d,C,I=[];if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,d=0;d<C;d++)I[d]=u[d]*n;else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(C=n.length,d=0;d<C;d++)I[d]=u*n[d];else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),d=0;d<C;d++)I[d]=u[d]*n[d];else I=u*n;return I},subtract:function(u,n){var d,C,I=[];if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,d=0;d<C;d++)I[d]=u[d]-n;else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(C=n.length,d=0;d<C;d++)I[d]=u-n[d];else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),d=0;d<C;d++)I[d]=u[d]-n[d];else I=u-n;return I},TheilSenRegression:function(u){var n,d,C=[],I=[],f=[];for(n=0;n<u.length;n++){for(I.length=0,d=0;d<u.length;d++)Math.abs(u[d].usrCoords[1]-u[n].usrCoords[1])>Mat.eps&&(I[d]=(u[d].usrCoords[2]-u[n].usrCoords[2])/(u[d].usrCoords[1]-u[n].usrCoords[1]));C[n]=this.median(I),f.push(u[n].usrCoords[2]-C[n]*u[n].usrCoords[1])}return[this.median(f),this.median(C),-1]},generateGaussian:function(u,n){var d,C,I;if(this.hasSpare)return this.hasSpare=!1,this.spare*n+u;do d=Math.random()*2-1,C=Math.random()*2-1,I=d*d+C*C;while(I>=1||I===0);return I=Math.sqrt(-2*Math.log(I)/I),this.spare=C*I,this.hasSpare=!0,u+n*d*I},randomNormal:function(u,n){return this.generateGaussian(u,n)},randomUniform:function(u,n){return Math.random()*(n-u)+u},randomExponential:function(u){var n;if(u<=0)return NaN;do n=Math.random();while(n===0);return-Math.log(n)/u},randomGamma:function(u,n,d){var C,I,f,y,B,_;if(u<=0)return NaN;if(n=n||1,d=d||0,u===1)return n*this.randomExponential(1)+d;if(u<1){B=Math.E/(u+Math.E);do{C=Math.random();do I=Math.random();while(I===0);C<B?(f=Math.pow(I,1/u),_=Math.exp(-f)):(f=1-Math.log(I),_=Math.pow(f,u-1)),C=Math.random()}while(C>=_);return n*f+d}do if(y=Math.tan(Math.PI*Math.random()),f=Math.sqrt(2*u-1)*y+u-1,f>0)I=Math.random();else continue;while(f<=0||I>(1+y*y)*Math.exp((u-1)*Math.log(f/(u-1))-Math.sqrt(2*u-1)*y));return n*f+d},randomBeta:function(u,n){var d,C,I;return u<=0||n<=0?NaN:(d=this.randomGamma(u),C=this.randomGamma(n),I=d/(d+C),I)},randomChisquare:function(u){return u<=0?NaN:2*this.randomGamma(u*.5)},randomF:function(u,n){var d,C;return u<=0||n<=0?NaN:(d=this.randomChisquare(u),C=this.randomChisquare(n),d*n/(C*u))},randomT:function(u){var n,d;return u<=0?NaN:(n=this.randomNormal(0,1),d=this.randomChisquare(u),n/Math.sqrt(d/u))},randomBinomial:function(u,n){var d,C,I,f,y,B;if(n<0||n>1||u<0)return NaN;if(n===0)return 0;if(n===1)return u;if(u===0)return 0;if(u===1)return Math.random()<n?1:0;if(n>.5)return u-this.randomBinomial(u,1-n);if(u<100){if(d=-1,C=0,I=Math.log(1-n),I===0)return 0;do d+=1,C+=Math.floor(Math.log(Math.random())/I)+1;while(C<u)}else f=1+Math.floor(u*.5),y=u-f+1,d=this.randomBeta(f,y),d>=n?(B=this.randomBinomial(f-1,n/d),d=B):(B=this.randomBinomial(y-1,(n-d)/(1-d)),d=f+B);return d},randomGeometric:function(u){var n;return u<0||u>1?NaN:(n=Math.random(),Math.ceil(Math.log(n)/Math.log(1-u)))},randomPoisson:function(u){var n=Math.exp(-u),d,C=0,I=1,f,y=7/8;if(u<=0)return NaN;if(u<10){do I*=Math.random(),C+=1;while(I>n);d=C-1}else C=Math.floor(y*u),f=this.randomGamma(C),f<u?d=C+this.randomPoisson(u-f):d=this.randomBinomial(C-1,u/f);return d},randomPareto:function(u,n){var d=Math.random();return u<=0||n<=0?NaN:n*Math.pow(1-d,-1/u)},randomHypergeometric:function(u,n,d){var C,I,f=0,y=u+n-d,B=Math.min(u,n),_=B;if(u<1||n<1||d>u+n)return NaN;for(C=d;_*C>0;)I=Math.random(),_-=Math.floor(I+_/(y+C)),C-=1;return f=B-_,u<=n?f:d-f},histogram:function(u,n){var d,C,I,f,y,B,_,Z,M,V=[],T=[],H=0;for(B=n.bins||10,Z=n.range||!1,Z===!1?(f=Math.min.apply(null,u),y=Math.max.apply(null,u)):(f=Z[0],y=Z[1]),B>0?_=(y-f)/(B-1):_=0,d=0;d<B;d++)V.push(0),T.push(f+d*_);for(C=u.length,d=0;d<C;d++)I=Math.floor((u[d]-f)/_),I>=0&&I<B?V[I]+=1:H+=1;if(n.density)for(M=JXG$1.Math.Statistics.sum(V)+H,d=0;d<B;d++)V[d]/=M*_;if(n.cumulative){if(n.density)for(d=0;d<B;d++)V[d]*=_;for(d=1;d<B;d++)V[d]+=V[d-1]}return[V,T]}};const Statistics=Mat.Statistics;Mat.Plot={checkReal:function(u){var n=!1,d,C,I=u.length;for(d=0;d<I;d++)if(C=u[d].usrCoords,!isNaN(C[1])&&!isNaN(C[2])&&Math.abs(C[0])>Mat.eps){n=!0;break}return n},updateParametricCurveNaive:function(u,n,d,C){var I,f,y=!1,B=(d-n)/C;for(I=0;I<C;I++)f=n+I*B,u.points[I].setCoordinates(Const.COORDS_BY_USER,[u.X(f,y),u.Y(f,y)],!1),u.points[I]._t=f,y=!0;return u},isSegmentOutside:function(u,n,d,C,I){return n<0&&C<0||n>I.canvasHeight&&C>I.canvasHeight||u<0&&d<0||u>I.canvasWidth&&d>I.canvasWidth},isDistOK:function(u,n,d,C){return Math.abs(u)<d&&Math.abs(n)<C&&!isNaN(u+n)},isSegmentDefined:function(u,n,d,C){return!(isNaN(u+n)&&isNaN(d+C))},updateParametricCurveOld:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O=!1,$=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),U=[],ee=[],Q=[],ie=[],ne=!1,le=0,ae=function(ce,ge,he){var Ie,fe=he[1]-ce[1],me=he[2]-ce[2],Ge=ge[0]-ce[1],Ze=ge[1]-ce[2],ye=Ge*Ge+Ze*Ze;return ye>=Mat.eps&&(Ie=(fe*Ge+me*Ze)/ye,Ie>0&&(Ie<=1?(fe-=Ie*Ge,me-=Ie*Ze):(fe-=Ge,me-=Ze))),Mat.hypot(fe,me)};for(JXG$1.deprecated("Curve.updateParametricCurveOld()"),u.board.updateQuality===u.board.BOARD_QUALITY_LOW?(T=15,H=10,F=10):(T=21,H=.7,F=.7),ie[0]=d-n,C=1;C<T;C++)ie[C]=ie[C-1]*.5;C=1,U[0]=1,ee[0]=0,I=n,$.setCoordinates(Const.COORDS_BY_USER,[u.X(I,O),u.Y(I,O)],!1),O=!0,_=$.scrCoords[1],Z=$.scrCoords[2],I=d,$.setCoordinates(Const.COORDS_BY_USER,[u.X(I,O),u.Y(I,O)],!1),y=$.scrCoords[1],B=$.scrCoords[2],Q[0]=[y,B],M=1,V=0,u.points=[],u.points[le++]=new Coords(Const.COORDS_BY_SCREEN,[_,Z],u.board,!1);do{for(ne=this.isDistOK(y-_,B-Z,H,F)||this.isSegmentOutside(_,Z,y,B,u.board);V<T&&(!ne||V<6)&&(V<=7||this.isSegmentDefined(_,Z,y,B));)U[M]=C,ee[M]=V,Q[M]=[y,B],M+=1,C=2*C-1,V++,I=n+C*ie[V],$.setCoordinates(Const.COORDS_BY_USER,[u.X(I,O),u.Y(I,O)],!1,!0),y=$.scrCoords[1],B=$.scrCoords[2],ne=this.isDistOK(y-_,B-Z,H,F)||this.isSegmentOutside(_,Z,y,B,u.board);le>1&&(f=ae(u.points[le-2].scrCoords,[y,B],u.points[le-1].scrCoords),f<.015&&(le-=1)),u.points[le]=new Coords(Const.COORDS_BY_SCREEN,[y,B],u.board,!1),u.points[le]._t=I,le+=1,_=y,Z=B,M-=1,y=Q[M][0],B=Q[M][1],V=ee[M]+1,C=U[M]*2}while(M>0&&le<5e5);return u.numberPoints=u.points.length,u},_insertPoint_v2:function(u,n,d){var C=!isNaN(this._lastCrds[1]+this._lastCrds[2]),I=!isNaN(n.scrCoords[1]+n.scrCoords[2]),f=u.board.canvasWidth,y=u.board.canvasHeight,B=500;I=I&&n.scrCoords[1]>-500&&n.scrCoords[2]>-500&&n.scrCoords[1]<f+B&&n.scrCoords[2]<y+B,(!I&&C||I&&(!C||Math.abs(n.scrCoords[1]-this._lastCrds[1])>.7||Math.abs(n.scrCoords[2]-this._lastCrds[2])>.7))&&(n._t=d,u.points.push(n),this._lastCrds=n.copy("scrCoords"))},neighborhood_isNaN_v2:function(u,n){var d,C=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),I,f;return I=n+Mat.eps,C.setCoordinates(Const.COORDS_BY_USER,[u.X(I,!0),u.Y(I,!0)],!1),f=C.usrCoords,d=isNaN(f[1]+f[2]),!(!d&&(I=n-Mat.eps,C.setCoordinates(Const.COORDS_BY_USER,[u.X(I,!0),u.Y(I,!0)],!1),f=C.usrCoords,d=isNaN(f[1]+f[2]),!d))},_borderCase:function(u,n,d,C,I,f,y,B){var _,Z,M,V=null,T,H=30,F=!1,O,$;if(B<=1){if(Z=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),isNaN(n[1]+n[2])&&!isNaN(C[1]+C[2])&&!this.neighborhood_isNaN_v2(u,I)||isNaN(d[1]+d[2])&&!isNaN(C[1]+C[2])&&!this.neighborhood_isNaN_v2(u,f)||isNaN(C[1]+C[2])&&(!isNaN(n[1]+n[2])||!isNaN(d[1]+d[2]))&&!this.neighborhood_isNaN_v2(u,y))return!1;T=0;do{if(isNaN(n[1]+n[2])&&!isNaN(C[1]+C[2]))O=I,$=y;else if(isNaN(d[1]+d[2])&&!isNaN(C[1]+C[2]))O=f,$=y;else if(isNaN(C[1]+C[2])&&!isNaN(d[1]+d[2]))O=y,$=f;else if(isNaN(C[1]+C[2])&&!isNaN(n[1]+n[2]))O=y,$=I;else return!1;_=.5*(O+$),Z.setCoordinates(Const.COORDS_BY_USER,[u.X(_,!0),u.Y(_,!0)],!1),M=Z.usrCoords,F=isNaN(M[1]+M[2]),F?O=_:$=_,++T}while(F&&T<H);if(T<H&&(V=M.slice(),C=M.slice(),$=_),V!==null)return this._insertPoint_v2(u,new Coords(Const.COORDS_BY_USER,V,u.board,!1)),!0}return!1},_plotRecursive_v2:function(u,n,d,C,I,f,y){var B,_,Z,M=0,V,T,H,F=.5,O=.99,$=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1);if(!(u.numberPoints>65536))return f<this.nanLevel&&this._isUndefined(u,n,d,C,I)?this:f<this.nanLevel&&this._isOutside(n,d,C,I,u.board)?this:(B=(d+I)*.5,$.setCoordinates(Const.COORDS_BY_USER,[u.X(B,!0),u.Y(B,!0)],!1),_=$.scrCoords,this._borderCase(u,n,C,_,d,I,B,f)?this:(Z=this._triangleDists(n,C,_),V=f<this.smoothLevel&&Z[3]<y,T=f<=this.jumpLevel&&(isNaN(Z[0])||isNaN(Z[1])||isNaN(Z[2]))||f<this.jumpLevel&&(Z[2]>O*Z[0]||Z[1]>O*Z[0]||Z[0]===1/0||Z[1]===1/0||Z[2]===1/0),H=f<this.smoothLevel+2&&Z[0]<F*(Z[1]+Z[2]),H&&(M=0,V=!1),--f,T?this._insertPoint_v2(u,new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],u.board,!1),B):f<=M||V?this._insertPoint_v2(u,$,B):(this._plotRecursive_v2(u,n,d,_,B,f,y),isNaN($.scrCoords[1]+$.scrCoords[2])||this._insertPoint_v2(u,$,B),this._plotRecursive_v2(u,_,B,C,I,f,y)),this))},updateParametricCurve_v2:function(u,n,d){var C,I,f,y,B=!1,_=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),Z=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),M,V,T,H,F;return u.board.updateQuality===u.board.BOARD_QUALITY_LOW?(M=JXG$1.evaluate(u.visProp.recursiondepthlow)||13,V=2,this.smoothLevel=M-6,this.jumpLevel=3):(M=JXG$1.evaluate(u.visProp.recursiondepthhigh)||17,V=2,this.smoothLevel=M-9,this.jumpLevel=2),this.nanLevel=M-4,u.points=[],this.xterm==="x"?(H=u.board.getBoundingBox(),T=(H[2]-H[0])*.3,C=Math.max(n,H[0]-T),I=Math.min(d,H[2]+T)):(C=n,I=d),_.setCoordinates(Const.COORDS_BY_USER,[u.X(C,B),u.Y(C,B)],!1),B=!0,Z.setCoordinates(Const.COORDS_BY_USER,[u.X(I,B),u.Y(I,B)],!1),F=this._findStartPoint(u,_.scrCoords,C,Z.scrCoords,I),_.setCoordinates(Const.COORDS_BY_SCREEN,F[0],!1),C=F[1],F=this._findStartPoint(u,Z.scrCoords,I,_.scrCoords,C),Z.setCoordinates(Const.COORDS_BY_SCREEN,F[0],!1),I=F[1],this._visibleArea=[C,I],f=_.copy("scrCoords"),y=Z.copy("scrCoords"),_._t=C,u.points.push(_),this._lastCrds=_.copy("scrCoords"),this._plotRecursive_v2(u,f,C,y,I,M,V),Z._t=I,u.points.push(Z),u.numberPoints=u.points.length,u},_insertLimesPoint:function(u,n,d,C,I){var f,y,B;Math.abs(this._lastUsrCrds[1])===1/0&&Math.abs(I.left_x)===1/0||Math.abs(this._lastUsrCrds[2])===1/0&&Math.abs(I.left_y)===1/0||(f=new Coords(Const.COORDS_BY_USER,[I.left_x,I.left_y],u.board),f._t=d,u.points.push(f),!isNaN(I.left_x)&&!isNaN(I.left_y)&&!isNaN(I.right_x)&&!isNaN(I.right_y)&&(Math.abs(I.left_x-I.right_x)>Mat.eps||Math.abs(I.left_y-I.right_y)>Mat.eps)&&(y=new Coords(Const.COORDS_BY_SCREEN,n,u.board),y._t=d,u.points.push(y)),B=new Coords(Const.COORDS_BY_USER,[I.right_x,I.right_y],u.board),B._t=d,u.points.push(B),this._lastScrCrds=B.copy("scrCoords"),this._lastUsrCrds=B.copy("usrCoords"))},_insertPoint:function(u,n,d,C,I){var f=!isNaN(this._lastScrCrds[1]+this._lastScrCrds[2]),y=!isNaN(n[1]+n[2]),B=u.board.canvasWidth,_=u.board.canvasHeight,Z,M=.8,V=500;if(JXG$1.exists(I)){this._insertLimesPoint(u,n,d,C,I);return}y=y&&n[1]>-500&&n[2]>-500&&n[1]<B+V&&n[2]<_+V,!(!f&&!y)&&(y&&f&&Math.abs(n[1]-this._lastScrCrds[1])<M&&Math.abs(n[2]-this._lastScrCrds[2])<M||Math.abs(n[1])===1/0&&Math.abs(this._lastUsrCrds[1])===1/0||Math.abs(n[2])===1/0&&Math.abs(this._lastUsrCrds[2])===1/0||(Z=new Coords(Const.COORDS_BY_SCREEN,n,u.board),Z._t=d,u.points.push(Z),this._lastScrCrds=Z.copy("scrCoords"),this._lastUsrCrds=Z.copy("usrCoords")))},_triangleDists:function(u,n,d){var C,I,f,y,B;return C=[u[0]*n[0],(u[1]+n[1])*.5,(u[2]+n[2])*.5],I=Geometry.distance(u,n,3),f=Geometry.distance(u,d,3),y=Geometry.distance(d,n,3),B=Geometry.distance(d,C,3),[I,f,y,B]},_isUndefined:function(u,n,d,C,I){var f,y,B;if(!isNaN(n[1]+n[2])||!isNaN(C[1]+C[2]))return!1;for(B=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),y=0;y<20;++y)if(f=d+Math.random()*(I-d),B.setCoordinates(Const.COORDS_BY_USER,[u.X(f,!0),u.Y(f,!0)],!1),!isNaN(B.scrCoords[0]+B.scrCoords[1]+B.scrCoords[2]))return!1;return!0},_isOutside:function(u,n,d,C,I){var f=500,y=I.canvasWidth,B=I.canvasHeight;return u[1]<-500&&d[1]<-500||u[2]<-500&&d[2]<-500||u[1]>y+f&&d[1]>y+f||u[2]>B+f&&d[2]>B+f},_isOutsidePoint:function(u,n){var d=500,C=n.canvasWidth,I=n.canvasHeight;return u[1]<-500||u[2]<-500||u[1]>C+d||u[2]>I+d},_findStartPoint:function(u,n,d,C,I){return[n,d]},_getBorderPos:function(u,n,d,C,I,f,y){var B,_,Z,M,V=30,T=!1,H,F;if(_=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),M=0,isNaN(d[1]+d[2])&&!isNaN(I[1]+I[2]))F=n,H=C;else if(isNaN(y[1]+y[2])&&!isNaN(I[1]+I[2]))F=f,H=C;else if(isNaN(I[1]+I[2])&&!isNaN(y[1]+y[2]))F=C,H=f;else if(isNaN(I[1]+I[2])&&!isNaN(d[1]+d[2]))F=C,H=n;else return!1;do B=.5*(H+F),_.setCoordinates(Const.COORDS_BY_USER,[u.X(B,!0),u.Y(B,!0)],!1),Z=_.usrCoords,T=isNaN(Z[1]+Z[2]),T?F=B:H=B,++M;while(M<V&&Math.abs(H-F)>Mat.eps);return B},_getCuspPos:function(u,n,d){var C=[u.X(n,!0),u.Y(n,!0)],I=[u.X(d,!0),u.Y(d,!0)],f=function(y){var B=[u.X(y,!0),u.Y(y,!0)];return-(Mat.hypot(C[0]-B[0],C[1]-B[1])+Mat.hypot(I[0]-B[0],I[1]-B[1]))};return Numerics.fminbr(f,[n,d],u)},_getJumpPos:function(u,n,d){var C=function(I){var f=Mat.eps*Mat.eps,y=[u.X(I,!0),u.Y(I,!0)],B=[u.X(I+f,!0),u.Y(I+f,!0)];return-Math.abs((B[1]-y[1])/(B[0]-y[0]))};return Numerics.fminbr(C,[n,d],u)},_getLimits:function(u,n){var d,C=2/(u.maxX()-u.minX()),I,f,y,B;return d=Extrapolate.limit(n,-C,u.X),I=d[0],d[1]==="infinite"&&(I=Math.sign(I)*(1/0)),d=Extrapolate.limit(n,-C,u.Y),y=d[0],d[1]==="infinite"&&(y=Math.sign(y)*(1/0)),d=Extrapolate.limit(n,C,u.X),f=d[0],d[1]==="infinite"&&(f=Math.sign(f)*(1/0)),d=Extrapolate.limit(n,C,u.Y),B=d[0],d[1]==="infinite"&&(B=Math.sign(B)*(1/0)),{left_x:I,left_y:y,right_x:f,right_y:B,t:n}},_getLimes:function(u,n,d,C,I,f,y,B,_){var Z;return B==="border"?Z=this._getBorderPos(u,n,d,C,I,f,y):B==="cusp"?Z=this._getCuspPos(u,n,f):B==="jump"&&(Z=this._getJumpPos(u,n,f)),this._getLimits(u,Z)},_plotNonRecursive:function(u,n,d,C,I,f){var y,B,_,Z=0,M=null,V,T,H=!1,F="",O,$,U,ee,Q,ie=[],ne=0,le;for(U=u.board.origin.scrCoords,ie[ne++]=[n,d,C,I,f,1/0];ne>0;){if(le=ie[--ne],n=le[0],d=le[1],C=le[2],I=le[3],ee=le[4],Q=le[5],H=!1,F="",M=null,u.points.length>65536)return;ee<this.nanLevel&&(this._isUndefined(u,n,d,C,I)||this._isOutside(n,d,C,I,u.board))||(y=(d+I)*.5,O=u.X(y,!0),$=u.Y(y,!0),B=[1,U[1]+O*u.board.unitX,U[2]-$*u.board.unitY],_=this._triangleDists(n,C,B),V=isNaN(n[1]+n[2]),T=isNaN(C[1]+C[2]),V&&!T||!V&&T?F="border":_[0]>.66*Q||_[0]<this.cusp_threshold*(_[1]+_[2])||_[1]>5*_[2]||_[2]>5*_[1]?F="cusp":(_[2]>this.jump_threshold*_[0]||_[1]>this.jump_threshold*_[0]||_[0]===1/0||_[1]===1/0||_[2]===1/0)&&(F="jump"),H=F===""&&ee<this.smoothLevel&&_[3]<this.smooth_threshold,ee<this.testLevel&&!H&&(F===""?H=!0:M=this._getLimes(u,d,n,y,B,I,C,F,ee)),M!==null?(B=[1,NaN,NaN],this._insertPoint(u,B,y,ee,M)):ee<=Z||H?this._insertPoint(u,B,y,ee,null):(ie[ne++]=[B,y,C,I,ee-1,_[0]],ie[ne++]=[n,d,B,y,ee-1,_[0]]))}return this},updateParametricCurve_v3:function(u,n,d){var C,I,f,y,B=!1,_=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),Z=new Coords(Const.COORDS_BY_USER,[0,0],u.board,!1),M,V,T,H;return u.board.updateQuality===u.board.BOARD_QUALITY_LOW?M=JXG$1.evaluate(u.visProp.recursiondepthlow)||14:M=JXG$1.evaluate(u.visProp.recursiondepthhigh)||17,this.smoothLevel=7,this.nanLevel=M-4,this.testLevel=4,this.cusp_threshold=.5,this.jump_threshold=.99,this.smooth_threshold=2,u.points=[],u.xterm==="x"?(T=u.board.getBoundingBox(),V=(T[2]-T[0])*.3,C=Math.max(n,T[0]-V),I=Math.min(d,T[2]+V)):(C=n,I=d),_.setCoordinates(Const.COORDS_BY_USER,[u.X(C,B),u.Y(C,B)],!1),B=!0,Z.setCoordinates(Const.COORDS_BY_USER,[u.X(I,B),u.Y(I,B)],!1),H=this._findStartPoint(u,_.scrCoords,C,Z.scrCoords,I),_.setCoordinates(Const.COORDS_BY_SCREEN,H[0],!1),C=H[1],H=this._findStartPoint(u,Z.scrCoords,I,_.scrCoords,C),Z.setCoordinates(Const.COORDS_BY_SCREEN,H[0],!1),I=H[1],this._visibleArea=[C,I],f=_.copy("scrCoords"),y=Z.copy("scrCoords"),_._t=C,u.points.push(_),this._lastScrCrds=_.copy("scrCoords"),this._lastUsrCrds=_.copy("usrCoords"),this._plotNonRecursive(u,f,C,y,I,M),Z._t=I,u.points.push(Z),u.numberPoints=u.points.length,u},_criticalInterval:function(u,n,d){var C,I,f,y,B,_,Z=!1,M,V=-1/0,T=!1,H=!1,F=0,O=[],$=[],U=[];for(M=Statistics.abs(u),y=Statistics.median(M),y<1e-7?(y=1e-7,T=!0):y*=this.criticalThreshold,C=0;C<n;C++)M[C]>y?(U.push({i:C,v:u[C],group:F}),V=C,Z||(Z=!0)):Z&&C>V+4&&(U.length>0&&O.push(U.slice(0)),U=[],Z=!1,F++);for(Z&&U.length>1&&O.push(U.slice(0)),T&&O.length===0&&(H=!0),I=0;I<O.length;I++)if($[I]="point",f=O[I].length,!(f<64)){for(_=0,B=Math.sign(O[I][0].v),C=1;C<f;C++)Math.sign(O[I][C].v)!==B&&(_++,B=Math.sign(O[I][C].v));_*6>f&&($[I]="interval")}return{smooth:H,groups:O,types:$}},Component:function(){this.left_isNaN=!1,this.right_isNaN=!1,this.left_t=null,this.right_t=null,this.t_values=[],this.x_values=[],this.y_values=[],this.len=0},findComponents:function(u,n,d,C){var I,f,y,B,_,Z=[],M,V=0,T=0,H=0,F=!1,O=!1;for(y=(d-n)/C,Z[V]=new this.Component,M=Z[V],I=0,f=n;I<=C;I++,f+=y)B=u.X(f,O),_=u.Y(f,O),isNaN(B)||isNaN(_)?(H++,H>1&&F&&(M.right_isNaN=!0,M.right_t=f-y,M.len=T,F=!1,V++,Z[V]=new this.Component,M=Z[V],H=0)):(F||(F=!0,T=0,H>0&&(M.left_t=f-y,M.left_isNaN=!0)),H=0,M.t_values[T]=f,M.x_values[T]=B,M.y_values[T]=_,T++),I===0&&(O=!0);return F?M.len=T:Z.pop(),Z},getPointType:function(u,n,d,C,I,f,y){var B=I[0],_=f[0],Z=C.length,M={idx:n,t:d,x:B[n],y:_[n],type:"other"};return n<5?(M.type="borderleft",M.idx=0,M.t=C[0],M.x=B[0],M.y=_[0],M):(n>y-6&&(M.type="borderright",M.idx=Z-1,M.t=C[Z-1],M.x=B[Z-1],M.y=_[Z-1]),M)},newtonApprox:function(u,n,d,C,I){var f,y=0;for(f=C;f>0;f--)y=(y+I[f][u])*(n-(f-1)*d)/f;return y+I[0][u]},thiele:function(u,n,d,C,I){var f,y=0;for(f=I;f>1;f--)y=(u-d[C+f])/(n[f][C+1]-n[f-2][C+1]+y);return n[0][C+1]+(u-d[C+1])/(n[1][C+1]+y)},differenceMethodExperiments:function(u,n){var d,C,I,f,y=u.t_values,B=u.x_values,_=u.y_values,Z=[],M=[],V=[],T=[],H=[],F=[],O=[],$=[],U,ee,Q=0,ie,ne,le,ae,ce,ge=[];for(U=y[1]-y[0],H.push([]),F.push([]),O.push([]),$.push([]),I=_.length,d=0;d<I;d++)H[0][d]=B[d],F[0][d]=_[d],O[0][d]=B[d],$[0][d]=_[d];for(H.push([]),F.push([]),O.push([]),$.push([]),ee=U,I=_.length-1,d=0;d<I;d++)Z[d]=B[d+1]-B[d],M[d]=_[d+1]-_[d],V[d]=Z[d],T[d]=M[d],H[1][d]=Z[d],F[1][d]=M[d],O[1][d]=ee/Z[d],$[1][d]=ee/M[d];for(I--,f=Math.min(8,_.length-1),C=1;C<f;C++){for(H.push([]),F.push([]),O.push([]),$.push([]),ee*=U,d=0;d<I;d++)Z[d]=Z[d+1]-Z[d],M[d]=M[d+1]-M[d],H[C+1][d]=Z[d],F[C+1][d]=M[d],O[C+1][d]=ee/(O[C][d+1]-O[C][d])+O[C-1][d+1],$[C+1][d]=ee/($[C][d+1]-$[C][d])+$[C-1][d+1];if(ce=this._criticalPoints(M,I,C),ce===!1){console.log("Polynomial of degree",C),ce=[];break}if(ce.length>0&&(Q++,Q>1&&C%2===0))break;I--}for(d=0;d<ce.length;d++){for(ne=-1/0,le=0;le<ce[d].length;le++)ae=Math.abs(ce[d][le].v),ae>ne&&(ne=ae,ie=le);ie=Math.floor(ce[d][ie].i+C/2),ge.push(this.getPointType(n,ie,y,B,_,V,T,I+1))}return[ge,H,F,O,$]},getCenterOfCriticalInterval:function(u,n,d){var C,I,f,y,B=0,_=0,Z=d[1]-d[0],M,V=[];for(C=-1/0,V=[],I=0;I<u.length;I++)y=Math.abs(u[I].v),y>C?(V=[I],C=y,f=I):C===y&&V.push(I);if(V.length>0&&(M=V.reduce(function(T,H){return T+H},0)/V.length,f=Math.floor(M),M+=u[0].i),C<1/0){for(I=0;I<u.length;I++)B+=Math.abs(u[I].v)*u[I].i,_+=Math.abs(u[I].v);M=B/_}return M+=n/2,[u[f].i+n/2,M,d[Math.floor(M)]+Z*(M-Math.floor(M))]},differenceMethod:function(u,n){var d,C,I,f,y=u.t_values,B=u.x_values,_=u.y_values,Z=[],M=[],V=0,T=-1,H=-1,F,O,$,U,ee,Q=[],ie,ne=[];for(I=_.length,Z.push(new Float64Array(B)),M.push(new Float64Array(_)),I--,f=Math.min(12,I),C=0;C<f&&(Z.push(new Float64Array(I)),M.push(new Float64Array(I)),Z[C+1]=Z[C].map(function(le,ae,ce){return ce[ae+1]-le}),M[C+1]=M[C].map(function(le,ae,ce){return ce[ae+1]-le}),U=this._criticalInterval(M[C+1],I,C),U.smooth===!0&&(H=C,Q=[]),$=this._criticalInterval(Z[C+1],I,C),T===-1&&$.smooth===!0&&(T=C),!(H>=0));C++){if(U.groups.length>0&&(V++,V>2&&(C+1)%2===0)){Q=U.groups,ie=U.types;break}I--}for(d=0;d<Q.length;d++)ie[d]!=="interval"&&(O=this.getCenterOfCriticalInterval(Q[d],C+1,y),F=U[0],F=Math.floor(O[1]),ee=O[2],ne.push(this.getPointType(n,F,ee,y,Z,M,I+1)));return[ne,Z,M,T,H]},_insertPoint_v4:function(u,n,d,C){var I,f=null,y,B,_=.8;u.points.length>0&&(f=u.points[u.points.length-1].scrCoords),I=new Coords(Const.COORDS_BY_USER,n,u.board),!(f!==null&&(y=I.scrCoords[1]-f[1],B=I.scrCoords[2]-f[2],y*y+B*B<_*_))&&(I._t=d,u.points.push(I))},getInterval:function(u,n,d){var C,I;return Interval.disable(),C=Interval.Interval(n,d),u.board.mathLib=Interval,u.board.mathLibJXG=Interval,I=u.Y(C,!0),u.board.mathLib=Math,u.board.mathLibJXG=JXG$1.Math,I},sign:function(u){return u<0?-1:u>0?1:0},handleBorder:function(u,n,d,C,I){var f=d.idx,y,B,_,Z=32,M,V,T,H,F,O,$,U,ee;if(ee=n.t_values[1]-n.t_values[0],d.type==="borderleft"?(y=n.left_isNaN?n.left_t:d.t-ee,B=y,_=B+ee):d.type==="borderright"?(y=n.right_isNaN?n.right_t:d.t+ee,_=y,B=_-ee):console.log("No bordercase!!!"),$=this.findComponents(u,B,_,Z),$.length!==0){for(d.type==="borderleft"&&(B=$[0].left_t,_=$[0].t_values[0],ee=$[0].t_values[1]-$[0].t_values[0],B=B===null?_-ee:B,y=B,M=this.getInterval(u,B,_),JXG$1.isObject(M)&&(H=M.lo,F=M.hi,V=u.X(y,!0),T=I[1][f]<0?F:H,this._insertPoint_v4(u,[1,V,T],y))),U=$[0].t_values.length,O=0;O<U;O++)y=$[0].t_values[O],V=$[0].x_values[O],T=$[0].y_values[O],this._insertPoint_v4(u,[1,V,T],y);d.type==="borderright"&&(B=$[0].t_values[U-1],_=$[0].right_t,ee=$[0].t_values[1]-$[0].t_values[0],_=_===null?B+ee:_,y=_,M=this.getInterval(u,B,_),JXG$1.isObject(M)&&(H=M.lo,F=M.hi,V=u.X(y,!0),T=I[1][f]>0?F:H,this._insertPoint_v4(u,[1,V,T],y)))}},_seconditeration_v4:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T,H,F,O,$,U;for(y=n.t_values[d.idx-2],B=n.t_values[d.idx+2],Z=this.findComponents(u,y,B,64),V=0;V<Z.length;V++){for(M=Z[V],_=this.differenceMethod(M,u),T=_[0],F=_[1],O=_[2],$=0,H=0;H<=T.length;H++){for(H===T.length?U=M.len:U=T[H].idx,f=$;f<U;f++)!isNaN(M.x_values[f])&&!isNaN(M.y_values[f])&&this._insertPoint_v4(u,[1,M.x_values[f],M.y_values[f]],M.t_values[f]);H<T.length&&(this.handleSingularity(u,M,T[H],F,O),$=T[H].idx+1)}U=M.len,V<Z.length-1&&this._insertPoint_v4(u,[1,NaN,NaN],M.right_t)}return this},_recurse_v4:function(u,n,d,C,I,f,y,B){var _=2,Z=(n+d)*.5,M=u.X(Z,!0),V=u.Y(Z,!0),T,H;if(B===0){this._insertPoint_v4(u,[1,NaN,NaN],Z);return}T=(M-C)*u.board.unitX,H=(V-I)*u.board.unitY,Mat.hypot(T,H)>_?this._recurse_v4(u,n,Z,C,I,M,V,B-1):this._insertPoint_v4(u,[1,M,V],Z),T=(M-f)*u.board.unitX,H=(V-y)*u.board.unitY,Mat.hypot(T,H)>_?this._recurse_v4(u,Z,d,M,V,f,y,B-1):this._insertPoint_v4(u,[1,M,V],Z)},handleSingularity:function(u,n,d,C,I){var f=d.idx,y,B,_,Z,M,V,T,H,F,O,$,U=100,ee=5,Q=3;y=d.t,console.log("HandleSingularity at t =",y),B=n.t_values[f-ee],_=n.t_values[f+ee],Z=this.getInterval(u,B,_),JXG$1.isObject(Z)?(H=Z.lo,F=Z.hi):I[0][f-1]<I[0][f+1]?(H=I[0][f-1],F=I[0][f+1]):(H=I[0][f+1],F=I[0][f-1]),T=u.X(y,!0),O=(I[0][f-Q]-I[0][f-ee])/(n.t_values[f-Q]-n.t_values[f-ee]),$=(I[0][f+Q]-I[0][f+ee])/(n.t_values[f+Q]-n.t_values[f+ee]),console.log(":::",O,$),O<-100?(this._insertPoint_v4(u,[1,T,H],y,!0),$<=U&&this._insertPoint_v4(u,[1,NaN,NaN],y)):O>U?(this._insertPoint_v4(u,[1,T,F],y),$>=-100&&this._insertPoint_v4(u,[1,NaN,NaN],y)):(H===-1/0&&(this._insertPoint_v4(u,[1,T,H],y,!0),this._insertPoint_v4(u,[1,NaN,NaN],y)),F===1/0&&(this._insertPoint_v4(u,[1,NaN,NaN],y),this._insertPoint_v4(u,[1,T,F],y,!0)),d.t<n.t_values[f]?(M=f-1,V=f):(M=f,V=f+1),B=n.t_values[M],_=n.t_values[V],this._recurse_v4(u,B,_,C[0][M],I[0][M],C[0][V],I[0][V],10)),$<-100?this._insertPoint_v4(u,[1,T,F],y):$>U&&this._insertPoint_v4(u,[1,T,H],y)},steps:1021,criticalThreshold:1e3,plot_v4:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q=(d-n)/C,ie=function(ae){return u.Y(ae,!0)},ne=function(ae){return-u.Y(ae,!0)},le=Q*.5;for(y=this.findComponents(u,n,d,C),B=0;B<y.length;B++){for(_=y[B],T=this.differenceMethod(_,u),Z=T[0],H=T[1],F=T[2],(Z.length===0||Z[0].type!=="borderleft")&&Z.unshift({idx:0,t:_.t_values[0],x:_.x_values[0],y:_.y_values[0],type:"borderleft"}),Z[Z.length-1].type!=="borderright"&&(f=_.t_values.length,Z.push({idx:f-1,t:_.t_values[f-1],x:_.x_values[f-1],y:_.y_values[f-1],type:"borderright"})),V=0,M=0;M<=Z.length;M++){for(M===Z.length?f=_.len:f=Z[M].idx-1,I=V;I<f-2;I++)this._insertPoint_v4(u,[1,_.x_values[I],_.y_values[I]],_.t_values[I]),I>=V+3&&I<f-3&&F.length>3&&Math.abs(F[2][I])>.2*Math.abs(F[0][I])&&(O=_.t_values[I],le=Q*.25,ee=this.getInterval(u,O,O+Q),JXG$1.isObject(ee)?F[2][I]>0?this._insertPoint_v4(u,[1,O+le,ee.lo],O+le):this._insertPoint_v4(u,[1,O+Q-le,ee.hi],O+Q-le):($=Numerics.fminbr(ie,[O,O+Q]),U=Numerics.fminbr(ne,[O,O+Q]),$<U?(this._insertPoint_v4(u,[1,u.X($,!0),u.Y($,!0)],$),this._insertPoint_v4(u,[1,u.X(U,!0),u.Y(U,!0)],U)):(this._insertPoint_v4(u,[1,u.X(U,!0),u.Y(U,!0)],U),this._insertPoint_v4(u,[1,u.X($,!0),u.Y($,!0)],$))));M<Z.length&&(I=Z[M].idx,Z[M].type==="borderleft"||Z[M].type==="borderright"?this.handleBorder(u,_,Z[M],H,F):this._seconditeration_v4(u,_,Z[M],H,F),V=Z[M].idx+1+1)}f=_.len,B<y.length-1&&this._insertPoint_v4(u,[1,NaN,NaN],_.right_t)}},updateParametricCurve_v4:function(u,n,d){var C,I,f,y;u.xterm==="x"?(y=u.board.getBoundingBox(),f=(y[2]-y[0])*.3,C=Math.max(n,y[0]-f),I=Math.min(d,y[2]+f)):(C=n,I=d),u.points=[],this.plot_v4(u,C,I,this.steps),u.numberPoints=u.points.length},updateParametricCurve:function(u,n,d){return this.updateParametricCurve_v2(u,n,d)}};const Plot=Mat.Plot;Mat.ImplicitPlot=function(u,n,d,C,I){var f={resolution_out:5,resolution_in:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0,unitX:10,unitY:10};this.config=JXG$1.merge(f,n),this.f=d,this.dfx=null,this.dfy=null,JXG$1.isFunction(C)?this.dfx=C:this.dfx=function(y,B){var _=Mat.eps*Mat.eps;return(this.f(y+_,B)-this.f(y-_,B))*.5/_},JXG$1.isFunction(I)?this.dfy=I:this.dfy=function(y,B){var _=Mat.eps*Mat.eps;return(this.f(y,B+_)-this.f(y,B-_))*.5/_},this.bbox=u,this.qdt=new Quadtree(20,5,u),this.components=[]};JXG$1.extend(Mat.ImplicitPlot.prototype,{plot:function(){var u,n,d,C,I,f,y=[],B=[],_=[],Z=0,M,V=this,T=function($){return V.f(u,$)},H=function($){return-V.f(u,$)},F=function($){return V.f($,n)},O=function($){return-V.f($,n)};for(d=Math.min(this.bbox[0],this.bbox[2])-Mat.eps,C=Math.max(this.bbox[0],this.bbox[2]),I=Math.min(this.bbox[1],this.bbox[3])+Mat.eps,f=Math.max(this.bbox[1],this.bbox[3]),M=this.config.resolution_out/this.config.unitX,M*=1+Mat.eps,u=d;u<C;u+=M)_=this.searchLine(T,H,u,[I,f],"vertical",Z,y,B),_!==!1&&(y=_[0],B=_[1],Z=_[2]);for(M=this.config.resolution_out/this.config.unitY,M*=1+Mat.eps,n=I;n<f;n+=M)_=this.searchLine(F,O,n,[d,C],"horizontal",Z,y,B),_!==!1&&(y=_[0],B=_[1],Z=_[2]);return[y,B,Z]},searchLine:function(u,n,d,C,I,f,y,B){var _,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae=this.config.tol_u0,ce=C[0],ge=C[1];if(_=Numerics.fminbr(u,[ce,ge]),T=u(_),Z=Numerics.fminbr(n,[ce,ge]),H=u(Z),T<ae&&H>-ae){if(F=_,_=Math.min(F,Z),Z=Math.max(F,Z),M=Numerics.fzero(u,[_,Z]),V=u(M),Math.abs(V)>Math.max((H-T)*Mat.eps,.001))return!1;if(I==="vertical"?(U=[1,d,M],le=this.config.resolution_in/this.config.unitY):(U=[1,M,d],le=this.config.resolution_in/this.config.unitX),le*=1+Mat.eps,$=this.curveContainsPoint(U,y,B,le*2,this.config.qdt_box),!$){if(ie=this.traceComponent(U,1),ie.length>0){for(f>0&&(y.push(NaN),B.push(NaN)),ne=y.length,Q=ie[0].length,ee=1;ee<Q;ee++)this.qdt.insertItem({xlb:Math.min(ie[0][ee-1],ie[0][ee]),xub:Math.max(ie[0][ee-1],ie[0][ee]),ylb:Math.min(ie[1][ee-1],ie[1][ee]),yub:Math.max(ie[1][ee-1],ie[1][ee]),idx1:ne+ee-1,idx2:ne+ee,comp:f});f++,JXG$1.concat(y,ie[0]),JXG$1.concat(B,ie[1])}}return O=M-le*.01,O-ce>le&&(ie=this.searchLine(u,n,d,[ce,O],I,f,y,B),ie!==!1&&(y=ie[0],B=ie[1],f=ie[2])),O=M+le*.01,ge-O>le&&(ie=this.searchLine(u,n,d,[O,ge],I,f,y,B),ie!==!1&&(y=ie[0],B=ie[1],f=ie[2])),[y,B,f]}return!1},curveContainsPoint:function(u,n,d,C,I){var f,y,B,_,Z=u[1],M=u[2];for(B=this.qdt.find([Z-I,M+I,Z+I,M-I]),y=B.length,f=0;f<y;f++)if(_=Geometry.distPointSegment(u,[1,n[B[f].idx1],d[B[f].idx1]],[1,n[B[f].idx2],d[B[f].idx2]]),_<C)return!0;return!1},traceComponent:function(u){var n=[],d=[],C=[];return C=this.tracing(u,1),C.length===0||(n=C[0],d=C[1]),C[2]||(C=this.tracing(u,-1),C.length===0||(n=C[0].reverse().concat(n.slice(1)),d=C[1].reverse().concat(d.slice(1)))),n.length<6&&(n.push(n[n.length-1]),d.push(d[d.length-1])),[n,d]},tracing:function(u,n){var d=[],C=[],I=[],f,y,B,_,Z,M,V=0,T=0,H=!1,F,O,$,U,ee,Q,ie,ne,le,ae=!1,ce=!1,ge=this.config.kappa_0,he=this.config.delta_0,Ie=this.config.alpha_0,fe=this.config.h_initial,me=this.config.max_steps,Ge=n,Ze=[],ye=[],Ee=[],Ve,Ye,be,Be;if(d=u.slice(1),Ze.push(d[0]),ye.push(d[1]),f=this.tangent(d),f===!1)return[];this.dfx(d[0],d[1]),this.dfy(d[0],d[1]);do{if(f=this.tangent(d),f===!1){d=C.slice(),Ze.push(d[0]),ye.push(d[1]);break}if(Ze.length===1)B=f.slice();else if(Ze.length===2)Ee.push(Ze.length-1);else if(ae&&Ze.length>2&&!ce){if(U=Geometry.distPointSegment([1,d[0],d[1]],[1,Ze[0],ye[0]],[1,Ze[1],ye[1]]),U<this.config.loop_dist*fe&&Mat.innerProduct(f,B,2)>this.config.loop_dir){d=u.slice(1),Ze.push(d[0]),ye.push(d[1]),H=!0;break}if(this.config.loop_detection){for(Ve=Ze.length-1,Ye=Math.floor(Mat.log2(Ve)),be=0;be<=Ye&&(U=Geometry.distPointSegment([1,d[0],d[1]],[1,Ze[Ee[be]-1],ye[Ee[be]-1]],[1,Ze[Ee[be]],ye[Ee[be]]]),!(U<this.config.loop_dist*fe&&(y=this.tangent([Ze[Ee[be]],ye[Ee[be]]]),Mat.innerProduct(f,y,2)>this.config.loop_dir)));be++);if(be<=Ye){H=!0;break}for(Ye=1,Be=0,be=0;be<100&&(Ve+1)%Ye===0;be++)Ye*=2,Be++;Ee[Be]=Ve}}C[0]=d[0]+fe*Ge*f[0],C[1]=d[1]+fe*Ge*f[1],T=0;do _=[this.dfx(C[0],C[1]),this.dfy(C[0],C[1])],$=_[0]*_[0]+_[1]*_[1],Z=this.f(C[0],C[1])/$,I[0]=C[0]-_[0]*Z,I[1]=C[1]-_[1]*Z,T===0?F=Math.abs(Z)*Math.sqrt($):T===1&&(O=Math.abs(Z)*Math.sqrt($)),C[0]=I[0],C[1]=I[1],T++;while(T<20&&Math.abs(this.f(C[0],C[1]))>this.config.tol_newton);if(ie=F,T>1?Q=O/F:Q=0,y=this.tangent(C),M=Mat.innerProduct(f,y,2),M=Math.max(-1,Math.min(1,M)),ne=Math.acos(M),ce=!1,ee=Geometry.distance(d,C,2),ee<this.config.tol_progress){d=C.slice(),Ze.push(d[0]),ye.push(d[1]);break}else if(M<0&&!(fe>this.config.h_critical))if(ce=!0,this.isBifurcation(d,this.config.tol_cusp))Ge*=-1,ne=0;else{d=C.slice(),Ze.push(d[0]),ye.push(d[1]);break}if(!ce&&(le=Math.max(Math.sqrt(Q/ge),Math.sqrt(ie/he),ne/Ie),isNaN(le)&&(le=1),le=Math.max(Math.min(le,2),.5),fe/=le,fe=Math.min(this.config.h_max,fe),le>=2)){if(V++,V>=3*me)break;ae=!1;continue}d=C.slice(),Ze.push(d[0]),ye.push(d[1]),ae=!0,V++}while(V<me&&d[0]>=this.bbox[0]&&d[1]<=this.bbox[1]&&d[0]<=this.bbox[2]&&d[1]>=this.bbox[3]);return[Ze,ye,H]},isBifurcation:function(u,n){var d=Mat.eps*Mat.eps*100,C,I,f,y,B,_,Z,M,V,T;return C=u[0],I=u[1],f=.5*(this.dfx(C+d,I)-this.dfx(C-d,I))/d,y=.5*(this.dfx(C,I+d)-this.dfx(C,I-d))/d,B=.5*(this.dfy(C+d,I)-this.dfy(C-d,I))/d,_=.5*(this.dfy(C,I+d)-this.dfy(C,I-d))/d,Z=f+_,T=Z*Z-4*(f*_-y*B),M=.5*(Z+Math.sqrt(T)),V=.5*(Z-Math.sqrt(T)),Math.abs(M)>n&&Math.abs(V)>n},handleCriticalPoint:function(u,n,d,C){var I=Math.atan2(C*n[1],C*n[0]),f=function(Z){var M=u[0]+d*Math.cos(Z),V=u[1]+d*Math.sin(Z);return this.f(M,V)},y,B,_;return _=Numerics.root(f,I),y=u[0]+d*Math.cos(_),B=u[1]+d*Math.sin(_),[y,B]},updateA:function(u,n,d){var C=[d[0]-n[0],d[1]-n[1]],I=this.f(d[0],d[1])-this.f(n[0],n[1]),f,y;return y=C[0]*C[0]+C[1]*C[1],f=I-(u[0]*C[0]+u[1]*C[1]),f/=y,u[0]+=f*C[0],u[1]+=f*C[1],u},tangent_A:function(u){var n=[-u[1],u[0]],d=Mat.norm(n,2);return d<Mat.eps,[n[0]/d,n[1]/d]},tangent:function(u){var n=[-this.dfy(u[0],u[1]),this.dfx(u[0],u[1])],d=Mat.norm(n,2);return d<Mat.eps*Mat.eps?!1:[n[0]/d,n[1]/d]}});const ImplicitPlot=Mat.ImplicitPlot;Mat.Metapost={MP_ENDPOINT:0,MP_EXPLICIT:1,MP_GIVEN:2,MP_CURL:3,MP_OPEN:4,MP_END_CYCLE:5,UNITY:1,FRACTION_ONE:1,FRACTION_THREE:3,ONE_EIGHTY_DEG:Math.PI,THREE_SIXTY_DEG:2*Math.PI,EPS_SQ:1e-5*1e-5,make_choices:function(u){var n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$=!0;B=u[0];do{if(!B)break;y=B.next,B.rtype>this.MP_EXPLICIT&&(B.x-y.x)*(B.x-y.x)+(B.y-y.y)*(B.y-y.y)<this.EPS_SQ&&(B.rtype=this.MP_EXPLICIT,B.ltype===this.MP_OPEN&&(B.ltype=this.MP_CURL,B.set_left_curl(this.UNITY)),y.ltype=this.MP_EXPLICIT,y.rtype===this.MP_OPEN&&(y.rtype=this.MP_CURL,y.set_right_curl(this.UNITY)),B.rx=B.x,y.lx=B.x,B.ry=B.y,y.ly=B.y),B=y}while(B!==u[0]);for(d=u[0];$&&!(d.ltype!==this.MP_OPEN||d.rtype!==this.MP_OPEN);)if(d=d.next,d===u[0]){d.ltype=this.MP_END_CYCLE;break}for(B=d;$&&B;){if(y=B.next,B.rtype>=this.MP_GIVEN){for(;y.ltype===this.MP_OPEN&&y.rtype===this.MP_OPEN;)y=y.next;for(C=0,_=B,f=u.length,T=[],H=[],F=[],O=[null];$&&(M=_.next,T.push(M.x-_.x),H.push(M.y-_.y),F.push(this.mp_pyth_add(T[C],H[C])),C>0&&(V=H[C-1]/F[C-1],Z=T[C-1]/F[C-1],O.push(Math.atan2(H[C]*Z-T[C]*V,T[C]*Z+H[C]*V))),C++,_=M,_===y&&(f=C),!(C>=f&&_.ltype!==this.MP_END_CYCLE)););C===f?O.push(0):O.push(O[1]),y.ltype===this.MP_OPEN&&(I=y.rx-y.x,n=y.ry-y.y,I*I+n*n<this.EPS_SQ?(y.ltype=this.MP_CURL,y.set_left_curl(this.UNITY)):(y.ltype=this.MP_GIVEN,y.set_left_given(Math.atan2(n,I)))),B.rtype===this.MP_OPEN&&B.ltype===this.MP_EXPLICIT&&(I=B.x-B.lx,n=B.y-B.ly,I*I+n*n<this.EPS_SQ?(B.rtype=this.MP_CURL,B.set_right_curl(this.UNITY)):(B.rtype=this.MP_GIVEN,B.set_right_given(Math.atan2(n,I)))),this.mp_solve_choices(B,y,f,T,H,F,O)}else B.rtype===this.MP_ENDPOINT&&(B.rx=B.x,B.ry=B.y,y.lx=y.x,y.ly=y.y);if(B=y,B===d)break}},mp_solve_choices:function(u,n,d,C,I,f,y){var B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze,ye,Ee=!0;for(V=f.length+1,$=new Array(V),O=new Array(V),Z=new Array(V),ne=new Array(V),Ze=0;Ze<V;Ze++)ne[Ze]=Z[Ze]=O[Ze]=$[Ze]=0;for(H=0,F=u,ee=0;Ee;){if(Q=F.next,H===0)if(F.rtype===this.MP_GIVEN){if(Q.ltype===this.MP_GIVEN){B=Math.atan2(I[0],C[0]),ge=this.mp_n_sin_cos(u.right_given()-B),he=ge[0],Ie=ge[1],fe=this.mp_n_sin_cos(n.left_given()-B),me=fe[0],Ge=fe[1],this.mp_set_controls(u,n,C[0],I[0],Ie,he,-Ge,me);return}Z[0]=F.right_given()-Math.atan2(I[0],C[0]),Z[0]=this.reduce_angle(Z[0]),$[0]=0,O[0]=0}else if(F.rtype===this.MP_CURL){if(Q.ltype===this.MP_CURL){u.rtype=this.MP_EXPLICIT,n.ltype=this.MP_EXPLICIT,U=Math.abs(n.left_tension()),le=Math.abs(u.right_tension()),ie=this.UNITY/(3*le),u.rx=u.x+C[0]*ie,u.ry=u.y+I[0]*ie,ie=this.UNITY/(3*U),n.lx=n.x-C[0]*ie,n.ly=n.y-I[0]*ie;return}ce=F.right_curl(),U=Math.abs(Q.left_tension()),le=Math.abs(F.right_tension()),$[0]=this.mp_curl_ratio(ce,le,U),Z[0]=-y[1]*$[0],O[0]=0}else F.rtype===this.MP_OPEN&&($[0]=0,Z[0]=0,O[0]=this.FRACTION_ONE);else if(F.ltype===this.MP_END_CYCLE||F.ltype===this.MP_OPEN){if(B=this.UNITY/(3*Math.abs(ee.right_tension())-this.UNITY),ae=f[H]*(this.FRACTION_THREE-this.UNITY/Math.abs(ee.right_tension())),M=this.UNITY/(3*Math.abs(Q.left_tension())-this.UNITY),T=f[H-1]*(this.FRACTION_THREE-this.UNITY/Math.abs(Q.left_tension())),ce=this.FRACTION_ONE-$[H-1]*B,ae=ae*ce,U=Math.abs(F.left_tension()),le=Math.abs(F.right_tension()),U<le?ae*=Math.pow(U/le,2):U>le&&(T*=Math.pow(le/U,2)),ie=T/(T+ae),$[H]=ie*M,_=-y[H+1]*$[H],ee.rtype===this.MP_CURL?(O[H]=0,Z[H]=_-y[1]*(this.FRACTION_ONE-ie)):(ie=(this.FRACTION_ONE-ie)/ce,_=_-y[H]*ie,ie=ie*B,Z[H]=_-Z[H-1]*ie,O[H]=-O[H-1]*ie),F.ltype===this.MP_END_CYCLE){for(B=0,M=this.FRACTION_ONE;Ee&&(H-=1,H===0&&(H=d),B=Z[H]-B*$[H],M=O[H]-M*$[H],H!==d););for(B=B/(this.FRACTION_ONE-M),ne[d]=B,Z[0]=B,ye=1;ye<d;ye++)Z[ye]=Z[ye]+B*O[ye];break}}else{if(F.ltype===this.MP_CURL){ce=F.left_curl(),U=Math.abs(F.left_tension()),le=Math.abs(ee.right_tension()),ie=this.mp_curl_ratio(ce,U,le),ne[d]=-(Z[d-1]*ie)/(this.FRACTION_ONE-ie*$[d-1]);break}if(F.ltype===this.MP_GIVEN){ne[d]=F.left_given()-Math.atan2(I[d-1],C[d-1]),ne[d]=this.reduce_angle(ne[d]);break}}ee=F,F=Q,H+=1}for(H=d-1;H>-1;H--)ne[H]=Z[H]-ne[H+1]*$[H];for(F=u,H=0;Ee&&(Q=F.next,ge=this.mp_n_sin_cos(ne[H]),he=ge[0],Ie=ge[1],fe=this.mp_n_sin_cos(-y[H+1]-ne[H+1]),me=fe[0],Ge=fe[1],this.mp_set_controls(F,Q,C[H],I[H],Ie,he,Ge,me),H++,F=Q,H!==d););},mp_n_sin_cos:function(u){return[Math.cos(u),Math.sin(u)]},mp_set_controls:function(u,n,d,C,I,f,y,B){var _,Z,M,V,T;M=Math.abs(n.left_tension()),_=Math.abs(u.right_tension()),T=this.mp_velocity(I,f,y,B,_),Z=this.mp_velocity(y,B,I,f,M),(u.right_tension()<0||n.left_tension()<0)&&(I>=0&&y>=0||I<=0&&y<=0)&&(V=Math.abs(I)*B+Math.abs(y)*f,V>0&&(V*=1.00024414062,u.right_tension()<0&&this.mp_ab_vs_cd(Math.abs(y),this.FRACTION_ONE,T,V)<0&&(T=Math.abs(y)/V),n.left_tension()<0&&this.mp_ab_vs_cd(Math.abs(I),this.FRACTION_ONE,Z,V)<0&&(Z=Math.abs(I)/V))),u.rx=u.x+(d*f-C*I)*T,u.ry=u.y+(C*f+d*I)*T,n.lx=n.x-(d*B+C*y)*Z,n.ly=n.y-(C*B-d*y)*Z,u.rtype=this.MP_EXPLICIT,n.ltype=this.MP_EXPLICIT},mp_pyth_add:function(u,n){return Mat.hypot(u,n)},mp_curl_ratio:function(u,n,d){var C=1/n,I=1/d;return Math.min(4,((3-C)*C*C*u+I*I*I)/(C*C*C*u+(3-I)*I*I))},mp_ab_vs_cd:function(u,n,d,C){return u*n===d*C?0:u*n>d*C?1:-1},mp_velocity:function(u,n,d,C,I){return Math.min(4,(2+Math.sqrt(2)*(u-d/16)*(d-u/16)*(n-C))/(1.5*I*(2+(Math.sqrt(5)-1)*n+(3-Math.sqrt(5))*C)))},reduce_angle:function(u){return Math.abs(u)>this.ONE_EIGHTY_DEG&&(u>0?u-=this.THREE_SIXTY_DEG:u+=this.THREE_SIXTY_DEG),u},makeknots:function(u,n){var d,C,I=[];for(C=u.length,d=0;d<C;d++)I.push({x:u[d][0],y:u[d][1],ltype:this.MP_OPEN,rtype:this.MP_OPEN,lx:!1,rx:!1,ly:n,ry:n,left_curl:function(){return this.lx||0},right_curl:function(){return this.rx||0},left_tension:function(){return this.ly||1},right_tension:function(){return this.ry||1},set_right_curl:function(f){this.rx=f||0},set_left_curl:function(f){this.lx=f||0}});for(C=I.length,d=0;d<C;d++)I[d].next=I[d+1]||I[d],I[d].set_right_given=I[d].set_right_curl,I[d].set_left_given=I[d].set_left_curl,I[d].right_given=I[d].right_curl,I[d].left_given=I[d].left_curl;return I[C-1].next=I[0],I},curve:function(u,n){var d,C,I,f,y,B,_=!1,Z=[],M=[];n=n||{tension:1,direction:{},curl:{},isClosed:!1},y=1,n.hasOwnProperty("tension")&&(y=JXG$1.evaluate(n.tension)),d=this.makeknots(u,y),C=d.length,JXG$1.exists(n.isClosed)&&JXG$1.evaluate(n.isClosed)&&(_=!0),_||(d[0].ltype=this.MP_ENDPOINT,d[0].rtype=this.MP_CURL,d[C-1].rtype=this.MP_ENDPOINT,d[C-1].ltype=this.MP_CURL);for(f in n)if(n.hasOwnProperty(f)){if(I=parseInt(f,10),isNaN(I)||I<0||I>=C)continue;if(B=n[I],JXG$1.exists(B.type))switch(B.type){case"curl":y=JXG$1.evaluate(B.curl),I===0?(d[I].rtype=this.MP_CURL,d[I].set_right_curl(y)):I===C-1?(d[I].ltype=this.MP_CURL,d[I].set_left_curl(y)):(d[I].ltype=this.MP_CURL,d[I].rtype=this.MP_CURL,d[I].lx=y,d[I].rx=y);break}JXG$1.exists(B.direction)&&(y=JXG$1.evaluate(B.direction),JXG$1.isArray(y)?(y[0]!==!1&&(d[I].lx=y[0]*Math.PI/180,d[I].ltype=this.MP_GIVEN),y[1]!==!1&&(d[I].rx=y[1]*Math.PI/180,d[I].rtype=this.MP_GIVEN)):(d[I].lx=y*Math.PI/180,d[I].rx=y*Math.PI/180,d[I].ltype=d[I].rtype=this.MP_GIVEN)),JXG$1.exists(B.tension)&&(y=JXG$1.evaluate(B.tension),JXG$1.isArray(y)?(y[0]!==!1&&(d[I].ly=JXG$1.evaluate(y[0])),y[1]!==!1&&(d[I].ry=JXG$1.evaluate(y[1]))):(d[I].ly=y,d[I].ry=y))}for(this.make_choices(d),I=0;I<C-1;I++)Z.push(d[I].x),Z.push(d[I].rx),Z.push(d[I+1].lx),M.push(d[I].y),M.push(d[I].ry),M.push(d[I+1].ly);return Z.push(d[C-1].x),M.push(d[C-1].y),_&&(Z.push(d[C-1].rx),M.push(d[C-1].ry),Z.push(d[0].lx),M.push(d[0].ly),Z.push(d[0].x),M.push(d[0].y)),[Z,M]}};const Metapost=Mat.Metapost;Mat.Clip={_isSeparator:function(u){return isNaN(u.coords.usrCoords[1])&&isNaN(u.coords.usrCoords[2])},makeDoublyLinkedList:function(u){var n,d=null,C=[],I=u.length;if(I>0)for(n=0;n<I;n++){if(this._isSeparator(u[n])){u[n]._next=u[(n+1)%I],u[n]._prev=u[(I+n-1)%I];continue}d===null&&(d=n,C.push(d)),this._isSeparator(u[(n+1)%I])||n===I-1?(u[n]._next=u[d],u[d]._prev=u[n],u[n]._end=!0,d=null):(u[n]._next=u[(n+1)%I],u[d]._prev=u[n]),this._isSeparator(u[(I+n-1)%I])||(u[n]._prev=u[(I+n-1)%I])}return C},Vertex:function(u,n,d,C,I,f){this.pos=n,this.intersection=!0,this.coords=u,this.elementClass=Const.OBJECT_CLASS_POINT,this.data={alpha:d,path:C,pathname:I,done:!1,type:f,idx:0},this.neighbour=null,this.entry_exit=!1},_addToList:function(u,n,d){var C=u.length,I=Mat.eps*Mat.eps;C>0&&Math.abs(u[C-1].coords.usrCoords[0]-n.usrCoords[0])<I&&Math.abs(u[C-1].coords.usrCoords[1]-n.usrCoords[1])<I&&Math.abs(u[C-1].coords.usrCoords[2]-n.usrCoords[2])<I||u.push({pos:d,intersection:!1,coords:n,elementClass:Const.OBJECT_CLASS_POINT})},sortIntersections:function(u){var n,d,C,I,f,y,B=[],_=u.length;for(n=0;n<_;n++)if(u[n].sort(function(Z,M){return Z.data.alpha>M.data.alpha?1:-1}),u[n].length>0){for(f=u[n].length-1,C=u[n][0],I=C.data.path[C.pos],y=I._next,n===_-1&&(I._end=!1),C.data.alpha===0&&C.data.type==="T"?(I.intersection=!0,I.data=C.data,I.neighbour=C.neighbour,I.neighbour.neighbour=I,I.entry_exit=!1,u[n][0]=I):(C._prev=I,C._prev._next=C),d=1;d<=f;d++)C=u[n][d],C._prev=u[n][d-1],C._prev._next=C;C=u[n][f],C._next=y,C._next._prev=C,n===_-1&&(C._end=!0),B=B.concat(u[n])}return B},_inbetween:function(u,n,d){var C,I=Mat.eps*Mat.eps,f=d[1]-n[1],y=d[2]-n[2],B=u[1]-n[1],_=u[2]-n[2];return f===0&&y===0&&B===0&&_===0?!0:(Math.abs(B)<I&&Math.abs(f)<I?C=_/y:C=B/f,Math.abs(C)<I&&(C=0),C)},_print_array:function(u){var n,d;for(n=0;n<u.length;n++)try{d="",u[n]._end&&(d=" end"),console.log(n,u[n].coords.usrCoords,u[n].data.type,"	","prev",u[n]._prev.coords.usrCoords,"next",u[n]._next.coords.usrCoords+d)}catch{console.log(n,u[n].coords.usrCoords)}},_print_list:function(u){for(var n=0,d;n<100&&(u.data?d=u.data.alpha:d="-",console.log("	",u.coords.usrCoords,`
		is:`,u.intersection,"end:",u._end,d,`
		-:`,u._prev.coords.usrCoords,`
		+:`,u._next.coords.usrCoords,`
		n:`,u.intersection?u.neighbour.coords.usrCoords:"-"),!u._end);)u=u._next,n++},_noOverlap:function(u,n,d,C){var I,f=Math.sqrt(Mat.eps),y,B,_,Z,M=!1;for(I=0;I<3;I++)if(y=Math.min(u[I],n[I]),B=Math.max(u[I],n[I]),_=Math.min(d[I],C[I]),Z=Math.max(d[I],C[I]),B<_-f||y>Z+f){M=!0;break}return M},findIntersections:function(u,n,d){var C=[],I=Mat.eps*100,f,y,B,_=u.length,Z=n.length,M,V,T,H,F,O,$,U,ee,Q,ie=[],ne=[],le=[],ae=[],ce=!1,ge=!1;for(y=0;y<Z;y++)ae.push([]);for(f=0;f<_;f++){if(le.push([]),this._isSeparator(u[f])||this._isSeparator(u[(f+1)%_])){ce=!0;continue}if(ce&&f===_-1)break;for(M=u[f].coords.usrCoords,V=u[(f+1)%_].coords.usrCoords,y=0;y<Z;y++){if(this._isSeparator(n[y])||this._isSeparator(n[(y+1)%Z])){ge=!0;continue}if(ge&&y===Z-1)break;if(T=n[y].coords.usrCoords,H=n[(y+1)%Z].coords.usrCoords,!this._noOverlap(M,V,T,H)&&(C=Geometry.meetSegmentSegment(M,V,T,H),F=Geometry.distance(M,V,3),O=Geometry.distance(T,H,3),C[1]*F>-I&&C[1]<1-I/F&&C[2]*O>-I&&C[2]<1-I/O||C[1]===1/0&&C[2]===1/0&&Mat.norm(C[0],3)<I)){if(B=new Coords(Const.COORDS_BY_USER,C[0],d),U="X",Math.abs(C[1])*F<I||Math.abs(C[2])*O<I)U="T",Math.abs(C[1])*F<I&&(C[1]=0),Math.abs(C[2])*O<I&&(C[2]=0),C[1]===0?B=new Coords(Const.COORDS_BY_USER,M,d):B=new Coords(Const.COORDS_BY_USER,T,d);else if(C[1]===1/0&&C[2]===1/0&&Mat.norm(C[0],3)<I){$=this._inbetween(M,T,H),$>=0&&$<1&&(U="T",B=new Coords(Const.COORDS_BY_USER,M,d),C[1]=0,C[2]=$,ee=new this.Vertex(B,f,C[1],u,"S",U),Q=new this.Vertex(B,y,C[2],n,"C",U),ee.neighbour=Q,Q.neighbour=ee,le[f].push(ee),ae[y].push(Q)),$=this._inbetween(T,M,V),Geometry.distance(M,T,3)>I&&$>=0&&$<1&&(U="T",B=new Coords(Const.COORDS_BY_USER,T,d),C[1]=$,C[2]=0,ee=new this.Vertex(B,f,C[1],u,"S",U),Q=new this.Vertex(B,y,C[2],n,"C",U),ee.neighbour=Q,Q.neighbour=ee,le[f].push(ee),ae[y].push(Q));continue}ee=new this.Vertex(B,f,C[1],u,"S",U),Q=new this.Vertex(B,y,C[2],n,"C",U),ee.neighbour=Q,Q.neighbour=ee,le[f].push(ee),ae[y].push(Q)}}}for(ie=this.sortIntersections(le),f=0;f<ie.length;f++)ie[f].data.idx=f,ie[f].neighbour.data.idx=f;return ne=this.sortIntersections(ae),[ie,ne]},_getPosition:function(u,n,d,C){var I=Geometry.det3p(u,n,d),f=Geometry.det3p(u,d,C),y=Geometry.det3p(n,d,C);return y>=0?I>=0&&f>=0?"left":"right":I>=0||f>=0?"left":"right"},_classifyDegenerateIntersections:function(u){var n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O=!0;for(Z=Geometry.det3p,B=0,u._tours=0;O;){if(u.intersection&&u.data.type==="T"&&(n=u._next.coords.usrCoords,d=u._prev.coords.usrCoords,Geometry.distance(u.coords.usrCoords,n,3)<Mat.eps&&(n=u._next._next.coords.usrCoords),Geometry.distance(u.coords.usrCoords,d,3)<Mat.eps&&(d=u._prev._prev.coords.usrCoords),f=u.neighbour,I=f._prev.coords.usrCoords,C=f._next.coords.usrCoords,Geometry.distance(f.coords.usrCoords,C,3)<Mat.eps&&(C=f._next._next.coords.usrCoords),Geometry.distance(f.coords.usrCoords,I,3)<Mat.eps&&(I=f._prev._prev.coords.usrCoords),V=Z(u.coords.usrCoords,d,I),T=Z(u.coords.usrCoords,n,C),H=Z(u.coords.usrCoords,d,C),F=Z(u.coords.usrCoords,n,I),V===0&&T===0&&H===0&&F===0&&(u.coords.usrCoords[1]*=1+Math.random()*Mat.eps,u.coords.usrCoords[2]*=1+Math.random()*Mat.eps,f.coords.usrCoords[1]=u.coords.usrCoords[1],f.coords.usrCoords[2]=u.coords.usrCoords[2],V=Z(u.coords.usrCoords,d,I),T=Z(u.coords.usrCoords,n,C),H=Z(u.coords.usrCoords,d,C),F=Z(u.coords.usrCoords,n,I)),M=!1,V===0?Geometry.affineRatio(u.coords.usrCoords,d,I)<0&&(M=!0):T===0?Geometry.affineRatio(u.coords.usrCoords,n,C)<0&&(M=!0):H===0?Geometry.affineRatio(u.coords.usrCoords,d,C)>0&&(M=!0):F===0&&Geometry.affineRatio(u.coords.usrCoords,n,I)>0&&(M=!0),M&&(_=I,I=C,C=_,_=V,V=H,H=_,_=T,T=F,F=_),JXG$1.exists(u.delayedStatus)||(u.delayedStatus=[]),V===0&&T===0?u.delayedStatus=["on","on"]:V===0?(y=this._getPosition(n,I,f.coords.usrCoords,C),u.delayedStatus=["on",y]):T===0?(y=this._getPosition(d,I,f.coords.usrCoords,C),u.delayedStatus=[y,"on"]):u.delayedStatus.length===0&&(this._getPosition(d,I,f.coords.usrCoords,C)!==this._getPosition(n,I,f.coords.usrCoords,C)?u.data.type="X":u.data.type="B")),JXG$1.exists(u._tours)&&u._tours++,u._tours>3||u._end||B>1e3){B>1e3&&console.log("Clipping: _classifyDegenerateIntersections exit"),JXG$1.exists(u._tours)&&delete u._tours;break}u.intersection&&B++,u=u._next}},_handleIntersectionChains:function(u){for(var n=0,d="Null",C,I=!0,f=!1,y=!1;I&&(u.intersection===!0&&(u.data.type==="T"&&(u.delayedStatus[0]!=="on"&&u.delayedStatus[1]==="on"?(f=!0,C=u,d=u.delayedStatus[0]):f&&u.delayedStatus[0]==="on"&&u.delayedStatus[1]==="on"?u.data.type="B":f&&u.delayedStatus[0]==="on"&&u.delayedStatus[1]!=="on"&&(f=!1,d===u.delayedStatus[1]?(C.data.type="DB",u.data.type="DB"):(C.data.type="DX",u.data.type="DX"))),n++),u._end&&(y=!0),!(y&&!f));){if(n>1e3){console.log("Warning: _handleIntersectionChains: intersection chain reached maximum numbers of iterations");break}u=u._next}},_handleFullyDegenerateCase:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee=[u,n];for(f=0;f<2;f++){for(C=ee[f],H=C.length,V=0,U=!0;V<H;V++)if(!C[V].intersection){U=!1;break}if(U)for(I=ee[(f+1)%2],F=I.length,V=0;V<H;V++){for(_=C[V].coords.usrCoords,Z=C[V]._next.coords.usrCoords,y=[(_[0]+Z[0])*.5,(_[1]+Z[1])*.5,(_[2]+Z[2])*.5],T=0,O=!1;T<F;T++)if(Math.abs(Geometry.det3p(I[T].coords.usrCoords,I[(T+1)%F].coords.usrCoords,y))<Mat.eps){O=!0;break}if(!O){B=new Coords(Const.COORDS_BY_USER,y,d),M={pos:V,intersection:!1,coords:B,elementClass:Const.OBJECT_CLASS_POINT},$=C[V]._next,C[V]._next=M,M._prev=C[V],M._next=$,$._prev=M,C[V]._end&&(C[V]._end=!1,M._end=!0);break}}}},_getStatus:function(u,n){for(var d;u.intersection&&!u._end;)u=u._next;return Geometry.windingNumber(u.coords.usrCoords,n)===0?d="entry":d="exit",[u,d]},markEntryExit:function(u,n,d){var C,I,f,y,B,_,Z,M=!0,V=null,T=0;for(_=d.length,B=0;B<_;B++)for(Z=d[B],this._classifyDegenerateIntersections(u[Z]),this._handleIntersectionChains(u[Z]),y=this._getStatus(u[Z],n),I=y[0],C=y[1],I._starter=!0,f=0,V=null,T=0;M&&(I.intersection===!0&&(I.data.type==="X"&&T===1&&(V.entry_exit=C,C==="exit"&&(V.data.type="X"),T=2),(I.data.type==="X"||I.data.type==="DB")&&(I.entry_exit=C,C=C==="entry"?"exit":"entry"),I.data.type==="DX"&&(T===0?(V=I,T=1):T===1?(I.entry_exit=C,V.entry_exit=C,C==="exit"?V.data.type="X":I.data.type="X",C=C==="entry"?"exit":"entry",V=null,T=0):T===2&&(I.entry_exit=C,I.data.type="X",C=C==="entry"?"exit":"entry",V=null,T=0))),I=I._next,!(JXG$1.exists(I._starter)||f>1e4));)f++},_stayOnPath:function(u,n){var d=!0;return u.intersection&&u.data.type!=="B"&&(d=n===u.entry_exit),d},_addVertex:function(u,n,d){return!isNaN(n.coords.usrCoords[1])&&!isNaN(n.coords.usrCoords[2])&&u.push(n),n.intersection&&n.data.done?(d&&console.log("Add last intersection point",n.coords.usrCoords,"on",n.data.pathname,n.entry_exit,n.data.type),!0):(n.intersection&&(n.data.done=!0,d&&console.log("Add intersection point",n.coords.usrCoords,"on",n.data.pathname,n.entry_exit,n.data.type)),!1)},tracing:function(u,n,d){for(var C,I,f,y,B=0,_=1e4,Z=0,M=[],V=!1,T=!1;Z<n.length&&B<_;){if(f=n[Z],f.data.done||f.data.type!=="X"){Z++;continue}M.length>0&&M.push([NaN,NaN]),y=f.data.idx,C=u,V=this._addVertex(M,f,T),I=f.entry_exit;do{if(V)break;if(d==="intersection"&&f.entry_exit==="entry"||d==="union"&&f.entry_exit==="exit"||d==="difference"&&C===u==(f.entry_exit==="exit")){do if(f=f._next,V=this._addVertex(M,f,T),V)break;while(this._stayOnPath(f,I));B++}else{do if(f=f._prev,V=this._addVertex(M,f,T),V)break;while(this._stayOnPath(f,I));B++}if(V)break;if(!f.neighbour)return console.log("Tracing: emergency break - no neighbour!!!!!!!!!!!!!!!!!",B),[[0],[0]];if(f=f.neighbour,f.data.done)break;f.data.done=!0,I=f.entry_exit,C=f.data.path}while(f.data.idx!==y&&B<_);B>=_&&console.log("Tracing: stopping an infinite loop!",B),Z++}return this._getCoordsArrays(M,!1)},isEmptyCase:function(u,n,d){return d==="intersection"&&(u.length===0||n.length===0)||d==="union"&&u.length===0&&n.length===0||d==="difference"&&u.length===0},_getCoordsArrays:function(u,n){var d=[],C=[],I,f=u.length;for(I=0;I<f;I++)u[I].coords?(d.push(u[I].coords.usrCoords[1]),C.push(u[I].coords.usrCoords[2])):(d.push(u[I][0]),C.push(u[I][1]));return n&&f>0&&(u[0].coords?(d.push(u[0].coords.usrCoords[1]),C.push(u[0].coords.usrCoords[2])):(d.push(u[0][0]),C.push(u[0][1]))),[d,C]},handleEmptyIntersection:function(u,n,d){var C,I,f=!1,y=[];if(u.length===0)return d==="union"?y=n:y=[],this._getCoordsArrays(y,!0);if(n.length===0)return d==="intersection"?y=[]:y=u,this._getCoordsArrays(y,!0);if(u.length>0)for(C=u[0];C.intersection&&(C=C._next,!C._end););if(n.length>0)for(I=n[0];I.intersection&&(I=I._next,!I._end););return Geometry.windingNumber(C.coords.usrCoords,n)===0?Geometry.windingNumber(I.coords.usrCoords,u)!==0?(d==="union"?(JXG$1.concat(y,u),y.push(u[0])):d==="difference"&&(JXG$1.concat(y,u),y.push(u[0]),Geometry.signedPolygon(u)*Geometry.signedPolygon(n)>0&&y.reverse(),y.push([NaN,NaN])),(d==="difference"||d==="intersection")&&(JXG$1.concat(y,n),y.push(n[0]),f=!1)):d==="difference"?(JXG$1.concat(y,u),f=!0):d==="union"&&(JXG$1.concat(y,u),y.push(u[0]),y.push([NaN,NaN]),JXG$1.concat(y,n),y.push(n[0])):d==="intersection"?(JXG$1.concat(y,u),f=!0):d==="union"&&(JXG$1.concat(y,n),y.push(n[0])),this._getCoordsArrays(y,f)},_countCrossingIntersections:function(u){var n,d=u.length,C=0;for(n=0;n<d;n++)u[n].data.type==="X"&&C++;return C},_getPath:function(u,n){var d,C,I,f,y,B,_,Z=[];if(u.elementClass===Const.OBJECT_CLASS_CURVE&&(u.type===Const.OBJECT_TYPE_ARC||u.type===Const.OBJECT_TYPE_SECTOR)){for(y=Geometry.rad(u.radiuspoint,u.center,u.anglepoint),_=Math.floor(y*180/Math.PI),I=u.Radius(),f=y/_,B=Math.atan2(u.radiuspoint.coords.usrCoords[2]-u.center.coords.usrCoords[2],u.radiuspoint.coords.usrCoords[1]-u.center.coords.usrCoords[1]),u.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(Z,u.center.coords,0),d=0;d<=_;d++)this._addToList(Z,new Coords(Const.COORDS_BY_USER,[u.center.coords.usrCoords[0],u.center.coords.usrCoords[1]+Math.cos(d*f+B)*I,u.center.coords.usrCoords[2]+Math.sin(d*f+B)*I],n),d+1);u.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(Z,u.center.coords,_+2)}else if(u.elementClass===Const.OBJECT_CLASS_CURVE&&JXG$1.exists(u.points))for(C=u.numberPoints,d=0;d<C;d++)this._addToList(Z,u.points[d],d);else if(u.type===Const.OBJECT_TYPE_POLYGON)for(d=0;d<u.vertices.length;d++)this._addToList(Z,u.vertices[d].coords,d);else if(u.elementClass===Const.OBJECT_CLASS_CIRCLE)for(_=359,I=u.Radius(),f=2*Math.PI/_,d=0;d<=_;d++)this._addToList(Z,new Coords(Const.COORDS_BY_USER,[u.center.coords.usrCoords[0],u.center.coords.usrCoords[1]+Math.cos(d*f)*I,u.center.coords.usrCoords[2]+Math.sin(d*f)*I],n),d);else if(JXG$1.isArray(u))for(C=u.length,d=0;d<C;d++)JXG$1.exists(u[d].coords)?this._addToList(Z,u[d].coords,d):JXG$1.isArray(u[d])?this._addToList(Z,new Coords(Const.COORDS_BY_USER,u[d],n),d):JXG$1.exists(u[d].usrCoords)&&this._addToList(Z,u[d],d);return Z},greinerHormann:function(u,n,d,C){var I,f=[],y=[],B=[],_,Z,M=[];return f=this._getPath(u,C),I=f.length,I>0&&Geometry.distance(f[0].coords.usrCoords,f[I-1].coords.usrCoords,3)<Mat.eps&&f.pop(),y=this._getPath(n,C),I=y.length,I>0&&Geometry.distance(y[0].coords.usrCoords,y[I-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&y.pop(),this.isEmptyCase(f,y,d)?[[],[]]:(_=this.makeDoublyLinkedList(f),Z=this.makeDoublyLinkedList(y),M=this.findIntersections(f,y,C),B=M[0],this._handleFullyDegenerateCase(f,y,C),this.markEntryExit(f,y,_),this.markEntryExit(y,f,Z),this._countCrossingIntersections(B)===0?this.handleEmptyIntersection(f,y,d):this.tracing(f,B,d))},union:function(u,n,d){return this.greinerHormann(u,n,"union",d)},intersection:function(u,n,d){return this.greinerHormann(u,n,"intersection",d)},difference:function(u,n,d){return this.greinerHormann(u,n,"difference",d)}};const Clip=Mat.Clip;Mat.Poly={};Mat.Poly.Ring=function(u){this.vars=u};JXG$1.extend(Mat.Poly.Ring.prototype,{});Mat.Poly.Monomial=function(u,n,d){var C;if(!JXG$1.exists(u))throw new Error("JSXGraph error: In JXG.Math.Poly.monomial missing parameter 'ring'.");for(JXG$1.isArray(d)||(d=[]),d=d.slice(0,u.vars.length),C=d.length;C<u.vars.length;C++)d.push(0);this.ring=u,this.coefficient=n||0,this.exponents=JXG$1.deepCopy(d)};JXG$1.extend(Mat.Poly.Monomial.prototype,{copy:function(){return new Mat.Poly.Monomial(this.ring,this.coefficient,this.exponents)},print:function(){var u=[],n;for(n=0;n<this.ring.vars.length;n++)u.push(this.ring.vars[n]+"^"+this.exponents[n]);return this.coefficient+"*"+u.join("*")}});Mat.Poly.Polynomial=function(u,n){var d=function(){},C;if(!JXG$1.exists(u))throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial missing parameter 'ring'.");JXG$1.exists(n)&&JXG$1.isString(n)?C=d():C=[],this.ring=u,this.monomials=C};JXG$1.extend(Mat.Poly.Polynomial.prototype,{findSignature:function(u){var n;for(n=0;n<this.monomials.length;n++)if(JXG$1.cmpArrays(this.monomials[n].exponents,u))return n;return-1},addSubMonomial:function(u,n){var d;d=this.findSignature(u.exponents),d>-1?this.monomials[d].coefficient+=n*u.coefficient:(u.coefficient*=n,this.monomials.push(u))},add:function(u){var n;if(JXG$1.exists(u)&&u.ring===this.ring)if(JXG$1.isArray(u.exponents))this.addSubMonomial(u,1);else for(n=0;n<u.monomials.length;n++)this.addSubMonomial(u.monomials[n],1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.add either summand is undefined or rings don't match.")},sub:function(u){var n;if(JXG$1.exists(u)&&u.ring===this.ring)if(JXG$1.isArray(u.exponents))this.addSubMonomial(u,-1);else for(n=0;n<u.monomials.length;n++)this.addSubMonomial(u.monomials[n],-1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.sub either summand is undefined or rings don't match.")},copy:function(){var u,n;for(n=new Mat.Poly.Polynomial(this.ring),u=0;u<this.monomials.length;u++)n.monomials.push(this.monomials[u].copy());return n},print:function(){var u=[],n;for(n=0;n<this.monomials.length;n++)u.push("("+this.monomials[n].print()+")");return u.join("+")}});Mat.Poly;JXG$1.Complex=function(u,n){this.isComplex=!0,u&&u.isComplex&&(n=u.imaginary,u=u.real),this.real=u||0,this.imaginary=n||0,this.absval=0,this.angle=0};JXG$1.extend(JXG$1.Complex.prototype,{toString:function(){return this.real+" + "+this.imaginary+"i"},add:function(u){return JXG$1.isNumber(u)?this.real+=u:(this.real+=u.real,this.imaginary+=u.imaginary),this},sub:function(u){return JXG$1.isNumber(u)?this.real-=u:(this.real-=u.real,this.imaginary-=u.imaginary),this},mult:function(u){var n,d;return JXG$1.isNumber(u)?(this.real*=u,this.imaginary*=u):(n=this.real,d=this.imaginary,this.real=n*u.real-d*u.imaginary,this.imaginary=n*u.imaginary+d*u.real),this},div:function(u){var n,d,C;if(JXG$1.isNumber(u)){if(Math.abs(u)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;this.real/=u,this.imaginary/=u}else{if(Math.abs(u.real)<Math.eps&&Math.abs(u.imaginary)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;n=u.real*u.real+u.imaginary*u.imaginary,C=this.real,d=this.imaginary,this.real=(C*u.real+d*u.imaginary)/n,this.imaginary=(d*u.real-C*u.imaginary)/n}return this},conj:function(){return this.imaginary*=-1,this}});JXG$1.C={};JXG$1.C.add=function(u,n){var d=new JXG$1.Complex(u);return d.add(n),d};JXG$1.C.sub=function(u,n){var d=new JXG$1.Complex(u);return d.sub(n),d};JXG$1.C.mult=function(u,n){var d=new JXG$1.Complex(u);return d.mult(n),d};JXG$1.C.div=function(u,n){var d=new JXG$1.Complex(u);return d.div(n),d};JXG$1.C.conj=function(u){var n=new JXG$1.Complex(u);return n.conj(),n};JXG$1.C.abs=function(u){var n=new JXG$1.Complex(u);return n.conj(),n.mult(u),Math.sqrt(n.real)};JXG$1.C.copy=function(u){return new JXG$1.Complex(u)};JXG$1.Complex.C=JXG$1.C;const Complex=JXG$1.Complex;var simpleColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},colorDefs=[{re:/^\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d.]{1,3})\s*\)\s*$/,example:["rgba(123, 234, 45, 0.5)","rgba(255,234,245,1.0)"],process:function(u){return[parseInt(u[1],10),parseInt(u[2],10),parseInt(u[3],10)]}},{re:/^\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1],10),parseInt(u[2],10),parseInt(u[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];JXG$1.rgbParser=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T=u,H;if(!JXG$1.exists(u))return[];if(JXG$1.exists(n)&&JXG$1.exists(d)&&(T=[u,n,d]),C=T,H=!1,JXG$1.isArray(C)){for(_=0;_<3;_++)H=H||/\./.test(T[_].toString());for(_=0;_<3;_++)H=H&&T[_]>=0&&T[_]<=1;return H?[Math.ceil(T[0]*255),Math.ceil(T[1]*255),Math.ceil(T[2]*255)]:T}for(typeof T=="string"&&(C=T),C.charAt(0)==="#"&&(C=C.slice(1,7)),C=C.replace(/ /g,"").toLowerCase(),C=simpleColors[C]||C,_=0;_<colorDefs.length;_++)f=colorDefs[_].re,y=colorDefs[_].process,B=f.exec(C),B&&(I=y(B),Z=I[0],M=I[1],V=I[2]);return isNaN(Z)||isNaN(M)||isNaN(V)?[]:(Z=Z<0||isNaN(Z)?0:Z>255?255:Z,M=M<0||isNaN(M)?0:M>255?255:M,V=V<0||isNaN(V)?0:V>255?255:V,[Z,M,V])};JXG$1.isColor=function(u){var n=new Option().style;return n.color=u,n.color!==""};JXG$1.rgb2css=function(u,n,d){var C;return C=JXG$1.rgbParser(u,n,d),"rgb("+C[0]+", "+C[1]+", "+C[2]+")"};JXG$1.rgb2hex=function(u,n,d){var C,I,f;return C=JXG$1.rgbParser(u,n,d),I=C[1],f=C[2],C=C[0],C=C.toString(16),I=I.toString(16),f=f.toString(16),C.length===1&&(C="0"+C),I.length===1&&(I="0"+I),f.length===1&&(f="0"+f),"#"+C+I+f};JXG$1.hex2rgb=function(u){return JXG$1.deprecated("JXG.hex2rgb()","JXG.rgb2css()"),JXG$1.rgb2css(u)};JXG$1.hsv2rgb=function(u,n,d){var C,I,f,y,B,_,Z,M,V;if(u=(u%360+360)%360,n===0)if(isNaN(u)||u<Mat.eps)C=d,I=d,f=d;else return"#ffffff";else switch(u>=360?_=0:_=u,_=_/60,B=Math.floor(_),y=_-B,Z=d*(1-n),M=d*(1-n*y),V=d*(1-n*(1-y)),B){case 0:C=d,I=V,f=Z;break;case 1:C=M,I=d,f=Z;break;case 2:C=Z,I=d,f=V;break;case 3:C=Z,I=M,f=d;break;case 4:C=V,I=Z,f=d;break;case 5:C=d,I=Z,f=M;break}return C=Math.round(C*255).toString(16),C=C.length===2?C:C.length===1?"0"+C:"00",I=Math.round(I*255).toString(16),I=I.length===2?I:I.length===1?"0"+I:"00",f=Math.round(f*255).toString(16),f=f.length===2?f:f.length===1?"0"+f:"00",["#",C,I,f].join("")};JXG$1.rgb2hsv=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O;return C=JXG$1.rgbParser(u,n,d),I=C[1],f=C[2],C=C[0],y=C/255,B=I/255,_=f/255,F=Math.max(C,I,f),O=Math.min(C,I,f),Z=F/255,M=O/255,H=Z,T=0,H>0&&(T=(H-M)/H),V=1/(Z-M),T>0&&(F===C?V=(B-_)*V:F===I?V=2+(_-y)*V:V=4+(y-B)*V),V*=60,V<0&&(V+=360),F===O&&(V=0),[V,T,H]};JXG$1.rgb2LMS=function(u,n,d){var C,I,f,y,B,_,Z,M=[[.05059983,.08585369,.0095242],[.01893033,.08925308,.01370054],[.00292202,.00975732,.07145979]];return C=JXG$1.rgbParser(u,n,d),I=C[1],f=C[2],C=C[0],C=Math.pow(C,.476190476),I=Math.pow(I,.476190476),f=Math.pow(f,.476190476),y=C*M[0][0]+I*M[0][1]+f*M[0][2],B=C*M[1][0]+I*M[1][1]+f*M[1][2],_=C*M[2][0]+I*M[2][1]+f*M[2][2],Z=[y,B,_],Z.l=y,Z.m=B,Z.s=_,Z};JXG$1.LMS2rgb=function(u,n,d){var C,I,f,y,B=[[30.830854,-29.832659,1.610474],[-6.481468,17.715578,-2.532642],[-.37569,-1.199062,14.273846]],_=function(Z){for(var M=127,V=64;V>0;){if(Math.pow(M,.476190476)>Z)M-=V;else{if(Math.pow(M+1,.476190476)>Z)return M;M+=V}V/=2}return M===254&&13.994955247<Z?255:M};return C=u*B[0][0]+n*B[0][1]+d*B[0][2],I=u*B[1][0]+n*B[1][1]+d*B[1][2],f=u*B[2][0]+n*B[2][1]+d*B[2][2],C=_(C),I=_(I),f=_(f),y=[C,I,f],y.r=C,y.g=I,y.b=f,y};JXG$1.rgba2rgbo=function(u){var n;return u.length===9&&u.charAt(0)==="#"?(n=parseInt(u.slice(7,9).toUpperCase(),16)/255,u=u.slice(0,7)):n=1,[u,n]};JXG$1.rgbo2rgba=function(u,n){var d;return u==="none"||u==="transparent"?u:(d=Math.round(n*255).toString(16),d.length===1&&(d="0"+d),JXG$1.rgb2hex(u)+d)};JXG$1.rgb2bw=function(u){var n,d,C,I="0123456789ABCDEF";return u==="none"||(C=JXG$1.rgbParser(u),n=Math.floor(.3*C[0]+.59*C[1]+.11*C[2]),d=I.charAt(n>>4&15)+I.charAt(n&15),u="#"+d+d+d),u};JXG$1.rgb2cb=function(u,n){var d,C,I,f,y,B,_,Z,M,V,T,H,F,O="0123456789ABCDEF";if(u==="none")return u;switch(y=JXG$1.rgb2LMS(u),C=y[0],I=y[1],f=y[2],n=n.toLowerCase(),n){case"protanopia":_=-.06150039994295001,Z=.08277001656812001,M=-.013200141220000003,V=.05858939668799999,T=-.07934519995360001,H=.013289415272000003,F=.6903216543277437,B=f/I,B<F?C=-(Z*I+M*f)/_:C=-(T*I+H*f)/V;break;case"tritanopia":_=-.00058973116217,Z=.007690316482,M=-.01011703519052,V=.025495080838999994,T=-.0422740347,H=.017005316784,F=.8349489908460004,B=I/C,B<F?f=-(_*C+Z*I)/M:f=-(V*C+T*I)/H;break;default:_=-.06150039994295001,Z=.08277001656812001,M=-.013200141220000003,V=.05858939668799999,T=-.07934519995360001,H=.013289415272000003,F=.5763833686400911,B=f/C,B<F?I=-(_*C+M*f)/Z:I=-(V*C+H*f)/T;break}return d=JXG$1.LMS2rgb(C,I,f),B=O.charAt(d[0]>>4&15)+O.charAt(d[0]&15),u="#"+B,B=O.charAt(d[1]>>4&15)+O.charAt(d[1]&15),u+=B,B=O.charAt(d[2]>>4&15)+O.charAt(d[2]&15),u+=B,u};JXG$1.shadeColor=function(u,n){var d=JXG$1.rgbParser(u),C=d[0],I=d[1],f=d[2];return C=parseInt(C+255*n),I=parseInt(I+255*n),f=parseInt(f+255*n),C=C>0?C:0,I=I>0?I:0,f=f>0?f:0,C=C<255?C:255,I=I<255?I:255,f=f<255?f:255,C=Math.round(C),I=Math.round(I),f=Math.round(f),JXG$1.rgb2hex([C,I,f])};JXG$1.lightenColor=function(u,n){return JXG$1.shadeColor(u,n)};JXG$1.darkenColor=function(u,n){return JXG$1.shadeColor(u,-1*n)};JXG$1.autoHighlight=function(u){var n=JXG$1.rgba2rgbo(u),d=n[0],C=n[1];return u.charAt(0)==="#"?(C<.3?C*=1.8:C*=.4,JXG$1.rgbo2rgba(d,C)):u};JXG$1.contrast=function(u,n,d,C){var I,f="#000000",y,B,_,Z;return n=n||"#000000",d=d||"#ffffff",C=C||7,I=JXG$1.rgbParser(u),y=JXG$1.rgbParser(f),B=.2126*Math.pow(I[0]/255,2.2)+.7152*Math.pow(I[1]/255,2.2)+.0722*Math.pow(I[2]/255,2.2),_=.2126*Math.pow(y[0]/255,2.2)+.7152*Math.pow(y[1]/255,2.2)+.0722*Math.pow(y[2]/255,2.2),B>_?Z=Math.floor((B+.05)/(_+.05)):Z=Math.floor((_+.05)/(B+.05)),Z=Z-1,Z>C?n:d};JXG$1.setClassicColors=function(){JXG$1.Options.elements.strokeColor="blue",JXG$1.Options.elements.fillColor="red",JXG$1.Options.hatch.strokeColor="blue",JXG$1.Options.angle.fillColor="#ff7f00",JXG$1.Options.angle.highlightFillColor="#ff7f00",JXG$1.Options.angle.strokeColor="#ff7f00",JXG$1.Options.angle.label.strokeColor="blue",JXG$1.Options.arc.strokeColor="blue",JXG$1.Options.circle.center.fillColor="red",JXG$1.Options.circle.center.strokeColor="blue",JXG$1.Options.circumcircle.strokeColor="blue",JXG$1.Options.circumcircle.center.fillColor="red",JXG$1.Options.circumcircle.center.strokeColor="blue",JXG$1.Options.circumcirclearc.strokeColor="blue",JXG$1.Options.circumcirclesector.strokeColor="blue",JXG$1.Options.circumcirclesector.fillColor="green",JXG$1.Options.circumcirclesector.highlightFillColor="green",JXG$1.Options.conic.strokeColor="blue",JXG$1.Options.curve.strokeColor="blue",JXG$1.Options.incircle.strokeColor="blue",JXG$1.Options.incircle.center.fillColor="red",JXG$1.Options.incircle.center.strokeColor="blue",JXG$1.Options.inequality.fillColor="red",JXG$1.Options.integral.fillColor="red",JXG$1.Options.integral.curveLeft.color="red",JXG$1.Options.integral.curveRight.color="red",JXG$1.Options.line.strokeColor="blue",JXG$1.Options.point.fillColor="red",JXG$1.Options.point.strokeColor="red",JXG$1.Options.polygon.fillColor="green",JXG$1.Options.polygon.highlightFillColor="green",JXG$1.Options.polygon.vertices.strokeColor="red",JXG$1.Options.polygon.vertices.fillColor="red",JXG$1.Options.regularpolygon.fillColor="green",JXG$1.Options.regularpolygon.highlightFillColor="green",JXG$1.Options.regularpolygon.vertices.strokeColor="red",JXG$1.Options.regularpolygon.vertices.fillColor="red",JXG$1.Options.riemannsum.fillColor="yellow",JXG$1.Options.sector.fillColor="green",JXG$1.Options.sector.highlightFillColor="green",JXG$1.Options.semicircle.center.fillColor="red",JXG$1.Options.semicircle.center.strokeColor="blue",JXG$1.Options.slopetriangle.fillColor="red",JXG$1.Options.slopetriangle.highlightFillColor="red",JXG$1.Options.turtle.arrow.strokeColor="blue"};JXG$1.extend(JXG$1,{paletteWong:{black:"#000000",orange:"#E69F00",skyblue:"#56B4E9",bluishgreen:"#009E73",yellow:"#F0E442",darkblue:"#0072B2",vermillion:"#D55E00",reddishpurple:"#CC79A7",blue:"#0072B2",red:"#D55E00",green:"#009E73",purple:"#CC79A7",white:"#ffffff"}});JXG$1.palette=JXG$1.paletteWong;JXG$1.Options={jc:{enabled:!0,compile:!0},board:{animationDelay:35,axis:!1,boundingBox:[-5,5,5,-5],browserPan:!1,clickDelay:600,dblClickSuppressClick:!1,defaultAxes:{x:{name:"x",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"middle",anchorY:"top",fontSize:12,offset:[0,-3]},tickEndings:[0,1],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}},y:{name:"y",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"right",anchorY:"middle",fontSize:12,offset:[-6,0]},tickEndings:[1,0],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}}},description:"",document:!1,drag:{enabled:!0},fullscreen:{symbol:'<svg height="1em" width="1em" version="1.1" viewBox="10 10 18 18"><path fill="#666" d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path><path fill="#666" d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path><path fill="#666" d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path><path fill="#666" d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',scale:.85,id:null},ignoreLabels:!0,intl:{enabled:!1},keepAspectRatio:!1,keyboard:{enabled:!0,dx:10,dy:10,panShift:!0,panCtrl:!1},logging:{enabled:!1},minimizeReflow:"none",maxBoundingBox:[-1/0,1/0,1/0,-1/0],maxFrameRate:40,maxNameLength:1,moveTarget:null,offsetX:0,offsetY:0,pan:{enabled:!0,needShift:!0,needTwoFingers:!1},registerEvents:!0,renderer:"auto",resize:{enabled:!0,throttle:10},screenshot:{scale:1,type:"png",symbol:"⌘",css:"background-color:#eeeeee; opacity:1.0; border:2px solid black; border-radius:10px; text-align:center",cssButton:"padding: 4px 10px; border: solid #356AA0 1px; border-radius: 5px; position: absolute; right: 2ex; top: 2ex; background-color: rgba(255, 255, 255, 0.3);"},selection:{enabled:!1,name:"selectionPolygon",needShift:!1,needCtrl:!0,fillColor:"#ffff00",visible:!1,withLines:!1,vertices:{visible:!1}},showClearTraces:!1,showCopyright:!0,showFullscreen:!1,showInfobox:!0,showNavigation:!0,showReload:!1,showScreenshot:!1,showZoom:!0,takeFirst:!1,takeSizeFromFile:!1,theme:"default",title:"",viewport:[0,0,0,0],zoom:{enabled:!0,factorX:1.25,factorY:1.25,wheel:!0,needShift:!0,center:"auto",min:1e-4,max:1e4,pinch:!0,pinchHorizontal:!0,pinchVertical:!0,pinchSensitivity:7},zoomX:1,zoomY:1},navbar:{strokeColor:"#333333",fillColor:"transparent",highlightFillColor:"#aaaaaa",padding:"2px",position:"absolute",fontSize:"14px",cursor:"pointer",zIndex:"100",right:"5px",bottom:"5px"},elements:{dash:0,dashScale:!1,draft:{draft:!1,strokeColor:"#565656",fillColor:"#565656",strokeOpacity:.8,fillOpacity:.8,strokeWidth:1},dragToTopOfLayer:!1,fillColor:JXG$1.palette.red,fillOpacity:1,fixed:!1,frozen:!1,gradient:null,gradientAngle:0,gradientCX:.5,gradientCY:.5,gradientEndOffset:1,gradientFX:.5,gradientFY:.5,gradientFR:0,gradientR:.5,gradientSecondColor:"#ffffff",gradientSecondOpacity:1,gradientStartOffset:0,highlight:!0,highlightFillColor:"none",highlightFillOpacity:1,highlightStrokeColor:"#c3d9ff",highlightStrokeOpacity:1,highlightStrokeWidth:2,isLabel:!1,layer:0,lineCap:"butt",needsRegularUpdate:!0,nonnegativeOnly:!1,precision:"inherit",priv:!1,rotatable:!0,scalable:!0,shadow:{enabled:!1,color:[0,0,0],opacity:1,blur:3,blend:.1,offset:[5,5]},snapToGrid:!1,strokeColor:JXG$1.palette.blue,strokeOpacity:1,strokeWidth:2,tabindex:0,trace:!1,traceAttributes:{},transitionDuration:100,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width"],visible:!0,viewport:"inherit",withLabel:!1},ticks:{generateLabelText:null,generateLabelValue:null,drawLabels:!1,label:{},beautifulScientificTickLabels:!1,useUnicodeMinus:!0,anchor:"left",drawZero:!1,insertTicks:!1,minTicksDistance:10,minorHeight:4,majorHeight:10,tickEndings:[1,1],majorTickEndings:[1,1],ignoreInfiniteTickEndings:!0,minorTicks:4,ticksPerLabel:!1,scale:1,scaleSymbol:"",labels:[],maxLabelLength:5,precision:3,digits:3,ticksDistance:1,face:"|",strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"none",highlightFillColor:"none",visible:"inherit",includeBoundaries:!1,type:"linear",intl:{enabled:"inherit",options:{}},minorTicksInArrow:!1,majorTicksInArrow:!0,labelInArrow:!0,minorTicksInMargin:!1,majorTicksInMargin:!0,labelInMargin:!0},hatch:{drawLabels:!1,drawZero:!0,majorHeight:20,anchor:"middle",face:"|",strokeWidth:2,strokeColor:JXG$1.palette.blue,ticksDistance:.2},precision:{touch:30,touchMax:100,mouse:4,pen:4,epsilon:1e-4,hasPoint:4},layer:{numlayers:20,unused9:19,unused8:18,unused7:17,unused6:16,unused5:15,unused4:14,unused3:13,unused2:12,unused1:11,unused0:10,text:9,point:9,glider:9,arc:8,line:7,circle:6,curve:5,turtle:5,polygon:3,sector:3,angle:3,integral:3,axis:2,ticks:2,grid:1,image:0,trace:0},angle:{withLabel:!0,radius:"auto",type:"sector",orthoType:"square",orthoSensitivity:1,fillColor:JXG$1.palette.orange,highlightFillColor:JXG$1.palette.orange,strokeColor:JXG$1.palette.orange,fillOpacity:.3,highlightFillOpacity:.3,radiuspoint:{withLabel:!1,visible:!1,name:""},pointsquare:{withLabel:!1,visible:!1,name:""},dot:{visible:!1,strokeColor:"none",fillColor:"#000000",size:2,face:"o",withLabel:!1,name:""},label:{position:"top",offset:[0,0],strokeColor:JXG$1.palette.blue},arc:{visible:!1,fillColor:"none"}},arc:{selection:"auto",hasInnerPoints:!1,label:{anchorX:"auto",anchorY:"auto"},firstArrow:!1,lastArrow:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",useDirection:!1,center:{},radiusPoint:{},anglePoint:{}},arrow:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},arrowparallel:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},axis:{name:"",needsRegularUpdate:!1,strokeWidth:1,lastArrow:{type:1,highlightSize:8,size:8},strokeColor:"#666666",highlightStrokeWidth:1,highlightStrokeColor:"#888888",position:"static",anchor:"",anchorDist:"10%",ticksAutoPos:!1,ticksAutoPosThreshold:"5%",withTicks:!0,straightFirst:!0,straightLast:!0,margin:-4,withLabel:!1,scalable:!1,ticks:{label:{offset:[4,-9],parse:!1,needsRegularUpdate:!1,display:"internal",visible:"inherit",layer:9},visible:"inherit",needsRegularUpdate:!1,strokeWidth:1,strokeColor:"#666666",highlightStrokeColor:"#888888",drawLabels:!0,drawZero:!1,insertTicks:!0,minTicksDistance:5,minorHeight:10,majorHeight:-1,tickEndings:[0,1],majorTickEndings:[1,1],minorTicks:4,ticksDistance:1,strokeOpacity:.25},point1:{needsRegularUpdate:!1,visible:!1},point2:{needsRegularUpdate:!1,visible:!1},tabindex:-1,label:{position:"lft",offset:[10,10]}},bisector:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},bisectorlines:{line1:{strokeColor:"#000000"},line2:{strokeColor:"#000000"}},boxplot:{dir:"vertical",smallWidth:.5,strokeWidth:2,strokeColor:JXG$1.palette.blue,fillColor:JXG$1.palette.blue,fillOpacity:.2,highlightStrokeWidth:2,highlightStrokeColor:JXG$1.palette.blue,highlightFillColor:JXG$1.palette.blue,highlightFillOpacity:.1},button:{disabled:!1,display:"html"},cardinalspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.05,fillOpacity:.05,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},chart:{chartStyle:"line",colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],highlightcolors:null,fillcolor:null,highlightonsector:!1,highlightbysize:!1,fillOpacity:.6,withLines:!1,label:{}},checkbox:{disabled:!1,checked:!1,display:"html"},circle:{hasInnerPoints:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},label:{position:"urt"}},circumcircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},circumcirclearc:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,name:""}},circumcirclesector:{useDirection:!0,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},comb:{frequency:.2,width:.4,angle:Math.PI/3,reverse:!1,point1:{visible:!1,withLabel:!1,fixed:!1,name:""},point2:{visible:!1,withLabel:!1,fixed:!1,name:""},strokeWidth:1,strokeColor:"#0000ff",fillColor:"none"},conic:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",foci:{fixed:!1,visible:!1,withLabel:!1,name:""},center:{visible:!1,withLabel:!1,name:""},point:{withLabel:!1,name:""},line:{visible:!1}},curve:{strokeWidth:1,strokeColor:JXG$1.palette.blue,fillColor:"none",fixed:!0,curveType:null,doAdvancedPlot:!0,doAdvancedPlotOld:!1,firstArrow:!1,handDrawing:!1,label:{position:"lft"},lastArrow:!1,lineCap:"round",numberPointsHigh:1600,numberPointsLow:400,plotVersion:2,recursionDepthHigh:17,recursionDepthLow:15},foreignobject:{fixed:!0,visible:!0,needsRegularUpdate:!1,attractors:[]},functiongraph:{},glider:{label:{}},grid:{needsRegularUpdate:!1,hasGrid:!1,highlight:!1,gridX:null,gridY:null,majorStep:"auto",minorElements:0,forceSquare:!1,includeBoundaries:!1,size:void 0,face:void 0,margin:void 0,drawZero:void 0,polygonVertices:void 0,major:{size:5,face:"line",margin:0,drawZero:!0,polygonVertices:6},minor:{visible:"inherit",size:3,face:"point",margin:0,drawZero:!0,polygonVertices:6},snapToGrid:!1,strokeColor:"#c0c0c0",strokeWidth:1,strokeOpacity:.5,dash:0,theme:0,themes:[{},{forceSquare:"min",major:{face:"line"}},{major:{face:"line"},minor:{size:3,face:"point"},minorElements:"auto"},{major:{face:"line"},minor:{face:"line",strokeOpacity:.25},minorElements:"auto"},{major:{face:"line"},minor:{face:"+",size:"95%"},minorElements:"auto"},{major:{face:"+",size:10,strokeOpacity:1},minor:{face:"point",size:3},minorElements:"auto"},{major:{face:"circle",size:8,fillColor:"#c0c0c0"},minor:{face:"point",size:3},minorElements:"auto"}]},group:{needsRegularUpdate:!0},htmlslider:{widthRange:100,widthOut:34,step:.01,frozen:!0,isLabel:!1,strokeColor:"#000000",display:"html",anchorX:"left",anchorY:"middle",withLabel:!1},image:{imageString:null,fillOpacity:1,highlightFillOpacity:.6,cssClass:"JXGimage",highlightCssClass:"JXGimageHighlight",rotate:0,snapSizeX:1,snapSizeY:1,attractors:[]},implicitcurve:{margin:1,resolution_outer:5,resolution_inner:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0},incircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},inequality:{fillColor:JXG$1.palette.red,fillOpacity:.2,strokeColor:"none",inverse:!1},infobox:{distanceX:-20,distanceY:25,intl:{enabled:"inherit",options:{}},fontSize:12,isLabel:!1,strokeColor:"#bbbbbb",display:"html",anchorX:"left",anchorY:"middle",cssClass:"JXGinfobox",rotate:0,visible:!0,parse:!1,transitionDuration:0,needsRegularUpdate:!1,tabindex:null,viewport:[0,0,0,0]},integral:{axis:"x",withLabel:!0,fixed:!0,strokeWidth:0,strokeOpacity:0,fillColor:JXG$1.palette.red,fillOpacity:.3,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.2,curveLeft:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseLeft:{visible:!1,fixed:!1,withLabel:!1,name:""},curveRight:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseRight:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{fontSize:20,digits:4,intl:{enabled:!1,options:{}}}},input:{disabled:!1,maxlength:524288,display:"html"},intersection:{alwaysIntersect:!0},label:{visible:"inherit",strokeColor:"#000000",strokeOpacity:1,highlightStrokeOpacity:.666666,highlightStrokeColor:"#000000",fixed:!0,position:"urt",distance:1.5,offset:[10,10],autoPosition:!1,autoPositionMinDistance:12,autoPositionMaxDistance:28,autoPositionWhitelist:[]},legend:{style:"vertical",labels:["1","2","3","4","5","6","7","8"],colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],rowHeight:20,strokeWidth:5},line:{firstArrow:!1,lastArrow:!1,margin:0,straightFirst:!0,straightLast:!0,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",withTicks:!1,point1:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},ticks:{drawLabels:!0,label:{offset:[4,-9]},drawZero:!1,insertTicks:!1,ticksDistance:1,minTicksDistance:50,minorHeight:4,majorHeight:-1,minorTicks:4,strokeOpacity:.3,visible:"inherit"},label:{position:"llft"},snapToGrid:!1,snapSizeX:1,snapSizeY:1,touchFirstPoint:!1,touchLastPoint:!1},locus:{translateToOrigin:!1,translateTo10:!1,stretch:!1,toOrigin:null,to10:null},measurement:{baseUnit:"",units:{},dim:null,showPrefix:!0,showSuffix:!0,prefix:"",suffix:"",formatPrefix:function(u){return u},formatSuffix:function(u){return u},formatCoords:function(u,n,d){return parseFloat(d)!==1?"(NaN | NaN)":"("+u+", "+n+")"},formatDirection:function(u,n){return"("+u+", "+n+")"}},metapostspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.5,fillOpacity:.5,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},mirrorelement:{fixed:!0,point:{},center:{},type:"Euclidean"},nonreflexangle:{},normal:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},orthogonalprojection:{},otherintersection:{alwaysIntersect:!0,precision:.001},parallel:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{position:"llft"}},parallelogram:{parallelpoint:{withLabel:!1,name:""}},parallelpoint:{},perpendicular:{strokeColor:"#000000",straightFirst:!0,straightLast:!0},perpendicularsegment:{strokeColor:"#000000",straightFirst:!1,straightLast:!1,point:{visible:!1,fixed:!0,withLabel:!1,name:""}},point:{withLabel:!0,label:{},style:5,face:"o",size:3,sizeUnit:"screen",strokeWidth:2,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width","width","height","rx","ry"],fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",zoom:!1,showInfobox:"inherit",infoboxDigits:"auto",draft:!1,attractors:[],attractorUnit:"user",attractorDistance:0,snatchDistance:0,snapToGrid:!1,attractToGrid:!1,snapSizeX:1,snapSizeY:1,snapToPoints:!1,ignoredSnapToPoints:[]},polygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"},visible:"inherit"},highlightByStrokeWidth:!1,vertices:{layer:9,withLabel:!1,name:"",strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1,visible:"inherit"},label:{offset:[0,0]}},polygonalchain:{fillColor:"none",highlightFillColor:"none"},prescribedangle:{anglePoint:{size:2,visible:!1,withLabel:!1}},reflection:{fixed:!0,center:{},type:"Euclidean"},reflexangle:{},regularpolygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"}},vertices:{layer:9,withLabel:!0,strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1},label:{offset:[0,0]}},riemannsum:{withLabel:!1,fillOpacity:.3,fillColor:JXG$1.palette.yellow},sector:{fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,highlightOnSector:!1,highlightStrokeWidth:0,selection:"auto",arc:{visible:!1,fillColor:"none",withLabel:!1,name:"",center:{visible:!1,withLabel:!1,name:""},radiusPoint:{visible:!1,withLabel:!1,name:""},anglePoint:{visible:!1,withLabel:!1,name:""}},radiusPoint:{visible:!1,withLabel:!1},center:{visible:!1,withLabel:!1},anglePoint:{visible:!1,withLabel:!1},label:{offset:[0,0],anchorX:"auto",anchorY:"auto"}},segment:{label:{position:"top"}},semicircle:{center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#eeeeee",highlightStrokeColor:JXG$1.palette.red,name:""}},slider:{snapWidth:-1,snapValues:[],snapValueDistance:0,precision:2,digits:2,intl:{enabled:"inherit",options:{}},firstArrow:!1,lastArrow:!1,withTicks:!0,withLabel:!0,suffixLabel:null,unitLabel:null,postLabel:null,layer:9,showInfobox:!1,name:"",visible:!0,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"#ffffff",highlightFillColor:"none",size:6,point1:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},point2:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},baseline:{needsRegularUpdate:!1,visible:"inherit",fixed:!0,scalable:!1,tabindex:null,name:"",strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888"},ticks:{needsRegularUpdate:!1,fixed:!0,drawLabels:!1,digits:2,includeBoundaries:!0,drawZero:!0,label:{offset:[-4,-14],display:"internal"},minTicksDistance:30,insertTicks:!0,ticksDistance:1,minorHeight:4,majorHeight:5,minorTicks:0,strokeOpacity:1,strokeWidth:1,tickEndings:[0,1],majortickEndings:[0,1],strokeColor:"#000000",visible:"inherit"},highline:{strokeWidth:3,visible:"inherit",fixed:!0,tabindex:null,name:"",strokeColor:"#000000",highlightStrokeColor:"#888888"},label:{visible:"inherit",strokeColor:"#000000"},moveOnUp:!0},slopefield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!1,size:5,angle:Math.PI*.125}},slopetriangle:{fillColor:JXG$1.palette.red,fillOpacity:.4,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.3,borders:{lastArrow:{type:1,size:6}},glider:{fixed:!0,visible:!1,withLabel:!1},baseline:{visible:!1,withLabel:!1,name:""},basepoint:{visible:!1,withLabel:!1,name:""},tangent:{visible:!1,withLabel:!1,name:""},toppoint:{visible:!1,withLabel:!1,name:""},label:{visible:!0,position:"first"}},smartlabelangle:{cssClass:"smart-label-solid smart-label-angle",highlightCssClass:"smart-label-solid smart-label-angle",anchorX:"left",anchorY:"middle",unit:"",prefix:"",suffix:"",measure:"deg",useMathJax:!0},smartlabelcircle:{cssClass:"smart-label-solid smart-label-circle",highlightCssClass:"smart-label-solid smart-label-circle",anchorX:"middle",useMathJax:!0,unit:"",prefix:"",suffix:"",measure:"radius"},smartlabelline:{cssClass:"smart-label-solid smart-label-line",highlightCssClass:"smart-label-solid smart-label-line",anchorX:"middle",useMathJax:!0,unit:"",measure:"length"},smartlabelpoint:{cssClass:"smart-label-solid smart-label-point",highlightCssClass:"smart-label-solid smart-label-point",anchorX:"middle",anchorY:"top",useMathJax:!0,dir:"row",unit:""},smartlabelpolygon:{cssClass:"smart-label-solid smart-label-polygon",highlightCssClass:"smart-label-solid smart-label-polygon",anchorX:"middle",useMathJax:!0,unit:"",measure:"area"},stepfunction:{},tangent:{},tangentto:{polar:{visible:!1,strokeWidth:1,dash:3},point:{visible:!1}},tapemeasure:{strokeColor:"#000000",strokeWidth:2,highlightStrokeColor:"#000000",withTicks:!0,withLabel:!0,rotate:0,precision:2,digits:2,point1:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},point2:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},ticks:{drawLabels:!1,drawZero:!0,insertTicks:!0,ticksDistance:.1,minorHeight:8,majorHeight:16,minorTicks:4,tickEndings:[0,1],majorTickEndings:[0,1],strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",visible:"inherit",label:{anchorY:"top",anchorX:"middle",offset:[0,-10]}},label:{position:"top"}},text:{fontSize:12,fontUnit:"px",formatNumber:!1,digits:2,intl:{enabled:"inherit",options:{minimumFractionDigits:0,maximumFractionDigits:2}},parse:!0,useCaja:!1,isLabel:!1,strokeColor:"#000000",highlightStrokeColor:"#000000",highlightStrokeOpacity:.666666,cssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",highlightCssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",cssStyle:"",highlightCssStyle:"",transitionProperties:["color","opacity"],useASCIIMathML:!1,useMathJax:!1,useKatex:!1,katexMacros:{},toFraction:!1,display:"html",anchor:null,anchorX:"left",anchorY:"middle",cssClass:"JXGtext",highlightCssClass:"JXGtext",dragArea:"all",withLabel:!1,rotate:0,visible:!0,snapSizeX:1,snapSizeY:1,attractors:[]},tracecurve:{strokeColor:"#000000",fillColor:"none",numberPoints:100},turtle:{strokeWidth:1,fillColor:"none",strokeColor:"#000000",arrow:{strokeWidth:2,withLabel:!1,strokeColor:JXG$1.palette.red,lastArrow:!0}},vectorfield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},shortcuts:{color:["strokeColor","fillColor"],opacity:["strokeOpacity","fillOpacity"],highlightColor:["highlightStrokeColor","highlightFillColor"],highlightOpacity:["highlightStrokeOpacity","highlightFillOpacity"],strokeWidth:["strokeWidth","highlightStrokeWidth"]}};JXG$1.Validator=function(){var u,n=function(H){return/^[0-9]+px$/.test(H)},d=function(H){return H==="html"||H==="internal"},C=function(H){return JXG$1.isString(H)},I=function(H){return JXG$1.exists(JXG$1.normalizePointFace(H))},f=function(H){return Math.abs(H-Math.round(H))<Mat.eps},y=function(H){return f(H)&&H>=0},B=function(H){return f(H)&&H>0},_=function(H){return H==="vml"||H==="svg"||H==="canvas"||H==="no"},Z=function(H){return H>0},M=function(H){return H>=0},V={},T={attractorDistance:M,color:C,display:d,doAdvancedPlot:!1,draft:!1,drawLabels:!1,drawZero:!1,face:I,factor:JXG$1.isNumber,fillColor:C,fillOpacity:JXG$1.isNumber,firstArrow:!1,fontSize:f,dash:f,gridX:JXG$1.isNumber,gridY:JXG$1.isNumber,hasGrid:!1,highlightFillColor:C,highlightFillOpacity:JXG$1.isNumber,highlightStrokeColor:C,highlightStrokeOpacity:JXG$1.isNumber,insertTicks:!1,lastArrow:!1,layer:y,majorHeight:f,minorHeight:f,minorTicks:M,minTicksDistance:B,numberPointsHigh:B,numberPointsLow:B,opacity:JXG$1.isNumber,radius:JXG$1.isNumber,RDPsmoothing:!1,renderer:_,right:n,showCopyright:!1,showInfobox:!1,showNavigation:!1,size:M,snapSizeX:Z,snapSizeY:Z,snapWidth:JXG$1.isNumber,snapToGrid:!1,snatchDistance:M,straightFirst:!1,straightLast:!1,stretch:!1,strokeColor:C,strokeOpacity:JXG$1.isNumber,strokeWidth:M,takeFirst:!1,takeSizeFromFile:!1,to10:!1,toOrigin:!1,translateTo10:!1,translateToOrigin:!1,useASCIIMathML:!1,useDirection:!1,useMathJax:!1,withLabel:!1,withTicks:!1,zoom:!1};for(u in T)T.hasOwnProperty(u)&&(V[u.toLowerCase()]=T[u]);return V}();JXG$1.normalizePointFace=function(u){var n={cross:"x",x:"x",circle:"o",o:"o",square:"[]","[]":"[]",plus:"+","+":"+",divide:"|","|":"|",minus:"-","-":"-",diamond:"<>","<>":"<>",diamond2:"<<>>","<<>>":"<<>>",triangleup:"^",A:"^",a:"^","^":"^",triangledown:"v",v:"v",triangleleft:"<","<":"<",triangleright:">",">":">"};return n[u]};JXG$1.useStandardOptions=function(u){var n,d,C,I,f=JXG$1.Options,y=u.hasGrid;u.options.grid.hasGrid=f.grid.hasGrid,u.options.grid.gridX=f.grid.gridX,u.options.grid.gridY=f.grid.gridY,u.options.grid.gridColor=f.grid.gridColor,u.options.grid.gridOpacity=f.grid.gridOpacity,u.options.grid.gridDash=f.grid.gridDash,u.options.grid.snapToGrid=f.grid.snapToGrid,u.options.grid.snapSizeX=f.grid.SnapSizeX,u.options.grid.snapSizeY=f.grid.SnapSizeY,u.takeSizeFromFile=f.takeSizeFromFile,I=function(B,_){B.visProp.fillcolor=_.fillColor,B.visProp.highlightfillcolor=_.highlightFillColor,B.visProp.strokecolor=_.strokeColor,B.visProp.highlightstrokecolor=_.highlightStrokeColor};for(n in u.objects)if(u.objects.hasOwnProperty(n))if(C=u.objects[n],C.elementClass===Const.OBJECT_CLASS_POINT)I(C,f.point);else if(C.elementClass===Const.OBJECT_CLASS_LINE)for(I(C,f.line),d=0;d<C.ticks.length;d++)C.ticks[d].majorTicks=f.line.ticks.majorTicks,C.ticks[d].minTicksDistance=f.line.ticks.minTicksDistance,C.ticks[d].visProp.minorheight=f.line.ticks.minorHeight,C.ticks[d].visProp.majorheight=f.line.ticks.majorHeight;else C.elementClass===Const.OBJECT_CLASS_CIRCLE?I(C,f.circle):C.type===Const.OBJECT_TYPE_ANGLE?I(C,f.angle):C.type===Const.OBJECT_TYPE_ARC?I(C,f.arc):C.type===Const.OBJECT_TYPE_POLYGON?I(C,f.polygon):C.type===Const.OBJECT_TYPE_CONIC?I(C,f.conic):C.type===Const.OBJECT_TYPE_CURVE?I(C,f.curve):C.type===Const.OBJECT_TYPE_SECTOR&&(C.arc.visProp.fillcolor=f.sector.fillColor,C.arc.visProp.highlightfillcolor=f.sector.highlightFillColor,C.arc.visProp.fillopacity=f.sector.fillOpacity,C.arc.visProp.highlightfillopacity=f.sector.highlightFillOpacity);u.fullUpdate(),y&&!u.hasGrid?u.removeGrids(u):!y&&u.hasGrid&&u.create("grid",[])};JXG$1.useBlackWhiteOptions=function(u){var n=JXG$1.Options;n.point.fillColor=JXG$1.rgb2bw(n.point.fillColor),n.point.highlightFillColor=JXG$1.rgb2bw(n.point.highlightFillColor),n.point.strokeColor=JXG$1.rgb2bw(n.point.strokeColor),n.point.highlightStrokeColor=JXG$1.rgb2bw(n.point.highlightStrokeColor),n.line.fillColor=JXG$1.rgb2bw(n.line.fillColor),n.line.highlightFillColor=JXG$1.rgb2bw(n.line.highlightFillColor),n.line.strokeColor=JXG$1.rgb2bw(n.line.strokeColor),n.line.highlightStrokeColor=JXG$1.rgb2bw(n.line.highlightStrokeColor),n.circle.fillColor=JXG$1.rgb2bw(n.circle.fillColor),n.circle.highlightFillColor=JXG$1.rgb2bw(n.circle.highlightFillColor),n.circle.strokeColor=JXG$1.rgb2bw(n.circle.strokeColor),n.circle.highlightStrokeColor=JXG$1.rgb2bw(n.circle.highlightStrokeColor),n.arc.fillColor=JXG$1.rgb2bw(n.arc.fillColor),n.arc.highlightFillColor=JXG$1.rgb2bw(n.arc.highlightFillColor),n.arc.strokeColor=JXG$1.rgb2bw(n.arc.strokeColor),n.arc.highlightStrokeColor=JXG$1.rgb2bw(n.arc.highlightStrokeColor),n.polygon.fillColor=JXG$1.rgb2bw(n.polygon.fillColor),n.polygon.highlightFillColor=JXG$1.rgb2bw(n.polygon.highlightFillColor),n.sector.fillColor=JXG$1.rgb2bw(n.sector.fillColor),n.sector.highlightFillColor=JXG$1.rgb2bw(n.sector.highlightFillColor),n.curve.strokeColor=JXG$1.rgb2bw(n.curve.strokeColor),n.grid.gridColor=JXG$1.rgb2bw(n.grid.gridColor),JXG$1.useStandardOptions(u)};JXG$1.Options.normalizePointFace=JXG$1.normalizePointFace;const Options=JXG$1.Options;JXG$1.AbstractRenderer=function(){this.vOffsetText=0,this.enhancedRendering=!0,this.container=null,this.type="",this.supportsForeignObject=!1,this.dashArray=[[2,2],[5,5],[10,10],[20,20],[20,10,10,10],[20,5,10,5],[0,5]]};JXG$1.extend(JXG$1.AbstractRenderer.prototype,{_updateVisual:function(u,n,d){(d||this.enhancedRendering)&&(n=n||{},this.setObjectViewport(u),this.setObjectTransition(u),JXG$1.evaluate(u.visProp.draft)?this.setDraft(u):(n.stroke||(u.highlighted?(this.setObjectStrokeColor(u,u.visProp.highlightstrokecolor,u.visProp.highlightstrokeopacity),this.setObjectStrokeWidth(u,u.visProp.highlightstrokewidth)):(this.setObjectStrokeColor(u,u.visProp.strokecolor,u.visProp.strokeopacity),this.setObjectStrokeWidth(u,u.visProp.strokewidth))),n.fill||(u.highlighted?this.setObjectFillColor(u,u.visProp.highlightfillcolor,u.visProp.highlightfillopacity):this.setObjectFillColor(u,u.visProp.fillcolor,u.visProp.fillopacity)),n.dash||this.setDashStyle(u,u.visProp),n.shadow||this.setShadow(u),n.tabindex||this.setTabindex(u)))},_getHighlighted:function(u){var n=!1,d;return(!JXG$1.exists(u.board)||!JXG$1.exists(u.board.highlightedObjects))&&(n=!0),!n&&JXG$1.exists(u.board.highlightedObjects[u.id])?d="highlight":d="",d},drawPoint:function(u){var n,d=Options.normalizePointFace(JXG$1.evaluate(u.visProp.face));d==="o"?n="ellipse":d==="[]"?n="rect":n="path",u.rendNode=this.appendChildPrim(this.createPrim(n,u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,n),this._updateVisual(u,{dash:!0,shadow:!0},!0),this.updatePoint(u)},updatePoint:function(u){var n=JXG$1.evaluate(u.visProp.size),d=Options.normalizePointFace(JXG$1.evaluate(u.visProp.face)),C=JXG$1.evaluate(u.visProp.sizeunit),I=JXG$1.evaluate(u.visProp.zoom),f;isNaN(u.coords.scrCoords[2]+u.coords.scrCoords[1])||(C==="user"&&(n*=Math.sqrt(Math.abs(u.board.unitX*u.board.unitY))),n*=!u.board||!I?1:Math.sqrt(u.board.zoomX*u.board.zoomY),f=n===0?0:n+1,d==="o"?this.updateEllipsePrim(u.rendNode,u.coords.scrCoords[1],u.coords.scrCoords[2],f,f):d==="[]"?this.updateRectPrim(u.rendNode,u.coords.scrCoords[1]-n,u.coords.scrCoords[2]-n,n*2,n*2):this.updatePathPrim(u.rendNode,this.updatePathStringPoint(u,n,d),u.board),this._updateVisual(u,{dash:!1,shadow:!1}),this.setShadow(u))},changePointStyle:function(u){var n=this.getElementById(u.id);JXG$1.exists(n)&&this.remove(n),this.drawPoint(u),JXG$1.clearVisPropOld(u),u.visPropCalc.visible||this.display(u,!1),JXG$1.evaluate(u.visProp.draft)&&this.setDraft(u)},drawLine:function(u){u.rendNode=this.appendChildPrim(this.createPrim("line",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"lines"),this.updateLine(u)},updateLine:function(u){this._updateVisual(u),this.updatePathWithArrowHeads(u),this.setLineCap(u)},drawCurve:function(u){u.rendNode=this.appendChildPrim(this.createPrim("path",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"path"),this.updateCurve(u)},updateCurve:function(u){this._updateVisual(u),this.updatePathWithArrowHeads(u),this.setLineCap(u)},updatePathWithArrowHeads:function(u,n){var d=u.visProp,C=n?"highlight":"",I,f;n&&d.highlightstrokewidth?I=Math.max(JXG$1.evaluate(d.highlightstrokewidth),JXG$1.evaluate(d.strokewidth)):I=JXG$1.evaluate(d.strokewidth),f=this.getArrowHeadData(u,I,C),this.makeArrows(u,f),u.elementClass===Const.OBJECT_CLASS_LINE?this.updateLineWithEndings(u,f):u.elementClass===Const.OBJECT_CLASS_CURVE&&this.updatePath(u),this.setArrowSize(u,f)},getArrowHeadData:function(u,n,d){var C=Mat.eps,I,f,y=0,B=0,_=0,Z=0,M=JXG$1.evaluate(u.visProp.firstarrow),V=JXG$1.evaluate(u.visProp.lastarrow),T,H;return(M||V)&&(JXG$1.exists(M.type)?I=JXG$1.evaluate(M.type):u.elementClass===Const.OBJECT_CLASS_LINE?I=1:I=7,JXG$1.exists(V.type)?f=JXG$1.evaluate(V.type):u.elementClass===Const.OBJECT_CLASS_LINE?f=1:f=7,M&&(H=6,JXG$1.exists(M.size)&&(H=JXG$1.evaluate(M.size)),d!==""&&JXG$1.exists(M[d+"size"])&&(H=JXG$1.evaluate(M[d+"size"])),T=n*H,I===2?(T*=.5,C+=n*H):I===3?(T=n*H/3,C+=n):I===4||I===5||I===6?(T=n*H/1.5,C+=n*H):I===7?(T=0,H=10,C+=n):C+=n*H,y+=T,_=H),V&&(H=6,JXG$1.exists(V.size)&&(H=JXG$1.evaluate(V.size)),d!==""&&JXG$1.exists(V[d+"size"])&&(H=JXG$1.evaluate(V[d+"size"])),T=n*H,f===2?(T*=.5,C+=n*H):f===3?(T=n*H/3,C+=n):f===4||f===5||f===6?(T=n*H/1.5,C+=n*H):f===7?(T=0,H=10,C+=n):C+=n*H,B+=T,Z=H)),u.visPropCalc.typeFirst=I,u.visPropCalc.typeLast=f,{evFirst:M,evLast:V,typeFirst:I,typeLast:f,offFirst:y,offLast:B,sizeFirst:_,sizeLast:Z,showFirst:1,showLast:1,minLen:C,strokeWidth:n}},updateLineWithEndings:function(u,n){var d,C,I=null;return d=new Coords(Const.COORDS_BY_USER,u.point1.coords.usrCoords,u.board),C=new Coords(Const.COORDS_BY_USER,u.point2.coords.usrCoords,u.board),I=JXG$1.evaluate(u.visProp.margin),Geometry.calcStraight(u,d,C,I),this.handleTouchpoints(u,d,C,n),this.getPositionArrowHead(u,d,C,n),this.updateLinePrim(u.rendNode,d.scrCoords[1],d.scrCoords[2],C.scrCoords[1],C.scrCoords[2],u.board),this},updatePath:function(u){return JXG$1.evaluate(u.visProp.handdrawing)?this.updatePathPrim(u.rendNode,this.updatePathStringBezierPrim(u),u.board):this.updatePathPrim(u.rendNode,this.updatePathStringPrim(u),u.board),this},getPositionArrowHead:function(u,n,d,C){var I,f,y,B,_;return(C.evFirst||C.evLast)&&(f=y=B=_=0,I=n.distance(Const.COORDS_BY_SCREEN,d),C.evFirst&&u.board.renderer.type!=="vml"&&(I>=C.minLen?(f=(d.scrCoords[1]-n.scrCoords[1])*C.offFirst/I,y=(d.scrCoords[2]-n.scrCoords[2])*C.offFirst/I):C.showFirst=0),C.evLast&&u.board.renderer.type!=="vml"&&(I>=C.minLen?(B=(d.scrCoords[1]-n.scrCoords[1])*C.offLast/I,_=(d.scrCoords[2]-n.scrCoords[2])*C.offLast/I):C.showLast=0),n.setCoordinates(Const.COORDS_BY_SCREEN,[n.scrCoords[1]+f,n.scrCoords[2]+y],!1,!0),d.setCoordinates(Const.COORDS_BY_SCREEN,[d.scrCoords[1]-B,d.scrCoords[2]-_],!1,!0)),this},handleTouchpoints:function(u,n,d,C){var I,f,y,B,_,Z,M;return(C.evFirst||C.evLast)&&(y=B=_=Z=M=0,I=JXG$1.evaluate(u.point1.visProp.size)+JXG$1.evaluate(u.point1.visProp.strokewidth),f=JXG$1.evaluate(u.point2.visProp.size)+JXG$1.evaluate(u.point2.visProp.strokewidth),C.evFirst&&JXG$1.evaluate(u.visProp.touchfirstpoint)&&JXG$1.evaluate(u.point1.visProp.visible)&&(y=n.distance(Const.COORDS_BY_SCREEN,d),B=(d.scrCoords[1]-n.scrCoords[1])*I/y,_=(d.scrCoords[2]-n.scrCoords[2])*I/y),C.evLast&&JXG$1.evaluate(u.visProp.touchlastpoint)&&JXG$1.evaluate(u.point2.visProp.visible)&&(y=n.distance(Const.COORDS_BY_SCREEN,d),Z=(d.scrCoords[1]-n.scrCoords[1])*f/y,M=(d.scrCoords[2]-n.scrCoords[2])*f/y),n.setCoordinates(Const.COORDS_BY_SCREEN,[n.scrCoords[1]+B,n.scrCoords[2]+_],!1,!0),d.setCoordinates(Const.COORDS_BY_SCREEN,[d.scrCoords[1]-Z,d.scrCoords[2]-M],!1,!0)),this},setArrowSize:function(u,n){return n.evFirst&&this._setArrowWidth(u.rendNodeTriangleStart,n.showFirst*n.strokeWidth,u.rendNode,n.sizeFirst),n.evLast&&this._setArrowWidth(u.rendNodeTriangleEnd,n.showLast*n.strokeWidth,u.rendNode,n.sizeLast),this},setLineCap:function(u){},drawTicks:function(u){u.rendNode=this.appendChildPrim(this.createPrim("path",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"path")},updateTicks:function(u){},drawEllipse:function(u){u.rendNode=this.appendChildPrim(this.createPrim("ellipse",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"ellipse"),this.updateEllipse(u)},updateEllipse:function(u){this._updateVisual(u);var n=u.Radius();Math.abs(u.center.coords.usrCoords[0])>Mat.eps&&!isNaN(n+u.center.coords.scrCoords[1]+u.center.coords.scrCoords[2])&&n*u.board.unitX<2e6&&this.updateEllipsePrim(u.rendNode,u.center.coords.scrCoords[1],u.center.coords.scrCoords[2],n*u.board.unitX,n*u.board.unitY),this.setLineCap(u)},drawPolygon:function(u){u.rendNode=this.appendChildPrim(this.createPrim("polygon",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"polygon"),this.updatePolygon(u)},updatePolygon:function(u){this._updateVisual(u,{stroke:!0,dash:!0}),this.updatePolygonPrim(u.rendNode,u)},displayCopyright:function(u,n){},drawInternalText:function(u){},updateInternalText:function(u){},drawText:function(u){var n,d,C,I;JXG$1.evaluate(u.visProp.display)==="html"&&JXG$1.isBrowser&&this.type!=="no"?(n=this.container.ownerDocument.createElement("div"),n.style.position="absolute",n.className=JXG$1.evaluate(u.visProp.cssclass),C=JXG$1.evaluate(u.visProp.layer),JXG$1.exists(C)||(C=0),this.container.style.zIndex===""?d=0:d=parseInt(this.container.style.zIndex,10),n.style.zIndex=d+C,this.container.appendChild(n),n.setAttribute("id",this.container.id+"_"+u.id)):n=this.drawInternalText(u),u.rendNode=n,u.htmlStr="",u.visProp.islabel&&JXG$1.exists(u.visProp.anchor)?(I=JXG$1.evaluate(u.visProp.anchor.visProp.visible),u.prepareUpdate().updateVisibility(I)):u.prepareUpdate().updateVisibility(),this.updateText(u)},updateText:function(u){var n=u.plaintext,d,C,I,f,y,B,_,Z,M,V,T;if(u.visPropCalc.visible)if(this.updateTextStyle(u,!1),JXG$1.evaluate(u.visProp.display)==="html"&&this.type!=="no"){if(isNaN(u.coords.scrCoords[1]+u.coords.scrCoords[2])||(C=u.coords.scrCoords[1],C=Math.abs(C)<1e6?C:1e6,y=u.getAnchorX(),y==="right"?(d=u.board.canvasWidth-C,V="right"):y==="middle"?(d=C-.5*u.size[0],V="center"):(d=C,V="left"),u.visPropOld.left!==y+d&&(y==="right"?(u.rendNode.style.right=d+"px",u.rendNode.style.left="auto"):(u.rendNode.style.left=d+"px",u.rendNode.style.right="auto"),u.visPropOld.left=y+d),C=u.coords.scrCoords[2]+this.vOffsetText,C=Math.abs(C)<1e6?C:1e6,B=u.getAnchorY(),B==="bottom"?(d=u.board.canvasHeight-C,T="bottom"):B==="middle"?(d=C-.5*u.size[1],T="center"):(d=C,T="top"),u.visPropOld.top!==B+d&&(B==="bottom"?(u.rendNode.style.top="auto",u.rendNode.style.bottom=d+"px"):(u.rendNode.style.bottom="auto",u.rendNode.style.top=d+"px"),u.visPropOld.top=B+d)),u.htmlStr!==n){try{u.type===JXG$1.OBJECT_TYPE_BUTTON?u.rendNodeButton.innerHTML=n:u.type===JXG$1.OBJECT_TYPE_CHECKBOX||u.type===JXG$1.OBJECT_TYPE_INPUT?u.rendNodeLabel.innerHTML=n:u.rendNode.innerHTML=n}catch{I=u.rendNode.parentNode,u.rendNode.parentNode.removeChild(u.rendNode),u.rendNode.innerHTML=n,I.appendChild(u.rendNode)}if(u.htmlStr=n,JXG$1.evaluate(u.visProp.usemathjax))try{MathJax.typeset?MathJax.typeset([u.rendNode]):MathJax.Hub.Queue(["Typeset",MathJax.Hub,u.rendNode])}catch{JXG$1.debug("MathJax (not yet) loaded")}else if(JXG$1.evaluate(u.visProp.usekatex))try{u.rendNode.innerHTML.indexOf("<span")===0&&u.rendNode.innerHTML.indexOf("<label")>0&&(u.rendNode.innerHTML.indexOf("<checkbox")>0||u.rendNode.innerHTML.indexOf("<input")>0)?f=u.rendNodeLabel:u.rendNode.innerHTML.indexOf("<button")===0?f=u.rendNodeButton:f=u.rendNode,f&&katex.render(n,f,{macros:JXG$1.evaluate(u.visProp.katexmacros),throwOnError:!1})}catch{JXG$1.debug("KaTeX not loaded (yet)")}else if(JXG$1.evaluate(u.visProp.useasciimathml))try{AMprocessNode(u.rendNode,!1)}catch{JXG$1.debug("AsciiMathML not loaded (yet)")}}_=JXG$1.evaluate(u.visProp.rotate),_!==0&&(_*=Math.PI/180,Z=Math.cos(_),M=Math.sin(_),u.rendNode.style.transform="matrix("+[Z,-1*M,M,Z,0,0].join(",")+")",u.rendNode.style["transform-origin"]=V+" "+T),this.transformImage(u,u.transformations)}else this.updateInternalText(u)},_css2js:function(u){var n=[],d,C,I,f,y,B=JXG$1.trim(u).replace(/;$/,"").split(";");for(C=B.length,d=0;d<C;++d)JXG$1.trim(B[d])!==""&&(y=B[d].split(":"),I=JXG$1.trim(y[0].replace(/-([a-z])/gi,function(_,Z){return Z.toUpperCase()})),f=JXG$1.trim(y[1]),n.push({key:I,val:f}));return n},updateTextStyle:function(u,n){var d,C,I,f,y,B=u.visProp,_=JXG$1.isBrowser?B.display:"internal",Z=["rendNode","rendNodeTag","rendNodeLabel"],M=Z.length,V=JXG$1.evaluate(B.fontunit),T,H,F,O,$=["cssdefaultstyle","cssstyle"],U=$.length;if(n?(I=B.highlightstrokecolor,C=B.highlightstrokeopacity,f=B.highlightcssclass):(I=B.strokecolor,C=B.strokeopacity,f=B.cssclass),this.type!=="no"&&(_==="html"||this.type!=="canvas")){for(F=0;F<U;F++)if(O=JXG$1.evaluate(B[(n?"highlight":"")+$[F]]),O!==""&&u.visPropOld[$[F]]!==O){for(T=this._css2js(O),y=0;y<M;y++)if(JXG$1.exists(u[Z[y]]))for(H in T)T.hasOwnProperty(H)&&(u[Z[y]].style[T[H].key]=T[H].val);u.visPropOld[$[F]]=O}if(d=JXG$1.evaluate(B.fontsize),u.visPropOld.fontsize!==d){u.needsSizeUpdate=!0;try{for(y=0;y<M;y++)JXG$1.exists(u[Z[y]])&&(u[Z[y]].style.fontSize=d+V)}catch{for(y=0;y<M;y++)JXG$1.exists(u[Z[y]])&&(u[Z[y]].style.fontSize=d)}u.visPropOld.fontsize=d}}return this.setTabindex(u),this.setObjectTransition(u),_==="html"&&this.type!=="no"?(this.setObjectViewport(u,!0),u.visPropOld.cssclass!==f&&(u.rendNode.className=f,u.visPropOld.cssclass=f,u.needsSizeUpdate=!0),this.setObjectStrokeColor(u,I,C)):this.updateInternalTextStyle(u,I,C),this},updateInternalTextStyle:function(u,n,d){this.setObjectStrokeColor(u,n,d)},drawImage:function(u){},updateImage:function(u){this.updateRectPrim(u.rendNode,u.coords.scrCoords[1],u.coords.scrCoords[2]-u.size[1],u.size[0],u.size[1]),this.updateImageURL(u),this.transformImage(u,u.transformations),this._updateVisual(u,{stroke:!0,dash:!0},!0)},joinTransforms:function(u,n){var d,C=u.board.origin.scrCoords[1],I=u.board.origin.scrCoords[2],f=u.board.unitX,y=u.board.unitY,B=n.length,_=[[1,0,0],[-C/f,1/f,0],[I/y,0,-1/y]];for(d=0;d<B;d++)_=Mat.matMatMult(n[d].matrix,_);return _=Mat.matMatMult([[1,0,0],[C,f,0],[I,0,-y]],_),_},transformImage:function(u,n){},updateImageURL:function(u){},updateImageStyle:function(u,n){u.rendNode.className=JXG$1.evaluate(n?u.visProp.highlightcssclass:u.visProp.cssclass)},drawForeignObject:function(u){},updateForeignObject:function(u){},appendChildPrim:function(u,n){},appendNodesToElement:function(u,n){},createPrim:function(u,n){return null},remove:function(u){},makeArrows:function(u,n){},_setArrowWidth:function(u,n,d){},updateEllipsePrim:function(u,n,d,C,I){},updateLinePrim:function(u,n,d,C,I,f){},updatePathPrim:function(u,n,d){},updatePathStringPoint:function(u,n,d){},updatePathStringPrim:function(u){},updatePathStringBezierPrim:function(u){},updatePolygonPrim:function(u,n){},updateRectPrim:function(u,n,d,C,I){},setPropertyPrim:function(u,n,d){},setTabindex:function(u){var n;u.board.attr.keyboard.enabled&&JXG$1.exists(u.rendNode)&&(n=JXG$1.evaluate(u.visProp.tabindex),(!u.visPropCalc.visible||JXG$1.evaluate(u.visProp.fixed))&&(n=null),n!==u.visPropOld.tabindex&&(u.rendNode.setAttribute("tabindex",n),u.visPropOld.tabindex=n))},display:function(u,n){u&&(u.visPropOld.visible=n)},show:function(u){},hide:function(u){},setBuffering:function(u,n){},setDashStyle:function(u){},setDraft:function(u){if(JXG$1.evaluate(u.visProp.draft)){var n=u.board.options.elements.draft.color,d=u.board.options.elements.draft.opacity;this.setObjectViewport(u),this.setObjectTransition(u),u.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(u,n,d):(u.elementClass===Const.OBJECT_CLASS_POINT?this.setObjectFillColor(u,n,d):this.setObjectFillColor(u,"none",0),this.setObjectStrokeColor(u,n,d),this.setObjectStrokeWidth(u,u.board.options.elements.draft.strokeWidth))}},removeDraft:function(u){this.setObjectViewport(u),this.setObjectTransition(u),u.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(u,u.visProp.fillcolor,u.visProp.fillopacity):(u.type===Const.OBJECT_CLASS_POINT&&this.setObjectFillColor(u,u.visProp.fillcolor,u.visProp.fillopacity),this.setObjectStrokeColor(u,u.visProp.strokecolor,u.visProp.strokeopacity),this.setObjectStrokeWidth(u,u.visProp.strokewidth))},setGradient:function(u){},updateGradient:function(u){},setObjectTransition:function(u,n){},setObjectViewport:function(u,n){},setObjectFillColor:function(u,n,d){},setObjectStrokeColor:function(u,n,d){},setObjectStrokeWidth:function(u,n){},setShadow:function(u){},highlight:function(u,n){var d,C,I=u.visProp,f;if(this.setObjectViewport(u),this.setObjectTransition(u),!I.draft){if(u.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(u,I.highlightfillcolor,I.highlightfillopacity),C=JXG$1.evaluate(I.highlightbystrokewidth),d=0;d<u.borders.length;d++)this.highlight(u.borders[d],!C);else u.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(u,!0):u.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(u,!0),this.setObjectFillColor(u,I.highlightfillcolor,I.highlightfillopacity)):(this.setObjectStrokeColor(u,I.highlightstrokecolor,I.highlightstrokeopacity),this.setObjectFillColor(u,I.highlightfillcolor,I.highlightfillopacity));I.highlightstrokewidth&&!n&&(f=Math.max(JXG$1.evaluate(I.highlightstrokewidth),JXG$1.evaluate(I.strokewidth)),this.setObjectStrokeWidth(u,f),(u.elementClass===Const.OBJECT_CLASS_LINE||u.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(u,!0))}return this},noHighlight:function(u){var n,d=u.visProp,C;if(this.setObjectViewport(u),this.setObjectTransition(u),!JXG$1.evaluate(u.visProp.draft)){if(u.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(u,d.fillcolor,d.fillopacity),n=0;n<u.borders.length;n++)this.noHighlight(u.borders[n]);else u.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(u,!1):u.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(u,!1),this.setObjectFillColor(u,d.fillcolor,d.fillopacity)):(this.setObjectStrokeColor(u,d.strokecolor,d.strokeopacity),this.setObjectFillColor(u,d.fillcolor,d.fillopacity));C=JXG$1.evaluate(d.strokewidth),this.setObjectStrokeWidth(u,C),(u.elementClass===Const.OBJECT_CLASS_LINE||u.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(u,!1)}return this},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(u,n){var d,C,I=function(y){y||(y=window.event),y.stopPropagation?y.stopPropagation():y.cancelBubble=!0},f=function(y,B,_,Z){var M;_=_||"",M=d.createElement("span"),M.innerHTML=y,M.style.paddingLeft="7px",M.style.paddingRight="7px",M.classList!==void 0&&(M.classList.add("JXG_navigation_button"),M.classList.add("JXG_navigation_button_"+Z)),M.setAttribute("id",_+"_navigation_"+Z),C.appendChild(M),JXG$1.addEvent(M,"click",function(V){return JXG$1.bind(B,u)(),!1},u),JXG$1.addEvent(M,"pointerup",I,u),JXG$1.addEvent(M,"pointerdown",I,u),JXG$1.addEvent(M,"pointerleave",I,u),JXG$1.addEvent(M,"mouseup",I,u),JXG$1.addEvent(M,"mousedown",I,u),JXG$1.addEvent(M,"touchend",I,u),JXG$1.addEvent(M,"touchstart",I,u)};JXG$1.isBrowser&&this.type!=="no"&&(d=u.containerObj.ownerDocument,C=d.createElement("div"),C.setAttribute("id",u.container+"_navigationbar"),C.style.color=n.strokecolor,C.style.backgroundColor=n.fillcolor,C.style.padding=n.padding,C.style.position=n.position,C.style.fontSize=n.fontsize,C.style.cursor=n.cursor,C.style.zIndex=n.zindex,u.containerObj.appendChild(C),C.style.right=n.right,C.style.bottom=n.bottom,C.classList!==void 0&&C.classList.add("JXG_navigation"),u.attr.showfullscreen&&f(u.attr.fullscreen.symbol,function(){u.toFullscreen(u.attr.fullscreen.id)},u.container,"fullscreen"),u.attr.showscreenshot&&f(u.attr.screenshot.symbol,function(){window.setTimeout(function(){u.renderer.screenshot(u,"",!1)},330)},u.container,"screenshot"),u.attr.showreload&&f("↻",function(){u.reload()},u.container,"reload"),u.attr.showcleartraces&&f("⊗",function(){u.clearTraces()},u.container,"cleartraces"),u.attr.shownavigation&&(u.attr.showzoom&&(f("–",u.zoomOut,u.container,"out"),f("o",u.zoom100,u.container,"100"),f("+",u.zoomIn,u.container,"in")),f("←",u.clickLeftArrow,u.container,"left"),f("↓",u.clickUpArrow,u.container,"down"),f("↑",u.clickDownArrow,u.container,"up"),f("→",u.clickRightArrow,u.container,"right")))},getElementById:function(u){var n;return JXG$1.exists(this.container)?(n=this.container.id+"_"+u,JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(n=CSS.escape(n)),this.container.querySelector("#"+n)):""},removeToInsertLater:function(u){var n=u.parentNode,d=u.nextSibling;if(n!==null)return n.removeChild(u),function(){d?n.insertBefore(u,d):n.appendChild(u)}},resize:function(u,n){},createTouchpoints:function(u){},showTouchpoint:function(u){},hideTouchpoint:function(u){},updateTouchpoint:function(u,n){},dumpToDataURI:function(u){},dumpToCanvas:function(u,n,d,C){},screenshot:function(u){},setLayer:function(u,n){}});const AbstractRenderer=JXG$1.AbstractRenderer;var UTF8_ACCEPT=0,UTF8D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,12,24,36,60,96,84,12,12,12,48,72,12,12,12,12,12,12,12,12,12,12,12,12,12,0,12,12,12,12,12,0,12,0,12,12,12,24,12,12,12,12,12,24,12,24,12,12,12,12,12,12,12,12,12,24,12,12,12,12,12,24,12,12,12,12,12,12,12,24,12,12,12,12,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,12,12,12,12,12];JXG$1.Util=JXG$1.Util||{};JXG$1.Util.UTF8={encode:function(u){var n,d,C="",I=u.length;if(u=u.replace(/\r\n/g,`
`),typeof unescape=="function"&&typeof encodeURIComponent=="function")return unescape(encodeURIComponent(u));for(n=0;n<I;n++)d=u.charCodeAt(n),d<128?C+=String.fromCharCode(d):d>127&&d<2048?(C+=String.fromCharCode(d>>6|192),C+=String.fromCharCode(d&63|128)):(C+=String.fromCharCode(d>>12|224),C+=String.fromCharCode(d>>6&63|128),C+=String.fromCharCode(d&63|128));return C},decode:function(u){var n,d,C,I=0,f=0,y=UTF8_ACCEPT,B=[],_=u.length,Z=[];for(n=0;n<_;n++)d=u.charCodeAt(n),C=UTF8D[d],y!==UTF8_ACCEPT?f=d&63|f<<6:f=255>>C&d,y=UTF8D[256+y+C],y===UTF8_ACCEPT&&(f>65535?B.push(55232+(f>>10),56320+(f&1023)):B.push(f),I++,I%1e4===0&&(Z.push(String.fromCharCode.apply(null,B)),B=[]));return Z.push(String.fromCharCode.apply(null,B)),Z.join("")},asciiCharCodeAt:function(u,n){var d=u.charCodeAt(n);if(d>255)switch(d){case 8364:d=128;break;case 8218:d=130;break;case 402:d=131;break;case 8222:d=132;break;case 8230:d=133;break;case 8224:d=134;break;case 8225:d=135;break;case 710:d=136;break;case 8240:d=137;break;case 352:d=138;break;case 8249:d=139;break;case 338:d=140;break;case 381:d=142;break;case 8216:d=145;break;case 8217:d=146;break;case 8220:d=147;break;case 8221:d=148;break;case 8226:d=149;break;case 8211:d=150;break;case 8212:d=151;break;case 732:d=152;break;case 8482:d=153;break;case 353:d=154;break;case 8250:d=155;break;case 339:d=156;break;case 382:d=158;break;case 376:d=159;break}return d}};const Encoding=JXG$1.Util.UTF8;var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad="=";JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Base64={_getByte:function(u,n){return u.charCodeAt(n)&255},_getIndex:function(u,n){return alphabet.indexOf(u.charAt(n))},encode:function(u){var n,d,C,I,f,y=[];for(f=Encoding.encode(u),C=f.length,I=C%3,n=0;n<C-I;n+=3)d=this._getByte(f,n)<<16|this._getByte(f,n+1)<<8|this._getByte(f,n+2),y.push(alphabet.charAt(d>>18),alphabet.charAt(d>>12&63),alphabet.charAt(d>>6&63),alphabet.charAt(d&63));switch(I){case 1:d=this._getByte(f,C-1),y.push(alphabet.charAt(d>>2),alphabet.charAt(d<<4&63),pad,pad);break;case 2:d=this._getByte(f,C-2)<<8|this._getByte(f,C-1),y.push(alphabet.charAt(d>>10),alphabet.charAt(d>>4&63),alphabet.charAt(d<<2&63),pad);break}return y.join("")},decode:function(u,n){var d,C,I,f,y,B,_=[],Z=[];if(d=u.replace(/[^A-Za-z0-9+/=]/g,""),I=d.length,I%4!==0)throw new Error("JSXGraph/utils/base64: Can't decode string (invalid input length).");for(d.charAt(I-1)===pad&&(f=1,d.charAt(I-2)===pad&&(f=2),I-=4),C=0;C<I;C+=4)y=this._getIndex(d,C)<<18|this._getIndex(d,C+1)<<12|this._getIndex(d,C+2)<<6|this._getIndex(d,C+3),Z.push(y>>16,y>>8&255,y&255),C%1e4===0&&(_.push(String.fromCharCode.apply(null,Z)),Z=[]);switch(f){case 1:y=this._getIndex(d,I)<<12|this._getIndex(d,I+1)<<6|this._getIndex(d,I+2),Z.push(y>>10,y>>2&255);break;case 2:y=this._getIndex(d,C)<<6|this._getIndex(d,C+1),Z.push(y>>4);break}return _.push(String.fromCharCode.apply(null,Z)),B=_.join(""),n&&(B=Encoding.decode(B)),B},decodeAsArray:function(u){var n,d=this.decode(u),C=[],I=d.length;for(n=0;n<I;n++)C[n]=d.charCodeAt(n);return C}};const Base64=JXG$1.Util.Base64;JXG$1.FileReader={handleRemoteFile:function(u,n,d,C,I,f){var y=!1;try{y=new XMLHttpRequest,d.toLowerCase()==="raw"?y.overrideMimeType("text/plain; charset="+I):y.overrideMimeType("text/xml; charset="+I)}catch{try{y=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{y=new ActiveXObject("Microsoft.XMLHTTP")}catch{y=!1}}}if(!y){JXG$1.debug("AJAX not activated!");return}y.open("GET",u,C),d.toLowerCase()==="raw"?this.cbp=function(){var B=y;B.readyState===4&&n(B.responseText)}:this.cbp=function(){var B=y,_="";B.readyState===4&&(JXG$1.exists(B.responseStream)&&(B.responseText.slice(0,2)==="PK"||Encoding.asciiCharCodeAt(B.responseText.slice(0,1),0)===31)?_=Base64.decode(jxgBinFileReader(B)):_=B.responseText,this.parseString(_,n,d,f))},this.cb=JXG$1.bind(this.cbp,this),y.onreadystatechange=this.cb;try{y.send(null)}catch{throw new Error("JSXGraph: A problem occurred while trying to read remote file '"+u+"'.")}},handleLocalFile:function(u,n,d,C,I,f){JXG$1.exists(C)||(C=!0),d.toLowerCase()==="raw"?this.cbp=function(B){n(B.target.result)}:this.cbp=function(B){var _=B.target.result;this.parseString(_,n,d,f)},this.cb=JXG$1.bind(this.cbp,this);var y=new FileReader;y.onload=this.cb,d.toLowerCase()==="raw"?y.readAsText(u):y.readAsText(u,I)},parseFileContent:function(u,n,d,C,I,f){JXG$1.isString(u)||FileReader===void 0?this.handleRemoteFile(u,n,d,C,I,f):this.handleLocalFile(u,n,d,C,I,f)},parseString:function(u,n,d,C){var I,f;if(d=d.toLowerCase(),I=JXG$1.readers[d],JXG$1.exists(I))f=new I(n,u),f.read();else if(d!=="jessiecode")throw new Error("JSXGraph: There is no reader available for '"+d+"'.");JXG$1.isFunction(C)&&C(n)}};!JXG$1.isMetroApp()&&JXG$1.isBrowser&&typeof navigator=="object"&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&document&&document.write&&document.write(`<script type="text/vbscript">
Function Base64Encode(inData)
  Const Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
  Dim cOut, sOut, I
  For I = 1 To LenB(inData) Step 3
    Dim nGroup, pOut, sGroup
    nGroup = &H10000 * AscB(MidB(inData, I, 1)) + _
      &H100 * MyASC(MidB(inData, I + 1, 1)) + MyASC(MidB(inData, I + 2, 1))
    nGroup = Oct(nGroup)
    nGroup = String(8 - Len(nGroup), "0") & nGroup
    pOut = Mid(Base64, CLng("&o" & Mid(nGroup, 1, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 3, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 5, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 7, 2)) + 1, 1)
    sOut = sOut + pOut
  Next
  Select Case LenB(inData) Mod 3
    Case 1: '8 bit final
      sOut = Left(sOut, Len(sOut) - 2) + "=="
    Case 2: '16 bit final
      sOut = Left(sOut, Len(sOut) - 1) + "="
  End Select
  Base64Encode = sOut
End Function

Function MyASC(OneChar)
  If OneChar = "" Then MyASC = 0 Else MyASC = AscB(OneChar)
End Function

Function jxgBinFileReader(xhr)
    Dim byteString
    Dim b64String
    Dim i
    byteString = xhr.responseBody
    ReDim byteArray(LenB(byteString))
    For i = 1 To LenB(byteString)
        byteArray(i-1) = AscB(MidB(byteString, i, 1))
    Next
    b64String = Base64Encode(byteString)
    jxgBinFileReader = b64String
End Function
<\/script>
`);const FileReader$1=JXG$1.FileReader;JXG$1.GeonextParser={replacePow:function(u){var n,d,C,I,f,y,B,_,Z,M,V,T;for(u=u.replace(/(\s*)\^(\s*)/g,"^"),M=u.indexOf("^"),I=-1;M>=0&&M<u.length-1;){if(I===M)throw new Error("JSXGraph: Error while parsing expression '"+u+"'");if(I=M,Z=u.slice(0,M),V=u.slice(M+1),Z.charAt(Z.length-1)===")"){for(n=1,d=Z.length-2;d>=0&&n>0;)C=Z.charAt(d),C===")"?n++:C==="("&&(n-=1),d-=1;if(n===0){for(f="",B=Z.substring(0,d+1),_=d;_>=0&&B.slice(_,_+1).match(/([\w.]+)/);)f=RegExp.$1+f,_-=1;f+=Z.substring(d+1,Z.length),f=f.replace(/([()+*%^\-/\][])/g,"\\$1")}else throw new Error("JSXGraph: Missing '(' in expression")}else f="[\\w\\.]+";if(V.match(/^([\w.]*\()/)){for(n=1,d=RegExp.$1.length;d<V.length&&n>0;)C=V.charAt(d),C===")"?n-=1:C==="("&&(n+=1),d+=1;if(n===0)y=V.substring(0,d),y=y.replace(/([()+*%^\-/[\]])/g,"\\$1");else throw new Error("JSXGraph: Missing ')' in expression")}else y="[\\w\\.]+";T=new RegExp("("+f+")\\^("+y+")"),u=u.replace(T,"pow($1,$2)"),M=u.indexOf("^")}return u},replaceIf:function(u){var n,d,C,I,f,y,B,_,Z,M="",V=null,T=null,H=null;if(C=u.indexOf("If("),C<0)return u;for(u=u.replace(/""/g,"0");C>=0;){for(n=u.slice(0,C),d=u.slice(C+3),f=1,I=0,y=-1,B=-1;I<d.length&&f>0;)_=d.charAt(I),_===")"?f-=1:_==="("?f+=1:_===","&&f===1&&(y<0?y=I:B=I),I+=1;if(Z=d.slice(0,I-1),d=d.slice(I),y<0||B<0)return"";V=Z.slice(0,y),T=Z.slice(y+1,B),H=Z.slice(B+1),V=this.replaceIf(V),T=this.replaceIf(T),H=this.replaceIf(H),M+=n+"(("+V+")?("+T+"):("+H+"))",u=d,V=null,T=null,C=u.indexOf("If(")}return M+=d,M},replaceNameById:function(u,n,d){var C,I,f,y,B=0,_=["X","Y","L","V"],Z=function(M){return d?"$('"+M+"')":M};for(y=0;y<_.length;y++)for(B=u.indexOf(_[y]+"(");B>=0;)B>=0&&(C=u.indexOf(")",B+2),C>=0&&(I=u.slice(B+2,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+2)+(d?"$('":"")+Z(f.id)+u.slice(C)))),C=u.indexOf(")",B+2),B=u.indexOf(_[y]+"(",C);for(B=u.indexOf("Dist(");B>=0;)B>=0&&(C=u.indexOf(",",B+5),C>=0&&(I=u.slice(B+5,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+5)+Z(f.id)+u.slice(C)))),C=u.indexOf(",",B+5),B=u.indexOf(",",C),C=u.indexOf(")",B+1),C>=0&&(I=u.slice(B+1,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+1)+Z(f.id)+u.slice(C))),C=u.indexOf(")",B+1),B=u.indexOf("Dist(",C);for(_=["Deg","Rad"],y=0;y<_.length;y++)for(B=u.indexOf(_[y]+"(");B>=0;)B>=0&&(C=u.indexOf(",",B+4),C>=0&&(I=u.slice(B+4,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+4)+Z(f.id)+u.slice(C)))),C=u.indexOf(",",B+4),B=u.indexOf(",",C),C=u.indexOf(",",B+1),C>=0&&(I=u.slice(B+1,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+1)+Z(f.id)+u.slice(C))),C=u.indexOf(",",B+1),B=u.indexOf(",",C),C=u.indexOf(")",B+1),C>=0&&(I=u.slice(B+1,C),I=I.replace(/\\(['"])?/g,"$1"),f=n.elementsByName[I],f&&(u=u.slice(0,B+1)+Z(f.id)+u.slice(C))),C=u.indexOf(")",B+1),B=u.indexOf(_[y]+"(",C);return u},replaceIdByObj:function(u){var n=/(X|Y|L)\(([\w_]+)\)/g;return u=u.replace(n,"$('$2').$1()"),n=/(V)\(([\w_]+)\)/g,u=u.replace(n,"$('$2').Value()"),n=/(Dist)\(([\w_]+),([\w_]+)\)/g,u=u.replace(n,"dist($('$2'), $('$3'))"),n=/(Deg)\(([\w_]+),([ \w[\w_]+),([\w_]+)\)/g,u=u.replace(n,"deg($('$2'),$('$3'),$('$4'))"),n=/Rad\(([\w_]+),([\w_]+),([\w_]+)\)/g,u=u.replace(n,"rad($('$1'),$('$2'),$('$3'))"),n=/N\((.+)\)/g,u=u.replace(n,"($1)"),u},geonext2JS:function(u,n){var d,C,I,f=["Abs","ACos","ASin","ATan","Ceil","Cos","Exp","Factorial","Floor","Log","Max","Min","Random","Round","Sin","Sqrt","Tan","Trunc"],y=["abs","acos","asin","atan","ceil","cos","exp","factorial","floor","log","max","min","random","round","sin","sqrt","tan","ceil"];for(u=u.replace(/&lt;/g,"<"),u=u.replace(/&gt;/g,">"),u=u.replace(/&amp;/g,"&"),C=u,C=this.replaceNameById(C,n),C=this.replaceIf(C),C=this.replacePow(C),C=this.replaceIdByObj(C),I=0;I<f.length;I++)d=new RegExp(["(\\W|^)(",f[I],")"].join(""),"ig"),C=C.replace(d,["$1",y[I]].join(""));return C=C.replace(/True/g,"true"),C=C.replace(/False/g,"false"),C=C.replace(/fasle/g,"false"),C=C.replace(/Pi/g,"PI"),C=C.replace(/"/g,"'"),C},findDependencies:function(u,n,d){var C,I,f,y;JXG$1.exists(d)||(d=u.board),C=d.elementsByName;for(I in C)C.hasOwnProperty(I)&&I!==u.name&&(C[I].elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(C[I].visProp.islabel)||(y=I.replace(/\[/g,"\\["),y=y.replace(/\]/g,"\\]"),f=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+y+")(,[\\w\\[\\]'_ ]+)*\\)","g"),n.search(f)>=0&&C[I].addChild(u)):(y=I.replace(/\[/g,"\\["),y=y.replace(/\]/g,"\\]"),f=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+y+")(,[\\w\\[\\]'_ ]+)*\\)","g"),n.search(f)>=0&&C[I].addChild(u)))},gxt2jc:function(u,n){var d;return u=u.replace(/&lt;/g,"<"),u=u.replace(/&gt;/g,">"),u=u.replace(/&amp;/g,"&"),d=u,d=this.replaceNameById(d,n,!0),d=d.replace(/True/g,"true"),d=d.replace(/False/g,"false"),d=d.replace(/fasle/g,"false"),d}};const GeonextParser=JXG$1.GeonextParser;JXG$1.GeometryElement=function(u,n,d,C){var I,f,y;if(this.needsUpdate=!0,this.isDraggable=!1,this.isReal=!0,this.childElements={},this.hasLabel=!1,this.highlighted=!1,this.notExistingParents={},this.traces={},this.numTraces=0,this.transformations=[],this.baseElement=null,this.descendants={},this.ancestors={},this.parents=[],this.symbolic={},this.rendNode=null,this.elType="",this.dump=!0,this.subs={},this.inherits=[],this._pos=-1,this.stdform=[1,0,0,0,1,1,0,0],this.methodMap={setLabel:"setLabel",label:"label",setName:"setName",getName:"getName",Name:"getName",addTransform:"addTransform",setProperty:"setAttribute",setAttribute:"setAttribute",addChild:"addChild",animate:"animate",on:"on",off:"off",trigger:"trigger",addTicks:"addTicks",removeTicks:"removeTicks",removeAllTicks:"removeAllTicks",Bounds:"bounds"},this.quadraticform=[[1,0,0],[0,1,0],[0,0,1]],this.visProp={},this.visPropCalc={visible:!1},EventEmitter.eventify(this),this.mouseover=!1,this.lastDragTime=new Date,this.view=null,arguments.length>0){this.board=u,this.type=d,this._org_type=d,this.elementClass=C||Const.OBJECT_CLASS_OTHER,this.id=n.id,I=n.name,JXG$1.exists(I)||(I=this.board.generateName(this)),I!==""&&(this.board.elementsByName[I]=this),this.name=I,this.needsRegularUpdate=n.needsregularupdate,JXG$1.clearVisPropOld(this),y=this.resolveShortcuts(n);for(f in y)y.hasOwnProperty(f)&&this._set(f,y[f]);this.visProp.draft=y.draft&&y.draft.draft}};JXG$1.extend(JXG$1.GeometryElement.prototype,{addChild:function(u){var n,d;this.childElements[u.id]=u,this.addDescendants(u),u.ancestors[this.id]=this;for(n in this.descendants)if(this.descendants.hasOwnProperty(n)){this.descendants[n].ancestors[this.id]=this;for(d in this.ancestors)this.ancestors.hasOwnProperty(d)&&(this.descendants[n].ancestors[this.ancestors[d].id]=this.ancestors[d])}for(n in this.ancestors)if(this.ancestors.hasOwnProperty(n))for(d in this.descendants)this.descendants.hasOwnProperty(d)&&(this.ancestors[n].descendants[this.descendants[d].id]=this.descendants[d]);return this},addDescendants:function(u){var n;this.descendants[u.id]=u;for(n in u.childElements)u.childElements.hasOwnProperty(n)&&this.addDescendants(u.childElements[n]);return this},addParents:function(u){var n,d,C;for(JXG$1.isArray(u)?C=u:C=arguments,d=C.length,n=0;n<d;++n)JXG$1.exists(C[n])&&(JXG$1.isId(this.board,C[n])?this.parents.push(C[n]):JXG$1.exists(C[n].id)&&this.parents.push(C[n].id));this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(u){this.parents=[],this.addParents(u)},addParentsFromJCFunctions:function(u){var n,d,C;for(n=0;n<u.length;n++)for(d in u[n].deps)C=u[n].deps[d],this.addParents(C),C.addChild(this);return this},removeChild:function(u){return delete this.childElements[u.id],this.removeDescendants(u),delete u.ancestors[this.id],this},removeDescendants:function(u){var n;delete this.descendants[u.id];for(n in u.childElements)u.childElements.hasOwnProperty(n)&&this.removeDescendants(u.childElements[n]);return this},countChildren:function(){var u,n,d=0;n=this.childElements;for(u in n)n.hasOwnProperty(u)&&u.indexOf("Label")<0&&d++;return d},getName:function(){return this.name},addTransform:function(u){return this},draggable:function(){return this.isDraggable&&!JXG$1.evaluate(this.visProp.fixed)&&this.type!==Const.OBJECT_TYPE_GLIDER},setPosition:function(u,n){var d=[],C,I,f,y;if(!JXG$1.exists(this.parents))return this;for(f=this.parents.length,I=0;I<f;++I)if(C=this.board.select(this.parents[I]),JXG$1.isPoint(C)){if(!C.draggable())return this;d.push(C)}if(n.length===3&&(n=n.slice(1)),y=this.board.create("transform",n,{type:"translate"}),f=d.length,f>0){if(y.applyOnce(d),JXG$1.exists(this.view)&&this.view.elType==="view3d")for(I=0;I<this.parents.length;++I)C=this.view.select(this.parents[I]),JXG$1.exists(C.setPosition2D)&&C.setPosition2D(y)}else this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(y):this.addTransform(y);for(I=0;I<f;++I)d[I].type===Const.OBJECT_TYPE_GLIDER&&d[I].updateGlider();return this},setPositionDirectly:function(u,n,d){var C=new Coords(u,n,this.board,!1),I=new Coords(u,d,this.board,!1),f=Statistics.subtract(C.usrCoords,I.usrCoords);return this.setPosition(Const.COORDS_BY_USER,f),this},generatePolynomial:function(){return[]},animate:function(u,n,d){d=d||{};var C,I,f,y=this.board.attr.animationdelay,B=Math.ceil(n/y),_=this,Z=function(V,T,H){var F,O,$,U,ee;for(F=JXG$1.rgb2hsv(V),O=JXG$1.rgb2hsv(T),$=(O[0]-F[0])/B,U=(O[1]-F[1])/B,ee=(O[2]-F[2])/B,_.animationData[H]=[],f=0;f<B;f++)_.animationData[H][B-f-1]=JXG$1.hsv2rgb(F[0]+(f+1)*$,F[1]+(f+1)*U,F[2]+(f+1)*ee)},M=function(V,T,H,F){var O,$;if(V=parseFloat(V),T=parseFloat(T),!(isNaN(V)||isNaN(T)))for($=(T-V)/B,_.animationData[H]=[],f=0;f<B;f++)O=V+(f+1)*$,_.animationData[H][B-f-1]=F?Math.floor(O):O};this.animationData={};for(C in u)if(u.hasOwnProperty(C))switch(I=C.toLowerCase(),I){case"strokecolor":case"fillcolor":Z(this.visProp[I],u[C],I);break;case"size":if(!JXG$1.isPoint(this))break;M(this.visProp[I],u[C],I,!0);break;case"strokeopacity":case"strokewidth":case"fillopacity":M(this.visProp[I],u[C],I,!1);break}return this.animationCallback=d.callback,this.board.addAnimation(this),this},update:function(){return JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(),this},updateRenderer:function(){return this},fullUpdate:function(u){return this.prepareUpdate().update().updateVisibility(u).updateRenderer()},setDisplayRendNode:function(u){var n,d,C,I,f;if(u===void 0&&(u=this.visPropCalc.visible),u===this.visPropOld.visible)return this;for(this.board.renderer.display(this,u),d=this.inherits.length,C=0;C<d;C++)if(f=this.inherits[C],JXG$1.isArray(f))for(I=f.length,n=0;n<I;n++)JXG$1.exists(f[n])&&JXG$1.exists(f[n].rendNode)&&JXG$1.evaluate(f[n].visProp.visible)==="inherit"&&f[n].setDisplayRendNode(u);else JXG$1.exists(f)&&JXG$1.exists(f.rendNode)&&JXG$1.evaluate(f.visProp.visible)==="inherit"&&f.setDisplayRendNode(u);return this.hasLabel&&JXG$1.exists(this.label)&&JXG$1.exists(this.label.rendNode)&&JXG$1.evaluate(this.label.visProp.visible)==="inherit"&&this.label.setDisplayRendNode(u),this},hide:function(){return this.setAttribute({visible:!1}),this},hideElement:function(){return this.hide(),this},show:function(){return this.setAttribute({visible:!0}),this},showElement:function(){return this.show(),this},updateVisibility:function(u){var n,d,C,I,f,y;if(this.needsUpdate){if(JXG$1.exists(this.view)&&JXG$1.evaluate(this.view.visProp.visible)===!1)this.visPropCalc.visible=!1;else for(u!==void 0?this.visPropCalc.visible=u:(y=JXG$1.evaluate(this.visProp.visible),JXG$1.exists(this.hiddenByParent)&&this.hiddenByParent&&(y=!1),y!=="inherit"&&(this.visPropCalc.visible=y)),d=this.inherits.length,C=0;C<d;C++)if(f=this.inherits[C],JXG$1.isArray(f))for(I=f.length,n=0;n<I;n++)JXG$1.exists(f[n])&&JXG$1.evaluate(f[n].visProp.visible)==="inherit"&&f[n].prepareUpdate().updateVisibility(this.visPropCalc.visible);else JXG$1.exists(f)&&JXG$1.evaluate(f.visProp.visible)==="inherit"&&f.prepareUpdate().updateVisibility(this.visPropCalc.visible);JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp)&&JXG$1.evaluate(this.label.visProp.visible)&&this.label.prepareUpdate().updateVisibility(this.visPropCalc.visible)}return this},_set:function(u,n){var d;if(u=u.toLocaleLowerCase(),this.visProp.hasOwnProperty(u)&&u.indexOf("color")>=0&&JXG$1.isString(n)&&n.length===9&&n.charAt(0)==="#")n=JXG$1.rgba2rgbo(n),this.visProp[u]=n[0],this.visProp[u.replace("color","opacity")]=n[1];else if(n!==null&&JXG$1.isObject(n)&&!JXG$1.exists(n.id)&&!JXG$1.exists(n.name)){this.visProp[u]={};for(d in n)n.hasOwnProperty(d)&&(this.visProp[u][d.toLocaleLowerCase()]=n[d])}else this.visProp[u]=n},resolveShortcuts:function(u){var n,d,C,I=["traceattributes","traceAttributes"];for(n in Options.shortcuts)if(Options.shortcuts.hasOwnProperty(n)){if(JXG$1.exists(u[n]))for(d=0;d<Options.shortcuts[n].length;d++)JXG$1.exists(u[Options.shortcuts[n][d]])||(u[Options.shortcuts[n][d]]=u[n]);for(C=0;C<I.length;C++)JXG$1.isObject(u[I[C]])&&(u[I[C]]=this.resolveShortcuts(u[I[C]]))}return u},setLabel:function(u){this.hasLabel||this.setAttribute({withlabel:!0}),this.setLabelText(u)},setLabelText:function(u){return JXG$1.exists(this.label)&&(u=u.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.label.setText(u)),this},setName:function(u){u=u.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.elType!=="slider"&&this.setLabelText(u),this.setAttribute({name:u})},setProperty:function(){JXG$1.deprecated("setProperty()","setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(u){var n,d,C,I,f,y,B,_,Z,M={};for(n=0;n<arguments.length;n++)y=arguments[n],JXG$1.isString(y)?(_=y.split(":"),M[JXG$1.trim(_[0])]=JXG$1.trim(_[1])):JXG$1.isArray(y)?M[y[0]]=y[1]:JXG$1.extend(M,y);M=this.resolveShortcuts(M);for(n in M)if(M.hasOwnProperty(n)){if(I=n.replace(/\s+/g,"").toLowerCase(),f=M[n],JXG$1.isObject(f)&&JXG$1.exists(this.visProp[I])){if(this.visProp[I]=JXG$1.merge(this.visProp[I],f),this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.exists(this.labels))for(C=this.labels.length,d=0;d<C;d++)this.labels[d].setAttribute(f);else if(JXG$1.exists(this[I]))if(JXG$1.isArray(this[I]))for(d=0;d<this[I].length;d++)this[I][d].setAttribute(f);else this[I].setAttribute(f);continue}switch(Z=this.visProp[I],I){case"checked":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeCheckbox.checked=!!f);break;case"disabled":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.disabled=!!f);break;case"face":JXG$1.isPoint(this)&&(this.visProp.face=f,this.board.renderer.changePointStyle(this));break;case"generatelabelvalue":this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.isFunction(f)&&(this.generateLabelValue=f);break;case"gradient":this.visProp.gradient=f,this.board.renderer.setGradient(this);break;case"gradientsecondcolor":f=JXG$1.rgba2rgbo(f),this.visProp.gradientsecondcolor=f[0],this.visProp.gradientsecondopacity=f[1],this.board.renderer.updateGradient(this);break;case"gradientsecondopacity":this.visProp.gradientsecondopacity=f,this.board.renderer.updateGradient(this);break;case"infoboxtext":JXG$1.isString(f)?this.infoboxText=f:this.infoboxText=!1;break;case"labelcolor":f=JXG$1.rgba2rgbo(f),B=f[1],f=f[0],B===0&&JXG$1.exists(this.label)&&this.hasLabel&&this.label.hideElement(),JXG$1.exists(this.label)&&this.hasLabel&&(this.label.visProp.strokecolor=f,this.board.renderer.setObjectStrokeColor(this.label,f,B)),this.elementClass===Const.OBJECT_CLASS_TEXT&&(this.visProp.strokecolor=f,this.visProp.strokeopacity=B,this.board.renderer.setObjectStrokeColor(this,f,B));break;case"layer":this.board.renderer.setLayer(this,JXG$1.evaluate(f)),this._set(I,f);break;case"maxlength":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.maxlength=!!f);break;case"name":Z=this.name,delete this.board.elementsByName[this.name],this.name=f,this.board.elementsByName[this.name]=this;break;case"needsregularupdate":this.needsRegularUpdate=!(f==="false"||f===!1),this.board.renderer.setBuffering(this,this.needsRegularUpdate?"auto":"static");break;case"onpolygon":this.type===Const.OBJECT_TYPE_GLIDER&&(this.onPolygon=!!f);break;case"radius":(this.type===Const.OBJECT_TYPE_ANGLE||this.type===Const.OBJECT_TYPE_SECTOR)&&this.setRadius(f);break;case"rotate":(this.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(this.visProp.display)==="internal"||this.type===Const.OBJECT_TYPE_IMAGE)&&this.addRotation(f);break;case"tabindex":JXG$1.exists(this.rendNode)&&(this.rendNode.setAttribute("tabindex",f),this._set(I,f));break;case"trace":f==="false"||f===!1?(this.clearTrace(),this.visProp.trace=!1):f==="pause"?this.visProp.trace=!1:this.visProp.trace=!0;break;case"visible":f==="false"?this.visProp.visible=!1:f==="true"?this.visProp.visible=!0:this.visProp.visible=f,this.setDisplayRendNode(JXG$1.evaluate(this.visProp.visible)),JXG$1.evaluate(this.visProp.visible)&&JXG$1.exists(this.updateSize)&&this.updateSize();break;case"withlabel":this.visProp.withlabel=f,JXG$1.evaluate(f)?(this.label||this.createLabel(),this.label.setAttribute({visible:"inherit"})):this.label&&this.hasLabel&&this.label.setAttribute({visible:!1}),this.hasLabel=f;break;case"straightfirst":case"straightlast":this._set(I,f);for(d in this.childElements)this.childElements.hasOwnProperty(d)&&this.childElements[d].elType==="glider"&&this.childElements[d].fullUpdate();break;default:JXG$1.exists(this.visProp[I])&&(!JXG$1.Validator[I]||JXG$1.Validator[I]&&JXG$1.Validator[I](f)||JXG$1.Validator[I]&&JXG$1.isFunction(f)&&JXG$1.Validator[I](f()))&&(f=f.toLowerCase&&f.toLowerCase()==="false"?!1:f,this._set(I,f));break}this.triggerEventHandlers(["attribute:"+I],[Z,f,this])}return this.triggerEventHandlers(["attribute"],[M,this]),JXG$1.evaluate(this.visProp.needsregularupdate)?this.board.update(this):this.board.fullUpdate(),this.elementClass===Const.OBJECT_CLASS_TEXT&&this.updateSize(),this},getProperty:function(){JXG$1.deprecated("getProperty()","getAttribute()"),this.getProperty.apply(this,arguments)},getAttribute:function(u){var n;switch(u=u.toLowerCase(),u){case"needsregularupdate":n=this.needsRegularUpdate;break;case"labelcolor":n=this.label.visProp.strokecolor;break;case"infoboxtext":n=this.infoboxText;break;case"withlabel":n=this.hasLabel;break;default:n=this.visProp[u];break}return n},setDash:function(u){return this.setAttribute({dash:u}),this},prepareUpdate:function(){return this.needsUpdate=!0,this},remove:function(){return this.board.renderer.remove(this.rendNode),this.hasLabel&&this.board.renderer.remove(this.board.renderer.getElementById(this.label.id)),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},getLabelAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},setArrow:function(u,n){return this.visProp.firstarrow=u,this.visProp.lastarrow=n,n&&(this.type=Const.OBJECT_TYPE_VECTOR,this.elType="arrow"),this.prepareUpdate().update().updateVisibility().updateRenderer(),this},createGradient:function(){var u=JXG$1.evaluate(this.visProp.gradient);(u==="linear"||u==="radial")&&this.board.renderer.setGradient(this)},createLabel:function(){var u,n=this;return JXG$1.elements.text?(u=JXG$1.deepCopy(this.visProp.label,null),u.id=this.id+"Label",u.isLabel=!0,u.anchor=this,u.priv=this.visProp.priv,this.visProp.withlabel&&(this.label=JXG$1.elements.text(this.board,[0,0,function(){return JXG$1.isFunction(n.name)?n.name():n.name}],u),this.label.needsUpdate=!0,this.label.dump=!1,this.label.fullUpdate(),this.hasLabel=!0)):JXG$1.debug("JSXGraph: Can't create label: text element is not available. Make sure you include base/text"),this},highlight:function(u){return u=JXG$1.def(u,!1),JXG$1.evaluate(this.visProp.highlight)&&(!this.highlighted||u)&&(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this)),this},noHighlight:function(){return this.highlighted&&(this.highlighted=!1,delete this.board.highlightedObjects[this.id],this.board.renderer.noHighlight(this)),this},clearTrace:function(){var u;for(u in this.traces)this.traces.hasOwnProperty(u)&&this.board.renderer.remove(this.traces[u]);return this.numTraces=0,this},cloneToBackground:function(){return this},bounds:function(){return[0,0,0,0]},normalize:function(){return this.stdform=Mat.normalize(this.stdform),this},toJSON:function(){var u,n,d=['{"name":',this.name];d.push(', "id":'+this.id),u=[];for(n in this.visProp)this.visProp.hasOwnProperty(n)&&JXG$1.exists(this.visProp[n])&&u.push('"'+n+'":'+this.visProp[n]);return d.push(', "visProp":{'+u.toString()+"}"),d.push("}"),d.join("")},addRotation:function(u){var n,d,C,I,f,y=this;return(this.elementClass===Const.OBJECT_CLASS_TEXT||this.type===Const.OBJECT_TYPE_IMAGE)&&u!==0&&(n=this.board.create("transform",[function(){return-y.X()},function(){return-y.Y()}],{type:"translate"}),d=this.board.create("transform",[function(){return y.X()},function(){return y.Y()}],{type:"translate"}),C=this.board.create("transform",[function(){return y.board.unitX/y.board.unitY},function(){return 1}],{type:"scale"}),I=this.board.create("transform",[function(){return y.board.unitY/y.board.unitX},function(){return 1}],{type:"scale"}),f=this.board.create("transform",[function(){return JXG$1.evaluate(u)*Math.PI/180}],{type:"rotate"}),n.bindTo(this),C.bindTo(this),f.bindTo(this),I.bindTo(this),d.bindTo(this)),this},highlightStrokeColor:function(u){return JXG$1.deprecated("highlightStrokeColor()","setAttribute()"),this.setAttribute({highlightStrokeColor:u}),this},strokeColor:function(u){return JXG$1.deprecated("strokeColor()","setAttribute()"),this.setAttribute({strokeColor:u}),this},strokeWidth:function(u){return JXG$1.deprecated("strokeWidth()","setAttribute()"),this.setAttribute({strokeWidth:u}),this},fillColor:function(u){return JXG$1.deprecated("fillColor()","setAttribute()"),this.setAttribute({fillColor:u}),this},highlightFillColor:function(u){return JXG$1.deprecated("highlightFillColor()","setAttribute()"),this.setAttribute({highlightFillColor:u}),this},labelColor:function(u){return JXG$1.deprecated("labelColor()","setAttribute()"),this.setAttribute({labelColor:u}),this},dash:function(u){return JXG$1.deprecated("dash()","setAttribute()"),this.setAttribute({dash:u}),this},visible:function(u){return JXG$1.deprecated("visible()","setAttribute()"),this.setAttribute({visible:u}),this},shadow:function(u){return JXG$1.deprecated("shadow()","setAttribute()"),this.setAttribute({shadow:u}),this},getType:function(){return this.elType},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},snapToGrid:function(){return this},snapToPoints:function(){return this},getAttributes:function(){var u=JXG$1.deepCopy(this.visProp),n=[],d,C=n.length;for(u.id=this.id,u.name=this.name,d=0;d<C;d++)delete u[n[d]];return u},hasPoint:function(u,n){return!1},addTicks:function(u){return(u.id===""||!JXG$1.exists(u.id))&&(u.id=this.id+"_ticks_"+(this.ticks.length+1)),this.board.renderer.drawTicks(u),this.ticks.push(u),u.id},removeAllTicks:function(){var u;if(JXG$1.exists(this.ticks)){for(u=this.ticks.length-1;u>=0;u--)this.removeTicks(this.ticks[u]);this.ticks=[],this.board.update()}},removeTicks:function(u){var n,d;if(JXG$1.exists(this.defaultTicks)&&this.defaultTicks===u&&(this.defaultTicks=null),JXG$1.exists(this.ticks)){for(n=this.ticks.length-1;n>=0;n--)if(this.ticks[n]===u){if(this.board.removeObject(this.ticks[n]),this.ticks[n].ticks)for(d=0;d<this.ticks[n].ticks.length;d++)JXG$1.exists(this.ticks[n].labels[d])&&this.board.removeObject(this.ticks[n].labels[d]);delete this.ticks[n];break}}},getSnapSizes:function(){var u,n,d;return u=JXG$1.evaluate(this.visProp.snapsizex),n=JXG$1.evaluate(this.visProp.snapsizey),u<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(d=this.board.defaultAxes.x.defaultTicks,u=d.ticksDelta*(JXG$1.evaluate(d.visProp.minorticks)+1)),n<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(d=this.board.defaultAxes.y.defaultTicks,n=d.ticksDelta*(JXG$1.evaluate(d.visProp.minorticks)+1)),[u,n]},handleSnapToGrid:function(u,n){var d,C,I,f,y,B,_,Z,M,V,T,H=!1,F=JXG$1.evaluate(this.visProp.attracttogrid),O=JXG$1.evaluate(this.visProp.attractorunit),$=JXG$1.evaluate(this.visProp.attractordistance);return!JXG$1.exists(this.coords)||JXG$1.evaluate(this.visProp.fixed)?this:(H=JXG$1.evaluate(this.visProp.snaptogrid)||F||u===!0,H&&(d=this.coords.usrCoords[1],C=this.coords.usrCoords[2],M=this.getSnapSizes(),V=M[0],T=M[1],V>0&&T>0&&(Z=this.board.getBoundingBox(),I=Math.round(d/V)*V,f=Math.round(C/T)*T,y=new JXG$1.Coords(Const.COORDS_BY_USER,[I,f],this.board),(!F||y.distance(O==="screen"?Const.COORDS_BY_SCREEN:Const.COORDS_BY_USER,this.coords)<$)&&(d=I,C=f,n||(B=Math.min(Z[0],Z[2]),_=Math.max(Z[0],Z[2]),d<B&&d>B-V?d+=V:d>_&&d<_+V&&(d-=V),B=Math.min(Z[1],Z[3]),_=Math.max(Z[1],Z[3]),C<B&&C>B-T?C+=T:C>_&&C<_+T&&(C-=T)),this.coords.setCoordinates(Const.COORDS_BY_USER,[d,C])))),this)},getBoundingBox:function(){var u,n,d,C,I,f=[1/0,1/0,-1/0,-1/0];if(this.type===Const.OBJECT_TYPE_POLYGON){if(n=this.vertices.length-1,n<=0)return f;for(u=0;u<n;u++)d=this.vertices[u].X(),f[0]=d<f[0]?d:f[0],f[2]=d>f[2]?d:f[2],d=this.vertices[u].Y(),f[1]=d<f[1]?d:f[1],f[3]=d>f[3]?d:f[3]}else if(this.elementClass===Const.OBJECT_CLASS_CIRCLE)C=this.center.X(),I=this.center.Y(),f=[C-this.radius,I+this.radius,C+this.radius,I-this.radius];else if(this.elementClass===Const.OBJECT_CLASS_CURVE){if(n=this.vertices.length,n===0)return f;for(u=0;u<n;u++)d=this.points[u].coords.usrCoords[1],f[0]=d<f[0]?d:f[0],f[2]=d>f[2]?d:f[2],d=this.points[u].coords.usrCoords[1],f[1]=d<f[1]?d:f[1],f[3]=d>f[3]?d:f[3]}return f},addEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"on"),removeEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"off"),formatNumberLocale:function(u,n){var d,C,I,f={},y={maximumfractiondigits:"maximumFractionDigits",minimumfractiondigits:"minimumFractionDigits",compactdisplay:"compactDisplay",currencydisplay:"currencyDisplay",currencysign:"currencySign",localematcher:"localeMatcher",numberingsystem:"numberingSystem",signdisplay:"signDisplay",unitdisplay:"unitDisplay",usegrouping:"useGrouping",roundingmode:"roundingMode",roundingpriority:"roundingPriority",roundingincrement:"roundingIncrement",trailingzerodisplay:"trailingZeroDisplay",minimumintegerdigits:"minimumIntegerDigits",minimumsignificantdigits:"minimumSignificantDigits",maximumsignificantdigits:"maximumSignificantDigits"};if(JXG$1.exists(Intl)&&this.useLocale()){d=JXG$1.evaluate(this.visProp.intl.locale)||JXG$1.evaluate(this.board.attr.intl.locale),C=JXG$1.evaluate(this.visProp.intl.options)||{};for(I in C)C.hasOwnProperty(I)&&(y.hasOwnProperty(I)?f[y[I]]=JXG$1.evaluate(C[I]):f[I]=JXG$1.evaluate(C[I]));return I="maximumfractiondigits",JXG$1.exists(C[I])||(f[y[I]]=n),Intl.NumberFormat(d,f).format(u)}return u},useLocale:function(){var u;return!JXG$1.exists(this.visProp.intl)||!JXG$1.exists(this.visProp.intl.enabled)?!1:(u=JXG$1.evaluate(this.visProp.intl.enabled),u===!0||u==="inherit"&&JXG$1.evaluate(this.board.attr.intl.enabled)===!0)},__evt__over:function(u){},__evt__mouseover:function(u){},__evt__out:function(u){},__evt__mouseout:function(u){},__evt__move:function(u){},__evt__mousemove:function(u){},__evt__drag:function(u){},__evt__mousedrag:function(u){},__evt__pendrag:function(u){},__evt__touchdrag:function(u){},__evt__keydrag:function(u){},__evt__down:function(u){},__evt__mousedown:function(u){},__evt__pendown:function(u){},__evt__touchdown:function(u){},__evt__click:function(u){},__evt__dblclick:function(u){},__evt__mouseclick:function(u){},__evt__mousedblclick:function(u){},__evt__pointerclick:function(u){},__evt__pointerdblclick:function(u){},__evt__up:function(u){},__evt__mouseup:function(u){},__evt__penup:function(u){},__evt__touchup:function(u){},__evt__attribute:function(u,n){},__evt__attribute_:function(u,n,d){},__evt:function(){}});const GeometryElement=JXG$1.GeometryElement;JXG$1.CoordsElement=function(u,n){var d;for(JXG$1.exists(u)||(u=[1,0,0]),d=0;d<u.length;++d)u[d]=parseFloat(u[d]);this.coords=new Coords(Const.COORDS_BY_USER,u,this.board),this.initialCoords=new Coords(Const.COORDS_BY_USER,u,this.board),this.position=null,this.isConstrained=!1,this.onPolygon=!1,this.slideObject=null,this.slideObjects=[],this.needsUpdateFromParent=!0,this.groups=[],this.Xjc=null,this.Yjc=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{move:"moveTo",moveTo:"moveTo",moveAlong:"moveAlong",visit:"visit",glide:"makeGlider",makeGlider:"makeGlider",intersect:"makeIntersection",makeIntersection:"makeIntersection",X:"X",Y:"Y",Coords:"Coords",free:"free",setPosition:"setGliderPosition",setGliderPosition:"setGliderPosition",addConstraint:"addConstraint",dist:"Dist",Dist:"Dist",onPolygon:"onPolygon",startAnimation:"startAnimation",stopAnimation:"stopAnimation"}),JXG$1.exists(this.element)&&this.addAnchor(u,n),this.isDraggable=!0};JXG$1.extend(JXG$1.CoordsElement.prototype,{updateConstraint:function(){return this},updateCoords:function(u){return this.needsUpdate?(JXG$1.exists(u)||(u=!1),JXG$1.evaluate(this.visProp.frozen)||this.updateConstraint(),this.type===Const.OBJECT_TYPE_GLIDER&&(this.isConstrained&&(u=!1),u?this.updateGliderFromParent():this.updateGlider()),this.updateTransform(u),this):this},updateGlider:function(){var u,n,d,C,I,f,y,B,_,Z,M,V,T=2*Math.PI,H,F,O,$,U,ee=!1,Q,ie,ne,le=this.slideObject,ae,ce,ge=[],he;if(this.needsUpdateFromParent=!1,le.elementClass===Const.OBJECT_CLASS_CIRCLE)JXG$1.evaluate(this.visProp.isgeonext)&&(T=1),$=Geometry.projectPointToCircle(this,le,this.board),U=Geometry.rad([le.center.X()+1,le.center.Y()],le.center,this)/T;else if(le.elementClass===Const.OBJECT_CLASS_LINE){if(this.onPolygon){if(C=le.point1.coords.usrCoords,I=le.point2.coords.usrCoords,u=1,n=I[u]-C[u],Math.abs(n)<Mat.eps&&(u=2,n=I[u]-C[u]),y=Geometry.projectPointToLine(this,le,this.board),B=(y.usrCoords[u]-C[u])/n,f=le.parentPolygon,B<0){for(u=0;u<f.borders.length;u++)if(le===f.borders[u]){le=f.borders[(u-1+f.borders.length)%f.borders.length];break}}else if(B>1){for(u=0;u<f.borders.length;u++)if(le===f.borders[u]){le=f.borders[(u+1+f.borders.length)%f.borders.length];break}}le.id!==this.slideObject.id&&(this.slideObject=le)}C=le.point1.coords,I=le.point2.coords,n=C.distance(Const.COORDS_BY_USER,I),n<Mat.eps?($=C,ee=!0,U=0):($=Geometry.projectPointToLine(this,le,this.board),C=C.usrCoords.slice(0),I=I.usrCoords.slice(0),Math.abs(I[0])<Mat.eps?(u=1,n=I[u],Math.abs(n)<Mat.eps&&(u=2,n=I[u]),n=($.usrCoords[u]-C[u])/n,Z=n>=0?1:-1,n=Math.abs(n),U=Z*n/(n+1)):Math.abs(C[0])<Mat.eps?(u=1,n=C[u],Math.abs(n)<Mat.eps&&(u=2,n=C[u]),n=($.usrCoords[u]-I[u])/n,n<0?U=(1-2*n)/(1-n):U=1/(n+1)):(u=1,n=I[u]-C[u],Math.abs(n)<Mat.eps&&(u=2,n=I[u]-C[u]),U=($.usrCoords[u]-C[u])/n)),ie=this.findClosestSnapValue(U),ie!==null?(ne=JXG$1.evaluate(this.visProp.snapvalues),U=(ne[ie]-this._smin)/(this._smax-this._smin),this.update(!0)):(Q=JXG$1.evaluate(this.visProp.snapwidth),JXG$1.evaluate(Q)>0&&Math.abs(this._smax-this._smin)>=Mat.eps&&(U=Math.max(Math.min(U,1),0),d=U*(this._smax-this._smin)+this._smin,d=Math.round(d/Q)*Q,U=(d-this._smin)/(this._smax-this._smin),this.update(!0))),C=le.point1.coords,!JXG$1.evaluate(le.visProp.straightfirst)&&Math.abs(C.usrCoords[0])>Mat.eps&&U<0&&($=C,ee=!0,U=0),I=le.point2.coords,!JXG$1.evaluate(le.visProp.straightlast)&&Math.abs(I.usrCoords[0])>Mat.eps&&U>1&&($=I,ee=!0,U=1)}else if(le.type===Const.OBJECT_TYPE_TURTLE)this.updateConstraint(),ae=Geometry.projectPointToTurtle(this,le,this.board),$=ae[0],U=ae[1];else if(le.elementClass===Const.OBJECT_CLASS_CURVE)if(le.type===Const.OBJECT_TYPE_ARC||le.type===Const.OBJECT_TYPE_SECTOR)$=Geometry.projectPointToCircle(this,le,this.board),_=Geometry.rad(le.radiuspoint,le.center,this),M=0,V=Geometry.rad(le.radiuspoint,le.center,le.anglepoint),U=_,Q=JXG$1.evaluate(le.visProp.selection),(Q==="minor"&&V>Math.PI||Q==="major"&&V<Math.PI)&&(M=V,V=2*Math.PI),(_<M||_>V)&&(U=V,(_<M&&_>M*.5||_>V&&_>V*.5+Math.PI)&&(U=M),this.needsUpdateFromParent=!0,this.updateGliderFromParent()),T=V-M,this.visProp.isgeonext&&(T=1),Math.abs(T)>Mat.eps&&(U/=T);else if(this.updateConstraint(),le.transformations.length>0){for(he=!1,ae=le.getTransformationSource(),ae[0]&&(he=ae[0],ge.push(le),ge.push(ae[1]));ae[0]&&JXG$1.exists(ae[1]._transformationSource);)ae=ae[1].getTransformationSource(),ge.push(ae[1]);if(ce=this.coords.usrCoords,he){for(u=0;u<ge.length;u++)ge[u].updateTransformMatrix(),O=Mat.inverse(ge[u].transformMat),ce=Mat.matVecMult(O,ce);for(H=new Coords(Const.COORDS_BY_USER,ce,this.board).usrCoords,F=Geometry.projectCoordsToCurve(H[1],H[2],this.position||0,ge[ge.length-1],this.board),ce=F[0].usrCoords,u=ge.length-2;u>=0;u--)ce=Mat.matVecMult(ge[u].transformMat,ce);F[0]=new Coords(Const.COORDS_BY_USER,ce,this.board)}else le.updateTransformMatrix(),O=Mat.inverse(le.transformMat),ce=Mat.matVecMult(O,ce),H=new Coords(Const.COORDS_BY_USER,ce,this.board).usrCoords,F=Geometry.projectCoordsToCurve(H[1],H[2],this.position||0,le,this.board);$=F[0],U=F[1]}else ae=Geometry.projectPointToCurve(this,le,this.board),$=ae[0],U=ae[1];else JXG$1.isPoint(le)&&($=Geometry.projectPointToPoint(this,le,this.board),U=this.position);this.coords.setCoordinates(Const.COORDS_BY_USER,$.usrCoords,ee),this.position=U},findClosestSnapValue:function(u){var n,d,C,I,f=null;if(C=JXG$1.evaluate(this.visProp.snapvalues),I=JXG$1.evaluate(this.visProp.snapvaluedistance),JXG$1.isArray(C)&&Math.abs(this._smax-this._smin)>=Mat.eps&&I>0)for(n=0;n<C.length;n++)d=Math.abs(u*(this._smax-this._smin)+this._smin-C[n]),d<I&&(I=d,f=n);return f},updateGliderFromParent:function(){var u,n,d,C,I,f=this.slideObject,y=[],B,_,Z,M,V,T,H,F=2*Math.PI;if(!this.needsUpdateFromParent){this.needsUpdateFromParent=!0;return}if(f.elementClass===Const.OBJECT_CLASS_CIRCLE)d=f.Radius(),JXG$1.evaluate(this.visProp.isgeonext)&&(F=1),I=[f.center.X()+d*Math.cos(this.position*F),f.center.Y()+d*Math.sin(this.position*F)];else if(f.elementClass===Const.OBJECT_CLASS_LINE)u=f.point1.coords.usrCoords,n=f.point2.coords.usrCoords,u[0]===0&&u[1]===0&&u[2]===0||n[0]===0&&n[1]===0&&n[2]===0?I=[0,0,0]:Math.abs(n[0])<Mat.eps?(C=Math.min(Math.abs(this.position),1-Mat.eps),C/=1-C,this.position<0&&(C=-C),I=[u[0]+C*n[0],u[1]+C*n[1],u[2]+C*n[2]]):Math.abs(u[0])<Mat.eps?(C=Math.max(this.position,Mat.eps),C=Math.min(C,2-Mat.eps),C>1?C=(C-1)/(C-2):C=(1-C)/C,I=[n[0]+C*u[0],n[1]+C*u[1],n[2]+C*u[2]]):(C=this.position,I=[u[0]+C*(n[0]-u[0]),u[1]+C*(n[1]-u[1]),u[2]+C*(n[2]-u[2])]);else if(f.type===Const.OBJECT_TYPE_TURTLE)this.coords.setCoordinates(Const.COORDS_BY_USER,[f.Z(this.position),f.X(this.position),f.Y(this.position)]),this.updateConstraint(),I=Geometry.projectPointToTurtle(this,f,this.board)[0].usrCoords;else if(f.elementClass===Const.OBJECT_CLASS_CURVE){for(Z=!1,B=f.getTransformationSource(),B[0]&&(Z=B[0],y.push(f),y.push(B[1]));B[0]&&JXG$1.exists(B[1]._transformationSource);)B=B[1].getTransformationSource(),y.push(B[1]);if(Z?this.coords.setCoordinates(Const.COORDS_BY_USER,[y[y.length-1].Z(this.position),y[y.length-1].X(this.position),y[y.length-1].Y(this.position)]):this.coords.setCoordinates(Const.COORDS_BY_USER,[f.Z(this.position),f.X(this.position),f.Y(this.position)]),f.type===Const.OBJECT_TYPE_ARC||f.type===Const.OBJECT_TYPE_SECTOR)M=Geometry.rad([f.center.X()+1,f.center.Y()],f.center,f.radiuspoint),V=0,H=Geometry.rad(f.radiuspoint,f.center,f.anglepoint),(f.visProp.selection==="minor"&&H>Math.PI||f.visProp.selection==="major"&&H<Math.PI)&&(V=H,H=2*Math.PI),F=H-V,JXG$1.evaluate(this.visProp.isgeonext)&&(F=1),T=this.position*F,(T<V||T>H)&&(T=H,(T<V&&T>V*.5||T>H&&T>H*.5+Math.PI)&&(T=V),this.position=T,Math.abs(F)>Mat.eps&&(this.position/=F)),d=f.Radius(),I=[f.center.X()+d*Math.cos(this.position*F+M),f.center.Y()+d*Math.sin(this.position*F+M)];else if(this.updateConstraint(),Z)for(I=Geometry.projectPointToCurve(this,y[y.length-1],this.board)[0].usrCoords,_=y.length-2;_>=0;_--)I=new Coords(Const.COORDS_BY_USER,Mat.matVecMult(y[_].transformMat,I),this.board).usrCoords;else I=Geometry.projectPointToCurve(this,f,this.board)[0].usrCoords}else JXG$1.isPoint(f)&&(I=Geometry.projectPointToPoint(this,f,this.board).usrCoords);this.coords.setCoordinates(Const.COORDS_BY_USER,I,!1)},updateRendererGeneric:function(u){return!this.needsUpdate||!this.board.renderer?this:(this.visPropCalc.visible&&(this.isReal=!isNaN(this.coords.usrCoords[1]+this.coords.usrCoords[2]),this.isReal=Math.abs(this.coords.usrCoords[0])>Mat.eps?this.isReal:!1,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer[u](this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this)},X:function(){return this.coords.usrCoords[1]},Y:function(){return this.coords.usrCoords[2]},Z:function(){return this.coords.usrCoords[0]},Coords:function(u){return u?this.coords.usrCoords.slice():this.coords.usrCoords.slice(1)},XEval:function(){return this.coords.usrCoords[1]},YEval:function(){return this.coords.usrCoords[2]},ZEval:function(){return this.coords.usrCoords[0]},Dist:function(u){return this.isReal&&u.isReal?this.coords.distance(Const.COORDS_BY_USER,u.coords):NaN},snapToGrid:function(u){return this.handleSnapToGrid(u)},handleSnapToPoints:function(u){var n,d,C,I=0,f,y=1/0,B=null,_,Z,M=JXG$1.evaluate(this.visProp.ignoredsnaptopoints),V,T,H=!1;if(f=this.board.objectsList.length,M&&(V=M.length),JXG$1.evaluate(this.visProp.snaptopoints)||u){for(_=JXG$1.evaluate(this.visProp.attractorunit),Z=JXG$1.evaluate(this.visProp.attractordistance),n=0;n<f;n++){if(d=this.board.objectsList[n],M){for(H=!1,T=0;T<V;T++)if(d===this.board.select(M[T])){H=!0;break}if(H)continue}JXG$1.isPoint(d)&&d!==this&&d.visPropCalc.visible&&(C=Geometry.projectPointToPoint(this,d,this.board),_==="screen"?I=C.distance(Const.COORDS_BY_SCREEN,this.coords):I=C.distance(Const.COORDS_BY_USER,this.coords),I<Z&&I<y&&(y=I,B=C))}B!==null&&this.coords.setCoordinates(Const.COORDS_BY_USER,B.usrCoords)}return this},snapToPoints:function(u){return this.handleSnapToPoints(u)},handleAttractors:function(){var u,n,d,C=0,I,f=JXG$1.evaluate(this.visProp.attractorunit),y=JXG$1.evaluate(this.visProp.attractordistance),B=JXG$1.evaluate(this.visProp.snatchdistance),_=JXG$1.evaluate(this.visProp.attractors),Z=_.length;if(y!==0){for(u=0;u<Z;u++)if(n=this.board.select(_[u]),JXG$1.exists(n)&&n!==this){if(JXG$1.isPoint(n)?d=Geometry.projectPointToPoint(this,n,this.board):n.elementClass===Const.OBJECT_CLASS_LINE?(I=Geometry.projectCoordsToSegment(this.coords.usrCoords,n.point1.coords.usrCoords,n.point2.coords.usrCoords),!JXG$1.evaluate(n.visProp.straightfirst)&&I[1]<0?d=n.point1.coords:!JXG$1.evaluate(n.visProp.straightlast)&&I[1]>1?d=n.point2.coords:d=new Coords(Const.COORDS_BY_USER,I[0],this.board)):n.elementClass===Const.OBJECT_CLASS_CIRCLE?d=Geometry.projectPointToCircle(this,n,this.board):n.elementClass===Const.OBJECT_CLASS_CURVE?d=Geometry.projectPointToCurve(this,n,this.board)[0]:n.type===Const.OBJECT_TYPE_TURTLE?d=Geometry.projectPointToTurtle(this,n,this.board)[0]:n.type===Const.OBJECT_TYPE_POLYGON&&(d=new Coords(Const.COORDS_BY_USER,Geometry.projectCoordsToPolygon(this.coords.usrCoords,n),this.board)),f==="screen"?C=d.distance(Const.COORDS_BY_SCREEN,this.coords):C=d.distance(Const.COORDS_BY_USER,this.coords),C<y){this.type===Const.OBJECT_TYPE_GLIDER&&(n===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===n)||this.makeGlider(n);break}C>=B&&(n===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===n)&&this.popSlideObject()}return this}},setPositionDirectly:function(u,n){var d,C,I,f=this.coords,y;if(this.relativeCoords)return C=new Coords(u,n,this.board),JXG$1.evaluate(this.visProp.islabel)?(I=Statistics.subtract(C.scrCoords,f.scrCoords),this.relativeCoords.scrCoords[1]+=I[1],this.relativeCoords.scrCoords[2]+=I[2]):(I=Statistics.subtract(C.usrCoords,f.usrCoords),this.relativeCoords.usrCoords[1]+=I[1],this.relativeCoords.usrCoords[2]+=I[2]),this;for(this.coords.setCoordinates(u,n),this.handleSnapToGrid(),this.handleSnapToPoints(),this.handleAttractors(),d=this.transformations.length-1;d>=0;d--)u===Const.COORDS_BY_SCREEN?y=new Coords(u,n,this.board).usrCoords:(n.length===2&&(n=[1].concat(n)),y=n),this.initialCoords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(Mat.inverse(this.transformations[d].matrix),y));return this.prepareUpdate().update(),this.board.isSuspendedUpdate&&this.type===Const.OBJECT_TYPE_GLIDER&&this.updateGlider(),this},setPositionByTransform:function(u,n){var d;return n=new Coords(u,n,this.board),d=this.board.create("transform",n.usrCoords.slice(1),{type:"translate"}),this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(d):this.addTransform(this,d),this.prepareUpdate().update(),this},setPosition:function(u,n){return this.setPositionDirectly(u,n)},setGliderPosition:function(u){return this.type===Const.OBJECT_TYPE_GLIDER&&(this.position=u,this.board.update()),this},makeGlider:function(u){var n=this.board.select(u),d=!1,C,I,f;if(n.type===Const.OBJECT_TYPE_POLYGON){for(C=Number.MAX_VALUE,I=0;I<n.borders.length;I++)f=JXG$1.Math.Geometry.distPointLine(this.coords.usrCoords,n.borders[I].stdform),f<C&&(C=f,u=n.borders[I]);n=this.board.select(u),d=!0}if(JXG$1.exists(n)){if(n.type===Const.OBJECT_TYPE_TICKS)throw new Error("JSXGraph: gliders on ticks are not possible.")}else throw new Error("JSXGraph: slide object undefined.");return this.slideObject=this.board.select(u),this.slideObjects.push(this.slideObject),this.addParents(u),this.type=Const.OBJECT_TYPE_GLIDER,this.elType="glider",this.visProp.snapwidth=-1,this.slideObject.addChild(this),this.isDraggable=!0,this.onPolygon=d,this.generatePolynomial=function(){return this.slideObject.generatePolynomial(this)},this.updateGlider(),this.needsUpdateFromParent=!0,this.updateGliderFromParent(),this},popSlideObject:function(){this.slideObjects.length>0&&(this.slideObjects.pop(),this.slideObject.removeChild(this),this.slideObjects.length===0?(this.type=this._org_type,this.type===Const.OBJECT_TYPE_POINT?this.elType="point":this.elementClass===Const.OBJECT_CLASS_TEXT?this.elType="text":this.type===Const.OBJECT_TYPE_IMAGE?this.elType="image":this.type===Const.OBJECT_TYPE_FOREIGNOBJECT&&(this.elType="foreignobject"),this.slideObject=null):this.slideObject=this.slideObjects[this.slideObjects.length-1])},free:function(){var u,n;if(this.type!==Const.OBJECT_TYPE_GLIDER)if(this.transformations.length=0,delete this.updateConstraint,this.isConstrained=!1,!this.isDraggable)this.isDraggable=!0,this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"),this.XEval=function(){return this.coords.usrCoords[1]},this.YEval=function(){return this.coords.usrCoords[2]},this.ZEval=function(){return this.coords.usrCoords[0]},this.Xjc=null,this.Yjc=null;else return;for(u in this.board.objects)this.board.objects.hasOwnProperty(u)&&(n=this.board.objects[u],n.descendants&&(delete n.descendants[this.id],delete n.childElements[this.id],this.hasLabel&&(delete n.descendants[this.label.id],delete n.childElements[this.label.id])));this.ancestors={},this.parents=[],this.slideObject=null,this.slideObjects=[],this.elementClass===Const.OBJECT_CLASS_POINT?(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"):this.elementClass===Const.OBJECT_CLASS_TEXT?(this.type=this._org_type,this.elType="text"):this.elementClass===Const.OBJECT_CLASS_OTHER&&(this.type=this._org_type,this.elType="image")},addConstraint:function(u){var n,d,C=[],I=["X","Y"],f=function(B){return function(){return B}},y=function(B){return function(){return B.Value()}};for(this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_CAS),this.isDraggable=!1,n=0;n<u.length;n++)d=u[n],JXG$1.isString(d)?(C[n]=this.board.jc.snippet(d,!0,null,!0),this.addParentsFromJCFunctions([C[n]]),u.length===2&&(this[I[n]+"jc"]=u[n])):JXG$1.isFunction(d)?C[n]=d:JXG$1.isNumber(d)?C[n]=f(d):JXG$1.isObject(d)&&JXG$1.isFunction(d.Value)&&(C[n]=y(d)),C[n].origin=d;return u.length===1?this.updateConstraint=function(){var B=C[0]();return JXG$1.isArray(B)?this.coords.setCoordinates(Const.COORDS_BY_USER,B):this.coords=B,this}:u.length===2?(this.XEval=C[0],this.YEval=C[1],this.addParents([C[0].origin,C[1].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.XEval(),this.YEval()]),this}):(this.ZEval=C[0],this.XEval=C[1],this.YEval=C[2],this.addParents([C[0].origin,C[1].origin,C[2].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()]),this}),this.isConstrained=!0,this.prepareUpdate().update(),this.board.isSuspendedUpdate||(this.updateVisibility().updateRenderer(),this.hasLabel&&this.label.fullUpdate()),this},addAnchor:function(u,n){n?this.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,u.slice(0,2),this.board):this.relativeCoords=new Coords(Const.COORDS_BY_USER,u,this.board),this.element.addChild(this),n&&this.addParents(this.element),this.XEval=function(){var d,C,I,f;return JXG$1.evaluate(this.visProp.islabel)?(f=JXG$1.evaluate(this.visProp.offset),d=parseFloat(f[0]),I=this.element.getLabelAnchor(),C=new Coords(Const.COORDS_BY_SCREEN,[d+this.relativeCoords.scrCoords[1]+I.scrCoords[1],0],this.board),C.usrCoords[1]):(I=this.element.getTextAnchor(),this.relativeCoords.usrCoords[1]+I.usrCoords[1])},this.YEval=function(){var d,C,I,f;return JXG$1.evaluate(this.visProp.islabel)?(f=JXG$1.evaluate(this.visProp.offset),d=-parseFloat(f[1]),I=this.element.getLabelAnchor(),C=new Coords(Const.COORDS_BY_SCREEN,[0,d+this.relativeCoords.scrCoords[2]+I.scrCoords[2]],this.board),C.usrCoords[2]):(I=this.element.getTextAnchor(),this.relativeCoords.usrCoords[2]+I.usrCoords[2])},this.ZEval=JXG$1.createFunction(1,this.board,""),this.updateConstraint=function(){this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()])},this.isConstrained=!0,this.updateConstraint()},updateTransform:function(u){var n;if(this.transformations.length===0)return this;for(n=0;n<this.transformations.length;n++)this.transformations[n].update();return this},addTransform:function(u,n){var d,C=JXG$1.isArray(n)?n:[n],I=C.length;for(this.transformations.length===0&&(this.baseElement=u),d=0;d<I;d++)this.transformations.push(C[d]);return this},startAnimation:function(u,n,d){var C=JXG$1.evaluate(u),I=JXG$1.evaluate(n),f=this;return d=JXG$1.evaluate(d)||250,this.type===Const.OBJECT_TYPE_GLIDER&&!JXG$1.exists(this.intervalCode)&&(this.intervalCode=window.setInterval(function(){f._anim(C,I)},d),JXG$1.exists(this.intervalCount)||(this.intervalCount=0)),this},stopAnimation:function(){return JXG$1.exists(this.intervalCode)&&(window.clearInterval(this.intervalCode),delete this.intervalCode),this},moveAlong:function(u,n,d){d=d||{};var C,I,f=[],y=[],B=this.board.attr.animationdelay,_=n/B,Z,M,V,T=function(H,F){return function(){return u[H][F]}};if(JXG$1.isArray(u)){for(Z=u.length,C=0;C<Z;C++)JXG$1.isPoint(u[C])?y[C]=u[C]:y[C]={elementClass:Const.OBJECT_CLASS_POINT,X:T(C,0),Y:T(C,1)};if(n=n||0,n===0)return this.setPosition(Const.COORDS_BY_USER,[y[y.length-1].X(),y[y.length-1].Y()]),this.board.update(this);if(!JXG$1.exists(d.interpolate)||d.interpolate)for(I=Numerics.Neville(y),C=0;C<_;C++)f[C]=[],f[C][0]=I[0]((_-C)/_*I[3]()),f[C][1]=I[1]((_-C)/_*I[3]());else{for(Z=u.length-1,C=0;C<_;++C)M=Math.floor(C/_*Z),V=C/_*Z-M,f[C]=[],f[C][0]=(1-V)*y[M].X()+V*y[M+1].X(),f[C][1]=(1-V)*y[M].Y()+V*y[M+1].Y();f.push([y[Z].X(),y[Z].Y()]),f.reverse()}this.animationPath=f}else JXG$1.isFunction(u)&&(this.animationPath=u,this.animationStart=new Date().getTime());return this.animationCallback=d.callback,this.board.addAnimation(this),this},moveTo:function(u,n,d){d=d||{},u=new Coords(Const.COORDS_BY_USER,u,this.board);var C,I=this.board.attr.animationdelay,f=Math.ceil(n/I),y=[],B=this.coords.usrCoords[1],_=this.coords.usrCoords[2],Z=u.usrCoords[1]-B,M=u.usrCoords[2]-_,V=function(T){let H=T/f;if(d.effect){if(d.effect==="<>")return Math.pow(Math.sin(H*Math.PI/2),2);if(d.effect==="<")return H*H*H;if(d.effect===">")return 1-Math.pow(1-H,3);if(d.effect==="==")return T/f;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return T/f};if(!JXG$1.exists(n)||n===0||Math.abs(u.usrCoords[0]-this.coords.usrCoords[0])>Mat.eps)return this.setPosition(Const.COORDS_BY_USER,u.usrCoords),this.board.update(this);if(!JXG$1.exists(d.callback)&&Math.abs(Z)<Mat.eps&&Math.abs(M)<Mat.eps)return this;for(C=f;C>=0;C--)y[f-C]=[u.usrCoords[0],B+Z*V(C),_+M*V(C)];return this.animationPath=y,this.animationCallback=d.callback,this.board.addAnimation(this),this},visit:function(u,n,d){u=new Coords(Const.COORDS_BY_USER,u,this.board);var C,I,f,y=this.board.attr.animationdelay,B=[],_=this.coords.usrCoords[1],Z=this.coords.usrCoords[2],M=u.usrCoords[1]-_,V=u.usrCoords[2]-Z,T=function(H){var F=H<f/2?2*H/f:2*(f-H)/f;if(d.effect){if(d.effect==="<>")return Math.pow(Math.sin(F*Math.PI/2),2);if(d.effect==="<")return F*F*F;if(d.effect===">")return 1-Math.pow(1-F,3);if(d.effect==="==")return F;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return F};for(JXG$1.isNumber(d)?d={repeat:d}:(d=d||{},JXG$1.exists(d.repeat)||(d.repeat=1)),f=Math.ceil(n/(y*d.repeat)),I=0;I<d.repeat;I++)for(C=f;C>=0;C--)B[I*(f+1)+f-C]=[u.usrCoords[0],_+M*T(C),Z+V*T(C)];return this.animationPath=B,this.animationCallback=d.callback,this.board.addAnimation(this),this},_anim:function(u,n){var d,C,I,f,y,B,_,Z,M;return this.intervalCount+=1,this.intervalCount>n&&(this.intervalCount=0),this.slideObject.elementClass===Const.OBJECT_CLASS_LINE?(_=this.slideObject.point1.coords.scrCoords,Z=this.slideObject.point2.coords.scrCoords,d=Math.round((Z[1]-_[1])*this.intervalCount/n),C=Math.round((Z[2]-_[2])*this.intervalCount/n),u>0?f=this.slideObject.point1:(f=this.slideObject.point2,d*=-1,C*=-1),this.coords.setCoordinates(Const.COORDS_BY_SCREEN,[f.coords.scrCoords[1]+d,f.coords.scrCoords[2]+C])):this.slideObject.elementClass===Const.OBJECT_CLASS_CURVE?(u>0?y=(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/n+this.slideObject.minX():y=-(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/n+this.slideObject.maxX(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.X(y),this.slideObject.Y(y)]),M=Geometry.projectPointToCurve(this,this.slideObject,this.board),this.coords=M[0],this.position=M[1]):this.slideObject.elementClass===Const.OBJECT_CLASS_CIRCLE&&(I=2*Math.PI,u<0?I*=this.intervalCount/n:I*=(n-this.intervalCount)/n,B=this.slideObject.Radius(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.center.coords.usrCoords[1]+B*Math.cos(I),this.slideObject.center.coords.usrCoords[2]+B*Math.sin(I)])),this.board.update(this),this},getTextAnchor:function(){return this.coords},getLabelAnchor:function(){return this.coords},getParents:function(){var u=[this.Z(),this.X(),this.Y()];return this.parents.length!==0&&(u=this.parents),this.type===Const.OBJECT_TYPE_GLIDER&&(u=[this.X(),this.Y(),this.slideObject.id]),u}});JXG$1.CoordsElement.create=function(u,n,d,C,I,f){var y,B=!1,_;for(_=0;_<d.length;_++)(JXG$1.isFunction(d[_])||JXG$1.isString(d[_]))&&(B=!0);if(B)y=new u(n,[0,0],C,I,f),y.addConstraint(d);else if(JXG$1.isNumber(d[0])&&JXG$1.isNumber(d[1]))y=new u(n,d,C,I,f),JXG$1.exists(C.slideobject)?y.makeGlider(C.slideobject):y.baseElement=y,y.isDraggable=!0;else if(JXG$1.isObject(d[0])&&JXG$1.isTransformationOrArray(d[1]))y=new u(n,[0,0],C,I,f),y.addTransform(d[0],d[1]),y.isDraggable=!1;else return!1;return y.handleSnapToGrid(),y.handleSnapToPoints(),y.handleAttractors(),y.addParents(d),y};const CoordsElement=JXG$1.CoordsElement;var priv$5={HTMLSliderInputEventHandler:function(){this._val=parseFloat(this.rendNodeRange.value),this.rendNodeOut.value=this.rendNodeRange.value,this.board.update()}};JXG$1.Text=function(u,n,d,C){var I;this.constructor(u,d,Const.OBJECT_TYPE_TEXT,Const.OBJECT_CLASS_TEXT),this.element=this.board.select(d.anchor),this.coordsConstructor(n,JXG$1.evaluate(this.visProp.islabel)),this.content="",this.plaintext="",this.plaintextOld=null,this.orgText="",this.needsSizeUpdate=!1,this.hiddenByParent=!1,this.size=[1,1],this.id=this.board.setId(this,"T"),this.board.renderer.drawText(this),this.board.finalizeAdding(this),I=this.visProp.visible,this.visProp.visible=!0,this.setText(C),this.visProp.visible=I,JXG$1.isString(this.content)&&this.notifyParents(this.content),this.elType="text",this.methodMap=JXG$1.deepCopy(this.methodMap,{setText:"setTextJessieCode",move:"setCoords",Size:"getSize",setAutoPosition:"setAutoPosition"})};JXG$1.Text.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Text.prototype,{hasPoint:function(u,n){var d,C,I,f,y,B,_,Z;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(_=this.board._inputDevice,Z=JXG$1.evaluate(this.visProp.precision[_])):Z=this.board.options.precision.hasPoint,this.transformations.length>0&&(d=Mat.matVecMult(Mat.inverse(this.board.renderer.joinTransforms(this,this.transformations)),[1,u,n]),u=d[1],n=d[2]),y=this.getAnchorX(),y==="right"?d=this.coords.scrCoords[1]-this.size[0]:y==="middle"?d=this.coords.scrCoords[1]-.5*this.size[0]:d=this.coords.scrCoords[1],C=d+this.size[0],B=this.getAnchorY(),B==="top"?f=this.coords.scrCoords[2]+this.size[1]:B==="middle"?f=this.coords.scrCoords[2]+.5*this.size[1]:f=this.coords.scrCoords[2],I=f-this.size[1],JXG$1.evaluate(this.visProp.dragarea)==="all"?u>=d-Z&&u<C+Z&&n>=I-Z&&n<=f+Z:n>=I-Z&&n<=f+Z&&(u>=d-Z&&u<=d+2*Z||u>=C-2*Z&&u<=C+Z)},_createFctUpdateText:function(u){var n,d,C,I,f,y,B=JXG$1.evaluate(this.visProp.parse),_=JXG$1.evaluate(this.visProp.usemathjax),Z=JXG$1.evaluate(this.visProp.usekatex),M=!1;if(this.orgText=u,JXG$1.isFunction(u))this.updateText=function(){I=u().toString(),B&&!_&&!Z?this.plaintext=this.replaceSub(this.replaceSup(this.convertGeonextAndSketchometry2CSS(I,!1))):this.plaintext=I};else if(JXG$1.isNumber(u)&&JXG$1.evaluate(this.visProp.formatnumber)?JXG$1.evaluate(this.visProp.tofraction)?_?this.content="\\("+JXG$1.toFraction(u,!0)+"\\)":this.content=JXG$1.toFraction(u,Z):(C=JXG$1.evaluate(this.visProp.digits),this.useLocale()?this.content=this.formatNumberLocale(u,C):this.content=JXG$1.toFixed(u,C)):JXG$1.isString(u)&&B?(JXG$1.evaluate(this.visProp.useasciimathml)?this.content="'`"+u+"`'":_||Z?(this.content=this.valueTagToJessieCode(u),JXG$1.isArray(this.content)||(this.content=this.content.replace(/\\/g,"\\\\"))):this.content=this.poorMansTeX(this.valueTagToJessieCode(u)),M=!0):this.content=u,M){if(JXG$1.isArray(this.content)){for(y=this,f=0;f<this.content.length;f++)if(this.content[f][0]!=='"'){this.content[f]=this.board.jc.snippet(this.content[f],!0,"",!1);for(d in this.content[f].deps)this.addParents(this.content[f].deps[d]),this.content[f].deps[d].addChild(this)}n=function(){var V,T,H=JXG$1.evaluate(y.visProp.digits),F="";for(V=0;V<y.content.length;V++)JXG$1.isFunction(y.content[V])?(T=y.content[V](),y.useLocale()?T=y.formatNumberLocale(T,H):T=JXG$1.toFixed(T,H)):(T=y.content[V],T[0]==='"'&&T[T.length-1]==='"'&&(T=T.slice(1,-1))),F+=T;return F}}else{n=this.board.jc.snippet(this.content,!0,"",!1);for(d in n.deps)this.addParents(n.deps[d]),n.deps[d].addChild(this)}this.updateText=function(){this.plaintext=this.unescapeTicks(n())}}else this.updateText=function(){this.plaintext=this.content}},_setText:function(u){return this._createFctUpdateText(u),this.updateText(),this.fullUpdate(),(!this.board.infobox||this.id!==this.board.infobox.id)&&this.updateSize(),this},setTextJessieCode:function(u){var n;return this.visProp.castext=u,JXG$1.isFunction(u)?n=function(){return JXG$1.sanitizeHTML(u())}:JXG$1.isNumber(u)?n=u:n=JXG$1.sanitizeHTML(u),this._setText(n)},setText:function(u){return this._setText(u)},updateSize:function(){var u,n,d,C=JXG$1.evaluate(this.visProp.display);return!JXG$1.isBrowser||this.board.renderer.type==="no"?this:(d=this.rendNode,C==="html"||this.board.renderer.type==="vml"?JXG$1.exists(d.offsetWidth)?(n=this,window.setTimeout(function(){n.size=[d.offsetWidth,d.offsetHeight],n.needsUpdate=!0,n.updateRenderer()},0)):this.size=this.crudeSizeEstimate():C==="internal"&&(this.board.renderer.type==="svg"?(n=this,window.setTimeout(function(){try{u=d.getBBox(),n.size=[u.width,u.height],n.needsUpdate=!0,n.updateRenderer()}catch{}},0)):this.board.renderer.type==="canvas"&&(this.size=this.crudeSizeEstimate())),this)},crudeSizeEstimate:function(){var u=parseFloat(JXG$1.evaluate(this.visProp.fontsize));return[u*this.plaintext.length*.45,u*.9]},utf8_decode:function(u){return u.replace(/&#x(\w+);/g,function(n,d){return String.fromCharCode(parseInt(d,16))})},replaceSub:function(u){if(!u.indexOf)return u;for(var n,d=u.indexOf("_{");d>=0;)u=u.slice(0,d)+u.slice(d).replace(/_\{/,"<sub>"),n=u.indexOf("}",d+4),n>=0&&(u=u.slice(0,n)+u.slice(n).replace(/\}/,"</sub>")),d=u.indexOf("_{");for(d=u.indexOf("_");d>=0;)u=u.slice(0,d)+u.slice(d).replace(/_(.?)/,"<sub>$1</sub>"),d=u.indexOf("_");return u},replaceSup:function(u){if(!u.indexOf)return u;for(var n,d=u.indexOf("^{");d>=0;)u=u.slice(0,d)+u.slice(d).replace(/\^\{/,"<sup>"),n=u.indexOf("}",d+4),n>=0&&(u=u.slice(0,n)+u.slice(n).replace(/\}/,"</sup>")),d=u.indexOf("^{");for(d=u.indexOf("^");d>=0;)u=u.slice(0,d)+u.slice(d).replace(/\^(.?)/,"<sup>$1</sup>"),d=u.indexOf("^");return u},getSize:function(){return this.size},setCoords:function(u,n){var d,C,I;return JXG$1.isArray(u)&&u.length>1&&(n=u[1],u=u[0]),JXG$1.evaluate(this.visProp.islabel)&&JXG$1.exists(this.element)?(d=this.element.getLabelAnchor(),C=(u-d.usrCoords[1])*this.board.unitX,I=-(n-d.usrCoords[2])*this.board.unitY,this.relativeCoords.setCoordinates(Const.COORDS_BY_SCREEN,[C,I])):this.coords.setCoordinates(Const.COORDS_BY_USER,[u,n]),this.fullUpdate(),this},update:function(u){return this.needsUpdate?(this.updateCoords(u),this.updateText(),JXG$1.evaluate(this.visProp.display)==="internal"&&JXG$1.isString(this.plaintext)&&(this.plaintext=this.utf8_decode(this.plaintext)),this.checkForSizeUpdate(),this.needsSizeUpdate&&this.updateSize(),this):this},checkForSizeUpdate:function(){this.board.infobox&&this.id===this.board.infobox.id?this.needsSizeUpdate=!1:(this.needsSizeUpdate=this.plaintextOld!==this.plaintext,this.needsSizeUpdate&&(this.plaintextOld=this.plaintext))},updateRenderer:function(){return JXG$1.evaluate(this.visProp.autoposition)&&this.setAutoPosition().updateConstraint(),this.updateRendererGeneric("updateText")},expandShortMath:function(u){var n=/([)0-9.])\s*([(a-zA-Z_])/g;return u.replace(n,"$1*$2")},generateTerm:function(u,n,d){var C,I,f,y,B='""';if(u=u||"",u=u.replace(/\r/g,""),u=u.replace(/\n/g,""),u=u.replace(/"/g,"'"),u=u.replace(/'/g,"\\'"),u=u.replace(/&amp;arc;/g,"&ang;"),u=u.replace(/<arc\s*\/>/g,"&ang;"),u=u.replace(/&lt;arc\s*\/&gt;/g,"&ang;"),u=u.replace(/&lt;sqrt\s*\/&gt;/g,"&radic;"),u=u.replace(/&lt;value&gt;/g,"<value>"),u=u.replace(/&lt;\/value&gt;/g,"</value>"),f=u.indexOf("<value>"),y=u.indexOf("</value>"),f>=0)for(;f>=0;)B+=' + "'+this.replaceSub(this.replaceSup(u.slice(0,f)))+'"',I=u.slice(f+7,y),I=I.replace(/\s+/g,""),n===!0&&(I=this.expandShortMath(I)),d?C=I:C=GeonextParser.geonext2JS(I,this.board),C=C.replace(/\\"/g,"'"),C=C.replace(/\\'/g,"'"),C.indexOf("toFixed")<0&&JXG$1.isNumber(JXG$1.bind(this.board.jc.snippet(C,!0,"",!1),this)())?B+="+("+C+").toFixed("+JXG$1.evaluate(this.visProp.digits)+")":B+="+("+C+")",u=u.slice(y+8),f=u.indexOf("<value>"),y=u.indexOf("</value>");return B+=' + "'+this.replaceSub(this.replaceSup(u))+'"',B=this.convertGeonextAndSketchometry2CSS(B),B=B.replace(/&amp;/g,"&"),B=B.replace(/"/g,"'"),B},valueTagToJessieCode:function(u){var n,d,C,I,f=[],y='"';if(u=u||"",u=u.replace(/\r/g,""),u=u.replace(/\n/g,""),u=u.replace(/&lt;value&gt;/g,"<value>"),u=u.replace(/&lt;\/value&gt;/g,"</value>"),C=u.indexOf("<value>"),I=u.indexOf("</value>"),C>=0)for(;C>=0;)f.push(y+this.escapeTicks(u.slice(0,C))+y),d=u.slice(C+7,I),d=d.replace(/\s+/g,""),d=this.expandShortMath(d),n=d,n=n.replace(/\\"/g,"'").replace(/\\'/g,"'"),f.push("("+n+")"),u=u.slice(I+8),C=u.indexOf("<value>"),I=u.indexOf("</value>");for(f.push(y+this.escapeTicks(u)+y),C=0;C<f.length;C++)f[C]=f[C].replace(/&amp;/g,"&");return f},poorMansTeX:function(u){var n,d;if(JXG$1.isArray(u)){for(d=[],n=0;n<u.length;n++)d.push(this.poorMansTeX(u[n]));return d}return u=u.replace(/<arc\s*\/*>/g,"&ang;").replace(/&lt;arc\s*\/*&gt;/g,"&ang;").replace(/<sqrt\s*\/*>/g,"&radic;").replace(/&lt;sqrt\s*\/*&gt;/g,"&radic;"),this.convertGeonextAndSketchometry2CSS(this.replaceSub(this.replaceSup(u)),!0)},escapeTicks:function(u){return u.replace(/"/g,"%22").replace(/'/g,"%27")},unescapeTicks:function(u){return u.replace(/%22/g,'"').replace(/%27/g,"'")},convertGeonext2CSS:function(u){return JXG$1.isString(u)&&(u=u.replace(/(<|&lt;)overline(>|&gt;)/g,"<span style=text-decoration:overline;>"),u=u.replace(/(<|&lt;)\/overline(>|&gt;)/g,"</span>"),u=u.replace(/(<|&lt;)arrow(>|&gt;)/g,"<span style=text-decoration:overline;>"),u=u.replace(/(<|&lt;)\/arrow(>|&gt;)/g,"</span>")),u},convertSketchometry2CSS:function(u,n){var d='<span class="sketcho sketcho-inherit sketcho-',C='"></span>';return JXG$1.isString(u)&&(n&&(d=this.escapeTicks(d),C=this.escapeTicks(C)),u=u.replace(/(<|&lt;)sketchofont(>|&gt;)/g,d),u=u.replace(/(<|&lt;)\/sketchofont(>|&gt;)/g,C)),u},convertGeonextAndSketchometry2CSS:function(u,n){return u=this.convertGeonext2CSS(u),u=this.convertSketchometry2CSS(u,n),u},notifyParents:function(u){var n,d=null;u=u.replace(/&lt;value&gt;/g,"<value>"),u=u.replace(/&lt;\/value&gt;/g,"</value>");do n=/<value>([\w\s*/^\-+()[\],<>=!]+)<\/value>/,d=n.exec(u),d!==null&&(GeonextParser.findDependencies(this,d[1],this.board),u=u.slice(d.index),u=u.replace(n,""));while(d!==null);return this},getParents:function(){var u;return this.relativeCoords!==void 0?u=[this.relativeCoords.usrCoords[1],this.relativeCoords.usrCoords[2],this.orgText]:u=[this.Z(),this.X(),this.Y(),this.orgText],this.parents.length!==0&&(u=this.parents),u},bounds:function(){var u=this.coords.usrCoords;return JXG$1.evaluate(this.visProp.islabel)||this.board.unitY===0||this.board.unitX===0?[0,0,0,0]:[u[1],u[2]+this.size[1]/this.board.unitY,u[1]+this.size[0]/this.board.unitX,u[2]]},getAnchorX:function(){var u=JXG$1.evaluate(this.visProp.anchorx);if(u==="auto")switch(this.visProp.position){case"top":case"bot":return"middle";case"rt":case"lrt":case"urt":return"left";case"lft":case"llft":case"ulft":default:return"right"}return u},getAnchorY:function(){var u=JXG$1.evaluate(this.visProp.anchory);if(u==="auto")switch(this.visProp.position){case"top":case"ulft":case"urt":return"bottom";case"bot":case"lrt":case"llft":return"top";case"rt":case"lft":default:return"middle"}return u},getNumberOfConflicts:function(u,n,d,C,I){I=I||[];var f=0,y,B,_,Z,M;for(Z=this.board.options.precision.hasPoint,this.board.options.precision.hasPoint=(d+C)*.25,y=0,_=this.board.objectsList.length;y<_;y++)B=this.board.objectsList[y],M=B.visProp.hasinnerpoints,B.visProp.hasinnerpoints=!1,B.visPropCalc.visible&&B.elType!=="axis"&&B.elType!=="ticks"&&B!==this.board.infobox&&B!==this&&B.hasPoint(u,n)&&I.indexOf(B.id)===-1&&f++,B.visProp.hasinnerpoints=M;return this.board.options.precision.hasPoint=Z,f},setAutoPosition:function(){var u,n,d,C,I,f=this.size[0],y=this.size[1],B,_,Z={conflicts:1/0,angle:0,r:0},M,V,T,H,F,O=12,$=2*Math.PI/O,U,ee,Q,ie,ne;if(this===this.board.infobox||!this.visPropCalc.visible||!JXG$1.evaluate(this.visProp.islabel)||!this.element)return this;if(H=JXG$1.evaluate(this.visProp.offset),I=this.element.getLabelAnchor(),d=I.scrCoords[1],C=I.scrCoords[2],ee=H[0],Q=H[1],T=this.getNumberOfConflicts(d+ee,C-Q,f,y,JXG$1.evaluate(this.visProp.autopositionwhitelist)),T===0)return this;for(F=JXG$1.evaluate(this.visProp.autopositionmindistance),M=JXG$1.evaluate(this.visProp.autopositionmaxdistance),V=.2*F,B=Math.atan2(Q,ee),Z.conflicts=T,Z.angle=B,Z.r=F;Z.conflicts>0&&F<=M;){for(U=1,_=B+$;U<O&&Z.conflicts>0&&(ie=Math.cos(_),ne=Math.sin(_),u=d+F*ie,n=C-F*ne,T=this.getNumberOfConflicts(u,n,f,y,JXG$1.evaluate(this.visProp.autopositionwhitelist)),T<Z.conflicts&&(Z.conflicts=T,Z.angle=_,Z.r=F),Z.conflicts!==0);U++)_+=$;F+=V}return F=Z.r,ie=Math.cos(Z.angle),ne=Math.sin(Z.angle),this.visProp.offset=[F*ie,F*ne],ie<-.2?this.visProp.anchorx="right":ie>.2?this.visProp.anchorx="left":this.visProp.anchorx="middle",this}});JXG$1.createText=function(u,n,d){var C,I=JXG$1.copyAttributes(d,u.options,"text"),f=n.slice(0,-1),y=n[n.length-1];if(I.anchor=I.parent||I.anchor,C=CoordsElement.create(JXG$1.Text,u,f,I,y),!C)throw new Error("JSXGraph: Can't create text with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return I.rotate!==0&&C.addRotation(I.rotate),C};JXG$1.registerElement("text",JXG$1.createText);JXG$1.createHTMLSlider=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"htmlslider");if(n.length!==2||n[0].length!==2||n[1].length!==3)throw new Error("JSXGraph: Can't create htmlslider with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parents are: [[x,y], [min, start, max]]`);f.anchor=f.parent||f.anchor,f.fixed=f.fixed||!0,I=[n[0][0],n[0][1],'<form style="display:inline"><input type="range" /><span></span><input type="text" /></form>'],C=JXG$1.createText(u,I,f),C.type=JXG$1.OBJECT_TYPE_HTMLSLIDER,C.rendNodeForm=C.rendNode.childNodes[0],C.rendNodeRange=C.rendNodeForm.childNodes[0],C.rendNodeRange.min=n[1][0],C.rendNodeRange.max=n[1][2],C.rendNodeRange.step=f.step,C.rendNodeRange.value=n[1][1],C.rendNodeLabel=C.rendNodeForm.childNodes[1],C.rendNodeLabel.id=C.rendNode.id+"_label",f.withlabel&&(C.rendNodeLabel.innerHTML=C.name+"="),C.rendNodeOut=C.rendNodeForm.childNodes[2],C.rendNodeOut.value=n[1][1];try{C.rendNodeForm.id=C.rendNode.id+"_form",C.rendNodeRange.id=C.rendNode.id+"_range",C.rendNodeOut.id=C.rendNode.id+"_out"}catch(y){JXG$1.debug(y)}return C.rendNodeRange.style.width=f.widthrange+"px",C.rendNodeRange.style.verticalAlign="middle",C.rendNodeOut.style.width=f.widthout+"px",C._val=n[1][1],JXG$1.supportsVML()?JXG$1.addEvent(C.rendNodeForm,"change",priv$5.HTMLSliderInputEventHandler,C):JXG$1.addEvent(C.rendNodeForm,"input",priv$5.HTMLSliderInputEventHandler,C),C.Value=function(){return this._val},C};JXG$1.registerElement("htmlslider",JXG$1.createHTMLSlider);const Text=JXG$1.Text;Object.create||(Object.create=function(u,n){if(typeof u!="object"&&typeof u!="function")throw new TypeError("Object prototype may only be an Object: "+u);if(u===null)throw new Error("This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.");if(typeof n<"u")throw new Error("This browser's implementation of Object.create is a shim and doesn't support a second argument.");function d(){}return d.prototype=u,new d});var priv$4={modules:{math:Mat,"math/geometry":Geometry,"math/statistics":Statistics,"math/numerics":Mat.Numerics}};JXG$1.JessieCode=function(u,n){this.scope={id:0,hasChild:!0,args:[],locals:{},context:null,previous:null},this.scopes=[],this.scopes.push(this.scope),this.dpstack=[[]],this.pscope=0,this.propstack=[{}],this.propscope=0,this.lhs=[],this.isLHS=!1,this.warnLog="jcwarn",this.$log=[],this.builtIn=this.defineBuiltIn(),this.operands=this.getPossibleOperands(),this.board=null,this.forceValueCall=!1,this.lineToElement={},this.parCurLine=1,this.parCurColumn=0,this.line=1,this.col=1,JXG$1.CA&&(this.CA=new JXG$1.CA(this.node,this.createNode,this)),this.code="",typeof u=="string"&&this.parse(u,n)};JXG$1.extend(JXG$1.JessieCode.prototype,{node:function(u,n,d){return{type:u,value:n,children:d}},createNode:function(u,n,d){var C=this.node(u,n,[]),I;for(I=2;I<arguments.length;I++)C.children.push(arguments[I]);return C.type==="node_const"&&JXG$1.isNumber(C.value)&&(C.isMath=!0),C.line=this.parCurLine,C.col=this.parCurColumn,C},pushScope:function(u){var n={args:u,locals:{},context:null,previous:this.scope};return this.scope.hasChild=!0,this.scope=n,n.id=this.scopes.push(n)-1,n},popScope:function(){var u=this.scope.previous;return this.scope=u!==null?u:this.scope,this.scope},getElementById:function(u){return this.board.objects[u]},log:function(){this.$log.push(arguments),typeof console=="object"&&console.log&&console.log.apply(console,arguments)},creator:function(){var u={},n;return n=function(d){var C;return typeof u[this.board.id+d]=="function"?C=u[this.board.id+d]:(C=function(I){return function(f,y){var B;return JXG$1.exists(y)?B=y:B={},B.name===void 0&&B.id===void 0&&(B.name=I.lhs[I.scope.id]!==0?I.lhs[I.scope.id]:""),I.board.create(d,f,B)}}(this),C.creator=!0,u[this.board.id+d]=C),C},n.clearCache=function(){u={}},n}(),letvar:function(u,n){this.builtIn[u]&&this._warn('"'+u+'" is a predefined value.'),this.scope.locals[u]=n},isLocalVariable:function(u){for(var n=this.scope;n!==null;){if(JXG$1.exists(n.locals[u]))return n;n=n.previous}return null},isParameter:function(u){for(var n=this.scope;n!==null;){if(JXG$1.indexOf(n.args,u)>-1)return n;n=n.previous}return null},isCreator:function(u){return!!JXG$1.elements[u]},isMathMethod:function(u){return u!=="E"&&!!Math[u]},isBuiltIn:function(u){return!!this.builtIn[u]},getvar:function(u,n,d){var C;if(n=JXG$1.def(n,!1),C=this.isLocalVariable(u),C!==null)return C.locals[u];if(u==="$board"||u==="EULER"||u==="PI")return this.builtIn[u];if(d){if(this.isBuiltIn(u))return this.builtIn[u];if(this.isMathMethod(u))return Math[u];if(this.isCreator(u))return this.creator(u)}if(!n&&(C=this.board.select(u),C!==u))return C},resolve:function(u){for(var n=this.scope;n!==null;){if(JXG$1.exists(n.locals[u]))return n.locals[u];n=n.previous}},getvarJS:function(u,n,d){var C,I="",f;return n=JXG$1.def(n,!1),d=JXG$1.def(d,!1),C=this.isParameter(u),C!==null?u:(C=this.isLocalVariable(u),C!==null&&!d?"$jc$.resolve('"+u+"')":this.isCreator(u)?"(function () { var a = Array.prototype.slice.call(arguments, 0), props = "+(d?"a.pop()":"{}")+"; return $jc$.board.create.apply($jc$.board, ['"+u+"'].concat([a, props])); })":(d&&this._error("Syntax error (attribute values are allowed with element creators only)"),this.isBuiltIn(u)?(I=this.builtIn[u].src||this.builtIn[u],JXG$1.isNumber(I)||I.match(/board\.select/)?I:(u=I.split(".").pop(),JXG$1.exists(this.board.mathLib)&&(f=new RegExp("^Math."+u),f.exec(I)!==null)?I.replace(f,"$jc$.board.mathLib."+u):JXG$1.exists(this.board.mathLibJXG)?(f=new RegExp("^JXG.Math."),f.exec(I)!==null?I.replace(f,"$jc$.board.mathLibJXG."):I):I)):this.isMathMethod(u)?"$jc$.board.mathLib."+u:n?"":(JXG$1.isId(this.board,u)?(I="$jc$.board.objects['"+u+"']",this.board.objects[u].elType==="slider"&&(I+=".Value()")):JXG$1.isName(this.board,u)?(I="$jc$.board.elementsByName['"+u+"']",this.board.elementsByName[u].elType==="slider"&&(I+=".Value()")):JXG$1.isGroup(this.board,u)&&(I="$jc$.board.groups['"+u+"']"),I)))},makeMap:function(u){return u.isMap=!0,u},functionCodeJS:function(u){var n=u.children[0].join(", "),d="",C="";return u.value==="op_map"&&(d="{ return  ",C=" }"),"function ("+n+`) {
var $oldscope$ = $jc$.scope;
$jc$.scope = $jc$.scopes[`+this.scope.id+`];
var r = (function () `+d+this.compile(u.children[1],!0)+C+`)();
$jc$.scope = $oldscope$;
return r;
}`},defineFunction:function(node){var fun,i,that=this,list=node.children[0],scope=this.pushScope(list);if(this.board.options.jc.compile){for(this.isLHS=!1,i=0;i<list.length;i++)scope.locals[list[i]]=list[i];this.replaceNames(node.children[1]),fun=function(jc){var fun,str="var f = function($jc$) { return "+jc.functionCodeJS(node)+"}; f;";try{for(fun=eval(str)(jc),scope.argtypes=[],i=0;i<list.length;i++)scope.argtypes.push(that.resolveType(list[i],node));return fun}catch(u){return jc._warn(`error compiling function

`+str+`

`+u.toString()),function(){}}}(this),this.popScope()}else fun=function(u,n,d){return function(){var C,I;for(I=n.scope,n.scope=n.scopes[d],C=0;C<u.length;C++)n.scope.locals[u[C]]=arguments[C];return C=n.execute(node.children[1]),n.scope=I,C}}(list,this,scope.id);return fun.node=node,fun.scope=scope,fun.toJS=fun.toString,fun.toString=function(u){return function(){return u.compile(u.replaceIDs(JXG$1.deepCopy(node)))}}(this),fun.deps={},this.collectDependencies(node.children[1],node.children[0],fun.deps),fun},mergeAttributes:function(u){var n,d={};for(n=0;n<arguments.length;n++)d=JXG$1.deepCopy(d,arguments[n],!0);return d},setProp:function(u,n,d){var C={},I,f;u.elementClass===Const.OBJECT_CLASS_POINT&&(n==="X"||n==="Y")?(n=n.toLowerCase(),u.isDraggable&&typeof d=="number"?(I=n==="x"?d:u.X(),f=n==="y"?d:u.Y(),u.setPosition(Const.COORDS_BY_USER,[I,f])):u.isDraggable&&(typeof d=="function"||typeof d=="string")?(I=n==="x"?d:u.coords.usrCoords[1],f=n==="y"?d:u.coords.usrCoords[2],u.addConstraint([I,f])):u.isDraggable||(I=n==="x"?d:u.XEval.origin,f=n==="y"?d:u.YEval.origin,u.addConstraint([I,f])),this.board.update()):u.elementClass===Const.OBJECT_CLASS_TEXT&&(n==="X"||n==="Y")?(typeof d=="number"?u[n]=function(){return d}:typeof d=="function"?(u.isDraggable=!1,u[n]=d):typeof d=="string"&&(u.isDraggable=!1,u[n]=JXG$1.createFunction(d,this.board),u[n+"jc"]=d),u[n].origin=d,this.board.update()):u.type&&u.elementClass&&u.visProp?JXG$1.exists(u[u.methodMap[n]])&&typeof u[u.methodMap[n]]!="function"?u[u.methodMap[n]]=d:(C[n]=d,u.setAttribute(C)):u[n]=d},_genericParse:function(u,n,d,C){var I,f,y,B,_=u.replace(/\r\n/g,`
`).split(`
`),Z=[];C||(this.code+=u+`
`),Text&&(f=Text.prototype.setText,Text.prototype.setText=Text.prototype.setTextJessieCode);try{for(JXG$1.exists(d)||(d=!1),I=0;I<_.length;I++)d&&(_[I]=JXG$1.GeonextParser.geonext2JS(_[I],this.board)),Z.push(_[I]);switch(u=Z.join(`
`),y=parser.parse(u),this.CA&&(y=this.CA.expandDerivatives(y,null,y),y=this.CA.removeTrivialNodes(y)),n){case"parse":B=this.execute(y);break;case"manipulate":B=this.compile(y);break;case"getAst":B=y;break;default:B=!1}}catch(M){throw M}finally{Text&&(Text.prototype.setText=f)}return B},parse:function(u,n,d){return this._genericParse(u,"parse",n,d)},manipulate:function(u,n,d){return this._genericParse(u,"manipulate",n,d)},getAST:function(u,n,d){return this._genericParse(u,"getAst",n,d)},snippet:function(u,n,d,C,I){var f;return n=JXG$1.def(n,!0),d=JXG$1.def(d,""),C=JXG$1.def(C,!1),this.forceValueCall=JXG$1.def(I,!0),f=(n?" function ("+d+") { return ":"")+u+(n?"; }":"")+";",this.parse(f,C,!0)},replaceIDs:function(u){var n,d;if(u.replaced&&(d=this.board.objects[u.children[1][0].value],JXG$1.exists(d)&&d.name!==""&&(u.type="node_var",u.value=d.name,u.children.length=0,delete u.replaced)),JXG$1.isArray(u))for(n=0;n<u.length;n++)u[n]=this.replaceIDs(u[n]);if(u.children)for(n=u.children.length;n>0;n--)JXG$1.exists(u.children[n-1])&&(u.children[n-1]=this.replaceIDs(u.children[n-1]));return u},replaceNames:function(u,n){var d,C,I=!1;if(n!==void 0&&(I=n),C=u.value,u.type==="node_op"&&C==="op_lhs"&&u.children.length===1?this.isLHS=!0:u.type==="node_var"&&(this.isLHS?this.letvar(C,!0):!JXG$1.exists(this.getvar(C,!0))&&JXG$1.exists(this.board.elementsByName[C])&&(I&&this.board.elementsByName[C].elType!=="slider"&&(I=!1),u=this.createReplacementNode(u,I))),JXG$1.isArray(u))for(d=0;d<u.length;d++)u[d]=this.replaceNames(u[d],I);if(u.children)for(this.forceValueCall&&(u.value==="op_execfun"&&u.children[0].value!=="V"&&u.children[0].value!=="$"&&(JXG$1.exists(Math[u.children[0].value])||JXG$1.exists(Mat[u.children[0].value]))&&u.children[1][0].type==="node_var"||u.value==="op_return"&&u.children.length===1&&u.children[0].type==="node_var")&&(I=!0),d=u.children.length;d>0;d--)JXG$1.exists(u.children[d-1])&&(u.children[d-1]=this.replaceNames(u.children[d-1],I));return u.type==="node_op"&&u.value==="op_lhs"&&u.children.length===1&&(this.isLHS=!1),u},createReplacementNode:function(u,n){var d=u.value,C=this.board.elementsByName[d];return u=this.createNode("node_op","op_execfun",this.createNode("node_var",n===!0?"$value":"$"),[this.createNode("node_str",C.id)]),u.replaced=!0,u},collectDependencies:function(u,n,d){var C,I,f,y;if(JXG$1.isArray(u)){for(y=u.length,C=0;C<y;C++)this.collectDependencies(u[C],n,d);return}if(I=u.value,u.type==="node_var"&&n.indexOf(I)<0&&(f=this.getvar(I),f&&f.visProp&&f.elType&&f.elementClass&&f.id&&f.elType==="slider"&&(d[f.id]=f)),u.type==="node_op"&&u.value==="op_execfun"&&u.children.length>1&&(u.children[0].value==="$"||u.children[0].value==="$value")&&u.children[1].length>0&&(f=u.children[1][0].value,d[f]=this.board.objects[f]),u.children)for(C=u.children.length;C>0;C--)JXG$1.exists(u.children[C-1])&&this.collectDependencies(u.children[C-1],n,d)},resolveProperty:function(u,n,d){return d=JXG$1.def(d,!1),u&&u.methodMap&&(JXG$1.exists(u.subs)&&JXG$1.exists(u.subs[n])?u=u.subs:JXG$1.exists(u.methodMap[n])?n=u.methodMap[n]:(u=u.visProp,n=n.toLowerCase())),JXG$1.isFunction(u)&&this._error("Accessing function properties is not allowed."),JXG$1.exists(u)||this._error(u+" is not an object"),JXG$1.exists(u[n])||this._error("unknown property "+n),d&&typeof u[n]=="function"?function(){return u[n].apply(u,arguments)}:u[n]},resolveType:function(u,n){var d,C,I="any";if(JXG$1.isArray(n)){for(d=0;d<n.length;d++)if(C=this.resolveType(u,n[d]),C!=="any")return I=C,I}if(n.type==="node_op"&&n.value==="op_execfun"&&n.children[0].type==="node_var"&&n.children[0].value===u)return"function";if(n.type==="node_op"){for(d=0;d<n.children.length;d++)if(n.children[0].type==="node_var"&&n.children[0].value===u&&(n.value==="op_add"||n.value==="op_sub"||n.value==="op_mul"||n.value==="op_div"||n.value==="op_mod"||n.value==="op_exp"||n.value==="op_neg"))return"any";for(d=0;d<n.children.length;d++)if(C=this.resolveType(u,n.children[d]),C!=="any")return I=C,I}return"any"},getLHS:function(u){var n;if(u.type==="node_var")n={o:this.scope.locals,what:u.value};else if(u.type==="node_op"&&u.value==="op_property")n={o:this.execute(u.children[0]),what:u.children[1]};else if(u.type==="node_op"&&u.value==="op_extvalue")n={o:this.execute(u.children[0]),what:this.execute(u.children[1])};else throw new Error("Syntax error: Invalid left-hand side of assignment.");return n},getLHSCompiler:function(u,n){var d;if(u.type==="node_var")d=u.value;else if(u.type==="node_op"&&u.value==="op_property")d=[this.compile(u.children[0],n),"'"+u.children[1]+"'"];else if(u.type==="node_op"&&u.value==="op_extvalue")d=[this.compile(u.children[0],n),u.children[1].type==="node_const"?u.children[1].value:this.compile(u.children[1],n)];else throw new Error("Syntax error: Invalid left-hand side of assignment.");return d},execute:function(u){var n,d,C,I,f,y,B,_,Z=[],M,V,T;if(n=0,!u)return n;switch(this.line=u.line,this.col=u.col,u.type){case"node_op":switch(u.value){case"op_none":u.children[0]&&this.execute(u.children[0]),u.children[1]&&(n=this.execute(u.children[1]));break;case"op_assign":d=this.getLHS(u.children[0]),this.lhs[this.scope.id]=d.what,d.o.type&&d.o.elementClass&&d.o.methodMap&&d.what==="label"&&this._error("Left-hand side of assignment is read-only."),n=this.execute(u.children[1]),d.o!==this.scope.locals||JXG$1.isArray(d.o)&&typeof d.what=="number"?this.setProp(d.o,d.what,n):this.letvar(d.what,n),this.lhs[this.scope.id]=0;break;case"op_if":this.execute(u.children[0])&&(n=this.execute(u.children[1]));break;case"op_conditional":case"op_if_else":this.execute(u.children[0])?n=this.execute(u.children[1]):n=this.execute(u.children[2]);break;case"op_while":for(;this.execute(u.children[0]);)this.execute(u.children[1]);break;case"op_do":do this.execute(u.children[0]);while(this.execute(u.children[1]));break;case"op_for":for(this.execute(u.children[0]);this.execute(u.children[1]);this.execute(u.children[2]))this.execute(u.children[3]);break;case"op_proplst":u.children[0]&&this.execute(u.children[0]),u.children[1]&&this.execute(u.children[1]);break;case"op_emptyobject":n={};break;case"op_proplst_val":this.propstack.push({}),this.propscope++,this.execute(u.children[0]),n=this.propstack[this.propscope],this.propstack.pop(),this.propscope--;break;case"op_prop":this.propstack[this.propscope][u.children[0]]=this.execute(u.children[1]);break;case"op_array":for(n=[],f=u.children[0].length,C=0;C<f;C++)n.push(this.execute(u.children[0][C]));break;case"op_extvalue":n=this.execute(u.children[0]),C=this.execute(u.children[1]),typeof C=="number"&&Math.abs(Math.round(C)-C)<Mat.eps?n=n[C]:n=y;break;case"op_return":if(this.scope===0)this._error("Unexpected return.");else return this.execute(u.children[0]);break;case"op_map":!u.children[1].isMath&&u.children[1].type!=="node_var"&&this._error("execute: In a map only function calls and mathematical expressions are allowed."),M=this.defineFunction(u),M.isMap=!0,n=M;break;case"op_function":M=this.defineFunction(u),M.isMap=!1,n=M;break;case"op_execfun":if(this.dpstack.push([]),this.pscope++,B=u.children[1],JXG$1.exists(u.children[2]))if(u.children[3])for(_=u.children[2],V={},C=0;C<_.length;C++)V=JXG$1.deepCopy(V,this.execute(_[C]),!0);else V=this.execute(u.children[2]);for(u.children[0]._isFunctionName=!0,M=this.execute(u.children[0]),delete u.children[0]._isFunctionName,JXG$1.exists(M)&&JXG$1.exists(M.sc)?T=M.sc:T=this,!M.creator&&JXG$1.exists(u.children[2])&&this._error("Unexpected value. Only element creators are allowed to have a value after the function call."),C=0;C<B.length;C++)JXG$1.exists(M.scope)&&JXG$1.exists(M.scope.argtypes)&&M.scope.argtypes[C]==="function"?(B[C]._isFunctionName=!0,Z[C]=this.execute(B[C]),delete B[C]._isFunctionName):Z[C]=this.execute(B[C]),this.dpstack[this.pscope].push({line:u.children[1][C].line,col:u.children[1][C].ecol});if(typeof M=="function"&&!M.creator)n=M.apply(T,Z);else if(typeof M=="function"&&M.creator){I=this.line;try{for(n=M(Z,V),n.jcLineStart=I,n.jcLineEnd=u.eline,C=I;C<=u.line;C++)this.lineToElement[C]=n;n.debugParents=this.dpstack[this.pscope]}catch(H){this._error(H.toString())}}else this._error("Function '"+M+"' is undefined.");this.dpstack.pop(),this.pscope--;break;case"op_property":I=this.execute(u.children[0]),d=u.children[1],n=this.resolveProperty(I,d,!1),JXG$1.exists(n)&&["number","string","boolean"].indexOf(typeof n)<0&&(n.sc=I);break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),this.use(u.children[0].toString());break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),d=this.getvar(u.children[0]),n=this.del(d);break;case"op_eq":n=this.execute(u.children[0])==this.execute(u.children[1]);break;case"op_neq":n=this.execute(u.children[0])!=this.execute(u.children[1]);break;case"op_approx":n=Math.abs(this.execute(u.children[0])-this.execute(u.children[1]))<Mat.eps;break;case"op_gt":n=this.execute(u.children[0])>this.execute(u.children[1]);break;case"op_lt":n=this.execute(u.children[0])<this.execute(u.children[1]);break;case"op_geq":n=this.execute(u.children[0])>=this.execute(u.children[1]);break;case"op_leq":n=this.execute(u.children[0])<=this.execute(u.children[1]);break;case"op_or":n=this.execute(u.children[0])||this.execute(u.children[1]);break;case"op_and":n=this.execute(u.children[0])&&this.execute(u.children[1]);break;case"op_not":n=!this.execute(u.children[0]);break;case"op_add":n=this.add(this.execute(u.children[0]),this.execute(u.children[1]));break;case"op_sub":n=this.sub(this.execute(u.children[0]),this.execute(u.children[1]));break;case"op_div":n=this.div(this.execute(u.children[0]),this.execute(u.children[1]));break;case"op_mod":n=this.mod(this.execute(u.children[0]),this.execute(u.children[1]),!0);break;case"op_mul":n=this.mul(this.execute(u.children[0]),this.execute(u.children[1]));break;case"op_exp":n=this.pow(this.execute(u.children[0]),this.execute(u.children[1]));break;case"op_neg":n=this.neg(this.execute(u.children[0]));break}break;case"node_var":n=this.getvar(u.value,!1,u._isFunctionName);break;case"node_const":u.value===null?n=null:n=Number(u.value);break;case"node_const_bool":n=u.value;break;case"node_str":n=u.value.replace(/\\(.)/g,"$1");break}return n},compile:function(u,n){var d,C,I,f="";if(JXG$1.exists(n)||(n=!1),!u)return f;switch(u.type){case"node_op":switch(u.value){case"op_none":u.children[0]&&(f=this.compile(u.children[0],n)),u.children[1]&&(f+=this.compile(u.children[1],n));break;case"op_assign":n?(d=this.getLHSCompiler(u.children[0],n),JXG$1.isArray(d)?f="$jc$.setProp("+d[0]+", "+d[1]+", "+this.compile(u.children[1],n)+`);
`:(this.isLocalVariable(d)!==this.scope&&(this.scope.locals[d]=!0),f="$jc$.scopes["+this.scope.id+"].locals['"+d+"'] = "+this.compile(u.children[1],n)+`;
`)):(d=this.compile(u.children[0]),f=d+" = "+this.compile(u.children[1],n)+`;
`);break;case"op_if":f=" if ("+this.compile(u.children[0],n)+") "+this.compile(u.children[1],n);break;case"op_if_else":f=" if ("+this.compile(u.children[0],n)+")"+this.compile(u.children[1],n),f+=" else "+this.compile(u.children[2],n);break;case"op_conditional":f="(("+this.compile(u.children[0],n)+")?("+this.compile(u.children[1],n),f+="):("+this.compile(u.children[2],n)+"))";break;case"op_while":f=" while ("+this.compile(u.children[0],n)+`) {
`+this.compile(u.children[1],n)+`}
`;break;case"op_do":f=` do {
`+this.compile(u.children[0],n)+"} while ("+this.compile(u.children[1],n)+`);
`;break;case"op_for":f=" for ("+this.compile(u.children[0],n)+this.compile(u.children[1],n)+"; "+this.compile(u.children[2],n).slice(0,-2)+`) {
`+this.compile(u.children[3],n)+`
}
`;break;case"op_proplst":u.children[0]&&(f=this.compile(u.children[0],n)+", "),f+=this.compile(u.children[1],n);break;case"op_prop":f=u.children[0]+": "+this.compile(u.children[1],n);break;case"op_emptyobject":f=n?"{}":"<< >>";break;case"op_proplst_val":f=this.compile(u.children[0],n);break;case"op_array":for(I=[],C=0;C<u.children[0].length;C++)I.push(this.compile(u.children[0][C],n));f="["+I.join(", ")+"]";break;case"op_extvalue":f=this.compile(u.children[0],n)+"["+this.compile(u.children[1],n)+"]";break;case"op_return":f=" return "+this.compile(u.children[0],n)+`;
`;break;case"op_map":!u.children[1].isMath&&u.children[1].type!=="node_var"&&this._error("compile: In a map only function calls and mathematical expressions are allowed."),I=u.children[0],n?f=" $jc$.makeMap(function ("+I.join(", ")+") { return "+this.compile(u.children[1],n)+"; })":f="map ("+I.join(", ")+") -> "+this.compile(u.children[1],n);break;case"op_function":I=u.children[0],this.pushScope(I),n?f=this.functionCodeJS(u):f=" function ("+I.join(", ")+") "+this.compile(u.children[1],n),this.popScope();break;case"op_execfunmath":console.log("op_execfunmath: TODO"),f="-1";break;case"op_execfun":if(u.children[2]){for(I=[],C=0;C<u.children[2].length;C++)I.push(this.compile(u.children[2][C],n));n?d="$jc$.mergeAttributes("+I.join(", ")+")":d=I.join(", ")}for(u.children[0].withProps=!!u.children[2],I=[],C=0;C<u.children[1].length;C++)I.push(this.compile(u.children[1][C],n));f=this.compile(u.children[0],n)+"("+I.join(", ")+(u.children[2]&&n?", "+d:"")+")"+(u.children[2]&&!n?" "+d:""),n&&(f+=`
`),n&&u.children[0].value==="$"&&(f="$jc$.board.objects["+this.compile(u.children[1][0],n)+"]");break;case"op_property":n&&u.children[1]!=="X"&&u.children[1]!=="Y"?f="$jc$.resolveProperty("+this.compile(u.children[0],n)+", '"+u.children[1]+"', true)":f=this.compile(u.children[0],n)+"."+u.children[1];break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),n?f="$jc$.use('":f="use('",f+=u.children[0].toString()+"');";break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),n?f="$jc$.del(":f="remove(",f+=this.compile(u.children[0],n)+")";break;case"op_eq":f="("+this.compile(u.children[0],n)+" === "+this.compile(u.children[1],n)+")";break;case"op_neq":f="("+this.compile(u.children[0],n)+" !== "+this.compile(u.children[1],n)+")";break;case"op_approx":f="("+this.compile(u.children[0],n)+" ~= "+this.compile(u.children[1],n)+")";break;case"op_gt":n?f="$jc$.gt("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" > "+this.compile(u.children[1],n)+")";break;case"op_lt":n?f="$jc$.lt("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" < "+this.compile(u.children[1],n)+")";break;case"op_geq":n?f="$jc$.geq("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" >= "+this.compile(u.children[1],n)+")";break;case"op_leq":n?f="$jc$.leq("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" <= "+this.compile(u.children[1],n)+")";break;case"op_or":f="("+this.compile(u.children[0],n)+" || "+this.compile(u.children[1],n)+")";break;case"op_and":f="("+this.compile(u.children[0],n)+" && "+this.compile(u.children[1],n)+")";break;case"op_not":f="!("+this.compile(u.children[0],n)+")";break;case"op_add":n?f="$jc$.add("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" + "+this.compile(u.children[1],n)+")";break;case"op_sub":n?f="$jc$.sub("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" - "+this.compile(u.children[1],n)+")";break;case"op_div":n?f="$jc$.div("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" / "+this.compile(u.children[1],n)+")";break;case"op_mod":n?f="$jc$.mod("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+", true)":f="("+this.compile(u.children[0],n)+" % "+this.compile(u.children[1],n)+")";break;case"op_mul":n?f="$jc$.mul("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+" * "+this.compile(u.children[1],n)+")";break;case"op_exp":n?f="$jc$.pow("+this.compile(u.children[0],n)+", "+this.compile(u.children[1],n)+")":f="("+this.compile(u.children[0],n)+"^"+this.compile(u.children[1],n)+")";break;case"op_neg":n?f="$jc$.neg("+this.compile(u.children[0],n)+")":f="(-"+this.compile(u.children[0],n)+")";break}break;case"node_var":n?f=this.getvarJS(u.value,!1,u.withProps):f=u.value;break;case"node_const":f=u.value;break;case"node_const_bool":f=u.value;break;case"node_str":f="'"+u.value+"'";break}return u.needsBrackets&&(f=`{
`+f+` }
`),u.needsAngleBrackets&&(n?f=`{
`+f+` }
`:f="<< "+f+` >>
`),f},getName:function(u,n){var d="";return JXG$1.exists(u)&&JXG$1.exists(u.getName)?(d=u.getName(),(!JXG$1.exists(d)||d==="")&&n&&(d=u.id)):n&&(d=u.id),d},X:function(u){return u.X()},Y:function(u){return u.Y()},V:function(u){return u.Value()},L:function(u){return u.L()},area:function(u){return(!JXG$1.exists(u)||!JXG$1.exists(u.Area))&&this._error("Error: Can't calculate area."),u.Area()},perimeter:function(u){return(!JXG$1.exists(u)||!JXG$1.exists(u.Perimeter))&&this._error("Error: Can't calculate perimeter."),u.Perimeter()},dist:function(u,n){return(!JXG$1.exists(u)||!JXG$1.exists(u.Dist))&&this._error("Error: Can't calculate distance."),u.Dist(n)},radius:function(u){return(!JXG$1.exists(u)||!JXG$1.exists(u.Radius))&&this._error("Error: Can't calculate radius."),u.Radius()},slope:function(u){return(!JXG$1.exists(u)||!JXG$1.exists(u.Slope))&&this._error("Error: Can't calculate slope."),u.Slope()},add:function(u,n){var d,C,I;if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),Interval.isInterval(u)||Interval.isInterval(n))I=Interval.add(u,n);else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),I=[],d=0;d<C;d++)I[d]=u[d]+n[d];else JXG$1.isNumber(u)&&JXG$1.isNumber(n)?I=u+n:JXG$1.isString(u)||JXG$1.isString(n)?I=u.toString()+n.toString():this._error("Operation + not defined on operands "+typeof u+" and "+typeof n);return I},sub:function(u,n){var d,C,I;if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),Interval.isInterval(u)||Interval.isInterval(n))I=Interval.sub(u,n);else if(JXG$1.isArray(u)&&JXG$1.isArray(n))for(C=Math.min(u.length,n.length),I=[],d=0;d<C;d++)I[d]=u[d]-n[d];else JXG$1.isNumber(u)&&JXG$1.isNumber(n)?I=u-n:this._error("Operation - not defined on operands "+typeof u+" and "+typeof n);return I},neg:function(u){var n,d,C;if(u=JXG$1.evalSlider(u),Interval.isInterval(u))C=Interval.negative(u);else if(JXG$1.isArray(u))for(d=u.length,C=[],n=0;n<d;n++)C[n]=-u[n];else JXG$1.isNumber(u)?C=-u:this._error("Unary operation - not defined on operand "+typeof u);return C},mul:function(u,n){var d,C,I;if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),JXG$1.isArray(u)&&JXG$1.isNumber(n)&&(d=u,u=n,n=u),Interval.isInterval(u)||Interval.isInterval(n))I=Interval.mul(u,n);else if(JXG$1.isArray(u)&&JXG$1.isArray(n))C=Math.min(u.length,n.length),I=Mat.innerProduct(u,n,C);else if(JXG$1.isNumber(u)&&JXG$1.isArray(n))for(C=n.length,I=[],d=0;d<C;d++)I[d]=u*n[d];else JXG$1.isNumber(u)&&JXG$1.isNumber(n)?I=u*n:this._error("Operation * not defined on operands "+typeof u+" and "+typeof n);return I},div:function(u,n){var d,C,I;if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),Interval.isInterval(u)||Interval.isInterval(n))I=Interval.div(u,n);else if(JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,I=[],d=0;d<C;d++)I[d]=u[d]/n;else JXG$1.isNumber(u)&&JXG$1.isNumber(n)?I=u/n:this._error("Operation * not defined on operands "+typeof u+" and "+typeof n);return I},mod:function(u,n){var d,C,I;if(u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),Interval.isInterval(u)||Interval.isInterval(n))return Interval.fmod(u,n);if(JXG$1.isArray(u)&&JXG$1.isNumber(n))for(C=u.length,I=[],d=0;d<C;d++)I[d]=Mat.mod(u[d],n,!0);else JXG$1.isNumber(u)&&JXG$1.isNumber(n)?I=Mat.mod(u,n,!0):this._error("Operation * not defined on operands "+typeof u+" and "+typeof n);return I},pow:function(u,n){return u=JXG$1.evalSlider(u),n=JXG$1.evalSlider(n),Interval.isInterval(u)||Interval.isInterval(n)?Interval.pow(u,n):Mat.pow(u,n)},lt:function(u,n){return Interval.isInterval(u)||Interval.isInterval(n)?Interval.lt(u,n):u<n},leq:function(u,n){return Interval.isInterval(u)||Interval.isInterval(n)?Interval.leq(u,n):u<=n},gt:function(u,n){return Interval.isInterval(u)||Interval.isInterval(n)?Interval.gt(u,n):u>n},geq:function(u,n){return Interval.isInterval(u)||Interval.isInterval(n)?Interval.geq(u,n):u>=n},randint:function(u,n,d){return JXG$1.exists(d)||(d=1),Math.round(Math.random()*(n-u)/d)*d+u},DDD:function(u){console.log("Dummy derivative function. This should never appear!")},ifthen:function(u,n,d){return u?n:d},del:function(u){typeof u=="object"&&JXG$1.exists(u.type)&&JXG$1.exists(u.elementClass)&&this.board.removeObject(u)},eval:function(u){return JXG$1.evaluate(u)},use:function(u){var n,d,C=!1;if(typeof u=="string"){for(n in JXG$1.boards)if(JXG$1.boards.hasOwnProperty(n)&&JXG$1.boards[n].container===u){d=JXG$1.boards[n],C=!0;break}}else d=u,C=!0;C?(this.board=d,this.builtIn.$board=d,this.builtIn.$board.src="$jc$.board"):this._error("Board '"+u+"' not found!")},findSymbol:function(u,n){var d,C;for(n=JXG$1.def(n,-1),n===-1?C=this.scope:C=this.scopes[n];C!==null;){for(d in C.locals)if(C.locals.hasOwnProperty(d)&&C.locals[d]===u)return[d,C];C=C.previous}return[]},importModule:function(u){return priv$4.modules[u.toLowerCase()]},defineBuiltIn:function(){var u=this,n={PI:Math.PI,EULER:Math.E,D:u.DDD,X:u.X,Y:u.Y,V:u.V,Value:u.V,L:u.L,Length:u.L,acosh:Mat.acosh,acot:Mat.acot,asinh:Mat.asinh,binomial:Mat.binomial,cbrt:Mat.cbrt,cosh:Mat.cosh,cot:Mat.cot,deg:Geometry.trueAngle,A:u.area,area:u.area,Area:u.area,perimeter:u.perimeter,Perimeter:u.perimeter,dist:u.dist,Dist:u.dist,R:u.radius,radius:u.radius,Radius:u.radius,erf:Mat.erf,erfc:Mat.erfc,erfi:Mat.erfi,factorial:Mat.factorial,gcd:Mat.gcd,lb:Mat.log2,lcm:Mat.lcm,ld:Mat.log2,lg:Mat.log10,ln:Math.log,log:Mat.log,log10:Mat.log10,log2:Mat.log2,ndtr:Mat.ndtr,ndtri:Mat.ndtri,nthroot:Mat.nthroot,pow:Mat.pow,rad:Geometry.rad,ratpow:Mat.ratpow,trunc:JXG$1.trunc,sinh:Mat.sinh,slope:u.slope,Slope:u.slope,randint:u.randint,IfThen:u.ifthen,import:u.importModule,eval:u.eval,use:u.use,remove:u.del,$:u.getElementById,$value:function(d){return u.getElementById(d).Value()},getName:u.getName,name:u.getName,$board:u.board,$log:u.log};return n.rad.sc=Geometry,n.deg.sc=Geometry,n.factorial.sc=Mat,n.X.src="$jc$.X",n.Y.src="$jc$.Y",n.V.src="$jc$.V",n.Value.src="$jc$.V",n.L.src="$jc$.L",n.Length.src="$jc$.L",n.acosh.src="JXG.Math.acosh",n.acot.src="JXG.Math.acot",n.asinh.src="JXG.Math.asinh",n.binomial.src="JXG.Math.binomial",n.cbrt.src="JXG.Math.cbrt",n.cot.src="JXG.Math.cot",n.cosh.src="JXG.Math.cosh",n.deg.src="JXG.Math.Geometry.trueAngle",n.erf.src="JXG.Math.erf",n.erfc.src="JXG.Math.erfc",n.erfi.src="JXG.Math.erfi",n.A.src="$jc$.area",n.area.src="$jc$.area",n.Area.src="$jc$.area",n.perimeter.src="$jc$.perimeter",n.Perimeter.src="$jc$.perimeter",n.dist.src="$jc$.dist",n.Dist.src="$jc$.dist",n.R.src="$jc$.radius",n.radius.src="$jc$.radius",n.Radius.src="$jc$.radius",n.factorial.src="JXG.Math.factorial",n.gcd.src="JXG.Math.gcd",n.lb.src="JXG.Math.log2",n.lcm.src="JXG.Math.lcm",n.ld.src="JXG.Math.log2",n.lg.src="JXG.Math.log10",n.ln.src="Math.log",n.log.src="JXG.Math.log",n.log10.src="JXG.Math.log10",n.log2.src="JXG.Math.log2",n.ndtr.src="JXG.Math.ndtr",n.ndtri.src="JXG.Math.ndtri",n.nthroot.src="JXG.Math.nthroot",n.pow.src="JXG.Math.pow",n.rad.src="JXG.Math.Geometry.rad",n.ratpow.src="JXG.Math.ratpow",n.trunc.src="JXG.trunc",n.sinh.src="JXG.Math.sinh",n.slope.src="$jc$.slope",n.Slope.src="$jc$.slope",n.randint.src="$jc$.randint",n.import.src="$jc$.importModule",n.eval.src="$jc$.eval",n.use.src="$jc$.use",n.remove.src="$jc$.del",n.IfThen.src="$jc$.ifthen",n.$.src="(function (n) { return $jc$.board.select(n); })",n.$value.src="(function (n) { return $jc$.board.select(n).Value(); })",n.getName.src="$jc$.getName",n.name.src="$jc$.getName",n.$board&&(n.$board.src="$jc$.board"),n.$log.src="$jc$.log",n=JXG$1.merge(n,u._addedBuiltIn),n},_addedBuiltIn:{},addBuiltIn:function(u,n){if(JXG$1.exists(this.builtIn)){if(JXG$1.exists(this.builtIn[u]))return;this.builtIn[u]=n,this.builtIn[u].src="$jc$."+u}JXG$1.exists(this._addedBuiltIn[u])||(this._addedBuiltIn[u]=n,this._addedBuiltIn[u].src="$jc$."+u,JXG$1.JessieCode.prototype[u]=n)},getPossibleOperands:function(){var u=["E"],n=this.builtIn||this.defineBuiltIn(),d=Math,C,I,f,y,B,_,Z,M,V,T,H,F,O,$;for(O=function(U,ee){return U.toLowerCase().localeCompare(ee.toLowerCase())},$=function(U,ee){var Q=null;if(ee==="jc")Q=n[U];else if(ee==="Math")Q=d[U];else return;if(!(u.indexOf(U)>=0)){if(JXG$1.isFunction(Q))return{name:U,type:"function",numParams:Q.length,origin:ee};if(JXG$1.isNumber(Q))return{name:U,type:"constant",value:Q,origin:ee};U.startsWith("$")||Q!==void 0&&console.error("undefined type",Q)}},C=Object.getOwnPropertyNames(n).sort(O),I=Object.getOwnPropertyNames(d).sort(O),f=[],y=0,B=0;y<C.length||B<I.length;)C[y]===I[B]?(_=$(I[B],"Math"),JXG$1.exists(_)&&f.push(_),y++,B++):!JXG$1.exists(I[B])||C[y].toLowerCase().localeCompare(I[B].toLowerCase())<0?(_=$(C[y],"jc"),JXG$1.exists(_)&&f.push(_),y++):(_=$(I[B],"Math"),JXG$1.exists(_)&&f.push(_),B++);for(V=[],T=[],H=[],F={},Z=f.length,y=0;y<Z;y++){switch(M=f[y],M.type){case"function":V.push(M.name),M.origin==="jc"&&T.push(M.name);break;case"constant":H.push(M.name);break}F[M.name]=M}return{all:F,list:f,functions:V,functions_jessiecode:T,constants:H}},_debug:function(u){typeof console=="object"?console.log(u):JXG$1.isBrowser&&document&&document.getElementById("debug")!==null&&(document.getElementById("debug").innerHTML+=u+"<br />")},_error:function(u){var n=new Error("Error("+this.line+"): "+u);throw n.line=this.line,n},_warn:function(u){typeof console=="object"?console.log("Warning("+this.line+"): "+u):JXG$1.isBrowser&&document&&document.getElementById(this.warnLog)!==null&&(document.getElementById(this.warnLog).innerHTML+="Warning("+this.line+"): "+u+"<br />")},_log:function(u){typeof window!="object"&&typeof self=="object"&&self.postMessage?self.postMessage({type:"log",msg:"Log: "+u.toString()}):console.log("Log: ",arguments)}});var parser=function(){var u=function(ii,it,Gt,Zt){for(Gt=Gt||{},Zt=ii.length;Zt--;Gt[ii[Zt]]=it);return Gt},n=[2,14],d=[1,13],C=[1,37],I=[1,14],f=[1,15],y=[1,21],B=[1,16],_=[1,17],Z=[1,33],M=[1,18],V=[1,19],T=[1,12],H=[1,59],F=[1,60],O=[1,58],$=[1,46],U=[1,48],ee=[1,49],Q=[1,50],ie=[1,51],ne=[1,52],le=[1,53],ae=[1,54],ce=[1,45],ge=[1,38],he=[1,39],Ie=[5,7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],fe=[5,7,8,12,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],me=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],Ge=[2,48],Ze=[1,72],ye=[10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,66,83,86],Ee=[1,78],Ve=[8,10,16,32,34,35,37,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],Ye=[1,82],be=[8,10,16,32,34,35,37,39,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],Be=[1,83],Ne=[1,84],Ae=[1,85],Re=[8,10,16,32,34,35,37,39,41,42,43,50,51,53,54,55,57,64,65,66,83,86],We=[1,89],De=[1,90],Fe=[1,91],Ke=[1,92],Rt=[1,97],dt=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,53,54,55,57,64,65,66,83,86],Ut=[1,103],rt=[1,104],nt=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,57,64,65,66,83,86],we=[1,105],Jt=[1,106],It=[1,107],Ht=[1,126],mt=[1,139],ni=[83,86],kt=[1,150],Me=[10,66,86],ve=[8,10,16,20,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,82,83,86],et=[1,167],ht=[10,86],Xt={trace:function(){},yy:{},symbols_:{error:2,Program:3,StatementList:4,EOF:5,IfStatement:6,IF:7,"(":8,Expression:9,")":10,Statement:11,ELSE:12,LoopStatement:13,WHILE:14,FOR:15,";":16,DO:17,UnaryStatement:18,USE:19,IDENTIFIER:20,DELETE:21,ReturnStatement:22,RETURN:23,EmptyStatement:24,StatementBlock:25,"{":26,"}":27,ExpressionStatement:28,AssignmentExpression:29,ConditionalExpression:30,LeftHandSideExpression:31,"=":32,LogicalORExpression:33,"?":34,":":35,LogicalANDExpression:36,"||":37,EqualityExpression:38,"&&":39,RelationalExpression:40,"==":41,"!=":42,"~=":43,AdditiveExpression:44,"<":45,">":46,"<=":47,">=":48,MultiplicativeExpression:49,"+":50,"-":51,UnaryExpression:52,"*":53,"/":54,"%":55,ExponentExpression:56,"^":57,"!":58,MemberExpression:59,CallExpression:60,PrimaryExpression:61,FunctionExpression:62,MapExpression:63,".":64,"[":65,"]":66,BasicLiteral:67,ObjectLiteral:68,ArrayLiteral:69,NullLiteral:70,BooleanLiteral:71,StringLiteral:72,NumberLiteral:73,NULL:74,TRUE:75,FALSE:76,STRING:77,NUMBER:78,NAN:79,INFINITY:80,ElementList:81,"<<":82,">>":83,PropertyList:84,Property:85,",":86,PropertyName:87,Arguments:88,AttributeList:89,Attribute:90,FUNCTION:91,ParameterDefinitionList:92,MAP:93,"->":94,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"IF",8:"(",10:")",12:"ELSE",14:"WHILE",15:"FOR",16:";",17:"DO",19:"USE",20:"IDENTIFIER",21:"DELETE",23:"RETURN",26:"{",27:"}",32:"=",34:"?",35:":",37:"||",39:"&&",41:"==",42:"!=",43:"~=",45:"<",46:">",47:"<=",48:">=",50:"+",51:"-",53:"*",54:"/",55:"%",57:"^",58:"!",64:".",65:"[",66:"]",74:"NULL",75:"TRUE",76:"FALSE",77:"STRING",78:"NUMBER",79:"NAN",80:"INFINITY",82:"<<",83:">>",86:",",91:"FUNCTION",93:"MAP",94:"->"},productions_:[0,[3,2],[6,5],[6,7],[13,5],[13,9],[13,7],[18,2],[18,2],[22,2],[22,3],[24,1],[25,3],[4,2],[4,0],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[28,2],[9,1],[29,1],[29,3],[30,1],[30,5],[33,1],[33,3],[36,1],[36,3],[38,1],[38,3],[38,3],[38,3],[40,1],[40,3],[40,3],[40,3],[40,3],[44,1],[44,3],[44,3],[49,1],[49,3],[49,3],[49,3],[56,1],[56,3],[52,1],[52,2],[52,2],[52,2],[31,1],[31,1],[59,1],[59,1],[59,1],[59,3],[59,4],[61,1],[61,1],[61,1],[61,1],[61,3],[67,1],[67,1],[67,1],[67,1],[70,1],[71,1],[71,1],[72,1],[73,1],[73,1],[73,1],[69,2],[69,3],[68,2],[68,3],[84,1],[84,3],[85,3],[87,1],[87,1],[87,1],[60,2],[60,3],[60,2],[60,4],[60,3],[88,2],[88,3],[89,1],[89,3],[90,1],[90,1],[81,1],[81,3],[62,4],[62,5],[63,5],[63,6],[92,1],[92,3]],performAction:function(it,Gt,Zt,Nt,_t,_e,Pe){var Je=_e.length-1;switch(_t){case 1:return _e[Je-1];case 2:this.$=Ue.createNode(ft(Pe[Je-4]),"node_op","op_if",_e[Je-2],_e[Je]);break;case 3:this.$=Ue.createNode(ft(Pe[Je-6]),"node_op","op_if_else",_e[Je-4],_e[Je-2],_e[Je]);break;case 4:this.$=Ue.createNode(ft(Pe[Je-4]),"node_op","op_while",_e[Je-2],_e[Je]);break;case 5:this.$=Ue.createNode(ft(Pe[Je-8]),"node_op","op_for",_e[Je-6],_e[Je-4],_e[Je-2],_e[Je]);break;case 6:this.$=Ue.createNode(ft(Pe[Je-6]),"node_op","op_do",_e[Je-5],_e[Je-2]);break;case 7:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_use",_e[Je]);break;case 8:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_delete",_e[Je]);break;case 9:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_return",void 0);break;case 10:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_return",_e[Je-1]);break;case 11:case 14:this.$=Ue.createNode(ft(Pe[Je]),"node_op","op_none");break;case 12:this.$=_e[Je-1],this.$.needsBrackets=!0;break;case 13:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_none",_e[Je-1],_e[Je]);break;case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 23:case 24:case 26:case 28:case 30:case 32:case 36:case 41:case 44:case 48:case 50:case 52:case 54:case 55:case 56:case 58:case 62:case 81:case 84:case 85:case 86:this.$=_e[Je];break;case 22:case 65:case 93:this.$=_e[Je-1];break;case 25:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_assign",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 27:this.$=Ue.createNode(ft(Pe[Je-4]),"node_op","op_conditional",_e[Je-4],_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 29:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_or",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 31:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_and",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 33:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_eq",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 34:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_neq",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 35:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_approx",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 37:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_lt",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 38:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_gt",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 39:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_leq",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 40:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_geq",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 42:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_add",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 43:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_sub",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 45:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_mul",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 46:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_div",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 47:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_mod",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 49:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_exp",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 51:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_not",_e[Je]),this.$.isMath=!1;break;case 53:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_neg",_e[Je]),this.$.isMath=!0;break;case 57:case 63:case 64:case 66:case 67:case 68:case 97:this.$=_e[Je],this.$.isMath=!1;break;case 59:case 91:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_property",_e[Je-2],_e[Je]),this.$.isMath=!0;break;case 60:case 90:this.$=Ue.createNode(ft(Pe[Je-3]),"node_op","op_extvalue",_e[Je-3],_e[Je-1]),this.$.isMath=!0;break;case 61:this.$=Ue.createNode(ft(Pe[Je]),"node_var",_e[Je]);break;case 69:this.$=_e[Je],this.$.isMath=!0;break;case 70:this.$=Ue.createNode(ft(Pe[Je]),"node_const",null);break;case 71:this.$=Ue.createNode(ft(Pe[Je]),"node_const_bool",!0);break;case 72:this.$=Ue.createNode(ft(Pe[Je]),"node_const_bool",!1);break;case 73:this.$=Ue.createNode(ft(Pe[Je]),"node_str",_e[Je].substring(1,_e[Je].length-1));break;case 74:this.$=Ue.createNode(ft(Pe[Je]),"node_const",parseFloat(_e[Je]));break;case 75:this.$=Ue.createNode(ft(Pe[Je]),"node_const",NaN);break;case 76:this.$=Ue.createNode(ft(Pe[Je]),"node_const",1/0);break;case 77:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_array",[]);break;case 78:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_array",_e[Je-1]);break;case 79:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_emptyobject",{}),this.$.needsAngleBrackets=!0;break;case 80:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_proplst_val",_e[Je-1]),this.$.needsAngleBrackets=!0;break;case 82:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_proplst",_e[Je-2],_e[Je]);break;case 83:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_prop",_e[Je-2],_e[Je]);break;case 87:case 89:this.$=Ue.createNode(ft(Pe[Je-1]),"node_op","op_execfun",_e[Je-1],_e[Je]),this.$.isMath=!0;break;case 88:this.$=Ue.createNode(ft(Pe[Je-2]),"node_op","op_execfun",_e[Je-2],_e[Je-1],_e[Je],!0),this.$.isMath=!1;break;case 92:this.$=[];break;case 94:case 98:case 104:this.$=[_e[Je]];break;case 95:case 99:case 105:this.$=_e[Je-2].concat(_e[Je]);break;case 96:this.$=Ue.createNode(ft(Pe[Je]),"node_var",_e[Je]),this.$.isMath=!0;break;case 100:this.$=Ue.createNode(ft(Pe[Je-3]),"node_op","op_function",[],_e[Je]),this.$.isMath=!1;break;case 101:this.$=Ue.createNode(ft(Pe[Je-4]),"node_op","op_function",_e[Je-2],_e[Je]),this.$.isMath=!1;break;case 102:this.$=Ue.createNode(ft(Pe[Je-4]),"node_op","op_map",[],_e[Je]);break;case 103:this.$=Ue.createNode(ft(Pe[Je-5]),"node_op","op_map",_e[Je-3],_e[Je]);break}},table:[u([5,7,8,14,15,16,17,19,20,21,23,26,50,51,58,65,74,75,76,77,78,79,80,82,91,93],n,{3:1,4:2}),{1:[3]},{5:[1,3],6:6,7:d,8:C,9:20,11:4,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{1:[2,1]},u(Ie,[2,13]),u(fe,[2,15]),u(fe,[2,16]),u(fe,[2,17]),u(fe,[2,18]),u(fe,[2,19]),u(fe,[2,20]),u(fe,[2,21]),u([7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],n,{4:61}),{8:[1,62]},{8:[1,63]},{8:[1,64]},{6:6,7:d,8:C,9:20,11:65,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{20:[1,66]},{20:[1,67]},{8:C,9:69,16:[1,68],20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{16:[1,70]},u(fe,[2,11]),u(me,[2,23]),u(me,[2,24]),u([8,10,16,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],Ge,{32:[1,71],57:Ze}),u([8,10,16,32,35,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],[2,26],{34:[1,73],37:[1,74]}),u(ye,[2,54],{88:77,8:Ee,64:[1,75],65:[1,76]}),u(ye,[2,55],{88:79,8:Ee,64:[1,81],65:[1,80]}),u(Ve,[2,28],{39:Ye}),u(me,[2,56]),u(me,[2,57]),u(me,[2,58]),u(be,[2,30],{41:Be,42:Ne,43:Ae}),u(me,[2,61]),u(me,[2,62]),u(me,[2,63]),u(me,[2,64]),{8:C,9:86,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:[1,87]},{8:[1,88]},u(Re,[2,32],{45:We,46:De,47:Fe,48:Ke}),u(me,[2,66]),u(me,[2,67]),u(me,[2,68]),u(me,[2,69]),{20:Rt,72:98,73:99,77:ie,78:ne,79:le,80:ae,83:[1,93],84:94,85:95,87:96},{8:C,20:Z,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,66:[1,100],67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,81:101,82:ce,91:ge,93:he},u(dt,[2,36],{50:Ut,51:rt}),u(me,[2,70]),u(me,[2,71]),u(me,[2,72]),u(me,[2,73]),u(me,[2,74]),u(me,[2,75]),u(me,[2,76]),u(nt,[2,41],{53:we,54:Jt,55:It}),u(me,[2,44]),u(me,[2,50]),{8:C,20:Z,31:109,50:H,51:F,52:108,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:110,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:111,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{6:6,7:d,8:C,9:20,11:4,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,27:[1,112],28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:113,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:114,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:115,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{14:[1,116]},u(fe,[2,7]),u(fe,[2,8]),u(fe,[2,9]),{16:[1,117]},u(fe,[2,22]),{8:C,20:Z,29:118,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:119,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,29:120,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,36:121,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{20:[1,122]},{8:C,9:123,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(me,[2,87],{89:124,90:125,68:127,20:Ht,82:ce}),{8:C,10:[1,128],20:Z,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,81:129,82:ce,91:ge,93:he},u(me,[2,89]),{8:C,9:130,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{20:[1,131]},{8:C,20:Z,31:109,38:132,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,40:133,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,40:134,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,40:135,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{10:[1,136]},{10:[1,137],20:mt,92:138},{10:[1,140],20:mt,92:141},{8:C,20:Z,31:109,44:142,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,44:143,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,44:144,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,44:145,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(me,[2,79]),{83:[1,146],86:[1,147]},u(ni,[2,81]),{35:[1,148]},{35:[2,84]},{35:[2,85]},{35:[2,86]},u(me,[2,77]),{66:[1,149],86:kt},u(Me,[2,98]),{8:C,20:Z,31:109,49:151,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,49:152,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:153,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:154,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,31:109,50:H,51:F,52:155,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(me,[2,51]),u([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],Ge,{57:Ze}),u(me,[2,52]),u(me,[2,53]),u([5,7,8,10,12,14,15,16,17,19,20,21,23,26,27,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,58,64,65,66,74,75,76,77,78,79,80,82,83,86,91,93],[2,12]),{10:[1,156]},{10:[1,157]},{16:[1,158]},{8:[1,159]},u(fe,[2,10]),u(me,[2,25]),u(me,[2,49]),{35:[1,160]},u(Ve,[2,29],{39:Ye}),u(me,[2,59]),{66:[1,161]},u([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83],[2,88],{86:[1,162]}),u(me,[2,94]),u(me,[2,96]),u(me,[2,97]),u(ve,[2,92]),{10:[1,163],86:kt},{66:[1,164]},u(me,[2,91]),u(be,[2,31],{41:Be,42:Ne,43:Ae}),u(Re,[2,33],{45:We,46:De,47:Fe,48:Ke}),u(Re,[2,34],{45:We,46:De,47:Fe,48:Ke}),u(Re,[2,35],{45:We,46:De,47:Fe,48:Ke}),u(me,[2,65]),{25:165,26:T},{10:[1,166],86:et},u(ht,[2,104]),{94:[1,168]},{10:[1,169],86:et},u(dt,[2,37],{50:Ut,51:rt}),u(dt,[2,38],{50:Ut,51:rt}),u(dt,[2,39],{50:Ut,51:rt}),u(dt,[2,40],{50:Ut,51:rt}),u(me,[2,80]),{20:Rt,72:98,73:99,77:ie,78:ne,79:le,80:ae,85:170,87:96},{8:C,20:Z,29:171,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(me,[2,78]),{8:C,20:Z,29:172,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(nt,[2,42],{53:we,54:Jt,55:It}),u(nt,[2,43],{53:we,54:Jt,55:It}),u(me,[2,45]),u(me,[2,46]),u(me,[2,47]),{6:6,7:d,8:C,9:20,11:173,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{6:6,7:d,8:C,9:20,11:174,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:175,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:176,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,20:Z,29:177,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(me,[2,60]),{20:Ht,68:127,82:ce,90:178},u(ve,[2,93]),u(me,[2,90]),u(me,[2,100]),{25:179,26:T},{20:[1,180]},{8:C,9:181,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{94:[1,182]},u(ni,[2,82]),u(ni,[2,83]),u(Me,[2,99]),u(Ie,[2,2],{12:[1,183]}),u(fe,[2,4]),{16:[1,184]},{10:[1,185]},u(me,[2,27]),u(me,[2,95]),u(me,[2,101]),u(ht,[2,105]),u(me,[2,102]),{8:C,9:186,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{6:6,7:d,8:C,9:20,11:187,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{8:C,9:188,20:Z,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},{16:[1,189]},u(me,[2,103]),u(fe,[2,3]),{10:[1,190]},u(fe,[2,6]),{6:6,7:d,8:C,9:20,11:191,13:7,14:I,15:f,16:y,17:B,18:8,19:_,20:Z,21:M,22:9,23:V,24:11,25:5,26:T,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:H,51:F,52:56,56:57,58:O,59:26,60:27,61:29,62:30,63:31,65:$,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:U,75:ee,76:Q,77:ie,78:ne,79:le,80:ae,82:ce,91:ge,93:he},u(fe,[2,5])],defaultActions:{3:[2,1],97:[2,84],98:[2,85],99:[2,86]},parseError:function(it,Gt){if(Gt.recoverable)this.trace(it);else{var Zt=new Error(it);throw Zt.hash=Gt,Zt}},parse:function(it){var Gt=this,Zt=[0],Nt=[null],_t=[],_e=this.table,Pe="",Je=0,ze=0,Kt=2,ct=1,bt=_t.slice.call(arguments,1),Tt=Object.create(this.lexer),$t={yy:{}};for(var si in this.yy)Object.prototype.hasOwnProperty.call(this.yy,si)&&($t.yy[si]=this.yy[si]);Tt.setInput(it,$t.yy),$t.yy.lexer=Tt,$t.yy.parser=this,typeof Tt.yylloc>"u"&&(Tt.yylloc={});var Bi=Tt.yylloc;_t.push(Bi);var Ki=Tt.options&&Tt.options.ranges;typeof $t.yy.parseError=="function"?this.parseError=$t.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var Gi=function(){var pi;return pi=Tt.lex()||ct,typeof pi!="number"&&(pi=Gt.symbols_[pi]||pi),pi},_i,Di,Fn,no,Tn={},Ln,qn,vs,sn;;){if(Di=Zt[Zt.length-1],this.defaultActions[Di]?Fn=this.defaultActions[Di]:((_i===null||typeof _i>"u")&&(_i=Gi()),Fn=_e[Di]&&_e[Di][_i]),typeof Fn>"u"||!Fn.length||!Fn[0]){var on="";sn=[];for(Ln in _e[Di])this.terminals_[Ln]&&Ln>Kt&&sn.push("'"+this.terminals_[Ln]+"'");Tt.showPosition?on="Parse error on line "+(Je+1)+`:
`+Tt.showPosition()+`
Expecting `+sn.join(", ")+", got '"+(this.terminals_[_i]||_i)+"'":on="Parse error on line "+(Je+1)+": Unexpected "+(_i==ct?"end of input":"'"+(this.terminals_[_i]||_i)+"'"),this.parseError(on,{text:Tt.match,token:this.terminals_[_i]||_i,line:Tt.yylineno,loc:Bi,expected:sn})}if(Fn[0]instanceof Array&&Fn.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Di+", token: "+_i);switch(Fn[0]){case 1:Zt.push(_i),Nt.push(Tt.yytext),_t.push(Tt.yylloc),Zt.push(Fn[1]),_i=null,ze=Tt.yyleng,Pe=Tt.yytext,Je=Tt.yylineno,Bi=Tt.yylloc;break;case 2:if(qn=this.productions_[Fn[1]][1],Tn.$=Nt[Nt.length-qn],Tn._$={first_line:_t[_t.length-(qn||1)].first_line,last_line:_t[_t.length-1].last_line,first_column:_t[_t.length-(qn||1)].first_column,last_column:_t[_t.length-1].last_column},Ki&&(Tn._$.range=[_t[_t.length-(qn||1)].range[0],_t[_t.length-1].range[1]]),no=this.performAction.apply(Tn,[Pe,ze,Je,$t.yy,Fn[1],Nt,_t].concat(bt)),typeof no<"u")return no;qn&&(Zt=Zt.slice(0,-1*qn*2),Nt=Nt.slice(0,-1*qn),_t=_t.slice(0,-1*qn)),Zt.push(this.productions_[Fn[1]][0]),Nt.push(Tn.$),_t.push(Tn._$),vs=_e[Zt[Zt.length-2]][Zt[Zt.length-1]],Zt.push(vs);break;case 3:return!0}}return!0}},Ue={node:function(ii,it,Gt){return{type:ii,value:it,children:Gt}},createNode:function(ii,it,Gt,Zt){var Nt,_t=this.node(it,Gt,[]);for(Nt=3;Nt<arguments.length;Nt++)_t.children.push(arguments[Nt]);return _t.line=ii[0],_t.col=ii[1],_t.eline=ii[2],_t.ecol=ii[3],_t}},ft=function(ii){return[ii.first_line,ii.first_column,ii.last_line,ii.last_column]},Dt=function(){var ii={EOF:1,parseError:function(Gt,Zt){if(this.yy.parser)this.yy.parser.parseError(Gt,Zt);else throw new Error(Gt)},setInput:function(it,Gt){return this.yy=Gt||this.yy||{},this._input=it,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var it=this._input[0];this.yytext+=it,this.yyleng++,this.offset++,this.match+=it,this.matched+=it;var Gt=it.match(/(?:\r\n?|\n).*/g);return Gt?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),it},unput:function(it){var Gt=it.length,Zt=it.split(/(?:\r\n?|\n)/g);this._input=it+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Gt),this.offset-=Gt;var Nt=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),Zt.length-1&&(this.yylineno-=Zt.length-1);var _t=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:Zt?(Zt.length===Nt.length?this.yylloc.first_column:0)+Nt[Nt.length-Zt.length].length-Zt[0].length:this.yylloc.first_column-Gt},this.options.ranges&&(this.yylloc.range=[_t[0],_t[0]+this.yyleng-Gt]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(it){this.unput(this.match.slice(it))},pastInput:function(){var it=this.matched.substr(0,this.matched.length-this.match.length);return(it.length>20?"...":"")+it.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var it=this.match;return it.length<20&&(it+=this._input.substr(0,20-it.length)),(it.substr(0,20)+(it.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var it=this.pastInput(),Gt=new Array(it.length+1).join("-");return it+this.upcomingInput()+`
`+Gt+"^"},test_match:function(it,Gt){var Zt,Nt,_t;if(this.options.backtrack_lexer&&(_t={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(_t.yylloc.range=this.yylloc.range.slice(0))),Nt=it[0].match(/(?:\r\n?|\n).*/g),Nt&&(this.yylineno+=Nt.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:Nt?Nt[Nt.length-1].length-Nt[Nt.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+it[0].length},this.yytext+=it[0],this.match+=it[0],this.matches=it,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(it[0].length),this.matched+=it[0],Zt=this.performAction.call(this,this.yy,this,Gt,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),Zt)return Zt;if(this._backtrack){for(var _e in _t)this[_e]=_t[_e];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var it,Gt,Zt,Nt;this._more||(this.yytext="",this.match="");for(var _t=this._currentRules(),_e=0;_e<_t.length;_e++)if(Zt=this._input.match(this.rules[_t[_e]]),Zt&&(!Gt||Zt[0].length>Gt[0].length)){if(Gt=Zt,Nt=_e,this.options.backtrack_lexer){if(it=this.test_match(Zt,_t[_e]),it!==!1)return it;if(this._backtrack){Gt=!1;continue}else return!1}else if(!this.options.flex)break}return Gt?(it=this.test_match(Gt,_t[Nt]),it!==!1?it:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Gt=this.next();return Gt||this.lex()},begin:function(Gt){this.conditionStack.push(Gt)},popState:function(){var Gt=this.conditionStack.length-1;return Gt>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Gt){return Gt=this.conditionStack.length-1-Math.abs(Gt||0),Gt>=0?this.conditionStack[Gt]:"INITIAL"},pushState:function(Gt){this.begin(Gt)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(Gt,Zt,Nt,_t){switch(Nt){case 0:break;case 1:return 78;case 2:return 78;case 3:return 77;case 4:return 77;case 5:break;case 6:break;case 7:return 7;case 8:return 12;case 9:return 14;case 10:return 17;case 11:return 15;case 12:return 91;case 13:return 93;case 14:return 19;case 15:return 23;case 16:return 21;case 17:return 75;case 18:return 76;case 19:return 74;case 20:return 80;case 21:return 94;case 22:return 94;case 23:return 82;case 24:return 83;case 25:return 26;case 26:return 27;case 27:return 16;case 28:return"#";case 29:return 34;case 30:return 35;case 31:return 79;case 32:return 64;case 33:return 65;case 34:return 66;case 35:return 8;case 36:return 10;case 37:return 58;case 38:return 57;case 39:return 57;case 40:return 53;case 41:return 54;case 42:return 55;case 43:return 50;case 44:return 51;case 45:return 47;case 46:return 45;case 47:return 48;case 48:return 46;case 49:return 41;case 50:return 43;case 51:return 42;case 52:return 39;case 53:return 37;case 54:return 32;case 55:return 86;case 56:return 5;case 57:return 20;case 58:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+\b)/,/^(?:[0-9]+)/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:\/\/.*)/,/^(?:\/\*(.|\n|\r)*?\*\/)/,/^(?:if\b)/,/^(?:else\b)/,/^(?:while\b)/,/^(?:do\b)/,/^(?:for\b)/,/^(?:function\b)/,/^(?:map\b)/,/^(?:use\b)/,/^(?:return\b)/,/^(?:delete\b)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:Infinity\b)/,/^(?:->)/,/^(?:=>)/,/^(?:<<)/,/^(?:>>)/,/^(?:\{)/,/^(?:\})/,/^(?:;)/,/^(?:#)/,/^(?:\?)/,/^(?::)/,/^(?:NaN\b)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:!)/,/^(?:\^)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\/)/,/^(?:%)/,/^(?:\+)/,/^(?:-)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:==)/,/^(?:~=)/,/^(?:!=)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:=)/,/^(?:,)/,/^(?:$)/,/^(?:[A-Za-z_\$][A-Za-z0-9_]*)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58],inclusive:!0}}};return ii}();Xt.lexer=Dt;function jt(){this.yy={}}return jt.prototype=Xt,Xt.Parser=jt,new jt}();parser.yy.parseError=parser.parseError;const JessieCode=JXG$1.JessieCode;JXG$1.Composition=function(u){var n,d=this,C=["setAttribute","setParents","prepareUpdate","updateRenderer","update","fullUpdate","highlight","noHighlight"],I=function(f){return function(){var y;for(y in d.elements)d.elements.hasOwnProperty(y)&&JXG$1.exists(d.elements[y][f])&&d.elements[y][f].apply(d.elements[y],arguments);return d}};for(n=0;n<C.length;n++)this[C[n]]=I(C[n]);this.elements={},this.objects=this.elements,this.elementsByName={},this.objectsList=[],this.groups={},this.methodMap={setAttribute:"setAttribute",setProperty:"setAttribute",setParents:"setParents",add:"add",remove:"remove",select:"select"};for(n in u)u.hasOwnProperty(n)&&this.add(n,u[n]);this.dump=!0,this.subs={}};JXG$1.extend(JXG$1.Composition.prototype,{add:function(u,n){return!JXG$1.exists(this[u])&&JXG$1.exists(n)?(JXG$1.exists(n.id)?this.elements[n.id]=n:this.elements[u]=n,JXG$1.exists(n.name)&&(this.elementsByName[n.name]=n),n.on("attribute:name",this.nameListener,this),this.objectsList.push(n),this[u]=n,this.methodMap[u]=n,!0):!1},remove:function(u){var n=!1,d;for(d in this.elements)if(this.elements.hasOwnProperty(d)&&this.elements[d].id===this[u].id){n=!0;break}return n&&(delete this.elements[this[u].id],delete this[u]),n},nameListener:function(u,n,d){delete this.elementsByName[u],this.elementsByName[n]=d},select:function(u){return JXG$1.exists(JXG$1.Board)?JXG$1.Board.prototype.select.call(this,u):new JXG$1.Composition},getParents:function(){return this.parents},getType:function(){return this.elType},getAttributes:function(){var u;for(u in this.subs)this.subs.hasOwnProperty(u)&&this.subs[u].visProp;return this.attr}});const Composition=JXG$1.Composition;JXG$1.Board=function(u,n,d,C,I,f,y,B,_,Z,M){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,JXG$1.exists(M.document)&&M.document!==!1?this.document=M.document:JXG$1.isBrowser&&(this.document=document),this.container="",this.id="",this.containerObj=null,JXG$1.isString(u)?(this.container=u,this.containerObj=JXG$1.isBrowser?this.document.getElementById(this.container):null):JXG$1.isBrowser&&(this.containerObj=u,this.container=this.containerObj.getAttribute("id"),this.container===null&&(this.container="null"+parseInt(Math.random()*16777216).toString())),JXG$1.isBrowser&&n.type!=="no"&&this.containerObj===null)throw new Error(`
JSXGraph: HTML container element "`+u+'" not found.');JXG$1.exists(d)&&d!==""&&JXG$1.isBrowser&&!JXG$1.exists(this.document.getElementById(d))?this.id=d:this.id=this.generateId(),this.renderer=n,this.grids=[],this.options=JXG$1.deepCopy(Options),this.attr=M,this.attr.theme!=="default"&&JXG$1.exists(JXG$1.themes[this.attr.theme])&&JXG$1.mergeAttr(this.options,JXG$1.themes[this.attr.theme],!0),this.dimension=2,this.jc=new JessieCode,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,C[0],C[1]],this.zoomX=I,this.zoomY=f,this.unitX=y*this.zoomX,this.unitY=B*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=_,this.canvasHeight=Z,EventEmitter.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.clickObjects={},this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this.resizeHandlers=[],this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=JXG$1.Math,this.attr.registerevents===!0?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:typeof this.attr.registerevents=="object"&&(JXG$1.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),JXG$1.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),JXG$1.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),JXG$1.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),JXG$1.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),this.attr.registerevents!==!1&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",getBoundingBox:"getBoundingBox",BoundingBox:"getBoundingBox",getView:"getBoundingBox",View:"getBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}};JXG$1.extend(JXG$1.Board.prototype,{generateName:function(u){var n,d,C=this.attr.maxnamelength,I="",f="",y=[],B="";if(u.type===Const.OBJECT_TYPE_TICKS)return"";for(JXG$1.isPoint(u)||JXG$1.isPoint3D(u)?n=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:u.type===Const.OBJECT_TYPE_ANGLE?n=["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:n=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],!JXG$1.isPoint(u)&&!JXG$1.isPoint3D(u)&&u.elementClass!==Const.OBJECT_CLASS_LINE&&u.type!==Const.OBJECT_TYPE_ANGLE&&(u.type===Const.OBJECT_TYPE_POLYGON?I="P_{":u.elementClass===Const.OBJECT_CLASS_CIRCLE?I="k_{":u.elementClass===Const.OBJECT_CLASS_TEXT?I="t_{":I="s_{",f="}"),d=0;d<C;d++)y[d]=0;for(;y[C-1]<n.length;){for(y[0]=1;y[0]<n.length;y[0]++){for(B=I,d=C;d>0;d--)B+=n[y[d-1]];if(!JXG$1.exists(this.elementsByName[B+f]))return B+f}for(y[0]=n.length,d=1;d<C;d++)y[d-1]===n.length&&(y[d-1]=1,y[d]+=1)}return""},generateId:function(){for(var u=1;JXG$1.exists(JXG$1.boards["jxgBoard"+u]);)u=Math.round(Math.random()*16777216);return"jxgBoard"+u},setId:function(u,n){var d,C=this.numObjects,I=u.id;if(this.numObjects+=1,I===""||!JXG$1.exists(I))for(I=this.id+n+C;JXG$1.exists(this.objects[I]);)d=Math.round(Math.random()*65535),I=this.id+n+C+"-"+d;return u.id=I,this.objects[I]=u,u._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=u,I},finalizeAdding:function(u){JXG$1.evaluate(u.visProp.visible)===!1&&this.renderer.display(u,!1)},finalizeLabel:function(u){u.hasLabel&&!JXG$1.evaluate(u.label.visProp.islabel)&&JXG$1.evaluate(u.label.visProp.visible)===!1&&this.renderer.display(u.label,!1)},checkFrameRate:function(u){var n=!1,d=new Date().getTime();return JXG$1.exists(u.pointerId)&&this.touchMoveLastId!==u.pointerId&&(n=!0,this.touchMoveLastId=u.pointerId),!n&&(d-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(n=!0),n&&(this.touchMoveLast=d),n},getCoordsTopLeftCorner:function(){var u,n,d,C=this.document.ownerDocument||this.document,I=C.documentElement||this.document.body.parentNode,f=C.body,y=this.containerObj,B,_;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||new Date().getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=new Date().getTime(),y.getBoundingClientRect){for(d=y.getBoundingClientRect(),B=1,_=y;_&&JXG$1.exists(_.parentNode);)JXG$1.exists(_.style)&&JXG$1.exists(_.style.zoom)&&_.style.zoom!==""&&(B*=parseFloat(_.style.zoom)),_=_.parentNode;return u=[d.left*B,d.top*B],u[0]+=JXG$1.getProp(y,"border-left-width"),u[1]+=JXG$1.getProp(y,"border-top-width"),this.renderer.type!=="vml"&&(u[0]+=JXG$1.getProp(y,"padding-left"),u[1]+=JXG$1.getProp(y,"padding-top")),this.cPos=u.slice(),this.cPos}return u=JXG$1.getOffset(y),n=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&n.defaultView&&(u[0]+=JXG$1.getProp(I,"margin-left"),u[1]+=JXG$1.getProp(I,"margin-top"),u[0]+=JXG$1.getProp(I,"border-left-width"),u[1]+=JXG$1.getProp(I,"border-top-width"),u[0]+=JXG$1.getProp(I,"padding-left"),u[1]+=JXG$1.getProp(I,"padding-top")),f&&(u[0]+=JXG$1.getProp(f,"left"),u[1]+=JXG$1.getProp(f,"top")),typeof google=="object"&&google.translate&&(u[0]+=10,u[1]+=25),u[0]+=JXG$1.getProp(y,"border-left-width"),u[1]+=JXG$1.getProp(y,"border-top-width"),this.renderer.type!=="vml"&&(u[0]+=JXG$1.getProp(y,"padding-left"),u[1]+=JXG$1.getProp(y,"padding-top")),u[0]+=this.attr.offsetx,u[1]+=this.attr.offsety,this.cPos=u.slice(),this.cPos},getPointLoc:function(u,n){var d,C,I,f;return d=this.getBoundingBox(),C=u,C.length===2&&C.unshift(void 0),I=[0,0],f=n||0,JXG$1.isNumber(f)&&(f=[f,f,f,f]),C[1]>d[2]-f[1]&&(I[0]=1),C[1]<d[0]+f[3]&&(I[0]=-1),C[2]>d[1]-f[0]&&(I[1]=1),C[2]<d[3]+f[2]&&(I[1]=-1),I},getLocationOrigin:function(u){return this.getPointLoc([0,0],u)},getMousePosition:function(u,n){var d=this.getCoordsTopLeftCorner(),C,I;return C=JXG$1.getPosition(u,n,this.document),this.updateCSSTransforms(),I=[1,C[0]-d[0],C[1]-d[1]],I=Mat.matVecMult(this.cssTransMat,I),I[1]/=I[0],I[2]/=I[0],[I[1],I[2]]},initMoveOrigin:function(u,n){this.drag_dx=u-this.origin.scrCoords[1],this.drag_dy=n-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(u,n,d,C){var I,f,y=[],B=[],_,Z=this.objectsList.length,M={visProp:{layer:-1e4}};for(this._shiftKey=d.shiftKey,this._ctrlKey=d.ctrlKey,f=0;f<Z;f++)I=this.objectsList[f],_=I.hasPoint&&I.hasPoint(u,n),I.visPropCalc.visible&&_&&(I.triggerEventHandlers([C+"down","down"],[d]),this.downObjects.push(I)),_&&I.isDraggable&&I.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(I)||I.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(I.visProp.fixed)&&(I.visProp.layer>M.visProp.layer||I.visProp.layer===M.visProp.layer&&I.lastDragTime.getTime()>=M.lastDragTime.getTime())&&(!this.attr.ignorelabels||!JXG$1.exists(M.label)||I!==M.label)&&(M=I,y.push(M),JXG$1.exists(M.coords)?B.push(Statistics.subtract(M.coords.scrCoords.slice(1),[u,n])):B.push([0,0]));return this.attr.drag.enabled&&y.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(y.length=1,this._drag_offset=B[0]):(y=y.slice(-1),this._drag_offset=B[B.length-1]),this._drag_offset||(this._drag_offset=[0,0]),this.renderer.type==="svg"&&JXG$1.exists(y[0])&&JXG$1.evaluate(y[0].visProp.dragtotopoflayer)&&y.length===1&&JXG$1.exists(y[0].rendNode)&&y[0].rendNode.parentNode.appendChild(y[0].rendNode),y.length>=1&&(y[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[d,y[0]])),y},moveObject:function(u,n,d,C,I){var f=new Coords(Const.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(u,n),this),y,B,_;d&&d.obj&&(y=d.obj,y.coords&&(B=y.coords.scrCoords.slice()),this.addLogEntry("drag",y,f.usrCoords.slice(1)),this.drag_position=[f.scrCoords[1],f.scrCoords[2]],this.drag_position=Statistics.add(this.drag_position,this._drag_offset),this._shiftKey=C.shiftKey,this._ctrlKey=C.ctrlKey,JXG$1.exists(y.coords)?y.setPositionDirectly(Const.COORDS_BY_SCREEN,this.drag_position):(this.displayInfobox(!1),isNaN(d.targets[0].Xprev+d.targets[0].Yprev)||y.setPositionDirectly(Const.COORDS_BY_SCREEN,[f.scrCoords[1],f.scrCoords[2]],[d.targets[0].Xprev,d.targets[0].Yprev]),d.targets[0].Xprev=f.scrCoords[1],d.targets[0].Yprev=f.scrCoords[2]),JXG$1.exists(y.coords)&&(y.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(y),y.prepareUpdate().update(!0).updateRenderer()),y.coords&&(_=y.coords.scrCoords),(!y.coords||B[1]!==_[1]||B[2]!==_[2])&&(y.triggerEventHandlers([I+"drag","drag"],[C]),this.update()),y.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[C,y]),y.lastDragTime=new Date)},twoFingerMove:function(u,n,d){var C;if(JXG$1.exists(u)&&JXG$1.exists(u.obj))C=u.obj;else return;C.elementClass===Const.OBJECT_CLASS_LINE||C.type===Const.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(u.targets,C,n):C.elementClass===Const.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(u.targets,C,n),d&&C.triggerEventHandlers(["touchdrag","drag"],[d])},getTwoFingerTransform(u,n,d,C){var I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le;return I=new Coords(Const.COORDS_BY_SCREEN,[u.Xprev,u.Yprev],this).usrCoords,f=I[1],y=I[2],I=new Coords(Const.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this).usrCoords,B=I[1],_=I[2],I=new Coords(Const.COORDS_BY_SCREEN,[u.X,u.Y],this).usrCoords,V=I[1],T=I[2],I=new Coords(Const.COORDS_BY_SCREEN,[n.X,n.Y],this).usrCoords,H=I[1],F=I[2],Z=B-f,M=_-y,O=H-V,$=F-T,Q=Z*Z+M*M,U=(O*Z+$*M)/Q,ee=($*Z-O*M)/Q,d||(le=Mat.hypot(U,ee),U/=le,ee/=le),C||(ee=0),ie=.5*(V+H-U*(f+B)+ee*(y+_)),ne=.5*(T+F-ee*(f+B)-U*(y+_)),[1,0,0,ie,U,-ee,ne,ee,U]},twoFingerTouchObject:function(u,n,d){var C,I,f,y,B,_,Z=!1;if(JXG$1.exists(u[0])&&JXG$1.exists(u[1])&&!isNaN(u[0].Xprev+u[0].Yprev+u[1].Xprev+u[1].Yprev)){if(I=this.getTwoFingerTransform(u[0],u[1],JXG$1.evaluate(n.visProp.scalable),JXG$1.evaluate(n.visProp.rotatable)),C=this.create("transform",I,{type:"generic"}),C.update(),n.elementClass===Const.OBJECT_CLASS_LINE)f=[],n.point1.draggable()&&f.push(n.point1),n.point2.draggable()&&f.push(n.point2),C.applyOnce(f);else if(n.type===Const.OBJECT_TYPE_POLYGON){for(B=n.vertices.length-1,_=n.visProp,Z=JXG$1.evaluate(_.snaptogrid)||JXG$1.evaluate(_.snaptopoints),y=0;y<B&&!Z;++y)_=n.vertices[y].visProp,Z=Z||JXG$1.evaluate(_.snaptogrid)||JXG$1.evaluate(_.snaptopoints),Z=Z||!n.vertices[y].draggable();if(!Z){for(f=[],y=0;y<B;++y)n.vertices[y].draggable()&&f.push(n.vertices[y]);C.applyOnce(f)}}this.update(),n.highlight(!0)}},twoFingerTouchCircle:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H;n.method==="pointCircle"||n.method==="pointLine"||JXG$1.exists(u[0])&&JXG$1.exists(u[1])&&!isNaN(u[0].Xprev+u[0].Yprev+u[1].Xprev+u[1].Yprev)&&(d===u[0].num?(C=u[1],I=u[0]):(C=u[0],I=u[1]),B=new Coords(Const.COORDS_BY_SCREEN,[C.Xprev,C.Yprev],this).usrCoords,y=new Coords(Const.COORDS_BY_SCREEN,[I.Xprev,I.Yprev],this).usrCoords,f=new Coords(Const.COORDS_BY_SCREEN,[I.X,I.Y],this).usrCoords,Z=Geometry.rad(y.slice(1),B.slice(1),f.slice(1)),M=this.create("transform",[-B[1],-B[2]],{type:"translate"}),V=this.create("transform",[Z],{type:"rotate"}),M.melt(V),JXG$1.evaluate(n.visProp.scalable)&&(_=Geometry.distance(B,f)/Geometry.distance(B,y),T=this.create("transform",[_,_],{type:"scale"}),M.melt(T)),H=this.create("transform",[B[1],B[2]],{type:"translate"}),M.melt(H),n.center.draggable()&&M.applyOnce([n.center]),n.method==="twoPoints"?n.point2.draggable()&&M.applyOnce([n.point2]):n.method==="pointRadius"&&JXG$1.isNumber(n.updateRadius.origin)&&n.setRadius(n.radius*_),this.update(n.center),n.highlight(!0))},highlightElements:function(u,n,d,C){var I,f,y,B={},_=this.objectsList.length;for(I=0;I<_;I++)f=this.objectsList[I],y=f.id,JXG$1.exists(f.hasPoint)&&f.visPropCalc.visible&&f.hasPoint(u,n)&&(this.updateInfobox(f),JXG$1.exists(this.highlightedObjects[y])||(B[y]=f,f.highlight(),this.triggerEventHandlers(["mousehit","hit"],[d,f,C])),f.mouseover?f.triggerEventHandlers(["mousemove","move"],[d]):(f.triggerEventHandlers(["mouseover","over"],[d]),f.mouseover=!0));for(I=0;I<_;I++)f=this.objectsList[I],y=f.id,f.mouseover&&(B[y]||(f.triggerEventHandlers(["mouseout","out"],[d]),f.mouseover=!1))},saveStartPos:function(u,n){var d=[],C,I;if(u.type===Const.OBJECT_TYPE_TICKS)d.push([1,NaN,NaN]);else if(u.elementClass===Const.OBJECT_CLASS_LINE)d.push(u.point1.coords.usrCoords),d.push(u.point2.coords.usrCoords);else if(u.elementClass===Const.OBJECT_CLASS_CIRCLE)d.push(u.center.coords.usrCoords),u.method==="twoPoints"&&d.push(u.point2.coords.usrCoords);else if(u.type===Const.OBJECT_TYPE_POLYGON)for(I=u.vertices.length-1,C=0;C<I;C++)d.push(u.vertices[C].coords.usrCoords);else if(u.type===Const.OBJECT_TYPE_SECTOR)d.push(u.point1.coords.usrCoords),d.push(u.point2.coords.usrCoords),d.push(u.point3.coords.usrCoords);else if(JXG$1.isPoint(u)||u.type===Const.OBJECT_TYPE_GLIDER)d.push(u.coords.usrCoords);else if(u.elementClass===Const.OBJECT_CLASS_CURVE)u.points.length>0&&d.push(u.points[0].usrCoords);else try{d.push(u.coords.usrCoords)}catch(f){JXG$1.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+f)}for(I=d.length,C=0;C<I;C++)n.Zstart.push(d[C][0]),n.Xstart.push(d[C][1]),n.Ystart.push(d[C][2])},mouseOriginMoveStart:function(u){var n,d;return n=this._isRequiredKeyPressed(u,"pan"),n&&(d=this.getMousePosition(u),this.initMoveOrigin(d[0],d[1])),n},mouseOriginMove:function(u){var n=this.mode===this.BOARD_MODE_MOVE_ORIGIN,d;return n&&(d=this.getMousePosition(u),this.moveOrigin(d[0],d[1],!0)),n},touchStartMoveOriginOneFinger:function(u){var n=u.touches,d,C;return d=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&n.length===1,d&&(C=this.getMousePosition(u,0),this.initMoveOrigin(C[0],C[1])),d},touchOriginMove:function(u){var n=this.mode===this.BOARD_MODE_MOVE_ORIGIN,d;return n&&(d=this.getMousePosition(u,0),this.moveOrigin(d[0],d[1],!0)),n},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},suppressDefault:function(u){return JXG$1.exists(u)&&u.preventDefault(),!1},addEventHandlers:function(){JXG$1.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),this.containerObj!==null&&JXG$1.addEvent(this.containerObj,"contextmenu",this.suppressDefault,this)},removeEventHandlers:function(){(this.hasPointerHandlers||this.hasMouseHandlers||this.hasTouchHandlers)&&this.containerObj!==null&&JXG$1.removeEvent(this.containerObj,"contextmenu",this.suppressDefault,this),this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),this.removeResizeEventHandlers()},addResizeEventHandlers:function(){if(this.resizeHandlers=[],JXG$1.isBrowser){try{this.startResizeObserver(),this.resizeHandlers.push("resizeobserver")}catch{JXG$1.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver(),this.resizeHandlers.push("resize")}JXG$1.addEvent(window,"scroll",this.scrollListener,this),this.resizeHandlers.push("scroll");try{window.matchMedia("print").addEventListener("change",this.printListenerMatch.bind(this)),window.matchMedia("screen").addEventListener("change",this.printListenerMatch.bind(this)),this.resizeHandlers.push("print")}catch(u){JXG$1.debug("Error adding printListener",u)}}},removeResizeEventHandlers:function(){var u,n;if(this.resizeHandlers.length>0&&JXG$1.isBrowser){for(u=0;u<this.resizeHandlers.length;u++)switch(n=this.resizeHandlers[u],n){case"resizeobserver":JXG$1.exists(this.resizeObserver)&&this.stopResizeObserver();break;case"resize":JXG$1.removeEvent(window,"resize",this.resizeListener,this),JXG$1.exists(this.intersectionObserver)&&this.stopIntersectionObserver();break;case"scroll":JXG$1.removeEvent(window,"scroll",this.scrollListener,this);break;case"print":window.matchMedia("print").removeEventListener("change",this.printListenerMatch.bind(this),!1),window.matchMedia("screen").removeEventListener("change",this.printListenerMatch.bind(this),!1);break}this.resizeHandlers=[]}},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&JXG$1.isBrowser){var u=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.addEvent(u,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.addEvent(u,"pointermove",this.pointerMoveListener,this),JXG$1.addEvent(u,"pointerleave",this.pointerLeaveListener,this),JXG$1.addEvent(u,"click",this.pointerClickListener,this),JXG$1.addEvent(u,"dblclick",this.pointerDblClickListener,this)),this.containerObj!==null&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&JXG$1.isBrowser){var u=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.addEvent(u,"mousemove",this.mouseMoveListener,this),JXG$1.addEvent(u,"click",this.mouseClickListener,this),JXG$1.addEvent(u,"dblclick",this.mouseDblClickListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(u){if(!this.hasTouchHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.addEvent(n,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var u,n=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],d=n.length;if(!this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(u=0;u<d;u++)JXG$1.addEvent(this.document,n[u],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var u,n=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],d=n.length;if(this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(u=0;u<d;u++)JXG$1.removeEvent(this.document,n[u],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&JXG$1.isBrowser){var u=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.removeEvent(u,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.removeEvent(u,"pointermove",this.pointerMoveListener,this),JXG$1.removeEvent(u,"pointerleave",this.pointerLeaveListener,this),JXG$1.removeEvent(u,"click",this.pointerClickListener,this),JXG$1.removeEvent(u,"dblclick",this.pointerDblClickListener,this)),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&JXG$1.isBrowser){var u=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.removeEvent(u,"mousemove",this.mouseMoveListener,this),JXG$1.removeEvent(u,"click",this.mouseClickListener,this),JXG$1.removeEvent(u,"dblclick",this.mouseDblClickListener,this),this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&JXG$1.isBrowser){var u=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.removeEvent(u,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-this.canvasHeight*.1),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+this.canvasHeight*.1),this},gestureChangeListener:function(u){var n,d=[],C=[],I,f=10,y=!1,B=this.attr.zoom.factorx,_=this.attr.zoom.factory,Z,M,V,T,H,F=!1,O,$,U,ee;return this.mode!==this.BOARD_MODE_ZOOM?!0:(u.preventDefault(),M=Geometry.distance([u.touches[0].clientX,u.touches[0].clientY],[u.touches[1].clientX,u.touches[1].clientY],2),u.scale===void 0&&(u.scale=M/this.prevDist),!JXG$1.exists(this.prevCoords)||(d=[u.touches[0].clientX-this.prevCoords[0][0],u.touches[0].clientY-this.prevCoords[0][1]],C=[u.touches[1].clientX-this.prevCoords[1][0],u.touches[1].clientY-this.prevCoords[1][1]],d[0]*d[0]+d[1]*d[1]<f*f&&C[0]*C[0]+C[1]*C[1]<f*f)||(I=Geometry.rad(d,[0,0],C),this.isPreviousGesture!=="pan"&&Math.abs(I)>Math.PI*.2&&Math.abs(I)<Math.PI*1.8&&(y=!0),this.isPreviousGesture!=="pan"&&!y&&(Math.abs(u.scale)<.77||Math.abs(u.scale)>1.3)&&(y=!0),Z=u.scale/this.prevScale,this.prevScale=u.scale,this.prevCoords=[[u.touches[0].clientX,u.touches[0].clientY],[u.touches[1].clientX,u.touches[1].clientY]],n=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(u,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!y?(this.isPreviousGesture="pan",this.moveOrigin(n.scrCoords[1],n.scrCoords[2],!0)):this.attr.zoom.enabled&&Math.abs(Z-1)<.5&&(F=!1,H=this.attr.zoom.center,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(O=Math.abs(u.touches[0].clientX-u.touches[1].clientX),$=Math.abs(u.touches[0].clientY-u.touches[1].clientY),V=Math.abs(Math.atan2($,O)),T=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&V<T?(this.attr.zoom.factorx=Z,this.attr.zoom.factory=1,U=0,ee=0,F=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(V-Math.PI*.5)<T?(this.attr.zoom.factorx=1,this.attr.zoom.factory=Z,U=0,ee=0,F=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=Z,this.attr.zoom.factory=Z,U=n.usrCoords[1],ee=n.usrCoords[2],F=!0),F&&(H==="board"?this.zoomIn():this.zoomIn(U,ee),this.attr.zoom.factorx=B,this.attr.zoom.factory=_))),!1)},gestureStartListener:function(u){var n;return u.preventDefault(),this.prevScale=1,this.prevDist=Geometry.distance([u.touches[0].clientX,u.touches[0].clientY],[u.touches[1].clientX,u.touches[1].clientY],2),this.prevCoords=[[u.touches[0].clientX,u.touches[0].clientY],[u.touches[1].clientX,u.touches[1].clientY]],this.isPreviousGesture="none",n=this.getMousePosition(u,0),this.initMoveOrigin(n[0],n[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(u,n){var d=this.attr[n];return d.enabled?!!((d.needshift&&u.shiftKey||!d.needshift&&!u.shiftKey)&&(d.needctrl&&u.ctrlKey||!d.needctrl&&!u.ctrlKey)):!1},_isPointerRegistered:function(u){var n,d=this._board_touches.length;for(n=0;n<d;n++)if(this._board_touches[n].pointerId===u.pointerId)return!0;return!1},_pointerStorePosition:function(u){var n,d;for(n=0,d=!1;n<this._board_touches.length;n++)if(this._board_touches[n].pointerId===u.pointerId){this._board_touches[n].clientX=u.clientX,this._board_touches[n].clientY=u.clientY,d=!0;break}return!d&&this._board_touches.length<2&&this._board_touches.push({pointerId:u.pointerId,clientX:u.clientX,clientY:u.clientY}),this},_pointerRemoveTouches:function(u){var n;for(n=0;n<this._board_touches.length;n++)if(this._board_touches[n].pointerId===u.pointerId){this._board_touches.splice(n,1);break}return this},_pointerClearTouches:function(u){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(u){if(JXG$1.isBrowser){if(u.pointerType==="touch"||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if(u.pointerType==="mouse")return"mouse";if(u.pointerType==="pen")return"pen"}return"mouse"},pointerDownListener:function(u,n,d){var C,I,f,y,B,_,Z,M="mouse",V,T,H;if(!n&&this._isPointerRegistered(u))return!1;if(JXG$1.evaluate(this.attr.movetarget)===null&&JXG$1.exists(u.target)&&JXG$1.exists(u.target.releasePointerCapture)&&u.target.releasePointerCapture(u.pointerId),!n&&u.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?JXG$1.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.addEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&JXG$1.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(_=window.getSelection(),_.removeAllRanges))try{_.removeAllRanges()}catch{}if(this._inputDevice=this._getPointerInputDevice(u),M=this._inputDevice,this.options.precision.hasPoint=this.options.precision[M],y=this.getMousePosition(u),this._testForSelection(u),this.selectingMode){this._startSelecting(y),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[u]);return}if(this.attr.drag.enabled&&n?(B=[n],this.mode=this.BOARD_MODE_DRAG):B=this.initMoveObject(y[0],y[1],u,M),Z={num:u.pointerId,X:y[0],Y:y[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},B.length>0){for(T=B[B.length-1],V=!1,C=0;C<this.touches.length;C++)if(this.touches[C].obj===T){I=C,f=this.touches[C].targets.push(Z)-1,V=!0;break}V||(f=0,I=this.touches.push({obj:T,targets:[Z]})-1),this.dehighlightAll(),T.highlight(!0),this.saveStartPos(T,this.touches[I].targets[f]),u&&u.preventDefault&&!d&&u.preventDefault()}return this.touches.length>0&&!d&&(u.preventDefault(),u.stopPropagation()),JXG$1.isBrowser?(this._getPointerInputDevice(u)!=="touch"?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(u):(this._pointerStorePosition(u),u.touches=this._board_touches,u.touches.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(u)||u.touches.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(u))),H="none",this.mode===this.BOARD_MODE_NONE&&JXG$1.evaluate(this.attr.browserpan)&&!(JXG$1.evaluate(this.attr.pan.enabled)&&!JXG$1.evaluate(this.attr.pan.needtwofingers))&&(H="pan-x pan-y"),this.containerObj.style.touchAction=H,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[u]),!0):!1},_handleClicks:function(u,n){var d=this,C,I,f;if(this.selectingMode){u.stopPropagation();return}if(I=JXG$1.evaluate(this.attr.clickdelay),f=JXG$1.evaluate(this.attr.dblclicksuppressclick),f)this._preventSingleClick=!1,this._singleClickTimer=setTimeout(function(){if(!d._preventSingleClick){d.triggerEventHandlers(n,[u]);for(C in d.clickObjects)d.clickObjects.hasOwnProperty(C)&&(d.clickObjects[C].triggerEventHandlers(n,[u]),delete d.clickObjects[C])}},I);else{d.triggerEventHandlers(n,[u]);for(C in d.clickObjects)d.clickObjects.hasOwnProperty(C)&&d.clickObjects[C].triggerEventHandlers(n,[u]);setTimeout(function(){for(C in d.clickObjects)d.clickObjects.hasOwnProperty(C)&&delete d.clickObjects[C]},I)}u.stopPropagation()},_handleDblClicks:function(u,n){var d;if(this.selectingMode){u.stopPropagation();return}this._preventSingleClick=!0,clearTimeout(this._singleClickTimer),this.triggerEventHandlers(n,[u]);for(d in this.clickObjects)this.clickObjects.hasOwnProperty(d)&&(this.clickObjects[d].triggerEventHandlers(n,[u]),delete this.clickObjects[d]);u.stopPropagation()},pointerClickListener:function(u){this._handleClicks(u,["click","pointerclick"])},pointerDblClickListener:function(u){this._handleDblClicks(u,["dblclick","pointerdblclick"])},mouseClickListener:function(u){this._handleClicks(u,["click","mouseclick"])},mouseDblClickListener:function(u){this._handleDblClicks(u,["dblclick","mousedblclick"])},pointerMoveListener:function(u){var n,d,C,I,f,y="mouse";if(this._getPointerInputDevice(u)==="touch"&&!this._isPointerRegistered(u))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(u))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(u.preventDefault(),u.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(u),y=this._inputDevice,this.options.precision.hasPoint=this.options.precision[y],I=this.options.precision.hasPoint*.3333,C=this.getMousePosition(u),JXG$1.evaluate(this.attr.movetarget)===null&&C[0]<=I||C[1]<=I||C[0]>=this.canvasWidth-I||C[1]>=this.canvasHeight-I)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(C),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[u,this.mode]);else if(!this.mouseOriginMove(u))if(this.mode===this.BOARD_MODE_DRAG){for(n=0;n<this.touches.length;n++)for(f=this.touches[n].targets,d=0;d<f.length;d++)if(f[d].num===u.pointerId){f[d].X=C[0],f[d].Y=C[1],f.length===1?this.moveObject(C[0],C[1],this.touches[n],u,y):f.length===2&&(this.twoFingerMove(this.touches[n],u.pointerId,u),f[d].Xprev=C[0],f[d].Yprev=C[1]);break}}else this._getPointerInputDevice(u)==="touch"&&(this._pointerStorePosition(u),this._board_touches.length===2&&(u.touches=this._board_touches,this.gestureChangeListener(u))),this.highlightElements(C[0],C[1],u,-1);return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[u,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(u){var n,d,C,I,f,y=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[u]),this.displayInfobox(!1),u){for(n=0;n<this.touches.length;n++)for(f=this.touches[n].targets,d=0;d<f.length;d++)if(f[d].num===u.pointerId){f.splice(d,1),f.length===0&&this.touches.splice(n,1);break}}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(u),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[u]),this.stopSelectionMode();else for(n=this.downObjects.length-1;n>-1;n--){for(C=!1,d=0;d<this.touches.length;d++)this.touches[d].obj.id===this.downObjects[n].id&&(C=!0);C||(this.downObjects[n].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[u]),JXG$1.exists(this.downObjects[n].coords)||(this.downObjects[n].snapToGrid(),this.downObjects[n].snapToPoints(),y=!0),I=this.downObjects[n].eventHandlers,(JXG$1.exists(I.click)&&I.click.length>0||JXG$1.exists(I.pointerclick)&&I.pointerclick.length>0||JXG$1.exists(I.dblclick)&&I.dblclick.length>0||JXG$1.exists(I.pointerdblclick)&&I.pointerdblclick.length>0)&&(this.clickObjects[this.downObjects[n].id]=this.downObjects[n]),this.downObjects.splice(n,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(u.pointerId),this._getPointerInputDevice(u)!=="touch"&&this.dehighlightAll(),y&&this.update(),!0},pointerLeaveListener:function(u){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(u){var n,d,C,I,f,y=this.options.precision.touch,B,_,Z,M=u.touches,V,T;for(this.hasTouchEnd||(JXG$1.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,n=0;n<M.length;n++)M[n].jxg_isused=!1;for(n=0;n<this.touches.length;n++)for(T=this.touches[n].targets,I=0;I<T.length;I++){T[I].num=-1,y=this.options.precision.touch;do{for(f=0;f<M.length;f++)if(Math.abs(Math.pow(M[f].screenX-T[I].X,2)+Math.pow(M[f].screenY-T[I].Y,2))<y*y){T[I].num=f,T[I].X=M[f].screenX,T[I].Y=M[f].screenY,M[f].jxg_isused=!0;break}y*=2}while(T[I].num===-1&&y<this.options.precision.touchMax);T[I].num===-1&&(JXG$1.debug("i couldn't find a targettouches for target no "+I+" on "+this.touches[n].obj.name+" ("+this.touches[n].obj.id+"). Removed the target."),JXG$1.debug("eps = "+y+", touchMax = "+Options.precision.touchMax),T.splice(n,1))}for(n=0;n<M.length;n++)if(!M[n].jxg_isused){if(d=this.getMousePosition(u,n),this.selectingMode)return this._startSelecting(d),this.triggerEventHandlers(["touchstartselecting","startselecting"],[u]),u.preventDefault(),u.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(C=this.initMoveObject(d[0],d[1],u,"touch"),C.length!==0){if(B=C[C.length-1],V={num:n,X:M[n].screenX,Y:M[n].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},JXG$1.isPoint(B)||B.elementClass===Const.OBJECT_CLASS_TEXT||B.type===Const.OBJECT_TYPE_TICKS||B.type===Const.OBJECT_TYPE_IMAGE)Z=[V],this.saveStartPos(B,Z[0]),this.touches.push({obj:B,targets:Z}),B.highlight(!0);else if(B.elementClass===Const.OBJECT_CLASS_LINE||B.elementClass===Const.OBJECT_CLASS_CIRCLE||B.elementClass===Const.OBJECT_CLASS_CURVE||B.type===Const.OBJECT_TYPE_POLYGON){for(_=!1,I=0;I<this.touches.length;I++)B.id===this.touches[I].obj.id&&(_=!0,this.touches[I].targets.length===1&&(this.saveStartPos(B,V),this.touches[I].targets.push(V)),M[n].jxg_isused=!0);_||(Z=[V],this.saveStartPos(B,Z[0]),this.touches.push({obj:B,targets:Z}),B.highlight(!0))}}M[n].jxg_isused=!0}return this.touches.length>0&&(u.preventDefault(),u.stopPropagation()),M.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(u)||M.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(u)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[u]),!1},touchMoveListener:function(u){var n,d,C,I,f=u.touches;if(!this.checkFrameRate(u))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(u.preventDefault(),u.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(n=0;n<f.length;n++)if(!f[n].jxg_isused){d=this.getMousePosition(u,n),this._moveSelecting(d),this.triggerEventHandlers(["touchmoves","moveselecting"],[u,this.mode]);break}}else if(!this.touchOriginMove(u))if(this.mode===this.BOARD_MODE_DRAG){for(n=0;n<this.touches.length;n++)if(I=this.touches[n].targets,I.length===1){if(f[I[0].num]){if(d=this.getMousePosition(u,I[0].num),d[0]<0||d[0]>this.canvasWidth||d[1]<0||d[1]>this.canvasHeight)return;I[0].X=d[0],I[0].Y=d[1],this.moveObject(d[0],d[1],this.touches[n],u,"touch")}}else if(I.length===2&&I[0].num>-1&&I[1].num>-1&&f[I[0].num]&&f[I[1].num]){if(d=this.getMousePosition(u,I[0].num),C=this.getMousePosition(u,I[1].num),d[0]<0||d[0]>this.canvasWidth||d[1]<0||d[1]>this.canvasHeight||C[0]<0||C[0]>this.canvasWidth||C[1]<0||C[1]>this.canvasHeight)return;I[0].X=d[0],I[0].Y=d[1],I[1].X=C[0],I[1].Y=C[1],this.twoFingerMove(this.touches[n],I[0].num,u),I[0].Xprev=d[0],I[0].Yprev=d[1],I[1].Xprev=C[0],I[1].Yprev=C[1]}}else f.length===2&&this.gestureChangeListener(u),d=this.getMousePosition(u,0),this.highlightElements(d[0],d[1],u,-1);return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[u,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(u){var n,d,C,I=this.options.precision.touch,f=[],y,B,_=u&&u.touches,Z,M=!1;if(this.triggerEventHandlers(["touchend","up"],[u]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(u),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[u]),this.stopSelectionMode();else if(_&&_.length>0){for(n=0;n<this.touches.length;n++)f[n]=this.touches[n];for(this.touches.length=0,n=0;n<_.length;n++)_[n].jxg_isused=!1;for(n=0;n<f.length;n++){for(y=!1,B=0,Z=f[n].targets,d=0;d<Z.length;d++)for(Z[d].found=!1,C=0;C<_.length;C++)if(Math.abs(Math.pow(_[C].screenX-Z[d].X,2)+Math.pow(_[C].screenY-Z[d].Y,2))<I*I){Z[d].found=!0,Z[d].num=C,Z[d].X=_[C].screenX,Z[d].Y=_[C].screenY,B+=1;break}if(JXG$1.isPoint(f[n].obj)?y=Z[0]&&Z[0].found:f[n].obj.elementClass===Const.OBJECT_CLASS_LINE?y=Z[0]&&Z[0].found||Z[1]&&Z[1].found:f[n].obj.elementClass===Const.OBJECT_CLASS_CIRCLE&&(y=B===1||B===3),y)for(this.touches.push({obj:f[n].obj,targets:[]}),d=0;d<Z.length;d++)Z[d].found&&this.touches[this.touches.length-1].targets.push({num:Z[d].num,X:Z[d].screenX,Y:Z[d].screenY,Xprev:NaN,Yprev:NaN,Xstart:Z[d].Xstart,Ystart:Z[d].Ystart,Zstart:Z[d].Zstart});else f[n].obj.noHighlight()}}else this.touches.length=0;for(n=this.downObjects.length-1;n>-1;n--){for(y=!1,d=0;d<this.touches.length;d++)this.touches[d].obj.id===this.downObjects[n].id&&(y=!0);y||(this.downObjects[n].triggerEventHandlers(["touchup","up"],[u]),JXG$1.exists(this.downObjects[n].coords)||(this.downObjects[n].snapToGrid(),this.downObjects[n].snapToPoints(),M=!0),this.downObjects.splice(n,1))}return(!_||_.length===0)&&(this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),M&&this.update()),!0},mouseDownListener:function(u){var n,d,C;if(this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp)JXG$1.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0;else return;if(this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,n=this.getMousePosition(u),this._testForSelection(u),this.selectingMode){this._startSelecting(n),this.triggerEventHandlers(["mousestartselecting","startselecting"],[u]);return}return d=this.initMoveObject(n[0],n[1],u,"mouse"),d.length===0?(this.mode=this.BOARD_MODE_NONE,C=!0):(this.mouse={obj:null,targets:[{X:n[0],Y:n[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=d[d.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),u&&u.preventDefault?u.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(C=this.mouseOriginMoveStart(u)),this.triggerEventHandlers(["mousedown","down"],[u]),C},mouseMoveListener:function(u){var n;if(!this.checkFrameRate(u))return!1;n=this.getMousePosition(u),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(n),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[u,this.mode])):this.mouseOriginMove(u)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(n[0],n[1],this.mouse,u,"mouse"):this.highlightElements(n[0],n[1],u,-1),this.triggerEventHandlers(["mousemove","move"],[u,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(u){var n;if(this.selectingMode===!1&&this.triggerEventHandlers(["mouseup","up"],[u]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&(JXG$1.exists(this.mouse.obj.coords)||(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints())),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(u),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[u]),this.stopSelectionMode();else for(n=0;n<this.downObjects.length;n++)this.downObjects[n].triggerEventHandlers(["mouseup","up"],[u]);this.downObjects.length=0,this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(u){var n,d,C;return!this.attr.zoom.enabled||!this.attr.zoom.wheel||!this._isRequiredKeyPressed(u,"zoom")?!0:(u=u||window.event,n=u.detail?-u.detail:u.wheelDelta/40,d=this.attr.zoom.center,d==="board"?C=[]:C=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(u),this).usrCoords,n>0?this.zoomIn(C[1],C[2]):this.zoomOut(C[1],C[2]),this.triggerEventHandlers(["mousewheel"],[u]),u.preventDefault(),!1)},keyDownListener:function(u){var n=u.target.id,d,C,I,f,y=0,B=0,_=JXG$1.evaluate(this.attr.keyboard.dx)/this.unitX,Z=JXG$1.evaluate(this.attr.keyboard.dy)/this.unitY,M=!1,V=!0,T,H;return!this.attr.keyboard.enabled||n===""||(f=this.containerObj.shadowRoot||document,f.activeElement&&(C=f.activeElement,C.tagName==="INPUT"||C.tagName==="textarea"))?!1:(d=n.replace(this.containerObj.id+"_",""),C=this.select(d),JXG$1.exists(C.coords)&&(H=C.coords.usrCoords.slice(1)),JXG$1.evaluate(this.attr.keyboard.panshift)&&u.shiftKey||JXG$1.evaluate(this.attr.keyboard.panctrl)&&u.ctrlKey?(JXG$1.evaluate(this.attr.zoom.enabled)===!0&&(M=!0),u.keyCode===38?this.clickUpArrow():u.keyCode===40?this.clickDownArrow():u.keyCode===37?this.clickLeftArrow():u.keyCode===39?this.clickRightArrow():M&&u.keyCode===171?this.zoomIn():M&&u.keyCode===173?this.zoomOut():M&&u.keyCode===79?this.zoom100():V=!1):(JXG$1.exists(C.visProp)&&(JXG$1.exists(C.visProp.snaptogrid)&&C.visProp.snaptogrid&&JXG$1.evaluate(C.visProp.snapsizex)&&JXG$1.evaluate(C.visProp.snapsizey)?(I=C.getSnapSizes(),y=I[0],B=I[1],_=y,Z=B):JXG$1.exists(C.visProp.attracttogrid)&&C.visProp.attracttogrid&&JXG$1.evaluate(C.visProp.attractordistance)&&JXG$1.evaluate(C.visProp.attractorunit)&&(y=1.1*JXG$1.evaluate(C.visProp.attractordistance),B=y,JXG$1.evaluate(C.visProp.attractorunit)==="screen"&&(y/=this.unitX,B/=this.unitX),_=Math.max(y,_),Z=Math.max(B,Z))),u.keyCode===38?T=[0,Z]:u.keyCode===40?T=[0,-Z]:u.keyCode===37?T=[-_,0]:u.keyCode===39?T=[_,0]:V=!1,T&&C.isDraggable&&C.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(C)||C.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(C.visProp.fixed)&&(this.mode=this.BOARD_MODE_DRAG,JXG$1.exists(C.coords)&&(T[0]+=H[0],T[1]+=H[1]),JXG$1.exists(C.coords)?(C.setPosition(JXG$1.COORDS_BY_USER,T),this.updateInfobox(C)):(this.displayInfobox(!1),C.setPositionDirectly(Const.COORDS_BY_USER,T,[0,0])),this.triggerEventHandlers(["keymove","move"],[u,this.mode]),C.triggerEventHandlers(["keydrag","drag"],[u]),this.mode=this.BOARD_MODE_NONE)),this.update(),V&&JXG$1.exists(u.preventDefault)&&u.preventDefault(),V)},keyFocusInListener:function(u){var n=u.target.id,d,C;if(!this.attr.keyboard.enabled||n==="")return!1;d=n.replace(this.containerObj.id+"_",""),C=this.select(d),JXG$1.exists(C.highlight)&&(C.highlight(!0),this.focusObjects=[d],C.triggerEventHandlers(["hit"],[u])),JXG$1.exists(C.coords)&&this.updateInfobox(C)},keyFocusOutListener:function(u){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(u,n){var d=u,C=n,I,f,y;u===void 0&&(d=this.containerObj.offsetWidth,C=this.containerObj.offsetHeight),u===void 0&&window&&window.getComputedStyle&&(I=window.getComputedStyle(this.containerObj,null),f=parseFloat(I.getPropertyValue("border-left-width"))+parseFloat(I.getPropertyValue("border-right-width")),isNaN(f)||(d-=f),y=parseFloat(I.getPropertyValue("border-top-width"))+parseFloat(I.getPropertyValue("border-bottom-width")),isNaN(y)||(C-=y)),!(d<=0||C<=0||isNaN(d)||isNaN(C))&&(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),!(JXG$1.exists(this._prevDim)&&this._prevDim.w===d&&this._prevDim.h===C)&&(this.resizeContainer(d,C,!0),this._prevDim={w:d,h:C}))},startResizeObserver:function(){var u=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||(this.resizeObserver=new ResizeObserver(function(n){var d;u._isResizing||(u._isResizing=!0,d=n[0].contentRect,window.setTimeout(function(){try{u.updateContainerDims(d.width,d.height)}catch{u.stopResizeObserver()}finally{u._isResizing=!1}},u.attr.resize.throttle))}),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var u=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||!this._isScrolling&&!this._isResizing&&(this._isResizing=!0,window.setTimeout(function(){u.updateContainerDims(),u._isResizing=!1},this.attr.resize.throttle))},scrollListener:function(u){var n=this;JXG$1.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout(function(){n._isScrolling=!1},66)))},startIntersectionObserver:function(){var u=this,n={root:null,rootMargin:"0px",threshold:.8};try{this.intersectionObserver=new IntersectionObserver(function(d){isNaN(u.getBoundingBox()[0])&&u.updateContainerDims()},n),this.intersectionObserver.observe(u.containerObj)}catch{JXG$1.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){JXG$1.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},printListener:function(u){this.updateContainerDims()},printListenerMatch:function(u){u.matches&&this.printListener()},initInfobox:function(u){var n=JXG$1.copyAttributes(u,this.options,"infobox");return n.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],n),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(u){var n,d,C,I,f,y,B,_=JXG$1.evaluate(u.visProp.showinfobox);return!JXG$1.evaluate(this.attr.showinfobox)&&_==="inherit"||!_?this:(JXG$1.isPoint(u)&&(C=u.coords.usrCoords[1],I=u.coords.usrCoords[2],y=JXG$1.evaluate(this.infobox.visProp.distancex),B=JXG$1.evaluate(this.infobox.visProp.distancey),this.infobox.setCoords(C+y/this.unitX,I+B/this.unitY),f=JXG$1.evaluate(u.visProp.infoboxdigits),typeof u.infoboxText!="string"?(f==="auto"?this.infobox.useLocale()?(n=this.infobox.formatNumberLocale(C),d=this.infobox.formatNumberLocale(I)):(n=JXG$1.autoDigits(C),d=JXG$1.autoDigits(I)):JXG$1.isNumber(f)?this.infobox.useLocale()?(n=this.infobox.formatNumberLocale(C,f),d=this.infobox.formatNumberLocale(I,f)):(n=JXG$1.toFixed(C,f),d=JXG$1.toFixed(I,f)):(n=C,d=I),this.highlightInfobox(n,d,u)):this.highlightCustomInfobox(u.infoboxText,u),this.displayInfobox(!0)),this)},displayInfobox:function(u){return!u&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===Const.OBJECT_CLASS_POINT?this:(this.infobox.hiddenByParent===u&&(this.infobox.hiddenByParent=!u,this.infobox.prepareUpdate().updateVisibility(u).updateRenderer()),this)},showInfobox:function(u){return this.displayInfobox(u)},highlightInfobox:function(u,n,d){return this.highlightCustomInfobox("("+u+", "+n+")",d),this},highlightCustomInfobox:function(u,n){return this.infobox.setText(u),this},dehighlightAll:function(){var u,n,d={},C=!1;for(u in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(u)&&(n=this.highlightedObjects[u],this.focusObjects.indexOf(u)<0?((this.hasMouseHandlers||this.hasPointerHandlers)&&n.noHighlight(),C=!0):d[u]=n);return this.highlightedObjects=d,this.renderer.type==="canvas"&&C&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(u,n){return[u,n]},getUsrCoordsOfMouse:function(u){var n=this.getCoordsTopLeftCorner(),d=JXG$1.getPosition(u,null,this.document),C=d[0]-n[0],I=d[1]-n[1],f=new Coords(Const.COORDS_BY_SCREEN,[C,I],this);return f.usrCoords.slice(1)},getAllUnderMouse:function(u){var n=this.getAllObjectsUnderMouse(u);return n.push(this.getUsrCoordsOfMouse(u)),n},getAllObjectsUnderMouse:function(u){var n=this.getCoordsTopLeftCorner(),d=JXG$1.getPosition(u,null,this.document),C=d[0]-n[0],I=d[1]-n[1],f=[],y,B,_=this.objectsList.length;for(y=0;y<_;y++)B=this.objectsList[y],B.visPropCalc.visible&&B.hasPoint&&B.hasPoint(C,I)&&(f[f.length]=B);return f},updateCoords:function(){var u,n,d=this.objectsList.length;for(n=0;n<d;n++)u=this.objectsList[n],JXG$1.exists(u.coords)&&(JXG$1.evaluate(u.visProp.frozen)?u.is3D?u.element2D.coords.screen2usr():u.coords.screen2usr():u.is3D?u.element2D.coords.usr2screen():u.coords.usr2screen());return this},moveOrigin:function(u,n,d){var C,I,f,y;return JXG$1.exists(u)&&JXG$1.exists(n)&&(C=this.origin.scrCoords[1],I=this.origin.scrCoords[2],this.origin.scrCoords[1]=u,this.origin.scrCoords[2]=n,d&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),f=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,y=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(f[1]<this.maxboundingbox[0]||f[2]>this.maxboundingbox[1]||y[1]>this.maxboundingbox[2]||y[2]<this.maxboundingbox[3])&&(this.origin.scrCoords[1]=C,this.origin.scrCoords[2]=I)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(u){var n,d,C,I,f,y,B,_=[],Z=u.indexOf("<data>"),M=u.indexOf("</data>"),V=function($,U,ee,Q){return function(){var ie,ne;ie=$.select(U.id),ne=ie.coords.usrCoords[Q],Q===2?ie.setPositionDirectly(Const.COORDS_BY_USER,[ee(),ne]):ie.setPositionDirectly(Const.COORDS_BY_USER,[ne,ee()]),ie.prepareUpdate().update()}},T=function($,U,ee){return function(){var Q,ie;Q=$.select(U.id),ie=ee(),Q.setAttribute({visible:ie})}},H=function($,U,ee,Q){return function(){var ie,ne;ie=$.select(U.id),ne=ee(),Q==="strokewidth"?ie.visProp.strokewidth=ne:(ne=JXG$1.rgba2rgbo(ne),ie.visProp[Q+"color"]=ne[0],ie.visProp[Q+"opacity"]=ne[1])}},F=function($,U,ee){return function(){var Q=$.select(U.id);Q.position=ee()}},O=function($,U,ee){return function(){var Q=$.select(U.id);Q.setStyle(ee())}};if(!(Z<0)){for(;Z>=0;){if(n=u.slice(Z+6,M),d=n.indexOf("="),C=n.slice(0,d),I=n.slice(d+1),d=C.indexOf("."),f=C.slice(0,d),y=this.elementsByName[JXG$1.unescapeHTML(f)],B=C.slice(d+1).replace(/\s+/g,"").toLowerCase(),I=JXG$1.createFunction(I,this,"",!0),!JXG$1.exists(this.elementsByName[f]))JXG$1.debug("debug conditions: |"+f+"| undefined");else switch(B){case"x":_.push(V(this,y,I,2));break;case"y":_.push(V(this,y,I,1));break;case"visible":_.push(T(this,y,I));break;case"position":_.push(F(this,y,I));break;case"stroke":_.push(H(this,y,I,"stroke"));break;case"style":_.push(O(this,y,I));break;case"strokewidth":_.push(H(this,y,I,"strokewidth"));break;case"fill":_.push(H(this,y,I,"fill"));break;case"label":break;default:JXG$1.debug('property "'+B+'" in conditions not yet implemented:'+I);break}u=u.slice(M+7),Z=u.indexOf("<data>"),M=u.indexOf("</data>")}this.updateConditions=function(){var $;for($=0;$<_.length;$++)_[$]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var u,n,d=this.getBoundingBox(),C=JXG$1.evaluate(this.options.grid.majorStep),I=JXG$1.evaluate(this.options.grid.gridX),f=JXG$1.evaluate(this.options.grid.gridY),y,B;for(JXG$1.isArray(C)||(C=[C,C]),C.length<2&&(C=[C[0],C[0]]),JXG$1.exists(I)&&(C[0]=I),JXG$1.exists(f)&&(C[1]=f),C[0]==="auto"?C[0]=1:C[0]=JXG$1.parseNumber(C[0],Math.abs(d[1]-d[3]),1/this.unitX),C[1]==="auto"?C[1]=1:C[1]=JXG$1.parseNumber(C[1],Math.abs(d[0]-d[2]),1/this.unitY),u=new Coords(Const.COORDS_BY_USER,[0,0],this),n=new Coords(Const.COORDS_BY_USER,[C[0],C[1]],this),y=u.scrCoords[1]-n.scrCoords[1],B=u.scrCoords[2]-n.scrCoords[2],this.options.grid.snapSizeX=C[0];Math.abs(y)>25;)this.options.grid.snapSizeX*=2,y/=2;for(this.options.grid.snapSizeY=C[1];Math.abs(B)>25;)this.options.grid.snapSizeY*=2,B/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(u,n){var d=this.getBoundingBox(),C=this.attr.zoom.factorx,I=this.attr.zoom.factory,f=(d[2]-d[0])*(1-1/C),y=(d[1]-d[3])*(1-1/I),B=.5,_=.5,Z=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX>this.attr.zoom.max&&C>1||this.zoomY>this.attr.zoom.max&&I>1||this.zoomX<Z&&C<1||this.zoomY<Z&&I<1?this:(JXG$1.isNumber(u)&&JXG$1.isNumber(n)&&(B=(u-d[0])/(d[2]-d[0]),_=(d[1]-n)/(d[1]-d[3])),this.setBoundingBox([d[0]+f*B,d[1]-y*_,d[2]-f*(1-B),d[3]+y*(1-_)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(u,n){var d=this.getBoundingBox(),C=this.attr.zoom.factorx,I=this.attr.zoom.factory,f=(d[2]-d[0])*(1-C),y=(d[1]-d[3])*(1-I),B=.5,_=.5,Z=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX<Z||this.zoomY<Z?this:(JXG$1.isNumber(u)&&JXG$1.isNumber(n)&&(B=(u-d[0])/(d[2]-d[0]),_=(d[1]-n)/(d[1]-d[3])),this.setBoundingBox([d[0]+f*B,d[1]-y*_,d[2]-f*(1-B),d[3]+y*(1-_)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var u,n,d;return JXG$1.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(u=this.getBoundingBox(),n=(u[2]-u[0])*(1-this.zoomX)*.5,d=(u[1]-u[3])*(1-this.zoomY)*.5,this.setBoundingBox([u[0]+n,u[1]-d,u[2]-n,u[3]+d],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var u,n,d,C,I,f=0,y=0,B=0,_=0,Z=this.objectsList.length;for(u=0;u<Z;u++)I=this.objectsList[u],JXG$1.isPoint(I)&&I.visPropCalc.visible&&(I.coords.usrCoords[1]<f?f=I.coords.usrCoords[1]:I.coords.usrCoords[1]>y&&(y=I.coords.usrCoords[1]),I.coords.usrCoords[2]>_?_=I.coords.usrCoords[2]:I.coords.usrCoords[2]<B&&(B=I.coords.usrCoords[2]));return n=50,d=n/this.unitX,C=n/this.unitY,this.setBoundingBox([f-d,_+C,y+d,B-C],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(u){var n,d,C,I=[1/0,-1/0,-1/0,1/0],f,y,B,_,Z;if(!JXG$1.isArray(u)||u.length===0)return this;for(n=0;n<u.length;n++)d=this.select(u[n]),C=d.bounds(),JXG$1.isArray(C)&&(C[0]<I[0]&&(I[0]=C[0]),C[1]>I[1]&&(I[1]=C[1]),C[2]>I[2]&&(I[2]=C[2]),C[3]<I[3]&&(I[3]=C[3]));return JXG$1.isArray(I)&&(f=.5*(I[0]+I[2]),y=.5*(I[1]+I[3]),B=1.5*(I[2]-I[0])*.5,_=1.5*(I[1]-I[3])*.5,Z=Math.max(B,_),this.setBoundingBox([f-Z,y+Z,f+Z,y-Z],this.keepaspectratio,"update")),this},setZoom:function(u,n){var d=this.attr.zoom.factorx,C=this.attr.zoom.factory;return this.attr.zoom.factorx=u/this.zoomX,this.attr.zoom.factory=n/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=d,this.attr.zoom.factory=C,this},_removeObj:function(u,n){var d,C;if(JXG$1.isArray(u)){for(C=0;C<u.length;C++)this._removeObj(u[C],n);return this}if(u=this.select(u),!JXG$1.exists(u)||JXG$1.isString(u))return this;try{for(d in u.childElements)u.childElements.hasOwnProperty(d)&&u.childElements[d].board._removeObj(u.childElements[d]);for(d in u.objects)u.objects.hasOwnProperty(d)&&u.objects[d].board._removeObj(u.objects[d]);if(n)for(d in this.objects)this.objects.hasOwnProperty(d)&&JXG$1.exists(this.objects[d].childElements)&&JXG$1.exists(this.objects[d].childElements.hasOwnProperty(u.id))&&(delete this.objects[d].childElements[u.id],delete this.objects[d].descendants[u.id]);else if(JXG$1.exists(u.ancestors))for(d in u.ancestors)u.ancestors.hasOwnProperty(d)&&JXG$1.exists(u.ancestors[d].childElements)&&JXG$1.exists(u.ancestors[d].childElements.hasOwnProperty(u.id))&&(delete u.ancestors[d].childElements[u.id],delete u.ancestors[d].descendants[u.id]);if(u._pos>-1)for(this.objectsList.splice(u._pos,1),C=u._pos;C<this.objectsList.length;C++)this.objectsList[C]._pos--;else u.type!==Const.OBJECT_TYPE_TURTLE&&JXG$1.debug("Board.removeObject: object "+u.id+" not found in list.");delete this.objects[u.id],delete this.elementsByName[u.name],u.visProp&&JXG$1.evaluate(u.visProp.trace)&&u.clearTrace(),JXG$1.exists(u.remove)&&u.remove()}catch(I){JXG$1.debug(u.id+": Could not be removed: "+I)}return this},removeObject:function(u,n){var d;if(this.renderer.suspendRedraw(this),JXG$1.isArray(u))for(d=0;d<u.length;d++)this._removeObj(u[d],n);else this._removeObj(u,n);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(u){var n;for(n in u.ancestors)u.ancestors.hasOwnProperty(n)&&this.removeAncestors(u.ancestors[n]);return this.removeObject(u),this},initGeonextBoard:function(){var u,n,d;return u=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),n=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),d=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[u,n],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[u,d],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(u,n,d,C){var I,f,y,B,_;return f=this.canvasWidth,y=this.canvasHeight,C||(I=this.getBoundingBox()),this.canvasWidth=parseFloat(u),this.canvasHeight=parseFloat(n),d||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),C?(B=(this.canvasWidth-f)*.5,_=(this.canvasHeight-y)*.5,this.moveOrigin(this.origin.scrCoords[1]+B,this.origin.scrCoords[2]+_)):this.setBoundingBox(I,this.keepaspectratio,"keep"),this},showDependencies:function(){var u,n,d,C,I;n=`<p>
`;for(u in this.objects)if(this.objects.hasOwnProperty(u)){I=0;for(d in this.objects[u].childElements)this.objects[u].childElements.hasOwnProperty(d)&&(I+=1);I>=0&&(n+="<strong>"+this.objects[u].id+":</strong> ");for(d in this.objects[u].childElements)this.objects[u].childElements.hasOwnProperty(d)&&(n+=this.objects[u].childElements[d].id+"("+this.objects[u].childElements[d].name+"), ");n+=`<p>
`}return n+=`</p>
`,C=window.open(),C.document.open(),C.document.write(n),C.document.close(),this},showXML:function(){var u=window.open("");return u.document.open(),u.document.write("<pre>"+JXG$1.escapeHTML(this.xmlString)+"</pre>"),u.document.close(),this},prepareUpdate:function(){var u,n,d=this.objectsList.length;for(u=0;u<d;u++)n=this.objectsList[u],n.needsUpdate=n.needsRegularUpdate||this.needsFullUpdate;for(u in this.groups)this.groups.hasOwnProperty(u)&&(n=this.groups[u],n.needsUpdate=n.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(u){var n,d;for(u=this.select(u),n=0;n<this.objectsList.length;n++)d=this.objectsList[n],this.needsFullUpdate&&d.elementClass===Const.OBJECT_CLASS_TEXT&&d.updateSize(),d.update(!JXG$1.exists(u)||d.id!==u.id).updateVisibility();for(n in this.groups)this.groups.hasOwnProperty(n)&&this.groups[n].update(u);return this},updateRenderer:function(){var u,n=this.objectsList.length;if(this.renderer){if(this.renderer.type==="canvas")this.updateRendererCanvas();else for(u=0;u<n;u++)this.objectsList[u].updateRenderer();return this}},updateRendererCanvas:function(){var u,n,d,C,I,f=this.objectsList.length,y=this.options.layer,B=this.options.layer.numlayers,_=Number.NEGATIVE_INFINITY;for(d=0;d<B;d++){C=Number.POSITIVE_INFINITY;for(I in y)y.hasOwnProperty(I)&&y[I]>_&&y[I]<C&&(C=y[I]);for(_=C,u=0;u<f;u++)n=this.objectsList[u],n.visProp.layer===C&&n.prepareUpdate().updateRenderer()}return this},addHook:function(u,n,d){return JXG$1.deprecated("Board.addHook()","Board.on()"),n=JXG$1.def(n,"update"),d=JXG$1.def(d,this),this.hooks.push([n,u]),this.on(n,u,d),this.hooks.length-1},addEvent:JXG$1.shortcut(JXG$1.Board.prototype,"on"),removeHook:function(u){return JXG$1.deprecated("Board.removeHook()","Board.off()"),this.hooks[u]&&(this.off(this.hooks[u][0],this.hooks[u][1]),this.hooks[u]=null),this},removeEvent:JXG$1.shortcut(JXG$1.Board.prototype,"off"),updateHooks:function(u){var n=Array.prototype.slice.call(arguments,0);return JXG$1.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),n[0]=JXG$1.def(n[0],"update"),this.triggerEventHandlers([n[0]],arguments),this},addChild:function(u){return JXG$1.exists(u)&&JXG$1.exists(u.containerObj)&&(this.dependentBoards.push(u),this.update()),this},removeChild:function(u){var n;for(n=this.dependentBoards.length-1;n>=0;n--)this.dependentBoards[n]===u&&this.dependentBoards.splice(n,1);return this},update:function(u){var n,d,C,I,f;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,this.attr.minimizereflow==="all"&&this.containerObj&&this.renderer.type!=="vml"&&(f=this.document.activeElement,I=this.renderer.removeToInsertLater(this.containerObj)),this.attr.minimizereflow==="svg"&&this.renderer.type==="svg"&&(f=this.document.activeElement,I=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate().updateElements(u).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),I&&(I(),f.focus()),d=this.dependentBoards.length,n=0;n<d;n++)C=this.dependentBoards[n],JXG$1.exists(C)&&C!==this&&(C.updateQuality=this.updateQuality,C.prepareUpdate().updateElements().updateConditions(),C.renderer.suspendRedraw(this),C.updateRenderer(),C.renderer.unsuspendRedraw(),C.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var u;for(u=0;u<this.grids.length;u++)this.removeObject(this.grids[u]);return this.grids.length=0,this.update(),this},create:function(u,n,d){var C,I;for(u=u.toLowerCase(),JXG$1.exists(n)||(n=[]),JXG$1.exists(d)||(d={}),I=0;I<n.length;I++)JXG$1.isString(n[I])&&!(u==="text"&&I===2)&&!(u==="solidofrevolution3d"&&I===2)&&!(u==="text3d"&&(I===2||I===4))&&!((u==="input"||u==="checkbox"||u==="button")&&(I===2||I===3))&&u!=="curve"&&u!=="functiongraph"&&u!=="implicitcurve"&&(n[I]=this.select(n[I]));if(JXG$1.isFunction(JXG$1.elements[u]))C=JXG$1.elements[u](this,n,d);else throw new Error("JSXGraph: create: Unknown element type given: "+u);return JXG$1.exists(C)?(C.prepareUpdate&&C.update&&C.updateRenderer&&C.fullUpdate(),C):(JXG$1.debug("JSXGraph: create: failure creating "+u),C)},createElement:function(){return JXG$1.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var u;for(u=0;u<this.objectsList.length;u++)this.objectsList[u].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(u,n,d){var C,I,f,y,B=0,_=0,Z=1,M,V,T,H,F,O=JXG$1.getDimensions(this.containerObj,this.document);return JXG$1.isArray(u)?u[0]<this.maxboundingbox[0]||u[1]>this.maxboundingbox[1]||u[2]>this.maxboundingbox[2]||u[3]<this.maxboundingbox[3]?this:(JXG$1.exists(d)||(d="reset"),f=this.unitX,y=this.unitY,this.canvasWidth=parseFloat(O.width),this.canvasHeight=parseFloat(O.height),I=this.canvasWidth,C=this.canvasHeight,n?(this.keepaspectratio?(M=f/y,isNaN(M)&&(M=1)):M=1,d==="keep"&&(Z=this.zoomX/this.zoomY),V=u[2]-u[0],T=u[1]-u[3],H=f*V,F=y*T,I>=C?H>=F?(this.unitY=C/T,this.unitX=this.unitY*M):(this.unitY=C/Math.abs(V)*Mat.sign(T)/Z,this.unitX=this.unitY*M):F>H?(this.unitX=I/V,this.unitY=this.unitX/M):(this.unitX=I/Math.abs(T)*Mat.sign(V)*Z,this.unitY=this.unitX/M),B=(I/this.unitX-V)*.5,_=(C/this.unitY-T)*.5,this.keepaspectratio=!0):(this.unitX=I/(u[2]-u[0]),this.unitY=C/(u[1]-u[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(u[0]-B),this.unitY*(u[1]+_)),d==="update"?(this.zoomX*=this.unitX/f,this.zoomY*=this.unitY/y):d==="reset"&&(this.zoomX=JXG$1.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=JXG$1.exists(this.attr.zoomy)?this.attr.zoomy:1),this):this},getBoundingBox:function(){var u=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,n=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[u[1],u[2],n[1],n[2]]},_set:function(u,n){u=u.toLocaleLowerCase(),n!==null&&JXG$1.isObject(n)&&!JXG$1.exists(n.id)&&!JXG$1.exists(n.name)?JXG$1.mergeAttr(this.attr[u],n):this.attr[u]=n},setAttribute:function(u){var n,d,C,I,f,y,B,_={};for(n=0;n<arguments.length;n++)d=arguments[n],JXG$1.isString(d)?(C=d.split(":"),_[JXG$1.trim(C[0])]=JXG$1.trim(C[1])):JXG$1.isArray(d)?_[d[0]]=d[1]:JXG$1.extend(_,d);for(n in _)if(_.hasOwnProperty(n)&&(I=n.replace(/\s+/g,"").toLowerCase(),f=_[n]),f=f.toLowerCase&&f.toLowerCase()==="false"?!1:f,y=this.attr[I],y!==f)switch(I){case"axis":f===!1&&JXG$1.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(f,this.keepaspectratio),this._set(I,f);break;case"defaultaxes":JXG$1.exists(this.defaultAxes.x)&&JXG$1.exists(f.x)&&this.defaultAxes.x.setAttribute(f.x),JXG$1.exists(this.defaultAxes.y)&&JXG$1.exists(f.y)&&this.defaultAxes.y.setAttribute(f.y);break;case"description":this.document.getElementById(this.container+"_ARIAdescription").innerHTML=f,this._set(I,f);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=f,this._set(I,f);break;case"keepaspectratio":this._set(I,f),this.setBoundingBox(this.getBoundingBox(),f,"keep");break;case"document":case"maxboundingbox":this[I]=f,this._set(I,f);break;case"zoomx":case"zoomy":this[I]=f,this._set(I,f),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":B=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+I),B&&JXG$1.exists(f.symbol)&&(B.innerHTML=JXG$1.evaluate(f.symbol)),this._set(I,f);break;case"selection":f.visible=!1,f.withLines=!1,f.vertices={visible:!1},this._set(I,f);break;case"showcopyright":this.renderer.type==="svg"&&(B=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")),B?B.style.display=JXG$1.evaluate(f)?"inline":"none":JXG$1.evaluate(f)&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)));default:JXG$1.exists(this.attr[I])&&this._set(I,f);break}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[_,this]),this.fullUpdate(),this},addAnimation:function(u){var n=this;return this.animationObjects[u.id]=u,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){n.animate()},u.board.attr.animationdelay)),this},stopAllAnimation:function(){var u;for(u in this.animationObjects)this.animationObjects.hasOwnProperty(u)&&JXG$1.exists(this.animationObjects[u])&&(this.animationObjects[u]=null,delete this.animationObjects[u]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var u,n,d,C,I,f,y,B,_=0,Z=null;for(n in this.animationObjects)if(this.animationObjects.hasOwnProperty(n)&&JXG$1.exists(this.animationObjects[n])){if(_+=1,d=this.animationObjects[n],d.animationPath&&(JXG$1.isFunction(d.animationPath)?C=d.animationPath(new Date().getTime()-d.animationStart):C=d.animationPath.pop(),!JXG$1.exists(C)||!JXG$1.isArray(C)&&isNaN(C)?delete d.animationPath:(d.setPositionDirectly(Const.COORDS_BY_USER,C),d.fullUpdate(),Z=d)),d.animationData){y=0;for(I in d.animationData)d.animationData.hasOwnProperty(I)&&(f=d.animationData[I].pop(),JXG$1.exists(f)?(y+=1,u={},u[I]=f,d.setAttribute(u)):delete d.animationData[f]);y===0&&delete d.animationData}!JXG$1.exists(d.animationData)&&!JXG$1.exists(d.animationPath)&&(this.animationObjects[n]=null,delete this.animationObjects[n],JXG$1.exists(d.animationCallback)&&(B=d.animationCallback,d.animationCallback=null,B()))}return _===0?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(Z),this},migratePoint:function(u,n,d){var C,I,f,y,B,_,Z=!1;u=this.select(u),n=this.select(n),JXG$1.exists(u.label)&&(_=u.label.id,Z=!0,this.removeObject(u.label));for(I in u.childElements)if(u.childElements.hasOwnProperty(I)){C=u.childElements[I],y=!1;for(f in C)C.hasOwnProperty(f)&&C[f]===u&&(C[f]=n,y=!0);for(y&&delete u.childElements[I],B=0;B<C.parents.length;B++)C.parents[B]===u.id&&(C.parents[B]=n.id);n.addChild(C)}return d&&(Z&&(delete n.childElements[_],delete n.descendants[_]),n.label&&this.removeObject(n.label),delete this.elementsByName[n.name],n.name=u.name,Z&&n.createLabel()),this.removeObject(u),JXG$1.exists(n.name)&&n.name!==""&&(this.elementsByName[n.name]=n),this.fullUpdate(),this},emulateColorblindness:function(u){var n,d;if(JXG$1.exists(u)||(u="none"),this.currentCBDef===u)return this;for(n in this.objects)this.objects.hasOwnProperty(n)&&(d=this.objects[n],u!=="none"?(this.currentCBDef==="none"&&(d.visPropOriginal={strokecolor:d.visProp.strokecolor,fillcolor:d.visProp.fillcolor,highlightstrokecolor:d.visProp.highlightstrokecolor,highlightfillcolor:d.visProp.highlightfillcolor}),d.setAttribute({strokecolor:JXG$1.rgb2cb(JXG$1.evaluate(d.visPropOriginal.strokecolor),u),fillcolor:JXG$1.rgb2cb(JXG$1.evaluate(d.visPropOriginal.fillcolor),u),highlightstrokecolor:JXG$1.rgb2cb(JXG$1.evaluate(d.visPropOriginal.highlightstrokecolor),u),highlightfillcolor:JXG$1.rgb2cb(JXG$1.evaluate(d.visPropOriginal.highlightfillcolor),u)})):JXG$1.exists(d.visPropOriginal)&&JXG$1.extend(d.visProp,d.visPropOriginal));return this.currentCBDef=u,this.update(),this},select:function(u,n){var d,C,I,f,y=u;if(y===null)return y;if(JXG$1.isString(y)&&y!=="")JXG$1.exists(this.objects[y])?y=this.objects[y]:JXG$1.exists(this.elementsByName[y])?y=this.elementsByName[y]:JXG$1.exists(this.groups[y])&&(y=this.groups[y]);else if(!n&&(JXG$1.isFunction(y)||JXG$1.isObject(y)&&!JXG$1.isFunction(y.setAttribute))){for(d=JXG$1.filterElements(this.objectsList,y),C={},f=d.length,I=0;I<f;I++)C[d[I].id]=d[I];y=new Composition(C)}else JXG$1.isObject(y)&&JXG$1.exists(y.id)&&!JXG$1.exists(this.objects[y.id])&&(y=null);return y},hasPoint:function(u,n){var d=u,C=n,I=this.getBoundingBox();return JXG$1.exists(u)&&JXG$1.isArray(u.usrCoords)&&(d=u.usrCoords[1],C=u.usrCoords[2]),!!(JXG$1.isNumber(d)&&JXG$1.isNumber(C)&&I[0]<d&&d<I[2]&&I[1]>C&&C>I[3])},updateCSSTransforms:function(){var u=this.containerObj,n=u,d=u;if(this.cssTransMat=JXG$1.getCSSTransformMatrix(n),JXG$1.exists(n.getRootNode)){for(n=n.parentNode===n.getRootNode()?n.parentNode.host:n.parentNode;n;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(n),this.cssTransMat),n=n.parentNode===n.getRootNode()?n.parentNode.host:n.parentNode;this.cssTransMat=Mat.inverse(this.cssTransMat)}else{for(n=n.offsetParent;n;){for(this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(n),this.cssTransMat),d=d.parentNode;d!==n;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(n),this.cssTransMat),d=d.parentNode;n=n.offsetParent}this.cssTransMat=Mat.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(u){this.isSelecting=!0,this.selectingBox=[[u[0],u[1]],[u[0],u[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(u){this.isSelecting&&(this.selectingBox[1]=[u[0],u[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(u){var n=this.getMousePosition(u);this.isSelecting=!1,this.selectingBox[1]=[n[0],n[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var u=this.selectingBox[0],n=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[u[0],u[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[u[0],n[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],n[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],u[1]])},_testForSelection:function(u){this._isRequiredKeyPressed(u,"selection")&&(JXG$1.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(u){var n;return JXG$1.exists(this.selectionPolygon)||(n=JXG$1.copyAttributes(u,Options,"board","selection"),n.enabled===!0&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],n))),this},__evt__attribute:function(u){},__evt__down:function(u){},__evt__mousedown:function(u){},__evt__pendown:function(u){},__evt__pointerdown:function(u){},__evt__touchstart:function(u){},__evt__up:function(u){},__evt__mouseup:function(u){},__evt__pointerup:function(u){},__evt__touchend:function(u){},__evt__click:function(u){},__evt__dblclick:function(u){},__evt__mouseclick:function(u){},__evt__mousedblclick:function(u){},__evt__pointerclick:function(u){},__evt__pointerdblclick:function(u){},__evt__move:function(u,n){},__evt__mousemove:function(u,n){},__evt__penmove:function(u,n){},__evt__pointermove:function(u,n){},__evt__touchmove:function(u,n){},__evt__keymove:function(u,n){},__evt__hit:function(u,n,d){},__evt__mousehit:function(u,n,d){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(u){var n,d,C,I,f=this.document,y;return u=u||this.container,this._fullscreen_inner_id=u,C=f.getElementById(u),n="fullscreenwrap_"+u,JXG$1.exists(C._cssFullscreenStore)||(I=this.containerObj.getBoundingClientRect(),C._cssFullscreenStore={w:I.width,h:I.height}),f.getElementById(n)?d=f.getElementById(n):(d=document.createElement("div"),d.classList.add("JXG_wrap_private"),d.setAttribute("id",n),C.parentNode.insertBefore(d,C),d.appendChild(C)),d.requestFullscreen=d.requestFullscreen||d.webkitRequestFullscreen||d.mozRequestFullScreen||d.msRequestFullscreen,f.fullscreenElement!==void 0?y=f.fullscreenElement:f.webkitFullscreenElement!==void 0?y=f.webkitFullscreenElement:y=f.msFullscreenElement,y===null?d.requestFullscreen&&(d.requestFullscreen(),this.startFullscreenResizeObserver(d)):(this.stopFullscreenResizeObserver(d),JXG$1.exists(document.exitFullscreen)?document.exitFullscreen():JXG$1.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(u){var n,d,C,I=this.document;n=this._fullscreen_inner_id,JXG$1.exists(n)&&(I.fullscreenElement!==void 0?C=I.fullscreenElement:I.webkitFullscreenElement!==void 0?C=I.webkitFullscreenElement:C=I.msFullscreenElement,d=I.getElementById(n),C?(d._cssFullscreenStore.id=C.id,d._cssFullscreenStore.isFullscreen=!0,d._cssFullscreenStore.margin=d.style.margin,d._cssFullscreenStore.width=d.style.width,d._cssFullscreenStore.height=d.style.height,d._cssFullscreenStore.transform=d.style.transform,d.style.width=d._cssFullscreenStore.w+"px",d.style.height=d._cssFullscreenStore.h+"px",d.style.margin="",JXG$1.scaleJSXGraphDiv(C.id,n,I,JXG$1.evaluate(this.attr.fullscreen.scale)),C=null):JXG$1.exists(d._cssFullscreenStore)&&(d._cssFullscreenStore.isFullscreen=!1,d.style.margin=d._cssFullscreenStore.margin,d.style.width=d._cssFullscreenStore.width,d.style.height=d._cssFullscreenStore.height,d.style.transform=d._cssFullscreenStore.transform,d._cssFullscreenStore=null,d.parentElement.replaceWith(d)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(u){var n=this;return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(this.resizeObserver=new ResizeObserver(function(d){var C,I,f=n.document;n._isResizing||(n._isResizing=!0,window.setTimeout(function(){try{C=n._fullscreen_inner_id,f.fullscreenElement!==void 0?I=f.fullscreenElement:f.webkitFullscreenElement!==void 0?I=f.webkitFullscreenElement:I=f.msFullscreenElement,I!==null&&JXG$1.scaleJSXGraphDiv(I.id,C,f,JXG$1.evaluate(n.attr.fullscreen.scale))}catch{n.stopFullscreenResizeObserver(u)}finally{n._isResizing=!1}},n.attr.resize.throttle))}),this.resizeObserver.observe(u),this)},stopFullscreenResizeObserver:function(u){return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(u),this)},addLogEntry:function(u,n,d){var C,I,f=this.userLog.length-1;return JXG$1.exists(n.elementClass)&&(I=n.id),JXG$1.evaluate(this.attr.logging.enabled)&&(C=new Date().getTime(),f>=0&&this.userLog[f].type===u&&this.userLog[f].id===I&&C-this.userLog[f].end<500?(this.userLog[f].end=C,this.userLog[f].endpos=d):this.userLog.push({type:u,id:I,start:C,startpos:d,end:C,endpos:d,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(u,n,d,C,I,f,y){var B=this,_=function(){var Z=0,M=0,V=0,T=d,H=Numerics.root(function(ge){var he=u.X(T),Ie=u.Y(T),fe=n.X(ge),me=n.Y(ge);return(he-fe)*(he-fe)+(Ie-me)*(Ie-me)},[0,Math.PI*2]),F=0,O=0,$,U=B.create("transform",[function(){return Z}],{type:"rotate"}),ee=B.create("transform",[function(){return Z},function(){return u.X(T)},function(){return u.Y(T)}],{type:"rotate"}),Q=B.create("transform",[function(){return M},function(){return V}],{type:"translate"}),ie=function(ge,he,Ie){var fe=Numerics.D(ge.X)(he),me=Numerics.D(ge.Y)(he),Ge=Numerics.D(ge.X)(Ie),Ze=Numerics.D(ge.Y)(Ie),ye=Numerics.D(ge.X)((he+Ie)*.5),Ee=Numerics.D(ge.Y)((he+Ie)*.5),Ve=Mat.hypot(fe,me),Ye=Mat.hypot(Ge,Ze),be=Mat.hypot(ye,Ee);return(Ve+4*be+Ye)*(Ie-he)/6},ne=function(ge){return $-ie(n,H,ge)},le=Math.PI/18,ae=le*9,ce=null;return this.rolling=function(){var ge,he,Ie,fe,me;F=T+I*C,$=ie(u,T,F),O=Numerics.root(ne,H),ge=new Complex(u.X(F),u.Y(F)),he=new Complex(n.X(O),n.Y(O)),Ie=new Complex(Numerics.D(u.X)(F),Numerics.D(u.Y)(F)),fe=new Complex(Numerics.D(n.X)(O),Numerics.D(n.Y)(O)),me=Complex.C.div(Ie,fe),Z=Math.atan2(me.imaginary,me.real),me.div(Complex.C.abs(me)),me.mult(he),M=ge.real-me.real,V=ge.imaginary-me.imaginary,Z<-le&&Z>-ae?(Z=-le,ee.applyOnce(y)):Z>le&&Z<ae?(Z=le,ee.applyOnce(y)):(U.applyOnce(y),Q.applyOnce(y),T=F,H=O),B.update()},this.start=function(){return f>0&&(ce=window.setInterval(this.rolling,f)),this},this.stop=function(){return window.clearInterval(ce),this},this};return new _}});const Board=JXG$1.Board;JXG$1.SVGRenderer=function(u,n){var d;for(this.type="svg",this.isIE=navigator.appVersion.indexOf("MSIE")!==-1||navigator.userAgent.match(/Trident\//),this.svgRoot=null,this.svgNamespace="http://www.w3.org/2000/svg",this.xlinkNamespace="http://www.w3.org/1999/xlink",this.container=u,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.svgRoot=this.container.ownerDocument.createElementNS(this.svgNamespace,"svg"),this.svgRoot.style.overflow="hidden",this.svgRoot.style.display="block",this.resize(n.width,n.height),this.container.appendChild(this.svgRoot),this.defs=this.container.ownerDocument.createElementNS(this.svgNamespace,"defs"),this.svgRoot.appendChild(this.defs),this.createShadowFilter=function(C,I,f,y,B,_){var Z=this.container.ownerDocument.createElementNS(this.svgNamespace,"filter"),M,V,T,H,F;return Z.setAttributeNS(null,"id",C),Z.setAttributeNS(null,"width","300%"),Z.setAttributeNS(null,"height","300%"),Z.setAttributeNS(null,"filterUnits","userSpaceOnUse"),M=this.container.ownerDocument.createElementNS(this.svgNamespace,"feOffset"),M.setAttributeNS(null,"in","SourceGraphic"),M.setAttributeNS(null,"result","offOut"),M.setAttributeNS(null,"dx",_[0]),M.setAttributeNS(null,"dy",_[1]),Z.appendChild(M),V=this.container.ownerDocument.createElementNS(this.svgNamespace,"feColorMatrix"),V.setAttributeNS(null,"in","offOut"),V.setAttributeNS(null,"result","colorOut"),V.setAttributeNS(null,"type","matrix"),I==="none"||!JXG$1.isArray(I)||I.length<3?V.setAttributeNS(null,"values","0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 "+f+" 0"):(I[0]/=255,I[1]/=255,I[2]/=255,F=y+" 0 0 0 "+I[0]+"  0 "+y+" 0 0 "+I[1]+"  0 0 "+y+" 0 "+I[2]+"  0 0 0 "+f+" 0",V.setAttributeNS(null,"values",F)),Z.appendChild(V),T=this.container.ownerDocument.createElementNS(this.svgNamespace,"feGaussianBlur"),T.setAttributeNS(null,"in","colorOut"),T.setAttributeNS(null,"result","blurOut"),T.setAttributeNS(null,"stdDeviation",B),Z.appendChild(T),H=this.container.ownerDocument.createElementNS(this.svgNamespace,"feBlend"),H.setAttributeNS(null,"in","SourceGraphic"),H.setAttributeNS(null,"in2","blurOut"),H.setAttributeNS(null,"mode","normal"),Z.appendChild(H),Z},this.uniqName=function(){return this.container.id+"_"+Array.prototype.slice.call(arguments).join("_")},this.toStr=function(){var C=Array.prototype.slice.call(arguments).join("");return JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(C=CSS.escape(C)),C},this.toURL=function(){return"url(#"+this.toStr.apply(this,arguments)+")"},this.defs.appendChild(this.createShadowFilter(this.uniqName("f1"),"none",1,.1,3,[5,5])),this.layer=[],d=0;d<Options.layer.numlayers;d++)this.layer[d]=this.container.ownerDocument.createElementNS(this.svgNamespace,"g"),this.svgRoot.appendChild(this.layer[d]);try{this.foreignObjLayer=this.container.ownerDocument.createElementNS(this.svgNamespace,"foreignObject"),this.foreignObjLayer.setAttribute("display","none"),this.foreignObjLayer.setAttribute("x",0),this.foreignObjLayer.setAttribute("y",0),this.foreignObjLayer.setAttribute("width","100%"),this.foreignObjLayer.setAttribute("height","100%"),this.foreignObjLayer.setAttribute("id",this.uniqName("foreignObj")),this.svgRoot.appendChild(this.foreignObjLayer),this.supportsForeignObject=!0}catch{this.supportsForeignObject=!1}};JXG$1.SVGRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.SVGRenderer.prototype,{_createArrowHead:function(u,n,d){var C,I,f=u.id+"Triangle",y,B;return JXG$1.exists(n)&&(f+=n),JXG$1.exists(d)&&(f+=d),C=this.createPrim("marker",f),C.setAttributeNS(null,"stroke",JXG$1.evaluate(u.visProp.strokecolor)),C.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(u.visProp.strokeopacity)),C.setAttributeNS(null,"fill",JXG$1.evaluate(u.visProp.strokecolor)),C.setAttributeNS(null,"fill-opacity",JXG$1.evaluate(u.visProp.strokeopacity)),C.setAttributeNS(null,"stroke-width",0),C.setAttributeNS(null,"orient","auto"),C.setAttributeNS(null,"markerUnits","strokeWidth"),I=this.container.ownerDocument.createElementNS(this.svgNamespace,"path"),B=5,n==="Start"?(y=0,d===2?I.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 L 5,5 z"):d===3?I.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z"):d===4?(B=3.31,I.setAttributeNS(null,"d","M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31")):d===5?(B=3.28,I.setAttributeNS(null,"d","M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28")):d===6?(B=2.84,I.setAttributeNS(null,"d","M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84")):d===7?(B=5.2,I.setAttributeNS(null,"d","M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20")):I.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 z"),u.elementClass===Const.OBJECT_CLASS_LINE&&(d===2?y=4.9:d===3?y=3.3:d===4||d===5||d===6?y=6.66:d===7?y=0:y=10)):(y=10,d===2?I.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 L 5,5 z"):d===3?(y=3.3,I.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z")):d===4?(B=3.31,I.setAttributeNS(null,"d","M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31")):d===5?(B=3.28,I.setAttributeNS(null,"d","M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28")):d===6?(B=2.84,I.setAttributeNS(null,"d","M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84")):d===7?(B=5.2,I.setAttributeNS(null,"d","M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20")):I.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 z"),u.elementClass===Const.OBJECT_CLASS_LINE&&(d===2?y=5.1:d===3?y=.02:d===4||d===5||d===6?y=3.33:d===7?y=10:y=.05)),d===7&&(C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"stroke-width",1)),C.setAttributeNS(null,"refY",B),C.setAttributeNS(null,"refX",y),C.appendChild(I),C},_setArrowColor:function(u,n,d,C,I){u&&(JXG$1.isString(n)&&(I!==7?this._setAttribute(function(){u.setAttributeNS(null,"stroke",n),u.setAttributeNS(null,"fill",n),u.setAttributeNS(null,"stroke-opacity",d),u.setAttributeNS(null,"fill-opacity",d)},C.visPropOld.fillcolor):this._setAttribute(function(){u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"stroke",n),u.setAttributeNS(null,"stroke-opacity",d)},C.visPropOld.fillcolor)),this.isIE&&C.rendNode.parentNode.insertBefore(C.rendNode,C.rendNode))},_setArrowWidth:function(u,n,d,C){var I,f;u&&(I=n,f=I*C,u.setAttributeNS(null,"viewBox","0 0 "+I*10+" "+I*10),u.setAttributeNS(null,"markerHeight",f),u.setAttributeNS(null,"markerWidth",f),u.setAttributeNS(null,"display","inherit"),this.isIE&&d.parentNode.insertBefore(d,d))},updateTicks:function(u){var n,d,C,I,f,y,B="",_=u.ticks.length,Z,M,V=!0;for(n=0;n<_;n++){for(C=u.ticks[n],f=C[0],y=C[1],Z=f.length,M=" M "+f[0]+" "+y[0],JXG$1.isNumber(f[0])||(V=!1),d=1;V&&d<Z;++d)JXG$1.isNumber(f[d])?M+=" L "+f[d]+" "+y[d]:V=!1;V&&(B+=M)}I=u.rendNode,JXG$1.exists(I)||(I=this.createPrim("path",u.id),this.appendChildPrim(I,JXG$1.evaluate(u.visProp.layer)),u.rendNode=I),I.setAttributeNS(null,"stroke",JXG$1.evaluate(u.visProp.strokecolor)),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(u.visProp.strokeopacity)),I.setAttributeNS(null,"stroke-width",JXG$1.evaluate(u.visProp.strokewidth)),this.updatePathPrim(I,B,u.board),this.setObjectViewport(u)},displayCopyright:function(u,n){var d=this.createPrim("text","licenseText"),C;d.setAttributeNS(null,"x","20px"),d.setAttributeNS(null,"y",2+n+"px"),d.setAttributeNS(null,"style","font-family:Arial,Helvetica,sans-serif; font-size:"+n+"px; fill:#356AA0;  opacity:0.3;"),C=this.container.ownerDocument.createTextNode(u),d.appendChild(C),this.appendChildPrim(d,0)},drawInternalText:function(u){var n=this.createPrim("text",u.id);return n.style.whiteSpace="nowrap",u.rendNodeText=this.container.ownerDocument.createTextNode(""),n.appendChild(u.rendNodeText),this.appendChildPrim(n,JXG$1.evaluate(u.visProp.layer)),n},updateInternalText:function(u){var n=u.plaintext,d,C=u.getAnchorX(),I=u.getAnchorY();u.rendNode.getAttributeNS(null,"class")!==u.visProp.cssclass&&(u.rendNode.setAttributeNS(null,"class",JXG$1.evaluate(u.visProp.cssclass)),u.needsSizeUpdate=!0),isNaN(u.coords.scrCoords[1]+u.coords.scrCoords[2])||(d=u.coords.scrCoords[1],u.visPropOld.left!==C+d&&(u.rendNode.setAttributeNS(null,"x",d+"px"),C==="left"?u.rendNode.setAttributeNS(null,"text-anchor","start"):C==="right"?u.rendNode.setAttributeNS(null,"text-anchor","end"):C==="middle"&&u.rendNode.setAttributeNS(null,"text-anchor","middle"),u.visPropOld.left=C+d),d=u.coords.scrCoords[2],u.visPropOld.top!==I+d&&(u.rendNode.setAttributeNS(null,"y",d+this.vOffsetText*.5+"px"),I==="bottom"?(u.rendNode.setAttributeNS(null,"dy","0"),u.rendNode.setAttributeNS(null,"dominant-baseline","auto")):I==="top"?(u.rendNode.setAttributeNS(null,"dy","1.6ex"),u.rendNode.setAttributeNS(null,"dominant-baseline","auto")):I==="middle"&&(u.rendNode.setAttributeNS(null,"dy","0.6ex"),u.rendNode.setAttributeNS(null,"dominant-baseline","auto")),u.visPropOld.top=I+d)),u.htmlStr!==n&&(u.rendNodeText.data=n,u.htmlStr=n),this.transformImage(u,u.transformations)},updateInternalTextStyle:function(u,n,d,C){this.setObjectViewport(u),this.setObjectFillColor(u,n,d)},drawImage:function(u){var n=this.createPrim("image",u.id);n.setAttributeNS(null,"preserveAspectRatio","none"),this.appendChildPrim(n,JXG$1.evaluate(u.visProp.layer)),u.rendNode=n,this.updateImage(u)},transformImage:function(u,n){var d,C,I=u.rendNode,f="",y,B,_=n.length;if(_>0&&(C=this.joinTransforms(u,n),d=[C[1][1],C[2][1],C[1][2],C[2][2],C[1][0],C[2][0]].join(","),d.indexOf("NaN")===-1))if(f+=" matrix("+d+") ",u.elementClass===Const.OBJECT_CLASS_TEXT&&u.visProp.display==="html"){switch(I.style.transform=f,y=-u.coords.scrCoords[1],B=-u.coords.scrCoords[2],JXG$1.evaluate(u.visProp.anchorx)){case"right":y+=u.size[0];break;case"middle":y+=u.size[0]*.5;break}switch(JXG$1.evaluate(u.visProp.anchory)){case"bottom":B+=u.size[1];break;case"middle":B+=u.size[1]*.5;break}I.style["transform-origin"]=y+"px "+B+"px"}else I.setAttributeNS(null,"transform",f)},updateImageURL:function(u){var n=JXG$1.evaluate(u.url);return u._src!==n?(u.imgIsLoaded=!1,u.rendNode.setAttributeNS(this.xlinkNamespace,"xlink:href",n),u._src=n,!0):!1},updateImageStyle:function(u,n){var d=JXG$1.evaluate(n?u.visProp.highlightcssclass:u.visProp.cssclass);u.rendNode.setAttributeNS(null,"class",d)},drawForeignObject:function(u){u.rendNode=this.appendChildPrim(this.createPrim("foreignObject",u.id),JXG$1.evaluate(u.visProp.layer)),this.appendNodesToElement(u,"foreignObject"),this.updateForeignObject(u)},updateForeignObject:function(u){u._useUserSize?u.rendNode.style.overflow="hidden":u.rendNode.style.overflow="visible",this.updateRectPrim(u.rendNode,u.coords.scrCoords[1],u.coords.scrCoords[2]-u.size[1],u.size[0],u.size[1]),u.rendNode.innerHTML=u.content,this._updateVisual(u,{stroke:!0,dash:!0},!0)},appendChildPrim:function(u,n){return JXG$1.exists(n)?n>=Options.layer.numlayers&&(n=Options.layer.numlayers-1):n=0,this.layer[n].appendChild(u),u},createPrim:function(u,n){var d=this.container.ownerDocument.createElementNS(this.svgNamespace,u);return d.setAttributeNS(null,"id",this.uniqName(n)),d.style.position="absolute",u==="path"&&(d.setAttributeNS(null,"stroke-linecap","round"),d.setAttributeNS(null,"stroke-linejoin","round"),d.setAttributeNS(null,"fill-rule","evenodd")),d},remove:function(u){JXG$1.exists(u)&&JXG$1.exists(u.parentNode)&&u.parentNode.removeChild(u)},setLayer:function(u,n){JXG$1.exists(n)?n>=Options.layer.numlayers&&(n=Options.layer.numlayers-1):n=0,this.layer[n].appendChild(u.rendNode)},makeArrows:function(u,n){var d,C,I=n.evFirst,f=n.evLast;if(this.isIE&&u.visPropCalc.visible&&(I||f)){u.rendNode.parentNode.insertBefore(u.rendNode,u.rendNode);return}d=u.rendNodeTriangleStart,I?(C=this.toStr(this.container.id,"_",u.id,"TriangleStart",n.typeFirst),(!JXG$1.exists(d)||d.id!==C)&&(d=this.container.ownerDocument.getElementById(C),d===null&&(d=this._createArrowHead(u,"Start",n.typeFirst),this.defs.appendChild(d)),u.rendNodeTriangleStart=d,u.rendNode.setAttributeNS(null,"marker-start",this.toURL(C)))):(JXG$1.exists(d)&&(this.remove(d),u.rendNodeTriangleStart=null),u.rendNode.setAttributeNS(null,"marker-start",null)),d=u.rendNodeTriangleEnd,f?(C=this.toStr(this.container.id,"_",u.id,"TriangleEnd",n.typeLast),(!JXG$1.exists(d)||d.id!==C)&&(d=this.container.ownerDocument.getElementById(C),d===null&&(d=this._createArrowHead(u,"End",n.typeLast),this.defs.appendChild(d)),u.rendNodeTriangleEnd=d,u.rendNode.setAttributeNS(null,"marker-end",this.toURL(C)))):(JXG$1.exists(d)&&(this.remove(d),u.rendNodeTriangleEnd=null),u.rendNode.setAttributeNS(null,"marker-end",null))},updateEllipsePrim:function(u,n,d,C,I){var f=1e6;f=2e5,n=Math.abs(n)<f?n:f*n/Math.abs(n),d=Math.abs(d)<f?d:f*d/Math.abs(d),C=Math.abs(C)<f?C:f*C/Math.abs(C),I=Math.abs(I)<f?I:f*I/Math.abs(I),u.setAttributeNS(null,"cx",n),u.setAttributeNS(null,"cy",d),u.setAttributeNS(null,"rx",Math.abs(C)),u.setAttributeNS(null,"ry",Math.abs(I))},updateLinePrim:function(u,n,d,C,I){var f=1e6;f=2e5,isNaN(n+d+C+I)||(n=Math.abs(n)<f?n:f*n/Math.abs(n),d=Math.abs(d)<f?d:f*d/Math.abs(d),C=Math.abs(C)<f?C:f*C/Math.abs(C),I=Math.abs(I)<f?I:f*I/Math.abs(I),u.setAttributeNS(null,"x1",n),u.setAttributeNS(null,"y1",d),u.setAttributeNS(null,"x2",C),u.setAttributeNS(null,"y2",I))},updatePathPrim:function(u,n){n===""&&(n="M 0 0"),u.setAttributeNS(null,"d",n)},updatePathStringPoint:function(u,n,d){var C="",I=u.coords.scrCoords,f=n*Math.sqrt(3)*.5,y=n*.5;return d==="x"?C=" M "+(I[1]-n)+" "+(I[2]-n)+" L "+(I[1]+n)+" "+(I[2]+n)+" M "+(I[1]+n)+" "+(I[2]-n)+" L "+(I[1]-n)+" "+(I[2]+n):d==="+"?C=" M "+(I[1]-n)+" "+I[2]+" L "+(I[1]+n)+" "+I[2]+" M "+I[1]+" "+(I[2]-n)+" L "+I[1]+" "+(I[2]+n):d==="|"?C=" M "+I[1]+" "+(I[2]-n)+" L "+I[1]+" "+(I[2]+n):d==="-"?C=" M "+(I[1]-n)+" "+I[2]+" L "+(I[1]+n)+" "+I[2]:d==="<>"||d==="<<>>"?(d==="<<>>"&&(n*=1.41),C=" M "+(I[1]-n)+" "+I[2]+" L "+I[1]+" "+(I[2]+n)+" L "+(I[1]+n)+" "+I[2]+" L "+I[1]+" "+(I[2]-n)+" Z "):d==="^"?C=" M "+I[1]+" "+(I[2]-n)+" L "+(I[1]-f)+" "+(I[2]+y)+" L "+(I[1]+f)+" "+(I[2]+y)+" Z ":d==="v"?C=" M "+I[1]+" "+(I[2]+n)+" L "+(I[1]-f)+" "+(I[2]-y)+" L "+(I[1]+f)+" "+(I[2]-y)+" Z ":d===">"?C=" M "+(I[1]+n)+" "+I[2]+" L "+(I[1]-y)+" "+(I[2]-f)+" L "+(I[1]-y)+" "+(I[2]+f)+" Z ":d==="<"&&(C=" M "+(I[1]-n)+" "+I[2]+" L "+(I[1]+y)+" "+(I[2]-f)+" L "+(I[1]+y)+" "+(I[2]+f)+" Z "),C},updatePathStringPrim:function(u){var n,d,C,I=" M ",f=" L ",y=" C ",B=I,_=5e3,Z="";if(u.numberPoints<=0)return"";if(C=Math.min(u.points.length,u.numberPoints),u.bezierDegree===1)for(n=0;n<C;n++)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?B=I:(d[1]=Math.max(Math.min(d[1],_),-5e3),d[2]=Math.max(Math.min(d[2],_),-5e3),Z+=B+d[1]+" "+d[2],B=f);else if(u.bezierDegree===3)for(n=0;n<C;)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?B=I:(Z+=B+d[1]+" "+d[2],B===y&&(n+=1,d=u.points[n].scrCoords,Z+=" "+d[1]+" "+d[2],n+=1,d=u.points[n].scrCoords,Z+=" "+d[1]+" "+d[2]),B=y),n+=1;return Z},updatePathStringBezierPrim:function(u){var n,d,C,I,f,y,B,_=" M ",Z=" C ",M=_,V=5e3,T="",H=JXG$1.evaluate(u.visProp.strokewidth),F=JXG$1.evaluate(u.visProp.curvetype)!=="plot";if(u.numberPoints<=0)return"";for(F&&u.board.options.curve.RDPsmoothing&&(u.points=Numerics.RamerDouglasPeucker(u.points,.5)),B=Math.min(u.points.length,u.numberPoints),d=1;d<3;d++)for(M=_,n=0;n<B;n++)I=u.points[n].scrCoords,isNaN(I[1])||isNaN(I[2])?M=_:(I[1]=Math.max(Math.min(I[1],V),-5e3),I[2]=Math.max(Math.min(I[2],V),-5e3),M===_?T+=M+I[1]+" "+I[2]:(C=2*d,T+=[M,f+(I[1]-f)*.333+H*(C*Math.random()-d)," ",y+(I[2]-y)*.333+H*(C*Math.random()-d)," ",f+(I[1]-f)*.666+H*(C*Math.random()-d)," ",y+(I[2]-y)*.666+H*(C*Math.random()-d)," ",I[1]," ",I[2]].join("")),M=Z,f=I[1],y=I[2]);return T},updatePolygonPrim:function(u,n){var d,C="",I,f=n.vertices.length;for(u.setAttributeNS(null,"stroke","none"),u.setAttributeNS(null,"fill-rule","evenodd"),n.elType==="polygonalchain"&&f++,d=0;d<f-1;d++){if(n.vertices[d].isReal)I=n.vertices[d].coords.scrCoords,C=C+I[1]+","+I[2];else{u.setAttributeNS(null,"points","");return}d<f-2&&(C+=" ")}C.indexOf("NaN")===-1&&u.setAttributeNS(null,"points",C)},updateRectPrim:function(u,n,d,C,I){u.setAttributeNS(null,"x",n),u.setAttributeNS(null,"y",d),u.setAttributeNS(null,"width",C),u.setAttributeNS(null,"height",I)},setPropertyPrim:function(u,n,d){n!=="stroked"&&u.setAttributeNS(null,n,d)},display:function(u,n){var d;u&&u.rendNode&&(u.visPropOld.visible=n,d=u.rendNode,n?(d.setAttributeNS(null,"display","inline"),d.style.visibility="inherit"):(d.setAttributeNS(null,"display","none"),d.style.visibility="hidden"))},show:function(u){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),this.display(u,!0)},hide:function(u){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),this.display(u,!1)},setBuffering:function(u,n){u.rendNode.setAttribute("buffered-rendering",n)},setDashStyle:function(u){var n=JXG$1.evaluate(u.visProp.dash),d=JXG$1.evaluate(u.visProp.dashscale),C=d?.5*JXG$1.evaluate(u.visProp.strokewidth):1,I=u.rendNode;n>0?I.setAttributeNS(null,"stroke-dasharray",this.dashArray[n-1].map(function(f){return f*C}).join(",")):I.hasAttributeNS(null,"stroke-dasharray")&&I.removeAttributeNS(null,"stroke-dasharray")},setGradient:function(u){var n=u.rendNode,d,C,I,f=JXG$1.evaluate(u.visProp.gradient);f==="linear"||f==="radial"?(d=this.createPrim(f+"Gradient",u.id+"_gradient"),C=this.createPrim("stop",u.id+"_gradient1"),I=this.createPrim("stop",u.id+"_gradient2"),d.appendChild(C),d.appendChild(I),this.defs.appendChild(d),n.setAttributeNS(null,"style","fill:"+this.toURL(this.container.id+"_"+u.id+"_gradient")),u.gradNode1=C,u.gradNode2=I,u.gradNode=d):n.removeAttributeNS(null,"style")},updateGradientAngle:function(u,n){var d=1,C=Math.cos(n),I=Math.sin(n);Math.abs(C)>Math.abs(I)?d/=Math.abs(C):d/=Math.abs(I),C>=0?(u.setAttributeNS(null,"x1",0),u.setAttributeNS(null,"x2",C*d)):(u.setAttributeNS(null,"x1",-C*d),u.setAttributeNS(null,"x2",0)),I>=0?(u.setAttributeNS(null,"y1",0),u.setAttributeNS(null,"y2",I*d)):(u.setAttributeNS(null,"y1",-I*d),u.setAttributeNS(null,"y2",0))},updateGradientCircle:function(u,n,d,C,I,f,y){u.setAttributeNS(null,"cx",n*100+"%"),u.setAttributeNS(null,"cy",d*100+"%"),u.setAttributeNS(null,"r",C*100+"%"),u.setAttributeNS(null,"fx",I*100+"%"),u.setAttributeNS(null,"fy",f*100+"%"),u.setAttributeNS(null,"fr",y*100+"%")},updateGradient:function(u){var n,d,C=u.gradNode1,I=u.gradNode2,f=JXG$1.evaluate(u.visProp.gradient);!JXG$1.exists(C)||!JXG$1.exists(I)||(d=JXG$1.evaluate(u.visProp.fillopacity),d=d>0?d:0,n=JXG$1.evaluate(u.visProp.fillcolor),C.setAttributeNS(null,"style","stop-color:"+n+";stop-opacity:"+d),I.setAttributeNS(null,"style","stop-color:"+JXG$1.evaluate(u.visProp.gradientsecondcolor)+";stop-opacity:"+JXG$1.evaluate(u.visProp.gradientsecondopacity)),C.setAttributeNS(null,"offset",JXG$1.evaluate(u.visProp.gradientstartoffset)*100+"%"),I.setAttributeNS(null,"offset",JXG$1.evaluate(u.visProp.gradientendoffset)*100+"%"),f==="linear"?this.updateGradientAngle(u.gradNode,JXG$1.evaluate(u.visProp.gradientangle)):f==="radial"&&this.updateGradientCircle(u.gradNode,JXG$1.evaluate(u.visProp.gradientcx),JXG$1.evaluate(u.visProp.gradientcy),JXG$1.evaluate(u.visProp.gradientr),JXG$1.evaluate(u.visProp.gradientfx),JXG$1.evaluate(u.visProp.gradientfy),JXG$1.evaluate(u.visProp.gradientfr)))},setObjectTransition:function(u,n){var d,C,I=[],f,y,B=0,_=["rendNode","rendNodeTriangleStart","rendNodeTriangleEnd"];if(n===void 0&&(n=JXG$1.evaluate(u.visProp.transitionduration)),C=JXG$1.evaluate(u.visProp.transitionproperties),!(n===u.visPropOld.transitionduration&&C===u.visPropOld.transitionproperties)){for(JXG$1.exists(C)&&(B=C.length),y=0;y<B;y++)I.push(C[y]+" "+n+"ms");for(f=I.join(", "),B=_.length,y=0;y<B;++y)u[_[y]]&&(d=u[_[y]],d.style.transition=f);u.visPropOld.transitionduration=n,u.visPropOld.transitionproperties=C}},setObjectViewport:function(u,n){},_setAttribute:function(u,n){n===""?u():window.setTimeout(u,1)},setObjectFillColor:function(u,n,d,C){var I,f,y,B,_=JXG$1.evaluate(n),Z=JXG$1.evaluate(d),M=JXG$1.evaluate(u.visProp.gradient);Z=Z>0?Z:0,!(u.visPropOld.fillcolor===_&&u.visPropOld.fillopacity===Z&&M===null)&&(JXG$1.exists(_)&&_!==!1&&(_.length!==9?(f=_,B=Z):(y=JXG$1.rgba2rgbo(_),f=y[0],B=Z*y[1]),C===void 0?I=u.rendNode:I=C,f!=="none"&&this._setAttribute(function(){I.setAttributeNS(null,"fill",f)},u.visPropOld.fillcolor),u.type===JXG$1.OBJECT_TYPE_IMAGE?this._setAttribute(function(){I.setAttributeNS(null,"opacity",B)},u.visPropOld.fillopacity):(f==="none"?(B=0,I.setAttributeNS(null,"pointer-events","visibleStroke")):I.setAttributeNS(null,"pointer-events","visiblePainted"),this._setAttribute(function(){I.setAttributeNS(null,"fill-opacity",B)},u.visPropOld.fillopacity)),(M==="linear"||M==="radial")&&this.updateGradient(u)),u.visPropOld.fillcolor=_,u.visPropOld.fillopacity=Z)},setObjectStrokeColor:function(u,n,d){var C=JXG$1.evaluate(n),I,f,y=JXG$1.evaluate(d),B,_;y=y>0?y:0,!(u.visPropOld.strokecolor===C&&u.visPropOld.strokeopacity===y)&&(JXG$1.exists(C)&&C!==!1&&(C.length!==9?(I=C,B=y):(f=JXG$1.rgba2rgbo(C),I=f[0],B=y*f[1]),_=u.rendNode,u.elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(u.visProp.display)==="html"?this._setAttribute(function(){_.style.color=I,_.style.opacity=B},u.visPropOld.strokecolor):this._setAttribute(function(){_.setAttributeNS(null,"style","fill:"+I),_.setAttributeNS(null,"style","fill-opacity:"+B)},u.visPropOld.strokecolor):this._setAttribute(function(){_.setAttributeNS(null,"stroke",I),_.setAttributeNS(null,"stroke-opacity",B)},u.visPropOld.strokecolor),(u.elementClass===Const.OBJECT_CLASS_CURVE||u.elementClass===Const.OBJECT_CLASS_LINE)&&(JXG$1.evaluate(u.visProp.firstarrow)&&this._setArrowColor(u.rendNodeTriangleStart,I,B,u,u.visPropCalc.typeFirst),JXG$1.evaluate(u.visProp.lastarrow)&&this._setArrowColor(u.rendNodeTriangleEnd,I,B,u,u.visPropCalc.typeLast))),u.visPropOld.strokecolor=C,u.visPropOld.strokeopacity=y)},setObjectStrokeWidth:function(u,n){var d,C=JXG$1.evaluate(n);isNaN(C)||u.visPropOld.strokewidth===C||(d=u.rendNode,this.setPropertyPrim(d,"stroked","true"),JXG$1.exists(C)&&this.setPropertyPrim(d,"stroke-width",C+"px"),u.visPropOld.strokewidth=C)},setLineCap:function(u){var n=JXG$1.evaluate(u.visProp.linecap);n===void 0||n===""||u.visPropOld.linecap===n||!JXG$1.exists(u.rendNode)||(this.setPropertyPrim(u.rendNode,"stroke-linecap",n),u.visPropOld.linecap=n)},setShadow:function(u){var n=JXG$1.evaluate(u.visProp.shadow),d,C,I,f,y,B,_,Z,M=!0,V=!1;d=JSON.stringify(n),d!==u.visPropOld.shadow&&(typeof n=="boolean"?(M=!0,V=n,C="none",I=3,f=.1,y=[5,5],B=1):JXG$1.evaluate(n.enabled)?(M=!1,V=!0,C=JXG$1.rgbParser(JXG$1.evaluate(n.color)),I=JXG$1.evaluate(n.blur),f=JXG$1.evaluate(n.blend),y=JXG$1.evaluate(n.offset),B=JXG$1.evaluate(n.opacity)):V=!1,JXG$1.exists(u.rendNode)&&(V?M?u.rendNode.setAttributeNS(null,"filter",this.toURL(this.container.id+"_f1")):(Z=this.container.ownerDocument.getElementById(_),Z&&this.defs.removeChild(Z),_=u.rendNode.id+"_f1",this.defs.appendChild(this.createShadowFilter(_,C,B,f,I,y)),u.rendNode.setAttributeNS(null,"filter",this.toURL(_))):u.rendNode.removeAttributeNS(null,"filter")),u.visPropOld.shadow=d)},suspendRedraw:function(){this.suspendHandle=this.svgRoot.suspendRedraw(1e4)},unsuspendRedraw:function(){this.svgRoot.unsuspendRedraw(this.suspendHandle)},resize:function(u,n){this.svgRoot.setAttribute("width",parseFloat(u)),this.svgRoot.setAttribute("height",parseFloat(n))},createTouchpoints:function(u){var n,d,C,I;for(this.touchpoints=[],n=0;n<u;n++)d="touchpoint1_"+n,I=this.createPrim("path",d),this.appendChildPrim(I,19),I.setAttributeNS(null,"d","M 0 0"),this.touchpoints.push(I),this.setPropertyPrim(I,"stroked","true"),this.setPropertyPrim(I,"stroke-width","1px"),I.setAttributeNS(null,"stroke","#000000"),I.setAttributeNS(null,"stroke-opacity",1),I.setAttributeNS(null,"display","none"),C="touchpoint2_"+n,I=this.createPrim("ellipse",C),this.appendChildPrim(I,19),this.updateEllipsePrim(I,0,0,0,0),this.touchpoints.push(I),this.setPropertyPrim(I,"stroked","true"),this.setPropertyPrim(I,"stroke-width","1px"),I.setAttributeNS(null,"stroke","#000000"),I.setAttributeNS(null,"stroke-opacity",1),I.setAttributeNS(null,"fill","#ffffff"),I.setAttributeNS(null,"fill-opacity",0),I.setAttributeNS(null,"display","none")},showTouchpoint:function(u){this.touchpoints&&u>=0&&2*u<this.touchpoints.length&&(this.touchpoints[2*u].setAttributeNS(null,"display","inline"),this.touchpoints[2*u+1].setAttributeNS(null,"display","inline"))},hideTouchpoint:function(u){this.touchpoints&&u>=0&&2*u<this.touchpoints.length&&(this.touchpoints[2*u].setAttributeNS(null,"display","none"),this.touchpoints[2*u+1].setAttributeNS(null,"display","none"))},updateTouchpoint:function(u,n){var d,C,I=37;this.touchpoints&&u>=0&&2*u<this.touchpoints.length&&(d=n[0],C=n[1],this.touchpoints[2*u].setAttributeNS(null,"d","M "+(d-I)+" "+C+" L "+(d+I)+" "+C+" M "+d+" "+(C-I)+" L "+d+" "+(C+I)),this.updateEllipsePrim(this.touchpoints[2*u+1],n[0],n[1],25,25))},_getValuesOfDOMElements:function(u){var n=[];if(u.nodeType===1)for(u=u.firstChild;u;)u.id!==void 0&&u.value!==void 0&&n.push([u.id,u.value]),JXG$1.concat(n,this._getValuesOfDOMElements(u)),u=u.nextSibling;return n},_getImgDataURL:function(u){var n,d,C,I,f,y;if(n=u.getElementsByTagName("image"),d=n.length,d>0)for(C=document.createElement("canvas"),y=0;y<d;y++){n[y].setAttribute("crossorigin","anonymous"),I=C.getContext("2d"),C.width=n[y].getAttribute("width"),C.height=n[y].getAttribute("height");try{I.drawImage(n[y],0,0,C.width,C.height),f=C.toDataURL(),n[y].setAttribute("xlink:href",f)}catch(B){console.log("CORS problem! Image can not be used",B)}}return!0},dumpToDataURI:function(u){var n=this.svgRoot,d=window.btoa||Base64.encode,C,I,f,y=[];if(this.container.hasChildNodes()&&JXG$1.exists(this.foreignObjLayer))for(u||this.foreignObjLayer.setAttribute("display","inline");n.nextSibling;)JXG$1.concat(y,this._getValuesOfDOMElements(n.nextSibling)),this.foreignObjLayer.appendChild(n.nextSibling);if(this._getImgDataURL(n),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),C=new XMLSerializer().serializeToString(n),u!==!0)for(f=y.length,I=0;I<f;I++)C=C.replace('id="'+y[I][0]+'"','id="'+y[I][0]+'" value="'+y[I][1]+'"');if(this.isIE&&(C.match(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g)||[]).length>1&&(C=C.replace(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g,"")),C=C.replace(/&nbsp;/g," "),C=C.replace(/url\(&quot;(.*)&quot;\)/g,"url($1)"),JXG$1.exists(this.foreignObjLayer)&&this.foreignObjLayer.hasChildNodes()){for(;this.foreignObjLayer.firstChild;)this.container.appendChild(this.foreignObjLayer.firstChild);this.foreignObjLayer.setAttribute("display","none")}return"data:image/svg+xml;base64,"+d(unescape(encodeURIComponent(C)))},dumpToCanvas:function(u,n,d,C){var I,f,y,B,_=this.container.ownerDocument;return y=_.getElementById(u),y.width=y.width,B=y.getContext("2d"),n!==void 0&&d!==void 0&&(y.style.width=parseFloat(n)+"px",y.style.height=parseFloat(d)+"px",y.setAttribute("width",parseFloat(n)),y.setAttribute("height",parseFloat(d))),f=new Image,I=this.dumpToDataURI(C),f.src=I,"Promise"in window?new Promise(function(Z,M){try{f.onload=function(){B.drawImage(f,0,0,n,d),Z()}}catch(V){M(V)}}):(f.onload=function(){window.setTimeout(function(){try{B.drawImage(f,0,0,n,d)}catch{console.log("screenshots not longer supported on IE")}},200)},this)},screenshot:function(u,n,d){var C,I=this.container.ownerDocument,f=this.container.parentNode,y,B,_,Z,M,V,T,H=u.attr.screenshot,F,O,$,U=!1,ee;return this.type==="no"?this:(V=H.scale*this.container.getBoundingClientRect().width,T=H.scale*this.container.getBoundingClientRect().height,n===void 0||n===""?(U=!0,_=new Image,_.style.width=V+"px",_.style.height=T+"px"):(U=!1,_=I.getElementById(n)),U&&(C=I.createElement("div"),C.style.cssText=H.css,C.style.width=V+"px",C.style.height=T+"px",C.style.zIndex=this.container.style.zIndex+120,C.style.position="absolute",C.style.top=this.container.offsetTop+"px",C.style.left=this.container.offsetLeft+"px"),y=I.createElement("canvas"),B=Math.random().toString(36).slice(2,7),y.setAttribute("id",B),y.setAttribute("width",V),y.setAttribute("height",T),y.style.width=V+"px",y.style.height=V+"px",y.style.display="none",f.appendChild(y),U&&(Z=I.createElement("span"),M=I.createTextNode("✖"),Z.style.cssText=H.cssButton,Z.appendChild(M),Z.onclick=function(){C.parentNode.removeChild(C)},C.appendChild(_),C.appendChild(Z),f.insertBefore(C,this.container.nextSibling)),F=I.getElementById(this.uniqName("navigationbar")),JXG$1.exists(F)&&(O=F.style.display,F.style.display="none",$=this.removeToInsertLater(F)),ee=function(){_.src=y.toDataURL("image/png"),f.removeChild(y)},"Promise"in window?this.dumpToCanvas(B,V,T,d).then(ee):(this.dumpToCanvas(B,V,T,d),window.setTimeout(ee,200)),JXG$1.exists(F)&&(F.style.display=O,$()),this)}});const SVGRenderer=JXG$1.SVGRenderer;JXG$1.VMLRenderer=function(u){this.type="vml",this.container=u,this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.onselectstart=function(){return!1},this.resolution=10,JXG$1.exists(JXG$1.vmlStylesheet)||(u.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),JXG$1.vmlStylesheet=this.container.ownerDocument.createStyleSheet(),JXG$1.vmlStylesheet.addRule(".jxgvml","behavior:url(#default#VML)"));try{u.ownerDocument.namespaces.jxgvml||u.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),this.createNode=function(n){return u.ownerDocument.createElement("<jxgvml:"+n+' class="jxgvml">')}}catch{this.createNode=function(d){return u.ownerDocument.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="jxgvml">')}}this.dashArray=["Solid","1 1","ShortDash","Dash","LongDash","ShortDashDot","LongDashDot"]};JXG$1.VMLRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.VMLRenderer.prototype,{_setAttr:function(u,n,d,C){try{this.container.ownerDocument.documentMode===8?u[n]=d:u.setAttribute(n,d,C)}catch{JXG$1.debug("_setAttr: "+n+" "+d+`<br>
`)}},updateTicks:function(u){var n,d,C,I,f,y=this.resolution,B=[];for(d=u.ticks.length,n=0;n<d;n++)C=u.ticks[n],I=C[0],f=C[1],JXG$1.isNumber(I[0])&&JXG$1.isNumber(I[1])&&B.push(" m "+Math.round(y*I[0])+", "+Math.round(y*f[0])+" l "+Math.round(y*I[1])+", "+Math.round(y*f[1])+" ");JXG$1.exists(u.rendNode)||(u.rendNode=this.createPrim("path",u.id),this.appendChildPrim(u.rendNode,JXG$1.evaluate(u.visProp.layer))),this._setAttr(u.rendNode,"stroked","true"),this._setAttr(u.rendNode,"strokecolor",JXG$1.evaluate(u.visProp.strokecolor),1),this._setAttr(u.rendNode,"strokeweight",JXG$1.evaluate(u.visProp.strokewidth)),this._setAttr(u.rendNodeStroke,"opacity",JXG$1.evaluate(u.visProp.strokeopacity)*100+"%"),this.updatePathPrim(u.rendNode,B,u.board)},displayCopyright:function(u,n){var d,C;d=this.createNode("textbox"),d.style.position="absolute",this._setAttr(d,"id",this.container.id+"_licenseText"),d.style.left=20,d.style.top=2,d.style.fontSize=n,d.style.color="#356AA0",d.style.fontFamily="Arial,Helvetica,sans-serif",this._setAttr(d,"opacity","30%"),d.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 30, enabled = true)",C=this.container.ownerDocument.createTextNode(u),d.appendChild(C),this.appendChildPrim(d,0)},drawInternalText:function(u){var n;return n=this.createNode("textbox"),n.style.position="absolute",u.rendNodeText=this.container.ownerDocument.createTextNode(""),n.appendChild(u.rendNodeText),this.appendChildPrim(n,9),n.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",n},updateInternalText:function(u){var n,d=u.plaintext,C=this.joinTransforms(u,u.transformations),I=[0,0],f,y,B,_,Z,M=u.rendNode,V=[],T=u.getAnchorX(),H=u.getAnchorY();if(!isNaN(u.coords.scrCoords[1]+u.coords.scrCoords[2])){for(T==="right"?I[0]=1:T==="middle"&&(I[0]=.5),H==="bottom"?I[1]=1:H==="middle"&&(I[1]=.5),V[0]=Mat.matVecMult(C,[1,u.coords.scrCoords[1]-I[0]*u.size[0],u.coords.scrCoords[2]+(1-I[1])*u.size[1]+this.vOffsetText]),V[0][1]/=V[0][0],V[0][2]/=V[0][0],V[1]=Mat.matVecMult(C,[1,u.coords.scrCoords[1]+(1-I[0])*u.size[0],u.coords.scrCoords[2]+(1-I[1])*u.size[1]+this.vOffsetText]),V[1][1]/=V[1][0],V[1][2]/=V[1][0],V[2]=Mat.matVecMult(C,[1,u.coords.scrCoords[1]+(1-I[0])*u.size[0],u.coords.scrCoords[2]-I[1]*u.size[1]+this.vOffsetText]),V[2][1]/=V[2][0],V[2][2]/=V[2][0],V[3]=Mat.matVecMult(C,[1,u.coords.scrCoords[1]-I[0]*u.size[0],u.coords.scrCoords[2]-I[1]*u.size[1]+this.vOffsetText]),V[3][1]/=V[3][0],V[3][2]/=V[3][0],f=V[0][1],B=V[0][1],y=V[0][2],_=V[0][2],Z=1;Z<4;Z++)f=Math.max(f,V[Z][1]),B=Math.min(B,V[Z][1]),y=Math.max(y,V[Z][2]),_=Math.min(_,V[Z][2]);n=I[0]===1?Math.floor(u.board.canvasWidth-f):Math.floor(B),u.visPropOld.left!==T+n&&(I[0]===1?(u.rendNode.style.right=n+"px",u.rendNode.style.left="auto"):(u.rendNode.style.left=n+"px",u.rendNode.style.right="auto"),u.visPropOld.left=T+n),n=I[1]===1?Math.floor(u.board.canvasHeight-y):Math.floor(_),u.visPropOld.top!==H+n&&(I[1]===1?(u.rendNode.style.bottom=n+"px",u.rendNode.style.top="auto"):(u.rendNode.style.top=n+"px",u.rendNode.style.bottom="auto"),u.visPropOld.top=H+n)}u.htmlStr!==d&&(u.rendNodeText.data=d,u.htmlStr=d),M.filters.item(0).M11=C[1][1],M.filters.item(0).M12=C[1][2],M.filters.item(0).M21=C[2][1],M.filters.item(0).M22=C[2][2],M.filters.item(0).enabled=!0},drawImage:function(u){var n;n=this.container.ownerDocument.createElement("img"),n.style.position="absolute",this._setAttr(n,"id",this.container.id+"_"+u.id),this.container.appendChild(n),this.appendChildPrim(n,JXG$1.evaluate(u.visProp.layer)),n.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand') progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",u.rendNode=n,this.updateImage(u)},transformImage:function(u,n){var d,C,I,f,y,B,_=u.rendNode,Z=[],M=n.length;if(M>0){for(d=this.joinTransforms(u,n),Z[0]=Mat.matVecMult(d,u.coords.scrCoords),Z[0][1]/=Z[0][0],Z[0][2]/=Z[0][0],Z[1]=Mat.matVecMult(d,[1,u.coords.scrCoords[1]+u.size[0],u.coords.scrCoords[2]]),Z[1][1]/=Z[1][0],Z[1][2]/=Z[1][0],Z[2]=Mat.matVecMult(d,[1,u.coords.scrCoords[1]+u.size[0],u.coords.scrCoords[2]-u.size[1]]),Z[2][1]/=Z[2][0],Z[2][2]/=Z[2][0],Z[3]=Mat.matVecMult(d,[1,u.coords.scrCoords[1],u.coords.scrCoords[2]-u.size[1]]),Z[3][1]/=Z[3][0],Z[3][2]/=Z[3][0],C=Z[0][1],f=Z[0][1],I=Z[0][2],y=Z[0][2],B=1;B<4;B++)C=Math.max(C,Z[B][1]),f=Math.min(f,Z[B][1]),I=Math.max(I,Z[B][2]),y=Math.min(y,Z[B][2]);_.style.left=Math.floor(f)+"px",_.style.top=Math.floor(y)+"px",_.filters.item(0).M11=d[1][1],_.filters.item(0).M12=d[1][2],_.filters.item(0).M21=d[2][1],_.filters.item(0).M22=d[2][2],_.filters.item(0).enabled=!0}},updateImageURL:function(u){var n=JXG$1.evaluate(u.url);this._setAttr(u.rendNode,"src",n)},appendChildPrim:function(u,n){return JXG$1.exists(n)||(n=0),u.style.zIndex=n,this.container.appendChild(u),u},appendNodesToElement:function(u,n){(n==="shape"||n==="path"||n==="polygon")&&(u.rendNodePath=this.getElementById(u.id+"_path")),u.rendNodeFill=this.getElementById(u.id+"_fill"),u.rendNodeStroke=this.getElementById(u.id+"_stroke"),u.rendNodeShadow=this.getElementById(u.id+"_shadow"),u.rendNode=this.getElementById(u.id)},createPrim:function(u,n){var d,C,I=this.createNode("fill"),f=this.createNode("stroke"),y=this.createNode("shadow");return this._setAttr(I,"id",this.container.id+"_"+n+"_fill"),this._setAttr(f,"id",this.container.id+"_"+n+"_stroke"),this._setAttr(y,"id",this.container.id+"_"+n+"_shadow"),u==="circle"||u==="ellipse"?(d=this.createNode("oval"),d.appendChild(I),d.appendChild(f),d.appendChild(y)):u==="polygon"||u==="path"||u==="shape"||u==="line"?(d=this.createNode("shape"),d.appendChild(I),d.appendChild(f),d.appendChild(y),C=this.createNode("path"),this._setAttr(C,"id",this.container.id+"_"+n+"_path"),d.appendChild(C)):(d=this.createNode(u),d.appendChild(I),d.appendChild(f),d.appendChild(y)),d.style.position="absolute",d.style.left="0px",d.style.top="0px",this._setAttr(d,"id",this.container.id+"_"+n),d},remove:function(u){JXG$1.exists(u)&&u.removeNode(!0)},makeArrows:function(u){var n,d=JXG$1.evaluate(u.visProp.firstarrow),C=JXG$1.evaluate(u.visProp.lastarrow);u.visPropOld.firstarrow===d&&u.visPropOld.lastarrow===C||(d?(n=u.rendNodeStroke,this._setAttr(n,"startarrow","block"),this._setAttr(n,"startarrowlength","long")):(n=u.rendNodeStroke,JXG$1.exists(n)&&this._setAttr(n,"startarrow","none")),C?(n=u.rendNodeStroke,this._setAttr(n,"id",this.container.id+"_"+u.id+"stroke"),this._setAttr(n,"endarrow","block"),this._setAttr(n,"endarrowlength","long")):(n=u.rendNodeStroke,JXG$1.exists(n)&&this._setAttr(n,"endarrow","none")),u.visPropOld.firstarrow=d,u.visPropOld.lastarrow=C)},updateEllipsePrim:function(u,n,d,C,I){u.style.left=Math.floor(n-C)+"px",u.style.top=Math.floor(d-I)+"px",u.style.width=Math.floor(Math.abs(C)*2)+"px",u.style.height=Math.floor(Math.abs(I)*2)+"px"},updateLinePrim:function(u,n,d,C,I,f){var y,B=this.resolution;isNaN(n+d+C+I)||(y=["m ",Math.floor(B*n),", ",Math.floor(B*d)," l ",Math.floor(B*C),", ",Math.floor(B*I)],this.updatePathPrim(u,y,f))},updatePathPrim:function(u,n,d){var C=d.canvasWidth,I=d.canvasHeight;n.length<=0&&(n=["m 0,0"]),u.style.width=C,u.style.height=I,this._setAttr(u,"coordsize",[Math.floor(this.resolution*C),Math.floor(this.resolution*I)].join(",")),this._setAttr(u,"path",n.join(""))},updatePathStringPoint:function(u,n,d){var C=[],I=Math.round,f=u.coords.scrCoords,y=n*Math.sqrt(3)*.5,B=n*.5,_=this.resolution;return d==="x"?C.push([" m ",I(_*(f[1]-n)),", ",I(_*(f[2]-n))," l ",I(_*(f[1]+n)),", ",I(_*(f[2]+n))," m ",I(_*(f[1]+n)),", ",I(_*(f[2]-n))," l ",I(_*(f[1]-n)),", ",I(_*(f[2]+n))].join("")):d==="+"?C.push([" m ",I(_*(f[1]-n)),", ",I(_*f[2])," l ",I(_*(f[1]+n)),", ",I(_*f[2])," m ",I(_*f[1]),", ",I(_*(f[2]-n))," l ",I(_*f[1]),", ",I(_*(f[2]+n))].join("")):d==="<>"||d==="<<>>"?(d==="<<>>"&&(n*=1.41),C.push([" m ",I(_*(f[1]-n)),", ",I(_*f[2])," l ",I(_*f[1]),", ",I(_*(f[2]+n))," l ",I(_*(f[1]+n)),", ",I(_*f[2])," l ",I(_*f[1]),", ",I(_*(f[2]-n))," x e "].join(""))):d==="^"?C.push([" m ",I(_*f[1]),", ",I(_*(f[2]-n))," l ",I(_*(f[1]-y)),", ",I(_*(f[2]+B))," l ",I(_*(f[1]+y)),", ",I(_*(f[2]+B))," x e "].join("")):d==="v"?C.push([" m ",I(_*f[1]),", ",I(_*(f[2]+n))," l ",I(_*(f[1]-y)),", ",I(_*(f[2]-B))," l ",I(_*(f[1]+y)),", ",I(_*(f[2]-B))," x e "].join("")):d===">"?C.push([" m ",I(_*(f[1]+n)),", ",I(_*f[2])," l ",I(_*(f[1]-B)),", ",I(_*(f[2]-y))," l ",I(_*(f[1]-B)),", ",I(_*(f[2]+y))," l ",I(_*(f[1]+n)),", ",I(_*f[2])].join("")):d==="<"&&C.push([" m ",I(_*(f[1]-n)),", ",I(_*f[2])," l ",I(_*(f[1]+B)),", ",I(_*(f[2]-y))," l ",I(_*(f[1]+B)),", ",I(_*(f[2]+y))," x e "].join("")),C},updatePathStringPrim:function(u){var n,d,C=[],I=this.resolution,f=Math.round,y=" m ",B=" l ",_=" c ",Z=y,M=Math.min(u.numberPoints,8192);if(u.numberPoints<=0)return"";if(M=Math.min(M,u.points.length),u.bezierDegree===1)for(n=0;n<M;n++)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?Z=y:(d[1]>2e4?d[1]=2e4:d[1]<-2e4&&(d[1]=-2e4),d[2]>2e4?d[2]=2e4:d[2]<-2e4&&(d[2]=-2e4),C.push([Z,f(I*d[1]),", ",f(I*d[2])].join("")),Z=B);else if(u.bezierDegree===3)for(n=0;n<M;)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?Z=y:(C.push([Z,f(I*d[1]),", ",f(I*d[2])].join("")),Z===_&&(n+=1,d=u.points[n].scrCoords,C.push([" ",f(I*d[1]),", ",f(I*d[2])].join("")),n+=1,d=u.points[n].scrCoords,C.push([" ",f(I*d[1]),", ",f(I*d[2])].join(""))),Z=_),n+=1;return C.push(" e"),C},updatePathStringBezierPrim:function(u){var n,d,C,I,f,y,B=[],_=JXG$1.evaluate(u.visProp.strokewidth),Z=this.resolution,M=Math.round,V=" m ",T=" c ",H=V,F=JXG$1.evaluate(u.visProp.curvetype)!=="plot",O=Math.min(u.numberPoints,8192);if(u.numberPoints<=0)return"";for(F&&u.board.options.curve.RDPsmoothing&&(u.points=Numerics.RamerDouglasPeucker(u.points,1)),O=Math.min(O,u.points.length),d=1;d<3;d++)for(H=V,n=0;n<O;n++)I=u.points[n].scrCoords,isNaN(I[1])||isNaN(I[2])?H=V:(I[1]>2e4?I[1]=2e4:I[1]<-2e4&&(I[1]=-2e4),I[2]>2e4?I[2]=2e4:I[2]<-2e4&&(I[2]=-2e4),H===V?B.push([H,M(Z*I[1])," ",M(Z*I[2])].join("")):(C=2*d,B.push([H,M(Z*(f+(I[1]-f)*.333+_*(C*Math.random()-d)))," ",M(Z*(y+(I[2]-y)*.333+_*(C*Math.random()-d)))," ",M(Z*(f+(I[1]-f)*.666+_*(C*Math.random()-d)))," ",M(Z*(y+(I[2]-y)*.666+_*(C*Math.random()-d)))," ",M(Z*I[1])," ",M(Z*I[2])].join(""))),H=T,f=I[1],y=I[2]);return B.push(" e"),B},updatePolygonPrim:function(u,n){var d,C=n.vertices.length,I=this.resolution,f,y=[];if(this._setAttr(u,"stroked","false"),f=n.vertices[0].coords.scrCoords,!isNaN(f[1]+f[2])){for(y.push(["m ",Math.floor(I*f[1]),",",Math.floor(I*f[2])," l "].join("")),d=1;d<C-1;d++){if(n.vertices[d].isReal){if(f=n.vertices[d].coords.scrCoords,isNaN(f[1]+f[2]))return;y.push(Math.floor(I*f[1])+","+Math.floor(I*f[2]))}else{this.updatePathPrim(u,"",n.board);return}d<C-2&&y.push(", ")}y.push(" x e"),this.updatePathPrim(u,y,n.board)}},updateRectPrim:function(u,n,d,C,I){u.style.left=Math.floor(n)+"px",u.style.top=Math.floor(d)+"px",C>=0&&(u.style.width=C+"px"),I>=0&&(u.style.height=I+"px")},setPropertyPrim:function(u,n,d){var C="",I;switch(n){case"stroke":C="strokecolor";break;case"stroke-width":C="strokeweight";break;case"stroke-dasharray":C="dashstyle";break}C!==""&&(I=JXG$1.evaluate(d),this._setAttr(u,C,I))},display:function(u,n){u&&u.rendNode&&(u.visPropOld.visible=n,n?u.rendNode.style.visibility="inherit":u.rendNode.style.visibility="hidden")},show:function(u){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),u&&u.rendNode&&(u.rendNode.style.visibility="inherit")},hide:function(u){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),u&&u.rendNode&&(u.rendNode.style.visibility="hidden")},setDashStyle:function(u,n){var d;n.dash>=0&&(d=u.rendNodeStroke,this._setAttr(d,"dashstyle",this.dashArray[n.dash]))},setGradient:function(u){var n=u.rendNodeFill,d=JXG$1.evaluate(u.visProp.gradient);d==="linear"?(this._setAttr(n,"type","gradient"),this._setAttr(n,"color2",JXG$1.evaluate(u.visProp.gradientsecondcolor)),this._setAttr(n,"opacity2",JXG$1.evaluate(u.visProp.gradientsecondopacity)),this._setAttr(n,"angle",JXG$1.evaluate(u.visProp.gradientangle))):d==="radial"?(this._setAttr(n,"type","gradientradial"),this._setAttr(n,"color2",JXG$1.evaluate(u.visProp.gradientsecondcolor)),this._setAttr(n,"opacity2",JXG$1.evaluate(u.visProp.gradientsecondopacity)),this._setAttr(n,"focusposition",JXG$1.evaluate(u.visProp.gradientpositionx)*100+"%,"+JXG$1.evaluate(u.visProp.gradientpositiony)*100+"%"),this._setAttr(n,"focussize","0,0")):this._setAttr(n,"type","solid")},setObjectFillColor:function(u,n,d){var C=JXG$1.evaluate(n),I,f,y=JXG$1.evaluate(d),B,_=u.rendNode;y=y>0?y:0,!(u.visPropOld.fillcolor===C&&u.visPropOld.fillopacity===y)&&(JXG$1.exists(C)&&C!==!1&&(C.length!==9?(I=C,B=y):(f=JXG$1.rgba2rgbo(C),I=f[0],B=y*f[1]),I==="none"||I===!1?this._setAttr(u.rendNode,"filled","false"):(this._setAttr(u.rendNode,"filled","true"),this._setAttr(u.rendNode,"fillcolor",I),JXG$1.exists(B)&&u.rendNodeFill&&this._setAttr(u.rendNodeFill,"opacity",B*100+"%")),u.type===Const.OBJECT_TYPE_IMAGE&&_.filters.length>1&&(_.filters.item(1).opacity=Math.round(B*100),_.filters.item(1).enabled=!0)),u.visPropOld.fillcolor=C,u.visPropOld.fillopacity=y)},setObjectStrokeColor:function(u,n,d){var C=JXG$1.evaluate(n),I,f,y=JXG$1.evaluate(d),B,_=u.rendNode,Z;y=y>0?y:0,!(u.visPropOld.strokecolor===C&&u.visPropOld.strokeopacity===y)&&(JXG$1.exists(C)&&C!==!1&&(C.length!==9?(I=C,B=y):(f=n.rgba2rgbo(C),I=f[0],B=y*f[1]),u.elementClass===Const.OBJECT_CLASS_TEXT?(_.filters.length>1&&(_.filters.item(1).opacity=Math.round(B*100),_.filters.item(1).enabled=!0),_.style.color=I):(I!==!1&&(this._setAttr(_,"stroked","true"),this._setAttr(_,"strokecolor",I)),Z=u.rendNodeStroke,JXG$1.exists(B)&&u.type!==Const.OBJECT_TYPE_IMAGE&&this._setAttr(Z,"opacity",B*100+"%"))),u.visPropOld.strokecolor=C,u.visPropOld.strokeopacity=y)},setObjectStrokeWidth:function(u,n){var d=JXG$1.evaluate(n),C;isNaN(d)||u.visPropOld.strokewidth===d||(C=u.rendNode,this.setPropertyPrim(C,"stroked","true"),JXG$1.exists(d)&&(this.setPropertyPrim(C,"stroke-width",d),d===0&&JXG$1.exists(u.rendNodeStroke)&&this._setAttr(C,"stroked","false")),u.visPropOld.strokewidth=d)},setShadow:function(u){var n=u.rendNodeShadow,d=JXG$1.evaluate(u.visProp.shadow);!n||u.visPropOld.shadow===d||(d?(this._setAttr(n,"On","True"),this._setAttr(n,"Offset","3pt,3pt"),this._setAttr(n,"Opacity","60%"),this._setAttr(n,"Color","#aaaaaa")):this._setAttr(n,"On","False"),u.visPropOld.shadow=d)},suspendRedraw:function(){this.container.style.display="none"},unsuspendRedraw:function(){this.container.style.display=""}});const VMLRenderer=JXG$1.VMLRenderer;var uuidCharsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",uuidChars=uuidCharsStr.split("");JXG$1.Util=JXG$1.Util||{};JXG$1.Util.genUUID=function(u){var n,d,C=[],I=0;for(u=u||"",u!==""&&u.slice(u.length-1)!=="-"&&(u=u+"-"),d=0;d<36;d++)d===8||d===13||d===18||d===23?C[d]="-":d===14?C[d]="4":(I<=2&&(I=33554432+Math.random()*16777216|0),n=I&15,I=I>>4,C[d]=uuidChars[d===19?n&3|8:n]);return u+C.join("")};const UUID=JXG$1.Util;JXG$1.CanvasRenderer=function(u,n){if(this.type="canvas",this.canvasRoot=null,this.suspendHandle=null,this.canvasId=UUID.genUUID(),this.canvasNamespace=null,JXG$1.isBrowser)this.container=u,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.innerHTML=['<canvas id="',this.canvasId,'" width="',n.width,'px" height="',n.height,'px"></canvas>'].join(""),this.canvasRoot=this.container.ownerDocument.getElementById(this.canvasId),this.canvasRoot.style.display="block",this.context=this.canvasRoot.getContext("2d");else if(JXG$1.isNode())try{this.canvasRoot=JXG$1.createCanvas(500,500),this.context=this.canvasRoot.getContext("2d")}catch{throw new Error(`JXG.createCanvas not available.
Install the npm package \`canvas\`
and call:
    import { createCanvas } from "canvas.js";
    JXG.createCanvas = createCanvas;
`)}};JXG$1.CanvasRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.CanvasRenderer.prototype,{_drawPolygon:function(u,n,d){var C,I=u.length,f=this.context;if(I>0){if(d&&(f.lineWidth=0),f.beginPath(),f.moveTo(u[0][0],u[0][1]),n===1)for(C=1;C<I;C++)f.lineTo(u[C][0],u[C][1]);else for(C=1;C<I;C+=3)f.bezierCurveTo(u[C][0],u[C][1],u[C+1][0],u[C+1][1],u[C+2][0],u[C+2][1]);d?(f.lineTo(u[0][0],u[0][1]),f.closePath(),f.fill("evenodd")):f.stroke()}},_fill:function(u){var n=this.context;n.save(),this._setColor(u,"fill")&&n.fill("evenodd"),n.restore()},_rotatePoint:function(u,n,d){return[n*Math.cos(u)-d*Math.sin(u),n*Math.sin(u)+d*Math.cos(u)]},_rotateShape:function(u,n){var d,C=[],I=u.length;if(I<=0)return u;for(d=0;d<I;d++)C.push(this._rotatePoint(n,u[d][0],u[d][1]));return C},updateGradientAngle:function(u,n){var d=1,C=Math.cos(-n),I=Math.sin(-n),f=u.getBoundingBox(),y,B,_,Z,M,V,T,H,F,O,$,U;return Math.abs(C)>Math.abs(I)?d/=Math.abs(C):d/=Math.abs(I),C>=0?(_=0,Z=C*d):(_=-C*d,Z=0),I>=0?(M=0,V=I*d):(M=-I*d,V=0),y=new Coords(Const.COORDS_BY_USER,[f[0],f[1]],u.board),B=new Coords(Const.COORDS_BY_USER,[f[2],f[3]],u.board),$=B.scrCoords[1]-y.scrCoords[1],U=B.scrCoords[2]-y.scrCoords[2],T=y.scrCoords[1]+$*_,F=y.scrCoords[2]+U*M,H=y.scrCoords[1]+$*Z,O=y.scrCoords[2]+U*V,this.context.createLinearGradient(T,F,H,O)},updateGradientCircle:function(u,n,d,C,I,f,y){var B=u.getBoundingBox(),_,Z,M,V,T,H,F,O,$,U;return _=new Coords(Const.COORDS_BY_USER,[B[0],B[1]],u.board),Z=new Coords(Const.COORDS_BY_USER,[B[2],B[3]],u.board),$=Z.scrCoords[1]-_.scrCoords[1],U=_.scrCoords[2]-Z.scrCoords[2],M=_.scrCoords[1]+$*n,V=Z.scrCoords[2]+U*d,H=_.scrCoords[1]+$*I,F=Z.scrCoords[2]+U*f,T=C*($+U)*.5,O=y*($+U)*.5,this.context.createRadialGradient(H,F,O,M,V,T)},updateGradient:function(u){var n,d=JXG$1.evaluate(u.visProp.gradient),C;return n=JXG$1.evaluate(u.visProp.fillcolor),d==="linear"?C=this.updateGradientAngle(u,JXG$1.evaluate(u.visProp.gradientangle)):d==="radial"&&(C=this.updateGradientCircle(u,JXG$1.evaluate(u.visProp.gradientcx),JXG$1.evaluate(u.visProp.gradientcy),JXG$1.evaluate(u.visProp.gradientr),JXG$1.evaluate(u.visProp.gradientfx),JXG$1.evaluate(u.visProp.gradientfy),JXG$1.evaluate(u.visProp.gradientfr))),C.addColorStop(JXG$1.evaluate(u.visProp.gradientstartoffset),n),C.addColorStop(JXG$1.evaluate(u.visProp.gradientendoffset),JXG$1.evaluate(u.visProp.gradientsecondcolor)),C},_setColor:function(u,n,d){var C=!0,I=u.visProp,f,y,B,_,Z,M,V,T;return n=n||"stroke",d=d||n,f=this._getHighlighted(u),T=JXG$1.evaluate(u.visProp.gradient),T==="linear"||T==="radial"?(this.context[d+"Style"]=this.updateGradient(u),C):(B=JXG$1.evaluate(I[f+n+"color"]),B!=="none"&&B!==!1?(M=JXG$1.evaluate(I[f+n+"opacity"]),M=M>0?M:0,B.length!==9?(Z=B,V=M):(_=JXG$1.rgba2rgbo(B),Z=_[0],V=M*_[1]),this.context.globalAlpha=V,this.context[d+"Style"]=Z):C=!1,y=parseFloat(JXG$1.evaluate(I[f+"strokewidth"])),n==="stroke"&&!isNaN(y)&&(y===0?this.context.globalAlpha=0:this.context.lineWidth=y),n==="stroke"&&I.linecap!==void 0&&I.linecap!==""&&(this.context.lineCap=I.linecap),C)},_stroke:function(u){var n=this.context,d=JXG$1.evaluate(u.visProp.dash),C=JXG$1.evaluate(u.visProp.dashscale),I=C?.5*JXG$1.evaluate(u.visProp.strokewidth):1;n.save(),d>0?n.setLineDash&&n.setLineDash(this.dashArray[d-1].map(function(f){return f*I})):this.context.lineDashArray=[],this._setColor(u,"stroke")&&n.stroke(),n.restore()},_translateShape:function(u,n,d){var C,I=[],f=u.length;if(f<=0)return u;for(C=0;C<f;C++)I.push([u[C][0]+n,u[C][1]+d]);return I},drawPoint:function(u){var n=JXG$1.evaluate(u.visProp.face),d=JXG$1.evaluate(u.visProp.size),C=u.coords.scrCoords,I=d*Math.sqrt(3)*.5,f=d*.5,y=parseFloat(JXG$1.evaluate(u.visProp.strokewidth))/2,B=this.context;if(u.visPropCalc.visible)switch(n){case"cross":case"x":B.beginPath(),B.moveTo(C[1]-d,C[2]-d),B.lineTo(C[1]+d,C[2]+d),B.moveTo(C[1]+d,C[2]-d),B.lineTo(C[1]-d,C[2]+d),B.lineCap="round",B.lineJoin="round",B.closePath(),this._stroke(u);break;case"circle":case"o":B.beginPath(),B.arc(C[1],C[2],d+1+y,0,2*Math.PI,!1),B.closePath(),this._fill(u),this._stroke(u);break;case"square":case"[]":if(d<=0)break;B.save(),this._setColor(u,"stroke","fill")&&B.fillRect(C[1]-d-y,C[2]-d-y,d*2+3*y,d*2+3*y),B.restore(),B.save(),this._setColor(u,"fill"),B.fillRect(C[1]-d+y,C[2]-d+y,d*2-y,d*2-y),B.restore();break;case"plus":case"+":B.beginPath(),B.moveTo(C[1]-d,C[2]),B.lineTo(C[1]+d,C[2]),B.moveTo(C[1],C[2]-d),B.lineTo(C[1],C[2]+d),B.lineCap="round",B.lineJoin="round",B.closePath(),this._stroke(u);break;case"divide":case"|":B.beginPath(),B.moveTo(C[1],C[2]-d),B.lineTo(C[1],C[2]+d),B.lineCap="round",B.lineJoin="round",B.closePath(),this._stroke(u);break;case"minus":case"-":B.beginPath(),B.moveTo(C[1]-d,C[2]),B.lineTo(C[1]+d,C[2]),B.lineCap="round",B.lineJoin="round",B.closePath(),this._stroke(u);break;case"diamond2":case"<<>>":d*=1.41;case"diamond":case"<>":B.beginPath(),B.moveTo(C[1]-d,C[2]),B.lineTo(C[1],C[2]+d),B.lineTo(C[1]+d,C[2]),B.lineTo(C[1],C[2]-d),B.closePath(),this._fill(u),this._stroke(u);break;case"triangleup":case"A":case"a":case"^":B.beginPath(),B.moveTo(C[1],C[2]-d),B.lineTo(C[1]-I,C[2]+f),B.lineTo(C[1]+I,C[2]+f),B.closePath(),this._fill(u),this._stroke(u);break;case"triangledown":case"v":B.beginPath(),B.moveTo(C[1],C[2]+d),B.lineTo(C[1]-I,C[2]-f),B.lineTo(C[1]+I,C[2]-f),B.closePath(),this._fill(u),this._stroke(u);break;case"triangleleft":case"<":B.beginPath(),B.moveTo(C[1]-d,C[2]),B.lineTo(C[1]+f,C[2]-I),B.lineTo(C[1]+f,C[2]+I),B.closePath(),this._fill(u),this._stroke(u);break;case"triangleright":case">":B.beginPath(),B.moveTo(C[1]+d,C[2]),B.lineTo(C[1]-f,C[2]-I),B.lineTo(C[1]-f,C[2]+I),B.closePath(),this._fill(u),this._stroke(u);break}},updatePoint:function(u){this.drawPoint(u)},drawArrows:function(u,n,d,C,I){var f,y,B,_,Z,M,V,T,H=this.context,F=6,O=1,$,U,ee=1,Q=1,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge=I.evFirst,Ze=I.evLast;if(JXG$1.evaluate(u.visProp.strokecolor)!=="none"&&(Ge||Ze)){if(u.elementClass===Const.OBJECT_CLASS_LINE)f=n.scrCoords[1],y=n.scrCoords[2],B=d.scrCoords[1],_=d.scrCoords[2],fe=me=Math.atan2(_-y,B-f);else{if(f=u.points[0].scrCoords[1],y=u.points[0].scrCoords[2],Ie=u.points.length-1,Ie<1)return;B=u.points[u.points.length-1].scrCoords[1],_=u.points[u.points.length-1].scrCoords[2],ae=u.points[1].scrCoords[1]-u.points[0].scrCoords[1],ce=u.points[1].scrCoords[2]-u.points[0].scrCoords[2],ge=u.points[Ie].scrCoords[1]-u.points[Ie-1].scrCoords[1],he=u.points[Ie].scrCoords[2]-u.points[Ie-1].scrCoords[2],Ge&&(fe=Math.atan2(ce,ae)),Ze&&(me=Math.atan2(he,ge))}if(Z=JXG$1.evaluate(u.visProp[C+"strokewidth"]),Ge)if(F=I.sizeFirst,M=Z*F,O=I.typeFirst,$=O,O===2)T=[[M,-M*.5],[0,0],[M,M*.5],[M*.5,0]];else if(O===3)T=[[M/3,-M*.5],[0,-M*.5],[0,M*.5],[M/3,M*.5]];else if(O===4)for(M/=10,ee=3,T=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],le=T.length,ne=0;ne<le;ne++)T[ne][0]*=-M,T[ne][1]*=M,T[ne][0]+=10*M,T[ne][1]-=3.31*M;else if(O===5)for(M/=10,ee=3,T=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],le=T.length,ne=0;ne<le;ne++)T[ne][0]*=-M,T[ne][1]*=M,T[ne][0]+=10*M,T[ne][1]-=3.28*M;else if(O===6)for(M/=10,ee=3,T=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],le=T.length,ne=0;ne<le;ne++)T[ne][0]*=-M,T[ne][1]*=M,T[ne][0]+=10*M,T[ne][1]-=2.84*M;else if(O===7)for(M=Z,ee=3,T=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],le=T.length,ne=0;ne<le;ne++)T[ne][0]*=-M,T[ne][1]*=M,T[ne][0]+=10*M,T[ne][1]-=5.2*M;else T=[[M,-M*.5],[0,0],[M,M*.5]];if(Ze)if(F=I.sizeLast,M=Z*F,O=I.typeLast,U=O,O===2)V=[[-M,-M*.5],[0,0],[-M,M*.5],[-M*.5,0]];else if(O===3)V=[[-M/3,-M*.5],[0,-M*.5],[0,M*.5],[-M/3,M*.5]];else if(O===4)for(M/=10,Q=3,V=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],le=V.length,ne=0;ne<le;ne++)V[ne][0]*=M,V[ne][1]*=M,V[ne][0]-=10*M,V[ne][1]-=3.31*M;else if(O===5)for(M/=10,Q=3,V=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],le=V.length,ne=0;ne<le;ne++)V[ne][0]*=M,V[ne][1]*=M,V[ne][0]-=10*M,V[ne][1]-=3.28*M;else if(O===6)for(M/=10,Q=3,V=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],le=V.length,ne=0;ne<le;ne++)V[ne][0]*=M,V[ne][1]*=M,V[ne][0]-=10*M,V[ne][1]-=2.84*M;else if(O===7)for(M=Z,Q=3,V=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],le=V.length,ne=0;ne<le;ne++)V[ne][0]*=M,V[ne][1]*=M,V[ne][0]-=10*M,V[ne][1]-=5.2*M;else V=[[-M,-M*.5],[0,0],[-M,M*.5]];H.save(),this._setColor(u,"stroke","fill")&&(this._setColor(u,"stroke"),Ge&&($===7?ie=!1:ie=!0,this._drawPolygon(this._translateShape(this._rotateShape(T,fe),f,y),ee,ie)),Ze&&(U===7?ie=!1:ie=!0,this._drawPolygon(this._translateShape(this._rotateShape(V,me),B,_),Q,ie))),H.restore()}},drawLine:function(u){var n,d,C=new Coords(Const.COORDS_BY_USER,u.point1.coords.usrCoords,u.board),I=new Coords(Const.COORDS_BY_USER,u.point2.coords.usrCoords,u.board),f=null,y,B,_;u.visPropCalc.visible&&(y=this._getHighlighted(u),B=JXG$1.evaluate(u.visProp[y+"strokewidth"]),_=this.getArrowHeadData(u,B,y),(_.evFirst||_.evLast)&&(f=-4),Geometry.calcStraight(u,C,I,f),this.handleTouchpoints(u,C,I,_),n=new Coords(Const.COORDS_BY_USER,C.usrCoords,u.board),d=new Coords(Const.COORDS_BY_USER,I.usrCoords,u.board),this.getPositionArrowHead(u,C,I,_),this.context.beginPath(),this.context.moveTo(C.scrCoords[1],C.scrCoords[2]),this.context.lineTo(I.scrCoords[1],I.scrCoords[2]),this._stroke(u),(_.evFirst||_.evLast)&&this.drawArrows(u,n,d,y,_))},updateLine:function(u){this.drawLine(u)},drawTicks:function(){},updateTicks:function(u){var n,d,C,I,f=u.ticks.length,y,B,_=this.context;for(_.beginPath(),n=0;n<f;n++)for(d=u.ticks[n],C=d[0],I=d[1],y=C.length,_.moveTo(C[0],I[0]),B=1;B<y;++B)_.lineTo(C[B],I[B]);_.lineCap="round",this._stroke(u)},drawCurve:function(u){var n,d,C;JXG$1.evaluate(u.visProp.handdrawing)?this.updatePathStringBezierPrim(u):this.updatePathStringPrim(u),u.numberPoints>1&&(n=this._getHighlighted(u),d=JXG$1.evaluate(u.visProp[n+"strokewidth"]),C=this.getArrowHeadData(u,d,n),(C.evFirst||C.evLast)&&this.drawArrows(u,null,null,n,C))},updateCurve:function(u){this.drawCurve(u)},drawEllipse:function(u){var n=u.center.coords.scrCoords[1],d=u.center.coords.scrCoords[2],C=u.board.unitX,I=u.board.unitY,f=2*u.Radius(),y=2*u.Radius(),B=f*C,_=y*I,Z=n-B/2,M=d-_/2,V=B/2*.5522848,T=_/2*.5522848,H=Z+B,F=M+_,O=Z+B/2,$=M+_/2,U=this.context;f>0&&y>0&&!isNaN(n+d)&&(U.beginPath(),U.moveTo(Z,$),U.bezierCurveTo(Z,$-T,O-V,M,O,M),U.bezierCurveTo(O+V,M,H,$-T,H,$),U.bezierCurveTo(H,$+T,O+V,F,O,F),U.bezierCurveTo(O-V,F,Z,$+T,Z,$),U.closePath(),this._fill(u),this._stroke(u))},updateEllipse:function(u){return this.drawEllipse(u)},displayCopyright:function(u,n){var d=this.context;d.save(),d.font=n+"px Arial",d.fillStyle="#aaa",d.lineWidth=.5,d.fillText(u,10,2+n),d.restore()},drawInternalText:function(u){var n=JXG$1.evaluate(u.visProp.fontsize),d=JXG$1.evaluate(u.visProp.fontunit),C=u.getAnchorX(),I=u.getAnchorY(),f=this.context;return f.save(),this._setColor(u,"stroke","fill")&&!isNaN(u.coords.scrCoords[1]+u.coords.scrCoords[2])&&(f.font=(n>0?n:0)+d+" Arial",this.transformImage(u,u.transformations),C==="left"?f.textAlign="left":C==="right"?f.textAlign="right":C==="middle"&&(f.textAlign="center"),I==="bottom"?f.textBaseline="bottom":I==="top"?f.textBaseline="top":I==="middle"&&(f.textBaseline="middle"),f.fillText(u.plaintext,u.coords.scrCoords[1],u.coords.scrCoords[2])),f.restore(),null},updateInternalText:function(u){this.drawInternalText(u)},setObjectStrokeColor:function(u,n,d){var C=JXG$1.evaluate(n),I,f,y=JXG$1.evaluate(d),B,_;y=y>0?y:0,!(u.visPropOld.strokecolor===C&&u.visPropOld.strokeopacity===y)&&(JXG$1.exists(C)&&C!==!1&&(C.length!==9?(I=C,B=y):(f=JXG$1.rgba2rgbo(C),I=f[0],B=y*f[1]),_=u.rendNode,u.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(u.visProp.display)==="html"&&(_.style.color=I,_.style.opacity=B)),u.visPropOld.strokecolor=C,u.visPropOld.strokeopacity=y)},drawImage:function(u){u.rendNode=new Image,u._src="",this.updateImage(u)},updateImage:function(u){var n=this.context,d=JXG$1.evaluate(u.visProp.fillopacity),C=JXG$1.bind(function(){u.imgIsLoaded=!0,!(u.size[0]<=0||u.size[1]<=0)&&(n.save(),n.globalAlpha=d,this.transformImage(u,u.transformations),n.drawImage(u.rendNode,u.coords.scrCoords[1],u.coords.scrCoords[2]-u.size[1],u.size[0],u.size[1]),n.restore())},this);this.updateImageURL(u)?u.rendNode.onload=C:u.imgIsLoaded&&C()},transformImage:function(u,n){var d,C,I,f,y,B=n.length,_=this.context;if(B>0)if(d=this.joinTransforms(u,n),u.elementClass===Const.OBJECT_CLASS_TEXT&&u.visProp.display==="html"){if(C=" matrix("+[d[1][1],d[2][1],d[1][2],d[2][2],d[1][0],d[2][0]].join(",")+") ",C.indexOf("NaN")===-1){switch(y=u.rendNode,y.style.transform=C,I=-u.coords.scrCoords[1],f=-u.coords.scrCoords[2],JXG$1.evaluate(u.visProp.anchorx)){case"right":I+=u.size[0];break;case"middle":I+=u.size[0]*.5;break}switch(JXG$1.evaluate(u.visProp.anchory)){case"bottom":f+=u.size[1];break;case"middle":f+=u.size[1]*.5;break}y.style["transform-origin"]=I+"px "+f+"px"}}else Math.abs(Numerics.det(d))>=Mat.eps&&_.transform(d[1][1],d[2][1],d[1][2],d[2][2],d[1][0],d[2][0])},updateImageURL:function(u){var n;return n=JXG$1.evaluate(u.url),u._src!==n?(u.imgIsLoaded=!1,u.rendNode.src=n,u._src=n,!0):!1},remove:function(u){JXG$1.exists(u)&&JXG$1.exists(u.parentNode)&&u.parentNode.removeChild(u)},updatePathStringPrim:function(u){var n,d,C,I,f,y="M",B="L",_="C",Z=y,M=5e3,V=this.context;if(!(u.numberPoints<=0)){if(f=Math.min(u.points.length,u.numberPoints),V.beginPath(),u.bezierDegree===1)for(n=0;n<f;n++)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?Z=y:(d[1]>M?d[1]=M:d[1]<-5e3&&(d[1]=-5e3),d[2]>M?d[2]=M:d[2]<-5e3&&(d[2]=-5e3),Z===y?V.moveTo(d[1],d[2]):V.lineTo(d[1],d[2]),Z=B);else if(u.bezierDegree===3)for(n=0;n<f;)d=u.points[n].scrCoords,isNaN(d[1])||isNaN(d[2])?Z=y:(Z===y?V.moveTo(d[1],d[2]):(n+=1,C=u.points[n].scrCoords,n+=1,I=u.points[n].scrCoords,V.bezierCurveTo(d[1],d[2],C[1],C[2],I[1],I[2])),Z=_),n+=1;V.lineCap="round",this._fill(u),this._stroke(u)}},updatePathStringBezierPrim:function(u){var n,d,C,I,f,y,B,_="M",Z="C",M=_,V=5e3,T=JXG$1.evaluate(u.visProp.strokewidth),H=JXG$1.evaluate(u.visProp.curvetype)!=="plot",F=this.context;if(!(u.numberPoints<=0)){for(H&&u.board.options.curve.RDPsmoothing&&(u.points=Numerics.RamerDouglasPeucker(u.points,.5)),B=Math.min(u.points.length,u.numberPoints),F.beginPath(),d=1;d<3;d++)for(M=_,n=0;n<B;n++)I=u.points[n].scrCoords,isNaN(I[1])||isNaN(I[2])?M=_:(I[1]>V?I[1]=V:I[1]<-5e3&&(I[1]=-5e3),I[2]>V?I[2]=V:I[2]<-5e3&&(I[2]=-5e3),M===_?F.moveTo(I[1],I[2]):(C=2*d,F.bezierCurveTo(f+(I[1]-f)*.333+T*(C*Math.random()-d),y+(I[2]-y)*.333+T*(C*Math.random()-d),f+(I[1]-f)*.666+T*(C*Math.random()-d),y+(I[2]-y)*.666+T*(C*Math.random()-d),I[1],I[2])),M=Z,f=I[1],y=I[2]);F.lineCap="round",this._fill(u),this._stroke(u)}},updatePolygonPrim:function(u,n){var d,C,I,f=n.vertices.length,y=this.context,B=!0;if(!(f<=0||!n.visPropCalc.visible)){for(n.elType==="polygonalchain"&&f++,y.beginPath(),C=0;!n.vertices[C].isReal&&C<f-1;)C++,B=!1;for(d=n.vertices[C].coords.scrCoords,y.moveTo(d[1],d[2]),I=C;I<f-1;I++)n.vertices[I].isReal||(B=!1),d=n.vertices[I].coords.scrCoords,y.lineTo(d[1],d[2]);y.closePath(),B&&this._fill(n)}},display:function(u,n){u&&u.rendNode&&(u.visPropOld.visible=n,n?u.rendNode.style.visibility="inherit":u.rendNode.style.visibility="hidden")},show:function(u){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),JXG$1.exists(u.rendNode)&&(u.rendNode.style.visibility="inherit")},hide:function(u){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),JXG$1.exists(u.rendNode)&&(u.rendNode.style.visibility="hidden")},setGradient:function(u){},setShadow:function(u){u.visPropOld.shadow!==u.visProp.shadow&&(u.visPropOld.shadow=u.visProp.shadow)},highlight:function(u){return u.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(u.visProp.display)==="html"?this.updateTextStyle(u,!0):(u.board.prepareUpdate(),u.board.renderer.suspendRedraw(u.board),u.board.updateRenderer(),u.board.renderer.unsuspendRedraw()),this},noHighlight:function(u){return u.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(u.visProp.display)==="html"?this.updateTextStyle(u,!1):(u.board.prepareUpdate(),u.board.renderer.suspendRedraw(u.board),u.board.updateRenderer(),u.board.renderer.unsuspendRedraw()),this},suspendRedraw:function(u){this.context.save(),this.context.clearRect(0,0,this.canvasRoot.width,this.canvasRoot.height),u&&u.attr.showcopyright&&this.displayCopyright(JXG$1.licenseText,12)},unsuspendRedraw:function(){this.context.restore()},resize:function(u,n){this.container?(this.canvasRoot.style.width=parseFloat(u)+"px",this.canvasRoot.style.height=parseFloat(n)+"px",this.canvasRoot.setAttribute("width",2*parseFloat(u)+"px"),this.canvasRoot.setAttribute("height",2*parseFloat(n)+"px")):(this.canvasRoot.width=2*parseFloat(u),this.canvasRoot.height=2*parseFloat(n)),this.context=this.canvasRoot.getContext("2d"),this.context.scale(2,2)},removeToInsertLater:function(){return function(){}}});const CanvasRenderer=JXG$1.CanvasRenderer;JXG$1.NoRenderer=function(){this.enhancedRendering=!1,this.type="no"};JXG$1.extend(JXG$1.NoRenderer.prototype,{drawPoint:function(u){},updatePoint:function(u){},changePointStyle:function(u){},drawLine:function(u){},updateLine:function(u){},drawTicks:function(u){},updateTicks:function(u){},drawCurve:function(u){},updateCurve:function(u){},drawEllipse:function(u){},updateEllipse:function(u){},drawPolygon:function(u){},updatePolygon:function(u){},displayCopyright:function(u,n){},drawInternalText:function(u){},updateInternalText:function(u){},drawText:function(u){},updateText:function(u){},updateTextStyle:function(u,n){},updateInternalTextStyle:function(u,n,d){},drawImage:function(u){},updateImage:function(u){},transformImage:function(u,n){},updateImageURL:function(u){},appendChildPrim:function(u,n){},appendNodesToElement:function(u,n){},createPrim:function(u,n){return null},remove:function(u){},makeArrows:function(u){},updateEllipsePrim:function(u,n,d,C,I){},updateLinePrim:function(u,n,d,C,I,f){},updatePathPrim:function(u,n,d){},updatePathStringPoint:function(u,n,d){},updatePathStringPrim:function(u){},updatePathStringBezierPrim:function(u){},updatePolygonPrim:function(u,n){},updateRectPrim:function(u,n,d,C,I){},setPropertyPrim:function(u,n,d){},display:function(u,n){u&&(u.visPropOld.visible=n)},show:function(u){},hide:function(u){},setBuffering:function(u,n){},setDashStyle:function(u){},setDraft:function(u){},removeDraft:function(u){},setGradient:function(u){},updateGradient:function(u){},setObjectTransition:function(u,n){},setObjectFillColor:function(u,n,d){},setObjectStrokeColor:function(u,n,d){},setObjectStrokeWidth:function(u,n){},setShadow:function(u){},highlight:function(u){},noHighlight:function(u){},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(u){},getElementById:function(u){return null},resize:function(u,n){},removeToInsertLater:function(){return function(){}}});JXG$1.NoRenderer.prototype=new AbstractRenderer;const NoRenderer=JXG$1.NoRenderer;JXG$1.JSXGraph={rendererType:function(){return Options.board.renderer="no",JXG$1.supportsVML()&&(Options.board.renderer="vml",document.onmousemove=function(){var u;return document.body&&(u=document.body.scrollLeft,u+=document.body.scrollTop),u}),JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),JXG$1.supportsSVG()&&(Options.board.renderer="svg"),JXG$1.isNode()&&JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),(JXG$1.isNode()||Options.renderer==="no")&&(Options.text.display="internal",Options.infobox.display="internal"),Options.board.renderer}(),initRenderer:function(u,n,d,C){var I,f;if((!JXG$1.exists(d)||d===!1)&&typeof document=="object"&&(d=document),typeof d=="object"&&u!==null)for(I=JXG$1.isString(u)?d.getElementById(u):u;I.firstChild;)I.removeChild(I.firstChild);else I=u;return(C===void 0||C==="auto")&&(C=this.rendererType),C==="svg"?f=new SVGRenderer(I,n):C==="vml"?f=new VMLRenderer(I):C==="canvas"?f=new CanvasRenderer(I,n):f=new NoRenderer,f},_setAttributes:function(u,n){var d=JXG$1.copyAttributes(u,n,"board"),C=["drag","fullscreen","intl","keyboard","logging","pan","resize","screenshot","selection","zoom"],I=C.length,f,y;for(f=0;f<I;f++)y=C[f],d[y]=JXG$1.copyAttributes(d,n,"board",y);return d.navbar=JXG$1.copyAttributes(d.navbar,n,"navbar"),d.movetarget=u.moveTarget||u.movetarget||n.board.moveTarget,d},_fillBoard:function(u,n,d){u.initInfobox(n.infobox),u.maxboundingbox=n.maxboundingbox,u.resizeContainer(d.width,d.height,!0,!0),u._createSelectionPolygon(n),u.renderer.drawNavigationBar(u,n.navbar),JXG$1.boards[u.id]=u},_setARIA:function(u,n){var d=n.document,C,I,f,y,B,_;if(typeof d!="object"){if(!JXG$1.isBrowser)return;d=document}I=JXG$1.isString(u)?d.getElementById(u):u,C=I.ownerDocument,y=I.parentNode,B=u+"_ARIAlabel",_=u+"_ARIAdescription",f=C.createElement("div"),f.innerHTML=n.title,f.setAttribute("id",B),f.style.display="none",y.insertBefore(f,I),f=C.createElement("div"),f.innerHTML=n.description,f.setAttribute("id",_),f.style.display="none",y.insertBefore(f,I),I.setAttribute("aria-labelledby",B),I.setAttribute("aria-describedby",_)},_removeARIANodes:function(u){var n,d,C;C=u.document||document,typeof C=="object"&&(d=u.containerObj.getAttribute("aria-labelledby"),n=C.getElementById(d),n&&n.parentNode&&n.parentNode.removeChild(n),d=u.containerObj.getAttribute("aria-describedby"),n=C.getElementById(d),n&&n.parentNode&&n.parentNode.removeChild(n))},initBoard:function(u,n){var d,C,I,f,y,B,_=0,Z=0,M,V,T,H,F,O,$,U,ee={},Q;return n=n||{},n.theme!=="default"&&JXG$1.exists(JXG$1.themes[n.theme])&&(ee=JXG$1.themes[n.theme]),U=JXG$1.deepCopy(Options,ee,!0),H=this._setAttributes(n,U),V=JXG$1.getDimensions(u,H.document),H.unitx||H.unity?(d=JXG$1.def(H.originx,150),C=JXG$1.def(H.originy,150),I=JXG$1.def(H.unitx,50),f=JXG$1.def(H.unity,50)):(T=H.boundingbox,T[0]<H.maxboundingbox[0]&&(T[0]=H.maxboundingbox[0]),T[1]>H.maxboundingbox[1]&&(T[1]=H.maxboundingbox[1]),T[2]>H.maxboundingbox[2]&&(T[2]=H.maxboundingbox[2]),T[3]<H.maxboundingbox[3]&&(T[3]=H.maxboundingbox[3]),y=parseInt(V.width,10),B=parseInt(V.height,10),JXG$1.exists(T)&&H.keepaspectratio?(I=y/(T[2]-T[0]),f=B/(T[1]-T[3]),Math.abs(I)<Math.abs(f)?(f=Math.abs(I)*f/Math.abs(f),Z=(B/f-(T[1]-T[3]))*.5):(I=Math.abs(f)*I/Math.abs(I),_=(y/I-(T[2]-T[0]))*.5)):(I=y/(T[2]-T[0]),f=B/(T[1]-T[3])),d=-I*(T[0]-_),C=f*(T[1]+Z)),M=this.initRenderer(u,V,H.document,H.renderer),this._setARIA(u,H),Q=new Board(u,M,H.id,[d,C],H.zoomx,H.zoomy,I,f,V.width,V.height,H),Q.keepaspectratio=H.keepaspectratio,this._fillBoard(Q,H,V),Q.suspendUpdate(),H=Q.attr,H.axis&&(F=typeof H.axis=="object"?H.axis:{},O=JXG$1.deepCopy(U.board.defaultaxes.x,F),$=JXG$1.deepCopy(U.board.defaultaxes.y,F),H.defaultaxes.x&&(O=JXG$1.deepCopy(O,H.defaultaxes.x)),H.defaultaxes.y&&($=JXG$1.deepCopy($,H.defaultaxes.y)),Q.defaultAxes={},Q.defaultAxes.x=Q.create("axis",[[0,0],[1,0]],O),Q.defaultAxes.y=Q.create("axis",[[0,0],[0,1]],$)),H.grid&&Q.create("grid",[],typeof H.grid=="object"?H.grid:{}),Q.unsuspendUpdate(),Q},loadBoardFromFile:function(u,n,d,C,I){var f,y,B,_,Z;return C=C||{},f=this._setAttributes(C),_=JXG$1.getDimensions(u,f.document),y=this.initRenderer(u,_,f.document,f.renderer),this._setARIA(u,f),B=new Board(u,y,"",[150,150],1,1,50,50,_.width,_.height,f),this._fillBoard(B,f,_),Z=f.encoding||"iso-8859-1",FileReader$1.parseFileContent(n,B,d,!0,Z,I),B},loadBoardFromString:function(u,n,d,C,I){var f,y,B,_;return C=C||{},f=this._setAttributes(C),_=JXG$1.getDimensions(u,f.document),y=this.initRenderer(u,_,f.document,f.renderer),this._setARIA(u,f),B=new Board(u,y,"",[150,150],1,1,50,50,_.width,_.height,f),this._fillBoard(B,f,_),FileReader$1.parseString(n,B,d,!0,I),B},freeBoard:function(u){var n;typeof u=="string"&&(u=JXG$1.boards[u]),this._removeARIANodes(u),u.removeEventHandlers(),u.suspendUpdate();for(n in u.objects)u.objects.hasOwnProperty(n)&&u.objects[n].remove();for(;u.containerObj.firstChild;)u.containerObj.removeChild(u.containerObj.firstChild);for(n in u.objects)u.objects.hasOwnProperty(n)&&delete u.objects[n];delete u.renderer,u.jc.creator.clearCache(),delete u.jc,delete JXG$1.boards[u.id]},registerElement:function(u,n){JXG$1.deprecated("JXG.JSXGraph.registerElement()","JXG.registerElement()"),JXG$1.registerElement(u,n)}};JXG$1.isBrowser&&typeof window=="object"&&typeof document=="object"&&JXG$1.addEvent(window,"load",function(){var u,n,d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee=!1,Q=document.getElementsByTagName("script"),ie=function(le,ae,ce){var ge=JXG$1.JSXGraph.initBoard(I,{boundingbox:ce,keepaspectratio:!0,grid:F,axis:H,showReload:!0});if(ae.toLowerCase().indexOf("script")>-1)ge.construct(le);else try{ge.jc.parse(le)}catch(he){JXG$1.debug(he)}return ge},ne=function(le,ae,ce,ge){return function(){var he;JXG$1.JSXGraph.freeBoard(le),he=ie(ae,ce,ge),he.reload=ne(he,ae,ce,ge)}};for(n=0;n<Q.length;n++)if(u=Q[n].getAttribute("type",!1),JXG$1.exists(u)&&(u.toLowerCase()==="text/jessiescript"||u.toLowerCase()==="jessiescript"||u.toLowerCase()==="text/jessiecode"||u.toLowerCase()==="jessiecode")){if(V=Q[n].getAttribute("class",!1)||"",B=Q[n].getAttribute("width",!1)||"",_=Q[n].getAttribute("height",!1)||"",Z=Q[n].getAttribute("maxwidth",!1)||"100%",M=Q[n].getAttribute("aspectratio",!1)||"1/1",T=Q[n].getAttribute("boundingbox",!1)||"-5, 5, 5, -5",I=Q[n].getAttribute("container",!1),$=Q[n].getAttribute("src",!1),T=T.split(","),T.length!==4)T=[-5,5,5,-5];else for(d=0;d<T.length;d++)T[d]=parseFloat(T[d]);if(H=JXG$1.str2Bool(Q[n].getAttribute("axis",!1)||"false"),F=JXG$1.str2Bool(Q[n].getAttribute("grid",!1)||"false"),JXG$1.exists(I))C=document.getElementById(I);else{I="jessiescript_autgen_jxg_"+n,C=document.createElement("div"),C.setAttribute("id",I),y=B!==""?"width:"+B+";":"",y+=_!==""?"height:"+_+";":"",y+=Z!==""?"max-width:"+Z+";":"",y+=M!==""?"aspect-ratio:"+M+";":"",C.setAttribute("style",y),C.setAttribute("class","jxgbox "+V);try{document.body.insertBefore(C,Q[n])}catch{typeof jQuery=="object"&&jQuery(C).insertBefore(Q[n])}}O="",JXG$1.exists($)?(ee=!0,U=new XMLHttpRequest,U.open("GET",$),U.overrideMimeType("text/plain; charset=x-user-defined"),U.addEventListener("load",function(){if(this.status<400)O=this.responseText+`
`+O,f=ie(O,u,T),f.reload=ne(f,O,u,T);else throw new Error(`
JSXGraph: failed to load file`,$,":",this.responseText)}),U.addEventListener("error",function(le){throw new Error(`
JSXGraph: failed to load file`,$,":",le)}),U.send()):ee=!1,document.getElementById(I)?(O=Q[n].innerHTML,O=O.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""),Q[n].innerHTML=O,ee||(f=ie(O,u,T),f.reload=ne(f,O,u,T))):JXG$1.debug("JSXGraph: Apparently the div injection failed. Can't create a board, sorry.")}},window);JXG$1.JSXGraph;JXG$1.Point=function(u,n,d){this.constructor(u,d,Const.OBJECT_TYPE_POINT,Const.OBJECT_CLASS_POINT),this.element=this.board.select(d.anchor),this.coordsConstructor(n),this.elType="point",this.id=this.board.setId(this,"P"),this.board.renderer.drawPoint(this),this.board.finalizeAdding(this),this.createGradient(),this.createLabel()};JXG$1.Point.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Point.prototype,{hasPoint:function(u,n){var d=this.coords.scrCoords,C,I,f,y=JXG$1.evaluate(this.visProp.sizeunit);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(f=this.board._inputDevice,I=JXG$1.evaluate(this.visProp.precision[f])):I=this.board.options.precision.hasPoint,C=parseFloat(JXG$1.evaluate(this.visProp.size)),y==="user"&&(C*=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY))),C+=parseFloat(JXG$1.evaluate(this.visProp.strokewidth))*.5,C<I&&(C=I),Math.abs(d[1]-u)<C+2&&Math.abs(d[2]-n)<C+2},update:function(u){return this.needsUpdate?(this.updateCoords(u),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateTransform:function(u){var n,d;if(this.transformations.length===0||this.baseElement===null)return this;for(this===this.baseElement?(n=this.transformations[0].apply(this.baseElement,"self"),this.coords.setCoordinates(Const.COORDS_BY_USER,n)):n=this.transformations[0].apply(this.baseElement),this.coords.setCoordinates(Const.COORDS_BY_USER,n),d=1;d<this.transformations.length;d++)this.coords.setCoordinates(Const.COORDS_BY_USER,this.transformations[d].apply(this));return this},updateRenderer:function(){return this.updateRendererGeneric("updatePoint"),this},bounds:function(){return this.coords.usrCoords.slice(1).concat(this.coords.usrCoords.slice(1))},makeIntersection:function(u,n,d,C){var I;u=this.board.select(u),n=this.board.select(n),I=Geometry.intersectionFunction(this.board,u,n,d,C,this.visProp.alwaysintersect),this.addConstraint([I]);try{u.addChild(this),n.addChild(this)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof u+"' and '"+typeof n+"'.")}this.type=Const.OBJECT_TYPE_INTERSECTION,this.elType="intersection",this.parents=[u.id,n.id,d,C],this.generatePolynomial=function(){var f=u.generatePolynomial(this),y=n.generatePolynomial(this);return f.length===0||y.length===0?[]:[f[0],y[0]]},this.prepareUpdate().update()},setStyle:function(u){var n=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"],d=[2,3,4,1,2,3,4,2,3,4,2,3,4];return this.visProp.face=n[u],this.visProp.size=d[u],this.board.renderer.changePointStyle(this),this},normalizeFace:function(u){return JXG$1.deprecated("Point.normalizeFace()","JXG.normalizePointFace()"),Options.normalizePointFace(u)},face:function(u){JXG$1.deprecated("Point.face()","Point.setAttribute()"),this.setAttribute({face:u})},size:function(u){JXG$1.deprecated("Point.size()","Point.setAttribute()"),this.setAttribute({size:u})},isOn:function(u,n){var d,C;return n=n||Mat.eps,JXG$1.isPoint(u)?this.Dist(u)<n:u.elementClass===Const.OBJECT_CLASS_LINE?u.elType==="segment"&&!JXG$1.evaluate(this.visProp.alwaysintersect)?(d=JXG$1.Math.Geometry.projectCoordsToSegment(this.coords.usrCoords,u.point1.coords.usrCoords,u.point2.coords.usrCoords),d[1]>=0&&d[1]<=1&&Geometry.distPointLine(this.coords.usrCoords,u.stdform)<n):Geometry.distPointLine(this.coords.usrCoords,u.stdform)<n:u.elementClass===Const.OBJECT_CLASS_CIRCLE?JXG$1.evaluate(u.visProp.hasinnerpoints)?this.Dist(u.center)<u.Radius()+n:Math.abs(this.Dist(u.center)-u.Radius())<n:u.elementClass===Const.OBJECT_CLASS_CURVE?(C=Geometry.projectPointToCurve(this,u,this.board)[0],Geometry.distance(this.coords.usrCoords,C.usrCoords,3)<n):u.type===Const.OBJECT_TYPE_POLYGON?JXG$1.evaluate(u.visProp.hasinnerpoints)&&u.pnpoly(this.coords.usrCoords[1],this.coords.usrCoords[2],JXG$1.COORDS_BY_USER)?!0:(d=Geometry.projectCoordsToPolygon(this.coords.usrCoords,u),Geometry.distance(this.coords.usrCoords,d,3)<n):u.type===Const.OBJECT_TYPE_TURTLE?(C=Geometry.projectPointToTurtle(this,u,this.board),Geometry.distance(this.coords.usrCoords,C.usrCoords,3)<n):!1},cloneToBackground:function(){var u={};return u.id=this.id+"T"+this.numTraces,this.numTraces+=1,u.coords=this.coords,u.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),u.visProp.layer=this.board.options.layer.trace,u.elementClass=Const.OBJECT_CLASS_POINT,u.board=this.board,JXG$1.clearVisPropOld(u),u.visPropCalc={visible:JXG$1.evaluate(u.visProp.visible)},this.board.renderer.drawPoint(u),this.traces[u.id]=u.rendNode,this}});JXG$1.createPoint=function(u,n,d){var C,I;if(I=JXG$1.copyAttributes(d,u.options,"point"),C=CoordsElement.create(JXG$1.Point,u,n,I),!C)throw new Error("JSXGraph: Can't create point with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return C};JXG$1.createGlider=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"glider");return n.length===1?I=[0,0]:I=n.slice(0,2),C=u.create("point",I,f),C.makeGlider(n[n.length-1]),C};JXG$1.createIntersectionPoint=function(u,n,d){var C,I,f,y,B,_,Z=JXG$1.copyAttributes(d,u.options,"intersection");n.push(0,0),I=u.select(n[0]),f=u.select(n[1]),B=n[2]||0,_=n[3]||0,C=u.create("point",[0,0,0],Z),y=Geometry.intersectionFunction(u,I,f,B,_,C.visProp.alwaysintersect),C.addConstraint([y]);try{I.addChild(C),f.addChild(C)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'.")}return C.type=Const.OBJECT_TYPE_INTERSECTION,C.elType="intersection",C.setParents([I.id,f.id]),C.intersectionNumbers=[B,_],C.getParents=function(){return this.parents.concat(this.intersectionNumbers)},C.generatePolynomial=function(){var M=I.generatePolynomial(C),V=f.generatePolynomial(C);return M.length===0||V.length===0?[]:[M[0],V[0]]},C};JXG$1.createOtherIntersectionPoint=function(u,n,d){var C,I,f,y,B,_,Z,M=!0,V=JXG$1.copyAttributes(d,u.options,"otherintersection");if(n.length!==3)M=!1;else{for(I=u.select(n[0]),f=u.select(n[1]),JXG$1.isArray(n[2])?B=n[2]:B=[n[2]],y=0;y<B.length;y++)if(B[y]=u.select(B[y]),!JXG$1.isPoint(B[y])){M=!1;break}M&&(Z=[I,f],Z.sort(function(T,H){return H.elementClass-T.elementClass}),([Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE].indexOf(Z[0].elementClass)<0||[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_LINE].indexOf(Z[1].elementClass)<0)&&(M=!1))}if(!M)throw new Error("JSXGraph: Can't create 'other intersection point' with parent types '"+typeof n[0]+"',  '"+typeof n[1]+"'and  '"+typeof n[2]+`'.
Possible parent types: [circle|curve|line,circle|curve|line, point], not two lines`);return C=u.create("point",[0,0,0],V),_=Geometry.otherIntersectionFunction(Z,B,C.visProp.alwaysintersect,C.visProp.precision),C.addConstraint([_]),C.type=Const.OBJECT_TYPE_INTERSECTION,C.elType="otherintersection",C.setParents([I.id,f.id]),C.addParents(B),I.addChild(C),f.addChild(C),I.elementClass===Const.OBJECT_CLASS_CIRCLE&&(C.generatePolynomial=function(){var T=I.generatePolynomial(C),H=f.generatePolynomial(C);return T.length===0||H.length===0?[]:[T[0],H[0]]}),C};JXG$1.createPolePoint=function(u,n,d){var C,I,f,y,B,_,Z;if(n.length>1&&(y=n[0].type===Const.OBJECT_TYPE_CONIC||n[0].elementClass===Const.OBJECT_CLASS_CIRCLE,B=n[1].type===Const.OBJECT_TYPE_CONIC||n[1].elementClass===Const.OBJECT_CLASS_CIRCLE,_=n[0].elementClass===Const.OBJECT_CLASS_LINE,Z=n[1].elementClass===Const.OBJECT_CLASS_LINE),n.length!==2||!(y&&Z||_&&B))throw new Error("JSXGraph: Can't create 'pole point' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent type: [conic|circle,line], [line,conic|circle]`);return Z?(I=u.select(n[0]),f=u.select(n[1])):(I=u.select(n[1]),f=u.select(n[0])),C=u.create("point",[function(){var M=I.quadraticform,V=f.stdform.slice(0,3);return[JXG$1.Math.Numerics.det([V,M[1],M[2]]),JXG$1.Math.Numerics.det([M[0],V,M[2]]),JXG$1.Math.Numerics.det([M[0],M[1],V])]}],d),C.elType="polepoint",C.setParents([I.id,f.id]),I.addChild(C),f.addChild(C),C};JXG$1.registerElement("point",JXG$1.createPoint);JXG$1.registerElement("glider",JXG$1.createGlider);JXG$1.registerElement("intersection",JXG$1.createIntersectionPoint);JXG$1.registerElement("otherintersection",JXG$1.createOtherIntersectionPoint);JXG$1.registerElement("polepoint",JXG$1.createPolePoint);const Point=JXG$1.Point;JXG$1.Line=function(u,n,d,C){this.constructor(u,C,Const.OBJECT_TYPE_LINE,Const.OBJECT_CLASS_LINE),this.point1=this.board.select(n),this.point2=this.board.select(d),this.ticks=[],this.defaultTicks=null,this.parentPolygon=null,this.id=this.board.setId(this,"L"),this.board.renderer.drawLine(this),this.board.finalizeAdding(this),this.elType="line",this.point1._is_new?(this.addChild(this.point1),delete this.point1._is_new):this.point1.addChild(this),this.point2._is_new?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this),this.inherits.push(this.point1,this.point2),this.updateStdform(),this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{point1:"point1",point2:"point2",getSlope:"Slope",Slope:"Slope",Direction:"Direction",getRise:"getRise",Rise:"getRise",getYIntersect:"getRise",YIntersect:"getRise",getAngle:"getAngle",Angle:"getAngle",L:"L",length:"L",setFixedLength:"setFixedLength",setStraight:"setStraight"})};JXG$1.Line.prototype=new GeometryElement;JXG$1.extend(JXG$1.Line.prototype,{hasPoint:function(u,n){var d=[],C=[1,u,n],I,f,y,B,_,Z,M,V,T,H=JXG$1.evaluate(this.visProp.strokewidth);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(T=this.board._inputDevice,V=JXG$1.evaluate(this.visProp.precision[T])):V=this.board.options.precision.hasPoint,V+=H*.5,d[0]=this.stdform[0]-this.stdform[1]*this.board.origin.scrCoords[1]/this.board.unitX+this.stdform[2]*this.board.origin.scrCoords[2]/this.board.unitY,d[1]=this.stdform[1]/this.board.unitX,d[2]=this.stdform[2]/-this.board.unitY,I=Geometry.distPointLine(C,d),isNaN(I)||I>V?!1:JXG$1.evaluate(this.visProp.straightfirst)&&JXG$1.evaluate(this.visProp.straightlast)?!0:(y=this.point1.coords,B=this.point2.coords,f=[0,d[1],d[2]],f=Mat.crossProduct(f,C),f=Mat.crossProduct(f,d),f[1]/=f[0],f[2]/=f[0],f[0]=1,f=new Coords(Const.COORDS_BY_SCREEN,f.slice(1),this.board).usrCoords,_=y.distance(Const.COORDS_BY_USER,B),y=y.usrCoords.slice(0),B=B.usrCoords.slice(0),_<Mat.eps?Z=0:(_===Number.POSITIVE_INFINITY&&(_=1/Mat.eps,Math.abs(B[0])<Mat.eps?(_/=Geometry.distance([0,0,0],B),B=[1,y[1]+B[1]*_,y[2]+B[2]*_]):(_/=Geometry.distance([0,0,0],y),y=[1,B[1]+y[1]*_,B[2]+y[2]*_])),M=1,_=B[M]-y[M],Math.abs(_)<Mat.eps&&(M=2,_=B[M]-y[M]),Z=(f[M]-y[M])/_),!JXG$1.evaluate(this.visProp.straightfirst)&&Z<0?!1:!(!JXG$1.evaluate(this.visProp.straightlast)&&Z>1))},update:function(){var u;return this.needsUpdate?(this.constrained&&(JXG$1.isFunction(this.funps)?(u=this.funps(),u&&u.length&&u.length===2&&(this.point1=u[0],this.point2=u[1])):(JXG$1.isFunction(this.funp1)&&(u=this.funp1(),JXG$1.isPoint(u)?this.point1=u:u&&u.length&&u.length===2&&this.point1.setPositionDirectly(Const.COORDS_BY_USER,u)),JXG$1.isFunction(this.funp2)&&(u=this.funp2(),JXG$1.isPoint(u)?this.point2=u:u&&u.length&&u.length===2&&this.point2.setPositionDirectly(Const.COORDS_BY_USER,u)))),this.updateSegmentFixedLength(),this.updateStdform(),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateSegmentFixedLength:function(){var u,n,d,C,I,f,y,B;return this.hasFixedLength?(u=this.point1.Dist(this.point2),n=JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.fixedLength()):Math.abs(this.fixedLength()),d=this.fixedLengthOldCoords[0].distance(Const.COORDS_BY_USER,this.point1.coords),C=this.fixedLengthOldCoords[1].distance(Const.COORDS_BY_USER,this.point2.coords),(d>Mat.eps||C>Mat.eps||u!==n)&&(I=this.point1.isDraggable&&this.point1.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point1.visProp.fixed),f=this.point2.isDraggable&&this.point2.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point2.visProp.fixed),u>Mat.eps?d>C&&f||d<=C&&f&&!I?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+(this.point2.X()-this.point1.X())*n/u,this.point1.Y()+(this.point2.Y()-this.point1.Y())*n/u]),this.point2.fullUpdate()):(d<=C&&I||d>C&&I&&!f)&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+(this.point1.X()-this.point2.X())*n/u,this.point2.Y()+(this.point1.Y()-this.point2.Y())*n/u]),this.point1.fullUpdate()):(y=Math.random()-.5,B=Math.random()-.5,u=Mat.hypot(y,B),f?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+y*n/u,this.point1.Y()+B*n/u]),this.point2.fullUpdate()):I&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+y*n/u,this.point2.Y()+B*n/u]),this.point1.fullUpdate())),this.fixedLengthOldCoords[0].setCoordinates(Const.COORDS_BY_USER,this.point1.coords.usrCoords),this.fixedLengthOldCoords[1].setCoordinates(Const.COORDS_BY_USER,this.point2.coords.usrCoords)),this):this},updateStdform:function(){var u=Mat.crossProduct(this.point1.coords.usrCoords,this.point2.coords.usrCoords);this.stdform[0]=u[0],this.stdform[1]=u[1],this.stdform[2]=u[2],this.stdform[3]=0,this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.point1.coords.usrCoords[1]+this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[1]+this.point2.coords.usrCoords[2])&&Mat.innerProduct(this.stdform,this.stdform,3)>=Mat.eps*Mat.eps,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateLine(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},generatePolynomial:function(u){var n=this.point1.symbolic.x,d=this.point1.symbolic.y,C=this.point2.symbolic.x,I=this.point2.symbolic.y,f=u.symbolic.x,y=u.symbolic.y;return[["(",d,")*(",f,")-(",d,")*(",C,")+(",y,")*(",C,")-(",n,")*(",y,")+(",n,")*(",I,")-(",f,")*(",I,")"].join("")]},getRise:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[0]/this.stdform[2]:1/0},Slope:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[1]/this.stdform[2]:1/0},getSlope:function(){return this.Slope()},getAngle:function(){return Math.atan2(-this.stdform[1],this.stdform[2])},Direction:function(){var u=this.point1.coords.usrCoords,n=this.point2.coords.usrCoords;return n[0]===0&&u[0]!==0?n.slice(1):u[0]===0&&n[0]!==0?[-u[1],-u[2]]:[n[1]-u[1],n[2]-u[2]]},isVertical:function(){var u=this.Direction();return u[0]===0&&u[1]!==0},isHorizontal:function(){var u=this.Direction();return u[1]===0&&u[0]!==0},setStraight:function(u,n){return this.visProp.straightfirst=u,this.visProp.straightlast=n,this.board.renderer.updateLine(this),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[.5*(this.point2.X()+this.point1.X()),.5*(this.point2.Y()+this.point1.Y())],this.board)},setLabelRelativeCoords:function(u){JXG$1.exists(this.label)&&(this.label.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,[u[0],-u[1]],this.board))},getLabelAnchor:function(){var u,n,d,C,I,f,y,B,_=1.5,Z=0,M=new Coords(Const.COORDS_BY_USER,this.point1.coords.usrCoords,this.board),V=new Coords(Const.COORDS_BY_USER,this.point2.coords.usrCoords,this.board),T=JXG$1.evaluate(this.visProp.straightfirst),H=JXG$1.evaluate(this.visProp.straightlast);if((T||H)&&Geometry.calcStraight(this,M,V,0),M=M.scrCoords,V=V.scrCoords,!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(d))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d.indexOf("right")<0&&d.indexOf("left")<0)switch(d){case"last":u=V[1],n=V[2];break;case"first":u=M[1],n=M[2];break;case"lft":case"llft":case"ulft":M[1]<V[1]+Mat.eps?(u=M[1],n=M[2]):(u=V[1],n=V[2]);break;case"rt":case"lrt":case"urt":M[1]>V[1]+Mat.eps?(u=M[1],n=M[2]):(u=V[1],n=V[2]);break;default:u=.5*(M[1]+V[1]),n=.5*(M[2]+V[2])}else C=JXG$1.parsePosition(d),I=JXG$1.parseNumber(C.pos,1,1),f=V[1]-M[1],y=V[2]-M[2],B=Mat.hypot(f,y),C.pos.indexOf("px")>=0||C.pos.indexOf("fr")>=0||C.pos.indexOf("%")>=0?(C.pos.indexOf("px")>=0&&(I/=B),u=M[1]+I*f,n=M[2]+I*y):(u=M[1]+I*this.board.unitX*f/B,n=M[2]+I*this.board.unitY*y/B),C.side==="left"?f*=-1:y*=-1,JXG$1.exists(this.label)&&(_=.5*JXG$1.evaluate(this.label.visProp.distance)/B),u+=y*this.label.size[0]*_,n+=f*this.label.size[1]*_;return(T||H)&&(JXG$1.exists(this.label)&&(Z=JXG$1.evaluate(this.label.visProp.fontsize)),Math.abs(u)<Mat.eps?u=Z:this.board.canvasWidth+Mat.eps>u&&u>this.board.canvasWidth-Z-Mat.eps&&(u=this.board.canvasWidth-Z),Mat.eps+Z>n&&n>-Mat.eps?n=Z:this.board.canvasHeight+Mat.eps>n&&n>this.board.canvasHeight-Z-Mat.eps&&(n=this.board.canvasHeight-Z)),new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board)},cloneToBackground:function(){var u={},n,d,C;return u.id=this.id+"T"+this.numTraces,u.elementClass=Const.OBJECT_CLASS_LINE,this.numTraces++,u.point1=this.point1,u.point2=this.point2,u.stdform=this.stdform,u.board=this.board,u.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),u.visProp.layer=this.board.options.layer.trace,JXG$1.clearVisPropOld(u),u.visPropCalc={visible:JXG$1.evaluate(u.visProp.visible)},d=this.getSlope(),n=this.getRise(),u.getSlope=function(){return d},u.getRise=function(){return n},C=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawLine(u),this.board.renderer.enhancedRendering=C,this.traces[u.id]=u.rendNode,this},addTransform:function(u){var n,d=JXG$1.isArray(u)?u:[u],C=d.length;for(n=0;n<C;n++)this.point1.transformations.push(d[n]),this.point2.transformations.push(d[n]);return this},snapToGrid:function(u){var n,d,C,I,f,y,B,_,Z;return JXG$1.evaluate(this.visProp.snaptogrid)?this.parents.length<3?(this.point1.handleSnapToGrid(!0,!0),this.point2.handleSnapToGrid(!0,!0)):JXG$1.exists(u)&&(_=JXG$1.evaluate(this.visProp.snapsizex),Z=JXG$1.evaluate(this.visProp.snapsizey),n=new Coords(Const.COORDS_BY_SCREEN,[u.Xprev,u.Yprev],this.board),y=n.usrCoords[1],B=n.usrCoords[2],_<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(f=this.board.defaultAxes.x.defaultTicks,_=f.ticksDelta*(JXG$1.evaluate(f.visProp.minorticks)+1)),Z<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(f=this.board.defaultAxes.y.defaultTicks,Z=f.ticksDelta*(JXG$1.evaluate(f.visProp.minorticks)+1)),_>0&&Z>0&&(d=Geometry.projectPointToLine({coords:n},this,this.board),C=Statistics.subtract([1,Math.round(y/_)*_,Math.round(B/Z)*Z],d.usrCoords),I=this.board.create("transform",C.slice(1),{type:"translate"}),I.applyOnce([this.point1,this.point2]))):(this.point1.handleSnapToGrid(!1,!0),this.point2.handleSnapToGrid(!1,!0)),this},snapToPoints:function(){var u=JXG$1.evaluate(this.visProp.snaptopoints);return this.parents.length<3&&(this.point1.handleSnapToPoints(u),this.point2.handleSnapToPoints(u)),this},X:function(u){var n,d=this.stdform[2];return n=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[1]:this.point2.coords.usrCoords[1],u=(u-.5)*2,(1-Math.abs(u))*n-u*d},Y:function(u){var n,d=this.stdform[1];return n=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[2]:this.point2.coords.usrCoords[2],u=(u-.5)*2,(1-Math.abs(u))*n+u*d},Z:function(u){var n=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[0]:this.point2.coords.usrCoords[0];return u=(u-.5)*2,(1-Math.abs(u))*n},L:function(){return this.point1.Dist(this.point2)},setFixedLength:function(u){return this.hasFixedLength?(this.fixedLength=JXG$1.createFunction(u,this.board),this.hasFixedLength=!0,this.addParentsFromJCFunctions([this.fixedLength]),this.board.update(),this):this},minX:function(){return 0},maxX:function(){return 1},bounds:function(){var u=this.point1.coords.usrCoords,n=this.point2.coords.usrCoords;return[Math.min(u[1],n[1]),Math.max(u[2],n[2]),Math.max(u[1],n[1]),Math.min(u[2],n[2])]},remove:function(){this.removeAllTicks(),GeometryElement.prototype.remove.call(this)}});JXG$1.createLine=function(u,n,d){var C,I,f,y,B,_,Z=[],M=!1,V=!1,T;if(n.length===2){if(_=JXG$1.copyAttributes(d,u.options,"line","point1"),JXG$1.isArray(n[0])&&n[0].length>1)f=u.create("point",n[0],_);else if(JXG$1.isString(n[0])||JXG$1.isPoint(n[0]))f=u.select(n[0]);else if(JXG$1.isFunction(n[0])&&JXG$1.isPoint(n[0]()))f=n[0](),V=!0;else if(JXG$1.isFunction(n[0])&&n[0]().length&&n[0]().length>=2)f=JXG$1.createPoint(u,n[0](),_),V=!0;else if(JXG$1.isObject(n[0])&&JXG$1.isTransformationOrArray(n[1]))M=!0,f=u.create("point",[n[0].point1,n[1]],_);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);if(_=JXG$1.copyAttributes(d,u.options,"line","point2"),M)y=u.create("point",[n[0].point2,n[1]],_);else if(JXG$1.isArray(n[1])&&n[1].length>1)y=u.create("point",n[1],_);else if(JXG$1.isString(n[1])||JXG$1.isPoint(n[1]))y=u.select(n[1]);else if(JXG$1.isFunction(n[1])&&JXG$1.isPoint(n[1]()))y=n[1](),V=!0;else if(JXG$1.isFunction(n[1])&&n[1]().length&&n[1]().length>=2)y=JXG$1.createPoint(u,n[1](),_),V=!0;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);_=JXG$1.copyAttributes(d,u.options,"line"),I=new JXG$1.Line(u,f,y,_),V?(I.constrained=!0,I.funp1=n[0],I.funp2=n[1]):M||(I.isDraggable=!0),I.setParents([f.id,y.id])}else if(n.length===3){for(T=!0,B=0;B<3;B++)if(JXG$1.isNumber(n[B]))Z[B]=JXG$1.createFunction(n[B]);else if(JXG$1.isFunction(n[B]))Z[B]=n[B],T=!1;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);_=JXG$1.copyAttributes(d,u.options,"line","point1"),T?f=u.create("point",[Z[2]()*Z[2]()+Z[1]()*Z[1](),Z[2]()-Z[1]()*Z[0]()+Z[2](),-Z[1]()-Z[2]()*Z[0]()-Z[1]()],_):f=u.create("point",[function(){return(Z[2]()*Z[2]()+Z[1]()*Z[1]())*.5},function(){return(Z[2]()-Z[1]()*Z[0]()+Z[2]())*.5},function(){return(-Z[1]()-Z[2]()*Z[0]()-Z[1]())*.5}],_),_=JXG$1.copyAttributes(d,u.options,"line","point2"),T?y=u.create("point",[Z[2]()*Z[2]()+Z[1]()*Z[1](),-Z[1]()*Z[0]()+Z[2](),-Z[2]()*Z[0]()-Z[1]()],_):y=u.create("point",[function(){return Z[2]()*Z[2]()+Z[1]()*Z[1]()},function(){return-Z[1]()*Z[0]()+Z[2]()},function(){return-Z[2]()*Z[0]()-Z[1]()}],_),f.prepareUpdate().update(),y.prepareUpdate().update(),_=JXG$1.copyAttributes(d,u.options,"line"),I=new JXG$1.Line(u,f,y,_),I.isDraggable=T,I.setParents([f,y])}else if(n.length===1&&JXG$1.isFunction(n[0])&&n[0]().length===2&&JXG$1.isPoint(n[0]()[0])&&JXG$1.isPoint(n[0]()[1]))C=n[0](),_=JXG$1.copyAttributes(d,u.options,"line"),I=new JXG$1.Line(u,C[0],C[1],_),I.constrained=!0,I.funps=n[0],I.setParents(C);else if(n.length===1&&JXG$1.isFunction(n[0])&&n[0]().length===3&&JXG$1.isNumber(n[0]()[0])&&JXG$1.isNumber(n[0]()[1])&&JXG$1.isNumber(n[0]()[2]))C=n[0],_=JXG$1.copyAttributes(d,u.options,"line","point1"),f=u.create("point",[function(){var H=C();return[(H[2]*H[2]+H[1]*H[1])*.5,(H[2]-H[1]*H[0]+H[2])*.5,(-H[1]-H[2]*H[0]-H[1])*.5]}],_),_=JXG$1.copyAttributes(d,u.options,"line","point2"),y=u.create("point",[function(){var H=C();return[H[2]*H[2]+H[1]*H[1],-H[1]*H[0]+H[2],-H[2]*H[0]-H[1]]}],_),_=JXG$1.copyAttributes(d,u.options,"line"),I=new JXG$1.Line(u,f,y,_),I.constrained=!0,I.funps=n[0],I.setParents([f,y]);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);return I};JXG$1.registerElement("line",JXG$1.createLine);JXG$1.createSegment=function(u,n,d){var C,I;if(d.straightFirst=!1,d.straightLast=!1,I=JXG$1.copyAttributes(d,u.options,"segment"),C=u.create("line",n.slice(0,2),I),n.length===3){try{C.hasFixedLength=!0,C.fixedLengthOldCoords=[],C.fixedLengthOldCoords[0]=new Coords(Const.COORDS_BY_USER,C.point1.coords.usrCoords.slice(1,3),u),C.fixedLengthOldCoords[1]=new Coords(Const.COORDS_BY_USER,C.point2.coords.usrCoords.slice(1,3),u),C.setFixedLength(n[2])}catch{throw new Error("JSXGraph: Can't create segment with third parent type '"+typeof n[2]+`'.
Possible third parent types: number or function`)}C.getParents=function(){return this.parents.concat(this.fixedLength())}}return C.elType="segment",C};JXG$1.registerElement("segment",JXG$1.createSegment);JXG$1.createArrow=function(u,n,d){var C,I;return d.straightFirst=!1,d.straightLast=!1,I=JXG$1.copyAttributes(d,u.options,"arrow"),C=u.create("line",n,I),C.type=Const.OBJECT_TYPE_VECTOR,C.elType="arrow",C};JXG$1.registerElement("arrow",JXG$1.createArrow);JXG$1.createAxis=function(u,n,d){var C,I,f,y;I=JXG$1.copyAttributes(d,u.options,"axis");try{C=u.create("line",n,I)}catch{throw new Error("JSXGraph: Can't create axis with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}C.type=Const.OBJECT_TYPE_AXIS,C.isDraggable=!1,C.point1.isDraggable=!1,C.point2.isDraggable=!1,C._point1UsrCoordsOrg=C.point1.coords.usrCoords.slice(),C._point2UsrCoordsOrg=C.point2.coords.usrCoords.slice();for(f in C.ancestors)C.ancestors.hasOwnProperty(f)&&(C.ancestors[f].type=Const.OBJECT_TYPE_AXISPOINT);return JXG$1.exists(I.ticks.ticksdistance)?y=I.ticks.ticksdistance:JXG$1.isArray(I.ticks.ticks)?y=I.ticks.ticks:y=1,C.defaultTicks=u.create("ticks",[C,y],I.ticks),C.defaultTicks.dump=!1,C.elType="axis",C.subs={ticks:C.defaultTicks},C.inherits.push(C.defaultTicks),C.update=function(){var B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge;if(B=this.board.getBoundingBox(),_=JXG$1.evaluate(this.visProp.position),M=this.Direction(),V=this.isHorizontal(),T=this.isVertical(),H=JXG$1.evaluate(this.visProp.ticksautopos),F=JXG$1.evaluate(this.visProp.ticksautoposthreshold),V?F=JXG$1.parseNumber(F,Math.abs(B[1]-B[3]),1/this.board.unitX)*this.board.unitX:T?F=JXG$1.parseNumber(F,Math.abs(B[1]-B[3]),1/this.board.unitY)*this.board.unitY:F=JXG$1.parseNumber(F,1,1),$=JXG$1.evaluate(this.visProp.anchor),U=$.indexOf("left")>-1,ee=$.indexOf("right")>-1,Q=JXG$1.evaluate(this.visProp.anchordist),V?Q=JXG$1.parseNumber(Q,Math.abs(B[1]-B[3]),1/this.board.unitX):T?Q=JXG$1.parseNumber(Q,Math.abs(B[0]-B[2]),1/this.board.unitY):Q=0,le=this.board.getPointLoc(this._point1UsrCoordsOrg,Q),ie=this.point1.coords.usrCoords.slice(),ne=this.point2.coords.usrCoords.slice(),_==="static"||!T&&!V||(_==="fixed"?(V&&(M[0]>0&&ee||M[0]<0&&U?(ie[2]=B[3]+Q,ne[2]=B[3]+Q):M[0]>0&&U||M[0]<0&&ee?(ie[2]=B[1]-Q,ne[2]=B[1]-Q):(ie=this._point1UsrCoordsOrg.slice(),ne=this._point2UsrCoordsOrg.slice())),T&&(M[1]>0&&U||M[1]<0&&ee?(ie[1]=B[0]+Q,ne[1]=B[0]+Q):M[1]>0&&ee||M[1]<0&&U?(ie[1]=B[2]-Q,ne[1]=B[2]-Q):(ie=this._point1UsrCoordsOrg.slice(),ne=this._point2UsrCoordsOrg.slice()))):_==="sticky"&&(V&&(le[1]<0&&(M[0]>0&&ee||M[0]<0&&U)?(ie[2]=B[3]+Q,ne[2]=B[3]+Q):le[1]>0&&(M[0]>0&&U||M[0]<0&&ee)?(ie[2]=B[1]-Q,ne[2]=B[1]-Q):(ie=this._point1UsrCoordsOrg.slice(),ne=this._point2UsrCoordsOrg.slice())),T&&(le[0]<0&&(M[1]>0&&U||M[1]<0&&ee)?(ie[1]=B[0]+Q,ne[1]=B[0]+Q):le[0]>0&&(M[1]>0&&ee||M[1]<0&&U)?(ie[1]=B[2]-Q,ne[1]=B[2]-Q):(ie=this._point1UsrCoordsOrg.slice(),ne=this._point2UsrCoordsOrg.slice())))),this.point1.setPositionDirectly(JXG$1.COORDS_BY_USER,ie),this.point2.setPositionDirectly(JXG$1.COORDS_BY_USER,ne),JXG$1.exists(this.defaultTicks)){if(ae=this.defaultTicks.visProp.label,H&&(V||T)){if(JXG$1.exists(ae._anchorx_org)||(ae._anchorx_org=JXG$1.def(ae.anchorx,this.board.options.text.anchorX)),JXG$1.exists(ae._anchory_org)||(ae._anchory_org=JXG$1.def(ae.anchory,this.board.options.text.anchorY)),JXG$1.exists(ae._offset_org)||(ae._offset_org=ae.offset.slice()),ge=ae.offset,V){for(O=C.point1.coords.scrCoords[2]-this.board.canvasHeight*.5,ce=ae.anchory,O<0&&Math.abs(O)>F?ae._side==="bottom"&&(ae.anchory==="top"&&(ce="bottom"),ge[1]*=-1,ae._side="top"):O>0&&Math.abs(O)>F?ae._side==="top"&&(ae.anchory==="bottom"&&(ce="top"),ge[1]*=-1,ae._side="bottom"):(ce=ae._anchory_org,ge=ae._offset_org.slice(),ce==="top"?ae._side="bottom":ce==="bottom"?ae._side="top":ge[1]<0?ae._side="bottom":ae._side="top"),Z=0;Z<C.defaultTicks.labels.length;Z++)this.defaultTicks.labels[Z].visProp.anchory=ce;ae.anchory=ce}else if(T){for(O=C.point1.coords.scrCoords[1]-this.board.canvasWidth*.5,O<0&&Math.abs(O)>F?ae._side==="right"&&(ae.anchorx==="left"&&(ce="right"),ge[0]*=-1,ae._side="left"):O>0&&Math.abs(O)>F?ae._side==="left"&&(ae.anchorx==="right"&&(ce="left"),ge[0]*=-1,ae._side="right"):(ce=ae._anchorx_org,ge=ae._offset_org.slice(),ce==="left"?ae._side="right":ce==="right"||ge[0]<0?ae._side="left":ae._side="right"),Z=0;Z<C.defaultTicks.labels.length;Z++)this.defaultTicks.labels[Z].visProp.anchorx=ce;ae.anchorx=ce}ae.offset=ge}else delete ae._anchorx_org,delete ae._anchory_org,delete ae._offset_org;this.defaultTicks.needsUpdate=!0}return JXG$1.Line.prototype.update.call(this),this},C};JXG$1.registerElement("axis",JXG$1.createAxis);JXG$1.createTangent=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T=[];if(n.length===1)C=n[0],I=C.slideObject;else if(n.length===2)if(JXG$1.isPoint(n[0]))C=n[0],I=n[1];else if(JXG$1.isPoint(n[1]))I=n[0],C=n[1];else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);if(_=JXG$1.copyAttributes(d,u.options,"tangent"),I.elementClass===Const.OBJECT_CLASS_LINE)B=u.create("line",[I.point1,I.point2],_),B.glider=C;else if(I.elementClass===Const.OBJECT_CLASS_CURVE&&I.type!==Const.OBJECT_TYPE_CONIC){if(M=I.getTransformationSource(),V=M[0],V)for(T.push(I);M[0]&&JXG$1.exists(M[1]._transformationSource);)T.push(M[1]),M=M[1].getTransformationSource();JXG$1.evaluate(I.visProp.curvetype)!=="plot"||V?(B=u.create("line",[function(){var H=I.X,F=I.Y,O,$,U,ee,Q,ie,ne,le;if(C.type===Const.OBJECT_TYPE_GLIDER?le=C.position:JXG$1.evaluate(I.visProp.curvetype)==="functiongraph"?le=C.X():le=Geometry.projectPointToCurve(C,I,u)[1],ne=C.Coords(!0),V){for(Q=T[T.length-1]._transformationSource,H=Q.X,F=Q.Y,ee=0;ee<T.length;ee++)T[ee].updateTransformMatrix(),ie=Mat.inverse(T[ee].transformMat),ne=Mat.matVecMult(ie,ne);C.type!==Const.OBJECT_TYPE_GLIDER&&(ne[1]/=ne[0],ne[2]/=ne[0],ne[0]/=ne[0],le=Geometry.projectCoordsToCurve(ne[1],ne[2],0,Q,u)[1])}if(O=Numerics.D(F)(le),$=Numerics.D(H)(le),U=[-ne[1]*O+ne[2]*$,ne[0]*O,-ne[0]*$],V)for(ee=T.length-1;ee>=0;ee--)ie=Mat.transpose(Mat.inverse(T[ee].transformMat)),U=Mat.matVecMult(ie,U);return U}],_),C.addChild(B),B.glider=C):(Z=function(H,F,O){var $=Math.floor(H),U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe;if(F.bezierDegree===1)$===F.numberPoints-1&&$--;else if(F.bezierDegree===3)F.elType==="sector"?(Ie=F.points.slice(3,F.numberPoints-3),fe=Ie.length):(Ie=F.points,fe=Ie.length),$=Math.floor(H*(fe-1)/3)*3,Q=(H*(fe-1)-$)/3,$>=fe-1&&($=fe-4,Q=1);else return 0;if($<0)return 1;switch(F.bezierDegree===1?(U=F.points[$].usrCoords,ee=F.points[$+1].usrCoords):(ie=Ie[$].usrCoords,ne=Ie[$+1].usrCoords,le=Ie[$+2].usrCoords,ae=Ie[$+3].usrCoords,ce=(1-Q)*(1-Q)*(ne[1]-ie[1])+2*(1-Q)*Q*(le[1]-ne[1])+Q*Q*(ae[1]-le[1]),ge=(1-Q)*(1-Q)*(ne[2]-ie[2])+2*(1-Q)*Q*(le[2]-ne[2])+Q*Q*(ae[2]-le[2]),he=Mat.hypot(ce,ge),ce/=he,ge/=he,U=C.coords.usrCoords,ee=[1,U[1]+ce,U[2]+ge]),O){case 0:return U[2]*ee[1]-U[1]*ee[2];case 1:return ee[2]-U[2];case 2:return U[1]-ee[1];default:return[U[2]*ee[1]-U[1]*ee[2],ee[2]-U[2],U[1]-ee[1]]}},B=u.create("line",[function(){var H;return C.type===Const.OBJECT_TYPE_GLIDER?H=C.position:H=Geometry.projectPointToCurve(C,I,u)[1],Z(H,I)}],_),C.addChild(B),B.glider=C)}else I.type===Const.OBJECT_TYPE_TURTLE?(B=u.create("line",[function(){var H,F;for(C.type===Const.OBJECT_TYPE_GLIDER?F=C.position:F=Geometry.projectPointToTurtle(C,I,u)[1],H=Math.floor(F),f=0;f<I.objects.length;f++)if(y=I.objects[f],y.type===Const.OBJECT_TYPE_CURVE){if(H<y.numberPoints)break;H-=y.numberPoints}return H===y.numberPoints-1&&H--,H<0?[1,0,0]:[y.Y(H)*y.X(H+1)-y.X(H)*y.Y(H+1),y.Y(H+1)-y.Y(H),y.X(H)-y.X(H+1)]}],_),C.addChild(B),B.glider=C):(I.elementClass===Const.OBJECT_CLASS_CIRCLE||I.type===Const.OBJECT_TYPE_CONIC)&&(B=u.create("line",[function(){return Mat.matVecMult(I.quadraticform,C.coords.usrCoords)}],_),C.addChild(B),B.glider=C);if(!JXG$1.exists(B))throw new Error("JSXGraph: Couldn't create tangent with the given parents.");return B.elType="tangent",B.type=Const.OBJECT_TYPE_TANGENT,B.setParents(n),B};JXG$1.createNormal=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H=[];for(y=0;y<n.length;++y)n[y]=u.select(n[y]);if(n.length===1)C=n[0],I=C.slideObject;else if(n.length===2)if(JXG$1.isPointType(u,n[0]))C=JXG$1.providePoints(u,[n[0]],d,"point")[0],I=n[1];else if(JXG$1.isPointType(u,n[1]))I=n[0],C=JXG$1.providePoints(u,[n[1]],d,"point")[0];else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);if(B=JXG$1.copyAttributes(d,u.options,"normal"),I.elementClass===Const.OBJECT_CLASS_LINE)Z=JXG$1.copyAttributes(d,u.options,"normal","point"),_=u.create("point",[function(){var F=Mat.crossProduct([1,0,0],I.stdform);return[F[0],-F[2],F[1]]}],Z),_.isDraggable=!0,f=u.create("line",[C,_],B),f.point=_,f.subs={point:_},f.inherits.push(_);else if(I.elementClass===Const.OBJECT_CLASS_CIRCLE)f=u.create("line",[I.midpoint,C],B);else if(I.elementClass===Const.OBJECT_CLASS_CURVE){if(V=I.getTransformationSource(),T=V[0],T)for(H.push(I);V[0]&&JXG$1.exists(V[1]._transformationSource);)H.push(V[1]),V=V[1].getTransformationSource();JXG$1.evaluate(I.visProp.curvetype)!=="plot"||T?f=u.create("line",[function(){var F=I.X,O=I.Y,$,U,ee,Q,ie,ne,le,ae;if(C.type===Const.OBJECT_TYPE_GLIDER?ae=C.position:JXG$1.evaluate(I.visProp.curvetype)==="functiongraph"?ae=C.X():ae=Geometry.projectPointToCurve(C,I,u)[1],le=C.Coords(!0),T){for(ie=H[H.length-1]._transformationSource,F=ie.X,O=ie.Y,Q=0;Q<H.length;Q++)H[Q].updateTransformMatrix(),ne=Mat.inverse(H[Q].transformMat),le=Mat.matVecMult(ne,le);C.type!==Const.OBJECT_TYPE_GLIDER&&(le[1]/=le[0],le[2]/=le[0],le[0]/=le[0],ae=Geometry.projectCoordsToCurve(le[1],le[2],0,ie,u)[1])}if($=Numerics.D(O)(ae),U=Numerics.D(F)(ae),ee=[-le[1]*U-le[2]*$,le[0]*U,le[0]*$],T)for(Q=H.length-1;Q>=0;Q--)ne=Mat.transpose(Mat.inverse(H[Q].transformMat)),ee=Mat.matVecMult(ne,ee);return ee}],B):(M=function(F,O,$){var U=Math.floor(F),ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze,ye,Ee;if(O.bezierDegree===1)U===O.numberPoints-1&&U--,ne=F;else if(O.bezierDegree===3)O.elType==="sector"?(ye=O.points.slice(3,O.numberPoints-3),Ee=ye.length):(ye=O.points,Ee=ye.length),U=Math.floor(F*(Ee-1)/3)*3,ne=(F*(Ee-1)-U)/3,U>=Ee-1&&(U=Ee-4,ne=1);else return 0;if(U<0)return 1;switch(ee=ne-U,O.bezierDegree===1?(Q=O.points[U].usrCoords,ie=O.points[U+1].usrCoords,Ge=[Q[0]+ee*(ie[0]-Q[0]),Q[1]+ee*(ie[1]-Q[1]),Q[2]+ee*(ie[2]-Q[2])],me=Mat.crossProduct(Q,ie),Ze=Mat.crossProduct([1,0,0],me),Ze=[Ze[0],-Ze[2],Ze[1]],me=Mat.crossProduct(Ge,Ze)):(le=ye[U].usrCoords,ae=ye[U+1].usrCoords,ce=ye[U+2].usrCoords,ge=ye[U+3].usrCoords,he=(1-ne)*(1-ne)*(ae[1]-le[1])+2*(1-ne)*ne*(ce[1]-ae[1])+ne*ne*(ge[1]-ce[1]),Ie=(1-ne)*(1-ne)*(ae[2]-le[2])+2*(1-ne)*ne*(ce[2]-ae[2])+ne*ne*(ge[2]-ce[2]),fe=Mat.hypot(he,Ie),he/=fe,Ie/=fe,Q=C.coords.usrCoords,ie=[1,Q[1]-Ie,Q[2]+he],me=[Q[2]*ie[1]-Q[1]*ie[2],ie[2]-Q[2],Q[1]-ie[1]]),$){case 0:return me[0];case 1:return me[1];case 2:return me[2];default:return me}},f=u.create("line",[function(){var F;return C.type===Const.OBJECT_TYPE_GLIDER?F=C.position:F=Geometry.projectPointToCurve(C,I,u)[1],M(F,I)}],B),C.addChild(f),f.glider=C)}else if(I.type===Const.OBJECT_TYPE_TURTLE)f=u.create("line",[function(){var F,O,$=Math.floor(C.position),U=C.position-$;for(O=0;O<I.objects.length;O++)if(F=I.objects[O],F.type===Const.OBJECT_TYPE_CURVE){if($<F.numberPoints)break;$-=F.numberPoints}return $===F.numberPoints-1&&($-=1,U=1),$<0?1:(F.Y($)+U*(F.Y($+1)-F.Y($)))*(F.Y($)-F.Y($+1))-(F.X($)+U*(F.X($+1)-F.X($)))*(F.X($+1)-F.X($))},function(){var F,O,$=Math.floor(C.position);for(O=0;O<I.objects.length;O++)if(F=I.objects[O],F.type===Const.OBJECT_TYPE_CURVE){if($<F.numberPoints)break;$-=F.numberPoints}return $===F.numberPoints-1&&($-=1),$<0?0:F.X($+1)-F.X($)},function(){var F,O,$=Math.floor(C.position);for(O=0;O<I.objects.length;O++)if(F=I.objects[O],F.type===Const.OBJECT_TYPE_CURVE){if($<F.numberPoints)break;$-=F.numberPoints}return $===F.numberPoints-1&&($-=1),$<0?0:F.Y($+1)-F.Y($)}],B);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);return f.elType="normal",f.setParents(n),JXG$1.exists(C._is_new)?(f.addChild(C),delete C._is_new):C.addChild(f),I.addChild(f),f};JXG$1.createRadicalAxis=function(u,n,d){var C,I,f;if(n.length!==2||n[0].elementClass!==Const.OBJECT_CLASS_CIRCLE||n[1].elementClass!==Const.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create 'radical axis' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent type: [circle,circle]`);return I=u.select(n[0]),f=u.select(n[1]),C=u.create("line",[function(){var y=I.stdform,B=f.stdform;return Mat.matVecMult(Mat.transpose([y.slice(0,3),B.slice(0,3)]),[B[3],-y[3]])}],d),C.elType="radicalaxis",C.setParents([I.id,f.id]),I.addChild(C),f.addChild(C),C};JXG$1.createPolarLine=function(u,n,d){var C,I,f,y,B,_,Z;if(n.length>1&&(y=n[0].type===Const.OBJECT_TYPE_CONIC||n[0].elementClass===Const.OBJECT_CLASS_CIRCLE,B=n[1].type===Const.OBJECT_TYPE_CONIC||n[1].elementClass===Const.OBJECT_CLASS_CIRCLE,_=JXG$1.isPoint(n[0]),Z=JXG$1.isPoint(n[1])),n.length!==2||!(y&&Z||_&&B))throw new Error("JSXGraph: Can't create 'polar line' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent type: [conic|circle,point], [point,conic|circle]`);return Z?(I=u.select(n[0]),f=u.select(n[1])):(I=u.select(n[1]),f=u.select(n[0])),C=u.create("tangent",[I,f],d),C.elType="polarline",C};JXG$1.createTangentTo=function(u,n,d){var C,I,f,y,B,_,Z;if(f=u.select(n[0]),y=JXG$1.providePoints(u,n[1],d,"point")[0],B=JXG$1.def(n[2],0),f.type!==Const.OBJECT_TYPE_CIRCLE&&f.type!==Const.OBJECT_TYPE_CONIC||y.elementClass!==Const.OBJECT_CLASS_POINT)throw new Error("JSXGraph: Can't create tangentto with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [circle|conic,point,number]`);return I=JXG$1.copyAttributes(d,u.options,"tangentto"),Z=u.create("polar",[f,y],I.polar),_=u.create("intersection",[Z,f,B],I.point),C=u.create("tangent",[f,_],I),C.point=_,C.polar=Z,C.elType="tangentto",C};JXG$1.registerElement("tangent",JXG$1.createTangent);JXG$1.registerElement("normal",JXG$1.createNormal);JXG$1.registerElement("tangentto",JXG$1.createTangentTo);JXG$1.registerElement("polar",JXG$1.createTangent);JXG$1.registerElement("radicalaxis",JXG$1.createRadicalAxis);JXG$1.registerElement("polarline",JXG$1.createPolarLine);JXG$1.Line;JXG$1.Group=function(u,n,d,C,I){var f,y,B,_;for(this.board=u,this.objects={},f=this.board.numObjects,this.board.numObjects+=1,n===""||!JXG$1.exists(n)?this.id=this.board.id+"Group"+f:this.id=n,this.board.groups[this.id]=this,this.type=Const.OBJECT_TYPE_POINT,this.elementClass=Const.OBJECT_CLASS_POINT,d===""||!JXG$1.exists(d)?this.name="group_"+this.board.generateName(this):this.name=d,delete this.type,this.coords={},this.needsRegularUpdate=I.needsregularupdate,this.rotationCenter="centroid",this.scaleCenter=null,this.rotationPoints=[],this.translationPoints=[],this.scalePoints=[],this.scaleDirections={},this.parents=[],JXG$1.isArray(C)?y=C:y=Array.prototype.slice.call(arguments,3),B=0;B<y.length;B++)_=this.board.select(y[B]),!JXG$1.evaluate(_.visProp.fixed)&&JXG$1.exists(_.coords)&&this.addPoint(_);this.methodMap={ungroup:"ungroup",add:"addPoint",addPoint:"addPoint",addPoints:"addPoints",addGroup:"addGroup",remove:"removePoint",removePoint:"removePoint",setAttribute:"setAttribute",setProperty:"setAttribute"}};JXG$1.extend(JXG$1.Group.prototype,{ungroup:function(){var u,n,d;for(u in this.objects)this.objects.hasOwnProperty(u)&&(n=this.objects[u].point,JXG$1.isArray(n.groups)&&(d=JXG$1.indexOf(n.groups,this.id),d>=0&&delete n.groups[d]));return this.objects={},this},addParents:function(u){var n,d,C;for(JXG$1.isArray(u)?C=u:C=arguments,d=C.length,n=0;n<d;++n)JXG$1.isId(this.board,C[n])?this.parents.push(C[n]):JXG$1.exists(C[n].id)&&this.parents.push(C[n].id);this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(u){return this.parents=[],this.addParents(u),this},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},_updateCoordsCache:function(u){var n;u!==""&&JXG$1.exists(this.objects[u])&&(n=this.objects[u].point,this.coords[n.id]={usrCoords:n.coords.usrCoords.slice(0)})},update:function(){var u,n,d,C,I,f,y,B,_,Z,M=null;if(!this.needsUpdate)return this;if(u=this._update_find_drag_type(),u.action==="nothing")return this._updateCoordsCache(u.id),this;if(M=this.objects[u.id].point,u.action==="translation")_=[M.coords.usrCoords[1]-this.coords[u.id].usrCoords[1],M.coords.usrCoords[2]-this.coords[u.id].usrCoords[2]];else if(u.action==="rotation"||u.action==="scaling"){if(u.action==="rotation"?d="rotationCenter":d="scaleCenter",JXG$1.isPoint(this[d]))Z=this[d].coords.usrCoords.slice(1);else if(this[d]==="centroid")Z=this._update_centroid_center();else if(JXG$1.isArray(this[d]))Z=this[d];else if(JXG$1.isFunction(this[d]))Z=this[d]();else return this;if(u.action==="rotation")B=Geometry.rad(this.coords[u.id].usrCoords.slice(1),Z,this.objects[u.id].point),_=this.board.create("transform",[B,Z[0],Z[1]],{type:"rotate"}),_.update();else if(u.action==="scaling"){if(I=Geometry.distance(this.coords[u.id].usrCoords.slice(1),Z),Math.abs(I)<Mat.eps)return this;I=Geometry.distance(M.coords.usrCoords.slice(1),Z)/I,f=this.scaleDirections[u.id].indexOf("x")>=0?I:1,y=this.scaleDirections[u.id].indexOf("y")>=0?I:1,_=this.board.create("transform",[1,0,0,Z[0]*(1-f),f,0,Z[1]*(1-y),0,y],{type:"generic"}),_.update()}else return this}this._update_apply_transformation(u,_),this.needsUpdate=!1;for(n in this.objects)if(this.objects.hasOwnProperty(n))for(C in this.objects[n].descendants)this.objects[n].descendants.hasOwnProperty(C)&&(this.objects[n].descendants.needsUpdate=this.objects[n].descendants.needsRegularUpdate||this.board.needsFullUpdate);this.board.updateElements(u);for(n in this.objects)this.objects.hasOwnProperty(n)&&this._updateCoordsCache(n);return this},_update_find_drag_type:function(){var u,n,d="nothing",C=[],I;for(u in this.objects)this.objects.hasOwnProperty(u)&&(n=this.objects[u].point,n.coords.distance(Const.COORDS_BY_USER,this.coords[u])>Mat.eps&&C.push(n.id));return C.length===0?{action:d,id:"",changed:C}:(I=C[0],n=this.objects[I].point,C.length>1?d="translation":JXG$1.isInArray(this.rotationPoints,n)&&JXG$1.exists(this.rotationCenter)?d="rotation":JXG$1.isInArray(this.scalePoints,n)&&JXG$1.exists(this.scaleCenter)?d="scaling":JXG$1.isInArray(this.translationPoints,n)&&(d="translation"),{action:d,id:I,changed:C})},_update_centroid_center:function(){var u,n,d;u=[0,0],n=0;for(d in this.coords)this.coords.hasOwnProperty(d)&&(u[0]+=this.coords[d].usrCoords[1],u[1]+=this.coords[d].usrCoords[2],++n);return n>0&&(u[0]/=n,u[1]/=n),u},_update_apply_transformation:function(u,n){var d,C;for(d in this.objects)this.objects.hasOwnProperty(d)&&(JXG$1.exists(this.board.objects[d])?(C=this.objects[d].point,C.id!==u.id?u.action==="translation"?JXG$1.isInArray(u.changed,C.id)||C.coords.setCoordinates(Const.COORDS_BY_USER,[this.coords[d].usrCoords[1]+n[0],this.coords[d].usrCoords[2]+n[1]]):(u.action==="rotation"||u.action==="scaling")&&n.applyOnce([C]):(u.action==="rotation"||u.action==="scaling")&&C.coords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(n.matrix,this.coords[C.id].usrCoords))):delete this.objects[d])},addPoint:function(u){return this.objects[u.id]={point:this.board.select(u)},this._updateCoordsCache(u.id),this.translationPoints.push(u),u.groups.push(this.id),u.groups=JXG$1.uniqueArray(u.groups),this},addPoints:function(u){var n;for(n=0;n<u.length;n++)this.addPoint(u[n]);return this},addGroup:function(u){var n;for(n in u.objects)u.objects.hasOwnProperty(n)&&this.addPoint(u.objects[n].point);return this},removePoint:function(u){return delete this.objects[u.id],this},setRotationCenter:function(u){return this.rotationCenter=u,this},setRotationPoints:function(u){return this._setActionPoints("rotation",u)},addRotationPoint:function(u){return this._addActionPoint("rotation",u)},removeRotationPoint:function(u){return this._removeActionPoint("rotation",u)},setTranslationPoints:function(u){return this._setActionPoints("translation",u)},addTranslationPoint:function(u){return this._addActionPoint("translation",u)},removeTranslationPoint:function(u){return this._removeActionPoint("translation",u)},setScaleCenter:function(u){return this.scaleCenter=u,this},setScalePoints:function(u,n){var d,C,I;for(JXG$1.isArray(u)?d=u:d=arguments,I=d.length,C=0;C<I;++C)this.scaleDirections[this.board.select(d[C]).id]=n||"xy";return this._setActionPoints("scale",u)},addScalePoint:function(u,n){return this._addActionPoint("scale",u),this.scaleDirections[this.board.select(u).id]=n||"xy",this},removeScalePoint:function(u){return this._removeActionPoint("scale",u)},_setActionPoints:function(u,n){var d,C,I;for(JXG$1.isArray(n)?d=n:d=arguments,I=d.length,this[u+"Points"]=[],C=0;C<I;++C)this._addActionPoint(u,d[C]);return this},_addActionPoint:function(u,n){return this[u+"Points"].push(this.board.select(n)),this},_removeActionPoint:function(u,n){var d=this[u+"Points"].indexOf(this.board.select(n));return d>-1&&this[u+"Points"].splice(d,1),this},setProperty:function(){JXG$1.deprecated("Group.setProperty","Group.setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(){var u;for(u in this.objects)this.objects.hasOwnProperty(u)&&this.objects[u].point.setAttribute.apply(this.objects[u].point,arguments);return this}});JXG$1.createGroup=function(u,n,d){var C=JXG$1.copyAttributes(d,u.options,"group"),I=new JXG$1.Group(u,C.id,C.name,n,C);return I.elType="group",I.setParents(n),I};JXG$1.registerElement("group",JXG$1.createGroup);JXG$1.Group;JXG$1.Circle=function(u,n,d,C,I){this.constructor(u,I,Const.OBJECT_TYPE_CIRCLE,Const.OBJECT_CLASS_CIRCLE),this.method=n,this.midpoint=this.board.select(d),this.center=this.board.select(d),this.point2=null,this.radius=0,this.line=null,this.circle=null,this.points=[],n==="twoPoints"?(this.point2=u.select(C),this.radius=this.Radius()):n==="pointRadius"?(this.gxtterm=C,this.updateRadius=JXG$1.createFunction(C,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])):n==="pointLine"?(this.line=u.select(C),this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords)):n==="pointCircle"&&(this.circle=u.select(C),this.radius=this.circle.Radius()),this.id=this.board.setId(this,"C"),this.board.renderer.drawEllipse(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="circle",this.createLabel(),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),n==="pointRadius"?this.notifyParents(C):n==="pointLine"?this.line.addChild(this):n==="pointCircle"?this.circle.addChild(this):n==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{setRadius:"setRadius",getRadius:"getRadius",Area:"Area",area:"Area",Perimeter:"Perimeter",Circumference:"Perimeter",radius:"Radius",Radius:"Radius",Diameter:"Diameter",center:"center",line:"line",point2:"point2"})};JXG$1.Circle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Circle.prototype,{hasPoint:function(u,n){var d,C,I=this.center.coords.usrCoords,f=new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board),y=this.Radius(),B,_,Z;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(C=this.board._inputDevice,d=JXG$1.evaluate(this.visProp.precision[C])):d=this.board.options.precision.hasPoint,B=I[1]-f.usrCoords[1],_=I[2]-f.usrCoords[2],Z=Mat.hypot(B,_),d+=JXG$1.evaluate(this.visProp.strokewidth)*.5,d/=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY)),JXG$1.evaluate(this.visProp.hasinnerpoints)?Z<y+d:Math.abs(Z-y)<d},generatePolynomial:function(u){var n=this.center.symbolic.x,d=this.center.symbolic.y,C=u.symbolic.x,I=u.symbolic.y,f=this.generateRadiusSquared();return f===""?[]:["(("+C+")-("+n+"))^2 + (("+I+")-("+d+"))^2 - ("+f+")"]},generateRadiusSquared:function(){var u,n,d,C,I,f,y="";return this.method==="twoPoints"?(u=this.center.symbolic.x,n=this.center.symbolic.y,d=this.point2.symbolic.x,C=this.point2.symbolic.y,y="(("+d+")-("+u+"))^2 + (("+C+")-("+n+"))^2"):this.method==="pointRadius"?JXG$1.isNumber(this.radius)&&(y=(this.radius*this.radius).toString()):this.method==="pointLine"?(d=this.line.point1.symbolic.x,C=this.line.point1.symbolic.y,I=this.line.point2.symbolic.x,f=this.line.point2.symbolic.y,y="(("+d+")-("+I+"))^2 + (("+C+")-("+f+"))^2"):this.method==="pointCircle"&&(y=this.circle.Radius()),y},update:function(){var u,n,d,C,I,f;if(this.needsUpdate)for(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.method==="pointLine"?this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords):this.method==="pointCircle"?this.radius=this.circle.Radius():this.method==="pointRadius"&&(this.radius=this.updateRadius()),this.radius=Math.abs(this.radius),this.updateStdform(),this.updateQuadraticform(),d=this.center.coords.usrCoords[0],u=this.center.coords.usrCoords[1]/d,n=this.center.coords.usrCoords[2]/d,d/=d,C=this.Radius(),I=.551915024494,this.numberPoints=13,this.dataX=[u+C,u+C,u+C*I,u,u-C*I,u-C,u-C,u-C,u-C*I,u,u+C*I,u+C,u+C],this.dataY=[n,n+C*I,n+C,n+C,n+C,n+C*I,n,n-C*I,n-C,n-C,n-C,n-C*I,n],this.bezierDegree=3,f=0;f<this.numberPoints;f++)this.points[f]=new Coords(Const.COORDS_BY_USER,[this.dataX[f],this.dataY[f]],this.board);return this},updateQuadraticform:function(){var u=this.center,n=u.X(),d=u.Y(),C=this.Radius();this.quadraticform=[[n*n+d*d-C*C,-n,-d],[-n,1,0],[-d,0,1]]},updateStdform:function(){this.stdform[3]=.5,this.stdform[4]=this.Radius(),this.stdform[1]=-this.center.coords.usrCoords[1],this.stdform[2]=-this.center.coords.usrCoords[2],isFinite(this.stdform[4])||(this.stdform[0]=JXG$1.exists(this.point2)?-(this.stdform[1]*this.point2.coords.usrCoords[1]+this.stdform[2]*this.point2.coords.usrCoords[2]):0),this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.center.coords.usrCoords[1]+this.center.coords.usrCoords[2]+this.Radius())&&this.center.isReal,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateEllipse(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},notifyParents:function(u){JXG$1.isString(u)&&GeonextParser.findDependencies(this,u,this.board)},setRadius:function(u){return this.updateRadius=JXG$1.createFunction(u,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(u){return JXG$1.exists(u)?(this.setRadius(u),this.Radius()):this.method==="twoPoints"?JXG$1.cmpArrays(this.point2.coords.usrCoords,[0,0,0])||JXG$1.cmpArrays(this.center.coords.usrCoords,[0,0,0])?NaN:this.center.Dist(this.point2):this.method==="pointLine"||this.method==="pointCircle"?this.radius:this.method==="pointRadius"?JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.updateRadius()):Math.abs(this.updateRadius()):NaN},Diameter:function(){return 2*this.Radius()},getRadius:function(){return JXG$1.deprecated("Circle.getRadius()","Circle.Radius()"),this.Radius()},getTextAnchor:function(){return this.center.coords},getLabelAnchor:function(){var u,n,d,C,I,f,y=1.5,B=this.Radius(),_=this.center.coords.usrCoords,Z=.7071067811865;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(d))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d.indexOf("right")<0&&d.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"lft":u=_[1]-B,n=_[2];break;case"llft":u=_[1]-Z*B,n=_[2]-Z*B;break;case"rt":u=_[1]+B,n=_[2];break;case"lrt":u=_[1]+Z*B,n=_[2]-Z*B;break;case"urt":u=_[1]+Z*B,n=_[2]+Z*B;break;case"top":u=_[1],n=_[2]+B;break;case"bot":u=_[1],n=_[2]-B;break;default:u=_[1]-Z*B,n=_[2]+Z*B;break}else return _=this.center.coords.scrCoords,C=JXG$1.parsePosition(d),I=JXG$1.parseNumber(C.pos,2*Math.PI,1),C.pos.indexOf("fr")<0&&C.pos.indexOf("%")<0&&(C.pos.indexOf("px")>=0?I=0:I*=Math.PI/180),f=1,C.side==="left"&&(f=-1),JXG$1.exists(this.label)&&(y=f*.5*JXG$1.evaluate(this.label.visProp.distance)),u=_[1]+(B*this.board.unitX+this.label.size[0]*y)*Math.cos(I),n=_[2]-(B*this.board.unitY+this.label.size[1]*y)*Math.sin(I),new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board);return new Coords(Const.COORDS_BY_USER,[u,n],this.board)},cloneToBackground:function(){var u,n=this.Radius(),d={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CIRCLE,center:{coords:this.center.coords},Radius:function(){return n},getRadius:function(){return n},board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return d.visProp.layer=this.board.options.layer.trace,this.numTraces++,JXG$1.clearVisPropOld(d),d.visPropCalc={visible:JXG$1.evaluate(d.visProp.visible)},u=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawEllipse(d),this.board.renderer.enhancedRendering=u,this.traces[d.id]=d.rendNode,this},addTransform:function(u){var n,d=JXG$1.isArray(u)?u:[u],C=d.length;for(n=0;n<C;n++)this.center.transformations.push(d[n]),this.method==="twoPoints"&&this.point2.transformations.push(d[n]);return this},snapToGrid:function(){var u=JXG$1.evaluate(this.visProp.snaptogrid);return this.center.handleSnapToGrid(u,!0),this.method==="twoPoints"&&this.point2.handleSnapToGrid(u,!0),this},snapToPoints:function(){var u=JXG$1.evaluate(this.visProp.snaptopoints);return this.center.handleSnapToPoints(u),this.method==="twoPoints"&&this.point2.handleSnapToPoints(u),this},X:function(u){return this.Radius()*Math.cos(u*2*Math.PI)+this.center.coords.usrCoords[1]},Y:function(u){return this.Radius()*Math.sin(u*2*Math.PI)+this.center.coords.usrCoords[2]},Z:function(u){return 1},minX:function(){return 0},maxX:function(){return 1},Area:function(){var u=this.Radius();return u*u*Math.PI},Perimeter:function(){return 2*this.Radius()*Math.PI},bounds:function(){var u=this.center.coords.usrCoords,n=this.Radius();return[u[1]-n,u[2]+n,u[1]+n,u[2]-n]},getParents:function(){return this.parents.length===1?this.parents.concat(this.radius):this.parents}});JXG$1.createCircle=function(u,n,d){var C,I,f,y,B,_=!0,Z=["center","point2"];if(I=[],B=u.select(n[0]),JXG$1.isObject(B)&&B.elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isTransformationOrArray(n[1]))return y=JXG$1.copyAttributes(d,u.options,"circle"),C=JXG$1.createEllipse(u,[B.center,B.center,function(){return 2*B.Radius()}],y),C.addTransform(n[1]),C;for(f=0;f<n.length;f++)if(JXG$1.isPointType(u,n[f])){if(n.length<3?I.push(JXG$1.providePoints(u,[n[f]],d,"circle",[Z[f]])[0]):I.push(JXG$1.providePoints(u,[n[f]],d,"point")[0]),I[I.length-1]===!1)throw new Error("JSXGraph: Can't create circle from this type. Please provide a point type.")}else I.push(n[f]);if(y=JXG$1.copyAttributes(d,u.options,"circle"),I.length===2&&JXG$1.isPoint(I[0])&&JXG$1.isPoint(I[1]))C=new JXG$1.Circle(u,"twoPoints",I[0],I[1],y);else if((JXG$1.isNumber(I[0])||JXG$1.isFunction(I[0])||JXG$1.isString(I[0]))&&JXG$1.isPoint(I[1]))C=new JXG$1.Circle(u,"pointRadius",I[1],I[0],y);else if((JXG$1.isNumber(I[1])||JXG$1.isFunction(I[1])||JXG$1.isString(I[1]))&&JXG$1.isPoint(I[0]))C=new JXG$1.Circle(u,"pointRadius",I[0],I[1],y);else if(I[0].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(I[1]))C=new JXG$1.Circle(u,"pointCircle",I[1],I[0],y);else if(I[1].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(I[0]))C=new JXG$1.Circle(u,"pointCircle",I[0],I[1],y);else if(I[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(I[1]))C=new JXG$1.Circle(u,"pointLine",I[1],I[0],y);else if(I[1].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(I[0]))C=new JXG$1.Circle(u,"pointLine",I[0],I[1],y);else if(n.length===3&&JXG$1.isPoint(I[0])&&JXG$1.isPoint(I[1])&&JXG$1.isPoint(I[2]))if(JXG$1.elements.circumcircle)C=JXG$1.elements.circumcircle(u,I,y);else throw new Error("JSXGraph: Can't create circle with three points. Please include the circumcircle element (element/composition).");else throw new Error("JSXGraph: Can't create circle with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [point,number], [point,function], [point,circle], [point,point,point], [circle,transformation]`);for(C.isDraggable=_,C.setParents(I),C.elType="circle",f=0;f<I.length;f++)JXG$1.isPoint(I[f])&&C.inherits.push(I[f]);return C};JXG$1.registerElement("circle",JXG$1.createCircle);const Circle=JXG$1.Circle;JXG$1.createEllipse=function(u,n,d){var C,I,f,y,B,_,Z,M=[],V=JXG$1.copyAttributes(d,u.options,"conic","foci"),T=JXG$1.copyAttributes(d,u.options,"conic","center"),H=JXG$1.copyAttributes(d,u.options,"conic");for(_=0;_<2;_++)if(n[_].length>1)M[_]=u.create("point",n[_],V);else if(JXG$1.isPoint(n[_]))M[_]=u.select(n[_]);else if(JXG$1.isFunction(n[_])&&JXG$1.isPoint(n[_]()))M[_]=n[_]();else if(JXG$1.isString(n[_]))M[_]=u.select(n[_]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(n[2]))B=JXG$1.createFunction(n[2],u);else if(JXG$1.isFunction(n[2])&&JXG$1.isNumber(n[2]()))B=n[2];else{if(JXG$1.isPoint(n[2]))y=u.select(n[2]);else if(n[2].length>1)y=u.create("point",n[2],V);else if(JXG$1.isFunction(n[2])&&JXG$1.isPoint(n[2]()))y=n[2]();else if(JXG$1.isString(n[2]))y=u.select(n[2]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);B=function(){return y.Dist(M[0])+y.Dist(M[1])}}for(JXG$1.exists(n[4])||(n[4]=2*Math.PI),JXG$1.exists(n[3])||(n[3]=0),f=u.create("point",[function(){return(M[0].X()+M[1].X())*.5},function(){return(M[0].Y()+M[1].Y())*.5}],T),I=u.create("curve",[function(F){return 0},function(F){return 0},n[3],n[4]],H),I.majorAxis=B,Z=I.hasPoint,C=function(F,O){var $,U,ee,Q,ie,ne,le,ae,ce;O||($=B(),U=$*$,ee=M[0].X(),Q=M[0].Y(),ie=M[1].X(),ne=M[1].Y(),le=ee-ie,ae=Q-ne,ce=(U-ee*ee-Q*Q+ie*ie+ne*ne)/(2*$),I.quadraticform=[[ce*ce-ie*ie-ne*ne,ce*le/$+ie,ce*ae/$+ne],[ce*le/$+ie,le*le/U-1,le*ae/U],[ce*ae/$+ne,le*ae/U,ae*ae/U-1]])},I.X=function(F,O){var $=B(),U=M[1].Dist(M[0]),ee=.5*(U*U-$*$)/(U*Math.cos(F)-$),Q=Math.atan2(M[1].Y()-M[0].Y(),M[1].X()-M[0].X());return O||C(F,O),M[0].X()+Math.cos(Q+F)*ee},I.Y=function(F,O){var $=B(),U=M[1].Dist(M[0]),ee=.5*(U*U-$*$)/(U*Math.cos(F)-$),Q=Math.atan2(M[1].Y()-M[0].Y(),M[1].X()-M[0].X());return M[0].Y()+Math.sin(Q+F)*ee},I.midpoint=I.center=f,I.type=Const.OBJECT_TYPE_CONIC,I.subs={center:I.center},I.inherits.push(I.center,M[0],M[1]),JXG$1.isPoint(y)&&I.inherits.push(y),I.hasPoint=function(F,O){var $,U,ee,Q,ie;return JXG$1.evaluate(this.visProp.hasinnerpoints)?($=M[0].coords,U=M[1].coords,ee=this.majorAxis(),Q=new Coords(Const.COORDS_BY_SCREEN,[F,O],this.board),ie=Q.distance(Const.COORDS_BY_USER,$)+Q.distance(Const.COORDS_BY_USER,U),ie<=ee):Z.apply(this,arguments)},f.addChild(I),_=0;_<2;_++)JXG$1.isPoint(M[_])&&M[_].addChild(I);return JXG$1.isPoint(y)&&y.addChild(I),I.setParents(n),I};JXG$1.createHyperbola=function(u,n,d){var C,I,f,y,B,_,Z=[],M=JXG$1.copyAttributes(d,u.options,"conic","foci"),V=JXG$1.copyAttributes(d,u.options,"conic","center"),T=JXG$1.copyAttributes(d,u.options,"conic");for(_=0;_<2;_++)if(n[_].length>1)Z[_]=u.create("point",n[_],M);else if(JXG$1.isPoint(n[_]))Z[_]=u.select(n[_]);else if(JXG$1.isFunction(n[_])&&JXG$1.isPoint(n[_]()))Z[_]=n[_]();else if(JXG$1.isString(n[_]))Z[_]=u.select(n[_]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(n[2]))B=JXG$1.createFunction(n[2],u);else if(JXG$1.isFunction(n[2])&&JXG$1.isNumber(n[2]()))B=n[2];else{if(JXG$1.isPoint(n[2]))y=u.select(n[2]);else if(n[2].length>1)y=u.create("point",n[2],M);else if(JXG$1.isFunction(n[2])&&JXG$1.isPoint(n[2]()))y=n[2]();else if(JXG$1.isString(n[2]))y=u.select(n[2]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);B=function(){return y.Dist(Z[0])-y.Dist(Z[1])}}for(JXG$1.exists(n[4])||(n[4]=1.0001*Math.PI),JXG$1.exists(n[3])||(n[3]=-1.0001*Math.PI),f=u.create("point",[function(){return(Z[0].X()+Z[1].X())*.5},function(){return(Z[0].Y()+Z[1].Y())*.5}],V),I=u.create("curve",[function(H){return 0},function(H){return 0},n[3],n[4]],T),I.majorAxis=B,C=function(H,F){var O,$,U,ee,Q,ie,ne,le,ae;F||(O=B(),$=O*O,U=Z[0].X(),ee=Z[0].Y(),Q=Z[1].X(),ie=Z[1].Y(),ne=U-Q,le=ee-ie,ae=($-U*U-ee*ee+Q*Q+ie*ie)/(2*O),I.quadraticform=[[ae*ae-Q*Q-ie*ie,ae*ne/O+Q,ae*le/O+ie],[ae*ne/O+Q,ne*ne/$-1,ne*le/$],[ae*le/O+ie,ne*le/$,le*le/$-1]])},I.X=function(H,F){var O=B(),$=Z[1].Dist(Z[0]),U=.5*($*$-O*O)/($*Math.cos(H)+O),ee=Math.atan2(Z[1].Y()-Z[0].Y(),Z[1].X()-Z[0].X());return F||C(H,F),Z[0].X()+Math.cos(ee+H)*U},I.Y=function(H,F){var O=B(),$=Z[1].Dist(Z[0]),U=.5*($*$-O*O)/($*Math.cos(H)+O),ee=Math.atan2(Z[1].Y()-Z[0].Y(),Z[1].X()-Z[0].X());return Z[0].Y()+Math.sin(ee+H)*U},I.midpoint=I.center=f,I.subs={center:I.center},I.inherits.push(I.center,Z[0],Z[1]),JXG$1.isPoint(y)&&I.inherits.push(y),I.type=Const.OBJECT_TYPE_CONIC,f.addChild(I),_=0;_<2;_++)JXG$1.isPoint(Z[_])&&Z[_].addChild(I);return JXG$1.isPoint(y)&&y.addChild(I),I.setParents(n),I};JXG$1.createParabola=function(u,n,d){var C,I,f,y=n[0],B=n[1],_=JXG$1.copyAttributes(d,u.options,"conic","foci"),Z=JXG$1.copyAttributes(d,u.options,"conic","center"),M=JXG$1.copyAttributes(d,u.options,"conic"),V;if(n[0].length>1)y=u.create("point",n[0],_);else if(JXG$1.isPoint(n[0]))y=u.select(n[0]);else if(JXG$1.isFunction(n[0])&&JXG$1.isPoint(n[0]()))y=n[0]();else if(JXG$1.isString(n[0]))y=u.select(n[0]);else throw new Error("JSXGraph: Can't create Parabola with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line]`);return JXG$1.isArray(B)&&B.length===2&&(V=JXG$1.copyAttributes(d,u.options,"conic","line"),B=u.create("line",B,V)),JXG$1.exists(n[3])||(n[3]=2*Math.PI),JXG$1.exists(n[2])||(n[2]=0),f=u.create("point",[function(){return Geometry.projectPointToLine(y,B,u).usrCoords}],Z),I=u.create("curve",[function(T){return 0},function(T){return 0},n[2],n[3]],M),I.midpoint=I.center=f,I.subs={center:I.center},I.inherits.push(I.center),C=function(T,H){var F,O,$,U,ee,Q;H||(F=B.stdform[1],O=B.stdform[2],$=B.stdform[0],U=F*F+O*O,ee=y.X(),Q=y.Y(),I.quadraticform=[[$*$-U*(ee*ee+Q*Q),$*F+U*ee,$*O+U*Q],[$*F+U*ee,-O*O,F*O],[$*O+U*Q,F*O,-F*F]])},I.X=function(T,H){var F,O,$=B.getAngle(),U=Geometry.distPointLine(y.coords.usrCoords,B.stdform),ee=B.point1.coords.usrCoords,Q=B.point2.coords.usrCoords,ie=y.coords.usrCoords;return ee[0]===0?ee=[1,Q[1]+B.stdform[2],Q[2]-B.stdform[1]]:Q[0]===0&&(Q=[1,ee[1]+B.stdform[2],ee[2]-B.stdform[1]]),O=(Q[1]-ee[1])*(ie[2]-ee[2])-(Q[2]-ee[2])*(ie[1]-ee[1])>=0?1:-1,F=O*U/(1-Math.sin(T)),H||C(T,H),y.X()+Math.cos(T+$)*F},I.Y=function(T,H){var F,O,$=B.getAngle(),U=Geometry.distPointLine(y.coords.usrCoords,B.stdform),ee=B.point1.coords.usrCoords,Q=B.point2.coords.usrCoords,ie=y.coords.usrCoords;return ee[0]===0?ee=[1,Q[1]+B.stdform[2],Q[2]-B.stdform[1]]:Q[0]===0&&(Q=[1,ee[1]+B.stdform[2],ee[2]-B.stdform[1]]),O=(Q[1]-ee[1])*(ie[2]-ee[2])-(Q[2]-ee[2])*(ie[1]-ee[1])>=0?1:-1,F=O*U/(1-Math.sin(T)),y.Y()+Math.sin(T+$)*F},I.type=Const.OBJECT_TYPE_CONIC,f.addChild(I),JXG$1.isPoint(y)&&(y.addChild(I),I.inherits.push(y)),B.addChild(I),I.setParents(n),I};JXG$1.createConic=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U=[[1,0,0],[0,1,0],[0,0,1]],ee=[[1,0,0],[0,1,0],[0,0,1]],Q=[],ie=[],ne=JXG$1.copyAttributes(d,u.options,"conic","point"),le=JXG$1.copyAttributes(d,u.options,"conic","center"),ae=JXG$1.copyAttributes(d,u.options,"conic");if(n.length===5)$=!0;else if(n.length===6)$=!1;else throw new Error("JSXGraph: Can't create generic Conic with "+n.length+" parameters.");if($)for(F=0;F<5;F++)if(n[F].length>1)Q[F]=u.create("point",n[F],ne);else if(JXG$1.isPoint(n[F]))Q[F]=u.select(n[F]);else if(JXG$1.isFunction(n[F])&&JXG$1.isPoint(n[F]()))Q[F]=n[F]();else if(JXG$1.isString(n[F]))Q[F]=u.select(n[F]);else throw new Error("JSXGraph: Can't create Conic section with parent types '"+typeof n[F]+`'.
Possible parent types: [point,point,point,point,point], [a00,a11,a22,a01,a02,a12]`);else O=[[0,0,0],[0,0,0],[0,0,0]],O[0][0]=JXG$1.isFunction(n[2])?function(){return n[2]()}:function(){return n[2]},O[0][1]=JXG$1.isFunction(n[4])?function(){return n[4]()}:function(){return n[4]},O[0][2]=JXG$1.isFunction(n[5])?function(){return n[5]()}:function(){return n[5]},O[1][1]=JXG$1.isFunction(n[0])?function(){return n[0]()}:function(){return n[0]},O[1][2]=JXG$1.isFunction(n[3])?function(){return n[3]()}:function(){return n[3]},O[2][2]=JXG$1.isFunction(n[1])?function(){return n[1]()}:function(){return n[1]};if(B=function(ce){var ge,he;for(ge=0;ge<3;ge++)for(he=ge;he<3;he++)ce[ge][he]+=ce[he][ge];for(ge=0;ge<3;ge++)for(he=0;he<ge;he++)ce[ge][he]=ce[he][ge];return ce},y=function(ce,ge){var he,Ie,fe=[[0,0,0],[0,0,0],[0,0,0]];for(he=0;he<3;he++)for(Ie=0;Ie<3;Ie++)fe[he][Ie]=ce[he]*ge[Ie];return B(fe)},f=function(ce,ge,he){var Ie,fe,me,Ge,Ze,ye=[[0,0,0],[0,0,0],[0,0,0]];for(Ze=Mat.matVecMult(ge,he),me=Mat.innerProduct(he,Ze),Ze=Mat.matVecMult(ce,he),Ge=Mat.innerProduct(he,Ze),Ie=0;Ie<3;Ie++)for(fe=0;fe<3;fe++)ye[Ie][fe]=me*ce[Ie][fe]-Ge*ge[Ie][fe];return ye},I=u.create("curve",[function(ce){return 0},function(ce){return 0},0,2*Math.PI],ae),C=function(ce,ge){var he,Ie,fe;if(!ge){if($){for(he=0;he<5;he++)ie[he]=Q[he].coords.usrCoords;T=y(Mat.crossProduct(ie[0],ie[1]),Mat.crossProduct(ie[2],ie[3])),H=y(Mat.crossProduct(ie[0],ie[2]),Mat.crossProduct(ie[1],ie[3])),ee=f(T,H,ie[4])}else for(he=0;he<3;he++)for(Ie=he;Ie<3;Ie++)ee[he][Ie]=O[he][Ie](),Ie>he&&(ee[Ie][he]=ee[he][Ie]);I.quadraticform=ee,_=Numerics.Jacobi(ee),_[0][0][0]<0&&(_[0][0][0]*=-1,_[0][1][1]*=-1,_[0][2][2]*=-1),U=_[1],V=Math.sqrt(Math.abs(_[0][0][0])),Z=Math.sqrt(Math.abs(_[0][1][1])),M=Math.sqrt(Math.abs(_[0][2][2]))}return _[0][1][1]<=0&&_[0][2][2]<=0?fe=Mat.matVecMult(U,[1/V,Math.cos(ce)/Z,Math.sin(ce)/M]):_[0][1][1]<=0&&_[0][2][2]>0?fe=Mat.matVecMult(U,[Math.cos(ce)/V,1/Z,Math.sin(ce)/M]):_[0][2][2]<0&&(fe=Mat.matVecMult(U,[Math.sin(ce)/V,Math.cos(ce)/Z,1/M])),JXG$1.exists(fe)?(fe[1]/=fe[0],fe[2]/=fe[0],fe[0]=1):fe=[1,NaN,NaN],fe},I.X=function(ce,ge){return C(ce,ge)[1]},I.Y=function(ce,ge){return C(ce,ge)[2]},I.midpoint=u.create("point",[function(){var ce=I.quadraticform;return[ce[1][1]*ce[2][2]-ce[1][2]*ce[1][2],ce[1][2]*ce[0][2]-ce[2][2]*ce[0][1],ce[0][1]*ce[1][2]-ce[1][1]*ce[0][2]]}],le),I.type=Const.OBJECT_TYPE_CONIC,I.center=I.midpoint,I.subs={center:I.center},I.inherits.push(I.center),I.inherits=I.inherits.concat(Q),$){for(F=0;F<5;F++)JXG$1.isPoint(Q[F])&&Q[F].addChild(I);I.setParents(n)}return I.addChild(I.center),I};JXG$1.registerElement("ellipse",JXG$1.createEllipse);JXG$1.registerElement("hyperbola",JXG$1.createHyperbola);JXG$1.registerElement("parabola",JXG$1.createParabola);JXG$1.registerElement("conic",JXG$1.createConic);JXG$1.Polygon=function(u,n,d){this.constructor(u,d,Const.OBJECT_TYPE_POLYGON,Const.OBJECT_CLASS_AREA);var C,I,f,y,B,_=JXG$1.copyAttributes(d,u.options,"polygon","borders");for(this.withLines=d.withlines,this.attr_line=_,this.vertices=[],C=0;C<n.length;C++)this.vertices[C]=this.board.select(n[C]),this.vertices[C]._is_new&&(delete this.vertices[C]._is_new,this.vertices[C]._is_new_pol=!0);if(this.vertices.length>0&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.borders=[],this.withLines)for(f=this.vertices.length-1,y=0;y<f;y++)C=(y+1)%f,_.id=_.ids&&_.ids[C],_.name=_.names&&_.names[C],_.strokecolor=JXG$1.isArray(_.colors)&&_.colors[C%_.colors.length]||_.strokecolor,_.visible=JXG$1.exists(d.borders.visible)?d.borders.visible:d.visible,_.strokecolor===!1&&(_.strokecolor="none"),I=u.create("segment",[this.vertices[C],this.vertices[C+1]],_),I.dump=!1,this.borders[C]=I,I.parentPolygon=this,this.addChild(I);for(this.inherits.push(this.vertices,this.borders),this.id=this.board.setId(this,"Py"),C=0;C<this.vertices.length-1;C++)B=this.board.select(this.vertices[C]),JXG$1.exists(B._is_new_pol)?(this.addChild(B),delete B._is_new_pol):B.addChild(this);this.board.renderer.drawPolygon(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="polygon",this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{borders:"borders",vertices:"vertices",A:"Area",Area:"Area",Perimeter:"Perimeter",L:"Perimeter",boundingBox:"bounds",BoundingBox:"bounds",addPoints:"addPoints",insertPoints:"insertPoints",removePoints:"removePoints",Intersect:"intersect"})};JXG$1.Polygon.prototype=new GeometryElement;JXG$1.extend(JXG$1.Polygon.prototype,{pnpoly:function(u,n,d){return Geometry.pnpoly(u,n,this.vertices,d)},hasPoint:function(u,n){var d,C;if(JXG$1.evaluate(this.visProp.hasinnerpoints)&&this.pnpoly(u,n))return!0;for(C=this.borders.length,d=0;d<C;d++)if(this.borders[d].hasPoint(u,n))return!0;return!1},updateRenderer:function(){var u,n;if(!this.needsUpdate)return this;if(this.visPropCalc.visible){for(n=this.vertices.length-(this.elType==="polygonalchain"?0:1),this.isReal=!0,u=0;u<n;++u)if(!this.vertices[u].isReal){this.isReal=!1;break}if(!this.isReal){this.updateVisibility(!1);for(u in this.childElements)this.childElements.hasOwnProperty(u)&&this.childElements[u].setDisplayRendNode(!1)}}return this.visPropCalc.visible&&this.board.renderer.updatePolygon(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this},getTextAnchor:function(){var u,n,d,C,I;if(this.vertices.length===0)return new Coords(Const.COORDS_BY_USER,[1,0,0],this.board);for(u=this.vertices[0].X(),n=this.vertices[0].Y(),d=u,C=n,I=0;I<this.vertices.length;I++)this.vertices[I].X()<u&&(u=this.vertices[I].X()),this.vertices[I].X()>d&&(d=this.vertices[I].X()),this.vertices[I].Y()>n&&(n=this.vertices[I].Y()),this.vertices[I].Y()<C&&(C=this.vertices[I].Y());return new Coords(Const.COORDS_BY_USER,[(u+d)*.5,(n+C)*.5],this.board)},getLabelAnchor:JXG$1.shortcut(JXG$1.Polygon.prototype,"getTextAnchor"),cloneToBackground:function(){var u={},n;return u.id=this.id+"T"+this.numTraces,this.numTraces++,u.vertices=this.vertices,u.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),u.visProp.layer=this.board.options.layer.trace,u.board=this.board,JXG$1.clearVisPropOld(u),u.visPropCalc={visible:JXG$1.evaluate(u.visProp.visible)},n=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawPolygon(u),this.board.renderer.enhancedRendering=n,this.traces[u.id]=u.rendNode,this},hideElement:function(u){var n;if(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),!u)for(n=0;n<this.borders.length;n++)this.borders[n].hideElement();this.hasLabel&&JXG$1.exists(this.label)&&(this.label.hiddenByParent=!0,this.label.visPropCalc.visible&&this.label.hideElement())},showElement:function(u){var n;if(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!0),!u)for(n=0;n<this.borders.length;n++)this.borders[n].showElement().updateRenderer();return JXG$1.exists(this.label)&&this.hasLabel&&this.label.hiddenByParent&&(this.label.hiddenByParent=!1,this.label.visPropCalc.visible||this.label.showElement().updateRenderer()),this},Area:function(){return Math.abs(Geometry.signedPolygon(this.vertices,!0))},Perimeter:function(){var u,n=this.vertices.length,d=0;for(u=1;u<n;++u)d+=this.vertices[u].Dist(this.vertices[u-1]);return d},L:function(){return this.Perimeter()},boundingBox:function(){var u=[0,0,0,0],n,d,C=this.vertices.length-1;if(C===0)return u;for(u[0]=this.vertices[0].X(),u[2]=u[0],u[1]=this.vertices[0].Y(),u[3]=u[1],n=1;n<C;++n)d=this.vertices[n].X(),d<u[0]?u[0]=d:d>u[2]&&(u[2]=d),d=this.vertices[n].Y(),d>u[1]?u[1]=d:d<u[3]&&(u[3]=d);return u},bounds:function(){return this.boundingBox()},remove:function(){var u;for(u=0;u<this.borders.length;u++)this.board.removeObject(this.borders[u]);GeometryElement.prototype.remove.call(this)},findPoint:function(u){var n;if(!JXG$1.isPoint(u))return-1;for(n=0;n<this.vertices.length;n++)if(this.vertices[n].id===u.id)return n;return-1},addPoints:function(u){var n,d=Array.prototype.slice.call(arguments);return this.elType==="polygonalchain"?n=this.vertices.length-1:n=this.vertices.length-2,this.insertPoints.apply(this,[n].concat(d))},insertPoints:function(u,n){var d,C,I,f,y;if(arguments.length===0)return this;if(I=this.vertices.length-1,this.elType==="polygon"&&I--,u<-1||u>I)return this;for(C=arguments.length-1,d=1;d<C+1;d++)y=JXG$1.providePoints(this.board,[arguments[d]],{},"polygon",["vertices"])[0],y._is_new&&(this.addChild(y),delete y._is_new),this.vertices.splice(u+d,0,y);if(this.withLines)for(f=u+1,this.elType==="polygon"?u<0?(this.vertices[this.vertices.length-1]=this.vertices[0],this.borders[this.borders.length-1].point2=this.vertices[this.vertices.length-1]):this.borders[u].point2=this.vertices[f]:u>=0&&(u<this.borders.length?this.borders[u].point2=this.vertices[f]:f=u),d=f;d<f+C;d++)this.borders.splice(d,0,this.board.create("segment",[this.vertices[d],this.vertices[d+1]],this.attr_line));return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},removePoints:function(u){var n,d,C,I,f=[],y=[],B=[],_=[];for(this.elType==="polygon"&&(I=this.vertices.pop()),n=0;n<arguments.length;n++)C=arguments[n],JXG$1.isPoint(C)&&(C=this.findPoint(C)),JXG$1.isNumber(C)&&C>-1&&C<this.vertices.length&&JXG$1.indexOf(B,C)===-1&&B.push(C);if(B.length===0)return this.elType==="polygon"&&this.vertices.push(I),this;for(n=0;n<B.length;n++)this.vertices[B[n]].removeChild(this);for(B=B.sort(),f=this.vertices.slice(),y=this.borders.slice(),this.withLines&&_.push([B[B.length-1]]),n=B.length-1;n>-1;n--)f[B[n]]=-1,this.withLines&&B.length>1&&B[n]-1>B[n-1]&&(_[_.length-1][1]=B[n],_.push([B[n-1]]));for(this.withLines&&(_[_.length-1][1]=B[0]),this.vertices=[],n=0;n<f.length;n++)JXG$1.isPoint(f[n])&&this.vertices.push(f[n]);if(this.elType==="polygon"&&this.vertices.length>1&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.withLines){for(n=0;n<_.length;n++){for(d=_[n][1]-1;d<_[n][0]+1;d++)d<0?this.elType==="polygon"&&(this.board.removeObject(this.borders[y.length-1]),y[y.length-1]=-1):d<y.length&&(this.board.removeObject(this.borders[d]),y[d]=-1);_[n][1]!==0&&_[n][0]!==f.length-1&&(y[_[n][0]-1]=this.board.create("segment",[f[_[n][1]-1],f[_[n][0]+1]],this.attr_line))}for(this.borders=[],n=0;n<y.length;n++)y[n]!==-1&&this.borders.push(y[n]);this.elType==="polygon"&&this.vertices.length>2&&(_[0][1]===this.vertices.length-1||_[_.length-1][1]===0)&&this.borders.push(this.board.create("segment",[this.vertices[this.vertices.length-2],this.vertices[0]],this.attr_line))}return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},getParents:function(){return this.setParents(this.vertices),this.parents},getAttributes:function(){var u=GeometryElement.prototype.getAttributes.call(this),n;if(this.withLines)for(u.lines=u.lines||{},u.lines.ids=[],u.lines.colors=[],n=0;n<this.borders.length;n++)u.lines.ids.push(this.borders[n].id),u.lines.colors.push(this.borders[n].visProp.strokecolor);return u},snapToGrid:function(){var u,n;for(JXG$1.evaluate(this.visProp.snaptogrid)?n=!0:n=!1,u=0;u<this.vertices.length;u++)this.vertices[u].handleSnapToGrid(n,!0)},setPositionDirectly:function(u,n,d){var C,I,f,y,B=new Coords(u,n,this.board),_=new Coords(u,d,this.board);for(y=this.vertices.length-1,f=0;f<y;f++)if(!this.vertices[f].draggable())return this;return C=Statistics.subtract(B.usrCoords,_.usrCoords),I=this.board.create("transform",C.slice(1),{type:"translate"}),I.applyOnce(this.vertices.slice(0,-1)),this},sutherlandHodgman:function(u){var n=JXG$1.Math.Geometry.sortVertices(this.vertices),d=JXG$1.Math.Geometry.sortVertices(u.vertices),C=n.length-1,I=d.length-1,f,y=[],B,_,Z,M,V,T,H=function(F,O,$){return(O[1]-F[1])*($[2]-F[2])-(O[2]-F[2])*($[1]-F[1])>=0};for(_=0;_<I;_++)y.push(d[_]);for(_=0;_<C;_++)for(B=y.slice(0),f=B.length,y=[],M=B[f-1],Z=0;Z<f;Z++)V=B[Z],H(n[_],n[_+1],V)?(H(n[_],n[_+1],M)||(T=JXG$1.Math.Geometry.meetSegmentSegment(M,V,n[_],n[_+1]),T[0][1]/=T[0][0],T[0][2]/=T[0][0],T[0][0]=1,y.push(T[0])),y.push(V)):H(n[_],n[_+1],M)&&(T=JXG$1.Math.Geometry.meetSegmentSegment(M,V,n[_],n[_+1]),T[0][1]/=T[0][0],T[0][2]/=T[0][0],T[0][0]=1,y.push(T[0])),M=V;return y},intersect:function(u){return this.sutherlandHodgman(u)}});JXG$1.createPolygon=function(u,n,d){var C,I,f,y,B=[],_,Z,M=!1;if(_=JXG$1.copyAttributes(d,u.options,"polygon"),y=u.select(n[0]),y===null&&(y=n[0]),JXG$1.isObject(y)&&y.type===Const.OBJECT_TYPE_POLYGON&&JXG$1.isTransformationOrArray(n[1]))for(M=!0,f=y.vertices.length-1,Z=JXG$1.copyAttributes(d,u.options,"polygon","vertices"),I=0;I<f;I++)Z.withlabel&&(Z.name=y.vertices[I].name===""?"":y.vertices[I].name+"'"),B.push(u.create("point",[y.vertices[I],n[1]],Z));else if(B=JXG$1.providePoints(u,n,d,"polygon",["vertices"]),B===!1)throw new Error("JSXGraph: Can't create polygon / polygonalchain with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon and a transformation can be supplied");if(_=JXG$1.copyAttributes(d,u.options,"polygon"),C=new JXG$1.Polygon(u,B,_),C.isDraggable=!0,M)for(C.prepareUpdate().update().updateVisibility().updateRenderer(),f=y.vertices.length-1,I=0;I<f;I++)B[I].prepareUpdate().update().updateVisibility().updateRenderer();return C};JXG$1.createRegularPolygon=function(u,n,d){var C,I,f,y=[],B,_,Z,M;if(_=n.length,f=n[_-1],JXG$1.isNumber(f)&&(n.length!==3||f<3))throw new Error("JSXGraph: A regular polygon needs two point types and a number > 2 as input.");if(JXG$1.isNumber(u.select(f))?(_--,Z=!1):(f=_,Z=!0),y=JXG$1.providePoints(u,n.slice(0,_),d,"regularpolygon",["vertices"]),y===!1)throw new Error("JSXGraph: Can't create regular polygon with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates");for(M=JXG$1.copyAttributes(d,u.options,"regularpolygon","vertices"),I=2;I<f;I++)B=u.create("transform",[Math.PI*(2-(f-2)/f),y[I-1]],{type:"rotate"}),Z?(y[I].addTransform(y[I-2],B),y[I].fullUpdate()):(JXG$1.isArray(M.ids)&&M.ids.length>=f-2&&(M.id=M.ids[I-2]),y[I]=u.create("point",[y[I-2],B],M),y[I].type=Const.OBJECT_TYPE_CAS,y[I].isDraggable=!0,y[I].visProp.fixed=!1);return M=JXG$1.copyAttributes(d,u.options,"regularpolygon"),C=u.create("polygon",y,M),C.elType="regularpolygon",C};JXG$1.createPolygonalChain=function(u,n,d){var C,I;return C=JXG$1.copyAttributes(d,u.options,"polygonalchain"),I=u.create("polygon",n,C),I.elType="polygonalchain",I.vertices.pop(),u.removeObject(I.borders[I.borders.length-1]),I.borders.pop(),I};JXG$1.createParallelogram=function(u,n,d){var C,I,f=[],y,B;if(f=JXG$1.providePoints(u,n,d,"polygon",["vertices"]),f===!1||f.length<3)throw new Error("JSXGraph: Can't create parallelogram with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates.");return B=JXG$1.copyAttributes(d,u.options,"parallelogram","parallelpoint"),I=u.create("parallelpoint",f,B),y=JXG$1.copyAttributes(d,u.options,"parallelogram"),C=u.create("polygon",[f[0],f[1],I,f[2]],y),C.elType="parallelogram",C.parallelPoint=I,C.isDraggable=!0,I.isDraggable=!0,I.visProp.fixed=!1,C};JXG$1.registerElement("polygon",JXG$1.createPolygon);JXG$1.registerElement("regularpolygon",JXG$1.createRegularPolygon);JXG$1.registerElement("polygonalchain",JXG$1.createPolygonalChain);JXG$1.registerElement("parallelogram",JXG$1.createParallelogram);const Polygon=JXG$1.Polygon;JXG$1.Curve=function(u,n,d){this.constructor(u,d,Const.OBJECT_TYPE_CURVE,Const.OBJECT_CLASS_CURVE),this.points=[],this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh),this.bezierDegree=1,this.dataX=null,this.dataY=null,this.ticks=[],this.qdt=null,JXG$1.exists(n[0])?this.varname=n[0]:this.varname="x",this.xterm=n[1],this.yterm=n[2],this.generateTerm(this.varname,this.xterm,this.yterm,n[3],n[4]),this.updateCurve(),this.id=this.board.setId(this,"G"),this.board.renderer.drawCurve(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="curve",this.createLabel(),JXG$1.isString(this.xterm)&&this.notifyParents(this.xterm),JXG$1.isString(this.yterm)&&this.notifyParents(this.yterm),this.methodMap=JXG$1.deepCopy(this.methodMap,{generateTerm:"generateTerm",setTerm:"generateTerm",move:"moveTo",moveTo:"moveTo",MinX:"minX",MaxX:"maxX"})};JXG$1.Curve.prototype=new GeometryElement;JXG$1.extend(JXG$1.Curve.prototype,{minX:function(){var u;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?0:(u=new Coords(Const.COORDS_BY_SCREEN,[-this.board.canvasWidth*.1,0],this.board,!1),u.usrCoords[1])},maxX:function(){var u;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?2*Math.PI:(u=new Coords(Const.COORDS_BY_SCREEN,[this.board.canvasWidth*1.1,0],this.board,!1),u.usrCoords[1])},X:function(u){return NaN},Y:function(u){return NaN},Z:function(u){return 1},hasPoint:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T=[],H,F,O=JXG$1.evaluate(this.visProp.numberpointslow),$=(this.maxX()-this.minX())/O,U,ee,Q=1/0,ie,ne,le,ae,ce,ge=!0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(ee=this.board._inputDevice,U=JXG$1.evaluate(this.visProp.precision[ee])):U=this.board.options.precision.hasPoint,_=new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board,!1),u=_.usrCoords[1],n=_.usrCoords[2],this.bezierDegree===1&&JXG$1.evaluate(this.visProp.hasinnerpoints)&&(V=Geometry.windingNumber([1,u,n],this.points,!0),V!==0))return!0;if(U+=JXG$1.evaluate(this.visProp.strokewidth)*.5,U*=U,ie=this.board.unitX*this.board.unitX,ne=this.board.unitY*this.board.unitY,ae=this.minX(),ce=this.maxX(),JXG$1.exists(this._visibleArea)&&(ae=this._visibleArea[0],ce=this._visibleArea[1],$=(ce-ae)/O),le=JXG$1.evaluate(this.visProp.curvetype),le==="parameter"||le==="polar")for(this.transformations.length>0&&(this.updateTransformMatrix(),M=Mat.inverse(this.transformMat),I=Mat.matVecMult(M,[1,u,n]),u=I[1],n=I[2]),f=0,C=ae;f<O;f++){if(y=this.X(C,ge),B=this.Y(C,ge),Q=(u-y)*(u-y)*ie+(n-B)*(n-B)*ne,Q<=U)return!0;C+=$}else if(le==="plot"||le==="functiongraph"){for((!JXG$1.exists(d)||d<0)&&(d=0),JXG$1.exists(this.qdt)&&JXG$1.evaluate(this.visProp.useqdt)&&this.bezierDegree!==3?(F=this.qdt.query(new Coords(Const.COORDS_BY_USER,[u,n],this.board)),H=F.points,Z=H.length):(H=this.points,Z=this.numberPoints-1),f=d;f<Z;f++)if(this.bezierDegree===3?T=Geometry.projectCoordsToBeziersegment([1,u,n],this,f):F?(H[f].prev&&(T=Geometry.projectCoordsToSegment([1,u,n],H[f].prev.usrCoords,H[f].usrCoords)),H[f].next&&H[f+1]!==H[f].next&&(T=Geometry.projectCoordsToSegment([1,u,n],H[f].usrCoords,H[f].next.usrCoords))):T=Geometry.projectCoordsToSegment([1,u,n],H[f].usrCoords,H[f+1].usrCoords),T[1]>=0&&T[1]<=1&&(u-T[0][1])*(u-T[0][1])*ie+(n-T[0][2])*(n-T[0][2])*ne<=U)return!0;return!1}return Q<U},allocatePoints:function(){var u,n;if(n=this.numberPoints,this.points.length<this.numberPoints)for(u=this.points.length;u<n;u++)this.points[u]=new Coords(Const.COORDS_BY_USER,[0,0],this.board,!1)},update:function(){return this.needsUpdate&&(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.updateCurve()),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=Plot.checkReal(this.points),this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateCurve(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateDataArray:function(){},updateCurve:function(){var u,n,d,C,I,f,y=this.visProp.plotversion,B=!1;if(this.updateTransformMatrix(),this.updateDataArray(),d=this.minX(),C=this.maxX(),JXG$1.exists(this.dataX))for(this.numberPoints=this.dataX.length,n=this.numberPoints,this.allocatePoints(),u=0;u<n;u++)I=u,JXG$1.exists(this.dataY)?(f=u,this.points[u].setCoordinates(Const.COORDS_BY_USER,[this.dataX[u],this.dataY[u]],!1)):(f=this.X(I),this.points[u].setCoordinates(Const.COORDS_BY_USER,[this.dataX[u],this.Y(f,B)],!1)),this.points[u]._t=u,B=!0;else if(JXG$1.evaluate(this.visProp.doadvancedplot)?y===1||JXG$1.evaluate(this.visProp.doadvancedplotold)?Plot.updateParametricCurveOld(this,d,C):y===2?Plot.updateParametricCurve_v2(this,d,C):y===3?Plot.updateParametricCurve_v3(this,d,C):y===4?Plot.updateParametricCurve_v4(this,d,C):Plot.updateParametricCurve_v2(this,d,C):(this.board.updateQuality===this.board.BOARD_QUALITY_HIGH?this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh):this.numberPoints=JXG$1.evaluate(this.visProp.numberpointslow),this.allocatePoints(),Plot.updateParametricCurveNaive(this,d,C,this.numberPoints)),n=this.numberPoints,JXG$1.evaluate(this.visProp.useqdt)&&this.board.updateQuality===this.board.BOARD_QUALITY_HIGH)for(this.qdt=new QDT(this.board.getBoundingBox()),u=0;u<this.points.length;u++)this.qdt.insert(this.points[u]),u>0&&(this.points[u].prev=this.points[u-1]),u<n-1&&(this.points[u].next=this.points[u+1]);for(JXG$1.evaluate(this.visProp.curvetype)!=="plot"&&JXG$1.evaluate(this.visProp.rdpsmoothing)&&(this.points=Numerics.RamerDouglasPeucker(this.points,.2),this.numberPoints=this.points.length),n=this.numberPoints,u=0;u<n;u++)this.updateTransform(this.points[u]);return this},updateTransformMatrix:function(){var u,n,d=this.transformations.length;for(this.transformMat=[[1,0,0],[0,1,0],[0,0,1]],n=0;n<d;n++)u=this.transformations[n],u.update(),this.transformMat=Mat.matMatMult(u.matrix,this.transformMat);return this},updateTransform:function(u){var n,d=this.transformations.length;return d>0&&(n=Mat.matVecMult(this.transformMat,u.usrCoords),u.setCoordinates(Const.COORDS_BY_USER,n,!1,!0)),u},addTransform:function(u){var n,d=JXG$1.isArray(u)?u:[u],C=d.length;for(n=0;n<C;n++)this.transformations.push(d[n]);return this},interpolationFunctionFromArray:function(u){var n="data"+u,d=this;return function(C,I){var f,y,B,_,Z=d[n],M=Z.length,V,T=[];if(isNaN(C))return NaN;if(C<0)return JXG$1.isFunction(Z[0])?Z[0]():Z[0];if(d.bezierDegree===3){if(V=(M-1)/3,C>=V)return JXG$1.isFunction(Z[Z.length-1])?Z[Z.length-1]():Z[Z.length-1];for(f=Math.floor(C)*3,B=C%1,_=1-B,y=0;y<4;y++)JXG$1.isFunction(Z[f+y])?T[y]=Z[f+y]():T[y]=Z[f+y];return _*_*(_*T[0]+3*B*T[1])+(3*_*T[2]+B*T[3])*B*B}if(C>M-2?f=M-2:f=parseInt(Math.floor(C),10),f===C)return JXG$1.isFunction(Z[f])?Z[f]():Z[f];for(y=0;y<2;y++)JXG$1.isFunction(Z[f+y])?T[y]=Z[f+y]():T[y]=Z[f+y];return T[0]+(T[1]-T[0])*(C-f)}},generateTerm:function(u,n,d,C,I){var f,y;JXG$1.isArray(n)?(this.dataX=n,this.numberPoints=this.dataX.length,this.X=this.interpolationFunctionFromArray.apply(this,["X"]),this.visProp.curvetype="plot",this.isDraggable=!0):(this.X=JXG$1.createFunction(n,this.board,u),JXG$1.isString(n)?this.visProp.curvetype="functiongraph":(JXG$1.isFunction(n)||JXG$1.isNumber(n))&&(this.visProp.curvetype="parameter"),this.isDraggable=!0),JXG$1.isArray(d)?(this.dataY=d,this.Y=this.interpolationFunctionFromArray.apply(this,["Y"])):this.Y=JXG$1.createFunction(d,this.board,u),JXG$1.isFunction(n)&&JXG$1.isArray(d)&&(f=JXG$1.createFunction(d[0],this.board,""),y=JXG$1.createFunction(d[1],this.board,""),this.X=function(B){return n(B)*Math.cos(B)+f()},this.X.deps=f.deps,this.Y=function(B){return n(B)*Math.sin(B)+y()},this.Y.deps=y.deps,this.visProp.curvetype="polar"),JXG$1.exists(C)?this.minX=JXG$1.createFunction(C,this.board,""):delete this.minX,JXG$1.exists(I)?this.maxX=JXG$1.createFunction(I,this.board,""):delete this.maxX,this.addParentsFromJCFunctions([this.X,this.Y,this.minX,this.maxX])},notifyParents:function(u){var n,d,C=!1,I;I={xterm:1,yterm:1};for(n in I)if(I.hasOwnProperty(n)&&this.hasOwnProperty(n)&&this[n].origin){C=!0;for(d in this[n].origin.deps)this[n].origin.deps.hasOwnProperty(d)&&this[n].origin.deps[d].addChild(this)}C||GeonextParser.findDependencies(this,u,this.board)},getLabelAnchor:function(){var u,n,d,C,I,f,y,B,_,Z,M=1.5,V,T=.05*this.board.canvasWidth,H=.05*this.board.canvasHeight,F=.95*this.board.canvasWidth,O=.95*this.board.canvasHeight;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(d))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(d.indexOf("right")<0&&d.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"ulft":u=T,n=H;break;case"llft":u=T,n=O;break;case"rt":u=F,n=.5*O;break;case"lrt":u=F,n=O;break;case"urt":u=F,n=H;break;case"top":u=.5*F,n=H;break;case"bot":u=.5*F,n=O;break;default:u=T,n=.5*O}else return C=JXG$1.parsePosition(d),I=JXG$1.parseNumber(C.pos,this.maxX()-this.minX(),1),C.pos.indexOf("fr")<0&&C.pos.indexOf("%")<0&&(I=0),y=this.minX()+I,u=this.X(y),n=this.Y(y),V=new Coords(Const.COORDS_BY_USER,[u,n],this.board).scrCoords,f=Mat.eps,y<this.minX()+f?(B=(this.X(y+f)-this.X(y))/f,_=(this.Y(y+f)-this.Y(y))/f):y>this.maxX()-f?(B=(this.X(y)-this.X(y-f))/f,_=(this.Y(y)-this.Y(y-f))/f):(B=.5*(this.X(y+f)-this.X(y-f))/f,_=.5*(this.Y(y+f)-this.Y(y-f))/f),Z=Mat.hypot(B,_),C.side==="left"?_*=-1:B*=-1,JXG$1.exists(this.label)&&(M=.5*JXG$1.evaluate(this.label.visProp.distance)/Z),u=V[1]+_*this.label.size[0]*M,n=V[2]-B*this.label.size[1]*M,new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board);return V=new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board,!1),Geometry.projectCoordsToCurve(V.usrCoords[1],V.usrCoords[2],0,this,this.board)[0]},cloneToBackground:function(){var u,n={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CURVE,points:this.points.slice(0),bezierDegree:this.bezierDegree,numberPoints:this.numberPoints,board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return n.visProp.layer=this.board.options.layer.trace,n.visProp.curvetype=this.visProp.curvetype,this.numTraces++,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},u=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawCurve(n),this.board.renderer.enhancedRendering=u,this.traces[n.id]=n.rendNode,this},bounds:function(){var u=1/0,n=-1/0,d=1/0,C=-1/0,I=this.points.length,f,y,B;if(this.bezierDegree===3){for(f=0;f<I;f++)this.points[f].X=JXG$1.bind(function(){return this.usrCoords[1]},this.points[f]),this.points[f].Y=JXG$1.bind(function(){return this.usrCoords[2]},this.points[f]);return y=Numerics.bezier(this.points),B=y[3](),u=Numerics.fminbr(function(_){return y[0](_)},[0,B]),n=Numerics.fminbr(function(_){return-y[0](_)},[0,B]),d=Numerics.fminbr(function(_){return y[1](_)},[0,B]),C=Numerics.fminbr(function(_){return-y[1](_)},[0,B]),u=y[0](u),n=y[0](n),d=y[1](d),C=y[1](C),[u,C,n,d]}for(f=0;f<I;f++)u>this.points[f].usrCoords[1]&&(u=this.points[f].usrCoords[1]),n<this.points[f].usrCoords[1]&&(n=this.points[f].usrCoords[1]),d>this.points[f].usrCoords[2]&&(d=this.points[f].usrCoords[2]),C<this.points[f].usrCoords[2]&&(C=this.points[f].usrCoords[2]);return[u,C,n,d]},getParents:function(){var u=[this.xterm,this.yterm,this.minX(),this.maxX()];return this.parents.length!==0&&(u=this.parents),u},moveTo:function(u){var n=[],d;return this.points.length>0&&!JXG$1.evaluate(this.visProp.fixed)?(d=this.points[0],u.length===3?n=[u[0]-d.usrCoords[0],u[1]-d.usrCoords[1],u[2]-d.usrCoords[2]]:n=[u[0]-d.usrCoords[1],u[1]-d.usrCoords[2]],this.setPosition(Const.COORDS_BY_USER,n),this.board.update(this)):this},getTransformationSource:function(){var u,n;return JXG$1.exists(this._transformationSource)&&(n=this._transformationSource,n.elementClass===Const.OBJECT_CLASS_CURVE&&(u=!0)),[u,n]}});JXG$1.createCurve=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"curve");return C=u.select(n[0],!0),JXG$1.isTransformationOrArray(n[1])&&JXG$1.isObject(C)&&(C.type===Const.OBJECT_TYPE_CURVE||C.type===Const.OBJECT_TYPE_ANGLE||C.type===Const.OBJECT_TYPE_ARC||C.type===Const.OBJECT_TYPE_CONIC||C.type===Const.OBJECT_TYPE_SECTOR)?(C.type===Const.OBJECT_TYPE_SECTOR?f=JXG$1.copyAttributes(d,u.options,"sector"):C.type===Const.OBJECT_TYPE_ARC?f=JXG$1.copyAttributes(d,u.options,"arc"):C.type===Const.OBJECT_TYPE_ANGLE?(JXG$1.exists(d.withLabel)||(d.withLabel=!1),f=JXG$1.copyAttributes(d,u.options,"angle")):f=JXG$1.copyAttributes(d,u.options,"curve"),f=JXG$1.copyAttributes(f,u.options,"curve"),I=new JXG$1.Curve(u,["x",[],[]],f),I.updateDataArray=function(){var y,B=C.numberPoints;for(this.bezierDegree=C.bezierDegree,this.dataX=[],this.dataY=[],y=0;y<B;y++)this.dataX.push(C.points[y].usrCoords[1]),this.dataY.push(C.points[y].usrCoords[2]);return this},I.addTransform(n[1]),C.addChild(I),I.setParents([C]),I._transformationSource=C,I):(f=JXG$1.copyAttributes(d,u.options,"curve"),new JXG$1.Curve(u,["x"].concat(n),f))};JXG$1.registerElement("curve",JXG$1.createCurve);JXG$1.createFunctiongraph=function(u,n,d){var C,I=["x","x"].concat(n);return C=JXG$1.copyAttributes(d,u.options,"functiongraph"),C=JXG$1.copyAttributes(C,u.options,"curve"),C.curvetype="functiongraph",new JXG$1.Curve(u,I,C)};JXG$1.registerElement("functiongraph",JXG$1.createFunctiongraph);JXG$1.registerElement("plot",JXG$1.createFunctiongraph);JXG$1.createSpline=function(u,n,d){var C,I,f;return I=function(){var y,B=[],_=[];return[function(Z,M){var V,T,H;if(!M){if(B=[],_=[],n.length===2&&JXG$1.isArray(n[0])&&JXG$1.isArray(n[1])&&n[0].length===n[1].length)for(V=0;V<n[0].length;V++)JXG$1.isFunction(n[0][V])?B.push(n[0][V]()):B.push(n[0][V]),JXG$1.isFunction(n[1][V])?_.push(n[1][V]()):_.push(n[1][V]);else for(V=0;V<n.length;V++)if(JXG$1.isPoint(n[V]))B.push(n[V].X()),_.push(n[V].Y());else if(JXG$1.isArray(n[V])&&n[V].length===2)for(T=0;T<n.length;T++)JXG$1.isFunction(n[T][0])?B.push(n[T][0]()):B.push(n[T][0]),JXG$1.isFunction(n[T][1])?_.push(n[T][1]()):_.push(n[T][1]);else JXG$1.isFunction(n[V])&&n[V]().length===2&&(H=n[V](),B.push(H[0]),_.push(H[1]));y=Numerics.splineDef(B,_)}return Numerics.splineEval(Z,B,_,y)},function(){return B[0]},function(){return B[B.length-1]}]},d=JXG$1.copyAttributes(d,u.options,"curve"),d.curvetype="functiongraph",f=I(),C=new JXG$1.Curve(u,["x","x",f[0],f[1],f[2]],d),C.setParents(n),C.elType="spline",C};JXG$1.registerElement("spline",JXG$1.createSpline);JXG$1.createCardinalSpline=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H=`
Possible parent types: [points:array, tau:number|function, type:string]`;if(!JXG$1.exists(n[0])||!JXG$1.isArray(n[0]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 1 'points' has to be array of points or coordinate pairs"+H);if(!JXG$1.exists(n[1])||!JXG$1.isNumber(n[1])&&!JXG$1.isFunction(n[1]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 2 'tau' has to be number between [0,1] or function'"+H);if(!JXG$1.exists(n[2])||!JXG$1.isString(n[2]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 3 'type' has to be string 'uniform' or 'centripetal'"+H);if(d=JXG$1.copyAttributes(d,u.options,"curve"),d=JXG$1.copyAttributes(d,u.options,"cardinalspline"),d.curvetype="parameter",_=n[0],Z=[],!d.isarrayofcoordinates&&_.length===2&&JXG$1.isArray(_[0])&&JXG$1.isArray(_[1])&&_[0].length===_[1].length)for(M=0;M<_[0].length;M++)Z[M]=[],JXG$1.isFunction(_[0][M])?Z[M].push(_[0][M]()):Z[M].push(_[0][M]),JXG$1.isFunction(_[1][M])?Z[M].push(_[1][M]()):Z[M].push(_[1][M]);else for(M=0;M<_.length;M++)JXG$1.isString(_[M])?Z.push(u.select(_[M])):JXG$1.isPoint(_[M])?Z.push(_[M]):JXG$1.isArray(_[M])&&_[M].length===2?(Z[M]=[],JXG$1.isFunction(_[M][0])?Z[M].push(_[M][0]()):Z[M].push(_[M][0]),JXG$1.isFunction(_[M][1])?Z[M].push(_[M][1]()):Z[M].push(_[M][1])):JXG$1.isFunction(_[M])&&_[M]().length===2&&Z.push(n[M]());if(d.createpoints===!0)f=JXG$1.providePoints(u,Z,d,"cardinalspline",["points"]);else for(f=[],I=function(F){return{X:function(){return Z[F][0]},Y:function(){return Z[F][1]},Dist:function(O){var $=this.X()-O.X(),U=this.Y()-O.Y();return Mat.hypot($,U)}}},M=0;M<Z.length;M++)JXG$1.isPoint(Z[M])?f.push(Z[M]):f.push(I(M));for(y=n[1],B=n[2],T=["x"].concat(Numerics.CardinalSpline(f,y,B)),C=new JXG$1.Curve(u,T,d),V=f.length,C.setParents(f),M=0;M<V;M++)_=f[M],JXG$1.isPoint(_)&&(JXG$1.exists(_._is_new)?(C.addChild(_),delete _._is_new):_.addChild(C));return C.elType="cardinalspline",C};JXG$1.registerElement("cardinalspline",JXG$1.createCardinalSpline);JXG$1.createMetapostSpline=function(u,n,d){var C,I,f,y,B,_,Z,M,V=`
Possible parent types: [points:array, controls:object`;if(!JXG$1.exists(n[0])||!JXG$1.isArray(n[0]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 1 'points' has to be array of points or coordinate pairs"+V);if(!JXG$1.exists(n[1])||!JXG$1.isObject(n[1]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 2 'controls' has to be a JavaScript object'"+V);if(d=JXG$1.copyAttributes(d,u.options,"curve"),d=JXG$1.copyAttributes(d,u.options,"metapostspline"),d.curvetype="parameter",B=n[0],_=[],!d.isarrayofcoordinates&&B.length===2&&JXG$1.isArray(B[0])&&JXG$1.isArray(B[1])&&B[0].length===B[1].length)for(Z=0;Z<B[0].length;Z++)_[Z]=[],JXG$1.isFunction(B[0][Z])?_[Z].push(B[0][Z]()):_[Z].push(B[0][Z]),JXG$1.isFunction(B[1][Z])?_[Z].push(B[1][Z]()):_[Z].push(B[1][Z]);else for(Z=0;Z<B.length;Z++)JXG$1.isString(B[Z])?_.push(u.select(B[Z])):JXG$1.isPoint(B[Z])?_.push(B[Z]):JXG$1.isArray(B[Z])&&B[Z].length===2?(_[Z]=[],JXG$1.isFunction(B[Z][0])?_[Z].push(B[Z][0]()):_[Z].push(B[Z][0]),JXG$1.isFunction(B[Z][1])?_[Z].push(B[Z][1]()):_[Z].push(B[Z][1])):JXG$1.isFunction(B[Z])&&B[Z]().length===2&&_.push(n[Z]());if(d.createpoints===!0)f=JXG$1.providePoints(u,_,d,"metapostspline",["points"]);else for(f=[],I=function(T){return{X:function(){return _[T][0]},Y:function(){return _[T][1]}}},Z=0;Z<_.length;Z++)JXG$1.isPoint(_[Z])?f.push(_[Z]):f.push(I);for(y=n[1],C=new JXG$1.Curve(u,["t",[],[],0,B.length-1],d),C.updateDataArray=function(){var T,H,F=f.length,O=[];for(H=0;H<F;H++)O.push([f[H].X(),f[H].Y()]);T=Metapost.curve(O,y),this.dataX=T[0],this.dataY=T[1]},C.bezierDegree=3,M=f.length,C.setParents(f),Z=0;Z<M;Z++)JXG$1.isPoint(f[Z])&&f[Z].addChild(C);return C.elType="metapostspline",C};JXG$1.registerElement("metapostspline",JXG$1.createMetapostSpline);JXG$1.createRiemannsum=function(u,n,d){var C,I,f,y,B,_;if(_=JXG$1.copyAttributes(d,u.options,"riemannsum"),_.curvetype="plot",f=n[0],C=JXG$1.createFunction(n[1],u,""),!JXG$1.exists(C))throw new Error(`JSXGraph: JXG.createRiemannsum: argument '2' n has to be number or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);if(typeof n[2]=="string"&&(n[2]="'"+n[2]+"'"),I=JXG$1.createFunction(n[2],u,""),!JXG$1.exists(I))throw new Error(`JSXGraph: JXG.createRiemannsum: argument 3 'type' has to be string or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);return y=[[0],[0]].concat(n.slice(3)),B=u.create("curve",y,_),B.sum=0,B.Value=function(){return this.sum},B.updateDataArray=function(){var Z=Numerics.riemann(f,C(),I(),this.minX(),this.maxX());this.dataX=Z[0],this.dataY=Z[1],this.sum=Z[2]},B.addParentsFromJCFunctions([C,I]),B};JXG$1.registerElement("riemannsum",JXG$1.createRiemannsum);JXG$1.createTracecurve=function(u,n,d){var C,I,f,y;if(n.length!==2)throw new Error(`JSXGraph: Can't create trace curve with given parent'
Possible parent types: [glider, point]`);if(I=u.select(n[0]),f=u.select(n[1]),I.type!==Const.OBJECT_TYPE_GLIDER||!JXG$1.isPoint(f))throw new Error("JSXGraph: Can't create trace curve with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [glider, point]`);return y=JXG$1.copyAttributes(d,u.options,"tracecurve"),y.curvetype="plot",C=u.create("curve",[[0],[0]],y),C.updateDataArray=function(){var B,_,Z,M,V,T,H,F,O,$=y.numberpoints,U=I.position,ee=I.slideObject,Q=ee.minX(),ie=ee.maxX();for(_=(ie-Q)/$,this.dataX=[],this.dataY=[],ee.elementClass!==Const.OBJECT_CLASS_CURVE&&$++,B=0;B<$;B++){Z=Q+B*_,T=ee.X(Z)/ee.Z(Z),H=ee.Y(Z)/ee.Z(Z),I.setPositionDirectly(Const.COORDS_BY_USER,[T,H]),F=!1;for(M in this.board.objects)if(this.board.objects.hasOwnProperty(M)&&(V=this.board.objects[M],V===I&&(F=!0),F&&V.needsRegularUpdate&&(O=V.visProp.trace,V.visProp.trace=!1,V.needsUpdate=!0,V.update(!0),V.visProp.trace=O,V===f)))break;this.dataX[B]=f.X(),this.dataY[B]=f.Y()}I.position=U,F=!1;for(M in this.board.objects)if(this.board.objects.hasOwnProperty(M)&&(V=this.board.objects[M],V===I&&(F=!0),F&&V.needsRegularUpdate&&(O=V.visProp.trace,V.visProp.trace=!1,V.needsUpdate=!0,V.update(!0),V.visProp.trace=O,V===f)))break},C};JXG$1.registerElement("tracecurve",JXG$1.createTracecurve);JXG$1.createStepfunction=function(u,n,d){var C,I;if(n.length!==2)throw new Error(`JSXGraph: Can't create step function with given parent'
Possible parent types: [array, array|function]`);return I=JXG$1.copyAttributes(d,u.options,"stepfunction"),C=u.create("curve",n,I),C.updateDataArray=function(){var f,y=0,B=this.xterm.length;if(this.dataX=[],this.dataY=[],B!==0)for(this.dataX[y]=this.xterm[0],this.dataY[y]=this.yterm[0],++y,f=1;f<B;++f)this.dataX[y]=this.xterm[f],this.dataY[y]=this.dataY[y-1],++y,this.dataX[y]=this.xterm[f],this.dataY[y]=this.yterm[f],++y},C};JXG$1.registerElement("stepfunction",JXG$1.createStepfunction);JXG$1.createDerivative=function(u,n,d){var C,I,f,y,B;if(n.length!==1&&n[0].class!==Const.OBJECT_CLASS_CURVE)throw new Error(`JSXGraph: Can't create derivative curve with given parent'
Possible parent types: [curve]`);return B=JXG$1.copyAttributes(d,u.options,"curve"),I=n[0],f=Numerics.D(I.X),y=Numerics.D(I.Y),C=u.create("curve",[function(_){return I.X(_)},function(_){return y(_)/f(_)},I.minX(),I.maxX()],B),C.setParents(I),C};JXG$1.registerElement("derivative",JXG$1.createDerivative);JXG$1.createCurveIntersection=function(u,n,d){var C;if(n.length!==2)throw new Error(`JSXGraph: Can't create curve intersection with given parent'
Possible parent types: [array, array|function]`);return C=u.create("curve",[[],[]],d),C.updateDataArray=function(){var I=Clip.intersection(n[0],n[1],this.board);this.dataX=I[0],this.dataY=I[1]},C};JXG$1.createCurveUnion=function(u,n,d){var C;if(n.length!==2)throw new Error(`JSXGraph: Can't create curve union with given parent'
Possible parent types: [array, array|function]`);return C=u.create("curve",[[],[]],d),C.updateDataArray=function(){var I=Clip.union(n[0],n[1],this.board);this.dataX=I[0],this.dataY=I[1]},C};JXG$1.createCurveDifference=function(u,n,d){var C;if(n.length!==2)throw new Error(`JSXGraph: Can't create curve difference with given parent'
Possible parent types: [array, array|function]`);return C=u.create("curve",[[],[]],d),C.updateDataArray=function(){var I=Clip.difference(n[0],n[1],this.board);this.dataX=I[0],this.dataY=I[1]},C};JXG$1.registerElement("curvedifference",JXG$1.createCurveDifference);JXG$1.registerElement("curveintersection",JXG$1.createCurveIntersection);JXG$1.registerElement("curveunion",JXG$1.createCurveUnion);JXG$1.createBoxPlot=function(u,n,d){var C,I,f,y=JXG$1.copyAttributes(d,u.options,"boxplot");if(n.length!==3)throw new Error(`JSXGraph: Can't create box plot with given parent'
Possible parent types: [array, number|function, number|function] containing quantiles, axis, width`);if(n[0].length<5)throw new Error(`JSXGraph: Can't create box plot with given parent[0]'
parent[0] has to contain at least 5 quantiles.`);for(C=u.create("curve",[[],[]],y),f=n[0].length,C.Q=[],I=0;I<f;I++)C.Q[I]=JXG$1.createFunction(n[0][I],u);return C.x=JXG$1.createFunction(n[1],u),C.w=JXG$1.createFunction(n[2],u),C.updateDataArray=function(){var B,_,Z,M,V,T,H,F,O;H=JXG$1.evaluate(this.visProp.smallwidth),F=JXG$1.evaluate(this.visProp.dir),O=this.x(),Z=O-this.w()*.5,M=O-this.w()*.5*H,V=O+this.w()*.5,T=O+this.w()*.5*H,B=[O,M,T,O,O,Z,Z,V,V,O,NaN,Z,V,NaN,O,O,M,T,O],_=[this.Q[0](),this.Q[0](),this.Q[0](),this.Q[0](),this.Q[1](),this.Q[1](),this.Q[3](),this.Q[3](),this.Q[1](),this.Q[1](),NaN,this.Q[2](),this.Q[2](),NaN,this.Q[3](),this.Q[4](),this.Q[4](),this.Q[4](),this.Q[4]()],F==="vertical"?(this.dataX=B,this.dataY=_):(this.dataX=_,this.dataY=B)},C.addParentsFromJCFunctions([C.Q,C.x,C.w]),C};JXG$1.registerElement("boxplot",JXG$1.createBoxPlot);JXG$1.createImplicitCurve=function(u,n,d){var C,I;if([1,3,5].indexOf(n.length)<0)throw new Error(`JSXGraph: Can't create curve implicitCurve with given parent'
Possible parent types: [f], [f, rangex, rangey], [f, dfx, dfy] or [f, dfx, dfy, rangex, rangey]
with functions f, dfx, dfy and arrays of length 2 rangex, rangey.`);return I=JXG$1.copyAttributes(d,u.options,"implicitcurve"),C=u.create("curve",[[],[]],I),C.f=JXG$1.createFunction(n[0],u,"x, y"),C.dfx=JXG$1.createFunction(n[1],u,"x, y"),C.dfy=JXG$1.createFunction(n[2],u,"x, y"),C.domain=null,n.length===5?C.domain=[n[3],n[4]]:n.length===3&&(C.domain=[n[1],n[2]]),C.updateDataArray=function(){var f,y,B,_,Z,M=[],V;this.domain===null?(V=JXG$1.evaluate(this.visProp.margin),f=this.board.getBoundingBox(),f[0]-=V,f[1]+=V,f[2]+=V,f[3]-=V):(y=JXG$1.evaluate(this.domain[0]),B=JXG$1.evaluate(this.domain[1]),f=[y[0],B[1],y[1],B[0]]),Z={resolution_out:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_outer)),resolution_in:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_inner)),max_steps:JXG$1.evaluate(this.visProp.max_steps),alpha_0:JXG$1.evaluate(this.visProp.alpha_0),tol_u0:JXG$1.evaluate(this.visProp.tol_u0),tol_newton:JXG$1.evaluate(this.visProp.tol_newton),tol_cusp:JXG$1.evaluate(this.visProp.tol_cusp),tol_progress:JXG$1.evaluate(this.visProp.tol_progress),qdt_box:JXG$1.evaluate(this.visProp.qdt_box),kappa_0:JXG$1.evaluate(this.visProp.kappa_0),delta_0:JXG$1.evaluate(this.visProp.delta_0),h_initial:JXG$1.evaluate(this.visProp.h_initial),h_critical:JXG$1.evaluate(this.visProp.h_critical),h_max:JXG$1.evaluate(this.visProp.h_max),loop_dist:JXG$1.evaluate(this.visProp.loop_dist),loop_dir:JXG$1.evaluate(this.visProp.loop_dir),loop_detection:JXG$1.evaluate(this.visProp.loop_detection),unitX:this.board.unitX,unitY:this.board.unitY},this.dataX=[],this.dataY=[],_=new ImplicitPlot(f,Z,this.f,this.dfx,this.dfy),this.qdt=_.qdt,M=_.plot(),this.dataX=M[0],this.dataY=M[1]},C.elType="implicitcurve",C};JXG$1.registerElement("implicitcurve",JXG$1.createImplicitCurve);JXG$1.Curve;JXG$1.createArc=function(u,n,d){var C,I,f;if(f=JXG$1.providePoints(u,n,d,"arc",["center","radiuspoint","anglepoint"]),f===!1||f.length<3)throw new Error("JSXGraph: Can't create Arc with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point], [arc, transformation]`);return I=JXG$1.copyAttributes(d,u.options,"arc"),C=u.create("curve",[[0],[0]],I),C.elType="arc",C.setParents(f),C.type=Const.OBJECT_TYPE_ARC,C.center=f[0],C.radiuspoint=f[1],C.point2=C.radiuspoint,C.anglepoint=f[2],C.point3=C.anglepoint,JXG$1.exists(C.center._is_new)?(C.addChild(C.center),delete C.center._is_new):C.center.addChild(C),JXG$1.exists(C.radiuspoint._is_new)?(C.addChild(C.radiuspoint),delete C.radiuspoint._is_new):C.radiuspoint.addChild(C),JXG$1.exists(C.anglepoint._is_new)?(C.addChild(C.anglepoint),delete C.anglepoint._is_new):C.anglepoint.addChild(C),C.useDirection=I.usedirection,C.updateDataArray=function(){var y,B,_,Z,M,V,T=1,H=this.radiuspoint,F=this.center,O=this.anglepoint,$=JXG$1.evaluate(this.visProp.selection);B=Geometry.rad(H,F,O),($==="minor"&&B>Math.PI||$==="major"&&B<Math.PI)&&(T=-1),this.useDirection&&(Z=f[1].coords.usrCoords,M=f[3].coords.usrCoords,V=f[2].coords.usrCoords,_=(Z[1]-V[1])*(Z[2]-M[2])-(Z[2]-V[2])*(Z[1]-M[1]),_<0?(this.radiuspoint=f[1],this.anglepoint=f[2]):(this.radiuspoint=f[2],this.anglepoint=f[1])),H=H.coords.usrCoords,F=F.coords.usrCoords,O=O.coords.usrCoords,y=Geometry.bezierArc(H,F,O,!1,T),this.dataX=y[0],this.dataY=y[1],this.bezierDegree=3,this.updateStdform(),this.updateQuadraticform()},C.Radius=function(){return this.radiuspoint.Dist(this.center)},C.getRadius=function(){return JXG$1.deprecated("Arc.getRadius()","Arc.Radius()"),this.Radius()},C.Value=function(y,B){var _;return B=B||Geometry.rad(this.radiuspoint,this.center,this.anglepoint),y=y||"length",y=y.toLocaleLowerCase(),y===""||y.indexOf("len")===0?_=B*this.Radius():y.indexOf("rad")===0?_=B:y.indexOf("deg")===0?_=B*180/Math.PI:y.indexOf("sem")===0?_=B/Math.PI:y.indexOf("cir")===0&&(_=B*.5/Math.PI),_},C.L=function(){return this.Value("length")},C.hasPoint=function(y,B){var _,Z,M,V,T,H,F,O=this.Radius();return JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(y,B):(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(F=this.board._inputDevice,H=JXG$1.evaluate(this.visProp.precision[F])):H=this.board.options.precision.hasPoint,H/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),Z=new Coords(Const.COORDS_BY_SCREEN,[y,B],this.board),this.transformations.length>0&&(this.updateTransformMatrix(),V=Mat.inverse(this.transformMat),T=Mat.matVecMult(V,Z.usrCoords),Z=new Coords(Const.COORDS_BY_USER,T,this.board)),_=this.center.coords.distance(Const.COORDS_BY_USER,Z),M=Math.abs(_-O)<H,M&&(M=Geometry.coordsOnArc(this,Z)),M)},C.hasPointSector=function(y,B){var _=new Coords(Const.COORDS_BY_SCREEN,[y,B],this.board),Z=this.Radius(),M=this.center.coords.distance(Const.COORDS_BY_USER,_),V=M<Z;return V&&(V=Geometry.coordsOnArc(this,_)),V},C.getTextAnchor=function(){return this.center.coords},C.getLabelAnchor=function(){var y,B,_,Z,M,V=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),T=10/this.board.unitX,H=10/this.board.unitY,F=this.point2.coords.usrCoords,O=this.center.coords.usrCoords,$=F[1]-O[1],U=F[2]-O[2],ee=JXG$1.evaluate(this.visProp.selection),Q=this.label?this.label.visProp:this.visProp.label;return(ee==="minor"&&V>Math.PI||ee==="major"&&V<Math.PI)&&(V=-(2*Math.PI-V)),y=new Coords(Const.COORDS_BY_USER,[O[1]+Math.cos(V*.5)*$-Math.sin(V*.5)*U,O[2]+Math.sin(V*.5)*$+Math.cos(V*.5)*U],this.board),_=y.usrCoords[1]-O[1],Z=y.usrCoords[2]-O[2],M=Mat.hypot(_,Z),_=_*(M+T)/M,Z=Z*(M+H)/M,B=[O[1]+_,O[2]+Z],Q.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],B)),new Coords(Const.COORDS_BY_USER,B,this.board)},C.updateQuadraticform=Circle.prototype.updateQuadraticform,C.updateStdform=Circle.prototype.updateStdform,C.methodMap=JXG$1.deepCopy(C.methodMap,{getRadius:"getRadius",radius:"Radius",Radius:"Radius",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint",Value:"Value",L:"L"}),C.prepareUpdate().update(),C};JXG$1.registerElement("arc",JXG$1.createArc);JXG$1.createSemicircle=function(u,n,d){var C,I,f,y;if(y=JXG$1.providePoints(u,n,d,"point"),y===!1||y.length!==2)throw new Error("JSXGraph: Can't create Semicircle with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point]`);return f=JXG$1.copyAttributes(d,u.options,"semicircle","center"),I=u.create("midpoint",y,f),I.dump=!1,f=JXG$1.copyAttributes(d,u.options,"semicircle"),C=u.create("arc",[I,y[1],y[0]],f),C.elType="semicircle",C.setParents([y[0].id,y[1].id]),C.subs={midpoint:I},C.inherits.push(I),C.midpoint=C.center=I,C};JXG$1.registerElement("semicircle",JXG$1.createSemicircle);JXG$1.createCircumcircleArc=function(u,n,d){var C,I,f,y;if(y=JXG$1.providePoints(u,n,d,"point"),y===!1||y.length!==3)throw new Error("JSXGraph: create Circumcircle Arc with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`);return f=JXG$1.copyAttributes(d,u.options,"circumcirclearc","center"),I=u.create("circumcenter",y,f),I.dump=!1,f=JXG$1.copyAttributes(d,u.options,"circumcirclearc"),f.usedirection=!0,C=u.create("arc",[I,y[0],y[2],y[1]],f),C.elType="circumcirclearc",C.setParents([y[0].id,y[1].id,y[2].id]),C.subs={center:I},C.inherits.push(I),C.center=I,C};JXG$1.registerElement("circumcirclearc",JXG$1.createCircumcircleArc);JXG$1.createMinorArc=function(u,n,d){return d.selection="minor",JXG$1.createArc(u,n,d)};JXG$1.registerElement("minorarc",JXG$1.createMinorArc);JXG$1.createMajorArc=function(u,n,d){return d.selection="major",JXG$1.createArc(u,n,d)};JXG$1.registerElement("majorarc",JXG$1.createMajorArc);JXG$1.createSector=function(u,n,d){var C,I,f,y="invalid",B,_,Z=["center","radiusPoint","anglePoint"],M;if(n[0].elementClass===Const.OBJECT_CLASS_LINE&&n[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(n[2])||JXG$1.isNumber(n[2]))&&(JXG$1.isArray(n[3])||JXG$1.isNumber(n[3]))&&(JXG$1.isNumber(n[4])||JXG$1.isFunction(n[4])||JXG$1.isString(n[4])))y="2lines";else{if(M=JXG$1.providePoints(u,n,d,"sector",Z),M===!1)throw new Error("JSXGraph: Can't create Sector with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+"'.");y="3points"}if(I=JXG$1.copyAttributes(d,u.options,"sector"),C=u.create("curve",[[0],[0]],I),C.type=Const.OBJECT_TYPE_SECTOR,C.elType="sector",C.autoRadius=function(){var V=20/C.board.unitX,T=1/0,H=50/C.board.unitX;return JXG$1.isPoint(C.center)&&(T=C.center.Dist(C.point2)*.3333),Math.max(V,Math.min(T,H))},y==="2lines")C.Radius=function(){var V=JXG$1.evaluate(n[4]);return V==="auto"?this.autoRadius():V},C.line1=u.select(n[0]),C.line2=u.select(n[1]),C.line1.addChild(C),C.line2.addChild(C),C.setParents(n),C.point1={visProp:{}},C.point2={visProp:{}},C.point3={visProp:{}},B=Geometry.meetLineLine(C.line1.stdform,C.line2.stdform,0,u),JXG$1.isArray(n[2])?(n[2].length===2&&(n[2]=[1].concat(n[2])),_=Geometry.projectPointToLine({coords:{usrCoords:n[2]}},C.line1,u),_=Statistics.subtract(_.usrCoords,B.usrCoords),C.direction1=Mat.innerProduct(_,[0,C.line1.stdform[2],-C.line1.stdform[1]],3)>=0?1:-1):C.direction1=n[2]>=0?1:-1,JXG$1.isArray(n[3])?(n[3].length===2&&(n[3]=[1].concat(n[3])),_=Geometry.projectPointToLine({coords:{usrCoords:n[3]}},C.line2,u),_=Statistics.subtract(_.usrCoords,B.usrCoords),C.direction2=Mat.innerProduct(_,[0,C.line2.stdform[2],-C.line2.stdform[1]],3)>=0?1:-1):C.direction2=n[3]>=0?1:-1,C.methodMap=JXG$1.deepCopy(C.methodMap,{arc:"arc",center:"center",line1:"line1",line2:"line2"}),C.updateDataArray=function(){var V,T,H,F=[0,0,0],O=[0,0,0],$=[0,0,0],U;if(T=this.line1,H=this.line2,O=Mat.crossProduct(T.stdform,H.stdform),Math.abs(O[0])>Mat.eps*Mat.eps&&(O[1]/=O[0],O[2]/=O[0],O[0]/=O[0]),V=this.direction1*this.Radius(),F=Statistics.add(O,[0,V*T.stdform[2],-V*T.stdform[1]]),V=this.direction2*this.Radius(),$=Statistics.add(O,[0,V*H.stdform[2],-V*H.stdform[1]]),this.point2.coords=new Coords(Const.COORDS_BY_USER,F,C.board),this.point1.coords=new Coords(Const.COORDS_BY_USER,O,C.board),this.point3.coords=new Coords(Const.COORDS_BY_USER,$,C.board),Math.abs(F[0])<Mat.eps||Math.abs(O[0])<Mat.eps||Math.abs($[0])<Mat.eps){this.dataX=[NaN],this.dataY=[NaN];return}U=Geometry.bezierArc(F,O,$,!0,1),this.dataX=U[0],this.dataY=U[1],this.bezierDegree=3};else if(y==="3points"){for(C.point1=M[0],C.point2=M[1],C.point3=M[2],f=0;f<3;f++)JXG$1.exists(M[f]._is_new)?(C.addChild(M[f]),delete M[f]._is_new):M[f].addChild(C);C.useDirection=d.usedirection,C.setParents(M),JXG$1.exists(M[3])&&(C.point4=M[3],C.point4.addChild(C)),C.methodMap=JXG$1.deepCopy(C.methodMap,{arc:"arc",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint"}),C.updateDataArray=function(){var V,T,H,F,O,$=this.point2,U=this.point1,ee=this.point3,Q,ie=1,ne=JXG$1.evaluate(this.visProp.selection);if(!$.isReal||!U.isReal||!ee.isReal){this.dataX=[NaN],this.dataY=[NaN];return}Q=Geometry.rad($,U,ee),(ne==="minor"&&Q>Math.PI||ne==="major"&&Q<Math.PI)&&(ie=-1),this.useDirection&&JXG$1.exists(this.point4)&&(H=this.point2.coords.usrCoords,F=this.point4.coords.usrCoords,O=this.point3.coords.usrCoords,T=(H[1]-O[1])*(H[2]-F[2])-(H[2]-O[2])*(H[1]-F[1]),T>=0&&(ee=this.point2,$=this.point3)),$=$.coords.usrCoords,U=U.coords.usrCoords,ee=ee.coords.usrCoords,V=Geometry.bezierArc($,U,ee,!0,ie),this.dataX=V[0],this.dataY=V[1],this.bezierDegree=3},C.Radius=function(){return this.point2.Dist(this.point1)}}return C.center=C.point1,C.radiuspoint=C.point2,C.anglepoint=C.point3,I=JXG$1.copyAttributes(d,u.options,"arc"),I=JXG$1.copyAttributes(I,u.options,"sector","arc"),I.withLabel=!1,I.selection=C.visProp.selection,I.name+="_arc",y==="2lines"?(C.updateDataArray(),C.arc=u.create("arc",[function(){return C.point1.coords.usrCoords},function(){var V=C.point2.coords.distance(Const.COORDS_BY_USER,C.point1.coords);return V===0?[C.point1.coords.usrCoords[1],C.point1.coords.usrCoords[2]]:[C.point1.coords.usrCoords[1]+C.Radius()*(C.point2.coords.usrCoords[1]-C.point1.coords.usrCoords[1])/V,C.point1.coords.usrCoords[2]+C.Radius()*(C.point2.coords.usrCoords[2]-C.point1.coords.usrCoords[2])/V]},function(){return C.point3.coords.usrCoords}],I)):C.arc=u.create("arc",[C.point1,function(){var V=C.point2.Dist(C.point1);return V===0?[C.point1.X(),C.point1.Y()]:[C.point1.X()+C.Radius()*(C.point2.X()-C.point1.X())/V,C.point1.Y()+C.Radius()*(C.point2.Y()-C.point1.Y())/V]},C.point3],I),C.addChild(C.arc),C.hasPointCurve=function(V,T){var H,F,O,$,U,ee=new Coords(Const.COORDS_BY_SCREEN,[V,T],this.board),Q=this.Radius(),ie=this.center.coords.distance(Const.COORDS_BY_USER,ee),ne,le=JXG$1.evaluate(this.visProp.selection);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(U=this.board._inputDevice,$=JXG$1.evaluate(this.visProp.precision[U])):$=this.board.options.precision.hasPoint,$/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),ne=Math.abs(ie-Q)<$,ne&&(H=Geometry.rad(this.point2,this.center,ee.usrCoords.slice(1)),F=0,O=Geometry.rad(this.point2,this.center,this.point3),(le==="minor"&&O>Math.PI||le==="major"&&O<Math.PI)&&(F=O,O=2*Math.PI),(H<F||H>O)&&(ne=!1)),ne},C.hasPointSector=function(V,T){var H,F=new Coords(Const.COORDS_BY_SCREEN,[V,T],this.board),O=this.Radius(),$=this.point1.coords.distance(Const.COORDS_BY_USER,F),U,ee,Q=$<O,ie=JXG$1.evaluate(this.visProp.selection);return Q&&(H=Geometry.rad(this.radiuspoint,this.center,F.usrCoords.slice(1)),U=0,ee=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),(ie==="minor"&&ee>Math.PI||ie==="major"&&ee<Math.PI)&&(U=ee,ee=2*Math.PI),(H<U||H>ee)&&(Q=!1)),Q},C.hasPoint=function(V,T){return JXG$1.evaluate(this.visProp.highlightonsector)||JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(V,T):this.hasPointCurve(V,T)},C.getTextAnchor=function(){return this.point1.coords},C.getLabelAnchor=function(){var V,T,H,F,O,$=Geometry.rad(this.point2,this.point1,this.point3),U=13/this.board.unitX,ee=13/this.board.unitY,Q=this.point2.coords.usrCoords,ie=this.point1.coords.usrCoords,ne=Q[1]-ie[1],le=Q[2]-ie[2],ae=JXG$1.evaluate(this.visProp.selection),ce=this.label?this.label.visProp:this.visProp.label;return(ae==="minor"&&$>Math.PI||ae==="major"&&$<Math.PI)&&($=-(2*Math.PI-$)),V=new Coords(Const.COORDS_BY_USER,[ie[1]+Math.cos($*.5)*ne-Math.sin($*.5)*le,ie[2]+Math.sin($*.5)*ne+Math.cos($*.5)*le],this.board),H=V.usrCoords[1]-ie[1],F=V.usrCoords[2]-ie[2],O=Mat.hypot(H,F),H=H*(O+U)/O,F=F*(O+ee)/O,T=[ie[1]+H,ie[2]+F],ce.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],T)),new Coords(Const.COORDS_BY_USER,T,this.board)},C.setRadius=function(V){var T,H=JXG$1.evaluate(V);V==="auto"||H==="auto"?T="auto":JXG$1.isNumber(V)?T="number":JXG$1.isFunction(V)&&!JXG$1.isString(H)?T="function":T="undefined",T!=="undefined"&&(this.visProp.radius=V),C.Radius=function(){var F=JXG$1.evaluate(V);return F==="auto"?this.autoRadius():F}},C.getRadius=function(){return JXG$1.deprecated("Sector.getRadius()","Sector.Radius()"),this.Radius()},C.Value=function(V){return this.arc.Value(V)},C.L=function(){return this.arc.L()},C.Area=function(){var V=this.Radius();return .5*V*V*this.Value("radians")},C.Perimeter=function(){return this.L()+2*this.Radius()},y==="3points"&&(C.setPositionDirectly=function(V,T,H){var F,O,$=new Coords(V,T,this.board),U=new Coords(V,H,this.board);return!C.point1.draggable()||!C.point2.draggable()||!C.point3.draggable()?this:(F=Statistics.subtract($.usrCoords,U.usrCoords),O=this.board.create("transform",F.slice(1),{type:"translate"}),O.applyOnce([C.point1,C.point2,C.point3]),this)}),C.methodMap=JXG$1.deepCopy(C.methodMap,{radius:"Radius",Radius:"Radius",getRadius:"Radius",setRadius:"setRadius",Value:"Value",L:"L",Area:"Area",Perimeter:"Perimeter"}),C};JXG$1.registerElement("sector",JXG$1.createSector);JXG$1.createCircumcircleSector=function(u,n,d){var C,I,f,y;if(y=JXG$1.providePoints(u,n,d,"point"),y===!1)throw new Error("JSXGraph: Can't create circumcircle sector with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+"'.");return I=u.create("circumcenter",y.slice(0,3),f),I.dump=!1,f=JXG$1.copyAttributes(d,u.options,"circumcirclesector"),C=u.create("sector",[I,y[0],y[2],y[1]],f),C.elType="circumcirclesector",C.setParents(y),C.center=I,C.subs={center:I},C};JXG$1.registerElement("circumcirclesector",JXG$1.createCircumcircleSector);JXG$1.createMinorSector=function(u,n,d){return d.selection="minor",JXG$1.createSector(u,n,d)};JXG$1.registerElement("minorsector",JXG$1.createMinorSector);JXG$1.createMajorSector=function(u,n,d){return d.selection="major",JXG$1.createSector(u,n,d)};JXG$1.registerElement("majorsector",JXG$1.createMajorSector);JXG$1.createAngle=function(u,n,d){var C,I,f,y,B,_,Z="invalid";if(n[0].elementClass===Const.OBJECT_CLASS_LINE&&n[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(n[2])||JXG$1.isNumber(n[2]))&&(JXG$1.isArray(n[3])||JXG$1.isNumber(n[3])))Z="2lines";else{if(f={name:""},_=JXG$1.providePoints(u,n,f,"point"),_===!1)throw new Error("JSXGraph: Can't create angle with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"' and '"+typeof n[2]+"'.");Z="3points"}if(f=JXG$1.copyAttributes(d,u.options,"angle"),JXG$1.exists(f.name)||(f.name=u.generateName({type:Const.OBJECT_TYPE_ANGLE})),JXG$1.exists(f.radius)?I=f.radius:I=0,u.suspendUpdate(),Z==="2lines"?(n.push(I),C=u.create("sector",n,f),C.updateDataArraySector=C.updateDataArray,C.setAngle=function(M){},C.free=function(M){}):(C=u.create("sector",[_[1],_[0],_[2]],f),C.arc.visProp.priv=!0,C.point=C.point2=C.radiuspoint=_[0],C.pointsquare=C.point3=C.anglepoint=_[2],C.Radius=function(){var M=JXG$1.evaluate(I);return M==="auto"?C.autoRadius():M},C.updateDataArraySector=function(){var M=this.point2,V=this.point1,T=this.point3,H=this.Radius(),F=V.Dist(M),O,$,U=1,ee=JXG$1.evaluate(this.visProp.selection);$=Geometry.rad(M,V,T),(ee==="minor"&&$>Math.PI||ee==="major"&&$<Math.PI)&&(U=-1),M=M.coords.usrCoords,V=V.coords.usrCoords,T=T.coords.usrCoords,M=[1,V[1]+(M[1]-V[1])*H/F,V[2]+(M[2]-V[2])*H/F],T=[1,V[1]+(T[1]-V[1])*H/F,V[2]+(T[2]-V[2])*H/F],O=Geometry.bezierArc(M,V,T,!0,U),this.dataX=O[0],this.dataY=O[1],this.bezierDegree=3},C.setAngle=function(M){var V,T,H,F=this.anglepoint,O=this.radiuspoint;return F.draggable()&&(V=this.board.create("transform",[M,this.center],{type:"rotate"}),F.addTransform(O,V),V.update(),F.moveTo(Mat.matVecMult(V.matrix,O.coords.usrCoords)),JXG$1.isFunction(M)?H=function(){return Math.PI*2-M()}:H=function(){return Math.PI*2-M},T=this.board.create("transform",[H,this.center],{type:"rotate"}),F.coords.on("update",function(){T.update(),O.moveTo(Mat.matVecMult(T.matrix,F.coords.usrCoords))}),F.setParents(O),this.hasFixedAngle=!0),this},C.free=function(){var M=this.anglepoint;return M.transformations.length>0&&(M.transformations.pop(),M.isDraggable=!0,M.parents=[],M.coords.off("update")),this.hasFixedAngle=!1,this},C.setParents(_)),JXG$1.exists(C.visProp.text)&&C.label.setText(JXG$1.evaluate(C.visProp.text)),C.elType="angle",C.type=Const.OBJECT_TYPE_ANGLE,C.subs={},C.updateDataArraySquare=function(){var M,V,T,H,F,O,$,U,ee=this.Radius();Z==="2lines"&&this.updateDataArraySector(),M=this.point2,V=this.point1,T=this.point3,M=M.coords.usrCoords,V=V.coords.usrCoords,T=T.coords.usrCoords,H=Geometry.distance(M,V,3),F=Geometry.distance(T,V,3),M=[1,V[1]+(M[1]-V[1])*ee/H,V[2]+(M[2]-V[2])*ee/H],T=[1,V[1]+(T[1]-V[1])*ee/F,V[2]+(T[2]-V[2])*ee/F],O=Mat.crossProduct(T,V),$=[-M[1]*O[1]-M[2]*O[2],M[0]*O[1],M[0]*O[2]],O=Mat.crossProduct(M,V),U=[-T[1]*O[1]-T[2]*O[2],T[0]*O[1],T[0]*O[2]],O=Mat.crossProduct($,U),O[1]/=O[0],O[2]/=O[0],this.dataX=[V[1],M[1],O[1],T[1],V[1]],this.dataY=[V[2],M[2],O[2],T[2],V[2]],this.bezierDegree=1},C.updateDataArrayNone=function(){this.dataX=[NaN],this.dataY=[NaN],this.bezierDegree=1},C.updateDataArray=function(){var M=JXG$1.evaluate(this.visProp.type),V=Geometry.trueAngle(this.point2,this.point1,this.point3),T=JXG$1.evaluate(this.visProp.selection);(T==="minor"&&V>180||T==="major"&&V<180)&&(V=360-V),Math.abs(V-90)<JXG$1.evaluate(this.visProp.orthosensitivity)+Mat.eps&&(M=JXG$1.evaluate(this.visProp.orthotype)),M==="none"?this.updateDataArrayNone():M==="square"?this.updateDataArraySquare():M==="sector"?this.updateDataArraySector():M==="sectordot"&&(this.updateDataArraySector(),this.dot.visProp.visible||this.dot.setAttribute({visible:!0})),(!this.visProp.visible||M!=="sectordot"&&this.dot.visProp.visible)&&this.dot.setAttribute({visible:!1})},y=JXG$1.copyAttributes(d,u.options,"angle","dot"),C.dot=u.create("point",[function(){var M,V,T,H,F,O,$,U,ee;return JXG$1.exists(C.dot)&&!C.dot.visProp.visible?[0,0]:(M=C.point2.coords.usrCoords,V=C.point1.coords.usrCoords,T=C.Radius(),H=Geometry.distance(M,V,3),F=Geometry.rad(C.point2,C.point1,C.point3),ee=JXG$1.evaluate(C.visProp.selection),(ee==="minor"&&F>Math.PI||ee==="major"&&F<Math.PI)&&(F=-(2*Math.PI-F)),F*=.5,O=Math.cos(F),$=Math.sin(F),M=[1,V[1]+(M[1]-V[1])*T/H,V[2]+(M[2]-V[2])*T/H],U=[[1,0,0],[V[1]-.5*V[1]*O+.5*V[2]*$,O*.5,-$*.5],[V[2]-.5*V[1]*$-.5*V[2]*O,$*.5,O*.5]],Mat.matVecMult(U,M))}],y),C.dot.dump=!1,C.subs.dot=C.dot,Z==="2lines")for(B=0;B<2;B++)u.select(n[B]).addChild(C.dot);else for(B=0;B<3;B++)u.select(_[B]).addChild(C.dot);return u.unsuspendUpdate(),C.Value=function(M){return M=M||"radians",M===""&&(M="radians"),C.arc.Value(M)},C.getLabelAnchor=function(){var M,V=12,T,H,F,O,$,U,ee,Q,ie=JXG$1.evaluate(C.visProp.selection),ne=this.label?this.label.visProp:this.visProp.label;return JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp.fontsize)&&(V=JXG$1.evaluate(this.label.visProp.fontsize)),V/=this.board.unitX,T=C.point2.coords.usrCoords,H=C.point1.coords.usrCoords,F=C.Radius(),O=Geometry.distance(T,H,3),$=Geometry.rad(C.point2,C.point1,C.point3),(ie==="minor"&&$>Math.PI||ie==="major"&&$<Math.PI)&&($=-(2*Math.PI-$)),$*=.5,U=Math.cos($),ee=Math.sin($),T=[1,H[1]+(T[1]-H[1])*F/O,H[2]+(T[2]-H[2])*F/O],Q=[[1,0,0],[H[1]-.5*H[1]*U+.5*H[2]*ee,U*.5,-ee*.5],[H[2]-.5*H[1]*ee-.5*H[2]*U,ee*.5,U*.5]],M=Mat.matVecMult(Q,T),M[1]/=M[0],M[2]/=M[0],M[0]/=M[0],O=Geometry.distance(M,H,3),M=[M[0],H[1]+(M[1]-H[1])*(F+V)/O,H[2]+(M[2]-H[2])*(F+V)/O],ne.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],M)),new Coords(Const.COORDS_BY_USER,M,this.board)},C.methodMap=JXG$1.deepCopy(C.methodMap,{setAngle:"setAngle",Value:"Value",free:"free"}),C};JXG$1.registerElement("angle",JXG$1.createAngle);JXG$1.createNonreflexAngle=function(u,n,d){var C;return d.selection="minor",d=JXG$1.copyAttributes(d,u.options,"nonreflexangle"),C=JXG$1.createAngle(u,n,d),C.Value=function(I){var f=Geometry.rad(this.point2,this.point1,this.point3);return I=I||"radians",I===""&&(I="radians"),f=f<Math.PI?f:2*Math.PI-f,this.arc.Value(I,f)},C};JXG$1.registerElement("nonreflexangle",JXG$1.createNonreflexAngle);JXG$1.createReflexAngle=function(u,n,d){var C;return d.selection="major",d=JXG$1.copyAttributes(d,u.options,"reflexangle"),C=JXG$1.createAngle(u,n,d),C.Value=function(I){var f=Geometry.rad(this.point2,this.point1,this.point3);return I=I||"radians",I===""&&(I="radians"),f=f>=Math.PI?f:2*Math.PI-f,this.arc.Value(I,f)},C};JXG$1.registerElement("reflexangle",JXG$1.createReflexAngle);JXG$1.createOrthogonalProjection=function(u,n,d){var C,I,f,y;if(n[0]=u.select(n[0]),n[1]=u.select(n[1]),JXG$1.isPointType(u,n[0])&&n[1].elementClass===Const.OBJECT_CLASS_LINE)I=JXG$1.providePoints(u,[n[0]],d,"point")[0],C=n[1];else if(JXG$1.isPointType(u,n[1])&&n[0].elementClass===Const.OBJECT_CLASS_LINE)I=JXG$1.providePoints(u,[n[1]],d,"point")[0],C=n[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line]`);return y=JXG$1.copyAttributes(d,u.options,"orthogonalprojection"),f=u.create("point",[function(){return Geometry.projectPointToLine(I,C,u)}],y),JXG$1.exists(I._is_new)?(f.addChild(I),delete I._is_new):I.addChild(f),C.addChild(f),f.elType="orthogonalprojection",f.setParents([I.id,f.id]),f.update(),f.generatePolynomial=function(){var B=C.point1.symbolic.x,_=C.point1.symbolic.y,Z=C.point2.symbolic.x,M=C.point2.symbolic.y,V=I.symbolic.x,T=I.symbolic.y,H=f.symbolic.x,F=f.symbolic.y,O="("+_+")*("+H+")-("+_+")*("+Z+")+("+F+")*("+Z+")-("+B+")*("+F+")+("+B+")*("+M+")-("+H+")*("+M+")",$="("+T+")*("+_+")-("+T+")*("+M+")-("+F+")*("+_+")+("+F+")*("+M+")+("+V+")*("+B+")-("+V+")*("+Z+")-("+H+")*("+B+")+("+H+")*("+Z+")";return[O,$]},f};JXG$1.createPerpendicular=function(u,n,d){var C,I,f,y;if(n[0]=u.select(n[0]),n[1]=u.select(n[1]),JXG$1.isPointType(u,n[0])&&n[1].elementClass===Const.OBJECT_CLASS_LINE)I=n[1],C=JXG$1.providePoints(u,[n[0]],d,"point")[0];else if(JXG$1.isPointType(u,n[1])&&n[0].elementClass===Const.OBJECT_CLASS_LINE)I=n[0],C=JXG$1.providePoints(u,[n[1]],d,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [line,point]`);return y=JXG$1.copyAttributes(d,u.options,"perpendicular"),f=JXG$1.createLine(u,[function(){return I.stdform[2]*C.X()-I.stdform[1]*C.Y()},function(){return-I.stdform[2]*C.Z()},function(){return I.stdform[1]*C.Z()}],y),f.elType="perpendicular",f.setParents([I.id,C.id]),JXG$1.exists(C._is_new)?(f.addChild(C),delete C._is_new):C.addChild(f),I.addChild(f),f};JXG$1.createPerpendicularPoint=function(u,n,d){var C,I,f;if(n[0]=u.select(n[0]),n[1]=u.select(n[1]),JXG$1.isPointType(u,n[0])&&n[1].elementClass===Const.OBJECT_CLASS_LINE)I=JXG$1.providePoints(u,[n[0]],d,"point")[0],C=n[1];else if(JXG$1.isPointType(u,n[1])&&n[0].elementClass===Const.OBJECT_CLASS_LINE)I=JXG$1.providePoints(u,[n[1]],d,"point")[0],C=n[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,line]`);return f=u.create("point",[function(){return Geometry.perpendicular(C,I,u)[0]}],d),JXG$1.exists(I._is_new)?(f.addChild(I),delete I._is_new):I.addChild(f),C.addChild(f),f.elType="perpendicularpoint",f.setParents([I.id,C.id]),f.update(),f.generatePolynomial=function(){var y=C.point1.symbolic.x,B=C.point1.symbolic.y,_=C.point2.symbolic.x,Z=C.point2.symbolic.y,M=I.symbolic.x,V=I.symbolic.y,T=f.symbolic.x,H=f.symbolic.y,F="("+B+")*("+T+")-("+B+")*("+_+")+("+H+")*("+_+")-("+y+")*("+H+")+("+y+")*("+Z+")-("+T+")*("+Z+")",O="("+V+")*("+B+")-("+V+")*("+Z+")-("+H+")*("+B+")+("+H+")*("+Z+")+("+M+")*("+y+")-("+M+")*("+_+")-("+T+")*("+y+")+("+T+")*("+_+")";return[F,O]},f};JXG$1.createPerpendicularSegment=function(u,n,d){var C,I,f,y,B;if(n[0]=u.select(n[0]),n[1]=u.select(n[1]),JXG$1.isPointType(u,n[0])&&n[1].elementClass===Const.OBJECT_CLASS_LINE)I=n[1],C=JXG$1.providePoints(u,[n[0]],d,"point")[0];else if(JXG$1.isPointType(u,n[1])&&n[0].elementClass===Const.OBJECT_CLASS_LINE)I=n[0],C=JXG$1.providePoints(u,[n[1]],d,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [line,point]`);return B=JXG$1.copyAttributes(d,u.options,"perpendicularsegment","point"),y=JXG$1.createPerpendicularPoint(u,[I,C],B),y.dump=!1,JXG$1.exists(d.layer)||(d.layer=u.options.layer.line),B=JXG$1.copyAttributes(d,u.options,"perpendicularsegment"),f=JXG$1.createLine(u,[function(){return Geometry.perpendicular(I,C,u)[1]?[y,C]:[C,y]}],B),f.point=y,JXG$1.exists(C._is_new)?(f.addChild(C),delete C._is_new):C.addChild(f),I.addChild(f),f.elType="perpendicularsegment",f.setParents([C.id,I.id]),f.subs={point:y},f.inherits.push(y),f};JXG$1.createMidpoint=function(u,n,d){var C,I,f,y,B;for(y=0;y<n.length;++y)n[y]=u.select(n[y]);if(n.length===2&&JXG$1.isPointType(u,n[0])&&JXG$1.isPointType(u,n[1]))n=JXG$1.providePoints(u,n,d,"point"),C=n[0],I=n[1];else if(n.length===1&&n[0].elementClass===Const.OBJECT_CLASS_LINE)C=n[0].point1,I=n[0].point2;else throw new Error(`JSXGraph: Can't create midpoint.
Possible parent types: [point,point], [line]`);return B=JXG$1.copyAttributes(d,u.options,"midpoint"),f=u.create("point",[function(){var _=C.coords.usrCoords[1]+I.coords.usrCoords[1];return isNaN(_)||Math.abs(C.coords.usrCoords[0])<Mat.eps||Math.abs(I.coords.usrCoords[0])<Mat.eps?NaN:_*.5},function(){var _=C.coords.usrCoords[2]+I.coords.usrCoords[2];return isNaN(_)||Math.abs(C.coords.usrCoords[0])<Mat.eps||Math.abs(I.coords.usrCoords[0])<Mat.eps?NaN:_*.5}],B),JXG$1.exists(C._is_new)?(f.addChild(C),delete C._is_new):C.addChild(f),JXG$1.exists(I._is_new)?(f.addChild(I),delete I._is_new):I.addChild(f),f.elType="midpoint",f.setParents([C.id,I.id]),f.prepareUpdate().update(),f.generatePolynomial=function(){var _=C.symbolic.x,Z=C.symbolic.y,M=I.symbolic.x,V=I.symbolic.y,T=f.symbolic.x,H=f.symbolic.y,F="("+Z+")*("+T+")-("+Z+")*("+M+")+("+H+")*("+M+")-("+_+")*("+H+")+("+_+")*("+V+")-("+T+")*("+V+")",O="("+_+")^2 - 2*("+_+")*("+T+")+("+Z+")^2-2*("+Z+")*("+H+")-("+M+")^2+2*("+M+")*("+T+")-("+V+")^2+2*("+V+")*("+H+")";return[F,O]},f};JXG$1.createParallelPoint=function(u,n,d){var C,I,f,y,B,_;for(B=0;B<n.length;++B)n[B]=u.select(n[B]);if(n.length===3&&JXG$1.isPointType(u,n[0])&&JXG$1.isPointType(u,n[1])&&JXG$1.isPointType(u,n[2]))n=JXG$1.providePoints(u,n,d,"point"),C=n[0],I=n[1],f=n[2];else if(JXG$1.isPointType(u,n[0])&&n[1].elementClass===Const.OBJECT_CLASS_LINE)f=JXG$1.providePoints(u,[n[0]],d,"point")[0],C=n[1].point1,I=n[1].point2;else if(JXG$1.isPointType(u,n[1])&&n[0].elementClass===Const.OBJECT_CLASS_LINE)f=JXG$1.providePoints(u,[n[1]],d,"point")[0],C=n[0].point1,I=n[0].point2;else throw new Error("JSXGraph: Can't create parallel point with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [line,point], [point,point,point]`);return _=JXG$1.copyAttributes(d,u.options,"parallelpoint"),y=u.create("point",[function(){return f.coords.usrCoords[1]+I.coords.usrCoords[1]-C.coords.usrCoords[1]},function(){return f.coords.usrCoords[2]+I.coords.usrCoords[2]-C.coords.usrCoords[2]}],_),JXG$1.exists(C._is_new)?(y.addChild(C),delete C._is_new):C.addChild(y),JXG$1.exists(I._is_new)?(y.addChild(I),delete I._is_new):I.addChild(y),JXG$1.exists(f._is_new)?(y.addChild(f),delete f._is_new):f.addChild(y),y.elType="parallelpoint",y.setParents([C.id,I.id,f.id]),y.prepareUpdate().update(),y.generatePolynomial=function(){var Z=C.symbolic.x,M=C.symbolic.y,V=I.symbolic.x,T=I.symbolic.y,H=f.symbolic.x,F=f.symbolic.y,O=y.symbolic.x,$=y.symbolic.y,U="("+T+")*("+O+")-("+T+")*("+H+")-("+M+")*("+O+")+("+M+")*("+H+")-("+$+")*("+V+")+("+$+")*("+Z+")+("+F+")*("+V+")-("+F+")*("+Z+")",ee="("+$+")*("+Z+")-("+$+")*("+H+")-("+T+")*("+Z+")+("+T+")*("+H+")-("+O+")*("+M+")+("+O+")*("+F+")+("+V+")*("+M+")-("+V+")*("+F+")";return[U,ee]},y};JXG$1.createParallel=function(u,n,d){var C,I,f,y,B,_,Z=1;for(B=0;B<n.length;++B)n[B]=u.select(n[B]);return C=null,n.length===3?(n=JXG$1.providePoints(u,n,d,"point"),C=n[2],Z=0):JXG$1.isPointType(u,n[0])?(C=JXG$1.providePoints(u,[n[0]],d,"point")[0],y=function(){return n[1].stdform}):JXG$1.isPointType(u,n[1])&&(C=JXG$1.providePoints(u,[n[1]],d,"point")[0],y=function(){return n[0].stdform}),JXG$1.exists(d.layer)||(d.layer=u.options.layer.line),_=JXG$1.copyAttributes(d,u.options,"parallel","point"),Z===1?I=u.create("point",[function(){return Mat.crossProduct([1,0,0],y())}],_):I=u.create("parallelpoint",n,_),I.isDraggable=!0,_=JXG$1.copyAttributes(d,u.options,"parallel"),f=u.create("line",[C,I],_),f.elType="parallel",f.subs={point:I},f.inherits.push(I),f.setParents([n[0].id,n[1].id]),n.length===3&&f.addParents(n[2].id),f.point=I,f};JXG$1.createArrowParallel=function(u,n,d){var C,I;try{return I=JXG$1.copyAttributes(d,u.options,"arrowparallel"),I.lastArrow===!1&&(I.lastArrow=!0),C=JXG$1.createParallel(u,n,I).setAttribute({straightFirst:!1,straightLast:!1}),C.type=Const.OBJECT_TYPE_VECTOR,C.elType="arrowparallel",C}catch{throw new Error("JSXGraph: Can't create arrowparallel with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [line,point], [point,point,point]`)}};JXG$1.createBisector=function(u,n,d){var C,I,f,y;if(n=JXG$1.providePoints(u,n,d,"point"),JXG$1.isPoint(n[0])&&JXG$1.isPoint(n[1])&&JXG$1.isPoint(n[2])){for(y=JXG$1.copyAttributes(d,u.options,"bisector","point"),y.snapToGrid=!1,C=u.create("point",[function(){return Geometry.angleBisector(n[0],n[1],n[2],u)}],y),C.dump=!1,f=0;f<3;f++)JXG$1.exists(n[f]._is_new)?(C.addChild(n[f]),delete n[f]._is_new):n[f].addChild(C);return JXG$1.exists(d.layer)||(d.layer=u.options.layer.line),y=JXG$1.copyAttributes(d,u.options,"bisector"),I=JXG$1.createLine(u,[n[1],C],y),I.point=C,I.elType="bisector",I.setParents(n),I.subs={point:C},I.inherits.push(C),I}throw new Error("JSXGraph: Can't create angle bisector with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createAngularBisectorsOfTwoLines=function(u,n,d){var C,I,f,y,B=u.select(n[0]),_=u.select(n[1]);if(B.elementClass!==Const.OBJECT_CLASS_LINE||_.elementClass!==Const.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create angle bisectors of two lines with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [line,line]`);return JXG$1.exists(d.layer)||(d.layer=u.options.layer.line),f=JXG$1.copyAttributes(d,u.options,"bisectorlines","line1"),C=u.create("line",[function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[0]/Z-_.stdform[0]/M},function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[1]/Z-_.stdform[1]/M},function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[2]/Z-_.stdform[2]/M}],f),JXG$1.exists(d.layer)||(d.layer=u.options.layer.line),f=JXG$1.copyAttributes(d,u.options,"bisectorlines","line2"),I=u.create("line",[function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[0]/Z+_.stdform[0]/M},function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[1]/Z+_.stdform[1]/M},function(){var Z=Mat.hypot(B.stdform[1],B.stdform[2]),M=Mat.hypot(_.stdform[1],_.stdform[2]);return B.stdform[2]/Z+_.stdform[2]/M}],f),y=new Composition({line1:C,line2:I}),C.dump=!1,I.dump=!1,y.elType="bisectorlines",y.setParents([B.id,_.id]),y.subs={line1:C,line2:I},y};JXG$1.createCircumcenter=function(u,n,d){var C,I,f,y,B;if(n=JXG$1.providePoints(u,n,d,"point"),JXG$1.isPoint(n[0])&&JXG$1.isPoint(n[1])&&JXG$1.isPoint(n[2])){for(f=n[0],y=n[1],B=n[2],C=JXG$1.createPoint(u,[function(){return Geometry.circumcenter(f,y,B,u)}],d),I=0;I<3;I++)JXG$1.exists(n[I]._is_new)?(C.addChild(n[I]),delete n[I]._is_new):n[I].addChild(C);return C.elType="circumcenter",C.setParents(n),C.generatePolynomial=function(){var _=f.symbolic.x,Z=f.symbolic.y,M=y.symbolic.x,V=y.symbolic.y,T=B.symbolic.x,H=B.symbolic.y,F=C.symbolic.x,O=C.symbolic.y,$=["((",F,")-(",_,"))^2+((",O,")-(",Z,"))^2-((",F,")-(",M,"))^2-((",O,")-(",V,"))^2"].join(""),U=["((",F,")-(",_,"))^2+((",O,")-(",Z,"))^2-((",F,")-(",T,"))^2-((",O,")-(",H,"))^2"].join("");return[$,U]},C}throw new Error("JSXGraph: Can't create circumcircle midpoint with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createIncenter=function(u,n,d){var C,I,f,y,B;if(n=JXG$1.providePoints(u,n,d,"point"),n.length>=3&&JXG$1.isPoint(n[0])&&JXG$1.isPoint(n[1])&&JXG$1.isPoint(n[2])){for(I=n[0],f=n[1],y=n[2],C=u.create("point",[function(){var _,Z,M;return _=Mat.hypot(f.X()-y.X(),f.Y()-y.Y()),Z=Mat.hypot(I.X()-y.X(),I.Y()-y.Y()),M=Mat.hypot(f.X()-I.X(),f.Y()-I.Y()),new Coords(Const.COORDS_BY_USER,[(_*I.X()+Z*f.X()+M*y.X())/(_+Z+M),(_*I.Y()+Z*f.Y()+M*y.Y())/(_+Z+M)],u)}],d),B=0;B<3;B++)JXG$1.exists(n[B]._is_new)?(C.addChild(n[B]),delete n[B]._is_new):n[B].addChild(C);C.elType="incenter",C.setParents(n)}else throw new Error("JSXGraph: Can't create incenter with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`);return C};JXG$1.createCircumcircle=function(u,n,d){var C,I,f,y;if(n=JXG$1.providePoints(u,n,d,"point"),n===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`);try{for(f=JXG$1.copyAttributes(d,u.options,"circumcircle","center"),C=JXG$1.createCircumcenter(u,n,f),C.dump=!1,JXG$1.exists(d.layer)||(d.layer=u.options.layer.circle),f=JXG$1.copyAttributes(d,u.options,"circumcircle"),I=JXG$1.createCircle(u,[C,n[0]],f),I.elType="circumcircle",I.setParents(n),I.subs={center:C},I.inherits.push(I),y=0;y<3;y++)JXG$1.exists(n[y]._is_new)?(I.addChild(n[y]),delete n[y]._is_new):n[y].addChild(I)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`)}return I};JXG$1.createIncircle=function(u,n,d){var C,I,f,y;if(n=JXG$1.providePoints(u,n,d,"point"),n===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`);try{for(y=JXG$1.copyAttributes(d,u.options,"incircle","center"),I=JXG$1.createIncenter(u,n,y),I.dump=!1,JXG$1.exists(d.layer)||(d.layer=u.options.layer.circle),y=JXG$1.copyAttributes(d,u.options,"incircle"),f=JXG$1.createCircle(u,[I,function(){var B=Mat.hypot(n[1].X()-n[2].X(),n[1].Y()-n[2].Y()),_=Mat.hypot(n[0].X()-n[2].X(),n[0].Y()-n[2].Y()),Z=Mat.hypot(n[1].X()-n[0].X(),n[1].Y()-n[0].Y()),M=(B+_+Z)/2;return Math.sqrt((M-B)*(M-_)*(M-Z)/M)}],y),f.elType="incircle",f.setParents(n),C=0;C<3;C++)JXG$1.exists(n[C]._is_new)?(f.addChild(n[C]),delete n[C]._is_new):n[C].addChild(f);f.center=I,f.subs={center:f.center},f.inherits.push(I)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof n[0]+"', '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point,point]`)}return f};JXG$1.createReflection=function(u,n,d){var C,I,f,y,B,_,Z,M,V=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, line]`;for(_=0;_<n.length;++_)n[_]=u.select(n[_]);if(Z=JXG$1.copyAttributes(d,u.options,"reflection"),JXG$1.isPoint(n[0]))I=JXG$1.providePoints(u,[n[0]],M)[0];else if(n[0].elementClass===Const.OBJECT_CLASS_CURVE||n[0].elementClass===Const.OBJECT_CLASS_LINE||n[0].type===Const.OBJECT_TYPE_POLYGON||n[0].elementClass===Const.OBJECT_CLASS_CIRCLE)I=n[0];else throw new Error("JSXGraph: Can't create reflection element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);if(n[1].elementClass===Const.OBJECT_CLASS_LINE)C=n[1];else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);if(B=JXG$1.createTransform(u,[C],{type:"reflect"}),JXG$1.isPoint(I))f=JXG$1.createPoint(u,[I,B],Z);else if(I.elementClass===Const.OBJECT_CLASS_CURVE)f=JXG$1.createCurve(u,[I,B],Z);else if(I.elementClass===Const.OBJECT_CLASS_LINE)f=JXG$1.createLine(u,[I,B],Z);else if(I.type===Const.OBJECT_TYPE_POLYGON)f=JXG$1.createPolygon(u,[I,B],Z);else if(I.elementClass===Const.OBJECT_CLASS_CIRCLE)Z.type.toLowerCase()==="euclidean"?(M=JXG$1.copyAttributes(d,u.options,"reflection","center"),y=JXG$1.createPoint(u,[I.center,B],M),y.prepareUpdate().update().updateVisibility(JXG$1.evaluate(y.visProp.visible)).updateRenderer(),f=JXG$1.createCircle(u,[y,function(){return I.Radius()}],Z)):f=JXG$1.createCircle(u,[I,B],Z);else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);return JXG$1.exists(I._is_new)&&(f.addChild(I),delete I._is_new),C.addChild(f),f.elType="reflection",f.addParents(C),f.prepareUpdate().update(),JXG$1.isPoint(f)&&(f.generatePolynomial=function(){var T=C.point1.symbolic.x,H=C.point1.symbolic.y,F=C.point2.symbolic.x,O=C.point2.symbolic.y,$=I.symbolic.x,U=I.symbolic.y,ee=f.symbolic.x,Q=f.symbolic.y,ie=["((",Q,")-(",U,"))*((",H,")-(",O,"))+((",T,")-(",F,"))*((",ee,")-(",$,"))"].join(""),ne=["((",ee,")-(",T,"))^2+((",Q,")-(",H,"))^2-((",$,")-(",T,"))^2-((",U,")-(",H,"))^2"].join("");return[ie,ne]}),f};JXG$1.createMirrorElement=function(u,n,d){var C,I,f,y,B,_,Z,M,V=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, point]`;for(I=0;I<n.length;++I)n[I]=u.select(n[I]);if(Z=JXG$1.copyAttributes(d,u.options,"mirrorelement"),JXG$1.isPoint(n[0]))C=JXG$1.providePoints(u,[n[0]],Z)[0];else if(n[0].elementClass===Const.OBJECT_CLASS_CURVE||n[0].elementClass===Const.OBJECT_CLASS_LINE||n[0].type===Const.OBJECT_TYPE_POLYGON||n[0].elementClass===Const.OBJECT_CLASS_CIRCLE)C=n[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);if(JXG$1.isPoint(n[1]))M=JXG$1.copyAttributes(d,u.options,"mirrorelement","point"),f=JXG$1.providePoints(u,[n[1]],M)[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);if(_=JXG$1.createTransform(u,[Math.PI,f],{type:"rotate"}),JXG$1.isPoint(C))y=JXG$1.createPoint(u,[C,_],Z);else if(C.elementClass===Const.OBJECT_CLASS_CURVE)y=JXG$1.createCurve(u,[C,_],Z);else if(C.elementClass===Const.OBJECT_CLASS_LINE)y=JXG$1.createLine(u,[C,_],Z);else if(C.type===Const.OBJECT_TYPE_POLYGON)y=JXG$1.createPolygon(u,[C,_],Z);else if(C.elementClass===Const.OBJECT_CLASS_CIRCLE)Z.type.toLowerCase()==="euclidean"?(M=JXG$1.copyAttributes(d,u.options,"mirrorelement","center"),B=JXG$1.createPoint(u,[C.center,_],M),B.prepareUpdate().update().updateVisibility(JXG$1.evaluate(B.visProp.visible)).updateRenderer(),y=JXG$1.createCircle(u,[B,function(){return C.Radius()}],Z)):y=JXG$1.createCircle(u,[C,_],Z);else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'."+V);return JXG$1.exists(C._is_new)&&(y.addChild(C),delete C._is_new),f.addChild(y),y.elType="mirrorelement",y.addParents(f),y.prepareUpdate().update(),y};JXG$1.createMirrorPoint=function(u,n,d){var C=JXG$1.createMirrorElement(u,n,d);return C.elType="mirrorpoint",C};JXG$1.createIntegral=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U=null,ee;if(JXG$1.isArray(n[0])&&n[1].elementClass===Const.OBJECT_CLASS_CURVE)C=n[0],I=n[1];else if(JXG$1.isArray(n[1])&&n[0].elementClass===Const.OBJECT_CLASS_CURVE)C=n[1],I=n[0];else throw new Error("JSXGraph: Can't create integral with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [[number|function,number|function],curve]`);return f=JXG$1.copyAttributes(d,u.options,"integral"),f.withLabel=!1,ee=u.create("curve",[[0],[0]],f),y=C[0],B=C[1],JXG$1.isFunction(y)?(_=y,Z=function(){return I.Y(_())},y=_()):(_=y,Z=I.Y(y)),JXG$1.isFunction(B)?(M=B,V=function(){return I.Y(M())},B=M()):(M=B,V=I.Y(B)),f=JXG$1.copyAttributes(d,u.options,"integral","curveleft"),T=u.create("glider",[_,Z,I],f),JXG$1.isFunction(_)&&T.hideElement(),f=JXG$1.copyAttributes(d,u.options,"integral","baseleft"),H=u.create("point",[function(){return JXG$1.evaluate(ee.visProp.axis)==="y"?0:T.X()},function(){return JXG$1.evaluate(ee.visProp.axis)==="y"?T.Y():0}],f),f=JXG$1.copyAttributes(d,u.options,"integral","curveright"),F=u.create("glider",[M,V,I],f),JXG$1.isFunction(M)&&F.hideElement(),f=JXG$1.copyAttributes(d,u.options,"integral","baseright"),O=u.create("point",[function(){return JXG$1.evaluate(ee.visProp.axis)==="y"?0:F.X()},function(){return JXG$1.evaluate(ee.visProp.axis)==="y"?F.Y():0}],f),f=JXG$1.copyAttributes(d,u.options,"integral"),f.withlabel!==!1&&f.axis!=="y"&&(f=JXG$1.copyAttributes(d,u.options,"integral","label"),f=JXG$1.copyAttributes(f,u.options,"label"),U=u.create("text",[function(){var Q=new Coords(Const.COORDS_BY_SCREEN,[JXG$1.evaluate(this.visProp.offset[0])+this.board.origin.scrCoords[1],0],this.board,!1),ie=this.board.getBoundingBox(),ne=(ie[2]-ie[0])*.1,le=F.X();return le<ie[0]?le=ie[0]+ne:le>ie[2]&&(le=ie[2]-ne),le+Q.usrCoords[1]},function(){var Q=new Coords(Const.COORDS_BY_SCREEN,[0,JXG$1.evaluate(this.visProp.offset[1])+this.board.origin.scrCoords[2]],this.board,!1),ie=this.board.getBoundingBox(),ne=(ie[1]-ie[3])*.1,le=F.Y();return le>ie[1]?le=ie[1]-ne:le<ie[3]&&(le=ie[3]+ne),le+Q.usrCoords[2]},""],f),$=function(){var Q=Numerics.NewtonCotes([H.X(),O.X()],I.Y),ie=JXG$1.evaluate(U.visProp.digits),ne;return U.useLocale()?ne=U.formatNumberLocale(Q,ie):ne=JXG$1.toFixed(Q,ie),"&int; = "+ne},U.setText($),U.dump=!1,T.addChild(U),F.addChild(U)),T.dump=!1,H.dump=!1,F.dump=!1,O.dump=!1,ee.elType="integral",ee.setParents([I.id,C]),ee.subs={curveLeft:T,baseLeft:H,curveRight:F,baseRight:O},ee.inherits.push(T,H,F,O),f.withLabel&&(ee.subs.label=U,ee.inherits.push(U)),ee.Value=function(){return Numerics.I([H.X(),O.X()],I.Y)},ee.updateDataArray=function(){var Q,ie,ne,le,ae,ce,ge,he,Ie;if(JXG$1.evaluate(this.visProp.axis)==="y"){for(T.Y()<F.Y()?(ce=T.X(),he=T.Y(),ge=F.X(),Ie=F.Y()):(ce=F.X(),he=F.Y(),ge=T.X(),Ie=T.Y()),le=Math.min(ce,ge),ae=Math.max(ce,ge),Q=[0,ce],ie=[he,he],ne=0;ne<I.numberPoints;ne++)he<=I.points[ne].usrCoords[2]&&le<=I.points[ne].usrCoords[1]&&I.points[ne].usrCoords[2]<=Ie&&I.points[ne].usrCoords[1]<=ae&&(Q.push(I.points[ne].usrCoords[1]),ie.push(I.points[ne].usrCoords[2]));Q.push(ge),ie.push(Ie),Q.push(0),ie.push(Ie),Q.push(0),ie.push(he)}else{for(H.X()<O.X()?(le=H.X(),ae=O.X()):(le=O.X(),ae=H.X()),Q=[le,le],ie=[0,I.Y(le)],ne=0;ne<I.numberPoints;ne++)le<=I.points[ne].usrCoords[1]&&I.points[ne].usrCoords[1]<=ae&&(Q.push(I.points[ne].usrCoords[1]),ie.push(I.points[ne].usrCoords[2]));Q.push(ae),ie.push(I.Y(ae)),Q.push(ae),ie.push(0),Q.push(le),ie.push(0)}this.dataX=Q,this.dataY=ie},T.addChild(ee),F.addChild(ee),H.addChild(ee),O.addChild(ee),ee.baseLeft=H,ee.baseRight=O,ee.curveLeft=T,ee.curveRight=F,ee.methodMap=JXG$1.deepCopy(ee.methodMap,{curveLeft:"curveLeft",baseLeft:"baseLeft",curveRight:"curveRight",baseRight:"baseRight",Value:"Value"}),ee.label=U,ee};JXG$1.createInequality=function(u,n,d){var C,I,f;if(f=JXG$1.copyAttributes(d,u.options,"inequality"),n[0].elementClass===Const.OBJECT_CLASS_LINE)I=u.create("curve",[[],[]],f),I.hasPoint=function(){return!1},I.updateDataArray=function(){var y,B,_,Z=u.getBoundingBox(),M=JXG$1.evaluate(this.visProp.inverse),V=M?-1:1,T=1.5,H=T*Math.max(Z[2]-Z[0],Z[1]-Z[3]),F={coords:{usrCoords:[1,(Z[0]+Z[2])*.5,M?Z[1]:Z[3]]}},O=n[0].stdform.slice(1),$=O;_=T*Math.max(Geometry.perpendicular(n[0],F,u)[0].distance(Const.COORDS_BY_USER,F.coords),H),_*=V,F={coords:{usrCoords:[1,(Z[0]+Z[2])*.5,(Z[1]+Z[3])*.5]}},Math.abs(Mat.innerProduct(F.coords.usrCoords,n[0].stdform,3))>=Mat.eps?F=Geometry.perpendicular(n[0],F,u)[0].usrCoords:F=F.coords.usrCoords,y=[1,F[1]+O[1]*H,F[2]-O[0]*H],B=[1,F[1]-$[1]*H,F[2]+$[0]*H],this.dataX=[y[1],y[1]+O[0]*_,B[1]+$[0]*_,B[1],y[1]],this.dataY=[y[2],y[2]+O[1]*_,B[2]+$[1]*_,B[2],y[2]]};else if(n[0].elementClass===Const.OBJECT_CLASS_CURVE&&n[0].visProp.curvetype==="functiongraph")I=u.create("curve",[[],[]],f),I.updateDataArray=function(){var y=this.board.getBoundingBox(),B=[],_,Z,M,V,T,H=n[0].minX(),F=n[0].maxX(),O,$,U,ee,Q=(y[1]-y[3])*.3,ie=JXG$1.evaluate(this.visProp.inverse);if(_=ie?1:3,this.dataX=[],this.dataY=[],V=n[0].points.length,V!==0)for(y[1]+=Q,y[3]-=Q,M=-1;M<V-1;){for(T=M+1,Z=V;T<V;T++)if(n[0].points[T].isReal()){Z=T;break}if(Z>=V)break;for(T=Z,M=V-1;T<V-1;T++)if(!n[0].points[T+1].isReal()){M=T;break}for(U=n[0].points[Z].usrCoords[1],ee=n[0].points[M].usrCoords[1],O=y[0]<H?H:y[0],$=y[2]>F?F:y[2],O=Z===0?O:Math.max(O,U),$=M===V-1?$:Math.min($,ee),O=Z===0?H:U,$=M===V-1?F:ee,B=[],B.push([1,O,y[_]]),B.push([1,O,n[0].points[Z].usrCoords[2]]),T=Z;T<=M;T++)B.push(n[0].points[T].usrCoords);for(B.push([1,$,n[0].points[M].usrCoords[2]]),B.push([1,$,y[_]]),B.push(B[0]),T=0;T<B.length;T++)this.dataX.push(B[T][1]),this.dataY.push(B[T][2]);M<V-1&&(this.dataX.push(NaN),this.dataY.push(NaN))}},I.hasPoint=function(){return!1};else if(C=JXG$1.createFunction(n[0]),I.addParentsFromJCFunctions([C]),!JXG$1.exists(C))throw new Error(`JSXGraph: Can't create area with the given parents.
Possible parent types: [line], [function]`);return I.addParents(n[0]),I};JXG$1.registerElement("arrowparallel",JXG$1.createArrowParallel);JXG$1.registerElement("bisector",JXG$1.createBisector);JXG$1.registerElement("bisectorlines",JXG$1.createAngularBisectorsOfTwoLines);JXG$1.registerElement("msector",JXG$1.createMsector);JXG$1.registerElement("circumcircle",JXG$1.createCircumcircle);JXG$1.registerElement("circumcirclemidpoint",JXG$1.createCircumcenter);JXG$1.registerElement("circumcenter",JXG$1.createCircumcenter);JXG$1.registerElement("incenter",JXG$1.createIncenter);JXG$1.registerElement("incircle",JXG$1.createIncircle);JXG$1.registerElement("integral",JXG$1.createIntegral);JXG$1.registerElement("midpoint",JXG$1.createMidpoint);JXG$1.registerElement("mirrorelement",JXG$1.createMirrorElement);JXG$1.registerElement("mirrorpoint",JXG$1.createMirrorPoint);JXG$1.registerElement("orthogonalprojection",JXG$1.createOrthogonalProjection);JXG$1.registerElement("parallel",JXG$1.createParallel);JXG$1.registerElement("parallelpoint",JXG$1.createParallelPoint);JXG$1.registerElement("perpendicular",JXG$1.createPerpendicular);JXG$1.registerElement("perpendicularpoint",JXG$1.createPerpendicularPoint);JXG$1.registerElement("perpendicularsegment",JXG$1.createPerpendicularSegment);JXG$1.registerElement("reflection",JXG$1.createReflection);JXG$1.registerElement("inequality",JXG$1.createInequality);JXG$1.createGrid=function(u,n,d){var C=Mat.eps,I=5e3,f,y,B,_,Z,M,V,T=[],H=[],F;if(B=n,B.length>2||B.length>=1&&B[0].elType!=="axis"||B.length>=2&&B[1].elType!=="axis")throw new Error("JSXGraph: Can't create 'grid' with parent type '"+n[0].elType+"'. Possible parent types: [axis,axis]");return!JXG$1.exists(B[0])&&JXG$1.exists(u.defaultAxes)&&(B[0]=u.defaultAxes.x),!JXG$1.exists(B[1])&&JXG$1.exists(u.defaultAxes)&&(B[1]=u.defaultAxes.y),F=function(O,$,U,ee,Q,ie,ne){var le,ae,ce,ge,he,Ie,fe;switch(O.toLowerCase()){case".":case"point":return $.visProp.linecap="round",$.visProp.strokewidth=Q*$.board.unitX+ie*$.board.unitY,[[U,U,NaN],[ee,ee,NaN]];case"o":case"circle":return $.visProp.linecap="square",$.bezierDegree=3,ae=4*Math.tan(Math.PI/8)/3,[[U+Q,U+Q,U+ae*Q,U,U-ae*Q,U-Q,U-Q,U-Q,U-ae*Q,U,U+ae*Q,U+Q,U+Q,NaN],[ee,ee+ae*ie,ee+ie,ee+ie,ee+ie,ee+ae*ie,ee,ee-ae*ie,ee-ie,ee-ie,ee-ie,ee-ae*ie,ee,NaN]];case"regpol":case"regularpolygon":for($.visProp.linecap="round",ge=JXG$1.evaluate($.visProp.polygonvertices),he=[[],[]],le=0;le<=2*Math.PI;le+=2*Math.PI/ge)he[0].push(U-Q*Math.sin(le)),he[1].push(ee-ie*Math.cos(le));return he[0].push(NaN),he[1].push(NaN),he;case"[]":case"square":return $.visProp.linecap="square",[[U-Q,U+Q,U+Q,U-Q,U-Q,NaN],[ee+ie,ee+ie,ee-ie,ee-ie,ee+ie,NaN]];case"<>":case"diamond":return $.visProp.linecap="square",[[U,U+Q,U,U-Q,U,NaN],[ee+ie,ee,ee-ie,ee,ee+ie,NaN]];case"<<>>":case"diamond2":return $.visProp.linecap="square",Ie=Q*Math.sqrt(2),fe=ie*Math.sqrt(2),[[U,U+Ie,U,U-Ie,U,NaN],[ee+fe,ee,ee-fe,ee,ee+fe,NaN]];case"x":case"cross":return[[U-Q,U+Q,NaN,U-Q,U+Q,NaN],[ee+ie,ee-ie,NaN,ee-ie,ee+ie,NaN]];case"+":case"plus":return[[U-Q,U+Q,NaN,U,U,NaN],[ee,ee,NaN,ee-ie,ee+ie,NaN]];case"-":case"minus":return[[U-Q,U+Q,NaN],[ee,ee,NaN]];case"|":case"divide":return[[U,U,NaN],[ee-ie,ee+ie,NaN]];case"^":case"a":case"A":case"triangleup":return[[U-Q,U,U+Q,NaN],[ee-ie,ee,ee-ie,NaN]];case"v":case"triangledown":return[[U-Q,U,U+Q,NaN],[ee+ie,ee,ee+ie,NaN]];case"<":case"triangleleft":return[[U+Q,U,U+Q,NaN],[ee+ie,ee,ee-ie,NaN]];case">":case"triangleright":return[[U-Q,U,U-Q,NaN],[ee+ie,ee,ee-ie,NaN]];case"line":return ce=JXG$1.evaluate($.visProp.margin),[[U,U,NaN,ne[0]-ce/$.board.unitX,ne[2]+ce/$.board.unitX,NaN],[ne[1]+ce/$.board.unitY,ne[3]-ce/$.board.unitY,NaN,ee,ee,NaN]];default:return[[],[]]}},_=JXG$1.copyAttributes(d,u.options,"grid"),JXG$1.mergeAttr(_,_.themes[_.theme],!1),Z={},JXG$1.mergeAttr(Z,_,!0,!0),JXG$1.mergeAttr(Z,_.major,!0,!0),f=u.create("curve",[[null],[null]],Z),f.elType="grid",f.type=Const.OBJECT_TYPE_GRID,M={},JXG$1.mergeAttr(M,_,!0,!0),JXG$1.mergeAttr(M,_.minor,!0,!0),M.id===Z.id&&(M.id=f.id+"_minor"),M.name===Z.name&&(M.name=f.name+"_minor"),y=u.create("curve",[[null],[null]],M),y.elType="grid",y.type=Const.OBJECT_TYPE_GRID,f.minorGrid=y,y.majorGrid=f,f.hasPoint=function(){return!1},y.hasPoint=function(){return!1},f.inherits.push(y),f.updateDataArray=function(){var O=this.board.getBoundingBox(),$,U,ee,Q,ie,ne,le,ae,ce=JXG$1.evaluate(this.visProp.gridx),ge=JXG$1.evaluate(this.visProp.gridy),he=JXG$1.evaluate(this.visProp.face),Ie=JXG$1.evaluate(this.visProp.drawzero),fe=Ie===!0||JXG$1.isObject(Ie)&&JXG$1.evaluate(Ie.origin)===!0,me=Ie===!0||JXG$1.isObject(Ie)&&JXG$1.evaluate(Ie.x)===!0,Ge=Ie===!0||JXG$1.isObject(Ie)&&JXG$1.evaluate(Ie.y)===!0,Ze=JXG$1.evaluate(this.visProp.includeboundaries),ye=JXG$1.evaluate(this.visProp.forcesquare);if(this.dataX=[],this.dataY=[],V=JXG$1.evaluate(this.visProp.majorstep),JXG$1.isArray(V)||(V=[V,V]),V.length<2&&(V=[V[0],V[0]]),JXG$1.exists(ce)&&(JXG$1.deprecated("gridX","majorStep"),V[0]=ce),JXG$1.exists(ge)&&(JXG$1.deprecated("gridY","majorStep"),V[1]=ge),V[0]==="auto"?(ae=Math.pow(10,Math.floor(Math.log(50/this.board.unitX)/Math.LN10)),V[0]=ae,JXG$1.exists(B[0])&&(V[0]=B[0].ticks[0].getDistanceMajorTicks())):V[0]=JXG$1.parseNumber(V[0],Math.abs(O[1]-O[3]),1/this.board.unitX),V[1]==="auto"?(ae=Math.pow(10,Math.floor(Math.log(50/this.board.unitY)/Math.LN10)),V[1]=ae,JXG$1.exists(B[1])&&(V[1]=B[1].ticks[0].getDistanceMajorTicks())):V[1]=JXG$1.parseNumber(V[1],Math.abs(O[0]-O[2]),1/this.board.unitY),ye==="min"||ye===!0?V[0]*this.board.unitX<=V[1]*this.board.unitY?V[1]=V[0]/this.board.unitY*this.board.unitX:V[0]=V[1]/this.board.unitX*this.board.unitY:ye==="max"&&(V[0]*this.board.unitX<=V[1]*this.board.unitY?V[0]=V[1]/this.board.unitX*this.board.unitY:V[1]=V[0]/this.board.unitY*this.board.unitX),T=JXG$1.evaluate(this.visProp.size),JXG$1.isArray(T)||(T=[T,T]),T.length<2&&(T=[T[0],T[0]]),JXG$1.isNumber(T[0],!0)&&(T[0]=T[0]+"px"),JXG$1.isNumber(T[1],!0)&&(T[1]=T[1]+"px"),T[0]=JXG$1.parseNumber(T[0],V[0],1/this.board.unitX),T[1]=JXG$1.parseNumber(T[1],V[1],1/this.board.unitY),H[0]=T[0]/2,H[1]=T[1]/2,$=Mat.roundToStep(O[0],V[0]),U=Mat.roundToStep(O[1],V[1]),le=isFinite($)&&isFinite(U)&&isFinite(O[2])&&isFinite(O[3])&&Math.abs(O[2])<Math.abs(V[0]*I)&&Math.abs(O[3])<Math.abs(V[1]*I),he.toLowerCase()==="line"){for(ie=JXG$1.evaluate(f.visProp.margin),Q=U;le&&Q>=O[3];Q-=V[1])!fe&&Math.abs(Q)<C||!Ge&&Math.abs(Q)<C||!Ze&&(Q<=O[3]+H[1]||Q>=O[1]-H[1])||(ne=[[O[0]-ie/f.board.unitX,O[2]+ie/f.board.unitX,NaN],[Q,Q,NaN]],JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1]));for(ee=$;le&&ee<=O[2];ee+=V[0])!fe&&Math.abs(ee)<C||!me&&Math.abs(ee)<C||!Ze&&(ee<=O[0]+H[0]||ee>=O[2]-H[0])||(ne=[[ee,ee,NaN],[O[1]+ie/f.board.unitY,O[3]-ie/f.board.unitY,NaN]],JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1]))}else for(Q=U;le&&Q>=O[3];Q-=V[1])for(ee=$;le&&ee<=O[2];ee+=V[0])!fe&&Math.abs(Q)<C&&Math.abs(ee)<C||!me&&Math.abs(Q)<C&&Math.abs(ee)>=C||!Ge&&Math.abs(ee)<C&&Math.abs(Q)>=C||!Ze&&(ee<=O[0]+H[0]||ee>=O[2]-H[0]||Q<=O[3]+H[1]||Q>=O[1]-H[1])||(ne=F(he,f,ee,Q,H[0],H[1],O),JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1]))},y.updateDataArray=function(){var O=this.board.getBoundingBox(),$,U,ee,Q,ie,ne,le,ae=[],ce=[],ge,he,Ie,fe,me,Ge,Ze,ye,Ee,Ve,Ye,be,Be=JXG$1.evaluate(this.visProp.minorelements),Ne=JXG$1.evaluate(this.visProp.size),Ae=JXG$1.evaluate(this.visProp.face),Re=JXG$1.evaluate(this.visProp.drawzero),We=Re===!0||JXG$1.isObject(Re)&&JXG$1.evaluate(Re.x)===!0,De=Re===!0||JXG$1.isObject(Re)&&JXG$1.evaluate(Re.y)===!0,Fe=JXG$1.evaluate(this.majorGrid.visProp.face),Ke=JXG$1.evaluate(this.majorGrid.visProp.drawzero),Rt=Ke===!0||JXG$1.isObject(Ke)&&JXG$1.evaluate(Ke.origin)===!0,dt=Ke===!0||JXG$1.isObject(Ke)&&JXG$1.evaluate(Ke.x)===!0,Ut=Ke===!0||JXG$1.isObject(Ke)&&JXG$1.evaluate(Ke.y)===!0,rt=JXG$1.evaluate(this.visProp.includeboundaries);if(this.dataX=[],this.dataY=[],JXG$1.isArray(Be)||(Be=[Be,Be]),Be.length<2&&(Be=[Be[0],Be[0]]),JXG$1.isNumber(Be[0],!0)?Be[0]=parseFloat(Be[0]):(Be[0]=3,JXG$1.exists(B[0])&&(Be[0]=JXG$1.evaluate(B[0].getAttribute("ticks").minorticks))),ae[0]=V[0]/(Be[0]+1),JXG$1.isNumber(Be[1],!0)?Be[1]=parseFloat(Be[1]):(Be[1]=3,JXG$1.exists(B[1])&&(Be[1]=JXG$1.evaluate(B[1].getAttribute("ticks").minorticks))),ae[1]=V[1]/(Be[1]+1),JXG$1.isArray(Ne)||(Ne=[Ne,Ne]),Ne.length<2&&(Ne=[Ne[0],Ne[0]]),JXG$1.isNumber(Ne[0],!0)&&(Ne[0]=Ne[0]+"px"),JXG$1.isNumber(Ne[1],!0)&&(Ne[1]=Ne[1]+"px"),Ne[0]=JXG$1.parseNumber(Ne[0],ae[0],1/this.board.unitX),Ne[1]=JXG$1.parseNumber(Ne[1],ae[1],1/this.board.unitY),ce[0]=Ne[0]*.5,ce[1]=Ne[1]*.5,$=Mat.roundToStep(O[0],ae[0]),U=Mat.roundToStep(O[1],ae[1]),le=isFinite($)&&isFinite(U)&&isFinite(O[2])&&isFinite(O[3])&&Math.abs(O[2])<=Math.abs(ae[0]*I)&&Math.abs(O[3])<Math.abs(ae[1]*I),Ae.toLowerCase()!=="line")for(Q=U;le&&Q>=O[3];Q-=ae[1])for(ee=$;le&&ee<=O[2];ee+=ae[0]){if(ge=Mat.roundToStep(Math.abs(ee),V[0]),ge=Math.abs(ge-Math.abs(ee)),he=V[0]-ge,Ie=Mat.roundToStep(Math.abs(Q),V[1]),Ie=Math.abs(Ie-Math.abs(Q)),fe=V[1]-Ie,Fe==="line"){if(ge-ce[0]-H[0]<C||he-ce[0]-H[0]<C||Ie-ce[1]-H[1]<C||fe-ce[1]-H[1]<C)continue}else if((ge-ce[0]-H[0]<C||he-ce[0]-H[0]<C)&&(Ie-ce[1]-H[1]<C||fe-ce[1]-H[1]<C)&&(Rt||H[1]-Math.abs(Q)+ce[1]<C||H[0]-Math.abs(ee)+ce[0]<C)&&(dt||H[1]-Math.abs(Q)+ce[1]<C||H[0]+Math.abs(ee)-ce[0]<C)&&(Ut||H[0]-Math.abs(ee)+ce[0]<C||H[1]+Math.abs(Q)-ce[1]<C))continue;!De&&Math.abs(ee)<C||!We&&Math.abs(Q)<C||(me=Math.abs(O[0]%V[0]),Ge=Math.abs(O[1]%V[1]),Ze=Math.abs(O[2]%V[0]),ye=Math.abs(O[3]%V[1]),Ee=V[0]-me,Ve=V[1]-Ge,Ye=V[0]-Ze,be=V[1]-ye,!(!rt&&(ee-ce[0]-O[0]-H[0]+Ee<C&&Ee-H[0]<C||ee-ce[0]-O[0]-H[0]-me<C&&me-H[0]<C||-ee-ce[0]+O[2]-H[0]+Ye<C&&Ye-H[0]<C||-ee-ce[0]+O[2]-H[0]-Ze<C&&Ze-H[0]<C||-Q-ce[1]+O[1]-H[1]+Ve<C&&Ve-H[1]<C||-Q-ce[1]+O[1]-H[1]-Ge<C&&Ge-H[1]<C||Q-ce[1]-O[3]-H[1]+be<C&&be-H[1]<C||Q-ce[1]-O[3]-H[1]-ye<C&&ye-H[1]<C||-Q-ce[1]+O[1]<C||ee-ce[0]-O[0]<C||Q-ce[1]-O[3]<C||-ee-ce[0]+O[2]<C))&&(ne=F(Ae,y,ee,Q,ce[0],ce[1],O),JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1])))}else{for(ie=JXG$1.evaluate(y.visProp.margin),Q=U;le&&Q>=O[3];Q-=ae[1]){if(Ie=Mat.roundToStep(Math.abs(Q),V[1]),Ie=Math.abs(Ie-Math.abs(Q)),fe=V[1]-Ie,Fe==="line"){if(Ie-ce[1]-H[1]<C||fe-ce[1]-H[1]<C)continue}else if((Ie-ce[1]-H[1]<C||fe-ce[1]-H[1]<C)&&(Rt||H[1]-Math.abs(Q)+ce[1]<C)&&(dt||H[1]-Math.abs(Q)+ce[1]<C)&&(Ut||H[1]+Math.abs(Q)-ce[1]<C))continue;!We&&Math.abs(Q)<C||(me=Math.abs(O[0]%V[0]),Ge=Math.abs(O[1]%V[1]),Ze=Math.abs(O[2]%V[0]),ye=Math.abs(O[3]%V[1]),Ee=V[0]-me,Ve=V[1]-Ge,Ye=V[0]-Ze,be=V[1]-ye,!(!rt&&(-Q-ce[1]+O[1]-H[1]+Ve<C&&Ve-H[1]<C||-Q-ce[1]+O[1]-H[1]-Ge<C&&Ge-H[1]<C||Q-ce[1]-O[3]-H[1]+be<C&&be-H[1]<C||Q-ce[1]-O[3]-H[1]-ye<C&&ye-H[1]<C||-Q-ce[1]+O[1]<C||Q-ce[1]-O[3]<C))&&(ne=[[O[0]-ie/y.board.unitX,O[2]+ie/y.board.unitX,NaN],[Q,Q,NaN]],JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1])))}for(ee=$;le&&ee<=O[2];ee+=ae[0]){if(ge=Mat.roundToStep(Math.abs(ee),V[0]),ge=Math.abs(ge-Math.abs(ee)),he=V[0]-ge,Fe==="line"){if(ge-ce[0]-H[0]<C||he-ce[0]-H[0]<C)continue}else if((ge-ce[0]-H[0]<C||he-ce[0]-H[0]<C)&&(Rt||H[0]-Math.abs(ee)+ce[0]<C)&&(dt||H[0]+Math.abs(ee)-ce[0]<C)&&(Ut||H[0]-Math.abs(ee)+ce[0]<C))continue;!De&&Math.abs(ee)<C||(me=Math.abs(O[0]%V[0]),Ge=Math.abs(O[1]%V[1]),Ze=Math.abs(O[2]%V[0]),ye=Math.abs(O[3]%V[1]),Ee=V[0]-me,Ve=V[1]-Ge,Ye=V[0]-Ze,be=V[1]-ye,!(!rt&&(ee-ce[0]-O[0]-H[0]+Ee<C&&Ee-H[0]<C||ee-ce[0]-O[0]-H[0]-me<C&&me-H[0]<C||-ee-ce[0]+O[2]-H[0]+Ye<C&&Ye-H[0]<C||-ee-ce[0]+O[2]-H[0]-Ze<C&&Ze-H[0]<C||ee-ce[0]-O[0]<C||-ee-ce[0]+O[2]<C))&&(ne=[[ee,ee,NaN],[O[1]+ie/y.board.unitY,O[3]-ie/y.board.unitY,NaN]],JXG$1.concat(this.dataX,ne[0]),JXG$1.concat(this.dataY,ne[1])))}}},u.grids.push(f),u.grids.push(y),f};JXG$1.registerElement("grid",JXG$1.createGrid);JXG$1.Image=function(u,n,d,C,I){this.constructor(u,d,Const.OBJECT_TYPE_IMAGE,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(d.anchor),this.coordsConstructor(n),this.W=JXG$1.createFunction(I[0],this.board,""),this.H=JXG$1.createFunction(I[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*u.unitX),Math.abs(this.usrSize[1]*u.unitY)],this.url=C,this.elType="image",this.span=[this.coords.usrCoords.slice(0),[this.coords.usrCoords[0],this.W(),0],[this.coords.usrCoords[0],0,this.H()]],this.id=this.board.setId(this,"Im"),this.board.renderer.drawImage(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H",setSize:"setSize"})};JXG$1.Image.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Image,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Image.prototype,{hasPoint:function(u,n){var d,C,I,f,y,B,_,Z,M,V=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(f=this.board._inputDevice,y=JXG$1.evaluate(this.visProp.precision[f])):y=this.board.options.precision.hasPoint,V===0?(d=u-this.coords.scrCoords[1],C=this.coords.scrCoords[2]-n,I=y,d>=-I&&d-this.size[0]<=I&&C>=-I&&C-this.size[1]<=I):(B=new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board),B=B.usrCoords,_=[B[0]-this.span[0][0],B[1]-this.span[0][1],B[2]-this.span[0][2]],M=Mat.innerProduct,Z=M(_,this.span[1]),0<=Z&&Z<=M(this.span[1],this.span[1])&&(Z=M(_,this.span[2]),0<=Z&&Z<=M(this.span[2],this.span[2])))},update:function(u){return this.needsUpdate?(this.updateCoords(u),this.updateSize(),this.updateSpan(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateImage")},updateSize:function(){return this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)],this},updateSpan:function(){var u,n,d=this.transformations.length,C=[];if(d===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(C[0]=[this.Z(),this.X(),this.Y()],C[1]=[this.Z(),this.X()+this.W(),this.Y()],C[2]=[this.Z(),this.X(),this.Y()+this.H()],u=0;u<d;u++)for(n=0;n<3;n++)C[n]=Mat.matVecMult(this.transformations[u].matrix,C[n]);for(n=0;n<3;n++)C[n][1]/=C[n][0],C[n][2]/=C[n][0],C[n][0]/=C[n][0];for(n=1;n<3;n++)C[n][0]-=C[0][0],C[n][1]-=C[0][1],C[n][2]-=C[0][2];this.span=C}return this},addTransform:function(u){var n;if(JXG$1.isArray(u))for(n=0;n<u.length;n++)this.transformations.push(u[n]);else this.transformations.push(u);return this},getParents:function(){var u=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(u=this.parents),u},setSize:function(u,n){return this.W=JXG$1.createFunction(u,this.board,""),this.H=JXG$1.createFunction(n,this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createImage=function(u,n,d){var C,I,f=n[0],y=n[1],B=n[2];if(C=JXG$1.copyAttributes(d,u.options,"image"),I=CoordsElement.create(JXG$1.Image,u,y,C,f,B),!I)throw new Error("JSXGraph: Can't create image with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return C.rotate!==0&&I.addRotation(C.rotate),I};JXG$1.registerElement("image",JXG$1.createImage);JXG$1.Image;JXG$1.createSlider=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he;return he=JXG$1.copyAttributes(d,u.options,"slider"),ie=he.withticks,Q=he.withlabel,ae=he.snapwidth,ne=he.snapvalues,le=he.snapvaluedistance,Z=u.create("point",n[0],he.point1),M=u.create("point",n[1],he.point2),T=u.create("segment",[Z,M],he.baseline),T.updateStdform(),C=Z.coords.usrCoords.slice(1),I=M.coords.usrCoords.slice(1),f=n[2][0],y=n[2][1],B=n[2][2],_=B-f,ce=JXG$1.evaluate(ae),ge=ce===-1?y:Math.round(y/ce)*ce,U=C[0]+(I[0]-C[0])*(ge-f)/(B-f),ee=C[1]+(I[1]-C[1])*(ge-f)/(B-f),he.withlabel=!1,V=u.create("glider",[U,ee,T],he),V.setAttribute({snapwidth:ae,snapvalues:ne,snapvaluedistance:le}),H=u.create("segment",[Z,V],he.highline),V.Value=function(){var Ie=this._smax-this._smin,fe=JXG$1.evaluate(this.visProp.snapwidth);return fe===-1?this.position*Ie+this._smin:Math.round((this.position*Ie+this._smin)/fe)*fe},V.methodMap=JXG$1.deepCopy(V.methodMap,{Value:"Value",setValue:"setValue",smax:"_smax",smin:"_smin",setMax:"setMax",setMin:"setMin",point1:"point1",point2:"point2",baseline:"baseline",highline:"highline",ticks:"ticks",label:"label"}),V._smax=B,V._smin=f,V.setMax=function(Ie){return this._smax=Ie,this},V.setValue=function(Ie){var fe=this._smax-this._smin;return Math.abs(fe)>Mat.eps?this.position=(Ie-this._smin)/fe:this.position=0,this.position=Math.max(0,Math.min(1,this.position)),this},V.setMin=function(Ie){return this._smin=Ie,this},Q&&($=u.create("text",[function(){return(M.X()-Z.X())*.05+M.X()},function(){return(M.Y()-Z.Y())*.05+M.Y()},function(){var Ie,fe=JXG$1.evaluate(V.visProp.digits),me=JXG$1.evaluate(V.visProp.suffixlabel),Ge=JXG$1.evaluate(V.visProp.unitlabel),Ze=JXG$1.evaluate(V.visProp.postlabel);return fe===2&&JXG$1.evaluate(V.visProp.precision)!==2&&(fe=JXG$1.evaluate(V.visProp.precision)),me!==null?Ie=me:V.name&&V.name!==""?Ie=V.name+" = ":Ie="",V.useLocale()?Ie+=V.formatNumberLocale(V.Value(),fe):Ie+=JXG$1.toFixed(V.Value(),fe),Ge!==null&&(Ie+=Ge),Ze!==null&&(Ie+=Ze),Ie}],he.label),V.label=$,V.visProp.withlabel=!0,V.hasLabel=!0),V.point1=Z,V.point2=M,V.baseline=T,V.highline=H,ie&&(JXG$1.exists(he.generatelabeltext)||(he.ticks.generateLabelText=function(Ie,fe,me){var Ge,Ze=V.point1.Dist(V.point2),ye=V._smin,Ee=V._smax,Ve=this.getDistanceFromZero(fe,Ie)*(Ee-ye)/Ze+ye;return Ze<Mat.eps||Math.abs(Ve)<Mat.eps?Ge="0":Ge=this.formatLabelText(Ve),Ge}),F=2,O=u.create("ticks",[V.baseline,V.point1.Dist(Z)/F,function(Ie){var fe=V.point1.Dist(V.point2),me=V.point1.coords.distance(Const.COORDS_BY_USER,Ie);return fe<Mat.eps?0:me/fe*_+f}],he.ticks),V.ticks=O),V.remove=function(){Q&&u.removeObject($),u.removeObject(H),u.removeObject(T),u.removeObject(M),u.removeObject(Z),Point.prototype.remove.call(V)},Z.dump=!1,M.dump=!1,T.dump=!1,H.dump=!1,Q&&($.dump=!1),V.elType="slider",V.parents=n,V.subs={point1:Z,point2:M,baseLine:T,highLine:H},V.inherits.push(Z,M,T,H),T.inherits=[],H.inherits=[],ie&&(O.dump=!1,V.subs.ticks=O,V.inherits.push(O)),V.getParents=function(){return[this.point1.coords.usrCoords.slice(1),this.point2.coords.usrCoords.slice(1),[this._smin,this.position*(this._smax-this._smin)+this._smin,this._smax]]},V.baseline.on("up",function(Ie){var fe,me;JXG$1.evaluate(V.visProp.moveonup)&&!JXG$1.evaluate(V.visProp.fixed)&&(fe=T.board.getMousePosition(Ie,0),me=new Coords(Const.COORDS_BY_SCREEN,fe,this.board),V.moveTo([me.usrCoords[1],me.usrCoords[2]]),V.triggerEventHandlers(["drag"],[Ie]))}),V.prepareUpdate().update(),u.isSuspendedUpdate||(V.updateVisibility().updateRenderer(),V.baseline.updateVisibility().updateRenderer(),V.highline.updateVisibility().updateRenderer(),ie&&V.ticks.updateVisibility().updateRenderer()),V};JXG$1.registerElement("slider",JXG$1.createSlider);JXG$1.PrefixParser={parse:function(u,n){var d,C,I,f,y,B;if(JXG$1.isNumber(u)||JXG$1.isString(u))return u;if(!JXG$1.isArray(u)||u.length<2)throw new Error("prefixParser.parse: term is not an array, number or string");if(d=u[0],I=u.length,n==="execute")if(JXG$1.isInArray(["+","-","*","/"],d))for(f=this.parse(u[1],n),C=2;C<I;C++)switch(B=this.parse(u[C],n),d){case"+":f+=B;break;case"-":f-=B;break;case"*":f*=B;break;case"/":f/=B;break}else if(d==="exec"){for(y=u[1],B=[],C=2;C<I;C++)B.push(this.parse(u[C],n));if(JXG$1.exists(Math[y]))f=Math[y].apply(this,B);else if(JXG$1.exists(Mat[y]))f=Mat[y].apply(this,B);else throw new Error("PrefixParser.parse: "+y+" is not allowed")}else{if(y=u[0],y==="V"&&(y="Value"),y==="Coords"&&(u[2]="true"),!JXG$1.exists(u[1][y]))throw new Error("PrefixParser.parse: "+y+" is not a method of "+u[1]);for(B=[],C=2;C<I;C++)B.push(this.parse(u[C],n));f=u[1][y].apply(u[1],B)}return f},dimension:function(u){var n,d,C,I,f,y,B,_;if(JXG$1.isNumber(u))return 0;if(!JXG$1.isArray(u)||u.length<2)throw new Error("PrefixParser.dimension: term is not an array");if(n=u[0],C=u.length,JXG$1.isInArray(["+","-","*","/"],n))for(I=this.dimension(u[1]),d=2;d<C;d++)switch(B=this.dimension(u[d]),n){case"+":B!==I&&(I=NaN);break;case"-":B!==I&&(I=NaN);break;case"*":I+=B;break;case"/":I-=B;break}else if(n==="exec")u[2].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(I=u[2].Dimension(),JXG$1.exists(u[2].visProp.dim)&&(y=JXG$1.evaluate(u[2].visProp.dim),y!==null&&(I=y))):I=0;else switch(f=u[0],f){case"L":case"Length":case"Perimeter":case"Radius":case"R":I=1;break;case"Area":case"A":I=2;break;default:u[1].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(I=u[1].Dimension(),JXG$1.exists(u[1].visProp.dim)&&(y=JXG$1.evaluate(u[1].visProp.dim),y!==null&&(I=y))):(I=0,(f==="Value"||f==="V")&&[Const.OBJECT_TYPE_ARC,Const.OBJECT_TYPE_SECTOR,Const.OBJECT_TYPE_ANGLE].indexOf(u[1].type)>=0&&(_="",u.length===3&&JXG$1.isString(u[2])&&(_=u[2].toLowerCase()),_===""?u[1].type===Const.OBJECT_TYPE_ANGLE?I=0:I=1:_.indexOf("len")===0?I=1:I=0))}return I},toPrefix:function(u){var n,d,C,I;if(JXG$1.isNumber(u))return u;if(!JXG$1.isArray(u)||u.length<2)throw new Error("PrefixParser.toPrefix: term is not an array");for(n=u[0],C=u.length,I=[n],d=1;d<C;d++)JXG$1.isInArray(["+","-","*","/"],n)?I.push(this.toPrefix(u[d])):n==="V"&&u[d].type===JXG$1.OBJECT_TYPE_MEASUREMENT?I=u[d].toPrefix():n==="exec"?d===1?I.push(u[d]):I.push(this.toPrefix(u[d])):I=[n,u[d].id];return I},getParents:function(u){var n,d,C,I;if(JXG$1.isNumber(u))return[];if(!JXG$1.isArray(u)||u.length<2)throw new Error("PrefixParser.getParents: term is not an array");for(n=u[0],C=u.length,I=[],d=1;d<C;d++)JXG$1.isInArray(["+","-","*","/"],n)?JXG$1.concat(I,this.getParents(u[d])):n==="V"&&u[d].type===JXG$1.OBJECT_TYPE_MEASUREMENT?JXG$1.concat(I,u[d].getParents()):n==="exec"?d>1&&JXG$1.concat(I,this.getParents(u[d])):I.push(u[d]);return I}};const Prefix=JXG$1.PrefixParser;JXG$1.createTapemeasure=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H;return C=n[0],I=n[1],f=JXG$1.copyAttributes(d,u.options,"tapemeasure","point1"),M=u.create("point",C,f),f=JXG$1.copyAttributes(d,u.options,"tapemeasure","point2"),V=u.create("point",I,f),M.setAttribute({ignoredSnapToPoints:[V.id]}),V.setAttribute({ignoredSnapToPoints:[M.id]}),f=JXG$1.copyAttributes(d,u.options,"tapemeasure"),y=f.withticks,B=f.withlabel,_=f.digits,_===2&&f.precision!==2&&(_=f.precision),B&&(f.withlabel=!0),Z=u.create("segment",[M,V],f),B&&(d.name&&d.name!==""?T=d.name+" = ":T="",Z.label.setText(function(){var F=JXG$1.evaluate(Z.label.visProp.digits);return Z.label.useLocale()?T+Z.label.formatNumberLocale(M.Dist(V),F):T+JXG$1.toFixed(M.Dist(V),F)})),y&&(f=JXG$1.copyAttributes(d,u.options,"tapemeasure","ticks"),H=u.create("ticks",[Z,.1],f),Z.inherits.push(H)),Z.remove=function(){y&&Z.removeTicks(H),u.removeObject(V),u.removeObject(M),GeometryElement.prototype.remove.call(this)},Z.Value=function(){return M.Dist(V)},M.dump=!1,V.dump=!1,Z.elType="tapemeasure",Z.getParents=function(){return[[M.X(),M.Y()],[V.X(),V.Y()]]},Z.subs={point1:M,point2:V},y&&(H.dump=!1),Z.methodMap=JXG$1.deepCopy(Z.methodMap,{Value:"Value"}),Z.prepareUpdate().update(),u.isSuspendedUpdate||(Z.updateVisibility().updateRenderer(),Z.point1.updateVisibility().updateRenderer(),Z.point2.updateVisibility().updateRenderer()),Z};JXG$1.registerElement("tapemeasure",JXG$1.createTapemeasure);JXG$1.createMeasurement=function(u,n,d){var C,I,f,y,B,_;for(I=JXG$1.copyAttributes(d,u.options,"measurement"),f=n[0],y=n[1],B=n[2],C=u.create("text",[f,y,""],I),C.type=JXG$1.OBJECT_TYPE_MEASUREMENT,C.elType="measurement",C.Value=function(){return Prefix.parse(B,"execute")},C.Dimension=function(){var Z=JXG$1.evaluate(C.visProp.dim);return Z!==null?Z:Prefix.dimension(B)},C.Unit=function(){var Z="",M=JXG$1.evaluate(C.visProp.units),V=C.Dimension();return JXG$1.isObject(M)&&JXG$1.exists(M[V])&&M[V]!==!1?Z=JXG$1.evaluate(M[V]):JXG$1.isObject(M)&&JXG$1.exists(M["dim"+V])&&M["dim"+V]!==!1?Z=JXG$1.evaluate(M["dim"+V]):(Z=JXG$1.evaluate(C.visProp.baseunit),V===0?Z="":V>1&&Z!==""&&(Z=Z+"^{"+V+"}")),Z},C.getTerm=function(){return B},C.getMethod=function(){var Z=B[0];return Z==="V"&&(Z="Value"),Z},C.toPrefix=function(){return Prefix.toPrefix(B)},C.getParents=function(){return Prefix.getParents(B)},C.addParents(C.getParents()),_=0;_<C.parents.length;_++)u.select(C.parents[_]).addChild(C);return C.setText(function(){var Z="",M="",V=C.Dimension(),T=JXG$1.evaluate(C.visProp.digits),H=C.Unit(),F=C.Value(),O;if(JXG$1.evaluate(C.visProp.showprefix)&&(Z=C.visProp.formatprefix.apply(C,[JXG$1.evaluate(C.visProp.prefix)])),JXG$1.evaluate(C.visProp.showsuffix)&&(M=C.visProp.formatsuffix.apply(C,[JXG$1.evaluate(C.visProp.suffix)])),JXG$1.isNumber(F))T==="none"||(T==="auto"?C.useLocale()?F=C.formatNumberLocale(F):F=JXG$1.autoDigits(F):C.useLocale()?F=C.formatNumberLocale(F,T):F=JXG$1.toFixed(F,T));else if(JXG$1.isArray(F))for(O=0;O<F.length;O++)JXG$1.isNumber(F[O])&&(T==="none"||(T==="auto"?C.useLocale()?F[O]=C.formatNumberLocale(F[O]):F[O]=JXG$1.autoDigits(F[O]):C.useLocale()?F[O]=C.formatNumberLocale(F[O],T):F[O]=JXG$1.toFixed(F[O],T)));return V==="coords"&&JXG$1.isArray(F)&&(F.length===2&&F.unshift(void 0),F=C.visProp.formatcoords.apply(C,[F[1],F[2],F[0]])),V==="direction"&&JXG$1.isArray(F)&&(F=C.visProp.formatdirection.apply(C,[F[0],F[1]])),JXG$1.isString(V)?Z+F+M:isNaN(V)?Z+"NaN"+M:Z+F+H+M}),C.methodMap=JXG$1.deepCopy(C.methodMap,{Value:"Value",Dimension:"Dimension",Unit:"Unit",getTerm:"getTerm",Term:"getTerm",getMethod:"getMethod",Method:"getMethod",getParents:"getParents",Parents:"getParents"}),C};JXG$1.registerElement("measurement",JXG$1.createMeasurement);JXG$1.DataSource=function(){return this.data=[],this.columnHeaders=[],this.rowHeaders=[],this};JXG$1.extend(JXG$1.DataSource.prototype,{loadFromArray:function(u,n,d){var C,I,f;if(JXG$1.isArray(n)&&(this.columnHeaders=n,n=!1),JXG$1.isArray(d)&&(this.rowHeaders=d,d=!1),this.data=[],n&&(this.columnHeaders=[]),d&&(this.rowHeaders=[]),JXG$1.exists(u)){for(this.data=[],C=0;C<u.length;C++)for(this.data[C]=[],I=0;I<u[C].length;I++)f=u[C][I],parseFloat(f).toString()===f?this.data[C][I]=parseFloat(f):f!=="-"?this.data[C][I]=f:this.data[C][I]=NaN;if(n&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),d)for(this.rowHeaders=[],C=0;C<this.data.length;C++)this.rowHeaders.push(this.data[C][0]),this.data[C]=this.data[C].slice(1)}return this},loadFromTable:function(u,n,d){var C,I,f,y,B;if(JXG$1.isArray(n)&&(this.columnHeaders=n,n=!1),JXG$1.isArray(d)&&(this.rowHeaders=d,d=!1),this.data=[],n&&(this.columnHeaders=[]),d&&(this.rowHeaders=[]),u=document.getElementById(u),JXG$1.exists(u)){for(C=u.getElementsByTagName("tr"),this.data=[],I=0;I<C.length;I++)for(y=C[I].getElementsByTagName("td"),this.data[I]=[],f=0;f<y.length;f++)B=y[f].innerHTML,parseFloat(B).toString()===B?this.data[I][f]=parseFloat(B):B!=="-"?this.data[I][f]=B:this.data[I][f]=NaN;if(n&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),d)for(this.rowHeaders=[],I=0;I<this.data.length;I++)this.rowHeaders.push(this.data[I][0]),this.data[I]=this.data[I].slice(1)}return this},addColumn:function(u,n,d){throw new Error("not implemented")},addRow:function(u,n,d){throw new Error("not implemented")},getColumn:function(u){var n,d=[];if(JXG$1.isString(u)){for(n=0;n<this.columnHeaders.length;n++)if(u===this.columnHeaders[n]){u=n;break}}for(n=0;n<this.data.length;n++)this.data[n].length>u&&(d[n]=parseFloat(this.data[n][u]));return d},getRow:function(u){var n,d;if(JXG$1.isString(u)){for(d=0;d<this.rowHeaders.length;d++)if(u===this.rowHeaders[d]){u=d;break}}for(n=[],d=0;d<this.data[u].length;d++)n[d]=this.data[u][d];return n}});const DataSource=JXG$1.DataSource;JXG$1.Chart=function(u,n,d){this.constructor(u,d);var C,I,f,y,B,_;if(!JXG$1.isArray(n)||n.length===0)throw new Error("JSXGraph: Can't create a chart without data");if(this.elements=[],JXG$1.isNumber(n[0]))for(I=n,C=[],f=0;f<I.length;f++)C[f]=f+1;else if(n.length===1&&JXG$1.isArray(n[0]))for(I=n[0],C=[],_=JXG$1.evaluate(I).length,f=0;f<_;f++)C[f]=f+1;else n.length===2&&(_=Math.min(n[0].length,n[1].length),C=n[0].slice(0,_),I=n[1].slice(0,_));if(JXG$1.isArray(I)&&I.length===0)throw new Error("JSXGraph: Can't create charts without data.");for(B=d.chartstyle.replace(/ /g,"").split(","),f=0;f<B.length;f++){switch(B[f]){case"bar":y=this.drawBar(u,C,I,d);break;case"line":y=this.drawLine(u,C,I,d);break;case"fit":y=this.drawFit(u,C,I,d);break;case"spline":y=this.drawSpline(u,C,I,d);break;case"pie":y=this.drawPie(u,I,d);break;case"point":y=this.drawPoints(u,C,I,d);break;case"radar":y=this.drawRadar(u,n,d);break}this.elements.push(y)}return this.id=this.board.setId(this,"Chart"),this.elements};JXG$1.Chart.prototype=new GeometryElement;JXG$1.extend(JXG$1.Chart.prototype,{drawLine:function(u,n,d,C){return C.fillcolor="none",C.highlightfillcolor="none",u.create("curve",[n,d],C)},drawSpline:function(u,n,d,C){return C.fillColor="none",C.highlightfillcolor="none",u.create("spline",[n,d],C)},drawFit:function(u,n,d,C){var I=C.degree;return I=Math.max(parseInt(I,10),1)||1,C.fillcolor="none",C.highlightfillcolor="none",u.create("functiongraph",[Numerics.regressionPolynomial(I,n,d)],C)},drawBar:function(u,n,d,C){var I,f,y,B,_,Z,M,V,T=[],H=[],F,O,$=function(ee,Q){return function(){return n[ee]()-Q*y}},U={fixed:!0,withLabel:!1,visible:!1,name:""};if(F=JXG$1.copyAttributes(C,u.options,"chart"),F&&F.width)y=F.width;else{if(n.length<=1)y=1;else for(y=n[1]-n[0],I=1;I<n.length-1;I++)y=n[I+1]-n[I]<y?n[I+1]-n[I]:y;y*=.8}for(O=JXG$1.copyAttributes(C,u.options,"chart","label"),I=0;I<n.length;I++)JXG$1.isFunction(n[I])?(B=$(I,-.5),_=$(I,0),Z=$(I,.5)):(B=n[I]-y*.5,_=n[I],Z=n[I]+y*.5),JXG$1.isFunction(d[I])?M=d[I]():M=d[I],M=d[I],F.dir==="horizontal"?(H[0]=u.create("point",[0,B],U),H[1]=u.create("point",[M,B],U),H[2]=u.create("point",[M,Z],U),H[3]=u.create("point",[0,Z],U),JXG$1.exists(F.labels)&&JXG$1.exists(F.labels[I])&&(O.anchorY="middle",f=u.create("text",[M,_,F.labels[I]],O),f.visProp.anchorx=function(ee){return function(){return ee.X()>=0?"left":"right"}}(f))):(H[0]=u.create("point",[B,0],U),H[1]=u.create("point",[B,M],U),H[2]=u.create("point",[Z,M],U),H[3]=u.create("point",[Z,0],U),JXG$1.exists(F.labels)&&JXG$1.exists(F.labels[I])&&(O.anchorX="middle",f=u.create("text",[_,M,F.labels[I]],O),f.visProp.anchory=function(ee){return function(){return ee.Y()>=0?"bottom":"top"}}(f))),JXG$1.isArray(F.colors)&&(V=F.colors,F.fillcolor=V[I%V.length]),T[I]=u.create("polygon",H,F),JXG$1.exists(F.labels)&&JXG$1.exists(F.labels[I])&&(T[I].text=f);return T},drawPoints:function(u,n,d,C){var I,f=[],y=C.infoboxarray;for(C.fixed=!0,C.name="",I=0;I<n.length;I++)C.infoboxtext=y?y[I%y.length]:!1,f[I]=u.create("point",[n[I],d[I]],C);return f},drawPie:function(u,n,d){var C,I,f=[],y=[],B=d.colors,_=d.highlightcolors,Z=d.labels,M=d.radius||4,V=M,T=d.center||[0,0],H=T[0],F=T[1],O=function(ie,ne,le){return function(){var ae,ce,ge,he=0;for(ce=0;ce<=ie;ce++)he+=parseFloat(JXG$1.evaluate(n[ce]));for(ae=he,ce=ie+1;ce<n.length;ce++)ae+=parseFloat(JXG$1.evaluate(n[ce]));return ge=ae!==0?2*Math.PI*he/ae:0,V()*Math[ne](ge)+le}},$=function(ie,ne){var le=-this.point1.coords.usrCoords[1]+this.point2.coords.usrCoords[1],ae=-this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[2];JXG$1.exists(this.label)&&(this.label.rendNode.style.fontSize=ne*JXG$1.evaluate(this.label.visProp.fontsize)+"px",this.label.fullUpdate()),this.point2.coords=new Coords(Const.COORDS_BY_USER,[this.point1.coords.usrCoords[1]+le*ie,this.point1.coords.usrCoords[2]+ae*ie],this.board),this.fullUpdate()},U=function(){this.highlighted||(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this),$.call(this,1.1,2))},ee=function(){this.highlighted&&(this.highlighted=!1,this.board.renderer.noHighlight(this),$.call(this,.9090909,1))},Q={fixed:!0,withLabel:!1,visible:!1,name:""};if(!JXG$1.isArray(Z))for(Z=[],C=0;C<n.length;C++)Z[C]="";for(JXG$1.isFunction(M)||(V=function(){return M}),d.highlightonsector=d.highlightonsector||!1,d.straightfirst=!1,d.straightlast=!1,I=u.create("point",[H,F],Q),f[0]=u.create("point",[function(){return V()+H},function(){return F}],Q),C=0;C<n.length;C++)f[C+1]=u.create("point",[O(C,"cos",H),O(C,"sin",F)],Q),d.name=Z[C],d.withlabel=d.name!=="",d.fillcolor=B&&B[C%B.length],d.labelcolor=B&&B[C%B.length],d.highlightfillcolor=_&&_[C%_.length],y[C]=u.create("sector",[I,f[C],f[C+1]],d),d.highlightonsector&&(y[C].hasPoint=y[C].hasPointSector),d.highlightbysize&&(y[C].highlight=U,y[C].noHighlight=ee);return{sectors:y,points:f,midpoint:I}},drawRadar:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe,me,Ge,Ze,ye,Ee,Ve,Ye,be,Be,Ne,Ae,Re,We,De,Fe,Ke,Rt,dt,Ut=n.length,rt=function(){var we,Jt,It,Ht,mt=JXG$1.evaluate(this.visProp.label.offset).slice(0);return we=this.point1.X(),Jt=this.point2.X(),It=this.point1.Y(),Ht=this.point2.Y(),Jt<we&&(mt[0]=-mt[0]),Ht<It&&(mt[1]=-mt[1]),this.setLabelRelativeCoords(mt),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)},nt=function(we,Jt){var It,Ht,mt;return It=u.create("transform",[-(U[Jt]-O[Jt]),0],{type:"translate"}),Ht=u.create("transform",[ne/(ee[Jt]+$[Jt]-(U[Jt]-O[Jt])),1],{type:"scale"}),It.melt(Ht),mt=u.create("transform",[we],{type:"rotate"}),It.melt(mt),It};if(Ut<=0)throw new Error("JSXGraph radar chart: no data");if(f=d.paramarray,!JXG$1.exists(f))throw new Error("JSXGraph radar chart: need paramArray attribute");if(y=f.length,y<=1)throw new Error("JSXGraph radar chart: need more than one param in paramArray");for(C=0;C<Ut;C++)if(y!==n[C].length)throw new Error("JSXGraph radar chart: use data length equal to number of params ("+n[C].length+" != "+y+")");for(B=[],_=[],I=0;I<y;I++)B[I]=n[0][I],_[I]=B[I];for(C=1;C<Ut;C++)for(I=0;I<y;I++)n[C][I]>B[I]&&(B[I]=n[C][I]),n[C][I]<_[I]&&(_[I]=n[C][I]);for(Z=[],M=[],C=0;C<Ut;C++)Z[C]="",M[C]=[];for(V=[],T=[],H=d.startshiftratio||0,F=d.endshiftratio||0,C=0;C<y;C++)V[C]=(B[C]-_[C])*H,T[C]=(B[C]-_[C])*F;if(O=d.startshiftarray||V,$=d.endshiftarray||T,U=d.startarray||_,JXG$1.exists(d.start))for(C=0;C<y;C++)U[C]=d.start;if(ee=d.endarray||B,JXG$1.exists(d.end))for(C=0;C<y;C++)ee[C]=d.end;if(O.length!==y)throw new Error("JSXGraph radar chart: start shifts length is not equal to number of parameters");if($.length!==y)throw new Error("JSXGraph radar chart: end shifts length is not equal to number of parameters");if(U.length!==y)throw new Error("JSXGraph radar chart: starts length is not equal to number of parameters");if(ee.length!==y)throw new Error("JSXGraph radar chart: snds length is not equal to number of parameters");for(Q=d.labelarray||Z,ie=d.colors,ne=d.radius||10,Rt=d.strokewidth||1,JXG$1.exists(d.highlightonsector)||(d.highlightonsector=!1),le={name:d.name,id:d.id,strokewidth:Rt,polystrokewidth:d.polystrokewidth||Rt,strokecolor:d.strokecolor||"black",straightfirst:!1,straightlast:!1,fillcolor:d.fillColor||"#FFFF88",fillopacity:d.fillOpacity||.4,highlightfillcolor:d.highlightFillColor||"#FF7400",highlightstrokecolor:d.highlightStrokeColor||"black",gradient:d.gradient||"none"},ae=d.center||[0,0],ce=ae[0],ge=ae[1],he=u.create("point",[ce,ge],{name:"",fixed:!0,withlabel:!1,visible:!1}),Ie=Math.PI/2-Math.PI/y,Ie=d.startangle||0,fe=Ie,me=[],Ge=[],C=0;C<y;C++)for(fe+=2*Math.PI/y,ye=ne*Math.cos(fe)+ce,Ee=ne*Math.sin(fe)+ge,me[C]=u.create("point",[ye,Ee],{name:"",fixed:!0,withlabel:!1,visible:!1}),Ge[C]=u.create("line",[he,me[C]],{name:f[C],strokeColor:le.strokecolor,strokeWidth:le.strokewidth,strokeOpacity:1,straightFirst:!1,straightLast:!1,withLabel:!0,highlightStrokeColor:le.highlightstrokecolor}),Ge[C].getLabelAnchor=rt,Ze=nt(fe,C),I=0;I<n.length;I++)dt=n[I][C],M[I][C]=u.create("point",[dt,0],{name:"",fixed:!0,withlabel:!1,visible:!1}),M[I][C].addTransform(M[I][C],Ze);for(Ve=[],C=0;C<Ut;C++)for(le.labelcolor=ie&&ie[C%ie.length],le.strokecolor=ie&&ie[C%ie.length],le.fillcolor=ie&&ie[C%ie.length],Ve[C]=u.create("polygon",M[C],{withLines:!0,withLabel:!1,fillColor:le.fillcolor,fillOpacity:le.fillopacity,highlightFillColor:le.highlightfillcolor}),I=0;I<y;I++)Ve[C].borders[I].setAttribute("strokecolor:"+ie[C%ie.length]),Ve[C].borders[I].setAttribute("strokewidth:"+le.polystrokewidth);switch(Ye=d.legendposition||"none",Ye){case"right":Be=d.legendleftoffset||2,Ne=d.legendtopoffset||1,this.legend=u.create("legend",[ce+ne+Be,ge+ne-Ne],{labels:Q,colors:ie});break;case"none":break;default:JXG$1.debug("Unknown legend position")}if(be=[],d.showcircles){for(Ae=[],C=0;C<6;C++)Ae[C]=20*C;if(Ae[0]="0",Re=d.circlelabelarray||Ae,We=Re.length,We<2)throw new Error("JSXGraph radar chart: too less circles in circleLabelArray");for(De=[],Fe=Ie+Math.PI/y,Ze=nt(Fe,0),le.fillcolor="none",le.highlightfillcolor="none",le.strokecolor=d.strokecolor||"black",le.strokewidth=d.circlestrokewidth||.5,le.layer=0,Ke=(ee[0]-U[0])/(We-1),C=0;C<We;C++)De[C]=u.create("point",[U[0]+C*Ke,0],{name:Re[C],size:0,fixed:!0,withLabel:!0,visible:!0}),De[C].addTransform(De[C],Ze),be[C]=u.create("circle",[he,De[C]],le)}return this.rendNode=Ve[0].rendNode,{circles:be,lines:Ge,points:M,midpoint:he,polygons:Ve}},updateRenderer:function(){return this},update:function(){return this.needsUpdate&&this.updateDataArray(),this},updateDataArray:function(){return this}});JXG$1.createChart=function(u,n,d){var C,I,f,y,B,_=[],Z,M,V,T,H,F,O,$,U,ee,Q,ie=JXG$1.isBrowser?u.document.getElementById(n[0]):null;if(n.length===1&&JXG$1.isString(n[0])){if(JXG$1.exists(ie)){if(T=JXG$1.copyAttributes(d,u.options,"chart"),ie=new DataSource().loadFromTable(n[0],T.withheaders,T.withheaders),C=ie.data,B=ie.columnHeaders,I=ie.rowHeaders,H=T.width,F=T.name,O=T.strokecolor,$=T.fillcolor,U=T.highlightstrokecolor,ee=T.highlightfillcolor,u.suspendUpdate(),Q=C.length,V=[],T.rows&&JXG$1.isArray(T.rows)){for(f=0;f<Q;f++)for(y=0;y<T.rows.length;y++)if(T.rows[y]===f||T.withheaders&&T.rows[y]===I[f]){V.push(C[f]);break}}else V=C;for(Q=V.length,f=0;f<Q;f++){if(M=[],T.chartstyle&&T.chartstyle.indexOf("bar")!==-1){for(H?Z=H:Z=.8,M.push(1-Z/2+(f+.5)*Z/Q),y=1;y<V[f].length;y++)M.push(M[y-1]+1);T.width=Z/Q}F&&F.length===Q?T.name=F[f]:T.withheaders&&(T.name=B[f]),O&&O.length===Q?T.strokecolor=O[f]:T.strokecolor=JXG$1.hsv2rgb((f+1)/Q*360,.9,.6),$&&$.length===Q?T.fillcolor=$[f]:T.fillcolor=JXG$1.hsv2rgb((f+1)/Q*360,.9,1),U&&U.length===Q?T.highlightstrokecolor=U[f]:T.highlightstrokecolor=JXG$1.hsv2rgb((f+1)/Q*360,.9,1),ee&&ee.length===Q?T.highlightfillcolor=ee[f]:T.highlightfillcolor=JXG$1.hsv2rgb((f+1)/Q*360,.9,.6),T.chartstyle&&T.chartstyle.indexOf("bar")!==-1?_.push(new JXG$1.Chart(u,[M,V[f]],T)):_.push(new JXG$1.Chart(u,[V[f]],T))}u.unsuspendUpdate()}return _}return T=JXG$1.copyAttributes(d,u.options,"chart"),new JXG$1.Chart(u,n,T)};JXG$1.registerElement("chart",JXG$1.createChart);JXG$1.Legend=function(u,n,d){var C;if(this.constructor(),C=JXG$1.copyAttributes(d,u.options,"legend"),this.board=u,this.coords=new Coords(Const.COORDS_BY_USER,n,this.board),this.myAtts={},this.label_array=C.labelarray||C.labels,this.color_array=C.colorarray||C.colors,this.lines=[],this.myAtts.strokewidth=C.strokewidth||5,this.myAtts.straightfirst=!1,this.myAtts.straightlast=!1,this.myAtts.withlabel=!0,this.myAtts.fixed=!0,this.style=C.legendstyle||C.style,this.style==="vertical")this.drawVerticalLegend(u,C);else throw new Error("JSXGraph: Unknown legend style: "+this.style)};JXG$1.Legend.prototype=new GeometryElement;JXG$1.Legend.prototype.drawVerticalLegend=function(u,n){var d,C=n.linelength||1,I=(n.rowheight||20)/this.board.unitY,f=function(){return this.setLabelRelativeCoords(this.visProp.label.offset),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)};for(d=0;d<this.label_array.length;d++)this.myAtts.name=this.label_array[d],this.myAtts.strokecolor=this.color_array[d%this.color_array.length],this.myAtts.highlightstrokecolor=this.color_array[d%this.color_array.length],this.myAtts.label={offset:[10,0],strokeColor:this.color_array[d%this.color_array.length],strokeWidth:this.myAtts.strokewidth},this.lines[d]=u.create("line",[[this.coords.usrCoords[1],this.coords.usrCoords[2]-d*I],[this.coords.usrCoords[1]+C,this.coords.usrCoords[2]-d*I]],this.myAtts),this.lines[d].getLabelAnchor=f,this.lines[d].prepareUpdate().update().updateVisibility(JXG$1.evaluate(this.lines[d].visProp.visible)).updateRenderer()};JXG$1.createLegend=function(u,n,d){var C=[0,0];if(JXG$1.exists(n)&&n.length===2)C=n;else throw new Error("JSXGraph: Legend element needs two numbers as parameters");return new JXG$1.Legend(u,C,d)};JXG$1.registerElement("legend",JXG$1.createLegend);JXG$1.Chart,JXG$1.Legend;JXG$1.Transformation=function(u,n,d){this.elementClass=Const.OBJECT_CLASS_OTHER,this.type=Const.OBJECT_TYPE_TRANSFORMATION,this.matrix=[[1,0,0],[0,1,0],[0,0,1]],this.board=u,this.isNumericMatrix=!1,this.setMatrix(u,n,d),this.methodMap={apply:"apply",applyOnce:"applyOnce",bindTo:"bindTo",bind:"bindTo",melt:"melt"}};JXG$1.Transformation.prototype={};JXG$1.extend(JXG$1.Transformation.prototype,{update:function(){return this},setMatrix:function(u,n,d){var C;for(this.isNumericMatrix=!0,C=0;C<d.length;C++)if(typeof d[C]!="number"){this.isNumericMatrix=!1;break}if(n==="translate"){if(d.length!==2)throw new Error("JSXGraph: translate transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(u,d,2),this.update=function(){this.matrix[1][0]=this.evalParam(0),this.matrix[2][0]=this.evalParam(1)}}else if(n==="scale"){if(d.length!==2)throw new Error("JSXGraph: scale transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(u,d,2),this.update=function(){this.matrix[1][1]=this.evalParam(0),this.matrix[2][2]=this.evalParam(1)}}else if(n==="reflect")d.length<4&&(d[0]=u.select(d[0])),d.length===2&&(d[1]=u.select(d[1])),d.length===4&&(this.evalParam=JXG$1.createEvalFunction(u,d,4)),this.update=function(){var I,f,y,B,_,Z,M,V;d.length===1?M=d[0].stdform:d.length===2?M=Mat.crossProduct(d[1].coords.usrCoords,d[0].coords.usrCoords):d.length===4&&(M=Mat.crossProduct([1,this.evalParam(2),this.evalParam(3)],[1,this.evalParam(0),this.evalParam(1)])),I=M[1],f=M[2],y=M[0],V=[-y*I,-y*f,I*I+f*f],Z=V[2],B=V[0]/V[2],_=V[1]/V[2],I=-M[2],f=M[1],this.matrix[1][1]=(I*I-f*f)/Z,this.matrix[1][2]=2*I*f/Z,this.matrix[2][1]=this.matrix[1][2],this.matrix[2][2]=-this.matrix[1][1],this.matrix[1][0]=B*(1-this.matrix[1][1])-_*this.matrix[1][2],this.matrix[2][0]=_*(1-this.matrix[2][2])-B*this.matrix[2][1]};else if(n==="rotate")d.length===3?this.evalParam=JXG$1.createEvalFunction(u,d,3):d.length>0&&d.length<=2&&(this.evalParam=JXG$1.createEvalFunction(u,d,1),d.length===2&&!JXG$1.isArray(d[1])&&(d[1]=u.select(d[1]))),this.update=function(){var I,f,y=this.evalParam(0),B=Math.cos(y),_=Math.sin(y);this.matrix[1][1]=B,this.matrix[1][2]=-_,this.matrix[2][1]=_,this.matrix[2][2]=B,d.length>1&&(d.length===3?(I=this.evalParam(1),f=this.evalParam(2)):JXG$1.isArray(d[1])?(I=d[1][0],f=d[1][1]):(I=d[1].X(),f=d[1].Y()),this.matrix[1][0]=I*(1-B)+f*_,this.matrix[2][0]=f*(1-B)-I*_)};else if(n==="shear"){if(d.length!==2)throw new Error("JSXGraph: shear transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(u,d,2),this.update=function(){this.matrix[1][2]=this.evalParam(0),this.matrix[2][1]=this.evalParam(1)}}else if(n==="generic"){if(d.length!==9)throw new Error("JSXGraph: generic transformation needs 9 parameters.");this.evalParam=JXG$1.createEvalFunction(u,d,9),this.update=function(){this.matrix[0][0]=this.evalParam(0),this.matrix[0][1]=this.evalParam(1),this.matrix[0][2]=this.evalParam(2),this.matrix[1][0]=this.evalParam(3),this.matrix[1][1]=this.evalParam(4),this.matrix[1][2]=this.evalParam(5),this.matrix[2][0]=this.evalParam(6),this.matrix[2][1]=this.evalParam(7),this.matrix[2][2]=this.evalParam(8)}}},apply:function(u,n){return this.update(),JXG$1.exists(n)?Mat.matVecMult(this.matrix,u.initialCoords.usrCoords):Mat.matVecMult(this.matrix,u.coords.usrCoords)},applyOnce:function(u){var n,d,C;for(JXG$1.isArray(u)||(u=[u]),d=u.length,C=0;C<d;C++)this.update(),n=Mat.matVecMult(this.matrix,u[C].coords.usrCoords),u[C].coords.setCoordinates(Const.COORDS_BY_USER,n)},bindTo:function(u){var n,d;if(JXG$1.isArray(u))for(d=u.length,n=0;n<d;n++)u[n].transformations.push(this);else u.transformations.push(this)},setProperty:function(u){JXG$1.deprecated("Transformation.setProperty()","Transformation.setAttribute()")},setAttribute:function(u){},melt:function(u){var n=[],d,C,I,f,y,B;for(C=u.matrix.length,I=this.matrix[0].length,d=0;d<C;d++)n[d]=[];for(this.update(),u.update(),d=0;d<C;d++)for(B=0;B<I;B++){for(y=0,f=0;f<C;f++)y+=u.matrix[d][f]*this.matrix[f][B];n[d][B]=y}return this.update=function(){var _=this.matrix.length,Z=this.matrix[0].length;for(d=0;d<_;d++)for(B=0;B<Z;B++)this.matrix[d][B]=n[d][B]},this},getParents:function(){var u=[[].concat.apply([],this.matrix)];return this.parents.length!==0&&(u=this.parents),u}});JXG$1.createTransform=function(u,n,d){return new JXG$1.Transformation(u,d.type,n)};JXG$1.registerElement("transform",JXG$1.createTransform);JXG$1.Transformation;JXG$1.Turtle=function(u,n,d){var C,I,f;return this.constructor(u,d,Const.OBJECT_TYPE_TURTLE,Const.OBJECT_CLASS_OTHER),this.turtleIsHidden=!1,this.board=u,this.visProp.curveType="plot",this._attributes=JXG$1.copyAttributes(this.visProp,u.options,"turtle"),delete this._attributes.id,C=0,I=0,f=90,n.length!==0&&(n.length===3?(C=n[0],I=n[1],f=n[2]):n.length===2?JXG$1.isArray(n[0])?(C=n[0][0],I=n[0][1],f=n[1]):(C=n[0],I=n[1]):(C=n[0][0],I=n[0][1])),this.init(C,I,f),this.methodMap=JXG$1.deepCopy(this.methodMap,{forward:"forward",fd:"forward",back:"back",bk:"back",right:"right",rt:"right",left:"left",lt:"left",penUp:"penUp",pu:"penUp",up:"penUp",penDown:"penDown",pd:"penDown",down:"penDown",clearScreen:"clearScreen",cs:"clearScreen",clean:"clean",setPos:"setPos",home:"home",hideTurtle:"hideTurtle",ht:"hideTurtle",hide:"hideTurtle",showTurtle:"showTurtle",st:"showTurtle",show:"showTurtle",penSize:"setPenSize",setPenSize:"setPenSize",penColor:"setPenColor",setPenColor:"setPenColor",highlightPenColor:"setHighlightPenColor",setHighlightPenColor:"setHighlightPenColor",getPenColor:"getPenColor",Color:"getPenColor",getHighlightPenColor:"getHighlightPenColor",HighlightColor:"getHighlightPenColor",getPenSize:"getPenSize",Size:"getPenSize",pushTurtle:"pushTurtle",push:"pushTurtle",popTurtle:"popTurtle",pop:"popTurtle",lookTo:"lookTo",pos:"pos",Pos:"pos",moveTo:"moveTo",X:"X",Y:"Y"}),this};JXG$1.Turtle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Turtle.prototype,{init:function(u,n,d){var C={fixed:!0,name:"",visible:!1,withLabel:!1};this.arrowLen=20/Mat.hypot(this.board.unitX,this.board.unitY),this.pos=[u,n],this.isPenDown=!0,this.dir=90,this.stack=[],this.objects=[],this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.turtle=this.board.create("point",this.pos,C),this.objects.push(this.turtle),this.turtle2=this.board.create("point",[this.pos[0],this.pos[1]+this.arrowLen],C),this.objects.push(this.turtle2),this.visProp.arrow.lastArrow=!0,this.visProp.arrow.straightFirst=!1,this.visProp.arrow.straightLast=!1,this.arrow=this.board.create("line",[this.turtle,this.turtle2],this.visProp.arrow),this.objects.push(this.arrow),this.subs={arrow:this.arrow},this.inherits.push(this.arrow),this.right(90-d),this.board.update()},forward:function(u){if(u===0)return this;var n,d=u*Math.cos(this.dir*Math.PI/180),C=u*Math.sin(this.dir*Math.PI/180);return this.turtleIsHidden||(n=this.board.create("transform",[d,C],{type:"translate"}),n.applyOnce(this.turtle),n.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]+=d,this.pos[1]+=C,this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update(),this},back:function(u){return this.forward(-u)},right:function(u){if(this.dir-=u,this.dir%=360,!this.turtleIsHidden){var n=this.board.create("transform",[-u*Math.PI/180,this.turtle],{type:"rotate"});n.applyOnce(this.turtle2)}return this.board.update(),this},left:function(u){return this.right(-u)},penUp:function(){return this.isPenDown=!1,this},penDown:function(){return this.isPenDown=!0,this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this},clean:function(){var u,n;for(u=0;u<this.objects.length;u++)n=this.objects[u],n.type===Const.OBJECT_TYPE_CURVE&&(this.board.removeObject(n),this.objects.splice(u,1));return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},clearScreen:function(){var u,n,d=this.objects.length;for(u=0;u<d;u++)n=this.objects[u],this.board.removeObject(n);return this.init(0,0,90),this},setPos:function(u,n){var d;return JXG$1.isArray(u)?this.pos=u:this.pos=[u,n],this.turtleIsHidden||(this.turtle.setPositionDirectly(Const.COORDS_BY_USER,[u,n]),this.turtle2.setPositionDirectly(Const.COORDS_BY_USER,[u,n+this.arrowLen]),d=this.board.create("transform",[-(this.dir-90)*Math.PI/180,this.turtle],{type:"rotate"}),d.applyOnce(this.turtle2)),this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},setPenSize:function(u){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeWidth",u)),this.objects.push(this.curve),this},setPenColor:function(u){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeColor",u)),this.objects.push(this.curve),this},getPenAttribute:function(u){var n,d=this.objects.length;return d===4?n=0:n=d-1,JXG$1.evaluate(this.objects[n].visProp[u])},getPenSize:function(){return this.getPenAttribute("strokewidth")},getPenColor:function(){return this.getPenAttribute("strokecolor")},getHighlightPenColor:function(){return this.getPenAttribute("highlightstrokecolor")},setHighlightPenColor:function(u){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("highlightStrokeColor",u)),this.objects.push(this.curve),this},setAttribute:function(u){var n,d,C,I=this.objects.length;for(n=0;n<I;n++)d=this.objects[n],d.type===Const.OBJECT_TYPE_CURVE&&d.setAttribute(u);return C=this.visProp.id,this.visProp=JXG$1.deepCopy(this.curve.visProp),this.visProp.id=C,this._attributes=JXG$1.deepCopy(this.visProp),delete this._attributes.id,this},copyAttr:function(u,n){return this._attributes[u.toLowerCase()]=n,this._attributes},showTurtle:function(){return this.turtleIsHidden=!1,this.arrow.setAttribute({visible:!0}),this.visProp.arrow.visible=!1,this.setPos(this.pos[0],this.pos[1]),this.board.update(),this},hideTurtle:function(){return this.turtleIsHidden=!0,this.arrow.setAttribute({visible:!1}),this.visProp.arrow.visible=!1,this.board.update(),this},home:function(){return this.pos=[0,0],this.setPos(this.pos[0],this.pos[1]),this},pushTurtle:function(){return this.stack.push([this.pos[0],this.pos[1],this.dir]),this},popTurtle:function(){var u=this.stack.pop();return this.pos[0]=u[0],this.pos[1]=u[1],this.dir=u[2],this.setPos(this.pos[0],this.pos[1]),this},lookTo:function(u){var n,d,C,I,f;return JXG$1.isArray(u)?(n=this.pos[0],d=this.pos[1],C=u[0],I=u[1],f=Math.atan2(I-d,C-n),this.right(this.dir-f*180/Math.PI)):JXG$1.isNumber(u)&&this.right(this.dir-u),this},moveTo:function(u){var n,d,C;return JXG$1.isArray(u)&&(n=u[0]-this.pos[0],d=u[1]-this.pos[1],this.turtleIsHidden||(C=this.board.create("transform",[n,d],{type:"translate"}),C.applyOnce(this.turtle),C.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]=u[0],this.pos[1]=u[1],this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update()),this},fd:function(u){return this.forward(u)},bk:function(u){return this.back(u)},lt:function(u){return this.left(u)},rt:function(u){return this.right(u)},pu:function(){return this.penUp()},pd:function(){return this.penDown()},ht:function(){return this.hideTurtle()},st:function(){return this.showTurtle()},cs:function(){return this.clearScreen()},push:function(){return this.pushTurtle()},pop:function(){return this.popTurtle()},evalAt:function(u,n){var d,C,I,f,y=this.objects.length;for(d=0,C=0;d<y;d++)if(I=this.objects[d],I.elementClass===Const.OBJECT_CLASS_CURVE){if(C<=u&&u<C+I.numberPoints)return f=u-C,I[n](f);C+=I.numberPoints}return this[n]()},X:function(u){return JXG$1.exists(u)?this.evalAt(u,"X"):this.pos[0]},Y:function(u){return JXG$1.exists(u)?this.evalAt(u,"Y"):this.pos[1]},Z:function(u){return 1},minX:function(){return 0},maxX:function(){var u,n,d=this.objects.length,C=0;for(u=0;u<d;u++)n=this.objects[u],n.elementClass===Const.OBJECT_CLASS_CURVE&&(C+=this.objects[u].numberPoints);return C},hasPoint:function(u,n){var d,C;for(d=0;d<this.objects.length;d++)if(C=this.objects[d],C.type===Const.OBJECT_TYPE_CURVE&&C.hasPoint(u,n))return!0;return!1}});JXG$1.createTurtle=function(u,n,d){var C;return n=n||[],C=JXG$1.copyAttributes(d,u.options,"turtle"),new JXG$1.Turtle(u,n,C)};JXG$1.registerElement("turtle",JXG$1.createTurtle);JXG$1.Turtle;JXG$1.Ticks=function(u,n,d){if(this.constructor(u.board,d,Const.OBJECT_TYPE_TICKS,Const.OBJECT_CLASS_OTHER),this.line=u,this.board=this.line.board,this.fixedTicks=null,this.equidistant=!1,this.labelsData=[],JXG$1.isFunction(n))throw this.ticksFunction=n,new Error("Function arguments are no longer supported.");JXG$1.isArray(n)?this.fixedTicks=n:this.equidistant=!0,this.ticks=[],this.labels=[],this.labelCounter=0,this.id=this.line.addTicks(this),this.elType="ticks",this.inherits.push(this.labels),this.board.setId(this,"Ti")};JXG$1.Ticks.prototype=new GeometryElement;JXG$1.extend(JXG$1.Ticks.prototype,{hasPoint:function(u,n){var d,C,I,f,y=this.ticks&&this.ticks.length||0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(f=this.board._inputDevice,I=JXG$1.evaluate(this.visProp.precision[f])):I=this.board.options.precision.hasPoint,I+=JXG$1.evaluate(this.visProp.strokewidth)*.5,!JXG$1.evaluate(this.line.visProp.scalable)||this.line.elementClass===Const.OBJECT_CLASS_CURVE||this.line.stdform[1]!==0&&this.line.stdform[2]!==0&&this.line.type!==Const.OBJECT_TYPE_AXIS)return!1;for(d=0;d<y;d++)if(C=this.ticks[d],C[2]&&!(this.line.stdform[1]===0&&Math.abs(C[0][0]-this.line.point1.coords.scrCoords[1])<Mat.eps||this.line.stdform[2]===0&&Math.abs(C[1][0]-this.line.point1.coords.scrCoords[2])<Mat.eps)&&(Math.abs(C[0][0]-C[0][1])>=1||Math.abs(C[1][0]-C[1][1])>=1)){if(this.line.stdform[1]===0){if(Math.abs(n-this.line.point1.coords.scrCoords[2])<2*I&&C[0][0]-I<u&&u<C[0][1]+I)return!0}else if(this.line.stdform[2]===0&&Math.abs(u-this.line.point1.coords.scrCoords[1])<2*I&&C[1][0]-I<n&&n<C[1][1]+I)return!0}return!1},setPositionDirectly:function(u,n,d){var C,I,f=new Coords(u,n,this.board),y=new Coords(u,d,this.board),B=this.board.getBoundingBox();return this.line.type!==Const.OBJECT_TYPE_AXIS||!JXG$1.evaluate(this.line.visProp.scalable)?this:(Math.abs(this.line.stdform[1])<Mat.eps&&Math.abs(f.usrCoords[1]*y.usrCoords[1])>Mat.eps?(C=y.usrCoords[1]/f.usrCoords[1],B[0]*=C,B[2]*=C,this.board.setBoundingBox(B,this.board.keepaspectratio,"update")):Math.abs(this.line.stdform[2])<Mat.eps&&Math.abs(f.usrCoords[2]*y.usrCoords[2])>Mat.eps&&(I=y.usrCoords[2]/f.usrCoords[2],B[3]*=I,B[1]*=I,this.board.setBoundingBox(B,this.board.keepaspectratio,"update")),this)},calculateTicksCoordinates:function(){var u,n,d,C;if(!(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(this.setTicksSizeVariables(),Math.abs(this.dx)<Mat.eps&&Math.abs(this.dy)<Mat.eps)))return u=this.getZeroCoordinates(),this.line.elementClass===Const.OBJECT_CLASS_LINE?n=this.getLowerAndUpperBounds(u,"ticksdistance"):n={lower:this.line.minX(),upper:this.line.maxX(),a1:0,a2:0,m1:0,m2:0},JXG$1.evaluate(this.visProp.type)==="polar"&&(C=this.board.getBoundingBox(),d=Math.max(Mat.hypot(C[0],C[1]),Mat.hypot(C[2],C[3])),n.upper=d),this.ticks=[],this.labelsData=[],this.equidistant?this.generateEquidistantTicks(u,n):this.generateFixedTicks(u,n),this},setTicksSizeVariables:function(u){var n,d,C,I,f=JXG$1.evaluate(this.visProp.majorheight)*.5,y=JXG$1.evaluate(this.visProp.minorheight)*.5;JXG$1.exists(u)?(d=this.line.minX(),C=this.line.maxX(),I=this.line.points.length,I<2?(this.dxMaj=0,this.dyMaj=0):Mat.relDif(u,d)<Mat.eps?(this.dxMaj=this.line.points[0].usrCoords[2]-this.line.points[1].usrCoords[2],this.dyMaj=this.line.points[1].usrCoords[1]-this.line.points[0].usrCoords[1]):Mat.relDif(u,C)<Mat.eps?(this.dxMaj=this.line.points[I-2].usrCoords[2]-this.line.points[I-1].usrCoords[2],this.dyMaj=this.line.points[I-1].usrCoords[1]-this.line.points[I-2].usrCoords[1]):(this.dxMaj=-Numerics.D(this.line.Y)(u),this.dyMaj=Numerics.D(this.line.X)(u))):(this.dxMaj=this.line.stdform[1],this.dyMaj=this.line.stdform[2]),this.dxMin=this.dxMaj,this.dyMin=this.dyMaj,this.dx=this.dxMaj,this.dy=this.dyMaj,n=Mat.hypot(this.dxMaj*this.board.unitX,this.dyMaj*this.board.unitY),this.dxMaj*=f/n*this.board.unitX,this.dyMaj*=f/n*this.board.unitY,this.dxMin*=y/n*this.board.unitX,this.dyMin*=y/n*this.board.unitY,this.minStyle=JXG$1.evaluate(this.visProp.minorheight)<0?"infinite":"finite",this.majStyle=JXG$1.evaluate(this.visProp.majorheight)<0?"infinite":"finite"},getZeroCoordinates:function(){var u,n,d,C,I,f,y,B,_,Z=JXG$1.evaluate(this.visProp.anchor);return this.line.elementClass===Const.OBJECT_CLASS_LINE?this.line.type===Const.OBJECT_TYPE_AXIS?Geometry.projectPointToLine({coords:{usrCoords:[1,0,0]}},this.line,this.board):(d=this.line.point1.coords.usrCoords[0],u=this.line.point1.coords.usrCoords[1],n=this.line.point1.coords.usrCoords[2],f=this.line.point2.coords.usrCoords[0],C=this.line.point2.coords.usrCoords[1],I=this.line.point2.coords.usrCoords[2],Z==="right"?this.line.point2.coords:Z==="middle"?new Coords(Const.COORDS_BY_USER,[(d+f)*.5,(u+C)*.5,(n+I)*.5],this.board):JXG$1.isNumber(Z)?new Coords(Const.COORDS_BY_USER,[d+(f-d)*Z,u+(C-u)*Z,n+(I-n)*Z],this.board):this.line.point1.coords):(B=this.line.minX(),_=this.line.maxX(),Z==="right"?y=_:Z==="middle"?y=(B+_)*.5:JXG$1.isNumber(Z)?y=B*(1-Z)+_*Z:y=B,y)},getLowerAndUpperBounds:function(u,n){var d,C,I,f,y,B,_,Z,M,V,T,H,F,O,$,U=Mat.eps*10,ee=JXG$1.evaluate(this.line.visProp.straightfirst),Q=JXG$1.evaluate(this.line.visProp.straightlast),ie=JXG$1.evaluate(this.visProp.includeboundaries);return this.line.elementClass===Const.OBJECT_CLASS_CURVE?{lower:this.line.minX(),upper:this.line.maxX()}:(y=new Coords(Const.COORDS_BY_USER,this.line.point1.coords.usrCoords,this.board),B=new Coords(Const.COORDS_BY_USER,this.line.point2.coords.usrCoords,this.board),_=Math.abs(y.usrCoords[0])>=Mat.eps&&y.scrCoords[1]>=0&&y.scrCoords[1]<=this.board.canvasWidth&&y.scrCoords[2]>=0&&y.scrCoords[2]<=this.board.canvasHeight,Z=Math.abs(B.usrCoords[0])>=Mat.eps&&B.scrCoords[1]>=0&&B.scrCoords[1]<=this.board.canvasWidth&&B.scrCoords[2]>=0&&B.scrCoords[2]<=this.board.canvasHeight,JXG$1.exists(n)&&n==="ticksdistance"?(Geometry.calcStraight(this.line,y,B,0),O=this.getDistanceFromZero(u,y),$=this.getDistanceFromZero(u,B),Geometry.calcStraight(this.line,y,B,JXG$1.evaluate(this.line.visProp.margin)),O=this.getDistanceFromZero(u,y)-O,$=this.getDistanceFromZero(u,B).m2):Geometry.calcLineDelimitingPoints(this.line,y,B),I=JXG$1.evaluate(this.line.visProp.firstarrow),f=JXG$1.evaluate(this.line.visProp.lastarrow),H=this.getDistanceFromZero(u,y),F=this.getDistanceFromZero(u,B),(I||f)&&(T=this.board.renderer.getArrowHeadData(this.line,JXG$1.evaluate(this.line.visProp.strokewidth),""),this.board.renderer.getPositionArrowHead(this.line,y,B,T)),M=this.getDistanceFromZero(u,y),V=this.getDistanceFromZero(u,B),H=M-H,F=M-F,M<V?(d=M,C=V,!ee&&_&&!ie&&(d+=U),!Q&&Z&&!ie&&(C-=U)):V<M?(d=V,C=M,!Q&&Z&&!ie&&(d+=U),!ee&&_&&!ie&&(C-=U)):(d=0,C=0),{lower:d,upper:C,a1:H,a2:F,m1:O,m2:$})},getDistanceFromZero:function(u,n){var d,C,I,f,y;return d=this.line.point1.coords,C=this.line.point2.coords,y=u.distance(Const.COORDS_BY_USER,n),I=[C.usrCoords[0]-d.usrCoords[0],C.usrCoords[1]-d.usrCoords[1],C.usrCoords[2]-d.usrCoords[2]],f=[n.usrCoords[0]-u.usrCoords[0],n.usrCoords[1]-u.usrCoords[1],n.usrCoords[2]-u.usrCoords[2]],Mat.innerProduct(I,f,3)<0&&(y*=-1),y},generateEquidistantTicks:function(u,n){var d,C=Mat.eps,I,f,y=JXG$1.evaluate(this.visProp.minorticks);if(f=this.getDistanceMajorTicks(),this.line.elementClass===Const.OBJECT_CLASS_LINE&&(I=this.getXandYdeltas()),f*=JXG$1.evaluate(this.visProp.scale),f/=y+1,this.ticksDelta=f,!(f<Mat.eps)){for(d=0,JXG$1.evaluate(this.visProp.drawzero)||(d=f);d<=n.upper+C&&(d>=n.lower-C&&this.processTickPosition(u,d,f,I),d+=f,!(n.upper-d>f*1e4)););for(d=-f;d>=n.lower-C&&(d<=n.upper+C&&this.processTickPosition(u,d,f,I),d-=f,!(d-n.lower>f*1e4)););}},getDistanceMajorTicks:function(){var u,n,d,C,I,f,y=5,B,_,Z;return JXG$1.evaluate(this.visProp.insertticks)?(d=this.getLowerAndUpperBounds(this.getZeroCoordinates(),""),I=d.upper-d.lower,f=JXG$1.evaluate(this.visProp.scale),B=I/(y+1)/f,_=JXG$1.evaluate(this.visProp.minticksdistance)/f,Z=JXG$1.evaluate(this.visProp.minorticks),C=this.getXandYdeltas(),C.x*=this.board.unitX,C.y*=this.board.unitY,_/=Mat.hypot(C.x,C.y),_*=Z+1,u=Math.pow(10,Math.floor(Math.log(_)/Math.LN10)),2*u>=_?u*=2:5*u>=_&&(u*=5),n=Math.pow(10,Math.floor(Math.log(B)/Math.LN10)),5*n<B?n*=5:2*n<B&&(n*=2),u=Math.max(u,n),u):JXG$1.evaluate(this.visProp.ticksdistance)},processTickPosition:function(u,n,d,C){var I,f,y,B,_,Z=JXG$1.evaluate(this.visProp.ticksperlabel),M=null;this.line.elementClass===Const.OBJECT_CLASS_LINE?(I=u.usrCoords[1]+n*C.x,f=u.usrCoords[2]+n*C.y):(I=this.line.X(u+n),f=this.line.Y(u+n)),y=new Coords(Const.COORDS_BY_USER,[I,f],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&(M=u+n,this.setTicksSizeVariables(M)),y.major=Math.round(n/d)%(JXG$1.evaluate(this.visProp.minorticks)+1)===0,Z||(Z=JXG$1.evaluate(this.visProp.minorticks)+1),_=Math.round(n/d)%Z===0,B=this.createTickPath(y,y.major),B.length===3&&(this.ticks.push(B),_&&JXG$1.evaluate(this.visProp.drawlabels)?this.labelsData.push(this.generateLabelData(this.generateLabelText(y,u,M),y,this.ticks.length)):this.labelsData.push(null))},generateFixedTicks:function(u,n){var d,C,I,f,y,B,_=Mat.eps,Z,M=JXG$1.isArray(this.visProp.labels),V,T=JXG$1.evaluate(this.visProp.drawlabels);for(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(V=this.getXandYdeltas()),I=0;I<this.fixedTicks.length;I++)this.line.elementClass===Const.OBJECT_CLASS_LINE?(Z=this.fixedTicks[I],y=u.usrCoords[1]+Z*V.x,B=u.usrCoords[2]+Z*V.y):(Z=u+this.fixedTicks[I],y=this.line.X(Z),B=this.line.Y(Z)),d=new Coords(Const.COORDS_BY_USER,[y,B],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&this.setTicksSizeVariables(Z),f=this.createTickPath(d,!0),f.length===3&&Z>=n.lower-_&&Z<=n.upper+_&&(this.ticks.push(f),T&&(M||JXG$1.exists(this.visProp.labels[I]))?(C=M?JXG$1.evaluate(this.visProp.labels[I]):Z,this.labelsData.push(this.generateLabelData(this.generateLabelText(d,u,C),d,I))):this.labelsData.push(null))},getXandYdeltas:function(){var u,n,d=this.line.point1.Dist(this.line.point2);return u=this.line.point1.coords.usrCoords,n=this.line.point2.coords.usrCoords,{x:(n[1]-u[1])/d,y:(n[2]-u[2])/d}},_isInsideCanvas:function(u,n,d){var C=this.board.canvasWidth,I=this.board.canvasHeight;return d===void 0&&(d=0),u[0]>=d&&u[0]<=C-d&&n[0]>=d&&n[0]<=I-d||u[1]>=d&&u[1]<=C-d&&n[1]>=d&&n[1]<=I-d},createTickPath:function(u,n){var d,C,I,f,y,B,_,Z,M,V=[-2e6,-2e6],T=[-2e6,-2e6],H,F,O,$,U,ee,Q,ie,ne;if(d=u.scrCoords,n?(f=this.dxMaj,y=this.dyMaj,M=this.majStyle,Q=JXG$1.evaluate(this.visProp.majortickendings[0])>0,ie=JXG$1.evaluate(this.visProp.majortickendings[1])>0):(f=this.dxMin,y=this.dyMin,M=this.minStyle,Q=JXG$1.evaluate(this.visProp.tickendings[0])>0,ie=JXG$1.evaluate(this.visProp.tickendings[1])>0),C=[-y*d[1]-f*d[2],y,f],n&&JXG$1.evaluate(this.visProp.type)==="polar"){if($=this.board.getBoundingBox(),U=2*Math.PI,ee=U/180,d=u.usrCoords,F=Mat.hypot(d[1],d[2]),O=Math.max(Mat.hypot($[0],$[1]),Mat.hypot($[2],$[3])),F<O){for(V=[],T=[],H=0;H<=U;H+=ee)V.push(this.board.origin.scrCoords[1]+F*Math.cos(H)*this.board.unitX),T.push(this.board.origin.scrCoords[2]+F*Math.sin(H)*this.board.unitY);return[V,T,n]}}else{if(M==="infinite"){if(JXG$1.evaluate(this.visProp.ignoreinfinitetickendings)&&(Q=ie=!0),I=Geometry.meetLineBoard(C,this.board),Q&&ie)V[0]=I[0].scrCoords[1],V[1]=I[1].scrCoords[1],T[0]=I[0].scrCoords[2],T[1]=I[1].scrCoords[2];else if(ne=[Mat.innerProduct(I[0].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0],Mat.innerProduct(I[1].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0]],ne[0]<ne[1]&&(I.reverse(),ne.reverse()),Q){if(ne[0]<0)return[];ne[1]<0?(V[0]=I[0].scrCoords[1],T[0]=I[0].scrCoords[2],V[1]=d[1],T[1]=d[2]):(V[0]=I[0].scrCoords[1],T[0]=I[0].scrCoords[2],V[1]=I[1].scrCoords[1],T[1]=I[1].scrCoords[2])}else if(ie){if(ne[1]>0)return[];ne[0]>0?(V[0]=d[1],T[0]=d[2],V[1]=I[1].scrCoords[1],T[1]=I[1].scrCoords[2]):(V[0]=I[0].scrCoords[1],T[0]=I[0].scrCoords[2],V[1]=I[1].scrCoords[1],T[1]=I[1].scrCoords[2])}}else JXG$1.evaluate(this.visProp.face)===">"?Z=Math.PI/4:JXG$1.evaluate(this.visProp.face)==="<"?Z=-Math.PI/4:Z=0,B=Math.cos(Z)*f-Math.sin(Z)*y,_=Math.sin(Z)*f+Math.cos(Z)*y,V[0]=d[1]+B*Q,T[0]=d[2]-_*Q,V[1]=d[1],T[1]=d[2],Z=-Z,B=Math.cos(Z)*f-Math.sin(Z)*y,_=Math.sin(Z)*f+Math.cos(Z)*y,V[2]=d[1]-B*ie,T[2]=d[2]+_*ie;if(this._isInsideCanvas(V,T))return[V,T,n]}return[]},formatLabelText:function(u){var n,d,C=JXG$1.evaluate(this.visProp.label.usemathjax),I=JXG$1.evaluate(this.visProp.label.usekatex),f=JXG$1.evaluate(this.visProp.scalesymbol);return JXG$1.isNumber(u)?(JXG$1.evaluate(this.visProp.label.tofraction)?C?n="\\("+JXG$1.toFraction(u,!0)+"\\)":n=JXG$1.toFraction(u,I):(d=JXG$1.evaluate(this.visProp.digits),this.useLocale()?n=this.formatNumberLocale(u,d):(n=(Math.round(u*1e11)/1e11).toString(),(n.length>JXG$1.evaluate(this.visProp.maxlabellength)||n.indexOf("e")!==-1)&&(JXG$1.evaluate(this.visProp.precision)!==3&&d===3&&(d=JXG$1.evaluate(this.visProp.precision)),n=u.toExponential(d).toString()))),JXG$1.evaluate(this.visProp.beautifulscientificticklabels)&&(n=this.beautifyScientificNotationLabel(n)),n.indexOf(".")>-1&&n.indexOf("e")===-1&&(n=n.replace(/0+$/,""),n=n.replace(/\.$/,""))):n=u.toString(),f.length>0&&(n==="1"?n=f:n==="-1"?n="-"+f:n!=="0"&&(n=n+f)),JXG$1.evaluate(this.visProp.useunicodeminus)&&(n=n.replace(/-/g,"−")),n},beautifyScientificNotationLabel:function(u){var n;return u.indexOf("e")===-1?u:(n=parseFloat(u.substring(0,u.indexOf("e")))+u.substring(u.indexOf("e")),n=n.replace(/e(.*)$/g,function(d,C){var I="•10";return I+=C.replace(/-/g,"⁻").replace(/\+/g,"").replace(/0/g,"⁰").replace(/1/g,"¹").replace(/2/g,"²").replace(/3/g,"³").replace(/4/g,"⁴").replace(/5/g,"⁵").replace(/6/g,"⁶").replace(/7/g,"⁷").replace(/8/g,"⁸").replace(/9/g,"⁹"),I}),n)},generateLabelText:function(u,n,d){var C,I;if(!JXG$1.exists(d)){if(I=this.getDistanceFromZero(n,u),Math.abs(I)<Mat.eps)return"0";d=I/JXG$1.evaluate(this.visProp.scale)}return C=this.formatLabelText(d),C},generateLabelData:function(u,n,d){var C,I,f,y;return y=JXG$1.evaluate(this.visProp.label.fontsize),C=[n.scrCoords[1],n.scrCoords[1]],I=[n.scrCoords[2],n.scrCoords[2]],f=y===void 0?12:y,f*=.5,this._isInsideCanvas(C,I,f)?(C=JXG$1.evaluate(this.visProp.label.offset[0]),I=JXG$1.evaluate(this.visProp.label.offset[1]),{x:n.usrCoords[1]+C/this.board.unitX,y:n.usrCoords[2]+I/this.board.unitY,t:u,i:d}):null},update:function(){return this.needsUpdate&&this.board.canvasWidth!==0&&this.board.canvasHeight!==0&&this.calculateTicksCoordinates(),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&this.board.renderer.updateTicks(this),this.updateRendererLabels(),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateRendererLabels:function(){var u,n,d,C,I,f,y,B;for(d=this.labelsData.length,C=this.labels.length,u=0,n=0;u<d;u++)this.labelsData[u]!==null&&(y=this.labelsData[u],n<C?(f=this.labels[n],f.setText(y.t),f.setCoords(y.x,y.y),n++):(this.labelCounter+=1,I={isLabel:!0,layer:this.board.options.layer.line,highlightStrokeColor:this.board.options.text.strokeColor,highlightStrokeWidth:this.board.options.text.strokeWidth,highlightStrokeOpacity:this.board.options.text.strokeOpacity,priv:this.visProp.priv},I=JXG$1.deepCopy(I,this.visProp.label),I.id=this.id+y.i+"Label"+this.labelCounter,f=JXG$1.createText(this.board,[y.x,y.y,y.t],I),this.addChild(f),f.setParents(this),f.isDraggable=!1,f.dump=!1,this.labels.push(f)),B=JXG$1.evaluate(this.visProp.label.visible),B==="inherit"&&(B=this.visPropCalc.visible),f.prepareUpdate().updateVisibility(B).updateRenderer(),f.distanceX=JXG$1.evaluate(this.visProp.label.offset[0]),f.distanceY=JXG$1.evaluate(this.visProp.label.offset[1]));for(d=n,n=d;n<C;n++)this.board.renderer.display(this.labels[n],!1),this.labels[n].visProp.visible=this.labels[n].visPropCalc.visible=!1;return this},hideElement:function(){var u;for(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),u=0;u<this.labels.length;u++)JXG$1.exists(this.labels[u])&&this.labels[u].hideElement();return this},showElement:function(){var u;for(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!1),u=0;u<this.labels.length;u++)JXG$1.exists(this.labels[u])&&this.labels[u].showElement();return this}});JXG$1.createTicks=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"ticks");if(n.length<2?I=f.ticksdistance:I=n[1],n[0].elementClass===Const.OBJECT_CLASS_LINE||n[0].elementClass===Const.OBJECT_CLASS_CURVE)C=new JXG$1.Ticks(n[0],I,f);else throw new Error("JSXGraph: Can't create Ticks with parent types '"+typeof n[0]+"'.");return JXG$1.isFunction(f.generatelabelvalue)&&(C.generateLabelText=f.generatelabelvalue),JXG$1.isFunction(f.generatelabeltext)&&(C.generateLabelText=f.generatelabeltext),C.setParents(n[0]),C.isDraggable=!0,C.fullUpdate(n[0].visPropCalc.visible),C};JXG$1.createHatchmark=function(u,n,d){var C,I,f,y,B,_,Z=[],M=JXG$1.copyAttributes(d,u.options,"hatch");if(n[0].elementClass!==Const.OBJECT_CLASS_LINE&&n[0].elementClass!==Const.OBJECT_CLASS_CURVE||typeof n[1]!="number")throw new Error("JSXGraph: Can't create Hatch mark with parent types '"+typeof n[0]+"' and '"+typeof n[1]+" and ''"+typeof n[2]+"'.");for(C=n[1],y=M.ticksdistance,B=(C-1)*y,f=-B*.5,I=0;I<C;I++)Z[I]=f+I*y;return _=u.create("ticks",[n[0],Z],M),_.elType="hatch",n[0].inherits.push(_),_};JXG$1.registerElement("ticks",JXG$1.createTicks);JXG$1.registerElement("hash",JXG$1.createHatchmark);JXG$1.registerElement("hatch",JXG$1.createHatchmark);JXG$1.Ticks;var bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],NAMEMAX=256;JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Unzip=function(u){var n,d,C,I,f=[],y=0,B=[],_=new Array(32768),Z=0,M=!1,V=u.length,T=0,H=1,F=new Array(288),O=new Array(32),$=0,U=null,ee=0,Q=new Array(17),ie=[];Q[0]=0;function ne(){return T<V?u[T++]:-1}function le(){H=1}function ae(){var Ye;try{Ye=H&1,H>>=1,H===0&&(H=ne(),Ye=H&1,H=H>>1|128)}catch(be){throw console.log("Probably problems on iOS7 with >>"),be}return Ye}function ce(Ye){var be=0,Be=Ye;try{for(;Be--;)be=be<<1|ae();Ye&&(be=bitReverse[be]>>8-Ye)}catch(Ne){throw console.log("Probably problems on iOS7 with >>"),Ne}return be}function ge(){Z=0}function he(Ye){_[Z++]=Ye,f.push(String.fromCharCode(Ye)),Z===32768&&(Z=0)}function Ie(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1}function fe(){for(var Ye=!0;Ye;){if(Q[ee]>=I)return-1;if(C[Q[ee]]===ee)return Q[ee]++;Q[ee]++}}function me(){var Ye=U[$],be;if(ee===17)return-1;if($++,ee++,be=fe(),be>=0)Ye.b0=be;else if(Ye.b0=32768,me())return-1;if(be=fe(),be>=0)Ye.b1=be,Ye.jump=null;else if(Ye.b1=32768,Ye.jump=U[$],Ye.jumppos=$,me())return-1;return ee--,0}function Ge(Ye,be,Be,Ne){var Ae;for(U=Ye,$=0,C=Be,I=be,Ae=0;Ae<17;Ae++)Q[Ae]=0;return ee=0,me()?-1:0}function Ze(Ye){for(var be,Be,Ne,Ae=!0,Re=0,We=Ye[Re];Ae;)if(Ne=ae(),Ne){if(!(We.b1&32768))return We.b1;for(We=We.jump,be=Ye.length,Be=0;Be<be;Be++)if(Ye[Be]===We){Re=Be;break}}else{if(!(We.b0&32768))return We.b0;Re++,We=Ye[Re]}}function ye(){var Ye,be,Be,Ne,Ae,Re,We,De,Fe,Ke,Rt,dt,Ut,rt,nt,we,Jt=!0;do if(Ye=ae(),Be=ce(2),Be===0)for(le(),Ke=ne(),Ke|=ne()<<8,dt=ne(),dt|=ne()<<8,(Ke^~dt)&65535&&JXG$1.debug(`BlockLen checksum mismatch
`);Ke--;)be=ne(),he(be);else if(Be===1)for(;Jt;)if(Ae=bitReverse[ce(7)]>>1,Ae>23?(Ae=Ae<<1|ae(),Ae>199?(Ae-=128,Ae=Ae<<1|ae()):(Ae-=48,Ae>143&&(Ae=Ae+136))):Ae+=256,Ae<256)he(Ae);else{if(Ae===256)break;for(Ae-=257,Fe=ce(cplext[Ae])+cplens[Ae],Ae=bitReverse[ce(5)]>>3,cpdext[Ae]>8?(Rt=ce(8),Rt|=ce(cpdext[Ae]-8)<<8):Rt=ce(cpdext[Ae]),Rt+=cpdist[Ae],Ae=0;Ae<Fe;Ae++)be=_[Z-Rt&32767],he(be)}else if(Be===2){for(We=new Array(320),rt=257+ce(5),nt=1+ce(5),we=4+ce(4),Ae=0;Ae<19;Ae++)We[Ae]=0;for(Ae=0;Ae<we;Ae++)We[border[Ae]]=ce(3);for(Fe=O.length,Ne=0;Ne<Fe;Ne++)O[Ne]=new Ie;if(Ge(O,19,We))return ge(),1;for(Ut=rt+nt,Ne=0;Ne<Ut;)if(Ae=Ze(O),Ae<16)We[Ne++]=Ae;else if(Ae===16){if(Ae=3+ce(2),Ne+Ae>Ut)return ge(),1;for(Re=Ne?We[Ne-1]:0;Ae--;)We[Ne++]=Re}else{if(Ae===17?Ae=3+ce(3):Ae=11+ce(7),Ne+Ae>Ut)return ge(),1;for(;Ae--;)We[Ne++]=0}for(Fe=F.length,Ne=0;Ne<Fe;Ne++)F[Ne]=new Ie;if(Ge(F,rt,We))return ge(),1;for(Fe=F.length,Ne=0;Ne<Fe;Ne++)O[Ne]=new Ie;for(De=[],Ne=rt;Ne<We.length;Ne++)De[Ne-rt]=We[Ne];if(Ge(O,nt,De))return ge(),1;for(;Jt;)if(Ae=Ze(F),Ae>=256){if(Ae-=256,Ae===0)break;for(Ae-=1,Fe=ce(cplext[Ae])+cplens[Ae],Ae=Ze(O),cpdext[Ae]>8?(Rt=ce(8),Rt|=ce(cpdext[Ae]-8)<<8):Rt=ce(cpdext[Ae]),Rt+=cpdist[Ae];Fe--;)be=_[Z-Rt&32767],he(be)}else he(Ae)}while(!Ye);return ge(),le(),0}function Ee(){var Ye,be,Be,Ne,Ae,Re,We,De,Fe=[];try{if(f=[],M=!1,Fe[0]=ne(),Fe[1]=ne(),Fe[0]===120&&Fe[1]===218&&(ye(),B[y]=[f.join(""),"geonext.gxt"],y++),Fe[0]===31&&Fe[1]===139&&(Ve(),B[y]=[f.join(""),"file"],y++),Fe[0]===80&&Fe[1]===75){if(M=!0,Fe[2]=ne(),Fe[3]=ne(),Fe[2]===3&&Fe[3]===4){for(Fe[0]=ne(),Fe[1]=ne(),n=ne(),n|=ne()<<8,De=ne(),De|=ne()<<8,ne(),ne(),ne(),ne(),We=ne(),We|=ne()<<8,We|=ne()<<16,We|=ne()<<24,Re=ne(),Re|=ne()<<8,Re|=ne()<<16,Re|=ne()<<24,Ae=ne(),Ae|=ne()<<8,Ae|=ne()<<16,Ae|=ne()<<24,Ne=ne(),Ne|=ne()<<8,Be=ne(),Be|=ne()<<8,Ye=0,ie=[];Ne--;)be=ne(),be==="/"|be===":"?Ye=0:Ye<NAMEMAX-1&&(ie[Ye++]=String.fromCharCode(be));for(d||(d=ie),Ye=0;Ye<Be;)be=ne(),Ye++;if(De===8&&(ye(),B[y]=new Array(2),B[y][0]=f.join(""),B[y][1]=ie.join(""),y++),Ve())return!1}return!0}}catch(Ke){throw console.log("Probably problems on iOS7 with >>"),Ke}return!1}function Ve(){var Ye,be,Be,Ne,Ae,Re=[];if(n&8&&(Re[0]=ne(),Re[1]=ne(),Re[2]=ne(),Re[3]=ne(),Re[0]===80&&Re[1]===75&&Re[2]===7&&Re[3]===8?(Ye=ne(),Ye|=ne()<<8,Ye|=ne()<<16,Ye|=ne()<<24):Ye=Re[0]|Re[1]<<8|Re[2]<<16|Re[3]<<24,be=ne(),be|=ne()<<8,be|=ne()<<16,be|=ne()<<24,Be=ne(),Be|=ne()<<8,Be|=ne()<<16,Be|=ne()<<24),M&&Ee())return!1;if(Re[0]=ne(),Re[0]!==8)return!0;if(n=ne(),ne(),ne(),ne(),ne(),ne(),ne(),n&4)for(Re[0]=ne(),Re[2]=ne(),ee=Re[0]+256*Re[1],Ne=0;Ne<ee;Ne++)ne();if(n&8)for(Ne=0,ie=[],Ae=ne();Ae;)(Ae==="7"||Ae===":")&&(Ne=0),Ne<NAMEMAX-1&&(ie[Ne++]=Ae),Ae=ne();if(n&16)for(Ae=ne();Ae;)Ae=ne();return n&2&&(ne(),ne()),ye(),Ye=ne(),Ye|=ne()<<8,Ye|=ne()<<16,Ye|=ne()<<24,Be=ne(),Be|=ne()<<8,Be|=ne()<<16,Be|=ne()<<24,M&&Ee(),!1}JXG$1.Util.Unzip.prototype.unzipFile=function(Ye){var be;for(this.unzip(),be=0;be<B.length;be++)if(B[be][1]===Ye)return B[be][0];return""},JXG$1.Util.Unzip.prototype.unzip=function(){return Ee(),B}};JXG$1.Util;JXG$1.CA=function(u,n,d){this.node=u,this.createNode=n,this.parser=d};JXG$1.extend(JXG$1.CA.prototype,{findMapNode:function(u,n){var d,C,I;if(n.value==="op_assign"&&n.children[0].value===u)return n.children[1];if(n.children){for(C=n.children.length,d=0;d<C;++d)if(I=this.findMapNode(u,n.children[d]),I!==null)return I}return null},setMath:function(u){var n,d;if((u.type=="node_op"&&(u.value=="op_add"||u.value=="op_sub"||u.value=="op_mul"||u.value=="op_div"||u.value=="op_neg"||u.value=="op_execfun"||u.value=="op_exp")||u.type=="node_var"||u.type=="node_const")&&(u.isMath=!0),u.children)for(d=u.children.length,n=0;n<d;++n)this.setMath(u.children[n])},deriveElementary:function(u,n){var d=u.children[0].value,C=u.children[1],I;switch(d){case"abs":I=this.createNode("node_op","op_div",C[0],this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0]))]));break;case"sqrt":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_mul",this.createNode("node_const",2),this.createNode(u.type,u.value,JXG$1.deepCopy(u.children[0]),JXG$1.deepCopy(u.children[1]))));break;case"sin":I=this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(C));break;case"cos":I=this.createNode("node_op","op_neg",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(C)));break;case"tan":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(C)),this.createNode("node_const",2)));break;case"cot":I=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(C)),this.createNode("node_const",2))));break;case"exp":I=this.createNode(u.type,u.value,JXG$1.deepCopy(u.children[0]),JXG$1.deepCopy(u.children[1]));break;case"pow":I=this.createNode("node_op","op_mul",this.createNode("node_op","op_execfun",JXG$1.deepCopy(u.children[0]),JXG$1.deepCopy(u.children[1])),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(u.children[1][0],n),this.createNode("node_op","op_div",JXG$1.deepCopy(u.children[1][1]),JXG$1.deepCopy(u.children[1][0]))),this.createNode("node_op","op_mul",this.derivative(u.children[1][1],n),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(u.children[1][0])]))));break;case"log":case"ln":I=this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(C[0]));break;case"log2":case"lb":case"ld":I=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(C[0])),this.createNode("node_const",1.4426950408889634));break;case"log10":case"lg":I=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(C[0])),this.createNode("node_const",.43429448190325176));break;case"asin":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0])))]));break;case"acos":I=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0])))])));break;case"atan":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0]))));break;case"acot":I=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0])))));break;case"sinh":I=this.createNode("node_op","op_execfun",this.createNode("node_var","cosh"),[JXG$1.deepCopy(C[0])]);break;case"cosh":I=this.createNode("node_op","op_execfun",this.createNode("node_var","sinh"),[JXG$1.deepCopy(C[0])]);break;case"tanh":I=this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","tanh"),[JXG$1.deepCopy(C[0])]),this.createNode("node_const",2)));break;case"asinh":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0])),this.createNode("node_const",1))]));break;case"acosh":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0])),this.createNode("node_const",1))]));break;case"atanh":I=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(C[0]),JXG$1.deepCopy(C[0]))));break;default:throw I=this.createNode("node_const",0),console.log('Derivative of "'+d+'" not yet implemented'),new Error("Error("+this.line+"): ")}return I},derivative:function(u,n){var d;switch(u.type){case"node_op":switch(u.value){case"op_execfun":u.children[0].value=="pow"?d=this.deriveElementary(u,n):u.children[1].length===0?d=this.createNode("node_const",0):d=this.createNode("node_op","op_mul",this.deriveElementary(u,n),this.derivative(u.children[1][0],n));break;case"op_div":d=this.createNode("node_op","op_div",this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",this.derivative(u.children[0],n),JXG$1.deepCopy(u.children[1])),this.createNode("node_op","op_mul",JXG$1.deepCopy(u.children[0]),this.derivative(u.children[1],n))),this.createNode("node_op","op_mul",JXG$1.deepCopy(u.children[1]),JXG$1.deepCopy(u.children[1])));break;case"op_mul":d=this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(u.children[0]),this.derivative(u.children[1],n)),this.createNode("node_op","op_mul",this.derivative(u.children[0],n),JXG$1.deepCopy(u.children[1])));break;case"op_neg":d=this.createNode("node_op","op_neg",this.derivative(u.children[0],n));break;case"op_add":case"op_sub":d=this.createNode("node_op",u.value,this.derivative(u.children[0],n),this.derivative(u.children[1],n));break;case"op_exp":d=this.createNode("node_op","op_mul",JXG$1.deepCopy(u),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(u.children[0],n),this.createNode("node_op","op_div",JXG$1.deepCopy(u.children[1]),JXG$1.deepCopy(u.children[0]))),this.createNode("node_op","op_mul",this.derivative(u.children[1],n),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(u.children[0])]))));break}break;case"node_var":u.value===n?d=this.createNode("node_const",1):d=this.createNode("node_const",0);break;case"node_const":d=this.createNode("node_const",0);break}return d},expandDerivatives:function(u,n,d){var C,I,f,y,B,_,Z,M,V,T,H,F,O;if(_=0,!u)return _;for(this.line=u.line,this.col=u.col,C=u.children.length,I=0;I<C;++I)if(u.children[I]&&u.children[I].type)u.children[I]=this.expandDerivatives(u.children[I],u,d);else if(JXG$1.isArray(u.children[I]))for(f=0;f<u.children[I].length;++f)u.children[I][f]&&u.children[I][f].type&&(u.children[I][f]=this.expandDerivatives(u.children[I][f],u,d));switch(u.type){case"node_op":switch(u.value){case"op_execfun":if(u.children[0]&&u.children[0].value==="D"){if(O=!1,u.children[1][0].type=="node_var"&&(V=u.children[1][0].value,y=this.findMapNode(V,d),y!==null&&(O=!0)),O?(H=y.children[0],u.children[1].length>=2?T=u.children[1][1].value:T=y.children[0][0],B=y.children[1]):(B=u.children[1][0],H=["x"],u.children[1].length>=2?T=u.children[1][1].value:T="x"),u.children[1].length>=3?F=u.children[1][2].value:F=1,M=B,F>=1)for(;F>=1;)M=this.derivative(M,T),M=this.removeTrivialNodes(M),F--;n.type=="node_op"&&n.value=="op_assign"?Z=this.createNode("node_op","op_map",H,M):Z=M,this.setMath(Z),u.type=Z.type,u.value=Z.value,Z.children.length>0&&(u.children[0]=Z.children[0]),Z.children.length>1&&(u.children[1]=Z.children[1])}}break}return u},removeTrivialNodes:function(u){var n,d,C,I,f;if(JXG$1.isArray(u))for(d=u.length,n=0;n<d;++n)u[n]=this.removeTrivialNodes(u[n]);if(u.type!="node_op"||!u.children)return u;for(d=u.children.length,n=0;n<d;++n){this.mayNotBeSimplified=!1;do u.children[n]=this.removeTrivialNodes(u.children[n]);while(this.mayNotBeSimplified)}switch(u.value){case"op_map":if(C=u.children[0],I=u.children[1],I.type=="node_var"){for(n=0;n<C.length;++n)if(C[n]==I.value){I.isMath=!0;break}}break;case"op_add":if(C=u.children[0],I=u.children[1],C.type=="node_const"&&C.value===0)return I;if(I.type=="node_const"&&I.value===0)return C;if(C.type=="node_const"&&I.type=="node_const")return C.value+=I.value,C;break;case"op_mul":if(C=u.children[0],I=u.children[1],C.type=="node_const"&&C.value==1)return I;if(I.type=="node_const"&&I.value==1||C.type=="node_const"&&C.value===0)return C;if(I.type=="node_const"&&I.value===0||I.type=="node_const"&&I.value===0)return I;if(C.type=="node_op"&&C.value=="op_neg"&&I.type=="node_op"&&I.value=="op_neg")return u.children=[C.children[0],I.children[0]],this.mayNotBeSimplified=!0,u;if(C.value=="op_neg"&&I.value!="op_neg")return u.type="node_op",u.value="op_neg",u.children=[this.createNode("node_op","op_mul",C.children[0],I)],this.mayNotBeSimplified=!0,u;if(C.value!="op_neg"&&I.value=="op_neg")return u.type="node_op",u.value="op_neg",u.children=[this.createNode("node_op","op_mul",C,I.children[0])],this.mayNotBeSimplified=!0,u;if(C.value=="op_div"&&C.children[0].type=="node_const"&&C.children[0].value==1)return u.type="node_op",u.value="op_div",u.children=[I,C.children[1]],this.mayNotBeSimplified=!0,u;if(I.value=="op_div"&&I.children[0].type=="node_const"&&I.children[0].value==1)return u.type="node_op",u.value="op_div",u.children=[C,I.children[1]],this.mayNotBeSimplified=!0,u;if(C.type!="node_const"&&I.type=="node_const")return u.children=[I,C],this.mayNotBeSimplified=!0,u;if(C.type!="node_const"&&I.type=="node_op"&&I.value=="op_neg"&&I.children[0].type=="node_const")return u.children=[I,C],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value!="op_execfun"&&(I.type=="node_var"||I.type=="node_op"&&I.value=="op_execfun"))return u.children=[I,C],this.mayNotBeSimplified=!0,u;if(C.type!="node_op"&&I.type=="node_op"&&I.value=="op_neg"&&I.children[0].type=="node_var")return u.children=[I,C],this.mayNotBeSimplified=!0,u;if(C.type!="node_const"&&I.type=="node_op"&&(I.value=="op_mul"||I.value=="op_div")&&I.children[0].type=="node_const")return f=I.children[0],I.children[0]=C,u.children=[f,I],this.mayNotBeSimplified=!0,u;if(I.type!="node_const"&&C.type=="node_op"&&C.value=="op_mul"&&C.children[0].type=="node_const")return u.children=[C.children[0],this.createNode("node_op","op_mul",C.children[1],I)],this.mayNotBeSimplified=!0,u;if(C.type=="node_const"&&I.type=="node_const")return C.value*=I.value,C;if(C.type=="node_const"&&I.type=="node_op"&&(I.value=="op_mul"||I.value=="op_div")&&I.children[0].type=="node_const")return I.children[0].value*=C.value,I;if(C.hash=this.parser.compile(C),I.hash=this.parser.compile(I),C.hash===I.hash)return u.value="op_exp",u.children[1]=this.createNode("node_const",2),u;if(C.type=="node_const"&&I.type=="node_op"&&(I.value=="op_mul"||I.value=="op_div")&&I.children[0].type=="node_const")return I.children[0].value*=C.value,I;if(I.type=="node_op"&&I.value=="op_exp"&&(C.hash||(C.hash=this.parser.compile(C)),I.children[0].hash||(I.children[0].hash=this.parser.compile(I.children[0])),C.hash===I.children[0].hash))return I.children[1]=this.createNode("node_op","op_add",I.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,I;if(C.type=="node_op"&&C.value=="op_exp"&&I.type=="node_op"&&I.value=="op_exp"&&(C.children[0].hash=this.parser.compile(C.children[0]),I.children[0].hash=this.parser.compile(I.children[0]),C.children[0].hash===I.children[0].hash))return C.children[1]=this.createNode("node_op","op_add",C.children[1],I.children[1]),this.mayNotBeSimplified=!0,C;break;case"op_sub":if(C=u.children[0],I=u.children[1],C.type=="node_const"&&C.value===0)return u.value="op_neg",u.children[0]=I,u;if(I.type=="node_const"&&I.value===0)return C;if(C.type=="node_const"&&I.type=="node_const"&&C.value==I.value)return this.createNode("node_const",0);if(C.type=="node_var"&&I.type=="node_var"&&C.value==I.value)return this.createNode("node_const",0);if(C.type=="node_const"&&I.type=="node_const")return C.value-=I.value,C;if(C.type=="node_op"&&C.value=="op_mul"&&I.type=="node_op"&&I.value=="op_mul"&&(C.children[1].hash=this.parser.compile(C.children[1]),I.children[1].hash=this.parser.compile(I.children[1]),C.children[1].hash===I.children[1].hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_sub",C.children[0],I.children[0]),C.children[1]],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value=="op_mul"&&(C.children[1].hash=this.parser.compile(C.children[1]),I.hash=this.parser.compile(I),C.children[1].hash===I.hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_sub",C.children[0],this.createNode("node_const",1)),I],this.mayNotBeSimplified=!0,u;if(I.type=="node_op"&&I.value=="op_mul"&&(I.children[1].hash=this.parser.compile(I.children[1]),C.hash=this.parser.compile(C),I.children[1].hash===C.hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_sub",this.createNode("node_const",1),I.children[0]),C],this.mayNotBeSimplified=!0,u;break;case"op_neg":if(C=u.children[0],C.type=="node_const"&&C.value===0)return C;if(C.type=="node_op"&&C.value=="op_neg")return C.children[0];break;case"op_div":if(C=u.children[0],I=u.children[1],C.type=="node_const"&&I.type=="node_const"&&C.value==I.value&&C.value!==0)return C.value=1,C;if(C.type=="node_const"&&C.value===0&&I.type=="node_const"&&I.value!==0)return C.value=0,C;if(C.type=="node_const"&&C.value===0&&(I.type=="node_op"||I.type=="node_var"))return u.type="node_const",u.value=0,u;if(C.type=="node_var"&&I.type=="node_var"&&C.value==I.value)return this.createNode("node_const",1);if(C.type=="node_const"&&C.value!==0&&I.type=="node_const"&&I.value===0)return C.value>0?C.value=1/0:C.value=-1/0,C;if(C.type=="node_op"&&C.value=="op_neg"&&I.type=="node_op"&&I.value=="op_neg")return u.children=[C.children[0],I.children[0]],this.mayNotBeSimplified=!0,u;if(C.value=="op_neg"&&I.value!="op_neg")return u.type="node_op",u.value="op_neg",u.children=[this.createNode("node_op","op_div",C.children[0],I)],this.mayNotBeSimplified=!0,u;if(C.value!="op_neg"&&I.value=="op_neg")return u.type="node_op",u.value="op_neg",u.children=[this.createNode("node_op","op_div",C,I.children[0])],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value=="op_exp"&&(I.hash||(I.hash=this.parser.compile(I)),C.children[0].hash||(C.children[0].hash=this.parser.compile(C.children[0])),I.hash===C.children[0].hash))return C.children[1]=this.createNode("node_op","op_sub",C.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,C;if(I.type!="node_const"&&C.type=="node_op"&&C.value=="op_mul"&&C.children[0].type=="node_const")return u.value="op_mul",u.children=[C.children[0],this.createNode("node_op","op_div",C.children[1],I)],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value=="op_exp"&&I.type=="node_op"&&I.value=="op_exp"&&(C.children[0].hash=this.parser.compile(C.children[0]),I.children[0].hash=this.parser.compile(I.children[0]),C.children[0].hash===I.children[0].hash))return C.children[1]=this.createNode("node_op","op_sub",C.children[1],I.children[1]),this.mayNotBeSimplified=!0,C;break;case"op_exp":if(C=u.children[0],I=u.children[1],I.type=="node_const"&&I.value===0)return I.value=1,I;if(I.type=="node_const"&&I.value==1||C.type=="node_const"&&C.value==1||C.type=="node_const"&&C.value===0&&I.type=="node_const"&&I.value!==0)return C;if(C.type=="node_op"&&C.value=="op_exp")return u.children=[C.children[0],this.createNode("node_op","op_mul",C.children[1],I)],u;break}switch(u.value){case"op_add":if(C=u.children[0],I=u.children[1],C.type=="node_const"&&I.type=="node_const"&&C.value==I.value)return C.value+=I.value,C;if(C.type=="node_var"&&I.type=="node_var"&&C.value==I.value)return u.children[0]=this.createNode("node_const",2),u.value="op_mul",u;if(C.type=="node_op"&&C.value=="op_neg")return u.value="op_sub",u.children[0]=I,u.children[1]=C.children[0],this.mayNotBeSimplified=!0,u;if(I.type=="node_op"&&I.value=="op_neg")return u.value="op_sub",u.children[1]=I.children[0],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value=="op_mul"&&I.type=="node_op"&&I.value=="op_mul"&&(C.children[1].hash=this.parser.compile(C.children[1]),I.children[1].hash=this.parser.compile(I.children[1]),C.children[1].hash===I.children[1].hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_add",C.children[0],I.children[0]),C.children[1]],this.mayNotBeSimplified=!0,u;if(C.type=="node_op"&&C.value=="op_mul"&&(C.children[1].hash=this.parser.compile(C.children[1]),I.hash=this.parser.compile(I),C.children[1].hash===I.hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_add",C.children[0],this.createNode("node_const",1)),I],this.mayNotBeSimplified=!0,u;if(I.type=="node_op"&&I.value=="op_mul"&&(I.children[1].hash=this.parser.compile(I.children[1]),C.hash=this.parser.compile(C),I.children[1].hash===C.hash))return u.value="op_mul",u.children=[this.createNode("node_op","op_add",this.createNode("node_const",1),I.children[0]),C],this.mayNotBeSimplified=!0,u;break;case"op_sub":if(C=u.children[0],I=u.children[1],I.type=="node_op"&&I.value=="op_neg")return u.value="op_add",u.children[1]=I.children[0],this.mayNotBeSimplified=!0,u;break;case"op_execfun":return this.simplifyElementary(u)}return u},simplifyElementary:function(u){var n=u.children[0].value,d=u.children[1];if(d.length==0)return u;switch(n){case"sin":case"tan":if(d[0].type=="node_const"&&d[0].value===0||d[0].type=="node_var"&&d[0].value=="PI"||d[0].type=="node_op"&&d[0].value=="op_mul"&&d[0].children[0].type=="node_const"&&d[0].children[0].value%1===0&&d[0].children[1].type=="node_var"&&d[0].children[1].value=="PI")return u.type="node_const",u.value=0,u;break;case"cos":if(d[0].type=="node_const"&&d[0].value===0)return u.type="node_const",u.value=1,u;if(d[0].type=="node_var"&&d[0].value=="PI")return u.type="node_op",u.value="op_neg",u.children=[this.createNode("node_const",1)],u;break;case"exp":if(d[0].type=="node_const"&&d[0].value===0)return u.type="node_const",u.value=1,u;break;case"pow":if(d[1].type=="node_const"&&d[1].value===0)return u.type="node_const",u.value=1,u;break}return u}});JXG$1.CA;JXG$1.Dump={addMarkers:function(u,n,d){var C,I,f;JXG$1.isArray(n)||(n=[n]),JXG$1.isArray(d)||(d=[d]),I=Math.min(n.length,d.length),n.length=I,d.length=I;for(C in u.objects)if(u.objects.hasOwnProperty(C))for(f=0;f<I;f++)u.objects[C][n[f]]=d[f]},deleteMarkers:function(u,n){var d,C,I;JXG$1.isArray(n)||(n=[n]),C=n.length,n.length=C;for(d in u.objects)if(u.objects.hasOwnProperty(d))for(I=0;I<C;I++)delete u.objects[d][n[I]]},str:function(u){return typeof u=="string"&&u.slice(0,7)!=="function"&&(u='"'+u+'"'),u},minimizeObject:function(u,n){var d,C,I,f={},y=JXG$1.deepCopy(u),B=[];for(I=1;I<arguments.length;I++)B.push(arguments[I]);for(f=JXG$1.deepCopy(f,JXG$1.Options.elements,!0),I=B.length;I>0;I--)f=JXG$1.deepCopy(f,B[I-1],!0);for(d in f)f.hasOwnProperty(d)&&(C=d.toLowerCase(),typeof f[d]!="object"&&f[d]===y[C]&&delete y[C]);return y},prepareAttributes:function(u,n){var d,C;d=this.minimizeObject(n.getAttributes(),JXG$1.Options[n.elType]);for(C in n.subs)n.subs.hasOwnProperty(C)&&(d[C]=this.minimizeObject(n.subs[C].getAttributes(),JXG$1.Options[n.elType][C],JXG$1.Options[n.subs[C].elType]),d[C].id=n.subs[C].id,d[C].name=n.subs[C].name);return d.id=n.id,d.name=n.name,d},setBoundingBox:function(u,n,d){return u.push({obj:d,method:"setBoundingBox",params:[n.getBoundingBox(),n.keepaspectratio]}),u},dump:function(u){var n,d,C,I,f=[],y=[],B=[],_=u.objectsList.length;for(this.addMarkers(u,"dumped",!1),n=0;n<_;n++)if(d=u.objectsList[n],C={},!d.dumped&&d.dump){for(C.type=d.getType(),C.parents=d.getParents().slice(),C.type==="point"&&C.parents[0]===1&&(C.parents=C.parents.slice(1)),I=0;I<C.parents.length;I++)JXG$1.isString(C.parents[I])&&C.parents[I][0]!=="'"&&C.parents[I][0]!=='"'?C.parents[I]='"'+C.parents[I]+'"':JXG$1.isArray(C.parents[I])&&(C.parents[I]="["+C.parents[I].toString()+"]");C.attributes=this.prepareAttributes(u,d),C.type==="glider"&&d.onPolygon&&f.push({obj:d.id,prop:"onPolygon",val:!0}),B.push(C)}return this.deleteMarkers(u,"dumped"),{elements:B,props:f,methods:y}},arrayToParamStr:function(u,n){var d,C=[];for(d=0;d<u.length;d++)C.push(n.call(this,u[d]));return C.join(", ")},toJCAN:function(u){var n,d,C;switch(typeof u){case"object":if(u){if(d=[],JXG$1.isArray(u)){for(n=0;n<u.length;n++)d.push(this.toJCAN(u[n]));return"["+d.join(",")+"]"}for(C in u)u.hasOwnProperty(C)&&d.push(C+": "+this.toJCAN(u[C]));return"<<"+d.join(", ")+">> "}return"null";case"string":return"'"+u.replace(/\\/g,"\\\\").replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return u.toString();case"null":return"null"}},toJessie:function(u){var n,d,C,I=this.dump(u),f=[];for(I.methods=this.setBoundingBox(I.methods,u,"$board"),d=I.elements,n=0;n<d.length;n++)d[n].attributes.name.length>0&&f.push("// "+d[n].attributes.name),f.push("s"+n+" = "+d[n].type+"("+d[n].parents.join(", ")+") "+this.toJCAN(d[n].attributes).replace(/\n/,"\\n")+";"),d[n].type==="axis"&&(C=d[n].attributes.id,u.objects[C].defaultTicks===null&&f.push("s"+n+".removeAllTicks();")),f.push("");for(n=0;n<I.methods.length;n++)f.push(I.methods[n].obj+"."+I.methods[n].method+"("+this.arrayToParamStr(I.methods[n].params,this.toJCAN)+");"),f.push("");for(n=0;n<I.props.length;n++)f.push(I.props[n].obj+"."+I.props[n].prop+" = "+this.toJCAN(I.props[n].val)+";"),f.push("");return f.join(`
`)},toJavaScript:function(u){var n,d,C,I=this.dump(u),f=[];for(I.methods=this.setBoundingBox(I.methods,u,"board"),d=I.elements,n=0;n<d.length;n++)f.push('board.create("'+d[n].type+'", ['+d[n].parents.join(", ")+"], "+JXG$1.toJSON(d[n].attributes)+");"),d[n].type==="axis"&&(C=d[n].attributes.id,u.objects[C].defaultTicks===null&&f.push('board.objects["'+C+'"].removeTicks(board.objects["'+C+'"].defaultTicks);'));for(n=0;n<I.methods.length;n++)f.push(I.methods[n].obj+"."+I.methods[n].method+"("+this.arrayToParamStr(I.methods[n].params,JXG$1.toJSON)+");"),f.push("");for(n=0;n<I.props.length;n++)f.push(I.props[n].obj+"."+I.props[n].prop+" = "+JXG$1.toJSON(I.props[n].val)+";"),f.push("");return f.join(`
`)}};JXG$1.Dump;JXG$1.createComb=function(u,n,d){var C,I,f,y,B;if(n.length===2){if(JXG$1.isArray(n[0])&&n[0].length>1)y=JXG$1.copyAttributes(d,u.options,"comb","point1"),C=u.create("point",n[0],y);else if(JXG$1.isString(n[0])||JXG$1.isPoint(n[0]))C=u.select(n[0]);else if(JXG$1.isFunction(n[0])&&JXG$1.isPoint(n[0]()))C=n[0]();else if(JXG$1.isFunction(n[0])&&n[0]().length&&n[0]().length>=2)y=JXG$1.copyAttributes(d,u.options,"comb","point1"),C=JXG$1.createPoint(u,n[0](),y);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);if(JXG$1.isArray(n[1])&&n[1].length>1)y=JXG$1.copyAttributes(d,u.options,"comb","point2"),I=u.create("point",n[1],y);else if(JXG$1.isString(n[1])||JXG$1.isPoint(n[1]))I=u.select(n[1]);else if(JXG$1.isFunction(n[1])&&JXG$1.isPoint(n[1]()))I=n[1]();else if(JXG$1.isFunction(n[1])&&n[1]().length&&n[1]().length>=2)y=JXG$1.copyAttributes(d,u.options,"comb","point2"),I=JXG$1.createPoint(u,n[1](),y);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}else throw B=n.map(function(_){return"'"+typeof _+"'"}),new Error("JSXGraph: Can't create comb with parent types "+B.join(", ")+`.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);return y=JXG$1.copyAttributes(d,u.options,"comb"),f=u.create("curve",[[0],[0]],y),f.updateDataArray=function(){var _=0,Z=C.Dist(I),M,V,T,H,F,O,$,U=C,ee=I,Q,ie,ne;for(Q=JXG$1.evaluate(f.visProp.frequency),ie=-JXG$1.evaluate(f.visProp.angle),ne=JXG$1.evaluate(f.visProp.width),JXG$1.evaluate(f.visProp.reverse)&&(U=I,ee=C,ie=-ie),M=Math.cos(ie),V=Math.sin(ie),T=(ee.X()-U.X())/Z,H=(ee.Y()-U.Y())/Z,M*=ne/Math.abs(V),V*=ne/Math.abs(V),this.dataX=[],this.dataY=[];_<Z;)F=U.X()+T*_,O=U.Y()+H*_,$=Math.min(M,Z-_)/Math.abs(M),V*=$,M*=$,this.dataX.push(F),this.dataY.push(O),this.dataX.push(F+T*M+H*V),this.dataY.push(O-T*V+H*M),this.dataX.push(NaN),this.dataY.push(NaN),_+=Q},f};JXG$1.registerElement("comb",JXG$1.createComb);var priv$3={removeSlopeTriangle:function(){Polygon.prototype.remove.call(this),this.board.removeObject(this.toppoint),this.board.removeObject(this.glider),this.board.removeObject(this.baseline),this.board.removeObject(this.basepoint),this.board.removeObject(this.label),this._isPrivateTangent&&this.board.removeObject(this.tangent)},Value:function(){return this.tangent.getSlope()},Direction:function(){return this.tangent.Direction()}};JXG$1.createSlopeTriangle=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T=!1;if(n.length===1&&n[0].type===Const.OBJECT_TYPE_TANGENT)I=n[0],f=I.glider;else if(n.length===1&&n[0].type===Const.OBJECT_TYPE_GLIDER)f=n[0],V=JXG$1.copyAttributes(d,u.options,"slopetriangle","tangent"),I=u.create("tangent",[f],V),T=!0;else if(n.length===2&&n[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(n[1]))I=n[0],f=n[1];else throw new Error("JSXGraph: Can't create slope triangle with parent types '"+typeof n[0]+"'.");return V=JXG$1.copyAttributes(d,u.options,"slopetriangle","basepoint"),Z=u.create("point",[function(){return[f.X()+1,f.Y()]}],V),V=JXG$1.copyAttributes(d,u.options,"slopetriangle","baseline"),_=u.create("line",[f,Z],V),V=JXG$1.copyAttributes(d,u.options,"slopetriangle","glider"),y=u.create("glider",[f.X()+1,f.Y(),_],V),V=JXG$1.copyAttributes(d,u.options,"slopetriangle","toppoint"),B=u.create("point",[function(){return[y.X(),y.Y()+(y.X()-f.X())*I.getSlope()]}],V),V=JXG$1.copyAttributes(d,u.options,"slopetriangle"),C=u.create("polygon",[f,y,B],V),C.Value=priv$3.Value,C.Direction=priv$3.Direction,C.tangent=I,C._isPrivateTangent=T,C.borders[2].setArrow(!1,!1),V=JXG$1.copyAttributes(d,u.options,"slopetriangle","label"),V=JXG$1.copyAttributes(V,u.options,"label"),V.isLabel=!0,V.anchor=C.borders[1],V.priv=C.borders[1].visProp.priv,V.id=C.borders[1].id+"Label",M=u.create("text",[0,0,function(){return""}],V),M.needsUpdate=!0,M.dump=!1,C.borders[1].label=M,C.borders[1].hasLabel=!0,C.borders[1].visProp.withlabel=!0,M._setText(function(){var H=JXG$1.evaluate(M.visProp.digits);return M.useLocale()?M.formatNumberLocale(C.Value(),H):JXG$1.toFixed(C.Value(),H)}),M.fullUpdate(),C.glider=y,C.basepoint=Z,C.baseline=_,C.toppoint=B,C.label=M,C.subs={glider:y,basePoint:Z,baseLine:_,topPoint:B,label:M},C.inherits.push(y,Z,_,B,M),C.methodMap=JXG$1.deepCopy(C.methodMap,{tangent:"tangent",glider:"glider",basepoint:"basepoint",baseline:"baseline",toppoint:"toppoint",label:"label",Value:"Value",V:"Value",Direction:"Direction"}),C.remove=priv$3.removeSlopeTriangle,C};JXG$1.registerElement("slopetriangle",JXG$1.createSlopeTriangle);var priv$2={CheckboxChangeEventHandler:function(){this._value=this.rendNodeCheckbox.checked,this.board.update()}};JXG$1.createCheckbox=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"checkbox");return I=[n[0],n[1],'<span style="display:inline"><input type="checkbox" /><label for=""></label></span>'],C=u.create("text",I,f),C.type=JXG$1.OBJECT_TYPE_CHECKBOX,C.rendNodeCheckbox=C.rendNode.childNodes[0].childNodes[0],C.rendNodeLabel=C.rendNode.childNodes[0].childNodes[1],C.rendNodeTag=C.rendNodeCheckbox,C.rendNodeTag.disabled=!!f.disabled,C.rendNodeCheckbox.id=C.rendNode.id+"_checkbox",C.rendNodeLabel.id=C.rendNode.id+"_label",C.rendNodeLabel.setAttribute("for",C.rendNodeCheckbox.id),C.setText(n[2]),C.visPropOld.fontsize="0px",u.renderer.updateTextStyle(C,!1),C.rendNodeCheckbox.checked=f.checked,C._value=f.checked,C.Value=function(){return this._value},C.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeCheckbox.checked),this},JXG$1.addEvent(C.rendNodeCheckbox,"change",priv$2.CheckboxChangeEventHandler,C),C};JXG$1.registerElement("checkbox",JXG$1.createCheckbox);var priv$1={InputInputEventHandler:function(u){this._value=this.rendNodeInput.value,this.board.update()}};JXG$1.createInput=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"input");return I=[n[0],n[1],'<span style="display:inline; white-space:nowrap; padding:0px;"><span></span><input type="text" maxlength="'+f.maxlength+'" style="width:100%"/></span>'],C=u.create("text",I,f),C.type=JXG$1.OBJECT_TYPE_INPUT,C.rendNodeLabel=C.rendNode.childNodes[0].childNodes[0],C.rendNodeInput=C.rendNode.childNodes[0].childNodes[1],C.rendNodeInput.value=n[2],C.rendNodeTag=C.rendNodeInput,C.rendNodeTag.disabled=!!f.disabled,C.rendNodeLabel.id=C.rendNode.id+"_label",C.rendNodeInput.id=C.rendNode.id+"_input",C.setText(n[3]),C._value=n[2],C.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeInput.value),this},C.Value=function(){return this._value},C.set=function(y){return this._value=y,this.rendNodeInput.value=y,this},JXG$1.addEvent(C.rendNodeInput,"input",priv$1.InputInputEventHandler,C),JXG$1.addEvent(C.rendNodeInput,"mousedown",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),JXG$1.addEvent(C.rendNodeInput,"touchstart",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),JXG$1.addEvent(C.rendNodeInput,"pointerdown",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),C.visPropOld.fontsize="0px",u.renderer.updateTextStyle(C,!1),C};JXG$1.registerElement("input",JXG$1.createInput);var priv={ButtonClickEventHandler:function(){this._handler&&this._handler(),this.board.update()}};JXG$1.createButton=function(u,n,d){var C,I,f=JXG$1.copyAttributes(d,u.options,"button");return I=[n[0],n[1],'<button type="button" style="width:100%;"></button>'],C=u.create("text",I,f),C.type=JXG$1.OBJECT_TYPE_BUTTON,C.rendNodeButton=C.rendNode.childNodes[0],C.rendNodeButton.id=C.rendNode.id+"_button",C.rendNodeTag=C.rendNodeButton,C.rendNodeTag.disabled=!!f.disabled,C.setText(n[2]),C.visPropOld.fontsize="0px",u.renderer.updateTextStyle(C,!1),n[3]&&(JXG$1.isString(n[3])?(C._jc=new JXG$1.JessieCode,C._jc.use(u),C._handler=function(){C._jc.parse(n[3])}):C._handler=n[3]),JXG$1.addEvent(C.rendNodeButton,"click",priv.ButtonClickEventHandler,C),JXG$1.addEvent(C.rendNodeButton,"mousedown",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),JXG$1.addEvent(C.rendNodeButton,"touchstart",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),JXG$1.addEvent(C.rendNodeButton,"pointerdown",function(y){JXG$1.exists(y.stopPropagation)&&y.stopPropagation()},C),C};JXG$1.registerElement("button",JXG$1.createButton);JXG$1.createVectorField=function(u,n,d){var C,I;if(!(n.length>=3&&(JXG$1.isArray(n[0])||JXG$1.isFunction(n[0])||JXG$1.isString(n[0]))&&JXG$1.isArray(n[1])&&n[1].length===3&&JXG$1.isArray(n[2])&&n[2].length===3))throw new Error("JSXGraph: Can't create vector field with parent types '"+typeof n[0]+"', '"+typeof n[1]+"', '"+typeof n[2]+"'.");return I=JXG$1.copyAttributes(d,u.options,"vectorfield"),C=u.create("curve",[[],[]],I),C.elType="vectorfield",C.setF=function(f,y){var B,_;return JXG$1.isArray(f)?(B=JXG$1.createFunction(f[0],this.board,y),_=JXG$1.createFunction(f[1],this.board,y),this.F=function(Z,M){return[B(Z,M),_(Z,M)]}):this.F=JXG$1.createFunction(f,C.board,y),this},C.setF(n[0],"x, y"),C.xData=n[1],C.yData=n[2],C.updateDataArray=function(){var f,y,B,_,Z=JXG$1.evaluate(this.visProp.scale),M=JXG$1.evaluate(this.xData[0]),V=JXG$1.evaluate(this.xData[1]),T=JXG$1.evaluate(this.xData[2]),H=(T-M)/V,F=JXG$1.evaluate(this.yData[0]),O=JXG$1.evaluate(this.yData[1]),$=JXG$1.evaluate(this.yData[2]),U=($-F)/O,ee,Q,ie,ne,le=JXG$1.evaluate(this.visProp.arrowhead.enabled),ae,ce,ge,he;for(le&&(ae=JXG$1.evaluate(this.visProp.arrowhead.size),ce=ae/u.unitX,ge=ae/u.unitY,he=JXG$1.evaluate(this.visProp.arrowhead.angle)),this.dataX=[],this.dataY=[],B=0,f=M;B<=V;f+=H,B++)for(_=0,y=F;_<=O;y+=U,_++)ee=this.F(f,y),ee[0]*=Z,ee[1]*=Z,JXG$1.concat(this.dataX,[f,f+ee[0],NaN]),JXG$1.concat(this.dataY,[y,y+ee[1],NaN]),le&&Math.abs(ee[0])+Math.abs(ee[1])>0&&(Q=Math.atan2(ee[1],ee[0]),ie=Q+he,ne=Q-he,JXG$1.concat(this.dataX,[f+ee[0]-Math.cos(ie)*ce,f+ee[0],f+ee[0]-Math.cos(ne)*ce,NaN]),JXG$1.concat(this.dataY,[y+ee[1]-Math.sin(ie)*ge,y+ee[1],y+ee[1]-Math.sin(ne)*ge,NaN]))},C.methodMap=JXG$1.deepCopy(C.methodMap,{setF:"setF"}),C};JXG$1.registerElement("vectorfield",JXG$1.createVectorField);JXG$1.createSlopeField=function(u,n,d){var C,I,f;if(!(n.length>=3&&(JXG$1.isFunction(n[0])||JXG$1.isString(n[0]))&&JXG$1.isArray(n[1])&&n[1].length===3&&JXG$1.isArray(n[2])&&n[2].length===3))throw new Error("JSXGraph: Can't create slope field with parent types '"+typeof n[0]+"', '"+typeof n[1]+"', '"+typeof n[2]+"'.");return I=JXG$1.createFunction(n[0],u,"x, y"),n[0]=function(y,B){var _=I(y,B),Z=Math.sqrt(1+_*_);return[1/Z,_/Z]},f=JXG$1.copyAttributes(d,u.options,"slopefield"),C=u.create("vectorfield",n,f),C.elType="slopefield",C.setF=function(y,B){var _=JXG$1.createFunction(y,C.board,B);this.F=function(Z,M){var V=_(Z,M),T=Math.sqrt(1+V*V);return[1/T,V/T]}},C.methodMap=JXG$1.deepCopy(C.methodMap,{setF:"setF"}),C};JXG$1.registerElement("slopefield",JXG$1.createSlopeField);JXG$1.createSmartLabel=function(u,n,d){var C,I,f,y,B,_;if(n.length===0||[Const.OBJECT_CLASS_POINT,Const.OBJECT_CLASS_LINE,Const.OBJECT_CLASS_CIRCLE].indexOf(n[0].elementClass)<0&&[Const.OBJECT_TYPE_POLYGON,Const.OBJECT_TYPE_ANGLE].indexOf(n[0].type)<0)throw new Error("JSXGraph: Can't create smartlabel with parent types '"+typeof n[0]+"', '"+typeof n[1]+"'.");return f=n[0],y=n[1]||"",f.elementClass===Const.OBJECT_CLASS_POINT?I=JXG$1.copyAttributes(d,u.options,"smartlabelpoint"):f.elementClass===Const.OBJECT_CLASS_LINE?(I=JXG$1.copyAttributes(d,u.options,"smartlabelline"),I.rotate=function(){return Math.atan(f.getSlope())*180/Math.PI},I.visible=function(){return!(f.L()<1.5)}):f.elementClass===Const.OBJECT_CLASS_CIRCLE?(I=JXG$1.copyAttributes(d,u.options,"smartlabelcircle"),I.visible=function(){return!(f.Radius()<1.5)}):f.type===Const.OBJECT_TYPE_POLYGON?I=JXG$1.copyAttributes(d,u.options,"smartlabelpolygon"):f.type===Const.OBJECT_TYPE_ANGLE&&(I=JXG$1.copyAttributes(d,u.options,"smartlabelangle"),I.rotate=function(){var Z=f.center.coords.usrCoords,M=f.getLabelAnchor().usrCoords,V=Math.atan2(M[2]-Z[2],M[1]-Z[1])*180/Math.PI;return V>90&&V<270?V+180:V},I.anchorX=function(){var Z=f.center.coords.usrCoords,M=f.getLabelAnchor().usrCoords,V=Math.atan2(M[2]-Z[2],M[1]-Z[1])*180/Math.PI;return V>90&&V<270?"right":"left"}),B=function(Z,M,V,T){var H;switch(T){case"length":H=function(){return M.L()};break;case"slope":H=function(){return M.Slope()};break;case"area":H=function(){return M.Area()};break;case"radius":H=function(){return M.Radius()};break;case"perimeter":H=function(){return M.Perimeter()};break;case"rad":H=function(){return M.Value()};break;case"deg":H=function(){return M.Value()*180/Math.PI};break;default:H=function(){return 0}}return function(){var F="",O,$=JXG$1.evaluate(y),U=JXG$1.evaluate(Z.visProp.digits),ee=JXG$1.evaluate(Z.visProp.unit),Q=JXG$1.evaluate(Z.visProp.prefix),ie=JXG$1.evaluate(Z.visProp.suffix),ne=JXG$1.evaluate(Z.visProp.usemathjax)||JXG$1.evaluate(Z.visProp.usekatex);return $===""?(Z.useLocale()?O=Z.formatNumberLocale(H(),U):O=JXG$1.toFixed(H(),U),ne?F=["\\(",Q,O,"\\,",ee,ie,"\\)"].join(""):F=[Q,O,ee,ie].join("")):F=$,F}},f.elementClass===Const.OBJECT_CLASS_POINT?(C=u.create("text",[function(){return f.X()},function(){return f.Y()},""],I),_=function(){var Z="",M=JXG$1.evaluate(y),V=JXG$1.evaluate(C.visProp.digits),T=JXG$1.evaluate(C.visProp.unit),H=JXG$1.evaluate(C.visProp.prefix),F=JXG$1.evaluate(C.visProp.suffix),O=JXG$1.evaluate(C.visProp.dir),$=JXG$1.evaluate(C.visProp.usemathjax)||JXG$1.evaluate(C.visProp.usekatex),U,ee;return C.useLocale()?(U=C.formatNumberLocale(f.X(),V),ee=C.formatNumberLocale(f.Y(),V)):(U=JXG$1.toFixed(f.X(),V),ee=JXG$1.toFixed(f.Y(),V)),M===""?O==="row"?$?Z=["\\(",H,U,"\\,",T," / ",ee,"\\,",T,F,"\\)"].join(""):Z=[H,U," ",T," / ",ee," ",T,F].join(""):O.indexOf("col")===0&&($?Z=["\\(",H,"\\left(\\array{",U,"\\,",T,"\\\\ ",ee,"\\,",T,"}\\right)",F,"\\)"].join(""):Z=[H,U," ",T,"<br/>",ee," ",T,F].join("")):Z=M,Z}):f.elementClass===Const.OBJECT_CLASS_LINE?I.measure==="length"?(C=u.create("text",[function(){return(f.point1.X()+f.point2.X())*.5},function(){return(f.point1.Y()+f.point2.Y())*.5},""],I),_=B(C,f,"line","length")):I.measure==="slope"&&(C=u.create("text",[function(){return f.point1.X()*.25+f.point2.X()*.75},function(){return f.point1.Y()*.25+f.point2.Y()*.75},""],I),_=B(C,f,"line","slope")):f.elementClass===Const.OBJECT_CLASS_CIRCLE?I.measure==="radius"?(C=u.create("text",[function(){return f.center.X()+f.Radius()*.5},function(){return f.center.Y()},""],I),_=B(C,f,"circle","radius")):I.measure==="area"?(C=u.create("text",[function(){return f.center.X()},function(){return f.center.Y()+f.Radius()*.5},""],I),_=B(C,f,"circle","area")):(I.measure==="circumference"||I.measure==="perimeter")&&(C=u.create("text",[function(){return f.getLabelAnchor()},""],I),_=B(C,f,"circle","perimeter")):f.type===Const.OBJECT_TYPE_POLYGON?I.measure==="area"?(C=u.create("text",[function(){return f.getTextAnchor()},""],I),_=B(C,f,"polygon","area")):I.measure==="perimeter"&&(C=u.create("text",[function(){var Z=f.borders.length-1;return Z>=0?[(f.borders[Z].point1.X()+f.borders[Z].point2.X())*.5,(f.borders[Z].point1.Y()+f.borders[Z].point2.Y())*.5]:f.getTextAnchor()},""],I),_=B(C,f,"polygon","perimeter")):f.type===Const.OBJECT_TYPE_ANGLE&&(C=u.create("text",[function(){return f.getLabelAnchor()},""],I),_=B(C,f,"angle",I.measure)),JXG$1.exists(C)&&(C.setText(_),f.addChild(C),C.setParents([f])),C};JXG$1.registerElement("smartlabel",JXG$1.createSmartLabel);JXG$1.ForeignObject=function(u,n,d,C,I){this.constructor(u,d,Const.OBJECT_TYPE_FOREIGNOBJECT,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(d.anchor),this.coordsConstructor(n),this._useUserSize=!1,this.size=[1,1],JXG$1.exists(I)&&I.length>0&&(this._useUserSize=!0,this.W=JXG$1.createFunction(I[0],this.board,""),this.H=JXG$1.createFunction(I[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()]),this.content=C,this.elType="foreignobject",this.id=this.board.setId(this,"Im"),this.board.renderer.drawForeignObject(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H"})};JXG$1.ForeignObject.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.ForeignObject,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.ForeignObject.prototype,{hasPoint:function(u,n){var d,C,I,f,y,B,_,Z,M,V=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(f=this.board._inputDevice,y=JXG$1.evaluate(this.visProp.precision[f])):y=this.board.options.precision.hasPoint,V===0?(d=u-this.coords.scrCoords[1],C=this.coords.scrCoords[2]-n,I=y,d>=-I&&d-this.size[0]<=I&&C>=-I&&C-this.size[1]<=I):(B=new Coords(Const.COORDS_BY_SCREEN,[u,n],this.board),B=B.usrCoords,_=[B[0]-this.span[0][0],B[1]-this.span[0][1],B[2]-this.span[0][2]],M=Mat.innerProduct,Z=M(_,this.span[1]),0<=Z&&Z<=M(this.span[1],this.span[1])&&(Z=M(_,this.span[2]),0<=Z&&Z<=M(this.span[2],this.span[2])))},update:function(u){return this.needsUpdate?(this.updateCoords(u),this.updateSize(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateForeignObject")},updateSize:function(){var u=[0,0];return this._useUserSize?(this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)]):this.rendNode.hasChildNodes()&&(u=this.rendNode.childNodes[0].getBoundingClientRect(),this.size=[u.width,u.height]),this},updateSpan:function(){var u,n,d=this.transformations.length,C=[];if(d===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(C[0]=[this.Z(),this.X(),this.Y()],C[1]=[this.Z(),this.X()+this.W(),this.Y()],C[2]=[this.Z(),this.X(),this.Y()+this.H()],u=0;u<d;u++)for(n=0;n<3;n++)C[n]=Mat.matVecMult(this.transformations[u].matrix,C[n]);for(n=0;n<3;n++)C[n][1]/=C[n][0],C[n][2]/=C[n][0],C[n][0]/=C[n][0];for(n=1;n<3;n++)C[n][0]-=C[0][0],C[n][1]-=C[0][1],C[n][2]-=C[0][2];this.span=C}return this},addTransform:function(u){var n;if(JXG$1.isArray(u))for(n=0;n<u.length;n++)this.transformations.push(u[n]);else this.transformations.push(u);return this},getParents:function(){var u=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(u=this.parents),u},setSize:function(u,n){return this.W=JXG$1.createFunction(u,this.board,""),this.H=JXG$1.createFunction(n,this.board,""),this._useUserSize=!0,this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createForeignObject=function(u,n,d){var C,I,f=n[0],y=n[1],B=[];if(n.length>=2&&(B=n[2]),C=JXG$1.copyAttributes(d,u.options,"foreignobject"),I=CoordsElement.create(JXG$1.ForeignObject,u,y,C,f,B),!I)throw new Error("JSXGraph: Can't create foreignObject with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [string, [x, y], [w, h]], [string, [x, y]], [element,transformation]`);return I};JXG$1.registerElement("foreignobject",JXG$1.createForeignObject);JXG$1.registerElement("fo",JXG$1.createForeignObject);JXG$1.ForeignObject;JXG$1.extend(Options,{axes3d:{axesPosition:"center",xAxis:{visible:!0,point2:{name:"x"},strokeColor:JXG$1.palette.red},yAxis:{visible:!0,point2:{name:"y"},strokeColor:JXG$1.palette.green},zAxis:{visible:!0,point2:{name:"z"},strokeColor:JXG$1.palette.blue},xAxisBorder:{name:"x",visible:"ìnherit",withLabel:!1,label:{position:"50% left",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle",anchorY:"middle"}}},yAxisBorder:{name:"y",visible:"ìnherit",withLabel:!1,label:{position:"50% right",offset:[0,-30],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle"}}},zAxisBorder:{name:"z",visible:"ìnherit",withLabel:!1,label:{position:"50% right",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle",anchorY:"middle"}}},xPlaneRear:{visible:!0,layer:0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",mesh3d:{layer:1}},yPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},yPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1}},axis3d:{highlight:!1,fixed:!0,strokeColor:"black",strokeWidth:1,tabindex:null,point1:{visible:!1,name:""},point2:{visible:!1,name:"",label:{visible:!0}}},circle3d:{point:{visible:!1,name:""}},curve3d:{highlight:!1,tabindex:-1,strokeWidth:1,numberPointsHigh:200},intersectionline3d:{point1:{visible:!1,name:""},point2:{visible:!1,name:""}},line3d:{strokeWidth:1,strokeColor:"black",fixed:!0,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",point:{visible:!1,name:""},point1:{visible:!1,name:""},point2:{visible:!1,name:""}},mesh3d:{strokeWidth:1,strokeColor:"#9a9a9a",strokeOpacity:.6,highlight:!1,tabindex:null,visible:"inherit"},plane3d:{strokeWidth:0,strokeColor:"black",strokeOpacity:1,highlight:!1,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",gradientAngle:Math.PI,fillColor:"#a7a7a7",fillOpacity:.6,point:{visible:!1,name:"",fixed:!0}},point3d:{infoboxDigits:"auto",strokeWidth:0,gradient:"radial",gradientSecondColor:"#555555",fillColor:"yellow",highlightStrokeColor:"#555555",gradientFX:.7,gradientFY:.3},polygon3d:{highlight:!1,tabindex:-1,strokeWidth:1,fillColor:"none"},sphere3d:{highlight:!1,strokeWidth:1,strokeColor:"#00ff80",fillColor:"white",gradient:"radial",gradientSecondColor:"#00ff80",gradientFX:.7,gradientFY:.3,fillOpacity:.4},surface3d:{highlight:!1,tabindex:-1,strokeWidth:1,stepsU:30,stepsV:30},text3d:{},ticks3d:{visible:!0,ticksDistance:1,majorHeight:10,minorTicks:0,tickEndings:[0,1],drawLabels:!0,label:{visible:!0}},vectorfield3d:{scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},view3d:{needsRegularUpdate:!0,projection:"parallel",verticalDrag:{enabled:!0,key:"shift"},az:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:1}},el:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:.3}},bank:{pointer:{enabled:!0,speed:.08,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:-Math.PI,max:Math.PI,start:0}},trackball:{enabled:!1,outside:!0,button:-1,key:"none"},r:"auto",fov:1/5*2*Math.PI,depthOrderPoints:!1,values:[[0,1.57],[.78,.62],[0,0],[5.49,.62],[4.71,0],[3.93,.62],[3.14,0],[2.36,.62],[1.57,1.57]],infobox:{strokeColor:"#000000",fontSize:24,useKatex:!1,useMathjax:!1},_currentView:-1}});JXG$1.Options;JXG$1.View3D=function(u,n,d){this.constructor(u,d,Const.OBJECT_TYPE_VIEW3D,Const.OBJECT_CLASS_3D),this.objects={},this.points=this.visProp.depthorderpoints?[]:null,this.elementsByName={},this.defaultAxes=null,this.angles={az:null,el:null,bank:null},this.matrix3DRot=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.matrix3D=[[1,0,0,0],[0,1,0,0],[0,0,1,0]],this.boxToCam=[],this.llftCorner=n[0],this.size=n[1],this.bbox3D=n[2],this.r=-1,this.focalDist=-1,this.projectionType="parallel",this.trackballEnabled=!1,this.timeoutAzimuth=null,this.id=this.board.setId(this,"V"),this.board.finalizeAdding(this),this.elType="view3d",this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.View3D.prototype=new GeometryElement;JXG$1.extend(JXG$1.View3D.prototype,{create:function(u,n,d){var C=[],I;return u.indexOf("3d")>0&&C.push(this),I=this.board.create(u,C.concat(n),d),I},select:function(u,n){var d,C,I,f,y=u;if(y===null)return y;if(JXG$1.isString(y)&&y!=="")JXG$1.exists(this.objects[y])?y=this.objects[y]:JXG$1.exists(this.elementsByName[y])&&(y=this.elementsByName[y]);else if(!n&&(JXG$1.isFunction(y)||JXG$1.isObject(y)&&!JXG$1.isFunction(y.setAttribute))){for(d=JXG$1.filterElements(this.objectsList,y),C={},f=d.length,I=0;I<f;I++)C[d[I].id]=d[I];y=new Composition(C)}else JXG$1.isObject(y)&&JXG$1.exists(y.id)&&!JXG$1.exists(this.objects[y.id])&&(y=null);return y},setAnglesFromRotation:function(){var u=this.matrix3DRot,n,d,C,I,f,y,B;n=Math.sqrt(u[1][3]*u[1][3]+u[2][3]*u[2][3]),n>Mat.eps?(d=u[2][3]/n,C=u[1][3]/n):(d=Math.cos(this.angles.bank),C=Math.sin(this.angles.bank)),u=Mat.matMatMult([[1,0,0,0],[0,d,-C,0],[0,C,d,0],[0,0,0,1]],u),this.angles.bank=Math.atan2(C,d),I=u[2][3],f=u[3][3],u=Mat.matMatMult([[1,0,0,0],[0,1,0,0],[0,0,I,f],[0,0,-f,I]],u),this.angles.el=Math.atan2(f,I),y=-u[1][1],B=u[3][1],this.angles.az=Math.atan2(B,y),this.angles.az<0&&(this.angles.az+=2*Math.PI),this.setSlidersFromAngles()},anglesHaveMoved:function(){return this._hasMoveAz||this._hasMoveEl||Math.abs(this.angles.az-this.az_slide.Value())>Mat.eps||Math.abs(this.angles.el-this.el_slide.Value())>Mat.eps||Math.abs(this.angles.bank-this.bank_slide.Value())>Mat.eps},getAnglesFromSliders:function(){this.angles.az=this.az_slide.Value(),this.angles.el=this.el_slide.Value(),this.angles.bank=this.bank_slide.Value()},setSlidersFromAngles:function(){this.az_slide.setValue(this.angles.az),this.el_slide.setValue(this.angles.el),this.bank_slide.setValue(this.angles.bank)},getRotationFromAngles:function(){var u,n,d,C,I,f,y=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return u=this.angles.az,n=this.angles.el,d=this.angles.bank,C=-Math.sin(n),y[1][1]=-Math.cos(u),y[1][2]=Math.sin(u),y[1][3]=0,y[2][1]=C*Math.sin(u),y[2][2]=C*Math.cos(u),y[2][3]=Math.cos(n),y[3][1]=Math.cos(n)*Math.sin(u),y[3][2]=Math.cos(n)*Math.cos(u),y[3][3]=Math.sin(n),I=Math.cos(d),f=Math.sin(d),y=Mat.matMatMult([[1,0,0,0],[0,I,f,0],[0,-f,I,0],[0,0,0,1]],y),y},_projectToSphere:function(u,n,d){var C=Mat.hypot(n,d),I,f;return C<u*.7071067811865475?f=Math.sqrt(u*u-C*C):(I=u/1.414213562373095,f=I*I/C),f},updateProjectionTrackball:function(u){var n=100,d,C,I,f,y,B,_,Z,M,V,T,H,F,O=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return JXG$1.exists(this._trackball)?(d=this._trackball.dx,C=this._trackball.dy,I=d*d+C*C,I>Mat.eps&&(n=(this.size[0]*this.board.unitX+this.size[1]*this.board.unitY)*.25,B=this._trackball.x,_=this._trackball.y,y=[B,_,this._projectToSphere(n,B,_)],B-=d,_-=C,f=[B,_,this._projectToSphere(n,B,_)],F=Mat.crossProduct(f,y),V=Mat.hypot(F[0],F[1],F[2]),F[0]/=V,F[1]/=V,F[2]/=V,M=Geometry.distance(y,f,3)/(2*n),M=M>1?1:M,M=M<-1?-1:M,Z=2*Math.asin(M),T=Math.cos(Z),M=1-T,H=Math.sin(Z),O[1][1]=T+F[0]*F[0]*M,O[2][1]=F[1]*F[0]*M+F[2]*H,O[3][1]=F[2]*F[0]*M-F[1]*H,O[1][2]=F[0]*F[1]*M-F[2]*H,O[2][2]=T+F[1]*F[1]*M,O[3][2]=F[2]*F[1]*M+F[0]*H,O[1][3]=F[0]*F[2]*M+F[1]*H,O[2][3]=F[1]*F[2]*M-F[0]*H,O[3][3]=T+F[2]*F[2]*M),O=Mat.matMatMult(O,this.matrix3DRot),O):this.matrix3DRot},updateAngleSliderBounds:function(){var u,n,d,C,I,f,y,B,_,Z,M,V,T;this.trackballEnabled=JXG$1.evaluate(this.visProp.trackball.enabled),this.trackballEnabled?(this.az_slide.setMin(0),this.az_slide.setMax(2*Math.PI),this.el_slide.setMin(-.5*Math.PI),this.el_slide.setMax(.5*Math.PI),this.bank_slide.setMin(-Math.PI),this.bank_slide.setMax(Math.PI)):(this.az_slide.setMin(this.visProp.az.slider.min),this.az_slide.setMax(this.visProp.az.slider.max),this.el_slide.setMin(this.visProp.el.slider.min),this.el_slide.setMax(this.visProp.el.slider.max),this.bank_slide.setMin(this.visProp.bank.slider.min),this.bank_slide.setMax(this.visProp.bank.slider.max)),u=this.az_slide._smax,n=this.az_slide._smin,d=this.el_slide._smax,C=this.el_slide._smin,V=this.bank_slide._smax,T=this.bank_slide._smin,this.trackballEnabled?(I=Mat.mod(this.angles.el,2*Math.PI),.5*Math.PI<I&&I<1.5*Math.PI&&(this.angles.el=Math.PI-I,this.angles.az=Mat.wrap(this.angles.az+Math.PI,n,u),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,T,V)),this.angles.az=Mat.wrap(this.angles.az,n,u),this.angles.el=Mat.wrap(this.angles.el,C,d),this.angles.bank=Mat.wrap(this.angles.bank,T,V)):(M=function(H){return H<C?C-H:d<H?H-d:0},f=.5*(C+d),y=Mat.wrap(this.angles.el,f-Math.PI,f+Math.PI),B=Mat.wrap(Math.PI-this.angles.el,f-Math.PI,f+Math.PI),_=M(y),Z=M(B),_<=Z?this.angles.el=Mat.clamp(y,C,d):(this.angles.el=Mat.clamp(B,C,d),this.angles.az=Mat.wrap(this.angles.az+Math.PI,n,u),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,T,V)),this.angles.az=Mat.wrapAndClamp(this.angles.az,n,u,2*Math.PI),this.angles.bank=Mat.wrapAndClamp(this.angles.bank,T,V,2*Math.PI),this.matrix3DRot=this.getRotationFromAngles()),this.setSlidersFromAngles()},_updateCentralProjection:function(){var u=20,n=8,d,C;return d=JXG$1.evaluate(this.visProp.r),d==="auto"&&(d=Mat.hypot(this.bbox3D[0][0]-this.bbox3D[0][1],this.bbox3D[1][0]-this.bbox3D[1][1],this.bbox3D[2][0]-this.bbox3D[2][1])*1.01),this.boxToCam=this.matrix3DRot.map(I=>I.slice()),this.boxToCam[3][0]=-d,this.focalDist=1/Math.tan(.5*JXG$1.evaluate(this.visProp.fov)),C=[[0,0,0,-1],[0,this.focalDist,0,0],[0,0,this.focalDist,0],[2*u*n/(n-u),0,0,(u+n)/(n-u)]],Mat.matMatMult(C,this.boxToCam)},compareDepth:function(u,n){var d=[0,u.coords[1]-n.coords[1],u.coords[2]-n.coords[2],u.coords[3]-n.coords[3]],C=Mat.matVecMult(this.matrix3DRot,Mat.matVecMult(this.shift,d));return C[3]},update:function(){var u=this.r,n=[[1,0,0,0],[0,-u,0,0],[0,0,-u,0],[0,0,0,1]],d,C,I,f,y,B;if(!JXG$1.exists(this.el_slide)||!JXG$1.exists(this.az_slide)||!JXG$1.exists(this.bank_slide)||!this.needsUpdate)return this;switch(d=[[1,0,0],[0,1,0],[0,0,1]],this.projectionType=JXG$1.evaluate(this.visProp.projection).toLowerCase(),this.trackballEnabled!==JXG$1.evaluate(this.visProp.trackball.enabled)&&this.updateAngleSliderBounds(),this._hasMoveTrackball?(this.matrix3DRot=this.updateProjectionTrackball(),this.setAnglesFromRotation()):this.anglesHaveMoved()&&(this.getAnglesFromSliders(),this.matrix3DRot=this.getRotationFromAngles()),this.shift=[[1,0,0,0],[-.5*(this.bbox3D[0][0]+this.bbox3D[0][1]),1,0,0],[-.5*(this.bbox3D[1][0]+this.bbox3D[1][1]),0,1,0],[-.5*(this.bbox3D[2][0]+this.bbox3D[2][1]),0,0,1]],this.projectionType){case"central":I=2*.4,d[1][1]=this.size[0]/I,d[2][2]=this.size[1]/I,d[1][0]=this.llftCorner[0]+d[1][1]*.5*I,d[2][0]=this.llftCorner[1]+d[2][2]*.5*I,this.viewPortTransform=d,C=this._updateCentralProjection(),this.matrix3D=Mat.matMatMult(C,this.shift);break;case"parallel":default:f=this.bbox3D[0][1]-this.bbox3D[0][0],y=this.bbox3D[1][1]-this.bbox3D[1][0],d[1][1]=this.size[0]/f,d[2][2]=this.size[1]/y,d[1][0]=this.llftCorner[0]+d[1][1]*.5*f,d[2][0]=this.llftCorner[1]+d[2][2]*.5*y,this.matrix3D=Mat.matMatMult(d,Mat.matMatMult(Mat.matMatMult(this.matrix3DRot,n),this.shift).slice(0,3))}return this.visProp.depthorderpoints&&this.points===null&&(B=Object.values(this.objects),this.points=B.filter(_=>_.type===Const.OBJECT_TYPE_POINT3D)),!this.visProp.depthorderpoints&&this.points!==null&&(this.points=null),this.visProp.depthorderpoints&&this.board.renderer&&this.board.renderer.type==="svg"&&this.points.filter(_=>JXG$1.evaluate(_.element2D.visProp.visible)).sort(this.compareDepth.bind(this)).forEach(_=>this.board.renderer.setLayer(_.element2D,_.element2D.visProp.layer)),this},updateRenderer:function(){return this.needsUpdate=!1,this},removeObject:function(u,n){var d;if(JXG$1.isArray(u)){for(d=0;d<u.length;d++)this.removeObject(u[d]);return this}if(u=this.select(u),!JXG$1.exists(u)||JXG$1.isString(u))return this;try{delete this.objects[u.id]}catch(C){JXG$1.debug("View3D "+u.id+": Could not be removed: "+C)}return this.board.removeObject(u,n),this},worldToFocal:function(u,n=!0){var d,C=Mat.matVecMult(this.boxToCam,Mat.matVecMult(this.shift,u));if(C[3]-=C[0]*this.focalDist,n)return C;for(d=1;d<4;d++)C[d]/=C[0];return C.slice(1,4)},project3DTo2D:function(u,n,d){var C,I;switch(arguments.length===3?C=[1,u,n,d]:u.length===3?(C=u.slice(),C.unshift(1)):C=u,I=Mat.matVecMult(this.matrix3D,C),this.projectionType){case"central":return I[1]/=I[0],I[2]/=I[0],I[3]/=I[0],I[0]/=I[0],Mat.matVecMult(this.viewPortTransform,I.slice(0,3));case"parallel":default:return I}},_getW0:function(u,n,d){var C=Mat.inverse(u),I=C[0][0]+n[1]*C[0][1]+n[2]*C[0][2],f=C[3][0]+n[1]*C[3][1]+n[2]*C[3][2],y,B,_;return _=d*C[0][3]-C[3][3],y=(f*C[0][3]-I*C[3][3])/_,B=(f-I*d)/_,[1/y,B]},project2DTo3DPlane:function(u,n,d){var C,I,f,y,B,_=n.slice(1),Z,M,V;if(d=d||[1,0,0,0],y=Mat.norm(_,3),f=Mat.innerProduct(d.slice(1),_,3)/y,this.projectionType==="parallel"){C=this.matrix3D.slice(0,3),C.push([0,_[0],_[1],_[2]]),I=u.coords.usrCoords.slice(),I.push(f);try{C[2][3]===1&&(C[2][1]=C[2][2]=Mat.eps*.001),B=Mat.Numerics.Gauss(C,I)}catch{B=[0,NaN,NaN,NaN]}}else{C=this.matrix3D,I=u.coords.usrCoords.slice(),Z=Mat.Numerics.Gauss(this.viewPortTransform,I),V=this._getW0(C,Z,f),M=V[0],I=[Z[0]*M,Z[1]*M,Z[2]*M,V[1]*M];try{C[2][3]===1&&(C[2][1]=C[2][2]=Mat.eps*.001),B=Mat.Numerics.Gauss(C,I),B[1]/=B[0],B[2]/=B[0],B[3]/=B[0],B[0]/=B[0]}catch{B=[0,NaN,NaN,NaN]}}return B},projectScreenToSegment:function(u,n,d){var C=this.project3DTo2D(n).slice(1,3),I=this.project3DTo2D(d).slice(1,3),f=[I[0]-C[0],I[1]-C[1]],y=Mat.innerProduct(f,f),B=[u[0]-C[0],u[1]-C[1]],_=Mat.innerProduct(B,f)/y,Z,M,V,T,H,F,O;return this.projectionType==="central"?(Z=[.5*(n[0]+d[0]),.5*(n[1]+d[1]),.5*(n[2]+d[2])],M=this.project3DTo2D(Z).slice(1,3),V=[M[0]-C[0],M[1]-C[1]],T=Mat.innerProduct(V,f)/y,H=(1-T)*_/((1-2*T)*_+T)):H=_,F=Math.min(Math.max(H,0),1),O=1-F,[1,O*n[0]+F*d[0],O*n[1]+F*d[1],O*n[2]+F*d[2]]},project2DTo3DVertical:function(u,n){var d=u.coords.usrCoords.slice(1,3),C=[n[1],n[2],this.bbox3D[2][0]],I=[n[1],n[2],this.bbox3D[2][1]];return this.projectScreenToSegment(d,C,I)},project3DToCube:function(u){var n=this.bbox3D,d=!1;return u[1]<n[0][0]&&(u[1]=n[0][0],d=!0),u[1]>n[0][1]&&(u[1]=n[0][1],d=!0),u[2]<n[1][0]&&(u[2]=n[1][0],d=!0),u[2]>n[1][1]&&(u[2]=n[1][1],d=!0),u[3]<=n[2][0]&&(u[3]=n[2][0],d=!0),u[3]>=n[2][1]&&(u[3]=n[2][1],d=!0),[u,d]},intersectionLineCube:function(u,n,d){var C,I,f,y;for(C=d,I=0;I<3;I++)n[I]!==0&&(f=(this.bbox3D[I][0]-u[I])/n[I],y=(this.bbox3D[I][1]-u[I])/n[I],d<0?C=Math.max(C,Math.min(f,y)):C=Math.min(C,Math.max(f,y)));return C},isInCube:function(u){return u[0]>this.bbox3D[0][0]-Mat.eps&&u[0]<this.bbox3D[0][1]+Mat.eps&&u[1]>this.bbox3D[1][0]-Mat.eps&&u[1]<this.bbox3D[1][1]+Mat.eps&&u[2]>this.bbox3D[2][0]-Mat.eps&&u[2]<this.bbox3D[2][1]+Mat.eps},intersectionPlanePlane:function(u,n,d){var C=[[],[]],I,f,y,B;return d=d||n.d,I=Mat.Geometry.meet3Planes(u.normal,u.d,n.normal,d,Mat.crossProduct(u.normal,n.normal),0),f=Mat.Geometry.meetPlanePlane(u.vec1,u.vec2,n.vec1,n.vec2),y=this.intersectionLineCube(I,f,1/0),B=Mat.axpy(y,f,I),this.isInCube(B)&&(C[0]=B),y=this.intersectionLineCube(I,f,-1/0),B=Mat.axpy(y,f,I),this.isInCube(B)&&(C[1]=B),C},getMesh:function(u,n,d){var C,I,f,y,B,_,Z,M=[0,0,0],V=n[2],T=d[2],H=[],F=[];for(_=(JXG$1.evaluate(n[1])-JXG$1.evaluate(n[0]))/V,Z=(JXG$1.evaluate(d[1])-JXG$1.evaluate(d[0]))/T,C=0;C<=V;C++){for(f=n[0]+_*C,I=0;I<=T;I++)y=d[0]+Z*I,JXG$1.isFunction(u)?M=u(f,y):M=[u[0](f,y),u[1](f,y),u[2](f,y)],B=this.project3DTo2D(M),H.push(B[1]),F.push(B[2]);H.push(NaN),F.push(NaN)}for(I=0;I<=T;I++){for(y=d[0]+Z*I,C=0;C<=V;C++)f=n[0]+_*C,JXG$1.isFunction(u)?M=u(f,y):M=[u[0](f,y),u[1](f,y),u[2](f,y)],B=this.project3DTo2D(M),H.push(B[1]),F.push(B[2]);H.push(NaN),F.push(NaN)}return[H,F]},animateAzimuth:function(){var u=this.az_slide._smin,n=this.az_slide._smax,d=n-u,C=this.az_slide.Value()+.1;this.az_slide.position=(C-u)/d,this.az_slide.position>1&&(this.az_slide.position=0),this.board.update(),this.timeoutAzimuth=setTimeout((function(){this.animateAzimuth()}).bind(this),200)},stopAzimuth:function(){clearTimeout(this.timeoutAzimuth),this.timeoutAzimuth=null},isVerticalDrag:function(){var u=this.board,n;return JXG$1.evaluate(this.visProp.verticaldrag.enabled)?(n="_"+JXG$1.evaluate(this.visProp.verticaldrag.key)+"Key",u[n]):!1},setView:function(u,n,d){return d=d||this.r,this.az_slide.setValue(u),this.el_slide.setValue(n),this.r=d,this.board.update(),this},nextView:function(){var u=JXG$1.evaluate(this.visProp.values),n=this.visProp._currentview;return n=(n+1)%u.length,this.setCurrentView(n),this},previousView:function(){var u=JXG$1.evaluate(this.visProp.values),n=this.visProp._currentview;return n=(n+u.length-1)%u.length,this.setCurrentView(n),this},setCurrentView:function(u){var n=JXG$1.evaluate(this.visProp.values);return(u<0||u>=n.length)&&(u=(u%n.length+n.length)%n.length),this.setView(n[u][0],n[u][1],n[u][2]),this.visProp._currentview=u,this},_azEventHandler:function(u){var n=this.az_slide._smax,d=this.az_slide._smin,C=(n-d)/this.board.canvasWidth*JXG$1.evaluate(this.visProp.az.pointer.speed),I=u.movementX,f=this.az_slide.Value(),y=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.az.keyboard.enabled)&&(u.key==="ArrowRight"?f=f+JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180:u.key==="ArrowLeft"&&(f=f-JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.az.pointer.enabled)&&I!==0&&u.key==null&&(f+=I*C),JXG$1.evaluate(this.visProp.az.continuous)?f=Mat.wrap(f,d,n):f>0?f=Math.min(n,f):f<0&&(f=Math.max(d,f)),this.setView(f,y),this)},_elEventHandler:function(u){var n=this.el_slide._smax,d=this.el_slide._smin,C=(n-d)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.el.pointer.speed),I=u.movementY,f=this.az_slide.Value(),y=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.el.keyboard.enabled)&&(u.key==="ArrowUp"?y=y-JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180:u.key==="ArrowDown"&&(y=y+JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&I!==0&&u.key==null&&(y+=I*C),JXG$1.evaluate(this.visProp.el.continuous)&&!this.trackballEnabled?y=Mat.wrap(y,d,n):y>0?y=Math.min(n,y):y<0&&(y=Math.max(d,y)),this.setView(f,y),this)},_bankEventHandler:function(u){var n=this.bank_slide._smax,d=this.bank_slide._smin,C,I,f=u.deltaY,y=this.bank_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.bank.keyboard.enabled)&&(C=JXG$1.evaluate(this.visProp.bank.keyboard.step)*Math.PI/180,u.key==="."||u.key==="<"?y-=C:(u.key===","||u.key===">")&&(y+=C)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&f!==0&&u.key==null&&(I=(n-d)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.bank.pointer.speed),y+=f*I,u.preventDefault()),JXG$1.evaluate(this.visProp.bank.continuous)?y=Mat.wrap(y,d,n):y=Mat.clamp(y,d,n),this.bank_slide.setValue(y),this.board.update(),this)},_trackballHandler:function(u){var n=this.board.getMousePosition(u),d,C,I;return I=new Coords(Const.COORDS_BY_USER,[this.llftCorner[0]+this.size[0]*.5,this.llftCorner[1]+this.size[1]*.5],this.board),d=n[0]-I.scrCoords[1],C=n[1]-I.scrCoords[2],this._trackball={dx:u.movementX,dy:-u.movementY,x:d,y:-C},this.board.update(),this},pointerDownHandler:function(u){var n,d,C;this._hasMoveAz=!1,this._hasMoveEl=!1,this._hasMoveBank=!1,this._hasMoveTrackball=!1,this.board.mode===this.board.BOARD_MODE_NONE&&(JXG$1.evaluate(this.visProp.trackball.enabled)?(n=JXG$1.evaluate(this.visProp.trackball.button),d=JXG$1.evaluate(this.visProp.trackball.key),(n===-1||n===u.button)&&(d==="none"||d.indexOf("shift")>-1&&u.shiftKey||d.indexOf("ctrl")>-1&&u.ctrlKey)&&(C=JXG$1.evaluate(this.visProp.trackball.outside)?document:this.board.containerObj,JXG$1.addEvent(C,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!0)):(JXG$1.evaluate(this.visProp.az.pointer.enabled)&&(n=JXG$1.evaluate(this.visProp.az.pointer.button),d=JXG$1.evaluate(this.visProp.az.pointer.key),(n===-1||n===u.button)&&(d==="none"||d.indexOf("shift")>-1&&u.shiftKey||d.indexOf("ctrl")>-1&&u.ctrlKey)&&(C=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(C,"pointermove",this._azEventHandler,this),this._hasMoveAz=!0)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&(n=JXG$1.evaluate(this.visProp.el.pointer.button),d=JXG$1.evaluate(this.visProp.el.pointer.key),(n===-1||n===u.button)&&(d==="none"||d.indexOf("shift")>-1&&u.shiftKey||d.indexOf("ctrl")>-1&&u.ctrlKey)&&(C=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(C,"pointermove",this._elEventHandler,this),this._hasMoveEl=!0)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&(n=JXG$1.evaluate(this.visProp.bank.pointer.button),d=JXG$1.evaluate(this.visProp.bank.pointer.key),(n===-1||n===u.button)&&(d==="none"||d.indexOf("shift")>-1&&u.shiftKey||d.indexOf("ctrl")>-1&&u.ctrlKey)&&(C=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(C,"wheel",this._bankEventHandler,this,{passive:!1}),this._hasMoveBank=!0))),JXG$1.addEvent(document,"pointerup",this.pointerUpHandler,this))},pointerUpHandler:function(u){var n;this._hasMoveAz&&(n=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(n,"pointermove",this._azEventHandler,this),this._hasMoveAz=!1),this._hasMoveEl&&(n=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(n,"pointermove",this._elEventHandler,this),this._hasMoveEl=!1),this._hasMoveBank&&(n=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(n,"wheel",this._bankEventHandler,this),this._hasMoveBank=!1),this._hasMoveTrackball&&(n=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(n,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!1),JXG$1.removeEvent(document,"pointerup",this.pointerUpHandler,this)}});JXG$1.createView3D=function(u,n,d){var C,I,f,y,B,_,Z,M,V,T=n[0],H=n[1];return I=JXG$1.copyAttributes(d,u.options,"view3d"),C=new JXG$1.View3D(u,n,I),C.defaultAxes=C.create("axes3d",[],I),_=T[0],Z=T[1],M=H[0],V=H[1],f=JXG$1.copyAttributes(I,u.options,"view3d","az","slider"),f.name="az",y=JXG$1.copyAttributes(I,u.options,"view3d","el","slider"),y.name="el",B=JXG$1.copyAttributes(I,u.options,"view3d","bank","slider"),B.name="bank",C.az_slide=u.create("slider",[[_-1,Z-2],[_+M+1,Z-2],[JXG$1.evaluate(f.min),JXG$1.evaluate(f.start),JXG$1.evaluate(f.max)]],f),C.inherits.push(C.az_slide),C.el_slide=u.create("slider",[[_-1,Z],[_-1,Z+V],[JXG$1.evaluate(y.min),JXG$1.evaluate(y.start),JXG$1.evaluate(y.max)]],y),C.inherits.push(C.el_slide),C.bank_slide=u.create("slider",[[_-1,Z+V+2],[_+M+1,Z+V+2],[JXG$1.evaluate(B.min),JXG$1.evaluate(B.start),JXG$1.evaluate(B.max)]],B),C.inherits.push(C.bank_slide),C.board.infobox.visProp=JXG$1.merge(C.board.infobox.visProp,I.infobox),C.board.highlightInfobox=function(F,O,$){var U,ee,Q,ie,ne="",le=$.board,ae,ce,ge=null;for(this.mode===this.BOARD_MODE_DRAG&&(C.isVerticalDrag()?ne='<span style="color:black; font-size:200%">⇅ &nbsp;</span>':ne='<span style="color:black; font-size:200%">⇄ &nbsp;</span>'),ee=0;ee<$.parents.length&&(ge=le.objects[$.parents[ee]],!ge.is3D);ee++);if(ge){if(ie=[1,0,0,ge.coords[3]],C._w0=Mat.innerProduct(C.matrix3D[0],ie,4),Q=C.project2DTo3DPlane(ge.element2D,[1,0,0,1],ie),!C.isInCube(Q)){C.board.highlightCustomInfobox("",ge);return}U=JXG$1.evaluate(ge.visProp.infoboxdigits),ce=C.board.infobox,U==="auto"?ce.useLocale()?ae=[ne,"(",ce.formatNumberLocale(ge.X())," | ",ce.formatNumberLocale(ge.Y())," | ",ce.formatNumberLocale(ge.Z()),")"]:ae=[ne,"(",JXG$1.autoDigits(ge.X())," | ",JXG$1.autoDigits(ge.Y())," | ",JXG$1.autoDigits(ge.Z()),")"]:ce.useLocale()?ae=[ne,"(",ce.formatNumberLocale(ge.X(),U)," | ",ce.formatNumberLocale(ge.Y(),U)," | ",ce.formatNumberLocale(ge.Z(),U),")"]:ae=[ne,"(",JXG$1.toFixed(ge.X(),U)," | ",JXG$1.toFixed(ge.Y(),U)," | ",JXG$1.toFixed(ge.Z(),U),")"],C.board.highlightCustomInfobox(ae.join(""),ge)}else C.board.highlightCustomInfobox("("+F+", "+O+")",$)},C.BOARD_MODE_NONE=0,JXG$1.addEvent(u.containerObj,"keydown",function(F){var O,$=!1;JXG$1.evaluate(C.visProp.el.keyboard.enabled)&&(F.key==="ArrowUp"||F.key==="ArrowDown")&&(O=JXG$1.evaluate(C.visProp.el.keyboard.key),(O==="none"||O.indexOf("shift")>-1&&F.shiftKey||O.indexOf("ctrl")>-1&&F.ctrlKey)&&(C._elEventHandler(F),$=!0)),JXG$1.evaluate(C.visProp.el.keyboard.enabled)&&(F.key==="ArrowLeft"||F.key==="ArrowRight")&&(O=JXG$1.evaluate(C.visProp.az.keyboard.key),(O==="none"||O.indexOf("shift")>-1&&F.shiftKey||O.indexOf("ctrl")>-1&&F.ctrlKey)&&(C._azEventHandler(F),$=!0)),JXG$1.evaluate(C.visProp.bank.keyboard.enabled)&&(F.key===","||F.key==="<"||F.key==="."||F.key===">")&&(O=JXG$1.evaluate(C.visProp.bank.keyboard.key),(O==="none"||O.indexOf("shift")>-1&&F.shiftKey||O.indexOf("ctrl")>-1&&F.ctrlKey)&&(C._bankEventHandler(F),$=!0)),F.key==="PageUp"?(C.nextView(),$=!0):F.key==="PageDown"&&(C.previousView(),$=!0),$&&F.preventDefault()},C),JXG$1.addEvent(u.containerObj,"pointerdown",C.pointerDownHandler,C),C.getAnglesFromSliders(),C.matrix3DRot=C.getRotationFromAngles(),C.updateAngleSliderBounds(),C.board.update(),C};JXG$1.registerElement("view3d",JXG$1.createView3D);JXG$1.View3D;JXG$1.GeometryElement3D=function(u,n){this.elType=n,this.id=this.board.setId(this,n),this.view=u,this.element2D=null,this.is3D=!0,this.view.objects[this.id]=this,this.name!==""&&(this.view.elementsByName[this.name]=this)};JXG$1.extend(JXG$1.GeometryElement3D.prototype,{setAttr2D:function(u){var n=u;return n.name=this.name,n},setAttribute:function(u){var n,d,C,I,f,y={};for(n=0;n<arguments.length;n++)I=arguments[n],JXG$1.isString(I)?(f=I.split(":"),y[JXG$1.trim(f[0])]=JXG$1.trim(f[1])):JXG$1.isArray(I)?y[I[0]]=I[1]:JXG$1.extend(y,I);for(n in y)if(y.hasOwnProperty(n))switch(d=n.replace(/\s+/g,"").toLowerCase(),C=y[n],d){case"numberpointshigh":case"stepsu":case"stepsv":JXG$1.exists(this.visProp[d])&&(!JXG$1.Validator[d]||JXG$1.Validator[d]&&JXG$1.Validator[d](C)||JXG$1.Validator[d]&&JXG$1.isFunction(C)&&JXG$1.Validator[d](C()))&&(C=C.toLowerCase&&C.toLowerCase()==="false"?!1:C,this._set(d,C));break;default:JXG$1.exists(this.element2D)&&this.element2D.setAttribute(y)}},getAttribute:function(u){var n;switch(u=u.toLowerCase(),u){case"numberpointshigh":case"stepsu":case"stepsv":n=this.visProp[u];break;default:JXG$1.exists(this.element2D)&&(n=this.element2D.getAttribute(u));break}return n},getAttributes:function(){var u={},n,d,C=["numberpointshigh","stepsu","stepsv"],I=C.length;for(JXG$1.exists(this.element2D)&&(u=JXG$1.merge(this.element2D.getAttributes())),n=0;n<I;n++)d=C[n],JXG$1.exists(this.visProp[d])&&(u[d]=this.visProp[d]);return u},setPosition2D:function(u){},remove:function(){}});JXG$1.GeometryElement3D;JXG$1.createAxes3D=function(u,n,d){var C=n[0],I=["x","y","z"],f="Axis",y=["Rear","Front"],B=[0,0,0],_=[0,0,0],Z,M,V,T,H,F,O,$,U,ee,Q,ie,ne,le,ae,ce,ge,he,Ie,fe={};if(JXG$1.exists(C.bbox3D))for(Z=0;Z<I.length;Z++)B[Z]=C.bbox3D[Z][0],_[Z]=C.bbox3D[Z][1];else for(Z=0;Z<I.length;Z++)B[Z]=n[1][Z],_[Z]=n[2][1];for(F=JXG$1.copyAttributes(d,u.options,"axes3d"),O=F.axesposition,Z=0;Z<I.length;Z++)$=I[Z],ge=$+f,O==="center"?(Q=[0,0,0],ie=[0,0,0],ie[Z]=_[Z],fe[ge]=C.create("axis3d",[Q,ie],F[ge.toLowerCase()]),fe[ge].view=C):O==="border"&&(ge+="Border",Q=B.slice(),ie=_.slice(),$==="z"?(Q[1]=_[1],ie[0]=B[0]):$==="x"?(Q=[B[0],_[1],B[2]],ie=[_[0],_[1],B[2]]):(Q=[_[0],B[1],B[2]],ie=[_[0],_[1],B[2]]),ie[Z]=_[Z],fe[ge]=C.create("axis3d",[Q,ie],F[ge.toLowerCase()]),fe[ge].view=C,Ie=F[ge.toLowerCase()].ticks3d,ee=_[Z]-B[Z],$==="x"?fe[ge+"Ticks"]=C.create("ticks3d",[Q,[1,0,0],ee,[0,1,0]],Ie):$==="y"?fe[ge+"Ticks"]=C.create("ticks3d",[Q,[0,1,0],ee,[1,0,0]],Ie):fe[ge+"Ticks"]=C.create("ticks3d",[Q,[0,0,1],ee,[0,1,0]],Ie),fe[ge+"Ticks"].view=C);for(O==="center"?(fe.O=C.create("intersection",[fe[I[0]+f],fe[I[1]+f]],{name:"",visible:!1,withLabel:!1}),fe.O.view=C):fe.O=null,Z=0;Z<I.length;Z++)for(T=(Z+1)%3,H=(Z+2)%3,$=I[Z],M=0;M<y.length;M++)Q=[0,0,0],Q[Z]=M===0?B[Z]:_[Z],ne=[0,0,0],le=[0,0,0],ne[T]=1,le[H]=1,ae=[B[T],_[T]],ce=[B[H],_[H]],ge=$+"Plane"+y[M],F=JXG$1.copyAttributes(d,u.options,"axes3d",ge),fe[ge]=C.create("plane3d",[Q,ne,le,ae,ce],F),fe[ge].elType="axisplane3d";for(Z=0;Z<I.length;Z++)for($=I[Z],M=0;M<y.length;M++)for(V=1;V<=2;V++)T=(Z+V)%3,U=I[T],ge=$+"Plane"+y[M]+U.toUpperCase()+"Axis",he=$+"Plane"+y[M],Q=[0,0,0],ie=[0,0,0],Q[Z]=ie[Z]=M===0?B[Z]:_[Z],Q[T]=B[T],ie[T]=_[T],F=JXG$1.copyAttributes(d,u.options,"axes3d",ge),fe[ge]=C.create("axis3d",[Q,ie],F),fe[ge].view=C,fe[he].addChild(fe[ge]),fe[he].element2D.inherits.push(fe[ge]);return fe};JXG$1.registerElement("axes3d",JXG$1.createAxes3D);JXG$1.createAxis3D=function(u,n,d){var C=n[0],I,f=n[1],y=n[2],B,_,Z;return I=JXG$1.copyAttributes(d.point1,u.options,"axis3d","point1"),B=C.create("point",[function(M,V,T){return function(){return C.project3DTo2D(M,V,T)[1]}}(f[0],f[1],f[2]),function(M,V,T){return function(){return C.project3DTo2D(M,V,T)[2]}}(f[0],f[1],f[2])],I),I=JXG$1.copyAttributes(d.point2,u.options,"axis3d","point2"),_=C.create("point",[function(M,V,T){return function(){return C.project3DTo2D(M,V,T)[1]}}(y[0],y[1],y[2]),function(M,V,T){return function(){return C.project3DTo2D(M,V,T)[2]}}(y[0],y[1],y[2])],I),I=JXG$1.copyAttributes(d,u.options,"axis3d"),Z=C.create("arrow",[B,_],I),Z};JXG$1.registerElement("axis3d",JXG$1.createAxis3D);JXG$1.createMesh3D=function(u,n,d){var C=n[0],I=n[1],f=n[2],y=n[3],B=n[4],_=n[5],Z=n[6]||1,M;return M=C.create("curve",[[],[]],d),M.point=I,M.direction1=f,M.range1=y,M.direction2=B,M.range2=_,M.step=Z,M.updateDataArray=function(){var V=JXG$1.evaluate(this.range1),T=JXG$1.evaluate(this.range2),H=V[0],F=V[1],O=T[0],$=T[1],U,ee,Q,ie,ne=[0,0,0],le=[0,0,0],ae=JXG$1.evaluate(this.step),ce=[0,0,0];if(this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ce=this.point().slice(1);else for(ie=0;ie<3;ie++)ce[ie]=JXG$1.evaluate(this.point[ie]);for(ie=0;ie<3;ie++)ne[ie]=JXG$1.evaluate(this.direction1[ie]),le[ie]=JXG$1.evaluate(this.direction2[ie]);for(U=JXG$1.Math.norm(ne,3),ee=JXG$1.Math.norm(le,3),ie=0;ie<3;ie++)ne[ie]/=U,le[ie]/=ee;Q=C.getMesh([function(ge,he){return ce[0]+ge*ne[0]+he*le[0]},function(ge,he){return ce[1]+ge*ne[1]+he*le[1]},function(ge,he){return ce[2]+ge*ne[2]+he*le[2]}],[Math.ceil(H),Math.floor(F),(Math.ceil(F)-Math.floor(H))/ae],[Math.ceil(O),Math.floor($),(Math.ceil($)-Math.floor(O))/ae]),this.dataX=Q[0],this.dataY=Q[1]},M};JXG$1.registerElement("mesh3d",JXG$1.createMesh3D);JXG$1.Circle3D=function(u,n,d,C,I){var f;this.constructor(u.board,I,Const.OBJECT_TYPE_CIRCLE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"circle3d"),this.center=this.board.select(n),this.normal=[0,0,0],this.curve,this.frame1,this.frame2,this.updateNormal=function(){var y,B;for(y=0;y<3;y++)this.normal[y]=JXG$1.evaluate(d[y]);if(B=Mat.norm(this.normal),Math.abs(B)>Mat.eps)for(y=0;y<3;y++)this.normal[y]/=B},JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),this.updateRadius=JXG$1.createFunction(C,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.updateNormal(),this.frame1=Mat.crossProduct(this.normal,[1,0,0]),f=Mat.crossProduct(this.normal,[-.5,.8660254037844386,0]),Mat.norm(f)>Mat.norm(this.frame1)&&(this.frame1=f),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame(),this.curve=u.create("curve3d",[y=>this.center.X()+this.Radius()*(Math.cos(y)*this.frame1[0]+Math.sin(y)*this.frame2[0]),y=>this.center.Y()+this.Radius()*(Math.cos(y)*this.frame1[1]+Math.sin(y)*this.frame2[1]),y=>this.center.Z()+this.Radius()*(Math.cos(y)*this.frame1[2]+Math.sin(y)*this.frame2[2]),[0,2*Math.PI]],I)};JXG$1.Circle3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Circle3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Circle3D.prototype,{update:function(){return this.updateNormal(),this.updateFrame(),this.curve.visProp.visible=!isNaN(this.Radius()),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(u){return this.updateRadius=JXG$1.createFunction(u,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(u){return JXG$1.exists(u)?(this.setRadius(u),this.Radius()):Math.abs(this.updateRadius())},normalizeFrame:function(){var u=Mat.norm(this.frame1),n=Mat.norm(this.frame2),d;for(d=0;d<3;d++)this.frame1[d]/=u,this.frame2[d]/=n},updateFrame:function(){this.frame1=Mat.crossProduct(this.frame2,this.normal),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame()},projectCoords:function(u,n){return this.curve.projectCoords(u,n)},projectScreenCoords:function(u,n){return this.curve.projectScreenCoords(u,n)}});JXG$1.createCircle3D=function(u,n,d){var C=n[0],I=JXG$1.copyAttributes(d,u.options,"circle3d"),f=JXG$1.providePoints3D(C,[n[1]],d,"circle3d",["point"])[0],y=n[2],B=n[3],_;return _=new JXG$1.Circle3D(C,f,y,B,I),_.curve.addParents([_]),_.addChild(_.curve),_.update(),_};JXG$1.registerElement("circle3d",JXG$1.createCircle3D);JXG$1.createIntersectionCircle3D=function(u,n,d){var C=n[0],I=n[1],f=n[2],y,B,_,Z=JXG$1.copyAttributes(d,u.options,"intersectioncircle3d");_=Geometry.intersectionFunction3D(C,I,f),B=C.create("point3d",_[0],{visible:!1}),y=C.create("circle3d",[B,_[1],_[2]],Z);try{I.addChild(y),f.addChild(y)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'.")}return y.type=Const.OBJECT_TYPE_INTERSECTION_CIRCLE3D,y.elType="intersectioncircle3d",y.setParents([I.id,f.id]),y};JXG$1.registerElement("intersectioncircle3d",JXG$1.createIntersectionCircle3D);JXG$1.Point3D=function(u,n,d,C){this.constructor(u.board,C,Const.OBJECT_TYPE_POINT3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"point3d"),this.board.finalizeAdding(this),u.visProp.depthorderpoints&&u.points.push(this),this.coords=[0,0,0,0],this.F=n,this.slide=d,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Point3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Point3D.prototype,{updateCoords:function(){var u;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,u=0;u<3;u++)JXG$1.isFunction(this.F[u])&&(this.coords[u+1]=JXG$1.evaluate(this.F[u]));return this},initCoords:function(){var u;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,u=0;u<3;u++)this.coords[u+1]=JXG$1.evaluate(this.F[u]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(u,n){var d=this.coords;return u.length===3?(d[0]=1,d[1]=u[0],d[2]=u[1],d[3]=u[2]):(d[0]=u[0],d[1]=u[1],d[2]=u[2],d[3]=u[2],this.normalizeCoords()),this},update:function(u){var n,d,C;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?n=this.view.project2DTo3DVertical(this.element2D,this.coords):(d=[1,0,0,this.coords[3]],n=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],d)),n[0]!==0&&(C=this.view.project3DToCube(n),this.coords=C[0],C[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()]))),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},distance:function(u){var n=Mat.eps*Mat.eps,d=this.coords,C=u.coords;return d[0]*d[0]>n&&C[0]*C[0]>n?Mat.hypot(C[1]-d[1],C[2]-d[2],C[3]-d[3]):Number.POSITIVE_INFINITY},__evt__update3D:function(u){}});JXG$1.createPoint3D=function(u,n,d){var C=n[0],I,f,y,B,_;if(n.length>2&&JXG$1.exists(n[n.length-1].is3D)?y=n.pop():y=null,n.length===2)f=n[1];else if(n.length===4)f=n.slice(1);else throw new Error("JSXGraph: Can't create point3d with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [[x,y,z]], [x,y,z]`);return I=JXG$1.copyAttributes(d,u.options,"point3d"),_=new JXG$1.Point3D(C,f,y,I),_.initCoords(),B=C.project3DTo2D(_.coords),I=_.setAttr2D(I),_.element2D=C.create("point",B,I),_.element2D.view=C,_.addChild(_.element2D),_.inherits.push(_.element2D),_.element2D.setParents(_),_.slide&&(_.slide.addChild(_),_.setParents(_.slide)),_._c2d=_.element2D.coords.usrCoords.slice(),_};JXG$1.registerElement("point3d",JXG$1.createPoint3D);JXG$1.Curve3D=function(u,n,d,C,I,f,y){this.constructor(u.board,y,Const.OBJECT_TYPE_CURVE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"curve3d"),this.board.finalizeAdding(this),this.F=n,this.X=d,this.Y=C,this.Z=I,this.dataX=null,this.dataY=null,this.dataZ=null,this.F!==null&&(this.X=function(B){return this.F(B)[0]},this.Y=function(B){return this.F(B)[1]},this.Z=function(B){return this.F(B)[2]}),this.range=f,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Curve3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Curve3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Curve3D.prototype,{updateDataArray2D:function(){var u=JXG$1.evaluate(this.visProp.numberpointshigh),n,d,C,I,f,y,B,_,Z,M=[0,0,0];if(B=[],_=[],JXG$1.exists(this.dataX))for(u=this.dataX.length,y=0;y<u;y++)M=[this.dataX[y],this.dataY[y],this.dataZ[y]],f=this.view.project3DTo2D(M),B.push(f[1]),_.push(f[2]);else if(JXG$1.isArray(this.X))for(u=this.X.length,y=0;y<u;y++)M=[this.X[y],this.Y[y],this.Z[y]],f=this.view.project3DTo2D(M),B.push(f[1]),_.push(f[2]);else for(n=JXG$1.evaluate(this.range),d=JXG$1.evaluate(n[0]),C=JXG$1.evaluate(n[1]),I=(C-d)/(u-1),Z=0,y=d;Z<u&&y<=C;Z++,y+=I)this.F!==null?M=this.F(y):M=[this.X(y),this.Y(y),this.Z(y)],f=this.view.project3DTo2D(M),B.push(f[1]),_.push(f[2]);return{X:B,Y:_}},updateDataArray:function(){},update:function(){return this.updateDataArray(),this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(u){u.length===0&&u.unshift(.5*(this.range[0]+this.range[1]))},projectCoords:function(u,n){return this.initParamsIfNeeded(n),Geometry.projectCoordsToParametric(u,this,n)},projectScreenCoords:function(u,n){return this.initParamsIfNeeded(n),Geometry.projectScreenCoordsToParametric(u,this,n)}});JXG$1.createCurve3D=function(u,n,d){var C=n[0],I,f,y,B,_,Z,M;return n.length===3?(I=n[1],_=n[2],f=null,y=null,B=null):(f=n[1],y=n[2],B=n[3],_=n[4],I=null),Z=JXG$1.copyAttributes(d,u.options,"curve3d"),M=new JXG$1.Curve3D(C,I,f,y,B,_,Z),Z=M.setAttr2D(Z),M.element2D=C.create("curve",[[],[]],Z),M.element2D.view=C,M.element2D.updateDataArray=function(){var V=M.updateDataArray2D();this.dataX=V.X,this.dataY=V.Y},M.addChild(M.element2D),M.inherits.push(M.element2D),M.element2D.setParents(M),M.element2D.prepareUpdate().update(),u.isSuspendedUpdate||M.element2D.updateVisibility().updateRenderer(),M};JXG$1.registerElement("curve3d",JXG$1.createCurve3D);JXG$1.createVectorfield3D=function(u,n,d){var C=n[0],I,f;if(!(n.length>=5&&(JXG$1.isArray(n[1])||JXG$1.isFunction(n[1])||JXG$1.isString(n[1]))&&JXG$1.isArray(n[2])&&n[1].length===3&&JXG$1.isArray(n[3])&&n[2].length===3&&JXG$1.isArray(n[4])&&n[3].length===3))throw new Error("JSXGraph: Can't create vector field 3D with parent types '"+typeof n[1]+"', '"+typeof n[2]+"', '"+typeof n[3]+"'.'"+typeof n[4]+"', ");return f=JXG$1.copyAttributes(d,u.options,"vectorfield3d"),I=C.create("curve3d",[[],[],[]],f),I.setF=function(y,B){var _,Z,M;return JXG$1.isArray(y)?(_=JXG$1.createFunction(y[0],this.board,B),Z=JXG$1.createFunction(y[1],this.board,B),M=JXG$1.createFunction(y[2],this.board,B),this.F=function(V,T,H){return[_(V,T,H),Z(V,T,H),M(V,T,H)]}):this.F=JXG$1.createFunction(y,I.board,B),this},I.setF(n[1],"x, y, z"),I.xData=n[2],I.yData=n[3],I.zData=n[4],I.updateDataArray=function(){var y,B,_,Z,M,V,T,H,F=JXG$1.evaluate(this.visProp.scale),O=[JXG$1.evaluate(this.xData[0]),JXG$1.evaluate(this.yData[0]),JXG$1.evaluate(this.zData[0])],$=[JXG$1.evaluate(this.xData[1]),JXG$1.evaluate(this.yData[1]),JXG$1.evaluate(this.zData[1])],U=[JXG$1.evaluate(this.xData[2]),JXG$1.evaluate(this.yData[2]),JXG$1.evaluate(this.zData[2])],ee=[(U[0]-O[0])/$[0],(U[1]-O[1])/$[1],(U[2]-O[2])/$[2]],Q,ie,ne,le,ae=JXG$1.evaluate(this.visProp.arrowhead.enabled),ce,ge,he,Ie,fe;for(ae&&(ce=JXG$1.evaluate(this.visProp.arrowhead.size),fe=JXG$1.evaluate(this.visProp.arrowhead.angle),ge=ce/u.unitX,he=ce/u.unitY,Ie=ce/Math.sqrt(u.unitX*u.unitY)),this.dataX=[],this.dataY=[],this.dataZ=[],B=0,V=O[0];B<=$[0];V+=ee[0],B++)for(_=0,T=O[1];_<=$[1];T+=ee[1],_++)for(y=0,H=O[2];y<=$[2];H+=ee[2],y++)Z=this.F(V,T,H),M=Mat.norm(Z),!(M<Number.EPSILON)&&(Z[0]*=F,Z[1]*=F,Z[2]*=F,JXG$1.concat(this.dataX,[V,V+Z[0],NaN]),JXG$1.concat(this.dataY,[T,T+Z[1],NaN]),JXG$1.concat(this.dataZ,[H,H+Z[2],NaN]),ae&&(M*=F,Q=Math.atan2(Z[1],Z[0]),le=Math.asin(Z[2]/M),ie=le-fe,ne=le+fe,JXG$1.concat(this.dataX,[V+Z[0]-ge*Math.cos(Q)*Math.cos(ie),V+Z[0],V+Z[0]-ge*Math.cos(Q)*Math.cos(ne),NaN]),JXG$1.concat(this.dataY,[T+Z[1]-he*Math.sin(Q)*Math.cos(ie),T+Z[1],T+Z[1]-he*Math.sin(Q)*Math.cos(ne),NaN]),JXG$1.concat(this.dataZ,[H+Z[2]-Ie*Math.sin(ne),H+Z[2],H+Z[2]-Ie*Math.sin(ie),NaN])))},I.methodMap=JXG$1.deepCopy(I.methodMap,{setF:"setF"}),I};JXG$1.registerElement("vectorfield3D",JXG$1.createVectorfield3D);JXG$1.Line3D=function(u,n,d,C,I){this.constructor(u.board,I,Const.OBJECT_TYPE_LINE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"line3d"),this.board.finalizeAdding(this),this.point=n,this.direction=d,this.range=C||[-1/0,1/0],this.point1=null,this.point2=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Line3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Line3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Line3D.prototype,{getPointCoords:function(u){var n=[],d=[],C,I;if(n=[this.point.X(),this.point.Y(),this.point.Z()],JXG$1.isFunction(this.direction))d=this.direction();else for(C=1;C<4;C++)d.push(JXG$1.evaluate(this.direction[C]));return I=JXG$1.evaluate(u),u=this.view.intersectionLineCube(n,d,I),[n[0]+d[0]*u,n[1]+d[1]*u,n[2]+d[2]*u]},update:function(){return this},setPosition2D:function(u){var n,d;for(n=0;n<this.parents.length;n++)d=this.view.select(this.parents[n]),d.elType==="point3d"&&d.element2D.draggable()&&u.applyOnce(d.element2D)},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(u){var n=this.getPointCoords(0),d=this.getPointCoords(1),C=[d[0]-n[0],d[1]-n[1],d[2]-n[2]],I=[u[0]-n[0],u[1]-n[1],u[2]-n[2]],f=Mat.innerProduct(I,C)/Mat.innerProduct(C,C),y=Math.min(Math.max(f,this.range[0]),this.range[1]),B;return B=this.getPointCoords(y).slice(),B.unshift(1),B},projectScreenCoords:function(u){var n=this.getPointCoords(0),d=this.getPointCoords(1);return this.view.projectScreenToSegment(u,n,d)}});JXG$1.createLine3D=function(u,n,d){var C=n[0],I,f,y,B,_,Z,M,V,T;return I=JXG$1.copyAttributes(d,u.options,"line3d"),JXG$1.isPoint3D(n[2])||n.length===3&&(JXG$1.isArray(n[2])||JXG$1.isFunction(n[2]))?(Z=JXG$1.providePoints3D(C,[n[1]],d,"line3d",["point1"])[0],M=JXG$1.providePoints3D(C,[n[2]],d,"line3d",["point2"])[0],B=function(){return[M.X()-Z.X(),M.Y()-Z.Y(),M.Z()-Z.Z()]},_=[0,1],T=new JXG$1.Line3D(C,Z,B,_,I),V=JXG$1.providePoints3D(C,[[0,0,0],[0,0,0]],{visible:!1},"line3d",["point1","point2"]),V[0].F=function(){var H=0;return JXG$1.evaluate(T.visProp.straightfirst)&&(H=-1/0),T.getPointCoords(H)},V[1].F=function(){var H=1;return JXG$1.evaluate(T.visProp.straightlast)&&(H=1/0),T.getPointCoords(H)},V[0].prepareUpdate().update(),V[1].prepareUpdate().update(),I=T.setAttr2D(I),I.straightfirst=!1,I.straightlast=!1,T.element2D=C.create("segment",[V[0].element2D,V[1].element2D],I),T.element2D.view=C,T.endpoints=V,T.addChild(V[0]),T.addChild(V[1]),T.addParents([Z,M])):(y=JXG$1.providePoints3D(C,[n[1]],d,"line3d",["point"])[0],JXG$1.isFunction(n[2])?B=n[2]:n[2].length===3?B=[1].concat(n[2]):n[2].length===4&&(B=n[2]),_=n[3],f=JXG$1.providePoints3D(C,[[0,0,0],[0,0,0]],d,"line3d",["point1","point2"]),T=new JXG$1.Line3D(C,y,B,_,I),f[0].F=function(){return T.getPointCoords(JXG$1.evaluate(T.range[0]))},f[0].prepareUpdate().update(),Z=f[0],f[1].F=function(){return T.getPointCoords(JXG$1.evaluate(T.range[1]))},f[1].prepareUpdate().update(),M=f[1],I=T.setAttr2D(I),I.straightfirst=!1,I.straightlast=!1,T.element2D=C.create("segment",[Z.element2D,M.element2D],I),T.element2D.view=C,T.endpoints=f,T.addParents(y)),T.addChild(T.element2D),T.inherits.push(T.element2D),T.element2D.addParents(T),T.point1=Z,T.point2=M,T.point1._is_new?(T.addChild(T.point1),delete T.point1._is_new):T.point1.addChild(T),T.point2._is_new?(T.addChild(T.point2),delete T.point2._is_new):T.point2.addChild(T),JXG$1.exists(y)&&(y._is_new?(T.addChild(y),delete y._is_new):y.addChild(T)),T.update(),T.element2D.prepareUpdate().update().updateRenderer(),T};JXG$1.registerElement("line3d",JXG$1.createLine3D);JXG$1.Plane3D=function(u,n,d,C,I,f,y){this.constructor(u.board,y,Const.OBJECT_TYPE_PLANE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"plane3d"),this.board.finalizeAdding(this),this.point=n,this.direction1=d,this.direction2=I,this.range1=C||[-1/0,1/0],this.range2=f||[-1/0,1/0],this.vec1=[0,0,0],this.vec2=[0,0,0],this.grid=null,this.normal=[0,0,0],this.d=0,this.updateNormal(),this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Plane3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Plane3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Plane3D.prototype,{updateNormal:function(){var u,n;if(JXG$1.isFunction(this.direction1))this.vec1=JXG$1.evaluate(this.direction1);else for(u=0;u<3;u++)this.vec1[u]=JXG$1.evaluate(this.direction1[u]);if(JXG$1.isFunction(this.direction2))this.vec2=JXG$1.evaluate(this.direction2);else for(u=0;u<3;u++)this.vec2[u]=JXG$1.evaluate(this.direction2[u]);if(this.normal=Mat.crossProduct(this.vec1,this.vec2),n=Mat.norm(this.normal),Math.abs(n)>Mat.eps)for(u=0;u<3;u++)this.normal[u]/=n;return this.d=Mat.innerProduct(this.point.coords.slice(1),this.normal,3),this},updateDataArray:function(){var u,n,d,C,I,f,y,B=["xPlaneRear","yPlaneRear","zPlaneRear"],_=[],Z=[0,0,0],M=[0,0,0],V=[0,0,0],T=[0,0,0],H,F,O,$,U,ee,Q,ie,ne=this.view;if(this.dataX=[],this.dataY=[],this.updateNormal(),this.elType!=="axisplane3d"&&ne.defaultAxes&&JXG$1.evaluate(this.range1[0])===-1/0&&JXG$1.evaluate(this.range1[1])===1/0&&JXG$1.evaluate(this.range2[0])===-1/0&&JXG$1.evaluate(this.range2[1])===1/0){for(O=0;O<B.length;O++){if(T=ne.intersectionPlanePlane(this,ne.defaultAxes[B[O]]),T[0].length===3&&T[1].length===3){for(F=0;F<_.length&&!(Geometry.distance(T[0],_[F][0],3)<Mat.eps&&Geometry.distance(T[1],_[F][1],3)<Mat.eps||Geometry.distance(T[0],_[F][1],3)<Mat.eps&&Geometry.distance(T[1],_[F][0],3)<Mat.eps);F++);F===_.length&&_.push(T.slice())}if(T=[0,0,0],T[O]=ne.bbox3D[O][1],H=Mat.innerProduct(T,ne.defaultAxes[B[O]].normal,3),T=ne.intersectionPlanePlane(this,ne.defaultAxes[B[O]],H),T[0].length===3&&T[1].length===3){for(F=0;F<_.length&&!(Geometry.distance(T[0],_[F][0],3)<Mat.eps&&Geometry.distance(T[1],_[F][1],3)<Mat.eps||Geometry.distance(T[0],_[F][1],3)<Mat.eps&&Geometry.distance(T[1],_[F][0],3)<Mat.eps);F++);F===_.length&&_.push(T.slice())}}if(_.length===0)return{X:this.dataX,Y:this.dataY};ee=0,Q=ee,F=0;do{for(T=_[Q][F],T.length===3&&(I=ne.project3DTo2D(T),this.dataX.push(I[1]),this.dataY.push(I[2])),F=(F+1)%2,T=_[Q][F],ie=Q,O=0;O<_.length;O++){if(O!==Q&&Geometry.distance(T,_[O][0])<Mat.eps){Q=O,F=0;break}if(O!==Q&&Geometry.distance(T,_[O][1])<Mat.eps){Q=O,F=1;break}}if(Q===ie){console.log("Error: update plane3d: did not find next",Q);break}}while(Q!==ee);I=ne.project3DTo2D(_[ee][0]),this.dataX.push(I[1]),this.dataY.push(I[2])}else{for(u=JXG$1.evaluate(this.range1[0]),n=JXG$1.evaluate(this.range1[1]),d=JXG$1.evaluate(this.range2[0]),C=JXG$1.evaluate(this.range2[1]),V=this.point.coords.slice(1),Z=this.vec1.slice(),M=this.vec2.slice(),f=Mat.norm(Z,3),y=Mat.norm(M,3),F=0;F<3;F++)Z[F]/=f,M[F]/=y;for(O=0;O<4;O++){switch(O){case 0:$=u,U=d;break;case 1:$=n,U=d;break;case 2:$=n,U=C;break;case 3:$=u,U=C}for(F=0;F<3;F++)T[F]=V[F]+$*Z[F]+U*M[F];I=ne.project3DTo2D(T),this.dataX.push(I[1]),this.dataY.push(I[2])}this.dataX.push(this.dataX[0]),this.dataY.push(this.dataY[0])}return{X:this.dataX,Y:this.dataY}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPlane3D=function(u,n,d){var C=n[0],I,f,y=n[2],B=n[3],_=n[4]||[-1/0,1/0],Z=n[5]||[-1/0,1/0],M,V;return f=JXG$1.providePoints3D(C,[n[1]],d,"plane3d",["point"])[0],I=JXG$1.copyAttributes(d,u.options,"plane3d"),M=new JXG$1.Plane3D(C,f,y,_,B,Z,I),f.addChild(M),I=M.setAttr2D(I),M.element2D=C.create("curve",[[],[]],I),M.element2D.view=C,M.element2D.updateDataArray=function(){var T=M.updateDataArray();this.dataX=T.X,this.dataY=T.Y},M.addChild(M.element2D),M.inherits.push(M.element2D),M.element2D.setParents(M),I=JXG$1.copyAttributes(d.mesh3d,u.options,"mesh3d"),Math.abs(M.range1[0])!==1/0&&Math.abs(M.range1[1])!==1/0&&Math.abs(M.range2[0])!==1/0&&Math.abs(M.range2[1])!==1/0&&(V=C.create("mesh3d",[function(){return f.coords},y,_,B,Z],I),M.grid=V,M.addChild(V),M.inherits.push(V),V.setParents(M),M.grid.view=C),M.element2D.prepareUpdate().update(),u.isSuspendedUpdate||M.element2D.updateVisibility().updateRenderer(),M};JXG$1.registerElement("plane3d",JXG$1.createPlane3D);JXG$1.createIntersectionLine3D=function(u,n,d){var C=n[0],I=n[1],f=n[2],y,B,_,Z=JXG$1.copyAttributes(d,u.options,"intersectionline3d"),M=[];for(B=0;B<2;B++)_=Geometry.intersectionFunction3D(C,I,f,B),M[B]=C.create("point3d",_,Z["point"+(B+1)]);y=C.create("line3d",M,Z);try{I.addChild(y),f.addChild(y)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof n[0]+"' and '"+typeof n[1]+"'.")}return y.type=Const.OBJECT_TYPE_INTERSECTION_LINE3D,y.elType="intersectionline3d",y.setParents([I.id,f.id]),y};JXG$1.registerElement("intersectionline3d",JXG$1.createIntersectionLine3D);JXG$1.Text3D=function(u,n,d,C,I){this.constructor(u.board,I,Const.OBJECT_TYPE_TEXT3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"text3d"),this.board.finalizeAdding(this),u.visProp.depthorderpoints&&u.points.push(this),this.coords=[0,0,0,0],this.F=n,this.slide=C,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Text3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Text3D.prototype,{updateCoords:function(){var u;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,u=0;u<3;u++)JXG$1.isFunction(this.F[u])&&(this.coords[u+1]=JXG$1.evaluate(this.F[u]));return this},initCoords:function(){var u;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,u=0;u<3;u++)this.coords[u+1]=JXG$1.evaluate(this.F[u]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(u,n){var d=this.coords;return u.length===3?(d[0]=1,d[1]=u[0],d[2]=u[1],d[3]=u[2]):(d[0]=u[0],d[1]=u[1],d[2]=u[2],d[3]=u[2],this.normalizeCoords()),this},update:function(u){var n,d,C;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?n=this.view.project2DTo3DVertical(this.element2D,this.coords):(d=[1,0,0,this.coords[3]],n=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],d)),n[0]!==0&&(C=this.view.project3DToCube(n),this.coords=C[0],C[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()].slice(1))),this.element2D.prepareUpdate().update()),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},__evt__update3D:function(u){}});JXG$1.createText3D=function(u,n,d){var C=n[0],I,f,y,B,_,Z;if(n.length>3&&JXG$1.exists(n[n.length-1].is3D)?y=n.pop():y=null,n.length===3)f=n[1],B=n[2];else if(n.length===5)f=n.slice(1,4),B=n[4];else throw new Error("JSXGraph: Can't create text3d with parent types '"+typeof n[0]+"' and '"+typeof n[1]+`'.
Possible parent types: [[x,y,z], text], [x,y,z, text]`);return I=JXG$1.copyAttributes(d,u.options,"text3d"),Z=new JXG$1.Text3D(C,f,B,y,I),Z.initCoords(),_=C.project3DTo2D(Z.coords),I=Z.setAttr2D(I),Z.element2D=C.create("text",[_[1],_[2],B],I),Z.element2D.view=C,Z.addChild(Z.element2D),Z.inherits.push(Z.element2D),Z.element2D.setParents(Z),Z.slide&&(Z.slide.addChild(Z),Z.setParents(Z.slide)),Z._c2d=Z.element2D.coords.usrCoords.slice(),Z};JXG$1.registerElement("text3d",JXG$1.createText3D);JXG$1.createTicks3D=function(u,n,d){var C=n[0],I=n[1],f=n[2],y=n[3],B=n[4],_,Z;return Z=JXG$1.copyAttributes(d,u.options,"ticks3d"),_=C.create("curve",[[],[]],Z),_.point=I,_.direction1=f,_.len=y,_.direction2=B,_.drawLabels=function(M){var V=0,T=this.len,H=JXG$1.evaluate(this.visProp.ticksdistance),F=JXG$1.evaluate(this.visProp.tickendings),O=JXG$1.evaluate(this.visProp.majorheight),$,U,ee,Q,ie,ne,le,ae=[0,0,0],ce=[0,0,0],ge=[0,0,0],he=[];if(O/=Math.sqrt(u.unitX*u.unitY),$=O*F[1]*2,this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ge=this.point().slice(1);else for(Q=0;Q<3;Q++)ge[Q]=JXG$1.evaluate(this.point[Q]);for(Q=0;Q<3;Q++)ae[Q]=JXG$1.evaluate(this.direction1[Q]),ce[Q]=JXG$1.evaluate(this.direction2[Q]);for(U=JXG$1.Math.norm(ae,3),ee=JXG$1.Math.norm(ce,3),Q=0;Q<3;Q++)ae[Q]/=U,ce[Q]/=ee;if(!(Math.abs(H)<Mat.eps)){for(ie=V;ie<=T;ie+=H){for(le=[ge[0]+ie*ae[0]+$*ce[0],ge[1]+ie*ae[1]+$*ce[1],ge[2]+ie*ae[2]+$*ce[2]],Q=0;Q<3;Q++)ae[Q]!==0&&(ne=ge[Q]+ie*ae[Q]);he.push(C.create("text3d",[le,ne],M))}return he}},JXG$1.evaluate(_.visProp.drawlabels)&&(_.labels=_.drawLabels(Z.label)),_.updateDataArray=function(){var M=0,V=this.len,T=JXG$1.evaluate(this.visProp.ticksdistance),H=JXG$1.evaluate(this.visProp.tickendings),F=JXG$1.evaluate(this.visProp.majorheight),O,$,U,ee,Q,ie,ne,le,ae=[0,0,0],ce=[0,0,0],ge=[0,0,0];if(F/=Math.sqrt(u.unitX*u.unitY),O=F*-H[0],$=F*H[1],this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ge=this.point().slice(1);else for(Q=0;Q<3;Q++)ge[Q]=JXG$1.evaluate(this.point[Q]);for(Q=0;Q<3;Q++)ae[Q]=JXG$1.evaluate(this.direction1[Q]),ce[Q]=JXG$1.evaluate(this.direction2[Q]);for(U=JXG$1.Math.norm(ae,3),ee=JXG$1.Math.norm(ce,3),Q=0;Q<3;Q++)ae[Q]/=U,ce[Q]/=ee;if(!(Math.abs(T)<Mat.eps))for(ie=M;ie<=V;ie+=T)le=[ge[0]+ie*ae[0]+O*ce[0],ge[1]+ie*ae[1]+O*ce[1],ge[2]+ie*ae[2]+O*ce[2]],ne=C.project3DTo2D(le),this.dataX.push(ne[1]),this.dataY.push(ne[2]),le=[ge[0]+ie*ae[0]+$*ce[0],ge[1]+ie*ae[1]+$*ce[1],ge[2]+ie*ae[2]+$*ce[2]],ne=C.project3DTo2D(le),this.dataX.push(ne[1]),this.dataY.push(ne[2]),this.dataX.push(NaN),this.dataY.push(NaN)},_};JXG$1.registerElement("ticks3d",JXG$1.createTicks3D);JXG$1.Polygon3D=function(u,n,d){var C;for(this.constructor(u.board,d,Const.OBJECT_TYPE_POLYGON3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"polygon3d"),this.board.finalizeAdding(this),this.vertices=[],C=0;C<n.length;C++)this.vertices[C]=this.board.select(n[C]),this.vertices[C]._is_new&&(delete this.vertices[C]._is_new,this.vertices[C]._is_new_pol=!0)};JXG$1.Polygon3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Polygon3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Polygon3D.prototype,{update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPolygon3D=function(u,n,d){var C=n[0],I,f,y,B,_=[],Z=[],M,V,T=!1;if(M=JXG$1.copyAttributes(d,u.options,"polygon3d"),B=u.select(n[1]),B===null&&(B=n[1]),JXG$1.isObject(B)&&B.type===Const.OBJECT_TYPE_POLYGON3D&&JXG$1.isTransformationOrArray(n[2]))for(T=!0,y=B.vertices.length-1,V=JXG$1.copyAttributes(d,u.options,"polygon3d","vertices"),f=0;f<y;f++)V.withlabel&&(V.name=B.vertices[f].name===""?"":B.vertices[f].name+"'"),_.push(u.create("point3d",[B.vertices[f],n[2]],V));else if(_=JXG$1.providePoints3D(C,n.slice(1),d,"polygon3d",["vertices"]),_===!1)throw new Error("JSXGraph: Can't create polygon3d with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon3d and a transformation can be supplied");for(I=new JXG$1.Polygon3D(C,_,M),I.isDraggable=!0,M=I.setAttr2D(M),f=0;f<_.length;f++)Z.push(_[f].element2D);if(I.element2D=u.create("polygon",Z,M),I.element2D.view=C,I.addChild(I.element2D),I.inherits.push(I.element2D),I.element2D.setParents(I),T)for(I.prepareUpdate().update().updateVisibility().updateRenderer(),y=B.vertices.length-1,f=0;f<y;f++)_[f].prepareUpdate().update().updateVisibility().updateRenderer();return I};JXG$1.registerElement("polygon3d",JXG$1.createPolygon3D);JXG$1.Sphere3D=function(u,n,d,C,I){this.constructor(u.board,I,Const.OBJECT_TYPE_SPHERE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"sphere3d"),this.board.finalizeAdding(this),this.method=n,this.center=this.board.select(d),this.point2=null,this.points=[],this.element2D=null,this.aux2D=[],this.projectionType=u.projectionType,n==="twoPoints"?(this.point2=this.board.select(C),this.radius=this.Radius()):n==="pointRadius"&&(this.updateRadius=JXG$1.createFunction(C,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),n==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{center:"center",point2:"point2",Radius:"Radius"})};JXG$1.Sphere3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Sphere3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Sphere3D.prototype,{update:function(){return this.projectionType!==this.view.projectionType&&this.rebuildProjection(),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(u){return this.updateRadius=JXG$1.createFunction(u,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(u){return JXG$1.exists(u)?(this.setRadius(u),this.Radius()):this.method==="twoPoints"?this.center.isIllDefined()||this.point2.isIllDefined()?NaN:this.center.distance(this.point2):this.method==="pointRadius"?Math.abs(this.updateRadius()):NaN},focusFn:function(u){var n=this;return function(){var d=n.view.boxToCam[3],C=n.Radius();return n.view.project3DTo2D([n.center.X()+u*C*d[1],n.center.Y()+u*C*d[2],n.center.Z()+u*C*d[3]]).slice(1,3)}},innerVertexFn:function(){var u=this;return function(){var n=u.view,d=n.worldToFocal(u.center.coords,!1),C=Mat.hypot(d[0],d[1]),I=n.boxToCam,f=[-(d[0]*I[1][1]+d[1]*I[2][1])/C,-(d[0]*I[1][2]+d[1]*I[2][2])/C,-(d[0]*I[1][3]+d[1]*I[2][3])/C],y=u.Radius(),B=Math.atan(-C/d[2]),_=Math.acos(y/Mat.norm(d)),Z=B+_,M=Math.cos(Z),V=Math.sin(Z);return n.project3DTo2D([u.center.X()+y*(V*f[0]+M*I[3][1]),u.center.Y()+y*(V*f[1]+M*I[3][2]),u.center.Z()+y*(V*f[2]+M*I[3][3])])}},buildCentralProjection:function(){var u=this.view,n={visible:!1,withLabel:!1},d=u.create("point",this.focusFn(-1),n),C=u.create("point",this.focusFn(1),n),I=u.create("point",this.innerVertexFn(u),n);this.aux2D=[d,C,I],this.element2D=u.create("ellipse",this.aux2D,this.visProp)},buildParallelProjection:function(){var u=this,n=function(){var C=[1,u.center.X(),u.center.Y(),u.center.Z()];return u.view.project3DTo2D(C)},d=function(){var C=u.view.bbox3D[0][1]-u.view.bbox3D[0][0];return u.Radius()*u.view.size[0]/C};this.aux2D=[],this.element2D=this.view.create("circle",[n,d],this.visProp)},rebuildProjection:function(){var u;if(this.element2D){this.view.board.removeObject(this.element2D);for(u in this.aux2D)this.aux2D.hasOwnProperty(u)&&this.view.board.removeObject(this.aux2D[u])}this.projectionType=this.view.projectionType,this.projectionType==="central"?this.buildCentralProjection():this.buildParallelProjection(),this.addChild(this.element2D),this.inherits.push(this.element2D),this.element2D.view=this.view}});JXG$1.createSphere3D=function(u,n,d){var C=n[0],I,f,y,B,_,Z;for(I=JXG$1.copyAttributes(d,u.options,"sphere3d"),f=[],Z=1;Z<n.length;Z++)if(JXG$1.isPointType3D(u,n[Z])){if(f.length===0?y="center":y="point",B=JXG$1.providePoints3D(C,[n[Z]],d,"sphere3d",[y])[0],B===!1)throw new Error("JSXGraph: Can't create sphere3d from this type. Please provide a point type.");f.push(B)}else f.push(n[Z]);if(JXG$1.isPoint3D(f[0])&&JXG$1.isPoint3D(f[1]))_=new JXG$1.Sphere3D(C,"twoPoints",f[0],f[1],I);else if((JXG$1.isNumber(f[0])||JXG$1.isFunction(f[0])||JXG$1.isString(f[0]))&&JXG$1.isPoint3D(f[1]))_=new JXG$1.Sphere3D(C,"pointRadius",f[1],f[0],I);else if((JXG$1.isNumber(f[1])||JXG$1.isFunction(f[1])||JXG$1.isString(f[1]))&&JXG$1.isPoint3D(f[0]))_=new JXG$1.Sphere3D(C,"pointRadius",f[0],f[1],I);else throw new Error("JSXGraph: Can't create sphere3d with parent types '"+typeof n[1]+"' and '"+typeof n[2]+`'.
Possible parent types: [point,point], [point,number], [point,function]`);return _.rebuildProjection(),_.element2D.prepareUpdate().update().updateRenderer(),_};JXG$1.registerElement("sphere3d",JXG$1.createSphere3D);JXG$1.Surface3D=function(u,n,d,C,I,f,y,B){this.constructor(u.board,B,Const.OBJECT_TYPE_SURFACE3D,Const.OBJECT_CLASS_3D),this.constructor3D(u,"surface3d"),this.board.finalizeAdding(this),this.F=n,this.X=d,this.Y=C,this.Z=I,this.F!==null&&(this.X=function(_,Z){return this.F(_,Z)[0]},this.Y=function(_,Z){return this.F(_,Z)[1]},this.Z=function(_,Z){return this.F(_,Z)[2]}),this.range_u=f,this.range_v=y,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Surface3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Surface3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Surface3D.prototype,{updateDataArray:function(){var u=JXG$1.evaluate(this.visProp.stepsu),n=JXG$1.evaluate(this.visProp.stepsv),d=JXG$1.evaluate(this.range_u),C=JXG$1.evaluate(this.range_v),I,f;return this.F!==null?I=this.F:I=[this.X,this.Y,this.Z],d.push(u),C.push(n),f=this.view.getMesh(I,d,C),{X:f[0],Y:f[1]}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(u){u.length===0&&u.unshift(.5*(this.range_u[0]+this.range_u[1]),.5*(this.range_v[0]+this.range_v[1]))},projectCoords:function(u,n){return this.initParamsIfNeeded(n),Geometry.projectCoordsToParametric(u,this,n)},projectScreenCoords:function(u,n){return this.initParamsIfNeeded(n),Geometry.projectScreenCoordsToParametric(u,this,n)}});JXG$1.createParametricSurface3D=function(u,n,d){var C=n[0],I,f,y,B,_,Z,M,V;return n.length===4?(I=n[1],_=n[2],Z=n[3],f=null,y=null,B=null):(f=n[1],y=n[2],B=n[3],_=n[4],Z=n[5],I=null),M=JXG$1.copyAttributes(d,u.options,"surface3d"),V=new JXG$1.Surface3D(C,I,f,y,B,_,Z,M),M=V.setAttr2D(M),V.element2D=C.create("curve",[[],[]],M),V.element2D.view=C,V.element2D.updateDataArray=function(){var T=V.updateDataArray();this.dataX=T.X,this.dataY=T.Y},V.addChild(V.element2D),V.inherits.push(V.element2D),V.element2D.setParents(V),V.element2D.prepareUpdate().update(),u.isSuspendedUpdate||V.element2D.updateVisibility().updateRenderer(),V};JXG$1.registerElement("parametricsurface3d",JXG$1.createParametricSurface3D);JXG$1.createFunctiongraph3D=function(u,n,d){var C=n[0],I=function(Z,M){return Z},f=function(Z,M){return M},y=JXG$1.createFunction(n[1],u,"x, y"),B=n[2],_=n[3];return C.create("parametricsurface3d",[I,f,y,B,_],d)};JXG$1.registerElement("functiongraph3d",JXG$1.createFunctiongraph3D);let size=.75,color="#000";JXG$1.themes.mono_thin={board:{showInfobox:!1,showCopyright:!0,defaultAxes:{x:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[1,0]}},y:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[0,1]}}}},navbar:{strokeColor:"#bbb",fillColor:"none"},elements:{strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none",strokeOpacity:.6,highlightStrokeOpacity:1},angle:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3,label:{strokeColor:color}},arc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},axis:{},boxplot:{strokeWidth:size,strokeColor:color,fillColor:color,fillOpacity:.2,highlightStrokeWidth:size,highlightStrokeColor:color,highlightFillColor:color,highlightFillOpacity:.1},circle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcirclearc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},circumcirclesector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},comb:{strokeColor:color,strokeWidth:size},conic:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none"},curve:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},grid:{strokeWidth:size},hatch:{strokeColor:color,strokeWidth:size},incircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},inequality:{fillColor:"#aaaaaa55",fillOpacity:.2},integral:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaa33",fillOpacity:.3,highlightFillOpacity:.3,curveLeft:{color},baseLeft:{color},curveRight:{color},baseRight:{color}},label:{strokeColor:color},line:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},normal:{strokeColor:color},parallel:{strokeColor:color},perpendicular:{strokeColor:color},perpendicularsegment:{strokeColor:color},point:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},polygon:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaaa33",fillOpacity:.3,highlightFillOpacity:.3,vertices:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},borders:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size}},sector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},semicircle:{center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},slider:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color,baseline:{strokeWidth:size,strokeColor:color,highlightStrokeColor:color},label:{strokeColor:color},highline:{strokeWidth:3*size,name:"",strokeColor:color,highlightStrokeColor:color},ticks:{strokeColor:color}},slopefield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8},tapemeasure:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},ticks:{strokeWidth:size}},text:{strokeColor:color},tracecurve:{strokeColor:color},turtle:{strokeWidth:size,strokeColor:color,arrow:{strokeWidth:2*size,strokeColor:"#aaaaaa55"}},vectorfield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8}};JXG$1.COORDS_BY_SCREEN;JXG$1.COORDS_BY_USER;JXG$1.Dump;JXG$1.Expect;JXG$1.JSXGraph;JXG$1.Math;JXG$1.Options;JXG$1.boards;JXG$1.elements;JXG$1.palette;JXG$1.paletteWong;JXG$1.Board;JXG$1.Chart;JXG$1.Circle;JXG$1.Complex;JXG$1.Composition;JXG$1.Coords;JXG$1.CoordsElement;JXG$1.Curve;JXG$1.GeometryElement;JXG$1.Group;JXG$1.Image;JXG$1.JessieCode;JXG$1.PrefixParser;JXG$1.Line;JXG$1.Point;JXG$1.Polygon;JXG$1.Text;JXG$1.Ticks;JXG$1.Transformation;JXG$1.Turtle;JXG$1.View3D;JXG$1.LMS2rgb;JXG$1.addEvent;JXG$1.autoDigits;JXG$1.autoHighlight;JXG$1.bind;JXG$1.capitalize;JXG$1.clearVisPropOld;JXG$1.clone;JXG$1.cloneAndCopy;JXG$1.cmpArrays;JXG$1.coordsArrayToMatrix;JXG$1.copyAttributes;JXG$1.createEvalFunction;JXG$1.createFunction;JXG$1.createHTMLSlider;JXG$1.darkenColor;JXG$1.debug;JXG$1.debugInt;JXG$1.debugLine;JXG$1.debugWST;JXG$1.deepCopy;JXG$1.def;JXG$1.deprecated;JXG$1.eliminateDuplicates;JXG$1.escapeHTML;JXG$1.evalSlider;JXG$1.evaluate;JXG$1.filterElements;JXG$1.getBoardByContainerId;JXG$1.getCSSTransformMatrix;JXG$1.getCSSTransform;JXG$1.getDimensions;JXG$1.getOffset;JXG$1.getPosition;JXG$1.getProp;JXG$1.hex2rgb;JXG$1.hsv2rgb;JXG$1.isAndroid;JXG$1.isApple;JXG$1.isArray;JXG$1.isDesktop;JXG$1.isInArray;JXG$1.isInObject;JXG$1.isMetroApp;JXG$1.isMobile;JXG$1.isMozilla;JXG$1.isBoard;JXG$1.isName;JXG$1.isNode;JXG$1.isNumber;JXG$1.isObject;JXG$1.isPoint;JXG$1.isPoint3D;JXG$1.isPointType;JXG$1.isPointType3D;JXG$1.isString;JXG$1.isTouchDevice;JXG$1.isTransformationOrArray;JXG$1.isWebWorker;JXG$1.isWebkitAndroid;JXG$1.isWebkitApple;JXG$1.keys;JXG$1.lightenColor;JXG$1.merge;JXG$1.normalizePointFace;JXG$1.providePoints;JXG$1.registerElement;JXG$1.registerReader;JXG$1.removeAllEvents;JXG$1.removeElementFromArray;JXG$1.removeEvent;JXG$1.rgb2LMS;JXG$1.rgb2bw;JXG$1.rgb2cb;JXG$1.rgb2css;JXG$1.rgb2hex;JXG$1.rgb2hsv;JXG$1.rgbParser;JXG$1.rgba2rgbo;JXG$1.rgbo2rgba;JXG$1.sanitizeHTML;JXG$1.shortcut;JXG$1.str2Bool;JXG$1.supportsCanvas;JXG$1.supportsPointerEvents;JXG$1.supportsSVG;JXG$1.supportsVML;JXG$1.swap;JXG$1.timedChunk;JXG$1.toFixed;JXG$1.toFullscreen;JXG$1.toJSON;JXG$1.trim;JXG$1.trimNumber;JXG$1.truncate;JXG$1.unescapeHTML;JXG$1.uniqueArray;JXG$1.useBlackWhiteOptions;JXG$1.useStandardOptions;JXG$1.warn;JXG$1.isBrowser?window.JXG=JXG$1:JXG$1.isWebWorker()&&(self.JXG=JXG$1);var cjs={exports:{}},Draggable$1={};function r(u){var n,d,C="";if(typeof u=="string"||typeof u=="number")C+=u;else if(typeof u=="object")if(Array.isArray(u))for(n=0;n<u.length;n++)u[n]&&(d=r(u[n]))&&(C&&(C+=" "),C+=d);else for(n in u)u[n]&&(C&&(C+=" "),C+=n);return C}function clsx(){for(var u,n,d=0,C="";d<arguments.length;)(u=arguments[d++])&&(n=r(u))&&(C&&(C+=" "),C+=n);return C}const clsx_m=Object.freeze(Object.defineProperty({__proto__:null,clsx,default:clsx},Symbol.toStringTag,{value:"Module"})),require$$3=getAugmentedNamespace(clsx_m);var domFns={},shims={},hasRequiredShims;function requireShims(){if(hasRequiredShims)return shims;hasRequiredShims=1,Object.defineProperty(shims,"__esModule",{value:!0}),shims.dontSetMe=I,shims.findInArray=u,shims.int=C,shims.isFunction=n,shims.isNum=d;function u(f,y){for(let B=0,_=f.length;B<_;B++)if(y.apply(y,[f[B],B,f]))return f[B]}function n(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Function]"}function d(f){return typeof f=="number"&&!isNaN(f)}function C(f){return parseInt(f,10)}function I(f,y,B){if(f[y])return new Error("Invalid prop ".concat(y," passed to ").concat(B," - do not set this, set it on the child."))}return shims}var getPrefix={},hasRequiredGetPrefix;function requireGetPrefix(){if(hasRequiredGetPrefix)return getPrefix;hasRequiredGetPrefix=1,Object.defineProperty(getPrefix,"__esModule",{value:!0}),getPrefix.browserPrefixToKey=d,getPrefix.browserPrefixToStyle=C,getPrefix.default=void 0,getPrefix.getPrefix=n;const u=["Moz","Webkit","O","ms"];function n(){var f;let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const B=(f=window.document)===null||f===void 0||(f=f.documentElement)===null||f===void 0?void 0:f.style;if(!B||y in B)return"";for(let _=0;_<u.length;_++)if(d(y,u[_])in B)return u[_];return""}function d(f,y){return y?"".concat(y).concat(I(f)):f}function C(f,y){return y?"-".concat(y.toLowerCase(),"-").concat(f):f}function I(f){let y="",B=!0;for(let _=0;_<f.length;_++)B?(y+=f[_].toUpperCase(),B=!1):f[_]==="-"?B=!0:y+=f[_];return y}return getPrefix.default=n(),getPrefix}var hasRequiredDomFns;function requireDomFns(){if(hasRequiredDomFns)return domFns;hasRequiredDomFns=1,Object.defineProperty(domFns,"__esModule",{value:!0}),domFns.addClassName=ne,domFns.addEvent=B,domFns.addUserSelectStyles=Q,domFns.createCSSTransform=F,domFns.createSVGTransform=O,domFns.getTouch=U,domFns.getTouchIdentifier=ee,domFns.getTranslation=$,domFns.innerHeight=V,domFns.innerWidth=T,domFns.matchesSelector=f,domFns.matchesSelectorAndParentsTo=y,domFns.offsetXYFromParent=H,domFns.outerHeight=Z,domFns.outerWidth=M,domFns.removeClassName=le,domFns.removeEvent=_,domFns.removeUserSelectStyles=ie;var u=requireShims(),n=C(requireGetPrefix());function d(ae){if(typeof WeakMap!="function")return null;var ce=new WeakMap,ge=new WeakMap;return(d=function(he){return he?ge:ce})(ae)}function C(ae,ce){if(ae&&ae.__esModule)return ae;if(ae===null||typeof ae!="object"&&typeof ae!="function")return{default:ae};var ge=d(ce);if(ge&&ge.has(ae))return ge.get(ae);var he={},Ie=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var fe in ae)if(fe!=="default"&&Object.prototype.hasOwnProperty.call(ae,fe)){var me=Ie?Object.getOwnPropertyDescriptor(ae,fe):null;me&&(me.get||me.set)?Object.defineProperty(he,fe,me):he[fe]=ae[fe]}return he.default=ae,ge&&ge.set(ae,he),he}let I="";function f(ae,ce){return I||(I=(0,u.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(ge){return(0,u.isFunction)(ae[ge])})),(0,u.isFunction)(ae[I])?ae[I](ce):!1}function y(ae,ce,ge){let he=ae;do{if(f(he,ce))return!0;if(he===ge)return!1;he=he.parentNode}while(he);return!1}function B(ae,ce,ge,he){if(!ae)return;const Ie={capture:!0,...he};ae.addEventListener?ae.addEventListener(ce,ge,Ie):ae.attachEvent?ae.attachEvent("on"+ce,ge):ae["on"+ce]=ge}function _(ae,ce,ge,he){if(!ae)return;const Ie={capture:!0,...he};ae.removeEventListener?ae.removeEventListener(ce,ge,Ie):ae.detachEvent?ae.detachEvent("on"+ce,ge):ae["on"+ce]=null}function Z(ae){let ce=ae.clientHeight;const ge=ae.ownerDocument.defaultView.getComputedStyle(ae);return ce+=(0,u.int)(ge.borderTopWidth),ce+=(0,u.int)(ge.borderBottomWidth),ce}function M(ae){let ce=ae.clientWidth;const ge=ae.ownerDocument.defaultView.getComputedStyle(ae);return ce+=(0,u.int)(ge.borderLeftWidth),ce+=(0,u.int)(ge.borderRightWidth),ce}function V(ae){let ce=ae.clientHeight;const ge=ae.ownerDocument.defaultView.getComputedStyle(ae);return ce-=(0,u.int)(ge.paddingTop),ce-=(0,u.int)(ge.paddingBottom),ce}function T(ae){let ce=ae.clientWidth;const ge=ae.ownerDocument.defaultView.getComputedStyle(ae);return ce-=(0,u.int)(ge.paddingLeft),ce-=(0,u.int)(ge.paddingRight),ce}function H(ae,ce,ge){const Ie=ce===ce.ownerDocument.body?{left:0,top:0}:ce.getBoundingClientRect(),fe=(ae.clientX+ce.scrollLeft-Ie.left)/ge,me=(ae.clientY+ce.scrollTop-Ie.top)/ge;return{x:fe,y:me}}function F(ae,ce){const ge=$(ae,ce,"px");return{[(0,n.browserPrefixToKey)("transform",n.default)]:ge}}function O(ae,ce){return $(ae,ce,"")}function $(ae,ce,ge){let{x:he,y:Ie}=ae,fe="translate(".concat(he).concat(ge,",").concat(Ie).concat(ge,")");if(ce){const me="".concat(typeof ce.x=="string"?ce.x:ce.x+ge),Ge="".concat(typeof ce.y=="string"?ce.y:ce.y+ge);fe="translate(".concat(me,", ").concat(Ge,")")+fe}return fe}function U(ae,ce){return ae.targetTouches&&(0,u.findInArray)(ae.targetTouches,ge=>ce===ge.identifier)||ae.changedTouches&&(0,u.findInArray)(ae.changedTouches,ge=>ce===ge.identifier)}function ee(ae){if(ae.targetTouches&&ae.targetTouches[0])return ae.targetTouches[0].identifier;if(ae.changedTouches&&ae.changedTouches[0])return ae.changedTouches[0].identifier}function Q(ae){if(!ae)return;let ce=ae.getElementById("react-draggable-style-el");ce||(ce=ae.createElement("style"),ce.type="text/css",ce.id="react-draggable-style-el",ce.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,ce.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,ae.getElementsByTagName("head")[0].appendChild(ce)),ae.body&&ne(ae.body,"react-draggable-transparent-selection")}function ie(ae){if(ae)try{if(ae.body&&le(ae.body,"react-draggable-transparent-selection"),ae.selection)ae.selection.empty();else{const ce=(ae.defaultView||window).getSelection();ce&&ce.type!=="Caret"&&ce.removeAllRanges()}}catch{}}function ne(ae,ce){ae.classList?ae.classList.add(ce):ae.className.match(new RegExp("(?:^|\\s)".concat(ce,"(?!\\S)")))||(ae.className+=" ".concat(ce))}function le(ae,ce){ae.classList?ae.classList.remove(ce):ae.className=ae.className.replace(new RegExp("(?:^|\\s)".concat(ce,"(?!\\S)"),"g"),"")}return domFns}var positionFns={},hasRequiredPositionFns;function requirePositionFns(){if(hasRequiredPositionFns)return positionFns;hasRequiredPositionFns=1,Object.defineProperty(positionFns,"__esModule",{value:!0}),positionFns.canDragX=I,positionFns.canDragY=f,positionFns.createCoreData=B,positionFns.createDraggableData=_,positionFns.getBoundPosition=d,positionFns.getControlPosition=y,positionFns.snapToGrid=C;var u=requireShims(),n=requireDomFns();function d(V,T,H){if(!V.props.bounds)return[T,H];let{bounds:F}=V.props;F=typeof F=="string"?F:Z(F);const O=M(V);if(typeof F=="string"){const{ownerDocument:$}=O,U=$.defaultView;let ee;if(F==="parent"?ee=O.parentNode:ee=$.querySelector(F),!(ee instanceof U.HTMLElement))throw new Error('Bounds selector "'+F+'" could not find an element.');const Q=ee,ie=U.getComputedStyle(O),ne=U.getComputedStyle(Q);F={left:-O.offsetLeft+(0,u.int)(ne.paddingLeft)+(0,u.int)(ie.marginLeft),top:-O.offsetTop+(0,u.int)(ne.paddingTop)+(0,u.int)(ie.marginTop),right:(0,n.innerWidth)(Q)-(0,n.outerWidth)(O)-O.offsetLeft+(0,u.int)(ne.paddingRight)-(0,u.int)(ie.marginRight),bottom:(0,n.innerHeight)(Q)-(0,n.outerHeight)(O)-O.offsetTop+(0,u.int)(ne.paddingBottom)-(0,u.int)(ie.marginBottom)}}return(0,u.isNum)(F.right)&&(T=Math.min(T,F.right)),(0,u.isNum)(F.bottom)&&(H=Math.min(H,F.bottom)),(0,u.isNum)(F.left)&&(T=Math.max(T,F.left)),(0,u.isNum)(F.top)&&(H=Math.max(H,F.top)),[T,H]}function C(V,T,H){const F=Math.round(T/V[0])*V[0],O=Math.round(H/V[1])*V[1];return[F,O]}function I(V){return V.props.axis==="both"||V.props.axis==="x"}function f(V){return V.props.axis==="both"||V.props.axis==="y"}function y(V,T,H){const F=typeof T=="number"?(0,n.getTouch)(V,T):null;if(typeof T=="number"&&!F)return null;const O=M(H),$=H.props.offsetParent||O.offsetParent||O.ownerDocument.body;return(0,n.offsetXYFromParent)(F||V,$,H.props.scale)}function B(V,T,H){const F=!(0,u.isNum)(V.lastX),O=M(V);return F?{node:O,deltaX:0,deltaY:0,lastX:T,lastY:H,x:T,y:H}:{node:O,deltaX:T-V.lastX,deltaY:H-V.lastY,lastX:V.lastX,lastY:V.lastY,x:T,y:H}}function _(V,T){const H=V.props.scale;return{node:T.node,x:V.state.x+T.deltaX/H,y:V.state.y+T.deltaY/H,deltaX:T.deltaX/H,deltaY:T.deltaY/H,lastX:V.state.x,lastY:V.state.y}}function Z(V){return{left:V.left,top:V.top,right:V.right,bottom:V.bottom}}function M(V){const T=V.findDOMNode();if(!T)throw new Error("<DraggableCore>: Unmounted during event!");return T}return positionFns}var DraggableCore={},log={},hasRequiredLog;function requireLog(){if(hasRequiredLog)return log;hasRequiredLog=1,Object.defineProperty(log,"__esModule",{value:!0}),log.default=u;function u(){}return log}var hasRequiredDraggableCore;function requireDraggableCore(){if(hasRequiredDraggableCore)return DraggableCore;hasRequiredDraggableCore=1,Object.defineProperty(DraggableCore,"__esModule",{value:!0}),DraggableCore.default=void 0;var u=Z(requireReact()),n=B(requirePropTypes()),d=B(requireReactDom()),C=requireDomFns(),I=requirePositionFns(),f=requireShims(),y=B(requireLog());function B($){return $&&$.__esModule?$:{default:$}}function _($){if(typeof WeakMap!="function")return null;var U=new WeakMap,ee=new WeakMap;return(_=function(Q){return Q?ee:U})($)}function Z($,U){if($&&$.__esModule)return $;if($===null||typeof $!="object"&&typeof $!="function")return{default:$};var ee=_(U);if(ee&&ee.has($))return ee.get($);var Q={},ie=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ne in $)if(ne!=="default"&&Object.prototype.hasOwnProperty.call($,ne)){var le=ie?Object.getOwnPropertyDescriptor($,ne):null;le&&(le.get||le.set)?Object.defineProperty(Q,ne,le):Q[ne]=$[ne]}return Q.default=$,ee&&ee.set($,Q),Q}function M($,U,ee){return U=V(U),U in $?Object.defineProperty($,U,{value:ee,enumerable:!0,configurable:!0,writable:!0}):$[U]=ee,$}function V($){var U=T($,"string");return typeof U=="symbol"?U:String(U)}function T($,U){if(typeof $!="object"||$===null)return $;var ee=$[Symbol.toPrimitive];if(ee!==void 0){var Q=ee.call($,U);if(typeof Q!="object")return Q;throw new TypeError("@@toPrimitive must return a primitive value.")}return(U==="string"?String:Number)($)}const H={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let F=H.mouse,O=class extends u.Component{constructor(){super(...arguments),M(this,"dragging",!1),M(this,"lastX",NaN),M(this,"lastY",NaN),M(this,"touchIdentifier",null),M(this,"mounted",!1),M(this,"handleDragStart",U=>{if(this.props.onMouseDown(U),!this.props.allowAnyClick&&typeof U.button=="number"&&U.button!==0)return!1;const ee=this.findDOMNode();if(!ee||!ee.ownerDocument||!ee.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:Q}=ee;if(this.props.disabled||!(U.target instanceof Q.defaultView.Node)||this.props.handle&&!(0,C.matchesSelectorAndParentsTo)(U.target,this.props.handle,ee)||this.props.cancel&&(0,C.matchesSelectorAndParentsTo)(U.target,this.props.cancel,ee))return;U.type==="touchstart"&&U.preventDefault();const ie=(0,C.getTouchIdentifier)(U);this.touchIdentifier=ie;const ne=(0,I.getControlPosition)(U,ie,this);if(ne==null)return;const{x:le,y:ae}=ne,ce=(0,I.createCoreData)(this,le,ae);(0,y.default)("DraggableCore: handleDragStart: %j",ce),(0,y.default)("calling",this.props.onStart),!(this.props.onStart(U,ce)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,C.addUserSelectStyles)(Q),this.dragging=!0,this.lastX=le,this.lastY=ae,(0,C.addEvent)(Q,F.move,this.handleDrag),(0,C.addEvent)(Q,F.stop,this.handleDragStop))}),M(this,"handleDrag",U=>{const ee=(0,I.getControlPosition)(U,this.touchIdentifier,this);if(ee==null)return;let{x:Q,y:ie}=ee;if(Array.isArray(this.props.grid)){let ae=Q-this.lastX,ce=ie-this.lastY;if([ae,ce]=(0,I.snapToGrid)(this.props.grid,ae,ce),!ae&&!ce)return;Q=this.lastX+ae,ie=this.lastY+ce}const ne=(0,I.createCoreData)(this,Q,ie);if((0,y.default)("DraggableCore: handleDrag: %j",ne),this.props.onDrag(U,ne)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const ce=document.createEvent("MouseEvents");ce.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(ce)}return}this.lastX=Q,this.lastY=ie}),M(this,"handleDragStop",U=>{if(!this.dragging)return;const ee=(0,I.getControlPosition)(U,this.touchIdentifier,this);if(ee==null)return;let{x:Q,y:ie}=ee;if(Array.isArray(this.props.grid)){let ce=Q-this.lastX||0,ge=ie-this.lastY||0;[ce,ge]=(0,I.snapToGrid)(this.props.grid,ce,ge),Q=this.lastX+ce,ie=this.lastY+ge}const ne=(0,I.createCoreData)(this,Q,ie);if(this.props.onStop(U,ne)===!1||this.mounted===!1)return!1;const ae=this.findDOMNode();ae&&this.props.enableUserSelectHack&&(0,C.removeUserSelectStyles)(ae.ownerDocument),(0,y.default)("DraggableCore: handleDragStop: %j",ne),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,ae&&((0,y.default)("DraggableCore: Removing handlers"),(0,C.removeEvent)(ae.ownerDocument,F.move,this.handleDrag),(0,C.removeEvent)(ae.ownerDocument,F.stop,this.handleDragStop))}),M(this,"onMouseDown",U=>(F=H.mouse,this.handleDragStart(U))),M(this,"onMouseUp",U=>(F=H.mouse,this.handleDragStop(U))),M(this,"onTouchStart",U=>(F=H.touch,this.handleDragStart(U))),M(this,"onTouchEnd",U=>(F=H.touch,this.handleDragStop(U)))}componentDidMount(){this.mounted=!0;const U=this.findDOMNode();U&&(0,C.addEvent)(U,H.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const U=this.findDOMNode();if(U){const{ownerDocument:ee}=U;(0,C.removeEvent)(ee,H.mouse.move,this.handleDrag),(0,C.removeEvent)(ee,H.touch.move,this.handleDrag),(0,C.removeEvent)(ee,H.mouse.stop,this.handleDragStop),(0,C.removeEvent)(ee,H.touch.stop,this.handleDragStop),(0,C.removeEvent)(U,H.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,C.removeUserSelectStyles)(ee)}}findDOMNode(){var U,ee;return(U=this.props)!==null&&U!==void 0&&U.nodeRef?(ee=this.props)===null||ee===void 0||(ee=ee.nodeRef)===null||ee===void 0?void 0:ee.current:d.default.findDOMNode(this)}render(){return u.cloneElement(u.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};return DraggableCore.default=O,M(O,"displayName","DraggableCore"),M(O,"propTypes",{allowAnyClick:n.default.bool,children:n.default.node.isRequired,disabled:n.default.bool,enableUserSelectHack:n.default.bool,offsetParent:function($,U){if($[U]&&$[U].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:n.default.arrayOf(n.default.number),handle:n.default.string,cancel:n.default.string,nodeRef:n.default.object,onStart:n.default.func,onDrag:n.default.func,onStop:n.default.func,onMouseDown:n.default.func,scale:n.default.number,className:f.dontSetMe,style:f.dontSetMe,transform:f.dontSetMe}),M(O,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),DraggableCore}var hasRequiredDraggable;function requireDraggable(){return hasRequiredDraggable||(hasRequiredDraggable=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),Object.defineProperty(u,"DraggableCore",{enumerable:!0,get:function(){return _.default}}),u.default=void 0;var n=T(requireReact()),d=M(requirePropTypes()),C=M(requireReactDom()),I=M(require$$3),f=requireDomFns(),y=requirePositionFns(),B=requireShims(),_=M(requireDraggableCore()),Z=M(requireLog());function M(ee){return ee&&ee.__esModule?ee:{default:ee}}function V(ee){if(typeof WeakMap!="function")return null;var Q=new WeakMap,ie=new WeakMap;return(V=function(ne){return ne?ie:Q})(ee)}function T(ee,Q){if(ee&&ee.__esModule)return ee;if(ee===null||typeof ee!="object"&&typeof ee!="function")return{default:ee};var ie=V(Q);if(ie&&ie.has(ee))return ie.get(ee);var ne={},le=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ae in ee)if(ae!=="default"&&Object.prototype.hasOwnProperty.call(ee,ae)){var ce=le?Object.getOwnPropertyDescriptor(ee,ae):null;ce&&(ce.get||ce.set)?Object.defineProperty(ne,ae,ce):ne[ae]=ee[ae]}return ne.default=ee,ie&&ie.set(ee,ne),ne}function H(){return H=Object.assign?Object.assign.bind():function(ee){for(var Q=1;Q<arguments.length;Q++){var ie=arguments[Q];for(var ne in ie)Object.prototype.hasOwnProperty.call(ie,ne)&&(ee[ne]=ie[ne])}return ee},H.apply(this,arguments)}function F(ee,Q,ie){return Q=O(Q),Q in ee?Object.defineProperty(ee,Q,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ee[Q]=ie,ee}function O(ee){var Q=$(ee,"string");return typeof Q=="symbol"?Q:String(Q)}function $(ee,Q){if(typeof ee!="object"||ee===null)return ee;var ie=ee[Symbol.toPrimitive];if(ie!==void 0){var ne=ie.call(ee,Q);if(typeof ne!="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Q==="string"?String:Number)(ee)}class U extends n.Component{static getDerivedStateFromProps(Q,ie){let{position:ne}=Q,{prevPropsPosition:le}=ie;return ne&&(!le||ne.x!==le.x||ne.y!==le.y)?((0,Z.default)("Draggable: getDerivedStateFromProps %j",{position:ne,prevPropsPosition:le}),{x:ne.x,y:ne.y,prevPropsPosition:{...ne}}):null}constructor(Q){super(Q),F(this,"onDragStart",(ie,ne)=>{if((0,Z.default)("Draggable: onDragStart: %j",ne),this.props.onStart(ie,(0,y.createDraggableData)(this,ne))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),F(this,"onDrag",(ie,ne)=>{if(!this.state.dragging)return!1;(0,Z.default)("Draggable: onDrag: %j",ne);const le=(0,y.createDraggableData)(this,ne),ae={x:le.x,y:le.y,slackX:0,slackY:0};if(this.props.bounds){const{x:ge,y:he}=ae;ae.x+=this.state.slackX,ae.y+=this.state.slackY;const[Ie,fe]=(0,y.getBoundPosition)(this,ae.x,ae.y);ae.x=Ie,ae.y=fe,ae.slackX=this.state.slackX+(ge-ae.x),ae.slackY=this.state.slackY+(he-ae.y),le.x=ae.x,le.y=ae.y,le.deltaX=ae.x-this.state.x,le.deltaY=ae.y-this.state.y}if(this.props.onDrag(ie,le)===!1)return!1;this.setState(ae)}),F(this,"onDragStop",(ie,ne)=>{if(!this.state.dragging||this.props.onStop(ie,(0,y.createDraggableData)(this,ne))===!1)return!1;(0,Z.default)("Draggable: onDragStop: %j",ne);const ae={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:ge,y:he}=this.props.position;ae.x=ge,ae.y=he}this.setState(ae)}),this.state={dragging:!1,dragged:!1,x:Q.position?Q.position.x:Q.defaultPosition.x,y:Q.position?Q.position.y:Q.defaultPosition.y,prevPropsPosition:{...Q.position},slackX:0,slackY:0,isElementSVG:!1},Q.position&&!(Q.onDrag||Q.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var Q,ie;return(Q=(ie=this.props)===null||ie===void 0||(ie=ie.nodeRef)===null||ie===void 0?void 0:ie.current)!==null&&Q!==void 0?Q:C.default.findDOMNode(this)}render(){const{axis:Q,bounds:ie,children:ne,defaultPosition:le,defaultClassName:ae,defaultClassNameDragging:ce,defaultClassNameDragged:ge,position:he,positionOffset:Ie,scale:fe,...me}=this.props;let Ge={},Ze=null;const Ee=!!!he||this.state.dragging,Ve=he||le,Ye={x:(0,y.canDragX)(this)&&Ee?this.state.x:Ve.x,y:(0,y.canDragY)(this)&&Ee?this.state.y:Ve.y};this.state.isElementSVG?Ze=(0,f.createSVGTransform)(Ye,Ie):Ge=(0,f.createCSSTransform)(Ye,Ie);const be=(0,I.default)(ne.props.className||"",ae,{[ce]:this.state.dragging,[ge]:this.state.dragged});return n.createElement(_.default,H({},me,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),n.cloneElement(n.Children.only(ne),{className:be,style:{...ne.props.style,...Ge},transform:Ze}))}}u.default=U,F(U,"displayName","Draggable"),F(U,"propTypes",{..._.default.propTypes,axis:d.default.oneOf(["both","x","y","none"]),bounds:d.default.oneOfType([d.default.shape({left:d.default.number,right:d.default.number,top:d.default.number,bottom:d.default.number}),d.default.string,d.default.oneOf([!1])]),defaultClassName:d.default.string,defaultClassNameDragging:d.default.string,defaultClassNameDragged:d.default.string,defaultPosition:d.default.shape({x:d.default.number,y:d.default.number}),positionOffset:d.default.shape({x:d.default.oneOfType([d.default.number,d.default.string]),y:d.default.oneOfType([d.default.number,d.default.string])}),position:d.default.shape({x:d.default.number,y:d.default.number}),className:B.dontSetMe,style:B.dontSetMe,transform:B.dontSetMe}),F(U,"defaultProps",{..._.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})}(Draggable$1)),Draggable$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs.exports;hasRequiredCjs=1;const{default:u,DraggableCore:n}=requireDraggable();return cjs.exports=u,cjs.exports.default=u,cjs.exports.DraggableCore=n,cjs.exports}var cjsExports=requireCjs();const Draggable=getDefaultExportFromCjs(cjsExports);var reactDomExports=requireReactDom(),__assign$2=function(){return __assign$2=Object.assign||function(u){for(var n,d=1,C=arguments.length;d<C;d++){n=arguments[d];for(var I in n)Object.prototype.hasOwnProperty.call(n,I)&&(u[I]=n[I])}return u},__assign$2.apply(this,arguments)},rowSizeBase={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},colSizeBase={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},edgeBase={width:"20px",height:"20px",position:"absolute",zIndex:1},styles={top:__assign$2(__assign$2({},rowSizeBase),{top:"-5px"}),right:__assign$2(__assign$2({},colSizeBase),{left:void 0,right:"-5px"}),bottom:__assign$2(__assign$2({},rowSizeBase),{top:void 0,bottom:"-5px"}),left:__assign$2(__assign$2({},colSizeBase),{left:"-5px"}),topRight:__assign$2(__assign$2({},edgeBase),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:__assign$2(__assign$2({},edgeBase),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:__assign$2(__assign$2({},edgeBase),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:__assign$2(__assign$2({},edgeBase),{left:"-10px",top:"-10px",cursor:"nw-resize"})},Resizer=reactExports.memo(function(u){var n=u.onResizeStart,d=u.direction,C=u.children,I=u.replaceStyles,f=u.className,y=reactExports.useCallback(function(Z){n(Z,d)},[n,d]),B=reactExports.useCallback(function(Z){n(Z,d)},[n,d]),_=reactExports.useMemo(function(){return __assign$2(__assign$2({position:"absolute",userSelect:"none"},styles[d]),I??{})},[I,d]);return jsxRuntimeExports.jsx("div",{className:f||void 0,style:_,onMouseDown:y,onTouchStart:B,children:C})}),__extends$1=function(){var u=function(n,d){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,I){C.__proto__=I}||function(C,I){for(var f in I)Object.prototype.hasOwnProperty.call(I,f)&&(C[f]=I[f])},u(n,d)};return function(n,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");u(n,d);function C(){this.constructor=n}n.prototype=d===null?Object.create(d):(C.prototype=d.prototype,new C)}}(),__assign$1=function(){return __assign$1=Object.assign||function(u){for(var n,d=1,C=arguments.length;d<C;d++){n=arguments[d];for(var I in n)Object.prototype.hasOwnProperty.call(n,I)&&(u[I]=n[I])}return u},__assign$1.apply(this,arguments)},DEFAULT_SIZE={width:"auto",height:"auto"},clamp=function(u,n,d){return Math.max(Math.min(u,d),n)},snap=function(u,n,d){var C=Math.round(u/n);return C*n+d*(C-1)},hasDirection=function(u,n){return new RegExp(u,"i").test(n)},isTouchEvent=function(u){return!!(u.touches&&u.touches.length)},isMouseEvent=function(u){return!!((u.clientX||u.clientX===0)&&(u.clientY||u.clientY===0))},findClosestSnap=function(u,n,d){d===void 0&&(d=0);var C=n.reduce(function(f,y,B){return Math.abs(y-u)<Math.abs(n[f]-u)?B:f},0),I=Math.abs(n[C]-u);return d===0||I<d?n[C]:u},getStringSize=function(u){return u=u.toString(),u==="auto"||u.endsWith("px")||u.endsWith("%")||u.endsWith("vh")||u.endsWith("vw")||u.endsWith("vmax")||u.endsWith("vmin")?u:"".concat(u,"px")},getPixelSize=function(u,n,d,C){if(u&&typeof u=="string"){if(u.endsWith("px"))return Number(u.replace("px",""));if(u.endsWith("%")){var I=Number(u.replace("%",""))/100;return n*I}if(u.endsWith("vw")){var I=Number(u.replace("vw",""))/100;return d*I}if(u.endsWith("vh")){var I=Number(u.replace("vh",""))/100;return C*I}}return u},calculateNewMax=function(u,n,d,C,I,f,y){return C=getPixelSize(C,u.width,n,d),I=getPixelSize(I,u.height,n,d),f=getPixelSize(f,u.width,n,d),y=getPixelSize(y,u.height,n,d),{maxWidth:typeof C>"u"?void 0:Number(C),maxHeight:typeof I>"u"?void 0:Number(I),minWidth:typeof f>"u"?void 0:Number(f),minHeight:typeof y>"u"?void 0:Number(y)}},normalizeToPair=function(u){return Array.isArray(u)?u:[u,u]},definedProps=["as","ref","style","className","grid","gridGap","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],baseClassName="__resizable_base__",Resizable=function(u){__extends$1(n,u);function n(d){var C,I,f,y,B=u.call(this,d)||this;return B.ratio=1,B.resizable=null,B.parentLeft=0,B.parentTop=0,B.resizableLeft=0,B.resizableRight=0,B.resizableTop=0,B.resizableBottom=0,B.targetLeft=0,B.targetTop=0,B.delta={width:0,height:0},B.appendBase=function(){if(!B.resizable||!B.window)return null;var _=B.parentNode;if(!_)return null;var Z=B.window.document.createElement("div");return Z.style.width="100%",Z.style.height="100%",Z.style.position="absolute",Z.style.transform="scale(0, 0)",Z.style.left="0",Z.style.flex="0 0 100%",Z.classList?Z.classList.add(baseClassName):Z.className+=baseClassName,_.appendChild(Z),Z},B.removeBase=function(_){var Z=B.parentNode;Z&&Z.removeChild(_)},B.state={isResizing:!1,width:(I=(C=B.propsSize)===null||C===void 0?void 0:C.width)!==null&&I!==void 0?I:"auto",height:(y=(f=B.propsSize)===null||f===void 0?void 0:f.height)!==null&&y!==void 0?y:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},B.onResizeStart=B.onResizeStart.bind(B),B.onMouseMove=B.onMouseMove.bind(B),B.onMouseUp=B.onMouseUp.bind(B),B}return Object.defineProperty(n.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||DEFAULT_SIZE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){var d=0,C=0;if(this.resizable&&this.window){var I=this.resizable.offsetWidth,f=this.resizable.offsetHeight,y=this.resizable.style.position;y!=="relative"&&(this.resizable.style.position="relative"),d=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:I,C=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:f,this.resizable.style.position=y}return{width:d,height:C}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sizeStyle",{get:function(){var d=this,C=this.props.size,I=function(B){var _;if(typeof d.state[B]>"u"||d.state[B]==="auto")return"auto";if(d.propsSize&&d.propsSize[B]&&(!((_=d.propsSize[B])===null||_===void 0)&&_.toString().endsWith("%"))){if(d.state[B].toString().endsWith("%"))return d.state[B].toString();var Z=d.getParentSize(),M=Number(d.state[B].toString().replace("px","")),V=M/Z[B]*100;return"".concat(V,"%")}return getStringSize(d.state[B])},f=C&&typeof C.width<"u"&&!this.state.isResizing?getStringSize(C.width):I("width"),y=C&&typeof C.height<"u"&&!this.state.isResizing?getStringSize(C.height):I("height");return{width:f,height:y}},enumerable:!1,configurable:!0}),n.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var d=this.appendBase();if(!d)return{width:0,height:0};var C=!1,I=this.parentNode.style.flexWrap;I!=="wrap"&&(C=!0,this.parentNode.style.flexWrap="wrap"),d.style.position="relative",d.style.minWidth="100%",d.style.minHeight="100%";var f={width:d.offsetWidth,height:d.offsetHeight};return C&&(this.parentNode.style.flexWrap=I),this.removeBase(d),f},n.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},n.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},n.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var d=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:d.flexBasis!=="auto"?d.flexBasis:void 0})}},n.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},n.prototype.createSizeForCssProperty=function(d,C){var I=this.propsSize&&this.propsSize[C];return this.state[C]==="auto"&&this.state.original[C]===d&&(typeof I>"u"||I==="auto")?"auto":d},n.prototype.calculateNewMaxFromBoundary=function(d,C){var I=this.props.boundsByDirection,f=this.state.direction,y=I&&hasDirection("left",f),B=I&&hasDirection("top",f),_,Z;if(this.props.bounds==="parent"){var M=this.parentNode;M&&(_=y?this.resizableRight-this.parentLeft:M.offsetWidth+(this.parentLeft-this.resizableLeft),Z=B?this.resizableBottom-this.parentTop:M.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(_=y?this.resizableRight:this.window.innerWidth-this.resizableLeft,Z=B?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(_=y?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),Z=B?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return _&&Number.isFinite(_)&&(d=d&&d<_?d:_),Z&&Number.isFinite(Z)&&(C=C&&C<Z?C:Z),{maxWidth:d,maxHeight:C}},n.prototype.calculateNewSizeFromDirection=function(d,C){var I=this.props.scale||1,f=normalizeToPair(this.props.resizeRatio||1),y=f[0],B=f[1],_=this.state,Z=_.direction,M=_.original,V=this.props,T=V.lockAspectRatio,H=V.lockAspectRatioExtraHeight,F=V.lockAspectRatioExtraWidth,O=M.width,$=M.height,U=H||0,ee=F||0;return hasDirection("right",Z)&&(O=M.width+(d-M.x)*y/I,T&&($=(O-ee)/this.ratio+U)),hasDirection("left",Z)&&(O=M.width-(d-M.x)*y/I,T&&($=(O-ee)/this.ratio+U)),hasDirection("bottom",Z)&&($=M.height+(C-M.y)*B/I,T&&(O=($-U)*this.ratio+ee)),hasDirection("top",Z)&&($=M.height-(C-M.y)*B/I,T&&(O=($-U)*this.ratio+ee)),{newWidth:O,newHeight:$}},n.prototype.calculateNewSizeFromAspectRatio=function(d,C,I,f){var y=this.props,B=y.lockAspectRatio,_=y.lockAspectRatioExtraHeight,Z=y.lockAspectRatioExtraWidth,M=typeof f.width>"u"?10:f.width,V=typeof I.width>"u"||I.width<0?d:I.width,T=typeof f.height>"u"?10:f.height,H=typeof I.height>"u"||I.height<0?C:I.height,F=_||0,O=Z||0;if(B){var $=(T-F)*this.ratio+O,U=(H-F)*this.ratio+O,ee=(M-O)/this.ratio+F,Q=(V-O)/this.ratio+F,ie=Math.max(M,$),ne=Math.min(V,U),le=Math.max(T,ee),ae=Math.min(H,Q);d=clamp(d,ie,ne),C=clamp(C,le,ae)}else d=clamp(d,M,V),C=clamp(C,T,H);return{newWidth:d,newHeight:C}},n.prototype.setBoundingClientRect=function(){var d=1/(this.props.scale||1);if(this.props.bounds==="parent"){var C=this.parentNode;if(C){var I=C.getBoundingClientRect();this.parentLeft=I.left*d,this.parentTop=I.top*d}}if(this.props.bounds&&typeof this.props.bounds!="string"){var f=this.props.bounds.getBoundingClientRect();this.targetLeft=f.left*d,this.targetTop=f.top*d}if(this.resizable){var y=this.resizable.getBoundingClientRect(),B=y.left,_=y.top,Z=y.right,M=y.bottom;this.resizableLeft=B*d,this.resizableRight=Z*d,this.resizableTop=_*d,this.resizableBottom=M*d}},n.prototype.onResizeStart=function(d,C){if(!(!this.resizable||!this.window)){var I=0,f=0;if(d.nativeEvent&&isMouseEvent(d.nativeEvent)?(I=d.nativeEvent.clientX,f=d.nativeEvent.clientY):d.nativeEvent&&isTouchEvent(d.nativeEvent)&&(I=d.nativeEvent.touches[0].clientX,f=d.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var y=this.props.onResizeStart(d,C,this.resizable);if(y===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var B,_=this.window.getComputedStyle(this.resizable);if(_.flexBasis!=="auto"){var Z=this.parentNode;if(Z){var M=this.window.getComputedStyle(Z).flexDirection;this.flexDir=M.startsWith("row")?"row":"column",B=_.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var V={original:{x:I,y:f,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:__assign$1(__assign$1({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(d.target).cursor||"auto"}),direction:C,flexBasis:B};this.setState(V)}},n.prototype.onMouseMove=function(d){var C=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&isTouchEvent(d))try{d.preventDefault(),d.stopPropagation()}catch{}var I=this.props,f=I.maxWidth,y=I.maxHeight,B=I.minWidth,_=I.minHeight,Z=isTouchEvent(d)?d.touches[0].clientX:d.clientX,M=isTouchEvent(d)?d.touches[0].clientY:d.clientY,V=this.state,T=V.direction,H=V.original,F=V.width,O=V.height,$=this.getParentSize(),U=calculateNewMax($,this.window.innerWidth,this.window.innerHeight,f,y,B,_);f=U.maxWidth,y=U.maxHeight,B=U.minWidth,_=U.minHeight;var ee=this.calculateNewSizeFromDirection(Z,M),Q=ee.newHeight,ie=ee.newWidth,ne=this.calculateNewMaxFromBoundary(f,y);this.props.snap&&this.props.snap.x&&(ie=findClosestSnap(ie,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(Q=findClosestSnap(Q,this.props.snap.y,this.props.snapGap));var le=this.calculateNewSizeFromAspectRatio(ie,Q,{width:ne.maxWidth,height:ne.maxHeight},{width:B,height:_});if(ie=le.newWidth,Q=le.newHeight,this.props.grid){var ae=snap(ie,this.props.grid[0],this.props.gridGap?this.props.gridGap[0]:0),ce=snap(Q,this.props.grid[1],this.props.gridGap?this.props.gridGap[1]:0),ge=this.props.snapGap||0,he=ge===0||Math.abs(ae-ie)<=ge?ae:ie,Ie=ge===0||Math.abs(ce-Q)<=ge?ce:Q;ie=he,Q=Ie}var fe={width:ie-H.width,height:Q-H.height};if(this.delta=fe,F&&typeof F=="string"){if(F.endsWith("%")){var me=ie/$.width*100;ie="".concat(me,"%")}else if(F.endsWith("vw")){var Ge=ie/this.window.innerWidth*100;ie="".concat(Ge,"vw")}else if(F.endsWith("vh")){var Ze=ie/this.window.innerHeight*100;ie="".concat(Ze,"vh")}}if(O&&typeof O=="string"){if(O.endsWith("%")){var me=Q/$.height*100;Q="".concat(me,"%")}else if(O.endsWith("vw")){var Ge=Q/this.window.innerWidth*100;Q="".concat(Ge,"vw")}else if(O.endsWith("vh")){var Ze=Q/this.window.innerHeight*100;Q="".concat(Ze,"vh")}}var ye={width:this.createSizeForCssProperty(ie,"width"),height:this.createSizeForCssProperty(Q,"height")};this.flexDir==="row"?ye.flexBasis=ye.width:this.flexDir==="column"&&(ye.flexBasis=ye.height);var Ee=this.state.width!==ye.width,Ve=this.state.height!==ye.height,Ye=this.state.flexBasis!==ye.flexBasis,be=Ee||Ve||Ye;be&&reactDomExports.flushSync(function(){C.setState(ye)}),this.props.onResize&&be&&this.props.onResize(d,T,this.resizable,fe)}},n.prototype.onMouseUp=function(d){var C,I,f=this.state,y=f.isResizing,B=f.direction;f.original,!(!y||!this.resizable)&&(this.props.onResizeStop&&this.props.onResizeStop(d,B,this.resizable,this.delta),this.props.size&&this.setState({width:(C=this.props.size.width)!==null&&C!==void 0?C:"auto",height:(I=this.props.size.height)!==null&&I!==void 0?I:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:__assign$1(__assign$1({},this.state.backgroundStyle),{cursor:"auto"})}))},n.prototype.updateSize=function(d){var C,I;this.setState({width:(C=d.width)!==null&&C!==void 0?C:"auto",height:(I=d.height)!==null&&I!==void 0?I:"auto"})},n.prototype.renderResizer=function(){var d=this,C=this.props,I=C.enable,f=C.handleStyles,y=C.handleClasses,B=C.handleWrapperStyle,_=C.handleWrapperClass,Z=C.handleComponent;if(!I)return null;var M=Object.keys(I).map(function(V){return I[V]!==!1?jsxRuntimeExports.jsx(Resizer,{direction:V,onResizeStart:d.onResizeStart,replaceStyles:f&&f[V],className:y&&y[V],children:Z&&Z[V]?Z[V]:null},V):null});return jsxRuntimeExports.jsx("div",{className:_,style:B,children:M})},n.prototype.render=function(){var d=this,C=Object.keys(this.props).reduce(function(y,B){return definedProps.indexOf(B)!==-1||(y[B]=d.props[B]),y},{}),I=__assign$1(__assign$1(__assign$1({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(I.flexBasis=this.state.flexBasis);var f=this.props.as||"div";return jsxRuntimeExports.jsxs(f,__assign$1({style:I,className:this.props.className},C,{ref:function(y){y&&(d.resizable=y)},children:[this.state.isResizing&&jsxRuntimeExports.jsx("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer()]}))},n.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],gridGap:[0,0],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},n}(reactExports.PureComponent);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var extendStatics=function(u,n){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,C){d.__proto__=C}||function(d,C){for(var I in C)C.hasOwnProperty(I)&&(d[I]=C[I])},extendStatics(u,n)};function __extends(u,n){extendStatics(u,n);function d(){this.constructor=u}u.prototype=n===null?Object.create(n):(d.prototype=n.prototype,new d)}var __assign=function(){return __assign=Object.assign||function(n){for(var d,C=1,I=arguments.length;C<I;C++){d=arguments[C];for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(n[f]=d[f])}return n},__assign.apply(this,arguments)};function __rest(u,n){var d={};for(var C in u)Object.prototype.hasOwnProperty.call(u,C)&&n.indexOf(C)<0&&(d[C]=u[C]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var I=0,C=Object.getOwnPropertySymbols(u);I<C.length;I++)n.indexOf(C[I])<0&&Object.prototype.propertyIsEnumerable.call(u,C[I])&&(d[C[I]]=u[C[I]]);return d}var resizableStyle={width:"auto",height:"auto",display:"inline-block",position:"absolute",top:0,left:0},getEnableResizingByFlag=function(u){return{bottom:u,bottomLeft:u,bottomRight:u,left:u,right:u,top:u,topLeft:u,topRight:u}},Rnd=function(u){__extends(n,u);function n(d){var C=u.call(this,d)||this;return C.resizingPosition={x:0,y:0},C.offsetFromParent={left:0,top:0},C.resizableElement={current:null},C.originalPosition={x:0,y:0},C.state={resizing:!1,bounds:{top:0,right:0,bottom:0,left:0},maxWidth:d.maxWidth,maxHeight:d.maxHeight},C.onResizeStart=C.onResizeStart.bind(C),C.onResize=C.onResize.bind(C),C.onResizeStop=C.onResizeStop.bind(C),C.onDragStart=C.onDragStart.bind(C),C.onDrag=C.onDrag.bind(C),C.onDragStop=C.onDragStop.bind(C),C.getMaxSizesFromProps=C.getMaxSizesFromProps.bind(C),C}return n.prototype.componentDidMount=function(){this.updateOffsetFromParent();var d=this.offsetFromParent,C=d.left,I=d.top,f=this.getDraggablePosition(),y=f.x,B=f.y;this.draggable.setState({x:y-C,y:B-I}),this.forceUpdate()},n.prototype.getDraggablePosition=function(){var d=this.draggable.state,C=d.x,I=d.y;return{x:C,y:I}},n.prototype.getParent=function(){return this.resizable&&this.resizable.parentNode},n.prototype.getParentSize=function(){return this.resizable.getParentSize()},n.prototype.getMaxSizesFromProps=function(){var d=typeof this.props.maxWidth>"u"?Number.MAX_SAFE_INTEGER:this.props.maxWidth,C=typeof this.props.maxHeight>"u"?Number.MAX_SAFE_INTEGER:this.props.maxHeight;return{maxWidth:d,maxHeight:C}},n.prototype.getSelfElement=function(){return this.resizable&&this.resizable.resizable},n.prototype.getOffsetHeight=function(d){var C=this.props.scale;switch(this.props.bounds){case"window":return window.innerHeight/C;case"body":return document.body.offsetHeight/C;default:return d.offsetHeight}},n.prototype.getOffsetWidth=function(d){var C=this.props.scale;switch(this.props.bounds){case"window":return window.innerWidth/C;case"body":return document.body.offsetWidth/C;default:return d.offsetWidth}},n.prototype.onDragStart=function(d,C){this.props.onDragStart&&this.props.onDragStart(d,C);var I=this.getDraggablePosition();if(this.originalPosition=I,!!this.props.bounds){var f=this.getParent(),y=this.props.scale,B;if(this.props.bounds==="parent")B=f;else if(this.props.bounds==="body"){var _=f.getBoundingClientRect(),Z=_.left,M=_.top,V=document.body.getBoundingClientRect(),T=-(Z-f.offsetLeft*y-V.left)/y,H=-(M-f.offsetTop*y-V.top)/y,F=(document.body.offsetWidth-this.resizable.size.width*y)/y+T,O=(document.body.offsetHeight-this.resizable.size.height*y)/y+H;return this.setState({bounds:{top:H,right:F,bottom:O,left:T}})}else if(this.props.bounds==="window"){if(!this.resizable)return;var $=f.getBoundingClientRect(),U=$.left,ee=$.top,Q=-(U-f.offsetLeft*y)/y,ie=-(ee-f.offsetTop*y)/y,F=(window.innerWidth-this.resizable.size.width*y)/y+Q,O=(window.innerHeight-this.resizable.size.height*y)/y+ie;return this.setState({bounds:{top:ie,right:F,bottom:O,left:Q}})}else typeof this.props.bounds=="string"?B=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(B=this.props.bounds);if(!(!(B instanceof HTMLElement)||!(f instanceof HTMLElement))){var ne=B.getBoundingClientRect(),le=ne.left,ae=ne.top,ce=f.getBoundingClientRect(),ge=ce.left,he=ce.top,Ie=(le-ge)/y,fe=ae-he;if(this.resizable){this.updateOffsetFromParent();var me=this.offsetFromParent;this.setState({bounds:{top:fe-me.top,right:Ie+(B.offsetWidth-this.resizable.size.width)-me.left/y,bottom:fe+(B.offsetHeight-this.resizable.size.height)-me.top,left:Ie-me.left/y}})}}}},n.prototype.onDrag=function(d,C){if(this.props.onDrag){var I=this.offsetFromParent,f=I.left,y=I.top;if(!this.props.dragAxis||this.props.dragAxis==="both")return this.props.onDrag(d,__assign(__assign({},C),{x:C.x+f,y:C.y+y}));if(this.props.dragAxis==="x")return this.props.onDrag(d,__assign(__assign({},C),{x:C.x+f,y:this.originalPosition.y+y,deltaY:0}));if(this.props.dragAxis==="y")return this.props.onDrag(d,__assign(__assign({},C),{x:this.originalPosition.x+f,y:C.y+y,deltaX:0}))}},n.prototype.onDragStop=function(d,C){if(this.props.onDragStop){var I=this.offsetFromParent,f=I.left,y=I.top;if(!this.props.dragAxis||this.props.dragAxis==="both")return this.props.onDragStop(d,__assign(__assign({},C),{x:C.x+f,y:C.y+y}));if(this.props.dragAxis==="x")return this.props.onDragStop(d,__assign(__assign({},C),{x:C.x+f,y:this.originalPosition.y+y,deltaY:0}));if(this.props.dragAxis==="y")return this.props.onDragStop(d,__assign(__assign({},C),{x:this.originalPosition.x+f,y:C.y+y,deltaX:0}))}},n.prototype.onResizeStart=function(d,C,I){d.stopPropagation(),this.setState({resizing:!0});var f=this.props.scale,y=this.offsetFromParent,B=this.getDraggablePosition();if(this.resizingPosition={x:B.x+y.left,y:B.y+y.top},this.originalPosition=B,this.props.bounds){var _=this.getParent(),Z=void 0;this.props.bounds==="parent"?Z=_:this.props.bounds==="body"?Z=document.body:this.props.bounds==="window"?Z=window:typeof this.props.bounds=="string"?Z=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(Z=this.props.bounds);var M=this.getSelfElement();if(M instanceof Element&&(Z instanceof HTMLElement||Z===window)&&_ instanceof HTMLElement){var V=this.getMaxSizesFromProps(),T=V.maxWidth,H=V.maxHeight,F=this.getParentSize();if(T&&typeof T=="string")if(T.endsWith("%")){var O=Number(T.replace("%",""))/100;T=F.width*O}else T.endsWith("px")&&(T=Number(T.replace("px","")));if(H&&typeof H=="string")if(H.endsWith("%")){var O=Number(H.replace("%",""))/100;H=F.height*O}else H.endsWith("px")&&(H=Number(H.replace("px","")));var $=M.getBoundingClientRect(),U=$.left,ee=$.top,Q=this.props.bounds==="window"?{left:0,top:0}:Z.getBoundingClientRect(),ie=Q.left,ne=Q.top,le=this.getOffsetWidth(Z),ae=this.getOffsetHeight(Z),ce=C.toLowerCase().endsWith("left"),ge=C.toLowerCase().endsWith("right"),he=C.startsWith("top"),Ie=C.startsWith("bottom");if((ce||he)&&this.resizable){var fe=(U-ie)/f+this.resizable.size.width;this.setState({maxWidth:fe>Number(T)?T:fe})}if(ge||this.props.lockAspectRatio&&!ce&&!he){var fe=le+(ie-U)/f;this.setState({maxWidth:fe>Number(T)?T:fe})}if((he||ce)&&this.resizable){var fe=(ee-ne)/f+this.resizable.size.height;this.setState({maxHeight:fe>Number(H)?H:fe})}if(Ie||this.props.lockAspectRatio&&!he&&!ce){var fe=ae+(ne-ee)/f;this.setState({maxHeight:fe>Number(H)?H:fe})}}}else this.setState({maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight});this.props.onResizeStart&&this.props.onResizeStart(d,C,I)},n.prototype.onResize=function(d,C,I,f){var y=this,B={x:this.originalPosition.x,y:this.originalPosition.y},_=-f.width,Z=-f.height,M=["top","left","topLeft","bottomLeft","topRight"];M.includes(C)&&(C==="bottomLeft"?B.x+=_:(C==="topRight"||(B.x+=_),B.y+=Z));var V=this.draggable.state;(B.x!==V.x||B.y!==V.y)&&reactDomExports.flushSync(function(){y.draggable.setState(B)}),this.updateOffsetFromParent();var T=this.offsetFromParent,H=this.getDraggablePosition().x+T.left,F=this.getDraggablePosition().y+T.top;this.resizingPosition={x:H,y:F},this.props.onResize&&this.props.onResize(d,C,I,f,{x:H,y:F})},n.prototype.onResizeStop=function(d,C,I,f){this.setState({resizing:!1});var y=this.getMaxSizesFromProps(),B=y.maxWidth,_=y.maxHeight;this.setState({maxWidth:B,maxHeight:_}),this.props.onResizeStop&&this.props.onResizeStop(d,C,I,f,this.resizingPosition)},n.prototype.updateSize=function(d){this.resizable&&this.resizable.updateSize({width:d.width,height:d.height})},n.prototype.updatePosition=function(d){this.draggable.setState(d)},n.prototype.updateOffsetFromParent=function(){var d=this.props.scale,C=this.getParent(),I=this.getSelfElement();if(!C||I===null)return{top:0,left:0};var f=C.getBoundingClientRect(),y=f.left,B=f.top,_=I.getBoundingClientRect(),Z=this.getDraggablePosition(),M=C.scrollLeft,V=C.scrollTop;this.offsetFromParent={left:_.left-y+M-Z.x*d,top:_.top-B+V-Z.y*d}},n.prototype.render=function(){var d=this,C=this.props,I=C.disableDragging,f=C.style,y=C.dragHandleClassName,B=C.position,_=C.onMouseDown,Z=C.onMouseUp,M=C.dragAxis,V=C.dragGrid,T=C.bounds,H=C.enableUserSelectHack,F=C.cancel,O=C.children;C.onResizeStart,C.onResize,C.onResizeStop,C.onDragStart,C.onDrag,C.onDragStop;var $=C.resizeHandleStyles,U=C.resizeHandleClasses,ee=C.resizeHandleComponent,Q=C.enableResizing,ie=C.resizeGrid,ne=C.resizeHandleWrapperClass,le=C.resizeHandleWrapperStyle,ae=C.scale,ce=C.allowAnyClick,ge=C.dragPositionOffset,he=__rest(C,["disableDragging","style","dragHandleClassName","position","onMouseDown","onMouseUp","dragAxis","dragGrid","bounds","enableUserSelectHack","cancel","children","onResizeStart","onResize","onResizeStop","onDragStart","onDrag","onDragStop","resizeHandleStyles","resizeHandleClasses","resizeHandleComponent","enableResizing","resizeGrid","resizeHandleWrapperClass","resizeHandleWrapperStyle","scale","allowAnyClick","dragPositionOffset"]),Ie=this.props.default?__assign({},this.props.default):void 0;delete he.default;var fe=I||y?{cursor:"auto"}:{cursor:"move"},me=__assign(__assign(__assign({},resizableStyle),fe),f),Ge=this.offsetFromParent,Ze=Ge.left,ye=Ge.top,Ee;B&&(Ee={x:B.x-Ze,y:B.y-ye});var Ve=this.state.resizing?void 0:Ee,Ye=this.state.resizing?"both":M;return reactExports.createElement(Draggable,{ref:function(be){be&&(d.draggable=be)},handle:y?".".concat(y):void 0,defaultPosition:Ie,onMouseDown:_,onMouseUp:Z,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,axis:Ye,disabled:I,grid:V,bounds:T?this.state.bounds:void 0,position:Ve,enableUserSelectHack:H,cancel:F,scale:ae,allowAnyClick:ce,nodeRef:this.resizableElement,positionOffset:ge},reactExports.createElement(Resizable,__assign({},he,{ref:function(be){be&&(d.resizable=be,d.resizableElement.current=be.resizable)},defaultSize:Ie,size:this.props.size,enable:typeof Q=="boolean"?getEnableResizingByFlag(Q):Q,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,style:me,minWidth:this.props.minWidth,minHeight:this.props.minHeight,maxWidth:this.state.resizing?this.state.maxWidth:this.props.maxWidth,maxHeight:this.state.resizing?this.state.maxHeight:this.props.maxHeight,grid:ie,handleWrapperClass:ne,handleWrapperStyle:le,lockAspectRatio:this.props.lockAspectRatio,lockAspectRatioExtraWidth:this.props.lockAspectRatioExtraWidth,lockAspectRatioExtraHeight:this.props.lockAspectRatioExtraHeight,handleStyles:$,handleClasses:U,handleComponent:ee,scale:this.props.scale}),O))},n.defaultProps={maxWidth:Number.MAX_SAFE_INTEGER,maxHeight:Number.MAX_SAFE_INTEGER,scale:1,onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},onDragStart:function(){},onDrag:function(){},onDragStop:function(){}},n}(reactExports.PureComponent);const defaultOverlaySize={width:150,height:150},defaultOverlayPosition={x:10,y:50};function OverlayGraph({id:u,initialType:n="yvx",data:d,onClose:C}){const I=reactExports.useRef(null),f=reactExports.useRef(null),[y,B]=reactExports.useState(n),[_,Z]=reactExports.useState(!0),M=reactExports.useRef(null);return reactExports.useEffect(()=>{if(!I.current)return;const V=`jsxg-overlay-${u}-${Math.random().toString(36).slice(2)}`;I.current.id=V,console.log(`Initializing OVERLAY JSXGraph board with ID: ${V}`);const T=JXG$1.JSXGraph.initBoard(V,{boundingbox:[-5,5,5,-5],grid:!1,showCopyright:!1,pan:{enabled:!0,needShift:!1},zoom:{enabled:!0,wheel:!0,needShift:!1},keepaspectratio:!1,backgroundColor:"rgba(255, 255, 255, 0.9)"});return f.current=T,()=>{f.current&&(console.log(`Freeing OVERLAY JSXGraph board with ID: ${f.current.container}`),JXG$1.JSXGraph.freeBoard(f.current),f.current=null)}},[u]),reactExports.useEffect(()=>{const V=f.current;if(!V||!d)return;V.suspendUpdate(),V.objectsList.filter(U=>U.elType==="curve"||U.elType==="point").forEach(U=>{V.objects[U.id]&&V.removeObject(U)});const H=y==="xvt"?"t":"x",F=y==="yvt"?"y":y==="xvt"?"x":"y";let O=[],$=[];if(Object.values(d||{}).forEach((U,ee)=>{if(!U||U.length===0)return;const Q=U.map(ne=>ne[H]),ie=U.map(ne=>ne[F]);if(Q.length>0&&ie.length>0){V.create("curve",[Q,ie],{strokeColor:["#1f77b4","#ff7f0e"][ee%2],strokeWidth:2});const ne=Q[Q.length-1],le=ie[ie.length-1];typeof ne=="number"&&typeof le=="number"&&isFinite(ne)&&isFinite(le)&&V.create("point",[ne,le],{size:3,color:["#1f77b4","#ff7f0e"][ee%2],fixed:!0,name:""}),O.push(...Q.filter(Number.isFinite)),$.push(...ie.filter(Number.isFinite))}}),_&&O.length>0&&$.length>0){const U=Math.min(...O),ee=Math.max(...O),Q=Math.min(...$),ie=Math.max(...$),ne=ee-U,le=ie-Q,ae=Math.max(ne*.1,.5),ce=Math.max(le*.1,.5);let ge=U-ae,he=ee+ae,Ie=Q-ce,fe=ie+ce;const me=1;if(he-ge<me){const Ge=(ge+he)/2;ge=Ge-me/2,he=Ge+me/2}if(fe-Ie<me){const Ge=(Ie+fe)/2;Ie=Ge-me/2,fe=Ge+me/2}V.setBoundingBox([ge,fe,he,Ie],!1)}else!_&&V.objectsList.length===0&&V.setBoundingBox([-5,5,5,-5],!1);V.unsuspendUpdate()},[d,y,_]),reactExports.useEffect(()=>{const V=I.current;if(!V)return;const T=()=>{if(!f.current||!V)return;const F=V.clientWidth,O=V.clientHeight;F>0&&O>0&&(f.current.resizeContainer(F,O,!0),f.current.update())},H=new ResizeObserver(T);return H.observe(V),T(),()=>{V&&H.unobserve(V),H.disconnect()}},[u]),jsxRuntimeExports.jsx(Rnd,{ref:M,className:"overlay-graph-rnd",style:{zIndex:100},default:{x:defaultOverlayPosition.x,y:defaultOverlayPosition.y,width:defaultOverlaySize.width,height:defaultOverlaySize.height},minWidth:200,minHeight:180,bounds:"parent",onResizeStop:(V,T,H,F,O)=>{},children:jsxRuntimeExports.jsxs("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:"rgba(0, 0, 0, 0.3)"},children:[jsxRuntimeExports.jsx("button",{className:"overlay-graph-close-button",onClick:()=>C(u),"aria-label":"Close Graph",children:"X "}),jsxRuntimeExports.jsx("div",{ref:I,style:{flex:1,width:"100%",minHeight:0,position:"relative",backgroundColor:"transparent"}}),jsxRuntimeExports.jsxs("div",{style:{padding:"0px 2px",color:"white",fontSize:"10px",flexShrink:0},children:[jsxRuntimeExports.jsxs("label",{style:{marginRight:"4px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"yvx",checked:y==="yvx",onChange:V=>B(V.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," Y vs X"]}),jsxRuntimeExports.jsxs("label",{style:{marginRight:"6px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"xvt",checked:y==="xvt",onChange:V=>B(V.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," X vs T"]}),jsxRuntimeExports.jsxs("label",{style:{marginRight:"8px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"yvt",checked:y==="yvt",onChange:V=>B(V.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," Y vs T"]}),jsxRuntimeExports.jsxs("label",{style:{cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_,onChange:()=>Z(!_),style:{marginRight:"3px",verticalAlign:"middle"}})," Auto-Fit"]})]})]})})}/*!
 * Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2024 Fonticons, Inc.
 */const faMessage={prefix:"fas",iconName:"message",icon:[512,512,["comment-alt"],"f27a","M64 0C28.7 0 0 28.7 0 64L0 352c0 35.3 28.7 64 64 64l96 0 0 80c0 6.1 3.4 11.6 8.8 14.3s11.9 2.1 16.8-1.5L309.3 416 448 416c35.3 0 64-28.7 64-64l0-288c0-35.3-28.7-64-64-64L64 0z"]},faChevronUp={prefix:"fas",iconName:"chevron-up",icon:[512,512,[],"f077","M233.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 173.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z"]},faPause={prefix:"fas",iconName:"pause",icon:[320,512,[9208],"f04c","M48 64C21.5 64 0 85.5 0 112L0 400c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48L48 64zm192 0c-26.5 0-48 21.5-48 48l0 288c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48l-32 0z"]},faVectorSquare={prefix:"fas",iconName:"vector-square",icon:[448,512,[],"f5cb","M368 80l32 0 0 32-32 0 0-32zM352 32c-17.7 0-32 14.3-32 32L128 64c0-17.7-14.3-32-32-32L32 32C14.3 32 0 46.3 0 64l0 64c0 17.7 14.3 32 32 32l0 192c-17.7 0-32 14.3-32 32l0 64c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l192 0c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-64c0-17.7-14.3-32-32-32l0-192c17.7 0 32-14.3 32-32l0-64c0-17.7-14.3-32-32-32l-64 0zM96 160c17.7 0 32-14.3 32-32l192 0c0 17.7 14.3 32 32 32l0 192c-17.7 0-32 14.3-32 32l-192 0c0-17.7-14.3-32-32-32l0-192zM48 400l32 0 0 32-32 0 0-32zm320 32l0-32 32 0 0 32-32 0zM48 112l0-32 32 0 0 32-32 0z"]},faChartLine={prefix:"fas",iconName:"chart-line",icon:[512,512,["line-chart"],"f201","M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L240 221.3l57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"]},faArrowRotateRight={prefix:"fas",iconName:"arrow-rotate-right",icon:[512,512,[8635,"arrow-right-rotate","arrow-rotate-forward","redo"],"f01e","M386.3 160L336 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l128 0c17.7 0 32-14.3 32-32l0-128c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 51.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0s-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3s163.8-62.5 226.3 0L386.3 160z"]},faRedo=faArrowRotateRight,faCubes={prefix:"fas",iconName:"cubes",icon:[576,512,[],"f1b3","M290.8 48.6l78.4 29.7L288 109.5 206.8 78.3l78.4-29.7c1.8-.7 3.8-.7 5.7 0zM136 92.5l0 112.2c-1.3 .4-2.6 .8-3.9 1.3l-96 36.4C14.4 250.6 0 271.5 0 294.7L0 413.9c0 22.2 13.1 42.3 33.5 51.3l96 42.2c14.4 6.3 30.7 6.3 45.1 0L288 457.5l113.5 49.9c14.4 6.3 30.7 6.3 45.1 0l96-42.2c20.3-8.9 33.5-29.1 33.5-51.3l0-119.1c0-23.3-14.4-44.1-36.1-52.4l-96-36.4c-1.3-.5-2.6-.9-3.9-1.3l0-112.2c0-23.3-14.4-44.1-36.1-52.4l-96-36.4c-12.8-4.8-26.9-4.8-39.7 0l-96 36.4C150.4 48.4 136 69.3 136 92.5zM392 210.6l-82.4 31.2 0-89.2L392 121l0 89.6zM154.8 250.9l78.4 29.7L152 311.7 70.8 280.6l78.4-29.7c1.8-.7 3.8-.7 5.7 0zm18.8 204.4l0-100.5L256 323.2l0 95.9-82.4 36.2zM421.2 250.9c1.8-.7 3.8-.7 5.7 0l78.4 29.7L424 311.7l-81.2-31.1 78.4-29.7zM523.2 421.2l-77.6 34.1 0-100.5L528 323.2l0 90.7c0 3.2-1.9 6-4.8 7.3z"]},faUpload={prefix:"fas",iconName:"upload",icon:[512,512,[],"f093","M288 109.3L288 352c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-242.7-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352l128 0c0 35.3 28.7 64 64 64s64-28.7 64-64l128 0c35.3 0 64 28.7 64 64l0 32c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64l0-32c0-35.3 28.7-64 64-64zM432 456a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"]},faPlay={prefix:"fas",iconName:"play",icon:[384,512,[9654],"f04b","M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80L0 432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"]},faChevronDown={prefix:"fas",iconName:"chevron-down",icon:[512,512,[],"f078","M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"]},faCirclePlus={prefix:"fas",iconName:"circle-plus",icon:[512,512,["plus-circle"],"f055","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"]};function TimeUpdater({isPlaying:u,setCurrentTime:n}){return useFrame((d,C)=>{u&&n(I=>I+C)}),null}function Sphere({config:u,id:n,onPositionUpdate:d,setApi:C}){const{mass:I,radius:f,position:y,velocity:B,rotation:_=[0,0,0],color:Z="red",restitution:M=.7}=u,V=y||[0,0,0],[T,H]=useSphere(()=>({mass:I,position:V,velocity:B,rotation:_,args:[f],material:{restitution:M}}));reactExports.useEffect(()=>{H&&C(n,H)},[n,H,C]);const F=reactExports.useRef([...V]),O=.01;return useFrame(()=>{var $;if(($=T.current)!=null&&$.position){const U=T.current.position.toArray(),ee=U[0]-F.current[0],Q=U[1]-F.current[1],ie=U[2]-F.current[2],ne=ee*ee+Q*Q+ie*ie,le=F.current.every((ae,ce)=>ae===V[ce]);(ne>O*O||le)&&(F.current=[...U],d({id:n,x:U[0],y:U[1],z:U[2]}))}}),jsxRuntimeExports.jsxs("mesh",{ref:T,castShadow:!0,children:[jsxRuntimeExports.jsx("sphereGeometry",{args:[f,32,32]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:Z})]})}function Box({config:u,id:n,onPositionUpdate:d,setApi:C}){const{mass:I,dimensions:f,position:y,velocity:B,rotation:_=[0,0,0],color:Z="green",restitution:M=.7}=u,[V,T,H]=f||[1,1,1],F=y||[0,0,0],[O,$]=useBox(()=>({mass:I,position:F,velocity:B,rotation:_,args:[V,T,H],material:{restitution:M}}));reactExports.useEffect(()=>{$&&C(n,$)},[n,$,C]);const U=reactExports.useRef([...F]),ee=.01;return useFrame(()=>{var Q;if((Q=O.current)!=null&&Q.position){const ie=O.current.position.toArray(),ne=ie[0]-U.current[0],le=ie[1]-U.current[1],ae=ie[2]-U.current[2],ce=ne*ne+le*le+ae*ae,ge=U.current.every((he,Ie)=>he===F[Ie]);(ce>ee*ee||ge)&&(U.current=[...ie],d({id:n,x:ie[0],y:ie[1],z:ie[2]}))}}),jsxRuntimeExports.jsxs("mesh",{ref:O,castShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[V,T,H]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:Z})]})}function Cylinder({config:u,id:n,onPositionUpdate:d,setApi:C}){const{mass:I,radius:f,height:y,position:B,velocity:_,rotation:Z=[0,0,0],color:M="blue",restitution:V=.7}=u,T=B||[0,0,0],[H,F]=useCylinder(()=>({mass:I,position:T,velocity:_,rotation:Z,args:[f,f,y,16],material:{restitution:V}}));reactExports.useEffect(()=>{F&&C(n,F)},[n,F,C]);const O=reactExports.useRef([...T]),$=.01;return useFrame(()=>{var U;if((U=H.current)!=null&&U.position){const ee=H.current.position.toArray(),Q=ee[0]-O.current[0],ie=ee[1]-O.current[1],ne=ee[2]-O.current[2],le=Q*Q+ie*ie+ne*ne,ae=O.current.every((ce,ge)=>ce===T[ge]);(le>$*$||ae)&&(O.current=[...ee],d({id:n,x:ee[0],y:ee[1],z:ee[2]}))}}),jsxRuntimeExports.jsxs("mesh",{ref:H,castShadow:!0,children:[jsxRuntimeExports.jsx("cylinderGeometry",{args:[f,f,y,16]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:M})]})}function SceneBox({config:u,id:n,onPositionUpdate:d,setApi:C}){const{mass:I=0,dimensions:f=[10,.2,10],position:y=[0,0,0],velocity:B=[0,0,0],rotation:_=[0,0,0],color:Z="#88aa88",restitution:M=.3}=u,[V,T,H]=f,F=y||[0,0,0],[O,$]=useBox(()=>({mass:I,position:F,velocity:B,rotation:_,args:[V,T,H],material:{friction:.5,restitution:M}}));reactExports.useEffect(()=>{$&&C(n,$)},[n,$,C]);const U=reactExports.useRef([...F]),ee=.01;return useFrame(()=>{var Q;if((Q=O.current)!=null&&Q.position){const ie=O.current.position.toArray(),ne=ie[0]-U.current[0],le=ie[1]-U.current[1],ae=ie[2]-U.current[2],ce=ne*ne+le*le+ae*ae;(U.current.every((he,Ie)=>he===F[Ie])||I>0&&ce>ee*ee)&&(U.current=[...ie],d({id:n,x:ie[0],y:ie[1],z:ie[2]}))}}),jsxRuntimeExports.jsxs("mesh",{ref:O,receiveShadow:!0,castShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[V,T,H]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:Z})]})}function GroundPlane(){const[u]=usePlane(()=>({mass:0,rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.5,restitution:.3}}));return jsxRuntimeExports.jsxs("mesh",{ref:u,receiveShadow:!0,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[100,100]})," ",jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#88aa88",side:DoubleSide})]})}function FpsCounter({setFps:u}){const n=reactExports.useRef(performance.now()),d=reactExports.useRef(0);return useFrame(()=>{const C=performance.now();d.current+=1;const I=C-n.current;I>=1e3&&(u(Math.round(d.current*1e3/I)),d.current=0,n.current=C)}),null}function SimpleGrid(){return jsxRuntimeExports.jsx(Grid,{position:[0,.01,0],args:[100,100],cellColor:"#aaaaaa",sectionColor:"#888888",sectionSize:10,cellSize:1,fadeDistance:200,fadeStrength:1,infiniteGrid:!1})}function Visualizer({scene:u,onPositionUpdate:n,onAddGraph:d}){const[C,I]=reactExports.useState(0),[f,y]=reactExports.useState(!1),[B,_]=reactExports.useState(0),Z=reactExports.useRef({}),M=reactExports.useRef(u!=null&&u.objects?JSON.parse(JSON.stringify(u.objects)):[]),[V,T]=reactExports.useState([]),H=reactExports.useRef({}),[F,O]=reactExports.useState({}),[$,U]=reactExports.useState(!1),{gravity:ee=[0,-9.81,0],contactMaterial:Q={}}=u||{},ie=(u==null?void 0:u.objects)||[],ne={friction:Q.friction||.5,restitution:Q.restitution||.7},le=reactExports.useCallback((fe,me)=>{Z.current[fe]=me},[]),ae=reactExports.useCallback(()=>{H.current={},O({}),M.current.forEach((fe,me)=>{var ye;const Ge=fe.id!==void 0&&fe.id!==null&&fe.id!==""?String(fe.id):`${((ye=fe.type)==null?void 0:ye.toLowerCase())||"obj"}-${me}`,Ze=Z.current[Ge];if(Ze){Ze.wakeUp();const Ee=fe.position||[0,0,0],Ve=fe.velocity||[0,0,0],Ye=fe.rotation||[0,0,0],be=fe.angularVelocity||[0,0,0];Ze.position.set(...Ee),Ze.velocity.set(...Ve),Ze.rotation.set(...Ye),Ze.angularVelocity.set(...be)}}),y(!1),_(0)},[Z,M]),ce=reactExports.useCallback(({id:fe,x:me,y:Ge,z:Ze})=>{H.current[fe]=H.current[fe]||[],H.current[fe].push({x:me,y:Ge,z:Ze,t:B}),typeof n=="function"&&n({id:fe,x:me,y:Ge,z:Ze,t:B})},[B,n]),ge=reactExports.useCallback(fe=>{const me=`graph-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;T(Ge=>[...Ge,{id:me,initialType:fe}]),U(!1),typeof d=="function"&&d({id:me,initialType:fe})},[d]),he=reactExports.useCallback(fe=>{T(me=>me.filter(Ge=>Ge.id!==fe))},[]);reactExports.useEffect(()=>{M.current=u!=null&&u.objects?JSON.parse(JSON.stringify(u.objects)):[],ae()},[u,ae]),reactExports.useEffect(()=>{const fe=setInterval(()=>{O({...H.current})},100);return()=>clearInterval(fe)},[]);const Ie=()=>{y(fe=>!fe)};return jsxRuntimeExports.jsxs("div",{className:"visualizer",children:[jsxRuntimeExports.jsxs("div",{className:"controllbar",children:[jsxRuntimeExports.jsx("button",{onClick:()=>alert("2D/3D toggle not implemented yet"),children:"2D/3D"}),jsxRuntimeExports.jsxs("div",{className:"graphs-dropdown-container",children:[jsxRuntimeExports.jsxs("button",{className:"graphs-button",onClick:()=>U(fe=>!fe),"aria-expanded":$,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faChartLine,style:{marginRight:"5px"}}),"Graphs",jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:$?faChevronUp:faChevronDown,style:{marginLeft:"5px"}})]}),$&&jsxRuntimeExports.jsx("div",{className:"graphs-dropdown-menu",children:[{label:"Y vs T",value:"yvt"},{label:"X vs T",value:"xvt"},{label:"Z vs T",value:"zvt"},{label:"Y vs X",value:"yvx"}].map(fe=>jsxRuntimeExports.jsx("button",{onClick:()=>ge(fe.value),className:"dropdown-item",children:fe.label},fe.value))})]})]}),jsxRuntimeExports.jsxs(Canvas,{style:{height:"100%",width:"100%"},shadows:!0,gl:{logLevel:"errors"},camera:{position:[10,5,25],fov:50,near:.1,far:2e4},children:[jsxRuntimeExports.jsx(TimeUpdater,{isPlaying:f,setCurrentTime:_}),jsxRuntimeExports.jsx("ambientLight",{intensity:.6}),jsxRuntimeExports.jsx("directionalLight",{position:[8,10,5],intensity:1,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10}),jsxRuntimeExports.jsx("pointLight",{position:[-10,-10,-10],intensity:.3}),jsxRuntimeExports.jsxs(PhysicsProvider,{gravity:ee,defaultContactMaterial:ne,isPaused:!f,children:[jsxRuntimeExports.jsx(GroundPlane,{})," ",ie.map((fe,me)=>{var ye;const Ge=fe.id!==void 0&&fe.id!==null&&fe.id!==""?String(fe.id):`${((ye=fe.type)==null?void 0:ye.toLowerCase())||"obj"}-${me}`,Ze={...fe,id:Ge};switch(Ze.type){case"Sphere":return jsxRuntimeExports.jsx(Sphere,{config:Ze,id:Ge,onPositionUpdate:ce,setApi:le},Ge);case"Box":return jsxRuntimeExports.jsx(Box,{config:Ze,id:Ge,onPositionUpdate:ce,setApi:le},Ge);case"Cylinder":return jsxRuntimeExports.jsx(Cylinder,{config:Ze,id:Ge,onPositionUpdate:ce,setApi:le},Ge);case"Plane":return jsxRuntimeExports.jsx(SceneBox,{config:{...Ze,mass:Ze.mass??0},id:Ge,onPositionUpdate:ce,setApi:le},Ge);default:return console.warn(`Unsupported object type: ${Ze.type}`),null}})]}),jsxRuntimeExports.jsx(OrbitControls,{}),jsxRuntimeExports.jsx("axesHelper",{args:[5]})," ",jsxRuntimeExports.jsx(SimpleGrid,{}),jsxRuntimeExports.jsx(FpsCounter,{setFps:I})]}),jsxRuntimeExports.jsxs("div",{className:"timeControllbar",children:[jsxRuntimeExports.jsxs("button",{onClick:Ie,style:{padding:"5px",marginLeft:"5px"},children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:f?faPause:faPlay})," "]}),jsxRuntimeExports.jsxs("button",{onClick:ae,style:{padding:"5px",marginRight:"5px"},children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faRedo})," "]}),jsxRuntimeExports.jsxs("span",{className:"time-display",children:["Time: ",B.toFixed(3),"s"]})]}),jsxRuntimeExports.jsxs("div",{className:"fps-counter",children:["FPS: ",C]}),V.map(fe=>jsxRuntimeExports.jsx(OverlayGraph,{id:fe.id,initialType:fe.initialType,data:F,onClose:he},fe.id))]})}function RightPanel({onChat:u,onProperties:n}){return jsxRuntimeExports.jsxs("div",{className:"rightPanelContainer",children:[jsxRuntimeExports.jsx("div",{className:"properties",onClick:n,children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faVectorSquare})}),jsxRuntimeExports.jsx("div",{className:"chat",onClick:u,children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faMessage})})]})}function LeftPanel({onSceneExamples:u,onCreateScene:n,onUploadScene:d}){return jsxRuntimeExports.jsxs("div",{className:"leftPanelContainer",children:[jsxRuntimeExports.jsx("div",{className:"scene-examples",onClick:u,children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCubes})}),jsxRuntimeExports.jsx("div",{className:"create-scene",onClick:n,children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCirclePlus})}),jsxRuntimeExports.jsx("div",{className:"upload-scene",onClick:d,children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faUpload})})]})}function Conversation({updateConversation:u,conversationHistory:n=[],initialMessage:d="Hello! How can I help you with physics today?"}){const[C,I]=reactExports.useState(""),[f,y]=reactExports.useState(!1),[B,_]=reactExports.useState("gemini"),Z="AIzaSyBcFtkw2fZWMPQKhvUuCrpu1Qc_4Qq3dIQ",M=reactExports.useRef(!1);reactExports.useEffect(()=>{M.current||(u([{role:"ai",content:d}]),M.current=!0)},[d,u]);const V=async H=>{var $,U,ee,Q,ie;H.preventDefault();const F=C.trim();if(!F){alert("Please enter a question.");return}u(ne=>[...ne,{role:"user",content:F}]),I(""),y(!0);let O="I couldn't process that.";try{if(B==="chatgpt"){console.log("🔁 Trying ChatGPT via Puppeteer...");const ne=await fetch("http://localhost:3000/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:F})});if(!ne.ok){const ae=await ne.text();throw console.error("ChatGPT Error:",ae),new Error(`HTTP error! Status: ${ne.status}`)}O=(await ne.json()).response||O}else if(B==="ollama"){const ne=["gemma3","gemma3:1b"];let le=!1;for(const ae of ne)try{console.log(`🔁 Trying Ollama model: ${ae}`);const ce=await fetch("http://localhost:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ae,prompt:F,stream:!1})});if(!ce.ok){const he=await ce.text();throw console.error("Ollama Error:",he),new Error(`Ollama HTTP error! Status: ${ce.status}`)}const ge=await ce.json();console.log("Ollama Response:",JSON.stringify(ge,null,2)),O=ge.response||O,le=!0;break}catch(ce){console.warn(`❌ Failed with Ollama ${ae}: ${ce.message}`)}if(!le)throw new Error("All Ollama models failed.")}else if(B==="gemini"&&Z){console.log("🔁 Trying Gemini API...");const ne=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=${Z}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:F}]}]})});if(!ne.ok){const ae=await ne.text();throw console.error("Gemini API Error:",ae),new Error(`Gemini HTTP error! Status: ${ne.status}`)}const le=await ne.json();console.log("Gemini API Response:",JSON.stringify(le,null,2)),O=((ie=(Q=(ee=(U=($=le.candidates)==null?void 0:$[0])==null?void 0:U.content)==null?void 0:ee.parts)==null?void 0:Q[0])==null?void 0:ie.text)||O}u(ne=>[...ne,{role:"ai",content:O}])}catch(ne){console.error(`❌ Model failed: ${ne.message}`),u(le=>[...le,{role:"ai",content:"Error: Model failed. Ensure setup is correct."}])}finally{y(!1)}},T=n.slice(-10).map((H,F)=>jsxRuntimeExports.jsx("div",{className:H.role==="ai"?"ai-message":"user-message",children:jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:H.role==="ai"?"AI:":"You:"})," ",H.content]})},F));return jsxRuntimeExports.jsxs("div",{className:"conversation-container",children:[jsxRuntimeExports.jsxs("div",{className:"model-selector",children:[jsxRuntimeExports.jsx("label",{htmlFor:"model-select",children:"Select Model: "}),jsxRuntimeExports.jsxs("select",{id:"model-select",value:B,onChange:H=>_(H.target.value),disabled:f,children:[jsxRuntimeExports.jsx("option",{value:"gemini",children:"Gemini (Google AI Studio)"}),jsxRuntimeExports.jsx("option",{value:"chatgpt",children:"ChatGPT (Puppeteer)"}),jsxRuntimeExports.jsx("option",{value:"ollama",children:"Ollama"})]})]}),jsxRuntimeExports.jsx("div",{className:"conversation-box",children:T}),jsxRuntimeExports.jsxs("form",{className:"input-section",onSubmit:V,children:[jsxRuntimeExports.jsx("textarea",{className:"input-textarea",value:C,onChange:H=>I(H.target.value),placeholder:"Enter your physics question...",disabled:f}),jsxRuntimeExports.jsx("button",{type:"submit",className:"process-button",disabled:f||!C.trim(),children:f?"Processing...":"Process"})]})]})}const mechanicsExamples=[{id:"all-shapes-scene",name:"All Shapes Scene",description:"A scene with all supported physics shapes interacting dynamically.",objects:[{id:"sphere-1",type:"Sphere",mass:1,radius:.5,position:[0,4,0],velocity:[0,0,0],color:"#ff6347",restitution:.7,friction:.4},{id:"box-1",type:"Box",mass:1.5,dimensions:[1,1,1],position:[2,4,0],velocity:[0,0,0],color:"#32cd32",restitution:.8,friction:.5},{id:"cylinder-1",type:"Cylinder",mass:2,radius:.5,height:1.5,position:[-2,4,0],velocity:[0,0,0],color:"#4682b4",restitution:.6,friction:.3},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"circular-collision-10-balls Gemini 2.5 ",name:"10 Balls Circular Collision Gemini 2.5",description:"10 balls arranged in a circle, moving towards the center",objects:[{id:"ball-0",type:"Sphere",mass:10,radius:.5,position:[5,1,0],velocity:[-2,10,0],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-1",type:"Sphere",mass:10,radius:.5,position:[4.045,1,2.939],velocity:[-1.618,10,-1.176],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-2",type:"Sphere",mass:10,radius:.5,position:[1.545,1,4.755],velocity:[-.618,10,-1.902],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-3",type:"Sphere",mass:10,radius:.5,position:[-1.545,1,4.755],velocity:[.618,10,-1.902],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-4",type:"Sphere",mass:10,radius:.5,position:[-4.045,1,2.939],velocity:[1.618,10,-1.176],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-5",type:"Sphere",mass:10,radius:.5,position:[-5,1,0],velocity:[2,10,0],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-6",type:"Sphere",mass:10,radius:.5,position:[-4.045,1,-2.939],velocity:[1.618,10,1.176],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-7",type:"Sphere",mass:10,radius:.5,position:[-1.545,1,-4.755],velocity:[.618,10,1.902],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-8",type:"Sphere",mass:10,radius:.5,position:[1.545,1,-4.755],velocity:[-.618,10,1.902],rotation:[0,0,0],color:"#ff6347",restitution:.7},{id:"ball-9",type:"Sphere",mass:10,radius:.5,position:[4.045,1,-2.939],velocity:[-1.618,10,1.176],rotation:[0,0,0],color:"#ff6347",restitution:.7}],gravity:[0,-9.81,0],contactMaterial:{friction:.5,restitution:.7}},{id:"projectile-motion",name:"Projectile Motion",description:"A sphere launched to show parabolic trajectory under gravity.",objects:[{id:"projectile-sphere",type:"Sphere",mass:1,radius:.3,position:[-5,1,0],velocity:[6,4,0],color:"#ff4500",restitution:.9,friction:.4},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"collision-demo",name:"Elastic Collision",description:"Two spheres colliding to demonstrate momentum conservation.",objects:[{id:"sphere-left",type:"Sphere",mass:1,radius:.5,position:[-4,3,0],velocity:[3,0,0],color:"#1e90ff",restitution:.95,friction:.3},{id:"sphere-right",type:"Sphere",mass:1,radius:.5,position:[4,3,0],velocity:[-3,0,0],color:"#ff69b4",restitution:.95,friction:.3},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"inclined-plane",name:"Inclined Plane",description:"A box sliding down a ramp to illustrate gravity and friction.",objects:[{id:"sliding-box",type:"Box",mass:1,dimensions:[.5,.5,.5],position:[6,6,-2],velocity:[0,0,0],color:"#ff69b4",restitution:.5,friction:.4},{id:"sliding-ball",type:"Sphere",mass:1,radius:.5,position:[6,6,2],velocity:[0,0,0],color:"yellow",restitution:.5,friction:.4},{id:"ramp",type:"Box",mass:0,dimensions:[20,.2,10],position:[0,.5,0],rotation:[0,0,Math.PI/6],velocity:[0,0,0],color:"#228b22",restitution:.7,friction:.5},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"narrow-walls-collision",name:"Narrow Walls ",description:"A ball bouncing between two vertical walls that move closer together.",objects:[{id:"ball",type:"Sphere",mass:1,radius:.3,position:[0,10,0],velocity:[20,0,0],color:"#ffd700",restitution:.95,friction:.2},{id:"left-wall",type:"Box",mass:0,dimensions:[.2,20,2],position:[-3,5,0],velocity:[0,0,0],rotation:[0,0,.1],color:"#4682b4",restitution:.95,friction:.2},{id:"right-wall",type:"Box",mass:0,dimensions:[.2,20,2],position:[3,5,0],velocity:[0,0,0],rotation:[0,0,-.1],color:"#4682b4",restitution:.95,friction:.2},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"stacking-demo",name:"Stacking Demo",description:"Boxes stacked to test stability and gravity in a pile.",objects:[{id:"box-1",type:"Box",mass:1,dimensions:[1,1,1],position:[0,1,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"box-2",type:"Box",mass:1,dimensions:[2,1,2],position:[0,4,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"box-3",type:"Box",mass:1,dimensions:[3,1,3],position:[0,6,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]}],extractedScenes=[];function SceneSelector({currentScene:u,onSceneChange:n,conversationHistory:d}){var O,$,U,ee;const[C,I]=reactExports.useState([...mechanicsExamples,...extractedScenes]),[f,y]=reactExports.useState(!1),[B,_]=reactExports.useState(null),[Z,M]=reactExports.useState({}),V="AIzaSyBcFtkw2fZWMPQKhvUuCrpu1Qc_4Qq3dIQ",T=async()=>{var Q,ie,ne,le,ae,ce;if(!d.length){_("No conversation history to extract from.");return}y(!0),_(null);try{const he=`Extract a physics scene from this conversation:
${d.map(ye=>`${ye.role}: ${ye.content}`).join(`
`)}
Convert it into a plain JSON object matching the format below. Supported object types are "Sphere", "Box", "Cylinder", and "Box" (used for planes or platforms). Required fields for each type are listed; optional fields can be omitted if not specified. Use numeric values for all fields (e.g., 0.78539816339 for 45 degrees, 1.57079632679 for 90 degrees). If the conversation lacks details, use reasonable defaults (e.g., mass 1 for dynamic objects, 0 for static platforms, position [0, 0, 0]).

**Important:** Return the JSON object alone, without any additional text, comments, or Markdown (e.g., no json markers, no explanations). The response must be parseable directly as JSON by a program. Do not wrap it in code blocks or add formatting.

Example of expected output:
{"id":"example","name":"Bouncing Ball and Ramp","description":"A ball bounces on a sloped platform","objects":[{"id":"ball-1","type":"Sphere","mass":2,"radius":0.5,"position":[0,5,0],"velocity":[0,0,0],"rotation":[0,0,0],"color":"#ff6347","restitution":0.7},{"id":"ramp-1","type":"Box","mass":0,"dimensions":[5,0.2,5],"position":[0,0,0],"rotation":[0.52359877559,0,0],"color":"#88aa88","restitution":0.3},{"id":"cyl-1","type":"Cylinder","mass":1,"radius":0.3,"height":1.5,"position":[2,3,0],"velocity":[0,0,0],"rotation":[0,0,0],"color":"#4682b4","restitution":0.5}],"gravity":[0,-9.81,0],"contactMaterial":{"friction":0.5,"restitution":0.7}}

Required fields by type:
- "Sphere": "id", "type", "mass", "radius", "position"
- "Box": "id", "type", "mass", "dimensions" (array of 3 numbers: width, height, depth), "position"
- "Cylinder": "id", "type", "mass", "radius", "height", "position"
Optional fields for all types: "velocity" (default [0, 0, 0]), "rotation" (default [0, 0, 0]), "color" (default "#ff6347"), "restitution" (default 0.7, range 0 to 1).

Scene-level fields:
- "id": unique string (default to a timestamp if missing)
- "name": string (default "Extracted Scene")
- "description": string (default "Scene from conversation")
- "objects": array of objects (empty array if none found)
- "gravity": array of 3 numbers (default [0, -9.81, 0])
- "contactMaterial": object with "friction" (default 0.5) and "restitution" (default 0.7)

If no physics scene is identifiable, return this exact JSON object:
{"id":"empty","name":"No Scene Found","description":"No physics scene in conversation","objects":[],"gravity":[0,-9.81,0],"contactMaterial":{"friction":0.5,"restitution":0.7}}
`,Ie=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=${V}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:he}]}]})});if(!Ie.ok)throw new Error(`HTTP error! Status: ${Ie.status}`);const me=((ae=(le=(ne=(ie=(Q=(await Ie.json()).candidates)==null?void 0:Q[0])==null?void 0:ie.content)==null?void 0:ne.parts)==null?void 0:le[0])==null?void 0:ae.text)||"";let Ge;try{Ge=JSON.parse(me)}catch{const Ee=((ce=me.match(/```json\s*([\s\S]*?)\s*```/))==null?void 0:ce[1])||me.replace(/^.*?(\{.*\})/s,"$1").trim();Ge=JSON.parse(Ee)}Ge.id=Ge.id||`extracted-${Date.now()}`,Ge.name=Ge.name||`Extracted Scene ${extractedScenes.length+1}`,Ge.description=Ge.description||"Scene from conversation",Ge.objects=Array.isArray(Ge.objects)?Ge.objects:[],Ge.gravity=Array.isArray(Ge.gravity)&&Ge.gravity.length===3?Ge.gravity:[0,-9.81,0],Ge.contactMaterial=Ge.contactMaterial||{friction:.5,restitution:.7},Ge.objects=Ge.objects.map(ye=>{const Ee={id:ye.id||`obj-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:ye.type||"Sphere",mass:typeof ye.mass=="number"?ye.mass:ye.type==="Box"&&ye.dimensions?0:1,position:Array.isArray(ye.position)&&ye.position.length===3?ye.position:[0,0,0],velocity:Array.isArray(ye.velocity)&&ye.velocity.length===3?ye.velocity:[0,0,0],rotation:Array.isArray(ye.rotation)&&ye.rotation.length===3?ye.rotation:[0,0,0],color:typeof ye.color=="string"&&ye.color.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)?ye.color:"#ff6347",restitution:typeof ye.restitution=="number"&&ye.restitution>=0&&ye.restitution<=1?ye.restitution:.7};switch(Ee.type){case"Sphere":Ee.radius=typeof ye.radius=="number"&&ye.radius>0?ye.radius:.5;break;case"Box":Ee.dimensions=Array.isArray(ye.dimensions)&&ye.dimensions.length===3?ye.dimensions:[1,1,1];break;case"Cylinder":Ee.radius=typeof ye.radius=="number"&&ye.radius>0?ye.radius:.5,Ee.height=typeof ye.height=="number"&&ye.height>0?ye.height:1;break;default:Ee.type="Sphere",Ee.radius=.5;break}return Ee});const Ze=[Ge,...extractedScenes];I([...Ze,...mechanicsExamples])}catch(ge){_(`Scene extraction failed: ${ge.message}`);const Ie=[{id:`extracted-${Date.now()}`,name:"Error Scene",description:"Failed to extract scene",objects:[],gravity:[0,-9.81,0],contactMaterial:{friction:.5,restitution:.7}},...extractedScenes];I([...Ie,...mechanicsExamples])}finally{y(!1)}},H=Q=>{n(Q),M({})},F=Q=>{M(ie=>({...ie,[Q]:!ie[Q]}))};return jsxRuntimeExports.jsx("div",{className:"scene-selector-container",children:jsxRuntimeExports.jsxs("div",{className:"scene-selector",children:[jsxRuntimeExports.jsxs("div",{className:"scene-selector-header",children:[jsxRuntimeExports.jsx("button",{className:`extract-button ${f?"extracting":""}`,onClick:T,disabled:f,"aria-busy":f,"aria-label":"Extract scene from conversation",children:f?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"spinner","aria-hidden":"true"})," Extracting..."]}):"Extract Scene from Conversation"}),B&&jsxRuntimeExports.jsx("div",{className:"error-message",role:"alert",children:B})]}),jsxRuntimeExports.jsxs(PanelGroup,{direction:"vertical",children:[jsxRuntimeExports.jsxs(Panel,{defaultSize:60,minSize:20,className:"scene-list-panel",children:[jsxRuntimeExports.jsx("h3",{className:"scene-list-title",children:"Scene Examples"}),jsxRuntimeExports.jsx("ul",{className:"scene-list",children:C.map(Q=>jsxRuntimeExports.jsxs("li",{onClick:()=>H(Q),className:`scene-item ${u.id===Q.id?"selected":""}`,title:Q.description,role:"button",tabIndex:0,onKeyDown:ie=>ie.key==="Enter"&&H(Q),"aria-label":`Select scene: ${Q.name}`,children:[jsxRuntimeExports.jsx("div",{className:"scene-name",children:Q.name}),jsxRuntimeExports.jsx("div",{className:"scene-description",children:Q.description})]},Q.id))})]}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"panel-resize-handle"}),jsxRuntimeExports.jsx(Panel,{minSize:20,className:"scene-details-panel",children:jsxRuntimeExports.jsxs("div",{className:"scene-details",children:[jsxRuntimeExports.jsxs("h4",{className:"inspector-header",children:["Current Scene: ",u.name]}),jsxRuntimeExports.jsxs("div",{className:"details-content",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Description:"})," ",u.description]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("strong",{className:"scene-properties-title",children:["Objects (",u.objects.length,"):"]}),u.objects.length>0?jsxRuntimeExports.jsx("ul",{className:"object-list",children:u.objects.map((Q,ie)=>jsxRuntimeExports.jsxs("li",{className:"object-list-item",children:[jsxRuntimeExports.jsxs("div",{className:`object-header ${Z[Q.id||ie]?"":"collapsed"}`,onClick:()=>F(Q.id||ie),role:"button",tabIndex:0,onKeyDown:ne=>ne.key==="Enter"&&F(Q.id||ie),"aria-expanded":!!Z[Q.id||ie],"aria-label":`Toggle details for ${Q.type} (${Q.id})`,children:[jsxRuntimeExports.jsx("span",{className:"toggle-icon"}),jsxRuntimeExports.jsxs("span",{className:"object-title",children:[jsxRuntimeExports.jsx("span",{className:"object-type",children:Q.type}),jsxRuntimeExports.jsxs("span",{className:"object-id",children:["(",Q.id,")"]})]})]}),Z[Q.id||ie]&&jsxRuntimeExports.jsxs("div",{className:"object-properties",children:[jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Mass:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:[Q.mass," kg"]})]}),jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Position:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:["[",Q.position.map(ne=>ne.toFixed(2)).join(", "),"] m"]})]}),Q.velocity&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Velocity:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:["[",Q.velocity.map(ne=>ne.toFixed(2)).join(", "),"] m/s"]})]}),Q.rotation&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Rotation:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:["[",Q.rotation.map(ne=>(ne*180/Math.PI).toFixed(2)).join(", "),"]°"]})]}),jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Color:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:[jsxRuntimeExports.jsx("span",{className:"color-preview",style:{backgroundColor:Q.color}}),Q.color]})]}),typeof Q.restitution=="number"&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Restitution:"}),jsxRuntimeExports.jsx("span",{className:"property-value",children:Q.restitution.toFixed(2)})]}),Q.type==="Sphere"&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Radius:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:[Q.radius," m"]})]}),Q.type==="Box"&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Dimensions:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:["[",Q.dimensions.join(", "),"] m"]})]}),Q.type==="Cylinder"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Radius:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:[Q.radius," m"]})]}),jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Height:"}),jsxRuntimeExports.jsxs("span",{className:"property-value",children:[Q.height," m"]})]})]}),typeof Q.friction=="number"&&jsxRuntimeExports.jsxs("div",{className:"property-row",children:[jsxRuntimeExports.jsx("span",{className:"property-name",children:"Friction:"}),jsxRuntimeExports.jsx("span",{className:"property-value",children:Q.friction.toFixed(2)})]})]})]},Q.id||ie))}):jsxRuntimeExports.jsx("p",{className:"placeholder-text",children:"No objects in this scene."})]}),jsxRuntimeExports.jsxs("div",{className:"scene-properties",children:[jsxRuntimeExports.jsx("span",{className:"scene-properties-title",children:"Scene Properties"}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Gravity:"})," [",u.gravity.join(", "),"] m/s²"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Contact Material:"})," Friction:"," ",(($=(O=u.contactMaterial)==null?void 0:O.friction)==null?void 0:$.toFixed(2))??"N/A",", Restitution:"," ",((ee=(U=u.contactMaterial)==null?void 0:U.restitution)==null?void 0:ee.toFixed(2))??"N/A"]})]})]})]})})]})]})})}function App(){const[u,n]=reactExports.useState(mechanicsExamples[0]),[d,C]=reactExports.useState({}),[I,f]=reactExports.useState(null),[y,B]=reactExports.useState(null),[_,Z]=reactExports.useState([{role:"ai",content:"Hello! How can I help you with physics today?"}]),[M,V]=reactExports.useState([]),T=Q=>{const{id:ie,x:ne,y:le,z:ae,t:ce}=Q;C(ge=>{const Ie=[...ge[ie]||[],{x:ne,y:le,t:ce}];return{...ge,[ie]:Ie}})},H=Q=>{n(Q),C({})},F=Q=>{f(ie=>ie===Q?null:Q)},O=Q=>{B(ie=>ie===Q?null:Q)},$=reactExports.useCallback(Q=>{Z(Q)},[]),U=reactExports.useCallback(Q=>{const ie={id:Date.now(),type:Q};V(ne=>[...ne,ie])},[]),ee=reactExports.useCallback(Q=>{V(ie=>ie.filter(ne=>ne.id!==Q))},[]);return jsxRuntimeExports.jsxs("div",{className:"main",children:[jsxRuntimeExports.jsx(TopMenu,{onAddGraph:U}),jsxRuntimeExports.jsx(PanelGroup,{direction:"vertical",children:jsxRuntimeExports.jsx(Panel,{className:"main-panel",defaultSize:100,children:jsxRuntimeExports.jsxs(PanelGroup,{direction:"horizontal",children:[jsxRuntimeExports.jsx("div",{className:"left-section",children:jsxRuntimeExports.jsx(LeftPanel,{onSceneExamples:()=>F("scene-examples"),onCreateScene:()=>F("creat-scene"),onUploadScene:()=>F("upload-scene")})}),I==="scene-examples"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Panel,{className:"component-section examples-panel",defaultSize:30,minSize:15,order:0,children:jsxRuntimeExports.jsx(SceneSelector,{currentScene:u,onSceneChange:H,conversationHistory:_})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"})]}),jsxRuntimeExports.jsx(Panel,{className:"visualization-section",defaultSize:70,minSize:30,order:1,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx(Visualizer,{scene:u,onPositionUpdate:T},u.id),M.map(Q=>jsxRuntimeExports.jsx(OverlayGraph,{id:Q.id,initialType:Q.type,data:d,onClose:ee},Q.id))]})}),y==="chat"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsx(Panel,{className:"solution-section",minSize:5,defaultSize:30,order:2,children:jsxRuntimeExports.jsx("div",{className:"content-section",children:jsxRuntimeExports.jsx(Conversation,{updateConversation:$,conversationHistory:_})})})]}),jsxRuntimeExports.jsx("div",{className:"right-section",children:jsxRuntimeExports.jsx(RightPanel,{onChat:()=>O("chat"),onProperties:()=>O("properties")})})]})})})]})}clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
