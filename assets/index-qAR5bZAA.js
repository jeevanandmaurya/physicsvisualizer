var pC=Object.defineProperty;var AC=(n,t,o)=>t in n?pC(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o;var qh=(n,t,o)=>AC(n,typeof t!="symbol"?t+"":t,o);function _mergeNamespaces(n,t){for(var o=0;o<t.length;o++){const u=t[o];if(typeof u!="string"&&!Array.isArray(u)){for(const d in u)if(d!=="default"&&!(d in n)){const C=Object.getOwnPropertyDescriptor(u,d);C&&Object.defineProperty(n,d,C.get?C:{enumerable:!0,get:()=>u[d]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const C of d)if(C.type==="childList")for(const I of C.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&u(I)}).observe(document,{childList:!0,subtree:!0});function o(d){const C={};return d.integrity&&(C.integrity=d.integrity),d.referrerPolicy&&(C.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?C.credentials="include":d.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function u(d){if(d.ep)return;d.ep=!0;const C=o(d);fetch(d.href,C)}})();function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var o=function u(){return this instanceof u?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};o.prototype=t.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(n).forEach(function(u){var d=Object.getOwnPropertyDescriptor(n,u);Object.defineProperty(o,u,d.get?d:{enumerable:!0,get:function(){return n[u]}})}),o}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function o(u,d,C){var I=null;if(C!==void 0&&(I=""+C),d.key!==void 0&&(I=""+d.key),"key"in d){C={};for(var f in d)f!=="key"&&(C[f]=d[f])}else C=d;return d=C.ref,{$$typeof:n,type:u,key:I,ref:d!==void 0?d:null,props:C}}return reactJsxRuntime_production.Fragment=t,reactJsxRuntime_production.jsx=o,reactJsxRuntime_production.jsxs=o,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),I=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),S=Symbol.iterator;function w(he){return he===null||typeof he!="object"?null:(he=S&&he[S]||he["@@iterator"],typeof he=="function"?he:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,T={};function H(he,Ie,Be){this.props=he,this.context=Ie,this.refs=T,this.updater=Be||M}H.prototype.isReactComponent={},H.prototype.setState=function(he,Ie){if(typeof he!="object"&&typeof he!="function"&&he!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,he,Ie,"setState")},H.prototype.forceUpdate=function(he){this.updater.enqueueForceUpdate(this,he,"forceUpdate")};function J(){}J.prototype=H.prototype;function z(he,Ie,Be){this.props=he,this.context=Ie,this.refs=T,this.updater=Be||M}var L=z.prototype=new J;L.constructor=z,V(L,H.prototype),L.isPureReactComponent=!0;var K=Array.isArray,O={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function ee(he,Ie,Be,ue,me,xe){return Be=xe.ref,{$$typeof:n,type:he,key:Ie,ref:Be!==void 0?Be:null,props:xe}}function ie(he,Ie){return ee(he.type,Ie,void 0,void 0,void 0,he.props)}function te(he){return typeof he=="object"&&he!==null&&he.$$typeof===n}function se(he){var Ie={"=":"=0",":":"=2"};return"$"+he.replace(/[=:]/g,function(Be){return Ie[Be]})}var ae=/\/+/g;function le(he,Ie){return typeof he=="object"&&he!==null&&he.key!=null?se(""+he.key):Ie.toString(36)}function ge(){}function be(he){switch(he.status){case"fulfilled":return he.value;case"rejected":throw he.reason;default:switch(typeof he.status=="string"?he.then(ge,ge):(he.status="pending",he.then(function(Ie){he.status==="pending"&&(he.status="fulfilled",he.value=Ie)},function(Ie){he.status==="pending"&&(he.status="rejected",he.reason=Ie)})),he.status){case"fulfilled":return he.value;case"rejected":throw he.reason}}throw he}function Xe(he,Ie,Be,ue,me){var xe=typeof he;(xe==="undefined"||xe==="boolean")&&(he=null);var Je=!1;if(he===null)Je=!0;else switch(xe){case"bigint":case"string":case"number":Je=!0;break;case"object":switch(he.$$typeof){case n:case t:Je=!0;break;case G:return Je=he._init,Xe(Je(he._payload),Ie,Be,ue,me)}}if(Je)return me=me(he),Je=ue===""?"."+le(he,0):ue,K(me)?(Be="",Je!=null&&(Be=Je.replace(ae,"$&/")+"/"),Xe(me,Ie,Be,"",function(Ct){return Ct})):me!=null&&(te(me)&&(me=ie(me,Be+(me.key==null||he&&he.key===me.key?"":(""+me.key).replace(ae,"$&/")+"/")+Je)),Ie.push(me)),1;Je=0;var Ve=ue===""?".":ue+":";if(K(he))for(var Ee=0;Ee<he.length;Ee++)ue=he[Ee],xe=Ve+le(ue,Ee),Je+=Xe(ue,Ie,Be,xe,me);else if(Ee=w(he),typeof Ee=="function")for(he=Ee.call(he),Ee=0;!(ue=he.next()).done;)ue=ue.value,xe=Ve+le(ue,Ee++),Je+=Xe(ue,Ie,Be,xe,me);else if(xe==="object"){if(typeof he.then=="function")return Xe(be(he),Ie,Be,ue,me);throw Ie=String(he),Error("Objects are not valid as a React child (found: "+(Ie==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":Ie)+"). If you meant to render a collection of children, use an array instead.")}return Je}function Ce(he,Ie,Be){if(he==null)return he;var ue=[],me=0;return Xe(he,ue,"","",function(xe){return Ie.call(Be,xe,me++)}),ue}function Re(he){if(he._status===-1){var Ie=he._result;Ie=Ie(),Ie.then(function(Be){(he._status===0||he._status===-1)&&(he._status=1,he._result=Be)},function(Be){(he._status===0||he._status===-1)&&(he._status=2,he._result=Be)}),he._status===-1&&(he._status=0,he._result=Ie)}if(he._status===1)return he._result.default;throw he._result}var Se=typeof reportError=="function"?reportError:function(he){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ie=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof he=="object"&&he!==null&&typeof he.message=="string"?String(he.message):String(he),error:he});if(!window.dispatchEvent(Ie))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",he);return}console.error(he)};function Ze(){}return react_production.Children={map:Ce,forEach:function(he,Ie,Be){Ce(he,function(){Ie.apply(this,arguments)},Be)},count:function(he){var Ie=0;return Ce(he,function(){Ie++}),Ie},toArray:function(he){return Ce(he,function(Ie){return Ie})||[]},only:function(he){if(!te(he))throw Error("React.Children.only expected to receive a single React element child.");return he}},react_production.Component=H,react_production.Fragment=o,react_production.Profiler=d,react_production.PureComponent=z,react_production.StrictMode=u,react_production.Suspense=A,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,react_production.act=function(){throw Error("act(...) is not supported in production builds of React.")},react_production.cache=function(he){return function(){return he.apply(null,arguments)}},react_production.cloneElement=function(he,Ie,Be){if(he==null)throw Error("The argument must be a React element, but you passed "+he+".");var ue=V({},he.props),me=he.key,xe=void 0;if(Ie!=null)for(Je in Ie.ref!==void 0&&(xe=void 0),Ie.key!==void 0&&(me=""+Ie.key),Ie)!Q.call(Ie,Je)||Je==="key"||Je==="__self"||Je==="__source"||Je==="ref"&&Ie.ref===void 0||(ue[Je]=Ie[Je]);var Je=arguments.length-2;if(Je===1)ue.children=Be;else if(1<Je){for(var Ve=Array(Je),Ee=0;Ee<Je;Ee++)Ve[Ee]=arguments[Ee+2];ue.children=Ve}return ee(he.type,me,void 0,void 0,xe,ue)},react_production.createContext=function(he){return he={$$typeof:I,_currentValue:he,_currentValue2:he,_threadCount:0,Provider:null,Consumer:null},he.Provider=he,he.Consumer={$$typeof:C,_context:he},he},react_production.createElement=function(he,Ie,Be){var ue,me={},xe=null;if(Ie!=null)for(ue in Ie.key!==void 0&&(xe=""+Ie.key),Ie)Q.call(Ie,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(me[ue]=Ie[ue]);var Je=arguments.length-2;if(Je===1)me.children=Be;else if(1<Je){for(var Ve=Array(Je),Ee=0;Ee<Je;Ee++)Ve[Ee]=arguments[Ee+2];me.children=Ve}if(he&&he.defaultProps)for(ue in Je=he.defaultProps,Je)me[ue]===void 0&&(me[ue]=Je[ue]);return ee(he,xe,void 0,void 0,null,me)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(he){return{$$typeof:f,render:he}},react_production.isValidElement=te,react_production.lazy=function(he){return{$$typeof:G,_payload:{_status:-1,_result:he},_init:Re}},react_production.memo=function(he,Ie){return{$$typeof:y,type:he,compare:Ie===void 0?null:Ie}},react_production.startTransition=function(he){var Ie=O.T,Be={};O.T=Be;try{var ue=he(),me=O.S;me!==null&&me(Be,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(Ze,Se)}catch(xe){Se(xe)}finally{O.T=Ie}},react_production.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},react_production.use=function(he){return O.H.use(he)},react_production.useActionState=function(he,Ie,Be){return O.H.useActionState(he,Ie,Be)},react_production.useCallback=function(he,Ie){return O.H.useCallback(he,Ie)},react_production.useContext=function(he){return O.H.useContext(he)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(he,Ie){return O.H.useDeferredValue(he,Ie)},react_production.useEffect=function(he,Ie){return O.H.useEffect(he,Ie)},react_production.useId=function(){return O.H.useId()},react_production.useImperativeHandle=function(he,Ie,Be){return O.H.useImperativeHandle(he,Ie,Be)},react_production.useInsertionEffect=function(he,Ie){return O.H.useInsertionEffect(he,Ie)},react_production.useLayoutEffect=function(he,Ie){return O.H.useLayoutEffect(he,Ie)},react_production.useMemo=function(he,Ie){return O.H.useMemo(he,Ie)},react_production.useOptimistic=function(he,Ie){return O.H.useOptimistic(he,Ie)},react_production.useReducer=function(he,Ie,Be){return O.H.useReducer(he,Ie,Be)},react_production.useRef=function(he){return O.H.useRef(he)},react_production.useState=function(he){return O.H.useState(he)},react_production.useSyncExternalStore=function(he,Ie,Be){return O.H.useSyncExternalStore(he,Ie,Be)},react_production.useTransition=function(){return O.H.useTransition()},react_production.version="19.0.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,function(n){function t(Ce,Re){var Se=Ce.length;Ce.push(Re);e:for(;0<Se;){var Ze=Se-1>>>1,he=Ce[Ze];if(0<d(he,Re))Ce[Ze]=Re,Ce[Se]=he,Se=Ze;else break e}}function o(Ce){return Ce.length===0?null:Ce[0]}function u(Ce){if(Ce.length===0)return null;var Re=Ce[0],Se=Ce.pop();if(Se!==Re){Ce[0]=Se;e:for(var Ze=0,he=Ce.length,Ie=he>>>1;Ze<Ie;){var Be=2*(Ze+1)-1,ue=Ce[Be],me=Be+1,xe=Ce[me];if(0>d(ue,Se))me<he&&0>d(xe,ue)?(Ce[Ze]=xe,Ce[me]=Se,Ze=me):(Ce[Ze]=ue,Ce[Be]=Se,Ze=Be);else if(me<he&&0>d(xe,Se))Ce[Ze]=xe,Ce[me]=Se,Ze=me;else break e}}return Re}function d(Ce,Re){var Se=Ce.sortIndex-Re.sortIndex;return Se!==0?Se:Ce.id-Re.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var C=performance;n.unstable_now=function(){return C.now()}}else{var I=Date,f=I.now();n.unstable_now=function(){return I.now()-f}}var A=[],y=[],G=1,S=null,w=3,M=!1,V=!1,T=!1,H=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;function L(Ce){for(var Re=o(y);Re!==null;){if(Re.callback===null)u(y);else if(Re.startTime<=Ce)u(y),Re.sortIndex=Re.expirationTime,t(A,Re);else break;Re=o(y)}}function K(Ce){if(T=!1,L(Ce),!V)if(o(A)!==null)V=!0,be();else{var Re=o(y);Re!==null&&Xe(K,Re.startTime-Ce)}}var O=!1,Q=-1,ee=5,ie=-1;function te(){return!(n.unstable_now()-ie<ee)}function se(){if(O){var Ce=n.unstable_now();ie=Ce;var Re=!0;try{e:{V=!1,T&&(T=!1,J(Q),Q=-1),M=!0;var Se=w;try{t:{for(L(Ce),S=o(A);S!==null&&!(S.expirationTime>Ce&&te());){var Ze=S.callback;if(typeof Ze=="function"){S.callback=null,w=S.priorityLevel;var he=Ze(S.expirationTime<=Ce);if(Ce=n.unstable_now(),typeof he=="function"){S.callback=he,L(Ce),Re=!0;break t}S===o(A)&&u(A),L(Ce)}else u(A);S=o(A)}if(S!==null)Re=!0;else{var Ie=o(y);Ie!==null&&Xe(K,Ie.startTime-Ce),Re=!1}}break e}finally{S=null,w=Se,M=!1}Re=void 0}}finally{Re?ae():O=!1}}}var ae;if(typeof z=="function")ae=function(){z(se)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,ge=le.port2;le.port1.onmessage=se,ae=function(){ge.postMessage(null)}}else ae=function(){H(se,0)};function be(){O||(O=!0,ae())}function Xe(Ce,Re){Q=H(function(){Ce(n.unstable_now())},Re)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){V||M||(V=!0,be())},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return w},n.unstable_getFirstCallbackNode=function(){return o(A)},n.unstable_next=function(Ce){switch(w){case 1:case 2:case 3:var Re=3;break;default:Re=w}var Se=w;w=Re;try{return Ce()}finally{w=Se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,Re){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Se=w;w=Ce;try{return Re()}finally{w=Se}},n.unstable_scheduleCallback=function(Ce,Re,Se){var Ze=n.unstable_now();switch(typeof Se=="object"&&Se!==null?(Se=Se.delay,Se=typeof Se=="number"&&0<Se?Ze+Se:Ze):Se=Ze,Ce){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=Se+he,Ce={id:G++,callback:Re,priorityLevel:Ce,startTime:Se,expirationTime:he,sortIndex:-1},Se>Ze?(Ce.sortIndex=Se,t(y,Ce),o(A)===null&&Ce===o(y)&&(T?(J(Q),Q=-1):T=!0,Xe(K,Se-Ze))):(Ce.sortIndex=he,t(A,Ce),V||M||(V=!0,be())),Ce},n.unstable_shouldYield=te,n.unstable_wrapCallback=function(Ce){var Re=w;return function(){var Se=w;w=Re;try{return Ce.apply(this,arguments)}finally{w=Se}}}}(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var n=requireReact();function t(A){var y="https://react.dev/errors/"+A;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)y+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+A+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var u={d:{f:o,r:function(){throw Error(t(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},d=Symbol.for("react.portal");function C(A,y,G){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:S==null?null:""+S,children:A,containerInfo:y,implementation:G}}var I=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(A,y){if(A==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,reactDom_production.createPortal=function(A,y){var G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(t(299));return C(A,y,null,G)},reactDom_production.flushSync=function(A){var y=I.T,G=u.p;try{if(I.T=null,u.p=2,A)return A()}finally{I.T=y,u.p=G,u.d.f()}},reactDom_production.preconnect=function(A,y){typeof A=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,u.d.C(A,y))},reactDom_production.prefetchDNS=function(A){typeof A=="string"&&u.d.D(A)},reactDom_production.preinit=function(A,y){if(typeof A=="string"&&y&&typeof y.as=="string"){var G=y.as,S=f(G,y.crossOrigin),w=typeof y.integrity=="string"?y.integrity:void 0,M=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;G==="style"?u.d.S(A,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:S,integrity:w,fetchPriority:M}):G==="script"&&u.d.X(A,{crossOrigin:S,integrity:w,fetchPriority:M,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},reactDom_production.preinitModule=function(A,y){if(typeof A=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var G=f(y.as,y.crossOrigin);u.d.M(A,{crossOrigin:G,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&u.d.M(A)},reactDom_production.preload=function(A,y){if(typeof A=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var G=y.as,S=f(G,y.crossOrigin);u.d.L(A,G,{crossOrigin:S,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},reactDom_production.preloadModule=function(A,y){if(typeof A=="string")if(y){var G=f(y.as,y.crossOrigin);u.d.m(A,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:G,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else u.d.m(A)},reactDom_production.requestFormReset=function(A){u.d.r(A)},reactDom_production.unstable_batchedUpdates=function(A,y){return A(y)},reactDom_production.useFormState=function(A,y,G){return I.H.useFormState(A,y,G)},reactDom_production.useFormStatus=function(){return I.H.useHostTransitionStatus()},reactDom_production.version="19.0.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var n=requireScheduler(),t=requireReact(),o=requireReactDom();function u(B){var Z="https://react.dev/errors/"+B;if(1<arguments.length){Z+="?args[]="+encodeURIComponent(arguments[1]);for(var Y=2;Y<arguments.length;Y++)Z+="&args[]="+encodeURIComponent(arguments[Y])}return"Minified React error #"+B+"; visit "+Z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(B){return!(!B||B.nodeType!==1&&B.nodeType!==9&&B.nodeType!==11)}var C=Symbol.for("react.element"),I=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),w=Symbol.for("react.consumer"),M=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),L=Symbol.for("react.offscreen"),K=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function Q(B){return B===null||typeof B!="object"?null:(B=O&&B[O]||B["@@iterator"],typeof B=="function"?B:null)}var ee=Symbol.for("react.client.reference");function ie(B){if(B==null)return null;if(typeof B=="function")return B.$$typeof===ee?null:B.displayName||B.name||null;if(typeof B=="string")return B;switch(B){case A:return"Fragment";case f:return"Portal";case G:return"Profiler";case y:return"StrictMode";case T:return"Suspense";case H:return"SuspenseList"}if(typeof B=="object")switch(B.$$typeof){case M:return(B.displayName||"Context")+".Provider";case w:return(B._context.displayName||"Context")+".Consumer";case V:var Z=B.render;return B=B.displayName,B||(B=Z.displayName||Z.name||"",B=B!==""?"ForwardRef("+B+")":"ForwardRef"),B;case J:return Z=B.displayName||null,Z!==null?Z:ie(B.type)||"Memo";case z:Z=B._payload,B=B._init;try{return ie(B(Z))}catch{}}return null}var te=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=Object.assign,ae,le;function ge(B){if(ae===void 0)try{throw Error()}catch(Y){var Z=Y.stack.trim().match(/\n( *(at )?)/);ae=Z&&Z[1]||"",le=-1<Y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<Y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ae+B+le}var be=!1;function Xe(B,Z){if(!B||be)return"";be=!0;var Y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var F={DetermineComponentFrameRoot:function(){try{if(Z){var bt=function(){throw Error()};if(Object.defineProperty(bt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(bt,[])}catch(ct){var tt=ct}Reflect.construct(B,[],bt)}else{try{bt.call()}catch(ct){tt=ct}B.call(bt.prototype)}}else{try{throw Error()}catch(ct){tt=ct}(bt=B())&&typeof bt.catch=="function"&&bt.catch(function(){})}}catch(ct){if(ct&&tt&&typeof ct.stack=="string")return[ct.stack,tt.stack]}return[null,null]}};F.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var U=Object.getOwnPropertyDescriptor(F.DetermineComponentFrameRoot,"name");U&&U.configurable&&Object.defineProperty(F.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var ne=F.DetermineComponentFrameRoot(),ce=ne[0],pe=ne[1];if(ce&&pe){var we=ce.split(`
`),He=pe.split(`
`);for(U=F=0;F<we.length&&!we[F].includes("DetermineComponentFrameRoot");)F++;for(;U<He.length&&!He[U].includes("DetermineComponentFrameRoot");)U++;if(F===we.length||U===He.length)for(F=we.length-1,U=He.length-1;1<=F&&0<=U&&we[F]!==He[U];)U--;for(;1<=F&&0<=U;F--,U--)if(we[F]!==He[U]){if(F!==1||U!==1)do if(F--,U--,0>U||we[F]!==He[U]){var ht=`
`+we[F].replace(" at new "," at ");return B.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",B.displayName)),ht}while(1<=F&&0<=U);break}}}finally{be=!1,Error.prepareStackTrace=Y}return(Y=B?B.displayName||B.name:"")?ge(Y):""}function Ce(B){switch(B.tag){case 26:case 27:case 5:return ge(B.type);case 16:return ge("Lazy");case 13:return ge("Suspense");case 19:return ge("SuspenseList");case 0:case 15:return B=Xe(B.type,!1),B;case 11:return B=Xe(B.type.render,!1),B;case 1:return B=Xe(B.type,!0),B;default:return""}}function Re(B){try{var Z="";do Z+=Ce(B),B=B.return;while(B);return Z}catch(Y){return`
Error generating stack: `+Y.message+`
`+Y.stack}}function Se(B){var Z=B,Y=B;if(B.alternate)for(;Z.return;)Z=Z.return;else{B=Z;do Z=B,(Z.flags&4098)!==0&&(Y=Z.return),B=Z.return;while(B)}return Z.tag===3?Y:null}function Ze(B){if(B.tag===13){var Z=B.memoizedState;if(Z===null&&(B=B.alternate,B!==null&&(Z=B.memoizedState)),Z!==null)return Z.dehydrated}return null}function he(B){if(Se(B)!==B)throw Error(u(188))}function Ie(B){var Z=B.alternate;if(!Z){if(Z=Se(B),Z===null)throw Error(u(188));return Z!==B?null:B}for(var Y=B,F=Z;;){var U=Y.return;if(U===null)break;var ne=U.alternate;if(ne===null){if(F=U.return,F!==null){Y=F;continue}break}if(U.child===ne.child){for(ne=U.child;ne;){if(ne===Y)return he(U),B;if(ne===F)return he(U),Z;ne=ne.sibling}throw Error(u(188))}if(Y.return!==F.return)Y=U,F=ne;else{for(var ce=!1,pe=U.child;pe;){if(pe===Y){ce=!0,Y=U,F=ne;break}if(pe===F){ce=!0,F=U,Y=ne;break}pe=pe.sibling}if(!ce){for(pe=ne.child;pe;){if(pe===Y){ce=!0,Y=ne,F=U;break}if(pe===F){ce=!0,F=ne,Y=U;break}pe=pe.sibling}if(!ce)throw Error(u(189))}}if(Y.alternate!==F)throw Error(u(190))}if(Y.tag!==3)throw Error(u(188));return Y.stateNode.current===Y?B:Z}function Be(B){var Z=B.tag;if(Z===5||Z===26||Z===27||Z===6)return B;for(B=B.child;B!==null;){if(Z=Be(B),Z!==null)return Z;B=B.sibling}return null}var ue=Array.isArray,me=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,xe={pending:!1,data:null,method:null,action:null},Je=[],Ve=-1;function Ee(B){return{current:B}}function Ct(B){0>Ve||(B.current=Je[Ve],Je[Ve]=null,Ve--)}function st(B,Z){Ve++,Je[Ve]=B.current,B.current=Z}var wt=Ee(null),Qe=Ee(null),Ue=Ee(null),Ge=Ee(null);function Gt(B,Z){switch(st(Ue,Z),st(Qe,B),st(wt,null),B=Z.nodeType,B){case 9:case 11:Z=(Z=Z.documentElement)&&(Z=Z.namespaceURI)?cd(Z):0;break;default:if(B=B===8?Z.parentNode:Z,Z=B.tagName,B=B.namespaceURI)B=cd(B),Z=gd(B,Z);else switch(Z){case"svg":Z=1;break;case"math":Z=2;break;default:Z=0}}Ct(wt),st(wt,Z)}function ot(){Ct(wt),Ct(Qe),Ct(Ue)}function vt(B){B.memoizedState!==null&&st(Ge,B);var Z=wt.current,Y=gd(Z,B.type);Z!==Y&&(st(Qe,B),st(wt,Y))}function at(B){Qe.current===B&&(Ct(wt),Ct(Qe)),Ge.current===B&&(Ct(Ge),Tg._currentValue=xe)}var Tt=Object.prototype.hasOwnProperty,xt=n.unstable_scheduleCallback,ve=n.unstable_cancelCallback,de=n.unstable_shouldYield,De=n.unstable_requestPaint,nt=n.unstable_now,dt=n.unstable_getCurrentPriorityLevel,ze=n.unstable_ImmediatePriority,rt=n.unstable_UserBlockingPriority,Rt=n.unstable_NormalPriority,Mt=n.unstable_LowPriority,Yt=n.unstable_IdlePriority,Oe=n.log,gt=n.unstable_setDisableYieldValue,pt=null,mt=null;function It(B){if(mt&&typeof mt.onCommitFiberRoot=="function")try{mt.onCommitFiberRoot(pt,B,void 0,(B.current.flags&128)===128)}catch{}}function ye(B){if(typeof Oe=="function"&&gt(B),mt&&typeof mt.setStrictMode=="function")try{mt.setStrictMode(pt,B)}catch{}}var Ye=Math.clz32?Math.clz32:St,_e=Math.log,Ne=Math.LN2;function St(B){return B>>>=0,B===0?32:31-(_e(B)/Ne|0)|0}var et=128,lt=4194304;function yt(B){var Z=B&42;if(Z!==0)return Z;switch(B&-B){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return B&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return B&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return B}}function _t(B,Z){var Y=B.pendingLanes;if(Y===0)return 0;var F=0,U=B.suspendedLanes,ne=B.pingedLanes,ce=B.warmLanes;B=B.finishedLanes!==0;var pe=Y&134217727;return pe!==0?(Y=pe&~U,Y!==0?F=yt(Y):(ne&=pe,ne!==0?F=yt(ne):B||(ce=pe&~ce,ce!==0&&(F=yt(ce))))):(pe=Y&~U,pe!==0?F=yt(pe):ne!==0?F=yt(ne):B||(ce=Y&~ce,ce!==0&&(F=yt(ce)))),F===0?0:Z!==0&&Z!==F&&(Z&U)===0&&(U=F&-F,ce=Z&-Z,U>=ce||U===32&&(ce&4194176)!==0)?Z:F}function Jt(B,Z){return(B.pendingLanes&~(B.suspendedLanes&~B.pingedLanes)&Z)===0}function oi(B,Z){switch(B){case 1:case 2:case 4:case 8:return Z+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return Z+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Si(){var B=et;return et<<=1,(et&4194176)===0&&(et=128),B}function ni(){var B=lt;return lt<<=1,(lt&62914560)===0&&(lt=4194304),B}function gi(B){for(var Z=[],Y=0;31>Y;Y++)Z.push(B);return Z}function Ri(B,Z){B.pendingLanes|=Z,Z!==268435456&&(B.suspendedLanes=0,B.pingedLanes=0,B.warmLanes=0)}function vn(B,Z,Y,F,U,ne){var ce=B.pendingLanes;B.pendingLanes=Y,B.suspendedLanes=0,B.pingedLanes=0,B.warmLanes=0,B.expiredLanes&=Y,B.entangledLanes&=Y,B.errorRecoveryDisabledLanes&=Y,B.shellSuspendCounter=0;var pe=B.entanglements,we=B.expirationTimes,He=B.hiddenUpdates;for(Y=ce&~Y;0<Y;){var ht=31-Ye(Y),bt=1<<ht;pe[ht]=0,we[ht]=-1;var tt=He[ht];if(tt!==null)for(He[ht]=null,ht=0;ht<tt.length;ht++){var ct=tt[ht];ct!==null&&(ct.lane&=-536870913)}Y&=~bt}F!==0&&Ts(B,F,0),ne!==0&&U===0&&B.tag!==0&&(B.suspendedLanes|=ne&~(ce&~Z))}function Ts(B,Z,Y){B.pendingLanes|=Z,B.suspendedLanes&=~Z;var F=31-Ye(Z);B.entangledLanes|=Z,B.entanglements[F]=B.entanglements[F]|1073741824|Y&4194218}function mn(B,Z){var Y=B.entangledLanes|=Z;for(B=B.entanglements;Y;){var F=31-Ye(Y),U=1<<F;U&Z|B[F]&Z&&(B[F]|=Z),Y&=~U}}function Bn(B){return B&=-B,2<B?8<B?(B&134217727)!==0?32:268435456:8:2}function Vn(){var B=me.p;return B!==0?B:(B=window.event,B===void 0?32:Rd(B.type))}function ss(B,Z){var Y=me.p;try{return me.p=B,Z()}finally{me.p=Y}}var Ti=Math.random().toString(36).slice(2),Ji="__reactFiber$"+Ti,Qt="__reactProps$"+Ti,Js="__reactContainer$"+Ti,Uo="__reactEvents$"+Ti,Vl="__reactListeners$"+Ti,Wl="__reactHandles$"+Ti,El="__reactResources$"+Ti,fo="__reactMarker$"+Ti;function Mr(B){delete B[Ji],delete B[Qt],delete B[Uo],delete B[Vl],delete B[Wl]}function Hs(B){var Z=B[Ji];if(Z)return Z;for(var Y=B.parentNode;Y;){if(Z=Y[Js]||Y[Ji]){if(Y=Z.alternate,Z.child!==null||Y!==null&&Y.child!==null)for(B=dd(B);B!==null;){if(Y=B[Ji])return Y;B=dd(B)}return Z}B=Y,Y=B.parentNode}return null}function fe(B){if(B=B[Ji]||B[Js]){var Z=B.tag;if(Z===5||Z===6||Z===13||Z===26||Z===27||Z===3)return B}return null}function We(B){var Z=B.tag;if(Z===5||Z===26||Z===27||Z===6)return B.stateNode;throw Error(u(33))}function je(B){var Z=B[El];return Z||(Z=B[El]={hoistableStyles:new Map,hoistableScripts:new Map}),Z}function ke(B){B[fo]=!0}var Le=new Set,At={};function Nt(B,Z){Wt(B,Z),Wt(B+"Capture",Z)}function Wt(B,Z){for(At[B]=Z,B=0;B<Z.length;B++)Le.add(Z[B])}var Vt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ot=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ut={},Ft={};function Ci(B){return Tt.call(Ft,B)?!0:Tt.call(Ut,B)?!1:Ot.test(B)?Ft[B]=!0:(Ut[B]=!0,!1)}function Ii(B,Z,Y){if(Ci(Z))if(Y===null)B.removeAttribute(Z);else{switch(typeof Y){case"undefined":case"function":case"symbol":B.removeAttribute(Z);return;case"boolean":var F=Z.toLowerCase().slice(0,5);if(F!=="data-"&&F!=="aria-"){B.removeAttribute(Z);return}}B.setAttribute(Z,""+Y)}}function Hi(B,Z,Y){if(Y===null)B.removeAttribute(Z);else{switch(typeof Y){case"undefined":case"function":case"symbol":case"boolean":B.removeAttribute(Z);return}B.setAttribute(Z,""+Y)}}function mi(B,Z,Y,F){if(F===null)B.removeAttribute(Y);else{switch(typeof F){case"undefined":case"function":case"symbol":case"boolean":B.removeAttribute(Y);return}B.setAttributeNS(Z,Y,""+F)}}function qt(B){switch(typeof B){case"bigint":case"boolean":case"number":case"string":case"undefined":return B;case"object":return B;default:return""}}function Kt(B){var Z=B.type;return(B=B.nodeName)&&B.toLowerCase()==="input"&&(Z==="checkbox"||Z==="radio")}function gn(B){var Z=Kt(B)?"checked":"value",Y=Object.getOwnPropertyDescriptor(B.constructor.prototype,Z),F=""+B[Z];if(!B.hasOwnProperty(Z)&&typeof Y<"u"&&typeof Y.get=="function"&&typeof Y.set=="function"){var U=Y.get,ne=Y.set;return Object.defineProperty(B,Z,{configurable:!0,get:function(){return U.call(this)},set:function(ce){F=""+ce,ne.call(this,ce)}}),Object.defineProperty(B,Z,{enumerable:Y.enumerable}),{getValue:function(){return F},setValue:function(ce){F=""+ce},stopTracking:function(){B._valueTracker=null,delete B[Z]}}}}function fi(B){B._valueTracker||(B._valueTracker=gn(B))}function Dn(B){if(!B)return!1;var Z=B._valueTracker;if(!Z)return!0;var Y=Z.getValue(),F="";return B&&(F=Kt(B)?B.checked?"true":"false":B.value),B=F,B!==Y?(Z.setValue(B),!0):!1}function Is(B){if(B=B||(typeof document<"u"?document:void 0),typeof B>"u")return null;try{return B.activeElement||B.body}catch{return B.body}}var Wn=/[\n"\\]/g;function bn(B){return B.replace(Wn,function(Z){return"\\"+Z.charCodeAt(0).toString(16)+" "})}function Zi(B,Z,Y,F,U,ne,ce,pe){B.name="",ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?B.type=ce:B.removeAttribute("type"),Z!=null?ce==="number"?(Z===0&&B.value===""||B.value!=Z)&&(B.value=""+qt(Z)):B.value!==""+qt(Z)&&(B.value=""+qt(Z)):ce!=="submit"&&ce!=="reset"||B.removeAttribute("value"),Z!=null?Zn(B,ce,qt(Z)):Y!=null?Zn(B,ce,qt(Y)):F!=null&&B.removeAttribute("value"),U==null&&ne!=null&&(B.defaultChecked=!!ne),U!=null&&(B.checked=U&&typeof U!="function"&&typeof U!="symbol"),pe!=null&&typeof pe!="function"&&typeof pe!="symbol"&&typeof pe!="boolean"?B.name=""+qt(pe):B.removeAttribute("name")}function En(B,Z,Y,F,U,ne,ce,pe){if(ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(B.type=ne),Z!=null||Y!=null){if(!(ne!=="submit"&&ne!=="reset"||Z!=null))return;Y=Y!=null?""+qt(Y):"",Z=Z!=null?""+qt(Z):Y,pe||Z===B.value||(B.value=Z),B.defaultValue=Z}F=F??U,F=typeof F!="function"&&typeof F!="symbol"&&!!F,B.checked=pe?B.checked:!!F,B.defaultChecked=!!F,ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"&&(B.name=ce)}function Zn(B,Z,Y){Z==="number"&&Is(B.ownerDocument)===B||B.defaultValue===""+Y||(B.defaultValue=""+Y)}function Qi(B,Z,Y,F){if(B=B.options,Z){Z={};for(var U=0;U<Y.length;U++)Z["$"+Y[U]]=!0;for(Y=0;Y<B.length;Y++)U=Z.hasOwnProperty("$"+B[Y].value),B[Y].selected!==U&&(B[Y].selected=U),U&&F&&(B[Y].defaultSelected=!0)}else{for(Y=""+qt(Y),Z=null,U=0;U<B.length;U++){if(B[U].value===Y){B[U].selected=!0,F&&(B[U].defaultSelected=!0);return}Z!==null||B[U].disabled||(Z=B[U])}Z!==null&&(Z.selected=!0)}}function Sn(B,Z,Y){if(Z!=null&&(Z=""+qt(Z),Z!==B.value&&(B.value=Z),Y==null)){B.defaultValue!==Z&&(B.defaultValue=Z);return}B.defaultValue=Y!=null?""+qt(Y):""}function zs(B,Z,Y,F){if(Z==null){if(F!=null){if(Y!=null)throw Error(u(92));if(ue(F)){if(1<F.length)throw Error(u(93));F=F[0]}Y=F}Y==null&&(Y=""),Z=Y}Y=qt(Z),B.defaultValue=Y,F=B.textContent,F===Y&&F!==""&&F!==null&&(B.value=F)}function kn(B,Z){if(Z){var Y=B.firstChild;if(Y&&Y===B.lastChild&&Y.nodeType===3){Y.nodeValue=Z;return}}B.textContent=Z}var Yl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Da(B,Z,Y){var F=Z.indexOf("--")===0;Y==null||typeof Y=="boolean"||Y===""?F?B.setProperty(Z,""):Z==="float"?B.cssFloat="":B[Z]="":F?B.setProperty(Z,Y):typeof Y!="number"||Y===0||Yl.has(Z)?Z==="float"?B.cssFloat=Y:B[Z]=(""+Y).trim():B[Z]=Y+"px"}function _c(B,Z,Y){if(Z!=null&&typeof Z!="object")throw Error(u(62));if(B=B.style,Y!=null){for(var F in Y)!Y.hasOwnProperty(F)||Z!=null&&Z.hasOwnProperty(F)||(F.indexOf("--")===0?B.setProperty(F,""):F==="float"?B.cssFloat="":B[F]="");for(var U in Z)F=Z[U],Z.hasOwnProperty(U)&&Y[U]!==F&&Da(B,U,F)}else for(var ne in Z)Z.hasOwnProperty(ne)&&Da(B,ne,Z[ne])}function ka(B){if(B.indexOf("-")===-1)return!1;switch(B){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Kg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Oa(B){return Kg.test(""+B)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":B}var Tl=null;function Ua(B){return B=B.target||B.srcElement||window,B.correspondingUseElement&&(B=B.correspondingUseElement),B.nodeType===3?B.parentNode:B}var Nr=null,Vr=null;function Jl(B){var Z=fe(B);if(Z&&(B=Z.stateNode)){var Y=B[Qt]||null;e:switch(B=Z.stateNode,Z.type){case"input":if(Zi(B,Y.value,Y.defaultValue,Y.defaultValue,Y.checked,Y.defaultChecked,Y.type,Y.name),Z=Y.name,Y.type==="radio"&&Z!=null){for(Y=B;Y.parentNode;)Y=Y.parentNode;for(Y=Y.querySelectorAll('input[name="'+bn(""+Z)+'"][type="radio"]'),Z=0;Z<Y.length;Z++){var F=Y[Z];if(F!==B&&F.form===B.form){var U=F[Qt]||null;if(!U)throw Error(u(90));Zi(F,U.value,U.defaultValue,U.defaultValue,U.checked,U.defaultChecked,U.type,U.name)}}for(Z=0;Z<Y.length;Z++)F=Y[Z],F.form===B.form&&Dn(F)}break e;case"textarea":Sn(B,Y.value,Y.defaultValue);break e;case"select":Z=Y.value,Z!=null&&Qi(B,!!Y.multiple,Z,!1)}}}var Hl=!1;function Mc(B,Z,Y){if(Hl)return B(Z,Y);Hl=!0;try{var F=B(Z);return F}finally{if(Hl=!1,(Nr!==null||Vr!==null)&&(ia(),Nr&&(Z=Nr,B=Vr,Vr=Nr=null,Jl(Z),B)))for(Z=0;Z<B.length;Z++)Jl(B[Z])}}function ra(B,Z){var Y=B.stateNode;if(Y===null)return null;var F=Y[Qt]||null;if(F===null)return null;Y=F[Z];e:switch(Z){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(F=!F.disabled)||(B=B.type,F=!(B==="button"||B==="input"||B==="select"||B==="textarea")),B=!F;break e;default:B=!1}if(B)return null;if(Y&&typeof Y!="function")throw Error(u(231,Z,typeof Y));return Y}var $a=!1;if(Vt)try{var aa={};Object.defineProperty(aa,"passive",{get:function(){$a=!0}}),window.addEventListener("test",aa,aa),window.removeEventListener("test",aa,aa)}catch{$a=!1}var po=null,Nc=null,zl=null;function Vc(){if(zl)return zl;var B,Z=Nc,Y=Z.length,F,U="value"in po?po.value:po.textContent,ne=U.length;for(B=0;B<Y&&Z[B]===U[B];B++);var ce=Y-B;for(F=1;F<=ce&&Z[Y-F]===U[ne-F];F++);return zl=U.slice(B,1<F?1-F:void 0)}function $o(B){var Z=B.keyCode;return"charCode"in B?(B=B.charCode,B===0&&Z===13&&(B=13)):B=Z,B===10&&(B=13),32<=B||B===13?B:0}function la(){return!0}function ja(){return!1}function On(B){function Z(Y,F,U,ne,ce){this._reactName=Y,this._targetInst=U,this.type=F,this.nativeEvent=ne,this.target=ce,this.currentTarget=null;for(var pe in B)B.hasOwnProperty(pe)&&(Y=B[pe],this[pe]=Y?Y(ne):ne[pe]);return this.isDefaultPrevented=(ne.defaultPrevented!=null?ne.defaultPrevented:ne.returnValue===!1)?la:ja,this.isPropagationStopped=ja,this}return se(Z.prototype,{preventDefault:function(){this.defaultPrevented=!0;var Y=this.nativeEvent;Y&&(Y.preventDefault?Y.preventDefault():typeof Y.returnValue!="unknown"&&(Y.returnValue=!1),this.isDefaultPrevented=la)},stopPropagation:function(){var Y=this.nativeEvent;Y&&(Y.stopPropagation?Y.stopPropagation():typeof Y.cancelBubble!="unknown"&&(Y.cancelBubble=!0),this.isPropagationStopped=la)},persist:function(){},isPersistent:la}),Z}var jo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(B){return B.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ca=On(jo),ga=se({},jo,{view:0,detail:0}),Pg=On(ga),Ao,ua,ha,da=se({},ga,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qa,button:0,buttons:0,relatedTarget:function(B){return B.relatedTarget===void 0?B.fromElement===B.srcElement?B.toElement:B.fromElement:B.relatedTarget},movementX:function(B){return"movementX"in B?B.movementX:(B!==ha&&(ha&&B.type==="mousemove"?(Ao=B.screenX-ha.screenX,ua=B.screenY-ha.screenY):ua=Ao=0,ha=B),Ao)},movementY:function(B){return"movementY"in B?B.movementY:ua}}),Wc=On(da),Dg=se({},da,{dataTransfer:0}),Ah=On(Dg),wn=se({},ga,{relatedTarget:0}),Ll=On(wn),kg=se({},jo,{animationName:0,elapsedTime:0,pseudoElement:0}),Og=On(kg),Ug=se({},jo,{clipboardData:function(B){return"clipboardData"in B?B.clipboardData:window.clipboardData}}),$g=On(Ug),Qa=se({},jo,{data:0}),Fl=On(Qa),jg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ec(B){var Z=this.nativeEvent;return Z.getModifierState?Z.getModifierState(B):(B=qg[B])?!!Z[B]:!1}function qa(){return Ec}var eu=se({},ga,{key:function(B){if(B.key){var Z=jg[B.key]||B.key;if(Z!=="Unidentified")return Z}return B.type==="keypress"?(B=$o(B),B===13?"Enter":String.fromCharCode(B)):B.type==="keydown"||B.type==="keyup"?Qg[B.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qa,charCode:function(B){return B.type==="keypress"?$o(B):0},keyCode:function(B){return B.type==="keydown"||B.type==="keyup"?B.keyCode:0},which:function(B){return B.type==="keypress"?$o(B):B.type==="keydown"||B.type==="keyup"?B.keyCode:0}}),Yc=On(eu),Tc=se({},da,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Kl=On(Tc),tu=se({},ga,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qa}),Jc=On(tu),iu=se({},jo,{propertyName:0,elapsedTime:0,pseudoElement:0}),mo=On(iu),Hc=se({},da,{deltaX:function(B){return"deltaX"in B?B.deltaX:"wheelDeltaX"in B?-B.wheelDeltaX:0},deltaY:function(B){return"deltaY"in B?B.deltaY:"wheelDeltaY"in B?-B.wheelDeltaY:"wheelDelta"in B?-B.wheelDelta:0},deltaZ:0,deltaMode:0}),mh=On(Hc),nu=se({},jo,{newState:0,oldState:0}),Qo=On(nu),bo=[9,13,27,32],el=Vt&&"CompositionEvent"in window,Wr=null;Vt&&"documentMode"in document&&(Wr=document.documentMode);var tl=Vt&&"TextEvent"in window&&!Wr,il=Vt&&(!el||Wr&&8<Wr&&11>=Wr),qo=" ",_n=!1;function nl(B,Z){switch(B){case"keyup":return bo.indexOf(Z.keyCode)!==-1;case"keydown":return Z.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zc(B){return B=B.detail,typeof B=="object"&&"data"in B?B.data:null}var er=!1;function sl(B,Z){switch(B){case"compositionend":return zc(Z);case"keypress":return Z.which!==32?null:(_n=!0,qo);case"textInput":return B=Z.data,B===qo&&_n?null:B;default:return null}}function Lc(B,Z){if(er)return B==="compositionend"||!el&&nl(B,Z)?(B=Vc(),zl=Nc=po=null,er=!1,B):null;switch(B){case"paste":return null;case"keypress":if(!(Z.ctrlKey||Z.altKey||Z.metaKey)||Z.ctrlKey&&Z.altKey){if(Z.char&&1<Z.char.length)return Z.char;if(Z.which)return String.fromCharCode(Z.which)}return null;case"compositionend":return il&&Z.locale!=="ko"?null:Z.data;default:return null}}var Pl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fc(B){var Z=B&&B.nodeName&&B.nodeName.toLowerCase();return Z==="input"?!!Pl[B.type]:Z==="textarea"}function os(B,Z,Y,F){Nr?Vr?Vr.push(F):Vr=[F]:Nr=F,Z=nh(Z,"onChange"),0<Z.length&&(Y=new ca("onChange","change",null,Y,F),B.push({event:Y,listeners:Z}))}var Ca=null,Er=null;function su(B){sd(B,0)}function ol(B){var Z=We(B);if(Dn(Z))return B}function Dl(B,Z){if(B==="change")return Z}var kl=!1;if(Vt){var Ol;if(Vt){var Ia="oninput"in document;if(!Ia){var fa=document.createElement("div");fa.setAttribute("oninput","return;"),Ia=typeof fa.oninput=="function"}Ol=Ia}else Ol=!1;kl=Ol&&(!document.documentMode||9<document.documentMode)}function ki(){Ca&&(Ca.detachEvent("onpropertychange",ou),Er=Ca=null)}function ou(B){if(B.propertyName==="value"&&ol(Er)){var Z=[];os(Z,Er,B,Ua(B)),Mc(su,Z)}}function bh(B,Z,Y){B==="focusin"?(ki(),Ca=Z,Er=Y,Ca.attachEvent("onpropertychange",ou)):B==="focusout"&&ki()}function ru(B){if(B==="selectionchange"||B==="keyup"||B==="keydown")return ol(Er)}function rl(B,Z){if(B==="click")return ol(Z)}function tr(B,Z){if(B==="input"||B==="change")return ol(Z)}function au(B,Z){return B===Z&&(B!==0||1/B===1/Z)||B!==B&&Z!==Z}var rs=typeof Object.is=="function"?Object.is:au;function Ls(B,Z){if(rs(B,Z))return!0;if(typeof B!="object"||B===null||typeof Z!="object"||Z===null)return!1;var Y=Object.keys(B),F=Object.keys(Z);if(Y.length!==F.length)return!1;for(F=0;F<Y.length;F++){var U=Y[F];if(!Tt.call(Z,U)||!rs(B[U],Z[U]))return!1}return!0}function as(B){for(;B&&B.firstChild;)B=B.firstChild;return B}function Kc(B,Z){var Y=as(B);B=0;for(var F;Y;){if(Y.nodeType===3){if(F=B+Y.textContent.length,B<=Z&&F>=Z)return{node:Y,offset:Z-B};B=F}e:{for(;Y;){if(Y.nextSibling){Y=Y.nextSibling;break e}Y=Y.parentNode}Y=void 0}Y=as(Y)}}function Pc(B,Z){return B&&Z?B===Z?!0:B&&B.nodeType===3?!1:Z&&Z.nodeType===3?Pc(B,Z.parentNode):"contains"in B?B.contains(Z):B.compareDocumentPosition?!!(B.compareDocumentPosition(Z)&16):!1:!1}function Dc(B){B=B!=null&&B.ownerDocument!=null&&B.ownerDocument.defaultView!=null?B.ownerDocument.defaultView:window;for(var Z=Is(B.document);Z instanceof B.HTMLIFrameElement;){try{var Y=typeof Z.contentWindow.location.href=="string"}catch{Y=!1}if(Y)B=Z.contentWindow;else break;Z=Is(B.document)}return Z}function al(B){var Z=B&&B.nodeName&&B.nodeName.toLowerCase();return Z&&(Z==="input"&&(B.type==="text"||B.type==="search"||B.type==="tel"||B.type==="url"||B.type==="password")||Z==="textarea"||B.contentEditable==="true")}function kc(B,Z){var Y=Dc(Z);Z=B.focusedElem;var F=B.selectionRange;if(Y!==Z&&Z&&Z.ownerDocument&&Pc(Z.ownerDocument.documentElement,Z)){if(F!==null&&al(Z)){if(B=F.start,Y=F.end,Y===void 0&&(Y=B),"selectionStart"in Z)Z.selectionStart=B,Z.selectionEnd=Math.min(Y,Z.value.length);else if(Y=(B=Z.ownerDocument||document)&&B.defaultView||window,Y.getSelection){Y=Y.getSelection();var U=Z.textContent.length,ne=Math.min(F.start,U);F=F.end===void 0?ne:Math.min(F.end,U),!Y.extend&&ne>F&&(U=F,F=ne,ne=U),U=Kc(Z,ne);var ce=Kc(Z,F);U&&ce&&(Y.rangeCount!==1||Y.anchorNode!==U.node||Y.anchorOffset!==U.offset||Y.focusNode!==ce.node||Y.focusOffset!==ce.offset)&&(B=B.createRange(),B.setStart(U.node,U.offset),Y.removeAllRanges(),ne>F?(Y.addRange(B),Y.extend(ce.node,ce.offset)):(B.setEnd(ce.node,ce.offset),Y.addRange(B)))}}for(B=[],Y=Z;Y=Y.parentNode;)Y.nodeType===1&&B.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<B.length;Z++)Y=B[Z],Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}var Ul=Vt&&"documentMode"in document&&11>=document.documentMode,Yr=null,Oc=null,pa=null,$l=!1;function Bs(B,Z,Y){var F=Y.window===Y?Y.document:Y.nodeType===9?Y:Y.ownerDocument;$l||Yr==null||Yr!==Is(F)||(F=Yr,"selectionStart"in F&&al(F)?F={start:F.selectionStart,end:F.selectionEnd}:(F=(F.ownerDocument&&F.ownerDocument.defaultView||window).getSelection(),F={anchorNode:F.anchorNode,anchorOffset:F.anchorOffset,focusNode:F.focusNode,focusOffset:F.focusOffset}),pa&&Ls(pa,F)||(pa=F,F=nh(Oc,"onSelect"),0<F.length&&(Z=new ca("onSelect","select",null,Z,Y),B.push({event:Z,listeners:F}),Z.target=Yr)))}function yo(B,Z){var Y={};return Y[B.toLowerCase()]=Z.toLowerCase(),Y["Webkit"+B]="webkit"+Z,Y["Moz"+B]="moz"+Z,Y}var Tr={animationend:yo("Animation","AnimationEnd"),animationiteration:yo("Animation","AnimationIteration"),animationstart:yo("Animation","AnimationStart"),transitionrun:yo("Transition","TransitionRun"),transitionstart:yo("Transition","TransitionStart"),transitioncancel:yo("Transition","TransitionCancel"),transitionend:yo("Transition","TransitionEnd")},Uc={},jl={};Vt&&(jl=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);function un(B){if(Uc[B])return Uc[B];if(!Tr[B])return B;var Z=Tr[B],Y;for(Y in Z)if(Z.hasOwnProperty(Y)&&Y in jl)return Uc[B]=Z[Y];return B}var $c=un("animationend"),ls=un("animationiteration"),Qc=un("animationstart"),Go=un("transitionrun"),Aa=un("transitionstart"),ir=un("transitioncancel"),Ql=un("transitionend"),ql=new Map,vo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Ss(B,Z){ql.set(B,Z),Nt(Z,[B])}var Mn=[],qs=0,Bo=0;function ll(){for(var B=qs,Z=Bo=qs=0;Z<B;){var Y=Mn[Z];Mn[Z++]=null;var F=Mn[Z];Mn[Z++]=null;var U=Mn[Z];Mn[Z++]=null;var ne=Mn[Z];if(Mn[Z++]=null,F!==null&&U!==null){var ce=F.pending;ce===null?U.next=U:(U.next=ce.next,ce.next=U),F.pending=U}ne!==0&&gl(Y,U,ne)}}function cl(B,Z,Y,F){Mn[qs++]=B,Mn[qs++]=Z,Mn[qs++]=Y,Mn[qs++]=F,Bo|=F,B.lanes|=F,B=B.alternate,B!==null&&(B.lanes|=F)}function Jr(B,Z,Y,F){return cl(B,Z,Y,F),ul(B)}function So(B,Z){return cl(B,null,null,Z),ul(B)}function gl(B,Z,Y){B.lanes|=Y;var F=B.alternate;F!==null&&(F.lanes|=Y);for(var U=!1,ne=B.return;ne!==null;)ne.childLanes|=Y,F=ne.alternate,F!==null&&(F.childLanes|=Y),ne.tag===22&&(B=ne.stateNode,B===null||B._visibility&1||(U=!0)),B=ne,ne=ne.return;U&&Z!==null&&B.tag===3&&(ne=B.stateNode,U=31-Ye(Y),ne=ne.hiddenUpdates,B=ne[U],B===null?ne[U]=[Z]:B.push(Z),Z.lane=Y|536870912)}function ul(B){if(50<Ws)throw Ws=0,Do=null,Error(u(185));for(var Z=B.return;Z!==null;)B=Z,Z=B.return;return B.tag===3?B.stateNode:null}var nr={},ec=new WeakMap;function cs(B,Z){if(typeof B=="object"&&B!==null){var Y=ec.get(B);return Y!==void 0?Y:(Z={value:B,source:Z,stack:Re(Z)},ec.set(B,Z),Z)}return{value:B,source:Z,stack:Re(Z)}}var Hr=[],sr=0,Yn=null,hl=0,zi=[],fs=0,Xo=null,eo=1,xo="";function Un(B,Z){Hr[sr++]=hl,Hr[sr++]=Yn,Yn=B,hl=Z}function qc(B,Z,Y){zi[fs++]=eo,zi[fs++]=xo,zi[fs++]=Xo,Xo=B;var F=eo;B=xo;var U=32-Ye(F)-1;F&=~(1<<U),Y+=1;var ne=32-Ye(Z)+U;if(30<ne){var ce=U-U%5;ne=(F&(1<<ce)-1).toString(32),F>>=ce,U-=ce,eo=1<<32-Ye(Z)+U|Y<<U|F,xo=ne+B}else eo=1<<ne|Y<<U|F,xo=B}function dl(B){B.return!==null&&(Un(B,1),qc(B,1,0))}function or(B){for(;B===Yn;)Yn=Hr[--sr],Hr[sr]=null,hl=Hr[--sr],Hr[sr]=null;for(;B===Xo;)Xo=zi[--fs],zi[fs]=null,xo=zi[--fs],zi[fs]=null,eo=zi[--fs],zi[fs]=null}var Tn=null,Xn=null,bi=!1,Xs=null,xs=!1,Cl=Error(u(519));function zr(B){var Z=Error(u(418,""));throw to(cs(Z,B)),Cl}function lu(B){var Z=B.stateNode,Y=B.type,F=B.memoizedProps;switch(Z[Ji]=B,Z[Qt]=F,Y){case"dialog":Gi("cancel",Z),Gi("close",Z);break;case"iframe":case"object":case"embed":Gi("load",Z);break;case"video":case"audio":for(Y=0;Y<Ng.length;Y++)Gi(Ng[Y],Z);break;case"source":Gi("error",Z);break;case"img":case"image":case"link":Gi("error",Z),Gi("load",Z);break;case"details":Gi("toggle",Z);break;case"input":Gi("invalid",Z),En(Z,F.value,F.defaultValue,F.checked,F.defaultChecked,F.type,F.name,!0),fi(Z);break;case"select":Gi("invalid",Z);break;case"textarea":Gi("invalid",Z),zs(Z,F.value,F.defaultValue,F.children),fi(Z)}Y=F.children,typeof Y!="string"&&typeof Y!="number"&&typeof Y!="bigint"||Z.textContent===""+Y||F.suppressHydrationWarning===!0||ld(Z.textContent,Y)?(F.popover!=null&&(Gi("beforetoggle",Z),Gi("toggle",Z)),F.onScroll!=null&&Gi("scroll",Z),F.onScrollEnd!=null&&Gi("scrollend",Z),F.onClick!=null&&(Z.onclick=sh),Z=!0):Z=!1,Z||zr(B)}function cu(B){for(Tn=B.return;Tn;)switch(Tn.tag){case 3:case 27:xs=!0;return;case 5:case 13:xs=!1;return;default:Tn=Tn.return}}function ma(B){if(B!==Tn)return!1;if(!bi)return cu(B),bi=!0,!1;var Z=!1,Y;if((Y=B.tag!==3&&B.tag!==27)&&((Y=B.tag===5)&&(Y=B.type,Y=!(Y!=="form"&&Y!=="button")||Hh(B.type,B.memoizedProps)),Y=!Y),Y&&(Z=!0),Z&&Xn&&zr(B),cu(B),B.tag===13){if(B=B.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(u(317));e:{for(B=B.nextSibling,Z=0;B;){if(B.nodeType===8)if(Y=B.data,Y==="/$"){if(Z===0){Xn=Oo(B.nextSibling);break e}Z--}else Y!=="$"&&Y!=="$!"&&Y!=="$?"||Z++;B=B.nextSibling}Xn=null}}else Xn=Tn?Oo(B.stateNode.nextSibling):null;return!0}function ba(){Xn=Tn=null,bi=!1}function to(B){Xs===null?Xs=[B]:Xs.push(B)}var rr=Error(u(460)),eg=Error(u(474)),tc={then:function(){}};function gu(B){return B=B.status,B==="fulfilled"||B==="rejected"}function Il(){}function ar(B,Z,Y){switch(Y=B[Y],Y===void 0?B.push(Z):Y!==Z&&(Z.then(Il,Il),Z=Y),Z.status){case"fulfilled":return Z.value;case"rejected":throw B=Z.reason,B===rr?Error(u(483)):B;default:if(typeof Z.status=="string")Z.then(Il,Il);else{if(B=Ni,B!==null&&100<B.shellSuspendCounter)throw Error(u(482));B=Z,B.status="pending",B.then(function(F){if(Z.status==="pending"){var U=Z;U.status="fulfilled",U.value=F}},function(F){if(Z.status==="pending"){var U=Z;U.status="rejected",U.reason=F}})}switch(Z.status){case"fulfilled":return Z.value;case"rejected":throw B=Z.reason,B===rr?Error(u(483)):B}throw ya=Z,rr}}var ya=null;function Xi(){if(ya===null)throw Error(u(459));var B=ya;return ya=null,B}var lr=null,fl=0;function pl(B){var Z=fl;return fl+=1,lr===null&&(lr=[]),ar(lr,B,Z)}function Al(B,Z){Z=Z.props.ref,B.ref=Z!==void 0?Z:null}function ic(B,Z){throw Z.$$typeof===C?Error(u(525)):(B=Object.prototype.toString.call(Z),Error(u(31,B==="[object Object]"?"object with keys {"+Object.keys(Z).join(", ")+"}":B)))}function uu(B){var Z=B._init;return Z(B._payload)}function hu(B){function Z(Ke,Te){if(B){var $e=Ke.deletions;$e===null?(Ke.deletions=[Te],Ke.flags|=16):$e.push(Te)}}function Y(Ke,Te){if(!B)return null;for(;Te!==null;)Z(Ke,Te),Te=Te.sibling;return null}function F(Ke){for(var Te=new Map;Ke!==null;)Ke.key!==null?Te.set(Ke.key,Ke):Te.set(Ke.index,Ke),Ke=Ke.sibling;return Te}function U(Ke,Te){return Ke=qn(Ke,Te),Ke.index=0,Ke.sibling=null,Ke}function ne(Ke,Te,$e){return Ke.index=$e,B?($e=Ke.alternate,$e!==null?($e=$e.index,$e<Te?(Ke.flags|=33554434,Te):$e):(Ke.flags|=33554434,Te)):(Ke.flags|=1048576,Te)}function ce(Ke){return B&&Ke.alternate===null&&(Ke.flags|=33554434),Ke}function pe(Ke,Te,$e,ft){return Te===null||Te.tag!==6?(Te=In($e,Ke.mode,ft),Te.return=Ke,Te):(Te=U(Te,$e),Te.return=Ke,Te)}function we(Ke,Te,$e,ft){var Ht=$e.type;return Ht===A?ht(Ke,Te,$e.props.children,ft,$e.key):Te!==null&&(Te.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&uu(Ht)===Te.type)?(Te=U(Te,$e.props),Al(Te,$e),Te.return=Ke,Te):(Te=Ea($e.type,$e.key,$e.props,null,Ke.mode,ft),Al(Te,$e),Te.return=Ke,Te)}function He(Ke,Te,$e,ft){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==$e.containerInfo||Te.stateNode.implementation!==$e.implementation?(Te=wl($e,Ke.mode,ft),Te.return=Ke,Te):(Te=U(Te,$e.children||[]),Te.return=Ke,Te)}function ht(Ke,Te,$e,ft,Ht){return Te===null||Te.tag!==7?(Te=xr($e,Ke.mode,ft,Ht),Te.return=Ke,Te):(Te=U(Te,$e),Te.return=Ke,Te)}function bt(Ke,Te,$e){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Te=In(""+Te,Ke.mode,$e),Te.return=Ke,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case I:return $e=Ea(Te.type,Te.key,Te.props,null,Ke.mode,$e),Al($e,Te),$e.return=Ke,$e;case f:return Te=wl(Te,Ke.mode,$e),Te.return=Ke,Te;case z:var ft=Te._init;return Te=ft(Te._payload),bt(Ke,Te,$e)}if(ue(Te)||Q(Te))return Te=xr(Te,Ke.mode,$e,null),Te.return=Ke,Te;if(typeof Te.then=="function")return bt(Ke,pl(Te),$e);if(Te.$$typeof===M)return bt(Ke,mc(Ke,Te),$e);ic(Ke,Te)}return null}function tt(Ke,Te,$e,ft){var Ht=Te!==null?Te.key:null;if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return Ht!==null?null:pe(Ke,Te,""+$e,ft);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case I:return $e.key===Ht?we(Ke,Te,$e,ft):null;case f:return $e.key===Ht?He(Ke,Te,$e,ft):null;case z:return Ht=$e._init,$e=Ht($e._payload),tt(Ke,Te,$e,ft)}if(ue($e)||Q($e))return Ht!==null?null:ht(Ke,Te,$e,ft,null);if(typeof $e.then=="function")return tt(Ke,Te,pl($e),ft);if($e.$$typeof===M)return tt(Ke,Te,mc(Ke,$e),ft);ic(Ke,$e)}return null}function ct(Ke,Te,$e,ft,Ht){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Ke=Ke.get($e)||null,pe(Te,Ke,""+ft,Ht);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case I:return Ke=Ke.get(ft.key===null?$e:ft.key)||null,we(Te,Ke,ft,Ht);case f:return Ke=Ke.get(ft.key===null?$e:ft.key)||null,He(Te,Ke,ft,Ht);case z:var Ai=ft._init;return ft=Ai(ft._payload),ct(Ke,Te,$e,ft,Ht)}if(ue(ft)||Q(ft))return Ke=Ke.get($e)||null,ht(Te,Ke,ft,Ht,null);if(typeof ft.then=="function")return ct(Ke,Te,$e,pl(ft),Ht);if(ft.$$typeof===M)return ct(Ke,Te,$e,mc(Te,ft),Ht);ic(Te,ft)}return null}function Lt(Ke,Te,$e,ft){for(var Ht=null,Ai=null,Pt=Te,jt=Te=0,Pn=null;Pt!==null&&jt<$e.length;jt++){Pt.index>jt?(Pn=Pt,Pt=null):Pn=Pt.sibling;var xi=tt(Ke,Pt,$e[jt],ft);if(xi===null){Pt===null&&(Pt=Pn);break}B&&Pt&&xi.alternate===null&&Z(Ke,Pt),Te=ne(xi,Te,jt),Ai===null?Ht=xi:Ai.sibling=xi,Ai=xi,Pt=Pn}if(jt===$e.length)return Y(Ke,Pt),bi&&Un(Ke,jt),Ht;if(Pt===null){for(;jt<$e.length;jt++)Pt=bt(Ke,$e[jt],ft),Pt!==null&&(Te=ne(Pt,Te,jt),Ai===null?Ht=Pt:Ai.sibling=Pt,Ai=Pt);return bi&&Un(Ke,jt),Ht}for(Pt=F(Pt);jt<$e.length;jt++)Pn=ct(Pt,Ke,jt,$e[jt],ft),Pn!==null&&(B&&Pn.alternate!==null&&Pt.delete(Pn.key===null?jt:Pn.key),Te=ne(Pn,Te,jt),Ai===null?Ht=Pn:Ai.sibling=Pn,Ai=Pn);return B&&Pt.forEach(function(Pa){return Z(Ke,Pa)}),bi&&Un(Ke,jt),Ht}function si(Ke,Te,$e,ft){if($e==null)throw Error(u(151));for(var Ht=null,Ai=null,Pt=Te,jt=Te=0,Pn=null,xi=$e.next();Pt!==null&&!xi.done;jt++,xi=$e.next()){Pt.index>jt?(Pn=Pt,Pt=null):Pn=Pt.sibling;var Pa=tt(Ke,Pt,xi.value,ft);if(Pa===null){Pt===null&&(Pt=Pn);break}B&&Pt&&Pa.alternate===null&&Z(Ke,Pt),Te=ne(Pa,Te,jt),Ai===null?Ht=Pa:Ai.sibling=Pa,Ai=Pa,Pt=Pn}if(xi.done)return Y(Ke,Pt),bi&&Un(Ke,jt),Ht;if(Pt===null){for(;!xi.done;jt++,xi=$e.next())xi=bt(Ke,xi.value,ft),xi!==null&&(Te=ne(xi,Te,jt),Ai===null?Ht=xi:Ai.sibling=xi,Ai=xi);return bi&&Un(Ke,jt),Ht}for(Pt=F(Pt);!xi.done;jt++,xi=$e.next())xi=ct(Pt,Ke,jt,xi.value,ft),xi!==null&&(B&&xi.alternate!==null&&Pt.delete(xi.key===null?jt:xi.key),Te=ne(xi,Te,jt),Ai===null?Ht=xi:Ai.sibling=xi,Ai=xi);return B&&Pt.forEach(function(fC){return Z(Ke,fC)}),bi&&Un(Ke,jt),Ht}function An(Ke,Te,$e,ft){if(typeof $e=="object"&&$e!==null&&$e.type===A&&$e.key===null&&($e=$e.props.children),typeof $e=="object"&&$e!==null){switch($e.$$typeof){case I:e:{for(var Ht=$e.key;Te!==null;){if(Te.key===Ht){if(Ht=$e.type,Ht===A){if(Te.tag===7){Y(Ke,Te.sibling),ft=U(Te,$e.props.children),ft.return=Ke,Ke=ft;break e}}else if(Te.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&uu(Ht)===Te.type){Y(Ke,Te.sibling),ft=U(Te,$e.props),Al(ft,$e),ft.return=Ke,Ke=ft;break e}Y(Ke,Te);break}else Z(Ke,Te);Te=Te.sibling}$e.type===A?(ft=xr($e.props.children,Ke.mode,ft,$e.key),ft.return=Ke,Ke=ft):(ft=Ea($e.type,$e.key,$e.props,null,Ke.mode,ft),Al(ft,$e),ft.return=Ke,Ke=ft)}return ce(Ke);case f:e:{for(Ht=$e.key;Te!==null;){if(Te.key===Ht)if(Te.tag===4&&Te.stateNode.containerInfo===$e.containerInfo&&Te.stateNode.implementation===$e.implementation){Y(Ke,Te.sibling),ft=U(Te,$e.children||[]),ft.return=Ke,Ke=ft;break e}else{Y(Ke,Te);break}else Z(Ke,Te);Te=Te.sibling}ft=wl($e,Ke.mode,ft),ft.return=Ke,Ke=ft}return ce(Ke);case z:return Ht=$e._init,$e=Ht($e._payload),An(Ke,Te,$e,ft)}if(ue($e))return Lt(Ke,Te,$e,ft);if(Q($e)){if(Ht=Q($e),typeof Ht!="function")throw Error(u(150));return $e=Ht.call($e),si(Ke,Te,$e,ft)}if(typeof $e.then=="function")return An(Ke,Te,pl($e),ft);if($e.$$typeof===M)return An(Ke,Te,mc(Ke,$e),ft);ic(Ke,$e)}return typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint"?($e=""+$e,Te!==null&&Te.tag===6?(Y(Ke,Te.sibling),ft=U(Te,$e),ft.return=Ke,Ke=ft):(Y(Ke,Te),ft=In($e,Ke.mode,ft),ft.return=Ke,Ke=ft),ce(Ke)):Y(Ke,Te)}return function(Ke,Te,$e,ft){try{fl=0;var Ht=An(Ke,Te,$e,ft);return lr=null,Ht}catch(Pt){if(Pt===rr)throw Pt;var Ai=ln(29,Pt,null,Ke.mode);return Ai.lanes=ft,Ai.return=Ke,Ai}finally{}}}var Ro=hu(!0),Zo=hu(!1),Lr=Ee(null),Fr=Ee(0);function cr(B,Z){B=Po,st(Fr,B),st(Lr,Z),Po=B|Z.baseLanes}function nc(){st(Fr,Po),st(Lr,Lr.current)}function ml(){Po=Fr.current,Ct(Lr),Ct(Fr)}var gs=Ee(null),io=null;function wo(B){var Z=B.alternate;st(hn,hn.current&1),st(gs,B),io===null&&(Z===null||Lr.current!==null||Z.memoizedState!==null)&&(io=B)}function tg(B){if(B.tag===22){if(st(hn,hn.current),st(gs,B),io===null){var Z=B.alternate;Z!==null&&Z.memoizedState!==null&&(io=B)}}else _o()}function _o(){st(hn,hn.current),st(gs,gs.current)}function no(B){Ct(gs),io===B&&(io=null),Ct(hn)}var hn=Ee(0);function Ga(B){for(var Z=B;Z!==null;){if(Z.tag===13){var Y=Z.memoizedState;if(Y!==null&&(Y=Y.dehydrated,Y===null||Y.data==="$?"||Y.data==="$!"))return Z}else if(Z.tag===19&&Z.memoizedProps.revealOrder!==void 0){if((Z.flags&128)!==0)return Z}else if(Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===B)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===B)return null;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}return null}var ui=typeof AbortController<"u"?AbortController:function(){var B=[],Z=this.signal={aborted:!1,addEventListener:function(Y,F){B.push(F)}};this.abort=function(){Z.aborted=!0,B.forEach(function(Y){return Y()})}},yh=n.unstable_scheduleCallback,ps=n.unstable_NormalPriority,tn={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ig(){return{controller:new ui,data:new Map,refCount:0}}function gr(B){B.refCount--,B.refCount===0&&yh(ps,function(){B.controller.abort()})}var so=null,ur=0,Kr=0,hr=null;function Gh(B,Z){if(so===null){var Y=so=[];ur=0,Kr=_h(),hr={status:"pending",value:void 0,then:function(F){Y.push(F)}}}return ur++,Z.then(ng,ng),Z}function ng(){if(--ur===0&&so!==null){hr!==null&&(hr.status="fulfilled");var B=so;so=null,Kr=0,hr=null;for(var Z=0;Z<B.length;Z++)(0,B[Z])()}}function dr(B,Z){var Y=[],F={status:"pending",value:null,reason:null,then:function(U){Y.push(U)}};return B.then(function(){F.status="fulfilled",F.value=Z;for(var U=0;U<Y.length;U++)(0,Y[U])(Z)},function(U){for(F.status="rejected",F.reason=U,U=0;U<Y.length;U++)(0,Y[U])(void 0)}),F}var sc=te.S;te.S=function(B,Z){typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Gh(B,Z),sc!==null&&sc(B,Z)};var Mo=Ee(null);function bl(){var B=Mo.current;return B!==null?B:Ni.pooledCache}function va(B,Z){Z===null?st(Mo,Mo.current):st(Mo,Z.pool)}function No(){var B=bl();return B===null?null:{parent:tn._currentValue,pool:B}}var Vo=0,ri=null,wi=null,dn=null,$t=!1,Cr=!1,Ir=!1,Ba=0,fr=0,Sa=null,vh=0;function qi(){throw Error(u(321))}function Pr(B,Z){if(Z===null)return!1;for(var Y=0;Y<Z.length&&Y<B.length;Y++)if(!rs(B[Y],Z[Y]))return!1;return!0}function sg(B,Z,Y,F,U,ne){return Vo=ne,ri=Z,Z.memoizedState=null,Z.updateQueue=null,Z.lanes=0,te.H=B===null||B.memoizedState===null?Ar:Eo,Ir=!1,ne=Y(F,U),Ir=!1,Cr&&(ne=Cu(Z,Y,F,U)),du(B),ne}function du(B){te.H=ro;var Z=wi!==null&&wi.next!==null;if(Vo=0,dn=wi=ri=null,$t=!1,fr=0,Sa=null,Z)throw Error(u(300));B===null||yn||(B=B.dependencies,B!==null&&wa(B)&&(yn=!0))}function Cu(B,Z,Y,F){ri=B;var U=0;do{if(Cr&&(Sa=null),fr=0,Cr=!1,25<=U)throw Error(u(301));if(U+=1,dn=wi=null,B.updateQueue!=null){var ne=B.updateQueue;ne.lastEffect=null,ne.events=null,ne.stores=null,ne.memoCache!=null&&(ne.memoCache.index=0)}te.H=Or,ne=Z(Y,F)}while(Cr);return ne}function Bh(){var B=te.H,Z=B.useState()[0];return Z=typeof Z.then=="function"?Gl(Z):Z,B=B.useState()[0],(wi!==null?wi.memoizedState:null)!==B&&(ri.flags|=1024),Z}function og(){var B=Ba!==0;return Ba=0,B}function yl(B,Z,Y){Z.updateQueue=B.updateQueue,Z.flags&=-2053,B.lanes&=~Y}function oc(B){if($t){for(B=B.memoizedState;B!==null;){var Z=B.queue;Z!==null&&(Z.pending=null),B=B.next}$t=!1}Vo=0,dn=wi=ri=null,Cr=!1,fr=Ba=0,Sa=null}function Nn(){var B={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dn===null?ri.memoizedState=dn=B:dn=dn.next=B,dn}function nn(){if(wi===null){var B=ri.alternate;B=B!==null?B.memoizedState:null}else B=wi.next;var Z=dn===null?ri.memoizedState:dn.next;if(Z!==null)dn=Z,wi=B;else{if(B===null)throw ri.alternate===null?Error(u(467)):Error(u(310));wi=B,B={memoizedState:wi.memoizedState,baseState:wi.baseState,baseQueue:wi.baseQueue,queue:wi.queue,next:null},dn===null?ri.memoizedState=dn=B:dn=dn.next=B}return dn}var rc;rc=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Gl(B){var Z=fr;return fr+=1,Sa===null&&(Sa=[]),B=ar(Sa,B,Z),Z=ri,(dn===null?Z.memoizedState:dn.next)===null&&(Z=Z.alternate,te.H=Z===null||Z.memoizedState===null?Ar:Eo),B}function Xa(B){if(B!==null&&typeof B=="object"){if(typeof B.then=="function")return Gl(B);if(B.$$typeof===M)return Jn(B)}throw Error(u(438,String(B)))}function Fs(B){var Z=null,Y=ri.updateQueue;if(Y!==null&&(Z=Y.memoCache),Z==null){var F=ri.alternate;F!==null&&(F=F.updateQueue,F!==null&&(F=F.memoCache,F!=null&&(Z={data:F.data.map(function(U){return U.slice()}),index:0})))}if(Z==null&&(Z={data:[],index:0}),Y===null&&(Y=rc(),ri.updateQueue=Y),Y.memoCache=Z,Y=Z.data[Z.index],Y===void 0)for(Y=Z.data[Z.index]=Array(B),F=0;F<B;F++)Y[F]=K;return Z.index++,Y}function Oi(B,Z){return typeof Z=="function"?Z(B):Z}function Ks(B){var Z=nn();return us(Z,wi,B)}function us(B,Z,Y){var F=B.queue;if(F===null)throw Error(u(311));F.lastRenderedReducer=Y;var U=B.baseQueue,ne=F.pending;if(ne!==null){if(U!==null){var ce=U.next;U.next=ne.next,ne.next=ce}Z.baseQueue=U=ne,F.pending=null}if(ne=B.baseState,U===null)B.memoizedState=ne;else{Z=U.next;var pe=ce=null,we=null,He=Z,ht=!1;do{var bt=He.lane&-536870913;if(bt!==He.lane?(Dt&bt)===bt:(Vo&bt)===bt){var tt=He.revertLane;if(tt===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null}),bt===Kr&&(ht=!0);else if((Vo&tt)===tt){He=He.next,tt===Kr&&(ht=!0);continue}else bt={lane:0,revertLane:He.revertLane,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null},we===null?(pe=we=bt,ce=ne):we=we.next=bt,ri.lanes|=tt,js|=tt;bt=He.action,Ir&&Y(ne,bt),ne=He.hasEagerState?He.eagerState:Y(ne,bt)}else tt={lane:bt,revertLane:He.revertLane,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null},we===null?(pe=we=tt,ce=ne):we=we.next=tt,ri.lanes|=bt,js|=bt;He=He.next}while(He!==null&&He!==Z);if(we===null?ce=ne:we.next=pe,!rs(ne,B.memoizedState)&&(yn=!0,ht&&(Y=hr,Y!==null)))throw Y;B.memoizedState=ne,B.baseState=ce,B.baseQueue=we,F.lastRenderedState=ne}return U===null&&(F.lanes=0),[B.memoizedState,F.dispatch]}function ac(B){var Z=nn(),Y=Z.queue;if(Y===null)throw Error(u(311));Y.lastRenderedReducer=B;var F=Y.dispatch,U=Y.pending,ne=Z.memoizedState;if(U!==null){Y.pending=null;var ce=U=U.next;do ne=B(ne,ce.action),ce=ce.next;while(ce!==U);rs(ne,Z.memoizedState)||(yn=!0),Z.memoizedState=ne,Z.baseQueue===null&&(Z.baseState=ne),Y.lastRenderedState=ne}return[ne,F]}function Iu(B,Z,Y){var F=ri,U=nn(),ne=bi;if(ne){if(Y===void 0)throw Error(u(407));Y=Y()}else Y=Z();var ce=!rs((wi||U).memoizedState,Y);if(ce&&(U.memoizedState=Y,yn=!0),U=U.queue,cg(fu.bind(null,F,U,B),[B]),U.getSnapshot!==Z||ce||dn!==null&&dn.memoizedState.tag&1){if(F.flags|=2048,oo(9,pr.bind(null,F,U,Y,Z),{destroy:void 0},null),Ni===null)throw Error(u(349));ne||(Vo&60)!==0||$n(F,Z,Y)}return Y}function $n(B,Z,Y){B.flags|=16384,B={getSnapshot:Z,value:Y},Z=ri.updateQueue,Z===null?(Z=rc(),ri.updateQueue=Z,Z.stores=[B]):(Y=Z.stores,Y===null?Z.stores=[B]:Y.push(B))}function pr(B,Z,Y,F){Z.value=Y,Z.getSnapshot=F,pu(Z)&&Au(B)}function fu(B,Z,Y){return Y(function(){pu(Z)&&Au(B)})}function pu(B){var Z=B.getSnapshot;B=B.value;try{var Y=Z();return!rs(B,Y)}catch{return!0}}function Au(B){var Z=So(B,2);Z!==null&&pn(Z,B,2)}function rg(B){var Z=Nn();if(typeof B=="function"){var Y=B;if(B=Y(),Ir){ye(!0);try{Y()}finally{ye(!1)}}}return Z.memoizedState=Z.baseState=B,Z.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:B},Z}function ag(B,Z,Y,F){return B.baseState=Y,us(B,wi,typeof F=="function"?F:Oi)}function Sh(B,Z,Y,F,U){if(hc(B))throw Error(u(485));if(B=Z.action,B!==null){var ne={payload:U,action:B,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ce){ne.listeners.push(ce)}};te.T!==null?Y(!0):ne.isTransition=!1,F(ne),Y=Z.pending,Y===null?(ne.next=Z.pending=ne,lg(Z,ne)):(ne.next=Y.next,Z.pending=Y.next=ne)}}function lg(B,Z){var Y=Z.action,F=Z.payload,U=B.state;if(Z.isTransition){var ne=te.T,ce={};te.T=ce;try{var pe=Y(U,F),we=te.S;we!==null&&we(ce,pe),mu(B,Z,pe)}catch(He){Wo(B,Z,He)}finally{te.T=ne}}else try{ne=Y(U,F),mu(B,Z,ne)}catch(He){Wo(B,Z,He)}}function mu(B,Z,Y){Y!==null&&typeof Y=="object"&&typeof Y.then=="function"?Y.then(function(F){Dr(B,Z,F)},function(F){return Wo(B,Z,F)}):Dr(B,Z,Y)}function Dr(B,Z,Y){Z.status="fulfilled",Z.value=Y,bu(Z),B.state=Y,Z=B.pending,Z!==null&&(Y=Z.next,Y===Z?B.pending=null:(Y=Y.next,Z.next=Y,lg(B,Y)))}function Wo(B,Z,Y){var F=B.pending;if(B.pending=null,F!==null){F=F.next;do Z.status="rejected",Z.reason=Y,bu(Z),Z=Z.next;while(Z!==F)}B.action=null}function bu(B){B=B.listeners;for(var Z=0;Z<B.length;Z++)(0,B[Z])()}function yu(B,Z){return Z}function Gu(B,Z){if(bi){var Y=Ni.formState;if(Y!==null){e:{var F=ri;if(bi){if(Xn){t:{for(var U=Xn,ne=xs;U.nodeType!==8;){if(!ne){U=null;break t}if(U=Oo(U.nextSibling),U===null){U=null;break t}}ne=U.data,U=ne==="F!"||ne==="F"?U:null}if(U){Xn=Oo(U.nextSibling),F=U.data==="F!";break e}}zr(F)}F=!1}F&&(Z=Y[0])}}return Y=Nn(),Y.memoizedState=Y.baseState=Z,F={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yu,lastRenderedState:Z},Y.queue=F,Y=dg.bind(null,ri,F),F.dispatch=Y,F=rg(!1),ne=vl.bind(null,ri,!1,F.queue),F=Nn(),U={state:Z,dispatch:null,action:B,pending:null},F.queue=U,Y=Sh.bind(null,ri,U,ne,Y),U.dispatch=Y,F.memoizedState=B,[Z,Y,!1]}function xa(B){var Z=nn();return vu(Z,wi,B)}function vu(B,Z,Y){Z=us(B,Z,yu)[0],B=Ks(Oi)[0],Z=typeof Z=="object"&&Z!==null&&typeof Z.then=="function"?Gl(Z):Z;var F=nn(),U=F.queue,ne=U.dispatch;return Y!==F.memoizedState&&(ri.flags|=2048,oo(9,Xh.bind(null,U,Y),{destroy:void 0},null)),[Z,ne,B]}function Xh(B,Z){B.action=Z}function Bu(B){var Z=nn(),Y=wi;if(Y!==null)return vu(Z,Y,B);nn(),Z=Z.memoizedState,Y=nn();var F=Y.queue.dispatch;return Y.memoizedState=B,[Z,F,!1]}function oo(B,Z,Y,F){return B={tag:B,create:Z,inst:Y,deps:F,next:null},Z=ri.updateQueue,Z===null&&(Z=rc(),ri.updateQueue=Z),Y=Z.lastEffect,Y===null?Z.lastEffect=B.next=B:(F=Y.next,Y.next=B,B.next=F,Z.lastEffect=B),B}function Su(){return nn().memoizedState}function lc(B,Z,Y,F){var U=Nn();ri.flags|=B,U.memoizedState=oo(1|Z,Y,{destroy:void 0},F===void 0?null:F)}function cc(B,Z,Y,F){var U=nn();F=F===void 0?null:F;var ne=U.memoizedState.inst;wi!==null&&F!==null&&Pr(F,wi.memoizedState.deps)?U.memoizedState=oo(Z,Y,ne,F):(ri.flags|=B,U.memoizedState=oo(1|Z,Y,ne,F))}function Xu(B,Z){lc(8390656,8,B,Z)}function cg(B,Z){cc(2048,8,B,Z)}function xu(B,Z){return cc(4,2,B,Z)}function Ru(B,Z){return cc(4,4,B,Z)}function Zu(B,Z){if(typeof Z=="function"){B=B();var Y=Z(B);return function(){typeof Y=="function"?Y():Z(null)}}if(Z!=null)return B=B(),Z.current=B,function(){Z.current=null}}function wu(B,Z,Y){Y=Y!=null?Y.concat([B]):null,cc(4,4,Zu.bind(null,Z,B),Y)}function gg(){}function _u(B,Z){var Y=nn();Z=Z===void 0?null:Z;var F=Y.memoizedState;return Z!==null&&Pr(Z,F[1])?F[0]:(Y.memoizedState=[B,Z],B)}function Mu(B,Z){var Y=nn();Z=Z===void 0?null:Z;var F=Y.memoizedState;if(Z!==null&&Pr(Z,F[1]))return F[0];if(F=B(),Ir){ye(!0);try{B()}finally{ye(!1)}}return Y.memoizedState=[F,Z],F}function gc(B,Z,Y){return Y===void 0||(Vo&1073741824)!==0?B.memoizedState=Z:(B.memoizedState=Y,B=Gs(),ri.lanes|=B,js|=B,Y)}function Nu(B,Z,Y,F){return rs(Y,Z)?Y:Lr.current!==null?(B=gc(B,Y,F),rs(B,Z)||(yn=!0),B):(Vo&42)===0?(yn=!0,B.memoizedState=Y):(B=Gs(),ri.lanes|=B,js|=B,Z)}function Vu(B,Z,Y,F,U){var ne=me.p;me.p=ne!==0&&8>ne?ne:8;var ce=te.T,pe={};te.T=pe,vl(B,!1,Z,Y);try{var we=U(),He=te.S;if(He!==null&&He(pe,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var ht=dr(we,F);kr(B,Z,ht,ts(B))}else kr(B,Z,F,ts(B))}catch(bt){kr(B,Z,{then:function(){},status:"rejected",reason:bt},ts())}finally{me.p=ne,te.T=ce}}function xh(){}function ug(B,Z,Y,F){if(B.tag!==5)throw Error(u(476));var U=Wu(B).queue;Vu(B,U,Z,xe,Y===null?xh:function(){return Eu(B),Y(F)})}function Wu(B){var Z=B.memoizedState;if(Z!==null)return Z;Z={memoizedState:xe,baseState:xe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:xe},next:null};var Y={};return Z.next={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:Y},next:null},B.memoizedState=Z,B=B.alternate,B!==null&&(B.memoizedState=Z),Z}function Eu(B){var Z=Wu(B).next.queue;kr(B,Z,{},ts())}function uc(){return Jn(Tg)}function hg(){return nn().memoizedState}function Yu(){return nn().memoizedState}function Tu(B){for(var Z=B.return;Z!==null;){switch(Z.tag){case 24:case 3:var Y=ts();B=bs(Y);var F=ys(Z,B,Y);F!==null&&(pn(F,Z,Y),yr(F,Z,Y)),Z={cache:ig()},B.payload=Z;return}Z=Z.return}}function Ju(B,Z,Y){var F=ts();Y={lane:F,revertLane:0,action:Y,hasEagerState:!1,eagerState:null,next:null},hc(B)?Hu(Z,Y):(Y=Jr(B,Z,Y,F),Y!==null&&(pn(Y,B,F),zu(Y,Z,F)))}function dg(B,Z,Y){var F=ts();kr(B,Z,Y,F)}function kr(B,Z,Y,F){var U={lane:F,revertLane:0,action:Y,hasEagerState:!1,eagerState:null,next:null};if(hc(B))Hu(Z,U);else{var ne=B.alternate;if(B.lanes===0&&(ne===null||ne.lanes===0)&&(ne=Z.lastRenderedReducer,ne!==null))try{var ce=Z.lastRenderedState,pe=ne(ce,Y);if(U.hasEagerState=!0,U.eagerState=pe,rs(pe,ce))return cl(B,Z,U,0),Ni===null&&ll(),!1}catch{}finally{}if(Y=Jr(B,Z,U,F),Y!==null)return pn(Y,B,F),zu(Y,Z,F),!0}return!1}function vl(B,Z,Y,F){if(F={lane:2,revertLane:_h(),action:F,hasEagerState:!1,eagerState:null,next:null},hc(B)){if(Z)throw Error(u(479))}else Z=Jr(B,Y,F,2),Z!==null&&pn(Z,B,2)}function hc(B){var Z=B.alternate;return B===ri||Z!==null&&Z===ri}function Hu(B,Z){Cr=$t=!0;var Y=B.pending;Y===null?Z.next=Z:(Z.next=Y.next,Y.next=Z),B.pending=Z}function zu(B,Z,Y){if((Y&4194176)!==0){var F=Z.lanes;F&=B.pendingLanes,Y|=F,Z.lanes=Y,mn(B,Y)}}var ro={readContext:Jn,use:Xa,useCallback:qi,useContext:qi,useEffect:qi,useImperativeHandle:qi,useLayoutEffect:qi,useInsertionEffect:qi,useMemo:qi,useReducer:qi,useRef:qi,useState:qi,useDebugValue:qi,useDeferredValue:qi,useTransition:qi,useSyncExternalStore:qi,useId:qi};ro.useCacheRefresh=qi,ro.useMemoCache=qi,ro.useHostTransitionStatus=qi,ro.useFormState=qi,ro.useActionState=qi,ro.useOptimistic=qi;var Ar={readContext:Jn,use:Xa,useCallback:function(B,Z){return Nn().memoizedState=[B,Z===void 0?null:Z],B},useContext:Jn,useEffect:Xu,useImperativeHandle:function(B,Z,Y){Y=Y!=null?Y.concat([B]):null,lc(4194308,4,Zu.bind(null,Z,B),Y)},useLayoutEffect:function(B,Z){return lc(4194308,4,B,Z)},useInsertionEffect:function(B,Z){lc(4,2,B,Z)},useMemo:function(B,Z){var Y=Nn();Z=Z===void 0?null:Z;var F=B();if(Ir){ye(!0);try{B()}finally{ye(!1)}}return Y.memoizedState=[F,Z],F},useReducer:function(B,Z,Y){var F=Nn();if(Y!==void 0){var U=Y(Z);if(Ir){ye(!0);try{Y(Z)}finally{ye(!1)}}}else U=Z;return F.memoizedState=F.baseState=U,B={pending:null,lanes:0,dispatch:null,lastRenderedReducer:B,lastRenderedState:U},F.queue=B,B=B.dispatch=Ju.bind(null,ri,B),[F.memoizedState,B]},useRef:function(B){var Z=Nn();return B={current:B},Z.memoizedState=B},useState:function(B){B=rg(B);var Z=B.queue,Y=dg.bind(null,ri,Z);return Z.dispatch=Y,[B.memoizedState,Y]},useDebugValue:gg,useDeferredValue:function(B,Z){var Y=Nn();return gc(Y,B,Z)},useTransition:function(){var B=rg(!1);return B=Vu.bind(null,ri,B.queue,!0,!1),Nn().memoizedState=B,[!1,B]},useSyncExternalStore:function(B,Z,Y){var F=ri,U=Nn();if(bi){if(Y===void 0)throw Error(u(407));Y=Y()}else{if(Y=Z(),Ni===null)throw Error(u(349));(Dt&60)!==0||$n(F,Z,Y)}U.memoizedState=Y;var ne={value:Y,getSnapshot:Z};return U.queue=ne,Xu(fu.bind(null,F,ne,B),[B]),F.flags|=2048,oo(9,pr.bind(null,F,ne,Y,Z),{destroy:void 0},null),Y},useId:function(){var B=Nn(),Z=Ni.identifierPrefix;if(bi){var Y=xo,F=eo;Y=(F&~(1<<32-Ye(F)-1)).toString(32)+Y,Z=":"+Z+"R"+Y,Y=Ba++,0<Y&&(Z+="H"+Y.toString(32)),Z+=":"}else Y=vh++,Z=":"+Z+"r"+Y.toString(32)+":";return B.memoizedState=Z},useCacheRefresh:function(){return Nn().memoizedState=Tu.bind(null,ri)}};Ar.useMemoCache=Fs,Ar.useHostTransitionStatus=uc,Ar.useFormState=Gu,Ar.useActionState=Gu,Ar.useOptimistic=function(B){var Z=Nn();Z.memoizedState=Z.baseState=B;var Y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return Z.queue=Y,Z=vl.bind(null,ri,!0,Y),Y.dispatch=Z,[B,Z]};var Eo={readContext:Jn,use:Xa,useCallback:_u,useContext:Jn,useEffect:cg,useImperativeHandle:wu,useInsertionEffect:xu,useLayoutEffect:Ru,useMemo:Mu,useReducer:Ks,useRef:Su,useState:function(){return Ks(Oi)},useDebugValue:gg,useDeferredValue:function(B,Z){var Y=nn();return Nu(Y,wi.memoizedState,B,Z)},useTransition:function(){var B=Ks(Oi)[0],Z=nn().memoizedState;return[typeof B=="boolean"?B:Gl(B),Z]},useSyncExternalStore:Iu,useId:hg};Eo.useCacheRefresh=Yu,Eo.useMemoCache=Fs,Eo.useHostTransitionStatus=uc,Eo.useFormState=xa,Eo.useActionState=xa,Eo.useOptimistic=function(B,Z){var Y=nn();return ag(Y,wi,B,Z)};var Or={readContext:Jn,use:Xa,useCallback:_u,useContext:Jn,useEffect:cg,useImperativeHandle:wu,useInsertionEffect:xu,useLayoutEffect:Ru,useMemo:Mu,useReducer:ac,useRef:Su,useState:function(){return ac(Oi)},useDebugValue:gg,useDeferredValue:function(B,Z){var Y=nn();return wi===null?gc(Y,B,Z):Nu(Y,wi.memoizedState,B,Z)},useTransition:function(){var B=ac(Oi)[0],Z=nn().memoizedState;return[typeof B=="boolean"?B:Gl(B),Z]},useSyncExternalStore:Iu,useId:hg};Or.useCacheRefresh=Yu,Or.useMemoCache=Fs,Or.useHostTransitionStatus=uc,Or.useFormState=Bu,Or.useActionState=Bu,Or.useOptimistic=function(B,Z){var Y=nn();return wi!==null?ag(Y,wi,B,Z):(Y.baseState=B,[B,Y.queue.dispatch])};function Cg(B,Z,Y,F){Z=B.memoizedState,Y=Y(F,Z),Y=Y==null?Z:se({},Z,Y),B.memoizedState=Y,B.lanes===0&&(B.updateQueue.baseState=Y)}var Ig={isMounted:function(B){return(B=B._reactInternals)?Se(B)===B:!1},enqueueSetState:function(B,Z,Y){B=B._reactInternals;var F=ts(),U=bs(F);U.payload=Z,Y!=null&&(U.callback=Y),Z=ys(B,U,F),Z!==null&&(pn(Z,B,F),yr(Z,B,F))},enqueueReplaceState:function(B,Z,Y){B=B._reactInternals;var F=ts(),U=bs(F);U.tag=1,U.payload=Z,Y!=null&&(U.callback=Y),Z=ys(B,U,F),Z!==null&&(pn(Z,B,F),yr(Z,B,F))},enqueueForceUpdate:function(B,Z){B=B._reactInternals;var Y=ts(),F=bs(Y);F.tag=2,Z!=null&&(F.callback=Z),Z=ys(B,F,Y),Z!==null&&(pn(Z,B,Y),yr(Z,B,Y))}};function Lu(B,Z,Y,F,U,ne,ce){return B=B.stateNode,typeof B.shouldComponentUpdate=="function"?B.shouldComponentUpdate(F,ne,ce):Z.prototype&&Z.prototype.isPureReactComponent?!Ls(Y,F)||!Ls(U,ne):!0}function Fu(B,Z,Y,F){B=Z.state,typeof Z.componentWillReceiveProps=="function"&&Z.componentWillReceiveProps(Y,F),typeof Z.UNSAFE_componentWillReceiveProps=="function"&&Z.UNSAFE_componentWillReceiveProps(Y,F),Z.state!==B&&Ig.enqueueReplaceState(Z,Z.state,null)}function Ur(B,Z){var Y=Z;if("ref"in Z){Y={};for(var F in Z)F!=="ref"&&(Y[F]=Z[F])}if(B=B.defaultProps){Y===Z&&(Y=se({},Y));for(var U in B)Y[U]===void 0&&(Y[U]=B[U])}return Y}var dc=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function Ku(B){dc(B)}function Pu(B){console.error(B)}function Du(B){dc(B)}function Cc(B,Z){try{var Y=B.onUncaughtError;Y(Z.value,{componentStack:Z.stack})}catch(F){setTimeout(function(){throw F})}}function ku(B,Z,Y){try{var F=B.onCaughtError;F(Y.value,{componentStack:Y.stack,errorBoundary:Z.tag===1?Z.stateNode:null})}catch(U){setTimeout(function(){throw U})}}function fg(B,Z,Y){return Y=bs(Y),Y.tag=3,Y.payload={element:null},Y.callback=function(){Cc(B,Z)},Y}function pg(B){return B=bs(B),B.tag=3,B}function Ou(B,Z,Y,F){var U=Y.type.getDerivedStateFromError;if(typeof U=="function"){var ne=F.value;B.payload=function(){return U(ne)},B.callback=function(){ku(Z,Y,F)}}var ce=Y.stateNode;ce!==null&&typeof ce.componentDidCatch=="function"&&(B.callback=function(){ku(Z,Y,F),typeof U!="function"&&(fn===null?fn=new Set([this]):fn.add(this));var pe=F.stack;this.componentDidCatch(F.value,{componentStack:pe!==null?pe:""})})}function Rh(B,Z,Y,F,U){if(Y.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){if(Z=Y.alternate,Z!==null&&Sl(Z,Y,U,!0),Y=gs.current,Y!==null){switch(Y.tag){case 13:return io===null?Nl():Y.alternate===null&&Di===0&&(Di=3),Y.flags&=-257,Y.flags|=65536,Y.lanes=U,F===tc?Y.flags|=16384:(Z=Y.updateQueue,Z===null?Y.updateQueue=new Set([F]):Z.add(F),ii(B,F,U)),!1;case 22:return Y.flags|=65536,F===tc?Y.flags|=16384:(Z=Y.updateQueue,Z===null?(Z={transitions:null,markerInstances:null,retryQueue:new Set([F])},Y.updateQueue=Z):(Y=Z.retryQueue,Y===null?Z.retryQueue=new Set([F]):Y.add(F)),ii(B,F,U)),!1}throw Error(u(435,Y.tag))}return ii(B,F,U),Nl(),!1}if(bi)return Z=gs.current,Z!==null?((Z.flags&65536)===0&&(Z.flags|=256),Z.flags|=65536,Z.lanes=U,F!==Cl&&(B=Error(u(422),{cause:F}),to(cs(B,Y)))):(F!==Cl&&(Z=Error(u(423),{cause:F}),to(cs(Z,Y))),B=B.current.alternate,B.flags|=65536,U&=-U,B.lanes|=U,F=cs(F,Y),U=fg(B.stateNode,F,U),Ma(B,U),Di!==4&&(Di=2)),!1;var ne=Error(u(520),{cause:F});if(ne=cs(ne,Y),Ml===null?Ml=[ne]:Ml.push(ne),Di!==4&&(Di=2),Z===null)return!0;F=cs(F,Y),Y=Z;do{switch(Y.tag){case 3:return Y.flags|=65536,B=U&-U,Y.lanes|=B,B=fg(Y.stateNode,F,B),Ma(Y,B),!1;case 1:if(Z=Y.type,ne=Y.stateNode,(Y.flags&128)===0&&(typeof Z.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(fn===null||!fn.has(ne))))return Y.flags|=65536,U&=-U,Y.lanes|=U,U=pg(U),Ou(U,B,Y,F),Ma(Y,U),!1}Y=Y.return}while(Y!==null);return!1}var As=Error(u(461)),yn=!1;function Gn(B,Z,Y,F){Z.child=B===null?Zo(Z,null,Y,F):Ro(Z,B.child,Y,F)}function Ag(B,Z,Y,F,U){Y=Y.render;var ne=Z.ref;if("ref"in F){var ce={};for(var pe in F)pe!=="ref"&&(ce[pe]=F[pe])}else ce=F;return jr(Z),F=sg(B,Z,Y,ce,ne,U),pe=og(),B!==null&&!yn?(yl(B,Z,U),sn(B,Z,U)):(bi&&pe&&dl(Z),Z.flags|=1,Gn(B,Z,F,U),Z.child)}function mg(B,Z,Y,F,U){if(B===null){var ne=Y.type;return typeof ne=="function"&&!Fo(ne)&&ne.defaultProps===void 0&&Y.compare===null?(Z.tag=15,Z.type=ne,bg(B,Z,ne,F,U)):(B=Ea(Y.type,null,F,Z,Z.mode,U),B.ref=Z.ref,B.return=Z,Z.child=B)}if(ne=B.child,!xg(B,U)){var ce=ne.memoizedProps;if(Y=Y.compare,Y=Y!==null?Y:Ls,Y(ce,F)&&B.ref===Z.ref)return sn(B,Z,U)}return Z.flags|=1,B=qn(ne,F),B.ref=Z.ref,B.return=Z,Z.child=B}function bg(B,Z,Y,F,U){if(B!==null){var ne=B.memoizedProps;if(Ls(ne,F)&&B.ref===Z.ref)if(yn=!1,Z.pendingProps=F=ne,xg(B,U))(B.flags&131072)!==0&&(yn=!0);else return Z.lanes=B.lanes,sn(B,Z,U)}return Gg(B,Z,Y,F,U)}function Uu(B,Z,Y){var F=Z.pendingProps,U=F.children,ne=(Z.stateNode._pendingVisibility&2)!==0,ce=B!==null?B.memoizedState:null;if(Ra(B,Z),F.mode==="hidden"||ne){if((Z.flags&128)!==0){if(F=ce!==null?ce.baseLanes|Y:Y,B!==null){for(U=Z.child=B.child,ne=0;U!==null;)ne=ne|U.lanes|U.childLanes,U=U.sibling;Z.childLanes=ne&~F}else Z.childLanes=0,Z.child=null;return yg(B,Z,F,Y)}if((Y&536870912)!==0)Z.memoizedState={baseLanes:0,cachePool:null},B!==null&&va(Z,ce!==null?ce.cachePool:null),ce!==null?cr(Z,ce):nc(),tg(Z);else return Z.lanes=Z.childLanes=536870912,yg(B,Z,ce!==null?ce.baseLanes|Y:Y,Y)}else ce!==null?(va(Z,ce.cachePool),cr(Z,ce),_o(),Z.memoizedState=null):(B!==null&&va(Z,null),nc(),_o());return Gn(B,Z,U,Y),Z.child}function yg(B,Z,Y,F){var U=bl();return U=U===null?null:{parent:tn._currentValue,pool:U},Z.memoizedState={baseLanes:Y,cachePool:U},B!==null&&va(Z,null),nc(),tg(Z),B!==null&&Sl(B,Z,F,!0),null}function Ra(B,Z){var Y=Z.ref;if(Y===null)B!==null&&B.ref!==null&&(Z.flags|=2097664);else{if(typeof Y!="function"&&typeof Y!="object")throw Error(u(284));(B===null||B.ref!==Y)&&(Z.flags|=2097664)}}function Gg(B,Z,Y,F,U){return jr(Z),Y=sg(B,Z,Y,F,void 0,U),F=og(),B!==null&&!yn?(yl(B,Z,U),sn(B,Z,U)):(bi&&F&&dl(Z),Z.flags|=1,Gn(B,Z,Y,U),Z.child)}function $u(B,Z,Y,F,U,ne){return jr(Z),Z.updateQueue=null,Y=Cu(Z,F,Y,U),du(B),F=og(),B!==null&&!yn?(yl(B,Z,ne),sn(B,Z,ne)):(bi&&F&&dl(Z),Z.flags|=1,Gn(B,Z,Y,ne),Z.child)}function ju(B,Z,Y,F,U){if(jr(Z),Z.stateNode===null){var ne=nr,ce=Y.contextType;typeof ce=="object"&&ce!==null&&(ne=Jn(ce)),ne=new Y(F,ne),Z.memoizedState=ne.state!==null&&ne.state!==void 0?ne.state:null,ne.updater=Ig,Z.stateNode=ne,ne._reactInternals=Z,ne=Z.stateNode,ne.props=F,ne.state=Z.memoizedState,ne.refs={},jn(Z),ce=Y.contextType,ne.context=typeof ce=="object"&&ce!==null?Jn(ce):nr,ne.state=Z.memoizedState,ce=Y.getDerivedStateFromProps,typeof ce=="function"&&(Cg(Z,Y,ce,F),ne.state=Z.memoizedState),typeof Y.getDerivedStateFromProps=="function"||typeof ne.getSnapshotBeforeUpdate=="function"||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(ce=ne.state,typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount(),ce!==ne.state&&Ig.enqueueReplaceState(ne,ne.state,null),Ds(Z,F,ne,U),Hn(),ne.state=Z.memoizedState),typeof ne.componentDidMount=="function"&&(Z.flags|=4194308),F=!0}else if(B===null){ne=Z.stateNode;var pe=Z.memoizedProps,we=Ur(Y,pe);ne.props=we;var He=ne.context,ht=Y.contextType;ce=nr,typeof ht=="object"&&ht!==null&&(ce=Jn(ht));var bt=Y.getDerivedStateFromProps;ht=typeof bt=="function"||typeof ne.getSnapshotBeforeUpdate=="function",pe=Z.pendingProps!==pe,ht||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(pe||He!==ce)&&Fu(Z,ne,F,ce),Cn=!1;var tt=Z.memoizedState;ne.state=tt,Ds(Z,F,ne,U),Hn(),He=Z.memoizedState,pe||tt!==He||Cn?(typeof bt=="function"&&(Cg(Z,Y,bt,F),He=Z.memoizedState),(we=Cn||Lu(Z,Y,we,F,tt,He,ce))?(ht||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount()),typeof ne.componentDidMount=="function"&&(Z.flags|=4194308)):(typeof ne.componentDidMount=="function"&&(Z.flags|=4194308),Z.memoizedProps=F,Z.memoizedState=He),ne.props=F,ne.state=He,ne.context=ce,F=we):(typeof ne.componentDidMount=="function"&&(Z.flags|=4194308),F=!1)}else{ne=Z.stateNode,bc(B,Z),ce=Z.memoizedProps,ht=Ur(Y,ce),ne.props=ht,bt=Z.pendingProps,tt=ne.context,He=Y.contextType,we=nr,typeof He=="object"&&He!==null&&(we=Jn(He)),pe=Y.getDerivedStateFromProps,(He=typeof pe=="function"||typeof ne.getSnapshotBeforeUpdate=="function")||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(ce!==bt||tt!==we)&&Fu(Z,ne,F,we),Cn=!1,tt=Z.memoizedState,ne.state=tt,Ds(Z,F,ne,U),Hn();var ct=Z.memoizedState;ce!==bt||tt!==ct||Cn||B!==null&&B.dependencies!==null&&wa(B.dependencies)?(typeof pe=="function"&&(Cg(Z,Y,pe,F),ct=Z.memoizedState),(ht=Cn||Lu(Z,Y,ht,F,tt,ct,we)||B!==null&&B.dependencies!==null&&wa(B.dependencies))?(He||typeof ne.UNSAFE_componentWillUpdate!="function"&&typeof ne.componentWillUpdate!="function"||(typeof ne.componentWillUpdate=="function"&&ne.componentWillUpdate(F,ct,we),typeof ne.UNSAFE_componentWillUpdate=="function"&&ne.UNSAFE_componentWillUpdate(F,ct,we)),typeof ne.componentDidUpdate=="function"&&(Z.flags|=4),typeof ne.getSnapshotBeforeUpdate=="function"&&(Z.flags|=1024)):(typeof ne.componentDidUpdate!="function"||ce===B.memoizedProps&&tt===B.memoizedState||(Z.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||ce===B.memoizedProps&&tt===B.memoizedState||(Z.flags|=1024),Z.memoizedProps=F,Z.memoizedState=ct),ne.props=F,ne.state=ct,ne.context=we,F=ht):(typeof ne.componentDidUpdate!="function"||ce===B.memoizedProps&&tt===B.memoizedState||(Z.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||ce===B.memoizedProps&&tt===B.memoizedState||(Z.flags|=1024),F=!1)}return ne=F,Ra(B,Z),F=(Z.flags&128)!==0,ne||F?(ne=Z.stateNode,Y=F&&typeof Y.getDerivedStateFromError!="function"?null:ne.render(),Z.flags|=1,B!==null&&F?(Z.child=Ro(Z,B.child,null,U),Z.child=Ro(Z,null,Y,U)):Gn(B,Z,Y,U),Z.memoizedState=ne.state,B=Z.child):B=sn(B,Z,U),B}function vg(B,Z,Y,F){return ba(),Z.flags|=256,Gn(B,Z,Y,F),Z.child}var Bg={dehydrated:null,treeContext:null,retryLane:0};function xn(B){return{baseLanes:B,cachePool:No()}}function Ic(B,Z,Y){return B=B!==null?B.childLanes&~Y:0,Z&&(B|=es),B}function Qu(B,Z,Y){var F=Z.pendingProps,U=!1,ne=(Z.flags&128)!==0,ce;if((ce=ne)||(ce=B!==null&&B.memoizedState===null?!1:(hn.current&2)!==0),ce&&(U=!0,Z.flags&=-129),ce=(Z.flags&32)!==0,Z.flags&=-33,B===null){if(bi){if(U?wo(Z):_o(),bi){var pe=Xn,we;if(we=pe){e:{for(we=pe,pe=xs;we.nodeType!==8;){if(!pe){pe=null;break e}if(we=Oo(we.nextSibling),we===null){pe=null;break e}}pe=we}pe!==null?(Z.memoizedState={dehydrated:pe,treeContext:Xo!==null?{id:eo,overflow:xo}:null,retryLane:536870912},we=ln(18,null,null,0),we.stateNode=pe,we.return=Z,Z.child=we,Tn=Z,Xn=null,we=!0):we=!1}we||zr(Z)}if(pe=Z.memoizedState,pe!==null&&(pe=pe.dehydrated,pe!==null))return pe.data==="$!"?Z.lanes=16:Z.lanes=536870912,null;no(Z)}return pe=F.children,F=F.fallback,U?(_o(),U=Z.mode,pe=Xg({mode:"hidden",children:pe},U),F=xr(F,U,Y,null),pe.return=Z,F.return=Z,pe.sibling=F,Z.child=pe,U=Z.child,U.memoizedState=xn(Y),U.childLanes=Ic(B,ce,Y),Z.memoizedState=Bg,F):(wo(Z),Sg(Z,pe))}if(we=B.memoizedState,we!==null&&(pe=we.dehydrated,pe!==null)){if(ne)Z.flags&256?(wo(Z),Z.flags&=-257,Z=fc(B,Z,Y)):Z.memoizedState!==null?(_o(),Z.child=B.child,Z.flags|=128,Z=null):(_o(),U=F.fallback,pe=Z.mode,F=Xg({mode:"visible",children:F.children},pe),U=xr(U,pe,Y,null),U.flags|=2,F.return=Z,U.return=Z,F.sibling=U,Z.child=F,Ro(Z,B.child,null,Y),F=Z.child,F.memoizedState=xn(Y),F.childLanes=Ic(B,ce,Y),Z.memoizedState=Bg,Z=U);else if(wo(Z),pe.data==="$!"){if(ce=pe.nextSibling&&pe.nextSibling.dataset,ce)var He=ce.dgst;ce=He,F=Error(u(419)),F.stack="",F.digest=ce,to({value:F,source:null,stack:null}),Z=fc(B,Z,Y)}else if(yn||Sl(B,Z,Y,!1),ce=(Y&B.childLanes)!==0,yn||ce){if(ce=Ni,ce!==null){if(F=Y&-Y,(F&42)!==0)F=1;else switch(F){case 2:F=1;break;case 8:F=4;break;case 32:F=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:F=64;break;case 268435456:F=134217728;break;default:F=0}if(F=(F&(ce.suspendedLanes|Y))!==0?0:F,F!==0&&F!==we.retryLane)throw we.retryLane=F,So(B,F),pn(ce,B,F),As}pe.data==="$?"||Nl(),Z=fc(B,Z,Y)}else pe.data==="$?"?(Z.flags|=128,Z.child=B.child,Z=sa.bind(null,B),pe._reactRetry=Z,Z=null):(B=we.treeContext,Xn=Oo(pe.nextSibling),Tn=Z,bi=!0,Xs=null,xs=!1,B!==null&&(zi[fs++]=eo,zi[fs++]=xo,zi[fs++]=Xo,eo=B.id,xo=B.overflow,Xo=Z),Z=Sg(Z,F.children),Z.flags|=4096);return Z}return U?(_o(),U=F.fallback,pe=Z.mode,we=B.child,He=we.sibling,F=qn(we,{mode:"hidden",children:F.children}),F.subtreeFlags=we.subtreeFlags&31457280,He!==null?U=qn(He,U):(U=xr(U,pe,Y,null),U.flags|=2),U.return=Z,F.return=Z,F.sibling=U,Z.child=F,F=U,U=Z.child,pe=B.child.memoizedState,pe===null?pe=xn(Y):(we=pe.cachePool,we!==null?(He=tn._currentValue,we=we.parent!==He?{parent:He,pool:He}:we):we=No(),pe={baseLanes:pe.baseLanes|Y,cachePool:we}),U.memoizedState=pe,U.childLanes=Ic(B,ce,Y),Z.memoizedState=Bg,F):(wo(Z),Y=B.child,B=Y.sibling,Y=qn(Y,{mode:"visible",children:F.children}),Y.return=Z,Y.sibling=null,B!==null&&(ce=Z.deletions,ce===null?(Z.deletions=[B],Z.flags|=16):ce.push(B)),Z.child=Y,Z.memoizedState=null,Y)}function Sg(B,Z){return Z=Xg({mode:"visible",children:Z},B.mode),Z.return=B,B.child=Z}function Xg(B,Z){return Zg(B,Z,0,null)}function fc(B,Z,Y){return Ro(Z,B.child,null,Y),B=Sg(Z,Z.pendingProps.children),B.flags|=2,Z.memoizedState=null,B}function pc(B,Z,Y){B.lanes|=Z;var F=B.alternate;F!==null&&(F.lanes|=Z),ms(B.return,Z,Y)}function mr(B,Z,Y,F,U){var ne=B.memoizedState;ne===null?B.memoizedState={isBackwards:Z,rendering:null,renderingStartTime:0,last:F,tail:Y,tailMode:U}:(ne.isBackwards=Z,ne.rendering=null,ne.renderingStartTime=0,ne.last=F,ne.tail=Y,ne.tailMode=U)}function $r(B,Z,Y){var F=Z.pendingProps,U=F.revealOrder,ne=F.tail;if(Gn(B,Z,F.children,Y),F=hn.current,(F&2)!==0)F=F&1|2,Z.flags|=128;else{if(B!==null&&(B.flags&128)!==0)e:for(B=Z.child;B!==null;){if(B.tag===13)B.memoizedState!==null&&pc(B,Y,Z);else if(B.tag===19)pc(B,Y,Z);else if(B.child!==null){B.child.return=B,B=B.child;continue}if(B===Z)break e;for(;B.sibling===null;){if(B.return===null||B.return===Z)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}F&=1}switch(st(hn,F),U){case"forwards":for(Y=Z.child,U=null;Y!==null;)B=Y.alternate,B!==null&&Ga(B)===null&&(U=Y),Y=Y.sibling;Y=U,Y===null?(U=Z.child,Z.child=null):(U=Y.sibling,Y.sibling=null),mr(Z,!1,U,Y,ne);break;case"backwards":for(Y=null,U=Z.child,Z.child=null;U!==null;){if(B=U.alternate,B!==null&&Ga(B)===null){Z.child=U;break}B=U.sibling,U.sibling=Y,Y=U,U=B}mr(Z,!0,Y,null,ne);break;case"together":mr(Z,!1,null,null,void 0);break;default:Z.memoizedState=null}return Z.child}function sn(B,Z,Y){if(B!==null&&(Z.dependencies=B.dependencies),js|=Z.lanes,(Y&Z.childLanes)===0)if(B!==null){if(Sl(B,Z,Y,!1),(Y&Z.childLanes)===0)return null}else return null;if(B!==null&&Z.child!==B.child)throw Error(u(153));if(Z.child!==null){for(B=Z.child,Y=qn(B,B.pendingProps),Z.child=Y,Y.return=Z;B.sibling!==null;)B=B.sibling,Y=Y.sibling=qn(B,B.pendingProps),Y.return=Z;Y.sibling=null}return Z.child}function xg(B,Z){return(B.lanes&Z)!==0?!0:(B=B.dependencies,!!(B!==null&&wa(B)))}function Zh(B,Z,Y){switch(Z.tag){case 3:Gt(Z,Z.stateNode.containerInfo),br(Z,tn,B.memoizedState.cache),ba();break;case 27:case 5:vt(Z);break;case 4:Gt(Z,Z.stateNode.containerInfo);break;case 10:br(Z,Z.type,Z.memoizedProps.value);break;case 13:var F=Z.memoizedState;if(F!==null)return F.dehydrated!==null?(wo(Z),Z.flags|=128,null):(Y&Z.child.childLanes)!==0?Qu(B,Z,Y):(wo(Z),B=sn(B,Z,Y),B!==null?B.sibling:null);wo(Z);break;case 19:var U=(B.flags&128)!==0;if(F=(Y&Z.childLanes)!==0,F||(Sl(B,Z,Y,!1),F=(Y&Z.childLanes)!==0),U){if(F)return $r(B,Z,Y);Z.flags|=128}if(U=Z.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),st(hn,hn.current),F)break;return null;case 22:case 23:return Z.lanes=0,Uu(B,Z,Y);case 24:br(Z,tn,B.memoizedState.cache)}return sn(B,Z,Y)}function Bl(B,Z,Y){if(B!==null)if(B.memoizedProps!==Z.pendingProps)yn=!0;else{if(!xg(B,Y)&&(Z.flags&128)===0)return yn=!1,Zh(B,Z,Y);yn=(B.flags&131072)!==0}else yn=!1,bi&&(Z.flags&1048576)!==0&&qc(Z,hl,Z.index);switch(Z.lanes=0,Z.tag){case 16:e:{B=Z.pendingProps;var F=Z.elementType,U=F._init;if(F=U(F._payload),Z.type=F,typeof F=="function")Fo(F)?(B=Ur(F,B),Z.tag=1,Z=ju(null,Z,F,B,Y)):(Z.tag=0,Z=Gg(null,Z,F,B,Y));else{if(F!=null){if(U=F.$$typeof,U===V){Z.tag=11,Z=Ag(null,Z,F,B,Y);break e}else if(U===J){Z.tag=14,Z=mg(null,Z,F,B,Y);break e}}throw Z=ie(F)||F,Error(u(306,Z,""))}}return Z;case 0:return Gg(B,Z,Z.type,Z.pendingProps,Y);case 1:return F=Z.type,U=Ur(F,Z.pendingProps),ju(B,Z,F,U,Y);case 3:e:{if(Gt(Z,Z.stateNode.containerInfo),B===null)throw Error(u(387));var ne=Z.pendingProps;U=Z.memoizedState,F=U.element,bc(B,Z),Ds(Z,ne,null,Y);var ce=Z.memoizedState;if(ne=ce.cache,br(Z,tn,ne),ne!==U.cache&&Ac(Z,[tn],Y,!0),Hn(),ne=ce.element,U.isDehydrated)if(U={element:ne,isDehydrated:!1,cache:ce.cache},Z.updateQueue.baseState=U,Z.memoizedState=U,Z.flags&256){Z=vg(B,Z,ne,Y);break e}else if(ne!==F){F=cs(Error(u(424)),Z),to(F),Z=vg(B,Z,ne,Y);break e}else for(Xn=Oo(Z.stateNode.containerInfo.firstChild),Tn=Z,bi=!0,Xs=null,xs=!0,Y=Zo(Z,null,ne,Y),Z.child=Y;Y;)Y.flags=Y.flags&-3|4096,Y=Y.sibling;else{if(ba(),ne===F){Z=sn(B,Z,Y);break e}Gn(B,Z,ne,Y)}Z=Z.child}return Z;case 26:return Ra(B,Z),B===null?(Y=pd(Z.type,null,Z.pendingProps,null))?Z.memoizedState=Y:bi||(Y=Z.type,B=Z.pendingProps,F=oh(Ue.current).createElement(Y),F[Ji]=Z,F[Qt]=B,ns(F,Y,B),ke(F),Z.stateNode=F):Z.memoizedState=pd(Z.type,B.memoizedProps,Z.pendingProps,B.memoizedState),null;case 27:return vt(Z),B===null&&bi&&(F=Z.stateNode=Cd(Z.type,Z.pendingProps,Ue.current),Tn=Z,xs=!0,Xn=Oo(F.firstChild)),F=Z.pendingProps.children,B!==null||bi?Gn(B,Z,F,Y):Z.child=Ro(Z,null,F,Y),Ra(B,Z),Z.child;case 5:return B===null&&bi&&((U=F=Xn)&&(F=Dd(F,Z.type,Z.pendingProps,xs),F!==null?(Z.stateNode=F,Tn=Z,Xn=Oo(F.firstChild),xs=!1,U=!0):U=!1),U||zr(Z)),vt(Z),U=Z.type,ne=Z.pendingProps,ce=B!==null?B.memoizedProps:null,F=ne.children,Hh(U,ne)?F=null:ce!==null&&Hh(U,ce)&&(Z.flags|=32),Z.memoizedState!==null&&(U=sg(B,Z,Bh,null,null,Y),Tg._currentValue=U),Ra(B,Z),Gn(B,Z,F,Y),Z.child;case 6:return B===null&&bi&&((B=Y=Xn)&&(Y=kd(Y,Z.pendingProps,xs),Y!==null?(Z.stateNode=Y,Tn=Z,Xn=null,B=!0):B=!1),B||zr(Z)),null;case 13:return Qu(B,Z,Y);case 4:return Gt(Z,Z.stateNode.containerInfo),F=Z.pendingProps,B===null?Z.child=Ro(Z,null,F,Y):Gn(B,Z,F,Y),Z.child;case 11:return Ag(B,Z,Z.type,Z.pendingProps,Y);case 7:return Gn(B,Z,Z.pendingProps,Y),Z.child;case 8:return Gn(B,Z,Z.pendingProps.children,Y),Z.child;case 12:return Gn(B,Z,Z.pendingProps.children,Y),Z.child;case 10:return F=Z.pendingProps,br(Z,Z.type,F.value),Gn(B,Z,F.children,Y),Z.child;case 9:return U=Z.type._context,F=Z.pendingProps.children,jr(Z),U=Jn(U),F=F(U),Z.flags|=1,Gn(B,Z,F,Y),Z.child;case 14:return mg(B,Z,Z.type,Z.pendingProps,Y);case 15:return bg(B,Z,Z.type,Z.pendingProps,Y);case 19:return $r(B,Z,Y);case 22:return Uu(B,Z,Y);case 24:return jr(Z),F=Jn(tn),B===null?(U=bl(),U===null&&(U=Ni,ne=ig(),U.pooledCache=ne,ne.refCount++,ne!==null&&(U.pooledCacheLanes|=Y),U=ne),Z.memoizedState={parent:F,cache:U},jn(Z),br(Z,tn,U)):((B.lanes&Y)!==0&&(bc(B,Z),Ds(Z,null,null,Y),Hn()),U=B.memoizedState,ne=Z.memoizedState,U.parent!==F?(U={parent:F,cache:F},Z.memoizedState=U,Z.lanes===0&&(Z.memoizedState=Z.updateQueue.baseState=U),br(Z,tn,F)):(F=ne.cache,br(Z,tn,F),F!==U.cache&&Ac(Z,[tn],Y,!0))),Gn(B,Z,Z.pendingProps.children,Y),Z.child;case 29:throw Z.pendingProps}throw Error(u(156,Z.tag))}var Za=Ee(null),ao=null,Ps=null;function br(B,Z,Y){st(Za,Z._currentValue),Z._currentValue=Y}function Yo(B){B._currentValue=Za.current,Ct(Za)}function ms(B,Z,Y){for(;B!==null;){var F=B.alternate;if((B.childLanes&Z)!==Z?(B.childLanes|=Z,F!==null&&(F.childLanes|=Z)):F!==null&&(F.childLanes&Z)!==Z&&(F.childLanes|=Z),B===Y)break;B=B.return}}function Ac(B,Z,Y,F){var U=B.child;for(U!==null&&(U.return=B);U!==null;){var ne=U.dependencies;if(ne!==null){var ce=U.child;ne=ne.firstContext;e:for(;ne!==null;){var pe=ne;ne=U;for(var we=0;we<Z.length;we++)if(pe.context===Z[we]){ne.lanes|=Y,pe=ne.alternate,pe!==null&&(pe.lanes|=Y),ms(ne.return,Y,B),F||(ce=null);break e}ne=pe.next}}else if(U.tag===18){if(ce=U.return,ce===null)throw Error(u(341));ce.lanes|=Y,ne=ce.alternate,ne!==null&&(ne.lanes|=Y),ms(ce,Y,B),ce=null}else ce=U.child;if(ce!==null)ce.return=U;else for(ce=U;ce!==null;){if(ce===B){ce=null;break}if(U=ce.sibling,U!==null){U.return=ce.return,ce=U;break}ce=ce.return}U=ce}}function Sl(B,Z,Y,F){B=null;for(var U=Z,ne=!1;U!==null;){if(!ne){if((U.flags&524288)!==0)ne=!0;else if((U.flags&262144)!==0)break}if(U.tag===10){var ce=U.alternate;if(ce===null)throw Error(u(387));if(ce=ce.memoizedProps,ce!==null){var pe=U.type;rs(U.pendingProps.value,ce.value)||(B!==null?B.push(pe):B=[pe])}}else if(U===Ge.current){if(ce=U.alternate,ce===null)throw Error(u(387));ce.memoizedState.memoizedState!==U.memoizedState.memoizedState&&(B!==null?B.push(Tg):B=[Tg])}U=U.return}B!==null&&Ac(Z,B,Y,F),Z.flags|=262144}function wa(B){for(B=B.firstContext;B!==null;){if(!rs(B.context._currentValue,B.memoizedValue))return!0;B=B.next}return!1}function jr(B){ao=B,Ps=null,B=B.dependencies,B!==null&&(B.firstContext=null)}function Jn(B){return _a(ao,B)}function mc(B,Z){return ao===null&&jr(B),_a(B,Z)}function _a(B,Z){var Y=Z._currentValue;if(Z={context:Z,memoizedValue:Y,next:null},Ps===null){if(B===null)throw Error(u(308));Ps=Z,B.dependencies={lanes:0,firstContext:Z},B.flags|=524288}else Ps=Ps.next=Z;return Y}var Cn=!1;function jn(B){B.updateQueue={baseState:B.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bc(B,Z){B=B.updateQueue,Z.updateQueue===B&&(Z.updateQueue={baseState:B.baseState,firstBaseUpdate:B.firstBaseUpdate,lastBaseUpdate:B.lastBaseUpdate,shared:B.shared,callbacks:null})}function bs(B){return{lane:B,tag:0,payload:null,callback:null,next:null}}function ys(B,Z,Y){var F=B.updateQueue;if(F===null)return null;if(F=F.shared,(ti&2)!==0){var U=F.pending;return U===null?Z.next=Z:(Z.next=U.next,U.next=Z),F.pending=Z,Z=ul(B),gl(B,null,Y),Z}return cl(B,F,Z,Y),ul(B)}function yr(B,Z,Y){if(Z=Z.updateQueue,Z!==null&&(Z=Z.shared,(Y&4194176)!==0)){var F=Z.lanes;F&=B.pendingLanes,Y|=F,Z.lanes=Y,mn(B,Y)}}function Ma(B,Z){var Y=B.updateQueue,F=B.alternate;if(F!==null&&(F=F.updateQueue,Y===F)){var U=null,ne=null;if(Y=Y.firstBaseUpdate,Y!==null){do{var ce={lane:Y.lane,tag:Y.tag,payload:Y.payload,callback:null,next:null};ne===null?U=ne=ce:ne=ne.next=ce,Y=Y.next}while(Y!==null);ne===null?U=ne=Z:ne=ne.next=Z}else U=ne=Z;Y={baseState:F.baseState,firstBaseUpdate:U,lastBaseUpdate:ne,shared:F.shared,callbacks:F.callbacks},B.updateQueue=Y;return}B=Y.lastBaseUpdate,B===null?Y.firstBaseUpdate=Z:B.next=Z,Y.lastBaseUpdate=Z}var hs=!1;function Hn(){if(hs){var B=hr;if(B!==null)throw B}}function Ds(B,Z,Y,F){hs=!1;var U=B.updateQueue;Cn=!1;var ne=U.firstBaseUpdate,ce=U.lastBaseUpdate,pe=U.shared.pending;if(pe!==null){U.shared.pending=null;var we=pe,He=we.next;we.next=null,ce===null?ne=He:ce.next=He,ce=we;var ht=B.alternate;ht!==null&&(ht=ht.updateQueue,pe=ht.lastBaseUpdate,pe!==ce&&(pe===null?ht.firstBaseUpdate=He:pe.next=He,ht.lastBaseUpdate=we))}if(ne!==null){var bt=U.baseState;ce=0,ht=He=we=null,pe=ne;do{var tt=pe.lane&-536870913,ct=tt!==pe.lane;if(ct?(Dt&tt)===tt:(F&tt)===tt){tt!==0&&tt===Kr&&(hs=!0),ht!==null&&(ht=ht.next={lane:0,tag:pe.tag,payload:pe.payload,callback:null,next:null});e:{var Lt=B,si=pe;tt=Z;var An=Y;switch(si.tag){case 1:if(Lt=si.payload,typeof Lt=="function"){bt=Lt.call(An,bt,tt);break e}bt=Lt;break e;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=si.payload,tt=typeof Lt=="function"?Lt.call(An,bt,tt):Lt,tt==null)break e;bt=se({},bt,tt);break e;case 2:Cn=!0}}tt=pe.callback,tt!==null&&(B.flags|=64,ct&&(B.flags|=8192),ct=U.callbacks,ct===null?U.callbacks=[tt]:ct.push(tt))}else ct={lane:tt,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null},ht===null?(He=ht=ct,we=bt):ht=ht.next=ct,ce|=tt;if(pe=pe.next,pe===null){if(pe=U.shared.pending,pe===null)break;ct=pe,pe=ct.next,ct.next=null,U.lastBaseUpdate=ct,U.shared.pending=null}}while(!0);ht===null&&(we=bt),U.baseState=we,U.firstBaseUpdate=He,U.lastBaseUpdate=ht,ne===null&&(U.shared.lanes=0),js|=ce,B.lanes=ce,B.memoizedState=bt}}function lo(B,Z){if(typeof B!="function")throw Error(u(191,B));B.call(Z)}function co(B,Z){var Y=B.callbacks;if(Y!==null)for(B.callbacks=null,B=0;B<Y.length;B++)lo(Y[B],Z)}function on(B,Z){try{var Y=Z.updateQueue,F=Y!==null?Y.lastEffect:null;if(F!==null){var U=F.next;Y=U;do{if((Y.tag&B)===B){F=void 0;var ne=Y.create,ce=Y.inst;F=ne(),ce.destroy=F}Y=Y.next}while(Y!==U)}}catch(pe){Xt(Z,Z.return,pe)}}function Rs(B,Z,Y){try{var F=Z.updateQueue,U=F!==null?F.lastEffect:null;if(U!==null){var ne=U.next;F=ne;do{if((F.tag&B)===B){var ce=F.inst,pe=ce.destroy;if(pe!==void 0){ce.destroy=void 0,U=Z;var we=Y;try{pe()}catch(He){Xt(U,we,He)}}}F=F.next}while(F!==ne)}}catch(He){Xt(Z,Z.return,He)}}function To(B){var Z=B.updateQueue;if(Z!==null){var Y=B.stateNode;try{co(Z,Y)}catch(F){Xt(B,B.return,F)}}}function Xl(B,Z,Y){Y.props=Ur(B.type,B.memoizedProps),Y.state=B.memoizedState;try{Y.componentWillUnmount()}catch(F){Xt(B,Z,F)}}function rn(B,Z){try{var Y=B.ref;if(Y!==null){var F=B.stateNode;switch(B.tag){case 26:case 27:case 5:var U=F;break;default:U=F}typeof Y=="function"?B.refCleanup=Y(U):Y.current=U}}catch(ne){Xt(B,Z,ne)}}function Mi(B,Z){var Y=B.ref,F=B.refCleanup;if(Y!==null)if(typeof F=="function")try{F()}catch(U){Xt(B,Z,U)}finally{B.refCleanup=null,B=B.alternate,B!=null&&(B.refCleanup=null)}else if(typeof Y=="function")try{Y(null)}catch(U){Xt(B,Z,U)}else Y.current=null}function yi(B){var Z=B.type,Y=B.memoizedProps,F=B.stateNode;try{e:switch(Z){case"button":case"input":case"select":case"textarea":Y.autoFocus&&F.focus();break e;case"img":Y.src?F.src=Y.src:Y.srcSet&&(F.srcset=Y.srcSet)}}catch(U){Xt(B,B.return,U)}}function Zs(B,Z,Y){try{var F=B.stateNode;zd(F,B.type,Y,Z),F[Qt]=Z}catch(U){Xt(B,B.return,U)}}function ks(B){return B.tag===5||B.tag===3||B.tag===26||B.tag===27||B.tag===4}function xl(B){e:for(;;){for(;B.sibling===null;){if(B.return===null||ks(B.return))return null;B=B.return}for(B.sibling.return=B.return,B=B.sibling;B.tag!==5&&B.tag!==6&&B.tag!==27&&B.tag!==18;){if(B.flags&2||B.child===null||B.tag===4)continue e;B.child.return=B,B=B.child}if(!(B.flags&2))return B.stateNode}}function ds(B,Z,Y){var F=B.tag;if(F===5||F===6)B=B.stateNode,Z?Y.nodeType===8?Y.parentNode.insertBefore(B,Z):Y.insertBefore(B,Z):(Y.nodeType===8?(Z=Y.parentNode,Z.insertBefore(B,Y)):(Z=Y,Z.appendChild(B)),Y=Y._reactRootContainer,Y!=null||Z.onclick!==null||(Z.onclick=sh));else if(F!==4&&F!==27&&(B=B.child,B!==null))for(ds(B,Z,Y),B=B.sibling;B!==null;)ds(B,Z,Y),B=B.sibling}function Jo(B,Z,Y){var F=B.tag;if(F===5||F===6)B=B.stateNode,Z?Y.insertBefore(B,Z):Y.appendChild(B);else if(F!==4&&F!==27&&(B=B.child,B!==null))for(Jo(B,Z,Y),B=B.sibling;B!==null;)Jo(B,Z,Y),B=B.sibling}var Os=!1,Ki=!1,Gr=!1,yc=typeof WeakSet=="function"?WeakSet:Set,an=null,Gc=!1;function Na(B,Z){if(B=B.containerInfo,Th=uh,B=Dc(B),al(B)){if("selectionStart"in B)var Y={start:B.selectionStart,end:B.selectionEnd};else e:{Y=(Y=B.ownerDocument)&&Y.defaultView||window;var F=Y.getSelection&&Y.getSelection();if(F&&F.rangeCount!==0){Y=F.anchorNode;var U=F.anchorOffset,ne=F.focusNode;F=F.focusOffset;try{Y.nodeType,ne.nodeType}catch{Y=null;break e}var ce=0,pe=-1,we=-1,He=0,ht=0,bt=B,tt=null;t:for(;;){for(var ct;bt!==Y||U!==0&&bt.nodeType!==3||(pe=ce+U),bt!==ne||F!==0&&bt.nodeType!==3||(we=ce+F),bt.nodeType===3&&(ce+=bt.nodeValue.length),(ct=bt.firstChild)!==null;)tt=bt,bt=ct;for(;;){if(bt===B)break t;if(tt===Y&&++He===U&&(pe=ce),tt===ne&&++ht===F&&(we=ce),(ct=bt.nextSibling)!==null)break;bt=tt,tt=bt.parentNode}bt=ct}Y=pe===-1||we===-1?null:{start:pe,end:we}}else Y=null}Y=Y||{start:0,end:0}}else Y=null;for(Jh={focusedElem:B,selectionRange:Y},uh=!1,an=Z;an!==null;)if(Z=an,B=Z.child,(Z.subtreeFlags&1028)!==0&&B!==null)B.return=Z,an=B;else for(;an!==null;){switch(Z=an,ne=Z.alternate,B=Z.flags,Z.tag){case 0:break;case 11:case 15:break;case 1:if((B&1024)!==0&&ne!==null){B=void 0,Y=Z,U=ne.memoizedProps,ne=ne.memoizedState,F=Y.stateNode;try{var Lt=Ur(Y.type,U,Y.elementType===Y.type);B=F.getSnapshotBeforeUpdate(Lt,ne),F.__reactInternalSnapshotBeforeUpdate=B}catch(si){Xt(Y,Y.return,si)}}break;case 3:if((B&1024)!==0){if(B=Z.stateNode.containerInfo,Y=B.nodeType,Y===9)Fh(B);else if(Y===1)switch(B.nodeName){case"HEAD":case"HTML":case"BODY":Fh(B);break;default:B.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((B&1024)!==0)throw Error(u(163))}if(B=Z.sibling,B!==null){B.return=Z.return,an=B;break}an=Z.return}return Lt=Gc,Gc=!1,Lt}function Va(B,Z,Y){var F=Y.flags;switch(Y.tag){case 0:case 11:case 15:go(B,Y),F&4&&on(5,Y);break;case 1:if(go(B,Y),F&4)if(B=Y.stateNode,Z===null)try{B.componentDidMount()}catch(pe){Xt(Y,Y.return,pe)}else{var U=Ur(Y.type,Z.memoizedProps);Z=Z.memoizedState;try{B.componentDidUpdate(U,Z,B.__reactInternalSnapshotBeforeUpdate)}catch(pe){Xt(Y,Y.return,pe)}}F&64&&To(Y),F&512&&rn(Y,Y.return);break;case 3:if(go(B,Y),F&64&&(F=Y.updateQueue,F!==null)){if(B=null,Y.child!==null)switch(Y.child.tag){case 27:case 5:B=Y.child.stateNode;break;case 1:B=Y.child.stateNode}try{co(F,B)}catch(pe){Xt(Y,Y.return,pe)}}break;case 26:go(B,Y),F&512&&rn(Y,Y.return);break;case 27:case 5:go(B,Y),Z===null&&F&4&&yi(Y),F&512&&rn(Y,Y.return);break;case 12:go(B,Y);break;case 13:go(B,Y),F&4&&qu(B,Y);break;case 22:if(U=Y.memoizedState!==null||Os,!U){Z=Z!==null&&Z.memoizedState!==null||Ki;var ne=Os,ce=Ki;Os=U,(Ki=Z)&&!ce?$s(B,Y,(Y.subtreeFlags&8772)!==0):go(B,Y),Os=ne,Ki=ce}F&512&&(Y.memoizedProps.mode==="manual"?rn(Y,Y.return):Mi(Y,Y.return));break;default:go(B,Y)}}function vc(B){var Z=B.alternate;Z!==null&&(B.alternate=null,vc(Z)),B.child=null,B.deletions=null,B.sibling=null,B.tag===5&&(Z=B.stateNode,Z!==null&&Mr(Z)),B.stateNode=null,B.return=null,B.dependencies=null,B.memoizedProps=null,B.memoizedState=null,B.pendingProps=null,B.stateNode=null,B.updateQueue=null}var Pi=null,Rn=!1;function zn(B,Z,Y){for(Y=Y.child;Y!==null;)Bc(B,Z,Y),Y=Y.sibling}function Bc(B,Z,Y){if(mt&&typeof mt.onCommitFiberUnmount=="function")try{mt.onCommitFiberUnmount(pt,Y)}catch{}switch(Y.tag){case 26:Ki||Mi(Y,Z),zn(B,Z,Y),Y.memoizedState?Y.memoizedState.count--:Y.stateNode&&(Y=Y.stateNode,Y.parentNode.removeChild(Y));break;case 27:Ki||Mi(Y,Z);var F=Pi,U=Rn;for(Pi=Y.stateNode,zn(B,Z,Y),Y=Y.stateNode,Z=Y.attributes;Z.length;)Y.removeAttributeNode(Z[0]);Mr(Y),Pi=F,Rn=U;break;case 5:Ki||Mi(Y,Z);case 6:U=Pi;var ne=Rn;if(Pi=null,zn(B,Z,Y),Pi=U,Rn=ne,Pi!==null)if(Rn)try{B=Pi,F=Y.stateNode,B.nodeType===8?B.parentNode.removeChild(F):B.removeChild(F)}catch(ce){Xt(Y,Z,ce)}else try{Pi.removeChild(Y.stateNode)}catch(ce){Xt(Y,Z,ce)}break;case 18:Pi!==null&&(Rn?(Z=Pi,Y=Y.stateNode,Z.nodeType===8?Lh(Z.parentNode,Y):Z.nodeType===1&&Lh(Z,Y),Lg(Z)):Lh(Pi,Y.stateNode));break;case 4:F=Pi,U=Rn,Pi=Y.stateNode.containerInfo,Rn=!0,zn(B,Z,Y),Pi=F,Rn=U;break;case 0:case 11:case 14:case 15:Ki||Rs(2,Y,Z),Ki||Rs(4,Y,Z),zn(B,Z,Y);break;case 1:Ki||(Mi(Y,Z),F=Y.stateNode,typeof F.componentWillUnmount=="function"&&Xl(Y,Z,F)),zn(B,Z,Y);break;case 21:zn(B,Z,Y);break;case 22:Ki||Mi(Y,Z),Ki=(F=Ki)||Y.memoizedState!==null,zn(B,Z,Y),Ki=F;break;default:zn(B,Z,Y)}}function qu(B,Z){if(Z.memoizedState===null&&(B=Z.alternate,B!==null&&(B=B.memoizedState,B!==null&&(B=B.dehydrated,B!==null))))try{Lg(B)}catch(Y){Xt(Z,Z.return,Y)}}function Rl(B){switch(B.tag){case 13:case 19:var Z=B.stateNode;return Z===null&&(Z=B.stateNode=new yc),Z;case 22:return B=B.stateNode,Z=B._retryCache,Z===null&&(Z=B._retryCache=new yc),Z;default:throw Error(u(435,B.tag))}}function Zl(B,Z){var Y=Rl(B);Z.forEach(function(F){var U=qe.bind(null,B,F);Y.has(F)||(Y.add(F),F.then(U,U))})}function Qn(B,Z){var Y=Z.deletions;if(Y!==null)for(var F=0;F<Y.length;F++){var U=Y[F],ne=B,ce=Z,pe=ce;e:for(;pe!==null;){switch(pe.tag){case 27:case 5:Pi=pe.stateNode,Rn=!1;break e;case 3:Pi=pe.stateNode.containerInfo,Rn=!0;break e;case 4:Pi=pe.stateNode.containerInfo,Rn=!0;break e}pe=pe.return}if(Pi===null)throw Error(u(160));Bc(ne,ce,U),Pi=null,Rn=!1,ne=U.alternate,ne!==null&&(ne.return=null),U.return=null}if(Z.subtreeFlags&13878)for(Z=Z.child;Z!==null;)Qr(Z,B),Z=Z.sibling}var Ln=null;function Qr(B,Z){var Y=B.alternate,F=B.flags;switch(B.tag){case 0:case 11:case 14:case 15:Qn(Z,B),Fn(B),F&4&&(Rs(3,B,B.return),on(3,B),Rs(5,B,B.return));break;case 1:Qn(Z,B),Fn(B),F&512&&(Ki||Y===null||Mi(Y,Y.return)),F&64&&Os&&(B=B.updateQueue,B!==null&&(F=B.callbacks,F!==null&&(Y=B.shared.hiddenCallbacks,B.shared.hiddenCallbacks=Y===null?F:Y.concat(F))));break;case 26:var U=Ln;if(Qn(Z,B),Fn(B),F&512&&(Ki||Y===null||Mi(Y,Y.return)),F&4){var ne=Y!==null?Y.memoizedState:null;if(F=B.memoizedState,Y===null)if(F===null)if(B.stateNode===null){e:{F=B.type,Y=B.memoizedProps,U=U.ownerDocument||U;t:switch(F){case"title":ne=U.getElementsByTagName("title")[0],(!ne||ne[fo]||ne[Ji]||ne.namespaceURI==="http://www.w3.org/2000/svg"||ne.hasAttribute("itemprop"))&&(ne=U.createElement(F),U.head.insertBefore(ne,U.querySelector("head > title"))),ns(ne,F,Y),ne[Ji]=B,ke(ne),F=ne;break e;case"link":var ce=bd("link","href",U).get(F+(Y.href||""));if(ce){for(var pe=0;pe<ce.length;pe++)if(ne=ce[pe],ne.getAttribute("href")===(Y.href==null?null:Y.href)&&ne.getAttribute("rel")===(Y.rel==null?null:Y.rel)&&ne.getAttribute("title")===(Y.title==null?null:Y.title)&&ne.getAttribute("crossorigin")===(Y.crossOrigin==null?null:Y.crossOrigin)){ce.splice(pe,1);break t}}ne=U.createElement(F),ns(ne,F,Y),U.head.appendChild(ne);break;case"meta":if(ce=bd("meta","content",U).get(F+(Y.content||""))){for(pe=0;pe<ce.length;pe++)if(ne=ce[pe],ne.getAttribute("content")===(Y.content==null?null:""+Y.content)&&ne.getAttribute("name")===(Y.name==null?null:Y.name)&&ne.getAttribute("property")===(Y.property==null?null:Y.property)&&ne.getAttribute("http-equiv")===(Y.httpEquiv==null?null:Y.httpEquiv)&&ne.getAttribute("charset")===(Y.charSet==null?null:Y.charSet)){ce.splice(pe,1);break t}}ne=U.createElement(F),ns(ne,F,Y),U.head.appendChild(ne);break;default:throw Error(u(468,F))}ne[Ji]=B,ke(ne),F=ne}B.stateNode=F}else yd(U,B.type,B.stateNode);else B.stateNode=md(U,F,B.memoizedProps);else ne!==F?(ne===null?Y.stateNode!==null&&(Y=Y.stateNode,Y.parentNode.removeChild(Y)):ne.count--,F===null?yd(U,B.type,B.stateNode):md(U,F,B.memoizedProps)):F===null&&B.stateNode!==null&&Zs(B,B.memoizedProps,Y.memoizedProps)}break;case 27:if(F&4&&B.alternate===null){U=B.stateNode,ne=B.memoizedProps;try{for(var we=U.firstChild;we;){var He=we.nextSibling,ht=we.nodeName;we[fo]||ht==="HEAD"||ht==="BODY"||ht==="SCRIPT"||ht==="STYLE"||ht==="LINK"&&we.rel.toLowerCase()==="stylesheet"||U.removeChild(we),we=He}for(var bt=B.type,tt=U.attributes;tt.length;)U.removeAttributeNode(tt[0]);ns(U,bt,ne),U[Ji]=B,U[Qt]=ne}catch(Lt){Xt(B,B.return,Lt)}}case 5:if(Qn(Z,B),Fn(B),F&512&&(Ki||Y===null||Mi(Y,Y.return)),B.flags&32){U=B.stateNode;try{kn(U,"")}catch(Lt){Xt(B,B.return,Lt)}}F&4&&B.stateNode!=null&&(U=B.memoizedProps,Zs(B,U,Y!==null?Y.memoizedProps:U)),F&1024&&(Gr=!0);break;case 6:if(Qn(Z,B),Fn(B),F&4){if(B.stateNode===null)throw Error(u(162));F=B.memoizedProps,Y=B.stateNode;try{Y.nodeValue=F}catch(Lt){Xt(B,B.return,Lt)}}break;case 3:if(lh=null,U=Ln,Ln=rh(Z.containerInfo),Qn(Z,B),Ln=U,Fn(B),F&4&&Y!==null&&Y.memoizedState.isDehydrated)try{Lg(Z.containerInfo)}catch(Lt){Xt(B,B.return,Lt)}Gr&&(Gr=!1,vr(B));break;case 4:F=Ln,Ln=rh(B.stateNode.containerInfo),Qn(Z,B),Fn(B),Ln=F;break;case 12:Qn(Z,B),Fn(B);break;case 13:Qn(Z,B),Fn(B),B.child.flags&8192&&B.memoizedState!==null!=(Y!==null&&Y.memoizedState!==null)&&(ai=nt()),F&4&&(F=B.updateQueue,F!==null&&(B.updateQueue=null,Zl(B,F)));break;case 22:if(F&512&&(Ki||Y===null||Mi(Y,Y.return)),we=B.memoizedState!==null,He=Y!==null&&Y.memoizedState!==null,ht=Os,bt=Ki,Os=ht||we,Ki=bt||He,Qn(Z,B),Ki=bt,Os=ht,Fn(B),Z=B.stateNode,Z._current=B,Z._visibility&=-3,Z._visibility|=Z._pendingVisibility&2,F&8192&&(Z._visibility=we?Z._visibility&-2:Z._visibility|1,we&&(Z=Os||Ki,Y===null||He||Z||Us(B)),B.memoizedProps===null||B.memoizedProps.mode!=="manual"))e:for(Y=null,Z=B;;){if(Z.tag===5||Z.tag===26||Z.tag===27){if(Y===null){He=Y=Z;try{if(U=He.stateNode,we)ne=U.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{ce=He.stateNode,pe=He.memoizedProps.style;var ct=pe!=null&&pe.hasOwnProperty("display")?pe.display:null;ce.style.display=ct==null||typeof ct=="boolean"?"":(""+ct).trim()}}catch(Lt){Xt(He,He.return,Lt)}}}else if(Z.tag===6){if(Y===null){He=Z;try{He.stateNode.nodeValue=we?"":He.memoizedProps}catch(Lt){Xt(He,He.return,Lt)}}}else if((Z.tag!==22&&Z.tag!==23||Z.memoizedState===null||Z===B)&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===B)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===B)break e;Y===Z&&(Y=null),Z=Z.return}Y===Z&&(Y=null),Z.sibling.return=Z.return,Z=Z.sibling}F&4&&(F=B.updateQueue,F!==null&&(Y=F.retryQueue,Y!==null&&(F.retryQueue=null,Zl(B,Y))));break;case 19:Qn(Z,B),Fn(B),F&4&&(F=B.updateQueue,F!==null&&(B.updateQueue=null,Zl(B,F)));break;case 21:break;default:Qn(Z,B),Fn(B)}}function Fn(B){var Z=B.flags;if(Z&2){try{if(B.tag!==27){e:{for(var Y=B.return;Y!==null;){if(ks(Y)){var F=Y;break e}Y=Y.return}throw Error(u(160))}switch(F.tag){case 27:var U=F.stateNode,ne=xl(B);Jo(B,ne,U);break;case 5:var ce=F.stateNode;F.flags&32&&(kn(ce,""),F.flags&=-33);var pe=xl(B);Jo(B,pe,ce);break;case 3:case 4:var we=F.stateNode.containerInfo,He=xl(B);ds(B,He,we);break;default:throw Error(u(161))}}}catch(ht){Xt(B,B.return,ht)}B.flags&=-3}Z&4096&&(B.flags&=-4097)}function vr(B){if(B.subtreeFlags&1024)for(B=B.child;B!==null;){var Z=B;vr(Z),Z.tag===5&&Z.flags&1024&&Z.stateNode.reset(),B=B.sibling}}function go(B,Z){if(Z.subtreeFlags&8772)for(Z=Z.child;Z!==null;)Va(B,Z.alternate,Z),Z=Z.sibling}function Us(B){for(B=B.child;B!==null;){var Z=B;switch(Z.tag){case 0:case 11:case 14:case 15:Rs(4,Z,Z.return),Us(Z);break;case 1:Mi(Z,Z.return);var Y=Z.stateNode;typeof Y.componentWillUnmount=="function"&&Xl(Z,Z.return,Y),Us(Z);break;case 26:case 27:case 5:Mi(Z,Z.return),Us(Z);break;case 22:Mi(Z,Z.return),Z.memoizedState===null&&Us(Z);break;default:Us(Z)}B=B.sibling}}function $s(B,Z,Y){for(Y=Y&&(Z.subtreeFlags&8772)!==0,Z=Z.child;Z!==null;){var F=Z.alternate,U=B,ne=Z,ce=ne.flags;switch(ne.tag){case 0:case 11:case 15:$s(U,ne,Y),on(4,ne);break;case 1:if($s(U,ne,Y),F=ne,U=F.stateNode,typeof U.componentDidMount=="function")try{U.componentDidMount()}catch(He){Xt(F,F.return,He)}if(F=ne,U=F.updateQueue,U!==null){var pe=F.stateNode;try{var we=U.shared.hiddenCallbacks;if(we!==null)for(U.shared.hiddenCallbacks=null,U=0;U<we.length;U++)lo(we[U],pe)}catch(He){Xt(F,F.return,He)}}Y&&ce&64&&To(ne),rn(ne,ne.return);break;case 26:case 27:case 5:$s(U,ne,Y),Y&&F===null&&ce&4&&yi(ne),rn(ne,ne.return);break;case 12:$s(U,ne,Y);break;case 13:$s(U,ne,Y),Y&&ce&4&&qu(U,ne);break;case 22:ne.memoizedState===null&&$s(U,ne,Y),rn(ne,ne.return);break;default:$s(U,ne,Y)}Z=Z.sibling}}function Cs(B,Z){var Y=null;B!==null&&B.memoizedState!==null&&B.memoizedState.cachePool!==null&&(Y=B.memoizedState.cachePool.pool),B=null,Z.memoizedState!==null&&Z.memoizedState.cachePool!==null&&(B=Z.memoizedState.cachePool.pool),B!==Y&&(B!=null&&B.refCount++,Y!=null&&gr(Y))}function ws(B,Z){B=null,Z.alternate!==null&&(B=Z.alternate.memoizedState.cache),Z=Z.memoizedState.cache,Z!==B&&(Z.refCount++,B!=null&&gr(B))}function Li(B,Z,Y,F){if(Z.subtreeFlags&10256)for(Z=Z.child;Z!==null;)Ho(B,Z,Y,F),Z=Z.sibling}function Ho(B,Z,Y,F){var U=Z.flags;switch(Z.tag){case 0:case 11:case 15:Li(B,Z,Y,F),U&2048&&on(9,Z);break;case 3:Li(B,Z,Y,F),U&2048&&(B=null,Z.alternate!==null&&(B=Z.alternate.memoizedState.cache),Z=Z.memoizedState.cache,Z!==B&&(Z.refCount++,B!=null&&gr(B)));break;case 12:if(U&2048){Li(B,Z,Y,F),B=Z.stateNode;try{var ne=Z.memoizedProps,ce=ne.id,pe=ne.onPostCommit;typeof pe=="function"&&pe(ce,Z.alternate===null?"mount":"update",B.passiveEffectDuration,-0)}catch(we){Xt(Z,Z.return,we)}}else Li(B,Z,Y,F);break;case 23:break;case 22:ne=Z.stateNode,Z.memoizedState!==null?ne._visibility&4?Li(B,Z,Y,F):vi(B,Z):ne._visibility&4?Li(B,Z,Y,F):(ne._visibility|=4,ei(B,Z,Y,F,(Z.subtreeFlags&10256)!==0)),U&2048&&Cs(Z.alternate,Z);break;case 24:Li(B,Z,Y,F),U&2048&&ws(Z.alternate,Z);break;default:Li(B,Z,Y,F)}}function ei(B,Z,Y,F,U){for(U=U&&(Z.subtreeFlags&10256)!==0,Z=Z.child;Z!==null;){var ne=B,ce=Z,pe=Y,we=F,He=ce.flags;switch(ce.tag){case 0:case 11:case 15:ei(ne,ce,pe,we,U),on(8,ce);break;case 23:break;case 22:var ht=ce.stateNode;ce.memoizedState!==null?ht._visibility&4?ei(ne,ce,pe,we,U):vi(ne,ce):(ht._visibility|=4,ei(ne,ce,pe,we,U)),U&&He&2048&&Cs(ce.alternate,ce);break;case 24:ei(ne,ce,pe,we,U),U&&He&2048&&ws(ce.alternate,ce);break;default:ei(ne,ce,pe,we,U)}Z=Z.sibling}}function vi(B,Z){if(Z.subtreeFlags&10256)for(Z=Z.child;Z!==null;){var Y=B,F=Z,U=F.flags;switch(F.tag){case 22:vi(Y,F),U&2048&&Cs(F.alternate,F);break;case 24:vi(Y,F),U&2048&&ws(F.alternate,F);break;default:vi(Y,F)}Z=Z.sibling}}var Ui=8192;function zo(B){if(B.subtreeFlags&Ui)for(B=B.child;B!==null;)qr(B),B=B.sibling}function qr(B){switch(B.tag){case 26:zo(B),B.flags&Ui&&B.memoizedState!==null&&rC(Ln,B.memoizedState,B.memoizedProps);break;case 5:zo(B);break;case 3:case 4:var Z=Ln;Ln=rh(B.stateNode.containerInfo),zo(B),Ln=Z;break;case 22:B.memoizedState===null&&(Z=B.alternate,Z!==null&&Z.memoizedState!==null?(Z=Ui,Ui=16777216,zo(B),Ui=Z):zo(B));break;default:zo(B)}}function Br(B){var Z=B.alternate;if(Z!==null&&(B=Z.child,B!==null)){Z.child=null;do Z=B.sibling,B.sibling=null,B=Z;while(B!==null)}}function Sr(B){var Z=B.deletions;if((B.flags&16)!==0){if(Z!==null)for(var Y=0;Y<Z.length;Y++){var F=Z[Y];an=F,eh(F,B)}Br(B)}if(B.subtreeFlags&10256)for(B=B.child;B!==null;)Wa(B),B=B.sibling}function Wa(B){switch(B.tag){case 0:case 11:case 15:Sr(B),B.flags&2048&&Rs(9,B,B.return);break;case 3:Sr(B);break;case 12:Sr(B);break;case 22:var Z=B.stateNode;B.memoizedState!==null&&Z._visibility&4&&(B.return===null||B.return.tag!==13)?(Z._visibility&=-5,Lo(B)):Sr(B);break;default:Sr(B)}}function Lo(B){var Z=B.deletions;if((B.flags&16)!==0){if(Z!==null)for(var Y=0;Y<Z.length;Y++){var F=Z[Y];an=F,eh(F,B)}Br(B)}for(B=B.child;B!==null;){switch(Z=B,Z.tag){case 0:case 11:case 15:Rs(8,Z,Z.return),Lo(Z);break;case 22:Y=Z.stateNode,Y._visibility&4&&(Y._visibility&=-5,Lo(Z));break;default:Lo(Z)}B=B.sibling}}function eh(B,Z){for(;an!==null;){var Y=an;switch(Y.tag){case 0:case 11:case 15:Rs(8,Y,Z);break;case 23:case 22:if(Y.memoizedState!==null&&Y.memoizedState.cachePool!==null){var F=Y.memoizedState.cachePool.pool;F!=null&&F.refCount++}break;case 24:gr(Y.memoizedState.cache)}if(F=Y.child,F!==null)F.return=Y,an=F;else e:for(Y=B;an!==null;){F=an;var U=F.sibling,ne=F.return;if(vc(F),F===Y){an=null;break e}if(U!==null){U.return=ne,an=U;break e}an=ne}}}function Rg(B,Z,Y,F){this.tag=B,this.key=Y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=Z,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ln(B,Z,Y,F){return new Rg(B,Z,Y,F)}function Fo(B){return B=B.prototype,!(!B||!B.isReactComponent)}function qn(B,Z){var Y=B.alternate;return Y===null?(Y=ln(B.tag,Z,B.key,B.mode),Y.elementType=B.elementType,Y.type=B.type,Y.stateNode=B.stateNode,Y.alternate=B,B.alternate=Y):(Y.pendingProps=Z,Y.type=B.type,Y.flags=0,Y.subtreeFlags=0,Y.deletions=null),Y.flags=B.flags&31457280,Y.childLanes=B.childLanes,Y.lanes=B.lanes,Y.child=B.child,Y.memoizedProps=B.memoizedProps,Y.memoizedState=B.memoizedState,Y.updateQueue=B.updateQueue,Z=B.dependencies,Y.dependencies=Z===null?null:{lanes:Z.lanes,firstContext:Z.firstContext},Y.sibling=B.sibling,Y.index=B.index,Y.ref=B.ref,Y.refCleanup=B.refCleanup,Y}function Xr(B,Z){B.flags&=31457282;var Y=B.alternate;return Y===null?(B.childLanes=0,B.lanes=Z,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=Y.childLanes,B.lanes=Y.lanes,B.child=Y.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=Y.memoizedProps,B.memoizedState=Y.memoizedState,B.updateQueue=Y.updateQueue,B.type=Y.type,Z=Y.dependencies,B.dependencies=Z===null?null:{lanes:Z.lanes,firstContext:Z.firstContext}),B}function Ea(B,Z,Y,F,U,ne){var ce=0;if(F=B,typeof B=="function")Fo(B)&&(ce=1);else if(typeof B=="string")ce=sC(B,Y,wt.current)?26:B==="html"||B==="head"||B==="body"?27:5;else e:switch(B){case A:return xr(Y.children,U,ne,Z);case y:ce=8,U|=24;break;case G:return B=ln(12,Y,Z,U|2),B.elementType=G,B.lanes=ne,B;case T:return B=ln(13,Y,Z,U),B.elementType=T,B.lanes=ne,B;case H:return B=ln(19,Y,Z,U),B.elementType=H,B.lanes=ne,B;case L:return Zg(Y,U,ne,Z);default:if(typeof B=="object"&&B!==null)switch(B.$$typeof){case S:case M:ce=10;break e;case w:ce=9;break e;case V:ce=11;break e;case J:ce=14;break e;case z:ce=16,F=null;break e}ce=29,Y=Error(u(130,B===null?"null":typeof B,"")),F=null}return Z=ln(ce,Y,Z,U),Z.elementType=B,Z.type=F,Z.lanes=ne,Z}function xr(B,Z,Y,F){return B=ln(7,B,F,Z),B.lanes=Y,B}function Zg(B,Z,Y,F){B=ln(22,B,F,Z),B.elementType=L,B.lanes=Y;var U={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var ne=U._current;if(ne===null)throw Error(u(456));if((U._pendingVisibility&2)===0){var ce=So(ne,2);ce!==null&&(U._pendingVisibility|=2,pn(ce,ne,2))}},attach:function(){var ne=U._current;if(ne===null)throw Error(u(456));if((U._pendingVisibility&2)!==0){var ce=So(ne,2);ce!==null&&(U._pendingVisibility&=-3,pn(ce,ne,2))}}};return B.stateNode=U,B}function In(B,Z,Y){return B=ln(6,B,null,Z),B.lanes=Y,B}function wl(B,Z,Y){return Z=ln(4,B.children!==null?B.children:[],B.key,Z),Z.lanes=Y,Z.stateNode={containerInfo:B.containerInfo,pendingChildren:null,implementation:B.implementation},Z}function _s(B){B.flags|=4}function Rr(B,Z){if(Z.type!=="stylesheet"||(Z.state.loading&4)!==0)B.flags&=-16777217;else if(B.flags|=16777216,!Gd(Z)){if(Z=gs.current,Z!==null&&((Dt&4194176)===Dt?io!==null:(Dt&62914560)!==Dt&&(Dt&536870912)===0||Z!==io))throw ya=tc,eg;B.flags|=8192}}function Ms(B,Z){Z!==null&&(B.flags|=4),B.flags&16384&&(Z=B.tag!==22?ni():536870912,B.lanes|=Z,ho|=Z)}function _l(B,Z){if(!bi)switch(B.tailMode){case"hidden":Z=B.tail;for(var Y=null;Z!==null;)Z.alternate!==null&&(Y=Z),Z=Z.sibling;Y===null?B.tail=null:Y.sibling=null;break;case"collapsed":Y=B.tail;for(var F=null;Y!==null;)Y.alternate!==null&&(F=Y),Y=Y.sibling;F===null?Z||B.tail===null?B.tail=null:B.tail.sibling=null:F.sibling=null}}function ji(B){var Z=B.alternate!==null&&B.alternate.child===B.child,Y=0,F=0;if(Z)for(var U=B.child;U!==null;)Y|=U.lanes|U.childLanes,F|=U.subtreeFlags&31457280,F|=U.flags&31457280,U.return=B,U=U.sibling;else for(U=B.child;U!==null;)Y|=U.lanes|U.childLanes,F|=U.subtreeFlags,F|=U.flags,U.return=B,U=U.sibling;return B.subtreeFlags|=F,B.childLanes=Y,Z}function wh(B,Z,Y){var F=Z.pendingProps;switch(or(Z),Z.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ji(Z),null;case 1:return ji(Z),null;case 3:return Y=Z.stateNode,F=null,B!==null&&(F=B.memoizedState.cache),Z.memoizedState.cache!==F&&(Z.flags|=2048),Yo(tn),ot(),Y.pendingContext&&(Y.context=Y.pendingContext,Y.pendingContext=null),(B===null||B.child===null)&&(ma(Z)?_s(Z):B===null||B.memoizedState.isDehydrated&&(Z.flags&256)===0||(Z.flags|=1024,Xs!==null&&(Es(Xs),Xs=null))),ji(Z),null;case 26:return Y=Z.memoizedState,B===null?(_s(Z),Y!==null?(ji(Z),Rr(Z,Y)):(ji(Z),Z.flags&=-16777217)):Y?Y!==B.memoizedState?(_s(Z),ji(Z),Rr(Z,Y)):(ji(Z),Z.flags&=-16777217):(B.memoizedProps!==F&&_s(Z),ji(Z),Z.flags&=-16777217),null;case 27:at(Z),Y=Ue.current;var U=Z.type;if(B!==null&&Z.stateNode!=null)B.memoizedProps!==F&&_s(Z);else{if(!F){if(Z.stateNode===null)throw Error(u(166));return ji(Z),null}B=wt.current,ma(Z)?lu(Z):(B=Cd(U,F,Y),Z.stateNode=B,_s(Z))}return ji(Z),null;case 5:if(at(Z),Y=Z.type,B!==null&&Z.stateNode!=null)B.memoizedProps!==F&&_s(Z);else{if(!F){if(Z.stateNode===null)throw Error(u(166));return ji(Z),null}if(B=wt.current,ma(Z))lu(Z);else{switch(U=oh(Ue.current),B){case 1:B=U.createElementNS("http://www.w3.org/2000/svg",Y);break;case 2:B=U.createElementNS("http://www.w3.org/1998/Math/MathML",Y);break;default:switch(Y){case"svg":B=U.createElementNS("http://www.w3.org/2000/svg",Y);break;case"math":B=U.createElementNS("http://www.w3.org/1998/Math/MathML",Y);break;case"script":B=U.createElement("div"),B.innerHTML="<script><\/script>",B=B.removeChild(B.firstChild);break;case"select":B=typeof F.is=="string"?U.createElement("select",{is:F.is}):U.createElement("select"),F.multiple?B.multiple=!0:F.size&&(B.size=F.size);break;default:B=typeof F.is=="string"?U.createElement(Y,{is:F.is}):U.createElement(Y)}}B[Ji]=Z,B[Qt]=F;e:for(U=Z.child;U!==null;){if(U.tag===5||U.tag===6)B.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===Z)break e;for(;U.sibling===null;){if(U.return===null||U.return===Z)break e;U=U.return}U.sibling.return=U.return,U=U.sibling}Z.stateNode=B;e:switch(ns(B,Y,F),Y){case"button":case"input":case"select":case"textarea":B=!!F.autoFocus;break e;case"img":B=!0;break e;default:B=!1}B&&_s(Z)}}return ji(Z),Z.flags&=-16777217,null;case 6:if(B&&Z.stateNode!=null)B.memoizedProps!==F&&_s(Z);else{if(typeof F!="string"&&Z.stateNode===null)throw Error(u(166));if(B=Ue.current,ma(Z)){if(B=Z.stateNode,Y=Z.memoizedProps,F=null,U=Tn,U!==null)switch(U.tag){case 27:case 5:F=U.memoizedProps}B[Ji]=Z,B=!!(B.nodeValue===Y||F!==null&&F.suppressHydrationWarning===!0||ld(B.nodeValue,Y)),B||zr(Z)}else B=oh(B).createTextNode(F),B[Ji]=Z,Z.stateNode=B}return ji(Z),null;case 13:if(F=Z.memoizedState,B===null||B.memoizedState!==null&&B.memoizedState.dehydrated!==null){if(U=ma(Z),F!==null&&F.dehydrated!==null){if(B===null){if(!U)throw Error(u(318));if(U=Z.memoizedState,U=U!==null?U.dehydrated:null,!U)throw Error(u(317));U[Ji]=Z}else ba(),(Z.flags&128)===0&&(Z.memoizedState=null),Z.flags|=4;ji(Z),U=!1}else Xs!==null&&(Es(Xs),Xs=null),U=!0;if(!U)return Z.flags&256?(no(Z),Z):(no(Z),null)}if(no(Z),(Z.flags&128)!==0)return Z.lanes=Y,Z;if(Y=F!==null,B=B!==null&&B.memoizedState!==null,Y){F=Z.child,U=null,F.alternate!==null&&F.alternate.memoizedState!==null&&F.alternate.memoizedState.cachePool!==null&&(U=F.alternate.memoizedState.cachePool.pool);var ne=null;F.memoizedState!==null&&F.memoizedState.cachePool!==null&&(ne=F.memoizedState.cachePool.pool),ne!==U&&(F.flags|=2048)}return Y!==B&&Y&&(Z.child.flags|=8192),Ms(Z,Z.updateQueue),ji(Z),null;case 4:return ot(),B===null&&Wh(Z.stateNode.containerInfo),ji(Z),null;case 10:return Yo(Z.type),ji(Z),null;case 19:if(Ct(hn),U=Z.memoizedState,U===null)return ji(Z),null;if(F=(Z.flags&128)!==0,ne=U.rendering,ne===null)if(F)_l(U,!1);else{if(Di!==0||B!==null&&(B.flags&128)!==0)for(B=Z.child;B!==null;){if(ne=Ga(B),ne!==null){for(Z.flags|=128,_l(U,!1),B=ne.updateQueue,Z.updateQueue=B,Ms(Z,B),Z.subtreeFlags=0,B=Y,Y=Z.child;Y!==null;)Xr(Y,B),Y=Y.sibling;return st(hn,hn.current&1|2),Z.child}B=B.sibling}U.tail!==null&&nt()>di&&(Z.flags|=128,F=!0,_l(U,!1),Z.lanes=4194304)}else{if(!F)if(B=Ga(ne),B!==null){if(Z.flags|=128,F=!0,B=B.updateQueue,Z.updateQueue=B,Ms(Z,B),_l(U,!0),U.tail===null&&U.tailMode==="hidden"&&!ne.alternate&&!bi)return ji(Z),null}else 2*nt()-U.renderingStartTime>di&&Y!==536870912&&(Z.flags|=128,F=!0,_l(U,!1),Z.lanes=4194304);U.isBackwards?(ne.sibling=Z.child,Z.child=ne):(B=U.last,B!==null?B.sibling=ne:Z.child=ne,U.last=ne)}return U.tail!==null?(Z=U.tail,U.rendering=Z,U.tail=Z.sibling,U.renderingStartTime=nt(),Z.sibling=null,B=hn.current,st(hn,F?B&1|2:B&1),Z):(ji(Z),null);case 22:case 23:return no(Z),ml(),F=Z.memoizedState!==null,B!==null?B.memoizedState!==null!==F&&(Z.flags|=8192):F&&(Z.flags|=8192),F?(Y&536870912)!==0&&(Z.flags&128)===0&&(ji(Z),Z.subtreeFlags&6&&(Z.flags|=8192)):ji(Z),Y=Z.updateQueue,Y!==null&&Ms(Z,Y.retryQueue),Y=null,B!==null&&B.memoizedState!==null&&B.memoizedState.cachePool!==null&&(Y=B.memoizedState.cachePool.pool),F=null,Z.memoizedState!==null&&Z.memoizedState.cachePool!==null&&(F=Z.memoizedState.cachePool.pool),F!==Y&&(Z.flags|=2048),B!==null&&Ct(Mo),null;case 24:return Y=null,B!==null&&(Y=B.memoizedState.cache),Z.memoizedState.cache!==Y&&(Z.flags|=2048),Yo(tn),ji(Z),null;case 25:return null}throw Error(u(156,Z.tag))}function en(B,Z){switch(or(Z),Z.tag){case 1:return B=Z.flags,B&65536?(Z.flags=B&-65537|128,Z):null;case 3:return Yo(tn),ot(),B=Z.flags,(B&65536)!==0&&(B&128)===0?(Z.flags=B&-65537|128,Z):null;case 26:case 27:case 5:return at(Z),null;case 13:if(no(Z),B=Z.memoizedState,B!==null&&B.dehydrated!==null){if(Z.alternate===null)throw Error(u(340));ba()}return B=Z.flags,B&65536?(Z.flags=B&-65537|128,Z):null;case 19:return Ct(hn),null;case 4:return ot(),null;case 10:return Yo(Z.type),null;case 22:case 23:return no(Z),ml(),B!==null&&Ct(Mo),B=Z.flags,B&65536?(Z.flags=B&-65537|128,Z):null;case 24:return Yo(tn),null;case 25:return null;default:return null}}function wg(B,Z){switch(or(Z),Z.tag){case 3:Yo(tn),ot();break;case 26:case 27:case 5:at(Z);break;case 4:ot();break;case 13:no(Z);break;case 19:Ct(hn);break;case 10:Yo(Z.type);break;case 22:case 23:no(Z),ml(),B!==null&&Ct(Mo);break;case 24:Yo(tn)}}var ea={getCacheForType:function(B){var Z=Jn(tn),Y=Z.data.get(B);return Y===void 0&&(Y=B(),Z.data.set(B,Y)),Y}},Ko=typeof WeakMap=="function"?WeakMap:Map,ti=0,Ni=null,li=null,Dt=0,Ei=0,Bi=null,cn=!1,Kn=!1,Zr=!1,Po=0,Di=0,js=0,uo=0,Ya=0,es=0,ho=0,Ml=null,hi=null,Vi=!1,ai=0,di=1/0,_i=null,fn=null,Ns=!1,Vs=null,ta=0,Qs=0,$i=null,Ws=0,Do=null;function ts(){if((ti&2)!==0&&Dt!==0)return Dt&-Dt;if(te.T!==null){var B=Kr;return B!==0?B:_h()}return Vn()}function Gs(){es===0&&(es=(Dt&536870912)===0||bi?Si():536870912);var B=gs.current;return B!==null&&(B.flags|=32),es}function pn(B,Z,Y){(B===Ni&&Ei===2||B.cancelPendingCommit!==null)&&(ko(B,0),vs(B,Dt,es,!1)),Ri(B,Y),((ti&2)===0||B!==Ni)&&(B===Ni&&((ti&2)===0&&(uo|=Y),Di===4&&vs(B,Dt,es,!1)),Yi(B))}function Ta(B,Z,Y){if((ti&6)!==0)throw Error(u(327));var F=!Y&&(Z&60)===0&&(Z&B.expiredLanes)===0||Jt(B,Z),U=F?_(B,Z):na(B,Z,!0),ne=F;do{if(U===0){Kn&&!F&&vs(B,Z,0,!1);break}else if(U===6)vs(B,Z,0,!cn);else{if(Y=B.current.alternate,ne&&!_g(Y)){U=na(B,Z,!1),ne=!1;continue}if(U===2){if(ne=Z,B.errorRecoveryDisabledLanes&ne)var ce=0;else ce=B.pendingLanes&-536870913,ce=ce!==0?ce:ce&536870912?536870912:0;if(ce!==0){Z=ce;e:{var pe=B;U=Ml;var we=pe.current.memoizedState.isDehydrated;if(we&&(ko(pe,ce).flags|=256),ce=na(pe,ce,!1),ce!==2){if(Zr&&!we){pe.errorRecoveryDisabledLanes|=ne,uo|=ne,U=4;break e}ne=hi,hi=U,ne!==null&&Es(ne)}U=ce}if(ne=!1,U!==2)continue}}if(U===1){ko(B,0),vs(B,Z,0,!0);break}e:{switch(F=B,U){case 0:case 1:throw Error(u(345));case 4:if((Z&4194176)===Z){vs(F,Z,es,!cn);break e}break;case 2:hi=null;break;case 3:case 5:break;default:throw Error(u(329))}if(F.finishedWork=Y,F.finishedLanes=Z,(Z&62914560)===Z&&(ne=ai+300-nt(),10<ne)){if(vs(F,Z,es,!cn),_t(F,0)!==0)break e;F.timeoutHandle=ud(Sc.bind(null,F,Y,hi,_i,Vi,Z,es,uo,ho,cn,2,-0,0),ne);break e}Sc(F,Y,hi,_i,Vi,Z,es,uo,ho,cn,0,-0,0)}}break}while(!0);Yi(B)}function Es(B){hi===null?hi=B:hi.push.apply(hi,B)}function Sc(B,Z,Y,F,U,ne,ce,pe,we,He,ht,bt,tt){var ct=Z.subtreeFlags;if((ct&8192||(ct&16785408)===16785408)&&(Yg={stylesheets:null,count:0,unsuspend:oC},qr(Z),Z=aC(),Z!==null)){B.cancelPendingCommit=Z(Me.bind(null,B,Y,F,U,ce,pe,we,1,bt,tt)),vs(B,ne,ce,!He);return}Me(B,Y,F,U,ce,pe,we,ht,bt,tt)}function _g(B){for(var Z=B;;){var Y=Z.tag;if((Y===0||Y===11||Y===15)&&Z.flags&16384&&(Y=Z.updateQueue,Y!==null&&(Y=Y.stores,Y!==null)))for(var F=0;F<Y.length;F++){var U=Y[F],ne=U.getSnapshot;U=U.value;try{if(!rs(ne(),U))return!1}catch{return!1}}if(Y=Z.child,Z.subtreeFlags&16384&&Y!==null)Y.return=Z,Z=Y;else{if(Z===B)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===B)return!0;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}}return!0}function vs(B,Z,Y,F){Z&=~Ya,Z&=~uo,B.suspendedLanes|=Z,B.pingedLanes&=~Z,F&&(B.warmLanes|=Z),F=B.expirationTimes;for(var U=Z;0<U;){var ne=31-Ye(U),ce=1<<ne;F[ne]=-1,U&=~ce}Y!==0&&Ts(B,Y,Z)}function ia(){return(ti&6)===0?(pi(0),!1):!0}function Co(){if(li!==null){if(Ei===0)var B=li.return;else B=li,Ps=ao=null,oc(B),lr=null,fl=0,B=li;for(;B!==null;)wg(B.alternate,B),B=B.return;li=null}}function ko(B,Z){B.finishedWork=null,B.finishedLanes=0;var Y=B.timeoutHandle;Y!==-1&&(B.timeoutHandle=-1,Fd(Y)),Y=B.cancelPendingCommit,Y!==null&&(B.cancelPendingCommit=null,Y()),Co(),Ni=B,li=Y=qn(B.current,null),Dt=Z,Ei=0,Bi=null,cn=!1,Kn=Jt(B,Z),Zr=!1,ho=es=Ya=uo=js=Di=0,hi=Ml=null,Vi=!1,(Z&8)!==0&&(Z|=Z&32);var F=B.entangledLanes;if(F!==0)for(B=B.entanglements,F&=Z;0<F;){var U=31-Ye(F),ne=1<<U;Z|=B[U],F&=~ne}return Po=Z,ll(),Y}function wr(B,Z){ri=null,te.H=ro,Z===rr?(Z=Xi(),Ei=3):Z===eg?(Z=Xi(),Ei=4):Ei=Z===As?8:Z!==null&&typeof Z=="object"&&typeof Z.then=="function"?6:1,Bi=Z,li===null&&(Di=1,Cc(B,cs(Z,B.current)))}function Ja(){var B=te.H;return te.H=ro,B===null?ro:B}function Xc(){var B=te.A;return te.A=ea,B}function Nl(){Di=4,cn||(Dt&4194176)!==Dt&&gs.current!==null||(Kn=!0),(js&134217727)===0&&(uo&134217727)===0||Ni===null||vs(Ni,Dt,es,!1)}function na(B,Z,Y){var F=ti;ti|=2;var U=Ja(),ne=Xc();(Ni!==B||Dt!==Z)&&(_i=null,ko(B,Z)),Z=!1;var ce=Di;e:do try{if(Ei!==0&&li!==null){var pe=li,we=Bi;switch(Ei){case 8:Co(),ce=6;break e;case 3:case 2:case 6:gs.current===null&&(Z=!0);var He=Ei;if(Ei=0,Bi=null,oe(B,pe,we,He),Y&&Kn){ce=0;break e}break;default:He=Ei,Ei=0,Bi=null,oe(B,pe,we,He)}}Mg(),ce=Di;break}catch(ht){wr(B,ht)}while(!0);return Z&&B.shellSuspendCounter++,Ps=ao=null,ti=F,te.H=U,te.A=ne,li===null&&(Ni=null,Dt=0,ll()),ce}function Mg(){for(;li!==null;)P(li)}function _(B,Z){var Y=ti;ti|=2;var F=Ja(),U=Xc();Ni!==B||Dt!==Z?(_i=null,di=nt()+500,ko(B,Z)):Kn=Jt(B,Z);e:do try{if(Ei!==0&&li!==null){Z=li;var ne=Bi;t:switch(Ei){case 1:Ei=0,Bi=null,oe(B,Z,ne,1);break;case 2:if(gu(ne)){Ei=0,Bi=null,$(Z);break}Z=function(){Ei===2&&Ni===B&&(Ei=7),Yi(B)},ne.then(Z,Z);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:gu(ne)?(Ei=0,Bi=null,$(Z)):(Ei=0,Bi=null,oe(B,Z,ne,7));break;case 5:var ce=null;switch(li.tag){case 26:ce=li.memoizedState;case 5:case 27:var pe=li;if(!ce||Gd(ce)){Ei=0,Bi=null;var we=pe.sibling;if(we!==null)li=we;else{var He=pe.return;He!==null?(li=He,re(He)):li=null}break t}}Ei=0,Bi=null,oe(B,Z,ne,5);break;case 6:Ei=0,Bi=null,oe(B,Z,ne,6);break;case 8:Co(),Di=6;break e;default:throw Error(u(462))}}N();break}catch(ht){wr(B,ht)}while(!0);return Ps=ao=null,te.H=F,te.A=U,ti=Y,li!==null?0:(Ni=null,Dt=0,ll(),Di)}function N(){for(;li!==null&&!de();)P(li)}function P(B){var Z=Bl(B.alternate,B,Po);B.memoizedProps=B.pendingProps,Z===null?re(B):li=Z}function $(B){var Z=B,Y=Z.alternate;switch(Z.tag){case 15:case 0:Z=$u(Y,Z,Z.pendingProps,Z.type,void 0,Dt);break;case 11:Z=$u(Y,Z,Z.pendingProps,Z.type.render,Z.ref,Dt);break;case 5:oc(Z);default:wg(Y,Z),Z=li=Xr(Z,Po),Z=Bl(Y,Z,Po)}B.memoizedProps=B.pendingProps,Z===null?re(B):li=Z}function oe(B,Z,Y,F){Ps=ao=null,oc(Z),lr=null,fl=0;var U=Z.return;try{if(Rh(B,U,Z,Y,Dt)){Di=1,Cc(B,cs(Y,B.current)),li=null;return}}catch(ne){if(U!==null)throw li=U,ne;Di=1,Cc(B,cs(Y,B.current)),li=null;return}Z.flags&32768?(bi||F===1?B=!0:Kn||(Dt&536870912)!==0?B=!1:(cn=B=!0,(F===2||F===3||F===6)&&(F=gs.current,F!==null&&F.tag===13&&(F.flags|=16384))),Ae(Z,B)):re(Z)}function re(B){var Z=B;do{if((Z.flags&32768)!==0){Ae(Z,cn);return}B=Z.return;var Y=wh(Z.alternate,Z,Po);if(Y!==null){li=Y;return}if(Z=Z.sibling,Z!==null){li=Z;return}li=Z=B}while(Z!==null);Di===0&&(Di=5)}function Ae(B,Z){do{var Y=en(B.alternate,B);if(Y!==null){Y.flags&=32767,li=Y;return}if(Y=B.return,Y!==null&&(Y.flags|=32768,Y.subtreeFlags=0,Y.deletions=null),!Z&&(B=B.sibling,B!==null)){li=B;return}li=B=Y}while(B!==null);Di=6,li=null}function Me(B,Z,Y,F,U,ne,ce,pe,we,He){var ht=te.T,bt=me.p;try{me.p=2,te.T=null,Pe(B,Z,Y,F,bt,U,ne,ce,pe,we,He)}finally{te.T=ht,me.p=bt}}function Pe(B,Z,Y,F,U,ne,ce,pe){do Zt();while(Vs!==null);if((ti&6)!==0)throw Error(u(327));var we=B.finishedWork;if(F=B.finishedLanes,we===null)return null;if(B.finishedWork=null,B.finishedLanes=0,we===B.current)throw Error(u(177));B.callbackNode=null,B.callbackPriority=0,B.cancelPendingCommit=null;var He=we.lanes|we.childLanes;if(He|=Bo,vn(B,F,He,ne,ce,pe),B===Ni&&(li=Ni=null,Dt=0),(we.subtreeFlags&10256)===0&&(we.flags&10256)===0||Ns||(Ns=!0,Qs=He,$i=Y,Fe(Rt,function(){return Zt(),null})),Y=(we.flags&15990)!==0,(we.subtreeFlags&15990)!==0||Y?(Y=te.T,te.T=null,ne=me.p,me.p=2,ce=ti,ti|=4,Na(B,we),Qr(we,B),kc(Jh,B.containerInfo),uh=!!Th,Jh=Th=null,B.current=we,Va(B,we.alternate,we),De(),ti=ce,me.p=ne,te.T=Y):B.current=we,Ns?(Ns=!1,Vs=B,ta=F):ut(B,He),He=B.pendingLanes,He===0&&(fn=null),It(we.stateNode),Yi(B),Z!==null)for(U=B.onRecoverableError,we=0;we<Z.length;we++)He=Z[we],U(He.value,{componentStack:He.stack});return(ta&3)!==0&&Zt(),He=B.pendingLanes,(F&4194218)!==0&&(He&42)!==0?B===Do?Ws++:(Ws=0,Do=B):Ws=0,pi(0),null}function ut(B,Z){(B.pooledCacheLanes&=Z)===0&&(Z=B.pooledCache,Z!=null&&(B.pooledCache=null,gr(Z)))}function Zt(){if(Vs!==null){var B=Vs,Z=Qs;Qs=0;var Y=Bn(ta),F=te.T,U=me.p;try{if(me.p=32>Y?32:Y,te.T=null,Vs===null)var ne=!1;else{Y=$i,$i=null;var ce=Vs,pe=ta;if(Vs=null,ta=0,(ti&6)!==0)throw Error(u(331));var we=ti;if(ti|=4,Wa(ce.current),Ho(ce,ce.current,pe,Y),ti=we,pi(0,!1),mt&&typeof mt.onPostCommitFiberRoot=="function")try{mt.onPostCommitFiberRoot(pt,ce)}catch{}ne=!0}return ne}finally{me.p=U,te.T=F,ut(B,Z)}}return!1}function Et(B,Z,Y){Z=cs(Y,Z),Z=fg(B.stateNode,Z,2),B=ys(B,Z,2),B!==null&&(Ri(B,2),Yi(B))}function Xt(B,Z,Y){if(B.tag===3)Et(B,B,Y);else for(;Z!==null;){if(Z.tag===3){Et(Z,B,Y);break}else if(Z.tag===1){var F=Z.stateNode;if(typeof Z.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(fn===null||!fn.has(F))){B=cs(Y,B),Y=pg(2),F=ys(Z,Y,2),F!==null&&(Ou(Y,F,Z,B),Ri(F,2),Yi(F));break}}Z=Z.return}}function ii(B,Z,Y){var F=B.pingCache;if(F===null){F=B.pingCache=new Ko;var U=new Set;F.set(Z,U)}else U=F.get(Z),U===void 0&&(U=new Set,F.set(Z,U));U.has(Y)||(Zr=!0,U.add(Y),B=Ys.bind(null,B,Z,Y),Z.then(B,B))}function Ys(B,Z,Y){var F=B.pingCache;F!==null&&F.delete(Z),B.pingedLanes|=B.suspendedLanes&Y,B.warmLanes&=~Y,Ni===B&&(Dt&Y)===Y&&(Di===4||Di===3&&(Dt&62914560)===Dt&&300>nt()-ai?(ti&2)===0&&ko(B,0):Ya|=Y,ho===Dt&&(ho=0)),Yi(B)}function Ha(B,Z){Z===0&&(Z=ni()),B=So(B,Z),B!==null&&(Ri(B,Z),Yi(B))}function sa(B){var Z=B.memoizedState,Y=0;Z!==null&&(Y=Z.retryLane),Ha(B,Y)}function qe(B,Z){var Y=0;switch(B.tag){case 13:var F=B.stateNode,U=B.memoizedState;U!==null&&(Y=U.retryLane);break;case 19:F=B.stateNode;break;case 22:F=B.stateNode._retryCache;break;default:throw Error(u(314))}F!==null&&F.delete(Z),Ha(B,Y)}function Fe(B,Z){return xt(B,Z)}var it=null,Bt=null,zt=!1,Wi=!1,kt=!1,ci=0;function Yi(B){B!==Bt&&B.next===null&&(Bt===null?it=Bt=B:Bt=Bt.next=B),Wi=!0,zt||(zt=!0,Vd(_r))}function pi(B,Z){if(!kt&&Wi){kt=!0;do for(var Y=!1,F=it;F!==null;){if(B!==0){var U=F.pendingLanes;if(U===0)var ne=0;else{var ce=F.suspendedLanes,pe=F.pingedLanes;ne=(1<<31-Ye(42|B)+1)-1,ne&=U&~(ce&~pe),ne=ne&201326677?ne&201326677|1:ne?ne|2:0}ne!==0&&(Y=!0,td(F,ne))}else ne=Dt,ne=_t(F,F===Ni?ne:0),(ne&3)===0||Jt(F,ne)||(Y=!0,td(F,ne));F=F.next}while(Y);kt=!1}}function _r(){Wi=zt=!1;var B=0;ci!==0&&(Ld()&&(B=ci),ci=0);for(var Z=nt(),Y=null,F=it;F!==null;){var U=F.next,ne=th(F,Z);ne===0?(F.next=null,Y===null?it=U:Y.next=U,U===null&&(Bt=Y)):(Y=F,(B!==0||(ne&3)!==0)&&(Wi=!0)),F=U}pi(B)}function th(B,Z){for(var Y=B.suspendedLanes,F=B.pingedLanes,U=B.expirationTimes,ne=B.pendingLanes&-62914561;0<ne;){var ce=31-Ye(ne),pe=1<<ce,we=U[ce];we===-1?((pe&Y)===0||(pe&F)!==0)&&(U[ce]=oi(pe,Z)):we<=Z&&(B.expiredLanes|=pe),ne&=~pe}if(Z=Ni,Y=Dt,Y=_t(B,B===Z?Y:0),F=B.callbackNode,Y===0||B===Z&&Ei===2||B.cancelPendingCommit!==null)return F!==null&&F!==null&&ve(F),B.callbackNode=null,B.callbackPriority=0;if((Y&3)===0||Jt(B,Y)){if(Z=Y&-Y,Z===B.callbackPriority)return Z;switch(F!==null&&ve(F),Bn(Y)){case 2:case 8:Y=rt;break;case 32:Y=Rt;break;case 268435456:Y=Yt;break;default:Y=Rt}return F=ed.bind(null,B),Y=xt(Y,F),B.callbackPriority=Z,B.callbackNode=Y,Z}return F!==null&&F!==null&&ve(F),B.callbackPriority=2,B.callbackNode=null,2}function ed(B,Z){var Y=B.callbackNode;if(Zt()&&B.callbackNode!==Y)return null;var F=Dt;return F=_t(B,B===Ni?F:0),F===0?null:(Ta(B,F,Z),th(B,nt()),B.callbackNode!=null&&B.callbackNode===Y?ed.bind(null,B):null)}function td(B,Z){if(Zt())return null;Ta(B,Z,!0)}function Vd(B){Kd(function(){(ti&6)!==0?xt(ze,B):B()})}function _h(){return ci===0&&(ci=Si()),ci}function id(B){return B==null||typeof B=="symbol"||typeof B=="boolean"?null:typeof B=="function"?B:Oa(""+B)}function nd(B,Z){var Y=Z.ownerDocument.createElement("input");return Y.name=Z.name,Y.value=Z.value,B.id&&Y.setAttribute("form",B.id),Z.parentNode.insertBefore(Y,Z),B=new FormData(B),Y.parentNode.removeChild(Y),B}function Wd(B,Z,Y,F,U){if(Z==="submit"&&Y&&Y.stateNode===U){var ne=id((U[Qt]||null).action),ce=F.submitter;ce&&(Z=(Z=ce[Qt]||null)?id(Z.formAction):ce.getAttribute("formAction"),Z!==null&&(ne=Z,ce=null));var pe=new ca("action","action",null,F,U);B.push({event:pe,listeners:[{instance:null,listener:function(){if(F.defaultPrevented){if(ci!==0){var we=ce?nd(U,ce):new FormData(U);ug(Y,{pending:!0,data:we,method:U.method,action:ne},null,we)}}else typeof ne=="function"&&(pe.preventDefault(),we=ce?nd(U,ce):new FormData(U),ug(Y,{pending:!0,data:we,method:U.method,action:ne},ne,we))},currentTarget:U}]})}}for(var Mh=0;Mh<vo.length;Mh++){var Nh=vo[Mh],Ed=Nh.toLowerCase(),Yd=Nh[0].toUpperCase()+Nh.slice(1);Ss(Ed,"on"+Yd)}Ss($c,"onAnimationEnd"),Ss(ls,"onAnimationIteration"),Ss(Qc,"onAnimationStart"),Ss("dblclick","onDoubleClick"),Ss("focusin","onFocus"),Ss("focusout","onBlur"),Ss(Go,"onTransitionRun"),Ss(Aa,"onTransitionStart"),Ss(ir,"onTransitionCancel"),Ss(Ql,"onTransitionEnd"),Wt("onMouseEnter",["mouseout","mouseover"]),Wt("onMouseLeave",["mouseout","mouseover"]),Wt("onPointerEnter",["pointerout","pointerover"]),Wt("onPointerLeave",["pointerout","pointerover"]),Nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ng="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Td=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ng));function sd(B,Z){Z=(Z&4)!==0;for(var Y=0;Y<B.length;Y++){var F=B[Y],U=F.event;F=F.listeners;e:{var ne=void 0;if(Z)for(var ce=F.length-1;0<=ce;ce--){var pe=F[ce],we=pe.instance,He=pe.currentTarget;if(pe=pe.listener,we!==ne&&U.isPropagationStopped())break e;ne=pe,U.currentTarget=He;try{ne(U)}catch(ht){dc(ht)}U.currentTarget=null,ne=we}else for(ce=0;ce<F.length;ce++){if(pe=F[ce],we=pe.instance,He=pe.currentTarget,pe=pe.listener,we!==ne&&U.isPropagationStopped())break e;ne=pe,U.currentTarget=He;try{ne(U)}catch(ht){dc(ht)}U.currentTarget=null,ne=we}}}}function Gi(B,Z){var Y=Z[Uo];Y===void 0&&(Y=Z[Uo]=new Set);var F=B+"__bubble";Y.has(F)||(od(Z,B,2,!1),Y.add(F))}function Vh(B,Z,Y){var F=0;Z&&(F|=4),od(Y,B,F,Z)}var ih="_reactListening"+Math.random().toString(36).slice(2);function Wh(B){if(!B[ih]){B[ih]=!0,Le.forEach(function(Y){Y!=="selectionchange"&&(Td.has(Y)||Vh(Y,!1,B),Vh(Y,!0,B))});var Z=B.nodeType===9?B:B.ownerDocument;Z===null||Z[ih]||(Z[ih]=!0,Vh("selectionchange",!1,Z))}}function od(B,Z,Y,F){switch(Rd(Z)){case 2:var U=gC;break;case 8:U=uC;break;default:U=Oh}Y=U.bind(null,Z,Y,B),U=void 0,!$a||Z!=="touchstart"&&Z!=="touchmove"&&Z!=="wheel"||(U=!0),F?U!==void 0?B.addEventListener(Z,Y,{capture:!0,passive:U}):B.addEventListener(Z,Y,!0):U!==void 0?B.addEventListener(Z,Y,{passive:U}):B.addEventListener(Z,Y,!1)}function Eh(B,Z,Y,F,U){var ne=F;if((Z&1)===0&&(Z&2)===0&&F!==null)e:for(;;){if(F===null)return;var ce=F.tag;if(ce===3||ce===4){var pe=F.stateNode.containerInfo;if(pe===U||pe.nodeType===8&&pe.parentNode===U)break;if(ce===4)for(ce=F.return;ce!==null;){var we=ce.tag;if((we===3||we===4)&&(we=ce.stateNode.containerInfo,we===U||we.nodeType===8&&we.parentNode===U))return;ce=ce.return}for(;pe!==null;){if(ce=Hs(pe),ce===null)return;if(we=ce.tag,we===5||we===6||we===26||we===27){F=ne=ce;continue e}pe=pe.parentNode}}F=F.return}Mc(function(){var He=ne,ht=Ua(Y),bt=[];e:{var tt=ql.get(B);if(tt!==void 0){var ct=ca,Lt=B;switch(B){case"keypress":if($o(Y)===0)break e;case"keydown":case"keyup":ct=Yc;break;case"focusin":Lt="focus",ct=Ll;break;case"focusout":Lt="blur",ct=Ll;break;case"beforeblur":case"afterblur":ct=Ll;break;case"click":if(Y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ct=Wc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ct=Ah;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ct=Jc;break;case $c:case ls:case Qc:ct=Og;break;case Ql:ct=mo;break;case"scroll":case"scrollend":ct=Pg;break;case"wheel":ct=mh;break;case"copy":case"cut":case"paste":ct=$g;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ct=Kl;break;case"toggle":case"beforetoggle":ct=Qo}var si=(Z&4)!==0,An=!si&&(B==="scroll"||B==="scrollend"),Ke=si?tt!==null?tt+"Capture":null:tt;si=[];for(var Te=He,$e;Te!==null;){var ft=Te;if($e=ft.stateNode,ft=ft.tag,ft!==5&&ft!==26&&ft!==27||$e===null||Ke===null||(ft=ra(Te,Ke),ft!=null&&si.push(Vg(Te,ft,$e))),An)break;Te=Te.return}0<si.length&&(tt=new ct(tt,Lt,null,Y,ht),bt.push({event:tt,listeners:si}))}}if((Z&7)===0){e:{if(tt=B==="mouseover"||B==="pointerover",ct=B==="mouseout"||B==="pointerout",tt&&Y!==Tl&&(Lt=Y.relatedTarget||Y.fromElement)&&(Hs(Lt)||Lt[Js]))break e;if((ct||tt)&&(tt=ht.window===ht?ht:(tt=ht.ownerDocument)?tt.defaultView||tt.parentWindow:window,ct?(Lt=Y.relatedTarget||Y.toElement,ct=He,Lt=Lt?Hs(Lt):null,Lt!==null&&(An=Se(Lt),si=Lt.tag,Lt!==An||si!==5&&si!==27&&si!==6)&&(Lt=null)):(ct=null,Lt=He),ct!==Lt)){if(si=Wc,ft="onMouseLeave",Ke="onMouseEnter",Te="mouse",(B==="pointerout"||B==="pointerover")&&(si=Kl,ft="onPointerLeave",Ke="onPointerEnter",Te="pointer"),An=ct==null?tt:We(ct),$e=Lt==null?tt:We(Lt),tt=new si(ft,Te+"leave",ct,Y,ht),tt.target=An,tt.relatedTarget=$e,ft=null,Hs(ht)===He&&(si=new si(Ke,Te+"enter",Lt,Y,ht),si.target=$e,si.relatedTarget=An,ft=si),An=ft,ct&&Lt)t:{for(si=ct,Ke=Lt,Te=0,$e=si;$e;$e=xc($e))Te++;for($e=0,ft=Ke;ft;ft=xc(ft))$e++;for(;0<Te-$e;)si=xc(si),Te--;for(;0<$e-Te;)Ke=xc(Ke),$e--;for(;Te--;){if(si===Ke||Ke!==null&&si===Ke.alternate)break t;si=xc(si),Ke=xc(Ke)}si=null}else si=null;ct!==null&&rd(bt,tt,ct,si,!1),Lt!==null&&An!==null&&rd(bt,An,Lt,si,!0)}}e:{if(tt=He?We(He):window,ct=tt.nodeName&&tt.nodeName.toLowerCase(),ct==="select"||ct==="input"&&tt.type==="file")var Ht=Dl;else if(Fc(tt))if(kl)Ht=tr;else{Ht=ru;var Ai=bh}else ct=tt.nodeName,!ct||ct.toLowerCase()!=="input"||tt.type!=="checkbox"&&tt.type!=="radio"?He&&ka(He.elementType)&&(Ht=Dl):Ht=rl;if(Ht&&(Ht=Ht(B,He))){os(bt,Ht,Y,ht);break e}Ai&&Ai(B,tt,He),B==="focusout"&&He&&tt.type==="number"&&He.memoizedProps.value!=null&&Zn(tt,"number",tt.value)}switch(Ai=He?We(He):window,B){case"focusin":(Fc(Ai)||Ai.contentEditable==="true")&&(Yr=Ai,Oc=He,pa=null);break;case"focusout":pa=Oc=Yr=null;break;case"mousedown":$l=!0;break;case"contextmenu":case"mouseup":case"dragend":$l=!1,Bs(bt,Y,ht);break;case"selectionchange":if(Ul)break;case"keydown":case"keyup":Bs(bt,Y,ht)}var Pt;if(el)e:{switch(B){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else er?nl(B,Y)&&(jt="onCompositionEnd"):B==="keydown"&&Y.keyCode===229&&(jt="onCompositionStart");jt&&(il&&Y.locale!=="ko"&&(er||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&er&&(Pt=Vc()):(po=ht,Nc="value"in po?po.value:po.textContent,er=!0)),Ai=nh(He,jt),0<Ai.length&&(jt=new Fl(jt,B,null,Y,ht),bt.push({event:jt,listeners:Ai}),Pt?jt.data=Pt:(Pt=zc(Y),Pt!==null&&(jt.data=Pt)))),(Pt=tl?sl(B,Y):Lc(B,Y))&&(jt=nh(He,"onBeforeInput"),0<jt.length&&(Ai=new Fl("onBeforeInput","beforeinput",null,Y,ht),bt.push({event:Ai,listeners:jt}),Ai.data=Pt)),Wd(bt,B,He,Y,ht)}sd(bt,Z)})}function Vg(B,Z,Y){return{instance:B,listener:Z,currentTarget:Y}}function nh(B,Z){for(var Y=Z+"Capture",F=[];B!==null;){var U=B,ne=U.stateNode;U=U.tag,U!==5&&U!==26&&U!==27||ne===null||(U=ra(B,Y),U!=null&&F.unshift(Vg(B,U,ne)),U=ra(B,Z),U!=null&&F.push(Vg(B,U,ne))),B=B.return}return F}function xc(B){if(B===null)return null;do B=B.return;while(B&&B.tag!==5&&B.tag!==27);return B||null}function rd(B,Z,Y,F,U){for(var ne=Z._reactName,ce=[];Y!==null&&Y!==F;){var pe=Y,we=pe.alternate,He=pe.stateNode;if(pe=pe.tag,we!==null&&we===F)break;pe!==5&&pe!==26&&pe!==27||He===null||(we=He,U?(He=ra(Y,ne),He!=null&&ce.unshift(Vg(Y,He,we))):U||(He=ra(Y,ne),He!=null&&ce.push(Vg(Y,He,we)))),Y=Y.return}ce.length!==0&&B.push({event:Z,listeners:ce})}var Jd=/\r\n?/g,Hd=/\u0000|\uFFFD/g;function ad(B){return(typeof B=="string"?B:""+B).replace(Jd,`
`).replace(Hd,"")}function ld(B,Z){return Z=ad(Z),ad(B)===Z}function sh(){}function Fi(B,Z,Y,F,U,ne){switch(Y){case"children":typeof F=="string"?Z==="body"||Z==="textarea"&&F===""||kn(B,F):(typeof F=="number"||typeof F=="bigint")&&Z!=="body"&&kn(B,""+F);break;case"className":Hi(B,"class",F);break;case"tabIndex":Hi(B,"tabindex",F);break;case"dir":case"role":case"viewBox":case"width":case"height":Hi(B,Y,F);break;case"style":_c(B,F,ne);break;case"data":if(Z!=="object"){Hi(B,"data",F);break}case"src":case"href":if(F===""&&(Z!=="a"||Y!=="href")){B.removeAttribute(Y);break}if(F==null||typeof F=="function"||typeof F=="symbol"||typeof F=="boolean"){B.removeAttribute(Y);break}F=Oa(""+F),B.setAttribute(Y,F);break;case"action":case"formAction":if(typeof F=="function"){B.setAttribute(Y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof ne=="function"&&(Y==="formAction"?(Z!=="input"&&Fi(B,Z,"name",U.name,U,null),Fi(B,Z,"formEncType",U.formEncType,U,null),Fi(B,Z,"formMethod",U.formMethod,U,null),Fi(B,Z,"formTarget",U.formTarget,U,null)):(Fi(B,Z,"encType",U.encType,U,null),Fi(B,Z,"method",U.method,U,null),Fi(B,Z,"target",U.target,U,null)));if(F==null||typeof F=="symbol"||typeof F=="boolean"){B.removeAttribute(Y);break}F=Oa(""+F),B.setAttribute(Y,F);break;case"onClick":F!=null&&(B.onclick=sh);break;case"onScroll":F!=null&&Gi("scroll",B);break;case"onScrollEnd":F!=null&&Gi("scrollend",B);break;case"dangerouslySetInnerHTML":if(F!=null){if(typeof F!="object"||!("__html"in F))throw Error(u(61));if(Y=F.__html,Y!=null){if(U.children!=null)throw Error(u(60));B.innerHTML=Y}}break;case"multiple":B.multiple=F&&typeof F!="function"&&typeof F!="symbol";break;case"muted":B.muted=F&&typeof F!="function"&&typeof F!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(F==null||typeof F=="function"||typeof F=="boolean"||typeof F=="symbol"){B.removeAttribute("xlink:href");break}Y=Oa(""+F),B.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":F!=null&&typeof F!="function"&&typeof F!="symbol"?B.setAttribute(Y,""+F):B.removeAttribute(Y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":F&&typeof F!="function"&&typeof F!="symbol"?B.setAttribute(Y,""):B.removeAttribute(Y);break;case"capture":case"download":F===!0?B.setAttribute(Y,""):F!==!1&&F!=null&&typeof F!="function"&&typeof F!="symbol"?B.setAttribute(Y,F):B.removeAttribute(Y);break;case"cols":case"rows":case"size":case"span":F!=null&&typeof F!="function"&&typeof F!="symbol"&&!isNaN(F)&&1<=F?B.setAttribute(Y,F):B.removeAttribute(Y);break;case"rowSpan":case"start":F==null||typeof F=="function"||typeof F=="symbol"||isNaN(F)?B.removeAttribute(Y):B.setAttribute(Y,F);break;case"popover":Gi("beforetoggle",B),Gi("toggle",B),Ii(B,"popover",F);break;case"xlinkActuate":mi(B,"http://www.w3.org/1999/xlink","xlink:actuate",F);break;case"xlinkArcrole":mi(B,"http://www.w3.org/1999/xlink","xlink:arcrole",F);break;case"xlinkRole":mi(B,"http://www.w3.org/1999/xlink","xlink:role",F);break;case"xlinkShow":mi(B,"http://www.w3.org/1999/xlink","xlink:show",F);break;case"xlinkTitle":mi(B,"http://www.w3.org/1999/xlink","xlink:title",F);break;case"xlinkType":mi(B,"http://www.w3.org/1999/xlink","xlink:type",F);break;case"xmlBase":mi(B,"http://www.w3.org/XML/1998/namespace","xml:base",F);break;case"xmlLang":mi(B,"http://www.w3.org/XML/1998/namespace","xml:lang",F);break;case"xmlSpace":mi(B,"http://www.w3.org/XML/1998/namespace","xml:space",F);break;case"is":Ii(B,"is",F);break;case"innerText":case"textContent":break;default:(!(2<Y.length)||Y[0]!=="o"&&Y[0]!=="O"||Y[1]!=="n"&&Y[1]!=="N")&&(Y=Fg.get(Y)||Y,Ii(B,Y,F))}}function Yh(B,Z,Y,F,U,ne){switch(Y){case"style":_c(B,F,ne);break;case"dangerouslySetInnerHTML":if(F!=null){if(typeof F!="object"||!("__html"in F))throw Error(u(61));if(Y=F.__html,Y!=null){if(U.children!=null)throw Error(u(60));B.innerHTML=Y}}break;case"children":typeof F=="string"?kn(B,F):(typeof F=="number"||typeof F=="bigint")&&kn(B,""+F);break;case"onScroll":F!=null&&Gi("scroll",B);break;case"onScrollEnd":F!=null&&Gi("scrollend",B);break;case"onClick":F!=null&&(B.onclick=sh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!At.hasOwnProperty(Y))e:{if(Y[0]==="o"&&Y[1]==="n"&&(U=Y.endsWith("Capture"),Z=Y.slice(2,U?Y.length-7:void 0),ne=B[Qt]||null,ne=ne!=null?ne[Y]:null,typeof ne=="function"&&B.removeEventListener(Z,ne,U),typeof F=="function")){typeof ne!="function"&&ne!==null&&(Y in B?B[Y]=null:B.hasAttribute(Y)&&B.removeAttribute(Y)),B.addEventListener(Z,F,U);break e}Y in B?B[Y]=F:F===!0?B.setAttribute(Y,""):Ii(B,Y,F)}}}function ns(B,Z,Y){switch(Z){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gi("error",B),Gi("load",B);var F=!1,U=!1,ne;for(ne in Y)if(Y.hasOwnProperty(ne)){var ce=Y[ne];if(ce!=null)switch(ne){case"src":F=!0;break;case"srcSet":U=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,Z));default:Fi(B,Z,ne,ce,Y,null)}}U&&Fi(B,Z,"srcSet",Y.srcSet,Y,null),F&&Fi(B,Z,"src",Y.src,Y,null);return;case"input":Gi("invalid",B);var pe=ne=ce=U=null,we=null,He=null;for(F in Y)if(Y.hasOwnProperty(F)){var ht=Y[F];if(ht!=null)switch(F){case"name":U=ht;break;case"type":ce=ht;break;case"checked":we=ht;break;case"defaultChecked":He=ht;break;case"value":ne=ht;break;case"defaultValue":pe=ht;break;case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(u(137,Z));break;default:Fi(B,Z,F,ht,Y,null)}}En(B,ne,pe,we,He,ce,U,!1),fi(B);return;case"select":Gi("invalid",B),F=ce=ne=null;for(U in Y)if(Y.hasOwnProperty(U)&&(pe=Y[U],pe!=null))switch(U){case"value":ne=pe;break;case"defaultValue":ce=pe;break;case"multiple":F=pe;default:Fi(B,Z,U,pe,Y,null)}Z=ne,Y=ce,B.multiple=!!F,Z!=null?Qi(B,!!F,Z,!1):Y!=null&&Qi(B,!!F,Y,!0);return;case"textarea":Gi("invalid",B),ne=U=F=null;for(ce in Y)if(Y.hasOwnProperty(ce)&&(pe=Y[ce],pe!=null))switch(ce){case"value":F=pe;break;case"defaultValue":U=pe;break;case"children":ne=pe;break;case"dangerouslySetInnerHTML":if(pe!=null)throw Error(u(91));break;default:Fi(B,Z,ce,pe,Y,null)}zs(B,F,U,ne),fi(B);return;case"option":for(we in Y)if(Y.hasOwnProperty(we)&&(F=Y[we],F!=null))switch(we){case"selected":B.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:Fi(B,Z,we,F,Y,null)}return;case"dialog":Gi("cancel",B),Gi("close",B);break;case"iframe":case"object":Gi("load",B);break;case"video":case"audio":for(F=0;F<Ng.length;F++)Gi(Ng[F],B);break;case"image":Gi("error",B),Gi("load",B);break;case"details":Gi("toggle",B);break;case"embed":case"source":case"link":Gi("error",B),Gi("load",B);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(He in Y)if(Y.hasOwnProperty(He)&&(F=Y[He],F!=null))switch(He){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,Z));default:Fi(B,Z,He,F,Y,null)}return;default:if(ka(Z)){for(ht in Y)Y.hasOwnProperty(ht)&&(F=Y[ht],F!==void 0&&Yh(B,Z,ht,F,Y,void 0));return}}for(pe in Y)Y.hasOwnProperty(pe)&&(F=Y[pe],F!=null&&Fi(B,Z,pe,F,Y,null))}function zd(B,Z,Y,F){switch(Z){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var U=null,ne=null,ce=null,pe=null,we=null,He=null,ht=null;for(ct in Y){var bt=Y[ct];if(Y.hasOwnProperty(ct)&&bt!=null)switch(ct){case"checked":break;case"value":break;case"defaultValue":we=bt;default:F.hasOwnProperty(ct)||Fi(B,Z,ct,null,F,bt)}}for(var tt in F){var ct=F[tt];if(bt=Y[tt],F.hasOwnProperty(tt)&&(ct!=null||bt!=null))switch(tt){case"type":ne=ct;break;case"name":U=ct;break;case"checked":He=ct;break;case"defaultChecked":ht=ct;break;case"value":ce=ct;break;case"defaultValue":pe=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(u(137,Z));break;default:ct!==bt&&Fi(B,Z,tt,ct,F,bt)}}Zi(B,ce,pe,we,He,ht,ne,U);return;case"select":ct=ce=pe=tt=null;for(ne in Y)if(we=Y[ne],Y.hasOwnProperty(ne)&&we!=null)switch(ne){case"value":break;case"multiple":ct=we;default:F.hasOwnProperty(ne)||Fi(B,Z,ne,null,F,we)}for(U in F)if(ne=F[U],we=Y[U],F.hasOwnProperty(U)&&(ne!=null||we!=null))switch(U){case"value":tt=ne;break;case"defaultValue":pe=ne;break;case"multiple":ce=ne;default:ne!==we&&Fi(B,Z,U,ne,F,we)}Z=pe,Y=ce,F=ct,tt!=null?Qi(B,!!Y,tt,!1):!!F!=!!Y&&(Z!=null?Qi(B,!!Y,Z,!0):Qi(B,!!Y,Y?[]:"",!1));return;case"textarea":ct=tt=null;for(pe in Y)if(U=Y[pe],Y.hasOwnProperty(pe)&&U!=null&&!F.hasOwnProperty(pe))switch(pe){case"value":break;case"children":break;default:Fi(B,Z,pe,null,F,U)}for(ce in F)if(U=F[ce],ne=Y[ce],F.hasOwnProperty(ce)&&(U!=null||ne!=null))switch(ce){case"value":tt=U;break;case"defaultValue":ct=U;break;case"children":break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(u(91));break;default:U!==ne&&Fi(B,Z,ce,U,F,ne)}Sn(B,tt,ct);return;case"option":for(var Lt in Y)if(tt=Y[Lt],Y.hasOwnProperty(Lt)&&tt!=null&&!F.hasOwnProperty(Lt))switch(Lt){case"selected":B.selected=!1;break;default:Fi(B,Z,Lt,null,F,tt)}for(we in F)if(tt=F[we],ct=Y[we],F.hasOwnProperty(we)&&tt!==ct&&(tt!=null||ct!=null))switch(we){case"selected":B.selected=tt&&typeof tt!="function"&&typeof tt!="symbol";break;default:Fi(B,Z,we,tt,F,ct)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var si in Y)tt=Y[si],Y.hasOwnProperty(si)&&tt!=null&&!F.hasOwnProperty(si)&&Fi(B,Z,si,null,F,tt);for(He in F)if(tt=F[He],ct=Y[He],F.hasOwnProperty(He)&&tt!==ct&&(tt!=null||ct!=null))switch(He){case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(u(137,Z));break;default:Fi(B,Z,He,tt,F,ct)}return;default:if(ka(Z)){for(var An in Y)tt=Y[An],Y.hasOwnProperty(An)&&tt!==void 0&&!F.hasOwnProperty(An)&&Yh(B,Z,An,void 0,F,tt);for(ht in F)tt=F[ht],ct=Y[ht],!F.hasOwnProperty(ht)||tt===ct||tt===void 0&&ct===void 0||Yh(B,Z,ht,tt,F,ct);return}}for(var Ke in Y)tt=Y[Ke],Y.hasOwnProperty(Ke)&&tt!=null&&!F.hasOwnProperty(Ke)&&Fi(B,Z,Ke,null,F,tt);for(bt in F)tt=F[bt],ct=Y[bt],!F.hasOwnProperty(bt)||tt===ct||tt==null&&ct==null||Fi(B,Z,bt,tt,F,ct)}var Th=null,Jh=null;function oh(B){return B.nodeType===9?B:B.ownerDocument}function cd(B){switch(B){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gd(B,Z){if(B===0)switch(Z){case"svg":return 1;case"math":return 2;default:return 0}return B===1&&Z==="foreignObject"?0:B}function Hh(B,Z){return B==="textarea"||B==="noscript"||typeof Z.children=="string"||typeof Z.children=="number"||typeof Z.children=="bigint"||typeof Z.dangerouslySetInnerHTML=="object"&&Z.dangerouslySetInnerHTML!==null&&Z.dangerouslySetInnerHTML.__html!=null}var zh=null;function Ld(){var B=window.event;return B&&B.type==="popstate"?B===zh?!1:(zh=B,!0):(zh=null,!1)}var ud=typeof setTimeout=="function"?setTimeout:void 0,Fd=typeof clearTimeout=="function"?clearTimeout:void 0,hd=typeof Promise=="function"?Promise:void 0,Kd=typeof queueMicrotask=="function"?queueMicrotask:typeof hd<"u"?function(B){return hd.resolve(null).then(B).catch(Pd)}:ud;function Pd(B){setTimeout(function(){throw B})}function Lh(B,Z){var Y=Z,F=0;do{var U=Y.nextSibling;if(B.removeChild(Y),U&&U.nodeType===8)if(Y=U.data,Y==="/$"){if(F===0){B.removeChild(U),Lg(Z);return}F--}else Y!=="$"&&Y!=="$?"&&Y!=="$!"||F++;Y=U}while(Y);Lg(Z)}function Fh(B){var Z=B.firstChild;for(Z&&Z.nodeType===10&&(Z=Z.nextSibling);Z;){var Y=Z;switch(Z=Z.nextSibling,Y.nodeName){case"HTML":case"HEAD":case"BODY":Fh(Y),Mr(Y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(Y.rel.toLowerCase()==="stylesheet")continue}B.removeChild(Y)}}function Dd(B,Z,Y,F){for(;B.nodeType===1;){var U=Y;if(B.nodeName.toLowerCase()!==Z.toLowerCase()){if(!F&&(B.nodeName!=="INPUT"||B.type!=="hidden"))break}else if(F){if(!B[fo])switch(Z){case"meta":if(!B.hasAttribute("itemprop"))break;return B;case"link":if(ne=B.getAttribute("rel"),ne==="stylesheet"&&B.hasAttribute("data-precedence"))break;if(ne!==U.rel||B.getAttribute("href")!==(U.href==null?null:U.href)||B.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin)||B.getAttribute("title")!==(U.title==null?null:U.title))break;return B;case"style":if(B.hasAttribute("data-precedence"))break;return B;case"script":if(ne=B.getAttribute("src"),(ne!==(U.src==null?null:U.src)||B.getAttribute("type")!==(U.type==null?null:U.type)||B.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin))&&ne&&B.hasAttribute("async")&&!B.hasAttribute("itemprop"))break;return B;default:return B}}else if(Z==="input"&&B.type==="hidden"){var ne=U.name==null?null:""+U.name;if(U.type==="hidden"&&B.getAttribute("name")===ne)return B}else return B;if(B=Oo(B.nextSibling),B===null)break}return null}function kd(B,Z,Y){if(Z==="")return null;for(;B.nodeType!==3;)if((B.nodeType!==1||B.nodeName!=="INPUT"||B.type!=="hidden")&&!Y||(B=Oo(B.nextSibling),B===null))return null;return B}function Oo(B){for(;B!=null;B=B.nextSibling){var Z=B.nodeType;if(Z===1||Z===3)break;if(Z===8){if(Z=B.data,Z==="$"||Z==="$!"||Z==="$?"||Z==="F!"||Z==="F")break;if(Z==="/$")return null}}return B}function dd(B){B=B.previousSibling;for(var Z=0;B;){if(B.nodeType===8){var Y=B.data;if(Y==="$"||Y==="$!"||Y==="$?"){if(Z===0)return B;Z--}else Y==="/$"&&Z++}B=B.previousSibling}return null}function Cd(B,Z,Y){switch(Z=oh(Y),B){case"html":if(B=Z.documentElement,!B)throw Error(u(452));return B;case"head":if(B=Z.head,!B)throw Error(u(453));return B;case"body":if(B=Z.body,!B)throw Error(u(454));return B;default:throw Error(u(451))}}var Io=new Map,Id=new Set;function rh(B){return typeof B.getRootNode=="function"?B.getRootNode():B.ownerDocument}var oa=me.d;me.d={f:Od,r:Ud,D:$d,C:jd,L:Qd,m:qd,X:tC,S:eC,M:iC};function Od(){var B=oa.f(),Z=ia();return B||Z}function Ud(B){var Z=fe(B);Z!==null&&Z.tag===5&&Z.type==="form"?Eu(Z):oa.r(B)}var Rc=typeof document>"u"?null:document;function fd(B,Z,Y){var F=Rc;if(F&&typeof Z=="string"&&Z){var U=bn(Z);U='link[rel="'+B+'"][href="'+U+'"]',typeof Y=="string"&&(U+='[crossorigin="'+Y+'"]'),Id.has(U)||(Id.add(U),B={rel:B,crossOrigin:Y,href:Z},F.querySelector(U)===null&&(Z=F.createElement("link"),ns(Z,"link",B),ke(Z),F.head.appendChild(Z)))}}function $d(B){oa.D(B),fd("dns-prefetch",B,null)}function jd(B,Z){oa.C(B,Z),fd("preconnect",B,Z)}function Qd(B,Z,Y){oa.L(B,Z,Y);var F=Rc;if(F&&B&&Z){var U='link[rel="preload"][as="'+bn(Z)+'"]';Z==="image"&&Y&&Y.imageSrcSet?(U+='[imagesrcset="'+bn(Y.imageSrcSet)+'"]',typeof Y.imageSizes=="string"&&(U+='[imagesizes="'+bn(Y.imageSizes)+'"]')):U+='[href="'+bn(B)+'"]';var ne=U;switch(Z){case"style":ne=Zc(B);break;case"script":ne=wc(B)}Io.has(ne)||(B=se({rel:"preload",href:Z==="image"&&Y&&Y.imageSrcSet?void 0:B,as:Z},Y),Io.set(ne,B),F.querySelector(U)!==null||Z==="style"&&F.querySelector(Wg(ne))||Z==="script"&&F.querySelector(Eg(ne))||(Z=F.createElement("link"),ns(Z,"link",B),ke(Z),F.head.appendChild(Z)))}}function qd(B,Z){oa.m(B,Z);var Y=Rc;if(Y&&B){var F=Z&&typeof Z.as=="string"?Z.as:"script",U='link[rel="modulepreload"][as="'+bn(F)+'"][href="'+bn(B)+'"]',ne=U;switch(F){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":ne=wc(B)}if(!Io.has(ne)&&(B=se({rel:"modulepreload",href:B},Z),Io.set(ne,B),Y.querySelector(U)===null)){switch(F){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(Y.querySelector(Eg(ne)))return}F=Y.createElement("link"),ns(F,"link",B),ke(F),Y.head.appendChild(F)}}}function eC(B,Z,Y){oa.S(B,Z,Y);var F=Rc;if(F&&B){var U=je(F).hoistableStyles,ne=Zc(B);Z=Z||"default";var ce=U.get(ne);if(!ce){var pe={loading:0,preload:null};if(ce=F.querySelector(Wg(ne)))pe.loading=5;else{B=se({rel:"stylesheet",href:B,"data-precedence":Z},Y),(Y=Io.get(ne))&&Kh(B,Y);var we=ce=F.createElement("link");ke(we),ns(we,"link",B),we._p=new Promise(function(He,ht){we.onload=He,we.onerror=ht}),we.addEventListener("load",function(){pe.loading|=1}),we.addEventListener("error",function(){pe.loading|=2}),pe.loading|=4,ah(ce,Z,F)}ce={type:"stylesheet",instance:ce,count:1,state:pe},U.set(ne,ce)}}}function tC(B,Z){oa.X(B,Z);var Y=Rc;if(Y&&B){var F=je(Y).hoistableScripts,U=wc(B),ne=F.get(U);ne||(ne=Y.querySelector(Eg(U)),ne||(B=se({src:B,async:!0},Z),(Z=Io.get(U))&&Ph(B,Z),ne=Y.createElement("script"),ke(ne),ns(ne,"link",B),Y.head.appendChild(ne)),ne={type:"script",instance:ne,count:1,state:null},F.set(U,ne))}}function iC(B,Z){oa.M(B,Z);var Y=Rc;if(Y&&B){var F=je(Y).hoistableScripts,U=wc(B),ne=F.get(U);ne||(ne=Y.querySelector(Eg(U)),ne||(B=se({src:B,async:!0,type:"module"},Z),(Z=Io.get(U))&&Ph(B,Z),ne=Y.createElement("script"),ke(ne),ns(ne,"link",B),Y.head.appendChild(ne)),ne={type:"script",instance:ne,count:1,state:null},F.set(U,ne))}}function pd(B,Z,Y,F){var U=(U=Ue.current)?rh(U):null;if(!U)throw Error(u(446));switch(B){case"meta":case"title":return null;case"style":return typeof Y.precedence=="string"&&typeof Y.href=="string"?(Z=Zc(Y.href),Y=je(U).hoistableStyles,F=Y.get(Z),F||(F={type:"style",instance:null,count:0,state:null},Y.set(Z,F)),F):{type:"void",instance:null,count:0,state:null};case"link":if(Y.rel==="stylesheet"&&typeof Y.href=="string"&&typeof Y.precedence=="string"){B=Zc(Y.href);var ne=je(U).hoistableStyles,ce=ne.get(B);if(ce||(U=U.ownerDocument||U,ce={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},ne.set(B,ce),(ne=U.querySelector(Wg(B)))&&!ne._p&&(ce.instance=ne,ce.state.loading=5),Io.has(B)||(Y={rel:"preload",as:"style",href:Y.href,crossOrigin:Y.crossOrigin,integrity:Y.integrity,media:Y.media,hrefLang:Y.hrefLang,referrerPolicy:Y.referrerPolicy},Io.set(B,Y),ne||nC(U,B,Y,ce.state))),Z&&F===null)throw Error(u(528,""));return ce}if(Z&&F!==null)throw Error(u(529,""));return null;case"script":return Z=Y.async,Y=Y.src,typeof Y=="string"&&Z&&typeof Z!="function"&&typeof Z!="symbol"?(Z=wc(Y),Y=je(U).hoistableScripts,F=Y.get(Z),F||(F={type:"script",instance:null,count:0,state:null},Y.set(Z,F)),F):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,B))}}function Zc(B){return'href="'+bn(B)+'"'}function Wg(B){return'link[rel="stylesheet"]['+B+"]"}function Ad(B){return se({},B,{"data-precedence":B.precedence,precedence:null})}function nC(B,Z,Y,F){B.querySelector('link[rel="preload"][as="style"]['+Z+"]")?F.loading=1:(Z=B.createElement("link"),F.preload=Z,Z.addEventListener("load",function(){return F.loading|=1}),Z.addEventListener("error",function(){return F.loading|=2}),ns(Z,"link",Y),ke(Z),B.head.appendChild(Z))}function wc(B){return'[src="'+bn(B)+'"]'}function Eg(B){return"script[async]"+B}function md(B,Z,Y){if(Z.count++,Z.instance===null)switch(Z.type){case"style":var F=B.querySelector('style[data-href~="'+bn(Y.href)+'"]');if(F)return Z.instance=F,ke(F),F;var U=se({},Y,{"data-href":Y.href,"data-precedence":Y.precedence,href:null,precedence:null});return F=(B.ownerDocument||B).createElement("style"),ke(F),ns(F,"style",U),ah(F,Y.precedence,B),Z.instance=F;case"stylesheet":U=Zc(Y.href);var ne=B.querySelector(Wg(U));if(ne)return Z.state.loading|=4,Z.instance=ne,ke(ne),ne;F=Ad(Y),(U=Io.get(U))&&Kh(F,U),ne=(B.ownerDocument||B).createElement("link"),ke(ne);var ce=ne;return ce._p=new Promise(function(pe,we){ce.onload=pe,ce.onerror=we}),ns(ne,"link",F),Z.state.loading|=4,ah(ne,Y.precedence,B),Z.instance=ne;case"script":return ne=wc(Y.src),(U=B.querySelector(Eg(ne)))?(Z.instance=U,ke(U),U):(F=Y,(U=Io.get(ne))&&(F=se({},Y),Ph(F,U)),B=B.ownerDocument||B,U=B.createElement("script"),ke(U),ns(U,"link",F),B.head.appendChild(U),Z.instance=U);case"void":return null;default:throw Error(u(443,Z.type))}else Z.type==="stylesheet"&&(Z.state.loading&4)===0&&(F=Z.instance,Z.state.loading|=4,ah(F,Y.precedence,B));return Z.instance}function ah(B,Z,Y){for(var F=Y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),U=F.length?F[F.length-1]:null,ne=U,ce=0;ce<F.length;ce++){var pe=F[ce];if(pe.dataset.precedence===Z)ne=pe;else if(ne!==U)break}ne?ne.parentNode.insertBefore(B,ne.nextSibling):(Z=Y.nodeType===9?Y.head:Y,Z.insertBefore(B,Z.firstChild))}function Kh(B,Z){B.crossOrigin==null&&(B.crossOrigin=Z.crossOrigin),B.referrerPolicy==null&&(B.referrerPolicy=Z.referrerPolicy),B.title==null&&(B.title=Z.title)}function Ph(B,Z){B.crossOrigin==null&&(B.crossOrigin=Z.crossOrigin),B.referrerPolicy==null&&(B.referrerPolicy=Z.referrerPolicy),B.integrity==null&&(B.integrity=Z.integrity)}var lh=null;function bd(B,Z,Y){if(lh===null){var F=new Map,U=lh=new Map;U.set(Y,F)}else U=lh,F=U.get(Y),F||(F=new Map,U.set(Y,F));if(F.has(B))return F;for(F.set(B,null),Y=Y.getElementsByTagName(B),U=0;U<Y.length;U++){var ne=Y[U];if(!(ne[fo]||ne[Ji]||B==="link"&&ne.getAttribute("rel")==="stylesheet")&&ne.namespaceURI!=="http://www.w3.org/2000/svg"){var ce=ne.getAttribute(Z)||"";ce=B+ce;var pe=F.get(ce);pe?pe.push(ne):F.set(ce,[ne])}}return F}function yd(B,Z,Y){B=B.ownerDocument||B,B.head.insertBefore(Y,Z==="title"?B.querySelector("head > title"):null)}function sC(B,Z,Y){if(Y===1||Z.itemProp!=null)return!1;switch(B){case"meta":case"title":return!0;case"style":if(typeof Z.precedence!="string"||typeof Z.href!="string"||Z.href==="")break;return!0;case"link":if(typeof Z.rel!="string"||typeof Z.href!="string"||Z.href===""||Z.onLoad||Z.onError)break;switch(Z.rel){case"stylesheet":return B=Z.disabled,typeof Z.precedence=="string"&&B==null;default:return!0}case"script":if(Z.async&&typeof Z.async!="function"&&typeof Z.async!="symbol"&&!Z.onLoad&&!Z.onError&&Z.src&&typeof Z.src=="string")return!0}return!1}function Gd(B){return!(B.type==="stylesheet"&&(B.state.loading&3)===0)}var Yg=null;function oC(){}function rC(B,Z,Y){if(Yg===null)throw Error(u(475));var F=Yg;if(Z.type==="stylesheet"&&(typeof Y.media!="string"||matchMedia(Y.media).matches!==!1)&&(Z.state.loading&4)===0){if(Z.instance===null){var U=Zc(Y.href),ne=B.querySelector(Wg(U));if(ne){B=ne._p,B!==null&&typeof B=="object"&&typeof B.then=="function"&&(F.count++,F=ch.bind(F),B.then(F,F)),Z.state.loading|=4,Z.instance=ne,ke(ne);return}ne=B.ownerDocument||B,Y=Ad(Y),(U=Io.get(U))&&Kh(Y,U),ne=ne.createElement("link"),ke(ne);var ce=ne;ce._p=new Promise(function(pe,we){ce.onload=pe,ce.onerror=we}),ns(ne,"link",Y),Z.instance=ne}F.stylesheets===null&&(F.stylesheets=new Map),F.stylesheets.set(Z,B),(B=Z.state.preload)&&(Z.state.loading&3)===0&&(F.count++,Z=ch.bind(F),B.addEventListener("load",Z),B.addEventListener("error",Z))}}function aC(){if(Yg===null)throw Error(u(475));var B=Yg;return B.stylesheets&&B.count===0&&Dh(B,B.stylesheets),0<B.count?function(Z){var Y=setTimeout(function(){if(B.stylesheets&&Dh(B,B.stylesheets),B.unsuspend){var F=B.unsuspend;B.unsuspend=null,F()}},6e4);return B.unsuspend=Z,function(){B.unsuspend=null,clearTimeout(Y)}}:null}function ch(){if(this.count--,this.count===0){if(this.stylesheets)Dh(this,this.stylesheets);else if(this.unsuspend){var B=this.unsuspend;this.unsuspend=null,B()}}}var gh=null;function Dh(B,Z){B.stylesheets=null,B.unsuspend!==null&&(B.count++,gh=new Map,Z.forEach(lC,B),gh=null,ch.call(B))}function lC(B,Z){if(!(Z.state.loading&4)){var Y=gh.get(B);if(Y)var F=Y.get(null);else{Y=new Map,gh.set(B,Y);for(var U=B.querySelectorAll("link[data-precedence],style[data-precedence]"),ne=0;ne<U.length;ne++){var ce=U[ne];(ce.nodeName==="LINK"||ce.getAttribute("media")!=="not all")&&(Y.set(ce.dataset.precedence,ce),F=ce)}F&&Y.set(null,F)}U=Z.instance,ce=U.getAttribute("data-precedence"),ne=Y.get(ce)||F,ne===F&&Y.set(null,U),Y.set(ce,U),this.count++,F=ch.bind(this),U.addEventListener("load",F),U.addEventListener("error",F),ne?ne.parentNode.insertBefore(U,ne.nextSibling):(B=B.nodeType===9?B.head:B,B.insertBefore(U,B.firstChild)),Z.state.loading|=4}}var Tg={$$typeof:M,Provider:null,Consumer:null,_currentValue:xe,_currentValue2:xe,_threadCount:0};function cC(B,Z,Y,F,U,ne,ce,pe){this.tag=1,this.containerInfo=B,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gi(0),this.hiddenUpdates=gi(null),this.identifierPrefix=F,this.onUncaughtError=U,this.onCaughtError=ne,this.onRecoverableError=ce,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function vd(B,Z,Y,F,U,ne,ce,pe,we,He,ht,bt){return B=new cC(B,Z,Y,ce,pe,we,He,bt),Z=1,ne===!0&&(Z|=24),ne=ln(3,null,null,Z),B.current=ne,ne.stateNode=B,Z=ig(),Z.refCount++,B.pooledCache=Z,Z.refCount++,ne.memoizedState={element:F,isDehydrated:Y,cache:Z},jn(ne),B}function Bd(B){return B?(B=nr,B):nr}function Sd(B,Z,Y,F,U,ne){U=Bd(U),F.context===null?F.context=U:F.pendingContext=U,F=bs(Z),F.payload={element:Y},ne=ne===void 0?null:ne,ne!==null&&(F.callback=ne),Y=ys(B,F,Z),Y!==null&&(pn(Y,B,Z),yr(Y,B,Z))}function Xd(B,Z){if(B=B.memoizedState,B!==null&&B.dehydrated!==null){var Y=B.retryLane;B.retryLane=Y!==0&&Y<Z?Y:Z}}function kh(B,Z){Xd(B,Z),(B=B.alternate)&&Xd(B,Z)}function xd(B){if(B.tag===13){var Z=So(B,67108864);Z!==null&&pn(Z,B,67108864),kh(B,67108864)}}var uh=!0;function gC(B,Z,Y,F){var U=te.T;te.T=null;var ne=me.p;try{me.p=2,Oh(B,Z,Y,F)}finally{me.p=ne,te.T=U}}function uC(B,Z,Y,F){var U=te.T;te.T=null;var ne=me.p;try{me.p=8,Oh(B,Z,Y,F)}finally{me.p=ne,te.T=U}}function Oh(B,Z,Y,F){if(uh){var U=Uh(F);if(U===null)Eh(B,Z,F,hh,Y),Zd(B,F);else if(dC(U,B,Z,Y,F))F.stopPropagation();else if(Zd(B,F),Z&4&&-1<hC.indexOf(B)){for(;U!==null;){var ne=fe(U);if(ne!==null)switch(ne.tag){case 3:if(ne=ne.stateNode,ne.current.memoizedState.isDehydrated){var ce=yt(ne.pendingLanes);if(ce!==0){var pe=ne;for(pe.pendingLanes|=2,pe.entangledLanes|=2;ce;){var we=1<<31-Ye(ce);pe.entanglements[1]|=we,ce&=~we}Yi(ne),(ti&6)===0&&(di=nt()+500,pi(0))}}break;case 13:pe=So(ne,2),pe!==null&&pn(pe,ne,2),ia(),kh(ne,2)}if(ne=Uh(F),ne===null&&Eh(B,Z,F,hh,Y),ne===U)break;U=ne}U!==null&&F.stopPropagation()}else Eh(B,Z,F,null,Y)}}function Uh(B){return B=Ua(B),$h(B)}var hh=null;function $h(B){if(hh=null,B=Hs(B),B!==null){var Z=Se(B);if(Z===null)B=null;else{var Y=Z.tag;if(Y===13){if(B=Ze(Z),B!==null)return B;B=null}else if(Y===3){if(Z.stateNode.current.memoizedState.isDehydrated)return Z.tag===3?Z.stateNode.containerInfo:null;B=null}else Z!==B&&(B=null)}}return hh=B,null}function Rd(B){switch(B){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(dt()){case ze:return 2;case rt:return 8;case Rt:case Mt:return 32;case Yt:return 268435456;default:return 32}default:return 32}}var jh=!1,za=null,La=null,Fa=null,Jg=new Map,Hg=new Map,Ka=[],hC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zd(B,Z){switch(B){case"focusin":case"focusout":za=null;break;case"dragenter":case"dragleave":La=null;break;case"mouseover":case"mouseout":Fa=null;break;case"pointerover":case"pointerout":Jg.delete(Z.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hg.delete(Z.pointerId)}}function zg(B,Z,Y,F,U,ne){return B===null||B.nativeEvent!==ne?(B={blockedOn:Z,domEventName:Y,eventSystemFlags:F,nativeEvent:ne,targetContainers:[U]},Z!==null&&(Z=fe(Z),Z!==null&&xd(Z)),B):(B.eventSystemFlags|=F,Z=B.targetContainers,U!==null&&Z.indexOf(U)===-1&&Z.push(U),B)}function dC(B,Z,Y,F,U){switch(Z){case"focusin":return za=zg(za,B,Z,Y,F,U),!0;case"dragenter":return La=zg(La,B,Z,Y,F,U),!0;case"mouseover":return Fa=zg(Fa,B,Z,Y,F,U),!0;case"pointerover":var ne=U.pointerId;return Jg.set(ne,zg(Jg.get(ne)||null,B,Z,Y,F,U)),!0;case"gotpointercapture":return ne=U.pointerId,Hg.set(ne,zg(Hg.get(ne)||null,B,Z,Y,F,U)),!0}return!1}function wd(B){var Z=Hs(B.target);if(Z!==null){var Y=Se(Z);if(Y!==null){if(Z=Y.tag,Z===13){if(Z=Ze(Y),Z!==null){B.blockedOn=Z,ss(B.priority,function(){if(Y.tag===13){var F=ts(),U=So(Y,F);U!==null&&pn(U,Y,F),kh(Y,F)}});return}}else if(Z===3&&Y.stateNode.current.memoizedState.isDehydrated){B.blockedOn=Y.tag===3?Y.stateNode.containerInfo:null;return}}}B.blockedOn=null}function dh(B){if(B.blockedOn!==null)return!1;for(var Z=B.targetContainers;0<Z.length;){var Y=Uh(B.nativeEvent);if(Y===null){Y=B.nativeEvent;var F=new Y.constructor(Y.type,Y);Tl=F,Y.target.dispatchEvent(F),Tl=null}else return Z=fe(Y),Z!==null&&xd(Z),B.blockedOn=Y,!1;Z.shift()}return!0}function _d(B,Z,Y){dh(B)&&Y.delete(Z)}function CC(){jh=!1,za!==null&&dh(za)&&(za=null),La!==null&&dh(La)&&(La=null),Fa!==null&&dh(Fa)&&(Fa=null),Jg.forEach(_d),Hg.forEach(_d)}function Ch(B,Z){B.blockedOn===Z&&(B.blockedOn=null,jh||(jh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,CC)))}var Ih=null;function Md(B){Ih!==B&&(Ih=B,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Ih===B&&(Ih=null);for(var Z=0;Z<B.length;Z+=3){var Y=B[Z],F=B[Z+1],U=B[Z+2];if(typeof F!="function"){if($h(F||Y)===null)continue;break}var ne=fe(Y);ne!==null&&(B.splice(Z,3),Z-=3,ug(ne,{pending:!0,data:U,method:Y.method,action:F},F,U))}}))}function Lg(B){function Z(we){return Ch(we,B)}za!==null&&Ch(za,B),La!==null&&Ch(La,B),Fa!==null&&Ch(Fa,B),Jg.forEach(Z),Hg.forEach(Z);for(var Y=0;Y<Ka.length;Y++){var F=Ka[Y];F.blockedOn===B&&(F.blockedOn=null)}for(;0<Ka.length&&(Y=Ka[0],Y.blockedOn===null);)wd(Y),Y.blockedOn===null&&Ka.shift();if(Y=(B.ownerDocument||B).$$reactFormReplay,Y!=null)for(F=0;F<Y.length;F+=3){var U=Y[F],ne=Y[F+1],ce=U[Qt]||null;if(typeof ne=="function")ce||Md(Y);else if(ce){var pe=null;if(ne&&ne.hasAttribute("formAction")){if(U=ne,ce=ne[Qt]||null)pe=ce.formAction;else if($h(U)!==null)continue}else pe=ce.action;typeof pe=="function"?Y[F+1]=pe:(Y.splice(F,3),F-=3),Md(Y)}}}function Qh(B){this._internalRoot=B}fh.prototype.render=Qh.prototype.render=function(B){var Z=this._internalRoot;if(Z===null)throw Error(u(409));var Y=Z.current,F=ts();Sd(Y,F,B,Z,null,null)},fh.prototype.unmount=Qh.prototype.unmount=function(){var B=this._internalRoot;if(B!==null){this._internalRoot=null;var Z=B.containerInfo;B.tag===0&&Zt(),Sd(B.current,2,null,B,null,null),ia(),Z[Js]=null}};function fh(B){this._internalRoot=B}fh.prototype.unstable_scheduleHydration=function(B){if(B){var Z=Vn();B={blockedOn:null,target:B,priority:Z};for(var Y=0;Y<Ka.length&&Z!==0&&Z<Ka[Y].priority;Y++);Ka.splice(Y,0,B),Y===0&&wd(B)}};var Nd=t.version;if(Nd!=="19.0.0")throw Error(u(527,Nd,"19.0.0"));me.findDOMNode=function(B){var Z=B._reactInternals;if(Z===void 0)throw typeof B.render=="function"?Error(u(188)):(B=Object.keys(B).join(","),Error(u(268,B)));return B=Ie(Z),B=B!==null?Be(B):null,B=B===null?null:B.stateNode,B};var IC={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:te,findFiberByHostInstance:Hs,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ph.isDisabled&&ph.supportsFiber)try{pt=ph.inject(IC),mt=ph}catch{}}return reactDomClient_production.createRoot=function(B,Z){if(!d(B))throw Error(u(299));var Y=!1,F="",U=Ku,ne=Pu,ce=Du,pe=null;return Z!=null&&(Z.unstable_strictMode===!0&&(Y=!0),Z.identifierPrefix!==void 0&&(F=Z.identifierPrefix),Z.onUncaughtError!==void 0&&(U=Z.onUncaughtError),Z.onCaughtError!==void 0&&(ne=Z.onCaughtError),Z.onRecoverableError!==void 0&&(ce=Z.onRecoverableError),Z.unstable_transitionCallbacks!==void 0&&(pe=Z.unstable_transitionCallbacks)),Z=vd(B,1,!1,null,null,Y,F,U,ne,ce,pe,null),B[Js]=Z.current,Wh(B.nodeType===8?B.parentNode:B),new Qh(Z)},reactDomClient_production.hydrateRoot=function(B,Z,Y){if(!d(B))throw Error(u(299));var F=!1,U="",ne=Ku,ce=Pu,pe=Du,we=null,He=null;return Y!=null&&(Y.unstable_strictMode===!0&&(F=!0),Y.identifierPrefix!==void 0&&(U=Y.identifierPrefix),Y.onUncaughtError!==void 0&&(ne=Y.onUncaughtError),Y.onCaughtError!==void 0&&(ce=Y.onCaughtError),Y.onRecoverableError!==void 0&&(pe=Y.onRecoverableError),Y.unstable_transitionCallbacks!==void 0&&(we=Y.unstable_transitionCallbacks),Y.formState!==void 0&&(He=Y.formState)),Z=vd(B,1,!0,Z,Y??null,F,U,ne,ce,pe,we,He),Z.context=Bd(null),Y=Z.current,F=ts(),U=bs(F),U.callback=null,ys(Y,U,F),Z.current.lanes=F,Ri(Z,F),Yi(Z),B[Js]=Z.current,Wh(B),new fh(Z)},reactDomClient_production.version="19.0.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const{createElement,createContext,forwardRef,useCallback,useContext,useEffect,useImperativeHandle,useLayoutEffect,useMemo,useRef,useState}=React$1,useId=React$1[`useId${Math.random()}`.slice(0,5)],useLayoutEffect_do_not_use_directly=useLayoutEffect,PanelGroupContext=createContext(null);PanelGroupContext.displayName="PanelGroupContext";const useIsomorphicLayoutEffect$1=useLayoutEffect_do_not_use_directly,wrappedUseId=typeof useId=="function"?useId:()=>null;let counter=0;function useUniqueId(n=null){const t=wrappedUseId(),o=useRef(n||t||null);return o.current===null&&(o.current=""+counter++),n??o.current}function PanelWithForwardedRef({children:n,className:t="",collapsedSize:o,collapsible:u,defaultSize:d,forwardedRef:C,id:I,maxSize:f,minSize:A,onCollapse:y,onExpand:G,onResize:S,order:w,style:M,tagName:V="div",...T}){const H=useContext(PanelGroupContext);if(H===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:J,expandPanel:z,getPanelSize:L,getPanelStyle:K,groupId:O,isPanelCollapsed:Q,reevaluatePanelConstraints:ee,registerPanel:ie,resizePanel:te,unregisterPanel:se}=H,ae=useUniqueId(I),le=useRef({callbacks:{onCollapse:y,onExpand:G,onResize:S},constraints:{collapsedSize:o,collapsible:u,defaultSize:d,maxSize:f,minSize:A},id:ae,idIsFromProps:I!==void 0,order:w});useRef({didLogMissingDefaultSizeWarning:!1}),useIsomorphicLayoutEffect$1(()=>{const{callbacks:be,constraints:Xe}=le.current,Ce={...Xe};le.current.id=ae,le.current.idIsFromProps=I!==void 0,le.current.order=w,be.onCollapse=y,be.onExpand=G,be.onResize=S,Xe.collapsedSize=o,Xe.collapsible=u,Xe.defaultSize=d,Xe.maxSize=f,Xe.minSize=A,(Ce.collapsedSize!==Xe.collapsedSize||Ce.collapsible!==Xe.collapsible||Ce.maxSize!==Xe.maxSize||Ce.minSize!==Xe.minSize)&&ee(le.current,Ce)}),useIsomorphicLayoutEffect$1(()=>{const be=le.current;return ie(be),()=>{se(be)}},[w,ae,ie,se]),useImperativeHandle(C,()=>({collapse:()=>{J(le.current)},expand:be=>{z(le.current,be)},getId(){return ae},getSize(){return L(le.current)},isCollapsed(){return Q(le.current)},isExpanded(){return!Q(le.current)},resize:be=>{te(le.current,be)}}),[J,z,L,Q,ae,te]);const ge=K(le.current,d);return createElement(V,{...T,children:n,className:t,id:I,style:{...ge,...M},"data-panel":"","data-panel-collapsible":u||void 0,"data-panel-group-id":O,"data-panel-id":ae,"data-panel-size":parseFloat(""+ge.flexGrow).toFixed(1)})}const Panel=forwardRef((n,t)=>createElement(PanelWithForwardedRef,{...n,forwardedRef:t}));PanelWithForwardedRef.displayName="Panel";Panel.displayName="forwardRef(Panel)";let currentCursorStyle=null,styleElement=null;function getCursorStyle(n,t){if(t){const o=(t&EXCEEDED_HORIZONTAL_MIN)!==0,u=(t&EXCEEDED_HORIZONTAL_MAX)!==0,d=(t&EXCEEDED_VERTICAL_MIN)!==0,C=(t&EXCEEDED_VERTICAL_MAX)!==0;if(o)return d?"se-resize":C?"ne-resize":"e-resize";if(u)return d?"sw-resize":C?"nw-resize":"w-resize";if(d)return"s-resize";if(C)return"n-resize"}switch(n){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function resetGlobalCursorStyle(){styleElement!==null&&(document.head.removeChild(styleElement),currentCursorStyle=null,styleElement=null)}function setGlobalCursorStyle(n,t){const o=getCursorStyle(n,t);currentCursorStyle!==o&&(currentCursorStyle=o,styleElement===null&&(styleElement=document.createElement("style"),document.head.appendChild(styleElement)),styleElement.innerHTML=`*{cursor: ${o}!important;}`)}function isKeyDown(n){return n.type==="keydown"}function isPointerEvent(n){return n.type.startsWith("pointer")}function isMouseEvent$1(n){return n.type.startsWith("mouse")}function getResizeEventCoordinates(n){if(isPointerEvent(n)){if(n.isPrimary)return{x:n.clientX,y:n.clientY}}else if(isMouseEvent$1(n))return{x:n.clientX,y:n.clientY};return{x:1/0,y:1/0}}function getInputType(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function intersects$1(n,t,o){return n.x<t.x+t.width&&n.x+n.width>t.x&&n.y<t.y+t.height&&n.y+n.height>t.y}function compare(n,t){if(n===t)throw new Error("Cannot compare node with itself");const o={a:get_ancestors(n),b:get_ancestors(t)};let u;for(;o.a.at(-1)===o.b.at(-1);)n=o.a.pop(),t=o.b.pop(),u=n;assert(u,"Stacking order can only be calculated for elements with a common ancestor");const d={a:get_z_index(find_stacking_context(o.a)),b:get_z_index(find_stacking_context(o.b))};if(d.a===d.b){const C=u.childNodes,I={a:o.a.at(-1),b:o.b.at(-1)};let f=C.length;for(;f--;){const A=C[f];if(A===I.a)return 1;if(A===I.b)return-1}}return Math.sign(d.a-d.b)}const props=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function is_flex_item(n){var t;const o=getComputedStyle((t=get_parent(n))!==null&&t!==void 0?t:n).display;return o==="flex"||o==="inline-flex"}function creates_stacking_context(n){const t=getComputedStyle(n);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||is_flex_item(n))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||props.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function find_stacking_context(n){let t=n.length;for(;t--;){const o=n[t];if(assert(o,"Missing node"),creates_stacking_context(o))return o}return null}function get_z_index(n){return n&&Number(getComputedStyle(n).zIndex)||0}function get_ancestors(n){const t=[];for(;n;)t.push(n),n=get_parent(n);return t}function get_parent(n){const{parentNode:t}=n;return t&&t instanceof ShadowRoot?t.host:t}const EXCEEDED_HORIZONTAL_MIN=1,EXCEEDED_HORIZONTAL_MAX=2,EXCEEDED_VERTICAL_MIN=4,EXCEEDED_VERTICAL_MAX=8,isCoarsePointer=getInputType()==="coarse";let intersectingHandles=[],isPointerDown=!1,ownerDocumentCounts=new Map,panelConstraintFlags=new Map;const registeredResizeHandlers=new Set;function registerResizeHandle(n,t,o,u,d){var C;const{ownerDocument:I}=t,f={direction:o,element:t,hitAreaMargins:u,setResizeHandlerState:d},A=(C=ownerDocumentCounts.get(I))!==null&&C!==void 0?C:0;return ownerDocumentCounts.set(I,A+1),registeredResizeHandlers.add(f),updateListeners(),function(){var G;panelConstraintFlags.delete(n),registeredResizeHandlers.delete(f);const S=(G=ownerDocumentCounts.get(I))!==null&&G!==void 0?G:1;if(ownerDocumentCounts.set(I,S-1),updateListeners(),S===1&&ownerDocumentCounts.delete(I),intersectingHandles.includes(f)){const w=intersectingHandles.indexOf(f);w>=0&&intersectingHandles.splice(w,1),updateCursor(),d("up",!0,null)}}}function handlePointerDown(n){const{target:t}=n,{x:o,y:u}=getResizeEventCoordinates(n);isPointerDown=!0,recalculateIntersectingHandles({target:t,x:o,y:u}),updateListeners(),intersectingHandles.length>0&&(updateResizeHandlerStates("down",n),n.preventDefault(),n.stopPropagation())}function handlePointerMove(n){const{x:t,y:o}=getResizeEventCoordinates(n);if(isPointerDown&&n.buttons===0&&(isPointerDown=!1,updateResizeHandlerStates("up",n)),!isPointerDown){const{target:u}=n;recalculateIntersectingHandles({target:u,x:t,y:o})}updateResizeHandlerStates("move",n),updateCursor(),intersectingHandles.length>0&&n.preventDefault()}function handlePointerUp(n){const{target:t}=n,{x:o,y:u}=getResizeEventCoordinates(n);panelConstraintFlags.clear(),isPointerDown=!1,intersectingHandles.length>0&&n.preventDefault(),updateResizeHandlerStates("up",n),recalculateIntersectingHandles({target:t,x:o,y:u}),updateCursor(),updateListeners()}function recalculateIntersectingHandles({target:n,x:t,y:o}){intersectingHandles.splice(0);let u=null;(n instanceof HTMLElement||n instanceof SVGElement)&&(u=n),registeredResizeHandlers.forEach(d=>{const{element:C,hitAreaMargins:I}=d,f=C.getBoundingClientRect(),{bottom:A,left:y,right:G,top:S}=f,w=isCoarsePointer?I.coarse:I.fine;if(t>=y-w&&t<=G+w&&o>=S-w&&o<=A+w){if(u!==null&&document.contains(u)&&C!==u&&!C.contains(u)&&!u.contains(C)&&compare(u,C)>0){let V=u,T=!1;for(;V&&!V.contains(C);){if(intersects$1(V.getBoundingClientRect(),f)){T=!0;break}V=V.parentElement}if(T)return}intersectingHandles.push(d)}})}function reportConstraintsViolation(n,t){panelConstraintFlags.set(n,t)}function updateCursor(){let n=!1,t=!1;intersectingHandles.forEach(u=>{const{direction:d}=u;d==="horizontal"?n=!0:t=!0});let o=0;panelConstraintFlags.forEach(u=>{o|=u}),n&&t?setGlobalCursorStyle("intersection",o):n?setGlobalCursorStyle("horizontal",o):t?setGlobalCursorStyle("vertical",o):resetGlobalCursorStyle()}function updateListeners(){ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;o.removeEventListener("contextmenu",handlePointerUp),o.removeEventListener("pointerdown",handlePointerDown),o.removeEventListener("pointerleave",handlePointerMove),o.removeEventListener("pointermove",handlePointerMove)}),window.removeEventListener("pointerup",handlePointerUp),window.removeEventListener("pointercancel",handlePointerUp),registeredResizeHandlers.size>0&&(isPointerDown?(intersectingHandles.length>0&&ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;n>0&&(o.addEventListener("contextmenu",handlePointerUp),o.addEventListener("pointerleave",handlePointerMove),o.addEventListener("pointermove",handlePointerMove))}),window.addEventListener("pointerup",handlePointerUp),window.addEventListener("pointercancel",handlePointerUp)):ownerDocumentCounts.forEach((n,t)=>{const{body:o}=t;n>0&&(o.addEventListener("pointerdown",handlePointerDown,{capture:!0}),o.addEventListener("pointermove",handlePointerMove))}))}function updateResizeHandlerStates(n,t){registeredResizeHandlers.forEach(o=>{const{setResizeHandlerState:u}=o,d=intersectingHandles.includes(o);u(n,d,t)})}function useForceUpdate(){const[n,t]=useState(0);return useCallback(()=>t(o=>o+1),[])}function assert(n,t){if(!n)throw console.error(t),Error(t)}const PRECISION=10;function fuzzyCompareNumbers(n,t,o=PRECISION){return n.toFixed(o)===t.toFixed(o)?0:n>t?1:-1}function fuzzyNumbersEqual$1(n,t,o=PRECISION){return fuzzyCompareNumbers(n,t,o)===0}function fuzzyNumbersEqual(n,t,o){return fuzzyCompareNumbers(n,t,o)===0}function fuzzyLayoutsEqual(n,t,o){if(n.length!==t.length)return!1;for(let u=0;u<n.length;u++){const d=n[u],C=t[u];if(!fuzzyNumbersEqual(d,C,o))return!1}return!0}function resizePanel({panelConstraints:n,panelIndex:t,size:o}){const u=n[t];assert(u!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:d=0,collapsible:C,maxSize:I=100,minSize:f=0}=u;if(fuzzyCompareNumbers(o,f)<0)if(C){const A=(d+f)/2;fuzzyCompareNumbers(o,A)<0?o=d:o=f}else o=f;return o=Math.min(I,o),o=parseFloat(o.toFixed(PRECISION)),o}function adjustLayoutByDelta({delta:n,initialLayout:t,panelConstraints:o,pivotIndices:u,prevLayout:d,trigger:C}){if(fuzzyNumbersEqual(n,0))return t;const I=[...t],[f,A]=u;assert(f!=null,"Invalid first pivot index"),assert(A!=null,"Invalid second pivot index");let y=0;if(C==="keyboard"){{const S=n<0?A:f,w=o[S];assert(w,`Panel constraints not found for index ${S}`);const{collapsedSize:M=0,collapsible:V,minSize:T=0}=w;if(V){const H=t[S];if(assert(H!=null,`Previous layout not found for panel index ${S}`),fuzzyNumbersEqual(H,M)){const J=T-H;fuzzyCompareNumbers(J,Math.abs(n))>0&&(n=n<0?0-J:J)}}}{const S=n<0?f:A,w=o[S];assert(w,`No panel constraints found for index ${S}`);const{collapsedSize:M=0,collapsible:V,minSize:T=0}=w;if(V){const H=t[S];if(assert(H!=null,`Previous layout not found for panel index ${S}`),fuzzyNumbersEqual(H,T)){const J=H-M;fuzzyCompareNumbers(J,Math.abs(n))>0&&(n=n<0?0-J:J)}}}}{const S=n<0?1:-1;let w=n<0?A:f,M=0;for(;;){const T=t[w];assert(T!=null,`Previous layout not found for panel index ${w}`);const J=resizePanel({panelConstraints:o,panelIndex:w,size:100})-T;if(M+=J,w+=S,w<0||w>=o.length)break}const V=Math.min(Math.abs(n),Math.abs(M));n=n<0?0-V:V}{let w=n<0?f:A;for(;w>=0&&w<o.length;){const M=Math.abs(n)-Math.abs(y),V=t[w];assert(V!=null,`Previous layout not found for panel index ${w}`);const T=V-M,H=resizePanel({panelConstraints:o,panelIndex:w,size:T});if(!fuzzyNumbersEqual(V,H)&&(y+=V-H,I[w]=H,y.toPrecision(3).localeCompare(Math.abs(n).toPrecision(3),void 0,{numeric:!0})>=0))break;n<0?w--:w++}}if(fuzzyLayoutsEqual(d,I))return d;{const S=n<0?A:f,w=t[S];assert(w!=null,`Previous layout not found for panel index ${S}`);const M=w+y,V=resizePanel({panelConstraints:o,panelIndex:S,size:M});if(I[S]=V,!fuzzyNumbersEqual(V,M)){let T=M-V,J=n<0?A:f;for(;J>=0&&J<o.length;){const z=I[J];assert(z!=null,`Previous layout not found for panel index ${J}`);const L=z+T,K=resizePanel({panelConstraints:o,panelIndex:J,size:L});if(fuzzyNumbersEqual(z,K)||(T-=K-z,I[J]=K),fuzzyNumbersEqual(T,0))break;n>0?J--:J++}}}const G=I.reduce((S,w)=>w+S,0);return fuzzyNumbersEqual(G,100)?I:d}function calculateAriaValues({layout:n,panelsArray:t,pivotIndices:o}){let u=0,d=100,C=0,I=0;const f=o[0];assert(f!=null,"No pivot index found"),t.forEach((S,w)=>{const{constraints:M}=S,{maxSize:V=100,minSize:T=0}=M;w===f?(u=T,d=V):(C+=T,I+=V)});const A=Math.min(d,100-C),y=Math.max(u,100-I),G=n[f];return{valueMax:A,valueMin:y,valueNow:G}}function getResizeHandleElementsForGroup(n,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${n}"]`))}function getResizeHandleElementIndex(n,t,o=document){const d=getResizeHandleElementsForGroup(n,o).findIndex(C=>C.getAttribute("data-panel-resize-handle-id")===t);return d??null}function determinePivotIndices(n,t,o){const u=getResizeHandleElementIndex(n,t,o);return u!=null?[u,u+1]:[-1,-1]}function getPanelGroupElement(n,t=document){var o;if(t instanceof HTMLElement&&(t==null||(o=t.dataset)===null||o===void 0?void 0:o.panelGroupId)==n)return t;const u=t.querySelector(`[data-panel-group][data-panel-group-id="${n}"]`);return u||null}function getResizeHandleElement(n,t=document){const o=t.querySelector(`[data-panel-resize-handle-id="${n}"]`);return o||null}function getResizeHandlePanelIds(n,t,o,u=document){var d,C,I,f;const A=getResizeHandleElement(t,u),y=getResizeHandleElementsForGroup(n,u),G=A?y.indexOf(A):-1,S=(d=(C=o[G])===null||C===void 0?void 0:C.id)!==null&&d!==void 0?d:null,w=(I=(f=o[G+1])===null||f===void 0?void 0:f.id)!==null&&I!==void 0?I:null;return[S,w]}function useWindowSplitterPanelGroupBehavior({committedValuesRef:n,eagerValuesRef:t,groupId:o,layout:u,panelDataArray:d,panelGroupElement:C,setLayout:I}){useRef({didWarnAboutMissingResizeHandle:!1}),useIsomorphicLayoutEffect$1(()=>{if(!C)return;const f=getResizeHandleElementsForGroup(o,C);for(let A=0;A<d.length-1;A++){const{valueMax:y,valueMin:G,valueNow:S}=calculateAriaValues({layout:u,panelsArray:d,pivotIndices:[A,A+1]}),w=f[A];if(w!=null){const M=d[A];assert(M,`No panel data found for index "${A}"`),w.setAttribute("aria-controls",M.id),w.setAttribute("aria-valuemax",""+Math.round(y)),w.setAttribute("aria-valuemin",""+Math.round(G)),w.setAttribute("aria-valuenow",S!=null?""+Math.round(S):"")}}return()=>{f.forEach((A,y)=>{A.removeAttribute("aria-controls"),A.removeAttribute("aria-valuemax"),A.removeAttribute("aria-valuemin"),A.removeAttribute("aria-valuenow")})}},[o,u,d,C]),useEffect(()=>{if(!C)return;const f=t.current;assert(f,"Eager values not found");const{panelDataArray:A}=f,y=getPanelGroupElement(o,C);assert(y!=null,`No group found for id "${o}"`);const G=getResizeHandleElementsForGroup(o,C);assert(G,`No resize handles found for group id "${o}"`);const S=G.map(w=>{const M=w.getAttribute("data-panel-resize-handle-id");assert(M,"Resize handle element has no handle id attribute");const[V,T]=getResizeHandlePanelIds(o,M,A,C);if(V==null||T==null)return()=>{};const H=J=>{if(!J.defaultPrevented)switch(J.key){case"Enter":{J.preventDefault();const z=A.findIndex(L=>L.id===V);if(z>=0){const L=A[z];assert(L,`No panel data found for index ${z}`);const K=u[z],{collapsedSize:O=0,collapsible:Q,minSize:ee=0}=L.constraints;if(K!=null&&Q){const ie=adjustLayoutByDelta({delta:fuzzyNumbersEqual(K,O)?ee-O:O-K,initialLayout:u,panelConstraints:A.map(te=>te.constraints),pivotIndices:determinePivotIndices(o,M,C),prevLayout:u,trigger:"keyboard"});u!==ie&&I(ie)}}break}}};return w.addEventListener("keydown",H),()=>{w.removeEventListener("keydown",H)}});return()=>{S.forEach(w=>w())}},[C,n,t,o,u,d,I])}function areEqual(n,t){if(n.length!==t.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==t[o])return!1;return!0}function getResizeEventCursorPosition(n,t){const o=n==="horizontal",{x:u,y:d}=getResizeEventCoordinates(t);return o?u:d}function calculateDragOffsetPercentage(n,t,o,u,d){const C=o==="horizontal",I=getResizeHandleElement(t,d);assert(I,`No resize handle element found for id "${t}"`);const f=I.getAttribute("data-panel-group-id");assert(f,"Resize handle element has no group id attribute");let{initialCursorPosition:A}=u;const y=getResizeEventCursorPosition(o,n),G=getPanelGroupElement(f,d);assert(G,`No group element found for id "${f}"`);const S=G.getBoundingClientRect(),w=C?S.width:S.height;return(y-A)/w*100}function calculateDeltaPercentage(n,t,o,u,d,C){if(isKeyDown(n)){const I=o==="horizontal";let f=0;n.shiftKey?f=100:d!=null?f=d:f=10;let A=0;switch(n.key){case"ArrowDown":A=I?0:f;break;case"ArrowLeft":A=I?-f:0;break;case"ArrowRight":A=I?f:0;break;case"ArrowUp":A=I?0:-f;break;case"End":A=100;break;case"Home":A=-100;break}return A}else return u==null?0:calculateDragOffsetPercentage(n,t,o,u,C)}function calculateUnsafeDefaultLayout({panelDataArray:n}){const t=Array(n.length),o=n.map(C=>C.constraints);let u=0,d=100;for(let C=0;C<n.length;C++){const I=o[C];assert(I,`Panel constraints not found for index ${C}`);const{defaultSize:f}=I;f!=null&&(u++,t[C]=f,d-=f)}for(let C=0;C<n.length;C++){const I=o[C];assert(I,`Panel constraints not found for index ${C}`);const{defaultSize:f}=I;if(f!=null)continue;const A=n.length-u,y=d/A;u++,t[C]=y,d-=y}return t}function callPanelCallbacks(n,t,o){t.forEach((u,d)=>{const C=n[d];assert(C,`Panel data not found for index ${d}`);const{callbacks:I,constraints:f,id:A}=C,{collapsedSize:y=0,collapsible:G}=f,S=o[A];if(S==null||u!==S){o[A]=u;const{onCollapse:w,onExpand:M,onResize:V}=I;V&&V(u,S),G&&(w||M)&&(M&&(S==null||fuzzyNumbersEqual$1(S,y))&&!fuzzyNumbersEqual$1(u,y)&&M(),w&&(S==null||!fuzzyNumbersEqual$1(S,y))&&fuzzyNumbersEqual$1(u,y)&&w())}})}function compareLayouts(n,t){if(n.length!==t.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!=t[o])return!1;return!0}function computePanelFlexBoxStyle({defaultSize:n,dragState:t,layout:o,panelData:u,panelIndex:d,precision:C=3}){const I=o[d];let f;return I==null?f=n!=null?n.toPrecision(C):"1":u.length===1?f="1":f=I.toPrecision(C),{flexBasis:0,flexGrow:f,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function debounce(n,t=10){let o=null;return(...d)=>{o!==null&&clearTimeout(o),o=setTimeout(()=>{n(...d)},t)}}function initializeDefaultStorage(n){try{if(typeof localStorage<"u")n.getItem=t=>localStorage.getItem(t),n.setItem=(t,o)=>{localStorage.setItem(t,o)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),n.getItem=()=>null,n.setItem=()=>{}}}function getPanelGroupKey(n){return`react-resizable-panels:${n}`}function getPanelKey(n){return n.map(t=>{const{constraints:o,id:u,idIsFromProps:d,order:C}=t;return d?u:C?`${C}:${JSON.stringify(o)}`:JSON.stringify(o)}).sort((t,o)=>t.localeCompare(o)).join(",")}function loadSerializedPanelGroupState(n,t){try{const o=getPanelGroupKey(n),u=t.getItem(o);if(u){const d=JSON.parse(u);if(typeof d=="object"&&d!=null)return d}}catch{}return null}function loadPanelGroupState(n,t,o){var u,d;const C=(u=loadSerializedPanelGroupState(n,o))!==null&&u!==void 0?u:{},I=getPanelKey(t);return(d=C[I])!==null&&d!==void 0?d:null}function savePanelGroupState(n,t,o,u,d){var C;const I=getPanelGroupKey(n),f=getPanelKey(t),A=(C=loadSerializedPanelGroupState(n,d))!==null&&C!==void 0?C:{};A[f]={expandToSizes:Object.fromEntries(o.entries()),layout:u};try{d.setItem(I,JSON.stringify(A))}catch(y){console.error(y)}}function validatePanelGroupLayout({layout:n,panelConstraints:t}){const o=[...n],u=o.reduce((C,I)=>C+I,0);if(o.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${o.map(C=>`${C}%`).join(", ")}`);if(!fuzzyNumbersEqual(u,100)&&o.length>0)for(let C=0;C<t.length;C++){const I=o[C];assert(I!=null,`No layout data found for index ${C}`);const f=100/u*I;o[C]=f}let d=0;for(let C=0;C<t.length;C++){const I=o[C];assert(I!=null,`No layout data found for index ${C}`);const f=resizePanel({panelConstraints:t,panelIndex:C,size:I});I!=f&&(d+=I-f,o[C]=f)}if(!fuzzyNumbersEqual(d,0))for(let C=0;C<t.length;C++){const I=o[C];assert(I!=null,`No layout data found for index ${C}`);const f=I+d,A=resizePanel({panelConstraints:t,panelIndex:C,size:f});if(I!==A&&(d-=A-I,o[C]=A,fuzzyNumbersEqual(d,0)))break}return o}const LOCAL_STORAGE_DEBOUNCE_INTERVAL=100,defaultStorage={getItem:n=>(initializeDefaultStorage(defaultStorage),defaultStorage.getItem(n)),setItem:(n,t)=>{initializeDefaultStorage(defaultStorage),defaultStorage.setItem(n,t)}},debounceMap={};function PanelGroupWithForwardedRef({autoSaveId:n=null,children:t,className:o="",direction:u,forwardedRef:d,id:C=null,onLayout:I=null,keyboardResizeBy:f=null,storage:A=defaultStorage,style:y,tagName:G="div",...S}){const w=useUniqueId(C),M=useRef(null),[V,T]=useState(null),[H,J]=useState([]),z=useForceUpdate(),L=useRef({}),K=useRef(new Map),O=useRef(0),Q=useRef({autoSaveId:n,direction:u,dragState:V,id:w,keyboardResizeBy:f,onLayout:I,storage:A}),ee=useRef({layout:H,panelDataArray:[],panelDataArrayChanged:!1});useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),useImperativeHandle(d,()=>({getId:()=>Q.current.id,getLayout:()=>{const{layout:ue}=ee.current;return ue},setLayout:ue=>{const{onLayout:me}=Q.current,{layout:xe,panelDataArray:Je}=ee.current,Ve=validatePanelGroupLayout({layout:ue,panelConstraints:Je.map(Ee=>Ee.constraints)});areEqual(xe,Ve)||(J(Ve),ee.current.layout=Ve,me&&me(Ve),callPanelCallbacks(Je,Ve,L.current))}}),[]),useIsomorphicLayoutEffect$1(()=>{Q.current.autoSaveId=n,Q.current.direction=u,Q.current.dragState=V,Q.current.id=w,Q.current.onLayout=I,Q.current.storage=A}),useWindowSplitterPanelGroupBehavior({committedValuesRef:Q,eagerValuesRef:ee,groupId:w,layout:H,panelDataArray:ee.current.panelDataArray,setLayout:J,panelGroupElement:M.current}),useEffect(()=>{const{panelDataArray:ue}=ee.current;if(n){if(H.length===0||H.length!==ue.length)return;let me=debounceMap[n];me==null&&(me=debounce(savePanelGroupState,LOCAL_STORAGE_DEBOUNCE_INTERVAL),debounceMap[n]=me);const xe=[...ue],Je=new Map(K.current);me(n,xe,Je,H,A)}},[n,H,A]),useEffect(()=>{});const ie=useCallback(ue=>{const{onLayout:me}=Q.current,{layout:xe,panelDataArray:Je}=ee.current;if(ue.constraints.collapsible){const Ve=Je.map(wt=>wt.constraints),{collapsedSize:Ee=0,panelSize:Ct,pivotIndices:st}=panelDataHelper(Je,ue,xe);if(assert(Ct!=null,`Panel size not found for panel "${ue.id}"`),!fuzzyNumbersEqual$1(Ct,Ee)){K.current.set(ue.id,Ct);const Qe=findPanelDataIndex(Je,ue)===Je.length-1?Ct-Ee:Ee-Ct,Ue=adjustLayoutByDelta({delta:Qe,initialLayout:xe,panelConstraints:Ve,pivotIndices:st,prevLayout:xe,trigger:"imperative-api"});compareLayouts(xe,Ue)||(J(Ue),ee.current.layout=Ue,me&&me(Ue),callPanelCallbacks(Je,Ue,L.current))}}},[]),te=useCallback((ue,me)=>{const{onLayout:xe}=Q.current,{layout:Je,panelDataArray:Ve}=ee.current;if(ue.constraints.collapsible){const Ee=Ve.map(Ge=>Ge.constraints),{collapsedSize:Ct=0,panelSize:st=0,minSize:wt=0,pivotIndices:Qe}=panelDataHelper(Ve,ue,Je),Ue=me??wt;if(fuzzyNumbersEqual$1(st,Ct)){const Ge=K.current.get(ue.id),Gt=Ge!=null&&Ge>=Ue?Ge:Ue,vt=findPanelDataIndex(Ve,ue)===Ve.length-1?st-Gt:Gt-st,at=adjustLayoutByDelta({delta:vt,initialLayout:Je,panelConstraints:Ee,pivotIndices:Qe,prevLayout:Je,trigger:"imperative-api"});compareLayouts(Je,at)||(J(at),ee.current.layout=at,xe&&xe(at),callPanelCallbacks(Ve,at,L.current))}}},[]),se=useCallback(ue=>{const{layout:me,panelDataArray:xe}=ee.current,{panelSize:Je}=panelDataHelper(xe,ue,me);return assert(Je!=null,`Panel size not found for panel "${ue.id}"`),Je},[]),ae=useCallback((ue,me)=>{const{panelDataArray:xe}=ee.current,Je=findPanelDataIndex(xe,ue);return computePanelFlexBoxStyle({defaultSize:me,dragState:V,layout:H,panelData:xe,panelIndex:Je})},[V,H]),le=useCallback(ue=>{const{layout:me,panelDataArray:xe}=ee.current,{collapsedSize:Je=0,collapsible:Ve,panelSize:Ee}=panelDataHelper(xe,ue,me);return assert(Ee!=null,`Panel size not found for panel "${ue.id}"`),Ve===!0&&fuzzyNumbersEqual$1(Ee,Je)},[]),ge=useCallback(ue=>{const{layout:me,panelDataArray:xe}=ee.current,{collapsedSize:Je=0,collapsible:Ve,panelSize:Ee}=panelDataHelper(xe,ue,me);return assert(Ee!=null,`Panel size not found for panel "${ue.id}"`),!Ve||fuzzyCompareNumbers(Ee,Je)>0},[]),be=useCallback(ue=>{const{panelDataArray:me}=ee.current;me.push(ue),me.sort((xe,Je)=>{const Ve=xe.order,Ee=Je.order;return Ve==null&&Ee==null?0:Ve==null?-1:Ee==null?1:Ve-Ee}),ee.current.panelDataArrayChanged=!0,z()},[z]);useIsomorphicLayoutEffect$1(()=>{if(ee.current.panelDataArrayChanged){ee.current.panelDataArrayChanged=!1;const{autoSaveId:ue,onLayout:me,storage:xe}=Q.current,{layout:Je,panelDataArray:Ve}=ee.current;let Ee=null;if(ue){const st=loadPanelGroupState(ue,Ve,xe);st&&(K.current=new Map(Object.entries(st.expandToSizes)),Ee=st.layout)}Ee==null&&(Ee=calculateUnsafeDefaultLayout({panelDataArray:Ve}));const Ct=validatePanelGroupLayout({layout:Ee,panelConstraints:Ve.map(st=>st.constraints)});areEqual(Je,Ct)||(J(Ct),ee.current.layout=Ct,me&&me(Ct),callPanelCallbacks(Ve,Ct,L.current))}}),useIsomorphicLayoutEffect$1(()=>{const ue=ee.current;return()=>{ue.layout=[]}},[]);const Xe=useCallback(ue=>{let me=!1;const xe=M.current;return xe&&window.getComputedStyle(xe,null).getPropertyValue("direction")==="rtl"&&(me=!0),function(Ve){Ve.preventDefault();const Ee=M.current;if(!Ee)return()=>null;const{direction:Ct,dragState:st,id:wt,keyboardResizeBy:Qe,onLayout:Ue}=Q.current,{layout:Ge,panelDataArray:Gt}=ee.current,{initialLayout:ot}=st??{},vt=determinePivotIndices(wt,ue,Ee);let at=calculateDeltaPercentage(Ve,ue,Ct,st,Qe,Ee);const Tt=Ct==="horizontal";Tt&&me&&(at=-at);const xt=Gt.map(De=>De.constraints),ve=adjustLayoutByDelta({delta:at,initialLayout:ot??Ge,panelConstraints:xt,pivotIndices:vt,prevLayout:Ge,trigger:isKeyDown(Ve)?"keyboard":"mouse-or-touch"}),de=!compareLayouts(Ge,ve);(isPointerEvent(Ve)||isMouseEvent$1(Ve))&&O.current!=at&&(O.current=at,!de&&at!==0?Tt?reportConstraintsViolation(ue,at<0?EXCEEDED_HORIZONTAL_MIN:EXCEEDED_HORIZONTAL_MAX):reportConstraintsViolation(ue,at<0?EXCEEDED_VERTICAL_MIN:EXCEEDED_VERTICAL_MAX):reportConstraintsViolation(ue,0)),de&&(J(ve),ee.current.layout=ve,Ue&&Ue(ve),callPanelCallbacks(Gt,ve,L.current))}},[]),Ce=useCallback((ue,me)=>{const{onLayout:xe}=Q.current,{layout:Je,panelDataArray:Ve}=ee.current,Ee=Ve.map(Ge=>Ge.constraints),{panelSize:Ct,pivotIndices:st}=panelDataHelper(Ve,ue,Je);assert(Ct!=null,`Panel size not found for panel "${ue.id}"`);const Qe=findPanelDataIndex(Ve,ue)===Ve.length-1?Ct-me:me-Ct,Ue=adjustLayoutByDelta({delta:Qe,initialLayout:Je,panelConstraints:Ee,pivotIndices:st,prevLayout:Je,trigger:"imperative-api"});compareLayouts(Je,Ue)||(J(Ue),ee.current.layout=Ue,xe&&xe(Ue),callPanelCallbacks(Ve,Ue,L.current))},[]),Re=useCallback((ue,me)=>{const{layout:xe,panelDataArray:Je}=ee.current,{collapsedSize:Ve=0,collapsible:Ee}=me,{collapsedSize:Ct=0,collapsible:st,maxSize:wt=100,minSize:Qe=0}=ue.constraints,{panelSize:Ue}=panelDataHelper(Je,ue,xe);Ue!=null&&(Ee&&st&&fuzzyNumbersEqual$1(Ue,Ve)?fuzzyNumbersEqual$1(Ve,Ct)||Ce(ue,Ct):Ue<Qe?Ce(ue,Qe):Ue>wt&&Ce(ue,wt))},[Ce]),Se=useCallback((ue,me)=>{const{direction:xe}=Q.current,{layout:Je}=ee.current;if(!M.current)return;const Ve=getResizeHandleElement(ue,M.current);assert(Ve,`Drag handle element not found for id "${ue}"`);const Ee=getResizeEventCursorPosition(xe,me);T({dragHandleId:ue,dragHandleRect:Ve.getBoundingClientRect(),initialCursorPosition:Ee,initialLayout:Je})},[]),Ze=useCallback(()=>{T(null)},[]),he=useCallback(ue=>{const{panelDataArray:me}=ee.current,xe=findPanelDataIndex(me,ue);xe>=0&&(me.splice(xe,1),delete L.current[ue.id],ee.current.panelDataArrayChanged=!0,z())},[z]),Ie=useMemo(()=>({collapsePanel:ie,direction:u,dragState:V,expandPanel:te,getPanelSize:se,getPanelStyle:ae,groupId:w,isPanelCollapsed:le,isPanelExpanded:ge,reevaluatePanelConstraints:Re,registerPanel:be,registerResizeHandle:Xe,resizePanel:Ce,startDragging:Se,stopDragging:Ze,unregisterPanel:he,panelGroupElement:M.current}),[ie,V,u,te,se,ae,w,le,ge,Re,be,Xe,Ce,Se,Ze,he]),Be={display:"flex",flexDirection:u==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return createElement(PanelGroupContext.Provider,{value:Ie},createElement(G,{...S,children:t,className:o,id:C,ref:M,style:{...Be,...y},"data-panel-group":"","data-panel-group-direction":u,"data-panel-group-id":w}))}const PanelGroup=forwardRef((n,t)=>createElement(PanelGroupWithForwardedRef,{...n,forwardedRef:t}));PanelGroupWithForwardedRef.displayName="PanelGroup";PanelGroup.displayName="forwardRef(PanelGroup)";function findPanelDataIndex(n,t){return n.findIndex(o=>o===t||o.id===t.id)}function panelDataHelper(n,t,o){const u=findPanelDataIndex(n,t),C=u===n.length-1?[u-1,u]:[u,u+1],I=o[u];return{...t.constraints,panelSize:I,pivotIndices:C}}function useWindowSplitterResizeHandlerBehavior({disabled:n,handleId:t,resizeHandler:o,panelGroupElement:u}){useEffect(()=>{if(n||o==null||u==null)return;const d=getResizeHandleElement(t,u);if(d==null)return;const C=I=>{if(!I.defaultPrevented)switch(I.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{I.preventDefault(),o(I);break}case"F6":{I.preventDefault();const f=d.getAttribute("data-panel-group-id");assert(f,`No group element found for id "${f}"`);const A=getResizeHandleElementsForGroup(f,u),y=getResizeHandleElementIndex(f,t,u);assert(y!==null,`No resize element found for id "${t}"`);const G=I.shiftKey?y>0?y-1:A.length-1:y+1<A.length?y+1:0;A[G].focus();break}}};return d.addEventListener("keydown",C),()=>{d.removeEventListener("keydown",C)}},[u,n,t,o])}function PanelResizeHandle({children:n=null,className:t="",disabled:o=!1,hitAreaMargins:u,id:d,onBlur:C,onDragging:I,onFocus:f,style:A={},tabIndex:y=0,tagName:G="div",...S}){var w,M;const V=useRef(null),T=useRef({onDragging:I});useEffect(()=>{T.current.onDragging=I});const H=useContext(PanelGroupContext);if(H===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:J,groupId:z,registerResizeHandle:L,startDragging:K,stopDragging:O,panelGroupElement:Q}=H,ee=useUniqueId(d),[ie,te]=useState("inactive"),[se,ae]=useState(!1),[le,ge]=useState(null),be=useRef({state:ie});useIsomorphicLayoutEffect$1(()=>{be.current.state=ie}),useEffect(()=>{if(o)ge(null);else{const Se=L(ee);ge(()=>Se)}},[o,ee,L]);const Xe=(w=u==null?void 0:u.coarse)!==null&&w!==void 0?w:15,Ce=(M=u==null?void 0:u.fine)!==null&&M!==void 0?M:5;return useEffect(()=>{if(o||le==null)return;const Se=V.current;return assert(Se,"Element ref not attached"),registerResizeHandle(ee,Se,J,{coarse:Xe,fine:Ce},(he,Ie,Be)=>{if(Ie)switch(he){case"down":{te("drag"),assert(Be,'Expected event to be defined for "down" action'),K(ee,Be);const{onDragging:ue}=T.current;ue&&ue(!0);break}case"move":{const{state:ue}=be.current;ue!=="drag"&&te("hover"),assert(Be,'Expected event to be defined for "move" action'),le(Be);break}case"up":{te("hover"),O();const{onDragging:ue}=T.current;ue&&ue(!1);break}}else te("inactive")})},[Xe,J,o,Ce,L,ee,le,K,O]),useWindowSplitterResizeHandlerBehavior({disabled:o,handleId:ee,resizeHandler:le,panelGroupElement:Q}),createElement(G,{...S,children:n,className:t,id:d,onBlur:()=>{ae(!1),C==null||C()},onFocus:()=>{ae(!0),f==null||f()},ref:V,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...A},tabIndex:y,"data-panel-group-direction":J,"data-panel-group-id":z,"data-resize-handle":"","data-resize-handle-active":ie==="drag"?"pointer":se?"keyboard":void 0,"data-resize-handle-state":ie,"data-panel-resize-handle-enabled":!o,"data-panel-resize-handle-id":ee})}PanelResizeHandle.displayName="PanelResizeHandle";const logoFull="/physicsvisualizer/assets/physicsvisualizer-CncMpR-a.svg",logoMini="/physicsvisualizer/assets/icon-transparent-Be_3rhPj.svg",baseMenuItems={File:["New Scene","Extract Scene","Open","Save","Exit"],Scenes:["Create Scene","Mechanics","Electrodynamics","Custom"],Visualizer:["Start","Pause","Reset"],Graph:[{label:"Add Y vs X Plot",action:"addGraph",type:"yvx"},{label:"Add X vs T Plot",action:"addGraph",type:"xvt"},{label:"Add Y vs T Plot",action:"addGraph",type:"yvt"}],Conversation:["Clear Chat","Export Transcript"],Help:["Tutorials","About","Documentation"]};function TopMenu({onAddGraph:n}){const[t,o]=reactExports.useState(null),u=C=>{o(t===C?null:C)},d=C=>{C.action==="addGraph"&&typeof n=="function"&&n(C.type),o(null)};return jsxRuntimeExports.jsxs("div",{className:"top-menu",children:[jsxRuntimeExports.jsxs("div",{id:"icon",children:[jsxRuntimeExports.jsx("img",{className:"full-logo",src:logoFull,alt:"Full logo",height:"36px"}),jsxRuntimeExports.jsx("img",{className:"mini-logo",src:logoMini,alt:"Mini logo",height:"36px"})]}),Object.entries(baseMenuItems).map(([C,I])=>jsxRuntimeExports.jsxs("div",{className:"menu-item",onClick:()=>u(C),onMouseLeave:()=>{},children:[C,t===C&&jsxRuntimeExports.jsx("div",{className:"dropdown",onMouseLeave:()=>o(null),children:I.map((f,A)=>jsxRuntimeExports.jsx("div",{className:"dropdown-item",onClick:()=>d(typeof f=="object"?f:{}),children:typeof f=="object"?f.label:f},A))})]},C))]})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="174",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,TimestampQuery={COMPUTE:"compute",RENDER:"render"};let EventDispatcher$1=class{addEventListener(t,o){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[t]===void 0&&(u[t]=[]),u[t].indexOf(o)===-1&&u[t].push(o)}hasEventListener(t,o){const u=this._listeners;return u===void 0?!1:u[t]!==void 0&&u[t].indexOf(o)!==-1}removeEventListener(t,o){const u=this._listeners;if(u===void 0)return;const d=u[t];if(d!==void 0){const C=d.indexOf(o);C!==-1&&d.splice(C,1)}}dispatchEvent(t){const o=this._listeners;if(o===void 0)return;const u=o[t.type];if(u!==void 0){t.target=this;const d=u.slice(0);for(let C=0,I=d.length;C<I;C++)d[C].call(this,t);t.target=null}}};const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,o=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[o&63|128]+_lut[o>>8&255]+"-"+_lut[o>>16&255]+_lut[o>>24&255]+_lut[u&255]+_lut[u>>8&255]+_lut[u>>16&255]+_lut[u>>24&255]).toLowerCase()}function clamp$1(n,t,o){return Math.max(t,Math.min(o,n))}function euclideanModulo(n,t){return(n%t+t)%t}function mapLinear(n,t,o,u,d){return u+(n-t)*(d-u)/(o-t)}function inverseLerp(n,t,o){return n!==t?(o-n)/(t-n):0}function lerp(n,t,o){return(1-o)*n+o*t}function damp(n,t,o,u){return lerp(n,t,1-Math.exp(-o*u))}function pingpong(n,t=1){return t-Math.abs(euclideanModulo(n,t*2)-t)}function smoothstep(n,t,o){return n<=t?0:n>=o?1:(n=(n-t)/(o-t),n*n*(3-2*n))}function smootherstep(n,t,o){return n<=t?0:n>=o?1:(n=(n-t)/(o-t),n*n*n*(n*(n*6-15)+10))}function randInt(n,t){return n+Math.floor(Math.random()*(t-n+1))}function randFloat(n,t){return n+Math.random()*(t-n)}function randFloatSpread(n){return n*(.5-Math.random())}function seededRandom(n){n!==void 0&&(_seed=n);let t=_seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function degToRad(n){return n*DEG2RAD}function radToDeg(n){return n*RAD2DEG}function isPowerOfTwo(n){return(n&n-1)===0&&n!==0}function ceilPowerOfTwo(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function floorPowerOfTwo(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function setQuaternionFromProperEuler(n,t,o,u,d){const C=Math.cos,I=Math.sin,f=C(o/2),A=I(o/2),y=C((t+u)/2),G=I((t+u)/2),S=C((t-u)/2),w=I((t-u)/2),M=C((u-t)/2),V=I((u-t)/2);switch(d){case"XYX":n.set(f*G,A*S,A*w,f*y);break;case"YZY":n.set(A*w,f*G,A*S,f*y);break;case"ZXZ":n.set(A*S,A*w,f*G,f*y);break;case"XZX":n.set(f*G,A*V,A*M,f*y);break;case"YXY":n.set(A*M,f*G,A*V,f*y);break;case"ZYZ":n.set(A*V,A*M,f*G,f*y);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+d)}}function denormalize(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function normalize(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp:clamp$1,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(t=0,o=0){Vector2.prototype.isVector2=!0,this.x=t,this.y=o}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,o){return this.x=t,this.y=o,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const o=this.x,u=this.y,d=t.elements;return this.x=d[0]*o+d[3]*u+d[6],this.y=d[1]*o+d[4]*u+d[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,o){return this.x=clamp$1(this.x,t.x,o.x),this.y=clamp$1(this.y,t.y,o.y),this}clampScalar(t,o){return this.x=clamp$1(this.x,t,o),this.y=clamp$1(this.y,t,o),this}clampLength(t,o){const u=this.length();return this.divideScalar(u||1).multiplyScalar(clamp$1(u,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const o=Math.sqrt(this.lengthSq()*t.lengthSq());if(o===0)return Math.PI/2;const u=this.dot(t)/o;return Math.acos(clamp$1(u,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const o=this.x-t.x,u=this.y-t.y;return o*o+u*u}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this}lerpVectors(t,o,u){return this.x=t.x+(o.x-t.x)*u,this.y=t.y+(o.y-t.y)*u,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this}rotateAround(t,o){const u=Math.cos(o),d=Math.sin(o),C=this.x-t.x,I=this.y-t.y;return this.x=C*u-I*d+t.x,this.y=C*d+I*u+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(t,o,u,d,C,I,f,A,y){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,o,u,d,C,I,f,A,y)}set(t,o,u,d,C,I,f,A,y){const G=this.elements;return G[0]=t,G[1]=d,G[2]=f,G[3]=o,G[4]=C,G[5]=A,G[6]=u,G[7]=I,G[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const o=this.elements,u=t.elements;return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],this}extractBasis(t,o,u){return t.setFromMatrix3Column(this,0),o.setFromMatrix3Column(this,1),u.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const o=t.elements;return this.set(o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,o){const u=t.elements,d=o.elements,C=this.elements,I=u[0],f=u[3],A=u[6],y=u[1],G=u[4],S=u[7],w=u[2],M=u[5],V=u[8],T=d[0],H=d[3],J=d[6],z=d[1],L=d[4],K=d[7],O=d[2],Q=d[5],ee=d[8];return C[0]=I*T+f*z+A*O,C[3]=I*H+f*L+A*Q,C[6]=I*J+f*K+A*ee,C[1]=y*T+G*z+S*O,C[4]=y*H+G*L+S*Q,C[7]=y*J+G*K+S*ee,C[2]=w*T+M*z+V*O,C[5]=w*H+M*L+V*Q,C[8]=w*J+M*K+V*ee,this}multiplyScalar(t){const o=this.elements;return o[0]*=t,o[3]*=t,o[6]*=t,o[1]*=t,o[4]*=t,o[7]*=t,o[2]*=t,o[5]*=t,o[8]*=t,this}determinant(){const t=this.elements,o=t[0],u=t[1],d=t[2],C=t[3],I=t[4],f=t[5],A=t[6],y=t[7],G=t[8];return o*I*G-o*f*y-u*C*G+u*f*A+d*C*y-d*I*A}invert(){const t=this.elements,o=t[0],u=t[1],d=t[2],C=t[3],I=t[4],f=t[5],A=t[6],y=t[7],G=t[8],S=G*I-f*y,w=f*A-G*C,M=y*C-I*A,V=o*S+u*w+d*M;if(V===0)return this.set(0,0,0,0,0,0,0,0,0);const T=1/V;return t[0]=S*T,t[1]=(d*y-G*u)*T,t[2]=(f*u-d*I)*T,t[3]=w*T,t[4]=(G*o-d*A)*T,t[5]=(d*C-f*o)*T,t[6]=M*T,t[7]=(u*A-y*o)*T,t[8]=(I*o-u*C)*T,this}transpose(){let t;const o=this.elements;return t=o[1],o[1]=o[3],o[3]=t,t=o[2],o[2]=o[6],o[6]=t,t=o[5],o[5]=o[7],o[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const o=this.elements;return t[0]=o[0],t[1]=o[3],t[2]=o[6],t[3]=o[1],t[4]=o[4],t[5]=o[7],t[6]=o[2],t[7]=o[5],t[8]=o[8],this}setUvTransform(t,o,u,d,C,I,f){const A=Math.cos(C),y=Math.sin(C);return this.set(u*A,u*y,-u*(A*I+y*f)+I+t,-d*y,d*A,-d*(-y*I+A*f)+f+o,0,0,1),this}scale(t,o){return this.premultiply(_m3.makeScale(t,o)),this}rotate(t){return this.premultiply(_m3.makeRotation(-t)),this}translate(t,o){return this.premultiply(_m3.makeTranslation(t,o)),this}makeTranslation(t,o){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,o,0,0,1),this}makeRotation(t){const o=Math.cos(t),u=Math.sin(t);return this.set(o,-u,0,u,o,0,0,0,1),this}makeScale(t,o){return this.set(t,0,0,0,o,0,0,0,1),this}equals(t){const o=this.elements,u=t.elements;for(let d=0;d<9;d++)if(o[d]!==u[d])return!1;return!0}fromArray(t,o=0){for(let u=0;u<9;u++)this.elements[u]=t[u+o];return this}toArray(t=[],o=0){const u=this.elements;return t[o]=u[0],t[o+1]=u[1],t[o+2]=u[2],t[o+3]=u[3],t[o+4]=u[4],t[o+5]=u[5],t[o+6]=u[6],t[o+7]=u[7],t[o+8]=u[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(n,t){return new TYPED_ARRAYS[n](t)}function createElementNS(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function createCanvasElement(){const n=createElementNS("canvas");return n.style.display="block",n}const _cache={};function warnOnce(n){n in _cache||(_cache[n]=!0,console.warn(n))}function probeAsync(n,t,o){return new Promise(function(u,d){function C(){switch(n.clientWaitSync(t,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:d();break;case n.TIMEOUT_EXPIRED:setTimeout(C,o);break;default:u()}}setTimeout(C,o)})}function toNormalizedProjectionMatrix(n){const t=n.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function toReversedProjectionMatrix(n){const t=n.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const n={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(d,C,I){return this.enabled===!1||C===I||!C||!I||(this.spaces[C].transfer===SRGBTransfer&&(d.r=SRGBToLinear(d.r),d.g=SRGBToLinear(d.g),d.b=SRGBToLinear(d.b)),this.spaces[C].primaries!==this.spaces[I].primaries&&(d.applyMatrix3(this.spaces[C].toXYZ),d.applyMatrix3(this.spaces[I].fromXYZ)),this.spaces[I].transfer===SRGBTransfer&&(d.r=LinearToSRGB(d.r),d.g=LinearToSRGB(d.g),d.b=LinearToSRGB(d.b))),d},fromWorkingColorSpace:function(d,C){return this.convert(d,this.workingColorSpace,C)},toWorkingColorSpace:function(d,C){return this.convert(d,C,this.workingColorSpace)},getPrimaries:function(d){return this.spaces[d].primaries},getTransfer:function(d){return d===NoColorSpace?LinearTransfer:this.spaces[d].transfer},getLuminanceCoefficients:function(d,C=this.workingColorSpace){return d.fromArray(this.spaces[C].luminanceCoefficients)},define:function(d){Object.assign(this.spaces,d)},_getMatrix:function(d,C,I){return d.copy(this.spaces[C].toXYZ).multiply(this.spaces[I].fromXYZ)},_getDrawingBufferColorSpace:function(d){return this.spaces[d].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(d=this.workingColorSpace){return this.spaces[d].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],o=[.2126,.7152,.0722],u=[.3127,.329];return n.define({[LinearSRGBColorSpace]:{primaries:t,whitePoint:u,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:o,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:t,whitePoint:u,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:o,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),n}const ColorManagement=createColorManagement();function SRGBToLinear(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function LinearToSRGB(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let o;if(t instanceof HTMLCanvasElement)o=t;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=t.width,_canvas.height=t.height;const u=_canvas.getContext("2d");t instanceof ImageData?u.putImageData(t,0,0):u.drawImage(t,0,0,t.width,t.height),o=_canvas}return o.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const o=createElementNS("canvas");o.width=t.width,o.height=t.height;const u=o.getContext("2d");u.drawImage(t,0,0,t.width,t.height);const d=u.getImageData(0,0,t.width,t.height),C=d.data;for(let I=0;I<C.length;I++)C[I]=SRGBToLinear(C[I]/255)*255;return u.putImageData(d,0,0),o}else if(t.data){const o=t.data.slice(0);for(let u=0;u<o.length;u++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[u]=Math.floor(SRGBToLinear(o[u]/255)*255):o[u]=SRGBToLinear(o[u]);return{data:o,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let _sourceId=0;class Source{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const o=t===void 0||typeof t=="string";if(!o&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const u={uuid:this.uuid,url:""},d=this.data;if(d!==null){let C;if(Array.isArray(d)){C=[];for(let I=0,f=d.length;I<f;I++)d[I].isDataTexture?C.push(serializeImage(d[I].image)):C.push(serializeImage(d[I]))}else C=serializeImage(d);u.url=C}return o||(t.images[this.uuid]=u),u}}function serializeImage(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?ImageUtils.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher$1{constructor(t=Texture.DEFAULT_IMAGE,o=Texture.DEFAULT_MAPPING,u=ClampToEdgeWrapping,d=ClampToEdgeWrapping,C=LinearFilter,I=LinearMipmapLinearFilter,f=RGBAFormat,A=UnsignedByteType,y=Texture.DEFAULT_ANISOTROPY,G=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(t),this.mipmaps=[],this.mapping=o,this.channel=0,this.wrapS=u,this.wrapT=d,this.magFilter=C,this.minFilter=I,this.anisotropy=y,this.format=f,this.internalFormat=null,this.type=A,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=G,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const o=t===void 0||typeof t=="string";if(!o&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const u={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(u.userData=this.userData),o||(t.textures[this.uuid]=u),u}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(t=0,o=0,u=0,d=1){Vector4.prototype.isVector4=!0,this.x=t,this.y=o,this.z=u,this.w=d}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,o,u,d){return this.x=t,this.y=o,this.z=u,this.w=d,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;case 3:this.w=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this.z=t.z+o.z,this.w=t.w+o.w,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this.z+=t.z*o,this.w+=t.w*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this.z=t.z-o.z,this.w=t.w-o.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const o=this.x,u=this.y,d=this.z,C=this.w,I=t.elements;return this.x=I[0]*o+I[4]*u+I[8]*d+I[12]*C,this.y=I[1]*o+I[5]*u+I[9]*d+I[13]*C,this.z=I[2]*o+I[6]*u+I[10]*d+I[14]*C,this.w=I[3]*o+I[7]*u+I[11]*d+I[15]*C,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const o=Math.sqrt(1-t.w*t.w);return o<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/o,this.y=t.y/o,this.z=t.z/o),this}setAxisAngleFromRotationMatrix(t){let o,u,d,C;const A=t.elements,y=A[0],G=A[4],S=A[8],w=A[1],M=A[5],V=A[9],T=A[2],H=A[6],J=A[10];if(Math.abs(G-w)<.01&&Math.abs(S-T)<.01&&Math.abs(V-H)<.01){if(Math.abs(G+w)<.1&&Math.abs(S+T)<.1&&Math.abs(V+H)<.1&&Math.abs(y+M+J-3)<.1)return this.set(1,0,0,0),this;o=Math.PI;const L=(y+1)/2,K=(M+1)/2,O=(J+1)/2,Q=(G+w)/4,ee=(S+T)/4,ie=(V+H)/4;return L>K&&L>O?L<.01?(u=0,d=.707106781,C=.707106781):(u=Math.sqrt(L),d=Q/u,C=ee/u):K>O?K<.01?(u=.707106781,d=0,C=.707106781):(d=Math.sqrt(K),u=Q/d,C=ie/d):O<.01?(u=.707106781,d=.707106781,C=0):(C=Math.sqrt(O),u=ee/C,d=ie/C),this.set(u,d,C,o),this}let z=Math.sqrt((H-V)*(H-V)+(S-T)*(S-T)+(w-G)*(w-G));return Math.abs(z)<.001&&(z=1),this.x=(H-V)/z,this.y=(S-T)/z,this.z=(w-G)/z,this.w=Math.acos((y+M+J-1)/2),this}setFromMatrixPosition(t){const o=t.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this.w=o[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,o){return this.x=clamp$1(this.x,t.x,o.x),this.y=clamp$1(this.y,t.y,o.y),this.z=clamp$1(this.z,t.z,o.z),this.w=clamp$1(this.w,t.w,o.w),this}clampScalar(t,o){return this.x=clamp$1(this.x,t,o),this.y=clamp$1(this.y,t,o),this.z=clamp$1(this.z,t,o),this.w=clamp$1(this.w,t,o),this}clampLength(t,o){const u=this.length();return this.divideScalar(u||1).multiplyScalar(clamp$1(u,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this.z+=(t.z-this.z)*o,this.w+=(t.w-this.w)*o,this}lerpVectors(t,o,u){return this.x=t.x+(o.x-t.x)*u,this.y=t.y+(o.y-t.y)*u,this.z=t.z+(o.z-t.z)*u,this.w=t.w+(o.w-t.w)*u,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this.z=t[o+2],this.w=t[o+3],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,t[o+3]=this.w,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this.z=t.getZ(o),this.w=t.getW(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher$1{constructor(t=1,o=1,u={}){super(),this.isRenderTarget=!0,this.width=t,this.height=o,this.depth=1,this.scissor=new Vector4(0,0,t,o),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,o);const d={width:t,height:o,depth:1};u=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},u);const C=new Texture(d,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.colorSpace);C.flipY=!1,C.generateMipmaps=u.generateMipmaps,C.internalFormat=u.internalFormat,this.textures=[];const I=u.count;for(let f=0;f<I;f++)this.textures[f]=C.clone(),this.textures[f].isRenderTargetTexture=!0,this.textures[f].renderTarget=this;this.depthBuffer=u.depthBuffer,this.stencilBuffer=u.stencilBuffer,this.resolveDepthBuffer=u.resolveDepthBuffer,this.resolveStencilBuffer=u.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=u.depthTexture,this.samples=u.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,o,u=1){if(this.width!==t||this.height!==o||this.depth!==u){this.width=t,this.height=o,this.depth=u;for(let d=0,C=this.textures.length;d<C;d++)this.textures[d].image.width=t,this.textures[d].image.height=o,this.textures[d].image.depth=u;this.dispose()}this.viewport.set(0,0,t,o),this.scissor.set(0,0,t,o)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let o=0,u=t.textures.length;o<u;o++){this.textures[o]=t.textures[o].clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;const d=Object.assign({},t.textures[o].image);this.textures[o].source=new Source(d)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(t=1,o=1,u={}){super(t,o,u),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(t=null,o=1,u=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:o,height:u,depth:d},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(t=1,o=1,u=1,d={}){super(t,o,d),this.isWebGLArrayRenderTarget=!0,this.depth=u,this.texture=new DataArrayTexture(null,t,o,u),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(t=null,o=1,u=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:o,height:u,depth:d},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(t=1,o=1,u=1,d={}){super(t,o,d),this.isWebGL3DRenderTarget=!0,this.depth=u,this.texture=new Data3DTexture(null,t,o,u),this.texture.isRenderTargetTexture=!0}}let Quaternion$2=class{constructor(t=0,o=0,u=0,d=1){this.isQuaternion=!0,this._x=t,this._y=o,this._z=u,this._w=d}static slerpFlat(t,o,u,d,C,I,f){let A=u[d+0],y=u[d+1],G=u[d+2],S=u[d+3];const w=C[I+0],M=C[I+1],V=C[I+2],T=C[I+3];if(f===0){t[o+0]=A,t[o+1]=y,t[o+2]=G,t[o+3]=S;return}if(f===1){t[o+0]=w,t[o+1]=M,t[o+2]=V,t[o+3]=T;return}if(S!==T||A!==w||y!==M||G!==V){let H=1-f;const J=A*w+y*M+G*V+S*T,z=J>=0?1:-1,L=1-J*J;if(L>Number.EPSILON){const O=Math.sqrt(L),Q=Math.atan2(O,J*z);H=Math.sin(H*Q)/O,f=Math.sin(f*Q)/O}const K=f*z;if(A=A*H+w*K,y=y*H+M*K,G=G*H+V*K,S=S*H+T*K,H===1-f){const O=1/Math.sqrt(A*A+y*y+G*G+S*S);A*=O,y*=O,G*=O,S*=O}}t[o]=A,t[o+1]=y,t[o+2]=G,t[o+3]=S}static multiplyQuaternionsFlat(t,o,u,d,C,I){const f=u[d],A=u[d+1],y=u[d+2],G=u[d+3],S=C[I],w=C[I+1],M=C[I+2],V=C[I+3];return t[o]=f*V+G*S+A*M-y*w,t[o+1]=A*V+G*w+y*S-f*M,t[o+2]=y*V+G*M+f*w-A*S,t[o+3]=G*V-f*S-A*w-y*M,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,o,u,d){return this._x=t,this._y=o,this._z=u,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,o=!0){const u=t._x,d=t._y,C=t._z,I=t._order,f=Math.cos,A=Math.sin,y=f(u/2),G=f(d/2),S=f(C/2),w=A(u/2),M=A(d/2),V=A(C/2);switch(I){case"XYZ":this._x=w*G*S+y*M*V,this._y=y*M*S-w*G*V,this._z=y*G*V+w*M*S,this._w=y*G*S-w*M*V;break;case"YXZ":this._x=w*G*S+y*M*V,this._y=y*M*S-w*G*V,this._z=y*G*V-w*M*S,this._w=y*G*S+w*M*V;break;case"ZXY":this._x=w*G*S-y*M*V,this._y=y*M*S+w*G*V,this._z=y*G*V+w*M*S,this._w=y*G*S-w*M*V;break;case"ZYX":this._x=w*G*S-y*M*V,this._y=y*M*S+w*G*V,this._z=y*G*V-w*M*S,this._w=y*G*S+w*M*V;break;case"YZX":this._x=w*G*S+y*M*V,this._y=y*M*S+w*G*V,this._z=y*G*V-w*M*S,this._w=y*G*S-w*M*V;break;case"XZY":this._x=w*G*S-y*M*V,this._y=y*M*S-w*G*V,this._z=y*G*V+w*M*S,this._w=y*G*S+w*M*V;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+I)}return o===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,o){const u=o/2,d=Math.sin(u);return this._x=t.x*d,this._y=t.y*d,this._z=t.z*d,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(t){const o=t.elements,u=o[0],d=o[4],C=o[8],I=o[1],f=o[5],A=o[9],y=o[2],G=o[6],S=o[10],w=u+f+S;if(w>0){const M=.5/Math.sqrt(w+1);this._w=.25/M,this._x=(G-A)*M,this._y=(C-y)*M,this._z=(I-d)*M}else if(u>f&&u>S){const M=2*Math.sqrt(1+u-f-S);this._w=(G-A)/M,this._x=.25*M,this._y=(d+I)/M,this._z=(C+y)/M}else if(f>S){const M=2*Math.sqrt(1+f-u-S);this._w=(C-y)/M,this._x=(d+I)/M,this._y=.25*M,this._z=(A+G)/M}else{const M=2*Math.sqrt(1+S-u-f);this._w=(I-d)/M,this._x=(C+y)/M,this._y=(A+G)/M,this._z=.25*M}return this._onChangeCallback(),this}setFromUnitVectors(t,o){let u=t.dot(o)+1;return u<Number.EPSILON?(u=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=u):(this._x=0,this._y=-t.z,this._z=t.y,this._w=u)):(this._x=t.y*o.z-t.z*o.y,this._y=t.z*o.x-t.x*o.z,this._z=t.x*o.y-t.y*o.x,this._w=u),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp$1(this.dot(t),-1,1)))}rotateTowards(t,o){const u=this.angleTo(t);if(u===0)return this;const d=Math.min(1,o/u);return this.slerp(t,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,o){const u=t._x,d=t._y,C=t._z,I=t._w,f=o._x,A=o._y,y=o._z,G=o._w;return this._x=u*G+I*f+d*y-C*A,this._y=d*G+I*A+C*f-u*y,this._z=C*G+I*y+u*A-d*f,this._w=I*G-u*f-d*A-C*y,this._onChangeCallback(),this}slerp(t,o){if(o===0)return this;if(o===1)return this.copy(t);const u=this._x,d=this._y,C=this._z,I=this._w;let f=I*t._w+u*t._x+d*t._y+C*t._z;if(f<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,f=-f):this.copy(t),f>=1)return this._w=I,this._x=u,this._y=d,this._z=C,this;const A=1-f*f;if(A<=Number.EPSILON){const M=1-o;return this._w=M*I+o*this._w,this._x=M*u+o*this._x,this._y=M*d+o*this._y,this._z=M*C+o*this._z,this.normalize(),this}const y=Math.sqrt(A),G=Math.atan2(y,f),S=Math.sin((1-o)*G)/y,w=Math.sin(o*G)/y;return this._w=I*S+this._w*w,this._x=u*S+this._x*w,this._y=d*S+this._y*w,this._z=C*S+this._z*w,this._onChangeCallback(),this}slerpQuaternions(t,o,u){return this.copy(t).slerp(o,u)}random(){const t=2*Math.PI*Math.random(),o=2*Math.PI*Math.random(),u=Math.random(),d=Math.sqrt(1-u),C=Math.sqrt(u);return this.set(d*Math.sin(t),d*Math.cos(t),C*Math.sin(o),C*Math.cos(o))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,o=0){return this._x=t[o],this._y=t[o+1],this._z=t[o+2],this._w=t[o+3],this._onChangeCallback(),this}toArray(t=[],o=0){return t[o]=this._x,t[o+1]=this._y,t[o+2]=this._z,t[o+3]=this._w,t}fromBufferAttribute(t,o){return this._x=t.getX(o),this._y=t.getY(o),this._z=t.getZ(o),this._w=t.getW(o),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class Vector3{constructor(t=0,o=0,u=0){Vector3.prototype.isVector3=!0,this.x=t,this.y=o,this.z=u}set(t,o,u){return u===void 0&&(u=this.z),this.x=t,this.y=o,this.z=u,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,o){switch(t){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,o){return this.x=t.x+o.x,this.y=t.y+o.y,this.z=t.z+o.z,this}addScaledVector(t,o){return this.x+=t.x*o,this.y+=t.y*o,this.z+=t.z*o,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,o){return this.x=t.x-o.x,this.y=t.y-o.y,this.z=t.z-o.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,o){return this.x=t.x*o.x,this.y=t.y*o.y,this.z=t.z*o.z,this}applyEuler(t){return this.applyQuaternion(_quaternion$4.setFromEuler(t))}applyAxisAngle(t,o){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(t,o))}applyMatrix3(t){const o=this.x,u=this.y,d=this.z,C=t.elements;return this.x=C[0]*o+C[3]*u+C[6]*d,this.y=C[1]*o+C[4]*u+C[7]*d,this.z=C[2]*o+C[5]*u+C[8]*d,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const o=this.x,u=this.y,d=this.z,C=t.elements,I=1/(C[3]*o+C[7]*u+C[11]*d+C[15]);return this.x=(C[0]*o+C[4]*u+C[8]*d+C[12])*I,this.y=(C[1]*o+C[5]*u+C[9]*d+C[13])*I,this.z=(C[2]*o+C[6]*u+C[10]*d+C[14])*I,this}applyQuaternion(t){const o=this.x,u=this.y,d=this.z,C=t.x,I=t.y,f=t.z,A=t.w,y=2*(I*d-f*u),G=2*(f*o-C*d),S=2*(C*u-I*o);return this.x=o+A*y+I*S-f*G,this.y=u+A*G+f*y-C*S,this.z=d+A*S+C*G-I*y,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const o=this.x,u=this.y,d=this.z,C=t.elements;return this.x=C[0]*o+C[4]*u+C[8]*d,this.y=C[1]*o+C[5]*u+C[9]*d,this.z=C[2]*o+C[6]*u+C[10]*d,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,o){return this.x=clamp$1(this.x,t.x,o.x),this.y=clamp$1(this.y,t.y,o.y),this.z=clamp$1(this.z,t.z,o.z),this}clampScalar(t,o){return this.x=clamp$1(this.x,t,o),this.y=clamp$1(this.y,t,o),this.z=clamp$1(this.z,t,o),this}clampLength(t,o){const u=this.length();return this.divideScalar(u||1).multiplyScalar(clamp$1(u,t,o))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,o){return this.x+=(t.x-this.x)*o,this.y+=(t.y-this.y)*o,this.z+=(t.z-this.z)*o,this}lerpVectors(t,o,u){return this.x=t.x+(o.x-t.x)*u,this.y=t.y+(o.y-t.y)*u,this.z=t.z+(o.z-t.z)*u,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,o){const u=t.x,d=t.y,C=t.z,I=o.x,f=o.y,A=o.z;return this.x=d*A-C*f,this.y=C*I-u*A,this.z=u*f-d*I,this}projectOnVector(t){const o=t.lengthSq();if(o===0)return this.set(0,0,0);const u=t.dot(this)/o;return this.copy(t).multiplyScalar(u)}projectOnPlane(t){return _vector$c.copy(this).projectOnVector(t),this.sub(_vector$c)}reflect(t){return this.sub(_vector$c.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const o=Math.sqrt(this.lengthSq()*t.lengthSq());if(o===0)return Math.PI/2;const u=this.dot(t)/o;return Math.acos(clamp$1(u,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const o=this.x-t.x,u=this.y-t.y,d=this.z-t.z;return o*o+u*u+d*d}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,o,u){const d=Math.sin(o)*t;return this.x=d*Math.sin(u),this.y=Math.cos(o)*t,this.z=d*Math.cos(u),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,o,u){return this.x=t*Math.sin(o),this.y=u,this.z=t*Math.cos(o),this}setFromMatrixPosition(t){const o=t.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this}setFromMatrixScale(t){const o=this.setFromMatrixColumn(t,0).length(),u=this.setFromMatrixColumn(t,1).length(),d=this.setFromMatrixColumn(t,2).length();return this.x=o,this.y=u,this.z=d,this}setFromMatrixColumn(t,o){return this.fromArray(t.elements,o*4)}setFromMatrix3Column(t,o){return this.fromArray(t.elements,o*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,o=0){return this.x=t[o],this.y=t[o+1],this.z=t[o+2],this}toArray(t=[],o=0){return t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,t}fromBufferAttribute(t,o){return this.x=t.getX(o),this.y=t.getY(o),this.z=t.getZ(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,o=Math.random()*2-1,u=Math.sqrt(1-o*o);return this.x=u*Math.cos(t),this.y=o,this.z=u*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new Vector3,_quaternion$4=new Quaternion$2;class Box3{constructor(t=new Vector3(1/0,1/0,1/0),o=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=o}set(t,o){return this.min.copy(t),this.max.copy(o),this}setFromArray(t){this.makeEmpty();for(let o=0,u=t.length;o<u;o+=3)this.expandByPoint(_vector$b.fromArray(t,o));return this}setFromBufferAttribute(t){this.makeEmpty();for(let o=0,u=t.count;o<u;o++)this.expandByPoint(_vector$b.fromBufferAttribute(t,o));return this}setFromPoints(t){this.makeEmpty();for(let o=0,u=t.length;o<u;o++)this.expandByPoint(t[o]);return this}setFromCenterAndSize(t,o){const u=_vector$b.copy(o).multiplyScalar(.5);return this.min.copy(t).sub(u),this.max.copy(t).add(u),this}setFromObject(t,o=!1){return this.makeEmpty(),this.expandByObject(t,o)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,o=!1){t.updateWorldMatrix(!1,!1);const u=t.geometry;if(u!==void 0){const C=u.getAttribute("position");if(o===!0&&C!==void 0&&t.isInstancedMesh!==!0)for(let I=0,f=C.count;I<f;I++)t.isMesh===!0?t.getVertexPosition(I,_vector$b):_vector$b.fromBufferAttribute(C,I),_vector$b.applyMatrix4(t.matrixWorld),this.expandByPoint(_vector$b);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),_box$4.copy(t.boundingBox)):(u.boundingBox===null&&u.computeBoundingBox(),_box$4.copy(u.boundingBox)),_box$4.applyMatrix4(t.matrixWorld),this.union(_box$4)}const d=t.children;for(let C=0,I=d.length;C<I;C++)this.expandByObject(d[C],o);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,o){return o.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,_vector$b),_vector$b.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let o,u;return t.normal.x>0?(o=t.normal.x*this.min.x,u=t.normal.x*this.max.x):(o=t.normal.x*this.max.x,u=t.normal.x*this.min.x),t.normal.y>0?(o+=t.normal.y*this.min.y,u+=t.normal.y*this.max.y):(o+=t.normal.y*this.max.y,u+=t.normal.y*this.min.y),t.normal.z>0?(o+=t.normal.z*this.min.z,u+=t.normal.z*this.max.z):(o+=t.normal.z*this.max.z,u+=t.normal.z*this.min.z),o<=-t.constant&&u>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(t.a,_center),_v1$7.subVectors(t.b,_center),_v2$4.subVectors(t.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let o=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(o,_v0$2,_v1$7,_v2$4,_extents)||(o=[1,0,0,0,1,0,0,0,1],!satForAxes(o,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),o=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(o,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(t,o){return o.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$b).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(_vector$b).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(n,t,o,u,d){for(let C=0,I=n.length-3;C<=I;C+=3){_testAxis.fromArray(n,C);const f=d.x*Math.abs(_testAxis.x)+d.y*Math.abs(_testAxis.y)+d.z*Math.abs(_testAxis.z),A=t.dot(_testAxis),y=o.dot(_testAxis),G=u.dot(_testAxis);if(Math.max(-Math.max(A,y,G),Math.min(A,y,G))>f)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;let Sphere$1=class{constructor(t=new Vector3,o=-1){this.isSphere=!0,this.center=t,this.radius=o}set(t,o){return this.center.copy(t),this.radius=o,this}setFromPoints(t,o){const u=this.center;o!==void 0?u.copy(o):_box$3.setFromPoints(t).getCenter(u);let d=0;for(let C=0,I=t.length;C<I;C++)d=Math.max(d,u.distanceToSquared(t[C]));return this.radius=Math.sqrt(d),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const o=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=o*o}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,o){const u=this.center.distanceToSquared(t);return o.copy(t),u>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;_v1$6.subVectors(t,this.center);const o=_v1$6.lengthSq();if(o>this.radius*this.radius){const u=Math.sqrt(o),d=(u-this.radius)*.5;this.center.addScaledVector(_v1$6,d/u),this.radius+=d}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(_v2$3.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(_v1$6.copy(t.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(t.center).sub(_v2$3))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}};const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$2=class{constructor(t=new Vector3,o=new Vector3(0,0,-1)){this.origin=t,this.direction=o}set(t,o){return this.origin.copy(t),this.direction.copy(o),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,o){return o.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$a)),this}closestPointToPoint(t,o){o.subVectors(t,this.origin);const u=o.dot(this.direction);return u<0?o.copy(this.origin):o.copy(this.origin).addScaledVector(this.direction,u)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const o=_vector$a.subVectors(t,this.origin).dot(this.direction);return o<0?this.origin.distanceToSquared(t):(_vector$a.copy(this.origin).addScaledVector(this.direction,o),_vector$a.distanceToSquared(t))}distanceSqToSegment(t,o,u,d){_segCenter.copy(t).add(o).multiplyScalar(.5),_segDir.copy(o).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const C=t.distanceTo(o)*.5,I=-this.direction.dot(_segDir),f=_diff.dot(this.direction),A=-_diff.dot(_segDir),y=_diff.lengthSq(),G=Math.abs(1-I*I);let S,w,M,V;if(G>0)if(S=I*A-f,w=I*f-A,V=C*G,S>=0)if(w>=-V)if(w<=V){const T=1/G;S*=T,w*=T,M=S*(S+I*w+2*f)+w*(I*S+w+2*A)+y}else w=C,S=Math.max(0,-(I*w+f)),M=-S*S+w*(w+2*A)+y;else w=-C,S=Math.max(0,-(I*w+f)),M=-S*S+w*(w+2*A)+y;else w<=-V?(S=Math.max(0,-(-I*C+f)),w=S>0?-C:Math.min(Math.max(-C,-A),C),M=-S*S+w*(w+2*A)+y):w<=V?(S=0,w=Math.min(Math.max(-C,-A),C),M=w*(w+2*A)+y):(S=Math.max(0,-(I*C+f)),w=S>0?C:Math.min(Math.max(-C,-A),C),M=-S*S+w*(w+2*A)+y);else w=I>0?-C:C,S=Math.max(0,-(I*w+f)),M=-S*S+w*(w+2*A)+y;return u&&u.copy(this.origin).addScaledVector(this.direction,S),d&&d.copy(_segCenter).addScaledVector(_segDir,w),M}intersectSphere(t,o){_vector$a.subVectors(t.center,this.origin);const u=_vector$a.dot(this.direction),d=_vector$a.dot(_vector$a)-u*u,C=t.radius*t.radius;if(d>C)return null;const I=Math.sqrt(C-d),f=u-I,A=u+I;return A<0?null:f<0?this.at(A,o):this.at(f,o)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const o=t.normal.dot(this.direction);if(o===0)return t.distanceToPoint(this.origin)===0?0:null;const u=-(this.origin.dot(t.normal)+t.constant)/o;return u>=0?u:null}intersectPlane(t,o){const u=this.distanceToPlane(t);return u===null?null:this.at(u,o)}intersectsPlane(t){const o=t.distanceToPoint(this.origin);return o===0||t.normal.dot(this.direction)*o<0}intersectBox(t,o){let u,d,C,I,f,A;const y=1/this.direction.x,G=1/this.direction.y,S=1/this.direction.z,w=this.origin;return y>=0?(u=(t.min.x-w.x)*y,d=(t.max.x-w.x)*y):(u=(t.max.x-w.x)*y,d=(t.min.x-w.x)*y),G>=0?(C=(t.min.y-w.y)*G,I=(t.max.y-w.y)*G):(C=(t.max.y-w.y)*G,I=(t.min.y-w.y)*G),u>I||C>d||((C>u||isNaN(u))&&(u=C),(I<d||isNaN(d))&&(d=I),S>=0?(f=(t.min.z-w.z)*S,A=(t.max.z-w.z)*S):(f=(t.max.z-w.z)*S,A=(t.min.z-w.z)*S),u>A||f>d)||((f>u||u!==u)&&(u=f),(A<d||d!==d)&&(d=A),d<0)?null:this.at(u>=0?u:d,o)}intersectsBox(t){return this.intersectBox(t,_vector$a)!==null}intersectTriangle(t,o,u,d,C){_edge1.subVectors(o,t),_edge2.subVectors(u,t),_normal$1.crossVectors(_edge1,_edge2);let I=this.direction.dot(_normal$1),f;if(I>0){if(d)return null;f=1}else if(I<0)f=-1,I=-I;else return null;_diff.subVectors(this.origin,t);const A=f*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(A<0)return null;const y=f*this.direction.dot(_edge1.cross(_diff));if(y<0||A+y>I)return null;const G=-f*_diff.dot(_normal$1);return G<0?null:this.at(G/I,C)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(t,o,u,d,C,I,f,A,y,G,S,w,M,V,T,H){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,o,u,d,C,I,f,A,y,G,S,w,M,V,T,H)}set(t,o,u,d,C,I,f,A,y,G,S,w,M,V,T,H){const J=this.elements;return J[0]=t,J[4]=o,J[8]=u,J[12]=d,J[1]=C,J[5]=I,J[9]=f,J[13]=A,J[2]=y,J[6]=G,J[10]=S,J[14]=w,J[3]=M,J[7]=V,J[11]=T,J[15]=H,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(t){const o=this.elements,u=t.elements;return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],this}copyPosition(t){const o=this.elements,u=t.elements;return o[12]=u[12],o[13]=u[13],o[14]=u[14],this}setFromMatrix3(t){const o=t.elements;return this.set(o[0],o[3],o[6],0,o[1],o[4],o[7],0,o[2],o[5],o[8],0,0,0,0,1),this}extractBasis(t,o,u){return t.setFromMatrixColumn(this,0),o.setFromMatrixColumn(this,1),u.setFromMatrixColumn(this,2),this}makeBasis(t,o,u){return this.set(t.x,o.x,u.x,0,t.y,o.y,u.y,0,t.z,o.z,u.z,0,0,0,0,1),this}extractRotation(t){const o=this.elements,u=t.elements,d=1/_v1$5.setFromMatrixColumn(t,0).length(),C=1/_v1$5.setFromMatrixColumn(t,1).length(),I=1/_v1$5.setFromMatrixColumn(t,2).length();return o[0]=u[0]*d,o[1]=u[1]*d,o[2]=u[2]*d,o[3]=0,o[4]=u[4]*C,o[5]=u[5]*C,o[6]=u[6]*C,o[7]=0,o[8]=u[8]*I,o[9]=u[9]*I,o[10]=u[10]*I,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromEuler(t){const o=this.elements,u=t.x,d=t.y,C=t.z,I=Math.cos(u),f=Math.sin(u),A=Math.cos(d),y=Math.sin(d),G=Math.cos(C),S=Math.sin(C);if(t.order==="XYZ"){const w=I*G,M=I*S,V=f*G,T=f*S;o[0]=A*G,o[4]=-A*S,o[8]=y,o[1]=M+V*y,o[5]=w-T*y,o[9]=-f*A,o[2]=T-w*y,o[6]=V+M*y,o[10]=I*A}else if(t.order==="YXZ"){const w=A*G,M=A*S,V=y*G,T=y*S;o[0]=w+T*f,o[4]=V*f-M,o[8]=I*y,o[1]=I*S,o[5]=I*G,o[9]=-f,o[2]=M*f-V,o[6]=T+w*f,o[10]=I*A}else if(t.order==="ZXY"){const w=A*G,M=A*S,V=y*G,T=y*S;o[0]=w-T*f,o[4]=-I*S,o[8]=V+M*f,o[1]=M+V*f,o[5]=I*G,o[9]=T-w*f,o[2]=-I*y,o[6]=f,o[10]=I*A}else if(t.order==="ZYX"){const w=I*G,M=I*S,V=f*G,T=f*S;o[0]=A*G,o[4]=V*y-M,o[8]=w*y+T,o[1]=A*S,o[5]=T*y+w,o[9]=M*y-V,o[2]=-y,o[6]=f*A,o[10]=I*A}else if(t.order==="YZX"){const w=I*A,M=I*y,V=f*A,T=f*y;o[0]=A*G,o[4]=T-w*S,o[8]=V*S+M,o[1]=S,o[5]=I*G,o[9]=-f*G,o[2]=-y*G,o[6]=M*S+V,o[10]=w-T*S}else if(t.order==="XZY"){const w=I*A,M=I*y,V=f*A,T=f*y;o[0]=A*G,o[4]=-S,o[8]=y*G,o[1]=w*S+T,o[5]=I*G,o[9]=M*S-V,o[2]=V*S-M,o[6]=f*G,o[10]=T*S+w}return o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,o,u){const d=this.elements;return _z.subVectors(t,o),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(u,_z),_x.lengthSq()===0&&(Math.abs(u.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(u,_z)),_x.normalize(),_y.crossVectors(_z,_x),d[0]=_x.x,d[4]=_y.x,d[8]=_z.x,d[1]=_x.y,d[5]=_y.y,d[9]=_z.y,d[2]=_x.z,d[6]=_y.z,d[10]=_z.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,o){const u=t.elements,d=o.elements,C=this.elements,I=u[0],f=u[4],A=u[8],y=u[12],G=u[1],S=u[5],w=u[9],M=u[13],V=u[2],T=u[6],H=u[10],J=u[14],z=u[3],L=u[7],K=u[11],O=u[15],Q=d[0],ee=d[4],ie=d[8],te=d[12],se=d[1],ae=d[5],le=d[9],ge=d[13],be=d[2],Xe=d[6],Ce=d[10],Re=d[14],Se=d[3],Ze=d[7],he=d[11],Ie=d[15];return C[0]=I*Q+f*se+A*be+y*Se,C[4]=I*ee+f*ae+A*Xe+y*Ze,C[8]=I*ie+f*le+A*Ce+y*he,C[12]=I*te+f*ge+A*Re+y*Ie,C[1]=G*Q+S*se+w*be+M*Se,C[5]=G*ee+S*ae+w*Xe+M*Ze,C[9]=G*ie+S*le+w*Ce+M*he,C[13]=G*te+S*ge+w*Re+M*Ie,C[2]=V*Q+T*se+H*be+J*Se,C[6]=V*ee+T*ae+H*Xe+J*Ze,C[10]=V*ie+T*le+H*Ce+J*he,C[14]=V*te+T*ge+H*Re+J*Ie,C[3]=z*Q+L*se+K*be+O*Se,C[7]=z*ee+L*ae+K*Xe+O*Ze,C[11]=z*ie+L*le+K*Ce+O*he,C[15]=z*te+L*ge+K*Re+O*Ie,this}multiplyScalar(t){const o=this.elements;return o[0]*=t,o[4]*=t,o[8]*=t,o[12]*=t,o[1]*=t,o[5]*=t,o[9]*=t,o[13]*=t,o[2]*=t,o[6]*=t,o[10]*=t,o[14]*=t,o[3]*=t,o[7]*=t,o[11]*=t,o[15]*=t,this}determinant(){const t=this.elements,o=t[0],u=t[4],d=t[8],C=t[12],I=t[1],f=t[5],A=t[9],y=t[13],G=t[2],S=t[6],w=t[10],M=t[14],V=t[3],T=t[7],H=t[11],J=t[15];return V*(+C*A*S-d*y*S-C*f*w+u*y*w+d*f*M-u*A*M)+T*(+o*A*M-o*y*w+C*I*w-d*I*M+d*y*G-C*A*G)+H*(+o*y*S-o*f*M-C*I*S+u*I*M+C*f*G-u*y*G)+J*(-d*f*G-o*A*S+o*f*w+d*I*S-u*I*w+u*A*G)}transpose(){const t=this.elements;let o;return o=t[1],t[1]=t[4],t[4]=o,o=t[2],t[2]=t[8],t[8]=o,o=t[6],t[6]=t[9],t[9]=o,o=t[3],t[3]=t[12],t[12]=o,o=t[7],t[7]=t[13],t[13]=o,o=t[11],t[11]=t[14],t[14]=o,this}setPosition(t,o,u){const d=this.elements;return t.isVector3?(d[12]=t.x,d[13]=t.y,d[14]=t.z):(d[12]=t,d[13]=o,d[14]=u),this}invert(){const t=this.elements,o=t[0],u=t[1],d=t[2],C=t[3],I=t[4],f=t[5],A=t[6],y=t[7],G=t[8],S=t[9],w=t[10],M=t[11],V=t[12],T=t[13],H=t[14],J=t[15],z=S*H*y-T*w*y+T*A*M-f*H*M-S*A*J+f*w*J,L=V*w*y-G*H*y-V*A*M+I*H*M+G*A*J-I*w*J,K=G*T*y-V*S*y+V*f*M-I*T*M-G*f*J+I*S*J,O=V*S*A-G*T*A-V*f*w+I*T*w+G*f*H-I*S*H,Q=o*z+u*L+d*K+C*O;if(Q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ee=1/Q;return t[0]=z*ee,t[1]=(T*w*C-S*H*C-T*d*M+u*H*M+S*d*J-u*w*J)*ee,t[2]=(f*H*C-T*A*C+T*d*y-u*H*y-f*d*J+u*A*J)*ee,t[3]=(S*A*C-f*w*C-S*d*y+u*w*y+f*d*M-u*A*M)*ee,t[4]=L*ee,t[5]=(G*H*C-V*w*C+V*d*M-o*H*M-G*d*J+o*w*J)*ee,t[6]=(V*A*C-I*H*C-V*d*y+o*H*y+I*d*J-o*A*J)*ee,t[7]=(I*w*C-G*A*C+G*d*y-o*w*y-I*d*M+o*A*M)*ee,t[8]=K*ee,t[9]=(V*S*C-G*T*C-V*u*M+o*T*M+G*u*J-o*S*J)*ee,t[10]=(I*T*C-V*f*C+V*u*y-o*T*y-I*u*J+o*f*J)*ee,t[11]=(G*f*C-I*S*C-G*u*y+o*S*y+I*u*M-o*f*M)*ee,t[12]=O*ee,t[13]=(G*T*d-V*S*d+V*u*w-o*T*w-G*u*H+o*S*H)*ee,t[14]=(V*f*d-I*T*d-V*u*A+o*T*A+I*u*H-o*f*H)*ee,t[15]=(I*S*d-G*f*d+G*u*A-o*S*A-I*u*w+o*f*w)*ee,this}scale(t){const o=this.elements,u=t.x,d=t.y,C=t.z;return o[0]*=u,o[4]*=d,o[8]*=C,o[1]*=u,o[5]*=d,o[9]*=C,o[2]*=u,o[6]*=d,o[10]*=C,o[3]*=u,o[7]*=d,o[11]*=C,this}getMaxScaleOnAxis(){const t=this.elements,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],u=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],d=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(o,u,d))}makeTranslation(t,o,u){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,o,0,0,1,u,0,0,0,1),this}makeRotationX(t){const o=Math.cos(t),u=Math.sin(t);return this.set(1,0,0,0,0,o,-u,0,0,u,o,0,0,0,0,1),this}makeRotationY(t){const o=Math.cos(t),u=Math.sin(t);return this.set(o,0,u,0,0,1,0,0,-u,0,o,0,0,0,0,1),this}makeRotationZ(t){const o=Math.cos(t),u=Math.sin(t);return this.set(o,-u,0,0,u,o,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,o){const u=Math.cos(o),d=Math.sin(o),C=1-u,I=t.x,f=t.y,A=t.z,y=C*I,G=C*f;return this.set(y*I+u,y*f-d*A,y*A+d*f,0,y*f+d*A,G*f+u,G*A-d*I,0,y*A-d*f,G*A+d*I,C*A*A+u,0,0,0,0,1),this}makeScale(t,o,u){return this.set(t,0,0,0,0,o,0,0,0,0,u,0,0,0,0,1),this}makeShear(t,o,u,d,C,I){return this.set(1,u,C,0,t,1,I,0,o,d,1,0,0,0,0,1),this}compose(t,o,u){const d=this.elements,C=o._x,I=o._y,f=o._z,A=o._w,y=C+C,G=I+I,S=f+f,w=C*y,M=C*G,V=C*S,T=I*G,H=I*S,J=f*S,z=A*y,L=A*G,K=A*S,O=u.x,Q=u.y,ee=u.z;return d[0]=(1-(T+J))*O,d[1]=(M+K)*O,d[2]=(V-L)*O,d[3]=0,d[4]=(M-K)*Q,d[5]=(1-(w+J))*Q,d[6]=(H+z)*Q,d[7]=0,d[8]=(V+L)*ee,d[9]=(H-z)*ee,d[10]=(1-(w+T))*ee,d[11]=0,d[12]=t.x,d[13]=t.y,d[14]=t.z,d[15]=1,this}decompose(t,o,u){const d=this.elements;let C=_v1$5.set(d[0],d[1],d[2]).length();const I=_v1$5.set(d[4],d[5],d[6]).length(),f=_v1$5.set(d[8],d[9],d[10]).length();this.determinant()<0&&(C=-C),t.x=d[12],t.y=d[13],t.z=d[14],_m1$2.copy(this);const y=1/C,G=1/I,S=1/f;return _m1$2.elements[0]*=y,_m1$2.elements[1]*=y,_m1$2.elements[2]*=y,_m1$2.elements[4]*=G,_m1$2.elements[5]*=G,_m1$2.elements[6]*=G,_m1$2.elements[8]*=S,_m1$2.elements[9]*=S,_m1$2.elements[10]*=S,o.setFromRotationMatrix(_m1$2),u.x=C,u.y=I,u.z=f,this}makePerspective(t,o,u,d,C,I,f=WebGLCoordinateSystem){const A=this.elements,y=2*C/(o-t),G=2*C/(u-d),S=(o+t)/(o-t),w=(u+d)/(u-d);let M,V;if(f===WebGLCoordinateSystem)M=-(I+C)/(I-C),V=-2*I*C/(I-C);else if(f===WebGPUCoordinateSystem)M=-I/(I-C),V=-I*C/(I-C);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+f);return A[0]=y,A[4]=0,A[8]=S,A[12]=0,A[1]=0,A[5]=G,A[9]=w,A[13]=0,A[2]=0,A[6]=0,A[10]=M,A[14]=V,A[3]=0,A[7]=0,A[11]=-1,A[15]=0,this}makeOrthographic(t,o,u,d,C,I,f=WebGLCoordinateSystem){const A=this.elements,y=1/(o-t),G=1/(u-d),S=1/(I-C),w=(o+t)*y,M=(u+d)*G;let V,T;if(f===WebGLCoordinateSystem)V=(I+C)*S,T=-2*S;else if(f===WebGPUCoordinateSystem)V=C*S,T=-1*S;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+f);return A[0]=2*y,A[4]=0,A[8]=0,A[12]=-w,A[1]=0,A[5]=2*G,A[9]=0,A[13]=-M,A[2]=0,A[6]=0,A[10]=T,A[14]=-V,A[3]=0,A[7]=0,A[11]=0,A[15]=1,this}equals(t){const o=this.elements,u=t.elements;for(let d=0;d<16;d++)if(o[d]!==u[d])return!1;return!0}fromArray(t,o=0){for(let u=0;u<16;u++)this.elements[u]=t[u+o];return this}toArray(t=[],o=0){const u=this.elements;return t[o]=u[0],t[o+1]=u[1],t[o+2]=u[2],t[o+3]=u[3],t[o+4]=u[4],t[o+5]=u[5],t[o+6]=u[6],t[o+7]=u[7],t[o+8]=u[8],t[o+9]=u[9],t[o+10]=u[10],t[o+11]=u[11],t[o+12]=u[12],t[o+13]=u[13],t[o+14]=u[14],t[o+15]=u[15],t}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion$2;class Euler{constructor(t=0,o=0,u=0,d=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=o,this._z=u,this._order=d}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,o,u,d=this._order){return this._x=t,this._y=o,this._z=u,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,o=this._order,u=!0){const d=t.elements,C=d[0],I=d[4],f=d[8],A=d[1],y=d[5],G=d[9],S=d[2],w=d[6],M=d[10];switch(o){case"XYZ":this._y=Math.asin(clamp$1(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-G,M),this._z=Math.atan2(-I,C)):(this._x=Math.atan2(w,y),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$1(G,-1,1)),Math.abs(G)<.9999999?(this._y=Math.atan2(f,M),this._z=Math.atan2(A,y)):(this._y=Math.atan2(-S,C),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$1(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(-S,M),this._z=Math.atan2(-I,y)):(this._y=0,this._z=Math.atan2(A,C));break;case"ZYX":this._y=Math.asin(-clamp$1(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(w,M),this._z=Math.atan2(A,C)):(this._x=0,this._z=Math.atan2(-I,y));break;case"YZX":this._z=Math.asin(clamp$1(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-G,y),this._y=Math.atan2(-S,C)):(this._x=0,this._y=Math.atan2(f,M));break;case"XZY":this._z=Math.asin(-clamp$1(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(w,y),this._y=Math.atan2(f,C)):(this._x=Math.atan2(-G,M),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+o)}return this._order=o,u===!0&&this._onChangeCallback(),this}setFromQuaternion(t,o,u){return _matrix$2.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix$2,o,u)}setFromVector3(t,o=this._order){return this.set(t.x,t.y,t.z,o)}reorder(t){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],o=0){return t[o]=this._x,t[o+1]=this._y,t[o+2]=this._z,t[o+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$2,_m1$1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$2,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher$1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const t=new Vector3,o=new Euler,u=new Quaternion$2,d=new Vector3(1,1,1);function C(){u.setFromEuler(o,!1)}function I(){o.setFromQuaternion(u,void 0,!1)}o._onChange(C),u._onChange(I),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:o},quaternion:{configurable:!0,enumerable:!0,value:u},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,o){this.quaternion.setFromAxisAngle(t,o)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,o){return _q1.setFromAxisAngle(t,o),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(t,o){return _q1.setFromAxisAngle(t,o),this.quaternion.premultiply(_q1),this}rotateX(t){return this.rotateOnAxis(_xAxis,t)}rotateY(t){return this.rotateOnAxis(_yAxis,t)}rotateZ(t){return this.rotateOnAxis(_zAxis,t)}translateOnAxis(t,o){return _v1$4.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(o)),this}translateX(t){return this.translateOnAxis(_xAxis,t)}translateY(t){return this.translateOnAxis(_yAxis,t)}translateZ(t){return this.translateOnAxis(_zAxis,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(_m1$1$1.copy(this.matrixWorld).invert())}lookAt(t,o,u){t.isVector3?_target.copy(t):_target.set(t,o,u);const d=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1$1.lookAt(_position$3,_target,this.up):_m1$1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1$1),d&&(_m1$1$1.extractRotation(d.matrixWorld),_q1.setFromRotationMatrix(_m1$1$1),this.quaternion.premultiply(_q1.invert()))}add(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.add(arguments[o]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.remove(arguments[u]);return this}const o=this.children.indexOf(t);return o!==-1&&(t.parent=null,this.children.splice(o,1),t.dispatchEvent(_removedEvent),_childremovedEvent.child=t,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),_m1$1$1.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),_m1$1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1$1),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,o){if(this[t]===o)return this;for(let u=0,d=this.children.length;u<d;u++){const I=this.children[u].getObjectByProperty(t,o);if(I!==void 0)return I}}getObjectsByProperty(t,o,u=[]){this[t]===o&&u.push(this);const d=this.children;for(let C=0,I=d.length;C<I;C++)d[C].getObjectsByProperty(t,o,u);return u}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,t,_scale$2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const o=this.matrixWorld.elements;return t.set(o[8],o[9],o[10]).normalize()}raycast(){}traverse(t){t(this);const o=this.children;for(let u=0,d=o.length;u<d;u++)o[u].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const o=this.children;for(let u=0,d=o.length;u<d;u++)o[u].traverseVisible(t)}traverseAncestors(t){const o=this.parent;o!==null&&(t(o),o.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const o=this.children;for(let u=0,d=o.length;u<d;u++)o[u].updateMatrixWorld(t)}updateWorldMatrix(t,o){const u=this.parent;if(t===!0&&u!==null&&u.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),o===!0){const d=this.children;for(let C=0,I=d.length;C<I;C++)d[C].updateWorldMatrix(!1,!0)}}toJSON(t){const o=t===void 0||typeof t=="string",u={};o&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},u.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const d={};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(d.type="BatchedMesh",d.perObjectFrustumCulled=this.perObjectFrustumCulled,d.sortObjects=this.sortObjects,d.drawRanges=this._drawRanges,d.reservedRanges=this._reservedRanges,d.visibility=this._visibility,d.active=this._active,d.bounds=this._bounds.map(f=>({boxInitialized:f.boxInitialized,boxMin:f.box.min.toArray(),boxMax:f.box.max.toArray(),sphereInitialized:f.sphereInitialized,sphereRadius:f.sphere.radius,sphereCenter:f.sphere.center.toArray()})),d.maxInstanceCount=this._maxInstanceCount,d.maxVertexCount=this._maxVertexCount,d.maxIndexCount=this._maxIndexCount,d.geometryInitialized=this._geometryInitialized,d.geometryCount=this._geometryCount,d.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(d.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(d.boundingSphere={center:d.boundingSphere.center.toArray(),radius:d.boundingSphere.radius}),this.boundingBox!==null&&(d.boundingBox={min:d.boundingBox.min.toArray(),max:d.boundingBox.max.toArray()}));function C(f,A){return f[A.uuid]===void 0&&(f[A.uuid]=A.toJSON(t)),A.uuid}if(this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(d.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=C(t.geometries,this.geometry);const f=this.geometry.parameters;if(f!==void 0&&f.shapes!==void 0){const A=f.shapes;if(Array.isArray(A))for(let y=0,G=A.length;y<G;y++){const S=A[y];C(t.shapes,S)}else C(t.shapes,A)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(C(t.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const f=[];for(let A=0,y=this.material.length;A<y;A++)f.push(C(t.materials,this.material[A]));d.material=f}else d.material=C(t.materials,this.material);if(this.children.length>0){d.children=[];for(let f=0;f<this.children.length;f++)d.children.push(this.children[f].toJSON(t).object)}if(this.animations.length>0){d.animations=[];for(let f=0;f<this.animations.length;f++){const A=this.animations[f];d.animations.push(C(t.animations,A))}}if(o){const f=I(t.geometries),A=I(t.materials),y=I(t.textures),G=I(t.images),S=I(t.shapes),w=I(t.skeletons),M=I(t.animations),V=I(t.nodes);f.length>0&&(u.geometries=f),A.length>0&&(u.materials=A),y.length>0&&(u.textures=y),G.length>0&&(u.images=G),S.length>0&&(u.shapes=S),w.length>0&&(u.skeletons=w),M.length>0&&(u.animations=M),V.length>0&&(u.nodes=V)}return u.object=d,u;function I(f){const A=[];for(const y in f){const G=f[y];delete G.metadata,A.push(G)}return A}}clone(t){return new this.constructor().copy(this,t)}copy(t,o=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),o===!0)for(let u=0;u<t.children.length;u++){const d=t.children[u];this.add(d.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$2=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;class Triangle{constructor(t=new Vector3,o=new Vector3,u=new Vector3){this.a=t,this.b=o,this.c=u}static getNormal(t,o,u,d){d.subVectors(u,o),_v0$1.subVectors(t,o),d.cross(_v0$1);const C=d.lengthSq();return C>0?d.multiplyScalar(1/Math.sqrt(C)):d.set(0,0,0)}static getBarycoord(t,o,u,d,C){_v0$1.subVectors(d,o),_v1$3.subVectors(u,o),_v2$2.subVectors(t,o);const I=_v0$1.dot(_v0$1),f=_v0$1.dot(_v1$3),A=_v0$1.dot(_v2$2),y=_v1$3.dot(_v1$3),G=_v1$3.dot(_v2$2),S=I*y-f*f;if(S===0)return C.set(0,0,0),null;const w=1/S,M=(y*A-f*G)*w,V=(I*G-f*A)*w;return C.set(1-M-V,V,M)}static containsPoint(t,o,u,d){return this.getBarycoord(t,o,u,d,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(t,o,u,d,C,I,f,A){return this.getBarycoord(t,o,u,d,_v3$2)===null?(A.x=0,A.y=0,"z"in A&&(A.z=0),"w"in A&&(A.w=0),null):(A.setScalar(0),A.addScaledVector(C,_v3$2.x),A.addScaledVector(I,_v3$2.y),A.addScaledVector(f,_v3$2.z),A)}static getInterpolatedAttribute(t,o,u,d,C,I){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(t,o),_v41.fromBufferAttribute(t,u),_v42.fromBufferAttribute(t,d),I.setScalar(0),I.addScaledVector(_v40,C.x),I.addScaledVector(_v41,C.y),I.addScaledVector(_v42,C.z),I}static isFrontFacing(t,o,u,d){return _v0$1.subVectors(u,o),_v1$3.subVectors(t,o),_v0$1.cross(_v1$3).dot(d)<0}set(t,o,u){return this.a.copy(t),this.b.copy(o),this.c.copy(u),this}setFromPointsAndIndices(t,o,u,d){return this.a.copy(t[o]),this.b.copy(t[u]),this.c.copy(t[d]),this}setFromAttributeAndIndices(t,o,u,d){return this.a.fromBufferAttribute(t,o),this.b.fromBufferAttribute(t,u),this.c.fromBufferAttribute(t,d),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,o){return Triangle.getBarycoord(t,this.a,this.b,this.c,o)}getInterpolation(t,o,u,d,C){return Triangle.getInterpolation(t,this.a,this.b,this.c,o,u,d,C)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,o){const u=this.a,d=this.b,C=this.c;let I,f;_vab.subVectors(d,u),_vac.subVectors(C,u),_vap.subVectors(t,u);const A=_vab.dot(_vap),y=_vac.dot(_vap);if(A<=0&&y<=0)return o.copy(u);_vbp.subVectors(t,d);const G=_vab.dot(_vbp),S=_vac.dot(_vbp);if(G>=0&&S<=G)return o.copy(d);const w=A*S-G*y;if(w<=0&&A>=0&&G<=0)return I=A/(A-G),o.copy(u).addScaledVector(_vab,I);_vcp.subVectors(t,C);const M=_vab.dot(_vcp),V=_vac.dot(_vcp);if(V>=0&&M<=V)return o.copy(C);const T=M*y-A*V;if(T<=0&&y>=0&&V<=0)return f=y/(y-V),o.copy(u).addScaledVector(_vac,f);const H=G*V-M*S;if(H<=0&&S-G>=0&&M-V>=0)return _vbc.subVectors(C,d),f=(S-G)/(S-G+(M-V)),o.copy(d).addScaledVector(_vbc,f);const J=1/(H+T+w);return I=T*J,f=w*J,o.copy(u).addScaledVector(_vab,I).addScaledVector(_vac,f)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(n,t,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?n+(t-n)*6*o:o<1/2?t:o<2/3?n+(t-n)*6*(2/3-o):n}class Color{constructor(t,o,u){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,o,u)}set(t,o,u){if(o===void 0&&u===void 0){const d=t;d&&d.isColor?this.copy(d):typeof d=="number"?this.setHex(d):typeof d=="string"&&this.setStyle(d)}else this.setRGB(t,o,u);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,o=SRGBColorSpace){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ColorManagement.toWorkingColorSpace(this,o),this}setRGB(t,o,u,d=ColorManagement.workingColorSpace){return this.r=t,this.g=o,this.b=u,ColorManagement.toWorkingColorSpace(this,d),this}setHSL(t,o,u,d=ColorManagement.workingColorSpace){if(t=euclideanModulo(t,1),o=clamp$1(o,0,1),u=clamp$1(u,0,1),o===0)this.r=this.g=this.b=u;else{const C=u<=.5?u*(1+o):u+o-u*o,I=2*u-C;this.r=hue2rgb(I,C,t+1/3),this.g=hue2rgb(I,C,t),this.b=hue2rgb(I,C,t-1/3)}return ColorManagement.toWorkingColorSpace(this,d),this}setStyle(t,o=SRGBColorSpace){function u(C){C!==void 0&&parseFloat(C)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let d;if(d=/^(\w+)\(([^\)]*)\)/.exec(t)){let C;const I=d[1],f=d[2];switch(I){case"rgb":case"rgba":if(C=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return u(C[4]),this.setRGB(Math.min(255,parseInt(C[1],10))/255,Math.min(255,parseInt(C[2],10))/255,Math.min(255,parseInt(C[3],10))/255,o);if(C=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return u(C[4]),this.setRGB(Math.min(100,parseInt(C[1],10))/100,Math.min(100,parseInt(C[2],10))/100,Math.min(100,parseInt(C[3],10))/100,o);break;case"hsl":case"hsla":if(C=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return u(C[4]),this.setHSL(parseFloat(C[1])/360,parseFloat(C[2])/100,parseFloat(C[3])/100,o);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(t)){const C=d[1],I=C.length;if(I===3)return this.setRGB(parseInt(C.charAt(0),16)/15,parseInt(C.charAt(1),16)/15,parseInt(C.charAt(2),16)/15,o);if(I===6)return this.setHex(parseInt(C,16),o);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,o);return this}setColorName(t,o=SRGBColorSpace){const u=_colorKeywords[t.toLowerCase()];return u!==void 0?this.setHex(u,o):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),Math.round(clamp$1(_color.r*255,0,255))*65536+Math.round(clamp$1(_color.g*255,0,255))*256+Math.round(clamp$1(_color.b*255,0,255))}getHexString(t=SRGBColorSpace){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,o=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),o);const u=_color.r,d=_color.g,C=_color.b,I=Math.max(u,d,C),f=Math.min(u,d,C);let A,y;const G=(f+I)/2;if(f===I)A=0,y=0;else{const S=I-f;switch(y=G<=.5?S/(I+f):S/(2-I-f),I){case u:A=(d-C)/S+(d<C?6:0);break;case d:A=(C-u)/S+2;break;case C:A=(u-d)/S+4;break}A/=6}return t.h=A,t.s=y,t.l=G,t}getRGB(t,o=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),o),t.r=_color.r,t.g=_color.g,t.b=_color.b,t}getStyle(t=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const o=_color.r,u=_color.g,d=_color.b;return t!==SRGBColorSpace?`color(${t} ${o.toFixed(3)} ${u.toFixed(3)} ${d.toFixed(3)})`:`rgb(${Math.round(o*255)},${Math.round(u*255)},${Math.round(d*255)})`}offsetHSL(t,o,u){return this.getHSL(_hslA),this.setHSL(_hslA.h+t,_hslA.s+o,_hslA.l+u)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,o){return this.r=t.r+o.r,this.g=t.g+o.g,this.b=t.b+o.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,o){return this.r+=(t.r-this.r)*o,this.g+=(t.g-this.g)*o,this.b+=(t.b-this.b)*o,this}lerpColors(t,o,u){return this.r=t.r+(o.r-t.r)*u,this.g=t.g+(o.g-t.g)*u,this.b=t.b+(o.b-t.b)*u,this}lerpHSL(t,o){this.getHSL(_hslA),t.getHSL(_hslB);const u=lerp(_hslA.h,_hslB.h,o),d=lerp(_hslA.s,_hslB.s,o),C=lerp(_hslA.l,_hslB.l,o);return this.setHSL(u,d,C),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const o=this.r,u=this.g,d=this.b,C=t.elements;return this.r=C[0]*o+C[3]*u+C[6]*d,this.g=C[1]*o+C[4]*u+C[7]*d,this.b=C[2]*o+C[5]*u+C[8]*d,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,o=0){return this.r=t[o],this.g=t[o+1],this.b=t[o+2],this}toArray(t=[],o=0){return t[o]=this.r,t[o+1]=this.g,t[o+2]=this.b,t}fromBufferAttribute(t,o){return this.r=t.getX(o),this.g=t.getY(o),this.b=t.getZ(o),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher$1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const o in t){const u=t[o];if(u===void 0){console.warn(`THREE.Material: parameter '${o}' has value of undefined.`);continue}const d=this[o];if(d===void 0){console.warn(`THREE.Material: '${o}' is not a property of THREE.${this.type}.`);continue}d&&d.isColor?d.set(u):d&&d.isVector3&&u&&u.isVector3?d.copy(u):this[o]=u}}toJSON(t){const o=t===void 0||typeof t=="string";o&&(t={textures:{},images:{}});const u={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.color&&this.color.isColor&&(u.color=this.color.getHex()),this.roughness!==void 0&&(u.roughness=this.roughness),this.metalness!==void 0&&(u.metalness=this.metalness),this.sheen!==void 0&&(u.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(u.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(u.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(u.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(u.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(u.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(u.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(u.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(u.shininess=this.shininess),this.clearcoat!==void 0&&(u.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(u.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(u.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(u.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,u.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(u.dispersion=this.dispersion),this.iridescence!==void 0&&(u.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(u.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(u.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(u.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(u.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(u.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(u.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(u.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(u.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(u.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(u.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(u.lightMap=this.lightMap.toJSON(t).uuid,u.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(u.aoMap=this.aoMap.toJSON(t).uuid,u.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(u.bumpMap=this.bumpMap.toJSON(t).uuid,u.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(u.normalMap=this.normalMap.toJSON(t).uuid,u.normalMapType=this.normalMapType,u.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(u.displacementMap=this.displacementMap.toJSON(t).uuid,u.displacementScale=this.displacementScale,u.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(u.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(u.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(u.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(u.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(u.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(u.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(u.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(u.combine=this.combine)),this.envMapRotation!==void 0&&(u.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(u.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(u.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(u.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(u.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(u.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(u.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(u.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(u.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(u.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(u.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(u.size=this.size),this.shadowSide!==null&&(u.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(u.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(u.blending=this.blending),this.side!==FrontSide&&(u.side=this.side),this.vertexColors===!0&&(u.vertexColors=!0),this.opacity<1&&(u.opacity=this.opacity),this.transparent===!0&&(u.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(u.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(u.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(u.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(u.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(u.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(u.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(u.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(u.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(u.depthFunc=this.depthFunc),this.depthTest===!1&&(u.depthTest=this.depthTest),this.depthWrite===!1&&(u.depthWrite=this.depthWrite),this.colorWrite===!1&&(u.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(u.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(u.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(u.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(u.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(u.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(u.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(u.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(u.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(u.rotation=this.rotation),this.polygonOffset===!0&&(u.polygonOffset=!0),this.polygonOffsetFactor!==0&&(u.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(u.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(u.linewidth=this.linewidth),this.dashSize!==void 0&&(u.dashSize=this.dashSize),this.gapSize!==void 0&&(u.gapSize=this.gapSize),this.scale!==void 0&&(u.scale=this.scale),this.dithering===!0&&(u.dithering=!0),this.alphaTest>0&&(u.alphaTest=this.alphaTest),this.alphaHash===!0&&(u.alphaHash=!0),this.alphaToCoverage===!0&&(u.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(u.premultipliedAlpha=!0),this.forceSinglePass===!0&&(u.forceSinglePass=!0),this.wireframe===!0&&(u.wireframe=!0),this.wireframeLinewidth>1&&(u.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(u.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(u.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(u.flatShading=!0),this.visible===!1&&(u.visible=!1),this.toneMapped===!1&&(u.toneMapped=!1),this.fog===!1&&(u.fog=!1),Object.keys(this.userData).length>0&&(u.userData=this.userData);function d(C){const I=[];for(const f in C){const A=C[f];delete A.metadata,I.push(A)}return I}if(o){const C=d(t.textures),I=d(t.images);C.length>0&&(u.textures=C),I.length>0&&(u.images=I)}return u}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const o=t.clippingPlanes;let u=null;if(o!==null){const d=o.length;u=new Array(d);for(let C=0;C!==d;++C)u[C]=o[C].clone()}return this.clippingPlanes=u,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _tables=_generateTables();function _generateTables(){const n=new ArrayBuffer(4),t=new Float32Array(n),o=new Uint32Array(n),u=new Uint32Array(512),d=new Uint32Array(512);for(let A=0;A<256;++A){const y=A-127;y<-27?(u[A]=0,u[A|256]=32768,d[A]=24,d[A|256]=24):y<-14?(u[A]=1024>>-y-14,u[A|256]=1024>>-y-14|32768,d[A]=-y-1,d[A|256]=-y-1):y<=15?(u[A]=y+15<<10,u[A|256]=y+15<<10|32768,d[A]=13,d[A|256]=13):y<128?(u[A]=31744,u[A|256]=64512,d[A]=24,d[A|256]=24):(u[A]=31744,u[A|256]=64512,d[A]=13,d[A|256]=13)}const C=new Uint32Array(2048),I=new Uint32Array(64),f=new Uint32Array(64);for(let A=1;A<1024;++A){let y=A<<13,G=0;for(;(y&8388608)===0;)y<<=1,G-=8388608;y&=-8388609,G+=947912704,C[A]=y|G}for(let A=1024;A<2048;++A)C[A]=939524096+(A-1024<<13);for(let A=1;A<31;++A)I[A]=A<<23;I[31]=1199570944,I[32]=2147483648;for(let A=33;A<63;++A)I[A]=2147483648+(A-32<<23);I[63]=3347054592;for(let A=1;A<64;++A)A!==32&&(f[A]=1024);return{floatView:t,uint32View:o,baseTable:u,shiftTable:d,mantissaTable:C,exponentTable:I,offsetTable:f}}function toHalfFloat(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=clamp$1(n,-65504,65504),_tables.floatView[0]=n;const t=_tables.uint32View[0],o=t>>23&511;return _tables.baseTable[o]+((t&8388607)>>_tables.shiftTable[o])}function fromHalfFloat(n){const t=n>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[t]+(n&1023)]+_tables.exponentTable[t],_tables.floatView[0]}class DataUtils{static toHalfFloat(t){return toHalfFloat(t)}static fromHalfFloat(t){return fromHalfFloat(t)}}const _vector$9=new Vector3,_vector2$1=new Vector2;let _id$2=0;class BufferAttribute{constructor(t,o,u=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=t,this.itemSize=o,this.count=t!==void 0?t.length/o:0,this.normalized=u,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,o){this.updateRanges.push({start:t,count:o})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,o,u){t*=this.itemSize,u*=o.itemSize;for(let d=0,C=this.itemSize;d<C;d++)this.array[t+d]=o.array[u+d];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let o=0,u=this.count;o<u;o++)_vector2$1.fromBufferAttribute(this,o),_vector2$1.applyMatrix3(t),this.setXY(o,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let o=0,u=this.count;o<u;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyMatrix3(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(t){for(let o=0,u=this.count;o<u;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyMatrix4(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(t){for(let o=0,u=this.count;o<u;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.applyNormalMatrix(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(t){for(let o=0,u=this.count;o<u;o++)_vector$9.fromBufferAttribute(this,o),_vector$9.transformDirection(t),this.setXYZ(o,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(t,o=0){return this.array.set(t,o),this}getComponent(t,o){let u=this.array[t*this.itemSize+o];return this.normalized&&(u=denormalize(u,this.array)),u}setComponent(t,o,u){return this.normalized&&(u=normalize(u,this.array)),this.array[t*this.itemSize+o]=u,this}getX(t){let o=this.array[t*this.itemSize];return this.normalized&&(o=denormalize(o,this.array)),o}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize]=o,this}getY(t){let o=this.array[t*this.itemSize+1];return this.normalized&&(o=denormalize(o,this.array)),o}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+1]=o,this}getZ(t){let o=this.array[t*this.itemSize+2];return this.normalized&&(o=denormalize(o,this.array)),o}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+2]=o,this}getW(t){let o=this.array[t*this.itemSize+3];return this.normalized&&(o=denormalize(o,this.array)),o}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+3]=o,this}setXY(t,o,u){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array)),this.array[t+0]=o,this.array[t+1]=u,this}setXYZ(t,o,u,d){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.array[t+0]=o,this.array[t+1]=u,this.array[t+2]=d,this}setXYZW(t,o,u,d,C){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array),C=normalize(C,this.array)),this.array[t+0]=o,this.array[t+1]=u,this.array[t+2]=d,this.array[t+3]=C,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==StaticDrawUsage&&(t.usage=this.usage),t}}class Int8BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Int8Array(t),o,u)}}class Uint8BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Uint8Array(t),o,u)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Uint8ClampedArray(t),o,u)}}class Int16BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Int16Array(t),o,u)}}class Uint16BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Uint16Array(t),o,u)}}class Int32BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Int32Array(t),o,u)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Uint32Array(t),o,u)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Uint16Array(t),o,u),this.isFloat16BufferAttribute=!0}getX(t){let o=fromHalfFloat(this.array[t*this.itemSize]);return this.normalized&&(o=denormalize(o,this.array)),o}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize]=toHalfFloat(o),this}getY(t){let o=fromHalfFloat(this.array[t*this.itemSize+1]);return this.normalized&&(o=denormalize(o,this.array)),o}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+1]=toHalfFloat(o),this}getZ(t){let o=fromHalfFloat(this.array[t*this.itemSize+2]);return this.normalized&&(o=denormalize(o,this.array)),o}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+2]=toHalfFloat(o),this}getW(t){let o=fromHalfFloat(this.array[t*this.itemSize+3]);return this.normalized&&(o=denormalize(o,this.array)),o}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.array[t*this.itemSize+3]=toHalfFloat(o),this}setXY(t,o,u){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(u),this}setXYZ(t,o,u,d){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(u),this.array[t+2]=toHalfFloat(d),this}setXYZW(t,o,u,d,C){return t*=this.itemSize,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array),C=normalize(C,this.array)),this.array[t+0]=toHalfFloat(o),this.array[t+1]=toHalfFloat(u),this.array[t+2]=toHalfFloat(d),this.array[t+3]=toHalfFloat(C),this}}class Float32BufferAttribute extends BufferAttribute{constructor(t,o,u){super(new Float32Array(t),o,u)}}let _id$1=0;const _m1$3=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher$1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayNeedsUint32(t)?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,o){return this.attributes[t]=o,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,o,u=0){this.groups.push({start:t,count:o,materialIndex:u})}clearGroups(){this.groups=[]}setDrawRange(t,o){this.drawRange.start=t,this.drawRange.count=o}applyMatrix4(t){const o=this.attributes.position;o!==void 0&&(o.applyMatrix4(t),o.needsUpdate=!0);const u=this.attributes.normal;if(u!==void 0){const C=new Matrix3().getNormalMatrix(t);u.applyNormalMatrix(C),u.needsUpdate=!0}const d=this.attributes.tangent;return d!==void 0&&(d.transformDirection(t),d.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return _m1$3.makeRotationFromQuaternion(t),this.applyMatrix4(_m1$3),this}rotateX(t){return _m1$3.makeRotationX(t),this.applyMatrix4(_m1$3),this}rotateY(t){return _m1$3.makeRotationY(t),this.applyMatrix4(_m1$3),this}rotateZ(t){return _m1$3.makeRotationZ(t),this.applyMatrix4(_m1$3),this}translate(t,o,u){return _m1$3.makeTranslation(t,o,u),this.applyMatrix4(_m1$3),this}scale(t,o,u){return _m1$3.makeScale(t,o,u),this.applyMatrix4(_m1$3),this}lookAt(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(t){const o=this.getAttribute("position");if(o===void 0){const u=[];for(let d=0,C=t.length;d<C;d++){const I=t[d];u.push(I.x,I.y,I.z||0)}this.setAttribute("position",new Float32BufferAttribute(u,3))}else{const u=Math.min(t.length,o.count);for(let d=0;d<u;d++){const C=t[d];o.setXYZ(d,C.x,C.y,C.z||0)}t.length>o.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),o.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const t=this.attributes.position,o=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),o)for(let u=0,d=o.length;u<d;u++){const C=o[u];_box$2.setFromBufferAttribute(C),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere$1);const t=this.attributes.position,o=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(t){const u=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(t),o)for(let C=0,I=o.length;C<I;C++){const f=o[C];_boxMorphTargets.setFromBufferAttribute(f),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(u);let d=0;for(let C=0,I=t.count;C<I;C++)_vector$8.fromBufferAttribute(t,C),d=Math.max(d,u.distanceToSquared(_vector$8));if(o)for(let C=0,I=o.length;C<I;C++){const f=o[C],A=this.morphTargetsRelative;for(let y=0,G=f.count;y<G;y++)_vector$8.fromBufferAttribute(f,y),A&&(_offset.fromBufferAttribute(t,y),_vector$8.add(_offset)),d=Math.max(d,u.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,o=this.attributes;if(t===null||o.position===void 0||o.normal===void 0||o.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const u=o.position,d=o.normal,C=o.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*u.count),4));const I=this.getAttribute("tangent"),f=[],A=[];for(let ie=0;ie<u.count;ie++)f[ie]=new Vector3,A[ie]=new Vector3;const y=new Vector3,G=new Vector3,S=new Vector3,w=new Vector2,M=new Vector2,V=new Vector2,T=new Vector3,H=new Vector3;function J(ie,te,se){y.fromBufferAttribute(u,ie),G.fromBufferAttribute(u,te),S.fromBufferAttribute(u,se),w.fromBufferAttribute(C,ie),M.fromBufferAttribute(C,te),V.fromBufferAttribute(C,se),G.sub(y),S.sub(y),M.sub(w),V.sub(w);const ae=1/(M.x*V.y-V.x*M.y);isFinite(ae)&&(T.copy(G).multiplyScalar(V.y).addScaledVector(S,-M.y).multiplyScalar(ae),H.copy(S).multiplyScalar(M.x).addScaledVector(G,-V.x).multiplyScalar(ae),f[ie].add(T),f[te].add(T),f[se].add(T),A[ie].add(H),A[te].add(H),A[se].add(H))}let z=this.groups;z.length===0&&(z=[{start:0,count:t.count}]);for(let ie=0,te=z.length;ie<te;++ie){const se=z[ie],ae=se.start,le=se.count;for(let ge=ae,be=ae+le;ge<be;ge+=3)J(t.getX(ge+0),t.getX(ge+1),t.getX(ge+2))}const L=new Vector3,K=new Vector3,O=new Vector3,Q=new Vector3;function ee(ie){O.fromBufferAttribute(d,ie),Q.copy(O);const te=f[ie];L.copy(te),L.sub(O.multiplyScalar(O.dot(te))).normalize(),K.crossVectors(Q,te);const ae=K.dot(A[ie])<0?-1:1;I.setXYZW(ie,L.x,L.y,L.z,ae)}for(let ie=0,te=z.length;ie<te;++ie){const se=z[ie],ae=se.start,le=se.count;for(let ge=ae,be=ae+le;ge<be;ge+=3)ee(t.getX(ge+0)),ee(t.getX(ge+1)),ee(t.getX(ge+2))}}computeVertexNormals(){const t=this.index,o=this.getAttribute("position");if(o!==void 0){let u=this.getAttribute("normal");if(u===void 0)u=new BufferAttribute(new Float32Array(o.count*3),3),this.setAttribute("normal",u);else for(let w=0,M=u.count;w<M;w++)u.setXYZ(w,0,0,0);const d=new Vector3,C=new Vector3,I=new Vector3,f=new Vector3,A=new Vector3,y=new Vector3,G=new Vector3,S=new Vector3;if(t)for(let w=0,M=t.count;w<M;w+=3){const V=t.getX(w+0),T=t.getX(w+1),H=t.getX(w+2);d.fromBufferAttribute(o,V),C.fromBufferAttribute(o,T),I.fromBufferAttribute(o,H),G.subVectors(I,C),S.subVectors(d,C),G.cross(S),f.fromBufferAttribute(u,V),A.fromBufferAttribute(u,T),y.fromBufferAttribute(u,H),f.add(G),A.add(G),y.add(G),u.setXYZ(V,f.x,f.y,f.z),u.setXYZ(T,A.x,A.y,A.z),u.setXYZ(H,y.x,y.y,y.z)}else for(let w=0,M=o.count;w<M;w+=3)d.fromBufferAttribute(o,w+0),C.fromBufferAttribute(o,w+1),I.fromBufferAttribute(o,w+2),G.subVectors(I,C),S.subVectors(d,C),G.cross(S),u.setXYZ(w+0,G.x,G.y,G.z),u.setXYZ(w+1,G.x,G.y,G.z),u.setXYZ(w+2,G.x,G.y,G.z);this.normalizeNormals(),u.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let o=0,u=t.count;o<u;o++)_vector$8.fromBufferAttribute(t,o),_vector$8.normalize(),t.setXYZ(o,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function t(f,A){const y=f.array,G=f.itemSize,S=f.normalized,w=new y.constructor(A.length*G);let M=0,V=0;for(let T=0,H=A.length;T<H;T++){f.isInterleavedBufferAttribute?M=A[T]*f.data.stride+f.offset:M=A[T]*G;for(let J=0;J<G;J++)w[V++]=y[M++]}return new BufferAttribute(w,G,S)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const o=new BufferGeometry,u=this.index.array,d=this.attributes;for(const f in d){const A=d[f],y=t(A,u);o.setAttribute(f,y)}const C=this.morphAttributes;for(const f in C){const A=[],y=C[f];for(let G=0,S=y.length;G<S;G++){const w=y[G],M=t(w,u);A.push(M)}o.morphAttributes[f]=A}o.morphTargetsRelative=this.morphTargetsRelative;const I=this.groups;for(let f=0,A=I.length;f<A;f++){const y=I[f];o.addGroup(y.start,y.count,y.materialIndex)}return o}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const A=this.parameters;for(const y in A)A[y]!==void 0&&(t[y]=A[y]);return t}t.data={attributes:{}};const o=this.index;o!==null&&(t.data.index={type:o.array.constructor.name,array:Array.prototype.slice.call(o.array)});const u=this.attributes;for(const A in u){const y=u[A];t.data.attributes[A]=y.toJSON(t.data)}const d={};let C=!1;for(const A in this.morphAttributes){const y=this.morphAttributes[A],G=[];for(let S=0,w=y.length;S<w;S++){const M=y[S];G.push(M.toJSON(t.data))}G.length>0&&(d[A]=G,C=!0)}C&&(t.data.morphAttributes=d,t.data.morphTargetsRelative=this.morphTargetsRelative);const I=this.groups;I.length>0&&(t.data.groups=JSON.parse(JSON.stringify(I)));const f=this.boundingSphere;return f!==null&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const o={};this.name=t.name;const u=t.index;u!==null&&this.setIndex(u.clone(o));const d=t.attributes;for(const y in d){const G=d[y];this.setAttribute(y,G.clone(o))}const C=t.morphAttributes;for(const y in C){const G=[],S=C[y];for(let w=0,M=S.length;w<M;w++)G.push(S[w].clone(o));this.morphAttributes[y]=G}this.morphTargetsRelative=t.morphTargetsRelative;const I=t.groups;for(let y=0,G=I.length;y<G;y++){const S=I[y];this.addGroup(S.start,S.count,S.materialIndex)}const f=t.boundingBox;f!==null&&(this.boundingBox=f.clone());const A=t.boundingSphere;return A!==null&&(this.boundingSphere=A.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$2,_sphere$6=new Sphere$1,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,o=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,u=Object.keys(o);if(u.length>0){const d=o[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let C=0,I=d.length;C<I;C++){const f=d[C].name||String(C);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=C}}}}getVertexPosition(t,o){const u=this.geometry,d=u.attributes.position,C=u.morphAttributes.position,I=u.morphTargetsRelative;o.fromBufferAttribute(d,t);const f=this.morphTargetInfluences;if(C&&f){_morphA.set(0,0,0);for(let A=0,y=C.length;A<y;A++){const G=f[A],S=C[A];G!==0&&(_tempA.fromBufferAttribute(S,t),I?_morphA.addScaledVector(_tempA,G):_morphA.addScaledVector(_tempA.sub(o),G))}o.add(_morphA)}return o}raycast(t,o){const u=this.geometry,d=this.material,C=this.matrixWorld;d!==void 0&&(u.boundingSphere===null&&u.computeBoundingSphere(),_sphere$6.copy(u.boundingSphere),_sphere$6.applyMatrix4(C),_ray$3.copy(t.ray).recast(t.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(t.far-t.near)**2))&&(_inverseMatrix$3.copy(C).invert(),_ray$3.copy(t.ray).applyMatrix4(_inverseMatrix$3),!(u.boundingBox!==null&&_ray$3.intersectsBox(u.boundingBox)===!1)&&this._computeIntersections(t,o,_ray$3)))}_computeIntersections(t,o,u){let d;const C=this.geometry,I=this.material,f=C.index,A=C.attributes.position,y=C.attributes.uv,G=C.attributes.uv1,S=C.attributes.normal,w=C.groups,M=C.drawRange;if(f!==null)if(Array.isArray(I))for(let V=0,T=w.length;V<T;V++){const H=w[V],J=I[H.materialIndex],z=Math.max(H.start,M.start),L=Math.min(f.count,Math.min(H.start+H.count,M.start+M.count));for(let K=z,O=L;K<O;K+=3){const Q=f.getX(K),ee=f.getX(K+1),ie=f.getX(K+2);d=checkGeometryIntersection(this,J,t,u,y,G,S,Q,ee,ie),d&&(d.faceIndex=Math.floor(K/3),d.face.materialIndex=H.materialIndex,o.push(d))}}else{const V=Math.max(0,M.start),T=Math.min(f.count,M.start+M.count);for(let H=V,J=T;H<J;H+=3){const z=f.getX(H),L=f.getX(H+1),K=f.getX(H+2);d=checkGeometryIntersection(this,I,t,u,y,G,S,z,L,K),d&&(d.faceIndex=Math.floor(H/3),o.push(d))}}else if(A!==void 0)if(Array.isArray(I))for(let V=0,T=w.length;V<T;V++){const H=w[V],J=I[H.materialIndex],z=Math.max(H.start,M.start),L=Math.min(A.count,Math.min(H.start+H.count,M.start+M.count));for(let K=z,O=L;K<O;K+=3){const Q=K,ee=K+1,ie=K+2;d=checkGeometryIntersection(this,J,t,u,y,G,S,Q,ee,ie),d&&(d.faceIndex=Math.floor(K/3),d.face.materialIndex=H.materialIndex,o.push(d))}}else{const V=Math.max(0,M.start),T=Math.min(A.count,M.start+M.count);for(let H=V,J=T;H<J;H+=3){const z=H,L=H+1,K=H+2;d=checkGeometryIntersection(this,I,t,u,y,G,S,z,L,K),d&&(d.faceIndex=Math.floor(H/3),o.push(d))}}}}function checkIntersection$1(n,t,o,u,d,C,I,f){let A;if(t.side===BackSide?A=u.intersectTriangle(I,C,d,!0,f):A=u.intersectTriangle(d,C,I,t.side===FrontSide,f),A===null)return null;_intersectionPointWorld.copy(f),_intersectionPointWorld.applyMatrix4(n.matrixWorld);const y=o.ray.origin.distanceTo(_intersectionPointWorld);return y<o.near||y>o.far?null:{distance:y,point:_intersectionPointWorld.clone(),object:n}}function checkGeometryIntersection(n,t,o,u,d,C,I,f,A,y){n.getVertexPosition(f,_vA$1),n.getVertexPosition(A,_vB$1),n.getVertexPosition(y,_vC$1);const G=checkIntersection$1(n,t,o,u,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(G){const S=new Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,S),d&&(G.uv=Triangle.getInterpolatedAttribute(d,f,A,y,S,new Vector2)),C&&(G.uv1=Triangle.getInterpolatedAttribute(C,f,A,y,S,new Vector2)),I&&(G.normal=Triangle.getInterpolatedAttribute(I,f,A,y,S,new Vector3),G.normal.dot(u.direction)>0&&G.normal.multiplyScalar(-1));const w={a:f,b:A,c:y,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,w.normal),G.face=w,G.barycoord=S}return G}class BoxGeometry extends BufferGeometry{constructor(t=1,o=1,u=1,d=1,C=1,I=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:o,depth:u,widthSegments:d,heightSegments:C,depthSegments:I};const f=this;d=Math.floor(d),C=Math.floor(C),I=Math.floor(I);const A=[],y=[],G=[],S=[];let w=0,M=0;V("z","y","x",-1,-1,u,o,t,I,C,0),V("z","y","x",1,-1,u,o,-t,I,C,1),V("x","z","y",1,1,t,u,o,d,I,2),V("x","z","y",1,-1,t,u,-o,d,I,3),V("x","y","z",1,-1,t,o,u,d,C,4),V("x","y","z",-1,-1,t,o,-u,d,C,5),this.setIndex(A),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("normal",new Float32BufferAttribute(G,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2));function V(T,H,J,z,L,K,O,Q,ee,ie,te){const se=K/ee,ae=O/ie,le=K/2,ge=O/2,be=Q/2,Xe=ee+1,Ce=ie+1;let Re=0,Se=0;const Ze=new Vector3;for(let he=0;he<Ce;he++){const Ie=he*ae-ge;for(let Be=0;Be<Xe;Be++){const ue=Be*se-le;Ze[T]=ue*z,Ze[H]=Ie*L,Ze[J]=be,y.push(Ze.x,Ze.y,Ze.z),Ze[T]=0,Ze[H]=0,Ze[J]=Q>0?1:-1,G.push(Ze.x,Ze.y,Ze.z),S.push(Be/ee),S.push(1-he/ie),Re+=1}}for(let he=0;he<ie;he++)for(let Ie=0;Ie<ee;Ie++){const Be=w+Ie+Xe*he,ue=w+Ie+Xe*(he+1),me=w+(Ie+1)+Xe*(he+1),xe=w+(Ie+1)+Xe*he;A.push(Be,ue,xe),A.push(ue,me,xe),Se+=6}f.addGroup(M,Se,te),M+=Se,w+=Re}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(n){const t={};for(const o in n){t[o]={};for(const u in n[o]){const d=n[o][u];d&&(d.isColor||d.isMatrix3||d.isMatrix4||d.isVector2||d.isVector3||d.isVector4||d.isTexture||d.isQuaternion)?d.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[o][u]=null):t[o][u]=d.clone():Array.isArray(d)?t[o][u]=d.slice():t[o][u]=d}}return t}function mergeUniforms(n){const t={};for(let o=0;o<n.length;o++){const u=cloneUniforms(n[o]);for(const d in u)t[d]=u[d]}return t}function cloneUniformsGroups(n){const t=[];for(let o=0;o<n.length;o++)t.push(n[o].clone());return t}function getUnlitUniformColorSpace(n){const t=n.getRenderTarget();return t===null?n.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.uniformsGroups=cloneUniformsGroups(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const o=super.toJSON(t);o.glslVersion=this.glslVersion,o.uniforms={};for(const d in this.uniforms){const I=this.uniforms[d].value;I&&I.isTexture?o.uniforms[d]={type:"t",value:I.toJSON(t).uuid}:I&&I.isColor?o.uniforms[d]={type:"c",value:I.getHex()}:I&&I.isVector2?o.uniforms[d]={type:"v2",value:I.toArray()}:I&&I.isVector3?o.uniforms[d]={type:"v3",value:I.toArray()}:I&&I.isVector4?o.uniforms[d]={type:"v4",value:I.toArray()}:I&&I.isMatrix3?o.uniforms[d]={type:"m3",value:I.toArray()}:I&&I.isMatrix4?o.uniforms[d]={type:"m4",value:I.toArray()}:o.uniforms[d]={value:I}}Object.keys(this.defines).length>0&&(o.defines=this.defines),o.vertexShader=this.vertexShader,o.fragmentShader=this.fragmentShader,o.lights=this.lights,o.clipping=this.clipping;const u={};for(const d in this.extensions)this.extensions[d]===!0&&(u[d]=!0);return Object.keys(u).length>0&&(o.extensions=u),o}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(t,o){return super.copy(t,o),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,o){super.updateWorldMatrix(t,o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(t=50,o=1,u=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=u,this.far=d,this.focus=10,this.aspect=o,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,o){return super.copy(t,o),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const o=.5*this.getFilmHeight()/t;this.fov=RAD2DEG*2*Math.atan(o),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,o,u){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),o.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),u.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z)}getViewSize(t,o){return this.getViewBounds(t,_minTarget,_maxTarget),o.subVectors(_maxTarget,_minTarget)}setViewOffset(t,o,u,d,C,I){this.aspect=t/o,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=o,this.view.offsetX=u,this.view.offsetY=d,this.view.width=C,this.view.height=I,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let o=t*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,u=2*o,d=this.aspect*u,C=-.5*d;const I=this.view;if(this.view!==null&&this.view.enabled){const A=I.fullWidth,y=I.fullHeight;C+=I.offsetX*d/A,o-=I.offsetY*u/y,d*=I.width/A,u*=I.height/y}const f=this.filmOffset;f!==0&&(C+=t*f/this.getFilmWidth()),this.projectionMatrix.makePerspective(C,C+d,o,o-u,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const o=super.toJSON(t);return o.object.fov=this.fov,o.object.zoom=this.zoom,o.object.near=this.near,o.object.far=this.far,o.object.focus=this.focus,o.object.aspect=this.aspect,this.view!==null&&(o.object.view=Object.assign({},this.view)),o.object.filmGauge=this.filmGauge,o.object.filmOffset=this.filmOffset,o}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(t,o,u){super(),this.type="CubeCamera",this.renderTarget=u,this.coordinateSystem=null,this.activeMipmapLevel=0;const d=new PerspectiveCamera(fov,aspect,t,o);d.layers=this.layers,this.add(d);const C=new PerspectiveCamera(fov,aspect,t,o);C.layers=this.layers,this.add(C);const I=new PerspectiveCamera(fov,aspect,t,o);I.layers=this.layers,this.add(I);const f=new PerspectiveCamera(fov,aspect,t,o);f.layers=this.layers,this.add(f);const A=new PerspectiveCamera(fov,aspect,t,o);A.layers=this.layers,this.add(A);const y=new PerspectiveCamera(fov,aspect,t,o);y.layers=this.layers,this.add(y)}updateCoordinateSystem(){const t=this.coordinateSystem,o=this.children.concat(),[u,d,C,I,f,A]=o;for(const y of o)this.remove(y);if(t===WebGLCoordinateSystem)u.up.set(0,1,0),u.lookAt(1,0,0),d.up.set(0,1,0),d.lookAt(-1,0,0),C.up.set(0,0,-1),C.lookAt(0,1,0),I.up.set(0,0,1),I.lookAt(0,-1,0),f.up.set(0,1,0),f.lookAt(0,0,1),A.up.set(0,1,0),A.lookAt(0,0,-1);else if(t===WebGPUCoordinateSystem)u.up.set(0,-1,0),u.lookAt(-1,0,0),d.up.set(0,-1,0),d.lookAt(1,0,0),C.up.set(0,0,1),C.lookAt(0,1,0),I.up.set(0,0,-1),I.lookAt(0,-1,0),f.up.set(0,-1,0),f.lookAt(0,0,1),A.up.set(0,-1,0),A.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const y of o)this.add(y),y.updateMatrixWorld()}update(t,o){this.parent===null&&this.updateMatrixWorld();const{renderTarget:u,activeMipmapLevel:d}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[C,I,f,A,y,G]=this.children,S=t.getRenderTarget(),w=t.getActiveCubeFace(),M=t.getActiveMipmapLevel(),V=t.xr.enabled;t.xr.enabled=!1;const T=u.texture.generateMipmaps;u.texture.generateMipmaps=!1,t.setRenderTarget(u,0,d),t.render(o,C),t.setRenderTarget(u,1,d),t.render(o,I),t.setRenderTarget(u,2,d),t.render(o,f),t.setRenderTarget(u,3,d),t.render(o,A),t.setRenderTarget(u,4,d),t.render(o,y),u.texture.generateMipmaps=T,t.setRenderTarget(u,5,d),t.render(o,G),t.setRenderTarget(S,w,M),t.xr.enabled=V,u.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(t,o,u,d,C,I,f,A,y,G){t=t!==void 0?t:[],o=o!==void 0?o:CubeReflectionMapping,super(t,o,u,d,C,I,f,A,y,G),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t=1,o={}){super(t,t,o),this.isWebGLCubeRenderTarget=!0;const u={width:t,height:t,depth:1},d=[u,u,u,u,u,u];this.texture=new CubeTexture(d,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=o.generateMipmaps!==void 0?o.generateMipmaps:!1,this.texture.minFilter=o.minFilter!==void 0?o.minFilter:LinearFilter}fromEquirectangularTexture(t,o){this.texture.type=o.type,this.texture.colorSpace=o.colorSpace,this.texture.generateMipmaps=o.generateMipmaps,this.texture.minFilter=o.minFilter,this.texture.magFilter=o.magFilter;const u={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new BoxGeometry(5,5,5),C=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,side:BackSide,blending:NoBlending});C.uniforms.tEquirect.value=o;const I=new Mesh(d,C),f=o.minFilter;return o.minFilter===LinearMipmapLinearFilter&&(o.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,I),o.minFilter=f,I.geometry.dispose(),I.material.dispose(),this}clear(t,o,u,d){const C=t.getRenderTarget();for(let I=0;I<6;I++)t.setRenderTarget(this,I),t.clear(o,u,d);t.setRenderTarget(C)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const o=this._hand;if(o)for(const u of t.hand.values())this._getHandJoint(o,u)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,o,u){let d=null,C=null,I=null;const f=this._targetRay,A=this._grip,y=this._hand;if(t&&o.session.visibilityState!=="visible-blurred"){if(y&&t.hand){I=!0;for(const T of t.hand.values()){const H=o.getJointPose(T,u),J=this._getHandJoint(y,T);H!==null&&(J.matrix.fromArray(H.transform.matrix),J.matrix.decompose(J.position,J.rotation,J.scale),J.matrixWorldNeedsUpdate=!0,J.jointRadius=H.radius),J.visible=H!==null}const G=y.joints["index-finger-tip"],S=y.joints["thumb-tip"],w=G.position.distanceTo(S.position),M=.02,V=.005;y.inputState.pinching&&w>M+V?(y.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!y.inputState.pinching&&w<=M-V&&(y.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else A!==null&&t.gripSpace&&(C=o.getPose(t.gripSpace,u),C!==null&&(A.matrix.fromArray(C.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,C.linearVelocity?(A.hasLinearVelocity=!0,A.linearVelocity.copy(C.linearVelocity)):A.hasLinearVelocity=!1,C.angularVelocity?(A.hasAngularVelocity=!0,A.angularVelocity.copy(C.angularVelocity)):A.hasAngularVelocity=!1));f!==null&&(d=o.getPose(t.targetRaySpace,u),d===null&&C!==null&&(d=C),d!==null&&(f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,d.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(d.linearVelocity)):f.hasLinearVelocity=!1,d.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(d.angularVelocity)):f.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return f!==null&&(f.visible=d!==null),A!==null&&(A.visible=C!==null),y!==null&&(y.visible=I!==null),this}_getHandJoint(t,o){if(t.joints[o.jointName]===void 0){const u=new Group;u.matrixAutoUpdate=!1,u.visible=!1,t.joints[o.jointName]=u,t.add(u)}return t.joints[o.jointName]}}class FogExp2{constructor(t,o=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(t),this.density=o}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,o=1,u=1e3){this.isFog=!0,this.name="",this.color=new Color(t),this.near=o,this.far=u}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,o){return super.copy(t,o),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const o=super.toJSON(t);return this.fog!==null&&(o.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(o.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(o.object.backgroundIntensity=this.backgroundIntensity),o.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(o.object.environmentIntensity=this.environmentIntensity),o.object.environmentRotation=this.environmentRotation.toArray(),o}}class InterleavedBuffer{constructor(t,o){this.isInterleavedBuffer=!0,this.array=t,this.stride=o,this.count=t!==void 0?t.length/o:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,o){this.updateRanges.push({start:t,count:o})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,o,u){t*=this.stride,u*=o.stride;for(let d=0,C=this.stride;d<C;d++)this.array[t+d]=o.array[u+d];return this}set(t,o=0){return this.array.set(t,o),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const o=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),u=new this.constructor(o,this.stride);return u.setUsage(this.usage),u}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new Vector3;class InterleavedBufferAttribute{constructor(t,o,u,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=o,this.offset=u,this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let o=0,u=this.data.count;o<u;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.applyMatrix4(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(t){for(let o=0,u=this.count;o<u;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.applyNormalMatrix(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(t){for(let o=0,u=this.count;o<u;o++)_vector$7.fromBufferAttribute(this,o),_vector$7.transformDirection(t),this.setXYZ(o,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(t,o){let u=this.array[t*this.data.stride+this.offset+o];return this.normalized&&(u=denormalize(u,this.array)),u}setComponent(t,o,u){return this.normalized&&(u=normalize(u,this.array)),this.data.array[t*this.data.stride+this.offset+o]=u,this}setX(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset]=o,this}setY(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+1]=o,this}setZ(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+2]=o,this}setW(t,o){return this.normalized&&(o=normalize(o,this.array)),this.data.array[t*this.data.stride+this.offset+3]=o,this}getX(t){let o=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(o=denormalize(o,this.array)),o}getY(t){let o=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(o=denormalize(o,this.array)),o}getZ(t){let o=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(o=denormalize(o,this.array)),o}getW(t){let o=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(o=denormalize(o,this.array)),o}setXY(t,o,u){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=u,this}setXYZ(t,o,u,d){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=u,this.data.array[t+2]=d,this}setXYZW(t,o,u,d,C){return t=t*this.data.stride+this.offset,this.normalized&&(o=normalize(o,this.array),u=normalize(u,this.array),d=normalize(d,this.array),C=normalize(C,this.array)),this.data.array[t+0]=o,this.data.array[t+1]=u,this.data.array[t+2]=d,this.data.array[t+3]=C,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const o=[];for(let u=0;u<this.count;u++){const d=u*this.data.stride+this.offset;for(let C=0;C<this.itemSize;C++)o.push(this.data.array[d+C])}return new BufferAttribute(new this.array.constructor(o),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const o=[];for(let u=0;u<this.count;u++){const d=u*this.data.stride+this.offset;for(let C=0;C<this.itemSize;C++)o.push(this.data.array[d+C])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:o,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(t=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const o=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),u=new InterleavedBuffer(o,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(u,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(u,2,3,!1))}this.geometry=_geometry,this.material=t,this.center=new Vector2(.5,.5)}raycast(t,o){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const u=this.material.rotation;let d,C;u!==0&&(C=Math.cos(u),d=Math.sin(u));const I=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,I,_worldScale,d,C),transformVertex(_vB.set(.5,-.5,0),_mvPosition,I,_worldScale,d,C),transformVertex(_vC.set(.5,.5,0),_mvPosition,I,_worldScale,d,C),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let f=t.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(f===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,I,_worldScale,d,C),_uvB.set(0,1),f=t.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),f===null))return;const A=t.ray.origin.distanceTo(_intersectPoint);A<t.near||A>t.far||o.push({distance:A,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(t,o){return super.copy(t,o),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function transformVertex(n,t,o,u,d,C){_alignedPosition.subVectors(n,o).addScalar(.5).multiply(u),d!==void 0?(_rotatedPosition.x=C*_alignedPosition.x-d*_alignedPosition.y,_rotatedPosition.y=d*_alignedPosition.x+C*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),n.copy(t),n.x+=_rotatedPosition.x,n.y+=_rotatedPosition.y,n.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const o=t.levels;for(let u=0,d=o.length;u<d;u++){const C=o[u];this.addLevel(C.object.clone(),C.distance,C.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,o=0,u=0){o=Math.abs(o);const d=this.levels;let C;for(C=0;C<d.length&&!(o<d[C].distance);C++);return d.splice(C,0,{distance:o,hysteresis:u,object:t}),this.add(t),this}removeLevel(t){const o=this.levels;for(let u=0;u<o.length;u++)if(o[u].distance===t){const d=o.splice(u,1);return this.remove(d[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const o=this.levels;if(o.length>0){let u,d;for(u=1,d=o.length;u<d;u++){let C=o[u].distance;if(o[u].object.visible&&(C-=C*o[u].hysteresis),t<C)break}return o[u-1].object}return null}raycast(t,o){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const d=t.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(d).raycast(t,o)}}update(t){const o=this.levels;if(o.length>1){_v1$2.setFromMatrixPosition(t.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const u=_v1$2.distanceTo(_v2$1)/t.zoom;o[0].object.visible=!0;let d,C;for(d=1,C=o.length;d<C;d++){let I=o[d].distance;if(o[d].object.visible&&(I-=I*o[d].hysteresis),u>=I)o[d-1].object.visible=!1,o[d].object.visible=!0;else break}for(this._currentLevel=d-1;d<C;d++)o[d].object.visible=!1}}toJSON(t){const o=super.toJSON(t);this.autoUpdate===!1&&(o.object.autoUpdate=!1),o.object.levels=[];const u=this.levels;for(let d=0,C=u.length;d<C;d++){const I=u[d];o.object.levels.push({object:I.object.uuid,distance:I.distance,hysteresis:I.hysteresis})}return o}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$5=new Sphere$1,_inverseMatrix$2=new Matrix4,_ray$2=new Ray$2;class SkinnedMesh extends Mesh{constructor(t,o){super(t,o),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const o=t.getAttribute("position");for(let u=0;u<o.count;u++)this.getVertexPosition(u,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere$1),this.boundingSphere.makeEmpty();const o=t.getAttribute("position");for(let u=0;u<o.count;u++)this.getVertexPosition(u,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(t,o){return super.copy(t,o),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,o){const u=this.material,d=this.matrixWorld;u!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(d),t.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(d).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,o,_ray$2)))}getVertexPosition(t,o){return super.getVertexPosition(t,o),this.applyBoneTransform(t,o),o}bind(t,o){this.skeleton=t,o===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),o=this.matrixWorld),this.bindMatrix.copy(o),this.bindMatrixInverse.copy(o).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,o=this.geometry.attributes.skinWeight;for(let u=0,d=o.count;u<d;u++){t.fromBufferAttribute(o,u);const C=1/t.manhattanLength();C!==1/0?t.multiplyScalar(C):t.set(1,0,0,0),o.setXYZW(u,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,o){const u=this.skeleton,d=this.geometry;_skinIndex.fromBufferAttribute(d.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(d.attributes.skinWeight,t),_basePosition.copy(o).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(let C=0;C<4;C++){const I=_skinWeight.getComponent(C);if(I!==0){const f=_skinIndex.getComponent(C);_matrix4.multiplyMatrices(u.bones[f].matrixWorld,u.boneInverses[f]),o.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),I)}}return o.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(t=null,o=1,u=1,d,C,I,f,A,y=NearestFilter,G=NearestFilter,S,w){super(null,I,f,A,y,G,d,C,S,w),this.isDataTexture=!0,this.image={data:t,width:o,height:u},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(t=[],o=[]){this.uuid=generateUUID(),this.bones=t.slice(0),this.boneInverses=o,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,o=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),o.length===0)this.calculateInverses();else if(t.length!==o.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let u=0,d=this.bones.length;u<d;u++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,o=this.bones.length;t<o;t++){const u=new Matrix4;this.bones[t]&&u.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(u)}}pose(){for(let t=0,o=this.bones.length;t<o;t++){const u=this.bones[t];u&&u.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,o=this.bones.length;t<o;t++){const u=this.bones[t];u&&(u.parent&&u.parent.isBone?(u.matrix.copy(u.parent.matrixWorld).invert(),u.matrix.multiply(u.matrixWorld)):u.matrix.copy(u.matrixWorld),u.matrix.decompose(u.position,u.quaternion,u.scale))}}update(){const t=this.bones,o=this.boneInverses,u=this.boneMatrices,d=this.boneTexture;for(let C=0,I=t.length;C<I;C++){const f=t[C]?t[C].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(f,o[C]),_offsetMatrix.toArray(u,C*16)}d!==null&&(d.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const o=new Float32Array(t*t*4);o.set(this.boneMatrices);const u=new DataTexture(o,t,t,RGBAFormat,FloatType);return u.needsUpdate=!0,this.boneMatrices=o,this.boneTexture=u,this}getBoneByName(t){for(let o=0,u=this.bones.length;o<u;o++){const d=this.bones[o];if(d.name===t)return d}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,o){this.uuid=t.uuid;for(let u=0,d=t.bones.length;u<d;u++){const C=t.bones[u];let I=o[C];I===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",C),I=new Bone),this.bones.push(I),this.boneInverses.push(new Matrix4().fromArray(t.boneInverses[u]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const o=this.bones,u=this.boneInverses;for(let d=0,C=o.length;d<C;d++){const I=o[d];t.bones.push(I.uuid);const f=u[d];t.boneInverses.push(f.toArray())}return t}}class InstancedBufferAttribute extends BufferAttribute{constructor(t,o,u,d=1){super(t,o,u),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere$1;class InstancedMesh extends Mesh{constructor(t,o,u){super(t,o),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(u*16),16),this.instanceColor=null,this.morphTexture=null,this.count=u,this.boundingBox=null,this.boundingSphere=null;for(let d=0;d<u;d++)this.setMatrixAt(d,_identity)}computeBoundingBox(){const t=this.geometry,o=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let u=0;u<o;u++)this.getMatrixAt(u,_instanceLocalMatrix),_box3.copy(t.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const t=this.geometry,o=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere$1),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let u=0;u<o;u++)this.getMatrixAt(u,_instanceLocalMatrix),_sphere$4.copy(t.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(t,o){return super.copy(t,o),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,o){o.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,o){o.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,o){const u=o.morphTargetInfluences,d=this.morphTexture.source.data.data,C=u.length+1,I=t*C+1;for(let f=0;f<u.length;f++)u[f]=d[I+f]}raycast(t,o){const u=this.matrixWorld,d=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(u),t.ray.intersectsSphere(_sphere$4)!==!1))for(let C=0;C<d;C++){this.getMatrixAt(C,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(u,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(t,_instanceIntersects);for(let I=0,f=_instanceIntersects.length;I<f;I++){const A=_instanceIntersects[I];A.instanceId=C,A.object=this,o.push(A)}_instanceIntersects.length=0}}setColorAt(t,o){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),o.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,o){o.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,o){const u=o.morphTargetInfluences,d=u.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(d*this.count),d,this.count,RedFormat,FloatType));const C=this.morphTexture.source.data.data;let I=0;for(let y=0;y<u.length;y++)I+=u[y];const f=this.geometry.morphTargetsRelative?1:1-I,A=d*t;C[A]=f,C.set(u,A+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(t=new Vector3(1,0,0),o=0){this.isPlane=!0,this.normal=t,this.constant=o}set(t,o){return this.normal.copy(t),this.constant=o,this}setComponents(t,o,u,d){return this.normal.set(t,o,u),this.constant=d,this}setFromNormalAndCoplanarPoint(t,o){return this.normal.copy(t),this.constant=-o.dot(this.normal),this}setFromCoplanarPoints(t,o,u){const d=_vector1.subVectors(u,o).cross(_vector2.subVectors(t,o)).normalize();return this.setFromNormalAndCoplanarPoint(d,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,o){return o.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,o){const u=t.delta(_vector1),d=this.normal.dot(u);if(d===0)return this.distanceToPoint(t.start)===0?o.copy(t.start):null;const C=-(t.start.dot(this.normal)+this.constant)/d;return C<0||C>1?null:o.copy(t.start).addScaledVector(u,C)}intersectsLine(t){const o=this.distanceToPoint(t.start),u=this.distanceToPoint(t.end);return o<0&&u>0||u<0&&o>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,o){const u=o||_normalMatrix.getNormalMatrix(t),d=this.coplanarPoint(_vector1).applyMatrix4(t),C=this.normal.applyMatrix3(u).normalize();return this.constant=-d.dot(C),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$3=new Sphere$1,_vector$6=new Vector3;class Frustum{constructor(t=new Plane,o=new Plane,u=new Plane,d=new Plane,C=new Plane,I=new Plane){this.planes=[t,o,u,d,C,I]}set(t,o,u,d,C,I){const f=this.planes;return f[0].copy(t),f[1].copy(o),f[2].copy(u),f[3].copy(d),f[4].copy(C),f[5].copy(I),this}copy(t){const o=this.planes;for(let u=0;u<6;u++)o[u].copy(t.planes[u]);return this}setFromProjectionMatrix(t,o=WebGLCoordinateSystem){const u=this.planes,d=t.elements,C=d[0],I=d[1],f=d[2],A=d[3],y=d[4],G=d[5],S=d[6],w=d[7],M=d[8],V=d[9],T=d[10],H=d[11],J=d[12],z=d[13],L=d[14],K=d[15];if(u[0].setComponents(A-C,w-y,H-M,K-J).normalize(),u[1].setComponents(A+C,w+y,H+M,K+J).normalize(),u[2].setComponents(A+I,w+G,H+V,K+z).normalize(),u[3].setComponents(A-I,w-G,H-V,K-z).normalize(),u[4].setComponents(A-f,w-S,H-T,K-L).normalize(),o===WebGLCoordinateSystem)u[5].setComponents(A+f,w+S,H+T,K+L).normalize();else if(o===WebGPUCoordinateSystem)u[5].setComponents(f,S,T,L).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+o);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$3.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const o=t.geometry;o.boundingSphere===null&&o.computeBoundingSphere(),_sphere$3.copy(o.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(t){return _sphere$3.center.set(0,0,0),_sphere$3.radius=.7071067811865476,_sphere$3.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(t){const o=this.planes,u=t.center,d=-t.radius;for(let C=0;C<6;C++)if(o[C].distanceToPoint(u)<d)return!1;return!0}intersectsBox(t){const o=this.planes;for(let u=0;u<6;u++){const d=o[u];if(_vector$6.x=d.normal.x>0?t.max.x:t.min.x,_vector$6.y=d.normal.y>0?t.max.y:t.min.y,_vector$6.z=d.normal.z>0?t.max.z:t.min.z,d.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(t){const o=this.planes;for(let u=0;u<6;u++)if(o[u].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ascIdSort(n,t){return n-t}function sortOpaque(n,t){return n.z-t.z}function sortTransparent(n,t){return t.z-n.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,o,u,d){const C=this.pool,I=this.list;this.index>=C.length&&C.push({start:-1,count:-1,z:-1,index:-1});const f=C[this.index];I.push(f),this.index++,f.start=t,f.count=o,f.z=u,f.index=d}reset(){this.list.length=0,this.index=0}}const _matrix$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum=new Frustum,_box$1=new Box3,_sphere$2=new Sphere$1,_vector$5=new Vector3,_forward=new Vector3,_temp=new Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(n,t,o=0){const u=t.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==t.array.constructor){const d=n.count;for(let C=0;C<d;C++)for(let I=0;I<u;I++)t.setComponent(C+o,I,n.getComponent(C,I))}else t.array.set(n.array,o*u);t.needsUpdate=!0}function copyArrayContents(n,t){if(n.constructor!==t.constructor){const o=Math.min(n.length,t.length);for(let u=0;u<o;u++)t[u]=n[u]}else{const o=Math.min(n.length,t.length);t.set(new n.constructor(n.buffer,0,o))}}class BatchedMesh extends Mesh{constructor(t,o,u=o*2,d){super(new BufferGeometry,d),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=o,this._maxIndexCount=u,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const o=new Float32Array(t*t*4),u=new DataTexture(o,t,t,RGBAFormat,FloatType);this._matricesTexture=u}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const o=new Uint32Array(t*t),u=new DataTexture(o,t,t,RedIntegerFormat,UnsignedIntType);this._indirectTexture=u}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const o=new Float32Array(t*t*4).fill(1),u=new DataTexture(o,t,t,RGBAFormat,FloatType);u.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=u}_initializeGeometry(t){const o=this.geometry,u=this._maxVertexCount,d=this._maxIndexCount;if(this._geometryInitialized===!1){for(const C in t.attributes){const I=t.getAttribute(C),{array:f,itemSize:A,normalized:y}=I,G=new f.constructor(u*A),S=new BufferAttribute(G,A,y);o.setAttribute(C,S)}if(t.getIndex()!==null){const C=u>65535?new Uint32Array(d):new Uint16Array(d);o.setIndex(new BufferAttribute(C,1))}this._geometryInitialized=!0}}_validateGeometry(t){const o=this.geometry;if(!!t.getIndex()!=!!o.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const u in o.attributes){if(!t.hasAttribute(u))throw new Error(`THREE.BatchedMesh: Added geometry missing "${u}". All geometries must have consistent attributes.`);const d=t.getAttribute(u),C=o.getAttribute(u);if(d.itemSize!==C.itemSize||d.normalized!==C.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const o=this._instanceInfo;if(t<0||t>=o.length||o[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const o=this._geometryInfo;if(t<0||t>=o.length||o[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const t=this.boundingBox,o=this._instanceInfo;t.makeEmpty();for(let u=0,d=o.length;u<d;u++){if(o[u].active===!1)continue;const C=o[u].geometryIndex;this.getMatrixAt(u,_matrix$1),this.getBoundingBoxAt(C,_box$1).applyMatrix4(_matrix$1),t.union(_box$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere$1);const t=this.boundingSphere,o=this._instanceInfo;t.makeEmpty();for(let u=0,d=o.length;u<d;u++){if(o[u].active===!1)continue;const C=o[u].geometryIndex;this.getMatrixAt(u,_matrix$1),this.getBoundingSphereAt(C,_sphere$2).applyMatrix4(_matrix$1),t.union(_sphere$2)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const u={visible:!0,active:!0,geometryIndex:t};let d=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),d=this._availableInstanceIds.shift(),this._instanceInfo[d]=u):(d=this._instanceInfo.length,this._instanceInfo.push(u));const C=this._matricesTexture;_matrix$1.identity().toArray(C.image.data,d*16),C.needsUpdate=!0;const I=this._colorsTexture;return I&&(_whiteColor.toArray(I.image.data,d*4),I.needsUpdate=!0),this._visibilityChanged=!0,d}addGeometry(t,o=-1,u=-1){this._initializeGeometry(t),this._validateGeometry(t);const d={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},C=this._geometryInfo;d.vertexStart=this._nextVertexStart,d.reservedVertexCount=o===-1?t.getAttribute("position").count:o;const I=t.getIndex();if(I!==null&&(d.indexStart=this._nextIndexStart,d.reservedIndexCount=u===-1?I.count:u),d.indexStart!==-1&&d.indexStart+d.reservedIndexCount>this._maxIndexCount||d.vertexStart+d.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let A;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),A=this._availableGeometryIds.shift(),C[A]=d):(A=this._geometryCount,this._geometryCount++,C.push(d)),this.setGeometryAt(A,t),this._nextIndexStart=d.indexStart+d.reservedIndexCount,this._nextVertexStart=d.vertexStart+d.reservedVertexCount,A}setGeometryAt(t,o){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(o);const u=this.geometry,d=u.getIndex()!==null,C=u.getIndex(),I=o.getIndex(),f=this._geometryInfo[t];if(d&&I.count>f.reservedIndexCount||o.attributes.position.count>f.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const A=f.vertexStart,y=f.reservedVertexCount;f.vertexCount=o.getAttribute("position").count;for(const G in u.attributes){const S=o.getAttribute(G),w=u.getAttribute(G);copyAttributeData(S,w,A);const M=S.itemSize;for(let V=S.count,T=y;V<T;V++){const H=A+V;for(let J=0;J<M;J++)w.setComponent(H,J,0)}w.needsUpdate=!0,w.addUpdateRange(A*M,y*M)}if(d){const G=f.indexStart,S=f.reservedIndexCount;f.indexCount=o.getIndex().count;for(let w=0;w<I.count;w++)C.setX(G+w,A+I.getX(w));for(let w=I.count,M=S;w<M;w++)C.setX(G+w,A);C.needsUpdate=!0,C.addUpdateRange(G,f.reservedIndexCount)}return f.start=d?f.indexStart:f.vertexStart,f.count=d?f.indexCount:f.vertexCount,f.boundingBox=null,o.boundingBox!==null&&(f.boundingBox=o.boundingBox.clone()),f.boundingSphere=null,o.boundingSphere!==null&&(f.boundingSphere=o.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const o=this._geometryInfo;if(t>=o.length||o[t].active===!1)return this;const u=this._instanceInfo;for(let d=0,C=u.length;d<C;d++)u[d].active&&u[d].geometryIndex===t&&this.deleteInstance(d);return o[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,o=0;const u=this._geometryInfo,d=u.map((I,f)=>f).sort((I,f)=>u[I].vertexStart-u[f].vertexStart),C=this.geometry;for(let I=0,f=u.length;I<f;I++){const A=d[I],y=u[A];if(y.active!==!1){if(C.index!==null){if(y.indexStart!==o){const{indexStart:G,vertexStart:S,reservedIndexCount:w}=y,M=C.index,V=M.array,T=t-S;for(let H=G;H<G+w;H++)V[H]=V[H]+T;M.array.copyWithin(o,G,G+w),M.addUpdateRange(o,w),y.indexStart=o}o+=y.reservedIndexCount}if(y.vertexStart!==t){const{vertexStart:G,reservedVertexCount:S}=y,w=C.attributes;for(const M in w){const V=w[M],{array:T,itemSize:H}=V;T.copyWithin(t*H,G*H,(G+S)*H),V.addUpdateRange(t*H,S*H)}y.vertexStart=t}t+=y.reservedVertexCount,y.start=C.index?y.indexStart:y.vertexStart,this._nextIndexStart=C.index?y.indexStart+y.reservedIndexCount:0,this._nextVertexStart=y.vertexStart+y.reservedVertexCount}}return this}getBoundingBoxAt(t,o){if(t>=this._geometryCount)return null;const u=this.geometry,d=this._geometryInfo[t];if(d.boundingBox===null){const C=new Box3,I=u.index,f=u.attributes.position;for(let A=d.start,y=d.start+d.count;A<y;A++){let G=A;I&&(G=I.getX(G)),C.expandByPoint(_vector$5.fromBufferAttribute(f,G))}d.boundingBox=C}return o.copy(d.boundingBox),o}getBoundingSphereAt(t,o){if(t>=this._geometryCount)return null;const u=this.geometry,d=this._geometryInfo[t];if(d.boundingSphere===null){const C=new Sphere$1;this.getBoundingBoxAt(t,_box$1),_box$1.getCenter(C.center);const I=u.index,f=u.attributes.position;let A=0;for(let y=d.start,G=d.start+d.count;y<G;y++){let S=y;I&&(S=I.getX(S)),_vector$5.fromBufferAttribute(f,S),A=Math.max(A,C.center.distanceToSquared(_vector$5))}C.radius=Math.sqrt(A),d.boundingSphere=C}return o.copy(d.boundingSphere),o}setMatrixAt(t,o){this.validateInstanceId(t);const u=this._matricesTexture,d=this._matricesTexture.image.data;return o.toArray(d,t*16),u.needsUpdate=!0,this}getMatrixAt(t,o){return this.validateInstanceId(t),o.fromArray(this._matricesTexture.image.data,t*16)}setColorAt(t,o){return this.validateInstanceId(t),this._colorsTexture===null&&this._initColorsTexture(),o.toArray(this._colorsTexture.image.data,t*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,o){return this.validateInstanceId(t),o.fromArray(this._colorsTexture.image.data,t*4)}setVisibleAt(t,o){return this.validateInstanceId(t),this._instanceInfo[t].visible===o?this:(this._instanceInfo[t].visible=o,this._visibilityChanged=!0,this)}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,o){return this.validateInstanceId(t),this.validateGeometryId(o),this._instanceInfo[t].geometryIndex=o,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,o={}){this.validateGeometryId(t);const u=this._geometryInfo[t];return o.vertexStart=u.vertexStart,o.vertexCount=u.vertexCount,o.reservedVertexCount=u.reservedVertexCount,o.indexStart=u.indexStart,o.indexCount=u.indexCount,o.reservedIndexCount=u.reservedIndexCount,o.start=u.start,o.count=u.count,o}setInstanceCount(t){const o=this._availableInstanceIds,u=this._instanceInfo;for(o.sort(ascIdSort);o[o.length-1]===u.length;)u.pop(),o.pop();if(t<u.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const d=new Int32Array(t),C=new Int32Array(t);copyArrayContents(this._multiDrawCounts,d),copyArrayContents(this._multiDrawStarts,C),this._multiDrawCounts=d,this._multiDrawStarts=C,this._maxInstanceCount=t;const I=this._indirectTexture,f=this._matricesTexture,A=this._colorsTexture;I.dispose(),this._initIndirectTexture(),copyArrayContents(I.image.data,this._indirectTexture.image.data),f.dispose(),this._initMatricesTexture(),copyArrayContents(f.image.data,this._matricesTexture.image.data),A&&(A.dispose(),this._initColorsTexture(),copyArrayContents(A.image.data,this._colorsTexture.image.data))}setGeometrySize(t,o){const u=[...this._geometryInfo].filter(f=>f.active);if(Math.max(...u.map(f=>f.vertexStart+f.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${o}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...u.map(A=>A.indexStart+A.reservedIndexCount))>o)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${o}. Cannot shrink further.`);const C=this.geometry;C.dispose(),this._maxVertexCount=t,this._maxIndexCount=o,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(C));const I=this.geometry;C.index&&copyArrayContents(C.index.array,I.index.array);for(const f in C.attributes)copyArrayContents(C.attributes[f].array,I.attributes[f].array)}raycast(t,o){const u=this._instanceInfo,d=this._geometryInfo,C=this.matrixWorld,I=this.geometry;_mesh.material=this.material,_mesh.geometry.index=I.index,_mesh.geometry.attributes=I.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere$1);for(let f=0,A=u.length;f<A;f++){if(!u[f].visible||!u[f].active)continue;const y=u[f].geometryIndex,G=d[y];_mesh.geometry.setDrawRange(G.start,G.count),this.getMatrixAt(f,_mesh.matrixWorld).premultiply(C),this.getBoundingBoxAt(y,_mesh.geometry.boundingBox),this.getBoundingSphereAt(y,_mesh.geometry.boundingSphere),_mesh.raycast(t,_batchIntersects);for(let S=0,w=_batchIntersects.length;S<w;S++){const M=_batchIntersects[S];M.object=this,M.batchId=f,o.push(M)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox!==null?o.boundingBox.clone():null,boundingSphere:o.boundingSphere!==null?o.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(o=>({...o})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,o,u,d,C){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const I=d.getIndex(),f=I===null?1:I.array.BYTES_PER_ELEMENT,A=this._instanceInfo,y=this._multiDrawStarts,G=this._multiDrawCounts,S=this._geometryInfo,w=this.perObjectFrustumCulled,M=this._indirectTexture,V=M.image.data;w&&(_matrix$1.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_matrix$1,t.coordinateSystem));let T=0;if(this.sortObjects){_matrix$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(u.matrixWorld).applyMatrix4(_matrix$1),_forward.set(0,0,-1).transformDirection(u.matrixWorld).transformDirection(_matrix$1);for(let z=0,L=A.length;z<L;z++)if(A[z].visible&&A[z].active){const K=A[z].geometryIndex;this.getMatrixAt(z,_matrix$1),this.getBoundingSphereAt(K,_sphere$2).applyMatrix4(_matrix$1);let O=!1;if(w&&(O=!_frustum.intersectsSphere(_sphere$2)),!O){const Q=S[K],ee=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push(Q.start,Q.count,ee,z)}}const H=_renderList.list,J=this.customSort;J===null?H.sort(C.transparent?sortTransparent:sortOpaque):J.call(this,H,u);for(let z=0,L=H.length;z<L;z++){const K=H[z];y[T]=K.start*f,G[T]=K.count,V[T]=K.index,T++}_renderList.reset()}else for(let H=0,J=A.length;H<J;H++)if(A[H].visible&&A[H].active){const z=A[H].geometryIndex;let L=!1;if(w&&(this.getMatrixAt(H,_matrix$1),this.getBoundingSphereAt(z,_sphere$2).applyMatrix4(_matrix$1),L=!_frustum.intersectsSphere(_sphere$2)),!L){const K=S[z];y[T]=K.start*f,G[T]=K.count,V[T]=H,T++}}M.needsUpdate=!0,this._multiDrawCount=T,this._visibilityChanged=!1}onBeforeShadow(t,o,u,d,C,I){this.onBeforeRender(t,null,d,C,I)}}class LineBasicMaterial extends Material{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _vStart=new Vector3,_vEnd=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$2,_sphere$1=new Sphere$1,_intersectPointOnRay=new Vector3,_intersectPointOnSegment=new Vector3;class Line extends Object3D{constructor(t=new BufferGeometry,o=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const o=t.attributes.position,u=[0];for(let d=1,C=o.count;d<C;d++)_vStart.fromBufferAttribute(o,d-1),_vEnd.fromBufferAttribute(o,d),u[d]=u[d-1],u[d]+=_vStart.distanceTo(_vEnd);t.setAttribute("lineDistance",new Float32BufferAttribute(u,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,o){const u=this.geometry,d=this.matrixWorld,C=t.params.Line.threshold,I=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),_sphere$1.copy(u.boundingSphere),_sphere$1.applyMatrix4(d),_sphere$1.radius+=C,t.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(d).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const f=C/((this.scale.x+this.scale.y+this.scale.z)/3),A=f*f,y=this.isLineSegments?2:1,G=u.index,w=u.attributes.position;if(G!==null){const M=Math.max(0,I.start),V=Math.min(G.count,I.start+I.count);for(let T=M,H=V-1;T<H;T+=y){const J=G.getX(T),z=G.getX(T+1),L=checkIntersection(this,t,_ray$1,A,J,z,T);L&&o.push(L)}if(this.isLineLoop){const T=G.getX(V-1),H=G.getX(M),J=checkIntersection(this,t,_ray$1,A,T,H,V-1);J&&o.push(J)}}else{const M=Math.max(0,I.start),V=Math.min(w.count,I.start+I.count);for(let T=M,H=V-1;T<H;T+=y){const J=checkIntersection(this,t,_ray$1,A,T,T+1,T);J&&o.push(J)}if(this.isLineLoop){const T=checkIntersection(this,t,_ray$1,A,V-1,M,V-1);T&&o.push(T)}}}updateMorphTargets(){const o=this.geometry.morphAttributes,u=Object.keys(o);if(u.length>0){const d=o[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let C=0,I=d.length;C<I;C++){const f=d[C].name||String(C);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=C}}}}}function checkIntersection(n,t,o,u,d,C,I){const f=n.geometry.attributes.position;if(_vStart.fromBufferAttribute(f,d),_vEnd.fromBufferAttribute(f,C),o.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>u)return;_intersectPointOnRay.applyMatrix4(n.matrixWorld);const y=t.ray.origin.distanceTo(_intersectPointOnRay);if(!(y<t.near||y>t.far))return{distance:y,point:_intersectPointOnSegment.clone().applyMatrix4(n.matrixWorld),index:I,face:null,faceIndex:null,barycoord:null,object:n}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(t,o){super(t,o),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const o=t.attributes.position,u=[];for(let d=0,C=o.count;d<C;d+=2)_start.fromBufferAttribute(o,d),_end.fromBufferAttribute(o,d+1),u[d]=d===0?0:u[d-1],u[d+1]=u[d]+_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(u,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(t,o){super(t,o),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const _inverseMatrix=new Matrix4,_ray$4=new Ray$2,_sphere=new Sphere$1,_position$2=new Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,o=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=o,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,o){return super.copy(t,o),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,o){const u=this.geometry,d=this.matrixWorld,C=t.params.Points.threshold,I=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),_sphere.copy(u.boundingSphere),_sphere.applyMatrix4(d),_sphere.radius+=C,t.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(d).invert(),_ray$4.copy(t.ray).applyMatrix4(_inverseMatrix);const f=C/((this.scale.x+this.scale.y+this.scale.z)/3),A=f*f,y=u.index,S=u.attributes.position;if(y!==null){const w=Math.max(0,I.start),M=Math.min(y.count,I.start+I.count);for(let V=w,T=M;V<T;V++){const H=y.getX(V);_position$2.fromBufferAttribute(S,H),testPoint(_position$2,H,A,d,t,o,this)}}else{const w=Math.max(0,I.start),M=Math.min(S.count,I.start+I.count);for(let V=w,T=M;V<T;V++)_position$2.fromBufferAttribute(S,V),testPoint(_position$2,V,A,d,t,o,this)}}updateMorphTargets(){const o=this.geometry.morphAttributes,u=Object.keys(o);if(u.length>0){const d=o[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let C=0,I=d.length;C<I;C++){const f=d[C].name||String(C);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=C}}}}}function testPoint(n,t,o,u,d,C,I){const f=_ray$4.distanceSqToPoint(n);if(f<o){const A=new Vector3;_ray$4.closestPointToPoint(n,A),A.applyMatrix4(u);const y=d.ray.origin.distanceTo(A);if(y<d.near||y>d.far)return;C.push({distance:y,distanceToRay:Math.sqrt(f),point:A,index:t,face:null,faceIndex:null,barycoord:null,object:I})}}class VideoTexture extends Texture{constructor(t,o,u,d,C,I,f,A,y){super(t,o,u,d,C,I,f,A,y),this.isVideoTexture=!0,this.minFilter=I!==void 0?I:LinearFilter,this.magFilter=C!==void 0?C:LinearFilter,this.generateMipmaps=!1;const G=this;function S(){G.needsUpdate=!0,t.requestVideoFrameCallback(S)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(S)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class VideoFrameTexture extends VideoTexture{constructor(t,o,u,d,C,I,f,A){super({},t,o,u,d,C,I,f,A),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class FramebufferTexture extends Texture{constructor(t,o){super({width:t,height:o}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(t,o,u,d,C,I,f,A,y,G,S,w){super(null,I,f,A,y,G,d,C,S,w),this.isCompressedTexture=!0,this.image={width:o,height:u},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(t,o,u,d,C,I){super(t,o,u,C,I),this.isCompressedArrayTexture=!0,this.image.depth=d,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(t,o,u){super(void 0,t[0].width,t[0].height,o,u,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class CanvasTexture extends Texture{constructor(t,o,u,d,C,I,f,A,y){super(t,o,u,d,C,I,f,A,y),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(t,o,u,d,C,I,f,A,y,G=DepthFormat){if(G!==DepthFormat&&G!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");u===void 0&&G===DepthFormat&&(u=UnsignedIntType),u===void 0&&G===DepthStencilFormat&&(u=UnsignedInt248Type),super(null,d,C,I,f,A,G,u,y),this.isDepthTexture=!0,this.image={width:t,height:o},this.magFilter=f!==void 0?f:NearestFilter,this.minFilter=A!==void 0?A:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Source(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const o=super.toJSON(t);return this.compareFunction!==null&&(o.compareFunction=this.compareFunction),o}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,o){const u=this.getUtoTmapping(t);return this.getPoint(u,o)}getPoints(t=5){const o=[];for(let u=0;u<=t;u++)o.push(this.getPoint(u/t));return o}getSpacedPoints(t=5){const o=[];for(let u=0;u<=t;u++)o.push(this.getPointAt(u/t));return o}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const o=[];let u,d=this.getPoint(0),C=0;o.push(0);for(let I=1;I<=t;I++)u=this.getPoint(I/t),C+=u.distanceTo(d),o.push(C),d=u;return this.cacheArcLengths=o,o}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,o=null){const u=this.getLengths();let d=0;const C=u.length;let I;o?I=o:I=t*u[C-1];let f=0,A=C-1,y;for(;f<=A;)if(d=Math.floor(f+(A-f)/2),y=u[d]-I,y<0)f=d+1;else if(y>0)A=d-1;else{A=d;break}if(d=A,u[d]===I)return d/(C-1);const G=u[d],w=u[d+1]-G,M=(I-G)/w;return(d+M)/(C-1)}getTangent(t,o){let d=t-1e-4,C=t+1e-4;d<0&&(d=0),C>1&&(C=1);const I=this.getPoint(d),f=this.getPoint(C),A=o||(I.isVector2?new Vector2:new Vector3);return A.copy(f).sub(I).normalize(),A}getTangentAt(t,o){const u=this.getUtoTmapping(t);return this.getTangent(u,o)}computeFrenetFrames(t,o=!1){const u=new Vector3,d=[],C=[],I=[],f=new Vector3,A=new Matrix4;for(let M=0;M<=t;M++){const V=M/t;d[M]=this.getTangentAt(V,new Vector3)}C[0]=new Vector3,I[0]=new Vector3;let y=Number.MAX_VALUE;const G=Math.abs(d[0].x),S=Math.abs(d[0].y),w=Math.abs(d[0].z);G<=y&&(y=G,u.set(1,0,0)),S<=y&&(y=S,u.set(0,1,0)),w<=y&&u.set(0,0,1),f.crossVectors(d[0],u).normalize(),C[0].crossVectors(d[0],f),I[0].crossVectors(d[0],C[0]);for(let M=1;M<=t;M++){if(C[M]=C[M-1].clone(),I[M]=I[M-1].clone(),f.crossVectors(d[M-1],d[M]),f.length()>Number.EPSILON){f.normalize();const V=Math.acos(clamp$1(d[M-1].dot(d[M]),-1,1));C[M].applyMatrix4(A.makeRotationAxis(f,V))}I[M].crossVectors(d[M],C[M])}if(o===!0){let M=Math.acos(clamp$1(C[0].dot(C[t]),-1,1));M/=t,d[0].dot(f.crossVectors(C[0],C[t]))>0&&(M=-M);for(let V=1;V<=t;V++)C[V].applyMatrix4(A.makeRotationAxis(d[V],M*V)),I[V].crossVectors(d[V],C[V])}return{tangents:d,normals:C,binormals:I}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,o=0,u=1,d=1,C=0,I=Math.PI*2,f=!1,A=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=o,this.xRadius=u,this.yRadius=d,this.aStartAngle=C,this.aEndAngle=I,this.aClockwise=f,this.aRotation=A}getPoint(t,o=new Vector2){const u=o,d=Math.PI*2;let C=this.aEndAngle-this.aStartAngle;const I=Math.abs(C)<Number.EPSILON;for(;C<0;)C+=d;for(;C>d;)C-=d;C<Number.EPSILON&&(I?C=0:C=d),this.aClockwise===!0&&!I&&(C===d?C=-d:C=C-d);const f=this.aStartAngle+t*C;let A=this.aX+this.xRadius*Math.cos(f),y=this.aY+this.yRadius*Math.sin(f);if(this.aRotation!==0){const G=Math.cos(this.aRotation),S=Math.sin(this.aRotation),w=A-this.aX,M=y-this.aY;A=w*G-M*S+this.aX,y=w*S+M*G+this.aY}return u.set(A,y)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(t,o,u,d,C,I){super(t,o,u,u,d,C,I),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let n=0,t=0,o=0,u=0;function d(C,I,f,A){n=C,t=f,o=-3*C+3*I-2*f-A,u=2*C-2*I+f+A}return{initCatmullRom:function(C,I,f,A,y){d(I,f,y*(f-C),y*(A-I))},initNonuniformCatmullRom:function(C,I,f,A,y,G,S){let w=(I-C)/y-(f-C)/(y+G)+(f-I)/G,M=(f-I)/G-(A-I)/(G+S)+(A-f)/S;w*=G,M*=G,d(I,f,w,M)},calc:function(C){const I=C*C,f=I*C;return n+t*C+o*I+u*f}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],o=!1,u="centripetal",d=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=o,this.curveType=u,this.tension=d}getPoint(t,o=new Vector3){const u=o,d=this.points,C=d.length,I=(C-(this.closed?0:1))*t;let f=Math.floor(I),A=I-f;this.closed?f+=f>0?0:(Math.floor(Math.abs(f)/C)+1)*C:A===0&&f===C-1&&(f=C-2,A=1);let y,G;this.closed||f>0?y=d[(f-1)%C]:(tmp.subVectors(d[0],d[1]).add(d[0]),y=tmp);const S=d[f%C],w=d[(f+1)%C];if(this.closed||f+2<C?G=d[(f+2)%C]:(tmp.subVectors(d[C-1],d[C-2]).add(d[C-1]),G=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const M=this.curveType==="chordal"?.5:.25;let V=Math.pow(y.distanceToSquared(S),M),T=Math.pow(S.distanceToSquared(w),M),H=Math.pow(w.distanceToSquared(G),M);T<1e-4&&(T=1),V<1e-4&&(V=T),H<1e-4&&(H=T),px.initNonuniformCatmullRom(y.x,S.x,w.x,G.x,V,T,H),py.initNonuniformCatmullRom(y.y,S.y,w.y,G.y,V,T,H),pz.initNonuniformCatmullRom(y.z,S.z,w.z,G.z,V,T,H)}else this.curveType==="catmullrom"&&(px.initCatmullRom(y.x,S.x,w.x,G.x,this.tension),py.initCatmullRom(y.y,S.y,w.y,G.y,this.tension),pz.initCatmullRom(y.z,S.z,w.z,G.z,this.tension));return u.set(px.calc(A),py.calc(A),pz.calc(A)),u}copy(t){super.copy(t),this.points=[];for(let o=0,u=t.points.length;o<u;o++){const d=t.points[o];this.points.push(d.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let o=0,u=this.points.length;o<u;o++){const d=this.points[o];t.points.push(d.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let o=0,u=t.points.length;o<u;o++){const d=t.points[o];this.points.push(new Vector3().fromArray(d))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function CatmullRom(n,t,o,u,d){const C=(u-t)*.5,I=(d-o)*.5,f=n*n,A=n*f;return(2*o-2*u+C+I)*A+(-3*o+3*u-2*C-I)*f+C*n+o}function QuadraticBezierP0(n,t){const o=1-n;return o*o*t}function QuadraticBezierP1(n,t){return 2*(1-n)*n*t}function QuadraticBezierP2(n,t){return n*n*t}function QuadraticBezier(n,t,o,u){return QuadraticBezierP0(n,t)+QuadraticBezierP1(n,o)+QuadraticBezierP2(n,u)}function CubicBezierP0(n,t){const o=1-n;return o*o*o*t}function CubicBezierP1(n,t){const o=1-n;return 3*o*o*n*t}function CubicBezierP2(n,t){return 3*(1-n)*n*n*t}function CubicBezierP3(n,t){return n*n*n*t}function CubicBezier(n,t,o,u,d){return CubicBezierP0(n,t)+CubicBezierP1(n,o)+CubicBezierP2(n,u)+CubicBezierP3(n,d)}class CubicBezierCurve extends Curve{constructor(t=new Vector2,o=new Vector2,u=new Vector2,d=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=o,this.v2=u,this.v3=d}getPoint(t,o=new Vector2){const u=o,d=this.v0,C=this.v1,I=this.v2,f=this.v3;return u.set(CubicBezier(t,d.x,C.x,I.x,f.x),CubicBezier(t,d.y,C.y,I.y,f.y)),u}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class CubicBezierCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3,u=new Vector3,d=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=o,this.v2=u,this.v3=d}getPoint(t,o=new Vector3){const u=o,d=this.v0,C=this.v1,I=this.v2,f=this.v3;return u.set(CubicBezier(t,d.x,C.x,I.x,f.x),CubicBezier(t,d.y,C.y,I.y,f.y),CubicBezier(t,d.z,C.z,I.z,f.z)),u}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class LineCurve extends Curve{constructor(t=new Vector2,o=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=o}getPoint(t,o=new Vector2){const u=o;return t===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(t).add(this.v1)),u}getPointAt(t,o){return this.getPoint(t,o)}getTangent(t,o=new Vector2){return o.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,o){return this.getTangent(t,o)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class LineCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=o}getPoint(t,o=new Vector3){const u=o;return t===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(t).add(this.v1)),u}getPointAt(t,o){return this.getPoint(t,o)}getTangent(t,o=new Vector3){return o.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,o){return this.getTangent(t,o)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,o=new Vector2,u=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=o,this.v2=u}getPoint(t,o=new Vector2){const u=o,d=this.v0,C=this.v1,I=this.v2;return u.set(QuadraticBezier(t,d.x,C.x,I.x),QuadraticBezier(t,d.y,C.y,I.y)),u}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(t=new Vector3,o=new Vector3,u=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=o,this.v2=u}getPoint(t,o=new Vector3){const u=o,d=this.v0,C=this.v1,I=this.v2;return u.set(QuadraticBezier(t,d.x,C.x,I.x),QuadraticBezier(t,d.y,C.y,I.y),QuadraticBezier(t,d.z,C.z,I.z)),u}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class SplineCurve extends Curve{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,o=new Vector2){const u=o,d=this.points,C=(d.length-1)*t,I=Math.floor(C),f=C-I,A=d[I===0?I:I-1],y=d[I],G=d[I>d.length-2?d.length-1:I+1],S=d[I>d.length-3?d.length-1:I+2];return u.set(CatmullRom(f,A.x,y.x,G.x,S.x),CatmullRom(f,A.y,y.y,G.y,S.y)),u}copy(t){super.copy(t),this.points=[];for(let o=0,u=t.points.length;o<u;o++){const d=t.points[o];this.points.push(d.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let o=0,u=this.points.length;o<u;o++){const d=this.points[o];t.points.push(d.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let o=0,u=t.points.length;o<u;o++){const d=t.points[o];this.points.push(new Vector2().fromArray(d))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(o)){const u=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves[u](o,t))}return this}getPoint(t,o){const u=t*this.getLength(),d=this.getCurveLengths();let C=0;for(;C<d.length;){if(d[C]>=u){const I=d[C]-u,f=this.curves[C],A=f.getLength(),y=A===0?0:1-I/A;return f.getPointAt(y,o)}C++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let o=0;for(let u=0,d=this.curves.length;u<d;u++)o+=this.curves[u].getLength(),t.push(o);return this.cacheLengths=t,t}getSpacedPoints(t=40){const o=[];for(let u=0;u<=t;u++)o.push(this.getPoint(u/t));return this.autoClose&&o.push(o[0]),o}getPoints(t=12){const o=[];let u;for(let d=0,C=this.curves;d<C.length;d++){const I=C[d],f=I.isEllipseCurve?t*2:I.isLineCurve||I.isLineCurve3?1:I.isSplineCurve?t*I.points.length:t,A=I.getPoints(f);for(let y=0;y<A.length;y++){const G=A[y];u&&u.equals(G)||(o.push(G),u=G)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}copy(t){super.copy(t),this.curves=[];for(let o=0,u=t.curves.length;o<u;o++){const d=t.curves[o];this.curves.push(d.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let o=0,u=this.curves.length;o<u;o++){const d=this.curves[o];t.curves.push(d.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let o=0,u=t.curves.length;o<u;o++){const d=t.curves[o];this.curves.push(new Curves[d.type]().fromJSON(d))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let o=1,u=t.length;o<u;o++)this.lineTo(t[o].x,t[o].y);return this}moveTo(t,o){return this.currentPoint.set(t,o),this}lineTo(t,o){const u=new LineCurve(this.currentPoint.clone(),new Vector2(t,o));return this.curves.push(u),this.currentPoint.set(t,o),this}quadraticCurveTo(t,o,u,d){const C=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,o),new Vector2(u,d));return this.curves.push(C),this.currentPoint.set(u,d),this}bezierCurveTo(t,o,u,d,C,I){const f=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,o),new Vector2(u,d),new Vector2(C,I));return this.curves.push(f),this.currentPoint.set(C,I),this}splineThru(t){const o=[this.currentPoint.clone()].concat(t),u=new SplineCurve(o);return this.curves.push(u),this.currentPoint.copy(t[t.length-1]),this}arc(t,o,u,d,C,I){const f=this.currentPoint.x,A=this.currentPoint.y;return this.absarc(t+f,o+A,u,d,C,I),this}absarc(t,o,u,d,C,I){return this.absellipse(t,o,u,u,d,C,I),this}ellipse(t,o,u,d,C,I,f,A){const y=this.currentPoint.x,G=this.currentPoint.y;return this.absellipse(t+y,o+G,u,d,C,I,f,A),this}absellipse(t,o,u,d,C,I,f,A){const y=new EllipseCurve(t,o,u,d,C,I,f,A);if(this.curves.length>0){const S=y.getPoint(0);S.equals(this.currentPoint)||this.lineTo(S.x,S.y)}this.curves.push(y);const G=y.getPoint(1);return this.currentPoint.copy(G),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(t=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],o=12,u=0,d=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:o,phiStart:u,phiLength:d},o=Math.floor(o),d=clamp$1(d,0,Math.PI*2);const C=[],I=[],f=[],A=[],y=[],G=1/o,S=new Vector3,w=new Vector2,M=new Vector3,V=new Vector3,T=new Vector3;let H=0,J=0;for(let z=0;z<=t.length-1;z++)switch(z){case 0:H=t[z+1].x-t[z].x,J=t[z+1].y-t[z].y,M.x=J*1,M.y=-H,M.z=J*0,T.copy(M),M.normalize(),A.push(M.x,M.y,M.z);break;case t.length-1:A.push(T.x,T.y,T.z);break;default:H=t[z+1].x-t[z].x,J=t[z+1].y-t[z].y,M.x=J*1,M.y=-H,M.z=J*0,V.copy(M),M.x+=T.x,M.y+=T.y,M.z+=T.z,M.normalize(),A.push(M.x,M.y,M.z),T.copy(V)}for(let z=0;z<=o;z++){const L=u+z*G*d,K=Math.sin(L),O=Math.cos(L);for(let Q=0;Q<=t.length-1;Q++){S.x=t[Q].x*K,S.y=t[Q].y,S.z=t[Q].x*O,I.push(S.x,S.y,S.z),w.x=z/o,w.y=Q/(t.length-1),f.push(w.x,w.y);const ee=A[3*Q+0]*K,ie=A[3*Q+1],te=A[3*Q+0]*O;y.push(ee,ie,te)}}for(let z=0;z<o;z++)for(let L=0;L<t.length-1;L++){const K=L+z*t.length,O=K,Q=K+t.length,ee=K+t.length+1,ie=K+1;C.push(O,Q,ie),C.push(ee,ie,Q)}this.setIndex(C),this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2)),this.setAttribute("normal",new Float32BufferAttribute(y,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new LatheGeometry(t.points,t.segments,t.phiStart,t.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(t=1,o=1,u=4,d=8){const C=new Path;C.absarc(0,-o/2,t,Math.PI*1.5,0),C.absarc(0,o/2,t,0,Math.PI*.5),super(C.getPoints(u),d),this.type="CapsuleGeometry",this.parameters={radius:t,length:o,capSegments:u,radialSegments:d}}static fromJSON(t){return new CapsuleGeometry(t.radius,t.length,t.capSegments,t.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(t=1,o=32,u=0,d=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:o,thetaStart:u,thetaLength:d},o=Math.max(3,o);const C=[],I=[],f=[],A=[],y=new Vector3,G=new Vector2;I.push(0,0,0),f.push(0,0,1),A.push(.5,.5);for(let S=0,w=3;S<=o;S++,w+=3){const M=u+S/o*d;y.x=t*Math.cos(M),y.y=t*Math.sin(M),I.push(y.x,y.y,y.z),f.push(0,0,1),G.x=(I[w]/t+1)/2,G.y=(I[w+1]/t+1)/2,A.push(G.x,G.y)}for(let S=1;S<=o;S++)C.push(S,S+1,0);this.setIndex(C),this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(A,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CircleGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(t=1,o=1,u=1,d=32,C=1,I=!1,f=0,A=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:o,height:u,radialSegments:d,heightSegments:C,openEnded:I,thetaStart:f,thetaLength:A};const y=this;d=Math.floor(d),C=Math.floor(C);const G=[],S=[],w=[],M=[];let V=0;const T=[],H=u/2;let J=0;z(),I===!1&&(t>0&&L(!0),o>0&&L(!1)),this.setIndex(G),this.setAttribute("position",new Float32BufferAttribute(S,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2));function z(){const K=new Vector3,O=new Vector3;let Q=0;const ee=(o-t)/u;for(let ie=0;ie<=C;ie++){const te=[],se=ie/C,ae=se*(o-t)+t;for(let le=0;le<=d;le++){const ge=le/d,be=ge*A+f,Xe=Math.sin(be),Ce=Math.cos(be);O.x=ae*Xe,O.y=-se*u+H,O.z=ae*Ce,S.push(O.x,O.y,O.z),K.set(Xe,ee,Ce).normalize(),w.push(K.x,K.y,K.z),M.push(ge,1-se),te.push(V++)}T.push(te)}for(let ie=0;ie<d;ie++)for(let te=0;te<C;te++){const se=T[te][ie],ae=T[te+1][ie],le=T[te+1][ie+1],ge=T[te][ie+1];(t>0||te!==0)&&(G.push(se,ae,ge),Q+=3),(o>0||te!==C-1)&&(G.push(ae,le,ge),Q+=3)}y.addGroup(J,Q,0),J+=Q}function L(K){const O=V,Q=new Vector2,ee=new Vector3;let ie=0;const te=K===!0?t:o,se=K===!0?1:-1;for(let le=1;le<=d;le++)S.push(0,H*se,0),w.push(0,se,0),M.push(.5,.5),V++;const ae=V;for(let le=0;le<=d;le++){const be=le/d*A+f,Xe=Math.cos(be),Ce=Math.sin(be);ee.x=te*Ce,ee.y=H*se,ee.z=te*Xe,S.push(ee.x,ee.y,ee.z),w.push(0,se,0),Q.x=Xe*.5+.5,Q.y=Ce*.5*se+.5,M.push(Q.x,Q.y),V++}for(let le=0;le<d;le++){const ge=O+le,be=ae+le;K===!0?G.push(be,be+1,ge):G.push(be+1,be,ge),ie+=3}y.addGroup(J,ie,K===!0?1:2),J+=ie}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(t=1,o=1,u=32,d=1,C=!1,I=0,f=Math.PI*2){super(0,t,o,u,d,C,I,f),this.type="ConeGeometry",this.parameters={radius:t,height:o,radialSegments:u,heightSegments:d,openEnded:C,thetaStart:I,thetaLength:f}}static fromJSON(t){return new ConeGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(t=[],o=[],u=1,d=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:o,radius:u,detail:d};const C=[],I=[];f(d),y(u),G(),this.setAttribute("position",new Float32BufferAttribute(C,3)),this.setAttribute("normal",new Float32BufferAttribute(C.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(I,2)),d===0?this.computeVertexNormals():this.normalizeNormals();function f(z){const L=new Vector3,K=new Vector3,O=new Vector3;for(let Q=0;Q<o.length;Q+=3)M(o[Q+0],L),M(o[Q+1],K),M(o[Q+2],O),A(L,K,O,z)}function A(z,L,K,O){const Q=O+1,ee=[];for(let ie=0;ie<=Q;ie++){ee[ie]=[];const te=z.clone().lerp(K,ie/Q),se=L.clone().lerp(K,ie/Q),ae=Q-ie;for(let le=0;le<=ae;le++)le===0&&ie===Q?ee[ie][le]=te:ee[ie][le]=te.clone().lerp(se,le/ae)}for(let ie=0;ie<Q;ie++)for(let te=0;te<2*(Q-ie)-1;te++){const se=Math.floor(te/2);te%2===0?(w(ee[ie][se+1]),w(ee[ie+1][se]),w(ee[ie][se])):(w(ee[ie][se+1]),w(ee[ie+1][se+1]),w(ee[ie+1][se]))}}function y(z){const L=new Vector3;for(let K=0;K<C.length;K+=3)L.x=C[K+0],L.y=C[K+1],L.z=C[K+2],L.normalize().multiplyScalar(z),C[K+0]=L.x,C[K+1]=L.y,C[K+2]=L.z}function G(){const z=new Vector3;for(let L=0;L<C.length;L+=3){z.x=C[L+0],z.y=C[L+1],z.z=C[L+2];const K=H(z)/2/Math.PI+.5,O=J(z)/Math.PI+.5;I.push(K,1-O)}V(),S()}function S(){for(let z=0;z<I.length;z+=6){const L=I[z+0],K=I[z+2],O=I[z+4],Q=Math.max(L,K,O),ee=Math.min(L,K,O);Q>.9&&ee<.1&&(L<.2&&(I[z+0]+=1),K<.2&&(I[z+2]+=1),O<.2&&(I[z+4]+=1))}}function w(z){C.push(z.x,z.y,z.z)}function M(z,L){const K=z*3;L.x=t[K+0],L.y=t[K+1],L.z=t[K+2]}function V(){const z=new Vector3,L=new Vector3,K=new Vector3,O=new Vector3,Q=new Vector2,ee=new Vector2,ie=new Vector2;for(let te=0,se=0;te<C.length;te+=9,se+=6){z.set(C[te+0],C[te+1],C[te+2]),L.set(C[te+3],C[te+4],C[te+5]),K.set(C[te+6],C[te+7],C[te+8]),Q.set(I[se+0],I[se+1]),ee.set(I[se+2],I[se+3]),ie.set(I[se+4],I[se+5]),O.copy(z).add(L).add(K).divideScalar(3);const ae=H(O);T(Q,se+0,z,ae),T(ee,se+2,L,ae),T(ie,se+4,K,ae)}}function T(z,L,K,O){O<0&&z.x===1&&(I[L]=z.x-1),K.x===0&&K.z===0&&(I[L]=O/2/Math.PI+.5)}function H(z){return Math.atan2(z.z,-z.x)}function J(z){return Math.atan2(-z.y,Math.sqrt(z.x*z.x+z.z*z.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PolyhedronGeometry(t.vertices,t.indices,t.radius,t.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const u=(1+Math.sqrt(5))/2,d=1/u,C=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-u,0,-d,u,0,d,-u,0,d,u,-d,-u,0,-d,u,0,d,-u,0,d,u,0,-u,0,-d,u,0,-d,-u,0,d,u,0,d],I=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(C,I,t,o),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new DodecahedronGeometry(t.radius,t.detail)}}const _v0$3=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t=null,o=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:o},t!==null){const d=Math.pow(10,4),C=Math.cos(DEG2RAD*o),I=t.getIndex(),f=t.getAttribute("position"),A=I?I.count:f.count,y=[0,0,0],G=["a","b","c"],S=new Array(3),w={},M=[];for(let V=0;V<A;V+=3){I?(y[0]=I.getX(V),y[1]=I.getX(V+1),y[2]=I.getX(V+2)):(y[0]=V,y[1]=V+1,y[2]=V+2);const{a:T,b:H,c:J}=_triangle;if(T.fromBufferAttribute(f,y[0]),H.fromBufferAttribute(f,y[1]),J.fromBufferAttribute(f,y[2]),_triangle.getNormal(_normal),S[0]=`${Math.round(T.x*d)},${Math.round(T.y*d)},${Math.round(T.z*d)}`,S[1]=`${Math.round(H.x*d)},${Math.round(H.y*d)},${Math.round(H.z*d)}`,S[2]=`${Math.round(J.x*d)},${Math.round(J.y*d)},${Math.round(J.z*d)}`,!(S[0]===S[1]||S[1]===S[2]||S[2]===S[0]))for(let z=0;z<3;z++){const L=(z+1)%3,K=S[z],O=S[L],Q=_triangle[G[z]],ee=_triangle[G[L]],ie=`${K}_${O}`,te=`${O}_${K}`;te in w&&w[te]?(_normal.dot(w[te].normal)<=C&&(M.push(Q.x,Q.y,Q.z),M.push(ee.x,ee.y,ee.z)),w[te]=null):ie in w||(w[ie]={index0:y[z],index1:y[L],normal:_normal.clone()})}}for(const V in w)if(w[V]){const{index0:T,index1:H}=w[V];_v0$3.fromBufferAttribute(f,T),_v1$1.fromBufferAttribute(f,H),M.push(_v0$3.x,_v0$3.y,_v0$3.z),M.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(M,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}let Shape$2=class extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const o=[];for(let u=0,d=this.holes.length;u<d;u++)o[u]=this.holes[u].getPoints(t);return o}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let o=0,u=t.holes.length;o<u;o++){const d=t.holes[o];this.holes.push(d.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let o=0,u=this.holes.length;o<u;o++){const d=this.holes[o];t.holes.push(d.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let o=0,u=t.holes.length;o<u;o++){const d=t.holes[o];this.holes.push(new Path().fromJSON(d))}return this}};class Earcut{static triangulate(t,o,u=2){const d=o&&o.length,C=d?o[0]*u:t.length;let I=linkedList(t,0,C,u,!0);const f=[];if(!I||I.next===I.prev)return f;let A,y,G,S,w,M,V;if(d&&(I=eliminateHoles(t,o,I,u)),t.length>80*u){A=G=t[0],y=S=t[1];for(let T=u;T<C;T+=u)w=t[T],M=t[T+1],w<A&&(A=w),M<y&&(y=M),w>G&&(G=w),M>S&&(S=M);V=Math.max(G-A,S-y),V=V!==0?32767/V:0}return earcutLinked(I,f,u,A,y,V,0),f}}function linkedList(n,t,o,u,d){let C,I;if(d===signedArea(n,t,o,u)>0)for(C=t;C<o;C+=u)I=insertNode(C,n[C],n[C+1],I);else for(C=o-u;C>=t;C-=u)I=insertNode(C,n[C],n[C+1],I);return I&&equals(I,I.next)&&(removeNode(I),I=I.next),I}function filterPoints(n,t){if(!n)return n;t||(t=n);let o=n,u;do if(u=!1,!o.steiner&&(equals(o,o.next)||area(o.prev,o,o.next)===0)){if(removeNode(o),o=t=o.prev,o===o.next)break;u=!0}else o=o.next;while(u||o!==t);return t}function earcutLinked(n,t,o,u,d,C,I){if(!n)return;!I&&C&&indexCurve(n,u,d,C);let f=n,A,y;for(;n.prev!==n.next;){if(A=n.prev,y=n.next,C?isEarHashed(n,u,d,C):isEar(n)){t.push(A.i/o|0),t.push(n.i/o|0),t.push(y.i/o|0),removeNode(n),n=y.next,f=y.next;continue}if(n=y,n===f){I?I===1?(n=cureLocalIntersections(filterPoints(n),t,o),earcutLinked(n,t,o,u,d,C,2)):I===2&&splitEarcut(n,t,o,u,d,C):earcutLinked(filterPoints(n),t,o,u,d,C,1);break}}}function isEar(n){const t=n.prev,o=n,u=n.next;if(area(t,o,u)>=0)return!1;const d=t.x,C=o.x,I=u.x,f=t.y,A=o.y,y=u.y,G=d<C?d<I?d:I:C<I?C:I,S=f<A?f<y?f:y:A<y?A:y,w=d>C?d>I?d:I:C>I?C:I,M=f>A?f>y?f:y:A>y?A:y;let V=u.next;for(;V!==t;){if(V.x>=G&&V.x<=w&&V.y>=S&&V.y<=M&&pointInTriangle(d,f,C,A,I,y,V.x,V.y)&&area(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function isEarHashed(n,t,o,u){const d=n.prev,C=n,I=n.next;if(area(d,C,I)>=0)return!1;const f=d.x,A=C.x,y=I.x,G=d.y,S=C.y,w=I.y,M=f<A?f<y?f:y:A<y?A:y,V=G<S?G<w?G:w:S<w?S:w,T=f>A?f>y?f:y:A>y?A:y,H=G>S?G>w?G:w:S>w?S:w,J=zOrder(M,V,t,o,u),z=zOrder(T,H,t,o,u);let L=n.prevZ,K=n.nextZ;for(;L&&L.z>=J&&K&&K.z<=z;){if(L.x>=M&&L.x<=T&&L.y>=V&&L.y<=H&&L!==d&&L!==I&&pointInTriangle(f,G,A,S,y,w,L.x,L.y)&&area(L.prev,L,L.next)>=0||(L=L.prevZ,K.x>=M&&K.x<=T&&K.y>=V&&K.y<=H&&K!==d&&K!==I&&pointInTriangle(f,G,A,S,y,w,K.x,K.y)&&area(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;L&&L.z>=J;){if(L.x>=M&&L.x<=T&&L.y>=V&&L.y<=H&&L!==d&&L!==I&&pointInTriangle(f,G,A,S,y,w,L.x,L.y)&&area(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;K&&K.z<=z;){if(K.x>=M&&K.x<=T&&K.y>=V&&K.y<=H&&K!==d&&K!==I&&pointInTriangle(f,G,A,S,y,w,K.x,K.y)&&area(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function cureLocalIntersections(n,t,o){let u=n;do{const d=u.prev,C=u.next.next;!equals(d,C)&&intersects(d,u,u.next,C)&&locallyInside(d,C)&&locallyInside(C,d)&&(t.push(d.i/o|0),t.push(u.i/o|0),t.push(C.i/o|0),removeNode(u),removeNode(u.next),u=n=C),u=u.next}while(u!==n);return filterPoints(u)}function splitEarcut(n,t,o,u,d,C){let I=n;do{let f=I.next.next;for(;f!==I.prev;){if(I.i!==f.i&&isValidDiagonal(I,f)){let A=splitPolygon(I,f);I=filterPoints(I,I.next),A=filterPoints(A,A.next),earcutLinked(I,t,o,u,d,C,0),earcutLinked(A,t,o,u,d,C,0);return}f=f.next}I=I.next}while(I!==n)}function eliminateHoles(n,t,o,u){const d=[];let C,I,f,A,y;for(C=0,I=t.length;C<I;C++)f=t[C]*u,A=C<I-1?t[C+1]*u:n.length,y=linkedList(n,f,A,u,!1),y===y.next&&(y.steiner=!0),d.push(getLeftmost(y));for(d.sort(compareX),C=0;C<d.length;C++)o=eliminateHole(d[C],o);return o}function compareX(n,t){return n.x-t.x}function eliminateHole(n,t){const o=findHoleBridge(n,t);if(!o)return t;const u=splitPolygon(o,n);return filterPoints(u,u.next),filterPoints(o,o.next)}function findHoleBridge(n,t){let o=t,u=-1/0,d;const C=n.x,I=n.y;do{if(I<=o.y&&I>=o.next.y&&o.next.y!==o.y){const w=o.x+(I-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(w<=C&&w>u&&(u=w,d=o.x<o.next.x?o:o.next,w===C))return d}o=o.next}while(o!==t);if(!d)return null;const f=d,A=d.x,y=d.y;let G=1/0,S;o=d;do C>=o.x&&o.x>=A&&C!==o.x&&pointInTriangle(I<y?C:u,I,A,y,I<y?u:C,I,o.x,o.y)&&(S=Math.abs(I-o.y)/(C-o.x),locallyInside(o,n)&&(S<G||S===G&&(o.x>d.x||o.x===d.x&&sectorContainsSector(d,o)))&&(d=o,G=S)),o=o.next;while(o!==f);return d}function sectorContainsSector(n,t){return area(n.prev,n,t.prev)<0&&area(t.next,n,n.next)<0}function indexCurve(n,t,o,u){let d=n;do d.z===0&&(d.z=zOrder(d.x,d.y,t,o,u)),d.prevZ=d.prev,d.nextZ=d.next,d=d.next;while(d!==n);d.prevZ.nextZ=null,d.prevZ=null,sortLinked(d)}function sortLinked(n){let t,o,u,d,C,I,f,A,y=1;do{for(o=n,n=null,C=null,I=0;o;){for(I++,u=o,f=0,t=0;t<y&&(f++,u=u.nextZ,!!u);t++);for(A=y;f>0||A>0&&u;)f!==0&&(A===0||!u||o.z<=u.z)?(d=o,o=o.nextZ,f--):(d=u,u=u.nextZ,A--),C?C.nextZ=d:n=d,d.prevZ=C,C=d;o=u}C.nextZ=null,y*=2}while(I>1);return n}function zOrder(n,t,o,u,d){return n=(n-o)*d|0,t=(t-u)*d|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function getLeftmost(n){let t=n,o=n;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==n);return o}function pointInTriangle(n,t,o,u,d,C,I,f){return(d-I)*(t-f)>=(n-I)*(C-f)&&(n-I)*(u-f)>=(o-I)*(t-f)&&(o-I)*(C-f)>=(d-I)*(u-f)}function isValidDiagonal(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!intersectsPolygon(n,t)&&(locallyInside(n,t)&&locallyInside(t,n)&&middleInside(n,t)&&(area(n.prev,n,t.prev)||area(n,t.prev,t))||equals(n,t)&&area(n.prev,n,n.next)>0&&area(t.prev,t,t.next)>0)}function area(n,t,o){return(t.y-n.y)*(o.x-t.x)-(t.x-n.x)*(o.y-t.y)}function equals(n,t){return n.x===t.x&&n.y===t.y}function intersects(n,t,o,u){const d=sign(area(n,t,o)),C=sign(area(n,t,u)),I=sign(area(o,u,n)),f=sign(area(o,u,t));return!!(d!==C&&I!==f||d===0&&onSegment(n,o,t)||C===0&&onSegment(n,u,t)||I===0&&onSegment(o,n,u)||f===0&&onSegment(o,t,u))}function onSegment(n,t,o){return t.x<=Math.max(n.x,o.x)&&t.x>=Math.min(n.x,o.x)&&t.y<=Math.max(n.y,o.y)&&t.y>=Math.min(n.y,o.y)}function sign(n){return n>0?1:n<0?-1:0}function intersectsPolygon(n,t){let o=n;do{if(o.i!==n.i&&o.next.i!==n.i&&o.i!==t.i&&o.next.i!==t.i&&intersects(o,o.next,n,t))return!0;o=o.next}while(o!==n);return!1}function locallyInside(n,t){return area(n.prev,n,n.next)<0?area(n,t,n.next)>=0&&area(n,n.prev,t)>=0:area(n,t,n.prev)<0||area(n,n.next,t)<0}function middleInside(n,t){let o=n,u=!1;const d=(n.x+t.x)/2,C=(n.y+t.y)/2;do o.y>C!=o.next.y>C&&o.next.y!==o.y&&d<(o.next.x-o.x)*(C-o.y)/(o.next.y-o.y)+o.x&&(u=!u),o=o.next;while(o!==n);return u}function splitPolygon(n,t){const o=new Node(n.i,n.x,n.y),u=new Node(t.i,t.x,t.y),d=n.next,C=t.prev;return n.next=t,t.prev=n,o.next=d,d.prev=o,u.next=o,o.prev=u,C.next=u,u.prev=C,u}function insertNode(n,t,o,u){const d=new Node(n,t,o);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function removeNode(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Node(n,t,o){this.i=n,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(n,t,o,u){let d=0;for(let C=t,I=o-u;C<o;C+=u)d+=(n[I]-n[C])*(n[C+1]+n[I+1]),I=C;return d}class ShapeUtils{static area(t){const o=t.length;let u=0;for(let d=o-1,C=0;C<o;d=C++)u+=t[d].x*t[C].y-t[C].x*t[d].y;return u*.5}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,o){const u=[],d=[],C=[];removeDupEndPts(t),addContour(u,t);let I=t.length;o.forEach(removeDupEndPts);for(let A=0;A<o.length;A++)d.push(I),I+=o[A].length,addContour(u,o[A]);const f=Earcut.triangulate(u,d);for(let A=0;A<f.length;A+=3)C.push(f.slice(A,A+3));return C}}function removeDupEndPts(n){const t=n.length;t>2&&n[t-1].equals(n[0])&&n.pop()}function addContour(n,t){for(let o=0;o<t.length;o++)n.push(t[o].x),n.push(t[o].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t=new Shape$2([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),o={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:o},t=Array.isArray(t)?t:[t];const u=this,d=[],C=[];for(let f=0,A=t.length;f<A;f++){const y=t[f];I(y)}this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(C,2)),this.computeVertexNormals();function I(f){const A=[],y=o.curveSegments!==void 0?o.curveSegments:12,G=o.steps!==void 0?o.steps:1,S=o.depth!==void 0?o.depth:1;let w=o.bevelEnabled!==void 0?o.bevelEnabled:!0,M=o.bevelThickness!==void 0?o.bevelThickness:.2,V=o.bevelSize!==void 0?o.bevelSize:M-.1,T=o.bevelOffset!==void 0?o.bevelOffset:0,H=o.bevelSegments!==void 0?o.bevelSegments:3;const J=o.extrudePath,z=o.UVGenerator!==void 0?o.UVGenerator:WorldUVGenerator;let L,K=!1,O,Q,ee,ie;J&&(L=J.getSpacedPoints(G),K=!0,w=!1,O=J.computeFrenetFrames(G,!1),Q=new Vector3,ee=new Vector3,ie=new Vector3),w||(H=0,M=0,V=0,T=0);const te=f.extractPoints(y);let se=te.shape;const ae=te.holes;if(!ShapeUtils.isClockWise(se)){se=se.reverse();for(let Qe=0,Ue=ae.length;Qe<Ue;Qe++){const Ge=ae[Qe];ShapeUtils.isClockWise(Ge)&&(ae[Qe]=Ge.reverse())}}const ge=ShapeUtils.triangulateShape(se,ae),be=se;for(let Qe=0,Ue=ae.length;Qe<Ue;Qe++){const Ge=ae[Qe];se=se.concat(Ge)}function Xe(Qe,Ue,Ge){return Ue||console.error("THREE.ExtrudeGeometry: vec does not exist"),Qe.clone().addScaledVector(Ue,Ge)}const Ce=se.length,Re=ge.length;function Se(Qe,Ue,Ge){let Gt,ot,vt;const at=Qe.x-Ue.x,Tt=Qe.y-Ue.y,xt=Ge.x-Qe.x,ve=Ge.y-Qe.y,de=at*at+Tt*Tt,De=at*ve-Tt*xt;if(Math.abs(De)>Number.EPSILON){const nt=Math.sqrt(de),dt=Math.sqrt(xt*xt+ve*ve),ze=Ue.x-Tt/nt,rt=Ue.y+at/nt,Rt=Ge.x-ve/dt,Mt=Ge.y+xt/dt,Yt=((Rt-ze)*ve-(Mt-rt)*xt)/(at*ve-Tt*xt);Gt=ze+at*Yt-Qe.x,ot=rt+Tt*Yt-Qe.y;const Oe=Gt*Gt+ot*ot;if(Oe<=2)return new Vector2(Gt,ot);vt=Math.sqrt(Oe/2)}else{let nt=!1;at>Number.EPSILON?xt>Number.EPSILON&&(nt=!0):at<-Number.EPSILON?xt<-Number.EPSILON&&(nt=!0):Math.sign(Tt)===Math.sign(ve)&&(nt=!0),nt?(Gt=-Tt,ot=at,vt=Math.sqrt(de)):(Gt=at,ot=Tt,vt=Math.sqrt(de/2))}return new Vector2(Gt/vt,ot/vt)}const Ze=[];for(let Qe=0,Ue=be.length,Ge=Ue-1,Gt=Qe+1;Qe<Ue;Qe++,Ge++,Gt++)Ge===Ue&&(Ge=0),Gt===Ue&&(Gt=0),Ze[Qe]=Se(be[Qe],be[Ge],be[Gt]);const he=[];let Ie,Be=Ze.concat();for(let Qe=0,Ue=ae.length;Qe<Ue;Qe++){const Ge=ae[Qe];Ie=[];for(let Gt=0,ot=Ge.length,vt=ot-1,at=Gt+1;Gt<ot;Gt++,vt++,at++)vt===ot&&(vt=0),at===ot&&(at=0),Ie[Gt]=Se(Ge[Gt],Ge[vt],Ge[at]);he.push(Ie),Be=Be.concat(Ie)}for(let Qe=0;Qe<H;Qe++){const Ue=Qe/H,Ge=M*Math.cos(Ue*Math.PI/2),Gt=V*Math.sin(Ue*Math.PI/2)+T;for(let ot=0,vt=be.length;ot<vt;ot++){const at=Xe(be[ot],Ze[ot],Gt);Ve(at.x,at.y,-Ge)}for(let ot=0,vt=ae.length;ot<vt;ot++){const at=ae[ot];Ie=he[ot];for(let Tt=0,xt=at.length;Tt<xt;Tt++){const ve=Xe(at[Tt],Ie[Tt],Gt);Ve(ve.x,ve.y,-Ge)}}}const ue=V+T;for(let Qe=0;Qe<Ce;Qe++){const Ue=w?Xe(se[Qe],Be[Qe],ue):se[Qe];K?(ee.copy(O.normals[0]).multiplyScalar(Ue.x),Q.copy(O.binormals[0]).multiplyScalar(Ue.y),ie.copy(L[0]).add(ee).add(Q),Ve(ie.x,ie.y,ie.z)):Ve(Ue.x,Ue.y,0)}for(let Qe=1;Qe<=G;Qe++)for(let Ue=0;Ue<Ce;Ue++){const Ge=w?Xe(se[Ue],Be[Ue],ue):se[Ue];K?(ee.copy(O.normals[Qe]).multiplyScalar(Ge.x),Q.copy(O.binormals[Qe]).multiplyScalar(Ge.y),ie.copy(L[Qe]).add(ee).add(Q),Ve(ie.x,ie.y,ie.z)):Ve(Ge.x,Ge.y,S/G*Qe)}for(let Qe=H-1;Qe>=0;Qe--){const Ue=Qe/H,Ge=M*Math.cos(Ue*Math.PI/2),Gt=V*Math.sin(Ue*Math.PI/2)+T;for(let ot=0,vt=be.length;ot<vt;ot++){const at=Xe(be[ot],Ze[ot],Gt);Ve(at.x,at.y,S+Ge)}for(let ot=0,vt=ae.length;ot<vt;ot++){const at=ae[ot];Ie=he[ot];for(let Tt=0,xt=at.length;Tt<xt;Tt++){const ve=Xe(at[Tt],Ie[Tt],Gt);K?Ve(ve.x,ve.y+L[G-1].y,L[G-1].x+Ge):Ve(ve.x,ve.y,S+Ge)}}}me(),xe();function me(){const Qe=d.length/3;if(w){let Ue=0,Ge=Ce*Ue;for(let Gt=0;Gt<Re;Gt++){const ot=ge[Gt];Ee(ot[2]+Ge,ot[1]+Ge,ot[0]+Ge)}Ue=G+H*2,Ge=Ce*Ue;for(let Gt=0;Gt<Re;Gt++){const ot=ge[Gt];Ee(ot[0]+Ge,ot[1]+Ge,ot[2]+Ge)}}else{for(let Ue=0;Ue<Re;Ue++){const Ge=ge[Ue];Ee(Ge[2],Ge[1],Ge[0])}for(let Ue=0;Ue<Re;Ue++){const Ge=ge[Ue];Ee(Ge[0]+Ce*G,Ge[1]+Ce*G,Ge[2]+Ce*G)}}u.addGroup(Qe,d.length/3-Qe,0)}function xe(){const Qe=d.length/3;let Ue=0;Je(be,Ue),Ue+=be.length;for(let Ge=0,Gt=ae.length;Ge<Gt;Ge++){const ot=ae[Ge];Je(ot,Ue),Ue+=ot.length}u.addGroup(Qe,d.length/3-Qe,1)}function Je(Qe,Ue){let Ge=Qe.length;for(;--Ge>=0;){const Gt=Ge;let ot=Ge-1;ot<0&&(ot=Qe.length-1);for(let vt=0,at=G+H*2;vt<at;vt++){const Tt=Ce*vt,xt=Ce*(vt+1),ve=Ue+Gt+Tt,de=Ue+ot+Tt,De=Ue+ot+xt,nt=Ue+Gt+xt;Ct(ve,de,De,nt)}}}function Ve(Qe,Ue,Ge){A.push(Qe),A.push(Ue),A.push(Ge)}function Ee(Qe,Ue,Ge){st(Qe),st(Ue),st(Ge);const Gt=d.length/3,ot=z.generateTopUV(u,d,Gt-3,Gt-2,Gt-1);wt(ot[0]),wt(ot[1]),wt(ot[2])}function Ct(Qe,Ue,Ge,Gt){st(Qe),st(Ue),st(Gt),st(Ue),st(Ge),st(Gt);const ot=d.length/3,vt=z.generateSideWallUV(u,d,ot-6,ot-3,ot-2,ot-1);wt(vt[0]),wt(vt[1]),wt(vt[3]),wt(vt[1]),wt(vt[2]),wt(vt[3])}function st(Qe){d.push(A[Qe*3+0]),d.push(A[Qe*3+1]),d.push(A[Qe*3+2])}function wt(Qe){C.push(Qe.x),C.push(Qe.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),o=this.parameters.shapes,u=this.parameters.options;return toJSON$1(o,u,t)}static fromJSON(t,o){const u=[];for(let C=0,I=t.shapes.length;C<I;C++){const f=o[t.shapes[C]];u.push(f)}const d=t.options.extrudePath;return d!==void 0&&(t.options.extrudePath=new Curves[d.type]().fromJSON(d)),new ExtrudeGeometry(u,t.options)}}const WorldUVGenerator={generateTopUV:function(n,t,o,u,d){const C=t[o*3],I=t[o*3+1],f=t[u*3],A=t[u*3+1],y=t[d*3],G=t[d*3+1];return[new Vector2(C,I),new Vector2(f,A),new Vector2(y,G)]},generateSideWallUV:function(n,t,o,u,d,C){const I=t[o*3],f=t[o*3+1],A=t[o*3+2],y=t[u*3],G=t[u*3+1],S=t[u*3+2],w=t[d*3],M=t[d*3+1],V=t[d*3+2],T=t[C*3],H=t[C*3+1],J=t[C*3+2];return Math.abs(f-G)<Math.abs(I-y)?[new Vector2(I,1-A),new Vector2(y,1-S),new Vector2(w,1-V),new Vector2(T,1-J)]:[new Vector2(f,1-A),new Vector2(G,1-S),new Vector2(M,1-V),new Vector2(H,1-J)]}};function toJSON$1(n,t,o){if(o.shapes=[],Array.isArray(n))for(let u=0,d=n.length;u<d;u++){const C=n[u];o.shapes.push(C.uuid)}else o.shapes.push(n.uuid);return o.options=Object.assign({},t),t.extrudePath!==void 0&&(o.options.extrudePath=t.extrudePath.toJSON()),o}class IcosahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const u=(1+Math.sqrt(5))/2,d=[-1,u,0,1,u,0,-1,-u,0,1,-u,0,0,-1,u,0,1,u,0,-1,-u,0,1,-u,u,0,-1,u,0,1,-u,0,-1,-u,0,1],C=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(d,C,t,o),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new IcosahedronGeometry(t.radius,t.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const u=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(u,d,t,o),this.type="OctahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new OctahedronGeometry(t.radius,t.detail)}}class PlaneGeometry extends BufferGeometry{constructor(t=1,o=1,u=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:o,widthSegments:u,heightSegments:d};const C=t/2,I=o/2,f=Math.floor(u),A=Math.floor(d),y=f+1,G=A+1,S=t/f,w=o/A,M=[],V=[],T=[],H=[];for(let J=0;J<G;J++){const z=J*w-I;for(let L=0;L<y;L++){const K=L*S-C;V.push(K,-z,0),T.push(0,0,1),H.push(L/f),H.push(1-J/A)}}for(let J=0;J<A;J++)for(let z=0;z<f;z++){const L=z+y*J,K=z+y*(J+1),O=z+1+y*(J+1),Q=z+1+y*J;M.push(L,K,Q),M.push(K,O,Q)}this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(H,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(t=.5,o=1,u=32,d=1,C=0,I=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:o,thetaSegments:u,phiSegments:d,thetaStart:C,thetaLength:I},u=Math.max(3,u),d=Math.max(1,d);const f=[],A=[],y=[],G=[];let S=t;const w=(o-t)/d,M=new Vector3,V=new Vector2;for(let T=0;T<=d;T++){for(let H=0;H<=u;H++){const J=C+H/u*I;M.x=S*Math.cos(J),M.y=S*Math.sin(J),A.push(M.x,M.y,M.z),y.push(0,0,1),V.x=(M.x/o+1)/2,V.y=(M.y/o+1)/2,G.push(V.x,V.y)}S+=w}for(let T=0;T<d;T++){const H=T*(u+1);for(let J=0;J<u;J++){const z=J+H,L=z,K=z+u+1,O=z+u+2,Q=z+1;f.push(L,K,Q),f.push(K,O,Q)}}this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(y,3)),this.setAttribute("uv",new Float32BufferAttribute(G,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new RingGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape$2([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),o=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:o};const u=[],d=[],C=[],I=[];let f=0,A=0;if(Array.isArray(t)===!1)y(t);else for(let G=0;G<t.length;G++)y(t[G]),this.addGroup(f,A,G),f+=A,A=0;this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(C,3)),this.setAttribute("uv",new Float32BufferAttribute(I,2));function y(G){const S=d.length/3,w=G.extractPoints(o);let M=w.shape;const V=w.holes;ShapeUtils.isClockWise(M)===!1&&(M=M.reverse());for(let H=0,J=V.length;H<J;H++){const z=V[H];ShapeUtils.isClockWise(z)===!0&&(V[H]=z.reverse())}const T=ShapeUtils.triangulateShape(M,V);for(let H=0,J=V.length;H<J;H++){const z=V[H];M=M.concat(z)}for(let H=0,J=M.length;H<J;H++){const z=M[H];d.push(z.x,z.y,0),C.push(0,0,1),I.push(z.x,z.y)}for(let H=0,J=T.length;H<J;H++){const z=T[H],L=z[0]+S,K=z[1]+S,O=z[2]+S;u.push(L,K,O),A+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),o=this.parameters.shapes;return toJSON(o,t)}static fromJSON(t,o){const u=[];for(let d=0,C=t.shapes.length;d<C;d++){const I=o[t.shapes[d]];u.push(I)}return new ShapeGeometry(u,t.curveSegments)}}function toJSON(n,t){if(t.shapes=[],Array.isArray(n))for(let o=0,u=n.length;o<u;o++){const d=n[o];t.shapes.push(d.uuid)}else t.shapes.push(n.uuid);return t}class SphereGeometry extends BufferGeometry{constructor(t=1,o=32,u=16,d=0,C=Math.PI*2,I=0,f=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:o,heightSegments:u,phiStart:d,phiLength:C,thetaStart:I,thetaLength:f},o=Math.max(3,Math.floor(o)),u=Math.max(2,Math.floor(u));const A=Math.min(I+f,Math.PI);let y=0;const G=[],S=new Vector3,w=new Vector3,M=[],V=[],T=[],H=[];for(let J=0;J<=u;J++){const z=[],L=J/u;let K=0;J===0&&I===0?K=.5/o:J===u&&A===Math.PI&&(K=-.5/o);for(let O=0;O<=o;O++){const Q=O/o;S.x=-t*Math.cos(d+Q*C)*Math.sin(I+L*f),S.y=t*Math.cos(I+L*f),S.z=t*Math.sin(d+Q*C)*Math.sin(I+L*f),V.push(S.x,S.y,S.z),w.copy(S).normalize(),T.push(w.x,w.y,w.z),H.push(Q+K,1-L),z.push(y++)}G.push(z)}for(let J=0;J<u;J++)for(let z=0;z<o;z++){const L=G[J][z+1],K=G[J][z],O=G[J+1][z],Q=G[J+1][z+1];(J!==0||I>0)&&M.push(L,K,Q),(J!==u-1||A<Math.PI)&&M.push(K,O,Q)}this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(H,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(t=1,o=0){const u=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],d=[2,1,0,0,3,2,1,3,0,2,3,1];super(u,d,t,o),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:o}}static fromJSON(t){return new TetrahedronGeometry(t.radius,t.detail)}}class TorusGeometry extends BufferGeometry{constructor(t=1,o=.4,u=12,d=48,C=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:o,radialSegments:u,tubularSegments:d,arc:C},u=Math.floor(u),d=Math.floor(d);const I=[],f=[],A=[],y=[],G=new Vector3,S=new Vector3,w=new Vector3;for(let M=0;M<=u;M++)for(let V=0;V<=d;V++){const T=V/d*C,H=M/u*Math.PI*2;S.x=(t+o*Math.cos(H))*Math.cos(T),S.y=(t+o*Math.cos(H))*Math.sin(T),S.z=o*Math.sin(H),f.push(S.x,S.y,S.z),G.x=t*Math.cos(T),G.y=t*Math.sin(T),w.subVectors(S,G).normalize(),A.push(w.x,w.y,w.z),y.push(V/d),y.push(M/u)}for(let M=1;M<=u;M++)for(let V=1;V<=d;V++){const T=(d+1)*M+V-1,H=(d+1)*(M-1)+V-1,J=(d+1)*(M-1)+V,z=(d+1)*M+V;I.push(T,H,z),I.push(H,J,z)}this.setIndex(I),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(A,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(t=1,o=.4,u=64,d=8,C=2,I=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:o,tubularSegments:u,radialSegments:d,p:C,q:I},u=Math.floor(u),d=Math.floor(d);const f=[],A=[],y=[],G=[],S=new Vector3,w=new Vector3,M=new Vector3,V=new Vector3,T=new Vector3,H=new Vector3,J=new Vector3;for(let L=0;L<=u;++L){const K=L/u*C*Math.PI*2;z(K,C,I,t,M),z(K+.01,C,I,t,V),H.subVectors(V,M),J.addVectors(V,M),T.crossVectors(H,J),J.crossVectors(T,H),T.normalize(),J.normalize();for(let O=0;O<=d;++O){const Q=O/d*Math.PI*2,ee=-o*Math.cos(Q),ie=o*Math.sin(Q);S.x=M.x+(ee*J.x+ie*T.x),S.y=M.y+(ee*J.y+ie*T.y),S.z=M.z+(ee*J.z+ie*T.z),A.push(S.x,S.y,S.z),w.subVectors(S,M).normalize(),y.push(w.x,w.y,w.z),G.push(L/u),G.push(O/d)}}for(let L=1;L<=u;L++)for(let K=1;K<=d;K++){const O=(d+1)*(L-1)+(K-1),Q=(d+1)*L+(K-1),ee=(d+1)*L+K,ie=(d+1)*(L-1)+K;f.push(O,Q,ie),f.push(Q,ee,ie)}this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(y,3)),this.setAttribute("uv",new Float32BufferAttribute(G,2));function z(L,K,O,Q,ee){const ie=Math.cos(L),te=Math.sin(L),se=O/K*L,ae=Math.cos(se);ee.x=Q*(2+ae)*.5*ie,ee.y=Q*(2+ae)*te*.5,ee.z=Q*Math.sin(se)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusKnotGeometry(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class TubeGeometry extends BufferGeometry{constructor(t=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),o=64,u=1,d=8,C=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:o,radius:u,radialSegments:d,closed:C};const I=t.computeFrenetFrames(o,C);this.tangents=I.tangents,this.normals=I.normals,this.binormals=I.binormals;const f=new Vector3,A=new Vector3,y=new Vector2;let G=new Vector3;const S=[],w=[],M=[],V=[];T(),this.setIndex(V),this.setAttribute("position",new Float32BufferAttribute(S,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2));function T(){for(let L=0;L<o;L++)H(L);H(C===!1?o:0),z(),J()}function H(L){G=t.getPointAt(L/o,G);const K=I.normals[L],O=I.binormals[L];for(let Q=0;Q<=d;Q++){const ee=Q/d*Math.PI*2,ie=Math.sin(ee),te=-Math.cos(ee);A.x=te*K.x+ie*O.x,A.y=te*K.y+ie*O.y,A.z=te*K.z+ie*O.z,A.normalize(),w.push(A.x,A.y,A.z),f.x=G.x+u*A.x,f.y=G.y+u*A.y,f.z=G.z+u*A.z,S.push(f.x,f.y,f.z)}}function J(){for(let L=1;L<=o;L++)for(let K=1;K<=d;K++){const O=(d+1)*(L-1)+(K-1),Q=(d+1)*L+(K-1),ee=(d+1)*L+K,ie=(d+1)*(L-1)+K;V.push(O,Q,ie),V.push(Q,ee,ie)}}function z(){for(let L=0;L<=o;L++)for(let K=0;K<=d;K++)y.x=L/o,y.y=K/d,M.push(y.x,y.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new TubeGeometry(new Curves[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class WireframeGeometry extends BufferGeometry{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const o=[],u=new Set,d=new Vector3,C=new Vector3;if(t.index!==null){const I=t.attributes.position,f=t.index;let A=t.groups;A.length===0&&(A=[{start:0,count:f.count,materialIndex:0}]);for(let y=0,G=A.length;y<G;++y){const S=A[y],w=S.start,M=S.count;for(let V=w,T=w+M;V<T;V+=3)for(let H=0;H<3;H++){const J=f.getX(V+H),z=f.getX(V+(H+1)%3);d.fromBufferAttribute(I,J),C.fromBufferAttribute(I,z),isUniqueEdge(d,C,u)===!0&&(o.push(d.x,d.y,d.z),o.push(C.x,C.y,C.z))}}}else{const I=t.attributes.position;for(let f=0,A=I.count/3;f<A;f++)for(let y=0;y<3;y++){const G=3*f+y,S=3*f+(y+1)%3;d.fromBufferAttribute(I,G),C.fromBufferAttribute(I,S),isUniqueEdge(d,C,u)===!0&&(o.push(d.x,d.y,d.z),o.push(C.x,C.y,C.z))}}this.setAttribute("position",new Float32BufferAttribute(o,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function isUniqueEdge(n,t,o){const u=`${n.x},${n.y},${n.z}-${t.x},${t.y},${t.z}`,d=`${t.x},${t.y},${t.z}-${n.x},${n.y},${n.z}`;return o.has(u)===!0||o.has(d)===!0?!1:(o.add(u),o.add(d),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$1(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(o){this.ior=(1+.4*o)/(1-.4*o)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshToonMaterial extends Material{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class MeshNormalMaterial extends Material{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class MeshLambertMaterial extends Material{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshDepthMaterial extends Material{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function convertArray(n,t,o){return!n||!o&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function isTypedArray(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function getKeyframeOrder(n){function t(d,C){return n[d]-n[C]}const o=n.length,u=new Array(o);for(let d=0;d!==o;++d)u[d]=d;return u.sort(t),u}function sortedArray(n,t,o){const u=n.length,d=new n.constructor(u);for(let C=0,I=0;I!==u;++C){const f=o[C]*t;for(let A=0;A!==t;++A)d[I++]=n[f+A]}return d}function flattenJSON(n,t,o,u){let d=1,C=n[0];for(;C!==void 0&&C[u]===void 0;)C=n[d++];if(C===void 0)return;let I=C[u];if(I!==void 0)if(Array.isArray(I))do I=C[u],I!==void 0&&(t.push(C.time),o.push(...I)),C=n[d++];while(C!==void 0);else if(I.toArray!==void 0)do I=C[u],I!==void 0&&(t.push(C.time),I.toArray(o,o.length)),C=n[d++];while(C!==void 0);else do I=C[u],I!==void 0&&(t.push(C.time),o.push(I)),C=n[d++];while(C!==void 0)}function subclip(n,t,o,u,d=30){const C=n.clone();C.name=t;const I=[];for(let A=0;A<C.tracks.length;++A){const y=C.tracks[A],G=y.getValueSize(),S=[],w=[];for(let M=0;M<y.times.length;++M){const V=y.times[M]*d;if(!(V<o||V>=u)){S.push(y.times[M]);for(let T=0;T<G;++T)w.push(y.values[M*G+T])}}S.length!==0&&(y.times=convertArray(S,y.times.constructor),y.values=convertArray(w,y.values.constructor),I.push(y))}C.tracks=I;let f=1/0;for(let A=0;A<C.tracks.length;++A)f>C.tracks[A].times[0]&&(f=C.tracks[A].times[0]);for(let A=0;A<C.tracks.length;++A)C.tracks[A].shift(-1*f);return C.resetDuration(),C}function makeClipAdditive(n,t=0,o=n,u=30){u<=0&&(u=30);const d=o.tracks.length,C=t/u;for(let I=0;I<d;++I){const f=o.tracks[I],A=f.ValueTypeName;if(A==="bool"||A==="string")continue;const y=n.tracks.find(function(J){return J.name===f.name&&J.ValueTypeName===A});if(y===void 0)continue;let G=0;const S=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(G=S/3);let w=0;const M=y.getValueSize();y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(w=M/3);const V=f.times.length-1;let T;if(C<=f.times[0]){const J=G,z=S-G;T=f.values.slice(J,z)}else if(C>=f.times[V]){const J=V*S+G,z=J+S-G;T=f.values.slice(J,z)}else{const J=f.createInterpolant(),z=G,L=S-G;J.evaluate(C),T=J.resultBuffer.slice(z,L)}A==="quaternion"&&new Quaternion$2().fromArray(T).normalize().conjugate().toArray(T);const H=y.times.length;for(let J=0;J<H;++J){const z=J*M+w;if(A==="quaternion")Quaternion$2.multiplyQuaternionsFlat(y.values,z,T,0,y.values,z);else{const L=M-w*2;for(let K=0;K<L;++K)y.values[z+K]-=T[K]}}}return n.blendMode=AdditiveAnimationBlendMode,n}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(t,o,u,d){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=d!==void 0?d:new o.constructor(u),this.sampleValues=o,this.valueSize=u,this.settings=null,this.DefaultSettings_={}}evaluate(t){const o=this.parameterPositions;let u=this._cachedIndex,d=o[u],C=o[u-1];e:{t:{let I;i:{n:if(!(t<d)){for(let f=u+2;;){if(d===void 0){if(t<C)break n;return u=o.length,this._cachedIndex=u,this.copySampleValue_(u-1)}if(u===f)break;if(C=d,d=o[++u],t<d)break t}I=o.length;break i}if(!(t>=C)){const f=o[1];t<f&&(u=2,C=f);for(let A=u-2;;){if(C===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(u===A)break;if(d=C,C=o[--u-1],t>=C)break t}I=u,u=0;break i}break e}for(;u<I;){const f=u+I>>>1;t<o[f]?I=f:u=f+1}if(d=o[u],C=o[u-1],C===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===void 0)return u=o.length,this._cachedIndex=u,this.copySampleValue_(u-1)}this._cachedIndex=u,this.intervalChanged_(u,C,d)}return this.interpolate_(u,C,t,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const o=this.resultBuffer,u=this.sampleValues,d=this.valueSize,C=t*d;for(let I=0;I!==d;++I)o[I]=u[C+I];return o}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(t,o,u,d){super(t,o,u,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(t,o,u){const d=this.parameterPositions;let C=t-2,I=t+1,f=d[C],A=d[I];if(f===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:C=t,f=2*o-u;break;case WrapAroundEnding:C=d.length-2,f=o+d[C]-d[C+1];break;default:C=t,f=u}if(A===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:I=t,A=2*u-o;break;case WrapAroundEnding:I=1,A=u+d[1]-d[0];break;default:I=t-1,A=o}const y=(u-o)*.5,G=this.valueSize;this._weightPrev=y/(o-f),this._weightNext=y/(A-u),this._offsetPrev=C*G,this._offsetNext=I*G}interpolate_(t,o,u,d){const C=this.resultBuffer,I=this.sampleValues,f=this.valueSize,A=t*f,y=A-f,G=this._offsetPrev,S=this._offsetNext,w=this._weightPrev,M=this._weightNext,V=(u-o)/(d-o),T=V*V,H=T*V,J=-w*H+2*w*T-w*V,z=(1+w)*H+(-1.5-2*w)*T+(-.5+w)*V+1,L=(-1-M)*H+(1.5+M)*T+.5*V,K=M*H-M*T;for(let O=0;O!==f;++O)C[O]=J*I[G+O]+z*I[y+O]+L*I[A+O]+K*I[S+O];return C}}class LinearInterpolant extends Interpolant{constructor(t,o,u,d){super(t,o,u,d)}interpolate_(t,o,u,d){const C=this.resultBuffer,I=this.sampleValues,f=this.valueSize,A=t*f,y=A-f,G=(u-o)/(d-o),S=1-G;for(let w=0;w!==f;++w)C[w]=I[y+w]*S+I[A+w]*G;return C}}class DiscreteInterpolant extends Interpolant{constructor(t,o,u,d){super(t,o,u,d)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,o,u,d){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(o===void 0||o.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=convertArray(o,this.TimeBufferType),this.values=convertArray(u,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(t){const o=t.constructor;let u;if(o.toJSON!==this.toJSON)u=o.toJSON(t);else{u={name:t.name,times:convertArray(t.times,Array),values:convertArray(t.values,Array)};const d=t.getInterpolation();d!==t.DefaultInterpolation&&(u.interpolation=d)}return u.type=t.ValueTypeName,u}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let o;switch(t){case InterpolateDiscrete:o=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:o=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:o=this.InterpolantFactoryMethodSmooth;break}if(o===void 0){const u="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(u);return console.warn("THREE.KeyframeTrack:",u),this}return this.createInterpolant=o,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const o=this.times;for(let u=0,d=o.length;u!==d;++u)o[u]+=t}return this}scale(t){if(t!==1){const o=this.times;for(let u=0,d=o.length;u!==d;++u)o[u]*=t}return this}trim(t,o){const u=this.times,d=u.length;let C=0,I=d-1;for(;C!==d&&u[C]<t;)++C;for(;I!==-1&&u[I]>o;)--I;if(++I,C!==0||I!==d){C>=I&&(I=Math.max(I,1),C=I-1);const f=this.getValueSize();this.times=u.slice(C,I),this.values=this.values.slice(C*f,I*f)}return this}validate(){let t=!0;const o=this.getValueSize();o-Math.floor(o)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const u=this.times,d=this.values,C=u.length;C===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let I=null;for(let f=0;f!==C;f++){const A=u[f];if(typeof A=="number"&&isNaN(A)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,A),t=!1;break}if(I!==null&&I>A){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,A,I),t=!1;break}I=A}if(d!==void 0&&isTypedArray(d))for(let f=0,A=d.length;f!==A;++f){const y=d[f];if(isNaN(y)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,y),t=!1;break}}return t}optimize(){const t=this.times.slice(),o=this.values.slice(),u=this.getValueSize(),d=this.getInterpolation()===InterpolateSmooth,C=t.length-1;let I=1;for(let f=1;f<C;++f){let A=!1;const y=t[f],G=t[f+1];if(y!==G&&(f!==1||y!==t[0]))if(d)A=!0;else{const S=f*u,w=S-u,M=S+u;for(let V=0;V!==u;++V){const T=o[S+V];if(T!==o[w+V]||T!==o[M+V]){A=!0;break}}}if(A){if(f!==I){t[I]=t[f];const S=f*u,w=I*u;for(let M=0;M!==u;++M)o[w+M]=o[S+M]}++I}}if(C>0){t[I]=t[C];for(let f=C*u,A=I*u,y=0;y!==u;++y)o[A+y]=o[f+y];++I}return I!==t.length?(this.times=t.slice(0,I),this.values=o.slice(0,I*u)):(this.times=t,this.values=o),this}clone(){const t=this.times.slice(),o=this.values.slice(),u=this.constructor,d=new u(this.name,t,o);return d.createInterpolant=this.createInterpolant,d}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(t,o,u){super(t,o,u)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,o,u,d){super(t,o,u,d)}interpolate_(t,o,u,d){const C=this.resultBuffer,I=this.sampleValues,f=this.valueSize,A=(u-o)/(d-o);let y=t*f;for(let G=y+f;y!==G;y+=4)Quaternion$2.slerpFlat(C,0,I,y-f,I,y,A);return C}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(t,o,u){super(t,o,u)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t="",o=-1,u=[],d=NormalAnimationBlendMode){this.name=t,this.tracks=u,this.duration=o,this.blendMode=d,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const o=[],u=t.tracks,d=1/(t.fps||1);for(let I=0,f=u.length;I!==f;++I)o.push(parseKeyframeTrack(u[I]).scale(d));const C=new this(t.name,t.duration,o,t.blendMode);return C.uuid=t.uuid,C}static toJSON(t){const o=[],u=t.tracks,d={name:t.name,duration:t.duration,tracks:o,uuid:t.uuid,blendMode:t.blendMode};for(let C=0,I=u.length;C!==I;++C)o.push(KeyframeTrack.toJSON(u[C]));return d}static CreateFromMorphTargetSequence(t,o,u,d){const C=o.length,I=[];for(let f=0;f<C;f++){let A=[],y=[];A.push((f+C-1)%C,f,(f+1)%C),y.push(0,1,0);const G=getKeyframeOrder(A);A=sortedArray(A,1,G),y=sortedArray(y,1,G),!d&&A[0]===0&&(A.push(C),y.push(y[0])),I.push(new NumberKeyframeTrack(".morphTargetInfluences["+o[f].name+"]",A,y).scale(1/u))}return new this(t,-1,I)}static findByName(t,o){let u=t;if(!Array.isArray(t)){const d=t;u=d.geometry&&d.geometry.animations||d.animations}for(let d=0;d<u.length;d++)if(u[d].name===o)return u[d];return null}static CreateClipsFromMorphTargetSequences(t,o,u){const d={},C=/^([\w-]*?)([\d]+)$/;for(let f=0,A=t.length;f<A;f++){const y=t[f],G=y.name.match(C);if(G&&G.length>1){const S=G[1];let w=d[S];w||(d[S]=w=[]),w.push(y)}}const I=[];for(const f in d)I.push(this.CreateFromMorphTargetSequence(f,d[f],o,u));return I}static parseAnimation(t,o){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const u=function(S,w,M,V,T){if(M.length!==0){const H=[],J=[];flattenJSON(M,H,J,V),H.length!==0&&T.push(new S(w,H,J))}},d=[],C=t.name||"default",I=t.fps||30,f=t.blendMode;let A=t.length||-1;const y=t.hierarchy||[];for(let S=0;S<y.length;S++){const w=y[S].keys;if(!(!w||w.length===0))if(w[0].morphTargets){const M={};let V;for(V=0;V<w.length;V++)if(w[V].morphTargets)for(let T=0;T<w[V].morphTargets.length;T++)M[w[V].morphTargets[T]]=-1;for(const T in M){const H=[],J=[];for(let z=0;z!==w[V].morphTargets.length;++z){const L=w[V];H.push(L.time),J.push(L.morphTarget===T?1:0)}d.push(new NumberKeyframeTrack(".morphTargetInfluence["+T+"]",H,J))}A=M.length*I}else{const M=".bones["+o[S].name+"]";u(VectorKeyframeTrack,M+".position",w,"pos",d),u(QuaternionKeyframeTrack,M+".quaternion",w,"rot",d),u(VectorKeyframeTrack,M+".scale",w,"scl",d)}}return d.length===0?null:new this(C,A,d,f)}resetDuration(){const t=this.tracks;let o=0;for(let u=0,d=t.length;u!==d;++u){const C=this.tracks[u];o=Math.max(o,C.times[C.times.length-1])}return this.duration=o,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let o=0;o<this.tracks.length;o++)t=t&&this.tracks[o].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let o=0;o<this.tracks.length;o++)t.push(this.tracks[o].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function parseKeyframeTrack(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(n.type);if(n.times===void 0){const o=[],u=[];flattenJSON(n.keys,o,u,"value"),n.times=o,n.values=u}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Cache={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class LoadingManager{constructor(t,o,u){const d=this;let C=!1,I=0,f=0,A;const y=[];this.onStart=void 0,this.onLoad=t,this.onProgress=o,this.onError=u,this.itemStart=function(G){f++,C===!1&&d.onStart!==void 0&&d.onStart(G,I,f),C=!0},this.itemEnd=function(G){I++,d.onProgress!==void 0&&d.onProgress(G,I,f),I===f&&(C=!1,d.onLoad!==void 0&&d.onLoad())},this.itemError=function(G){d.onError!==void 0&&d.onError(G)},this.resolveURL=function(G){return A?A(G):G},this.setURLModifier=function(G){return A=G,this},this.addHandler=function(G,S){return y.push(G,S),this},this.removeHandler=function(G){const S=y.indexOf(G);return S!==-1&&y.splice(S,2),this},this.getHandler=function(G){for(let S=0,w=y.length;S<w;S+=2){const M=y[S],V=y[S+1];if(M.global&&(M.lastIndex=0),M.test(G))return V}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(t){this.manager=t!==void 0?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,o){const u=this;return new Promise(function(d,C){u.load(t,d,o,C)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(t,o){super(t),this.response=o}}class FileLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const C=Cache.get(t);if(C!==void 0)return this.manager.itemStart(t),setTimeout(()=>{o&&o(C),this.manager.itemEnd(t)},0),C;if(loading[t]!==void 0){loading[t].push({onLoad:o,onProgress:u,onError:d});return}loading[t]=[],loading[t].push({onLoad:o,onProgress:u,onError:d});const I=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),f=this.mimeType,A=this.responseType;fetch(I).then(y=>{if(y.status===200||y.status===0){if(y.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||y.body===void 0||y.body.getReader===void 0)return y;const G=loading[t],S=y.body.getReader(),w=y.headers.get("X-File-Size")||y.headers.get("Content-Length"),M=w?parseInt(w):0,V=M!==0;let T=0;const H=new ReadableStream({start(J){z();function z(){S.read().then(({done:L,value:K})=>{if(L)J.close();else{T+=K.byteLength;const O=new ProgressEvent("progress",{lengthComputable:V,loaded:T,total:M});for(let Q=0,ee=G.length;Q<ee;Q++){const ie=G[Q];ie.onProgress&&ie.onProgress(O)}J.enqueue(K),z()}},L=>{J.error(L)})}}});return new Response(H)}else throw new HttpError(`fetch for "${y.url}" responded with ${y.status}: ${y.statusText}`,y)}).then(y=>{switch(A){case"arraybuffer":return y.arrayBuffer();case"blob":return y.blob();case"document":return y.text().then(G=>new DOMParser().parseFromString(G,f));case"json":return y.json();default:if(f===void 0)return y.text();{const S=/charset="?([^;"\s]*)"?/i.exec(f),w=S&&S[1]?S[1].toLowerCase():void 0,M=new TextDecoder(w);return y.arrayBuffer().then(V=>M.decode(V))}}}).then(y=>{Cache.add(t,y);const G=loading[t];delete loading[t];for(let S=0,w=G.length;S<w;S++){const M=G[S];M.onLoad&&M.onLoad(y)}}).catch(y=>{const G=loading[t];if(G===void 0)throw this.manager.itemError(t),y;delete loading[t];for(let S=0,w=G.length;S<w;S++){const M=G[S];M.onError&&M.onError(y)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class AnimationLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=new FileLoader(this.manager);I.setPath(this.path),I.setRequestHeader(this.requestHeader),I.setWithCredentials(this.withCredentials),I.load(t,function(f){try{o(C.parse(JSON.parse(f)))}catch(A){d?d(A):console.error(A),C.manager.itemError(t)}},u,d)}parse(t){const o=[];for(let u=0;u<t.length;u++){const d=AnimationClip.parse(t[u]);o.push(d)}return o}}class CompressedTextureLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=[],f=new CompressedTexture,A=new FileLoader(this.manager);A.setPath(this.path),A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setWithCredentials(C.withCredentials);let y=0;function G(S){A.load(t[S],function(w){const M=C.parse(w,!0);I[S]={width:M.width,height:M.height,format:M.format,mipmaps:M.mipmaps},y+=1,y===6&&(M.mipmapCount===1&&(f.minFilter=LinearFilter),f.image=I,f.format=M.format,f.needsUpdate=!0,o&&o(f))},u,d)}if(Array.isArray(t))for(let S=0,w=t.length;S<w;++S)G(S);else A.load(t,function(S){const w=C.parse(S,!0);if(w.isCubemap){const M=w.mipmaps.length/w.mipmapCount;for(let V=0;V<M;V++){I[V]={mipmaps:[]};for(let T=0;T<w.mipmapCount;T++)I[V].mipmaps.push(w.mipmaps[V*w.mipmapCount+T]),I[V].format=w.format,I[V].width=w.width,I[V].height=w.height}f.image=I}else f.image.width=w.width,f.image.height=w.height,f.mipmaps=w.mipmaps;w.mipmapCount===1&&(f.minFilter=LinearFilter),f.format=w.format,f.needsUpdate=!0,o&&o(f)},u,d);return f}}class ImageLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const C=this,I=Cache.get(t);if(I!==void 0)return C.manager.itemStart(t),setTimeout(function(){o&&o(I),C.manager.itemEnd(t)},0),I;const f=createElementNS("img");function A(){G(),Cache.add(t,this),o&&o(this),C.manager.itemEnd(t)}function y(S){G(),d&&d(S),C.manager.itemError(t),C.manager.itemEnd(t)}function G(){f.removeEventListener("load",A,!1),f.removeEventListener("error",y,!1)}return f.addEventListener("load",A,!1),f.addEventListener("error",y,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),C.manager.itemStart(t),f.src=t,f}}class CubeTextureLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=new CubeTexture;C.colorSpace=SRGBColorSpace;const I=new ImageLoader(this.manager);I.setCrossOrigin(this.crossOrigin),I.setPath(this.path);let f=0;function A(y){I.load(t[y],function(G){C.images[y]=G,f++,f===6&&(C.needsUpdate=!0,o&&o(C))},void 0,d)}for(let y=0;y<t.length;++y)A(y);return C}}class DataTextureLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=new DataTexture,f=new FileLoader(this.manager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(C.withCredentials),f.load(t,function(A){let y;try{y=C.parse(A)}catch(G){if(d!==void 0)d(G);else{console.error(G);return}}y.image!==void 0?I.image=y.image:y.data!==void 0&&(I.image.width=y.width,I.image.height=y.height,I.image.data=y.data),I.wrapS=y.wrapS!==void 0?y.wrapS:ClampToEdgeWrapping,I.wrapT=y.wrapT!==void 0?y.wrapT:ClampToEdgeWrapping,I.magFilter=y.magFilter!==void 0?y.magFilter:LinearFilter,I.minFilter=y.minFilter!==void 0?y.minFilter:LinearFilter,I.anisotropy=y.anisotropy!==void 0?y.anisotropy:1,y.colorSpace!==void 0&&(I.colorSpace=y.colorSpace),y.flipY!==void 0&&(I.flipY=y.flipY),y.format!==void 0&&(I.format=y.format),y.type!==void 0&&(I.type=y.type),y.mipmaps!==void 0&&(I.mipmaps=y.mipmaps,I.minFilter=LinearMipmapLinearFilter),y.mipmapCount===1&&(I.minFilter=LinearFilter),y.generateMipmaps!==void 0&&(I.generateMipmaps=y.generateMipmaps),I.needsUpdate=!0,o&&o(I,y)},u,d),I}}class TextureLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=new Texture,I=new ImageLoader(this.manager);return I.setCrossOrigin(this.crossOrigin),I.setPath(this.path),I.load(t,function(f){C.image=f,C.needsUpdate=!0,o!==void 0&&o(C)},u,d),C}}class Light extends Object3D{constructor(t,o=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(t),this.intensity=o}dispose(){}copy(t,o){return super.copy(t,o),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const o=super.toJSON(t);return o.object.color=this.color.getHex(),o.object.intensity=this.intensity,this.groundColor!==void 0&&(o.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(o.object.distance=this.distance),this.angle!==void 0&&(o.object.angle=this.angle),this.decay!==void 0&&(o.object.decay=this.decay),this.penumbra!==void 0&&(o.object.penumbra=this.penumbra),this.shadow!==void 0&&(o.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(o.object.target=this.target.uuid),o}}class HemisphereLight extends Light{constructor(t,o,u){super(t,u),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(o)}copy(t,o){return super.copy(t,o),this.groundColor.copy(t.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const o=this.camera,u=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(t.matrixWorld),o.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(t.target.matrixWorld),o.lookAt(_lookTarget$1),o.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(_projScreenMatrix$1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const o=this.camera,u=RAD2DEG*2*t.angle*this.focus,d=this.mapSize.width/this.mapSize.height,C=t.distance||o.far;(u!==o.fov||d!==o.aspect||C!==o.far)&&(o.fov=u,o.aspect=d,o.far=C,o.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class SpotLight extends Light{constructor(t,o,u=0,d=Math.PI/3,C=0,I=2){super(t,o),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=u,this.angle=d,this.penumbra=C,this.decay=I,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,o){return super.copy(t,o),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(t,o=0){const u=this.camera,d=this.matrix,C=t.distance||u.far;C!==u.far&&(u.far=C,u.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(t.matrixWorld),u.position.copy(_lightPositionWorld),_lookTarget.copy(u.position),_lookTarget.add(this._cubeDirections[o]),u.up.copy(this._cubeUps[o]),u.lookAt(_lookTarget),u.updateMatrixWorld(),d.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(t,o,u=0,d=2){super(t,o),this.isPointLight=!0,this.type="PointLight",this.distance=u,this.decay=d,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,o){return super.copy(t,o),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(t=-1,o=1,u=1,d=-1,C=.1,I=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=o,this.top=u,this.bottom=d,this.near=C,this.far=I,this.updateProjectionMatrix()}copy(t,o){return super.copy(t,o),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,o,u,d,C,I){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=o,this.view.offsetX=u,this.view.offsetY=d,this.view.width=C,this.view.height=I,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),o=(this.top-this.bottom)/(2*this.zoom),u=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let C=u-t,I=u+t,f=d+o,A=d-o;if(this.view!==null&&this.view.enabled){const y=(this.right-this.left)/this.view.fullWidth/this.zoom,G=(this.top-this.bottom)/this.view.fullHeight/this.zoom;C+=y*this.view.offsetX,I=C+y*this.view.width,f-=G*this.view.offsetY,A=f-G*this.view.height}this.projectionMatrix.makeOrthographic(C,I,f,A,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const o=super.toJSON(t);return o.object.zoom=this.zoom,o.object.left=this.left,o.object.right=this.right,o.object.top=this.top,o.object.bottom=this.bottom,o.object.near=this.near,o.object.far=this.far,this.view!==null&&(o.object.view=Object.assign({},this.view)),o}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(t,o){super(t,o),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class AmbientLight extends Light{constructor(t,o){super(t,o),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(t,o,u=10,d=10){super(t,o),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=u,this.height=d}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const o=super.toJSON(t);return o.object.width=this.width,o.object.height=this.height,o}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let o=0;o<9;o++)this.coefficients[o].copy(t[o]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,o){const u=t.x,d=t.y,C=t.z,I=this.coefficients;return o.copy(I[0]).multiplyScalar(.282095),o.addScaledVector(I[1],.488603*d),o.addScaledVector(I[2],.488603*C),o.addScaledVector(I[3],.488603*u),o.addScaledVector(I[4],1.092548*(u*d)),o.addScaledVector(I[5],1.092548*(d*C)),o.addScaledVector(I[6],.315392*(3*C*C-1)),o.addScaledVector(I[7],1.092548*(u*C)),o.addScaledVector(I[8],.546274*(u*u-d*d)),o}getIrradianceAt(t,o){const u=t.x,d=t.y,C=t.z,I=this.coefficients;return o.copy(I[0]).multiplyScalar(.886227),o.addScaledVector(I[1],2*.511664*d),o.addScaledVector(I[2],2*.511664*C),o.addScaledVector(I[3],2*.511664*u),o.addScaledVector(I[4],2*.429043*u*d),o.addScaledVector(I[5],2*.429043*d*C),o.addScaledVector(I[6],.743125*C*C-.247708),o.addScaledVector(I[7],2*.429043*u*C),o.addScaledVector(I[8],.429043*(u*u-d*d)),o}add(t){for(let o=0;o<9;o++)this.coefficients[o].add(t.coefficients[o]);return this}addScaledSH(t,o){for(let u=0;u<9;u++)this.coefficients[u].addScaledVector(t.coefficients[u],o);return this}scale(t){for(let o=0;o<9;o++)this.coefficients[o].multiplyScalar(t);return this}lerp(t,o){for(let u=0;u<9;u++)this.coefficients[u].lerp(t.coefficients[u],o);return this}equals(t){for(let o=0;o<9;o++)if(!this.coefficients[o].equals(t.coefficients[o]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,o=0){const u=this.coefficients;for(let d=0;d<9;d++)u[d].fromArray(t,o+d*3);return this}toArray(t=[],o=0){const u=this.coefficients;for(let d=0;d<9;d++)u[d].toArray(t,o+d*3);return t}static getBasisAt(t,o){const u=t.x,d=t.y,C=t.z;o[0]=.282095,o[1]=.488603*d,o[2]=.488603*C,o[3]=.488603*u,o[4]=1.092548*u*d,o[5]=1.092548*d*C,o[6]=.315392*(3*C*C-1),o[7]=1.092548*u*C,o[8]=.546274*(u*u-d*d)}}class LightProbe extends Light{constructor(t=new SphericalHarmonics3,o=1){super(void 0,o),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const o=super.toJSON(t);return o.object.sh=this.sh.toArray(),o}}class MaterialLoader extends Loader{constructor(t){super(t),this.textures={}}load(t,o,u,d){const C=this,I=new FileLoader(C.manager);I.setPath(C.path),I.setRequestHeader(C.requestHeader),I.setWithCredentials(C.withCredentials),I.load(t,function(f){try{o(C.parse(JSON.parse(f)))}catch(A){d?d(A):console.error(A),C.manager.itemError(t)}},u,d)}parse(t){const o=this.textures;function u(C){return o[C]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",C),o[C]}const d=this.createMaterialFromType(t.type);if(t.uuid!==void 0&&(d.uuid=t.uuid),t.name!==void 0&&(d.name=t.name),t.color!==void 0&&d.color!==void 0&&d.color.setHex(t.color),t.roughness!==void 0&&(d.roughness=t.roughness),t.metalness!==void 0&&(d.metalness=t.metalness),t.sheen!==void 0&&(d.sheen=t.sheen),t.sheenColor!==void 0&&(d.sheenColor=new Color().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(d.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&d.emissive!==void 0&&d.emissive.setHex(t.emissive),t.specular!==void 0&&d.specular!==void 0&&d.specular.setHex(t.specular),t.specularIntensity!==void 0&&(d.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&d.specularColor!==void 0&&d.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(d.shininess=t.shininess),t.clearcoat!==void 0&&(d.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(d.dispersion=t.dispersion),t.iridescence!==void 0&&(d.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(d.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(d.transmission=t.transmission),t.thickness!==void 0&&(d.thickness=t.thickness),t.attenuationDistance!==void 0&&(d.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&d.attenuationColor!==void 0&&d.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(d.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(d.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(d.fog=t.fog),t.flatShading!==void 0&&(d.flatShading=t.flatShading),t.blending!==void 0&&(d.blending=t.blending),t.combine!==void 0&&(d.combine=t.combine),t.side!==void 0&&(d.side=t.side),t.shadowSide!==void 0&&(d.shadowSide=t.shadowSide),t.opacity!==void 0&&(d.opacity=t.opacity),t.transparent!==void 0&&(d.transparent=t.transparent),t.alphaTest!==void 0&&(d.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(d.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(d.depthFunc=t.depthFunc),t.depthTest!==void 0&&(d.depthTest=t.depthTest),t.depthWrite!==void 0&&(d.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(d.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(d.blendSrc=t.blendSrc),t.blendDst!==void 0&&(d.blendDst=t.blendDst),t.blendEquation!==void 0&&(d.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(d.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(d.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(d.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&d.blendColor!==void 0&&d.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(d.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(d.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(d.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(d.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(d.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(d.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(d.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(d.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(d.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(d.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(d.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(d.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(d.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(d.rotation=t.rotation),t.linewidth!==void 0&&(d.linewidth=t.linewidth),t.dashSize!==void 0&&(d.dashSize=t.dashSize),t.gapSize!==void 0&&(d.gapSize=t.gapSize),t.scale!==void 0&&(d.scale=t.scale),t.polygonOffset!==void 0&&(d.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(d.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(d.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(d.dithering=t.dithering),t.alphaToCoverage!==void 0&&(d.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(d.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(d.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(d.visible=t.visible),t.toneMapped!==void 0&&(d.toneMapped=t.toneMapped),t.userData!==void 0&&(d.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?d.vertexColors=t.vertexColors>0:d.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const C in t.uniforms){const I=t.uniforms[C];switch(d.uniforms[C]={},I.type){case"t":d.uniforms[C].value=u(I.value);break;case"c":d.uniforms[C].value=new Color().setHex(I.value);break;case"v2":d.uniforms[C].value=new Vector2().fromArray(I.value);break;case"v3":d.uniforms[C].value=new Vector3().fromArray(I.value);break;case"v4":d.uniforms[C].value=new Vector4().fromArray(I.value);break;case"m3":d.uniforms[C].value=new Matrix3().fromArray(I.value);break;case"m4":d.uniforms[C].value=new Matrix4().fromArray(I.value);break;default:d.uniforms[C].value=I.value}}if(t.defines!==void 0&&(d.defines=t.defines),t.vertexShader!==void 0&&(d.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(d.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(d.glslVersion=t.glslVersion),t.extensions!==void 0)for(const C in t.extensions)d.extensions[C]=t.extensions[C];if(t.lights!==void 0&&(d.lights=t.lights),t.clipping!==void 0&&(d.clipping=t.clipping),t.size!==void 0&&(d.size=t.size),t.sizeAttenuation!==void 0&&(d.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(d.map=u(t.map)),t.matcap!==void 0&&(d.matcap=u(t.matcap)),t.alphaMap!==void 0&&(d.alphaMap=u(t.alphaMap)),t.bumpMap!==void 0&&(d.bumpMap=u(t.bumpMap)),t.bumpScale!==void 0&&(d.bumpScale=t.bumpScale),t.normalMap!==void 0&&(d.normalMap=u(t.normalMap)),t.normalMapType!==void 0&&(d.normalMapType=t.normalMapType),t.normalScale!==void 0){let C=t.normalScale;Array.isArray(C)===!1&&(C=[C,C]),d.normalScale=new Vector2().fromArray(C)}return t.displacementMap!==void 0&&(d.displacementMap=u(t.displacementMap)),t.displacementScale!==void 0&&(d.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(d.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(d.roughnessMap=u(t.roughnessMap)),t.metalnessMap!==void 0&&(d.metalnessMap=u(t.metalnessMap)),t.emissiveMap!==void 0&&(d.emissiveMap=u(t.emissiveMap)),t.emissiveIntensity!==void 0&&(d.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(d.specularMap=u(t.specularMap)),t.specularIntensityMap!==void 0&&(d.specularIntensityMap=u(t.specularIntensityMap)),t.specularColorMap!==void 0&&(d.specularColorMap=u(t.specularColorMap)),t.envMap!==void 0&&(d.envMap=u(t.envMap)),t.envMapRotation!==void 0&&d.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(d.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(d.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(d.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(d.lightMap=u(t.lightMap)),t.lightMapIntensity!==void 0&&(d.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(d.aoMap=u(t.aoMap)),t.aoMapIntensity!==void 0&&(d.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(d.gradientMap=u(t.gradientMap)),t.clearcoatMap!==void 0&&(d.clearcoatMap=u(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(d.clearcoatRoughnessMap=u(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(d.clearcoatNormalMap=u(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(d.clearcoatNormalScale=new Vector2().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(d.iridescenceMap=u(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(d.iridescenceThicknessMap=u(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(d.transmissionMap=u(t.transmissionMap)),t.thicknessMap!==void 0&&(d.thicknessMap=u(t.thicknessMap)),t.anisotropyMap!==void 0&&(d.anisotropyMap=u(t.anisotropyMap)),t.sheenColorMap!==void 0&&(d.sheenColorMap=u(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(d.sheenRoughnessMap=u(t.sheenRoughnessMap)),d}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return MaterialLoader.createMaterialFromType(t)}static createMaterialFromType(t){const o={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new o[t]}}class LoaderUtils{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let o="";for(let u=0,d=t.length;u<d;u++)o+=String.fromCharCode(t[u]);try{return decodeURIComponent(escape(o))}catch{return o}}static extractUrlBase(t){const o=t.lastIndexOf("/");return o===-1?"./":t.slice(0,o+1)}static resolveURL(t,o){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(o)&&/^\//.test(t)&&(o=o.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:o+t)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class BufferGeometryLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=new FileLoader(C.manager);I.setPath(C.path),I.setRequestHeader(C.requestHeader),I.setWithCredentials(C.withCredentials),I.load(t,function(f){try{o(C.parse(JSON.parse(f)))}catch(A){d?d(A):console.error(A),C.manager.itemError(t)}},u,d)}parse(t){const o={},u={};function d(M,V){if(o[V]!==void 0)return o[V];const H=M.interleavedBuffers[V],J=C(M,H.buffer),z=getTypedArray(H.type,J),L=new InterleavedBuffer(z,H.stride);return L.uuid=H.uuid,o[V]=L,L}function C(M,V){if(u[V]!==void 0)return u[V];const H=M.arrayBuffers[V],J=new Uint32Array(H).buffer;return u[V]=J,J}const I=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,f=t.data.index;if(f!==void 0){const M=getTypedArray(f.type,f.array);I.setIndex(new BufferAttribute(M,1))}const A=t.data.attributes;for(const M in A){const V=A[M];let T;if(V.isInterleavedBufferAttribute){const H=d(t.data,V.data);T=new InterleavedBufferAttribute(H,V.itemSize,V.offset,V.normalized)}else{const H=getTypedArray(V.type,V.array),J=V.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;T=new J(H,V.itemSize,V.normalized)}V.name!==void 0&&(T.name=V.name),V.usage!==void 0&&T.setUsage(V.usage),I.setAttribute(M,T)}const y=t.data.morphAttributes;if(y)for(const M in y){const V=y[M],T=[];for(let H=0,J=V.length;H<J;H++){const z=V[H];let L;if(z.isInterleavedBufferAttribute){const K=d(t.data,z.data);L=new InterleavedBufferAttribute(K,z.itemSize,z.offset,z.normalized)}else{const K=getTypedArray(z.type,z.array);L=new BufferAttribute(K,z.itemSize,z.normalized)}z.name!==void 0&&(L.name=z.name),T.push(L)}I.morphAttributes[M]=T}t.data.morphTargetsRelative&&(I.morphTargetsRelative=!0);const S=t.data.groups||t.data.drawcalls||t.data.offsets;if(S!==void 0)for(let M=0,V=S.length;M!==V;++M){const T=S[M];I.addGroup(T.start,T.count,T.materialIndex)}const w=t.data.boundingSphere;if(w!==void 0){const M=new Vector3;w.center!==void 0&&M.fromArray(w.center),I.boundingSphere=new Sphere$1(M,w.radius)}return t.name&&(I.name=t.name),t.userData&&(I.userData=t.userData),I}}class ObjectLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=this.path===""?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||I;const f=new FileLoader(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(t,function(A){let y=null;try{y=JSON.parse(A)}catch(S){d!==void 0&&d(S),console.error("THREE:ObjectLoader: Can't parse "+t+".",S.message);return}const G=y.metadata;if(G===void 0||G.type===void 0||G.type.toLowerCase()==="geometry"){d!==void 0&&d(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}C.parse(y,o)},u,d)}async loadAsync(t,o){const u=this,d=this.path===""?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||d;const C=new FileLoader(this.manager);C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials);const I=await C.loadAsync(t,o),f=JSON.parse(I),A=f.metadata;if(A===void 0||A.type===void 0||A.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await u.parseAsync(f)}parse(t,o){const u=this.parseAnimations(t.animations),d=this.parseShapes(t.shapes),C=this.parseGeometries(t.geometries,d),I=this.parseImages(t.images,function(){o!==void 0&&o(y)}),f=this.parseTextures(t.textures,I),A=this.parseMaterials(t.materials,f),y=this.parseObject(t.object,C,A,f,u),G=this.parseSkeletons(t.skeletons,y);if(this.bindSkeletons(y,G),this.bindLightTargets(y),o!==void 0){let S=!1;for(const w in I)if(I[w].data instanceof HTMLImageElement){S=!0;break}S===!1&&o(y)}return y}async parseAsync(t){const o=this.parseAnimations(t.animations),u=this.parseShapes(t.shapes),d=this.parseGeometries(t.geometries,u),C=await this.parseImagesAsync(t.images),I=this.parseTextures(t.textures,C),f=this.parseMaterials(t.materials,I),A=this.parseObject(t.object,d,f,I,o),y=this.parseSkeletons(t.skeletons,A);return this.bindSkeletons(A,y),this.bindLightTargets(A),A}parseShapes(t){const o={};if(t!==void 0)for(let u=0,d=t.length;u<d;u++){const C=new Shape$2().fromJSON(t[u]);o[C.uuid]=C}return o}parseSkeletons(t,o){const u={},d={};if(o.traverse(function(C){C.isBone&&(d[C.uuid]=C)}),t!==void 0)for(let C=0,I=t.length;C<I;C++){const f=new Skeleton().fromJSON(t[C],d);u[f.uuid]=f}return u}parseGeometries(t,o){const u={};if(t!==void 0){const d=new BufferGeometryLoader;for(let C=0,I=t.length;C<I;C++){let f;const A=t[C];switch(A.type){case"BufferGeometry":case"InstancedBufferGeometry":f=d.parse(A);break;default:A.type in Geometries?f=Geometries[A.type].fromJSON(A,o):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${A.type}"`)}f.uuid=A.uuid,A.name!==void 0&&(f.name=A.name),A.userData!==void 0&&(f.userData=A.userData),u[A.uuid]=f}}return u}parseMaterials(t,o){const u={},d={};if(t!==void 0){const C=new MaterialLoader;C.setTextures(o);for(let I=0,f=t.length;I<f;I++){const A=t[I];u[A.uuid]===void 0&&(u[A.uuid]=C.parse(A)),d[A.uuid]=u[A.uuid]}}return d}parseAnimations(t){const o={};if(t!==void 0)for(let u=0;u<t.length;u++){const d=t[u],C=AnimationClip.parse(d);o[C.uuid]=C}return o}parseImages(t,o){const u=this,d={};let C;function I(A){return u.manager.itemStart(A),C.load(A,function(){u.manager.itemEnd(A)},void 0,function(){u.manager.itemError(A),u.manager.itemEnd(A)})}function f(A){if(typeof A=="string"){const y=A,G=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(y)?y:u.resourcePath+y;return I(G)}else return A.data?{data:getTypedArray(A.type,A.data),width:A.width,height:A.height}:null}if(t!==void 0&&t.length>0){const A=new LoadingManager(o);C=new ImageLoader(A),C.setCrossOrigin(this.crossOrigin);for(let y=0,G=t.length;y<G;y++){const S=t[y],w=S.url;if(Array.isArray(w)){const M=[];for(let V=0,T=w.length;V<T;V++){const H=w[V],J=f(H);J!==null&&(J instanceof HTMLImageElement?M.push(J):M.push(new DataTexture(J.data,J.width,J.height)))}d[S.uuid]=new Source(M)}else{const M=f(S.url);d[S.uuid]=new Source(M)}}}return d}async parseImagesAsync(t){const o=this,u={};let d;async function C(I){if(typeof I=="string"){const f=I,A=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:o.resourcePath+f;return await d.loadAsync(A)}else return I.data?{data:getTypedArray(I.type,I.data),width:I.width,height:I.height}:null}if(t!==void 0&&t.length>0){d=new ImageLoader(this.manager),d.setCrossOrigin(this.crossOrigin);for(let I=0,f=t.length;I<f;I++){const A=t[I],y=A.url;if(Array.isArray(y)){const G=[];for(let S=0,w=y.length;S<w;S++){const M=y[S],V=await C(M);V!==null&&(V instanceof HTMLImageElement?G.push(V):G.push(new DataTexture(V.data,V.width,V.height)))}u[A.uuid]=new Source(G)}else{const G=await C(A.url);u[A.uuid]=new Source(G)}}}return u}parseTextures(t,o){function u(C,I){return typeof C=="number"?C:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",C),I[C])}const d={};if(t!==void 0)for(let C=0,I=t.length;C<I;C++){const f=t[C];f.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid),o[f.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",f.image);const A=o[f.image],y=A.data;let G;Array.isArray(y)?(G=new CubeTexture,y.length===6&&(G.needsUpdate=!0)):(y&&y.data?G=new DataTexture:G=new Texture,y&&(G.needsUpdate=!0)),G.source=A,G.uuid=f.uuid,f.name!==void 0&&(G.name=f.name),f.mapping!==void 0&&(G.mapping=u(f.mapping,TEXTURE_MAPPING)),f.channel!==void 0&&(G.channel=f.channel),f.offset!==void 0&&G.offset.fromArray(f.offset),f.repeat!==void 0&&G.repeat.fromArray(f.repeat),f.center!==void 0&&G.center.fromArray(f.center),f.rotation!==void 0&&(G.rotation=f.rotation),f.wrap!==void 0&&(G.wrapS=u(f.wrap[0],TEXTURE_WRAPPING),G.wrapT=u(f.wrap[1],TEXTURE_WRAPPING)),f.format!==void 0&&(G.format=f.format),f.internalFormat!==void 0&&(G.internalFormat=f.internalFormat),f.type!==void 0&&(G.type=f.type),f.colorSpace!==void 0&&(G.colorSpace=f.colorSpace),f.minFilter!==void 0&&(G.minFilter=u(f.minFilter,TEXTURE_FILTER)),f.magFilter!==void 0&&(G.magFilter=u(f.magFilter,TEXTURE_FILTER)),f.anisotropy!==void 0&&(G.anisotropy=f.anisotropy),f.flipY!==void 0&&(G.flipY=f.flipY),f.generateMipmaps!==void 0&&(G.generateMipmaps=f.generateMipmaps),f.premultiplyAlpha!==void 0&&(G.premultiplyAlpha=f.premultiplyAlpha),f.unpackAlignment!==void 0&&(G.unpackAlignment=f.unpackAlignment),f.compareFunction!==void 0&&(G.compareFunction=f.compareFunction),f.userData!==void 0&&(G.userData=f.userData),d[f.uuid]=G}return d}parseObject(t,o,u,d,C){let I;function f(w){return o[w]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",w),o[w]}function A(w){if(w!==void 0){if(Array.isArray(w)){const M=[];for(let V=0,T=w.length;V<T;V++){const H=w[V];u[H]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",H),M.push(u[H])}return M}return u[w]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",w),u[w]}}function y(w){return d[w]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",w),d[w]}let G,S;switch(t.type){case"Scene":I=new Scene,t.background!==void 0&&(Number.isInteger(t.background)?I.background=new Color(t.background):I.background=y(t.background)),t.environment!==void 0&&(I.environment=y(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?I.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(I.fog=new FogExp2(t.fog.color,t.fog.density)),t.fog.name!==""&&(I.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(I.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(I.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&I.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(I.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&I.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":I=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(I.focus=t.focus),t.zoom!==void 0&&(I.zoom=t.zoom),t.filmGauge!==void 0&&(I.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(I.filmOffset=t.filmOffset),t.view!==void 0&&(I.view=Object.assign({},t.view));break;case"OrthographicCamera":I=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(I.zoom=t.zoom),t.view!==void 0&&(I.view=Object.assign({},t.view));break;case"AmbientLight":I=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":I=new DirectionalLight(t.color,t.intensity),I.target=t.target||"";break;case"PointLight":I=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":I=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":I=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),I.target=t.target||"";break;case"HemisphereLight":I=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":I=new LightProbe().fromJSON(t);break;case"SkinnedMesh":G=f(t.geometry),S=A(t.material),I=new SkinnedMesh(G,S),t.bindMode!==void 0&&(I.bindMode=t.bindMode),t.bindMatrix!==void 0&&I.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(I.skeleton=t.skeleton);break;case"Mesh":G=f(t.geometry),S=A(t.material),I=new Mesh(G,S);break;case"InstancedMesh":G=f(t.geometry),S=A(t.material);const w=t.count,M=t.instanceMatrix,V=t.instanceColor;I=new InstancedMesh(G,S,w),I.instanceMatrix=new InstancedBufferAttribute(new Float32Array(M.array),16),V!==void 0&&(I.instanceColor=new InstancedBufferAttribute(new Float32Array(V.array),V.itemSize));break;case"BatchedMesh":G=f(t.geometry),S=A(t.material),I=new BatchedMesh(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,S),I.geometry=G,I.perObjectFrustumCulled=t.perObjectFrustumCulled,I.sortObjects=t.sortObjects,I._drawRanges=t.drawRanges,I._reservedRanges=t.reservedRanges,I._visibility=t.visibility,I._active=t.active,I._bounds=t.bounds.map(T=>{const H=new Box3;H.min.fromArray(T.boxMin),H.max.fromArray(T.boxMax);const J=new Sphere$1;return J.radius=T.sphereRadius,J.center.fromArray(T.sphereCenter),{boxInitialized:T.boxInitialized,box:H,sphereInitialized:T.sphereInitialized,sphere:J}}),I._maxInstanceCount=t.maxInstanceCount,I._maxVertexCount=t.maxVertexCount,I._maxIndexCount=t.maxIndexCount,I._geometryInitialized=t.geometryInitialized,I._geometryCount=t.geometryCount,I._matricesTexture=y(t.matricesTexture.uuid),t.colorsTexture!==void 0&&(I._colorsTexture=y(t.colorsTexture.uuid));break;case"LOD":I=new LOD;break;case"Line":I=new Line(f(t.geometry),A(t.material));break;case"LineLoop":I=new LineLoop(f(t.geometry),A(t.material));break;case"LineSegments":I=new LineSegments(f(t.geometry),A(t.material));break;case"PointCloud":case"Points":I=new Points(f(t.geometry),A(t.material));break;case"Sprite":I=new Sprite(A(t.material));break;case"Group":I=new Group;break;case"Bone":I=new Bone;break;default:I=new Object3D}if(I.uuid=t.uuid,t.name!==void 0&&(I.name=t.name),t.matrix!==void 0?(I.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(I.matrixAutoUpdate=t.matrixAutoUpdate),I.matrixAutoUpdate&&I.matrix.decompose(I.position,I.quaternion,I.scale)):(t.position!==void 0&&I.position.fromArray(t.position),t.rotation!==void 0&&I.rotation.fromArray(t.rotation),t.quaternion!==void 0&&I.quaternion.fromArray(t.quaternion),t.scale!==void 0&&I.scale.fromArray(t.scale)),t.up!==void 0&&I.up.fromArray(t.up),t.castShadow!==void 0&&(I.castShadow=t.castShadow),t.receiveShadow!==void 0&&(I.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(I.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(I.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(I.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(I.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&I.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(I.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(I.visible=t.visible),t.frustumCulled!==void 0&&(I.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(I.renderOrder=t.renderOrder),t.userData!==void 0&&(I.userData=t.userData),t.layers!==void 0&&(I.layers.mask=t.layers),t.children!==void 0){const w=t.children;for(let M=0;M<w.length;M++)I.add(this.parseObject(w[M],o,u,d,C))}if(t.animations!==void 0){const w=t.animations;for(let M=0;M<w.length;M++){const V=w[M];I.animations.push(C[V])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(I.autoUpdate=t.autoUpdate);const w=t.levels;for(let M=0;M<w.length;M++){const V=w[M],T=I.getObjectByProperty("uuid",V.object);T!==void 0&&I.addLevel(T,V.distance,V.hysteresis)}}return I}bindSkeletons(t,o){Object.keys(o).length!==0&&t.traverse(function(u){if(u.isSkinnedMesh===!0&&u.skeleton!==void 0){const d=o[u.skeleton];d===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",u.skeleton):u.bind(d,u.bindMatrix)}})}bindLightTargets(t){t.traverse(function(o){if(o.isDirectionalLight||o.isSpotLight){const u=o.target,d=t.getObjectByProperty("uuid",u);d!==void 0?o.target=d:o.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,o,u,d){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const C=this,I=Cache.get(t);if(I!==void 0){if(C.manager.itemStart(t),I.then){I.then(y=>{o&&o(y),C.manager.itemEnd(t)}).catch(y=>{d&&d(y)});return}return setTimeout(function(){o&&o(I),C.manager.itemEnd(t)},0),I}const f={};f.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",f.headers=this.requestHeader;const A=fetch(t,f).then(function(y){return y.blob()}).then(function(y){return createImageBitmap(y,Object.assign(C.options,{colorSpaceConversion:"none"}))}).then(function(y){return Cache.add(t,y),o&&o(y),C.manager.itemEnd(t),y}).catch(function(y){d&&d(y),Cache.remove(t),C.manager.itemError(t),C.manager.itemEnd(t)});Cache.add(t,A),C.manager.itemStart(t)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(t){_context=t}}class AudioLoader extends Loader{constructor(t){super(t)}load(t,o,u,d){const C=this,I=new FileLoader(this.manager);I.setResponseType("arraybuffer"),I.setPath(this.path),I.setRequestHeader(this.requestHeader),I.setWithCredentials(this.withCredentials),I.load(t,function(A){try{const y=A.slice(0);AudioContext.getContext().decodeAudioData(y,function(S){o(S)}).catch(f)}catch(y){f(y)}},u,d);function f(A){d?d(A):console.error(A),C.manager.itemError(t)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const o=this._cache;if(o.focus!==t.focus||o.fov!==t.fov||o.aspect!==t.aspect*this.aspect||o.near!==t.near||o.far!==t.far||o.zoom!==t.zoom||o.eyeSep!==this.eyeSep){o.focus=t.focus,o.fov=t.fov,o.aspect=t.aspect*this.aspect,o.near=t.near,o.far=t.far,o.zoom=t.zoom,o.eyeSep=this.eyeSep,_projectionMatrix.copy(t.projectionMatrix);const d=o.eyeSep/2,C=d*o.near/o.focus,I=o.near*Math.tan(DEG2RAD*o.fov*.5)/o.zoom;let f,A;_eyeLeft.elements[12]=-d,_eyeRight.elements[12]=d,f=-I*o.aspect+C,A=I*o.aspect+C,_projectionMatrix.elements[0]=2*o.near/(A-f),_projectionMatrix.elements[8]=(A+f)/(A-f),this.cameraL.projectionMatrix.copy(_projectionMatrix),f=-I*o.aspect-C,A=I*o.aspect-C,_projectionMatrix.elements[0]=2*o.near/(A-f),_projectionMatrix.elements[8]=(A+f)/(A-f),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t,this.index=0}}class Clock{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const o=now();t=(o-this.oldTime)/1e3,this.oldTime=o,this.elapsedTime+=t}return t}}function now(){return performance.now()}const _position$1=new Vector3,_quaternion$1=new Quaternion$2,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const o=this.context.listener,u=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),o.positionX){const d=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(_position$1.x,d),o.positionY.linearRampToValueAtTime(_position$1.y,d),o.positionZ.linearRampToValueAtTime(_position$1.z,d),o.forwardX.linearRampToValueAtTime(_orientation$1.x,d),o.forwardY.linearRampToValueAtTime(_orientation$1.y,d),o.forwardZ.linearRampToValueAtTime(_orientation$1.z,d),o.upX.linearRampToValueAtTime(u.x,d),o.upY.linearRampToValueAtTime(u.y,d),o.upZ.linearRampToValueAtTime(u.z,d)}else o.setPosition(_position$1.x,_position$1.y,_position$1.z),o.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,u.x,u.y,u.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const o=this.context.createBufferSource();return o.buffer=this.buffer,o.loop=this.loop,o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.onended=this.onEnded.bind(this),o.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=o,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(t=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,o=this.filters.length;t<o;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,o=this.filters.length;t<o;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,o){return super.copy(t,o),t.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const _position=new Vector3,_quaternion=new Quaternion$2,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,o,u){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=o,this.panner.coneOuterGain=u,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const o=this.panner;if(o.positionX){const u=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(_position.x,u),o.positionY.linearRampToValueAtTime(_position.y,u),o.positionZ.linearRampToValueAtTime(_position.z,u),o.orientationX.linearRampToValueAtTime(_orientation.x,u),o.orientationY.linearRampToValueAtTime(_orientation.y,u),o.orientationZ.linearRampToValueAtTime(_orientation.z,u)}else o.setPosition(_position.x,_position.y,_position.z),o.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(t,o=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=o,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const o=this.getFrequencyData();for(let u=0;u<o.length;u++)t+=o[u];return t/o.length}}class PropertyMixer{constructor(t,o,u){this.binding=t,this.valueSize=u;let d,C,I;switch(o){case"quaternion":d=this._slerp,C=this._slerpAdditive,I=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(u*6),this._workIndex=5;break;case"string":case"bool":d=this._select,C=this._select,I=this._setAdditiveIdentityOther,this.buffer=new Array(u*5);break;default:d=this._lerp,C=this._lerpAdditive,I=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(u*5)}this._mixBufferRegion=d,this._mixBufferRegionAdditive=C,this._setIdentity=I,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,o){const u=this.buffer,d=this.valueSize,C=t*d+d;let I=this.cumulativeWeight;if(I===0){for(let f=0;f!==d;++f)u[C+f]=u[f];I=o}else{I+=o;const f=o/I;this._mixBufferRegion(u,C,0,f,d)}this.cumulativeWeight=I}accumulateAdditive(t){const o=this.buffer,u=this.valueSize,d=u*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(o,d,0,t,u),this.cumulativeWeightAdditive+=t}apply(t){const o=this.valueSize,u=this.buffer,d=t*o+o,C=this.cumulativeWeight,I=this.cumulativeWeightAdditive,f=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,C<1){const A=o*this._origIndex;this._mixBufferRegion(u,d,A,1-C,o)}I>0&&this._mixBufferRegionAdditive(u,d,this._addIndex*o,1,o);for(let A=o,y=o+o;A!==y;++A)if(u[A]!==u[A+o]){f.setValue(u,d);break}}saveOriginalState(){const t=this.binding,o=this.buffer,u=this.valueSize,d=u*this._origIndex;t.getValue(o,d);for(let C=u,I=d;C!==I;++C)o[C]=o[d+C%u];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,o=t+this.valueSize;for(let u=t;u<o;u++)this.buffer[u]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,o=this._addIndex*this.valueSize;for(let u=0;u<this.valueSize;u++)this.buffer[o+u]=this.buffer[t+u]}_select(t,o,u,d,C){if(d>=.5)for(let I=0;I!==C;++I)t[o+I]=t[u+I]}_slerp(t,o,u,d){Quaternion$2.slerpFlat(t,o,t,o,t,u,d)}_slerpAdditive(t,o,u,d,C){const I=this._workIndex*C;Quaternion$2.multiplyQuaternionsFlat(t,I,t,o,t,u),Quaternion$2.slerpFlat(t,o,t,o,t,I,d)}_lerp(t,o,u,d,C){const I=1-d;for(let f=0;f!==C;++f){const A=o+f;t[A]=t[A]*I+t[u+f]*d}}_lerpAdditive(t,o,u,d,C){for(let I=0;I!==C;++I){const f=o+I;t[f]=t[f]+t[u+I]*d}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(t,o,u){const d=u||PropertyBinding.parseTrackName(o);this._targetGroup=t,this._bindings=t.subscribe_(o,d)}getValue(t,o){this.bind();const u=this._targetGroup.nCachedObjects_,d=this._bindings[u];d!==void 0&&d.getValue(t,o)}setValue(t,o){const u=this._bindings;for(let d=this._targetGroup.nCachedObjects_,C=u.length;d!==C;++d)u[d].setValue(t,o)}bind(){const t=this._bindings;for(let o=this._targetGroup.nCachedObjects_,u=t.length;o!==u;++o)t[o].bind()}unbind(){const t=this._bindings;for(let o=this._targetGroup.nCachedObjects_,u=t.length;o!==u;++o)t[o].unbind()}}class PropertyBinding{constructor(t,o,u){this.path=o,this.parsedPath=u||PropertyBinding.parseTrackName(o),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,o,u){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,o,u):new PropertyBinding(t,o,u)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(t){const o=_trackRe.exec(t);if(o===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const u={nodeName:o[2],objectName:o[3],objectIndex:o[4],propertyName:o[5],propertyIndex:o[6]},d=u.nodeName&&u.nodeName.lastIndexOf(".");if(d!==void 0&&d!==-1){const C=u.nodeName.substring(d+1);_supportedObjectNames.indexOf(C)!==-1&&(u.nodeName=u.nodeName.substring(0,d),u.objectName=C)}if(u.propertyName===null||u.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return u}static findNode(t,o){if(o===void 0||o===""||o==="."||o===-1||o===t.name||o===t.uuid)return t;if(t.skeleton){const u=t.skeleton.getBoneByName(o);if(u!==void 0)return u}if(t.children){const u=function(C){for(let I=0;I<C.length;I++){const f=C[I];if(f.name===o||f.uuid===o)return f;const A=u(f.children);if(A)return A}return null},d=u(t.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,o){t[o]=this.targetObject[this.propertyName]}_getValue_array(t,o){const u=this.resolvedProperty;for(let d=0,C=u.length;d!==C;++d)t[o++]=u[d]}_getValue_arrayElement(t,o){t[o]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,o){this.resolvedProperty.toArray(t,o)}_setValue_direct(t,o){this.targetObject[this.propertyName]=t[o]}_setValue_direct_setNeedsUpdate(t,o){this.targetObject[this.propertyName]=t[o],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,o){this.targetObject[this.propertyName]=t[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,o){const u=this.resolvedProperty;for(let d=0,C=u.length;d!==C;++d)u[d]=t[o++]}_setValue_array_setNeedsUpdate(t,o){const u=this.resolvedProperty;for(let d=0,C=u.length;d!==C;++d)u[d]=t[o++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,o){const u=this.resolvedProperty;for(let d=0,C=u.length;d!==C;++d)u[d]=t[o++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,o){this.resolvedProperty[this.propertyIndex]=t[o]}_setValue_arrayElement_setNeedsUpdate(t,o){this.resolvedProperty[this.propertyIndex]=t[o],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,o){this.resolvedProperty[this.propertyIndex]=t[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,o){this.resolvedProperty.fromArray(t,o)}_setValue_fromArray_setNeedsUpdate(t,o){this.resolvedProperty.fromArray(t,o),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,o){this.resolvedProperty.fromArray(t,o),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,o){this.bind(),this.getValue(t,o)}_setValue_unbound(t,o){this.bind(),this.setValue(t,o)}bind(){let t=this.node;const o=this.parsedPath,u=o.objectName,d=o.propertyName;let C=o.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,o.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(u){let y=o.objectIndex;switch(u){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let G=0;G<t.length;G++)if(t[G].name===y){y=G;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[u]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[u]}if(y!==void 0){if(t[y]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[y]}}const I=t[d];if(I===void 0){const y=o.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+y+"."+d+" but it wasn't found.",t);return}let f=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?f=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(f=this.Versioning.MatrixWorldNeedsUpdate);let A=this.BindingType.Direct;if(C!==void 0){if(d==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[C]!==void 0&&(C=t.morphTargetDictionary[C])}A=this.BindingType.ArrayElement,this.resolvedProperty=I,this.propertyIndex=C}else I.fromArray!==void 0&&I.toArray!==void 0?(A=this.BindingType.HasFromToArray,this.resolvedProperty=I):Array.isArray(I)?(A=this.BindingType.EntireArray,this.resolvedProperty=I):this.propertyName=d;this.getValue=this.GetterByBindingType[A],this.setValue=this.SetterByBindingTypeAndVersioning[A][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let u=0,d=arguments.length;u!==d;++u)t[arguments[u].uuid]=u;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const o=this;this.stats={objects:{get total(){return o._objects.length},get inUse(){return this.total-o.nCachedObjects_}},get bindingsPerObject(){return o._bindings.length}}}add(){const t=this._objects,o=this._indicesByUUID,u=this._paths,d=this._parsedPaths,C=this._bindings,I=C.length;let f,A=t.length,y=this.nCachedObjects_;for(let G=0,S=arguments.length;G!==S;++G){const w=arguments[G],M=w.uuid;let V=o[M];if(V===void 0){V=A++,o[M]=V,t.push(w);for(let T=0,H=I;T!==H;++T)C[T].push(new PropertyBinding(w,u[T],d[T]))}else if(V<y){f=t[V];const T=--y,H=t[T];o[H.uuid]=V,t[V]=H,o[M]=T,t[T]=w;for(let J=0,z=I;J!==z;++J){const L=C[J],K=L[T];let O=L[V];L[V]=K,O===void 0&&(O=new PropertyBinding(w,u[J],d[J])),L[T]=O}}else t[V]!==f&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=y}remove(){const t=this._objects,o=this._indicesByUUID,u=this._bindings,d=u.length;let C=this.nCachedObjects_;for(let I=0,f=arguments.length;I!==f;++I){const A=arguments[I],y=A.uuid,G=o[y];if(G!==void 0&&G>=C){const S=C++,w=t[S];o[w.uuid]=G,t[G]=w,o[y]=S,t[S]=A;for(let M=0,V=d;M!==V;++M){const T=u[M],H=T[S],J=T[G];T[G]=H,T[S]=J}}}this.nCachedObjects_=C}uncache(){const t=this._objects,o=this._indicesByUUID,u=this._bindings,d=u.length;let C=this.nCachedObjects_,I=t.length;for(let f=0,A=arguments.length;f!==A;++f){const y=arguments[f],G=y.uuid,S=o[G];if(S!==void 0)if(delete o[G],S<C){const w=--C,M=t[w],V=--I,T=t[V];o[M.uuid]=S,t[S]=M,o[T.uuid]=w,t[w]=T,t.pop();for(let H=0,J=d;H!==J;++H){const z=u[H],L=z[w],K=z[V];z[S]=L,z[w]=K,z.pop()}}else{const w=--I,M=t[w];w>0&&(o[M.uuid]=S),t[S]=M,t.pop();for(let V=0,T=d;V!==T;++V){const H=u[V];H[S]=H[w],H.pop()}}}this.nCachedObjects_=C}subscribe_(t,o){const u=this._bindingsIndicesByPath;let d=u[t];const C=this._bindings;if(d!==void 0)return C[d];const I=this._paths,f=this._parsedPaths,A=this._objects,y=A.length,G=this.nCachedObjects_,S=new Array(y);d=C.length,u[t]=d,I.push(t),f.push(o),C.push(S);for(let w=G,M=A.length;w!==M;++w){const V=A[w];S[w]=new PropertyBinding(V,t,o)}return S}unsubscribe_(t){const o=this._bindingsIndicesByPath,u=o[t];if(u!==void 0){const d=this._paths,C=this._parsedPaths,I=this._bindings,f=I.length-1,A=I[f],y=t[f];o[y]=u,I[u]=A,I.pop(),C[u]=C[f],C.pop(),d[u]=d[f],d.pop()}}}class AnimationAction{constructor(t,o,u=null,d=o.blendMode){this._mixer=t,this._clip=o,this._localRoot=u,this.blendMode=d;const C=o.tracks,I=C.length,f=new Array(I),A={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let y=0;y!==I;++y){const G=C[y].createInterpolant(null);f[y]=G,G.settings=A}this._interpolantSettings=A,this._interpolants=f,this._propertyBindings=new Array(I),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,o){return this.loop=t,this.repetitions=o,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,o,u){if(t.fadeOut(o),this.fadeIn(o),u){const d=this._clip.duration,C=t._clip.duration,I=C/d,f=d/C;t.warp(1,I,o),this.warp(f,1,o)}return this}crossFadeTo(t,o,u){return t.crossFadeFrom(this,o,u)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,o,u){const d=this._mixer,C=d.time,I=this.timeScale;let f=this._timeScaleInterpolant;f===null&&(f=d._lendControlInterpolant(),this._timeScaleInterpolant=f);const A=f.parameterPositions,y=f.sampleValues;return A[0]=C,A[1]=C+u,y[0]=t/I,y[1]=o/I,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,o,u,d){if(!this.enabled){this._updateWeight(t);return}const C=this._startTime;if(C!==null){const A=(t-C)*u;A<0||u===0?o=0:(this._startTime=null,o=u*A)}o*=this._updateTimeScale(t);const I=this._updateTime(o),f=this._updateWeight(t);if(f>0){const A=this._interpolants,y=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let G=0,S=A.length;G!==S;++G)A[G].evaluate(I),y[G].accumulateAdditive(f);break;case NormalAnimationBlendMode:default:for(let G=0,S=A.length;G!==S;++G)A[G].evaluate(I),y[G].accumulate(d,f)}}}_updateWeight(t){let o=0;if(this.enabled){o=this.weight;const u=this._weightInterpolant;if(u!==null){const d=u.evaluate(t)[0];o*=d,t>u.parameterPositions[1]&&(this.stopFading(),d===0&&(this.enabled=!1))}}return this._effectiveWeight=o,o}_updateTimeScale(t){let o=0;if(!this.paused){o=this.timeScale;const u=this._timeScaleInterpolant;if(u!==null){const d=u.evaluate(t)[0];o*=d,t>u.parameterPositions[1]&&(this.stopWarping(),o===0?this.paused=!0:this.timeScale=o)}}return this._effectiveTimeScale=o,o}_updateTime(t){const o=this._clip.duration,u=this.loop;let d=this.time+t,C=this._loopCount;const I=u===LoopPingPong;if(t===0)return C===-1?d:I&&(C&1)===1?o-d:d;if(u===LoopOnce){C===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(d>=o)d=o;else if(d<0)d=0;else{this.time=d;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(C===-1&&(t>=0?(C=0,this._setEndings(!0,this.repetitions===0,I)):this._setEndings(this.repetitions===0,!0,I)),d>=o||d<0){const f=Math.floor(d/o);d-=o*f,C+=Math.abs(f);const A=this.repetitions-C;if(A<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,d=t>0?o:0,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(A===1){const y=t<0;this._setEndings(y,!y,I)}else this._setEndings(!1,!1,I);this._loopCount=C,this.time=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=d;if(I&&(C&1)===1)return o-d}return d}_setEndings(t,o,u){const d=this._interpolantSettings;u?(d.endingStart=ZeroSlopeEnding,d.endingEnd=ZeroSlopeEnding):(t?d.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:d.endingStart=WrapAroundEnding,o?d.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:d.endingEnd=WrapAroundEnding)}_scheduleFading(t,o,u){const d=this._mixer,C=d.time;let I=this._weightInterpolant;I===null&&(I=d._lendControlInterpolant(),this._weightInterpolant=I);const f=I.parameterPositions,A=I.sampleValues;return f[0]=C,A[0]=o,f[1]=C+t,A[1]=u,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher$1{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,o){const u=t._localRoot||this._root,d=t._clip.tracks,C=d.length,I=t._propertyBindings,f=t._interpolants,A=u.uuid,y=this._bindingsByRootAndName;let G=y[A];G===void 0&&(G={},y[A]=G);for(let S=0;S!==C;++S){const w=d[S],M=w.name;let V=G[M];if(V!==void 0)++V.referenceCount,I[S]=V;else{if(V=I[S],V!==void 0){V._cacheIndex===null&&(++V.referenceCount,this._addInactiveBinding(V,A,M));continue}const T=o&&o._propertyBindings[S].binding.parsedPath;V=new PropertyMixer(PropertyBinding.create(u,M,T),w.ValueTypeName,w.getValueSize()),++V.referenceCount,this._addInactiveBinding(V,A,M),I[S]=V}f[S].resultBuffer=V.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const u=(t._localRoot||this._root).uuid,d=t._clip.uuid,C=this._actionsByClip[d];this._bindAction(t,C&&C.knownActions[0]),this._addInactiveAction(t,d,u)}const o=t._propertyBindings;for(let u=0,d=o.length;u!==d;++u){const C=o[u];C.useCount++===0&&(this._lendBinding(C),C.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const o=t._propertyBindings;for(let u=0,d=o.length;u!==d;++u){const C=o[u];--C.useCount===0&&(C.restoreOriginalState(),this._takeBackBinding(C))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const o=t._cacheIndex;return o!==null&&o<this._nActiveActions}_addInactiveAction(t,o,u){const d=this._actions,C=this._actionsByClip;let I=C[o];if(I===void 0)I={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,C[o]=I;else{const f=I.knownActions;t._byClipCacheIndex=f.length,f.push(t)}t._cacheIndex=d.length,d.push(t),I.actionByRoot[u]=t}_removeInactiveAction(t){const o=this._actions,u=o[o.length-1],d=t._cacheIndex;u._cacheIndex=d,o[d]=u,o.pop(),t._cacheIndex=null;const C=t._clip.uuid,I=this._actionsByClip,f=I[C],A=f.knownActions,y=A[A.length-1],G=t._byClipCacheIndex;y._byClipCacheIndex=G,A[G]=y,A.pop(),t._byClipCacheIndex=null;const S=f.actionByRoot,w=(t._localRoot||this._root).uuid;delete S[w],A.length===0&&delete I[C],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const o=t._propertyBindings;for(let u=0,d=o.length;u!==d;++u){const C=o[u];--C.referenceCount===0&&this._removeInactiveBinding(C)}}_lendAction(t){const o=this._actions,u=t._cacheIndex,d=this._nActiveActions++,C=o[d];t._cacheIndex=d,o[d]=t,C._cacheIndex=u,o[u]=C}_takeBackAction(t){const o=this._actions,u=t._cacheIndex,d=--this._nActiveActions,C=o[d];t._cacheIndex=d,o[d]=t,C._cacheIndex=u,o[u]=C}_addInactiveBinding(t,o,u){const d=this._bindingsByRootAndName,C=this._bindings;let I=d[o];I===void 0&&(I={},d[o]=I),I[u]=t,t._cacheIndex=C.length,C.push(t)}_removeInactiveBinding(t){const o=this._bindings,u=t.binding,d=u.rootNode.uuid,C=u.path,I=this._bindingsByRootAndName,f=I[d],A=o[o.length-1],y=t._cacheIndex;A._cacheIndex=y,o[y]=A,o.pop(),delete f[C],Object.keys(f).length===0&&delete I[d]}_lendBinding(t){const o=this._bindings,u=t._cacheIndex,d=this._nActiveBindings++,C=o[d];t._cacheIndex=d,o[d]=t,C._cacheIndex=u,o[u]=C}_takeBackBinding(t){const o=this._bindings,u=t._cacheIndex,d=--this._nActiveBindings,C=o[d];t._cacheIndex=d,o[d]=t,C._cacheIndex=u,o[u]=C}_lendControlInterpolant(){const t=this._controlInterpolants,o=this._nActiveControlInterpolants++;let u=t[o];return u===void 0&&(u=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),u.__cacheIndex=o,t[o]=u),u}_takeBackControlInterpolant(t){const o=this._controlInterpolants,u=t.__cacheIndex,d=--this._nActiveControlInterpolants,C=o[d];t.__cacheIndex=d,o[d]=t,C.__cacheIndex=u,o[u]=C}clipAction(t,o,u){const d=o||this._root,C=d.uuid;let I=typeof t=="string"?AnimationClip.findByName(d,t):t;const f=I!==null?I.uuid:t,A=this._actionsByClip[f];let y=null;if(u===void 0&&(I!==null?u=I.blendMode:u=NormalAnimationBlendMode),A!==void 0){const S=A.actionByRoot[C];if(S!==void 0&&S.blendMode===u)return S;y=A.knownActions[0],I===null&&(I=y._clip)}if(I===null)return null;const G=new AnimationAction(this,I,o,u);return this._bindAction(G,y),this._addInactiveAction(G,f,C),G}existingAction(t,o){const u=o||this._root,d=u.uuid,C=typeof t=="string"?AnimationClip.findByName(u,t):t,I=C?C.uuid:t,f=this._actionsByClip[I];return f!==void 0&&f.actionByRoot[d]||null}stopAllAction(){const t=this._actions,o=this._nActiveActions;for(let u=o-1;u>=0;--u)t[u].stop();return this}update(t){t*=this.timeScale;const o=this._actions,u=this._nActiveActions,d=this.time+=t,C=Math.sign(t),I=this._accuIndex^=1;for(let y=0;y!==u;++y)o[y]._update(d,t,C,I);const f=this._bindings,A=this._nActiveBindings;for(let y=0;y!==A;++y)f[y].apply(I);return this}setTime(t){this.time=0;for(let o=0;o<this._actions.length;o++)this._actions[o].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const o=this._actions,u=t.uuid,d=this._actionsByClip,C=d[u];if(C!==void 0){const I=C.knownActions;for(let f=0,A=I.length;f!==A;++f){const y=I[f];this._deactivateAction(y);const G=y._cacheIndex,S=o[o.length-1];y._cacheIndex=null,y._byClipCacheIndex=null,S._cacheIndex=G,o[G]=S,o.pop(),this._removeInactiveBindingsForAction(y)}delete d[u]}}uncacheRoot(t){const o=t.uuid,u=this._actionsByClip;for(const I in u){const f=u[I].actionByRoot,A=f[o];A!==void 0&&(this._deactivateAction(A),this._removeInactiveAction(A))}const d=this._bindingsByRootAndName,C=d[o];if(C!==void 0)for(const I in C){const f=C[I];f.restoreOriginalState(),this._removeInactiveBinding(f)}}uncacheAction(t,o){const u=this.existingAction(t,o);u!==null&&(this._deactivateAction(u),this._removeInactiveAction(u))}}class RenderTarget3D extends RenderTarget{constructor(t=1,o=1,u=1,d={}){super(t,o,d),this.isRenderTarget3D=!0,this.depth=u,this.texture=new Data3DTexture(null,t,o,u),this.texture.isRenderTargetTexture=!0}}class RenderTargetArray extends RenderTarget{constructor(t=1,o=1,u=1,d={}){super(t,o,d),this.isRenderTargetArray=!0,this.depth=u,this.texture=new DataArrayTexture(null,t,o,u),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(t){this.value=t}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id$3=0;class UniformsGroup extends EventDispatcher$1{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id$3++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const o=this.uniforms.indexOf(t);return o!==-1&&this.uniforms.splice(o,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const o=t.uniforms;this.uniforms.length=0;for(let u=0,d=o.length;u<d;u++){const C=Array.isArray(o[u])?o[u]:[o[u]];for(let I=0;I<C.length;I++)this.uniforms.push(C[I].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,o,u=1){super(t,o),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=u}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const o=super.clone(t);return o.meshPerAttribute=this.meshPerAttribute,o}toJSON(t){const o=super.toJSON(t);return o.isInstancedInterleavedBuffer=!0,o.meshPerAttribute=this.meshPerAttribute,o}}class GLBufferAttribute{constructor(t,o,u,d,C){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=o,this.itemSize=u,this.elementSize=d,this.count=C,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,o){return this.type=t,this.elementSize=o,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const _matrix=new Matrix4;class Raycaster{constructor(t,o,u=0,d=1/0){this.ray=new Ray$2(t,o),this.near=u,this.far=d,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,o){this.ray.set(t,o)}setFromCamera(t,o){o.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(o.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(o).sub(this.ray.origin).normalize(),this.camera=o):o.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(o.near+o.far)/(o.near-o.far)).unproject(o),this.ray.direction.set(0,0,-1).transformDirection(o.matrixWorld),this.camera=o):console.error("THREE.Raycaster: Unsupported camera type: "+o.type)}setFromXRController(t){return _matrix.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix),this}intersectObject(t,o=!0,u=[]){return intersect$2(t,this,u,o),u.sort(ascSort),u}intersectObjects(t,o=!0,u=[]){for(let d=0,C=t.length;d<C;d++)intersect$2(t[d],this,u,o);return u.sort(ascSort),u}}function ascSort(n,t){return n.distance-t.distance}function intersect$2(n,t,o,u){let d=!0;if(n.layers.test(t.layers)&&n.raycast(t,o)===!1&&(d=!1),d===!0&&u===!0){const C=n.children;for(let I=0,f=C.length;I<f;I++)intersect$2(C[I],t,o,!0)}}class Spherical{constructor(t=1,o=0,u=0){this.radius=t,this.phi=o,this.theta=u}set(t,o,u){return this.radius=t,this.phi=o,this.theta=u,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=clamp$1(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,o,u){return this.radius=Math.sqrt(t*t+o*o+u*u),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,u),this.phi=Math.acos(clamp$1(o/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(t=1,o=0,u=0){this.radius=t,this.theta=o,this.y=u}set(t,o,u){return this.radius=t,this.theta=o,this.y=u,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,o,u){return this.radius=Math.sqrt(t*t+u*u),this.theta=Math.atan2(t,u),this.y=o,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(t,o,u,d){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,o,u,d)}identity(){return this.set(1,0,0,1),this}fromArray(t,o=0){for(let u=0;u<4;u++)this.elements[u]=t[u+o];return this}set(t,o,u,d){const C=this.elements;return C[0]=t,C[2]=o,C[1]=u,C[3]=d,this}}const _vector$4=new Vector2;class Box2{constructor(t=new Vector2(1/0,1/0),o=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=o}set(t,o){return this.min.copy(t),this.max.copy(o),this}setFromPoints(t){this.makeEmpty();for(let o=0,u=t.length;o<u;o++)this.expandByPoint(t[o]);return this}setFromCenterAndSize(t,o){const u=_vector$4.copy(o).multiplyScalar(.5);return this.min.copy(t).sub(u),this.max.copy(t).add(u),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,o){return o.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,o){return o.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$4).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(t=new Vector3,o=new Vector3){this.start=t,this.end=o}set(t,o){return this.start.copy(t),this.end.copy(o),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,o){return this.delta(o).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,o){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const u=_startEnd.dot(_startEnd);let C=_startEnd.dot(_startP)/u;return o&&(C=clamp$1(C,0,1)),C}closestPointToPoint(t,o,u){const d=this.closestPointToPointParameter(t,o);return this.delta(u).multiplyScalar(d).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(t,o){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=o,this.type="SpotLightHelper";const u=new BufferGeometry,d=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let I=0,f=1,A=32;I<A;I++,f++){const y=I/A*Math.PI*2,G=f/A*Math.PI*2;d.push(Math.cos(y),Math.sin(y),1,Math.cos(G),Math.sin(G),1)}u.setAttribute("position",new Float32BufferAttribute(d,3));const C=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(u,C),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,o=t*Math.tan(this.light.angle);this.cone.scale.set(o,o,t),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const o=getBoneList(t),u=new BufferGeometry,d=[],C=[],I=new Color(0,0,1),f=new Color(0,1,0);for(let y=0;y<o.length;y++){const G=o[y];G.parent&&G.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),C.push(I.r,I.g,I.b),C.push(f.r,f.g,f.b))}u.setAttribute("position",new Float32BufferAttribute(d,3)),u.setAttribute("color",new Float32BufferAttribute(C,3));const A=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(u,A),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=o,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const o=this.bones,u=this.geometry,d=u.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let C=0,I=0;C<o.length;C++){const f=o[C];f.parent&&f.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,f.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),d.setXYZ(I,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,f.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),d.setXYZ(I+1,_vector$2.x,_vector$2.y,_vector$2.z),I+=2)}u.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(n){const t=[];n.isBone===!0&&t.push(n);for(let o=0;o<n.children.length;o++)t.push(...getBoneList(n.children[o]));return t}class PointLightHelper extends Mesh{constructor(t,o,u){const d=new SphereGeometry(o,4,2),C=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(d,C),this.light=t,this.color=u,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(t,o,u){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,this.type="HemisphereLightHelper";const d=new OctahedronGeometry(o);d.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const C=d.getAttribute("position"),I=new Float32Array(C.count*3);d.setAttribute("color",new BufferAttribute(I,3)),this.add(new Mesh(d,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const o=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let u=0,d=o.count;u<d;u++){const C=u<d/2?_color1:_color2;o.setXYZ(u,C.r,C.g,C.b)}o.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,o=10,u=4473924,d=8947848){u=new Color(u),d=new Color(d);const C=o/2,I=t/o,f=t/2,A=[],y=[];for(let w=0,M=0,V=-f;w<=o;w++,V+=I){A.push(-f,0,V,f,0,V),A.push(V,0,-f,V,0,f);const T=w===C?u:d;T.toArray(y,M),M+=3,T.toArray(y,M),M+=3,T.toArray(y,M),M+=3,T.toArray(y,M),M+=3}const G=new BufferGeometry;G.setAttribute("position",new Float32BufferAttribute(A,3)),G.setAttribute("color",new Float32BufferAttribute(y,3));const S=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(G,S),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(t=10,o=16,u=8,d=64,C=4473924,I=8947848){C=new Color(C),I=new Color(I);const f=[],A=[];if(o>1)for(let S=0;S<o;S++){const w=S/o*(Math.PI*2),M=Math.sin(w)*t,V=Math.cos(w)*t;f.push(0,0,0),f.push(M,0,V);const T=S&1?C:I;A.push(T.r,T.g,T.b),A.push(T.r,T.g,T.b)}for(let S=0;S<u;S++){const w=S&1?C:I,M=t-t/u*S;for(let V=0;V<d;V++){let T=V/d*(Math.PI*2),H=Math.sin(T)*M,J=Math.cos(T)*M;f.push(H,0,J),A.push(w.r,w.g,w.b),T=(V+1)/d*(Math.PI*2),H=Math.sin(T)*M,J=Math.cos(T)*M,f.push(H,0,J),A.push(w.r,w.g,w.b)}}const y=new BufferGeometry;y.setAttribute("position",new Float32BufferAttribute(f,3)),y.setAttribute("color",new Float32BufferAttribute(A,3));const G=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(y,G),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,o,u){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,this.type="DirectionalLightHelper",o===void 0&&(o=1);let d=new BufferGeometry;d.setAttribute("position",new Float32BufferAttribute([-o,o,0,o,o,0,o,-o,0,-o,-o,0,-o,o,0],3));const C=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(d,C),this.add(this.lightPlane),d=new BufferGeometry,d.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(d,C),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(t){const o=new BufferGeometry,u=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),d=[],C=[],I={};f("n1","n2"),f("n2","n4"),f("n4","n3"),f("n3","n1"),f("f1","f2"),f("f2","f4"),f("f4","f3"),f("f3","f1"),f("n1","f1"),f("n2","f2"),f("n3","f3"),f("n4","f4"),f("p","n1"),f("p","n2"),f("p","n3"),f("p","n4"),f("u1","u2"),f("u2","u3"),f("u3","u1"),f("c","t"),f("p","c"),f("cn1","cn2"),f("cn3","cn4"),f("cf1","cf2"),f("cf3","cf4");function f(V,T){A(V),A(T)}function A(V){d.push(0,0,0),C.push(0,0,0),I[V]===void 0&&(I[V]=[]),I[V].push(d.length/3-1)}o.setAttribute("position",new Float32BufferAttribute(d,3)),o.setAttribute("color",new Float32BufferAttribute(C,3)),super(o,u),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=I,this.update();const y=new Color(16755200),G=new Color(16711680),S=new Color(43775),w=new Color(16777215),M=new Color(3355443);this.setColors(y,G,S,w,M)}setColors(t,o,u,d,C){const f=this.geometry.getAttribute("color");f.setXYZ(0,t.r,t.g,t.b),f.setXYZ(1,t.r,t.g,t.b),f.setXYZ(2,t.r,t.g,t.b),f.setXYZ(3,t.r,t.g,t.b),f.setXYZ(4,t.r,t.g,t.b),f.setXYZ(5,t.r,t.g,t.b),f.setXYZ(6,t.r,t.g,t.b),f.setXYZ(7,t.r,t.g,t.b),f.setXYZ(8,t.r,t.g,t.b),f.setXYZ(9,t.r,t.g,t.b),f.setXYZ(10,t.r,t.g,t.b),f.setXYZ(11,t.r,t.g,t.b),f.setXYZ(12,t.r,t.g,t.b),f.setXYZ(13,t.r,t.g,t.b),f.setXYZ(14,t.r,t.g,t.b),f.setXYZ(15,t.r,t.g,t.b),f.setXYZ(16,t.r,t.g,t.b),f.setXYZ(17,t.r,t.g,t.b),f.setXYZ(18,t.r,t.g,t.b),f.setXYZ(19,t.r,t.g,t.b),f.setXYZ(20,t.r,t.g,t.b),f.setXYZ(21,t.r,t.g,t.b),f.setXYZ(22,t.r,t.g,t.b),f.setXYZ(23,t.r,t.g,t.b),f.setXYZ(24,o.r,o.g,o.b),f.setXYZ(25,o.r,o.g,o.b),f.setXYZ(26,o.r,o.g,o.b),f.setXYZ(27,o.r,o.g,o.b),f.setXYZ(28,o.r,o.g,o.b),f.setXYZ(29,o.r,o.g,o.b),f.setXYZ(30,o.r,o.g,o.b),f.setXYZ(31,o.r,o.g,o.b),f.setXYZ(32,u.r,u.g,u.b),f.setXYZ(33,u.r,u.g,u.b),f.setXYZ(34,u.r,u.g,u.b),f.setXYZ(35,u.r,u.g,u.b),f.setXYZ(36,u.r,u.g,u.b),f.setXYZ(37,u.r,u.g,u.b),f.setXYZ(38,d.r,d.g,d.b),f.setXYZ(39,d.r,d.g,d.b),f.setXYZ(40,C.r,C.g,C.b),f.setXYZ(41,C.r,C.g,C.b),f.setXYZ(42,C.r,C.g,C.b),f.setXYZ(43,C.r,C.g,C.b),f.setXYZ(44,C.r,C.g,C.b),f.setXYZ(45,C.r,C.g,C.b),f.setXYZ(46,C.r,C.g,C.b),f.setXYZ(47,C.r,C.g,C.b),f.setXYZ(48,C.r,C.g,C.b),f.setXYZ(49,C.r,C.g,C.b),f.needsUpdate=!0}update(){const t=this.geometry,o=this.pointMap,u=1,d=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const C=this.camera.coordinateSystem===WebGLCoordinateSystem?-1:0;setPoint("c",o,t,_camera,0,0,C),setPoint("t",o,t,_camera,0,0,1),setPoint("n1",o,t,_camera,-1,-1,C),setPoint("n2",o,t,_camera,u,-1,C),setPoint("n3",o,t,_camera,-1,d,C),setPoint("n4",o,t,_camera,u,d,C),setPoint("f1",o,t,_camera,-1,-1,1),setPoint("f2",o,t,_camera,u,-1,1),setPoint("f3",o,t,_camera,-1,d,1),setPoint("f4",o,t,_camera,u,d,1),setPoint("u1",o,t,_camera,u*.7,d*1.1,C),setPoint("u2",o,t,_camera,-1*.7,d*1.1,C),setPoint("u3",o,t,_camera,0,d*2,C),setPoint("cf1",o,t,_camera,-1,0,1),setPoint("cf2",o,t,_camera,u,0,1),setPoint("cf3",o,t,_camera,0,-1,1),setPoint("cf4",o,t,_camera,0,d,1),setPoint("cn1",o,t,_camera,-1,0,C),setPoint("cn2",o,t,_camera,u,0,C),setPoint("cn3",o,t,_camera,0,-1,C),setPoint("cn4",o,t,_camera,0,d,C),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(n,t,o,u,d,C,I){_vector.set(d,C,I).unproject(u);const f=t[n];if(f!==void 0){const A=o.getAttribute("position");for(let y=0,G=f.length;y<G;y++)A.setXYZ(f[y],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(t,o=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(8*3),C=new BufferGeometry;C.setIndex(new BufferAttribute(u,1)),C.setAttribute("position",new BufferAttribute(d,3)),super(C,new LineBasicMaterial({color:o,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const t=_box.min,o=_box.max,u=this.geometry.attributes.position,d=u.array;d[0]=o.x,d[1]=o.y,d[2]=o.z,d[3]=t.x,d[4]=o.y,d[5]=o.z,d[6]=t.x,d[7]=t.y,d[8]=o.z,d[9]=o.x,d[10]=t.y,d[11]=o.z,d[12]=o.x,d[13]=o.y,d[14]=t.z,d[15]=t.x,d[16]=o.y,d[17]=t.z,d[18]=t.x,d[19]=t.y,d[20]=t.z,d[21]=o.x,d[22]=t.y,d[23]=t.z,u.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,o){return super.copy(t,o),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(t,o=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],C=new BufferGeometry;C.setIndex(new BufferAttribute(u,1)),C.setAttribute("position",new Float32BufferAttribute(d,3)),super(C,new LineBasicMaterial({color:o,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const o=this.box;o.isEmpty()||(o.getCenter(this.position),o.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(t,o=1,u=16776960){const d=u,C=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],I=new BufferGeometry;I.setAttribute("position",new Float32BufferAttribute(C,3)),I.computeBoundingSphere(),super(I,new LineBasicMaterial({color:d,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=o;const f=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],A=new BufferGeometry;A.setAttribute("position",new Float32BufferAttribute(f,3)),A.computeBoundingSphere(),this.add(new Mesh(A,new MeshBasicMaterial({color:d,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(t=new Vector3(0,0,1),o=new Vector3(0,0,0),u=1,d=16776960,C=u*.2,I=C*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(o),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:d,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:d,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(u,C,I)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();const o=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,o)}}setLength(t,o=t*.2,u=o*.2){this.line.scale.set(1,Math.max(1e-4,t-o),1),this.line.updateMatrix(),this.cone.scale.set(u,o,u),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(t=1){const o=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],u=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],d=new BufferGeometry;d.setAttribute("position",new Float32BufferAttribute(o,3)),d.setAttribute("color",new Float32BufferAttribute(u,3));const C=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(d,C),this.type="AxesHelper"}setColors(t,o,u){const d=new Color,C=this.geometry.attributes.color.array;return d.set(t),d.toArray(C,0),d.toArray(C,3),d.set(o),d.toArray(C,6),d.toArray(C,9),d.set(u),d.toArray(C,12),d.toArray(C,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(t,o){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,o),this}lineTo(t,o){return this.currentPath.lineTo(t,o),this}quadraticCurveTo(t,o,u,d){return this.currentPath.quadraticCurveTo(t,o,u,d),this}bezierCurveTo(t,o,u,d,C,I){return this.currentPath.bezierCurveTo(t,o,u,d,C,I),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function o(J){const z=[];for(let L=0,K=J.length;L<K;L++){const O=J[L],Q=new Shape$2;Q.curves=O.curves,z.push(Q)}return z}function u(J,z){const L=z.length;let K=!1;for(let O=L-1,Q=0;Q<L;O=Q++){let ee=z[O],ie=z[Q],te=ie.x-ee.x,se=ie.y-ee.y;if(Math.abs(se)>Number.EPSILON){if(se<0&&(ee=z[Q],te=-te,ie=z[O],se=-se),J.y<ee.y||J.y>ie.y)continue;if(J.y===ee.y){if(J.x===ee.x)return!0}else{const ae=se*(J.x-ee.x)-te*(J.y-ee.y);if(ae===0)return!0;if(ae<0)continue;K=!K}}else{if(J.y!==ee.y)continue;if(ie.x<=J.x&&J.x<=ee.x||ee.x<=J.x&&J.x<=ie.x)return!0}}return K}const d=ShapeUtils.isClockWise,C=this.subPaths;if(C.length===0)return[];let I,f,A;const y=[];if(C.length===1)return f=C[0],A=new Shape$2,A.curves=f.curves,y.push(A),y;let G=!d(C[0].getPoints());G=t?!G:G;const S=[],w=[];let M=[],V=0,T;w[V]=void 0,M[V]=[];for(let J=0,z=C.length;J<z;J++)f=C[J],T=f.getPoints(),I=d(T),I=t?!I:I,I?(!G&&w[V]&&V++,w[V]={s:new Shape$2,p:T},w[V].s.curves=f.curves,G&&V++,M[V]=[]):M[V].push({h:f,p:T[0]});if(!w[0])return o(C);if(w.length>1){let J=!1,z=0;for(let L=0,K=w.length;L<K;L++)S[L]=[];for(let L=0,K=w.length;L<K;L++){const O=M[L];for(let Q=0;Q<O.length;Q++){const ee=O[Q];let ie=!0;for(let te=0;te<w.length;te++)u(ee.p,w[te].p)&&(L!==te&&z++,ie?(ie=!1,S[te].push(ee)):J=!0);ie&&S[L].push(ee)}}z>0&&J===!1&&(M=S)}let H;for(let J=0,z=w.length;J<z;J++){A=w[J].s,y.push(A),H=M[J];for(let L=0,K=H.length;L<K;L++)A.holes.push(H[L].h)}return y}}class Controls extends EventDispatcher$1{constructor(t,o=null){super(),this.object=t,this.domElement=o,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function contain(n,t){const o=n.image&&n.image.width?n.image.width/n.image.height:1;return o>t?(n.repeat.x=1,n.repeat.y=o/t,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=t/o,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function cover(n,t){const o=n.image&&n.image.width?n.image.width/n.image.height:1;return o>t?(n.repeat.x=t/o,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=o/t,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function fill(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function getByteLength(n,t,o,u){const d=getTextureTypeByteLength(u);switch(o){case AlphaFormat:return n*t;case LuminanceFormat:return n*t;case LuminanceAlphaFormat:return n*t*2;case RedFormat:return n*t/d.components*d.byteLength;case RedIntegerFormat:return n*t/d.components*d.byteLength;case RGFormat:return n*t*2/d.components*d.byteLength;case RGIntegerFormat:return n*t*2/d.components*d.byteLength;case RGBFormat:return n*t*3/d.components*d.byteLength;case RGBAFormat:return n*t*4/d.components*d.byteLength;case RGBAIntegerFormat:return n*t*4/d.components*d.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(n,16)*Math.max(t,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(n,8)*Math.max(t,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((n+4)/5)*Math.floor((t+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((n+4)/5)*Math.floor((t+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((n+5)/6)*Math.floor((t+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((n+5)/6)*Math.floor((t+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((n+7)/8)*Math.floor((t+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((n+7)/8)*Math.floor((t+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((n+7)/8)*Math.floor((t+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((n+9)/10)*Math.floor((t+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((n+9)/10)*Math.floor((t+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((n+9)/10)*Math.floor((t+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((n+9)/10)*Math.floor((t+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((n+11)/12)*Math.floor((t+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((n+11)/12)*Math.floor((t+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(n/4)*Math.ceil(t/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(n/4)*Math.ceil(t/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(n/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${o} format.`)}function getTextureTypeByteLength(n){switch(n){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class TextureUtils{static contain(t,o){return contain(t,o)}static cover(t,o){return cover(t,o)}static fill(t){return fill(t)}static getByteLength(t,o,u,d){return getByteLength(t,o,u,d)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function WebGLAnimation(){let n=null,t=!1,o=null,u=null;function d(C,I){o(C,I),u=n.requestAnimationFrame(d)}return{start:function(){t!==!0&&o!==null&&(u=n.requestAnimationFrame(d),t=!0)},stop:function(){n.cancelAnimationFrame(u),t=!1},setAnimationLoop:function(C){o=C},setContext:function(C){n=C}}}function WebGLAttributes(n){const t=new WeakMap;function o(f,A){const y=f.array,G=f.usage,S=y.byteLength,w=n.createBuffer();n.bindBuffer(A,w),n.bufferData(A,y,G),f.onUploadCallback();let M;if(y instanceof Float32Array)M=n.FLOAT;else if(y instanceof Uint16Array)f.isFloat16BufferAttribute?M=n.HALF_FLOAT:M=n.UNSIGNED_SHORT;else if(y instanceof Int16Array)M=n.SHORT;else if(y instanceof Uint32Array)M=n.UNSIGNED_INT;else if(y instanceof Int32Array)M=n.INT;else if(y instanceof Int8Array)M=n.BYTE;else if(y instanceof Uint8Array)M=n.UNSIGNED_BYTE;else if(y instanceof Uint8ClampedArray)M=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+y);return{buffer:w,type:M,bytesPerElement:y.BYTES_PER_ELEMENT,version:f.version,size:S}}function u(f,A,y){const G=A.array,S=A.updateRanges;if(n.bindBuffer(y,f),S.length===0)n.bufferSubData(y,0,G);else{S.sort((M,V)=>M.start-V.start);let w=0;for(let M=1;M<S.length;M++){const V=S[w],T=S[M];T.start<=V.start+V.count+1?V.count=Math.max(V.count,T.start+T.count-V.start):(++w,S[w]=T)}S.length=w+1;for(let M=0,V=S.length;M<V;M++){const T=S[M];n.bufferSubData(y,T.start*G.BYTES_PER_ELEMENT,G,T.start,T.count)}A.clearUpdateRanges()}A.onUploadCallback()}function d(f){return f.isInterleavedBufferAttribute&&(f=f.data),t.get(f)}function C(f){f.isInterleavedBufferAttribute&&(f=f.data);const A=t.get(f);A&&(n.deleteBuffer(A.buffer),t.delete(f))}function I(f,A){if(f.isInterleavedBufferAttribute&&(f=f.data),f.isGLBufferAttribute){const G=t.get(f);(!G||G.version<f.version)&&t.set(f,{buffer:f.buffer,type:f.type,bytesPerElement:f.elementSize,version:f.version});return}const y=t.get(f);if(y===void 0)t.set(f,o(f,A));else if(y.version<f.version){if(y.size!==f.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");u(y.buffer,f,A),y.version=f.version}}return{get:d,remove:C,update:I}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(n,t,o,u,d,C,I){const f=new Color(0);let A=C===!0?0:1,y,G,S=null,w=0,M=null;function V(L){let K=L.isScene===!0?L.background:null;return K&&K.isTexture&&(K=(L.backgroundBlurriness>0?o:t).get(K)),K}function T(L){let K=!1;const O=V(L);O===null?J(f,A):O&&O.isColor&&(J(O,1),K=!0);const Q=n.xr.getEnvironmentBlendMode();Q==="additive"?u.buffers.color.setClear(0,0,0,1,I):Q==="alpha-blend"&&u.buffers.color.setClear(0,0,0,0,I),(n.autoClear||K)&&(u.buffers.depth.setTest(!0),u.buffers.depth.setMask(!0),u.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function H(L,K){const O=V(K);O&&(O.isCubeTexture||O.mapping===CubeUVReflectionMapping)?(G===void 0&&(G=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function(Q,ee,ie){this.matrixWorld.copyPosition(ie.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(G)),_e1$1.copy(K.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,O.isCubeTexture&&O.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),G.material.uniforms.envMap.value=O,G.material.uniforms.flipEnvMap.value=O.isCubeTexture&&O.isRenderTargetTexture===!1?-1:1,G.material.uniforms.backgroundBlurriness.value=K.backgroundBlurriness,G.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,G.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),G.material.toneMapped=ColorManagement.getTransfer(O.colorSpace)!==SRGBTransfer,(S!==O||w!==O.version||M!==n.toneMapping)&&(G.material.needsUpdate=!0,S=O,w=O.version,M=n.toneMapping),G.layers.enableAll(),L.unshift(G,G.geometry,G.material,0,0,null)):O&&O.isTexture&&(y===void 0&&(y=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),y.geometry.deleteAttribute("normal"),Object.defineProperty(y.material,"map",{get:function(){return this.uniforms.t2D.value}}),d.update(y)),y.material.uniforms.t2D.value=O,y.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,y.material.toneMapped=ColorManagement.getTransfer(O.colorSpace)!==SRGBTransfer,O.matrixAutoUpdate===!0&&O.updateMatrix(),y.material.uniforms.uvTransform.value.copy(O.matrix),(S!==O||w!==O.version||M!==n.toneMapping)&&(y.material.needsUpdate=!0,S=O,w=O.version,M=n.toneMapping),y.layers.enableAll(),L.unshift(y,y.geometry,y.material,0,0,null))}function J(L,K){L.getRGB(_rgb,getUnlitUniformColorSpace(n)),u.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,K,I)}function z(){G!==void 0&&(G.geometry.dispose(),G.material.dispose(),G=void 0),y!==void 0&&(y.geometry.dispose(),y.material.dispose(),y=void 0)}return{getClearColor:function(){return f},setClearColor:function(L,K=1){f.set(L),A=K,J(f,A)},getClearAlpha:function(){return A},setClearAlpha:function(L){A=L,J(f,A)},render:T,addToRenderList:H,dispose:z}}function WebGLBindingStates(n,t){const o=n.getParameter(n.MAX_VERTEX_ATTRIBS),u={},d=w(null);let C=d,I=!1;function f(se,ae,le,ge,be){let Xe=!1;const Ce=S(ge,le,ae);C!==Ce&&(C=Ce,y(C.object)),Xe=M(se,ge,le,be),Xe&&V(se,ge,le,be),be!==null&&t.update(be,n.ELEMENT_ARRAY_BUFFER),(Xe||I)&&(I=!1,K(se,ae,le,ge),be!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(be).buffer))}function A(){return n.createVertexArray()}function y(se){return n.bindVertexArray(se)}function G(se){return n.deleteVertexArray(se)}function S(se,ae,le){const ge=le.wireframe===!0;let be=u[se.id];be===void 0&&(be={},u[se.id]=be);let Xe=be[ae.id];Xe===void 0&&(Xe={},be[ae.id]=Xe);let Ce=Xe[ge];return Ce===void 0&&(Ce=w(A()),Xe[ge]=Ce),Ce}function w(se){const ae=[],le=[],ge=[];for(let be=0;be<o;be++)ae[be]=0,le[be]=0,ge[be]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ae,enabledAttributes:le,attributeDivisors:ge,object:se,attributes:{},index:null}}function M(se,ae,le,ge){const be=C.attributes,Xe=ae.attributes;let Ce=0;const Re=le.getAttributes();for(const Se in Re)if(Re[Se].location>=0){const he=be[Se];let Ie=Xe[Se];if(Ie===void 0&&(Se==="instanceMatrix"&&se.instanceMatrix&&(Ie=se.instanceMatrix),Se==="instanceColor"&&se.instanceColor&&(Ie=se.instanceColor)),he===void 0||he.attribute!==Ie||Ie&&he.data!==Ie.data)return!0;Ce++}return C.attributesNum!==Ce||C.index!==ge}function V(se,ae,le,ge){const be={},Xe=ae.attributes;let Ce=0;const Re=le.getAttributes();for(const Se in Re)if(Re[Se].location>=0){let he=Xe[Se];he===void 0&&(Se==="instanceMatrix"&&se.instanceMatrix&&(he=se.instanceMatrix),Se==="instanceColor"&&se.instanceColor&&(he=se.instanceColor));const Ie={};Ie.attribute=he,he&&he.data&&(Ie.data=he.data),be[Se]=Ie,Ce++}C.attributes=be,C.attributesNum=Ce,C.index=ge}function T(){const se=C.newAttributes;for(let ae=0,le=se.length;ae<le;ae++)se[ae]=0}function H(se){J(se,0)}function J(se,ae){const le=C.newAttributes,ge=C.enabledAttributes,be=C.attributeDivisors;le[se]=1,ge[se]===0&&(n.enableVertexAttribArray(se),ge[se]=1),be[se]!==ae&&(n.vertexAttribDivisor(se,ae),be[se]=ae)}function z(){const se=C.newAttributes,ae=C.enabledAttributes;for(let le=0,ge=ae.length;le<ge;le++)ae[le]!==se[le]&&(n.disableVertexAttribArray(le),ae[le]=0)}function L(se,ae,le,ge,be,Xe,Ce){Ce===!0?n.vertexAttribIPointer(se,ae,le,be,Xe):n.vertexAttribPointer(se,ae,le,ge,be,Xe)}function K(se,ae,le,ge){T();const be=ge.attributes,Xe=le.getAttributes(),Ce=ae.defaultAttributeValues;for(const Re in Xe){const Se=Xe[Re];if(Se.location>=0){let Ze=be[Re];if(Ze===void 0&&(Re==="instanceMatrix"&&se.instanceMatrix&&(Ze=se.instanceMatrix),Re==="instanceColor"&&se.instanceColor&&(Ze=se.instanceColor)),Ze!==void 0){const he=Ze.normalized,Ie=Ze.itemSize,Be=t.get(Ze);if(Be===void 0)continue;const ue=Be.buffer,me=Be.type,xe=Be.bytesPerElement,Je=me===n.INT||me===n.UNSIGNED_INT||Ze.gpuType===IntType;if(Ze.isInterleavedBufferAttribute){const Ve=Ze.data,Ee=Ve.stride,Ct=Ze.offset;if(Ve.isInstancedInterleavedBuffer){for(let st=0;st<Se.locationSize;st++)J(Se.location+st,Ve.meshPerAttribute);se.isInstancedMesh!==!0&&ge._maxInstanceCount===void 0&&(ge._maxInstanceCount=Ve.meshPerAttribute*Ve.count)}else for(let st=0;st<Se.locationSize;st++)H(Se.location+st);n.bindBuffer(n.ARRAY_BUFFER,ue);for(let st=0;st<Se.locationSize;st++)L(Se.location+st,Ie/Se.locationSize,me,he,Ee*xe,(Ct+Ie/Se.locationSize*st)*xe,Je)}else{if(Ze.isInstancedBufferAttribute){for(let Ve=0;Ve<Se.locationSize;Ve++)J(Se.location+Ve,Ze.meshPerAttribute);se.isInstancedMesh!==!0&&ge._maxInstanceCount===void 0&&(ge._maxInstanceCount=Ze.meshPerAttribute*Ze.count)}else for(let Ve=0;Ve<Se.locationSize;Ve++)H(Se.location+Ve);n.bindBuffer(n.ARRAY_BUFFER,ue);for(let Ve=0;Ve<Se.locationSize;Ve++)L(Se.location+Ve,Ie/Se.locationSize,me,he,Ie*xe,Ie/Se.locationSize*Ve*xe,Je)}}else if(Ce!==void 0){const he=Ce[Re];if(he!==void 0)switch(he.length){case 2:n.vertexAttrib2fv(Se.location,he);break;case 3:n.vertexAttrib3fv(Se.location,he);break;case 4:n.vertexAttrib4fv(Se.location,he);break;default:n.vertexAttrib1fv(Se.location,he)}}}}z()}function O(){ie();for(const se in u){const ae=u[se];for(const le in ae){const ge=ae[le];for(const be in ge)G(ge[be].object),delete ge[be];delete ae[le]}delete u[se]}}function Q(se){if(u[se.id]===void 0)return;const ae=u[se.id];for(const le in ae){const ge=ae[le];for(const be in ge)G(ge[be].object),delete ge[be];delete ae[le]}delete u[se.id]}function ee(se){for(const ae in u){const le=u[ae];if(le[se.id]===void 0)continue;const ge=le[se.id];for(const be in ge)G(ge[be].object),delete ge[be];delete le[se.id]}}function ie(){te(),I=!0,C!==d&&(C=d,y(C.object))}function te(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:f,reset:ie,resetDefaultState:te,dispose:O,releaseStatesOfGeometry:Q,releaseStatesOfProgram:ee,initAttributes:T,enableAttribute:H,disableUnusedAttributes:z}}function WebGLBufferRenderer(n,t,o){let u;function d(y){u=y}function C(y,G){n.drawArrays(u,y,G),o.update(G,u,1)}function I(y,G,S){S!==0&&(n.drawArraysInstanced(u,y,G,S),o.update(G,u,S))}function f(y,G,S){if(S===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(u,y,0,G,0,S);let M=0;for(let V=0;V<S;V++)M+=G[V];o.update(M,u,1)}function A(y,G,S,w){if(S===0)return;const M=t.get("WEBGL_multi_draw");if(M===null)for(let V=0;V<y.length;V++)I(y[V],G[V],w[V]);else{M.multiDrawArraysInstancedWEBGL(u,y,0,G,0,w,0,S);let V=0;for(let T=0;T<S;T++)V+=G[T]*w[T];o.update(V,u,1)}}this.setMode=d,this.render=C,this.renderInstances=I,this.renderMultiDraw=f,this.renderMultiDrawInstances=A}function WebGLCapabilities(n,t,o,u){let d;function C(){if(d!==void 0)return d;if(t.has("EXT_texture_filter_anisotropic")===!0){const ee=t.get("EXT_texture_filter_anisotropic");d=n.getParameter(ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d}function I(ee){return!(ee!==RGBAFormat&&u.convert(ee)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function f(ee){const ie=ee===HalfFloatType&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(ee!==UnsignedByteType&&u.convert(ee)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&ee!==FloatType&&!ie)}function A(ee){if(ee==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";ee="mediump"}return ee==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let y=o.precision!==void 0?o.precision:"highp";const G=A(y);G!==y&&(console.warn("THREE.WebGLRenderer:",y,"not supported, using",G,"instead."),y=G);const S=o.logarithmicDepthBuffer===!0,w=o.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),M=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),V=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T=n.getParameter(n.MAX_TEXTURE_SIZE),H=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),J=n.getParameter(n.MAX_VERTEX_ATTRIBS),z=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),L=n.getParameter(n.MAX_VARYING_VECTORS),K=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),O=V>0,Q=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:C,getMaxPrecision:A,textureFormatReadable:I,textureTypeReadable:f,precision:y,logarithmicDepthBuffer:S,reverseDepthBuffer:w,maxTextures:M,maxVertexTextures:V,maxTextureSize:T,maxCubemapSize:H,maxAttributes:J,maxVertexUniforms:z,maxVaryings:L,maxFragmentUniforms:K,vertexTextures:O,maxSamples:Q}}function WebGLClipping(n){const t=this;let o=null,u=0,d=!1,C=!1;const I=new Plane,f=new Matrix3,A={value:null,needsUpdate:!1};this.uniform=A,this.numPlanes=0,this.numIntersection=0,this.init=function(S,w){const M=S.length!==0||w||u!==0||d;return d=w,u=S.length,M},this.beginShadows=function(){C=!0,G(null)},this.endShadows=function(){C=!1},this.setGlobalState=function(S,w){o=G(S,w,0)},this.setState=function(S,w,M){const V=S.clippingPlanes,T=S.clipIntersection,H=S.clipShadows,J=n.get(S);if(!d||V===null||V.length===0||C&&!H)C?G(null):y();else{const z=C?0:u,L=z*4;let K=J.clippingState||null;A.value=K,K=G(V,w,L,M);for(let O=0;O!==L;++O)K[O]=o[O];J.clippingState=K,this.numIntersection=T?this.numPlanes:0,this.numPlanes+=z}};function y(){A.value!==o&&(A.value=o,A.needsUpdate=u>0),t.numPlanes=u,t.numIntersection=0}function G(S,w,M,V){const T=S!==null?S.length:0;let H=null;if(T!==0){if(H=A.value,V!==!0||H===null){const J=M+T*4,z=w.matrixWorldInverse;f.getNormalMatrix(z),(H===null||H.length<J)&&(H=new Float32Array(J));for(let L=0,K=M;L!==T;++L,K+=4)I.copy(S[L]).applyMatrix4(z,f),I.normal.toArray(H,K),H[K+3]=I.constant}A.value=H,A.needsUpdate=!0}return t.numPlanes=T,t.numIntersection=0,H}}function WebGLCubeMaps(n){let t=new WeakMap;function o(I,f){return f===EquirectangularReflectionMapping?I.mapping=CubeReflectionMapping:f===EquirectangularRefractionMapping&&(I.mapping=CubeRefractionMapping),I}function u(I){if(I&&I.isTexture){const f=I.mapping;if(f===EquirectangularReflectionMapping||f===EquirectangularRefractionMapping)if(t.has(I)){const A=t.get(I).texture;return o(A,I.mapping)}else{const A=I.image;if(A&&A.height>0){const y=new WebGLCubeRenderTarget(A.height);return y.fromEquirectangularTexture(n,I),t.set(I,y),I.addEventListener("dispose",d),o(y.texture,I.mapping)}else return null}}return I}function d(I){const f=I.target;f.removeEventListener("dispose",d);const A=t.get(f);A!==void 0&&(t.delete(f),A.dispose())}function C(){t=new WeakMap}return{get:u,dispose:C}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1)],_origin=new Vector3;class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,o=0,u=.1,d=100,C={}){const{size:I=256,position:f=_origin}=C;_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(I);const A=this._allocateTargets();return A.depthBuffer=!0,this._sceneToCubeUV(t,u,d,A,f),o>0&&this._blur(A,0,0,o),this._applyPMREM(A),this._cleanup(A),A}fromEquirectangular(t,o=null){return this._fromTexture(t,o)}fromCubemap(t,o=null){return this._fromTexture(t,o)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t,o){t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const u=o||this._allocateTargets();return this._textureToCubeUV(t,u),this._applyPMREM(u),this._cleanup(u),u}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),o=4*this._cubeSize,u={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},d=_createRenderTarget(t,o,u);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(t,o,u);const{_lodMax:C}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(C)),this._blurMaterial=_getBlurShader(C,t,o)}return d}_compileMaterial(t){const o=new Mesh(this._lodPlanes[0],t);this._renderer.compile(o,_flatCamera)}_sceneToCubeUV(t,o,u,d,C){const A=new PerspectiveCamera(90,1,o,u),y=[1,-1,1,1,1,1],G=[1,1,1,-1,-1,-1],S=this._renderer,w=S.autoClear,M=S.toneMapping;S.getClearColor(_clearColor),S.toneMapping=NoToneMapping,S.autoClear=!1;const V=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),T=new Mesh(new BoxGeometry,V);let H=!1;const J=t.background;J?J.isColor&&(V.color.copy(J),t.background=null,H=!0):(V.color.copy(_clearColor),H=!0);for(let z=0;z<6;z++){const L=z%3;L===0?(A.up.set(0,y[z],0),A.position.set(C.x,C.y,C.z),A.lookAt(C.x+G[z],C.y,C.z)):L===1?(A.up.set(0,0,y[z]),A.position.set(C.x,C.y,C.z),A.lookAt(C.x,C.y+G[z],C.z)):(A.up.set(0,y[z],0),A.position.set(C.x,C.y,C.z),A.lookAt(C.x,C.y,C.z+G[z]));const K=this._cubeSize;_setViewport(d,L*K,z>2?K:0,K,K),S.setRenderTarget(d),H&&S.render(T,A),S.render(t,A)}T.geometry.dispose(),T.material.dispose(),S.toneMapping=M,S.autoClear=w,t.background=J}_textureToCubeUV(t,o){const u=this._renderer,d=t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping;d?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const C=d?this._cubemapMaterial:this._equirectMaterial,I=new Mesh(this._lodPlanes[0],C),f=C.uniforms;f.envMap.value=t;const A=this._cubeSize;_setViewport(o,0,0,3*A,2*A),u.setRenderTarget(o),u.render(I,_flatCamera)}_applyPMREM(t){const o=this._renderer,u=o.autoClear;o.autoClear=!1;const d=this._lodPlanes.length;for(let C=1;C<d;C++){const I=Math.sqrt(this._sigmas[C]*this._sigmas[C]-this._sigmas[C-1]*this._sigmas[C-1]),f=_axisDirections[(d-C-1)%_axisDirections.length];this._blur(t,C-1,C,I,f)}o.autoClear=u}_blur(t,o,u,d,C){const I=this._pingPongRenderTarget;this._halfBlur(t,I,o,u,d,"latitudinal",C),this._halfBlur(I,t,u,u,d,"longitudinal",C)}_halfBlur(t,o,u,d,C,I,f){const A=this._renderer,y=this._blurMaterial;I!=="latitudinal"&&I!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const G=3,S=new Mesh(this._lodPlanes[d],y),w=y.uniforms,M=this._sizeLods[u]-1,V=isFinite(C)?Math.PI/(2*M):2*Math.PI/(2*MAX_SAMPLES-1),T=C/V,H=isFinite(C)?1+Math.floor(G*T):MAX_SAMPLES;H>MAX_SAMPLES&&console.warn(`sigmaRadians, ${C}, is too large and will clip, as it requested ${H} samples when the maximum is set to ${MAX_SAMPLES}`);const J=[];let z=0;for(let ee=0;ee<MAX_SAMPLES;++ee){const ie=ee/T,te=Math.exp(-ie*ie/2);J.push(te),ee===0?z+=te:ee<H&&(z+=2*te)}for(let ee=0;ee<J.length;ee++)J[ee]=J[ee]/z;w.envMap.value=t.texture,w.samples.value=H,w.weights.value=J,w.latitudinal.value=I==="latitudinal",f&&(w.poleAxis.value=f);const{_lodMax:L}=this;w.dTheta.value=V,w.mipInt.value=L-u;const K=this._sizeLods[d],O=3*K*(d>L-LOD_MIN?d-L+LOD_MIN:0),Q=4*(this._cubeSize-K);_setViewport(o,O,Q,3*K,2*K),A.setRenderTarget(o),A.render(S,_flatCamera)}}function _createPlanes(n){const t=[],o=[],u=[];let d=n;const C=n-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let I=0;I<C;I++){const f=Math.pow(2,d);o.push(f);let A=1/f;I>n-LOD_MIN?A=EXTRA_LOD_SIGMA[I-n+LOD_MIN-1]:I===0&&(A=0),u.push(A);const y=1/(f-2),G=-y,S=1+y,w=[G,G,S,G,S,S,G,G,S,S,G,S],M=6,V=6,T=3,H=2,J=1,z=new Float32Array(T*V*M),L=new Float32Array(H*V*M),K=new Float32Array(J*V*M);for(let Q=0;Q<M;Q++){const ee=Q%3*2/3-1,ie=Q>2?0:-1,te=[ee,ie,0,ee+2/3,ie,0,ee+2/3,ie+1,0,ee,ie,0,ee+2/3,ie+1,0,ee,ie+1,0];z.set(te,T*V*Q),L.set(w,H*V*Q);const se=[Q,Q,Q,Q,Q,Q];K.set(se,J*V*Q)}const O=new BufferGeometry;O.setAttribute("position",new BufferAttribute(z,T)),O.setAttribute("uv",new BufferAttribute(L,H)),O.setAttribute("faceIndex",new BufferAttribute(K,J)),t.push(O),d>LOD_MIN&&d--}return{lodPlanes:t,sizeLods:o,sigmas:u}}function _createRenderTarget(n,t,o){const u=new WebGLRenderTarget(n,t,o);return u.texture.mapping=CubeUVReflectionMapping,u.texture.name="PMREM.cubeUv",u.scissorTest=!0,u}function _setViewport(n,t,o,u,d){n.viewport.set(t,o,u,d),n.scissor.set(t,o,u,d)}function _getBlurShader(n,t,o){const u=new Float32Array(MAX_SAMPLES),d=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/o,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:u},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:d}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(n){let t=new WeakMap,o=null;function u(f){if(f&&f.isTexture){const A=f.mapping,y=A===EquirectangularReflectionMapping||A===EquirectangularRefractionMapping,G=A===CubeReflectionMapping||A===CubeRefractionMapping;if(y||G){let S=t.get(f);const w=S!==void 0?S.texture.pmremVersion:0;if(f.isRenderTargetTexture&&f.pmremVersion!==w)return o===null&&(o=new PMREMGenerator(n)),S=y?o.fromEquirectangular(f,S):o.fromCubemap(f,S),S.texture.pmremVersion=f.pmremVersion,t.set(f,S),S.texture;if(S!==void 0)return S.texture;{const M=f.image;return y&&M&&M.height>0||G&&M&&d(M)?(o===null&&(o=new PMREMGenerator(n)),S=y?o.fromEquirectangular(f):o.fromCubemap(f),S.texture.pmremVersion=f.pmremVersion,t.set(f,S),f.addEventListener("dispose",C),S.texture):null}}}return f}function d(f){let A=0;const y=6;for(let G=0;G<y;G++)f[G]!==void 0&&A++;return A===y}function C(f){const A=f.target;A.removeEventListener("dispose",C);const y=t.get(A);y!==void 0&&(t.delete(A),y.dispose())}function I(){t=new WeakMap,o!==null&&(o.dispose(),o=null)}return{get:u,dispose:I}}function WebGLExtensions(n){const t={};function o(u){if(t[u]!==void 0)return t[u];let d;switch(u){case"WEBGL_depth_texture":d=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=n.getExtension(u)}return t[u]=d,d}return{has:function(u){return o(u)!==null},init:function(){o("EXT_color_buffer_float"),o("WEBGL_clip_cull_distance"),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float"),o("WEBGL_multisampled_render_to_texture"),o("WEBGL_render_shared_exponent")},get:function(u){const d=o(u);return d===null&&warnOnce("THREE.WebGLRenderer: "+u+" extension not supported."),d}}}function WebGLGeometries(n,t,o,u){const d={},C=new WeakMap;function I(S){const w=S.target;w.index!==null&&t.remove(w.index);for(const V in w.attributes)t.remove(w.attributes[V]);w.removeEventListener("dispose",I),delete d[w.id];const M=C.get(w);M&&(t.remove(M),C.delete(w)),u.releaseStatesOfGeometry(w),w.isInstancedBufferGeometry===!0&&delete w._maxInstanceCount,o.memory.geometries--}function f(S,w){return d[w.id]===!0||(w.addEventListener("dispose",I),d[w.id]=!0,o.memory.geometries++),w}function A(S){const w=S.attributes;for(const M in w)t.update(w[M],n.ARRAY_BUFFER)}function y(S){const w=[],M=S.index,V=S.attributes.position;let T=0;if(M!==null){const z=M.array;T=M.version;for(let L=0,K=z.length;L<K;L+=3){const O=z[L+0],Q=z[L+1],ee=z[L+2];w.push(O,Q,Q,ee,ee,O)}}else if(V!==void 0){const z=V.array;T=V.version;for(let L=0,K=z.length/3-1;L<K;L+=3){const O=L+0,Q=L+1,ee=L+2;w.push(O,Q,Q,ee,ee,O)}}else return;const H=new(arrayNeedsUint32(w)?Uint32BufferAttribute:Uint16BufferAttribute)(w,1);H.version=T;const J=C.get(S);J&&t.remove(J),C.set(S,H)}function G(S){const w=C.get(S);if(w){const M=S.index;M!==null&&w.version<M.version&&y(S)}else y(S);return C.get(S)}return{get:f,update:A,getWireframeAttribute:G}}function WebGLIndexedBufferRenderer(n,t,o){let u;function d(w){u=w}let C,I;function f(w){C=w.type,I=w.bytesPerElement}function A(w,M){n.drawElements(u,M,C,w*I),o.update(M,u,1)}function y(w,M,V){V!==0&&(n.drawElementsInstanced(u,M,C,w*I,V),o.update(M,u,V))}function G(w,M,V){if(V===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(u,M,0,C,w,0,V);let H=0;for(let J=0;J<V;J++)H+=M[J];o.update(H,u,1)}function S(w,M,V,T){if(V===0)return;const H=t.get("WEBGL_multi_draw");if(H===null)for(let J=0;J<w.length;J++)y(w[J]/I,M[J],T[J]);else{H.multiDrawElementsInstancedWEBGL(u,M,0,C,w,0,T,0,V);let J=0;for(let z=0;z<V;z++)J+=M[z]*T[z];o.update(J,u,1)}}this.setMode=d,this.setIndex=f,this.render=A,this.renderInstances=y,this.renderMultiDraw=G,this.renderMultiDrawInstances=S}function WebGLInfo(n){const t={geometries:0,textures:0},o={frame:0,calls:0,triangles:0,points:0,lines:0};function u(C,I,f){switch(o.calls++,I){case n.TRIANGLES:o.triangles+=f*(C/3);break;case n.LINES:o.lines+=f*(C/2);break;case n.LINE_STRIP:o.lines+=f*(C-1);break;case n.LINE_LOOP:o.lines+=f*C;break;case n.POINTS:o.points+=f*C;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",I);break}}function d(){o.calls=0,o.triangles=0,o.points=0,o.lines=0}return{memory:t,render:o,programs:null,autoReset:!0,reset:d,update:u}}function WebGLMorphtargets(n,t,o){const u=new WeakMap,d=new Vector4;function C(I,f,A){const y=I.morphTargetInfluences,G=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,S=G!==void 0?G.length:0;let w=u.get(f);if(w===void 0||w.count!==S){let se=function(){ie.dispose(),u.delete(f),f.removeEventListener("dispose",se)};var M=se;w!==void 0&&w.texture.dispose();const V=f.morphAttributes.position!==void 0,T=f.morphAttributes.normal!==void 0,H=f.morphAttributes.color!==void 0,J=f.morphAttributes.position||[],z=f.morphAttributes.normal||[],L=f.morphAttributes.color||[];let K=0;V===!0&&(K=1),T===!0&&(K=2),H===!0&&(K=3);let O=f.attributes.position.count*K,Q=1;O>t.maxTextureSize&&(Q=Math.ceil(O/t.maxTextureSize),O=t.maxTextureSize);const ee=new Float32Array(O*Q*4*S),ie=new DataArrayTexture(ee,O,Q,S);ie.type=FloatType,ie.needsUpdate=!0;const te=K*4;for(let ae=0;ae<S;ae++){const le=J[ae],ge=z[ae],be=L[ae],Xe=O*Q*4*ae;for(let Ce=0;Ce<le.count;Ce++){const Re=Ce*te;V===!0&&(d.fromBufferAttribute(le,Ce),ee[Xe+Re+0]=d.x,ee[Xe+Re+1]=d.y,ee[Xe+Re+2]=d.z,ee[Xe+Re+3]=0),T===!0&&(d.fromBufferAttribute(ge,Ce),ee[Xe+Re+4]=d.x,ee[Xe+Re+5]=d.y,ee[Xe+Re+6]=d.z,ee[Xe+Re+7]=0),H===!0&&(d.fromBufferAttribute(be,Ce),ee[Xe+Re+8]=d.x,ee[Xe+Re+9]=d.y,ee[Xe+Re+10]=d.z,ee[Xe+Re+11]=be.itemSize===4?d.w:1)}}w={count:S,texture:ie,size:new Vector2(O,Q)},u.set(f,w),f.addEventListener("dispose",se)}if(I.isInstancedMesh===!0&&I.morphTexture!==null)A.getUniforms().setValue(n,"morphTexture",I.morphTexture,o);else{let V=0;for(let H=0;H<y.length;H++)V+=y[H];const T=f.morphTargetsRelative?1:1-V;A.getUniforms().setValue(n,"morphTargetBaseInfluence",T),A.getUniforms().setValue(n,"morphTargetInfluences",y)}A.getUniforms().setValue(n,"morphTargetsTexture",w.texture,o),A.getUniforms().setValue(n,"morphTargetsTextureSize",w.size)}return{update:C}}function WebGLObjects(n,t,o,u){let d=new WeakMap;function C(A){const y=u.render.frame,G=A.geometry,S=t.get(A,G);if(d.get(S)!==y&&(t.update(S),d.set(S,y)),A.isInstancedMesh&&(A.hasEventListener("dispose",f)===!1&&A.addEventListener("dispose",f),d.get(A)!==y&&(o.update(A.instanceMatrix,n.ARRAY_BUFFER),A.instanceColor!==null&&o.update(A.instanceColor,n.ARRAY_BUFFER),d.set(A,y))),A.isSkinnedMesh){const w=A.skeleton;d.get(w)!==y&&(w.update(),d.set(w,y))}return S}function I(){d=new WeakMap}function f(A){const y=A.target;y.removeEventListener("dispose",f),o.remove(y.instanceMatrix),y.instanceColor!==null&&o.remove(y.instanceColor)}return{update:C,dispose:I}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(n,t,o){const u=n[0];if(u<=0||u>0)return n;const d=t*o;let C=arrayCacheF32[d];if(C===void 0&&(C=new Float32Array(d),arrayCacheF32[d]=C),t!==0){u.toArray(C,0);for(let I=1,f=0;I!==t;++I)f+=o,n[I].toArray(C,f)}return C}function arraysEqual(n,t){if(n.length!==t.length)return!1;for(let o=0,u=n.length;o<u;o++)if(n[o]!==t[o])return!1;return!0}function copyArray(n,t){for(let o=0,u=t.length;o<u;o++)n[o]=t[o]}function allocTexUnits(n,t){let o=arrayCacheI32[t];o===void 0&&(o=new Int32Array(t),arrayCacheI32[t]=o);for(let u=0;u!==t;++u)o[u]=n.allocateTextureUnit();return o}function setValueV1f(n,t){const o=this.cache;o[0]!==t&&(n.uniform1f(this.addr,t),o[0]=t)}function setValueV2f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2fv(this.addr,t),copyArray(o,t)}}function setValueV3f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else if(t.r!==void 0)(o[0]!==t.r||o[1]!==t.g||o[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),o[0]=t.r,o[1]=t.g,o[2]=t.b);else{if(arraysEqual(o,t))return;n.uniform3fv(this.addr,t),copyArray(o,t)}}function setValueV4f(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4fv(this.addr,t),copyArray(o,t)}}function setValueM2(n,t){const o=this.cache,u=t.elements;if(u===void 0){if(arraysEqual(o,t))return;n.uniformMatrix2fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,u))return;mat2array.set(u),n.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(o,u)}}function setValueM3(n,t){const o=this.cache,u=t.elements;if(u===void 0){if(arraysEqual(o,t))return;n.uniformMatrix3fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,u))return;mat3array.set(u),n.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(o,u)}}function setValueM4(n,t){const o=this.cache,u=t.elements;if(u===void 0){if(arraysEqual(o,t))return;n.uniformMatrix4fv(this.addr,!1,t),copyArray(o,t)}else{if(arraysEqual(o,u))return;mat4array.set(u),n.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(o,u)}}function setValueV1i(n,t){const o=this.cache;o[0]!==t&&(n.uniform1i(this.addr,t),o[0]=t)}function setValueV2i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2iv(this.addr,t),copyArray(o,t)}}function setValueV3i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else{if(arraysEqual(o,t))return;n.uniform3iv(this.addr,t),copyArray(o,t)}}function setValueV4i(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4iv(this.addr,t),copyArray(o,t)}}function setValueV1ui(n,t){const o=this.cache;o[0]!==t&&(n.uniform1ui(this.addr,t),o[0]=t)}function setValueV2ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),o[0]=t.x,o[1]=t.y);else{if(arraysEqual(o,t))return;n.uniform2uiv(this.addr,t),copyArray(o,t)}}function setValueV3ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),o[0]=t.x,o[1]=t.y,o[2]=t.z);else{if(arraysEqual(o,t))return;n.uniform3uiv(this.addr,t),copyArray(o,t)}}function setValueV4ui(n,t){const o=this.cache;if(t.x!==void 0)(o[0]!==t.x||o[1]!==t.y||o[2]!==t.z||o[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=t.w);else{if(arraysEqual(o,t))return;n.uniform4uiv(this.addr,t),copyArray(o,t)}}function setValueT1(n,t,o){const u=this.cache,d=o.allocateTextureUnit();u[0]!==d&&(n.uniform1i(this.addr,d),u[0]=d);let C;this.type===n.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,C=emptyShadowTexture):C=emptyTexture,o.setTexture2D(t||C,d)}function setValueT3D1(n,t,o){const u=this.cache,d=o.allocateTextureUnit();u[0]!==d&&(n.uniform1i(this.addr,d),u[0]=d),o.setTexture3D(t||empty3dTexture,d)}function setValueT6(n,t,o){const u=this.cache,d=o.allocateTextureUnit();u[0]!==d&&(n.uniform1i(this.addr,d),u[0]=d),o.setTextureCube(t||emptyCubeTexture,d)}function setValueT2DArray1(n,t,o){const u=this.cache,d=o.allocateTextureUnit();u[0]!==d&&(n.uniform1i(this.addr,d),u[0]=d),o.setTexture2DArray(t||emptyArrayTexture,d)}function getSingularSetter(n){switch(n){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(n,t){n.uniform1fv(this.addr,t)}function setValueV2fArray(n,t){const o=flatten(t,this.size,2);n.uniform2fv(this.addr,o)}function setValueV3fArray(n,t){const o=flatten(t,this.size,3);n.uniform3fv(this.addr,o)}function setValueV4fArray(n,t){const o=flatten(t,this.size,4);n.uniform4fv(this.addr,o)}function setValueM2Array(n,t){const o=flatten(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,o)}function setValueM3Array(n,t){const o=flatten(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,o)}function setValueM4Array(n,t){const o=flatten(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,o)}function setValueV1iArray(n,t){n.uniform1iv(this.addr,t)}function setValueV2iArray(n,t){n.uniform2iv(this.addr,t)}function setValueV3iArray(n,t){n.uniform3iv(this.addr,t)}function setValueV4iArray(n,t){n.uniform4iv(this.addr,t)}function setValueV1uiArray(n,t){n.uniform1uiv(this.addr,t)}function setValueV2uiArray(n,t){n.uniform2uiv(this.addr,t)}function setValueV3uiArray(n,t){n.uniform3uiv(this.addr,t)}function setValueV4uiArray(n,t){n.uniform4uiv(this.addr,t)}function setValueT1Array(n,t,o){const u=this.cache,d=t.length,C=allocTexUnits(o,d);arraysEqual(u,C)||(n.uniform1iv(this.addr,C),copyArray(u,C));for(let I=0;I!==d;++I)o.setTexture2D(t[I]||emptyTexture,C[I])}function setValueT3DArray(n,t,o){const u=this.cache,d=t.length,C=allocTexUnits(o,d);arraysEqual(u,C)||(n.uniform1iv(this.addr,C),copyArray(u,C));for(let I=0;I!==d;++I)o.setTexture3D(t[I]||empty3dTexture,C[I])}function setValueT6Array(n,t,o){const u=this.cache,d=t.length,C=allocTexUnits(o,d);arraysEqual(u,C)||(n.uniform1iv(this.addr,C),copyArray(u,C));for(let I=0;I!==d;++I)o.setTextureCube(t[I]||emptyCubeTexture,C[I])}function setValueT2DArrayArray(n,t,o){const u=this.cache,d=t.length,C=allocTexUnits(o,d);arraysEqual(u,C)||(n.uniform1iv(this.addr,C),copyArray(u,C));for(let I=0;I!==d;++I)o.setTexture2DArray(t[I]||emptyArrayTexture,C[I])}function getPureArraySetter(n){switch(n){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(t,o,u){this.id=t,this.addr=u,this.cache=[],this.type=o.type,this.setValue=getSingularSetter(o.type)}}class PureArrayUniform{constructor(t,o,u){this.id=t,this.addr=u,this.cache=[],this.type=o.type,this.size=o.size,this.setValue=getPureArraySetter(o.type)}}class StructuredUniform{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,o,u){const d=this.seq;for(let C=0,I=d.length;C!==I;++C){const f=d[C];f.setValue(t,o[f.id],u)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(n,t){n.seq.push(t),n.map[t.id]=t}function parseUniform(n,t,o){const u=n.name,d=u.length;for(RePathPart.lastIndex=0;;){const C=RePathPart.exec(u),I=RePathPart.lastIndex;let f=C[1];const A=C[2]==="]",y=C[3];if(A&&(f=f|0),y===void 0||y==="["&&I+2===d){addUniform(o,y===void 0?new SingleUniform(f,n,t):new PureArrayUniform(f,n,t));break}else{let S=o.map[f];S===void 0&&(S=new StructuredUniform(f),addUniform(o,S)),o=S}}}class WebGLUniforms{constructor(t,o){this.seq=[],this.map={};const u=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let d=0;d<u;++d){const C=t.getActiveUniform(o,d),I=t.getUniformLocation(o,C.name);parseUniform(C,I,this)}}setValue(t,o,u,d){const C=this.map[o];C!==void 0&&C.setValue(t,u,d)}setOptional(t,o,u){const d=o[u];d!==void 0&&this.setValue(t,u,d)}static upload(t,o,u,d){for(let C=0,I=o.length;C!==I;++C){const f=o[C],A=u[f.id];A.needsUpdate!==!1&&f.setValue(t,A.value,d)}}static seqWithValue(t,o){const u=[];for(let d=0,C=t.length;d!==C;++d){const I=t[d];I.id in o&&u.push(I)}return u}}function WebGLShader(n,t,o){const u=n.createShader(t);return n.shaderSource(u,o),n.compileShader(u),u}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(n,t){const o=n.split(`
`),u=[],d=Math.max(t-6,0),C=Math.min(t+6,o.length);for(let I=d;I<C;I++){const f=I+1;u.push(`${f===t?">":" "} ${f}: ${o[I]}`)}return u.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(n){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,n);const t=`mat3( ${_m0.elements.map(o=>o.toFixed(4))} )`;switch(ColorManagement.getTransfer(n)){case LinearTransfer:return[t,"LinearTransferOETF"];case SRGBTransfer:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[t,"LinearTransferOETF"]}}function getShaderErrors(n,t,o){const u=n.getShaderParameter(t,n.COMPILE_STATUS),d=n.getShaderInfoLog(t).trim();if(u&&d==="")return"";const C=/ERROR: 0:(\d+)/.exec(d);if(C){const I=parseInt(C[1]);return o.toUpperCase()+`

`+d+`

`+handleSource(n.getShaderSource(t),I)}else return d}function getTexelEncodingFunction(n,t){const o=getEncodingComponents(t);return[`vec4 ${n}( vec4 value ) {`,`	return ${o[1]}( vec4( value.rgb * ${o[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(n,t){let o;switch(t){case LinearToneMapping:o="Linear";break;case ReinhardToneMapping:o="Reinhard";break;case CineonToneMapping:o="Cineon";break;case ACESFilmicToneMapping:o="ACESFilmic";break;case AgXToneMapping:o="AgX";break;case NeutralToneMapping:o="Neutral";break;case CustomToneMapping:o="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),o="Linear"}return"vec3 "+n+"( vec3 color ) { return "+o+"ToneMapping( color ); }"}const _v0=new Vector3;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0);const n=_v0.x.toFixed(4),t=_v0.y.toFixed(4),o=_v0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${t}, ${o} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(n){const t=[];for(const o in n){const u=n[o];u!==!1&&t.push("#define "+o+" "+u)}return t.join(`
`)}function fetchAttributeLocations(n,t){const o={},u=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let d=0;d<u;d++){const C=n.getActiveAttrib(t,d),I=C.name;let f=1;C.type===n.FLOAT_MAT2&&(f=2),C.type===n.FLOAT_MAT3&&(f=3),C.type===n.FLOAT_MAT4&&(f=4),o[I]={type:C.type,location:n.getAttribLocation(t,I),locationSize:f}}return o}function filterEmptyLine(n){return n!==""}function replaceLightNums(n,t){const o=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,o).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(n){return n.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(n,t){let o=ShaderChunk[t];if(o===void 0){const u=shaderChunkMap.get(t);if(u!==void 0)o=ShaderChunk[u],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,u);else throw new Error("Can not resolve #include <"+t+">")}return resolveIncludes(o)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(n){return n.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(n,t,o,u){let d="";for(let C=parseInt(t);C<parseInt(o);C++)d+=u.replace(/\[\s*i\s*\]/g,"[ "+C+" ]").replace(/UNROLLED_LOOP_INDEX/g,C);return d}function generatePrecision(n){let t=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?t+=`
#define HIGH_PRECISION`:n.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function generateShadowMapTypeDefine(n){let t="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":n.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:t="ENVMAP_TYPE_CUBE_UV";break}return t}function generateEnvMapModeDefine(n){let t="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case CubeRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}return t}function generateEnvMapBlendingDefine(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}return t}function generateCubeUVSize(n){const t=n.envMapCubeUVHeight;if(t===null)return null;const o=Math.log2(t)-2,u=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,o),7*16)),texelHeight:u,maxMip:o}}function WebGLProgram(n,t,o,u){const d=n.getContext(),C=o.defines;let I=o.vertexShader,f=o.fragmentShader;const A=generateShadowMapTypeDefine(o),y=generateEnvMapTypeDefine(o),G=generateEnvMapModeDefine(o),S=generateEnvMapBlendingDefine(o),w=generateCubeUVSize(o),M=generateVertexExtensions(o),V=generateDefines(C),T=d.createProgram();let H,J,z=o.glslVersion?"#version "+o.glslVersion+`
`:"";o.isRawShaderMaterial?(H=["#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V].filter(filterEmptyLine).join(`
`),H.length>0&&(H+=`
`),J=["#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V].filter(filterEmptyLine).join(`
`),J.length>0&&(J+=`
`)):(H=[generatePrecision(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V,o.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",o.batching?"#define USE_BATCHING":"",o.batchingColor?"#define USE_BATCHING_COLOR":"",o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.instancingMorph?"#define USE_INSTANCING_MORPH":"",o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+G:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",o.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",o.displacementMap?"#define USE_DISPLACEMENTMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.anisotropy?"#define USE_ANISOTROPY":"",o.anisotropyMap?"#define USE_ANISOTROPYMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",o.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",o.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.alphaHash?"#define USE_ALPHAHASH":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",o.mapUv?"#define MAP_UV "+o.mapUv:"",o.alphaMapUv?"#define ALPHAMAP_UV "+o.alphaMapUv:"",o.lightMapUv?"#define LIGHTMAP_UV "+o.lightMapUv:"",o.aoMapUv?"#define AOMAP_UV "+o.aoMapUv:"",o.emissiveMapUv?"#define EMISSIVEMAP_UV "+o.emissiveMapUv:"",o.bumpMapUv?"#define BUMPMAP_UV "+o.bumpMapUv:"",o.normalMapUv?"#define NORMALMAP_UV "+o.normalMapUv:"",o.displacementMapUv?"#define DISPLACEMENTMAP_UV "+o.displacementMapUv:"",o.metalnessMapUv?"#define METALNESSMAP_UV "+o.metalnessMapUv:"",o.roughnessMapUv?"#define ROUGHNESSMAP_UV "+o.roughnessMapUv:"",o.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+o.anisotropyMapUv:"",o.clearcoatMapUv?"#define CLEARCOATMAP_UV "+o.clearcoatMapUv:"",o.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+o.clearcoatNormalMapUv:"",o.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+o.clearcoatRoughnessMapUv:"",o.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+o.iridescenceMapUv:"",o.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+o.iridescenceThicknessMapUv:"",o.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+o.sheenColorMapUv:"",o.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+o.sheenRoughnessMapUv:"",o.specularMapUv?"#define SPECULARMAP_UV "+o.specularMapUv:"",o.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+o.specularColorMapUv:"",o.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+o.specularIntensityMapUv:"",o.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+o.transmissionMapUv:"",o.thicknessMapUv?"#define THICKNESSMAP_UV "+o.thicknessMapUv:"",o.vertexTangents&&o.flatShading===!1?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.pointsUvs?"#define USE_POINTS_UV":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&o.flatShading===!1?"#define USE_MORPHNORMALS":"",o.morphColors?"#define USE_MORPHCOLORS":"",o.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+o.morphTextureStride:"",o.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+o.morphTargetsCount:"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+A:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.numLightProbes>0?"#define USE_LIGHT_PROBES":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),J=[generatePrecision(o),"#define SHADER_TYPE "+o.shaderType,"#define SHADER_NAME "+o.shaderName,V,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+y:"",o.envMap?"#define "+G:"",o.envMap?"#define "+S:"",w?"#define CUBEUV_TEXEL_WIDTH "+w.texelWidth:"",w?"#define CUBEUV_TEXEL_HEIGHT "+w.texelHeight:"",w?"#define CUBEUV_MAX_MIP "+w.maxMip+".0":"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",o.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.anisotropy?"#define USE_ANISOTROPY":"",o.anisotropyMap?"#define USE_ANISOTROPYMAP":"",o.clearcoat?"#define USE_CLEARCOAT":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.dispersion?"#define USE_DISPERSION":"",o.iridescence?"#define USE_IRIDESCENCE":"",o.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",o.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",o.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.alphaTest?"#define USE_ALPHATEST":"",o.alphaHash?"#define USE_ALPHAHASH":"",o.sheen?"#define USE_SHEEN":"",o.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.vertexTangents&&o.flatShading===!1?"#define USE_TANGENT":"",o.vertexColors||o.instancingColor||o.batchingColor?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUv1s?"#define USE_UV1":"",o.vertexUv2s?"#define USE_UV2":"",o.vertexUv3s?"#define USE_UV3":"",o.pointsUvs?"#define USE_POINTS_UV":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+A:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.numLightProbes>0?"#define USE_LIGHT_PROBES":"",o.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",o.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",o.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",o.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",o.outputColorSpace),getLuminanceFunction(),o.useDepthPacking?"#define DEPTH_PACKING "+o.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),I=resolveIncludes(I),I=replaceLightNums(I,o),I=replaceClippingPlaneNums(I,o),f=resolveIncludes(f),f=replaceLightNums(f,o),f=replaceClippingPlaneNums(f,o),I=unrollLoops(I),f=unrollLoops(f),o.isRawShaderMaterial!==!0&&(z=`#version 300 es
`,H=[M,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+H,J=["#define varying in",o.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",o.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+J);const L=z+H+I,K=z+J+f,O=WebGLShader(d,d.VERTEX_SHADER,L),Q=WebGLShader(d,d.FRAGMENT_SHADER,K);d.attachShader(T,O),d.attachShader(T,Q),o.index0AttributeName!==void 0?d.bindAttribLocation(T,0,o.index0AttributeName):o.morphTargets===!0&&d.bindAttribLocation(T,0,"position"),d.linkProgram(T);function ee(ae){if(n.debug.checkShaderErrors){const le=d.getProgramInfoLog(T).trim(),ge=d.getShaderInfoLog(O).trim(),be=d.getShaderInfoLog(Q).trim();let Xe=!0,Ce=!0;if(d.getProgramParameter(T,d.LINK_STATUS)===!1)if(Xe=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(d,T,O,Q);else{const Re=getShaderErrors(d,O,"vertex"),Se=getShaderErrors(d,Q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(T,d.VALIDATE_STATUS)+`

Material Name: `+ae.name+`
Material Type: `+ae.type+`

Program Info Log: `+le+`
`+Re+`
`+Se)}else le!==""?console.warn("THREE.WebGLProgram: Program Info Log:",le):(ge===""||be==="")&&(Ce=!1);Ce&&(ae.diagnostics={runnable:Xe,programLog:le,vertexShader:{log:ge,prefix:H},fragmentShader:{log:be,prefix:J}})}d.deleteShader(O),d.deleteShader(Q),ie=new WebGLUniforms(d,T),te=fetchAttributeLocations(d,T)}let ie;this.getUniforms=function(){return ie===void 0&&ee(this),ie};let te;this.getAttributes=function(){return te===void 0&&ee(this),te};let se=o.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return se===!1&&(se=d.getProgramParameter(T,COMPLETION_STATUS_KHR)),se},this.destroy=function(){u.releaseStatesOfProgram(this),d.deleteProgram(T),this.program=void 0},this.type=o.shaderType,this.name=o.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=T,this.vertexShader=O,this.fragmentShader=Q,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const o=t.vertexShader,u=t.fragmentShader,d=this._getShaderStage(o),C=this._getShaderStage(u),I=this._getShaderCacheForMaterial(t);return I.has(d)===!1&&(I.add(d),d.usedTimes++),I.has(C)===!1&&(I.add(C),C.usedTimes++),this}remove(t){const o=this.materialCache.get(t);for(const u of o)u.usedTimes--,u.usedTimes===0&&this.shaderCache.delete(u.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const o=this.materialCache;let u=o.get(t);return u===void 0&&(u=new Set,o.set(t,u)),u}_getShaderStage(t){const o=this.shaderCache;let u=o.get(t);return u===void 0&&(u=new WebGLShaderStage(t),o.set(t,u)),u}}class WebGLShaderStage{constructor(t){this.id=_id++,this.code=t,this.usedTimes=0}}function WebGLPrograms(n,t,o,u,d,C,I){const f=new Layers,A=new WebGLShaderCache,y=new Set,G=[],S=d.logarithmicDepthBuffer,w=d.vertexTextures;let M=d.precision;const V={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function T(te){return y.add(te),te===0?"uv":`uv${te}`}function H(te,se,ae,le,ge){const be=le.fog,Xe=ge.geometry,Ce=te.isMeshStandardMaterial?le.environment:null,Re=(te.isMeshStandardMaterial?o:t).get(te.envMap||Ce),Se=Re&&Re.mapping===CubeUVReflectionMapping?Re.image.height:null,Ze=V[te.type];te.precision!==null&&(M=d.getMaxPrecision(te.precision),M!==te.precision&&console.warn("THREE.WebGLProgram.getParameters:",te.precision,"not supported, using",M,"instead."));const he=Xe.morphAttributes.position||Xe.morphAttributes.normal||Xe.morphAttributes.color,Ie=he!==void 0?he.length:0;let Be=0;Xe.morphAttributes.position!==void 0&&(Be=1),Xe.morphAttributes.normal!==void 0&&(Be=2),Xe.morphAttributes.color!==void 0&&(Be=3);let ue,me,xe,Je;if(Ze){const ni=ShaderLib[Ze];ue=ni.vertexShader,me=ni.fragmentShader}else ue=te.vertexShader,me=te.fragmentShader,A.update(te),xe=A.getVertexShaderID(te),Je=A.getFragmentShaderID(te);const Ve=n.getRenderTarget(),Ee=n.state.buffers.depth.getReversed(),Ct=ge.isInstancedMesh===!0,st=ge.isBatchedMesh===!0,wt=!!te.map,Qe=!!te.matcap,Ue=!!Re,Ge=!!te.aoMap,Gt=!!te.lightMap,ot=!!te.bumpMap,vt=!!te.normalMap,at=!!te.displacementMap,Tt=!!te.emissiveMap,xt=!!te.metalnessMap,ve=!!te.roughnessMap,de=te.anisotropy>0,De=te.clearcoat>0,nt=te.dispersion>0,dt=te.iridescence>0,ze=te.sheen>0,rt=te.transmission>0,Rt=de&&!!te.anisotropyMap,Mt=De&&!!te.clearcoatMap,Yt=De&&!!te.clearcoatNormalMap,Oe=De&&!!te.clearcoatRoughnessMap,gt=dt&&!!te.iridescenceMap,pt=dt&&!!te.iridescenceThicknessMap,mt=ze&&!!te.sheenColorMap,It=ze&&!!te.sheenRoughnessMap,ye=!!te.specularMap,Ye=!!te.specularColorMap,_e=!!te.specularIntensityMap,Ne=rt&&!!te.transmissionMap,St=rt&&!!te.thicknessMap,et=!!te.gradientMap,lt=!!te.alphaMap,yt=te.alphaTest>0,_t=!!te.alphaHash,Jt=!!te.extensions;let oi=NoToneMapping;te.toneMapped&&(Ve===null||Ve.isXRRenderTarget===!0)&&(oi=n.toneMapping);const Si={shaderID:Ze,shaderType:te.type,shaderName:te.name,vertexShader:ue,fragmentShader:me,defines:te.defines,customVertexShaderID:xe,customFragmentShaderID:Je,isRawShaderMaterial:te.isRawShaderMaterial===!0,glslVersion:te.glslVersion,precision:M,batching:st,batchingColor:st&&ge._colorsTexture!==null,instancing:Ct,instancingColor:Ct&&ge.instanceColor!==null,instancingMorph:Ct&&ge.morphTexture!==null,supportsVertexTextures:w,outputColorSpace:Ve===null?n.outputColorSpace:Ve.isXRRenderTarget===!0?Ve.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!te.alphaToCoverage,map:wt,matcap:Qe,envMap:Ue,envMapMode:Ue&&Re.mapping,envMapCubeUVHeight:Se,aoMap:Ge,lightMap:Gt,bumpMap:ot,normalMap:vt,displacementMap:w&&at,emissiveMap:Tt,normalMapObjectSpace:vt&&te.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:vt&&te.normalMapType===TangentSpaceNormalMap,metalnessMap:xt,roughnessMap:ve,anisotropy:de,anisotropyMap:Rt,clearcoat:De,clearcoatMap:Mt,clearcoatNormalMap:Yt,clearcoatRoughnessMap:Oe,dispersion:nt,iridescence:dt,iridescenceMap:gt,iridescenceThicknessMap:pt,sheen:ze,sheenColorMap:mt,sheenRoughnessMap:It,specularMap:ye,specularColorMap:Ye,specularIntensityMap:_e,transmission:rt,transmissionMap:Ne,thicknessMap:St,gradientMap:et,opaque:te.transparent===!1&&te.blending===NormalBlending&&te.alphaToCoverage===!1,alphaMap:lt,alphaTest:yt,alphaHash:_t,combine:te.combine,mapUv:wt&&T(te.map.channel),aoMapUv:Ge&&T(te.aoMap.channel),lightMapUv:Gt&&T(te.lightMap.channel),bumpMapUv:ot&&T(te.bumpMap.channel),normalMapUv:vt&&T(te.normalMap.channel),displacementMapUv:at&&T(te.displacementMap.channel),emissiveMapUv:Tt&&T(te.emissiveMap.channel),metalnessMapUv:xt&&T(te.metalnessMap.channel),roughnessMapUv:ve&&T(te.roughnessMap.channel),anisotropyMapUv:Rt&&T(te.anisotropyMap.channel),clearcoatMapUv:Mt&&T(te.clearcoatMap.channel),clearcoatNormalMapUv:Yt&&T(te.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Oe&&T(te.clearcoatRoughnessMap.channel),iridescenceMapUv:gt&&T(te.iridescenceMap.channel),iridescenceThicknessMapUv:pt&&T(te.iridescenceThicknessMap.channel),sheenColorMapUv:mt&&T(te.sheenColorMap.channel),sheenRoughnessMapUv:It&&T(te.sheenRoughnessMap.channel),specularMapUv:ye&&T(te.specularMap.channel),specularColorMapUv:Ye&&T(te.specularColorMap.channel),specularIntensityMapUv:_e&&T(te.specularIntensityMap.channel),transmissionMapUv:Ne&&T(te.transmissionMap.channel),thicknessMapUv:St&&T(te.thicknessMap.channel),alphaMapUv:lt&&T(te.alphaMap.channel),vertexTangents:!!Xe.attributes.tangent&&(vt||de),vertexColors:te.vertexColors,vertexAlphas:te.vertexColors===!0&&!!Xe.attributes.color&&Xe.attributes.color.itemSize===4,pointsUvs:ge.isPoints===!0&&!!Xe.attributes.uv&&(wt||lt),fog:!!be,useFog:te.fog===!0,fogExp2:!!be&&be.isFogExp2,flatShading:te.flatShading===!0,sizeAttenuation:te.sizeAttenuation===!0,logarithmicDepthBuffer:S,reverseDepthBuffer:Ee,skinning:ge.isSkinnedMesh===!0,morphTargets:Xe.morphAttributes.position!==void 0,morphNormals:Xe.morphAttributes.normal!==void 0,morphColors:Xe.morphAttributes.color!==void 0,morphTargetsCount:Ie,morphTextureStride:Be,numDirLights:se.directional.length,numPointLights:se.point.length,numSpotLights:se.spot.length,numSpotLightMaps:se.spotLightMap.length,numRectAreaLights:se.rectArea.length,numHemiLights:se.hemi.length,numDirLightShadows:se.directionalShadowMap.length,numPointLightShadows:se.pointShadowMap.length,numSpotLightShadows:se.spotShadowMap.length,numSpotLightShadowsWithMaps:se.numSpotLightShadowsWithMaps,numLightProbes:se.numLightProbes,numClippingPlanes:I.numPlanes,numClipIntersection:I.numIntersection,dithering:te.dithering,shadowMapEnabled:n.shadowMap.enabled&&ae.length>0,shadowMapType:n.shadowMap.type,toneMapping:oi,decodeVideoTexture:wt&&te.map.isVideoTexture===!0&&ColorManagement.getTransfer(te.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:Tt&&te.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(te.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:te.premultipliedAlpha,doubleSided:te.side===DoubleSide,flipSided:te.side===BackSide,useDepthPacking:te.depthPacking>=0,depthPacking:te.depthPacking||0,index0AttributeName:te.index0AttributeName,extensionClipCullDistance:Jt&&te.extensions.clipCullDistance===!0&&u.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Jt&&te.extensions.multiDraw===!0||st)&&u.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:u.has("KHR_parallel_shader_compile"),customProgramCacheKey:te.customProgramCacheKey()};return Si.vertexUv1s=y.has(1),Si.vertexUv2s=y.has(2),Si.vertexUv3s=y.has(3),y.clear(),Si}function J(te){const se=[];if(te.shaderID?se.push(te.shaderID):(se.push(te.customVertexShaderID),se.push(te.customFragmentShaderID)),te.defines!==void 0)for(const ae in te.defines)se.push(ae),se.push(te.defines[ae]);return te.isRawShaderMaterial===!1&&(z(se,te),L(se,te),se.push(n.outputColorSpace)),se.push(te.customProgramCacheKey),se.join()}function z(te,se){te.push(se.precision),te.push(se.outputColorSpace),te.push(se.envMapMode),te.push(se.envMapCubeUVHeight),te.push(se.mapUv),te.push(se.alphaMapUv),te.push(se.lightMapUv),te.push(se.aoMapUv),te.push(se.bumpMapUv),te.push(se.normalMapUv),te.push(se.displacementMapUv),te.push(se.emissiveMapUv),te.push(se.metalnessMapUv),te.push(se.roughnessMapUv),te.push(se.anisotropyMapUv),te.push(se.clearcoatMapUv),te.push(se.clearcoatNormalMapUv),te.push(se.clearcoatRoughnessMapUv),te.push(se.iridescenceMapUv),te.push(se.iridescenceThicknessMapUv),te.push(se.sheenColorMapUv),te.push(se.sheenRoughnessMapUv),te.push(se.specularMapUv),te.push(se.specularColorMapUv),te.push(se.specularIntensityMapUv),te.push(se.transmissionMapUv),te.push(se.thicknessMapUv),te.push(se.combine),te.push(se.fogExp2),te.push(se.sizeAttenuation),te.push(se.morphTargetsCount),te.push(se.morphAttributeCount),te.push(se.numDirLights),te.push(se.numPointLights),te.push(se.numSpotLights),te.push(se.numSpotLightMaps),te.push(se.numHemiLights),te.push(se.numRectAreaLights),te.push(se.numDirLightShadows),te.push(se.numPointLightShadows),te.push(se.numSpotLightShadows),te.push(se.numSpotLightShadowsWithMaps),te.push(se.numLightProbes),te.push(se.shadowMapType),te.push(se.toneMapping),te.push(se.numClippingPlanes),te.push(se.numClipIntersection),te.push(se.depthPacking)}function L(te,se){f.disableAll(),se.supportsVertexTextures&&f.enable(0),se.instancing&&f.enable(1),se.instancingColor&&f.enable(2),se.instancingMorph&&f.enable(3),se.matcap&&f.enable(4),se.envMap&&f.enable(5),se.normalMapObjectSpace&&f.enable(6),se.normalMapTangentSpace&&f.enable(7),se.clearcoat&&f.enable(8),se.iridescence&&f.enable(9),se.alphaTest&&f.enable(10),se.vertexColors&&f.enable(11),se.vertexAlphas&&f.enable(12),se.vertexUv1s&&f.enable(13),se.vertexUv2s&&f.enable(14),se.vertexUv3s&&f.enable(15),se.vertexTangents&&f.enable(16),se.anisotropy&&f.enable(17),se.alphaHash&&f.enable(18),se.batching&&f.enable(19),se.dispersion&&f.enable(20),se.batchingColor&&f.enable(21),te.push(f.mask),f.disableAll(),se.fog&&f.enable(0),se.useFog&&f.enable(1),se.flatShading&&f.enable(2),se.logarithmicDepthBuffer&&f.enable(3),se.reverseDepthBuffer&&f.enable(4),se.skinning&&f.enable(5),se.morphTargets&&f.enable(6),se.morphNormals&&f.enable(7),se.morphColors&&f.enable(8),se.premultipliedAlpha&&f.enable(9),se.shadowMapEnabled&&f.enable(10),se.doubleSided&&f.enable(11),se.flipSided&&f.enable(12),se.useDepthPacking&&f.enable(13),se.dithering&&f.enable(14),se.transmission&&f.enable(15),se.sheen&&f.enable(16),se.opaque&&f.enable(17),se.pointsUvs&&f.enable(18),se.decodeVideoTexture&&f.enable(19),se.decodeVideoTextureEmissive&&f.enable(20),se.alphaToCoverage&&f.enable(21),te.push(f.mask)}function K(te){const se=V[te.type];let ae;if(se){const le=ShaderLib[se];ae=UniformsUtils.clone(le.uniforms)}else ae=te.uniforms;return ae}function O(te,se){let ae;for(let le=0,ge=G.length;le<ge;le++){const be=G[le];if(be.cacheKey===se){ae=be,++ae.usedTimes;break}}return ae===void 0&&(ae=new WebGLProgram(n,se,te,C),G.push(ae)),ae}function Q(te){if(--te.usedTimes===0){const se=G.indexOf(te);G[se]=G[G.length-1],G.pop(),te.destroy()}}function ee(te){A.remove(te)}function ie(){A.dispose()}return{getParameters:H,getProgramCacheKey:J,getUniforms:K,acquireProgram:O,releaseProgram:Q,releaseShaderCache:ee,programs:G,dispose:ie}}function WebGLProperties(){let n=new WeakMap;function t(I){return n.has(I)}function o(I){let f=n.get(I);return f===void 0&&(f={},n.set(I,f)),f}function u(I){n.delete(I)}function d(I,f,A){n.get(I)[f]=A}function C(){n=new WeakMap}return{has:t,get:o,remove:u,update:d,dispose:C}}function painterSortStable(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function reversePainterSortStable(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function WebGLRenderList(){const n=[];let t=0;const o=[],u=[],d=[];function C(){t=0,o.length=0,u.length=0,d.length=0}function I(S,w,M,V,T,H){let J=n[t];return J===void 0?(J={id:S.id,object:S,geometry:w,material:M,groupOrder:V,renderOrder:S.renderOrder,z:T,group:H},n[t]=J):(J.id=S.id,J.object=S,J.geometry=w,J.material=M,J.groupOrder=V,J.renderOrder=S.renderOrder,J.z=T,J.group=H),t++,J}function f(S,w,M,V,T,H){const J=I(S,w,M,V,T,H);M.transmission>0?u.push(J):M.transparent===!0?d.push(J):o.push(J)}function A(S,w,M,V,T,H){const J=I(S,w,M,V,T,H);M.transmission>0?u.unshift(J):M.transparent===!0?d.unshift(J):o.unshift(J)}function y(S,w){o.length>1&&o.sort(S||painterSortStable),u.length>1&&u.sort(w||reversePainterSortStable),d.length>1&&d.sort(w||reversePainterSortStable)}function G(){for(let S=t,w=n.length;S<w;S++){const M=n[S];if(M.id===null)break;M.id=null,M.object=null,M.geometry=null,M.material=null,M.group=null}}return{opaque:o,transmissive:u,transparent:d,init:C,push:f,unshift:A,finish:G,sort:y}}function WebGLRenderLists(){let n=new WeakMap;function t(u,d){const C=n.get(u);let I;return C===void 0?(I=new WebGLRenderList,n.set(u,[I])):d>=C.length?(I=new WebGLRenderList,C.push(I)):I=C[d],I}function o(){n=new WeakMap}return{get:t,dispose:o}}function UniformsCache(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let o;switch(t.type){case"DirectionalLight":o={direction:new Vector3,color:new Color};break;case"SpotLight":o={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":o={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":o={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":o={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return n[t.id]=o,o}}}function ShadowUniformsCache(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let o;switch(t.type){case"DirectionalLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":o={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[t.id]=o,o}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function WebGLLights(n){const t=new UniformsCache,o=ShadowUniformsCache(),u={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let y=0;y<9;y++)u.probe.push(new Vector3);const d=new Vector3,C=new Matrix4,I=new Matrix4;function f(y){let G=0,S=0,w=0;for(let te=0;te<9;te++)u.probe[te].set(0,0,0);let M=0,V=0,T=0,H=0,J=0,z=0,L=0,K=0,O=0,Q=0,ee=0;y.sort(shadowCastingAndTexturingLightsFirst);for(let te=0,se=y.length;te<se;te++){const ae=y[te],le=ae.color,ge=ae.intensity,be=ae.distance,Xe=ae.shadow&&ae.shadow.map?ae.shadow.map.texture:null;if(ae.isAmbientLight)G+=le.r*ge,S+=le.g*ge,w+=le.b*ge;else if(ae.isLightProbe){for(let Ce=0;Ce<9;Ce++)u.probe[Ce].addScaledVector(ae.sh.coefficients[Ce],ge);ee++}else if(ae.isDirectionalLight){const Ce=t.get(ae);if(Ce.color.copy(ae.color).multiplyScalar(ae.intensity),ae.castShadow){const Re=ae.shadow,Se=o.get(ae);Se.shadowIntensity=Re.intensity,Se.shadowBias=Re.bias,Se.shadowNormalBias=Re.normalBias,Se.shadowRadius=Re.radius,Se.shadowMapSize=Re.mapSize,u.directionalShadow[M]=Se,u.directionalShadowMap[M]=Xe,u.directionalShadowMatrix[M]=ae.shadow.matrix,z++}u.directional[M]=Ce,M++}else if(ae.isSpotLight){const Ce=t.get(ae);Ce.position.setFromMatrixPosition(ae.matrixWorld),Ce.color.copy(le).multiplyScalar(ge),Ce.distance=be,Ce.coneCos=Math.cos(ae.angle),Ce.penumbraCos=Math.cos(ae.angle*(1-ae.penumbra)),Ce.decay=ae.decay,u.spot[T]=Ce;const Re=ae.shadow;if(ae.map&&(u.spotLightMap[O]=ae.map,O++,Re.updateMatrices(ae),ae.castShadow&&Q++),u.spotLightMatrix[T]=Re.matrix,ae.castShadow){const Se=o.get(ae);Se.shadowIntensity=Re.intensity,Se.shadowBias=Re.bias,Se.shadowNormalBias=Re.normalBias,Se.shadowRadius=Re.radius,Se.shadowMapSize=Re.mapSize,u.spotShadow[T]=Se,u.spotShadowMap[T]=Xe,K++}T++}else if(ae.isRectAreaLight){const Ce=t.get(ae);Ce.color.copy(le).multiplyScalar(ge),Ce.halfWidth.set(ae.width*.5,0,0),Ce.halfHeight.set(0,ae.height*.5,0),u.rectArea[H]=Ce,H++}else if(ae.isPointLight){const Ce=t.get(ae);if(Ce.color.copy(ae.color).multiplyScalar(ae.intensity),Ce.distance=ae.distance,Ce.decay=ae.decay,ae.castShadow){const Re=ae.shadow,Se=o.get(ae);Se.shadowIntensity=Re.intensity,Se.shadowBias=Re.bias,Se.shadowNormalBias=Re.normalBias,Se.shadowRadius=Re.radius,Se.shadowMapSize=Re.mapSize,Se.shadowCameraNear=Re.camera.near,Se.shadowCameraFar=Re.camera.far,u.pointShadow[V]=Se,u.pointShadowMap[V]=Xe,u.pointShadowMatrix[V]=ae.shadow.matrix,L++}u.point[V]=Ce,V++}else if(ae.isHemisphereLight){const Ce=t.get(ae);Ce.skyColor.copy(ae.color).multiplyScalar(ge),Ce.groundColor.copy(ae.groundColor).multiplyScalar(ge),u.hemi[J]=Ce,J++}}H>0&&(n.has("OES_texture_float_linear")===!0?(u.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,u.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(u.rectAreaLTC1=UniformsLib.LTC_HALF_1,u.rectAreaLTC2=UniformsLib.LTC_HALF_2)),u.ambient[0]=G,u.ambient[1]=S,u.ambient[2]=w;const ie=u.hash;(ie.directionalLength!==M||ie.pointLength!==V||ie.spotLength!==T||ie.rectAreaLength!==H||ie.hemiLength!==J||ie.numDirectionalShadows!==z||ie.numPointShadows!==L||ie.numSpotShadows!==K||ie.numSpotMaps!==O||ie.numLightProbes!==ee)&&(u.directional.length=M,u.spot.length=T,u.rectArea.length=H,u.point.length=V,u.hemi.length=J,u.directionalShadow.length=z,u.directionalShadowMap.length=z,u.pointShadow.length=L,u.pointShadowMap.length=L,u.spotShadow.length=K,u.spotShadowMap.length=K,u.directionalShadowMatrix.length=z,u.pointShadowMatrix.length=L,u.spotLightMatrix.length=K+O-Q,u.spotLightMap.length=O,u.numSpotLightShadowsWithMaps=Q,u.numLightProbes=ee,ie.directionalLength=M,ie.pointLength=V,ie.spotLength=T,ie.rectAreaLength=H,ie.hemiLength=J,ie.numDirectionalShadows=z,ie.numPointShadows=L,ie.numSpotShadows=K,ie.numSpotMaps=O,ie.numLightProbes=ee,u.version=nextVersion++)}function A(y,G){let S=0,w=0,M=0,V=0,T=0;const H=G.matrixWorldInverse;for(let J=0,z=y.length;J<z;J++){const L=y[J];if(L.isDirectionalLight){const K=u.directional[S];K.direction.setFromMatrixPosition(L.matrixWorld),d.setFromMatrixPosition(L.target.matrixWorld),K.direction.sub(d),K.direction.transformDirection(H),S++}else if(L.isSpotLight){const K=u.spot[M];K.position.setFromMatrixPosition(L.matrixWorld),K.position.applyMatrix4(H),K.direction.setFromMatrixPosition(L.matrixWorld),d.setFromMatrixPosition(L.target.matrixWorld),K.direction.sub(d),K.direction.transformDirection(H),M++}else if(L.isRectAreaLight){const K=u.rectArea[V];K.position.setFromMatrixPosition(L.matrixWorld),K.position.applyMatrix4(H),I.identity(),C.copy(L.matrixWorld),C.premultiply(H),I.extractRotation(C),K.halfWidth.set(L.width*.5,0,0),K.halfHeight.set(0,L.height*.5,0),K.halfWidth.applyMatrix4(I),K.halfHeight.applyMatrix4(I),V++}else if(L.isPointLight){const K=u.point[w];K.position.setFromMatrixPosition(L.matrixWorld),K.position.applyMatrix4(H),w++}else if(L.isHemisphereLight){const K=u.hemi[T];K.direction.setFromMatrixPosition(L.matrixWorld),K.direction.transformDirection(H),T++}}}return{setup:f,setupView:A,state:u}}function WebGLRenderState(n){const t=new WebGLLights(n),o=[],u=[];function d(G){y.camera=G,o.length=0,u.length=0}function C(G){o.push(G)}function I(G){u.push(G)}function f(){t.setup(o)}function A(G){t.setupView(o,G)}const y={lightsArray:o,shadowsArray:u,camera:null,lights:t,transmissionRenderTarget:{}};return{init:d,state:y,setupLights:f,setupLightsView:A,pushLight:C,pushShadow:I}}function WebGLRenderStates(n){let t=new WeakMap;function o(d,C=0){const I=t.get(d);let f;return I===void 0?(f=new WebGLRenderState(n),t.set(d,[f])):C>=I.length?(f=new WebGLRenderState(n),I.push(f)):f=I[C],f}function u(){t=new WeakMap}return{get:o,dispose:u}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(n,t,o){let u=new Frustum;const d=new Vector2,C=new Vector2,I=new Vector4,f=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),A=new MeshDistanceMaterial,y={},G=o.maxTextureSize,S={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},w=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),M=w.clone();M.defines.HORIZONTAL_PASS=1;const V=new BufferGeometry;V.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const T=new Mesh(V,w),H=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let J=this.type;this.render=function(Q,ee,ie){if(H.enabled===!1||H.autoUpdate===!1&&H.needsUpdate===!1||Q.length===0)return;const te=n.getRenderTarget(),se=n.getActiveCubeFace(),ae=n.getActiveMipmapLevel(),le=n.state;le.setBlending(NoBlending),le.buffers.color.setClear(1,1,1,1),le.buffers.depth.setTest(!0),le.setScissorTest(!1);const ge=J!==VSMShadowMap&&this.type===VSMShadowMap,be=J===VSMShadowMap&&this.type!==VSMShadowMap;for(let Xe=0,Ce=Q.length;Xe<Ce;Xe++){const Re=Q[Xe],Se=Re.shadow;if(Se===void 0){console.warn("THREE.WebGLShadowMap:",Re,"has no shadow.");continue}if(Se.autoUpdate===!1&&Se.needsUpdate===!1)continue;d.copy(Se.mapSize);const Ze=Se.getFrameExtents();if(d.multiply(Ze),C.copy(Se.mapSize),(d.x>G||d.y>G)&&(d.x>G&&(C.x=Math.floor(G/Ze.x),d.x=C.x*Ze.x,Se.mapSize.x=C.x),d.y>G&&(C.y=Math.floor(G/Ze.y),d.y=C.y*Ze.y,Se.mapSize.y=C.y)),Se.map===null||ge===!0||be===!0){const Ie=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Se.map!==null&&Se.map.dispose(),Se.map=new WebGLRenderTarget(d.x,d.y,Ie),Se.map.texture.name=Re.name+".shadowMap",Se.camera.updateProjectionMatrix()}n.setRenderTarget(Se.map),n.clear();const he=Se.getViewportCount();for(let Ie=0;Ie<he;Ie++){const Be=Se.getViewport(Ie);I.set(C.x*Be.x,C.y*Be.y,C.x*Be.z,C.y*Be.w),le.viewport(I),Se.updateMatrices(Re,Ie),u=Se.getFrustum(),K(ee,ie,Se.camera,Re,this.type)}Se.isPointLightShadow!==!0&&this.type===VSMShadowMap&&z(Se,ie),Se.needsUpdate=!1}J=this.type,H.needsUpdate=!1,n.setRenderTarget(te,se,ae)};function z(Q,ee){const ie=t.update(T);w.defines.VSM_SAMPLES!==Q.blurSamples&&(w.defines.VSM_SAMPLES=Q.blurSamples,M.defines.VSM_SAMPLES=Q.blurSamples,w.needsUpdate=!0,M.needsUpdate=!0),Q.mapPass===null&&(Q.mapPass=new WebGLRenderTarget(d.x,d.y)),w.uniforms.shadow_pass.value=Q.map.texture,w.uniforms.resolution.value=Q.mapSize,w.uniforms.radius.value=Q.radius,n.setRenderTarget(Q.mapPass),n.clear(),n.renderBufferDirect(ee,null,ie,w,T,null),M.uniforms.shadow_pass.value=Q.mapPass.texture,M.uniforms.resolution.value=Q.mapSize,M.uniforms.radius.value=Q.radius,n.setRenderTarget(Q.map),n.clear(),n.renderBufferDirect(ee,null,ie,M,T,null)}function L(Q,ee,ie,te){let se=null;const ae=ie.isPointLight===!0?Q.customDistanceMaterial:Q.customDepthMaterial;if(ae!==void 0)se=ae;else if(se=ie.isPointLight===!0?A:f,n.localClippingEnabled&&ee.clipShadows===!0&&Array.isArray(ee.clippingPlanes)&&ee.clippingPlanes.length!==0||ee.displacementMap&&ee.displacementScale!==0||ee.alphaMap&&ee.alphaTest>0||ee.map&&ee.alphaTest>0){const le=se.uuid,ge=ee.uuid;let be=y[le];be===void 0&&(be={},y[le]=be);let Xe=be[ge];Xe===void 0&&(Xe=se.clone(),be[ge]=Xe,ee.addEventListener("dispose",O)),se=Xe}if(se.visible=ee.visible,se.wireframe=ee.wireframe,te===VSMShadowMap?se.side=ee.shadowSide!==null?ee.shadowSide:ee.side:se.side=ee.shadowSide!==null?ee.shadowSide:S[ee.side],se.alphaMap=ee.alphaMap,se.alphaTest=ee.alphaTest,se.map=ee.map,se.clipShadows=ee.clipShadows,se.clippingPlanes=ee.clippingPlanes,se.clipIntersection=ee.clipIntersection,se.displacementMap=ee.displacementMap,se.displacementScale=ee.displacementScale,se.displacementBias=ee.displacementBias,se.wireframeLinewidth=ee.wireframeLinewidth,se.linewidth=ee.linewidth,ie.isPointLight===!0&&se.isMeshDistanceMaterial===!0){const le=n.properties.get(se);le.light=ie}return se}function K(Q,ee,ie,te,se){if(Q.visible===!1)return;if(Q.layers.test(ee.layers)&&(Q.isMesh||Q.isLine||Q.isPoints)&&(Q.castShadow||Q.receiveShadow&&se===VSMShadowMap)&&(!Q.frustumCulled||u.intersectsObject(Q))){Q.modelViewMatrix.multiplyMatrices(ie.matrixWorldInverse,Q.matrixWorld);const ge=t.update(Q),be=Q.material;if(Array.isArray(be)){const Xe=ge.groups;for(let Ce=0,Re=Xe.length;Ce<Re;Ce++){const Se=Xe[Ce],Ze=be[Se.materialIndex];if(Ze&&Ze.visible){const he=L(Q,Ze,te,se);Q.onBeforeShadow(n,Q,ee,ie,ge,he,Se),n.renderBufferDirect(ie,null,ge,he,Q,Se),Q.onAfterShadow(n,Q,ee,ie,ge,he,Se)}}}else if(be.visible){const Xe=L(Q,be,te,se);Q.onBeforeShadow(n,Q,ee,ie,ge,Xe,null),n.renderBufferDirect(ie,null,ge,Xe,Q,null),Q.onAfterShadow(n,Q,ee,ie,ge,Xe,null)}}const le=Q.children;for(let ge=0,be=le.length;ge<be;ge++)K(le[ge],ee,ie,te,se)}function O(Q){Q.target.removeEventListener("dispose",O);for(const ie in y){const te=y[ie],se=Q.target.uuid;se in te&&(te[se].dispose(),delete te[se])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(n,t){function o(){let Ne=!1;const St=new Vector4;let et=null;const lt=new Vector4(0,0,0,0);return{setMask:function(yt){et!==yt&&!Ne&&(n.colorMask(yt,yt,yt,yt),et=yt)},setLocked:function(yt){Ne=yt},setClear:function(yt,_t,Jt,oi,Si){Si===!0&&(yt*=oi,_t*=oi,Jt*=oi),St.set(yt,_t,Jt,oi),lt.equals(St)===!1&&(n.clearColor(yt,_t,Jt,oi),lt.copy(St))},reset:function(){Ne=!1,et=null,lt.set(-1,0,0,0)}}}function u(){let Ne=!1,St=!1,et=null,lt=null,yt=null;return{setReversed:function(_t){if(St!==_t){const Jt=t.get("EXT_clip_control");St?Jt.clipControlEXT(Jt.LOWER_LEFT_EXT,Jt.ZERO_TO_ONE_EXT):Jt.clipControlEXT(Jt.LOWER_LEFT_EXT,Jt.NEGATIVE_ONE_TO_ONE_EXT);const oi=yt;yt=null,this.setClear(oi)}St=_t},getReversed:function(){return St},setTest:function(_t){_t?Ve(n.DEPTH_TEST):Ee(n.DEPTH_TEST)},setMask:function(_t){et!==_t&&!Ne&&(n.depthMask(_t),et=_t)},setFunc:function(_t){if(St&&(_t=reversedFuncs[_t]),lt!==_t){switch(_t){case NeverDepth:n.depthFunc(n.NEVER);break;case AlwaysDepth:n.depthFunc(n.ALWAYS);break;case LessDepth:n.depthFunc(n.LESS);break;case LessEqualDepth:n.depthFunc(n.LEQUAL);break;case EqualDepth:n.depthFunc(n.EQUAL);break;case GreaterEqualDepth:n.depthFunc(n.GEQUAL);break;case GreaterDepth:n.depthFunc(n.GREATER);break;case NotEqualDepth:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}lt=_t}},setLocked:function(_t){Ne=_t},setClear:function(_t){yt!==_t&&(St&&(_t=1-_t),n.clearDepth(_t),yt=_t)},reset:function(){Ne=!1,et=null,lt=null,yt=null,St=!1}}}function d(){let Ne=!1,St=null,et=null,lt=null,yt=null,_t=null,Jt=null,oi=null,Si=null;return{setTest:function(ni){Ne||(ni?Ve(n.STENCIL_TEST):Ee(n.STENCIL_TEST))},setMask:function(ni){St!==ni&&!Ne&&(n.stencilMask(ni),St=ni)},setFunc:function(ni,gi,Ri){(et!==ni||lt!==gi||yt!==Ri)&&(n.stencilFunc(ni,gi,Ri),et=ni,lt=gi,yt=Ri)},setOp:function(ni,gi,Ri){(_t!==ni||Jt!==gi||oi!==Ri)&&(n.stencilOp(ni,gi,Ri),_t=ni,Jt=gi,oi=Ri)},setLocked:function(ni){Ne=ni},setClear:function(ni){Si!==ni&&(n.clearStencil(ni),Si=ni)},reset:function(){Ne=!1,St=null,et=null,lt=null,yt=null,_t=null,Jt=null,oi=null,Si=null}}}const C=new o,I=new u,f=new d,A=new WeakMap,y=new WeakMap;let G={},S={},w=new WeakMap,M=[],V=null,T=!1,H=null,J=null,z=null,L=null,K=null,O=null,Q=null,ee=new Color(0,0,0),ie=0,te=!1,se=null,ae=null,le=null,ge=null,be=null;const Xe=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ce=!1,Re=0;const Se=n.getParameter(n.VERSION);Se.indexOf("WebGL")!==-1?(Re=parseFloat(/^WebGL (\d)/.exec(Se)[1]),Ce=Re>=1):Se.indexOf("OpenGL ES")!==-1&&(Re=parseFloat(/^OpenGL ES (\d)/.exec(Se)[1]),Ce=Re>=2);let Ze=null,he={};const Ie=n.getParameter(n.SCISSOR_BOX),Be=n.getParameter(n.VIEWPORT),ue=new Vector4().fromArray(Ie),me=new Vector4().fromArray(Be);function xe(Ne,St,et,lt){const yt=new Uint8Array(4),_t=n.createTexture();n.bindTexture(Ne,_t),n.texParameteri(Ne,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Ne,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Jt=0;Jt<et;Jt++)Ne===n.TEXTURE_3D||Ne===n.TEXTURE_2D_ARRAY?n.texImage3D(St,0,n.RGBA,1,1,lt,0,n.RGBA,n.UNSIGNED_BYTE,yt):n.texImage2D(St+Jt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,yt);return _t}const Je={};Je[n.TEXTURE_2D]=xe(n.TEXTURE_2D,n.TEXTURE_2D,1),Je[n.TEXTURE_CUBE_MAP]=xe(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Je[n.TEXTURE_2D_ARRAY]=xe(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Je[n.TEXTURE_3D]=xe(n.TEXTURE_3D,n.TEXTURE_3D,1,1),C.setClear(0,0,0,1),I.setClear(1),f.setClear(0),Ve(n.DEPTH_TEST),I.setFunc(LessEqualDepth),ot(!1),vt(CullFaceBack),Ve(n.CULL_FACE),Ge(NoBlending);function Ve(Ne){G[Ne]!==!0&&(n.enable(Ne),G[Ne]=!0)}function Ee(Ne){G[Ne]!==!1&&(n.disable(Ne),G[Ne]=!1)}function Ct(Ne,St){return S[Ne]!==St?(n.bindFramebuffer(Ne,St),S[Ne]=St,Ne===n.DRAW_FRAMEBUFFER&&(S[n.FRAMEBUFFER]=St),Ne===n.FRAMEBUFFER&&(S[n.DRAW_FRAMEBUFFER]=St),!0):!1}function st(Ne,St){let et=M,lt=!1;if(Ne){et=w.get(St),et===void 0&&(et=[],w.set(St,et));const yt=Ne.textures;if(et.length!==yt.length||et[0]!==n.COLOR_ATTACHMENT0){for(let _t=0,Jt=yt.length;_t<Jt;_t++)et[_t]=n.COLOR_ATTACHMENT0+_t;et.length=yt.length,lt=!0}}else et[0]!==n.BACK&&(et[0]=n.BACK,lt=!0);lt&&n.drawBuffers(et)}function wt(Ne){return V!==Ne?(n.useProgram(Ne),V=Ne,!0):!1}const Qe={[AddEquation]:n.FUNC_ADD,[SubtractEquation]:n.FUNC_SUBTRACT,[ReverseSubtractEquation]:n.FUNC_REVERSE_SUBTRACT};Qe[MinEquation]=n.MIN,Qe[MaxEquation]=n.MAX;const Ue={[ZeroFactor]:n.ZERO,[OneFactor]:n.ONE,[SrcColorFactor]:n.SRC_COLOR,[SrcAlphaFactor]:n.SRC_ALPHA,[SrcAlphaSaturateFactor]:n.SRC_ALPHA_SATURATE,[DstColorFactor]:n.DST_COLOR,[DstAlphaFactor]:n.DST_ALPHA,[OneMinusSrcColorFactor]:n.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:n.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:n.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:n.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:n.CONSTANT_COLOR,[OneMinusConstantColorFactor]:n.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:n.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:n.ONE_MINUS_CONSTANT_ALPHA};function Ge(Ne,St,et,lt,yt,_t,Jt,oi,Si,ni){if(Ne===NoBlending){T===!0&&(Ee(n.BLEND),T=!1);return}if(T===!1&&(Ve(n.BLEND),T=!0),Ne!==CustomBlending){if(Ne!==H||ni!==te){if((J!==AddEquation||K!==AddEquation)&&(n.blendEquation(n.FUNC_ADD),J=AddEquation,K=AddEquation),ni)switch(Ne){case NormalBlending:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:n.blendFunc(n.ONE,n.ONE);break;case SubtractiveBlending:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case MultiplyBlending:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ne);break}else switch(Ne){case NormalBlending:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case SubtractiveBlending:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case MultiplyBlending:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ne);break}z=null,L=null,O=null,Q=null,ee.set(0,0,0),ie=0,H=Ne,te=ni}return}yt=yt||St,_t=_t||et,Jt=Jt||lt,(St!==J||yt!==K)&&(n.blendEquationSeparate(Qe[St],Qe[yt]),J=St,K=yt),(et!==z||lt!==L||_t!==O||Jt!==Q)&&(n.blendFuncSeparate(Ue[et],Ue[lt],Ue[_t],Ue[Jt]),z=et,L=lt,O=_t,Q=Jt),(oi.equals(ee)===!1||Si!==ie)&&(n.blendColor(oi.r,oi.g,oi.b,Si),ee.copy(oi),ie=Si),H=Ne,te=!1}function Gt(Ne,St){Ne.side===DoubleSide?Ee(n.CULL_FACE):Ve(n.CULL_FACE);let et=Ne.side===BackSide;St&&(et=!et),ot(et),Ne.blending===NormalBlending&&Ne.transparent===!1?Ge(NoBlending):Ge(Ne.blending,Ne.blendEquation,Ne.blendSrc,Ne.blendDst,Ne.blendEquationAlpha,Ne.blendSrcAlpha,Ne.blendDstAlpha,Ne.blendColor,Ne.blendAlpha,Ne.premultipliedAlpha),I.setFunc(Ne.depthFunc),I.setTest(Ne.depthTest),I.setMask(Ne.depthWrite),C.setMask(Ne.colorWrite);const lt=Ne.stencilWrite;f.setTest(lt),lt&&(f.setMask(Ne.stencilWriteMask),f.setFunc(Ne.stencilFunc,Ne.stencilRef,Ne.stencilFuncMask),f.setOp(Ne.stencilFail,Ne.stencilZFail,Ne.stencilZPass)),Tt(Ne.polygonOffset,Ne.polygonOffsetFactor,Ne.polygonOffsetUnits),Ne.alphaToCoverage===!0?Ve(n.SAMPLE_ALPHA_TO_COVERAGE):Ee(n.SAMPLE_ALPHA_TO_COVERAGE)}function ot(Ne){se!==Ne&&(Ne?n.frontFace(n.CW):n.frontFace(n.CCW),se=Ne)}function vt(Ne){Ne!==CullFaceNone?(Ve(n.CULL_FACE),Ne!==ae&&(Ne===CullFaceBack?n.cullFace(n.BACK):Ne===CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ee(n.CULL_FACE),ae=Ne}function at(Ne){Ne!==le&&(Ce&&n.lineWidth(Ne),le=Ne)}function Tt(Ne,St,et){Ne?(Ve(n.POLYGON_OFFSET_FILL),(ge!==St||be!==et)&&(n.polygonOffset(St,et),ge=St,be=et)):Ee(n.POLYGON_OFFSET_FILL)}function xt(Ne){Ne?Ve(n.SCISSOR_TEST):Ee(n.SCISSOR_TEST)}function ve(Ne){Ne===void 0&&(Ne=n.TEXTURE0+Xe-1),Ze!==Ne&&(n.activeTexture(Ne),Ze=Ne)}function de(Ne,St,et){et===void 0&&(Ze===null?et=n.TEXTURE0+Xe-1:et=Ze);let lt=he[et];lt===void 0&&(lt={type:void 0,texture:void 0},he[et]=lt),(lt.type!==Ne||lt.texture!==St)&&(Ze!==et&&(n.activeTexture(et),Ze=et),n.bindTexture(Ne,St||Je[Ne]),lt.type=Ne,lt.texture=St)}function De(){const Ne=he[Ze];Ne!==void 0&&Ne.type!==void 0&&(n.bindTexture(Ne.type,null),Ne.type=void 0,Ne.texture=void 0)}function nt(){try{n.compressedTexImage2D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function dt(){try{n.compressedTexImage3D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function ze(){try{n.texSubImage2D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function rt(){try{n.texSubImage3D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function Rt(){try{n.compressedTexSubImage2D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function Mt(){try{n.compressedTexSubImage3D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function Yt(){try{n.texStorage2D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function Oe(){try{n.texStorage3D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function gt(){try{n.texImage2D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function pt(){try{n.texImage3D(...arguments)}catch(Ne){console.error("THREE.WebGLState:",Ne)}}function mt(Ne){ue.equals(Ne)===!1&&(n.scissor(Ne.x,Ne.y,Ne.z,Ne.w),ue.copy(Ne))}function It(Ne){me.equals(Ne)===!1&&(n.viewport(Ne.x,Ne.y,Ne.z,Ne.w),me.copy(Ne))}function ye(Ne,St){let et=y.get(St);et===void 0&&(et=new WeakMap,y.set(St,et));let lt=et.get(Ne);lt===void 0&&(lt=n.getUniformBlockIndex(St,Ne.name),et.set(Ne,lt))}function Ye(Ne,St){const lt=y.get(St).get(Ne);A.get(St)!==lt&&(n.uniformBlockBinding(St,lt,Ne.__bindingPointIndex),A.set(St,lt))}function _e(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),I.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),G={},Ze=null,he={},S={},w=new WeakMap,M=[],V=null,T=!1,H=null,J=null,z=null,L=null,K=null,O=null,Q=null,ee=new Color(0,0,0),ie=0,te=!1,se=null,ae=null,le=null,ge=null,be=null,ue.set(0,0,n.canvas.width,n.canvas.height),me.set(0,0,n.canvas.width,n.canvas.height),C.reset(),I.reset(),f.reset()}return{buffers:{color:C,depth:I,stencil:f},enable:Ve,disable:Ee,bindFramebuffer:Ct,drawBuffers:st,useProgram:wt,setBlending:Ge,setMaterial:Gt,setFlipSided:ot,setCullFace:vt,setLineWidth:at,setPolygonOffset:Tt,setScissorTest:xt,activeTexture:ve,bindTexture:de,unbindTexture:De,compressedTexImage2D:nt,compressedTexImage3D:dt,texImage2D:gt,texImage3D:pt,updateUBOMapping:ye,uniformBlockBinding:Ye,texStorage2D:Yt,texStorage3D:Oe,texSubImage2D:ze,texSubImage3D:rt,compressedTexSubImage2D:Rt,compressedTexSubImage3D:Mt,scissor:mt,viewport:It,reset:_e}}function WebGLTextures(n,t,o,u,d,C,I){const f=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,A=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),y=new Vector2,G=new WeakMap;let S;const w=new WeakMap;let M=!1;try{M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function V(ve,de){return M?new OffscreenCanvas(ve,de):createElementNS("canvas")}function T(ve,de,De){let nt=1;const dt=xt(ve);if((dt.width>De||dt.height>De)&&(nt=De/Math.max(dt.width,dt.height)),nt<1)if(typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ve instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ve instanceof ImageBitmap||typeof VideoFrame<"u"&&ve instanceof VideoFrame){const ze=Math.floor(nt*dt.width),rt=Math.floor(nt*dt.height);S===void 0&&(S=V(ze,rt));const Rt=de?V(ze,rt):S;return Rt.width=ze,Rt.height=rt,Rt.getContext("2d").drawImage(ve,0,0,ze,rt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+dt.width+"x"+dt.height+") to ("+ze+"x"+rt+")."),Rt}else return"data"in ve&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+dt.width+"x"+dt.height+")."),ve;return ve}function H(ve){return ve.generateMipmaps}function J(ve){n.generateMipmap(ve)}function z(ve){return ve.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:ve.isWebGL3DRenderTarget?n.TEXTURE_3D:ve.isWebGLArrayRenderTarget||ve.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function L(ve,de,De,nt,dt=!1){if(ve!==null){if(n[ve]!==void 0)return n[ve];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ve+"'")}let ze=de;if(de===n.RED&&(De===n.FLOAT&&(ze=n.R32F),De===n.HALF_FLOAT&&(ze=n.R16F),De===n.UNSIGNED_BYTE&&(ze=n.R8)),de===n.RED_INTEGER&&(De===n.UNSIGNED_BYTE&&(ze=n.R8UI),De===n.UNSIGNED_SHORT&&(ze=n.R16UI),De===n.UNSIGNED_INT&&(ze=n.R32UI),De===n.BYTE&&(ze=n.R8I),De===n.SHORT&&(ze=n.R16I),De===n.INT&&(ze=n.R32I)),de===n.RG&&(De===n.FLOAT&&(ze=n.RG32F),De===n.HALF_FLOAT&&(ze=n.RG16F),De===n.UNSIGNED_BYTE&&(ze=n.RG8)),de===n.RG_INTEGER&&(De===n.UNSIGNED_BYTE&&(ze=n.RG8UI),De===n.UNSIGNED_SHORT&&(ze=n.RG16UI),De===n.UNSIGNED_INT&&(ze=n.RG32UI),De===n.BYTE&&(ze=n.RG8I),De===n.SHORT&&(ze=n.RG16I),De===n.INT&&(ze=n.RG32I)),de===n.RGB_INTEGER&&(De===n.UNSIGNED_BYTE&&(ze=n.RGB8UI),De===n.UNSIGNED_SHORT&&(ze=n.RGB16UI),De===n.UNSIGNED_INT&&(ze=n.RGB32UI),De===n.BYTE&&(ze=n.RGB8I),De===n.SHORT&&(ze=n.RGB16I),De===n.INT&&(ze=n.RGB32I)),de===n.RGBA_INTEGER&&(De===n.UNSIGNED_BYTE&&(ze=n.RGBA8UI),De===n.UNSIGNED_SHORT&&(ze=n.RGBA16UI),De===n.UNSIGNED_INT&&(ze=n.RGBA32UI),De===n.BYTE&&(ze=n.RGBA8I),De===n.SHORT&&(ze=n.RGBA16I),De===n.INT&&(ze=n.RGBA32I)),de===n.RGB&&De===n.UNSIGNED_INT_5_9_9_9_REV&&(ze=n.RGB9_E5),de===n.RGBA){const rt=dt?LinearTransfer:ColorManagement.getTransfer(nt);De===n.FLOAT&&(ze=n.RGBA32F),De===n.HALF_FLOAT&&(ze=n.RGBA16F),De===n.UNSIGNED_BYTE&&(ze=rt===SRGBTransfer?n.SRGB8_ALPHA8:n.RGBA8),De===n.UNSIGNED_SHORT_4_4_4_4&&(ze=n.RGBA4),De===n.UNSIGNED_SHORT_5_5_5_1&&(ze=n.RGB5_A1)}return(ze===n.R16F||ze===n.R32F||ze===n.RG16F||ze===n.RG32F||ze===n.RGBA16F||ze===n.RGBA32F)&&t.get("EXT_color_buffer_float"),ze}function K(ve,de){let De;return ve?de===null||de===UnsignedIntType||de===UnsignedInt248Type?De=n.DEPTH24_STENCIL8:de===FloatType?De=n.DEPTH32F_STENCIL8:de===UnsignedShortType&&(De=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):de===null||de===UnsignedIntType||de===UnsignedInt248Type?De=n.DEPTH_COMPONENT24:de===FloatType?De=n.DEPTH_COMPONENT32F:de===UnsignedShortType&&(De=n.DEPTH_COMPONENT16),De}function O(ve,de){return H(ve)===!0||ve.isFramebufferTexture&&ve.minFilter!==NearestFilter&&ve.minFilter!==LinearFilter?Math.log2(Math.max(de.width,de.height))+1:ve.mipmaps!==void 0&&ve.mipmaps.length>0?ve.mipmaps.length:ve.isCompressedTexture&&Array.isArray(ve.image)?de.mipmaps.length:1}function Q(ve){const de=ve.target;de.removeEventListener("dispose",Q),ie(de),de.isVideoTexture&&G.delete(de)}function ee(ve){const de=ve.target;de.removeEventListener("dispose",ee),se(de)}function ie(ve){const de=u.get(ve);if(de.__webglInit===void 0)return;const De=ve.source,nt=w.get(De);if(nt){const dt=nt[de.__cacheKey];dt.usedTimes--,dt.usedTimes===0&&te(ve),Object.keys(nt).length===0&&w.delete(De)}u.remove(ve)}function te(ve){const de=u.get(ve);n.deleteTexture(de.__webglTexture);const De=ve.source,nt=w.get(De);delete nt[de.__cacheKey],I.memory.textures--}function se(ve){const de=u.get(ve);if(ve.depthTexture&&(ve.depthTexture.dispose(),u.remove(ve.depthTexture)),ve.isWebGLCubeRenderTarget)for(let nt=0;nt<6;nt++){if(Array.isArray(de.__webglFramebuffer[nt]))for(let dt=0;dt<de.__webglFramebuffer[nt].length;dt++)n.deleteFramebuffer(de.__webglFramebuffer[nt][dt]);else n.deleteFramebuffer(de.__webglFramebuffer[nt]);de.__webglDepthbuffer&&n.deleteRenderbuffer(de.__webglDepthbuffer[nt])}else{if(Array.isArray(de.__webglFramebuffer))for(let nt=0;nt<de.__webglFramebuffer.length;nt++)n.deleteFramebuffer(de.__webglFramebuffer[nt]);else n.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&n.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&n.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let nt=0;nt<de.__webglColorRenderbuffer.length;nt++)de.__webglColorRenderbuffer[nt]&&n.deleteRenderbuffer(de.__webglColorRenderbuffer[nt]);de.__webglDepthRenderbuffer&&n.deleteRenderbuffer(de.__webglDepthRenderbuffer)}const De=ve.textures;for(let nt=0,dt=De.length;nt<dt;nt++){const ze=u.get(De[nt]);ze.__webglTexture&&(n.deleteTexture(ze.__webglTexture),I.memory.textures--),u.remove(De[nt])}u.remove(ve)}let ae=0;function le(){ae=0}function ge(){const ve=ae;return ve>=d.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ve+" texture units while this GPU supports only "+d.maxTextures),ae+=1,ve}function be(ve){const de=[];return de.push(ve.wrapS),de.push(ve.wrapT),de.push(ve.wrapR||0),de.push(ve.magFilter),de.push(ve.minFilter),de.push(ve.anisotropy),de.push(ve.internalFormat),de.push(ve.format),de.push(ve.type),de.push(ve.generateMipmaps),de.push(ve.premultiplyAlpha),de.push(ve.flipY),de.push(ve.unpackAlignment),de.push(ve.colorSpace),de.join()}function Xe(ve,de){const De=u.get(ve);if(ve.isVideoTexture&&at(ve),ve.isRenderTargetTexture===!1&&ve.version>0&&De.__version!==ve.version){const nt=ve.image;if(nt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(nt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{me(De,ve,de);return}}o.bindTexture(n.TEXTURE_2D,De.__webglTexture,n.TEXTURE0+de)}function Ce(ve,de){const De=u.get(ve);if(ve.version>0&&De.__version!==ve.version){me(De,ve,de);return}o.bindTexture(n.TEXTURE_2D_ARRAY,De.__webglTexture,n.TEXTURE0+de)}function Re(ve,de){const De=u.get(ve);if(ve.version>0&&De.__version!==ve.version){me(De,ve,de);return}o.bindTexture(n.TEXTURE_3D,De.__webglTexture,n.TEXTURE0+de)}function Se(ve,de){const De=u.get(ve);if(ve.version>0&&De.__version!==ve.version){xe(De,ve,de);return}o.bindTexture(n.TEXTURE_CUBE_MAP,De.__webglTexture,n.TEXTURE0+de)}const Ze={[RepeatWrapping]:n.REPEAT,[ClampToEdgeWrapping]:n.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:n.MIRRORED_REPEAT},he={[NearestFilter]:n.NEAREST,[NearestMipmapNearestFilter]:n.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:n.NEAREST_MIPMAP_LINEAR,[LinearFilter]:n.LINEAR,[LinearMipmapNearestFilter]:n.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:n.LINEAR_MIPMAP_LINEAR},Ie={[NeverCompare]:n.NEVER,[AlwaysCompare]:n.ALWAYS,[LessCompare]:n.LESS,[LessEqualCompare]:n.LEQUAL,[EqualCompare]:n.EQUAL,[GreaterEqualCompare]:n.GEQUAL,[GreaterCompare]:n.GREATER,[NotEqualCompare]:n.NOTEQUAL};function Be(ve,de){if(de.type===FloatType&&t.has("OES_texture_float_linear")===!1&&(de.magFilter===LinearFilter||de.magFilter===LinearMipmapNearestFilter||de.magFilter===NearestMipmapLinearFilter||de.magFilter===LinearMipmapLinearFilter||de.minFilter===LinearFilter||de.minFilter===LinearMipmapNearestFilter||de.minFilter===NearestMipmapLinearFilter||de.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ve,n.TEXTURE_WRAP_S,Ze[de.wrapS]),n.texParameteri(ve,n.TEXTURE_WRAP_T,Ze[de.wrapT]),(ve===n.TEXTURE_3D||ve===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ve,n.TEXTURE_WRAP_R,Ze[de.wrapR]),n.texParameteri(ve,n.TEXTURE_MAG_FILTER,he[de.magFilter]),n.texParameteri(ve,n.TEXTURE_MIN_FILTER,he[de.minFilter]),de.compareFunction&&(n.texParameteri(ve,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ve,n.TEXTURE_COMPARE_FUNC,Ie[de.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(de.magFilter===NearestFilter||de.minFilter!==NearestMipmapLinearFilter&&de.minFilter!==LinearMipmapLinearFilter||de.type===FloatType&&t.has("OES_texture_float_linear")===!1)return;if(de.anisotropy>1||u.get(de).__currentAnisotropy){const De=t.get("EXT_texture_filter_anisotropic");n.texParameterf(ve,De.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(de.anisotropy,d.getMaxAnisotropy())),u.get(de).__currentAnisotropy=de.anisotropy}}}function ue(ve,de){let De=!1;ve.__webglInit===void 0&&(ve.__webglInit=!0,de.addEventListener("dispose",Q));const nt=de.source;let dt=w.get(nt);dt===void 0&&(dt={},w.set(nt,dt));const ze=be(de);if(ze!==ve.__cacheKey){dt[ze]===void 0&&(dt[ze]={texture:n.createTexture(),usedTimes:0},I.memory.textures++,De=!0),dt[ze].usedTimes++;const rt=dt[ve.__cacheKey];rt!==void 0&&(dt[ve.__cacheKey].usedTimes--,rt.usedTimes===0&&te(de)),ve.__cacheKey=ze,ve.__webglTexture=dt[ze].texture}return De}function me(ve,de,De){let nt=n.TEXTURE_2D;(de.isDataArrayTexture||de.isCompressedArrayTexture)&&(nt=n.TEXTURE_2D_ARRAY),de.isData3DTexture&&(nt=n.TEXTURE_3D);const dt=ue(ve,de),ze=de.source;o.bindTexture(nt,ve.__webglTexture,n.TEXTURE0+De);const rt=u.get(ze);if(ze.version!==rt.__version||dt===!0){o.activeTexture(n.TEXTURE0+De);const Rt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),Mt=de.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(de.colorSpace),Yt=de.colorSpace===NoColorSpace||Rt===Mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,de.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,de.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Yt);let Oe=T(de.image,!1,d.maxTextureSize);Oe=Tt(de,Oe);const gt=C.convert(de.format,de.colorSpace),pt=C.convert(de.type);let mt=L(de.internalFormat,gt,pt,de.colorSpace,de.isVideoTexture);Be(nt,de);let It;const ye=de.mipmaps,Ye=de.isVideoTexture!==!0,_e=rt.__version===void 0||dt===!0,Ne=ze.dataReady,St=O(de,Oe);if(de.isDepthTexture)mt=K(de.format===DepthStencilFormat,de.type),_e&&(Ye?o.texStorage2D(n.TEXTURE_2D,1,mt,Oe.width,Oe.height):o.texImage2D(n.TEXTURE_2D,0,mt,Oe.width,Oe.height,0,gt,pt,null));else if(de.isDataTexture)if(ye.length>0){Ye&&_e&&o.texStorage2D(n.TEXTURE_2D,St,mt,ye[0].width,ye[0].height);for(let et=0,lt=ye.length;et<lt;et++)It=ye[et],Ye?Ne&&o.texSubImage2D(n.TEXTURE_2D,et,0,0,It.width,It.height,gt,pt,It.data):o.texImage2D(n.TEXTURE_2D,et,mt,It.width,It.height,0,gt,pt,It.data);de.generateMipmaps=!1}else Ye?(_e&&o.texStorage2D(n.TEXTURE_2D,St,mt,Oe.width,Oe.height),Ne&&o.texSubImage2D(n.TEXTURE_2D,0,0,0,Oe.width,Oe.height,gt,pt,Oe.data)):o.texImage2D(n.TEXTURE_2D,0,mt,Oe.width,Oe.height,0,gt,pt,Oe.data);else if(de.isCompressedTexture)if(de.isCompressedArrayTexture){Ye&&_e&&o.texStorage3D(n.TEXTURE_2D_ARRAY,St,mt,ye[0].width,ye[0].height,Oe.depth);for(let et=0,lt=ye.length;et<lt;et++)if(It=ye[et],de.format!==RGBAFormat)if(gt!==null)if(Ye){if(Ne)if(de.layerUpdates.size>0){const yt=getByteLength(It.width,It.height,de.format,de.type);for(const _t of de.layerUpdates){const Jt=It.data.subarray(_t*yt/It.data.BYTES_PER_ELEMENT,(_t+1)*yt/It.data.BYTES_PER_ELEMENT);o.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,_t,It.width,It.height,1,gt,Jt)}de.clearLayerUpdates()}else o.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,0,It.width,It.height,Oe.depth,gt,It.data)}else o.compressedTexImage3D(n.TEXTURE_2D_ARRAY,et,mt,It.width,It.height,Oe.depth,0,It.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ye?Ne&&o.texSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,0,It.width,It.height,Oe.depth,gt,pt,It.data):o.texImage3D(n.TEXTURE_2D_ARRAY,et,mt,It.width,It.height,Oe.depth,0,gt,pt,It.data)}else{Ye&&_e&&o.texStorage2D(n.TEXTURE_2D,St,mt,ye[0].width,ye[0].height);for(let et=0,lt=ye.length;et<lt;et++)It=ye[et],de.format!==RGBAFormat?gt!==null?Ye?Ne&&o.compressedTexSubImage2D(n.TEXTURE_2D,et,0,0,It.width,It.height,gt,It.data):o.compressedTexImage2D(n.TEXTURE_2D,et,mt,It.width,It.height,0,It.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ye?Ne&&o.texSubImage2D(n.TEXTURE_2D,et,0,0,It.width,It.height,gt,pt,It.data):o.texImage2D(n.TEXTURE_2D,et,mt,It.width,It.height,0,gt,pt,It.data)}else if(de.isDataArrayTexture)if(Ye){if(_e&&o.texStorage3D(n.TEXTURE_2D_ARRAY,St,mt,Oe.width,Oe.height,Oe.depth),Ne)if(de.layerUpdates.size>0){const et=getByteLength(Oe.width,Oe.height,de.format,de.type);for(const lt of de.layerUpdates){const yt=Oe.data.subarray(lt*et/Oe.data.BYTES_PER_ELEMENT,(lt+1)*et/Oe.data.BYTES_PER_ELEMENT);o.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,lt,Oe.width,Oe.height,1,gt,pt,yt)}de.clearLayerUpdates()}else o.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Oe.width,Oe.height,Oe.depth,gt,pt,Oe.data)}else o.texImage3D(n.TEXTURE_2D_ARRAY,0,mt,Oe.width,Oe.height,Oe.depth,0,gt,pt,Oe.data);else if(de.isData3DTexture)Ye?(_e&&o.texStorage3D(n.TEXTURE_3D,St,mt,Oe.width,Oe.height,Oe.depth),Ne&&o.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Oe.width,Oe.height,Oe.depth,gt,pt,Oe.data)):o.texImage3D(n.TEXTURE_3D,0,mt,Oe.width,Oe.height,Oe.depth,0,gt,pt,Oe.data);else if(de.isFramebufferTexture){if(_e)if(Ye)o.texStorage2D(n.TEXTURE_2D,St,mt,Oe.width,Oe.height);else{let et=Oe.width,lt=Oe.height;for(let yt=0;yt<St;yt++)o.texImage2D(n.TEXTURE_2D,yt,mt,et,lt,0,gt,pt,null),et>>=1,lt>>=1}}else if(ye.length>0){if(Ye&&_e){const et=xt(ye[0]);o.texStorage2D(n.TEXTURE_2D,St,mt,et.width,et.height)}for(let et=0,lt=ye.length;et<lt;et++)It=ye[et],Ye?Ne&&o.texSubImage2D(n.TEXTURE_2D,et,0,0,gt,pt,It):o.texImage2D(n.TEXTURE_2D,et,mt,gt,pt,It);de.generateMipmaps=!1}else if(Ye){if(_e){const et=xt(Oe);o.texStorage2D(n.TEXTURE_2D,St,mt,et.width,et.height)}Ne&&o.texSubImage2D(n.TEXTURE_2D,0,0,0,gt,pt,Oe)}else o.texImage2D(n.TEXTURE_2D,0,mt,gt,pt,Oe);H(de)&&J(nt),rt.__version=ze.version,de.onUpdate&&de.onUpdate(de)}ve.__version=de.version}function xe(ve,de,De){if(de.image.length!==6)return;const nt=ue(ve,de),dt=de.source;o.bindTexture(n.TEXTURE_CUBE_MAP,ve.__webglTexture,n.TEXTURE0+De);const ze=u.get(dt);if(dt.version!==ze.__version||nt===!0){o.activeTexture(n.TEXTURE0+De);const rt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),Rt=de.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(de.colorSpace),Mt=de.colorSpace===NoColorSpace||rt===Rt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,de.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,de.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Mt);const Yt=de.isCompressedTexture||de.image[0].isCompressedTexture,Oe=de.image[0]&&de.image[0].isDataTexture,gt=[];for(let lt=0;lt<6;lt++)!Yt&&!Oe?gt[lt]=T(de.image[lt],!0,d.maxCubemapSize):gt[lt]=Oe?de.image[lt].image:de.image[lt],gt[lt]=Tt(de,gt[lt]);const pt=gt[0],mt=C.convert(de.format,de.colorSpace),It=C.convert(de.type),ye=L(de.internalFormat,mt,It,de.colorSpace),Ye=de.isVideoTexture!==!0,_e=ze.__version===void 0||nt===!0,Ne=dt.dataReady;let St=O(de,pt);Be(n.TEXTURE_CUBE_MAP,de);let et;if(Yt){Ye&&_e&&o.texStorage2D(n.TEXTURE_CUBE_MAP,St,ye,pt.width,pt.height);for(let lt=0;lt<6;lt++){et=gt[lt].mipmaps;for(let yt=0;yt<et.length;yt++){const _t=et[yt];de.format!==RGBAFormat?mt!==null?Ye?Ne&&o.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt,0,0,_t.width,_t.height,mt,_t.data):o.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt,ye,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ye?Ne&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt,0,0,_t.width,_t.height,mt,It,_t.data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt,ye,_t.width,_t.height,0,mt,It,_t.data)}}}else{if(et=de.mipmaps,Ye&&_e){et.length>0&&St++;const lt=xt(gt[0]);o.texStorage2D(n.TEXTURE_CUBE_MAP,St,ye,lt.width,lt.height)}for(let lt=0;lt<6;lt++)if(Oe){Ye?Ne&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,gt[lt].width,gt[lt].height,mt,It,gt[lt].data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,ye,gt[lt].width,gt[lt].height,0,mt,It,gt[lt].data);for(let yt=0;yt<et.length;yt++){const Jt=et[yt].image[lt].image;Ye?Ne&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt+1,0,0,Jt.width,Jt.height,mt,It,Jt.data):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt+1,ye,Jt.width,Jt.height,0,mt,It,Jt.data)}}else{Ye?Ne&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,mt,It,gt[lt]):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,ye,mt,It,gt[lt]);for(let yt=0;yt<et.length;yt++){const _t=et[yt];Ye?Ne&&o.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt+1,0,0,mt,It,_t.image[lt]):o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,yt+1,ye,mt,It,_t.image[lt])}}}H(de)&&J(n.TEXTURE_CUBE_MAP),ze.__version=dt.version,de.onUpdate&&de.onUpdate(de)}ve.__version=de.version}function Je(ve,de,De,nt,dt,ze){const rt=C.convert(De.format,De.colorSpace),Rt=C.convert(De.type),Mt=L(De.internalFormat,rt,Rt,De.colorSpace),Yt=u.get(de),Oe=u.get(De);if(Oe.__renderTarget=de,!Yt.__hasExternalTextures){const gt=Math.max(1,de.width>>ze),pt=Math.max(1,de.height>>ze);dt===n.TEXTURE_3D||dt===n.TEXTURE_2D_ARRAY?o.texImage3D(dt,ze,Mt,gt,pt,de.depth,0,rt,Rt,null):o.texImage2D(dt,ze,Mt,gt,pt,0,rt,Rt,null)}o.bindFramebuffer(n.FRAMEBUFFER,ve),vt(de)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,nt,dt,Oe.__webglTexture,0,ot(de)):(dt===n.TEXTURE_2D||dt>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&dt<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,nt,dt,Oe.__webglTexture,ze),o.bindFramebuffer(n.FRAMEBUFFER,null)}function Ve(ve,de,De){if(n.bindRenderbuffer(n.RENDERBUFFER,ve),de.depthBuffer){const nt=de.depthTexture,dt=nt&&nt.isDepthTexture?nt.type:null,ze=K(de.stencilBuffer,dt),rt=de.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Rt=ot(de);vt(de)?f.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Rt,ze,de.width,de.height):De?n.renderbufferStorageMultisample(n.RENDERBUFFER,Rt,ze,de.width,de.height):n.renderbufferStorage(n.RENDERBUFFER,ze,de.width,de.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,rt,n.RENDERBUFFER,ve)}else{const nt=de.textures;for(let dt=0;dt<nt.length;dt++){const ze=nt[dt],rt=C.convert(ze.format,ze.colorSpace),Rt=C.convert(ze.type),Mt=L(ze.internalFormat,rt,Rt,ze.colorSpace),Yt=ot(de);De&&vt(de)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Yt,Mt,de.width,de.height):vt(de)?f.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Yt,Mt,de.width,de.height):n.renderbufferStorage(n.RENDERBUFFER,Mt,de.width,de.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ee(ve,de){if(de&&de.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(n.FRAMEBUFFER,ve),!(de.depthTexture&&de.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const nt=u.get(de.depthTexture);nt.__renderTarget=de,(!nt.__webglTexture||de.depthTexture.image.width!==de.width||de.depthTexture.image.height!==de.height)&&(de.depthTexture.image.width=de.width,de.depthTexture.image.height=de.height,de.depthTexture.needsUpdate=!0),Xe(de.depthTexture,0);const dt=nt.__webglTexture,ze=ot(de);if(de.depthTexture.format===DepthFormat)vt(de)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,dt,0,ze):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,dt,0);else if(de.depthTexture.format===DepthStencilFormat)vt(de)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,dt,0,ze):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,dt,0);else throw new Error("Unknown depthTexture format")}function Ct(ve){const de=u.get(ve),De=ve.isWebGLCubeRenderTarget===!0;if(de.__boundDepthTexture!==ve.depthTexture){const nt=ve.depthTexture;if(de.__depthDisposeCallback&&de.__depthDisposeCallback(),nt){const dt=()=>{delete de.__boundDepthTexture,delete de.__depthDisposeCallback,nt.removeEventListener("dispose",dt)};nt.addEventListener("dispose",dt),de.__depthDisposeCallback=dt}de.__boundDepthTexture=nt}if(ve.depthTexture&&!de.__autoAllocateDepthBuffer){if(De)throw new Error("target.depthTexture not supported in Cube render targets");Ee(de.__webglFramebuffer,ve)}else if(De){de.__webglDepthbuffer=[];for(let nt=0;nt<6;nt++)if(o.bindFramebuffer(n.FRAMEBUFFER,de.__webglFramebuffer[nt]),de.__webglDepthbuffer[nt]===void 0)de.__webglDepthbuffer[nt]=n.createRenderbuffer(),Ve(de.__webglDepthbuffer[nt],ve,!1);else{const dt=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ze=de.__webglDepthbuffer[nt];n.bindRenderbuffer(n.RENDERBUFFER,ze),n.framebufferRenderbuffer(n.FRAMEBUFFER,dt,n.RENDERBUFFER,ze)}}else if(o.bindFramebuffer(n.FRAMEBUFFER,de.__webglFramebuffer),de.__webglDepthbuffer===void 0)de.__webglDepthbuffer=n.createRenderbuffer(),Ve(de.__webglDepthbuffer,ve,!1);else{const nt=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,dt=de.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,dt),n.framebufferRenderbuffer(n.FRAMEBUFFER,nt,n.RENDERBUFFER,dt)}o.bindFramebuffer(n.FRAMEBUFFER,null)}function st(ve,de,De){const nt=u.get(ve);de!==void 0&&Je(nt.__webglFramebuffer,ve,ve.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),De!==void 0&&Ct(ve)}function wt(ve){const de=ve.texture,De=u.get(ve),nt=u.get(de);ve.addEventListener("dispose",ee);const dt=ve.textures,ze=ve.isWebGLCubeRenderTarget===!0,rt=dt.length>1;if(rt||(nt.__webglTexture===void 0&&(nt.__webglTexture=n.createTexture()),nt.__version=de.version,I.memory.textures++),ze){De.__webglFramebuffer=[];for(let Rt=0;Rt<6;Rt++)if(de.mipmaps&&de.mipmaps.length>0){De.__webglFramebuffer[Rt]=[];for(let Mt=0;Mt<de.mipmaps.length;Mt++)De.__webglFramebuffer[Rt][Mt]=n.createFramebuffer()}else De.__webglFramebuffer[Rt]=n.createFramebuffer()}else{if(de.mipmaps&&de.mipmaps.length>0){De.__webglFramebuffer=[];for(let Rt=0;Rt<de.mipmaps.length;Rt++)De.__webglFramebuffer[Rt]=n.createFramebuffer()}else De.__webglFramebuffer=n.createFramebuffer();if(rt)for(let Rt=0,Mt=dt.length;Rt<Mt;Rt++){const Yt=u.get(dt[Rt]);Yt.__webglTexture===void 0&&(Yt.__webglTexture=n.createTexture(),I.memory.textures++)}if(ve.samples>0&&vt(ve)===!1){De.__webglMultisampledFramebuffer=n.createFramebuffer(),De.__webglColorRenderbuffer=[],o.bindFramebuffer(n.FRAMEBUFFER,De.__webglMultisampledFramebuffer);for(let Rt=0;Rt<dt.length;Rt++){const Mt=dt[Rt];De.__webglColorRenderbuffer[Rt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,De.__webglColorRenderbuffer[Rt]);const Yt=C.convert(Mt.format,Mt.colorSpace),Oe=C.convert(Mt.type),gt=L(Mt.internalFormat,Yt,Oe,Mt.colorSpace,ve.isXRRenderTarget===!0),pt=ot(ve);n.renderbufferStorageMultisample(n.RENDERBUFFER,pt,gt,ve.width,ve.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Rt,n.RENDERBUFFER,De.__webglColorRenderbuffer[Rt])}n.bindRenderbuffer(n.RENDERBUFFER,null),ve.depthBuffer&&(De.__webglDepthRenderbuffer=n.createRenderbuffer(),Ve(De.__webglDepthRenderbuffer,ve,!0)),o.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ze){o.bindTexture(n.TEXTURE_CUBE_MAP,nt.__webglTexture),Be(n.TEXTURE_CUBE_MAP,de);for(let Rt=0;Rt<6;Rt++)if(de.mipmaps&&de.mipmaps.length>0)for(let Mt=0;Mt<de.mipmaps.length;Mt++)Je(De.__webglFramebuffer[Rt][Mt],ve,de,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Rt,Mt);else Je(De.__webglFramebuffer[Rt],ve,de,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Rt,0);H(de)&&J(n.TEXTURE_CUBE_MAP),o.unbindTexture()}else if(rt){for(let Rt=0,Mt=dt.length;Rt<Mt;Rt++){const Yt=dt[Rt],Oe=u.get(Yt);o.bindTexture(n.TEXTURE_2D,Oe.__webglTexture),Be(n.TEXTURE_2D,Yt),Je(De.__webglFramebuffer,ve,Yt,n.COLOR_ATTACHMENT0+Rt,n.TEXTURE_2D,0),H(Yt)&&J(n.TEXTURE_2D)}o.unbindTexture()}else{let Rt=n.TEXTURE_2D;if((ve.isWebGL3DRenderTarget||ve.isWebGLArrayRenderTarget)&&(Rt=ve.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),o.bindTexture(Rt,nt.__webglTexture),Be(Rt,de),de.mipmaps&&de.mipmaps.length>0)for(let Mt=0;Mt<de.mipmaps.length;Mt++)Je(De.__webglFramebuffer[Mt],ve,de,n.COLOR_ATTACHMENT0,Rt,Mt);else Je(De.__webglFramebuffer,ve,de,n.COLOR_ATTACHMENT0,Rt,0);H(de)&&J(Rt),o.unbindTexture()}ve.depthBuffer&&Ct(ve)}function Qe(ve){const de=ve.textures;for(let De=0,nt=de.length;De<nt;De++){const dt=de[De];if(H(dt)){const ze=z(ve),rt=u.get(dt).__webglTexture;o.bindTexture(ze,rt),J(ze),o.unbindTexture()}}}const Ue=[],Ge=[];function Gt(ve){if(ve.samples>0){if(vt(ve)===!1){const de=ve.textures,De=ve.width,nt=ve.height;let dt=n.COLOR_BUFFER_BIT;const ze=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,rt=u.get(ve),Rt=de.length>1;if(Rt)for(let Mt=0;Mt<de.length;Mt++)o.bindFramebuffer(n.FRAMEBUFFER,rt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.RENDERBUFFER,null),o.bindFramebuffer(n.FRAMEBUFFER,rt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.TEXTURE_2D,null,0);o.bindFramebuffer(n.READ_FRAMEBUFFER,rt.__webglMultisampledFramebuffer),o.bindFramebuffer(n.DRAW_FRAMEBUFFER,rt.__webglFramebuffer);for(let Mt=0;Mt<de.length;Mt++){if(ve.resolveDepthBuffer&&(ve.depthBuffer&&(dt|=n.DEPTH_BUFFER_BIT),ve.stencilBuffer&&ve.resolveStencilBuffer&&(dt|=n.STENCIL_BUFFER_BIT)),Rt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,rt.__webglColorRenderbuffer[Mt]);const Yt=u.get(de[Mt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Yt,0)}n.blitFramebuffer(0,0,De,nt,0,0,De,nt,dt,n.NEAREST),A===!0&&(Ue.length=0,Ge.length=0,Ue.push(n.COLOR_ATTACHMENT0+Mt),ve.depthBuffer&&ve.resolveDepthBuffer===!1&&(Ue.push(ze),Ge.push(ze),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Ge)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Ue))}if(o.bindFramebuffer(n.READ_FRAMEBUFFER,null),o.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Rt)for(let Mt=0;Mt<de.length;Mt++){o.bindFramebuffer(n.FRAMEBUFFER,rt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.RENDERBUFFER,rt.__webglColorRenderbuffer[Mt]);const Yt=u.get(de[Mt]).__webglTexture;o.bindFramebuffer(n.FRAMEBUFFER,rt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.TEXTURE_2D,Yt,0)}o.bindFramebuffer(n.DRAW_FRAMEBUFFER,rt.__webglMultisampledFramebuffer)}else if(ve.depthBuffer&&ve.resolveDepthBuffer===!1&&A){const de=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[de])}}}function ot(ve){return Math.min(d.maxSamples,ve.samples)}function vt(ve){const de=u.get(ve);return ve.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&de.__useRenderToTexture!==!1}function at(ve){const de=I.render.frame;G.get(ve)!==de&&(G.set(ve,de),ve.update())}function Tt(ve,de){const De=ve.colorSpace,nt=ve.format,dt=ve.type;return ve.isCompressedTexture===!0||ve.isVideoTexture===!0||De!==LinearSRGBColorSpace&&De!==NoColorSpace&&(ColorManagement.getTransfer(De)===SRGBTransfer?(nt!==RGBAFormat||dt!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",De)),de}function xt(ve){return typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement?(y.width=ve.naturalWidth||ve.width,y.height=ve.naturalHeight||ve.height):typeof VideoFrame<"u"&&ve instanceof VideoFrame?(y.width=ve.displayWidth,y.height=ve.displayHeight):(y.width=ve.width,y.height=ve.height),y}this.allocateTextureUnit=ge,this.resetTextureUnits=le,this.setTexture2D=Xe,this.setTexture2DArray=Ce,this.setTexture3D=Re,this.setTextureCube=Se,this.rebindTextures=st,this.setupRenderTarget=wt,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=Gt,this.setupDepthRenderbuffer=Ct,this.setupFrameBufferTexture=Je,this.useMultisampledRTT=vt}function WebGLUtils(n,t){function o(u,d=NoColorSpace){let C;const I=ColorManagement.getTransfer(d);if(u===UnsignedByteType)return n.UNSIGNED_BYTE;if(u===UnsignedShort4444Type)return n.UNSIGNED_SHORT_4_4_4_4;if(u===UnsignedShort5551Type)return n.UNSIGNED_SHORT_5_5_5_1;if(u===UnsignedInt5999Type)return n.UNSIGNED_INT_5_9_9_9_REV;if(u===ByteType)return n.BYTE;if(u===ShortType)return n.SHORT;if(u===UnsignedShortType)return n.UNSIGNED_SHORT;if(u===IntType)return n.INT;if(u===UnsignedIntType)return n.UNSIGNED_INT;if(u===FloatType)return n.FLOAT;if(u===HalfFloatType)return n.HALF_FLOAT;if(u===AlphaFormat)return n.ALPHA;if(u===RGBFormat)return n.RGB;if(u===RGBAFormat)return n.RGBA;if(u===LuminanceFormat)return n.LUMINANCE;if(u===LuminanceAlphaFormat)return n.LUMINANCE_ALPHA;if(u===DepthFormat)return n.DEPTH_COMPONENT;if(u===DepthStencilFormat)return n.DEPTH_STENCIL;if(u===RedFormat)return n.RED;if(u===RedIntegerFormat)return n.RED_INTEGER;if(u===RGFormat)return n.RG;if(u===RGIntegerFormat)return n.RG_INTEGER;if(u===RGBAIntegerFormat)return n.RGBA_INTEGER;if(u===RGB_S3TC_DXT1_Format||u===RGBA_S3TC_DXT1_Format||u===RGBA_S3TC_DXT3_Format||u===RGBA_S3TC_DXT5_Format)if(I===SRGBTransfer)if(C=t.get("WEBGL_compressed_texture_s3tc_srgb"),C!==null){if(u===RGB_S3TC_DXT1_Format)return C.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(u===RGBA_S3TC_DXT1_Format)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(u===RGBA_S3TC_DXT3_Format)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(u===RGBA_S3TC_DXT5_Format)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(C=t.get("WEBGL_compressed_texture_s3tc"),C!==null){if(u===RGB_S3TC_DXT1_Format)return C.COMPRESSED_RGB_S3TC_DXT1_EXT;if(u===RGBA_S3TC_DXT1_Format)return C.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(u===RGBA_S3TC_DXT3_Format)return C.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(u===RGBA_S3TC_DXT5_Format)return C.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(u===RGB_PVRTC_4BPPV1_Format||u===RGB_PVRTC_2BPPV1_Format||u===RGBA_PVRTC_4BPPV1_Format||u===RGBA_PVRTC_2BPPV1_Format)if(C=t.get("WEBGL_compressed_texture_pvrtc"),C!==null){if(u===RGB_PVRTC_4BPPV1_Format)return C.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(u===RGB_PVRTC_2BPPV1_Format)return C.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(u===RGBA_PVRTC_4BPPV1_Format)return C.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(u===RGBA_PVRTC_2BPPV1_Format)return C.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(u===RGB_ETC1_Format||u===RGB_ETC2_Format||u===RGBA_ETC2_EAC_Format)if(C=t.get("WEBGL_compressed_texture_etc"),C!==null){if(u===RGB_ETC1_Format||u===RGB_ETC2_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ETC2:C.COMPRESSED_RGB8_ETC2;if(u===RGBA_ETC2_EAC_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:C.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(u===RGBA_ASTC_4x4_Format||u===RGBA_ASTC_5x4_Format||u===RGBA_ASTC_5x5_Format||u===RGBA_ASTC_6x5_Format||u===RGBA_ASTC_6x6_Format||u===RGBA_ASTC_8x5_Format||u===RGBA_ASTC_8x6_Format||u===RGBA_ASTC_8x8_Format||u===RGBA_ASTC_10x5_Format||u===RGBA_ASTC_10x6_Format||u===RGBA_ASTC_10x8_Format||u===RGBA_ASTC_10x10_Format||u===RGBA_ASTC_12x10_Format||u===RGBA_ASTC_12x12_Format)if(C=t.get("WEBGL_compressed_texture_astc"),C!==null){if(u===RGBA_ASTC_4x4_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:C.COMPRESSED_RGBA_ASTC_4x4_KHR;if(u===RGBA_ASTC_5x4_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:C.COMPRESSED_RGBA_ASTC_5x4_KHR;if(u===RGBA_ASTC_5x5_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:C.COMPRESSED_RGBA_ASTC_5x5_KHR;if(u===RGBA_ASTC_6x5_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:C.COMPRESSED_RGBA_ASTC_6x5_KHR;if(u===RGBA_ASTC_6x6_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:C.COMPRESSED_RGBA_ASTC_6x6_KHR;if(u===RGBA_ASTC_8x5_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:C.COMPRESSED_RGBA_ASTC_8x5_KHR;if(u===RGBA_ASTC_8x6_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:C.COMPRESSED_RGBA_ASTC_8x6_KHR;if(u===RGBA_ASTC_8x8_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:C.COMPRESSED_RGBA_ASTC_8x8_KHR;if(u===RGBA_ASTC_10x5_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:C.COMPRESSED_RGBA_ASTC_10x5_KHR;if(u===RGBA_ASTC_10x6_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:C.COMPRESSED_RGBA_ASTC_10x6_KHR;if(u===RGBA_ASTC_10x8_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:C.COMPRESSED_RGBA_ASTC_10x8_KHR;if(u===RGBA_ASTC_10x10_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:C.COMPRESSED_RGBA_ASTC_10x10_KHR;if(u===RGBA_ASTC_12x10_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:C.COMPRESSED_RGBA_ASTC_12x10_KHR;if(u===RGBA_ASTC_12x12_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:C.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(u===RGBA_BPTC_Format||u===RGB_BPTC_SIGNED_Format||u===RGB_BPTC_UNSIGNED_Format)if(C=t.get("EXT_texture_compression_bptc"),C!==null){if(u===RGBA_BPTC_Format)return I===SRGBTransfer?C.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:C.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(u===RGB_BPTC_SIGNED_Format)return C.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(u===RGB_BPTC_UNSIGNED_Format)return C.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(u===RED_RGTC1_Format||u===SIGNED_RED_RGTC1_Format||u===RED_GREEN_RGTC2_Format||u===SIGNED_RED_GREEN_RGTC2_Format)if(C=t.get("EXT_texture_compression_rgtc"),C!==null){if(u===RGBA_BPTC_Format)return C.COMPRESSED_RED_RGTC1_EXT;if(u===SIGNED_RED_RGTC1_Format)return C.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(u===RED_GREEN_RGTC2_Format)return C.COMPRESSED_RED_GREEN_RGTC2_EXT;if(u===SIGNED_RED_GREEN_RGTC2_Format)return C.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return u===UnsignedInt248Type?n.UNSIGNED_INT_24_8:n[u]!==void 0?n[u]:null}return{convert:o}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,o,u){if(this.texture===null){const d=new Texture,C=t.properties.get(d);C.__webglTexture=o.texture,(o.depthNear!==u.depthNear||o.depthFar!==u.depthFar)&&(this.depthNear=o.depthNear,this.depthFar=o.depthFar),this.texture=d}}getMesh(t){if(this.texture!==null&&this.mesh===null){const o=t.cameras[0].viewport,u=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:o.z},depthHeight:{value:o.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),u)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher$1{constructor(t,o){super();const u=this;let d=null,C=1,I=null,f="local-floor",A=1,y=null,G=null,S=null,w=null,M=null,V=null;const T=new WebXRDepthSensing,H=o.getContextAttributes();let J=null,z=null;const L=[],K=[],O=new Vector2;let Q=null;const ee=new PerspectiveCamera;ee.viewport=new Vector4;const ie=new PerspectiveCamera;ie.viewport=new Vector4;const te=[ee,ie],se=new ArrayCamera;let ae=null,le=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(me){let xe=L[me];return xe===void 0&&(xe=new WebXRController,L[me]=xe),xe.getTargetRaySpace()},this.getControllerGrip=function(me){let xe=L[me];return xe===void 0&&(xe=new WebXRController,L[me]=xe),xe.getGripSpace()},this.getHand=function(me){let xe=L[me];return xe===void 0&&(xe=new WebXRController,L[me]=xe),xe.getHandSpace()};function ge(me){const xe=K.indexOf(me.inputSource);if(xe===-1)return;const Je=L[xe];Je!==void 0&&(Je.update(me.inputSource,me.frame,y||I),Je.dispatchEvent({type:me.type,data:me.inputSource}))}function be(){d.removeEventListener("select",ge),d.removeEventListener("selectstart",ge),d.removeEventListener("selectend",ge),d.removeEventListener("squeeze",ge),d.removeEventListener("squeezestart",ge),d.removeEventListener("squeezeend",ge),d.removeEventListener("end",be),d.removeEventListener("inputsourceschange",Xe);for(let me=0;me<L.length;me++){const xe=K[me];xe!==null&&(K[me]=null,L[me].disconnect(xe))}ae=null,le=null,T.reset(),t.setRenderTarget(J),M=null,w=null,S=null,d=null,z=null,ue.stop(),u.isPresenting=!1,t.setPixelRatio(Q),t.setSize(O.width,O.height,!1),u.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(me){C=me,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(me){f=me,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return y||I},this.setReferenceSpace=function(me){y=me},this.getBaseLayer=function(){return w!==null?w:M},this.getBinding=function(){return S},this.getFrame=function(){return V},this.getSession=function(){return d},this.setSession=async function(me){if(d=me,d!==null){if(J=t.getRenderTarget(),d.addEventListener("select",ge),d.addEventListener("selectstart",ge),d.addEventListener("selectend",ge),d.addEventListener("squeeze",ge),d.addEventListener("squeezestart",ge),d.addEventListener("squeezeend",ge),d.addEventListener("end",be),d.addEventListener("inputsourceschange",Xe),H.xrCompatible!==!0&&await o.makeXRCompatible(),Q=t.getPixelRatio(),t.getSize(O),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Je=null,Ve=null,Ee=null;H.depth&&(Ee=H.stencil?o.DEPTH24_STENCIL8:o.DEPTH_COMPONENT24,Je=H.stencil?DepthStencilFormat:DepthFormat,Ve=H.stencil?UnsignedInt248Type:UnsignedIntType);const Ct={colorFormat:o.RGBA8,depthFormat:Ee,scaleFactor:C};S=new XRWebGLBinding(d,o),w=S.createProjectionLayer(Ct),d.updateRenderState({layers:[w]}),t.setPixelRatio(1),t.setSize(w.textureWidth,w.textureHeight,!1),z=new WebGLRenderTarget(w.textureWidth,w.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(w.textureWidth,w.textureHeight,Ve,void 0,void 0,void 0,void 0,void 0,void 0,Je),stencilBuffer:H.stencil,colorSpace:t.outputColorSpace,samples:H.antialias?4:0,resolveDepthBuffer:w.ignoreDepthValues===!1,resolveStencilBuffer:w.ignoreDepthValues===!1})}else{const Je={antialias:H.antialias,alpha:!0,depth:H.depth,stencil:H.stencil,framebufferScaleFactor:C};M=new XRWebGLLayer(d,o,Je),d.updateRenderState({baseLayer:M}),t.setPixelRatio(1),t.setSize(M.framebufferWidth,M.framebufferHeight,!1),z=new WebGLRenderTarget(M.framebufferWidth,M.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:t.outputColorSpace,stencilBuffer:H.stencil,resolveDepthBuffer:M.ignoreDepthValues===!1,resolveStencilBuffer:M.ignoreDepthValues===!1})}z.isXRRenderTarget=!0,this.setFoveation(A),y=null,I=await d.requestReferenceSpace(f),ue.setContext(d),ue.start(),u.isPresenting=!0,u.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(d!==null)return d.environmentBlendMode},this.getDepthTexture=function(){return T.getDepthTexture()};function Xe(me){for(let xe=0;xe<me.removed.length;xe++){const Je=me.removed[xe],Ve=K.indexOf(Je);Ve>=0&&(K[Ve]=null,L[Ve].disconnect(Je))}for(let xe=0;xe<me.added.length;xe++){const Je=me.added[xe];let Ve=K.indexOf(Je);if(Ve===-1){for(let Ct=0;Ct<L.length;Ct++)if(Ct>=K.length){K.push(Je),Ve=Ct;break}else if(K[Ct]===null){K[Ct]=Je,Ve=Ct;break}if(Ve===-1)break}const Ee=L[Ve];Ee&&Ee.connect(Je)}}const Ce=new Vector3,Re=new Vector3;function Se(me,xe,Je){Ce.setFromMatrixPosition(xe.matrixWorld),Re.setFromMatrixPosition(Je.matrixWorld);const Ve=Ce.distanceTo(Re),Ee=xe.projectionMatrix.elements,Ct=Je.projectionMatrix.elements,st=Ee[14]/(Ee[10]-1),wt=Ee[14]/(Ee[10]+1),Qe=(Ee[9]+1)/Ee[5],Ue=(Ee[9]-1)/Ee[5],Ge=(Ee[8]-1)/Ee[0],Gt=(Ct[8]+1)/Ct[0],ot=st*Ge,vt=st*Gt,at=Ve/(-Ge+Gt),Tt=at*-Ge;if(xe.matrixWorld.decompose(me.position,me.quaternion,me.scale),me.translateX(Tt),me.translateZ(at),me.matrixWorld.compose(me.position,me.quaternion,me.scale),me.matrixWorldInverse.copy(me.matrixWorld).invert(),Ee[10]===-1)me.projectionMatrix.copy(xe.projectionMatrix),me.projectionMatrixInverse.copy(xe.projectionMatrixInverse);else{const xt=st+at,ve=wt+at,de=ot-Tt,De=vt+(Ve-Tt),nt=Qe*wt/ve*xt,dt=Ue*wt/ve*xt;me.projectionMatrix.makePerspective(de,De,nt,dt,xt,ve),me.projectionMatrixInverse.copy(me.projectionMatrix).invert()}}function Ze(me,xe){xe===null?me.matrixWorld.copy(me.matrix):me.matrixWorld.multiplyMatrices(xe.matrixWorld,me.matrix),me.matrixWorldInverse.copy(me.matrixWorld).invert()}this.updateCamera=function(me){if(d===null)return;let xe=me.near,Je=me.far;T.texture!==null&&(T.depthNear>0&&(xe=T.depthNear),T.depthFar>0&&(Je=T.depthFar)),se.near=ie.near=ee.near=xe,se.far=ie.far=ee.far=Je,(ae!==se.near||le!==se.far)&&(d.updateRenderState({depthNear:se.near,depthFar:se.far}),ae=se.near,le=se.far),ee.layers.mask=me.layers.mask|2,ie.layers.mask=me.layers.mask|4,se.layers.mask=ee.layers.mask|ie.layers.mask;const Ve=me.parent,Ee=se.cameras;Ze(se,Ve);for(let Ct=0;Ct<Ee.length;Ct++)Ze(Ee[Ct],Ve);Ee.length===2?Se(se,ee,ie):se.projectionMatrix.copy(ee.projectionMatrix),he(me,se,Ve)};function he(me,xe,Je){Je===null?me.matrix.copy(xe.matrixWorld):(me.matrix.copy(Je.matrixWorld),me.matrix.invert(),me.matrix.multiply(xe.matrixWorld)),me.matrix.decompose(me.position,me.quaternion,me.scale),me.updateMatrixWorld(!0),me.projectionMatrix.copy(xe.projectionMatrix),me.projectionMatrixInverse.copy(xe.projectionMatrixInverse),me.isPerspectiveCamera&&(me.fov=RAD2DEG*2*Math.atan(1/me.projectionMatrix.elements[5]),me.zoom=1)}this.getCamera=function(){return se},this.getFoveation=function(){if(!(w===null&&M===null))return A},this.setFoveation=function(me){A=me,w!==null&&(w.fixedFoveation=me),M!==null&&M.fixedFoveation!==void 0&&(M.fixedFoveation=me)},this.hasDepthSensing=function(){return T.texture!==null},this.getDepthSensingMesh=function(){return T.getMesh(se)};let Ie=null;function Be(me,xe){if(G=xe.getViewerPose(y||I),V=xe,G!==null){const Je=G.views;M!==null&&(t.setRenderTargetFramebuffer(z,M.framebuffer),t.setRenderTarget(z));let Ve=!1;Je.length!==se.cameras.length&&(se.cameras.length=0,Ve=!0);for(let st=0;st<Je.length;st++){const wt=Je[st];let Qe=null;if(M!==null)Qe=M.getViewport(wt);else{const Ge=S.getViewSubImage(w,wt);Qe=Ge.viewport,st===0&&(t.setRenderTargetTextures(z,Ge.colorTexture,w.ignoreDepthValues?void 0:Ge.depthStencilTexture),t.setRenderTarget(z))}let Ue=te[st];Ue===void 0&&(Ue=new PerspectiveCamera,Ue.layers.enable(st),Ue.viewport=new Vector4,te[st]=Ue),Ue.matrix.fromArray(wt.transform.matrix),Ue.matrix.decompose(Ue.position,Ue.quaternion,Ue.scale),Ue.projectionMatrix.fromArray(wt.projectionMatrix),Ue.projectionMatrixInverse.copy(Ue.projectionMatrix).invert(),Ue.viewport.set(Qe.x,Qe.y,Qe.width,Qe.height),st===0&&(se.matrix.copy(Ue.matrix),se.matrix.decompose(se.position,se.quaternion,se.scale)),Ve===!0&&se.cameras.push(Ue)}const Ee=d.enabledFeatures;if(Ee&&Ee.includes("depth-sensing")&&d.depthUsage=="gpu-optimized"&&S){const st=S.getDepthInformation(Je[0]);st&&st.isValid&&st.texture&&T.init(t,st,d.renderState)}}for(let Je=0;Je<L.length;Je++){const Ve=K[Je],Ee=L[Je];Ve!==null&&Ee!==void 0&&Ee.update(Ve,xe,y||I)}Ie&&Ie(me,xe),xe.detectedPlanes&&u.dispatchEvent({type:"planesdetected",data:xe}),V=null}const ue=new WebGLAnimation;ue.setAnimationLoop(Be),this.setAnimationLoop=function(me){Ie=me},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(n,t){function o(H,J){H.matrixAutoUpdate===!0&&H.updateMatrix(),J.value.copy(H.matrix)}function u(H,J){J.color.getRGB(H.fogColor.value,getUnlitUniformColorSpace(n)),J.isFog?(H.fogNear.value=J.near,H.fogFar.value=J.far):J.isFogExp2&&(H.fogDensity.value=J.density)}function d(H,J,z,L,K){J.isMeshBasicMaterial||J.isMeshLambertMaterial?C(H,J):J.isMeshToonMaterial?(C(H,J),S(H,J)):J.isMeshPhongMaterial?(C(H,J),G(H,J)):J.isMeshStandardMaterial?(C(H,J),w(H,J),J.isMeshPhysicalMaterial&&M(H,J,K)):J.isMeshMatcapMaterial?(C(H,J),V(H,J)):J.isMeshDepthMaterial?C(H,J):J.isMeshDistanceMaterial?(C(H,J),T(H,J)):J.isMeshNormalMaterial?C(H,J):J.isLineBasicMaterial?(I(H,J),J.isLineDashedMaterial&&f(H,J)):J.isPointsMaterial?A(H,J,z,L):J.isSpriteMaterial?y(H,J):J.isShadowMaterial?(H.color.value.copy(J.color),H.opacity.value=J.opacity):J.isShaderMaterial&&(J.uniformsNeedUpdate=!1)}function C(H,J){H.opacity.value=J.opacity,J.color&&H.diffuse.value.copy(J.color),J.emissive&&H.emissive.value.copy(J.emissive).multiplyScalar(J.emissiveIntensity),J.map&&(H.map.value=J.map,o(J.map,H.mapTransform)),J.alphaMap&&(H.alphaMap.value=J.alphaMap,o(J.alphaMap,H.alphaMapTransform)),J.bumpMap&&(H.bumpMap.value=J.bumpMap,o(J.bumpMap,H.bumpMapTransform),H.bumpScale.value=J.bumpScale,J.side===BackSide&&(H.bumpScale.value*=-1)),J.normalMap&&(H.normalMap.value=J.normalMap,o(J.normalMap,H.normalMapTransform),H.normalScale.value.copy(J.normalScale),J.side===BackSide&&H.normalScale.value.negate()),J.displacementMap&&(H.displacementMap.value=J.displacementMap,o(J.displacementMap,H.displacementMapTransform),H.displacementScale.value=J.displacementScale,H.displacementBias.value=J.displacementBias),J.emissiveMap&&(H.emissiveMap.value=J.emissiveMap,o(J.emissiveMap,H.emissiveMapTransform)),J.specularMap&&(H.specularMap.value=J.specularMap,o(J.specularMap,H.specularMapTransform)),J.alphaTest>0&&(H.alphaTest.value=J.alphaTest);const z=t.get(J),L=z.envMap,K=z.envMapRotation;L&&(H.envMap.value=L,_e1.copy(K),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,L.isCubeTexture&&L.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),H.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),H.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,H.reflectivity.value=J.reflectivity,H.ior.value=J.ior,H.refractionRatio.value=J.refractionRatio),J.lightMap&&(H.lightMap.value=J.lightMap,H.lightMapIntensity.value=J.lightMapIntensity,o(J.lightMap,H.lightMapTransform)),J.aoMap&&(H.aoMap.value=J.aoMap,H.aoMapIntensity.value=J.aoMapIntensity,o(J.aoMap,H.aoMapTransform))}function I(H,J){H.diffuse.value.copy(J.color),H.opacity.value=J.opacity,J.map&&(H.map.value=J.map,o(J.map,H.mapTransform))}function f(H,J){H.dashSize.value=J.dashSize,H.totalSize.value=J.dashSize+J.gapSize,H.scale.value=J.scale}function A(H,J,z,L){H.diffuse.value.copy(J.color),H.opacity.value=J.opacity,H.size.value=J.size*z,H.scale.value=L*.5,J.map&&(H.map.value=J.map,o(J.map,H.uvTransform)),J.alphaMap&&(H.alphaMap.value=J.alphaMap,o(J.alphaMap,H.alphaMapTransform)),J.alphaTest>0&&(H.alphaTest.value=J.alphaTest)}function y(H,J){H.diffuse.value.copy(J.color),H.opacity.value=J.opacity,H.rotation.value=J.rotation,J.map&&(H.map.value=J.map,o(J.map,H.mapTransform)),J.alphaMap&&(H.alphaMap.value=J.alphaMap,o(J.alphaMap,H.alphaMapTransform)),J.alphaTest>0&&(H.alphaTest.value=J.alphaTest)}function G(H,J){H.specular.value.copy(J.specular),H.shininess.value=Math.max(J.shininess,1e-4)}function S(H,J){J.gradientMap&&(H.gradientMap.value=J.gradientMap)}function w(H,J){H.metalness.value=J.metalness,J.metalnessMap&&(H.metalnessMap.value=J.metalnessMap,o(J.metalnessMap,H.metalnessMapTransform)),H.roughness.value=J.roughness,J.roughnessMap&&(H.roughnessMap.value=J.roughnessMap,o(J.roughnessMap,H.roughnessMapTransform)),J.envMap&&(H.envMapIntensity.value=J.envMapIntensity)}function M(H,J,z){H.ior.value=J.ior,J.sheen>0&&(H.sheenColor.value.copy(J.sheenColor).multiplyScalar(J.sheen),H.sheenRoughness.value=J.sheenRoughness,J.sheenColorMap&&(H.sheenColorMap.value=J.sheenColorMap,o(J.sheenColorMap,H.sheenColorMapTransform)),J.sheenRoughnessMap&&(H.sheenRoughnessMap.value=J.sheenRoughnessMap,o(J.sheenRoughnessMap,H.sheenRoughnessMapTransform))),J.clearcoat>0&&(H.clearcoat.value=J.clearcoat,H.clearcoatRoughness.value=J.clearcoatRoughness,J.clearcoatMap&&(H.clearcoatMap.value=J.clearcoatMap,o(J.clearcoatMap,H.clearcoatMapTransform)),J.clearcoatRoughnessMap&&(H.clearcoatRoughnessMap.value=J.clearcoatRoughnessMap,o(J.clearcoatRoughnessMap,H.clearcoatRoughnessMapTransform)),J.clearcoatNormalMap&&(H.clearcoatNormalMap.value=J.clearcoatNormalMap,o(J.clearcoatNormalMap,H.clearcoatNormalMapTransform),H.clearcoatNormalScale.value.copy(J.clearcoatNormalScale),J.side===BackSide&&H.clearcoatNormalScale.value.negate())),J.dispersion>0&&(H.dispersion.value=J.dispersion),J.iridescence>0&&(H.iridescence.value=J.iridescence,H.iridescenceIOR.value=J.iridescenceIOR,H.iridescenceThicknessMinimum.value=J.iridescenceThicknessRange[0],H.iridescenceThicknessMaximum.value=J.iridescenceThicknessRange[1],J.iridescenceMap&&(H.iridescenceMap.value=J.iridescenceMap,o(J.iridescenceMap,H.iridescenceMapTransform)),J.iridescenceThicknessMap&&(H.iridescenceThicknessMap.value=J.iridescenceThicknessMap,o(J.iridescenceThicknessMap,H.iridescenceThicknessMapTransform))),J.transmission>0&&(H.transmission.value=J.transmission,H.transmissionSamplerMap.value=z.texture,H.transmissionSamplerSize.value.set(z.width,z.height),J.transmissionMap&&(H.transmissionMap.value=J.transmissionMap,o(J.transmissionMap,H.transmissionMapTransform)),H.thickness.value=J.thickness,J.thicknessMap&&(H.thicknessMap.value=J.thicknessMap,o(J.thicknessMap,H.thicknessMapTransform)),H.attenuationDistance.value=J.attenuationDistance,H.attenuationColor.value.copy(J.attenuationColor)),J.anisotropy>0&&(H.anisotropyVector.value.set(J.anisotropy*Math.cos(J.anisotropyRotation),J.anisotropy*Math.sin(J.anisotropyRotation)),J.anisotropyMap&&(H.anisotropyMap.value=J.anisotropyMap,o(J.anisotropyMap,H.anisotropyMapTransform))),H.specularIntensity.value=J.specularIntensity,H.specularColor.value.copy(J.specularColor),J.specularColorMap&&(H.specularColorMap.value=J.specularColorMap,o(J.specularColorMap,H.specularColorMapTransform)),J.specularIntensityMap&&(H.specularIntensityMap.value=J.specularIntensityMap,o(J.specularIntensityMap,H.specularIntensityMapTransform))}function V(H,J){J.matcap&&(H.matcap.value=J.matcap)}function T(H,J){const z=t.get(J).light;H.referencePosition.value.setFromMatrixPosition(z.matrixWorld),H.nearDistance.value=z.shadow.camera.near,H.farDistance.value=z.shadow.camera.far}return{refreshFogUniforms:u,refreshMaterialUniforms:d}}function WebGLUniformsGroups(n,t,o,u){let d={},C={},I=[];const f=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function A(z,L){const K=L.program;u.uniformBlockBinding(z,K)}function y(z,L){let K=d[z.id];K===void 0&&(V(z),K=G(z),d[z.id]=K,z.addEventListener("dispose",H));const O=L.program;u.updateUBOMapping(z,O);const Q=t.render.frame;C[z.id]!==Q&&(w(z),C[z.id]=Q)}function G(z){const L=S();z.__bindingPointIndex=L;const K=n.createBuffer(),O=z.__size,Q=z.usage;return n.bindBuffer(n.UNIFORM_BUFFER,K),n.bufferData(n.UNIFORM_BUFFER,O,Q),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,L,K),K}function S(){for(let z=0;z<f;z++)if(I.indexOf(z)===-1)return I.push(z),z;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function w(z){const L=d[z.id],K=z.uniforms,O=z.__cache;n.bindBuffer(n.UNIFORM_BUFFER,L);for(let Q=0,ee=K.length;Q<ee;Q++){const ie=Array.isArray(K[Q])?K[Q]:[K[Q]];for(let te=0,se=ie.length;te<se;te++){const ae=ie[te];if(M(ae,Q,te,O)===!0){const le=ae.__offset,ge=Array.isArray(ae.value)?ae.value:[ae.value];let be=0;for(let Xe=0;Xe<ge.length;Xe++){const Ce=ge[Xe],Re=T(Ce);typeof Ce=="number"||typeof Ce=="boolean"?(ae.__data[0]=Ce,n.bufferSubData(n.UNIFORM_BUFFER,le+be,ae.__data)):Ce.isMatrix3?(ae.__data[0]=Ce.elements[0],ae.__data[1]=Ce.elements[1],ae.__data[2]=Ce.elements[2],ae.__data[3]=0,ae.__data[4]=Ce.elements[3],ae.__data[5]=Ce.elements[4],ae.__data[6]=Ce.elements[5],ae.__data[7]=0,ae.__data[8]=Ce.elements[6],ae.__data[9]=Ce.elements[7],ae.__data[10]=Ce.elements[8],ae.__data[11]=0):(Ce.toArray(ae.__data,be),be+=Re.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,le,ae.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function M(z,L,K,O){const Q=z.value,ee=L+"_"+K;if(O[ee]===void 0)return typeof Q=="number"||typeof Q=="boolean"?O[ee]=Q:O[ee]=Q.clone(),!0;{const ie=O[ee];if(typeof Q=="number"||typeof Q=="boolean"){if(ie!==Q)return O[ee]=Q,!0}else if(ie.equals(Q)===!1)return ie.copy(Q),!0}return!1}function V(z){const L=z.uniforms;let K=0;const O=16;for(let ee=0,ie=L.length;ee<ie;ee++){const te=Array.isArray(L[ee])?L[ee]:[L[ee]];for(let se=0,ae=te.length;se<ae;se++){const le=te[se],ge=Array.isArray(le.value)?le.value:[le.value];for(let be=0,Xe=ge.length;be<Xe;be++){const Ce=ge[be],Re=T(Ce),Se=K%O,Ze=Se%Re.boundary,he=Se+Ze;K+=Ze,he!==0&&O-he<Re.storage&&(K+=O-he),le.__data=new Float32Array(Re.storage/Float32Array.BYTES_PER_ELEMENT),le.__offset=K,K+=Re.storage}}}const Q=K%O;return Q>0&&(K+=O-Q),z.__size=K,z.__cache={},this}function T(z){const L={boundary:0,storage:0};return typeof z=="number"||typeof z=="boolean"?(L.boundary=4,L.storage=4):z.isVector2?(L.boundary=8,L.storage=8):z.isVector3||z.isColor?(L.boundary=16,L.storage=12):z.isVector4?(L.boundary=16,L.storage=16):z.isMatrix3?(L.boundary=48,L.storage=48):z.isMatrix4?(L.boundary=64,L.storage=64):z.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",z),L}function H(z){const L=z.target;L.removeEventListener("dispose",H);const K=I.indexOf(L.__bindingPointIndex);I.splice(K,1),n.deleteBuffer(d[L.id]),delete d[L.id],delete C[L.id]}function J(){for(const z in d)n.deleteBuffer(d[z]);I=[],d={},C={}}return{bind:A,update:y,dispose:J}}class WebGLRenderer{constructor(t={}){const{canvas:o=createCanvasElement(),context:u=null,depth:d=!0,stencil:C=!1,alpha:I=!1,antialias:f=!1,premultipliedAlpha:A=!0,preserveDrawingBuffer:y=!1,powerPreference:G="default",failIfMajorPerformanceCaveat:S=!1,reverseDepthBuffer:w=!1}=t;this.isWebGLRenderer=!0;let M;if(u!==null){if(typeof WebGLRenderingContext<"u"&&u instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");M=u.getContextAttributes().alpha}else M=I;const V=new Uint32Array(4),T=new Int32Array(4);let H=null,J=null;const z=[],L=[];this.domElement=o,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const K=this;let O=!1,Q=0,ee=0,ie=null,te=-1,se=null;const ae=new Vector4,le=new Vector4;let ge=null;const be=new Color(0);let Xe=0,Ce=o.width,Re=o.height,Se=1,Ze=null,he=null;const Ie=new Vector4(0,0,Ce,Re),Be=new Vector4(0,0,Ce,Re);let ue=!1;const me=new Frustum;let xe=!1,Je=!1;this.transmissionResolutionScale=1;const Ve=new Matrix4,Ee=new Matrix4,Ct=new Vector3,st=new Vector4,wt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Qe=!1;function Ue(){return ie===null?Se:1}let Ge=u;function Gt(fe,We){return o.getContext(fe,We)}try{const fe={alpha:!0,depth:d,stencil:C,antialias:f,premultipliedAlpha:A,preserveDrawingBuffer:y,powerPreference:G,failIfMajorPerformanceCaveat:S};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${REVISION}`),o.addEventListener("webglcontextlost",lt,!1),o.addEventListener("webglcontextrestored",yt,!1),o.addEventListener("webglcontextcreationerror",_t,!1),Ge===null){const We="webgl2";if(Ge=Gt(We,fe),Ge===null)throw Gt(We)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(fe){throw console.error("THREE.WebGLRenderer: "+fe.message),fe}let ot,vt,at,Tt,xt,ve,de,De,nt,dt,ze,rt,Rt,Mt,Yt,Oe,gt,pt,mt,It,ye,Ye,_e,Ne;function St(){ot=new WebGLExtensions(Ge),ot.init(),Ye=new WebGLUtils(Ge,ot),vt=new WebGLCapabilities(Ge,ot,t,Ye),at=new WebGLState(Ge,ot),vt.reverseDepthBuffer&&w&&at.buffers.depth.setReversed(!0),Tt=new WebGLInfo(Ge),xt=new WebGLProperties,ve=new WebGLTextures(Ge,ot,at,xt,vt,Ye,Tt),de=new WebGLCubeMaps(K),De=new WebGLCubeUVMaps(K),nt=new WebGLAttributes(Ge),_e=new WebGLBindingStates(Ge,nt),dt=new WebGLGeometries(Ge,nt,Tt,_e),ze=new WebGLObjects(Ge,dt,nt,Tt),mt=new WebGLMorphtargets(Ge,vt,ve),Oe=new WebGLClipping(xt),rt=new WebGLPrograms(K,de,De,ot,vt,_e,Oe),Rt=new WebGLMaterials(K,xt),Mt=new WebGLRenderLists,Yt=new WebGLRenderStates(ot),pt=new WebGLBackground(K,de,De,at,ze,M,A),gt=new WebGLShadowMap(K,ze,vt),Ne=new WebGLUniformsGroups(Ge,Tt,vt,at),It=new WebGLBufferRenderer(Ge,ot,Tt),ye=new WebGLIndexedBufferRenderer(Ge,ot,Tt),Tt.programs=rt.programs,K.capabilities=vt,K.extensions=ot,K.properties=xt,K.renderLists=Mt,K.shadowMap=gt,K.state=at,K.info=Tt}St();const et=new WebXRManager(K,Ge);this.xr=et,this.getContext=function(){return Ge},this.getContextAttributes=function(){return Ge.getContextAttributes()},this.forceContextLoss=function(){const fe=ot.get("WEBGL_lose_context");fe&&fe.loseContext()},this.forceContextRestore=function(){const fe=ot.get("WEBGL_lose_context");fe&&fe.restoreContext()},this.getPixelRatio=function(){return Se},this.setPixelRatio=function(fe){fe!==void 0&&(Se=fe,this.setSize(Ce,Re,!1))},this.getSize=function(fe){return fe.set(Ce,Re)},this.setSize=function(fe,We,je=!0){if(et.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ce=fe,Re=We,o.width=Math.floor(fe*Se),o.height=Math.floor(We*Se),je===!0&&(o.style.width=fe+"px",o.style.height=We+"px"),this.setViewport(0,0,fe,We)},this.getDrawingBufferSize=function(fe){return fe.set(Ce*Se,Re*Se).floor()},this.setDrawingBufferSize=function(fe,We,je){Ce=fe,Re=We,Se=je,o.width=Math.floor(fe*je),o.height=Math.floor(We*je),this.setViewport(0,0,fe,We)},this.getCurrentViewport=function(fe){return fe.copy(ae)},this.getViewport=function(fe){return fe.copy(Ie)},this.setViewport=function(fe,We,je,ke){fe.isVector4?Ie.set(fe.x,fe.y,fe.z,fe.w):Ie.set(fe,We,je,ke),at.viewport(ae.copy(Ie).multiplyScalar(Se).round())},this.getScissor=function(fe){return fe.copy(Be)},this.setScissor=function(fe,We,je,ke){fe.isVector4?Be.set(fe.x,fe.y,fe.z,fe.w):Be.set(fe,We,je,ke),at.scissor(le.copy(Be).multiplyScalar(Se).round())},this.getScissorTest=function(){return ue},this.setScissorTest=function(fe){at.setScissorTest(ue=fe)},this.setOpaqueSort=function(fe){Ze=fe},this.setTransparentSort=function(fe){he=fe},this.getClearColor=function(fe){return fe.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor(...arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha(...arguments)},this.clear=function(fe=!0,We=!0,je=!0){let ke=0;if(fe){let Le=!1;if(ie!==null){const At=ie.texture.format;Le=At===RGBAIntegerFormat||At===RGIntegerFormat||At===RedIntegerFormat}if(Le){const At=ie.texture.type,Nt=At===UnsignedByteType||At===UnsignedIntType||At===UnsignedShortType||At===UnsignedInt248Type||At===UnsignedShort4444Type||At===UnsignedShort5551Type,Wt=pt.getClearColor(),Vt=pt.getClearAlpha(),Ot=Wt.r,Ut=Wt.g,Ft=Wt.b;Nt?(V[0]=Ot,V[1]=Ut,V[2]=Ft,V[3]=Vt,Ge.clearBufferuiv(Ge.COLOR,0,V)):(T[0]=Ot,T[1]=Ut,T[2]=Ft,T[3]=Vt,Ge.clearBufferiv(Ge.COLOR,0,T))}else ke|=Ge.COLOR_BUFFER_BIT}We&&(ke|=Ge.DEPTH_BUFFER_BIT),je&&(ke|=Ge.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ge.clear(ke)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",lt,!1),o.removeEventListener("webglcontextrestored",yt,!1),o.removeEventListener("webglcontextcreationerror",_t,!1),pt.dispose(),Mt.dispose(),Yt.dispose(),xt.dispose(),de.dispose(),De.dispose(),ze.dispose(),_e.dispose(),Ne.dispose(),rt.dispose(),et.dispose(),et.removeEventListener("sessionstart",vn),et.removeEventListener("sessionend",Ts),mn.stop()};function lt(fe){fe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function yt(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1;const fe=Tt.autoReset,We=gt.enabled,je=gt.autoUpdate,ke=gt.needsUpdate,Le=gt.type;St(),Tt.autoReset=fe,gt.enabled=We,gt.autoUpdate=je,gt.needsUpdate=ke,gt.type=Le}function _t(fe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",fe.statusMessage)}function Jt(fe){const We=fe.target;We.removeEventListener("dispose",Jt),oi(We)}function oi(fe){Si(fe),xt.remove(fe)}function Si(fe){const We=xt.get(fe).programs;We!==void 0&&(We.forEach(function(je){rt.releaseProgram(je)}),fe.isShaderMaterial&&rt.releaseShaderCache(fe))}this.renderBufferDirect=function(fe,We,je,ke,Le,At){We===null&&(We=wt);const Nt=Le.isMesh&&Le.matrixWorld.determinant()<0,Wt=Vl(fe,We,je,ke,Le);at.setMaterial(ke,Nt);let Vt=je.index,Ot=1;if(ke.wireframe===!0){if(Vt=dt.getWireframeAttribute(je),Vt===void 0)return;Ot=2}const Ut=je.drawRange,Ft=je.attributes.position;let Ci=Ut.start*Ot,Ii=(Ut.start+Ut.count)*Ot;At!==null&&(Ci=Math.max(Ci,At.start*Ot),Ii=Math.min(Ii,(At.start+At.count)*Ot)),Vt!==null?(Ci=Math.max(Ci,0),Ii=Math.min(Ii,Vt.count)):Ft!=null&&(Ci=Math.max(Ci,0),Ii=Math.min(Ii,Ft.count));const Hi=Ii-Ci;if(Hi<0||Hi===1/0)return;_e.setup(Le,ke,Wt,je,Vt);let mi,qt=It;if(Vt!==null&&(mi=nt.get(Vt),qt=ye,qt.setIndex(mi)),Le.isMesh)ke.wireframe===!0?(at.setLineWidth(ke.wireframeLinewidth*Ue()),qt.setMode(Ge.LINES)):qt.setMode(Ge.TRIANGLES);else if(Le.isLine){let Kt=ke.linewidth;Kt===void 0&&(Kt=1),at.setLineWidth(Kt*Ue()),Le.isLineSegments?qt.setMode(Ge.LINES):Le.isLineLoop?qt.setMode(Ge.LINE_LOOP):qt.setMode(Ge.LINE_STRIP)}else Le.isPoints?qt.setMode(Ge.POINTS):Le.isSprite&&qt.setMode(Ge.TRIANGLES);if(Le.isBatchedMesh)if(Le._multiDrawInstances!==null)warnOnce("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),qt.renderMultiDrawInstances(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount,Le._multiDrawInstances);else if(ot.get("WEBGL_multi_draw"))qt.renderMultiDraw(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount);else{const Kt=Le._multiDrawStarts,gn=Le._multiDrawCounts,fi=Le._multiDrawCount,Dn=Vt?nt.get(Vt).bytesPerElement:1,Is=xt.get(ke).currentProgram.getUniforms();for(let Wn=0;Wn<fi;Wn++)Is.setValue(Ge,"_gl_DrawID",Wn),qt.render(Kt[Wn]/Dn,gn[Wn])}else if(Le.isInstancedMesh)qt.renderInstances(Ci,Hi,Le.count);else if(je.isInstancedBufferGeometry){const Kt=je._maxInstanceCount!==void 0?je._maxInstanceCount:1/0,gn=Math.min(je.instanceCount,Kt);qt.renderInstances(Ci,Hi,gn)}else qt.render(Ci,Hi)};function ni(fe,We,je){fe.transparent===!0&&fe.side===DoubleSide&&fe.forceSinglePass===!1?(fe.side=BackSide,fe.needsUpdate=!0,Qt(fe,We,je),fe.side=FrontSide,fe.needsUpdate=!0,Qt(fe,We,je),fe.side=DoubleSide):Qt(fe,We,je)}this.compile=function(fe,We,je=null){je===null&&(je=fe),J=Yt.get(je),J.init(We),L.push(J),je.traverseVisible(function(Le){Le.isLight&&Le.layers.test(We.layers)&&(J.pushLight(Le),Le.castShadow&&J.pushShadow(Le))}),fe!==je&&fe.traverseVisible(function(Le){Le.isLight&&Le.layers.test(We.layers)&&(J.pushLight(Le),Le.castShadow&&J.pushShadow(Le))}),J.setupLights();const ke=new Set;return fe.traverse(function(Le){if(!(Le.isMesh||Le.isPoints||Le.isLine||Le.isSprite))return;const At=Le.material;if(At)if(Array.isArray(At))for(let Nt=0;Nt<At.length;Nt++){const Wt=At[Nt];ni(Wt,je,Le),ke.add(Wt)}else ni(At,je,Le),ke.add(At)}),J=L.pop(),ke},this.compileAsync=function(fe,We,je=null){const ke=this.compile(fe,We,je);return new Promise(Le=>{function At(){if(ke.forEach(function(Nt){xt.get(Nt).currentProgram.isReady()&&ke.delete(Nt)}),ke.size===0){Le(fe);return}setTimeout(At,10)}ot.get("KHR_parallel_shader_compile")!==null?At():setTimeout(At,10)})};let gi=null;function Ri(fe){gi&&gi(fe)}function vn(){mn.stop()}function Ts(){mn.start()}const mn=new WebGLAnimation;mn.setAnimationLoop(Ri),typeof self<"u"&&mn.setContext(self),this.setAnimationLoop=function(fe){gi=fe,et.setAnimationLoop(fe),fe===null?mn.stop():mn.start()},et.addEventListener("sessionstart",vn),et.addEventListener("sessionend",Ts),this.render=function(fe,We){if(We!==void 0&&We.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(O===!0)return;if(fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),We.parent===null&&We.matrixWorldAutoUpdate===!0&&We.updateMatrixWorld(),et.enabled===!0&&et.isPresenting===!0&&(et.cameraAutoUpdate===!0&&et.updateCamera(We),We=et.getCamera()),fe.isScene===!0&&fe.onBeforeRender(K,fe,We,ie),J=Yt.get(fe,L.length),J.init(We),L.push(J),Ee.multiplyMatrices(We.projectionMatrix,We.matrixWorldInverse),me.setFromProjectionMatrix(Ee),Je=this.localClippingEnabled,xe=Oe.init(this.clippingPlanes,Je),H=Mt.get(fe,z.length),H.init(),z.push(H),et.enabled===!0&&et.isPresenting===!0){const At=K.xr.getDepthSensingMesh();At!==null&&Bn(At,We,-1/0,K.sortObjects)}Bn(fe,We,0,K.sortObjects),H.finish(),K.sortObjects===!0&&H.sort(Ze,he),Qe=et.enabled===!1||et.isPresenting===!1||et.hasDepthSensing()===!1,Qe&&pt.addToRenderList(H,fe),this.info.render.frame++,xe===!0&&Oe.beginShadows();const je=J.state.shadowsArray;gt.render(je,fe,We),xe===!0&&Oe.endShadows(),this.info.autoReset===!0&&this.info.reset();const ke=H.opaque,Le=H.transmissive;if(J.setupLights(),We.isArrayCamera){const At=We.cameras;if(Le.length>0)for(let Nt=0,Wt=At.length;Nt<Wt;Nt++){const Vt=At[Nt];ss(ke,Le,fe,Vt)}Qe&&pt.render(fe);for(let Nt=0,Wt=At.length;Nt<Wt;Nt++){const Vt=At[Nt];Vn(H,fe,Vt,Vt.viewport)}}else Le.length>0&&ss(ke,Le,fe,We),Qe&&pt.render(fe),Vn(H,fe,We);ie!==null&&ee===0&&(ve.updateMultisampleRenderTarget(ie),ve.updateRenderTargetMipmap(ie)),fe.isScene===!0&&fe.onAfterRender(K,fe,We),_e.resetDefaultState(),te=-1,se=null,L.pop(),L.length>0?(J=L[L.length-1],xe===!0&&Oe.setGlobalState(K.clippingPlanes,J.state.camera)):J=null,z.pop(),z.length>0?H=z[z.length-1]:H=null};function Bn(fe,We,je,ke){if(fe.visible===!1)return;if(fe.layers.test(We.layers)){if(fe.isGroup)je=fe.renderOrder;else if(fe.isLOD)fe.autoUpdate===!0&&fe.update(We);else if(fe.isLight)J.pushLight(fe),fe.castShadow&&J.pushShadow(fe);else if(fe.isSprite){if(!fe.frustumCulled||me.intersectsSprite(fe)){ke&&st.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(Ee);const Nt=ze.update(fe),Wt=fe.material;Wt.visible&&H.push(fe,Nt,Wt,je,st.z,null)}}else if((fe.isMesh||fe.isLine||fe.isPoints)&&(!fe.frustumCulled||me.intersectsObject(fe))){const Nt=ze.update(fe),Wt=fe.material;if(ke&&(fe.boundingSphere!==void 0?(fe.boundingSphere===null&&fe.computeBoundingSphere(),st.copy(fe.boundingSphere.center)):(Nt.boundingSphere===null&&Nt.computeBoundingSphere(),st.copy(Nt.boundingSphere.center)),st.applyMatrix4(fe.matrixWorld).applyMatrix4(Ee)),Array.isArray(Wt)){const Vt=Nt.groups;for(let Ot=0,Ut=Vt.length;Ot<Ut;Ot++){const Ft=Vt[Ot],Ci=Wt[Ft.materialIndex];Ci&&Ci.visible&&H.push(fe,Nt,Ci,je,st.z,Ft)}}else Wt.visible&&H.push(fe,Nt,Wt,je,st.z,null)}}const At=fe.children;for(let Nt=0,Wt=At.length;Nt<Wt;Nt++)Bn(At[Nt],We,je,ke)}function Vn(fe,We,je,ke){const Le=fe.opaque,At=fe.transmissive,Nt=fe.transparent;J.setupLightsView(je),xe===!0&&Oe.setGlobalState(K.clippingPlanes,je),ke&&at.viewport(ae.copy(ke)),Le.length>0&&Ti(Le,We,je),At.length>0&&Ti(At,We,je),Nt.length>0&&Ti(Nt,We,je),at.buffers.depth.setTest(!0),at.buffers.depth.setMask(!0),at.buffers.color.setMask(!0),at.setPolygonOffset(!1)}function ss(fe,We,je,ke){if((je.isScene===!0?je.overrideMaterial:null)!==null)return;J.state.transmissionRenderTarget[ke.id]===void 0&&(J.state.transmissionRenderTarget[ke.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:ot.has("EXT_color_buffer_half_float")||ot.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:C,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const At=J.state.transmissionRenderTarget[ke.id],Nt=ke.viewport||ae;At.setSize(Nt.z*K.transmissionResolutionScale,Nt.w*K.transmissionResolutionScale);const Wt=K.getRenderTarget();K.setRenderTarget(At),K.getClearColor(be),Xe=K.getClearAlpha(),Xe<1&&K.setClearColor(16777215,.5),K.clear(),Qe&&pt.render(je);const Vt=K.toneMapping;K.toneMapping=NoToneMapping;const Ot=ke.viewport;if(ke.viewport!==void 0&&(ke.viewport=void 0),J.setupLightsView(ke),xe===!0&&Oe.setGlobalState(K.clippingPlanes,ke),Ti(fe,je,ke),ve.updateMultisampleRenderTarget(At),ve.updateRenderTargetMipmap(At),ot.has("WEBGL_multisampled_render_to_texture")===!1){let Ut=!1;for(let Ft=0,Ci=We.length;Ft<Ci;Ft++){const Ii=We[Ft],Hi=Ii.object,mi=Ii.geometry,qt=Ii.material,Kt=Ii.group;if(qt.side===DoubleSide&&Hi.layers.test(ke.layers)){const gn=qt.side;qt.side=BackSide,qt.needsUpdate=!0,Ji(Hi,je,ke,mi,qt,Kt),qt.side=gn,qt.needsUpdate=!0,Ut=!0}}Ut===!0&&(ve.updateMultisampleRenderTarget(At),ve.updateRenderTargetMipmap(At))}K.setRenderTarget(Wt),K.setClearColor(be,Xe),Ot!==void 0&&(ke.viewport=Ot),K.toneMapping=Vt}function Ti(fe,We,je){const ke=We.isScene===!0?We.overrideMaterial:null;for(let Le=0,At=fe.length;Le<At;Le++){const Nt=fe[Le],Wt=Nt.object,Vt=Nt.geometry,Ot=ke===null?Nt.material:ke,Ut=Nt.group;Wt.layers.test(je.layers)&&Ji(Wt,We,je,Vt,Ot,Ut)}}function Ji(fe,We,je,ke,Le,At){fe.onBeforeRender(K,We,je,ke,Le,At),fe.modelViewMatrix.multiplyMatrices(je.matrixWorldInverse,fe.matrixWorld),fe.normalMatrix.getNormalMatrix(fe.modelViewMatrix),Le.onBeforeRender(K,We,je,ke,fe,At),Le.transparent===!0&&Le.side===DoubleSide&&Le.forceSinglePass===!1?(Le.side=BackSide,Le.needsUpdate=!0,K.renderBufferDirect(je,We,ke,Le,fe,At),Le.side=FrontSide,Le.needsUpdate=!0,K.renderBufferDirect(je,We,ke,Le,fe,At),Le.side=DoubleSide):K.renderBufferDirect(je,We,ke,Le,fe,At),fe.onAfterRender(K,We,je,ke,Le,At)}function Qt(fe,We,je){We.isScene!==!0&&(We=wt);const ke=xt.get(fe),Le=J.state.lights,At=J.state.shadowsArray,Nt=Le.state.version,Wt=rt.getParameters(fe,Le.state,At,We,je),Vt=rt.getProgramCacheKey(Wt);let Ot=ke.programs;ke.environment=fe.isMeshStandardMaterial?We.environment:null,ke.fog=We.fog,ke.envMap=(fe.isMeshStandardMaterial?De:de).get(fe.envMap||ke.environment),ke.envMapRotation=ke.environment!==null&&fe.envMap===null?We.environmentRotation:fe.envMapRotation,Ot===void 0&&(fe.addEventListener("dispose",Jt),Ot=new Map,ke.programs=Ot);let Ut=Ot.get(Vt);if(Ut!==void 0){if(ke.currentProgram===Ut&&ke.lightsStateVersion===Nt)return Uo(fe,Wt),Ut}else Wt.uniforms=rt.getUniforms(fe),fe.onBeforeCompile(Wt,K),Ut=rt.acquireProgram(Wt,Vt),Ot.set(Vt,Ut),ke.uniforms=Wt.uniforms;const Ft=ke.uniforms;return(!fe.isShaderMaterial&&!fe.isRawShaderMaterial||fe.clipping===!0)&&(Ft.clippingPlanes=Oe.uniform),Uo(fe,Wt),ke.needsLights=El(fe),ke.lightsStateVersion=Nt,ke.needsLights&&(Ft.ambientLightColor.value=Le.state.ambient,Ft.lightProbe.value=Le.state.probe,Ft.directionalLights.value=Le.state.directional,Ft.directionalLightShadows.value=Le.state.directionalShadow,Ft.spotLights.value=Le.state.spot,Ft.spotLightShadows.value=Le.state.spotShadow,Ft.rectAreaLights.value=Le.state.rectArea,Ft.ltc_1.value=Le.state.rectAreaLTC1,Ft.ltc_2.value=Le.state.rectAreaLTC2,Ft.pointLights.value=Le.state.point,Ft.pointLightShadows.value=Le.state.pointShadow,Ft.hemisphereLights.value=Le.state.hemi,Ft.directionalShadowMap.value=Le.state.directionalShadowMap,Ft.directionalShadowMatrix.value=Le.state.directionalShadowMatrix,Ft.spotShadowMap.value=Le.state.spotShadowMap,Ft.spotLightMatrix.value=Le.state.spotLightMatrix,Ft.spotLightMap.value=Le.state.spotLightMap,Ft.pointShadowMap.value=Le.state.pointShadowMap,Ft.pointShadowMatrix.value=Le.state.pointShadowMatrix),ke.currentProgram=Ut,ke.uniformsList=null,Ut}function Js(fe){if(fe.uniformsList===null){const We=fe.currentProgram.getUniforms();fe.uniformsList=WebGLUniforms.seqWithValue(We.seq,fe.uniforms)}return fe.uniformsList}function Uo(fe,We){const je=xt.get(fe);je.outputColorSpace=We.outputColorSpace,je.batching=We.batching,je.batchingColor=We.batchingColor,je.instancing=We.instancing,je.instancingColor=We.instancingColor,je.instancingMorph=We.instancingMorph,je.skinning=We.skinning,je.morphTargets=We.morphTargets,je.morphNormals=We.morphNormals,je.morphColors=We.morphColors,je.morphTargetsCount=We.morphTargetsCount,je.numClippingPlanes=We.numClippingPlanes,je.numIntersection=We.numClipIntersection,je.vertexAlphas=We.vertexAlphas,je.vertexTangents=We.vertexTangents,je.toneMapping=We.toneMapping}function Vl(fe,We,je,ke,Le){We.isScene!==!0&&(We=wt),ve.resetTextureUnits();const At=We.fog,Nt=ke.isMeshStandardMaterial?We.environment:null,Wt=ie===null?K.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:LinearSRGBColorSpace,Vt=(ke.isMeshStandardMaterial?De:de).get(ke.envMap||Nt),Ot=ke.vertexColors===!0&&!!je.attributes.color&&je.attributes.color.itemSize===4,Ut=!!je.attributes.tangent&&(!!ke.normalMap||ke.anisotropy>0),Ft=!!je.morphAttributes.position,Ci=!!je.morphAttributes.normal,Ii=!!je.morphAttributes.color;let Hi=NoToneMapping;ke.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(Hi=K.toneMapping);const mi=je.morphAttributes.position||je.morphAttributes.normal||je.morphAttributes.color,qt=mi!==void 0?mi.length:0,Kt=xt.get(ke),gn=J.state.lights;if(xe===!0&&(Je===!0||fe!==se)){const Qi=fe===se&&ke.id===te;Oe.setState(ke,fe,Qi)}let fi=!1;ke.version===Kt.__version?(Kt.needsLights&&Kt.lightsStateVersion!==gn.state.version||Kt.outputColorSpace!==Wt||Le.isBatchedMesh&&Kt.batching===!1||!Le.isBatchedMesh&&Kt.batching===!0||Le.isBatchedMesh&&Kt.batchingColor===!0&&Le.colorTexture===null||Le.isBatchedMesh&&Kt.batchingColor===!1&&Le.colorTexture!==null||Le.isInstancedMesh&&Kt.instancing===!1||!Le.isInstancedMesh&&Kt.instancing===!0||Le.isSkinnedMesh&&Kt.skinning===!1||!Le.isSkinnedMesh&&Kt.skinning===!0||Le.isInstancedMesh&&Kt.instancingColor===!0&&Le.instanceColor===null||Le.isInstancedMesh&&Kt.instancingColor===!1&&Le.instanceColor!==null||Le.isInstancedMesh&&Kt.instancingMorph===!0&&Le.morphTexture===null||Le.isInstancedMesh&&Kt.instancingMorph===!1&&Le.morphTexture!==null||Kt.envMap!==Vt||ke.fog===!0&&Kt.fog!==At||Kt.numClippingPlanes!==void 0&&(Kt.numClippingPlanes!==Oe.numPlanes||Kt.numIntersection!==Oe.numIntersection)||Kt.vertexAlphas!==Ot||Kt.vertexTangents!==Ut||Kt.morphTargets!==Ft||Kt.morphNormals!==Ci||Kt.morphColors!==Ii||Kt.toneMapping!==Hi||Kt.morphTargetsCount!==qt)&&(fi=!0):(fi=!0,Kt.__version=ke.version);let Dn=Kt.currentProgram;fi===!0&&(Dn=Qt(ke,We,Le));let Is=!1,Wn=!1,bn=!1;const Zi=Dn.getUniforms(),En=Kt.uniforms;if(at.useProgram(Dn.program)&&(Is=!0,Wn=!0,bn=!0),ke.id!==te&&(te=ke.id,Wn=!0),Is||se!==fe){at.buffers.depth.getReversed()?(Ve.copy(fe.projectionMatrix),toNormalizedProjectionMatrix(Ve),toReversedProjectionMatrix(Ve),Zi.setValue(Ge,"projectionMatrix",Ve)):Zi.setValue(Ge,"projectionMatrix",fe.projectionMatrix),Zi.setValue(Ge,"viewMatrix",fe.matrixWorldInverse);const Sn=Zi.map.cameraPosition;Sn!==void 0&&Sn.setValue(Ge,Ct.setFromMatrixPosition(fe.matrixWorld)),vt.logarithmicDepthBuffer&&Zi.setValue(Ge,"logDepthBufFC",2/(Math.log(fe.far+1)/Math.LN2)),(ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshLambertMaterial||ke.isMeshBasicMaterial||ke.isMeshStandardMaterial||ke.isShaderMaterial)&&Zi.setValue(Ge,"isOrthographic",fe.isOrthographicCamera===!0),se!==fe&&(se=fe,Wn=!0,bn=!0)}if(Le.isSkinnedMesh){Zi.setOptional(Ge,Le,"bindMatrix"),Zi.setOptional(Ge,Le,"bindMatrixInverse");const Qi=Le.skeleton;Qi&&(Qi.boneTexture===null&&Qi.computeBoneTexture(),Zi.setValue(Ge,"boneTexture",Qi.boneTexture,ve))}Le.isBatchedMesh&&(Zi.setOptional(Ge,Le,"batchingTexture"),Zi.setValue(Ge,"batchingTexture",Le._matricesTexture,ve),Zi.setOptional(Ge,Le,"batchingIdTexture"),Zi.setValue(Ge,"batchingIdTexture",Le._indirectTexture,ve),Zi.setOptional(Ge,Le,"batchingColorTexture"),Le._colorsTexture!==null&&Zi.setValue(Ge,"batchingColorTexture",Le._colorsTexture,ve));const Zn=je.morphAttributes;if((Zn.position!==void 0||Zn.normal!==void 0||Zn.color!==void 0)&&mt.update(Le,je,Dn),(Wn||Kt.receiveShadow!==Le.receiveShadow)&&(Kt.receiveShadow=Le.receiveShadow,Zi.setValue(Ge,"receiveShadow",Le.receiveShadow)),ke.isMeshGouraudMaterial&&ke.envMap!==null&&(En.envMap.value=Vt,En.flipEnvMap.value=Vt.isCubeTexture&&Vt.isRenderTargetTexture===!1?-1:1),ke.isMeshStandardMaterial&&ke.envMap===null&&We.environment!==null&&(En.envMapIntensity.value=We.environmentIntensity),Wn&&(Zi.setValue(Ge,"toneMappingExposure",K.toneMappingExposure),Kt.needsLights&&Wl(En,bn),At&&ke.fog===!0&&Rt.refreshFogUniforms(En,At),Rt.refreshMaterialUniforms(En,ke,Se,Re,J.state.transmissionRenderTarget[fe.id]),WebGLUniforms.upload(Ge,Js(Kt),En,ve)),ke.isShaderMaterial&&ke.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Ge,Js(Kt),En,ve),ke.uniformsNeedUpdate=!1),ke.isSpriteMaterial&&Zi.setValue(Ge,"center",Le.center),Zi.setValue(Ge,"modelViewMatrix",Le.modelViewMatrix),Zi.setValue(Ge,"normalMatrix",Le.normalMatrix),Zi.setValue(Ge,"modelMatrix",Le.matrixWorld),ke.isShaderMaterial||ke.isRawShaderMaterial){const Qi=ke.uniformsGroups;for(let Sn=0,zs=Qi.length;Sn<zs;Sn++){const kn=Qi[Sn];Ne.update(kn,Dn),Ne.bind(kn,Dn)}}return Dn}function Wl(fe,We){fe.ambientLightColor.needsUpdate=We,fe.lightProbe.needsUpdate=We,fe.directionalLights.needsUpdate=We,fe.directionalLightShadows.needsUpdate=We,fe.pointLights.needsUpdate=We,fe.pointLightShadows.needsUpdate=We,fe.spotLights.needsUpdate=We,fe.spotLightShadows.needsUpdate=We,fe.rectAreaLights.needsUpdate=We,fe.hemisphereLights.needsUpdate=We}function El(fe){return fe.isMeshLambertMaterial||fe.isMeshToonMaterial||fe.isMeshPhongMaterial||fe.isMeshStandardMaterial||fe.isShadowMaterial||fe.isShaderMaterial&&fe.lights===!0}this.getActiveCubeFace=function(){return Q},this.getActiveMipmapLevel=function(){return ee},this.getRenderTarget=function(){return ie},this.setRenderTargetTextures=function(fe,We,je){xt.get(fe.texture).__webglTexture=We,xt.get(fe.depthTexture).__webglTexture=je;const ke=xt.get(fe);ke.__hasExternalTextures=!0,ke.__autoAllocateDepthBuffer=je===void 0,ke.__autoAllocateDepthBuffer||ot.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ke.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(fe,We){const je=xt.get(fe);je.__webglFramebuffer=We,je.__useDefaultFramebuffer=We===void 0};const fo=Ge.createFramebuffer();this.setRenderTarget=function(fe,We=0,je=0){ie=fe,Q=We,ee=je;let ke=!0,Le=null,At=!1,Nt=!1;if(fe){const Vt=xt.get(fe);if(Vt.__useDefaultFramebuffer!==void 0)at.bindFramebuffer(Ge.FRAMEBUFFER,null),ke=!1;else if(Vt.__webglFramebuffer===void 0)ve.setupRenderTarget(fe);else if(Vt.__hasExternalTextures)ve.rebindTextures(fe,xt.get(fe.texture).__webglTexture,xt.get(fe.depthTexture).__webglTexture);else if(fe.depthBuffer){const Ft=fe.depthTexture;if(Vt.__boundDepthTexture!==Ft){if(Ft!==null&&xt.has(Ft)&&(fe.width!==Ft.image.width||fe.height!==Ft.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ve.setupDepthRenderbuffer(fe)}}const Ot=fe.texture;(Ot.isData3DTexture||Ot.isDataArrayTexture||Ot.isCompressedArrayTexture)&&(Nt=!0);const Ut=xt.get(fe).__webglFramebuffer;fe.isWebGLCubeRenderTarget?(Array.isArray(Ut[We])?Le=Ut[We][je]:Le=Ut[We],At=!0):fe.samples>0&&ve.useMultisampledRTT(fe)===!1?Le=xt.get(fe).__webglMultisampledFramebuffer:Array.isArray(Ut)?Le=Ut[je]:Le=Ut,ae.copy(fe.viewport),le.copy(fe.scissor),ge=fe.scissorTest}else ae.copy(Ie).multiplyScalar(Se).floor(),le.copy(Be).multiplyScalar(Se).floor(),ge=ue;if(je!==0&&(Le=fo),at.bindFramebuffer(Ge.FRAMEBUFFER,Le)&&ke&&at.drawBuffers(fe,Le),at.viewport(ae),at.scissor(le),at.setScissorTest(ge),At){const Vt=xt.get(fe.texture);Ge.framebufferTexture2D(Ge.FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Ge.TEXTURE_CUBE_MAP_POSITIVE_X+We,Vt.__webglTexture,je)}else if(Nt){const Vt=xt.get(fe.texture),Ot=We;Ge.framebufferTextureLayer(Ge.FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Vt.__webglTexture,je,Ot)}else if(fe!==null&&je!==0){const Vt=xt.get(fe.texture);Ge.framebufferTexture2D(Ge.FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Ge.TEXTURE_2D,Vt.__webglTexture,je)}te=-1},this.readRenderTargetPixels=function(fe,We,je,ke,Le,At,Nt){if(!(fe&&fe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Wt=xt.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&Nt!==void 0&&(Wt=Wt[Nt]),Wt){at.bindFramebuffer(Ge.FRAMEBUFFER,Wt);try{const Vt=fe.texture,Ot=Vt.format,Ut=Vt.type;if(!vt.textureFormatReadable(Ot)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!vt.textureTypeReadable(Ut)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}We>=0&&We<=fe.width-ke&&je>=0&&je<=fe.height-Le&&Ge.readPixels(We,je,ke,Le,Ye.convert(Ot),Ye.convert(Ut),At)}finally{const Vt=ie!==null?xt.get(ie).__webglFramebuffer:null;at.bindFramebuffer(Ge.FRAMEBUFFER,Vt)}}},this.readRenderTargetPixelsAsync=async function(fe,We,je,ke,Le,At,Nt){if(!(fe&&fe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Wt=xt.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&Nt!==void 0&&(Wt=Wt[Nt]),Wt){const Vt=fe.texture,Ot=Vt.format,Ut=Vt.type;if(!vt.textureFormatReadable(Ot))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!vt.textureTypeReadable(Ut))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(We>=0&&We<=fe.width-ke&&je>=0&&je<=fe.height-Le){at.bindFramebuffer(Ge.FRAMEBUFFER,Wt);const Ft=Ge.createBuffer();Ge.bindBuffer(Ge.PIXEL_PACK_BUFFER,Ft),Ge.bufferData(Ge.PIXEL_PACK_BUFFER,At.byteLength,Ge.STREAM_READ),Ge.readPixels(We,je,ke,Le,Ye.convert(Ot),Ye.convert(Ut),0);const Ci=ie!==null?xt.get(ie).__webglFramebuffer:null;at.bindFramebuffer(Ge.FRAMEBUFFER,Ci);const Ii=Ge.fenceSync(Ge.SYNC_GPU_COMMANDS_COMPLETE,0);return Ge.flush(),await probeAsync(Ge,Ii,4),Ge.bindBuffer(Ge.PIXEL_PACK_BUFFER,Ft),Ge.getBufferSubData(Ge.PIXEL_PACK_BUFFER,0,At),Ge.deleteBuffer(Ft),Ge.deleteSync(Ii),At}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(fe,We=null,je=0){fe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),We=arguments[0]||null,fe=arguments[1]);const ke=Math.pow(2,-je),Le=Math.floor(fe.image.width*ke),At=Math.floor(fe.image.height*ke),Nt=We!==null?We.x:0,Wt=We!==null?We.y:0;ve.setTexture2D(fe,0),Ge.copyTexSubImage2D(Ge.TEXTURE_2D,je,0,0,Nt,Wt,Le,At),at.unbindTexture()};const Mr=Ge.createFramebuffer(),Hs=Ge.createFramebuffer();this.copyTextureToTexture=function(fe,We,je=null,ke=null,Le=0,At=null){fe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),ke=arguments[0]||null,fe=arguments[1],We=arguments[2],At=arguments[3]||0,je=null),At===null&&(Le!==0?(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),At=Le,Le=0):At=0);let Nt,Wt,Vt,Ot,Ut,Ft,Ci,Ii,Hi;const mi=fe.isCompressedTexture?fe.mipmaps[At]:fe.image;if(je!==null)Nt=je.max.x-je.min.x,Wt=je.max.y-je.min.y,Vt=je.isBox3?je.max.z-je.min.z:1,Ot=je.min.x,Ut=je.min.y,Ft=je.isBox3?je.min.z:0;else{const Zn=Math.pow(2,-Le);Nt=Math.floor(mi.width*Zn),Wt=Math.floor(mi.height*Zn),fe.isDataArrayTexture?Vt=mi.depth:fe.isData3DTexture?Vt=Math.floor(mi.depth*Zn):Vt=1,Ot=0,Ut=0,Ft=0}ke!==null?(Ci=ke.x,Ii=ke.y,Hi=ke.z):(Ci=0,Ii=0,Hi=0);const qt=Ye.convert(We.format),Kt=Ye.convert(We.type);let gn;We.isData3DTexture?(ve.setTexture3D(We,0),gn=Ge.TEXTURE_3D):We.isDataArrayTexture||We.isCompressedArrayTexture?(ve.setTexture2DArray(We,0),gn=Ge.TEXTURE_2D_ARRAY):(ve.setTexture2D(We,0),gn=Ge.TEXTURE_2D),Ge.pixelStorei(Ge.UNPACK_FLIP_Y_WEBGL,We.flipY),Ge.pixelStorei(Ge.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),Ge.pixelStorei(Ge.UNPACK_ALIGNMENT,We.unpackAlignment);const fi=Ge.getParameter(Ge.UNPACK_ROW_LENGTH),Dn=Ge.getParameter(Ge.UNPACK_IMAGE_HEIGHT),Is=Ge.getParameter(Ge.UNPACK_SKIP_PIXELS),Wn=Ge.getParameter(Ge.UNPACK_SKIP_ROWS),bn=Ge.getParameter(Ge.UNPACK_SKIP_IMAGES);Ge.pixelStorei(Ge.UNPACK_ROW_LENGTH,mi.width),Ge.pixelStorei(Ge.UNPACK_IMAGE_HEIGHT,mi.height),Ge.pixelStorei(Ge.UNPACK_SKIP_PIXELS,Ot),Ge.pixelStorei(Ge.UNPACK_SKIP_ROWS,Ut),Ge.pixelStorei(Ge.UNPACK_SKIP_IMAGES,Ft);const Zi=fe.isDataArrayTexture||fe.isData3DTexture,En=We.isDataArrayTexture||We.isData3DTexture;if(fe.isDepthTexture){const Zn=xt.get(fe),Qi=xt.get(We),Sn=xt.get(Zn.__renderTarget),zs=xt.get(Qi.__renderTarget);at.bindFramebuffer(Ge.READ_FRAMEBUFFER,Sn.__webglFramebuffer),at.bindFramebuffer(Ge.DRAW_FRAMEBUFFER,zs.__webglFramebuffer);for(let kn=0;kn<Vt;kn++)Zi&&(Ge.framebufferTextureLayer(Ge.READ_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,xt.get(fe).__webglTexture,Le,Ft+kn),Ge.framebufferTextureLayer(Ge.DRAW_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,xt.get(We).__webglTexture,At,Hi+kn)),Ge.blitFramebuffer(Ot,Ut,Nt,Wt,Ci,Ii,Nt,Wt,Ge.DEPTH_BUFFER_BIT,Ge.NEAREST);at.bindFramebuffer(Ge.READ_FRAMEBUFFER,null),at.bindFramebuffer(Ge.DRAW_FRAMEBUFFER,null)}else if(Le!==0||fe.isRenderTargetTexture||xt.has(fe)){const Zn=xt.get(fe),Qi=xt.get(We);at.bindFramebuffer(Ge.READ_FRAMEBUFFER,Mr),at.bindFramebuffer(Ge.DRAW_FRAMEBUFFER,Hs);for(let Sn=0;Sn<Vt;Sn++)Zi?Ge.framebufferTextureLayer(Ge.READ_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Zn.__webglTexture,Le,Ft+Sn):Ge.framebufferTexture2D(Ge.READ_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Ge.TEXTURE_2D,Zn.__webglTexture,Le),En?Ge.framebufferTextureLayer(Ge.DRAW_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Qi.__webglTexture,At,Hi+Sn):Ge.framebufferTexture2D(Ge.DRAW_FRAMEBUFFER,Ge.COLOR_ATTACHMENT0,Ge.TEXTURE_2D,Qi.__webglTexture,At),Le!==0?Ge.blitFramebuffer(Ot,Ut,Nt,Wt,Ci,Ii,Nt,Wt,Ge.COLOR_BUFFER_BIT,Ge.NEAREST):En?Ge.copyTexSubImage3D(gn,At,Ci,Ii,Hi+Sn,Ot,Ut,Nt,Wt):Ge.copyTexSubImage2D(gn,At,Ci,Ii,Ot,Ut,Nt,Wt);at.bindFramebuffer(Ge.READ_FRAMEBUFFER,null),at.bindFramebuffer(Ge.DRAW_FRAMEBUFFER,null)}else En?fe.isDataTexture||fe.isData3DTexture?Ge.texSubImage3D(gn,At,Ci,Ii,Hi,Nt,Wt,Vt,qt,Kt,mi.data):We.isCompressedArrayTexture?Ge.compressedTexSubImage3D(gn,At,Ci,Ii,Hi,Nt,Wt,Vt,qt,mi.data):Ge.texSubImage3D(gn,At,Ci,Ii,Hi,Nt,Wt,Vt,qt,Kt,mi):fe.isDataTexture?Ge.texSubImage2D(Ge.TEXTURE_2D,At,Ci,Ii,Nt,Wt,qt,Kt,mi.data):fe.isCompressedTexture?Ge.compressedTexSubImage2D(Ge.TEXTURE_2D,At,Ci,Ii,mi.width,mi.height,qt,mi.data):Ge.texSubImage2D(Ge.TEXTURE_2D,At,Ci,Ii,Nt,Wt,qt,Kt,mi);Ge.pixelStorei(Ge.UNPACK_ROW_LENGTH,fi),Ge.pixelStorei(Ge.UNPACK_IMAGE_HEIGHT,Dn),Ge.pixelStorei(Ge.UNPACK_SKIP_PIXELS,Is),Ge.pixelStorei(Ge.UNPACK_SKIP_ROWS,Wn),Ge.pixelStorei(Ge.UNPACK_SKIP_IMAGES,bn),At===0&&We.generateMipmaps&&Ge.generateMipmap(gn),at.unbindTexture()},this.copyTextureToTexture3D=function(fe,We,je=null,ke=null,Le=0){return fe.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),je=arguments[0]||null,ke=arguments[1]||null,fe=arguments[2],We=arguments[3],Le=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(fe,We,je,ke,Le)},this.initRenderTarget=function(fe){xt.get(fe).__webglFramebuffer===void 0&&ve.setupRenderTarget(fe)},this.initTexture=function(fe){fe.isCubeTexture?ve.setTextureCube(fe,0):fe.isData3DTexture?ve.setTexture3D(fe,0):fe.isDataArrayTexture||fe.isCompressedArrayTexture?ve.setTexture2DArray(fe,0):ve.setTexture2D(fe,0),at.unbindTexture()},this.resetState=function(){Q=0,ee=0,ie=null,at.reset(),_e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const o=this.getContext();o.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(t),o.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}const THREE=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AgXToneMapping,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,AttachedBindMode,Audio,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,BatchedMesh,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,ConstantAlphaFactor,ConstantColorFactor,Controls,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DetachedBindMode,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher:EventDispatcher$1,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace,LinearToneMapping,LinearTransfer,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix2,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeutralToneMapping,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusConstantAlphaFactor,OneMinusConstantColorFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion:Quaternion$2,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGBDepthPacking,RGBFormat,RGBIntegerFormat,RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGDepthPacking,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray:Ray$2,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RenderTarget,RenderTarget3D,RenderTargetArray,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace,SRGBTransfer,Scene,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape:Shape$2,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,Source,Sphere:Sphere$1,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TextureUtils,TimestampQuery,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedInt5999Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoFrameTexture,VideoTexture,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WebXRController,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,createCanvasElement},Symbol.toStringTag,{value:"Module"}));var constants$1={exports:{}},reactReconcilerConstants_production={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconcilerConstants_production;function requireReactReconcilerConstants_production(){return hasRequiredReactReconcilerConstants_production||(hasRequiredReactReconcilerConstants_production=1,reactReconcilerConstants_production.ConcurrentRoot=1,reactReconcilerConstants_production.ContinuousEventPriority=8,reactReconcilerConstants_production.DefaultEventPriority=32,reactReconcilerConstants_production.DiscreteEventPriority=2,reactReconcilerConstants_production.IdleEventPriority=268435456,reactReconcilerConstants_production.LegacyRoot=0,reactReconcilerConstants_production.NoEventPriority=0),reactReconcilerConstants_production}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants$1.exports=requireReactReconcilerConstants_production()),constants$1.exports}var constantsExports=requireConstants(),withSelector={exports:{}},withSelector_production={},shim={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production;function requireUseSyncExternalStoreShim_production(){if(hasRequiredUseSyncExternalStoreShim_production)return useSyncExternalStoreShim_production;hasRequiredUseSyncExternalStoreShim_production=1;var n=requireReact();function t(S,w){return S===w&&(S!==0||1/S===1/w)||S!==S&&w!==w}var o=typeof Object.is=="function"?Object.is:t,u=n.useState,d=n.useEffect,C=n.useLayoutEffect,I=n.useDebugValue;function f(S,w){var M=w(),V=u({inst:{value:M,getSnapshot:w}}),T=V[0].inst,H=V[1];return C(function(){T.value=M,T.getSnapshot=w,A(T)&&H({inst:T})},[S,M,w]),d(function(){return A(T)&&H({inst:T}),S(function(){A(T)&&H({inst:T})})},[S]),I(M),M}function A(S){var w=S.getSnapshot;S=S.value;try{var M=w();return!o(S,M)}catch{return!0}}function y(S,w){return w()}var G=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?y:f;return useSyncExternalStoreShim_production.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:G,useSyncExternalStoreShim_production}var hasRequiredShim;function requireShim(){return hasRequiredShim||(hasRequiredShim=1,shim.exports=requireUseSyncExternalStoreShim_production()),shim.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredWithSelector_production;function requireWithSelector_production(){if(hasRequiredWithSelector_production)return withSelector_production;hasRequiredWithSelector_production=1;var n=requireReact(),t=requireShim();function o(y,G){return y===G&&(y!==0||1/y===1/G)||y!==y&&G!==G}var u=typeof Object.is=="function"?Object.is:o,d=t.useSyncExternalStore,C=n.useRef,I=n.useEffect,f=n.useMemo,A=n.useDebugValue;return withSelector_production.useSyncExternalStoreWithSelector=function(y,G,S,w,M){var V=C(null);if(V.current===null){var T={hasValue:!1,value:null};V.current=T}else T=V.current;V=f(function(){function J(Q){if(!z){if(z=!0,L=Q,Q=w(Q),M!==void 0&&T.hasValue){var ee=T.value;if(M(ee,Q))return K=ee}return K=Q}if(ee=K,u(L,Q))return ee;var ie=w(Q);return M!==void 0&&M(ee,ie)?(L=Q,ee):(L=Q,K=ie)}var z=!1,L,K,O=S===void 0?null:S;return[function(){return J(G())},O===null?void 0:function(){return J(O())}]},[G,S,w,M]);var H=d(y,V[0],V[1]);return I(function(){T.hasValue=!0,T.value=H},[H]),A(H),H},withSelector_production}var hasRequiredWithSelector;function requireWithSelector(){return hasRequiredWithSelector||(hasRequiredWithSelector=1,withSelector.exports=requireWithSelector_production()),withSelector.exports}var withSelectorExports=requireWithSelector();const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),createStoreImpl=n=>{let t;const o=new Set,u=(y,G)=>{const S=typeof y=="function"?y(t):y;if(!Object.is(S,t)){const w=t;t=G??(typeof S!="object"||S===null)?S:Object.assign({},t,S),o.forEach(M=>M(t,w))}},d=()=>t,f={setState:u,getState:d,getInitialState:()=>A,subscribe:y=>(o.add(y),()=>o.delete(y))},A=t=n(u,d,f);return f},createStore$1=n=>n?createStoreImpl(n):createStoreImpl,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports,identity=n=>n;function useStoreWithEqualityFn(n,t=identity,o){const u=useSyncExternalStoreWithSelector(n.subscribe,n.getState,n.getInitialState,t,o);return React.useDebugValue(u),u}const createWithEqualityFnImpl=(n,t)=>{const o=createStore$1(n),u=(d,C=t)=>useStoreWithEqualityFn(o,d,C);return Object.assign(u,o),u},createWithEqualityFn=(n,t)=>n?createWithEqualityFnImpl(n,t):createWithEqualityFnImpl;var reactReconciler={exports:{}},reactReconciler_production={exports:{}};/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactReconciler_production;function requireReactReconciler_production(){return hasRequiredReactReconciler_production||(hasRequiredReactReconciler_production=1,function(n){n.exports=function(t){function o(_,N,P,$){return new hu(_,N,P,$)}function u(){}function d(_){var N="https://react.dev/errors/"+_;if(1<arguments.length){N+="?args[]="+encodeURIComponent(arguments[1]);for(var P=2;P<arguments.length;P++)N+="&args[]="+encodeURIComponent(arguments[P])}return"Minified React error #"+_+"; visit "+N+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function C(_){return _===null||typeof _!="object"?null:(_=wi&&_[wi]||_["@@iterator"],typeof _=="function"?_:null)}function I(_){if(_==null)return null;if(typeof _=="function")return _.$$typeof===dn?null:_.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case ur:return"Fragment";case so:return"Portal";case hr:return"Profiler";case Kr:return"StrictMode";case Mo:return"Suspense";case bl:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case dr:return(_.displayName||"Context")+".Provider";case ng:return(_._context.displayName||"Context")+".Consumer";case sc:var N=_.render;return _=_.displayName,_||(_=N.displayName||N.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case va:return N=_.displayName||null,N!==null?N:I(_.type)||"Memo";case No:N=_._payload,_=_._init;try{return I(_(N))}catch{}}return null}function f(_){if(Cr===void 0)try{throw Error()}catch(P){var N=P.stack.trim().match(/\n( *(at )?)/);Cr=N&&N[1]||"",Ir=-1<P.stack.indexOf(`
    at`)?" (<anonymous>)":-1<P.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Cr+_+Ir}function A(_,N){if(!_||Ba)return"";Ba=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var $={DetermineComponentFrameRoot:function(){try{if(N){var Et=function(){throw Error()};if(Object.defineProperty(Et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Et,[])}catch(ii){var Xt=ii}Reflect.construct(_,[],Et)}else{try{Et.call()}catch(ii){Xt=ii}_.call(Et.prototype)}}else{try{throw Error()}catch(ii){Xt=ii}(Et=_())&&typeof Et.catch=="function"&&Et.catch(function(){})}}catch(ii){if(ii&&Xt&&typeof ii.stack=="string")return[ii.stack,Xt.stack]}return[null,null]}};$.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var oe=Object.getOwnPropertyDescriptor($.DetermineComponentFrameRoot,"name");oe&&oe.configurable&&Object.defineProperty($.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var re=$.DetermineComponentFrameRoot(),Ae=re[0],Me=re[1];if(Ae&&Me){var Pe=Ae.split(`
`),ut=Me.split(`
`);for(oe=$=0;$<Pe.length&&!Pe[$].includes("DetermineComponentFrameRoot");)$++;for(;oe<ut.length&&!ut[oe].includes("DetermineComponentFrameRoot");)oe++;if($===Pe.length||oe===ut.length)for($=Pe.length-1,oe=ut.length-1;1<=$&&0<=oe&&Pe[$]!==ut[oe];)oe--;for(;1<=$&&0<=oe;$--,oe--)if(Pe[$]!==ut[oe]){if($!==1||oe!==1)do if($--,oe--,0>oe||Pe[$]!==ut[oe]){var Zt=`
`+Pe[$].replace(" at new "," at ");return _.displayName&&Zt.includes("<anonymous>")&&(Zt=Zt.replace("<anonymous>",_.displayName)),Zt}while(1<=$&&0<=oe);break}}}finally{Ba=!1,Error.prepareStackTrace=P}return(P=_?_.displayName||_.name:"")?f(P):""}function y(_){switch(_.tag){case 26:case 27:case 5:return f(_.type);case 16:return f("Lazy");case 13:return f("Suspense");case 19:return f("SuspenseList");case 0:case 15:return _=A(_.type,!1),_;case 11:return _=A(_.type.render,!1),_;case 1:return _=A(_.type,!0),_;default:return""}}function G(_){try{var N="";do N+=y(_),_=_.return;while(_);return N}catch(P){return`
Error generating stack: `+P.message+`
`+P.stack}}function S(_){var N=_,P=_;if(_.alternate)for(;N.return;)N=N.return;else{_=N;do N=_,(N.flags&4098)!==0&&(P=N.return),_=N.return;while(_)}return N.tag===3?P:null}function w(_){if(S(_)!==_)throw Error(d(188))}function M(_){var N=_.alternate;if(!N){if(N=S(_),N===null)throw Error(d(188));return N!==_?null:_}for(var P=_,$=N;;){var oe=P.return;if(oe===null)break;var re=oe.alternate;if(re===null){if($=oe.return,$!==null){P=$;continue}break}if(oe.child===re.child){for(re=oe.child;re;){if(re===P)return w(oe),_;if(re===$)return w(oe),N;re=re.sibling}throw Error(d(188))}if(P.return!==$.return)P=oe,$=re;else{for(var Ae=!1,Me=oe.child;Me;){if(Me===P){Ae=!0,P=oe,$=re;break}if(Me===$){Ae=!0,$=oe,P=re;break}Me=Me.sibling}if(!Ae){for(Me=re.child;Me;){if(Me===P){Ae=!0,P=re,$=oe;break}if(Me===$){Ae=!0,$=re,P=oe;break}Me=Me.sibling}if(!Ae)throw Error(d(189))}}if(P.alternate!==$)throw Error(d(190))}if(P.tag!==3)throw Error(d(188));return P.stateNode.current===P?_:N}function V(_){var N=_.tag;if(N===5||N===26||N===27||N===6)return _;for(_=_.child;_!==null;){if(N=V(_),N!==null)return N;_=_.sibling}return null}function T(_){var N=_.tag;if(N===5||N===26||N===27||N===6)return _;for(_=_.child;_!==null;){if(_.tag!==4&&(N=T(_),N!==null))return N;_=_.sibling}return null}function H(_){return{current:_}}function J(_){0>mr||(_.current=pc[mr],pc[mr]=null,mr--)}function z(_,N){mr++,pc[mr]=_.current,_.current=N}function L(_){return _>>>=0,_===0?32:31-(xg(_)/Zh|0)|0}function K(_){var N=_&42;if(N!==0)return N;switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return _&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return _}}function O(_,N){var P=_.pendingLanes;if(P===0)return 0;var $=0,oe=_.suspendedLanes,re=_.pingedLanes,Ae=_.warmLanes;_=_.finishedLanes!==0;var Me=P&134217727;return Me!==0?(P=Me&~oe,P!==0?$=K(P):(re&=Me,re!==0?$=K(re):_||(Ae=Me&~Ae,Ae!==0&&($=K(Ae))))):(Me=P&~oe,Me!==0?$=K(Me):re!==0?$=K(re):_||(Ae=P&~Ae,Ae!==0&&($=K(Ae)))),$===0?0:N!==0&&N!==$&&(N&oe)===0&&(oe=$&-$,Ae=N&-N,oe>=Ae||oe===32&&(Ae&4194176)!==0)?N:$}function Q(_,N){return(_.pendingLanes&~(_.suspendedLanes&~_.pingedLanes)&N)===0}function ee(_,N){switch(_){case 1:case 2:case 4:case 8:return N+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return N+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ie(){var _=Bl;return Bl<<=1,(Bl&4194176)===0&&(Bl=128),_}function te(){var _=Za;return Za<<=1,(Za&62914560)===0&&(Za=4194304),_}function se(_){for(var N=[],P=0;31>P;P++)N.push(_);return N}function ae(_,N){_.pendingLanes|=N,N!==268435456&&(_.suspendedLanes=0,_.pingedLanes=0,_.warmLanes=0)}function le(_,N,P,$,oe,re){var Ae=_.pendingLanes;_.pendingLanes=P,_.suspendedLanes=0,_.pingedLanes=0,_.warmLanes=0,_.expiredLanes&=P,_.entangledLanes&=P,_.errorRecoveryDisabledLanes&=P,_.shellSuspendCounter=0;var Me=_.entanglements,Pe=_.expirationTimes,ut=_.hiddenUpdates;for(P=Ae&~P;0<P;){var Zt=31-sn(P),Et=1<<Zt;Me[Zt]=0,Pe[Zt]=-1;var Xt=ut[Zt];if(Xt!==null)for(ut[Zt]=null,Zt=0;Zt<Xt.length;Zt++){var ii=Xt[Zt];ii!==null&&(ii.lane&=-536870913)}P&=~Et}$!==0&&ge(_,$,0),re!==0&&oe===0&&_.tag!==0&&(_.suspendedLanes|=re&~(Ae&~N))}function ge(_,N,P){_.pendingLanes|=N,_.suspendedLanes&=~N;var $=31-sn(N);_.entangledLanes|=N,_.entanglements[$]=_.entanglements[$]|1073741824|P&4194218}function be(_,N){var P=_.entangledLanes|=N;for(_=_.entanglements;P;){var $=31-sn(P),oe=1<<$;oe&N|_[$]&N&&(_[$]|=N),P&=~oe}}function Xe(_){return _&=-_,2<_?8<_?(_&134217727)!==0?32:268435456:8:2}function Ce(_){if(Cn&&typeof Cn.onCommitFiberRoot=="function")try{Cn.onCommitFiberRoot(_a,_,void 0,(_.current.flags&128)===128)}catch{}}function Re(_){if(typeof Jn=="function"&&mc(_),Cn&&typeof Cn.setStrictMode=="function")try{Cn.setStrictMode(_a,_)}catch{}}function Se(_,N){return _===N&&(_!==0||1/_===1/N)||_!==_&&N!==N}function Ze(_,N){if(typeof _=="object"&&_!==null){var P=bc.get(_);return P!==void 0?P:(N={value:_,source:N,stack:G(N)},bc.set(_,N),N)}return{value:_,source:N,stack:G(N)}}function he(_,N){bs[ys++]=Ma,bs[ys++]=yr,yr=_,Ma=N}function Ie(_,N,P){hs[Hn++]=lo,hs[Hn++]=co,hs[Hn++]=Ds,Ds=_;var $=lo;_=co;var oe=32-sn($)-1;$&=~(1<<oe),P+=1;var re=32-sn(N)+oe;if(30<re){var Ae=oe-oe%5;re=($&(1<<Ae)-1).toString(32),$>>=Ae,oe-=Ae,lo=1<<32-sn(N)+oe|P<<oe|$,co=re+_}else lo=1<<re|P<<oe|$,co=_}function Be(_){_.return!==null&&(he(_,1),Ie(_,1,0))}function ue(_){for(;_===yr;)yr=bs[--ys],bs[ys]=null,Ma=bs[--ys],bs[ys]=null;for(;_===Ds;)Ds=hs[--Hn],hs[Hn]=null,co=hs[--Hn],hs[Hn]=null,lo=hs[--Hn],hs[Hn]=null}function me(_,N){z(To,N),z(Rs,_),z(on,null),_=sg(N),J(on),z(on,_)}function xe(){J(on),J(Rs),J(To)}function Je(_){_.memoizedState!==null&&z(Xl,_);var N=on.current,P=du(N,_.type);N!==P&&(z(Rs,_),z(on,P))}function Ve(_){Rs.current===_&&(J(on),J(Rs)),Xl.current===_&&(J(Xl),Fs?Wo._currentValue=Dr:Wo._currentValue2=Dr)}function Ee(_){var N=Error(d(418,""));throw Ue(Ze(N,_)),xl}function Ct(_,N){if(!us)throw Error(d(175));Ur(_.stateNode,_.type,_.memoizedProps,N,_)||Ee(_)}function st(_){for(rn=_.return;rn;)switch(rn.tag){case 3:case 27:ks=!0;return;case 5:case 13:ks=!1;return;default:rn=rn.return}}function wt(_){if(!us||_!==rn)return!1;if(!yi)return st(_),yi=!0,!1;var N=!1;if(xn?_.tag!==3&&_.tag!==27&&(_.tag!==5||pg(_.type)&&!Nn(_.type,_.memoizedProps))&&(N=!0):_.tag!==3&&(_.tag!==5||pg(_.type)&&!Nn(_.type,_.memoizedProps))&&(N=!0),N&&Mi&&Ee(_),st(_),_.tag===13){if(!us)throw Error(d(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(d(317));Mi=Pu(_)}else Mi=rn?Ar(_.stateNode):null;return!0}function Qe(){us&&(Mi=rn=null,yi=!1)}function Ue(_){Zs===null?Zs=[_]:Zs.push(_)}function Ge(){for(var _=Jo,N=Os=Jo=0;N<_;){var P=ds[N];ds[N++]=null;var $=ds[N];ds[N++]=null;var oe=ds[N];ds[N++]=null;var re=ds[N];if(ds[N++]=null,$!==null&&oe!==null){var Ae=$.pending;Ae===null?oe.next=oe:(oe.next=Ae.next,Ae.next=oe),$.pending=oe}re!==0&&at(P,oe,re)}}function Gt(_,N,P,$){ds[Jo++]=_,ds[Jo++]=N,ds[Jo++]=P,ds[Jo++]=$,Os|=$,_.lanes|=$,_=_.alternate,_!==null&&(_.lanes|=$)}function ot(_,N,P,$){return Gt(_,N,P,$),Tt(_)}function vt(_,N){return Gt(_,null,null,N),Tt(_)}function at(_,N,P){_.lanes|=P;var $=_.alternate;$!==null&&($.lanes|=P);for(var oe=!1,re=_.return;re!==null;)re.childLanes|=P,$=re.alternate,$!==null&&($.childLanes|=P),re.tag===22&&(_=re.stateNode,_===null||_._visibility&1||(oe=!0)),_=re,re=re.return;oe&&N!==null&&_.tag===3&&(re=_.stateNode,oe=31-sn(P),re=re.hiddenUpdates,_=re[oe],_===null?re[oe]=[N]:_.push(N),N.lane=P|536870912)}function Tt(_){if(50<na)throw na=0,Mg=null,Error(d(185));for(var N=_.return;N!==null;)_=N,N=_.return;return _.tag===3?_.stateNode:null}function xt(_){_!==Gr&&_.next===null&&(Gr===null?Ki=Gr=_:Gr=Gr.next=_),an=!0,yc||(yc=!0,ze(de))}function ve(_,N){if(!Gc&&an){Gc=!0;do for(var P=!1,$=Ki;$!==null;){if(_!==0){var oe=$.pendingLanes;if(oe===0)var re=0;else{var Ae=$.suspendedLanes,Me=$.pingedLanes;re=(1<<31-sn(42|_)+1)-1,re&=oe&~(Ae&~Me),re=re&201326677?re&201326677|1:re?re|2:0}re!==0&&(P=!0,dt($,re))}else re=di,re=O($,$===Vi?re:0),(re&3)===0||Q($,re)||(P=!0,dt($,re));$=$.next}while(P);Gc=!1}}function de(){an=yc=!1;var _=0;Na!==0&&(pu()&&(_=Na),Na=0);for(var N=ms(),P=null,$=Ki;$!==null;){var oe=$.next,re=De($,N);re===0?($.next=null,P===null?Ki=oe:P.next=oe,oe===null&&(Gr=P)):(P=$,(_!==0||(re&3)!==0)&&(an=!0)),$=oe}ve(_)}function De(_,N){for(var P=_.suspendedLanes,$=_.pingedLanes,oe=_.expirationTimes,re=_.pendingLanes&-62914561;0<re;){var Ae=31-sn(re),Me=1<<Ae,Pe=oe[Ae];Pe===-1?((Me&P)===0||(Me&$)!==0)&&(oe[Ae]=ee(Me,N)):Pe<=N&&(_.expiredLanes|=Me),re&=~Me}if(N=Vi,P=di,P=O(_,_===N?P:0),$=_.callbackNode,P===0||_===N&&_i===2||_.cancelPendingCommit!==null)return $!==null&&$!==null&&Ps($),_.callbackNode=null,_.callbackPriority=0;if((P&3)===0||Q(_,P)){if(N=P&-P,N===_.callbackPriority)return N;switch($!==null&&Ps($),Xe(P)){case 2:case 8:P=Sl;break;case 32:P=wa;break;case 268435456:P=jr;break;default:P=wa}return $=nt.bind(null,_),P=ao(P,$),_.callbackPriority=N,_.callbackNode=P,N}return $!==null&&$!==null&&Ps($),_.callbackPriority=2,_.callbackNode=null,2}function nt(_,N){var P=_.callbackNode;if(ar()&&_.callbackNode!==P)return null;var $=di;return $=O(_,_===Vi?$:0),$===0?null:(fs(_,$,N),De(_,ms()),_.callbackNode!=null&&_.callbackNode===P?nt.bind(null,_):null)}function dt(_,N){if(ar())return null;fs(_,N,!0)}function ze(_){yu?Gu(function(){(hi&6)!==0?ao(Ac,_):_()}):ao(Ac,_)}function rt(){return Na===0&&(Na=ie()),Na}function Rt(_,N){if(Va===null){var P=Va=[];vc=0,Pi=rt(),Rn={status:"pending",value:void 0,then:function($){P.push($)}}}return vc++,N.then(Mt,Mt),N}function Mt(){if(--vc===0&&Va!==null){Rn!==null&&(Rn.status="fulfilled");var _=Va;Va=null,Pi=0,Rn=null;for(var N=0;N<_.length;N++)(0,_[N])()}}function Yt(_,N){var P=[],$={status:"pending",value:null,reason:null,then:function(oe){P.push(oe)}};return _.then(function(){$.status="fulfilled",$.value=N;for(var oe=0;oe<P.length;oe++)(0,P[oe])(N)},function(oe){for($.status="rejected",$.reason=oe,oe=0;oe<P.length;oe++)(0,P[oe])(void 0)}),$}function Oe(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gt(_,N){_=_.updateQueue,N.updateQueue===_&&(N.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,callbacks:null})}function pt(_){return{lane:_,tag:0,payload:null,callback:null,next:null}}function mt(_,N,P){var $=_.updateQueue;if($===null)return null;if($=$.shared,(hi&2)!==0){var oe=$.pending;return oe===null?N.next=N:(N.next=oe.next,oe.next=N),$.pending=N,N=Tt(_),at(_,null,P),N}return Gt(_,$,N,P),Tt(_)}function It(_,N,P){if(N=N.updateQueue,N!==null&&(N=N.shared,(P&4194176)!==0)){var $=N.lanes;$&=_.pendingLanes,P|=$,N.lanes=P,be(_,P)}}function ye(_,N){var P=_.updateQueue,$=_.alternate;if($!==null&&($=$.updateQueue,P===$)){var oe=null,re=null;if(P=P.firstBaseUpdate,P!==null){do{var Ae={lane:P.lane,tag:P.tag,payload:P.payload,callback:null,next:null};re===null?oe=re=Ae:re=re.next=Ae,P=P.next}while(P!==null);re===null?oe=re=N:re=re.next=N}else oe=re=N;P={baseState:$.baseState,firstBaseUpdate:oe,lastBaseUpdate:re,shared:$.shared,callbacks:$.callbacks},_.updateQueue=P;return}_=P.lastBaseUpdate,_===null?P.firstBaseUpdate=N:_.next=N,P.lastBaseUpdate=N}function Ye(){if(Bc){var _=Rn;if(_!==null)throw _}}function _e(_,N,P,$){Bc=!1;var oe=_.updateQueue;zn=!1;var re=oe.firstBaseUpdate,Ae=oe.lastBaseUpdate,Me=oe.shared.pending;if(Me!==null){oe.shared.pending=null;var Pe=Me,ut=Pe.next;Pe.next=null,Ae===null?re=ut:Ae.next=ut,Ae=Pe;var Zt=_.alternate;Zt!==null&&(Zt=Zt.updateQueue,Me=Zt.lastBaseUpdate,Me!==Ae&&(Me===null?Zt.firstBaseUpdate=ut:Me.next=ut,Zt.lastBaseUpdate=Pe))}if(re!==null){var Et=oe.baseState;Ae=0,Zt=ut=Pe=null,Me=re;do{var Xt=Me.lane&-536870913,ii=Xt!==Me.lane;if(ii?(di&Xt)===Xt:($&Xt)===Xt){Xt!==0&&Xt===Pi&&(Bc=!0),Zt!==null&&(Zt=Zt.next={lane:0,tag:Me.tag,payload:Me.payload,callback:null,next:null});e:{var Ys=_,Ha=Me;Xt=N;var sa=P;switch(Ha.tag){case 1:if(Ys=Ha.payload,typeof Ys=="function"){Et=Ys.call(sa,Et,Xt);break e}Et=Ys;break e;case 3:Ys.flags=Ys.flags&-65537|128;case 0:if(Ys=Ha.payload,Xt=typeof Ys=="function"?Ys.call(sa,Et,Xt):Ys,Xt==null)break e;Et=tn({},Et,Xt);break e;case 2:zn=!0}}Xt=Me.callback,Xt!==null&&(_.flags|=64,ii&&(_.flags|=8192),ii=oe.callbacks,ii===null?oe.callbacks=[Xt]:ii.push(Xt))}else ii={lane:Xt,tag:Me.tag,payload:Me.payload,callback:Me.callback,next:null},Zt===null?(ut=Zt=ii,Pe=Et):Zt=Zt.next=ii,Ae|=Xt;if(Me=Me.next,Me===null){if(Me=oe.shared.pending,Me===null)break;ii=Me,Me=ii.next,ii.next=null,oe.lastBaseUpdate=ii,oe.shared.pending=null}}while(!0);Zt===null&&(Pe=Et),oe.baseState=Pe,oe.firstBaseUpdate=ut,oe.lastBaseUpdate=Zt,re===null&&(oe.shared.lanes=0),Ws|=Ae,_.lanes=Ae,_.memoizedState=Et}}function Ne(_,N){if(typeof _!="function")throw Error(d(191,_));_.call(N)}function St(_,N){var P=_.callbacks;if(P!==null)for(_.callbacks=null,_=0;_<P.length;_++)Ne(P[_],N)}function et(_,N){if(jn(_,N))return!0;if(typeof _!="object"||_===null||typeof N!="object"||N===null)return!1;var P=Object.keys(_),$=Object.keys(N);if(P.length!==$.length)return!1;for($=0;$<P.length;$++){var oe=P[$];if(!qu.call(N,oe)||!jn(_[oe],N[oe]))return!1}return!0}function lt(_){return _=_.status,_==="fulfilled"||_==="rejected"}function yt(){}function _t(_,N,P){switch(P=_[P],P===void 0?_.push(N):P!==N&&(N.then(yt,yt),N=P),N.status){case"fulfilled":return N.value;case"rejected":throw _=N.reason,_===Rl?Error(d(483)):_;default:if(typeof N.status=="string")N.then(yt,yt);else{if(_=Vi,_!==null&&100<_.shellSuspendCounter)throw Error(d(482));_=N,_.status="pending",_.then(function($){if(N.status==="pending"){var oe=N;oe.status="fulfilled",oe.value=$}},function($){if(N.status==="pending"){var oe=N;oe.status="rejected",oe.reason=$}})}switch(N.status){case"fulfilled":return N.value;case"rejected":throw _=N.reason,_===Rl?Error(d(483)):_}throw Ln=N,Rl}}function Jt(){if(Ln===null)throw Error(d(459));var _=Ln;return Ln=null,_}function oi(_){var N=Fn;return Fn+=1,Qr===null&&(Qr=[]),_t(Qr,_,N)}function Si(_,N){N=N.props.ref,_.ref=N!==void 0?N:null}function ni(_,N){throw N.$$typeof===ig?Error(d(525)):(_=Object.prototype.toString.call(N),Error(d(31,_==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":_)))}function gi(_){var N=_._init;return N(_._payload)}function Ri(_){function N(qe,Fe){if(_){var it=qe.deletions;it===null?(qe.deletions=[Fe],qe.flags|=16):it.push(Fe)}}function P(qe,Fe){if(!_)return null;for(;Fe!==null;)N(qe,Fe),Fe=Fe.sibling;return null}function $(qe){for(var Fe=new Map;qe!==null;)qe.key!==null?Fe.set(qe.key,qe):Fe.set(qe.index,qe),qe=qe.sibling;return Fe}function oe(qe,Fe){return qe=Zo(qe,Fe),qe.index=0,qe.sibling=null,qe}function re(qe,Fe,it){return qe.index=it,_?(it=qe.alternate,it!==null?(it=it.index,it<Fe?(qe.flags|=33554434,Fe):it):(qe.flags|=33554434,Fe)):(qe.flags|=1048576,Fe)}function Ae(qe){return _&&qe.alternate===null&&(qe.flags|=33554434),qe}function Me(qe,Fe,it,Bt){return Fe===null||Fe.tag!==6?(Fe=ml(it,qe.mode,Bt),Fe.return=qe,Fe):(Fe=oe(Fe,it),Fe.return=qe,Fe)}function Pe(qe,Fe,it,Bt){var zt=it.type;return zt===ur?Zt(qe,Fe,it.props.children,Bt,it.key):Fe!==null&&(Fe.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===No&&gi(zt)===Fe.type)?(Fe=oe(Fe,it.props),Si(Fe,it),Fe.return=qe,Fe):(Fe=Fr(it.type,it.key,it.props,null,qe.mode,Bt),Si(Fe,it),Fe.return=qe,Fe)}function ut(qe,Fe,it,Bt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==it.containerInfo||Fe.stateNode.implementation!==it.implementation?(Fe=gs(it,qe.mode,Bt),Fe.return=qe,Fe):(Fe=oe(Fe,it.children||[]),Fe.return=qe,Fe)}function Zt(qe,Fe,it,Bt,zt){return Fe===null||Fe.tag!==7?(Fe=cr(it,qe.mode,Bt,zt),Fe.return=qe,Fe):(Fe=oe(Fe,it),Fe.return=qe,Fe)}function Et(qe,Fe,it){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return Fe=ml(""+Fe,qe.mode,it),Fe.return=qe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case gr:return it=Fr(Fe.type,Fe.key,Fe.props,null,qe.mode,it),Si(it,Fe),it.return=qe,it;case so:return Fe=gs(Fe,qe.mode,it),Fe.return=qe,Fe;case No:var Bt=Fe._init;return Fe=Bt(Fe._payload),Et(qe,Fe,it)}if(fr(Fe)||C(Fe))return Fe=cr(Fe,qe.mode,it,null),Fe.return=qe,Fe;if(typeof Fe.then=="function")return Et(qe,oi(Fe),it);if(Fe.$$typeof===dr)return Et(qe,nl(qe,Fe),it);ni(qe,Fe)}return null}function Xt(qe,Fe,it,Bt){var zt=Fe!==null?Fe.key:null;if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return zt!==null?null:Me(qe,Fe,""+it,Bt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case gr:return it.key===zt?Pe(qe,Fe,it,Bt):null;case so:return it.key===zt?ut(qe,Fe,it,Bt):null;case No:return zt=it._init,it=zt(it._payload),Xt(qe,Fe,it,Bt)}if(fr(it)||C(it))return zt!==null?null:Zt(qe,Fe,it,Bt,null);if(typeof it.then=="function")return Xt(qe,Fe,oi(it),Bt);if(it.$$typeof===dr)return Xt(qe,Fe,nl(qe,it),Bt);ni(qe,it)}return null}function ii(qe,Fe,it,Bt,zt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number"||typeof Bt=="bigint")return qe=qe.get(it)||null,Me(Fe,qe,""+Bt,zt);if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case gr:return qe=qe.get(Bt.key===null?it:Bt.key)||null,Pe(Fe,qe,Bt,zt);case so:return qe=qe.get(Bt.key===null?it:Bt.key)||null,ut(Fe,qe,Bt,zt);case No:var Wi=Bt._init;return Bt=Wi(Bt._payload),ii(qe,Fe,it,Bt,zt)}if(fr(Bt)||C(Bt))return qe=qe.get(it)||null,Zt(Fe,qe,Bt,zt,null);if(typeof Bt.then=="function")return ii(qe,Fe,it,oi(Bt),zt);if(Bt.$$typeof===dr)return ii(qe,Fe,it,nl(Fe,Bt),zt);ni(Fe,Bt)}return null}function Ys(qe,Fe,it,Bt){for(var zt=null,Wi=null,kt=Fe,ci=Fe=0,Yi=null;kt!==null&&ci<it.length;ci++){kt.index>ci?(Yi=kt,kt=null):Yi=kt.sibling;var pi=Xt(qe,kt,it[ci],Bt);if(pi===null){kt===null&&(kt=Yi);break}_&&kt&&pi.alternate===null&&N(qe,kt),Fe=re(pi,Fe,ci),Wi===null?zt=pi:Wi.sibling=pi,Wi=pi,kt=Yi}if(ci===it.length)return P(qe,kt),yi&&he(qe,ci),zt;if(kt===null){for(;ci<it.length;ci++)kt=Et(qe,it[ci],Bt),kt!==null&&(Fe=re(kt,Fe,ci),Wi===null?zt=kt:Wi.sibling=kt,Wi=kt);return yi&&he(qe,ci),zt}for(kt=$(kt);ci<it.length;ci++)Yi=ii(kt,qe,ci,it[ci],Bt),Yi!==null&&(_&&Yi.alternate!==null&&kt.delete(Yi.key===null?ci:Yi.key),Fe=re(Yi,Fe,ci),Wi===null?zt=Yi:Wi.sibling=Yi,Wi=Yi);return _&&kt.forEach(function(_r){return N(qe,_r)}),yi&&he(qe,ci),zt}function Ha(qe,Fe,it,Bt){if(it==null)throw Error(d(151));for(var zt=null,Wi=null,kt=Fe,ci=Fe=0,Yi=null,pi=it.next();kt!==null&&!pi.done;ci++,pi=it.next()){kt.index>ci?(Yi=kt,kt=null):Yi=kt.sibling;var _r=Xt(qe,kt,pi.value,Bt);if(_r===null){kt===null&&(kt=Yi);break}_&&kt&&_r.alternate===null&&N(qe,kt),Fe=re(_r,Fe,ci),Wi===null?zt=_r:Wi.sibling=_r,Wi=_r,kt=Yi}if(pi.done)return P(qe,kt),yi&&he(qe,ci),zt;if(kt===null){for(;!pi.done;ci++,pi=it.next())pi=Et(qe,pi.value,Bt),pi!==null&&(Fe=re(pi,Fe,ci),Wi===null?zt=pi:Wi.sibling=pi,Wi=pi);return yi&&he(qe,ci),zt}for(kt=$(kt);!pi.done;ci++,pi=it.next())pi=ii(kt,qe,ci,pi.value,Bt),pi!==null&&(_&&pi.alternate!==null&&kt.delete(pi.key===null?ci:pi.key),Fe=re(pi,Fe,ci),Wi===null?zt=pi:Wi.sibling=pi,Wi=pi);return _&&kt.forEach(function(th){return N(qe,th)}),yi&&he(qe,ci),zt}function sa(qe,Fe,it,Bt){if(typeof it=="object"&&it!==null&&it.type===ur&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case gr:e:{for(var zt=it.key;Fe!==null;){if(Fe.key===zt){if(zt=it.type,zt===ur){if(Fe.tag===7){P(qe,Fe.sibling),Bt=oe(Fe,it.props.children),Bt.return=qe,qe=Bt;break e}}else if(Fe.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===No&&gi(zt)===Fe.type){P(qe,Fe.sibling),Bt=oe(Fe,it.props),Si(Bt,it),Bt.return=qe,qe=Bt;break e}P(qe,Fe);break}else N(qe,Fe);Fe=Fe.sibling}it.type===ur?(Bt=cr(it.props.children,qe.mode,Bt,it.key),Bt.return=qe,qe=Bt):(Bt=Fr(it.type,it.key,it.props,null,qe.mode,Bt),Si(Bt,it),Bt.return=qe,qe=Bt)}return Ae(qe);case so:e:{for(zt=it.key;Fe!==null;){if(Fe.key===zt)if(Fe.tag===4&&Fe.stateNode.containerInfo===it.containerInfo&&Fe.stateNode.implementation===it.implementation){P(qe,Fe.sibling),Bt=oe(Fe,it.children||[]),Bt.return=qe,qe=Bt;break e}else{P(qe,Fe);break}else N(qe,Fe);Fe=Fe.sibling}Bt=gs(it,qe.mode,Bt),Bt.return=qe,qe=Bt}return Ae(qe);case No:return zt=it._init,it=zt(it._payload),sa(qe,Fe,it,Bt)}if(fr(it))return Ys(qe,Fe,it,Bt);if(C(it)){if(zt=C(it),typeof zt!="function")throw Error(d(150));return it=zt.call(it),Ha(qe,Fe,it,Bt)}if(typeof it.then=="function")return sa(qe,Fe,oi(it),Bt);if(it.$$typeof===dr)return sa(qe,Fe,nl(qe,it),Bt);ni(qe,it)}return typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint"?(it=""+it,Fe!==null&&Fe.tag===6?(P(qe,Fe.sibling),Bt=oe(Fe,it),Bt.return=qe,qe=Bt):(P(qe,Fe),Bt=ml(it,qe.mode,Bt),Bt.return=qe,qe=Bt),Ae(qe)):P(qe,Fe)}return function(qe,Fe,it,Bt){try{Fn=0;var zt=sa(qe,Fe,it,Bt);return Qr=null,zt}catch(kt){if(kt===Rl)throw kt;var Wi=o(29,kt,null,qe.mode);return Wi.lanes=Bt,Wi.return=qe,Wi}finally{}}}function vn(_,N){_=Qs,z($s,_),z(Us,N),Qs=_|N.baseLanes}function Ts(){z($s,Qs),z(Us,Us.current)}function mn(){Qs=$s.current,J(Us),J($s)}function Bn(_){var N=_.alternate;z(Li,Li.current&1),z(Cs,_),ws===null&&(N===null||Us.current!==null||N.memoizedState!==null)&&(ws=_)}function Vn(_){if(_.tag===22){if(z(Li,Li.current),z(Cs,_),ws===null){var N=_.alternate;N!==null&&N.memoizedState!==null&&(ws=_)}}else ss()}function ss(){z(Li,Li.current),z(Cs,Cs.current)}function Ti(_){J(Cs),ws===_&&(ws=null),J(Li)}function Ji(_){for(var N=_;N!==null;){if(N.tag===13){var P=N.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||kr(P)||vl(P)))return N}else if(N.tag===19&&N.memoizedProps.revealOrder!==void 0){if((N.flags&128)!==0)return N}else if(N.child!==null){N.child.return=N,N=N.child;continue}if(N===_)break;for(;N.sibling===null;){if(N.return===null||N.return===_)return null;N=N.return}N.sibling.return=N.return,N=N.sibling}return null}function Qt(){throw Error(d(321))}function Js(_,N){if(N===null)return!1;for(var P=0;P<N.length&&P<_.length;P++)if(!jn(_[P],N[P]))return!1;return!0}function Uo(_,N,P,$,oe,re){return Ho=re,ei=N,N.memoizedState=null,N.updateQueue=null,N.lanes=0,$t.H=_===null||_.memoizedState===null?Fo:qn,Br=!1,re=P($,oe),Br=!1,qr&&(re=Wl(N,P,$,oe)),Vl(_),re}function Vl(_){$t.H=ln;var N=vi!==null&&vi.next!==null;if(Ho=0,Ui=vi=ei=null,zo=!1,Wa=0,Lo=null,N)throw Error(d(300));_===null||In||(_=_.dependencies,_!==null&&il(_)&&(In=!0))}function Wl(_,N,P,$){ei=_;var oe=0;do{if(qr&&(Lo=null),Wa=0,qr=!1,25<=oe)throw Error(d(301));if(oe+=1,Ui=vi=null,_.updateQueue!=null){var re=_.updateQueue;re.lastEffect=null,re.events=null,re.stores=null,re.memoCache!=null&&(re.memoCache.index=0)}$t.H=Xr,re=N(P,$)}while(qr);return re}function El(){var _=$t.H,N=_.useState()[0];return N=typeof N.then=="function"?je(N):N,_=_.useState()[0],(vi!==null?vi.memoizedState:null)!==_&&(ei.flags|=1024),N}function fo(){var _=Sr!==0;return Sr=0,_}function Mr(_,N,P){N.updateQueue=_.updateQueue,N.flags&=-2053,_.lanes&=~P}function Hs(_){if(zo){for(_=_.memoizedState;_!==null;){var N=_.queue;N!==null&&(N.pending=null),_=_.next}zo=!1}Ho=0,Ui=vi=ei=null,qr=!1,Wa=Sr=0,Lo=null}function fe(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?ei.memoizedState=Ui=_:Ui=Ui.next=_,Ui}function We(){if(vi===null){var _=ei.alternate;_=_!==null?_.memoizedState:null}else _=vi.next;var N=Ui===null?ei.memoizedState:Ui.next;if(N!==null)Ui=N,vi=_;else{if(_===null)throw ei.alternate===null?Error(d(467)):Error(d(310));vi=_,_={memoizedState:vi.memoizedState,baseState:vi.baseState,baseQueue:vi.baseQueue,queue:vi.queue,next:null},Ui===null?ei.memoizedState=Ui=_:Ui=Ui.next=_}return Ui}function je(_){var N=Wa;return Wa+=1,Lo===null&&(Lo=[]),_=_t(Lo,_,N),N=ei,(Ui===null?N.memoizedState:Ui.next)===null&&(N=N.alternate,$t.H=N===null||N.memoizedState===null?Fo:qn),_}function ke(_){if(_!==null&&typeof _=="object"){if(typeof _.then=="function")return je(_);if(_.$$typeof===dr)return _n(_)}throw Error(d(438,String(_)))}function Le(_){var N=null,P=ei.updateQueue;if(P!==null&&(N=P.memoCache),N==null){var $=ei.alternate;$!==null&&($=$.updateQueue,$!==null&&($=$.memoCache,$!=null&&(N={data:$.data.map(function(oe){return oe.slice()}),index:0})))}if(N==null&&(N={data:[],index:0}),P===null&&(P=Rg(),ei.updateQueue=P),P.memoCache=N,P=N.data[N.index],P===void 0)for(P=N.data[N.index]=Array(_),$=0;$<_;$++)P[$]=ri;return N.index++,P}function At(_,N){return typeof N=="function"?N(_):N}function Nt(_){var N=We();return Wt(N,vi,_)}function Wt(_,N,P){var $=_.queue;if($===null)throw Error(d(311));$.lastRenderedReducer=P;var oe=_.baseQueue,re=$.pending;if(re!==null){if(oe!==null){var Ae=oe.next;oe.next=re.next,re.next=Ae}N.baseQueue=oe=re,$.pending=null}if(re=_.baseState,oe===null)_.memoizedState=re;else{N=oe.next;var Me=Ae=null,Pe=null,ut=N,Zt=!1;do{var Et=ut.lane&-536870913;if(Et!==ut.lane?(di&Et)===Et:(Ho&Et)===Et){var Xt=ut.revertLane;if(Xt===0)Pe!==null&&(Pe=Pe.next={lane:0,revertLane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),Et===Pi&&(Zt=!0);else if((Ho&Xt)===Xt){ut=ut.next,Xt===Pi&&(Zt=!0);continue}else Et={lane:0,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},Pe===null?(Me=Pe=Et,Ae=re):Pe=Pe.next=Et,ei.lanes|=Xt,Ws|=Xt;Et=ut.action,Br&&P(re,Et),re=ut.hasEagerState?ut.eagerState:P(re,Et)}else Xt={lane:Et,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},Pe===null?(Me=Pe=Xt,Ae=re):Pe=Pe.next=Xt,ei.lanes|=Et,Ws|=Et;ut=ut.next}while(ut!==null&&ut!==N);if(Pe===null?Ae=re:Pe.next=Me,!jn(re,_.memoizedState)&&(In=!0,Zt&&(P=Rn,P!==null)))throw P;_.memoizedState=re,_.baseState=Ae,_.baseQueue=Pe,$.lastRenderedState=re}return oe===null&&($.lanes=0),[_.memoizedState,$.dispatch]}function Vt(_){var N=We(),P=N.queue;if(P===null)throw Error(d(311));P.lastRenderedReducer=_;var $=P.dispatch,oe=P.pending,re=N.memoizedState;if(oe!==null){P.pending=null;var Ae=oe=oe.next;do re=_(re,Ae.action),Ae=Ae.next;while(Ae!==oe);jn(re,N.memoizedState)||(In=!0),N.memoizedState=re,N.baseQueue===null&&(N.baseState=re),P.lastRenderedState=re}return[re,$]}function Ot(_,N,P){var $=ei,oe=We(),re=yi;if(re){if(P===void 0)throw Error(d(407));P=P()}else P=N();var Ae=!jn((vi||oe).memoizedState,P);if(Ae&&(oe.memoizedState=P,In=!0),oe=oe.queue,ka(Ci.bind(null,$,oe,_),[_]),oe.getSnapshot!==N||Ae||Ui!==null&&Ui.memoizedState.tag&1){if($.flags|=2048,zs(9,Ft.bind(null,$,oe,P,N),{destroy:void 0},null),Vi===null)throw Error(d(349));re||(Ho&60)!==0||Ut($,N,P)}return P}function Ut(_,N,P){_.flags|=16384,_={getSnapshot:N,value:P},N=ei.updateQueue,N===null?(N=Rg(),ei.updateQueue=N,N.stores=[_]):(P=N.stores,P===null?N.stores=[_]:P.push(_))}function Ft(_,N,P,$){N.value=P,N.getSnapshot=$,Ii(N)&&Hi(_)}function Ci(_,N,P){return P(function(){Ii(N)&&Hi(_)})}function Ii(_){var N=_.getSnapshot;_=_.value;try{var P=N();return!jn(_,P)}catch{return!0}}function Hi(_){var N=vt(_,2);N!==null&&zi(N,_,2)}function mi(_){var N=fe();if(typeof _=="function"){var P=_;if(_=P(),Br){Re(!0);try{P()}finally{Re(!1)}}}return N.memoizedState=N.baseState=_,N.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:At,lastRenderedState:_},N}function qt(_,N,P,$){return _.baseState=P,Wt(_,vi,typeof $=="function"?$:At)}function Kt(_,N,P,$,oe){if(ja(_))throw Error(d(485));if(_=N.action,_!==null){var re={payload:oe,action:_,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ae){re.listeners.push(Ae)}};$t.T!==null?P(!0):re.isTransition=!1,$(re),P=N.pending,P===null?(re.next=N.pending=re,gn(N,re)):(re.next=P.next,N.pending=P.next=re)}}function gn(_,N){var P=N.action,$=N.payload,oe=_.state;if(N.isTransition){var re=$t.T,Ae={};$t.T=Ae;try{var Me=P(oe,$),Pe=$t.S;Pe!==null&&Pe(Ae,Me),fi(_,N,Me)}catch(ut){Is(_,N,ut)}finally{$t.T=re}}else try{re=P(oe,$),fi(_,N,re)}catch(ut){Is(_,N,ut)}}function fi(_,N,P){P!==null&&typeof P=="object"&&typeof P.then=="function"?P.then(function($){Dn(_,N,$)},function($){return Is(_,N,$)}):Dn(_,N,P)}function Dn(_,N,P){N.status="fulfilled",N.value=P,Wn(N),_.state=P,N=_.pending,N!==null&&(P=N.next,P===N?_.pending=null:(P=P.next,N.next=P,gn(_,P)))}function Is(_,N,P){var $=_.pending;if(_.pending=null,$!==null){$=$.next;do N.status="rejected",N.reason=P,Wn(N),N=N.next;while(N!==$)}_.action=null}function Wn(_){_=_.listeners;for(var N=0;N<_.length;N++)(0,_[N])()}function bn(_,N){return N}function Zi(_,N){if(yi){var P=Vi.formState;if(P!==null){e:{var $=ei;if(yi){if(Mi){var oe=zu(Mi,ks);if(oe){Mi=Ar(oe),$=ro(oe);break e}}Ee($)}$=!1}$&&(N=P[0])}}P=fe(),P.memoizedState=P.baseState=N,$={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bn,lastRenderedState:N},P.queue=$,P=Vc.bind(null,ei,$),$.dispatch=P,$=mi(!1);var re=la.bind(null,ei,!1,$.queue);return $=fe(),oe={state:N,dispatch:null,action:_,pending:null},$.queue=oe,P=Kt.bind(null,ei,oe,re,P),oe.dispatch=P,$.memoizedState=_,[N,P,!1]}function En(_){var N=We();return Zn(N,vi,_)}function Zn(_,N,P){N=Wt(_,N,bn)[0],_=Nt(At)[0],N=typeof N=="object"&&N!==null&&typeof N.then=="function"?je(N):N;var $=We(),oe=$.queue,re=oe.dispatch;return P!==$.memoizedState&&(ei.flags|=2048,zs(9,Qi.bind(null,oe,P),{destroy:void 0},null)),[N,re,_]}function Qi(_,N){_.action=N}function Sn(_){var N=We(),P=vi;if(P!==null)return Zn(N,P,_);We(),N=N.memoizedState,P=We();var $=P.queue.dispatch;return P.memoizedState=_,[N,$,!1]}function zs(_,N,P,$){return _={tag:_,create:N,inst:P,deps:$,next:null},N=ei.updateQueue,N===null&&(N=Rg(),ei.updateQueue=N),P=N.lastEffect,P===null?N.lastEffect=_.next=_:($=P.next,P.next=_,_.next=$,N.lastEffect=_),_}function kn(){return We().memoizedState}function Yl(_,N,P,$){var oe=fe();ei.flags|=_,oe.memoizedState=zs(1|N,P,{destroy:void 0},$===void 0?null:$)}function Da(_,N,P,$){var oe=We();$=$===void 0?null:$;var re=oe.memoizedState.inst;vi!==null&&$!==null&&Js($,vi.memoizedState.deps)?oe.memoizedState=zs(N,P,re,$):(ei.flags|=_,oe.memoizedState=zs(1|N,P,re,$))}function _c(_,N){Yl(8390656,8,_,N)}function ka(_,N){Da(2048,8,_,N)}function Fg(_,N){return Da(4,2,_,N)}function Kg(_,N){return Da(4,4,_,N)}function Oa(_,N){if(typeof N=="function"){_=_();var P=N(_);return function(){typeof P=="function"?P():N(null)}}if(N!=null)return _=_(),N.current=_,function(){N.current=null}}function Tl(_,N,P){P=P!=null?P.concat([_]):null,Da(4,4,Oa.bind(null,N,_),P)}function Ua(){}function Nr(_,N){var P=We();N=N===void 0?null:N;var $=P.memoizedState;return N!==null&&Js(N,$[1])?$[0]:(P.memoizedState=[_,N],_)}function Vr(_,N){var P=We();N=N===void 0?null:N;var $=P.memoizedState;if(N!==null&&Js(N,$[1]))return $[0];if($=_(),Br){Re(!0);try{_()}finally{Re(!1)}}return P.memoizedState=[$,N],$}function Jl(_,N,P){return P===void 0||(Ho&1073741824)!==0?_.memoizedState=N:(_.memoizedState=P,_=hl(),ei.lanes|=_,Ws|=_,P)}function Hl(_,N,P,$){return jn(P,N)?P:Us.current!==null?(_=Jl(_,P,$),jn(_,N)||(In=!0),_):(Ho&42)===0?(In=!0,_.memoizedState=P):(_=hl(),ei.lanes|=_,Ws|=_,N)}function Mc(_,N,P,$,oe){var re=pr();$n(re!==0&&8>re?re:8);var Ae=$t.T,Me={};$t.T=Me,la(_,!1,N,P);try{var Pe=oe(),ut=$t.S;if(ut!==null&&ut(Me,Pe),Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var Zt=Yt(Pe,$);$o(_,N,Zt,Yn(_))}else $o(_,N,$,Yn(_))}catch(Et){$o(_,N,{then:function(){},status:"rejected",reason:Et},Yn())}finally{$n(re),$t.T=Ae}}function ra(_){var N=_.memoizedState;if(N!==null)return N;N={memoizedState:Dr,baseState:Dr,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:At,lastRenderedState:Dr},next:null};var P={};return N.next={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:At,lastRenderedState:P},next:null},_.memoizedState=N,_=_.alternate,_!==null&&(_.memoizedState=N),N}function $a(){return _n(Wo)}function aa(){return We().memoizedState}function po(){return We().memoizedState}function Nc(_){for(var N=_.return;N!==null;){switch(N.tag){case 24:case 3:var P=Yn();_=pt(P);var $=mt(N,_,P);$!==null&&(zi($,N,P),It($,N,P)),N={cache:er()},_.payload=N;return}N=N.return}}function zl(_,N,P){var $=Yn();P={lane:$,revertLane:0,action:P,hasEagerState:!1,eagerState:null,next:null},ja(_)?On(N,P):(P=ot(_,N,P,$),P!==null&&(zi(P,_,$),jo(P,N,$)))}function Vc(_,N,P){var $=Yn();$o(_,N,P,$)}function $o(_,N,P,$){var oe={lane:$,revertLane:0,action:P,hasEagerState:!1,eagerState:null,next:null};if(ja(_))On(N,oe);else{var re=_.alternate;if(_.lanes===0&&(re===null||re.lanes===0)&&(re=N.lastRenderedReducer,re!==null))try{var Ae=N.lastRenderedState,Me=re(Ae,P);if(oe.hasEagerState=!0,oe.eagerState=Me,jn(Me,Ae))return Gt(_,N,oe,0),Vi===null&&Ge(),!1}catch{}finally{}if(P=ot(_,N,oe,$),P!==null)return zi(P,_,$),jo(P,N,$),!0}return!1}function la(_,N,P,$){if($={lane:2,revertLane:rt(),action:$,hasEagerState:!1,eagerState:null,next:null},ja(_)){if(N)throw Error(d(479))}else N=ot(_,P,$,2),N!==null&&zi(N,_,2)}function ja(_){var N=_.alternate;return _===ei||N!==null&&N===ei}function On(_,N){qr=zo=!0;var P=_.pending;P===null?N.next=N:(N.next=P.next,P.next=N),_.pending=N}function jo(_,N,P){if((P&4194176)!==0){var $=N.lanes;$&=_.pendingLanes,P|=$,N.lanes=P,be(_,P)}}function ca(_,N,P,$){N=_.memoizedState,P=P($,N),P=P==null?N:tn({},N,P),_.memoizedState=P,_.lanes===0&&(_.updateQueue.baseState=P)}function ga(_,N,P,$,oe,re,Ae){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate($,re,Ae):N.prototype&&N.prototype.isPureReactComponent?!et(P,$)||!et(oe,re):!0}function Pg(_,N,P,$){_=N.state,typeof N.componentWillReceiveProps=="function"&&N.componentWillReceiveProps(P,$),typeof N.UNSAFE_componentWillReceiveProps=="function"&&N.UNSAFE_componentWillReceiveProps(P,$),N.state!==_&&Ea.enqueueReplaceState(N,N.state,null)}function Ao(_,N){var P=N;if("ref"in N){P={};for(var $ in N)$!=="ref"&&(P[$]=N[$])}if(_=_.defaultProps){P===N&&(P=tn({},P));for(var oe in _)P[oe]===void 0&&(P[oe]=_[oe])}return P}function ua(_,N){try{var P=_.onUncaughtError;P(N.value,{componentStack:N.stack})}catch($){setTimeout(function(){throw $})}}function ha(_,N,P){try{var $=_.onCaughtError;$(P.value,{componentStack:P.stack,errorBoundary:N.tag===1?N.stateNode:null})}catch(oe){setTimeout(function(){throw oe})}}function da(_,N,P){return P=pt(P),P.tag=3,P.payload={element:null},P.callback=function(){ua(_,N)},P}function Wc(_){return _=pt(_),_.tag=3,_}function Dg(_,N,P,$){var oe=P.type.getDerivedStateFromError;if(typeof oe=="function"){var re=$.value;_.payload=function(){return oe(re)},_.callback=function(){ha(N,P,$)}}var Ae=P.stateNode;Ae!==null&&typeof Ae.componentDidCatch=="function"&&(_.callback=function(){ha(N,P,$),typeof oe!="function"&&(Co===null?Co=new Set([this]):Co.add(this));var Me=$.stack;this.componentDidCatch($.value,{componentStack:Me!==null?Me:""})})}function Ah(_,N,P,$,oe){if(P.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){if(N=P.alternate,N!==null&&tl(N,P,oe,!0),P=Cs.current,P!==null){switch(P.tag){case 13:return ws===null?xs():P.alternate===null&&$i===0&&($i=3),P.flags&=-257,P.flags|=65536,P.lanes=oe,$===Qn?P.flags|=16384:(N=P.updateQueue,N===null?P.updateQueue=new Set([$]):N.add($),lr(_,$,oe)),!1;case 22:return P.flags|=65536,$===Qn?P.flags|=16384:(N=P.updateQueue,N===null?(N={transitions:null,markerInstances:null,retryQueue:new Set([$])},P.updateQueue=N):(P=N.retryQueue,P===null?N.retryQueue=new Set([$]):P.add($)),lr(_,$,oe)),!1}throw Error(d(435,P.tag))}return lr(_,$,oe),xs(),!1}if(yi)return N=Cs.current,N!==null?((N.flags&65536)===0&&(N.flags|=256),N.flags|=65536,N.lanes=oe,$!==xl&&(_=Error(d(422),{cause:$}),Ue(Ze(_,P)))):($!==xl&&(N=Error(d(423),{cause:$}),Ue(Ze(N,P))),_=_.current.alternate,_.flags|=65536,oe&=-oe,_.lanes|=oe,$=Ze($,P),oe=da(_.stateNode,$,oe),ye(_,oe),$i!==4&&($i=2)),!1;var re=Error(d(520),{cause:$});if(re=Ze(re,P),Ta===null?Ta=[re]:Ta.push(re),$i!==4&&($i=2),N===null)return!0;$=Ze($,P),P=N;do{switch(P.tag){case 3:return P.flags|=65536,_=oe&-oe,P.lanes|=_,_=da(P.stateNode,$,_),ye(P,_),!1;case 1:if(N=P.type,re=P.stateNode,(P.flags&128)===0&&(typeof N.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Co===null||!Co.has(re))))return P.flags|=65536,oe&=-oe,P.lanes|=oe,oe=Wc(oe),Dg(oe,_,P,$),ye(P,oe),!1}P=P.return}while(P!==null);return!1}function wn(_,N,P,$){N.child=_===null?go(N,null,P,$):vr(N,_.child,P,$)}function Ll(_,N,P,$,oe){P=P.render;var re=N.ref;if("ref"in $){var Ae={};for(var Me in $)Me!=="ref"&&(Ae[Me]=$[Me])}else Ae=$;return qo(N),$=Uo(_,N,P,Ae,re,oe),Me=fo(),_!==null&&!In?(Mr(_,N,oe),mo(_,N,oe)):(yi&&Me&&Be(N),N.flags|=1,wn(_,N,$,oe),N.child)}function kg(_,N,P,$,oe){if(_===null){var re=P.type;return typeof re=="function"&&!Ro(re)&&re.defaultProps===void 0&&P.compare===null?(N.tag=15,N.type=re,Og(_,N,re,$,oe)):(_=Fr(P.type,null,$,N,N.mode,oe),_.ref=N.ref,_.return=N,N.child=_)}if(re=_.child,!Hc(_,oe)){var Ae=re.memoizedProps;if(P=P.compare,P=P!==null?P:et,P(Ae,$)&&_.ref===N.ref)return mo(_,N,oe)}return N.flags|=1,_=Zo(re,$),_.ref=N.ref,_.return=N,N.child=_}function Og(_,N,P,$,oe){if(_!==null){var re=_.memoizedProps;if(et(re,$)&&_.ref===N.ref)if(In=!1,N.pendingProps=$=re,Hc(_,oe))(_.flags&131072)!==0&&(In=!0);else return N.lanes=_.lanes,mo(_,N,oe)}return Fl(_,N,P,$,oe)}function Ug(_,N,P){var $=N.pendingProps,oe=$.children,re=(N.stateNode._pendingVisibility&2)!==0,Ae=_!==null?_.memoizedState:null;if(Qa(_,N),$.mode==="hidden"||re){if((N.flags&128)!==0){if($=Ae!==null?Ae.baseLanes|P:P,_!==null){for(oe=N.child=_.child,re=0;oe!==null;)re=re|oe.lanes|oe.childLanes,oe=oe.sibling;N.childLanes=re&~$}else N.childLanes=0,N.child=null;return $g(_,N,$,P)}if((P&536870912)!==0)N.memoizedState={baseLanes:0,cachePool:null},_!==null&&Pl(N,Ae!==null?Ae.cachePool:null),Ae!==null?vn(N,Ae):Ts(),Vn(N);else return N.lanes=N.childLanes=536870912,$g(_,N,Ae!==null?Ae.baseLanes|P:P,P)}else Ae!==null?(Pl(N,Ae.cachePool),vn(N,Ae),ss(),N.memoizedState=null):(_!==null&&Pl(N,null),Ts(),ss());return wn(_,N,oe,P),N.child}function $g(_,N,P,$){var oe=Lc();return oe=oe===null?null:{parent:Fs?en._currentValue:en._currentValue2,pool:oe},N.memoizedState={baseLanes:P,cachePool:oe},_!==null&&Pl(N,null),Ts(),Vn(N),_!==null&&tl(_,N,$,!0),null}function Qa(_,N){var P=N.ref;if(P===null)_!==null&&_.ref!==null&&(N.flags|=2097664);else{if(typeof P!="function"&&typeof P!="object")throw Error(d(284));(_===null||_.ref!==P)&&(N.flags|=2097664)}}function Fl(_,N,P,$,oe){return qo(N),P=Uo(_,N,P,$,void 0,oe),$=fo(),_!==null&&!In?(Mr(_,N,oe),mo(_,N,oe)):(yi&&$&&Be(N),N.flags|=1,wn(_,N,P,oe),N.child)}function jg(_,N,P,$,oe,re){return qo(N),N.updateQueue=null,P=Wl(N,$,P,oe),Vl(_),$=fo(),_!==null&&!In?(Mr(_,N,re),mo(_,N,re)):(yi&&$&&Be(N),N.flags|=1,wn(_,N,P,re),N.child)}function Qg(_,N,P,$,oe){if(qo(N),N.stateNode===null){var re=$r,Ae=P.contextType;typeof Ae=="object"&&Ae!==null&&(re=_n(Ae)),re=new P($,re),N.memoizedState=re.state!==null&&re.state!==void 0?re.state:null,re.updater=Ea,N.stateNode=re,re._reactInternals=N,re=N.stateNode,re.props=$,re.state=N.memoizedState,re.refs={},Oe(N),Ae=P.contextType,re.context=typeof Ae=="object"&&Ae!==null?_n(Ae):$r,re.state=N.memoizedState,Ae=P.getDerivedStateFromProps,typeof Ae=="function"&&(ca(N,P,Ae,$),re.state=N.memoizedState),typeof P.getDerivedStateFromProps=="function"||typeof re.getSnapshotBeforeUpdate=="function"||typeof re.UNSAFE_componentWillMount!="function"&&typeof re.componentWillMount!="function"||(Ae=re.state,typeof re.componentWillMount=="function"&&re.componentWillMount(),typeof re.UNSAFE_componentWillMount=="function"&&re.UNSAFE_componentWillMount(),Ae!==re.state&&Ea.enqueueReplaceState(re,re.state,null),_e(N,$,re,oe),Ye(),re.state=N.memoizedState),typeof re.componentDidMount=="function"&&(N.flags|=4194308),$=!0}else if(_===null){re=N.stateNode;var Me=N.memoizedProps,Pe=Ao(P,Me);re.props=Pe;var ut=re.context,Zt=P.contextType;Ae=$r,typeof Zt=="object"&&Zt!==null&&(Ae=_n(Zt));var Et=P.getDerivedStateFromProps;Zt=typeof Et=="function"||typeof re.getSnapshotBeforeUpdate=="function",Me=N.pendingProps!==Me,Zt||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(Me||ut!==Ae)&&Pg(N,re,$,Ae),zn=!1;var Xt=N.memoizedState;re.state=Xt,_e(N,$,re,oe),Ye(),ut=N.memoizedState,Me||Xt!==ut||zn?(typeof Et=="function"&&(ca(N,P,Et,$),ut=N.memoizedState),(Pe=zn||ga(N,P,Pe,$,Xt,ut,Ae))?(Zt||typeof re.UNSAFE_componentWillMount!="function"&&typeof re.componentWillMount!="function"||(typeof re.componentWillMount=="function"&&re.componentWillMount(),typeof re.UNSAFE_componentWillMount=="function"&&re.UNSAFE_componentWillMount()),typeof re.componentDidMount=="function"&&(N.flags|=4194308)):(typeof re.componentDidMount=="function"&&(N.flags|=4194308),N.memoizedProps=$,N.memoizedState=ut),re.props=$,re.state=ut,re.context=Ae,$=Pe):(typeof re.componentDidMount=="function"&&(N.flags|=4194308),$=!1)}else{re=N.stateNode,gt(_,N),Ae=N.memoizedProps,Zt=Ao(P,Ae),re.props=Zt,Et=N.pendingProps,Xt=re.context,ut=P.contextType,Pe=$r,typeof ut=="object"&&ut!==null&&(Pe=_n(ut)),Me=P.getDerivedStateFromProps,(ut=typeof Me=="function"||typeof re.getSnapshotBeforeUpdate=="function")||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(Ae!==Et||Xt!==Pe)&&Pg(N,re,$,Pe),zn=!1,Xt=N.memoizedState,re.state=Xt,_e(N,$,re,oe),Ye();var ii=N.memoizedState;Ae!==Et||Xt!==ii||zn||_!==null&&_.dependencies!==null&&il(_.dependencies)?(typeof Me=="function"&&(ca(N,P,Me,$),ii=N.memoizedState),(Zt=zn||ga(N,P,Zt,$,Xt,ii,Pe)||_!==null&&_.dependencies!==null&&il(_.dependencies))?(ut||typeof re.UNSAFE_componentWillUpdate!="function"&&typeof re.componentWillUpdate!="function"||(typeof re.componentWillUpdate=="function"&&re.componentWillUpdate($,ii,Pe),typeof re.UNSAFE_componentWillUpdate=="function"&&re.UNSAFE_componentWillUpdate($,ii,Pe)),typeof re.componentDidUpdate=="function"&&(N.flags|=4),typeof re.getSnapshotBeforeUpdate=="function"&&(N.flags|=1024)):(typeof re.componentDidUpdate!="function"||Ae===_.memoizedProps&&Xt===_.memoizedState||(N.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||Ae===_.memoizedProps&&Xt===_.memoizedState||(N.flags|=1024),N.memoizedProps=$,N.memoizedState=ii),re.props=$,re.state=ii,re.context=Pe,$=Zt):(typeof re.componentDidUpdate!="function"||Ae===_.memoizedProps&&Xt===_.memoizedState||(N.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||Ae===_.memoizedProps&&Xt===_.memoizedState||(N.flags|=1024),$=!1)}return re=$,Qa(_,N),$=(N.flags&128)!==0,re||$?(re=N.stateNode,P=$&&typeof P.getDerivedStateFromError!="function"?null:re.render(),N.flags|=1,_!==null&&$?(N.child=vr(N,_.child,null,oe),N.child=vr(N,null,P,oe)):wn(_,N,P,oe),N.memoizedState=re.state,_=N.child):_=mo(_,N,oe),_}function qg(_,N,P,$){return Qe(),N.flags|=256,wn(_,N,P,$),N.child}function Ec(_){return{baseLanes:_,cachePool:Fc()}}function qa(_,N,P){return _=_!==null?_.childLanes&~P:0,N&&(_|=Gs),_}function eu(_,N,P){var $=N.pendingProps,oe=!1,re=(N.flags&128)!==0,Ae;if((Ae=re)||(Ae=_!==null&&_.memoizedState===null?!1:(Li.current&2)!==0),Ae&&(oe=!0,N.flags&=-129),Ae=(N.flags&32)!==0,N.flags&=-33,_===null){if(yi){if(oe?Bn(N):ss(),yi){var Me=Mi,Pe;(Pe=Me)&&(Me=Fu(Me,ks),Me!==null?(N.memoizedState={dehydrated:Me,treeContext:Ds!==null?{id:lo,overflow:co}:null,retryLane:536870912},Pe=o(18,null,null,0),Pe.stateNode=Me,Pe.return=N,N.child=Pe,rn=N,Mi=null,Pe=!0):Pe=!1),Pe||Ee(N)}if(Me=N.memoizedState,Me!==null&&(Me=Me.dehydrated,Me!==null))return vl(Me)?N.lanes=16:N.lanes=536870912,null;Ti(N)}return Me=$.children,$=$.fallback,oe?(ss(),oe=N.mode,Me=Tc({mode:"hidden",children:Me},oe),$=cr($,oe,P,null),Me.return=N,$.return=N,Me.sibling=$,N.child=Me,oe=N.child,oe.memoizedState=Ec(P),oe.childLanes=qa(_,Ae,P),N.memoizedState=wl,$):(Bn(N),Yc(N,Me))}if(Pe=_.memoizedState,Pe!==null&&(Me=Pe.dehydrated,Me!==null)){if(re)N.flags&256?(Bn(N),N.flags&=-257,N=Kl(_,N,P)):N.memoizedState!==null?(ss(),N.child=_.child,N.flags|=128,N=null):(ss(),oe=$.fallback,Me=N.mode,$=Tc({mode:"visible",children:$.children},Me),oe=cr(oe,Me,P,null),oe.flags|=2,$.return=N,oe.return=N,$.sibling=oe,N.child=$,vr(N,_.child,null,P),$=N.child,$.memoizedState=Ec(P),$.childLanes=qa(_,Ae,P),N.memoizedState=wl,N=oe);else if(Bn(N),vl(Me))Ae=hc(Me).digest,$=Error(d(419)),$.stack="",$.digest=Ae,Ue({value:$,source:null,stack:null}),N=Kl(_,N,P);else if(In||tl(_,N,P,!1),Ae=(P&_.childLanes)!==0,In||Ae){if(Ae=Vi,Ae!==null){if($=P&-P,($&42)!==0)$=1;else switch($){case 2:$=1;break;case 8:$=4;break;case 32:$=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:$=64;break;case 268435456:$=134217728;break;default:$=0}if($=($&(Ae.suspendedLanes|P))!==0?0:$,$!==0&&$!==Pe.retryLane)throw Pe.retryLane=$,vt(_,$),zi(Ae,_,$),Zg}kr(Me)||xs(),N=Kl(_,N,P)}else kr(Me)?(N.flags|=128,N.child=_.child,N=Al.bind(null,_),Hu(Me,N),N=null):(_=Pe.treeContext,us&&(Mi=Cg(Me),rn=N,yi=!0,Zs=null,ks=!1,_!==null&&(hs[Hn++]=lo,hs[Hn++]=co,hs[Hn++]=Ds,lo=_.id,co=_.overflow,Ds=N)),N=Yc(N,$.children),N.flags|=4096);return N}return oe?(ss(),oe=$.fallback,Me=N.mode,Pe=_.child,re=Pe.sibling,$=Zo(Pe,{mode:"hidden",children:$.children}),$.subtreeFlags=Pe.subtreeFlags&31457280,re!==null?oe=Zo(re,oe):(oe=cr(oe,Me,P,null),oe.flags|=2),oe.return=N,$.return=N,$.sibling=oe,N.child=$,$=oe,oe=N.child,Me=_.child.memoizedState,Me===null?Me=Ec(P):(Pe=Me.cachePool,Pe!==null?(re=Fs?en._currentValue:en._currentValue2,Pe=Pe.parent!==re?{parent:re,pool:re}:Pe):Pe=Fc(),Me={baseLanes:Me.baseLanes|P,cachePool:Pe}),oe.memoizedState=Me,oe.childLanes=qa(_,Ae,P),N.memoizedState=wl,$):(Bn(N),P=_.child,_=P.sibling,P=Zo(P,{mode:"visible",children:$.children}),P.return=N,P.sibling=null,_!==null&&(Ae=N.deletions,Ae===null?(N.deletions=[_],N.flags|=16):Ae.push(_)),N.child=P,N.memoizedState=null,P)}function Yc(_,N){return N=Tc({mode:"visible",children:N},_.mode),N.return=_,_.child=N}function Tc(_,N){return nc(_,N,0,null)}function Kl(_,N,P){return vr(N,_.child,null,P),_=Yc(N,N.pendingProps.children),_.flags|=2,N.memoizedState=null,_}function tu(_,N,P){_.lanes|=N;var $=_.alternate;$!==null&&($.lanes|=N),el(_.return,N,P)}function Jc(_,N,P,$,oe){var re=_.memoizedState;re===null?_.memoizedState={isBackwards:N,rendering:null,renderingStartTime:0,last:$,tail:P,tailMode:oe}:(re.isBackwards=N,re.rendering=null,re.renderingStartTime=0,re.last=$,re.tail=P,re.tailMode=oe)}function iu(_,N,P){var $=N.pendingProps,oe=$.revealOrder,re=$.tail;if(wn(_,N,$.children,P),$=Li.current,($&2)!==0)$=$&1|2,N.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=N.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&tu(_,P,N);else if(_.tag===19)tu(_,P,N);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===N)break e;for(;_.sibling===null;){if(_.return===null||_.return===N)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}$&=1}switch(z(Li,$),oe){case"forwards":for(P=N.child,oe=null;P!==null;)_=P.alternate,_!==null&&Ji(_)===null&&(oe=P),P=P.sibling;P=oe,P===null?(oe=N.child,N.child=null):(oe=P.sibling,P.sibling=null),Jc(N,!1,oe,P,re);break;case"backwards":for(P=null,oe=N.child,N.child=null;oe!==null;){if(_=oe.alternate,_!==null&&Ji(_)===null){N.child=oe;break}_=oe.sibling,oe.sibling=P,P=oe,oe=_}Jc(N,!0,P,null,re);break;case"together":Jc(N,!1,null,null,void 0);break;default:N.memoizedState=null}return N.child}function mo(_,N,P){if(_!==null&&(N.dependencies=_.dependencies),Ws|=N.lanes,(P&N.childLanes)===0)if(_!==null){if(tl(_,N,P,!1),(P&N.childLanes)===0)return null}else return null;if(_!==null&&N.child!==_.child)throw Error(d(153));if(N.child!==null){for(_=N.child,P=Zo(_,_.pendingProps),N.child=P,P.return=N;_.sibling!==null;)_=_.sibling,P=P.sibling=Zo(_,_.pendingProps),P.return=N;P.sibling=null}return N.child}function Hc(_,N){return(_.lanes&N)!==0?!0:(_=_.dependencies,!!(_!==null&&il(_)))}function mh(_,N,P){switch(N.tag){case 3:me(N,N.stateNode.containerInfo),Qo(N,en,_.memoizedState.cache),Qe();break;case 27:case 5:Je(N);break;case 4:me(N,N.stateNode.containerInfo);break;case 10:Qo(N,N.type,N.memoizedProps.value);break;case 13:var $=N.memoizedState;if($!==null)return $.dehydrated!==null?(Bn(N),N.flags|=128,null):(P&N.child.childLanes)!==0?eu(_,N,P):(Bn(N),_=mo(_,N,P),_!==null?_.sibling:null);Bn(N);break;case 19:var oe=(_.flags&128)!==0;if($=(P&N.childLanes)!==0,$||(tl(_,N,P,!1),$=(P&N.childLanes)!==0),oe){if($)return iu(_,N,P);N.flags|=128}if(oe=N.memoizedState,oe!==null&&(oe.rendering=null,oe.tail=null,oe.lastEffect=null),z(Li,Li.current),$)break;return null;case 22:case 23:return N.lanes=0,Ug(_,N,P);case 24:Qo(N,en,_.memoizedState.cache)}return mo(_,N,P)}function nu(_,N,P){if(_!==null)if(_.memoizedProps!==N.pendingProps)In=!0;else{if(!Hc(_,P)&&(N.flags&128)===0)return In=!1,mh(_,N,P);In=(_.flags&131072)!==0}else In=!1,yi&&(N.flags&1048576)!==0&&Ie(N,Ma,N.index);switch(N.lanes=0,N.tag){case 16:e:{_=N.pendingProps;var $=N.elementType,oe=$._init;if($=oe($._payload),N.type=$,typeof $=="function")Ro($)?(_=Ao($,_),N.tag=1,N=Qg(null,N,$,_,P)):(N.tag=0,N=Fl(null,N,$,_,P));else{if($!=null){if(oe=$.$$typeof,oe===sc){N.tag=11,N=Ll(null,N,$,_,P);break e}else if(oe===va){N.tag=14,N=kg(null,N,$,_,P);break e}}throw N=I($)||$,Error(d(306,N,""))}}return N;case 0:return Fl(_,N,N.type,N.pendingProps,P);case 1:return $=N.type,oe=Ao($,N.pendingProps),Qg(_,N,$,oe,P);case 3:e:{if(me(N,N.stateNode.containerInfo),_===null)throw Error(d(387));var re=N.pendingProps;oe=N.memoizedState,$=oe.element,gt(_,N),_e(N,re,null,P);var Ae=N.memoizedState;if(re=Ae.cache,Qo(N,en,re),re!==oe.cache&&Wr(N,[en],P,!0),Ye(),re=Ae.element,us&&oe.isDehydrated)if(oe={element:re,isDehydrated:!1,cache:Ae.cache},N.updateQueue.baseState=oe,N.memoizedState=oe,N.flags&256){N=qg(_,N,re,P);break e}else if(re!==$){$=Ze(Error(d(424)),N),Ue($),N=qg(_,N,re,P);break e}else for(us&&(Mi=Or(N.stateNode.containerInfo),rn=N,yi=!0,Zs=null,ks=!0),P=go(N,null,re,P),N.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(Qe(),re===$){N=mo(_,N,P);break e}wn(_,N,re,P)}N=N.child}return N;case 26:if(As)return Qa(_,N),_===null?(P=Ag(N.type,null,N.pendingProps,null))?N.memoizedState=P:yi||(N.stateNode=Gg(N.type,N.pendingProps,To.current,N)):N.memoizedState=Ag(N.type,_.memoizedProps,N.pendingProps,_.memoizedState),null;case 27:if(xn)return Je(N),_===null&&xn&&yi&&($=N.stateNode=Ic(N.type,N.pendingProps,To.current,on.current,!1),rn=N,ks=!0,Mi=Eo($)),$=N.pendingProps.children,_!==null||yi?wn(_,N,$,P):N.child=vr(N,null,$,P),Qa(_,N),N.child;case 5:return _===null&&yi&&(Ou(N.type,N.pendingProps,on.current),(oe=$=Mi)&&($=Ig($,N.type,N.pendingProps,ks),$!==null?(N.stateNode=$,rn=N,Mi=Eo($),ks=!1,oe=!0):oe=!1),oe||Ee(N)),Je(N),oe=N.type,re=N.pendingProps,Ae=_!==null?_.memoizedProps:null,$=re.children,Nn(oe,re)?$=null:Ae!==null&&Nn(oe,Ae)&&(N.flags|=32),N.memoizedState!==null&&(oe=Uo(_,N,El,null,null,P),Fs?Wo._currentValue=oe:Wo._currentValue2=oe),Qa(_,N),wn(_,N,$,P),N.child;case 6:return _===null&&yi&&(Rh(N.pendingProps,on.current),(_=P=Mi)&&(P=Lu(P,N.pendingProps,ks),P!==null?(N.stateNode=P,rn=N,Mi=null,_=!0):_=!1),_||Ee(N)),null;case 13:return eu(_,N,P);case 4:return me(N,N.stateNode.containerInfo),$=N.pendingProps,_===null?N.child=vr(N,null,$,P):wn(_,N,$,P),N.child;case 11:return Ll(_,N,N.type,N.pendingProps,P);case 7:return wn(_,N,N.pendingProps,P),N.child;case 8:return wn(_,N,N.pendingProps.children,P),N.child;case 12:return wn(_,N,N.pendingProps.children,P),N.child;case 10:return $=N.pendingProps,Qo(N,N.type,$.value),wn(_,N,$.children,P),N.child;case 9:return oe=N.type._context,$=N.pendingProps.children,qo(N),oe=_n(oe),$=$(oe),N.flags|=1,wn(_,N,$,P),N.child;case 14:return kg(_,N,N.type,N.pendingProps,P);case 15:return Og(_,N,N.type,N.pendingProps,P);case 19:return iu(_,N,P);case 22:return Ug(_,N,P);case 24:return qo(N),$=_n(en),_===null?(oe=Lc(),oe===null&&(oe=Vi,re=er(),oe.pooledCache=re,re.refCount++,re!==null&&(oe.pooledCacheLanes|=P),oe=re),N.memoizedState={parent:$,cache:oe},Oe(N),Qo(N,en,oe)):((_.lanes&P)!==0&&(gt(_,N),_e(N,null,null,P),Ye()),oe=_.memoizedState,re=N.memoizedState,oe.parent!==$?(oe={parent:$,cache:$},N.memoizedState=oe,N.lanes===0&&(N.memoizedState=N.updateQueue.baseState=oe),Qo(N,en,$)):($=re.cache,Qo(N,en,$),$!==oe.cache&&Wr(N,[en],P,!0))),wn(_,N,N.pendingProps.children,P),N.child;case 29:throw N.pendingProps}throw Error(d(156,N.tag))}function Qo(_,N,P){Fs?(z(_s,N._currentValue),N._currentValue=P):(z(_s,N._currentValue2),N._currentValue2=P)}function bo(_){var N=_s.current;Fs?_._currentValue=N:_._currentValue2=N,J(_s)}function el(_,N,P){for(;_!==null;){var $=_.alternate;if((_.childLanes&N)!==N?(_.childLanes|=N,$!==null&&($.childLanes|=N)):$!==null&&($.childLanes&N)!==N&&($.childLanes|=N),_===P)break;_=_.return}}function Wr(_,N,P,$){var oe=_.child;for(oe!==null&&(oe.return=_);oe!==null;){var re=oe.dependencies;if(re!==null){var Ae=oe.child;re=re.firstContext;e:for(;re!==null;){var Me=re;re=oe;for(var Pe=0;Pe<N.length;Pe++)if(Me.context===N[Pe]){re.lanes|=P,Me=re.alternate,Me!==null&&(Me.lanes|=P),el(re.return,P,_),$||(Ae=null);break e}re=Me.next}}else if(oe.tag===18){if(Ae=oe.return,Ae===null)throw Error(d(341));Ae.lanes|=P,re=Ae.alternate,re!==null&&(re.lanes|=P),el(Ae,P,_),Ae=null}else Ae=oe.child;if(Ae!==null)Ae.return=oe;else for(Ae=oe;Ae!==null;){if(Ae===_){Ae=null;break}if(oe=Ae.sibling,oe!==null){oe.return=Ae.return,Ae=oe;break}Ae=Ae.return}oe=Ae}}function tl(_,N,P,$){_=null;for(var oe=N,re=!1;oe!==null;){if(!re){if((oe.flags&524288)!==0)re=!0;else if((oe.flags&262144)!==0)break}if(oe.tag===10){var Ae=oe.alternate;if(Ae===null)throw Error(d(387));if(Ae=Ae.memoizedProps,Ae!==null){var Me=oe.type;jn(oe.pendingProps.value,Ae.value)||(_!==null?_.push(Me):_=[Me])}}else if(oe===Xl.current){if(Ae=oe.alternate,Ae===null)throw Error(d(387));Ae.memoizedState.memoizedState!==oe.memoizedState.memoizedState&&(_!==null?_.push(Wo):_=[Wo])}oe=oe.return}_!==null&&Wr(N,_,P,$),N.flags|=262144}function il(_){for(_=_.firstContext;_!==null;){var N=_.context;if(!jn(Fs?N._currentValue:N._currentValue2,_.memoizedValue))return!0;_=_.next}return!1}function qo(_){Rr=_,Ms=null,_=_.dependencies,_!==null&&(_.firstContext=null)}function _n(_){return zc(Rr,_)}function nl(_,N){return Rr===null&&qo(_),zc(_,N)}function zc(_,N){var P=Fs?N._currentValue:N._currentValue2;if(N={context:N,memoizedValue:P,next:null},Ms===null){if(_===null)throw Error(d(308));Ms=N,_.dependencies={lanes:0,firstContext:N},_.flags|=524288}else Ms=Ms.next=N;return P}function er(){return{controller:new _l,data:new Map,refCount:0}}function sl(_){_.refCount--,_.refCount===0&&ji(wh,function(){_.controller.abort()})}function Lc(){var _=ea.current;return _!==null?_:Vi.pooledCache}function Pl(_,N){N===null?z(ea,ea.current):z(ea,N.pool)}function Fc(){var _=Lc();return _===null?null:{parent:Fs?en._currentValue:en._currentValue2,pool:_}}function os(_){_.flags|=4}function Ca(_,N){if(_!==null&&_.child===N.child)return!1;if((N.flags&16)!==0)return!0;for(_=N.child;_!==null;){if((_.flags&13878)!==0||(_.subtreeFlags&13878)!==0)return!0;_=_.sibling}return!1}function Er(_,N,P,$){if(Oi)for(P=N.child;P!==null;){if(P.tag===5||P.tag===6)yl(_,P.stateNode);else if(!(P.tag===4||xn&&P.tag===27)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===N)break;for(;P.sibling===null;){if(P.return===null||P.return===N)return;P=P.return}P.sibling.return=P.return,P=P.sibling}else if(Ks)for(var oe=N.child;oe!==null;){if(oe.tag===5){var re=oe.stateNode;P&&$&&(re=Ju(re,oe.type,oe.memoizedProps)),yl(_,re)}else if(oe.tag===6)re=oe.stateNode,P&&$&&(re=dg(re,oe.memoizedProps)),yl(_,re);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)re=oe.child,re!==null&&(re.return=oe),Er(_,oe,!0,!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===N)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===N)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function su(_,N,P,$){if(Ks)for(var oe=N.child;oe!==null;){if(oe.tag===5){var re=oe.stateNode;P&&$&&(re=Ju(re,oe.type,oe.memoizedProps)),hg(_,re)}else if(oe.tag===6)re=oe.stateNode,P&&$&&(re=dg(re,oe.memoizedProps)),hg(_,re);else if(oe.tag!==4){if(oe.tag===22&&oe.memoizedState!==null)re=oe.child,re!==null&&(re.return=oe),su(_,oe,!(oe.memoizedProps!==null&&oe.memoizedProps.mode==="manual"),!0);else if(oe.child!==null){oe.child.return=oe,oe=oe.child;continue}}if(oe===N)break;for(;oe.sibling===null;){if(oe.return===null||oe.return===N)return;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}}function ol(_,N){if(Ks&&Ca(_,N)){_=N.stateNode;var P=_.containerInfo,$=uc();su($,N,!1,!1),_.pendingChildren=$,os(N),Yu(P,$)}}function Dl(_,N,P,$){if(Oi)_.memoizedProps!==$&&os(N);else if(Ks){var oe=_.stateNode,re=_.memoizedProps;if((_=Ca(_,N))||re!==$){var Ae=on.current;re=Eu(oe,P,re,$,!_,null),re===oe?N.stateNode=oe:(oc(re,P,$,Ae)&&os(N),N.stateNode=re,_?Er(re,N,!1,!1):os(N))}else N.stateNode=oe}}function kl(_,N,P){if(rg(N,P)){if(_.flags|=16777216,!ag(N,P))if(Xn())_.flags|=8192;else throw Ln=Qn,Zl}else _.flags&=-16777217}function Ol(_,N){if(ju(N)){if(_.flags|=16777216,!vg(N))if(Xn())_.flags|=8192;else throw Ln=Qn,Zl}else _.flags&=-16777217}function Ia(_,N){N!==null&&(_.flags|=4),_.flags&16384&&(N=_.tag!==22?te():536870912,_.lanes|=N,pn|=N)}function fa(_,N){if(!yi)switch(_.tailMode){case"hidden":N=_.tail;for(var P=null;N!==null;)N.alternate!==null&&(P=N),N=N.sibling;P===null?_.tail=null:P.sibling=null;break;case"collapsed":P=_.tail;for(var $=null;P!==null;)P.alternate!==null&&($=P),P=P.sibling;$===null?N||_.tail===null?_.tail=null:_.tail.sibling=null:$.sibling=null}}function ki(_){var N=_.alternate!==null&&_.alternate.child===_.child,P=0,$=0;if(N)for(var oe=_.child;oe!==null;)P|=oe.lanes|oe.childLanes,$|=oe.subtreeFlags&31457280,$|=oe.flags&31457280,oe.return=_,oe=oe.sibling;else for(oe=_.child;oe!==null;)P|=oe.lanes|oe.childLanes,$|=oe.subtreeFlags,$|=oe.flags,oe.return=_,oe=oe.sibling;return _.subtreeFlags|=$,_.childLanes=P,N}function ou(_,N,P){var $=N.pendingProps;switch(ue(N),N.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ki(N),null;case 1:return ki(N),null;case 3:return P=N.stateNode,$=null,_!==null&&($=_.memoizedState.cache),N.memoizedState.cache!==$&&(N.flags|=2048),bo(en),xe(),P.pendingContext&&(P.context=P.pendingContext,P.pendingContext=null),(_===null||_.child===null)&&(wt(N)?os(N):_===null||_.memoizedState.isDehydrated&&(N.flags&256)===0||(N.flags|=1024,Zs!==null&&(Xo(Zs),Zs=null))),ol(_,N),ki(N),null;case 26:if(As){P=N.type;var oe=N.memoizedState;return _===null?(os(N),oe!==null?(ki(N),Ol(N,oe)):(ki(N),kl(N,P,$))):oe?oe!==_.memoizedState?(os(N),ki(N),Ol(N,oe)):(ki(N),N.flags&=-16777217):(Oi?_.memoizedProps!==$&&os(N):Dl(_,N,P,$),ki(N),kl(N,P,$)),null}case 27:if(xn){if(Ve(N),P=To.current,oe=N.type,_!==null&&N.stateNode!=null)Oi?_.memoizedProps!==$&&os(N):Dl(_,N,oe,$);else{if(!$){if(N.stateNode===null)throw Error(d(166));return ki(N),null}_=on.current,wt(N)?Ct(N,_):(_=Ic(oe,$,P,_,!0),N.stateNode=_,os(N))}return ki(N),null}case 5:if(Ve(N),P=N.type,_!==null&&N.stateNode!=null)Dl(_,N,P,$);else{if(!$){if(N.stateNode===null)throw Error(d(166));return ki(N),null}_=on.current,wt(N)?Ct(N,_):(oe=og(P,$,To.current,_,N),Er(oe,N,!1,!1),N.stateNode=oe,oc(oe,P,$,_)&&os(N))}return ki(N),kl(N,N.type,N.pendingProps),null;case 6:if(_&&N.stateNode!=null)P=_.memoizedProps,Oi?P!==$&&os(N):Ks&&(P!==$?(N.stateNode=nn($,To.current,on.current,N),os(N)):N.stateNode=_.stateNode);else{if(typeof $!="string"&&N.stateNode===null)throw Error(d(166));if(_=To.current,P=on.current,wt(N)){if(!us)throw Error(d(176));if(_=N.stateNode,P=N.memoizedProps,$=null,oe=rn,oe!==null)switch(oe.tag){case 27:case 5:$=oe.memoizedProps}dc(_,P,N,$)||Ee(N)}else N.stateNode=nn($,_,P,N)}return ki(N),null;case 13:if($=N.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(oe=wt(N),$!==null&&$.dehydrated!==null){if(_===null){if(!oe)throw Error(d(318));if(!us)throw Error(d(344));if(oe=N.memoizedState,oe=oe!==null?oe.dehydrated:null,!oe)throw Error(d(317));Ku(oe,N)}else Qe(),(N.flags&128)===0&&(N.memoizedState=null),N.flags|=4;ki(N),oe=!1}else Zs!==null&&(Xo(Zs),Zs=null),oe=!0;if(!oe)return N.flags&256?(Ti(N),N):(Ti(N),null)}if(Ti(N),(N.flags&128)!==0)return N.lanes=P,N;if(P=$!==null,_=_!==null&&_.memoizedState!==null,P){$=N.child,oe=null,$.alternate!==null&&$.alternate.memoizedState!==null&&$.alternate.memoizedState.cachePool!==null&&(oe=$.alternate.memoizedState.cachePool.pool);var re=null;$.memoizedState!==null&&$.memoizedState.cachePool!==null&&(re=$.memoizedState.cachePool.pool),re!==oe&&($.flags|=2048)}return P!==_&&P&&(N.child.flags|=8192),Ia(N,N.updateQueue),ki(N),null;case 4:return xe(),ol(_,N),_===null&&Iu(N.stateNode.containerInfo),ki(N),null;case 10:return bo(N.type),ki(N),null;case 19:if(J(Li),oe=N.memoizedState,oe===null)return ki(N),null;if($=(N.flags&128)!==0,re=oe.rendering,re===null)if($)fa(oe,!1);else{if($i!==0||_!==null&&(_.flags&128)!==0)for(_=N.child;_!==null;){if(re=Ji(_),re!==null){for(N.flags|=128,fa(oe,!1),_=re.updateQueue,N.updateQueue=_,Ia(N,_),N.subtreeFlags=0,_=P,P=N.child;P!==null;)Lr(P,_),P=P.sibling;return z(Li,Li.current&1|2),N.child}_=_.sibling}oe.tail!==null&&ms()>vs&&(N.flags|=128,$=!0,fa(oe,!1),N.lanes=4194304)}else{if(!$)if(_=Ji(re),_!==null){if(N.flags|=128,$=!0,_=_.updateQueue,N.updateQueue=_,Ia(N,_),fa(oe,!0),oe.tail===null&&oe.tailMode==="hidden"&&!re.alternate&&!yi)return ki(N),null}else 2*ms()-oe.renderingStartTime>vs&&P!==536870912&&(N.flags|=128,$=!0,fa(oe,!1),N.lanes=4194304);oe.isBackwards?(re.sibling=N.child,N.child=re):(_=oe.last,_!==null?_.sibling=re:N.child=re,oe.last=re)}return oe.tail!==null?(N=oe.tail,oe.rendering=N,oe.tail=N.sibling,oe.renderingStartTime=ms(),N.sibling=null,_=Li.current,z(Li,$?_&1|2:_&1),N):(ki(N),null);case 22:case 23:return Ti(N),mn(),$=N.memoizedState!==null,_!==null?_.memoizedState!==null!==$&&(N.flags|=8192):$&&(N.flags|=8192),$?(P&536870912)!==0&&(N.flags&128)===0&&(ki(N),N.subtreeFlags&6&&(N.flags|=8192)):ki(N),P=N.updateQueue,P!==null&&Ia(N,P.retryQueue),P=null,_!==null&&_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(P=_.memoizedState.cachePool.pool),$=null,N.memoizedState!==null&&N.memoizedState.cachePool!==null&&($=N.memoizedState.cachePool.pool),$!==P&&(N.flags|=2048),_!==null&&J(ea),null;case 24:return P=null,_!==null&&(P=_.memoizedState.cache),N.memoizedState.cache!==P&&(N.flags|=2048),bo(en),ki(N),null;case 25:return null}throw Error(d(156,N.tag))}function bh(_,N){switch(ue(N),N.tag){case 1:return _=N.flags,_&65536?(N.flags=_&-65537|128,N):null;case 3:return bo(en),xe(),_=N.flags,(_&65536)!==0&&(_&128)===0?(N.flags=_&-65537|128,N):null;case 26:case 27:case 5:return Ve(N),null;case 13:if(Ti(N),_=N.memoizedState,_!==null&&_.dehydrated!==null){if(N.alternate===null)throw Error(d(340));Qe()}return _=N.flags,_&65536?(N.flags=_&-65537|128,N):null;case 19:return J(Li),null;case 4:return xe(),null;case 10:return bo(N.type),null;case 22:case 23:return Ti(N),mn(),_!==null&&J(ea),_=N.flags,_&65536?(N.flags=_&-65537|128,N):null;case 24:return bo(en),null;case 25:return null;default:return null}}function ru(_,N){switch(ue(N),N.tag){case 3:bo(en),xe();break;case 26:case 27:case 5:Ve(N);break;case 4:xe();break;case 13:Ti(N);break;case 19:J(Li);break;case 10:bo(N.type);break;case 22:case 23:Ti(N),mn(),_!==null&&J(ea);break;case 24:bo(en)}}function rl(_,N){try{var P=N.updateQueue,$=P!==null?P.lastEffect:null;if($!==null){var oe=$.next;P=oe;do{if((P.tag&_)===_){$=void 0;var re=P.create,Ae=P.inst;$=re(),Ae.destroy=$}P=P.next}while(P!==oe)}}catch(Me){Xi(N,N.return,Me)}}function tr(_,N,P){try{var $=N.updateQueue,oe=$!==null?$.lastEffect:null;if(oe!==null){var re=oe.next;$=re;do{if(($.tag&_)===_){var Ae=$.inst,Me=Ae.destroy;if(Me!==void 0){Ae.destroy=void 0,oe=N;var Pe=P;try{Me()}catch(ut){Xi(oe,Pe,ut)}}}$=$.next}while($!==re)}}catch(ut){Xi(N,N.return,ut)}}function au(_){var N=_.updateQueue;if(N!==null){var P=_.stateNode;try{St(N,P)}catch($){Xi(_,_.return,$)}}}function rs(_,N,P){P.props=Ao(_.type,_.memoizedProps),P.state=_.memoizedState;try{P.componentWillUnmount()}catch($){Xi(_,N,$)}}function Ls(_,N){try{var P=_.ref;if(P!==null){var $=_.stateNode;switch(_.tag){case 26:case 27:case 5:var oe=Pr($);break;default:oe=$}typeof P=="function"?_.refCleanup=P(oe):P.current=oe}}catch(re){Xi(_,N,re)}}function as(_,N){var P=_.ref,$=_.refCleanup;if(P!==null)if(typeof $=="function")try{$()}catch(oe){Xi(_,N,oe)}finally{_.refCleanup=null,_=_.alternate,_!=null&&(_.refCleanup=null)}else if(typeof P=="function")try{P(null)}catch(oe){Xi(_,N,oe)}else P.current=null}function Kc(_){var N=_.type,P=_.memoizedProps,$=_.stateNode;try{Ru($,N,P,_)}catch(oe){Xi(_,_.return,oe)}}function Pc(_,N,P){try{Zu(_.stateNode,_.type,P,N,_)}catch($){Xi(_,_.return,$)}}function Dc(_){return _.tag===5||_.tag===3||(As?_.tag===26:!1)||(xn?_.tag===27:!1)||_.tag===4}function al(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||Dc(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&(!xn||_.tag!==27)&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function kc(_,N,P){var $=_.tag;if($===5||$===6)_=_.stateNode,N?gg(P,_,N):cg(P,_);else if(!($===4||xn&&$===27)&&(_=_.child,_!==null))for(kc(_,N,P),_=_.sibling;_!==null;)kc(_,N,P),_=_.sibling}function Ul(_,N,P){var $=_.tag;if($===5||$===6)_=_.stateNode,N?wu(P,_,N):Xu(P,_);else if(!($===4||xn&&$===27)&&(_=_.child,_!==null))for(Ul(_,N,P),_=_.sibling;_!==null;)Ul(_,N,P),_=_.sibling}function Yr(_,N,P){_=_.containerInfo;try{Tu(_,P)}catch($){Xi(N,N.return,$)}}function Oc(_,N){for(Cu(_.containerInfo),Dt=N;Dt!==null;)if(_=Dt,N=_.child,(_.subtreeFlags&1028)!==0&&N!==null)N.return=_,Dt=N;else for(;Dt!==null;){_=Dt;var P=_.alternate;switch(N=_.flags,_.tag){case 0:break;case 11:case 15:break;case 1:if((N&1024)!==0&&P!==null){N=void 0;var $=_,oe=P.memoizedProps;P=P.memoizedState;var re=$.stateNode;try{var Ae=Ao($.type,oe,$.elementType===$.type);N=re.getSnapshotBeforeUpdate(Ae,P),re.__reactInternalSnapshotBeforeUpdate=N}catch(Me){Xi($,$.return,Me)}}break;case 3:(N&1024)!==0&&Oi&&Wu(_.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((N&1024)!==0)throw Error(d(163))}if(N=_.sibling,N!==null){N.return=_.return,Dt=N;break}Dt=_.return}return Ae=Ei,Ei=!1,Ae}function pa(_,N,P){var $=P.flags;switch(P.tag){case 0:case 11:case 15:Go(_,P),$&4&&rl(5,P);break;case 1:if(Go(_,P),$&4)if(_=P.stateNode,N===null)try{_.componentDidMount()}catch(Me){Xi(P,P.return,Me)}else{var oe=Ao(P.type,N.memoizedProps);N=N.memoizedState;try{_.componentDidUpdate(oe,N,_.__reactInternalSnapshotBeforeUpdate)}catch(Me){Xi(P,P.return,Me)}}$&64&&au(P),$&512&&Ls(P,P.return);break;case 3:if(Go(_,P),$&64&&($=P.updateQueue,$!==null)){if(_=null,P.child!==null)switch(P.child.tag){case 27:case 5:_=Pr(P.child.stateNode);break;case 1:_=P.child.stateNode}try{St($,_)}catch(Me){Xi(P,P.return,Me)}}break;case 26:if(As){Go(_,P),$&512&&Ls(P,P.return);break}case 27:case 5:Go(_,P),N===null&&$&4&&Kc(P),$&512&&Ls(P,P.return);break;case 12:Go(_,P);break;case 13:Go(_,P),$&4&&Tr(_,P);break;case 22:if(oe=P.memoizedState!==null||Ko,!oe){N=N!==null&&N.memoizedState!==null||ti;var re=Ko,Ae=ti;Ko=oe,(ti=N)&&!Ae?ir(_,P,(P.subtreeFlags&8772)!==0):Go(_,P),Ko=re,ti=Ae}$&512&&(P.memoizedProps.mode==="manual"?Ls(P,P.return):as(P,P.return));break;default:Go(_,P)}}function $l(_){var N=_.alternate;N!==null&&(_.alternate=null,$l(N)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(N=_.stateNode,N!==null&&Au(N)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function Bs(_,N,P){for(P=P.child;P!==null;)yo(_,N,P),P=P.sibling}function yo(_,N,P){if(Cn&&typeof Cn.onCommitFiberUnmount=="function")try{Cn.onCommitFiberUnmount(_a,P)}catch{}switch(P.tag){case 26:if(As){ti||as(P,N),Bs(_,N,P),P.memoizedState?bg(P.memoizedState):P.stateNode&&Ra(P.stateNode);break}case 27:if(xn){ti||as(P,N);var $=Bi,oe=cn;Bi=P.stateNode,Bs(_,N,P),Xg(P.stateNode),Bi=$,cn=oe;break}case 5:ti||as(P,N);case 6:if(Oi){if($=Bi,oe=cn,Bi=null,Bs(_,N,P),Bi=$,cn=oe,Bi!==null)if(cn)try{Mu(Bi,P.stateNode)}catch(re){Xi(P,N,re)}else try{_u(Bi,P.stateNode)}catch(re){Xi(P,N,re)}}else Bs(_,N,P);break;case 18:Oi&&Bi!==null&&(cn?fg(Bi,P.stateNode):ku(Bi,P.stateNode));break;case 4:Oi?($=Bi,oe=cn,Bi=P.stateNode.containerInfo,cn=!0,Bs(_,N,P),Bi=$,cn=oe):(Ks&&Yr(P.stateNode,P,uc()),Bs(_,N,P));break;case 0:case 11:case 14:case 15:ti||tr(2,P,N),ti||tr(4,P,N),Bs(_,N,P);break;case 1:ti||(as(P,N),$=P.stateNode,typeof $.componentWillUnmount=="function"&&rs(P,N,$)),Bs(_,N,P);break;case 21:Bs(_,N,P);break;case 22:ti||as(P,N),ti=($=ti)||P.memoizedState!==null,Bs(_,N,P),ti=$;break;default:Bs(_,N,P)}}function Tr(_,N){if(us&&N.memoizedState===null&&(_=N.alternate,_!==null&&(_=_.memoizedState,_!==null&&(_=_.dehydrated,_!==null))))try{Cc(_)}catch(P){Xi(N,N.return,P)}}function Uc(_){switch(_.tag){case 13:case 19:var N=_.stateNode;return N===null&&(N=_.stateNode=new li),N;case 22:return _=_.stateNode,N=_._retryCache,N===null&&(N=_._retryCache=new li),N;default:throw Error(d(435,_.tag))}}function jl(_,N){var P=Uc(_);N.forEach(function($){var oe=ic.bind(null,_,$);P.has($)||(P.add($),$.then(oe,oe))})}function un(_,N){var P=N.deletions;if(P!==null)for(var $=0;$<P.length;$++){var oe=P[$],re=_,Ae=N;if(Oi){var Me=Ae;e:for(;Me!==null;){switch(Me.tag){case 27:case 5:Bi=Me.stateNode,cn=!1;break e;case 3:Bi=Me.stateNode.containerInfo,cn=!0;break e;case 4:Bi=Me.stateNode.containerInfo,cn=!0;break e}Me=Me.return}if(Bi===null)throw Error(d(160));yo(re,Ae,oe),Bi=null,cn=!1}else yo(re,Ae,oe);re=oe.alternate,re!==null&&(re.return=null),oe.return=null}if(N.subtreeFlags&13878)for(N=N.child;N!==null;)$c(N,_),N=N.sibling}function $c(_,N){var P=_.alternate,$=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:un(N,_),ls(_),$&4&&(tr(3,_,_.return),rl(3,_),tr(5,_,_.return));break;case 1:un(N,_),ls(_),$&512&&(ti||P===null||as(P,P.return)),$&64&&Ko&&(_=_.updateQueue,_!==null&&($=_.callbacks,$!==null&&(P=_.shared.hiddenCallbacks,_.shared.hiddenCallbacks=P===null?$:P.concat($))));break;case 26:if(As){var oe=Kn;un(N,_),ls(_),$&512&&(ti||P===null||as(P,P.return)),$&4&&($=P!==null?P.memoizedState:null,N=_.memoizedState,P===null?N===null?_.stateNode===null?_.stateNode=Uu(oe,_.type,_.memoizedProps,_):yg(oe,_.type,_.stateNode):_.stateNode=mg(oe,N,_.memoizedProps):$!==N?($===null?P.stateNode!==null&&Ra(P.stateNode):bg($),N===null?yg(oe,_.type,_.stateNode):mg(oe,N,_.memoizedProps)):N===null&&_.stateNode!==null&&Pc(_,_.memoizedProps,P.memoizedProps));break}case 27:if(xn&&$&4&&_.alternate===null){oe=_.stateNode;var re=_.memoizedProps;try{Qu(oe),Sg(_.type,re,oe,_)}catch(Zt){Xi(_,_.return,Zt)}}case 5:if(un(N,_),ls(_),$&512&&(ti||P===null||as(P,P.return)),Oi){if(_.flags&32){N=_.stateNode;try{gc(N)}catch(Zt){Xi(_,_.return,Zt)}}$&4&&_.stateNode!=null&&(N=_.memoizedProps,Pc(_,N,P!==null?P.memoizedProps:N)),$&1024&&(Ni=!0)}break;case 6:if(un(N,_),ls(_),$&4&&Oi){if(_.stateNode===null)throw Error(d(162));$=_.memoizedProps,P=P!==null?P.memoizedProps:$,N=_.stateNode;try{xu(N,P,$)}catch(Zt){Xi(_,_.return,Zt)}}break;case 3:if(As?($u(),oe=Kn,Kn=Gn(N.containerInfo),un(N,_),Kn=oe):un(N,_),ls(_),$&4){if(Oi&&us&&P!==null&&P.memoizedState.isDehydrated)try{Du(N.containerInfo)}catch(Zt){Xi(_,_.return,Zt)}if(Ks){$=N.containerInfo,P=N.pendingChildren;try{Tu($,P)}catch(Zt){Xi(_,_.return,Zt)}}}Ni&&(Ni=!1,Qc(_));break;case 4:As?(P=Kn,Kn=Gn(_.stateNode.containerInfo),un(N,_),ls(_),Kn=P):(un(N,_),ls(_)),$&4&&Ks&&Yr(_.stateNode,_,_.stateNode.pendingChildren);break;case 12:un(N,_),ls(_);break;case 13:un(N,_),ls(_),_.child.flags&8192&&_.memoizedState!==null!=(P!==null&&P.memoizedState!==null)&&(_g=ms()),$&4&&($=_.updateQueue,$!==null&&(_.updateQueue=null,jl(_,$)));break;case 22:$&512&&(ti||P===null||as(P,P.return)),oe=_.memoizedState!==null;var Ae=P!==null&&P.memoizedState!==null,Me=Ko,Pe=ti;if(Ko=Me||oe,ti=Pe||Ae,un(N,_),ti=Pe,Ko=Me,ls(_),N=_.stateNode,N._current=_,N._visibility&=-3,N._visibility|=N._pendingVisibility&2,$&8192&&(N._visibility=oe?N._visibility&-2:N._visibility|1,oe&&(N=Ko||ti,P===null||Ae||N||Aa(_)),Oi&&(_.memoizedProps===null||_.memoizedProps.mode!=="manual"))){e:if(P=null,Oi)for(N=_;;){if(N.tag===5||As&&N.tag===26||xn&&N.tag===27){if(P===null){Ae=P=N;try{re=Ae.stateNode,oe?Nu(re):xh(Ae.stateNode,Ae.memoizedProps)}catch(Zt){Xi(Ae,Ae.return,Zt)}}}else if(N.tag===6){if(P===null){Ae=N;try{var ut=Ae.stateNode;oe?Vu(ut):ug(ut,Ae.memoizedProps)}catch(Zt){Xi(Ae,Ae.return,Zt)}}}else if((N.tag!==22&&N.tag!==23||N.memoizedState===null||N===_)&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===_)break e;for(;N.sibling===null;){if(N.return===null||N.return===_)break e;P===N&&(P=null),N=N.return}P===N&&(P=null),N.sibling.return=N.return,N=N.sibling}}$&4&&($=_.updateQueue,$!==null&&(P=$.retryQueue,P!==null&&($.retryQueue=null,jl(_,P))));break;case 19:un(N,_),ls(_),$&4&&($=_.updateQueue,$!==null&&(_.updateQueue=null,jl(_,$)));break;case 21:break;default:un(N,_),ls(_)}}function ls(_){var N=_.flags;if(N&2){try{if(Oi&&(!xn||_.tag!==27)){e:{for(var P=_.return;P!==null;){if(Dc(P)){var $=P;break e}P=P.return}throw Error(d(160))}switch($.tag){case 27:if(xn){var oe=$.stateNode,re=al(_);Ul(_,re,oe);break}case 5:var Ae=$.stateNode;$.flags&32&&(gc(Ae),$.flags&=-33);var Me=al(_);Ul(_,Me,Ae);break;case 3:case 4:var Pe=$.stateNode.containerInfo,ut=al(_);kc(_,ut,Pe);break;default:throw Error(d(161))}}}catch(Zt){Xi(_,_.return,Zt)}_.flags&=-3}N&4096&&(_.flags&=-4097)}function Qc(_){if(_.subtreeFlags&1024)for(_=_.child;_!==null;){var N=_;Qc(N),N.tag===5&&N.flags&1024&&bu(N.stateNode),_=_.sibling}}function Go(_,N){if(N.subtreeFlags&8772)for(N=N.child;N!==null;)pa(_,N.alternate,N),N=N.sibling}function Aa(_){for(_=_.child;_!==null;){var N=_;switch(N.tag){case 0:case 11:case 14:case 15:tr(4,N,N.return),Aa(N);break;case 1:as(N,N.return);var P=N.stateNode;typeof P.componentWillUnmount=="function"&&rs(N,N.return,P),Aa(N);break;case 26:case 27:case 5:as(N,N.return),Aa(N);break;case 22:as(N,N.return),N.memoizedState===null&&Aa(N);break;default:Aa(N)}_=_.sibling}}function ir(_,N,P){for(P=P&&(N.subtreeFlags&8772)!==0,N=N.child;N!==null;){var $=N.alternate,oe=_,re=N,Ae=re.flags;switch(re.tag){case 0:case 11:case 15:ir(oe,re,P),rl(4,re);break;case 1:if(ir(oe,re,P),$=re,oe=$.stateNode,typeof oe.componentDidMount=="function")try{oe.componentDidMount()}catch(ut){Xi($,$.return,ut)}if($=re,oe=$.updateQueue,oe!==null){var Me=$.stateNode;try{var Pe=oe.shared.hiddenCallbacks;if(Pe!==null)for(oe.shared.hiddenCallbacks=null,oe=0;oe<Pe.length;oe++)Ne(Pe[oe],Me)}catch(ut){Xi($,$.return,ut)}}P&&Ae&64&&au(re),Ls(re,re.return);break;case 26:case 27:case 5:ir(oe,re,P),P&&$===null&&Ae&4&&Kc(re),Ls(re,re.return);break;case 12:ir(oe,re,P);break;case 13:ir(oe,re,P),P&&Ae&4&&Tr(oe,re);break;case 22:re.memoizedState===null&&ir(oe,re,P),Ls(re,re.return);break;default:ir(oe,re,P)}N=N.sibling}}function Ql(_,N){var P=null;_!==null&&_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(P=_.memoizedState.cachePool.pool),_=null,N.memoizedState!==null&&N.memoizedState.cachePool!==null&&(_=N.memoizedState.cachePool.pool),_!==P&&(_!=null&&_.refCount++,P!=null&&sl(P))}function ql(_,N){_=null,N.alternate!==null&&(_=N.alternate.memoizedState.cache),N=N.memoizedState.cache,N!==_&&(N.refCount++,_!=null&&sl(_))}function vo(_,N,P,$){if(N.subtreeFlags&10256)for(N=N.child;N!==null;)Ss(_,N,P,$),N=N.sibling}function Ss(_,N,P,$){var oe=N.flags;switch(N.tag){case 0:case 11:case 15:vo(_,N,P,$),oe&2048&&rl(9,N);break;case 3:vo(_,N,P,$),oe&2048&&(_=null,N.alternate!==null&&(_=N.alternate.memoizedState.cache),N=N.memoizedState.cache,N!==_&&(N.refCount++,_!=null&&sl(_)));break;case 12:if(oe&2048){vo(_,N,P,$),_=N.stateNode;try{var re=N.memoizedProps,Ae=re.id,Me=re.onPostCommit;typeof Me=="function"&&Me(Ae,N.alternate===null?"mount":"update",_.passiveEffectDuration,-0)}catch(Pe){Xi(N,N.return,Pe)}}else vo(_,N,P,$);break;case 23:break;case 22:re=N.stateNode,N.memoizedState!==null?re._visibility&4?vo(_,N,P,$):qs(_,N):re._visibility&4?vo(_,N,P,$):(re._visibility|=4,Mn(_,N,P,$,(N.subtreeFlags&10256)!==0)),oe&2048&&Ql(N.alternate,N);break;case 24:vo(_,N,P,$),oe&2048&&ql(N.alternate,N);break;default:vo(_,N,P,$)}}function Mn(_,N,P,$,oe){for(oe=oe&&(N.subtreeFlags&10256)!==0,N=N.child;N!==null;){var re=_,Ae=N,Me=P,Pe=$,ut=Ae.flags;switch(Ae.tag){case 0:case 11:case 15:Mn(re,Ae,Me,Pe,oe),rl(8,Ae);break;case 23:break;case 22:var Zt=Ae.stateNode;Ae.memoizedState!==null?Zt._visibility&4?Mn(re,Ae,Me,Pe,oe):qs(re,Ae):(Zt._visibility|=4,Mn(re,Ae,Me,Pe,oe)),oe&&ut&2048&&Ql(Ae.alternate,Ae);break;case 24:Mn(re,Ae,Me,Pe,oe),oe&&ut&2048&&ql(Ae.alternate,Ae);break;default:Mn(re,Ae,Me,Pe,oe)}N=N.sibling}}function qs(_,N){if(N.subtreeFlags&10256)for(N=N.child;N!==null;){var P=_,$=N,oe=$.flags;switch($.tag){case 22:qs(P,$),oe&2048&&Ql($.alternate,$);break;case 24:qs(P,$),oe&2048&&ql($.alternate,$);break;default:qs(P,$)}N=N.sibling}}function Bo(_){if(_.subtreeFlags&Zr)for(_=_.child;_!==null;)ll(_),_=_.sibling}function ll(_){switch(_.tag){case 26:Bo(_),_.flags&Zr&&(_.memoizedState!==null?Bg(Kn,_.memoizedState,_.memoizedProps):lg(_.type,_.memoizedProps));break;case 5:Bo(_),_.flags&Zr&&lg(_.type,_.memoizedProps);break;case 3:case 4:if(As){var N=Kn;Kn=Gn(_.stateNode.containerInfo),Bo(_),Kn=N}else Bo(_);break;case 22:_.memoizedState===null&&(N=_.alternate,N!==null&&N.memoizedState!==null?(N=Zr,Zr=16777216,Bo(_),Zr=N):Bo(_));break;default:Bo(_)}}function cl(_){var N=_.alternate;if(N!==null&&(_=N.child,_!==null)){N.child=null;do N=_.sibling,_.sibling=null,_=N;while(_!==null)}}function Jr(_){var N=_.deletions;if((_.flags&16)!==0){if(N!==null)for(var P=0;P<N.length;P++){var $=N[P];Dt=$,ul($,_)}cl(_)}if(_.subtreeFlags&10256)for(_=_.child;_!==null;)So(_),_=_.sibling}function So(_){switch(_.tag){case 0:case 11:case 15:Jr(_),_.flags&2048&&tr(9,_,_.return);break;case 3:Jr(_);break;case 12:Jr(_);break;case 22:var N=_.stateNode;_.memoizedState!==null&&N._visibility&4&&(_.return===null||_.return.tag!==13)?(N._visibility&=-5,gl(_)):Jr(_);break;default:Jr(_)}}function gl(_){var N=_.deletions;if((_.flags&16)!==0){if(N!==null)for(var P=0;P<N.length;P++){var $=N[P];Dt=$,ul($,_)}cl(_)}for(_=_.child;_!==null;){switch(N=_,N.tag){case 0:case 11:case 15:tr(8,N,N.return),gl(N);break;case 22:P=N.stateNode,P._visibility&4&&(P._visibility&=-5,gl(N));break;default:gl(N)}_=_.sibling}}function ul(_,N){for(;Dt!==null;){var P=Dt;switch(P.tag){case 0:case 11:case 15:tr(8,P,N);break;case 23:case 22:if(P.memoizedState!==null&&P.memoizedState.cachePool!==null){var $=P.memoizedState.cachePool.pool;$!=null&&$.refCount++}break;case 24:sl(P.memoizedState.cache)}if($=P.child,$!==null)$.return=P,Dt=$;else e:for(P=_;Dt!==null;){$=Dt;var oe=$.sibling,re=$.return;if($l($),$===P){Dt=null;break e}if(oe!==null){oe.return=re,Dt=oe;break e}Dt=re}}}function nr(_){var N=ac(_);if(N!=null){if(typeof N.memoizedProps["data-testname"]!="string")throw Error(d(364));return N}if(_=vu(_),_===null)throw Error(d(362));return _.stateNode.current}function ec(_,N){var P=_.tag;switch(N.$$typeof){case Di:if(_.type===N.value)return!0;break;case js:e:{for(N=N.value,_=[_,0],P=0;P<_.length;){var $=_[P++],oe=$.tag,re=_[P++],Ae=N[re];if(oe!==5&&oe!==26&&oe!==27||!oo($)){for(;Ae!=null&&ec($,Ae);)re++,Ae=N[re];if(re===N.length){N=!0;break e}else for($=$.child;$!==null;)_.push($,re),$=$.sibling}}N=!1}return N;case uo:if((P===5||P===26||P===27)&&Su(_.stateNode,N.value))return!0;break;case es:if((P===5||P===6||P===26||P===27)&&(_=Bu(_),_!==null&&0<=_.indexOf(N.value)))return!0;break;case Ya:if((P===5||P===26||P===27)&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===N.value.toLowerCase()))return!0;break;default:throw Error(d(365))}return!1}function cs(_){switch(_.$$typeof){case Di:return"<"+(I(_.value)||"Unknown")+">";case js:return":has("+(cs(_)||"")+")";case uo:return'[role="'+_.value+'"]';case es:return'"'+_.value+'"';case Ya:return'[data-testname="'+_.value+'"]';default:throw Error(d(365))}}function Hr(_,N){var P=[];_=[_,0];for(var $=0;$<_.length;){var oe=_[$++],re=oe.tag,Ae=_[$++],Me=N[Ae];if(re!==5&&re!==26&&re!==27||!oo(oe)){for(;Me!=null&&ec(oe,Me);)Ae++,Me=N[Ae];if(Ae===N.length)P.push(oe);else for(oe=oe.child;oe!==null;)_.push(oe,Ae),oe=oe.sibling}}return P}function sr(_,N){if(!xa)throw Error(d(363));_=nr(_),_=Hr(_,N),N=[],_=Array.from(_);for(var P=0;P<_.length;){var $=_[P++],oe=$.tag;if(oe===5||oe===26||oe===27)oo($)||N.push($.stateNode);else for($=$.child;$!==null;)_.push($),$=$.sibling}return N}function Yn(){if((hi&2)!==0&&di!==0)return di&-di;if($t.T!==null){var _=Pi;return _!==0?_:rt()}return fu()}function hl(){Gs===0&&(Gs=(di&536870912)===0||yi?ie():536870912);var _=Cs.current;return _!==null&&(_.flags|=32),Gs}function zi(_,N,P){(_===Vi&&_i===2||_.cancelPendingCommit!==null)&&(or(_,0),Un(_,di,Gs,!1)),ae(_,P),((hi&2)===0||_!==Vi)&&(_===Vi&&((hi&2)===0&&(Do|=P),$i===4&&Un(_,di,Gs,!1)),xt(_))}function fs(_,N,P){if((hi&6)!==0)throw Error(d(327));var $=!P&&(N&60)===0&&(N&_.expiredLanes)===0||Q(_,N),oe=$?lu(_,N):Cl(_,N,!0),re=$;do{if(oe===0){Vs&&!$&&Un(_,N,0,!1);break}else if(oe===6)Un(_,N,0,!Ns);else{if(P=_.current.alternate,re&&!xo(P)){oe=Cl(_,N,!1),re=!1;continue}if(oe===2){if(re=N,_.errorRecoveryDisabledLanes&re)var Ae=0;else Ae=_.pendingLanes&-536870913,Ae=Ae!==0?Ae:Ae&536870912?536870912:0;if(Ae!==0){N=Ae;e:{var Me=_;oe=Ta;var Pe=us&&Me.current.memoizedState.isDehydrated;if(Pe&&(or(Me,Ae).flags|=256),Ae=Cl(Me,Ae,!1),Ae!==2){if(ta&&!Pe){Me.errorRecoveryDisabledLanes|=re,Do|=re,oe=4;break e}re=Es,Es=oe,re!==null&&Xo(re)}oe=Ae}if(re=!1,oe!==2)continue}}if(oe===1){or(_,0),Un(_,N,0,!0);break}e:{switch($=_,oe){case 0:case 1:throw Error(d(345));case 4:if((N&4194176)===N){Un($,N,Gs,!Ns);break e}break;case 2:Es=null;break;case 3:case 5:break;default:throw Error(d(329))}if($.finishedWork=P,$.finishedLanes=N,(N&62914560)===N&&(re=_g+300-ms(),10<re)){if(Un($,N,Gs,!Ns),O($,0)!==0)break e;$.timeoutHandle=rc(eo.bind(null,$,P,Es,ia,Sc,N,Gs,Do,pn,Ns,2,-0,0),re);break e}eo($,P,Es,ia,Sc,N,Gs,Do,pn,Ns,0,-0,0)}}break}while(!0);xt(_)}function Xo(_){Es===null?Es=_:Es.push.apply(Es,_)}function eo(_,N,P,$,oe,re,Ae,Me,Pe,ut,Zt,Et,Xt){var ii=N.subtreeFlags;if((ii&8192||(ii&16785408)===16785408)&&(Sh(),ll(N),N=mu(),N!==null)){_.cancelPendingCommit=N(tc.bind(null,_,P,$,oe,Ae,Me,Pe,1,Et,Xt)),Un(_,re,Ae,!ut);return}tc(_,P,$,oe,Ae,Me,Pe,Zt,Et,Xt)}function xo(_){for(var N=_;;){var P=N.tag;if((P===0||P===11||P===15)&&N.flags&16384&&(P=N.updateQueue,P!==null&&(P=P.stores,P!==null)))for(var $=0;$<P.length;$++){var oe=P[$],re=oe.getSnapshot;oe=oe.value;try{if(!jn(re(),oe))return!1}catch{return!1}}if(P=N.child,N.subtreeFlags&16384&&P!==null)P.return=N,N=P;else{if(N===_)break;for(;N.sibling===null;){if(N.return===null||N.return===_)return!0;N=N.return}N.sibling.return=N.return,N=N.sibling}}return!0}function Un(_,N,P,$){N&=~ts,N&=~Do,_.suspendedLanes|=N,_.pingedLanes&=~N,$&&(_.warmLanes|=N),$=_.expirationTimes;for(var oe=N;0<oe;){var re=31-sn(oe),Ae=1<<re;$[re]=-1,oe&=~Ae}P!==0&&ge(_,P,N)}function qc(){return(hi&6)===0?(ve(0),!1):!0}function dl(){if(ai!==null){if(_i===0)var _=ai.return;else _=ai,Ms=Rr=null,Hs(_),Qr=null,Fn=0,_=ai;for(;_!==null;)ru(_.alternate,_),_=_.return;ai=null}}function or(_,N){_.finishedWork=null,_.finishedLanes=0;var P=_.timeoutHandle;P!==Xa&&(_.timeoutHandle=Xa,Gl(P)),P=_.cancelPendingCommit,P!==null&&(_.cancelPendingCommit=null,P()),dl(),Vi=_,ai=P=Zo(_.current,null),di=N,_i=0,fn=null,Ns=!1,Vs=Q(_,N),ta=!1,pn=Gs=ts=Do=Ws=$i=0,Es=Ta=null,Sc=!1,(N&8)!==0&&(N|=N&32);var $=_.entangledLanes;if($!==0)for(_=_.entanglements,$&=N;0<$;){var oe=31-sn($),re=1<<oe;N|=_[oe],$&=~re}return Qs=N,Ge(),P}function Tn(_,N){ei=null,$t.H=ln,N===Rl?(N=Jt(),_i=3):N===Zl?(N=Jt(),_i=4):_i=N===Zg?8:N!==null&&typeof N=="object"&&typeof N.then=="function"?6:1,fn=N,ai===null&&($i=1,ua(_,Ze(N,_.current)))}function Xn(){var _=Cs.current;return _===null?!0:(di&4194176)===di?ws===null:(di&62914560)===di||(di&536870912)!==0?_===ws:!1}function bi(){var _=$t.H;return $t.H=ln,_===null?ln:_}function Xs(){var _=$t.A;return $t.A=Po,_}function xs(){$i=4,Ns||(di&4194176)!==di&&Cs.current!==null||(Vs=!0),(Ws&134217727)===0&&(Do&134217727)===0||Vi===null||Un(Vi,di,Gs,!1)}function Cl(_,N,P){var $=hi;hi|=2;var oe=bi(),re=Xs();(Vi!==_||di!==N)&&(ia=null,or(_,N)),N=!1;var Ae=$i;e:do try{if(_i!==0&&ai!==null){var Me=ai,Pe=fn;switch(_i){case 8:dl(),Ae=6;break e;case 3:case 2:case 6:Cs.current===null&&(N=!0);var ut=_i;if(_i=0,fn=null,to(_,Me,Pe,ut),P&&Vs){Ae=0;break e}break;default:ut=_i,_i=0,fn=null,to(_,Me,Pe,ut)}}zr(),Ae=$i;break}catch(Zt){Tn(_,Zt)}while(!0);return N&&_.shellSuspendCounter++,Ms=Rr=null,hi=$,$t.H=oe,$t.A=re,ai===null&&(Vi=null,di=0,Ge()),Ae}function zr(){for(;ai!==null;)ma(ai)}function lu(_,N){var P=hi;hi|=2;var $=bi(),oe=Xs();Vi!==_||di!==N?(ia=null,vs=ms()+500,or(_,N)):Vs=Q(_,N);e:do try{if(_i!==0&&ai!==null){N=ai;var re=fn;t:switch(_i){case 1:_i=0,fn=null,to(_,N,re,1);break;case 2:if(lt(re)){_i=0,fn=null,ba(N);break}N=function(){_i===2&&Vi===_&&(_i=7),xt(_)},re.then(N,N);break e;case 3:_i=7;break e;case 4:_i=5;break e;case 7:lt(re)?(_i=0,fn=null,ba(N)):(_i=0,fn=null,to(_,N,re,7));break;case 5:var Ae=null;switch(ai.tag){case 26:Ae=ai.memoizedState;case 5:case 27:var Me=ai,Pe=Me.type,ut=Me.pendingProps;if(Ae?vg(Ae):ag(Pe,ut)){_i=0,fn=null;var Zt=Me.sibling;if(Zt!==null)ai=Zt;else{var Et=Me.return;Et!==null?(ai=Et,rr(Et)):ai=null}break t}}_i=0,fn=null,to(_,N,re,5);break;case 6:_i=0,fn=null,to(_,N,re,6);break;case 8:dl(),$i=6;break e;default:throw Error(d(462))}}cu();break}catch(Xt){Tn(_,Xt)}while(!0);return Ms=Rr=null,$t.H=$,$t.A=oe,hi=P,ai!==null?0:(Vi=null,di=0,Ge(),$i)}function cu(){for(;ai!==null&&!br();)ma(ai)}function ma(_){var N=nu(_.alternate,_,Qs);_.memoizedProps=_.pendingProps,N===null?rr(_):ai=N}function ba(_){var N=_,P=N.alternate;switch(N.tag){case 15:case 0:N=jg(P,N,N.pendingProps,N.type,void 0,di);break;case 11:N=jg(P,N,N.pendingProps,N.type.render,N.ref,di);break;case 5:Hs(N);default:ru(P,N),N=ai=Lr(N,Qs),N=nu(P,N,Qs)}_.memoizedProps=_.pendingProps,N===null?rr(_):ai=N}function to(_,N,P,$){Ms=Rr=null,Hs(N),Qr=null,Fn=0;var oe=N.return;try{if(Ah(_,oe,N,P,di)){$i=1,ua(_,Ze(P,_.current)),ai=null;return}}catch(re){if(oe!==null)throw ai=oe,re;$i=1,ua(_,Ze(P,_.current)),ai=null;return}N.flags&32768?(yi||$===1?_=!0:Vs||(di&536870912)!==0?_=!1:(Ns=_=!0,($===2||$===3||$===6)&&($=Cs.current,$!==null&&$.tag===13&&($.flags|=16384))),eg(N,_)):rr(N)}function rr(_){var N=_;do{if((N.flags&32768)!==0){eg(N,Ns);return}_=N.return;var P=ou(N.alternate,N,Qs);if(P!==null){ai=P;return}if(N=N.sibling,N!==null){ai=N;return}ai=N=_}while(N!==null);$i===0&&($i=5)}function eg(_,N){do{var P=bh(_.alternate,_);if(P!==null){P.flags&=32767,ai=P;return}if(P=_.return,P!==null&&(P.flags|=32768,P.subtreeFlags=0,P.deletions=null),!N&&(_=_.sibling,_!==null)){ai=_;return}ai=_=P}while(_!==null);$i=6,ai=null}function tc(_,N,P,$,oe,re,Ae,Me,Pe,ut){var Zt=$t.T,Et=pr();try{$n(2),$t.T=null,gu(_,N,P,$,Et,oe,re,Ae,Me,Pe,ut)}finally{$t.T=Zt,$n(Et)}}function gu(_,N,P,$,oe,re,Ae,Me){do ar();while(wr!==null);if((hi&6)!==0)throw Error(d(327));var Pe=_.finishedWork;if($=_.finishedLanes,Pe===null)return null;if(_.finishedWork=null,_.finishedLanes=0,Pe===_.current)throw Error(d(177));_.callbackNode=null,_.callbackPriority=0,_.cancelPendingCommit=null;var ut=Pe.lanes|Pe.childLanes;if(ut|=Os,le(_,$,ut,re,Ae,Me),_===Vi&&(ai=Vi=null,di=0),(Pe.subtreeFlags&10256)===0&&(Pe.flags&10256)===0||ko||(ko=!0,Xc=ut,Nl=P,uu(wa,function(){return ar(),null})),P=(Pe.flags&15990)!==0,(Pe.subtreeFlags&15990)!==0||P?(P=$t.T,$t.T=null,re=pr(),$n(2),Ae=hi,hi|=4,Oc(_,Pe),$c(Pe,_),Bh(_.containerInfo),_.current=Pe,pa(_,Pe.alternate,Pe),Yo(),hi=Ae,$n(re),$t.T=P):_.current=Pe,ko?(ko=!1,wr=_,Ja=$):Il(_,ut),ut=_.pendingLanes,ut===0&&(Co=null),Ce(Pe.stateNode),xt(_),N!==null)for(oe=_.onRecoverableError,Pe=0;Pe<N.length;Pe++)ut=N[Pe],oe(ut.value,{componentStack:ut.stack});return(Ja&3)!==0&&ar(),ut=_.pendingLanes,($&4194218)!==0&&(ut&42)!==0?_===Mg?na++:(na=0,Mg=_):na=0,ve(0),null}function Il(_,N){(_.pooledCacheLanes&=N)===0&&(N=_.pooledCache,N!=null&&(_.pooledCache=null,sl(N)))}function ar(){if(wr!==null){var _=wr,N=Xc;Xc=0;var P=Xe(Ja),$=32>P?32:P;P=$t.T;var oe=pr();try{if($n($),$t.T=null,wr===null)var re=!1;else{$=Nl,Nl=null;var Ae=wr,Me=Ja;if(wr=null,Ja=0,(hi&6)!==0)throw Error(d(331));var Pe=hi;if(hi|=4,So(Ae.current),Ss(Ae,Ae.current,Me,$),hi=Pe,ve(0,!1),Cn&&typeof Cn.onPostCommitFiberRoot=="function")try{Cn.onPostCommitFiberRoot(_a,Ae)}catch{}re=!0}return re}finally{$n(oe),$t.T=P,Il(_,N)}}return!1}function ya(_,N,P){N=Ze(P,N),N=da(_.stateNode,N,2),_=mt(_,N,2),_!==null&&(ae(_,2),xt(_))}function Xi(_,N,P){if(_.tag===3)ya(_,_,P);else for(;N!==null;){if(N.tag===3){ya(N,_,P);break}else if(N.tag===1){var $=N.stateNode;if(typeof N.type.getDerivedStateFromError=="function"||typeof $.componentDidCatch=="function"&&(Co===null||!Co.has($))){_=Ze(P,_),P=Wc(2),$=mt(N,P,2),$!==null&&(Dg(P,$,N,_),ae($,2),xt($));break}}N=N.return}}function lr(_,N,P){var $=_.pingCache;if($===null){$=_.pingCache=new Ml;var oe=new Set;$.set(N,oe)}else oe=$.get(N),oe===void 0&&(oe=new Set,$.set(N,oe));oe.has(P)||(ta=!0,oe.add(P),_=fl.bind(null,_,N,P),N.then(_,_))}function fl(_,N,P){var $=_.pingCache;$!==null&&$.delete(N),_.pingedLanes|=_.suspendedLanes&P,_.warmLanes&=~P,Vi===_&&(di&P)===P&&($i===4||$i===3&&(di&62914560)===di&&300>ms()-_g?(hi&2)===0&&or(_,0):ts|=P,pn===di&&(pn=0)),xt(_)}function pl(_,N){N===0&&(N=te()),_=vt(_,N),_!==null&&(ae(_,N),xt(_))}function Al(_){var N=_.memoizedState,P=0;N!==null&&(P=N.retryLane),pl(_,P)}function ic(_,N){var P=0;switch(_.tag){case 13:var $=_.stateNode,oe=_.memoizedState;oe!==null&&(P=oe.retryLane);break;case 19:$=_.stateNode;break;case 22:$=_.stateNode._retryCache;break;default:throw Error(d(314))}$!==null&&$.delete(N),pl(_,P)}function uu(_,N){return ao(_,N)}function hu(_,N,P,$){this.tag=_,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=N,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=$,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ro(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Zo(_,N){var P=_.alternate;return P===null?(P=o(_.tag,N,_.key,_.mode),P.elementType=_.elementType,P.type=_.type,P.stateNode=_.stateNode,P.alternate=_,_.alternate=P):(P.pendingProps=N,P.type=_.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=_.flags&31457280,P.childLanes=_.childLanes,P.lanes=_.lanes,P.child=_.child,P.memoizedProps=_.memoizedProps,P.memoizedState=_.memoizedState,P.updateQueue=_.updateQueue,N=_.dependencies,P.dependencies=N===null?null:{lanes:N.lanes,firstContext:N.firstContext},P.sibling=_.sibling,P.index=_.index,P.ref=_.ref,P.refCleanup=_.refCleanup,P}function Lr(_,N){_.flags&=31457282;var P=_.alternate;return P===null?(_.childLanes=0,_.lanes=N,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=P.childLanes,_.lanes=P.lanes,_.child=P.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=P.memoizedProps,_.memoizedState=P.memoizedState,_.updateQueue=P.updateQueue,_.type=P.type,N=P.dependencies,_.dependencies=N===null?null:{lanes:N.lanes,firstContext:N.firstContext}),_}function Fr(_,N,P,$,oe,re){var Ae=0;if($=_,typeof _=="function")Ro(_)&&(Ae=1);else if(typeof _=="string")Ae=As&&xn?yn(_,P,on.current)?26:fc(_)?27:5:As?yn(_,P,on.current)?26:5:xn&&fc(_)?27:5;else e:switch(_){case ur:return cr(P.children,oe,re,N);case Kr:Ae=8,oe|=24;break;case hr:return _=o(12,P,N,oe|2),_.elementType=hr,_.lanes=re,_;case Mo:return _=o(13,P,N,oe),_.elementType=Mo,_.lanes=re,_;case bl:return _=o(19,P,N,oe),_.elementType=bl,_.lanes=re,_;case Vo:return nc(P,oe,re,N);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case Gh:case dr:Ae=10;break e;case ng:Ae=9;break e;case sc:Ae=11;break e;case va:Ae=14;break e;case No:Ae=16,$=null;break e}Ae=29,P=Error(d(130,_===null?"null":typeof _,"")),$=null}return N=o(Ae,P,N,oe),N.elementType=_,N.type=$,N.lanes=re,N}function cr(_,N,P,$){return _=o(7,_,$,N),_.lanes=P,_}function nc(_,N,P,$){_=o(22,_,$,N),_.elementType=Vo,_.lanes=P;var oe={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var re=oe._current;if(re===null)throw Error(d(456));if((oe._pendingVisibility&2)===0){var Ae=vt(re,2);Ae!==null&&(oe._pendingVisibility|=2,zi(Ae,re,2))}},attach:function(){var re=oe._current;if(re===null)throw Error(d(456));if((oe._pendingVisibility&2)!==0){var Ae=vt(re,2);Ae!==null&&(oe._pendingVisibility&=-3,zi(Ae,re,2))}}};return _.stateNode=oe,_}function ml(_,N,P){return _=o(6,_,null,N),_.lanes=P,_}function gs(_,N,P){return N=o(4,_.children!==null?_.children:[],_.key,N),N.lanes=P,N.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},N}function io(_,N,P,$,oe,re,Ae,Me){this.tag=1,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Xa,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=se(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=se(0),this.hiddenUpdates=se(null),this.identifierPrefix=$,this.onUncaughtError=oe,this.onCaughtError=re,this.onRecoverableError=Ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Me,this.incompleteTransitions=new Map}function wo(_,N,P,$,oe,re,Ae,Me,Pe,ut,Zt,Et){return _=new io(_,N,P,Ae,Me,Pe,ut,Et),N=1,re===!0&&(N|=24),re=o(3,null,null,N),_.current=re,re.stateNode=_,N=er(),N.refCount++,_.pooledCache=N,N.refCount++,re.memoizedState={element:$,isDehydrated:P,cache:N},Oe(re),_}function tg(_){return _?(_=$r,_):$r}function _o(_){var N=_._reactInternals;if(N===void 0)throw typeof _.render=="function"?Error(d(188)):(_=Object.keys(_).join(","),Error(d(268,_)));return _=M(N),_=_!==null?V(_):null,_===null?null:Pr(_.stateNode)}function no(_,N,P,$,oe,re){oe=tg(oe),$.context===null?$.context=oe:$.pendingContext=oe,$=pt(N),$.payload={element:P},re=re===void 0?null:re,re!==null&&($.callback=re),P=mt(_,$,N),P!==null&&(zi(P,_,N),It(P,_,N))}function hn(_,N){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var P=_.retryLane;_.retryLane=P!==0&&P<N?P:N}}function Ga(_,N){hn(_,N),(_=_.alternate)&&hn(_,N)}var ui={},yh=requireReact(),ps=requireScheduler(),tn=Object.assign,ig=Symbol.for("react.element"),gr=Symbol.for("react.transitional.element"),so=Symbol.for("react.portal"),ur=Symbol.for("react.fragment"),Kr=Symbol.for("react.strict_mode"),hr=Symbol.for("react.profiler"),Gh=Symbol.for("react.provider"),ng=Symbol.for("react.consumer"),dr=Symbol.for("react.context"),sc=Symbol.for("react.forward_ref"),Mo=Symbol.for("react.suspense"),bl=Symbol.for("react.suspense_list"),va=Symbol.for("react.memo"),No=Symbol.for("react.lazy"),Vo=Symbol.for("react.offscreen"),ri=Symbol.for("react.memo_cache_sentinel"),wi=Symbol.iterator,dn=Symbol.for("react.client.reference"),$t=yh.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Cr,Ir,Ba=!1,fr=Array.isArray,Sa=t.rendererVersion,vh=t.rendererPackageName,qi=t.extraDevToolsConfig,Pr=t.getPublicInstance,sg=t.getRootHostContext,du=t.getChildHostContext,Cu=t.prepareForCommit,Bh=t.resetAfterCommit,og=t.createInstance,yl=t.appendInitialChild,oc=t.finalizeInitialChildren,Nn=t.shouldSetTextContent,nn=t.createTextInstance,rc=t.scheduleTimeout,Gl=t.cancelTimeout,Xa=t.noTimeout,Fs=t.isPrimaryRenderer;t.warnsIfNotActing;var Oi=t.supportsMutation,Ks=t.supportsPersistence,us=t.supportsHydration,ac=t.getInstanceFromNode;t.beforeActiveInstanceBlur,t.afterActiveInstanceBlur;var Iu=t.preparePortalMount;t.prepareScopeUpdate,t.getInstanceFromScope;var $n=t.setCurrentUpdatePriority,pr=t.getCurrentUpdatePriority,fu=t.resolveUpdatePriority;t.resolveEventType,t.resolveEventTimeStamp;var pu=t.shouldAttemptEagerTransition,Au=t.detachDeletedInstance;t.requestPostPaintCallback;var rg=t.maySuspendCommit,ag=t.preloadInstance,Sh=t.startSuspendingCommit,lg=t.suspendInstance,mu=t.waitForCommitToBeReady,Dr=t.NotPendingTransition,Wo=t.HostTransitionContext,bu=t.resetFormInstance;t.bindToConsole;var yu=t.supportsMicrotasks,Gu=t.scheduleMicrotask,xa=t.supportsTestSelectors,vu=t.findFiberRoot,Xh=t.getBoundingRect,Bu=t.getTextContent,oo=t.isHiddenSubtree,Su=t.matchAccessibilityRole,lc=t.setFocusIfFocusable,cc=t.setupIntersectionObserver,Xu=t.appendChild,cg=t.appendChildToContainer,xu=t.commitTextUpdate,Ru=t.commitMount,Zu=t.commitUpdate,wu=t.insertBefore,gg=t.insertInContainerBefore,_u=t.removeChild,Mu=t.removeChildFromContainer,gc=t.resetTextContent,Nu=t.hideInstance,Vu=t.hideTextInstance,xh=t.unhideInstance,ug=t.unhideTextInstance,Wu=t.clearContainer,Eu=t.cloneInstance,uc=t.createContainerChildSet,hg=t.appendChildToContainerChildSet,Yu=t.finalizeContainerChildren,Tu=t.replaceContainerChildren,Ju=t.cloneHiddenInstance,dg=t.cloneHiddenTextInstance,kr=t.isSuspenseInstancePending,vl=t.isSuspenseInstanceFallback,hc=t.getSuspenseInstanceFallbackErrorDetails,Hu=t.registerSuspenseInstanceRetry,zu=t.canHydrateFormStateMarker,ro=t.isFormStateMarkerMatching,Ar=t.getNextHydratableSibling,Eo=t.getFirstHydratableChild,Or=t.getFirstHydratableChildWithinContainer,Cg=t.getFirstHydratableChildWithinSuspenseInstance,Ig=t.canHydrateInstance,Lu=t.canHydrateTextInstance,Fu=t.canHydrateSuspenseInstance,Ur=t.hydrateInstance,dc=t.hydrateTextInstance,Ku=t.hydrateSuspenseInstance,Pu=t.getNextHydratableInstanceAfterSuspenseInstance,Du=t.commitHydratedContainer,Cc=t.commitHydratedSuspenseInstance,ku=t.clearSuspenseBoundary,fg=t.clearSuspenseBoundaryFromContainer,pg=t.shouldDeleteUnhydratedTailInstances;t.diffHydratedPropsForDevWarnings,t.diffHydratedTextForDevWarnings,t.describeHydratableInstanceForDevWarnings;var Ou=t.validateHydratableInstance,Rh=t.validateHydratableTextInstance,As=t.supportsResources,yn=t.isHostHoistableType,Gn=t.getHoistableRoot,Ag=t.getResource,mg=t.acquireResource,bg=t.releaseResource,Uu=t.hydrateHoistable,yg=t.mountHoistable,Ra=t.unmountHoistable,Gg=t.createHoistableInstance,$u=t.prepareToCommitHoistables,ju=t.mayResourceSuspendCommit,vg=t.preloadResource,Bg=t.suspendResource,xn=t.supportsSingletons,Ic=t.resolveSingletonInstance,Qu=t.clearSingleton,Sg=t.acquireSingletonInstance,Xg=t.releaseSingletonInstance,fc=t.isHostSingletonType,pc=[],mr=-1,$r={},sn=Math.clz32?Math.clz32:L,xg=Math.log,Zh=Math.LN2,Bl=128,Za=4194304,ao=ps.unstable_scheduleCallback,Ps=ps.unstable_cancelCallback,br=ps.unstable_shouldYield,Yo=ps.unstable_requestPaint,ms=ps.unstable_now,Ac=ps.unstable_ImmediatePriority,Sl=ps.unstable_UserBlockingPriority,wa=ps.unstable_NormalPriority,jr=ps.unstable_IdlePriority,Jn=ps.log,mc=ps.unstable_setDisableYieldValue,_a=null,Cn=null,jn=typeof Object.is=="function"?Object.is:Se,bc=new WeakMap,bs=[],ys=0,yr=null,Ma=0,hs=[],Hn=0,Ds=null,lo=1,co="",on=H(null),Rs=H(null),To=H(null),Xl=H(null),rn=null,Mi=null,yi=!1,Zs=null,ks=!1,xl=Error(d(519)),ds=[],Jo=0,Os=0,Ki=null,Gr=null,yc=!1,an=!1,Gc=!1,Na=0,Va=null,vc=0,Pi=0,Rn=null,zn=!1,Bc=!1,qu=Object.prototype.hasOwnProperty,Rl=Error(d(460)),Zl=Error(d(474)),Qn={then:function(){}},Ln=null,Qr=null,Fn=0,vr=Ri(!0),go=Ri(!1),Us=H(null),$s=H(0),Cs=H(null),ws=null,Li=H(0),Ho=0,ei=null,vi=null,Ui=null,zo=!1,qr=!1,Br=!1,Sr=0,Wa=0,Lo=null,eh=0,Rg=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},ln={readContext:_n,use:ke,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt};ln.useCacheRefresh=Qt,ln.useMemoCache=Qt,ln.useHostTransitionStatus=Qt,ln.useFormState=Qt,ln.useActionState=Qt,ln.useOptimistic=Qt;var Fo={readContext:_n,use:ke,useCallback:function(_,N){return fe().memoizedState=[_,N===void 0?null:N],_},useContext:_n,useEffect:_c,useImperativeHandle:function(_,N,P){P=P!=null?P.concat([_]):null,Yl(4194308,4,Oa.bind(null,N,_),P)},useLayoutEffect:function(_,N){return Yl(4194308,4,_,N)},useInsertionEffect:function(_,N){Yl(4,2,_,N)},useMemo:function(_,N){var P=fe();N=N===void 0?null:N;var $=_();if(Br){Re(!0);try{_()}finally{Re(!1)}}return P.memoizedState=[$,N],$},useReducer:function(_,N,P){var $=fe();if(P!==void 0){var oe=P(N);if(Br){Re(!0);try{P(N)}finally{Re(!1)}}}else oe=N;return $.memoizedState=$.baseState=oe,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:oe},$.queue=_,_=_.dispatch=zl.bind(null,ei,_),[$.memoizedState,_]},useRef:function(_){var N=fe();return _={current:_},N.memoizedState=_},useState:function(_){_=mi(_);var N=_.queue,P=Vc.bind(null,ei,N);return N.dispatch=P,[_.memoizedState,P]},useDebugValue:Ua,useDeferredValue:function(_,N){var P=fe();return Jl(P,_,N)},useTransition:function(){var _=mi(!1);return _=Mc.bind(null,ei,_.queue,!0,!1),fe().memoizedState=_,[!1,_]},useSyncExternalStore:function(_,N,P){var $=ei,oe=fe();if(yi){if(P===void 0)throw Error(d(407));P=P()}else{if(P=N(),Vi===null)throw Error(d(349));(di&60)!==0||Ut($,N,P)}oe.memoizedState=P;var re={value:P,getSnapshot:N};return oe.queue=re,_c(Ci.bind(null,$,re,_),[_]),$.flags|=2048,zs(9,Ft.bind(null,$,re,P,N),{destroy:void 0},null),P},useId:function(){var _=fe(),N=Vi.identifierPrefix;if(yi){var P=co,$=lo;P=($&~(1<<32-sn($)-1)).toString(32)+P,N=":"+N+"R"+P,P=Sr++,0<P&&(N+="H"+P.toString(32)),N+=":"}else P=eh++,N=":"+N+"r"+P.toString(32)+":";return _.memoizedState=N},useCacheRefresh:function(){return fe().memoizedState=Nc.bind(null,ei)}};Fo.useMemoCache=Le,Fo.useHostTransitionStatus=$a,Fo.useFormState=Zi,Fo.useActionState=Zi,Fo.useOptimistic=function(_){var N=fe();N.memoizedState=N.baseState=_;var P={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return N.queue=P,N=la.bind(null,ei,!0,P),P.dispatch=N,[_,N]};var qn={readContext:_n,use:ke,useCallback:Nr,useContext:_n,useEffect:ka,useImperativeHandle:Tl,useInsertionEffect:Fg,useLayoutEffect:Kg,useMemo:Vr,useReducer:Nt,useRef:kn,useState:function(){return Nt(At)},useDebugValue:Ua,useDeferredValue:function(_,N){var P=We();return Hl(P,vi.memoizedState,_,N)},useTransition:function(){var _=Nt(At)[0],N=We().memoizedState;return[typeof _=="boolean"?_:je(_),N]},useSyncExternalStore:Ot,useId:aa};qn.useCacheRefresh=po,qn.useMemoCache=Le,qn.useHostTransitionStatus=$a,qn.useFormState=En,qn.useActionState=En,qn.useOptimistic=function(_,N){var P=We();return qt(P,vi,_,N)};var Xr={readContext:_n,use:ke,useCallback:Nr,useContext:_n,useEffect:ka,useImperativeHandle:Tl,useInsertionEffect:Fg,useLayoutEffect:Kg,useMemo:Vr,useReducer:Vt,useRef:kn,useState:function(){return Vt(At)},useDebugValue:Ua,useDeferredValue:function(_,N){var P=We();return vi===null?Jl(P,_,N):Hl(P,vi.memoizedState,_,N)},useTransition:function(){var _=Vt(At)[0],N=We().memoizedState;return[typeof _=="boolean"?_:je(_),N]},useSyncExternalStore:Ot,useId:aa};Xr.useCacheRefresh=po,Xr.useMemoCache=Le,Xr.useHostTransitionStatus=$a,Xr.useFormState=Sn,Xr.useActionState=Sn,Xr.useOptimistic=function(_,N){var P=We();return vi!==null?qt(P,vi,_,N):(P.baseState=_,[_,P.queue.dispatch])};var Ea={isMounted:function(_){return(_=_._reactInternals)?S(_)===_:!1},enqueueSetState:function(_,N,P){_=_._reactInternals;var $=Yn(),oe=pt($);oe.payload=N,P!=null&&(oe.callback=P),N=mt(_,oe,$),N!==null&&(zi(N,_,$),It(N,_,$))},enqueueReplaceState:function(_,N,P){_=_._reactInternals;var $=Yn(),oe=pt($);oe.tag=1,oe.payload=N,P!=null&&(oe.callback=P),N=mt(_,oe,$),N!==null&&(zi(N,_,$),It(N,_,$))},enqueueForceUpdate:function(_,N){_=_._reactInternals;var P=Yn(),$=pt(P);$.tag=2,N!=null&&($.callback=N),N=mt(_,$,P),N!==null&&(zi(N,_,P),It(N,_,P))}},xr=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var N=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(N))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)},Zg=Error(d(461)),In=!1,wl={dehydrated:null,treeContext:null,retryLane:0},_s=H(null),Rr=null,Ms=null,_l=typeof AbortController<"u"?AbortController:function(){var _=[],N=this.signal={aborted:!1,addEventListener:function(P,$){_.push($)}};this.abort=function(){N.aborted=!0,_.forEach(function(P){return P()})}},ji=ps.unstable_scheduleCallback,wh=ps.unstable_NormalPriority,en={$$typeof:dr,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},wg=$t.S;$t.S=function(_,N){typeof N=="object"&&N!==null&&typeof N.then=="function"&&Rt(_,N),wg!==null&&wg(_,N)};var ea=H(null),Ko=!1,ti=!1,Ni=!1,li=typeof WeakSet=="function"?WeakSet:Set,Dt=null,Ei=!1,Bi=null,cn=!1,Kn=null,Zr=8192,Po={getCacheForType:function(_){var N=_n(en),P=N.data.get(_);return P===void 0&&(P=_(),N.data.set(_,P)),P}},Di=0,js=1,uo=2,Ya=3,es=4;if(typeof Symbol=="function"&&Symbol.for){var ho=Symbol.for;Di=ho("selector.component"),js=ho("selector.has_pseudo_class"),uo=ho("selector.role"),Ya=ho("selector.test_id"),es=ho("selector.text")}var Ml=typeof WeakMap=="function"?WeakMap:Map,hi=0,Vi=null,ai=null,di=0,_i=0,fn=null,Ns=!1,Vs=!1,ta=!1,Qs=0,$i=0,Ws=0,Do=0,ts=0,Gs=0,pn=0,Ta=null,Es=null,Sc=!1,_g=0,vs=1/0,ia=null,Co=null,ko=!1,wr=null,Ja=0,Xc=0,Nl=null,na=0,Mg=null;return ui.attemptContinuousHydration=function(_){if(_.tag===13){var N=vt(_,67108864);N!==null&&zi(N,_,67108864),Ga(_,67108864)}},ui.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var N=Yn(),P=vt(_,N);P!==null&&zi(P,_,N),Ga(_,N)}},ui.attemptSynchronousHydration=function(_){switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var N=K(_.pendingLanes);if(N!==0){for(_.pendingLanes|=2,_.entangledLanes|=2;N;){var P=1<<31-sn(N);_.entanglements[1]|=P,N&=~P}xt(_),(hi&6)===0&&(vs=ms()+500,ve(0))}}break;case 13:N=vt(_,2),N!==null&&zi(N,_,2),qc(),Ga(_,2)}},ui.batchedUpdates=function(_,N){return _(N)},ui.createComponentSelector=function(_){return{$$typeof:Di,value:_}},ui.createContainer=function(_,N,P,$,oe,re,Ae,Me,Pe,ut){return wo(_,N,!1,null,P,$,re,Ae,Me,Pe,ut,null)},ui.createHasPseudoClassSelector=function(_){return{$$typeof:js,value:_}},ui.createHydrationContainer=function(_,N,P,$,oe,re,Ae,Me,Pe,ut,Zt,Et,Xt){return _=wo(P,$,!0,_,oe,re,Me,Pe,ut,Zt,Et,Xt),_.context=tg(null),P=_.current,$=Yn(),oe=pt($),oe.callback=N??null,mt(P,oe,$),_.current.lanes=$,ae(_,$),xt(_),_},ui.createPortal=function(_,N,P){var $=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:so,key:$==null?null:""+$,children:_,containerInfo:N,implementation:P}},ui.createRoleSelector=function(_){return{$$typeof:uo,value:_}},ui.createTestNameSelector=function(_){return{$$typeof:Ya,value:_}},ui.createTextSelector=function(_){return{$$typeof:es,value:_}},ui.defaultOnCaughtError=function(_){console.error(_)},ui.defaultOnRecoverableError=function(_){xr(_)},ui.defaultOnUncaughtError=function(_){xr(_)},ui.deferredUpdates=function(_){var N=$t.T,P=pr();try{return $n(32),$t.T=null,_()}finally{$n(P),$t.T=N}},ui.discreteUpdates=function(_,N,P,$,oe){var re=$t.T,Ae=pr();try{return $n(2),$t.T=null,_(N,P,$,oe)}finally{$n(Ae),$t.T=re,hi===0&&(vs=ms()+500)}},ui.findAllNodes=sr,ui.findBoundingRects=function(_,N){if(!xa)throw Error(d(363));N=sr(_,N),_=[];for(var P=0;P<N.length;P++)_.push(Xh(N[P]));for(N=_.length-1;0<N;N--){P=_[N];for(var $=P.x,oe=$+P.width,re=P.y,Ae=re+P.height,Me=N-1;0<=Me;Me--)if(N!==Me){var Pe=_[Me],ut=Pe.x,Zt=ut+Pe.width,Et=Pe.y,Xt=Et+Pe.height;if($>=ut&&re>=Et&&oe<=Zt&&Ae<=Xt){_.splice(N,1);break}else if($!==ut||P.width!==Pe.width||Xt<re||Et>Ae){if(!(re!==Et||P.height!==Pe.height||Zt<$||ut>oe)){ut>$&&(Pe.width+=ut-$,Pe.x=$),Zt<oe&&(Pe.width=oe-ut),_.splice(N,1);break}}else{Et>re&&(Pe.height+=Et-re,Pe.y=re),Xt<Ae&&(Pe.height=Ae-Et),_.splice(N,1);break}}}return _},ui.findHostInstance=_o,ui.findHostInstanceWithNoPortals=function(_){return _=M(_),_=_!==null?T(_):null,_===null?null:Pr(_.stateNode)},ui.findHostInstanceWithWarning=function(_){return _o(_)},ui.flushPassiveEffects=ar,ui.flushSyncFromReconciler=function(_){var N=hi;hi|=1;var P=$t.T,$=pr();try{if($n(2),$t.T=null,_)return _()}finally{$n($),$t.T=P,hi=N,(hi&6)===0&&ve(0)}},ui.flushSyncWork=qc,ui.focusWithin=function(_,N){if(!xa)throw Error(d(363));for(_=nr(_),N=Hr(_,N),N=Array.from(N),_=0;_<N.length;){var P=N[_++],$=P.tag;if(!oo(P)){if(($===5||$===26||$===27)&&lc(P.stateNode))return!0;for(P=P.child;P!==null;)N.push(P),P=P.sibling}}return!1},ui.getFindAllNodesFailureDescription=function(_,N){if(!xa)throw Error(d(363));var P=0,$=[];_=[nr(_),0];for(var oe=0;oe<_.length;){var re=_[oe++],Ae=re.tag,Me=_[oe++],Pe=N[Me];if((Ae!==5&&Ae!==26&&Ae!==27||!oo(re))&&(ec(re,Pe)&&($.push(cs(Pe)),Me++,Me>P&&(P=Me)),Me<N.length))for(re=re.child;re!==null;)_.push(re,Me),re=re.sibling}if(P<N.length){for(_=[];P<N.length;P++)_.push(cs(N[P]));return`findAllNodes was able to match part of the selector:
  `+($.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},ui.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 27:case 5:return Pr(_.child.stateNode);default:return _.child.stateNode}},ui.injectIntoDevTools=function(){var _={bundleType:0,version:Sa,rendererPackageName:vh,currentDispatcherRef:$t,findFiberByHostInstance:ac,reconcilerVersion:"19.0.0"};if(qi!==null&&(_.rendererConfig=qi),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var N=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(N.isDisabled||!N.supportsFiber)_=!0;else{try{_a=N.inject(_),Cn=N}catch{}_=!!N.checkDCE}}return _},ui.isAlreadyRendering=function(){return!1},ui.observeVisibleRects=function(_,N,P,$){if(!xa)throw Error(d(363));_=sr(_,N);var oe=cc(_,P,$).disconnect;return{disconnect:function(){oe()}}},ui.shouldError=function(){return null},ui.shouldSuspend=function(){return!1},ui.startHostTransition=function(_,N,P,$){if(_.tag!==5)throw Error(d(476));var oe=ra(_).queue;Mc(_,oe,N,Dr,P===null?u:function(){var re=ra(_).next.queue;return $o(_,re,{},Yn()),P($)})},ui.updateContainer=function(_,N,P,$){var oe=N.current,re=Yn();return no(oe,re,_,N,P,$),re},ui.updateContainerSync=function(_,N,P,$){return N.tag===0&&ar(),no(N.current,2,_,N,P,$),2},ui},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})}(reactReconciler_production)),reactReconciler_production.exports}var hasRequiredReactReconciler;function requireReactReconciler(){return hasRequiredReactReconciler||(hasRequiredReactReconciler=1,reactReconciler.exports=requireReactReconciler_production()),reactReconciler.exports}var reactReconcilerExports=requireReactReconciler();const Reconciler=getDefaultExportFromCjs(reactReconcilerExports);var schedulerExports=requireScheduler();function i$1(n,t,o){if(!n)return;if(o(n)===!0)return n;let u=t?n.return:n.child;for(;u;){const d=i$1(u,t,o);if(d)return d;u=t?null:u.sibling}}function l(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const a$2=l(reactExports.createContext(null));let m$1=class extends reactExports.Component{render(){return reactExports.createElement(a$2.Provider,{value:this._reactInternals},this.props.children)}};function c$2(){const n=reactExports.useContext(a$2);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=reactExports.useId();return reactExports.useMemo(()=>{for(const o of[n,n==null?void 0:n.alternate]){if(!o)continue;const u=i$1(o,!1,d=>{let C=d.memoizedState;for(;C;){if(C.memoizedState===t)return!0;C=C.next}});if(u)return u}},[n,t])}const p=Symbol.for("react.context"),b$2=n=>n!==null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===p;function h(){const n=c$2(),[t]=reactExports.useState(()=>new Map);t.clear();let o=n;for(;o;){const u=o.type;b$2(u)&&u!==a$2&&!t.has(u)&&t.set(u,reactExports.use(l(u))),o=o.return}return t}function x(){const n=h();return reactExports.useMemo(()=>Array.from(n.keys()).reduce((t,o)=>u=>reactExports.createElement(t,null,reactExports.createElement(o.Provider,{...u,value:n.get(o)})),t=>reactExports.createElement(m$1,{...t})),[n])}function findInitialRoot(n){let t=n.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const isOrthographicCamera=n=>n&&n.isOrthographicCamera,isRef=n=>n&&n.hasOwnProperty("current"),isColorRepresentation=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),useIsomorphicLayoutEffect=((n,t)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?reactExports.useLayoutEffect:reactExports.useEffect;function useMutableCallback(n){const t=reactExports.useRef(n);return useIsomorphicLayoutEffect(()=>void(t.current=n),[n]),t}function useBridge(){const n=c$2(),t=x();return reactExports.useMemo(()=>({children:o})=>{const d=!!i$1(n,!0,C=>C.type===reactExports.StrictMode)?reactExports.StrictMode:reactExports.Fragment;return jsxRuntimeExports.jsx(d,{children:jsxRuntimeExports.jsx(t,{children:o})})},[n,t])}function Block({set:n}){return useIsomorphicLayoutEffect(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}const ErrorBoundary=(n=>(n=class extends reactExports.Component{constructor(...o){super(...o),this.state={error:!1}}componentDidCatch(o){this.props.set(o)}render(){return this.state.error?null:this.props.children}},n.getDerivedStateFromError=()=>({error:!0}),n))();function calculateDpr(n){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],o),n[1]):n}function getRootState(n){var t;return(t=n.__r3f)==null?void 0:t.root.getState()}const is={obj:n=>n===Object(n)&&!is.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,t,{arrays:o="shallow",objects:u="reference",strict:d=!0}={}){if(typeof n!=typeof t||!!n!=!!t)return!1;if(is.str(n)||is.num(n)||is.boo(n))return n===t;const C=is.obj(n);if(C&&u==="reference")return n===t;const I=is.arr(n);if(I&&o==="reference")return n===t;if((I||C)&&n===t)return!0;let f;for(f in n)if(!(f in t))return!1;if(C&&o==="shallow"&&u==="shallow"){for(f in d?t:n)if(!is.equ(n[f],t[f],{strict:d,objects:"reference"}))return!1}else for(f in d?t:n)if(n[f]!==t[f])return!1;if(is.und(f)){if(I&&n.length===0&&t.length===0||C&&Object.keys(n).length===0&&Object.keys(t).length===0)return!0;if(n!==t)return!1}return!0}};function dispose(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const t in n){const o=n[t];(o==null?void 0:o.type)!=="Scene"&&(o==null||o.dispose==null||o.dispose())}}const REACT_INTERNAL_PROPS=["children","key","ref"];function getInstanceProps(n){const t={};for(const o in n)REACT_INTERNAL_PROPS.includes(o)||(t[o]=n[o]);return t}function prepare$1(n,t,o,u){const d=n;let C=d==null?void 0:d.__r3f;return C||(C={root:t,type:o,parent:null,children:[],props:getInstanceProps(u),object:d,eventCount:0,handlers:{},isHidden:!1},d&&(d.__r3f=C)),C}function resolve(n,t){let o=n[t];if(!t.includes("-"))return{root:n,key:t,target:o};o=n;for(const d of t.split("-")){var u;t=d,n=o,o=(u=o)==null?void 0:u[t]}return{root:n,key:t,target:o}}const INDEX_REGEX=/-\d+$/;function attach(n,t){if(is.str(t.props.attach)){if(INDEX_REGEX.test(t.props.attach)){const d=t.props.attach.replace(INDEX_REGEX,""),{root:C,key:I}=resolve(n.object,d);Array.isArray(C[I])||(C[I]=[])}const{root:o,key:u}=resolve(n.object,t.props.attach);t.previousAttach=o[u],o[u]=t.object}else is.fun(t.props.attach)&&(t.previousAttach=t.props.attach(n.object,t.object))}function detach(n,t){if(is.str(t.props.attach)){const{root:o,key:u}=resolve(n.object,t.props.attach),d=t.previousAttach;d===void 0?delete o[u]:o[u]=d}else t.previousAttach==null||t.previousAttach(n.object,t.object);delete t.previousAttach}const RESERVED_PROPS=[...REACT_INTERNAL_PROPS,"args","dispose","attach","object","onUpdate","dispose"],MEMOIZED_PROTOTYPES=new Map;function getMemoizedPrototype(n){let t=MEMOIZED_PROTOTYPES.get(n.constructor);try{t||(t=new n.constructor,MEMOIZED_PROTOTYPES.set(n.constructor,t))}catch{}return t}function diffProps(n,t){const o={};for(const u in t)if(!RESERVED_PROPS.includes(u)&&!is.equ(t[u],n.props[u])){o[u]=t[u];for(const d in t)d.startsWith(`${u}-`)&&(o[d]=t[d])}for(const u in n.props){if(RESERVED_PROPS.includes(u)||t.hasOwnProperty(u))continue;const{root:d,key:C}=resolve(n.object,u);if(d.constructor&&d.constructor.length===0){const I=getMemoizedPrototype(d);is.und(I)||(o[C]=I[C])}else o[C]=0}return o}const colorMaps=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],EVENT_REGEX=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function applyProps(n,t){var o;const u=n.__r3f,d=u&&findInitialRoot(u).getState(),C=u==null?void 0:u.eventCount;for(const f in t){let A=t[f];if(RESERVED_PROPS.includes(f))continue;if(u&&EVENT_REGEX.test(f)){typeof A=="function"?u.handlers[f]=A:delete u.handlers[f],u.eventCount=Object.keys(u.handlers).length;continue}if(A===void 0)continue;let{root:y,key:G,target:S}=resolve(n,f);if(S instanceof Layers&&A instanceof Layers)S.mask=A.mask;else if(S instanceof Color&&isColorRepresentation(A))S.set(A);else if(S!==null&&typeof S=="object"&&typeof S.set=="function"&&typeof S.copy=="function"&&A!=null&&A.constructor&&S.constructor===A.constructor)S.copy(A);else if(S!==null&&typeof S=="object"&&typeof S.set=="function"&&Array.isArray(A))typeof S.fromArray=="function"?S.fromArray(A):S.set(...A);else if(S!==null&&typeof S=="object"&&typeof S.set=="function"&&typeof A=="number")typeof S.setScalar=="function"?S.setScalar(A):S.set(A);else{var I;y[G]=A,d&&!d.linear&&colorMaps.includes(G)&&(I=y[G])!=null&&I.isTexture&&y[G].format===RGBAFormat&&y[G].type===UnsignedByteType&&(y[G].colorSpace=SRGBColorSpace)}}if(u!=null&&u.parent&&d!=null&&d.internal&&(o=u.object)!=null&&o.isObject3D&&C!==u.eventCount){const f=u.object,A=d.internal.interaction.indexOf(f);A>-1&&d.internal.interaction.splice(A,1),u.eventCount&&f.raycast!==null&&d.internal.interaction.push(f)}return u&&u.props.attach===void 0&&(u.object.isBufferGeometry?u.props.attach="geometry":u.object.isMaterial&&(u.props.attach="material")),u&&invalidateInstance(u),n}function invalidateInstance(n){var t;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const o=(t=n.root)==null||t.getState==null?void 0:t.getState();o&&o.internal.frames===0&&o.invalidate()}function updateCamera(n,t){n.manual||(isOrthographicCamera(n)?(n.left=t.width/-2,n.right=t.width/2,n.top=t.height/2,n.bottom=t.height/-2):n.aspect=t.width/t.height,n.updateProjectionMatrix())}const isObject3D=n=>n==null?void 0:n.isObject3D;function makeId(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function releaseInternalPointerCapture(n,t,o,u){const d=o.get(t);d&&(o.delete(t),o.size===0&&(n.delete(u),d.target.releasePointerCapture(u)))}function removeInteractivity(n,t){const{internal:o}=n.getState();o.interaction=o.interaction.filter(u=>u!==t),o.initialHits=o.initialHits.filter(u=>u!==t),o.hovered.forEach((u,d)=>{(u.eventObject===t||u.object===t)&&o.hovered.delete(d)}),o.capturedMap.forEach((u,d)=>{releaseInternalPointerCapture(o.capturedMap,t,u,d)})}function createEvents(n){function t(A){const{internal:y}=n.getState(),G=A.offsetX-y.initialClick[0],S=A.offsetY-y.initialClick[1];return Math.round(Math.sqrt(G*G+S*S))}function o(A){return A.filter(y=>["Move","Over","Enter","Out","Leave"].some(G=>{var S;return(S=y.__r3f)==null?void 0:S.handlers["onPointer"+G]}))}function u(A,y){const G=n.getState(),S=new Set,w=[],M=y?y(G.internal.interaction):G.internal.interaction;for(let J=0;J<M.length;J++){const z=getRootState(M[J]);z&&(z.raycaster.camera=void 0)}G.previousRoot||G.events.compute==null||G.events.compute(A,G);function V(J){const z=getRootState(J);if(!z||!z.events.enabled||z.raycaster.camera===null)return[];if(z.raycaster.camera===void 0){var L;z.events.compute==null||z.events.compute(A,z,(L=z.previousRoot)==null?void 0:L.getState()),z.raycaster.camera===void 0&&(z.raycaster.camera=null)}return z.raycaster.camera?z.raycaster.intersectObject(J,!0):[]}let T=M.flatMap(V).sort((J,z)=>{const L=getRootState(J.object),K=getRootState(z.object);return!L||!K?J.distance-z.distance:K.events.priority-L.events.priority||J.distance-z.distance}).filter(J=>{const z=makeId(J);return S.has(z)?!1:(S.add(z),!0)});G.events.filter&&(T=G.events.filter(T,G));for(const J of T){let z=J.object;for(;z;){var H;(H=z.__r3f)!=null&&H.eventCount&&w.push({...J,eventObject:z}),z=z.parent}}if("pointerId"in A&&G.internal.capturedMap.has(A.pointerId))for(let J of G.internal.capturedMap.get(A.pointerId).values())S.has(makeId(J.intersection))||w.push(J.intersection);return w}function d(A,y,G,S){if(A.length){const w={stopped:!1};for(const M of A){let V=getRootState(M.object);if(V||M.object.traverseAncestors(T=>{const H=getRootState(T);if(H)return V=H,!1}),V){const{raycaster:T,pointer:H,camera:J,internal:z}=V,L=new Vector3(H.x,H.y,0).unproject(J),K=te=>{var se,ae;return(se=(ae=z.capturedMap.get(te))==null?void 0:ae.has(M.eventObject))!=null?se:!1},O=te=>{const se={intersection:M,target:y.target};z.capturedMap.has(te)?z.capturedMap.get(te).set(M.eventObject,se):z.capturedMap.set(te,new Map([[M.eventObject,se]])),y.target.setPointerCapture(te)},Q=te=>{const se=z.capturedMap.get(te);se&&releaseInternalPointerCapture(z.capturedMap,M.eventObject,se,te)};let ee={};for(let te in y){let se=y[te];typeof se!="function"&&(ee[te]=se)}let ie={...M,...ee,pointer:H,intersections:A,stopped:w.stopped,delta:G,unprojectedPoint:L,ray:T.ray,camera:J,stopPropagation(){const te="pointerId"in y&&z.capturedMap.get(y.pointerId);if((!te||te.has(M.eventObject))&&(ie.stopped=w.stopped=!0,z.hovered.size&&Array.from(z.hovered.values()).find(se=>se.eventObject===M.eventObject))){const se=A.slice(0,A.indexOf(M));C([...se,M])}},target:{hasPointerCapture:K,setPointerCapture:O,releasePointerCapture:Q},currentTarget:{hasPointerCapture:K,setPointerCapture:O,releasePointerCapture:Q},nativeEvent:y};if(S(ie),w.stopped===!0)break}}}return A}function C(A){const{internal:y}=n.getState();for(const G of y.hovered.values())if(!A.length||!A.find(S=>S.object===G.object&&S.index===G.index&&S.instanceId===G.instanceId)){const w=G.eventObject.__r3f;if(y.hovered.delete(makeId(G)),w!=null&&w.eventCount){const M=w.handlers,V={...G,intersections:A};M.onPointerOut==null||M.onPointerOut(V),M.onPointerLeave==null||M.onPointerLeave(V)}}}function I(A,y){for(let G=0;G<y.length;G++){const S=y[G].__r3f;S==null||S.handlers.onPointerMissed==null||S.handlers.onPointerMissed(A)}}function f(A){switch(A){case"onPointerLeave":case"onPointerCancel":return()=>C([]);case"onLostPointerCapture":return y=>{const{internal:G}=n.getState();"pointerId"in y&&G.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{G.capturedMap.has(y.pointerId)&&(G.capturedMap.delete(y.pointerId),C([]))})}}return function(G){const{onPointerMissed:S,internal:w}=n.getState();w.lastEvent.current=G;const M=A==="onPointerMove",V=A==="onClick"||A==="onContextMenu"||A==="onDoubleClick",H=u(G,M?o:void 0),J=V?t(G):0;A==="onPointerDown"&&(w.initialClick=[G.offsetX,G.offsetY],w.initialHits=H.map(L=>L.eventObject)),V&&!H.length&&J<=2&&(I(G,w.interaction),S&&S(G)),M&&C(H);function z(L){const K=L.eventObject,O=K.__r3f;if(!(O!=null&&O.eventCount))return;const Q=O.handlers;if(M){if(Q.onPointerOver||Q.onPointerEnter||Q.onPointerOut||Q.onPointerLeave){const ee=makeId(L),ie=w.hovered.get(ee);ie?ie.stopped&&L.stopPropagation():(w.hovered.set(ee,L),Q.onPointerOver==null||Q.onPointerOver(L),Q.onPointerEnter==null||Q.onPointerEnter(L))}Q.onPointerMove==null||Q.onPointerMove(L)}else{const ee=Q[A];ee?(!V||w.initialHits.includes(K))&&(I(G,w.interaction.filter(ie=>!w.initialHits.includes(ie))),ee(L)):V&&w.initialHits.includes(K)&&I(G,w.interaction.filter(ie=>!w.initialHits.includes(ie)))}}d(H,G,J,z)}}return{handlePointer:f}}const isRenderer=n=>!!(n!=null&&n.render),context=reactExports.createContext(null),createStore=(n,t)=>{const o=createWithEqualityFn((f,A)=>{const y=new Vector3,G=new Vector3,S=new Vector3;function w(J=A().camera,z=G,L=A().size){const{width:K,height:O,top:Q,left:ee}=L,ie=K/O;z.isVector3?S.copy(z):S.set(...z);const te=J.getWorldPosition(y).distanceTo(S);if(isOrthographicCamera(J))return{width:K/J.zoom,height:O/J.zoom,top:Q,left:ee,factor:1,distance:te,aspect:ie};{const se=J.fov*Math.PI/180,ae=2*Math.tan(se/2)*te,le=ae*(K/O);return{width:le,height:ae,top:Q,left:ee,factor:K/le,distance:te,aspect:ie}}}let M;const V=J=>f(z=>({performance:{...z.performance,current:J}})),T=new Vector2;return{set:f,get:A,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(J=1)=>n(A(),J),advance:(J,z)=>t(J,z,A()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Clock,pointer:T,mouse:T,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const J=A();M&&clearTimeout(M),J.performance.current!==J.performance.min&&V(J.performance.min),M=setTimeout(()=>V(A().performance.max),J.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:w},setEvents:J=>f(z=>({...z,events:{...z.events,...J}})),setSize:(J,z,L=0,K=0)=>{const O=A().camera,Q={width:J,height:z,top:L,left:K};f(ee=>({size:Q,viewport:{...ee.viewport,...w(O,G,Q)}}))},setDpr:J=>f(z=>{const L=calculateDpr(J);return{viewport:{...z.viewport,dpr:L,initialDpr:z.viewport.initialDpr||L}}}),setFrameloop:(J="always")=>{const z=A().clock;z.stop(),z.elapsedTime=0,J!=="never"&&(z.start(),z.elapsedTime=0),f(()=>({frameloop:J}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:reactExports.createRef(),active:!1,frames:0,priority:0,subscribe:(J,z,L)=>{const K=A().internal;return K.priority=K.priority+(z>0?1:0),K.subscribers.push({ref:J,priority:z,store:L}),K.subscribers=K.subscribers.sort((O,Q)=>O.priority-Q.priority),()=>{const O=A().internal;O!=null&&O.subscribers&&(O.priority=O.priority-(z>0?1:0),O.subscribers=O.subscribers.filter(Q=>Q.ref!==J))}}}}}),u=o.getState();let d=u.size,C=u.viewport.dpr,I=u.camera;return o.subscribe(()=>{const{camera:f,size:A,viewport:y,gl:G,set:S}=o.getState();if(A.width!==d.width||A.height!==d.height||y.dpr!==C){d=A,C=y.dpr,updateCamera(f,A),y.dpr>0&&G.setPixelRatio(y.dpr);const w=typeof HTMLCanvasElement<"u"&&G.domElement instanceof HTMLCanvasElement;G.setSize(A.width,A.height,w)}f!==I&&(I=f,S(w=>({viewport:{...w.viewport,...w.viewport.getCurrentViewport(f)}})))}),o.subscribe(f=>n(f)),o};function useStore(){const n=reactExports.useContext(context);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function useThree(n=o=>o,t){return useStore()(n,t)}function useFrame(n,t=0){const o=useStore(),u=o.getState().internal.subscribe,d=useMutableCallback(n);return useIsomorphicLayoutEffect(()=>u(d,t,o),[t,u,o]),null}function createReconciler(n){const t=Reconciler(n);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:reactExports.version}),t}const NoEventPriority=0,catalogue={},PREFIX_REGEX=/^three(?=[A-Z])/,toPascalCase=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let i=0;const isConstructor=n=>typeof n=="function";function extend(n){if(isConstructor(n)){const t=`${i++}`;return catalogue[t]=n,t}else Object.assign(catalogue,n)}function validateInstance(n,t){const o=toPascalCase(n),u=catalogue[o];if(n!=="primitive"&&!u)throw new Error(`R3F: ${o} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function createInstance(n,t,o){var u;return n=toPascalCase(n)in catalogue?n:n.replace(PREFIX_REGEX,""),validateInstance(n,t),n==="primitive"&&(u=t.object)!=null&&u.__r3f&&delete t.object.__r3f,prepare$1(t.object,o,n,t)}function hideInstance(n){if(!n.isHidden){var t;n.props.attach&&(t=n.parent)!=null&&t.object?detach(n.parent,n):isObject3D(n.object)&&(n.object.visible=!1),n.isHidden=!0,invalidateInstance(n)}}function unhideInstance(n){if(n.isHidden){var t;n.props.attach&&(t=n.parent)!=null&&t.object?attach(n.parent,n):isObject3D(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,invalidateInstance(n)}}function handleContainerEffects(n,t,o){const u=t.root.getState();if(!(!n.parent&&n.object!==u.scene)){if(!t.object){var d,C;const I=catalogue[toPascalCase(t.type)];t.object=(d=t.props.object)!=null?d:new I(...(C=t.props.args)!=null?C:[]),t.object.__r3f=t}if(applyProps(t.object,t.props),t.props.attach)attach(n,t);else if(isObject3D(t.object)&&isObject3D(n.object)){const I=n.object.children.indexOf(o==null?void 0:o.object);if(o&&I!==-1){const f=n.object.children.indexOf(t.object);if(f!==-1){n.object.children.splice(f,1);const A=f<I?I-1:I;n.object.children.splice(A,0,t.object)}else t.object.parent=n.object,n.object.children.splice(I,0,t.object),t.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:t.object})}else n.object.add(t.object)}for(const I of t.children)handleContainerEffects(t,I);invalidateInstance(t)}}function appendChild(n,t){t&&(t.parent=n,n.children.push(t),handleContainerEffects(n,t))}function insertBefore(n,t,o){if(!t||!o)return;t.parent=n;const u=n.children.indexOf(o);u!==-1?n.children.splice(u,0,t):n.children.push(t),handleContainerEffects(n,t,o)}function disposeOnIdle(n){if(typeof n.dispose=="function"){const t=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():schedulerExports.unstable_scheduleCallback(schedulerExports.unstable_IdlePriority,t)}}function removeChild(n,t,o){if(!t)return;t.parent=null;const u=n.children.indexOf(t);u!==-1&&n.children.splice(u,1),t.props.attach?detach(n,t):isObject3D(t.object)&&isObject3D(n.object)&&(n.object.remove(t.object),removeInteractivity(findInitialRoot(t),t.object));const d=t.props.dispose!==null&&o!==!1;for(let C=t.children.length-1;C>=0;C--){const I=t.children[C];removeChild(t,I,d)}t.children.length=0,delete t.object.__r3f,d&&t.type!=="primitive"&&t.object.type!=="Scene"&&disposeOnIdle(t.object),o===void 0&&invalidateInstance(t)}function setFiberRef(n,t){for(const o of[n,n.alternate])if(o!==null)if(typeof o.ref=="function"){o.refCleanup==null||o.refCleanup();const u=o.ref(t);typeof u=="function"&&(o.refCleanup=u)}else o.ref&&(o.ref.current=t)}const reconstructed=[];function swapInstances(){for(const[o]of reconstructed){const u=o.parent;if(u){o.props.attach?detach(u,o):isObject3D(o.object)&&isObject3D(u.object)&&u.object.remove(o.object);for(const d of o.children)d.props.attach?detach(o,d):isObject3D(d.object)&&isObject3D(o.object)&&o.object.remove(d.object)}o.isHidden&&unhideInstance(o),o.object.__r3f&&delete o.object.__r3f,o.type!=="primitive"&&disposeOnIdle(o.object)}for(const[o,u,d]of reconstructed){o.props=u;const C=o.parent;if(C){var n,t;const I=catalogue[toPascalCase(o.type)];o.object=(n=o.props.object)!=null?n:new I(...(t=o.props.args)!=null?t:[]),o.object.__r3f=o,setFiberRef(d,o.object),applyProps(o.object,o.props),o.props.attach?attach(C,o):isObject3D(o.object)&&isObject3D(C.object)&&C.object.add(o.object);for(const f of o.children)f.props.attach?attach(o,f):isObject3D(f.object)&&isObject3D(o.object)&&o.object.add(f.object);invalidateInstance(o)}}reconstructed.length=0}const handleTextInstance=()=>{},NO_CONTEXT={};let currentUpdatePriority=NoEventPriority;const NoFlags=0,Update=4,reconciler=createReconciler({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance,removeChild,appendChild,appendInitialChild:appendChild,insertBefore,appendChildToContainer(n,t){const o=n.getState().scene.__r3f;!t||!o||appendChild(o,t)},removeChildFromContainer(n,t){const o=n.getState().scene.__r3f;!t||!o||removeChild(o,t)},insertInContainerBefore(n,t,o){const u=n.getState().scene.__r3f;!t||!o||!u||insertBefore(u,t,o)},getRootHostContext:()=>NO_CONTEXT,getChildHostContext:()=>NO_CONTEXT,commitUpdate(n,t,o,u,d){var C,I,f;validateInstance(t,u);let A=!1;if((n.type==="primitive"&&o.object!==u.object||((C=u.args)==null?void 0:C.length)!==((I=o.args)==null?void 0:I.length)||(f=u.args)!=null&&f.some((G,S)=>{var w;return G!==((w=o.args)==null?void 0:w[S])}))&&(A=!0),A)reconstructed.push([n,{...u},d]);else{const G=diffProps(n,u);Object.keys(G).length&&(Object.assign(n.props,G),applyProps(n.object,G))}(d.sibling===null||(d.flags&Update)===NoFlags)&&swapInstances()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n==null?void 0:n.object,prepareForCommit:()=>null,preparePortalMount:n=>prepare$1(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance,unhideInstance,createTextInstance:handleTextInstance,hideTextInstance:handleTextInstance,unhideTextInstance:handleTextInstance,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:reactExports.createContext(null),setCurrentUpdatePriority(n){currentUpdatePriority=n},getCurrentUpdatePriority(){return currentUpdatePriority},resolveUpdatePriority(){var n;if(currentUpdatePriority!==NoEventPriority)return currentUpdatePriority;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return constantsExports.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return constantsExports.ContinuousEventPriority;default:return constantsExports.DefaultEventPriority}},resetFormInstance(){}}),_roots=new Map,shallowLoose={objects:"shallow",strict:!1};function computeInitialSize(n,t){if(!t&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:o,height:u,top:d,left:C}=n.parentElement.getBoundingClientRect();return{width:o,height:u,top:d,left:C}}else if(!t&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function createRoot(n){const t=_roots.get(n),o=t==null?void 0:t.fiber,u=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,C=u||createStore(invalidate,advance),I=o||reconciler.createContainer(C,constantsExports.ConcurrentRoot,null,!1,null,"",d,d,d,null);t||_roots.set(n,{fiber:I,store:C});let f,A,y=!1,G=null;return{async configure(S={}){let w;G=new Promise(Ie=>w=Ie);let{gl:M,size:V,scene:T,events:H,onCreated:J,shadows:z=!1,linear:L=!1,flat:K=!1,legacy:O=!1,orthographic:Q=!1,frameloop:ee="always",dpr:ie=[1,2],performance:te,raycaster:se,camera:ae,onPointerMissed:le}=S,ge=C.getState(),be=ge.gl;if(!ge.gl){const Ie={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},Be=typeof M=="function"?await M(Ie):M;isRenderer(Be)?be=Be:be=new WebGLRenderer({...Ie,...M}),ge.set({gl:be})}let Xe=ge.raycaster;Xe||ge.set({raycaster:Xe=new Raycaster});const{params:Ce,...Re}=se||{};if(is.equ(Re,Xe,shallowLoose)||applyProps(Xe,{...Re}),is.equ(Ce,Xe.params,shallowLoose)||applyProps(Xe,{params:{...Xe.params,...Ce}}),!ge.camera||ge.camera===A&&!is.equ(A,ae,shallowLoose)){A=ae;const Ie=ae==null?void 0:ae.isCamera,Be=Ie?ae:Q?new OrthographicCamera(0,0,0,0,.1,1e3):new PerspectiveCamera(75,0,.1,1e3);Ie||(Be.position.z=5,ae&&(applyProps(Be,ae),Be.manual||("aspect"in ae||"left"in ae||"right"in ae||"bottom"in ae||"top"in ae)&&(Be.manual=!0,Be.updateProjectionMatrix())),!ge.camera&&!(ae!=null&&ae.rotation)&&Be.lookAt(0,0,0)),ge.set({camera:Be}),Xe.camera=Be}if(!ge.scene){let Ie;T!=null&&T.isScene?(Ie=T,prepare$1(Ie,C,"",{})):(Ie=new Scene,prepare$1(Ie,C,"",{}),T&&applyProps(Ie,T)),ge.set({scene:Ie})}H&&!ge.events.handlers&&ge.set({events:H(C)});const Se=computeInitialSize(n,V);if(is.equ(Se,ge.size,shallowLoose)||ge.setSize(Se.width,Se.height,Se.top,Se.left),ie&&ge.viewport.dpr!==calculateDpr(ie)&&ge.setDpr(ie),ge.frameloop!==ee&&ge.setFrameloop(ee),ge.onPointerMissed||ge.set({onPointerMissed:le}),te&&!is.equ(te,ge.performance,shallowLoose)&&ge.set(Ie=>({performance:{...Ie.performance,...te}})),!ge.xr){var Ze;const Ie=(me,xe)=>{const Je=C.getState();Je.frameloop!=="never"&&advance(me,!0,Je,xe)},Be=()=>{const me=C.getState();me.gl.xr.enabled=me.gl.xr.isPresenting,me.gl.xr.setAnimationLoop(me.gl.xr.isPresenting?Ie:null),me.gl.xr.isPresenting||invalidate(me)},ue={connect(){const me=C.getState().gl;me.xr.addEventListener("sessionstart",Be),me.xr.addEventListener("sessionend",Be)},disconnect(){const me=C.getState().gl;me.xr.removeEventListener("sessionstart",Be),me.xr.removeEventListener("sessionend",Be)}};typeof((Ze=be.xr)==null?void 0:Ze.addEventListener)=="function"&&ue.connect(),ge.set({xr:ue})}if(be.shadowMap){const Ie=be.shadowMap.enabled,Be=be.shadowMap.type;if(be.shadowMap.enabled=!!z,is.boo(z))be.shadowMap.type=PCFSoftShadowMap;else if(is.str(z)){var he;const ue={basic:BasicShadowMap,percentage:PCFShadowMap,soft:PCFSoftShadowMap,variance:VSMShadowMap};be.shadowMap.type=(he=ue[z])!=null?he:PCFSoftShadowMap}else is.obj(z)&&Object.assign(be.shadowMap,z);(Ie!==be.shadowMap.enabled||Be!==be.shadowMap.type)&&(be.shadowMap.needsUpdate=!0)}return ColorManagement.enabled=!O,y||(be.outputColorSpace=L?LinearSRGBColorSpace:SRGBColorSpace,be.toneMapping=K?NoToneMapping:ACESFilmicToneMapping),ge.legacy!==O&&ge.set(()=>({legacy:O})),ge.linear!==L&&ge.set(()=>({linear:L})),ge.flat!==K&&ge.set(()=>({flat:K})),M&&!is.fun(M)&&!isRenderer(M)&&!is.equ(M,be,shallowLoose)&&applyProps(be,M),f=J,y=!0,w(),this},render(S){return!y&&!G&&this.configure(),G.then(()=>{reconciler.updateContainer(jsxRuntimeExports.jsx(Provider,{store:C,children:S,onCreated:f,rootElement:n}),I,null,()=>{})}),C},unmount(){unmountComponentAtNode(n)}}}function Provider({store:n,children:t,onCreated:o,rootElement:u}){return useIsomorphicLayoutEffect(()=>{const d=n.getState();d.set(C=>({internal:{...C.internal,active:!0}})),o&&o(d),n.getState().events.connected||d.events.connect==null||d.events.connect(u)},[]),jsxRuntimeExports.jsx(context.Provider,{value:n,children:t})}function unmountComponentAtNode(n,t){const o=_roots.get(n),u=o==null?void 0:o.fiber;if(u){const d=o==null?void 0:o.store.getState();d&&(d.internal.active=!1),reconciler.updateContainer(null,u,null,()=>{d&&setTimeout(()=>{try{var C,I,f,A;d.events.disconnect==null||d.events.disconnect(),(C=d.gl)==null||(I=C.renderLists)==null||I.dispose==null||I.dispose(),(f=d.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(A=d.gl)!=null&&A.xr&&d.xr.disconnect(),dispose(d.scene),_roots.delete(n)}catch{}},500)})}}const globalEffects=new Set,globalAfterEffects=new Set,globalTailEffects=new Set;function run(n,t){if(n.size)for(const{callback:o}of n.values())o(t)}function flushGlobalEffects(n,t){switch(n){case"before":return run(globalEffects,t);case"after":return run(globalAfterEffects,t);case"tail":return run(globalTailEffects,t)}}let subscribers,subscription;function update(n,t,o){let u=t.clock.getDelta();t.frameloop==="never"&&typeof n=="number"&&(u=n-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=n),subscribers=t.internal.subscribers;for(let d=0;d<subscribers.length;d++)subscription=subscribers[d],subscription.ref.current(subscription.store.getState(),u,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let running=!1,useFrameInProgress=!1,repeat,frame,state;function loop(n){frame=requestAnimationFrame(loop),running=!0,repeat=0,flushGlobalEffects("before",n),useFrameInProgress=!0;for(const o of _roots.values()){var t;state=o.store.getState(),state.internal.active&&(state.frameloop==="always"||state.internal.frames>0)&&!((t=state.gl.xr)!=null&&t.isPresenting)&&(repeat+=update(n,state))}if(useFrameInProgress=!1,flushGlobalEffects("after",n),repeat===0)return flushGlobalEffects("tail",n),running=!1,cancelAnimationFrame(frame)}function invalidate(n,t=1){var o;if(!n)return _roots.forEach(u=>invalidate(u.store.getState(),t));(o=n.gl.xr)!=null&&o.isPresenting||!n.internal.active||n.frameloop==="never"||(t>1?n.internal.frames=Math.min(60,n.internal.frames+t):useFrameInProgress?n.internal.frames=2:n.internal.frames=1,running||(running=!0,requestAnimationFrame(loop)))}function advance(n,t=!0,o,u){if(t&&flushGlobalEffects("before",n),o)update(n,o,u);else for(const d of _roots.values())update(n,d.store.getState());t&&flushGlobalEffects("after",n)}const DOM_EVENTS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function createPointerEvents(n){const{handlePointer:t}=createEvents(n);return{priority:1,enabled:!0,compute(o,u,d){u.pointer.set(o.offsetX/u.size.width*2-1,-(o.offsetY/u.size.height)*2+1),u.raycaster.setFromCamera(u.pointer,u.camera)},connected:void 0,handlers:Object.keys(DOM_EVENTS).reduce((o,u)=>({...o,[u]:t(u)}),{}),update:()=>{var o;const{events:u,internal:d}=n.getState();(o=d.lastEvent)!=null&&o.current&&u.handlers&&u.handlers.onPointerMove(d.lastEvent.current)},connect:o=>{const{set:u,events:d}=n.getState();if(d.disconnect==null||d.disconnect(),u(C=>({events:{...C.events,connected:o}})),d.handlers)for(const C in d.handlers){const I=d.handlers[C],[f,A]=DOM_EVENTS[C];o.addEventListener(f,I,{passive:A})}},disconnect:()=>{const{set:o,events:u}=n.getState();if(u.connected){if(u.handlers)for(const d in u.handlers){const C=u.handlers[d],[I]=DOM_EVENTS[d];u.connected.removeEventListener(I,C)}o(d=>({events:{...d.events,connected:void 0}}))}}}}function g(n,t){let o;return(...u)=>{window.clearTimeout(o),o=window.setTimeout(()=>n(...u),t)}}function j({debounce:n,scroll:t,polyfill:o,offsetSize:u}={debounce:0,scroll:!1,offsetSize:!1}){const d=o||(typeof window>"u"?class{}:window.ResizeObserver);if(!d)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[C,I]=reactExports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),f=reactExports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:C,orientationHandler:null}),A=n?typeof n=="number"?n:n.scroll:null,y=n?typeof n=="number"?n:n.resize:null,G=reactExports.useRef(!1);reactExports.useEffect(()=>(G.current=!0,()=>void(G.current=!1)));const[S,w,M]=reactExports.useMemo(()=>{const J=()=>{if(!f.current.element)return;const{left:z,top:L,width:K,height:O,bottom:Q,right:ee,x:ie,y:te}=f.current.element.getBoundingClientRect(),se={left:z,top:L,width:K,height:O,bottom:Q,right:ee,x:ie,y:te};f.current.element instanceof HTMLElement&&u&&(se.height=f.current.element.offsetHeight,se.width=f.current.element.offsetWidth),Object.freeze(se),G.current&&!D(f.current.lastBounds,se)&&I(f.current.lastBounds=se)};return[J,y?g(J,y):J,A?g(J,A):J]},[I,u,A,y]);function V(){f.current.scrollContainers&&(f.current.scrollContainers.forEach(J=>J.removeEventListener("scroll",M,!0)),f.current.scrollContainers=null),f.current.resizeObserver&&(f.current.resizeObserver.disconnect(),f.current.resizeObserver=null),f.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",f.current.orientationHandler))}function T(){f.current.element&&(f.current.resizeObserver=new d(M),f.current.resizeObserver.observe(f.current.element),t&&f.current.scrollContainers&&f.current.scrollContainers.forEach(J=>J.addEventListener("scroll",M,{capture:!0,passive:!0})),f.current.orientationHandler=()=>{M()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",f.current.orientationHandler))}const H=J=>{!J||J===f.current.element||(V(),f.current.element=J,f.current.scrollContainers=E(J),T())};return X(M,!!t),W(w),reactExports.useEffect(()=>{V(),T()},[t,M,w]),reactExports.useEffect(()=>V,[]),[H,C,S]}function W(n){reactExports.useEffect(()=>{const t=n;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[n])}function X(n,t){reactExports.useEffect(()=>{if(t){const o=n;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[n,t])}function E(n){const t=[];if(!n||n===document.body)return t;const{overflow:o,overflowX:u,overflowY:d}=window.getComputedStyle(n);return[o,u,d].some(C=>C==="auto"||C==="scroll")&&t.push(n),[...t,...E(n.parentElement)]}const k=["x","y","top","bottom","left","right","width","height"],D=(n,t)=>k.every(o=>n[o]===t[o]);function CanvasImpl({ref:n,children:t,fallback:o,resize:u,style:d,gl:C,events:I=createPointerEvents,eventSource:f,eventPrefix:A,shadows:y,linear:G,flat:S,legacy:w,orthographic:M,frameloop:V,dpr:T,performance:H,raycaster:J,camera:z,scene:L,onPointerMissed:K,onCreated:O,...Q}){reactExports.useMemo(()=>extend(THREE),[]);const ee=useBridge(),[ie,te]=j({scroll:!0,debounce:{scroll:50,resize:0},...u}),se=reactExports.useRef(null),ae=reactExports.useRef(null);reactExports.useImperativeHandle(n,()=>se.current);const le=useMutableCallback(K),[ge,be]=reactExports.useState(!1),[Xe,Ce]=reactExports.useState(!1);if(ge)throw ge;if(Xe)throw Xe;const Re=reactExports.useRef(null);useIsomorphicLayoutEffect(()=>{const Ze=se.current;if(te.width>0&&te.height>0&&Ze){Re.current||(Re.current=createRoot(Ze));async function he(){await Re.current.configure({gl:C,scene:L,events:I,shadows:y,linear:G,flat:S,legacy:w,orthographic:M,frameloop:V,dpr:T,performance:H,raycaster:J,camera:z,size:te,onPointerMissed:(...Ie)=>le.current==null?void 0:le.current(...Ie),onCreated:Ie=>{Ie.events.connect==null||Ie.events.connect(f?isRef(f)?f.current:f:ae.current),A&&Ie.setEvents({compute:(Be,ue)=>{const me=Be[A+"X"],xe=Be[A+"Y"];ue.pointer.set(me/ue.size.width*2-1,-(xe/ue.size.height)*2+1),ue.raycaster.setFromCamera(ue.pointer,ue.camera)}}),O==null||O(Ie)}}),Re.current.render(jsxRuntimeExports.jsx(ee,{children:jsxRuntimeExports.jsx(ErrorBoundary,{set:Ce,children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Block,{set:be}),children:t??null})})}))}he()}}),reactExports.useEffect(()=>{const Ze=se.current;if(Ze)return()=>unmountComponentAtNode(Ze)},[]);const Se=f?"none":"auto";return jsxRuntimeExports.jsx("div",{ref:ae,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Se,...d},...Q,children:jsxRuntimeExports.jsx("div",{ref:ie,style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:se,style:{display:"block"},children:o})})})}function Canvas(n){return jsxRuntimeExports.jsx(m$1,{children:jsxRuntimeExports.jsx(CanvasImpl,{...n})})}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(t,o,u){return Function.prototype.apply.call(t,o,u)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(n){console&&console.warn&&console.warn(n)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(n){if(typeof n!="number"||n<0||NumberIsNaN(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");defaultMaxListeners=n}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(n){return n._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:n._maxListeners}EventEmitter$1.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function(t){for(var o=[],u=1;u<arguments.length;u++)o.push(arguments[u]);var d=t==="error",C=this._events;if(C!==void 0)d=d&&C.error===void 0;else if(!d)return!1;if(d){var I;if(o.length>0&&(I=o[0]),I instanceof Error)throw I;var f=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw f.context=I,f}var A=C[t];if(A===void 0)return!1;if(typeof A=="function")ReflectApply(A,this,o);else for(var y=A.length,G=arrayClone(A,y),u=0;u<y;++u)ReflectApply(G[u],this,o);return!0};function _addListener(n,t,o,u){var d,C,I;if(checkListener(o),C=n._events,C===void 0?(C=n._events=Object.create(null),n._eventsCount=0):(C.newListener!==void 0&&(n.emit("newListener",t,o.listener?o.listener:o),C=n._events),I=C[t]),I===void 0)I=C[t]=o,++n._eventsCount;else if(typeof I=="function"?I=C[t]=u?[o,I]:[I,o]:u?I.unshift(o):I.push(o),d=_getMaxListeners(n),d>0&&I.length>d&&!I.warned){I.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=n,f.type=t,f.count=I.length,ProcessEmitWarning(f)}return n}EventEmitter$1.prototype.addListener=function(t,o){return _addListener(this,t,o,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function(t,o){return _addListener(this,t,o,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(n,t,o){var u={fired:!1,wrapFn:void 0,target:n,type:t,listener:o},d=onceWrapper.bind(u);return d.listener=o,u.wrapFn=d,d}EventEmitter$1.prototype.once=function(t,o){return checkListener(o),this.on(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.prependOnceListener=function(t,o){return checkListener(o),this.prependListener(t,_onceWrap(this,t,o)),this};EventEmitter$1.prototype.removeListener=function(t,o){var u,d,C,I,f;if(checkListener(o),d=this._events,d===void 0)return this;if(u=d[t],u===void 0)return this;if(u===o||u.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete d[t],d.removeListener&&this.emit("removeListener",t,u.listener||o));else if(typeof u!="function"){for(C=-1,I=u.length-1;I>=0;I--)if(u[I]===o||u[I].listener===o){f=u[I].listener,C=I;break}if(C<0)return this;C===0?u.shift():spliceOne(u,C),u.length===1&&(d[t]=u[0]),d.removeListener!==void 0&&this.emit("removeListener",t,f||o)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function(t){var o,u,d;if(u=this._events,u===void 0)return this;if(u.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):u[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete u[t]),this;if(arguments.length===0){var C=Object.keys(u),I;for(d=0;d<C.length;++d)I=C[d],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=u[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(d=o.length-1;d>=0;d--)this.removeListener(t,o[d]);return this};function _listeners(n,t,o){var u=n._events;if(u===void 0)return[];var d=u[t];return d===void 0?[]:typeof d=="function"?o?[d.listener||d]:[d]:o?unwrapListeners(d):arrayClone(d,d.length)}EventEmitter$1.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter$1.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter$1.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):listenerCount.call(n,t)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(n){var t=this._events;if(t!==void 0){var o=t[n];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(n,t){for(var o=new Array(t),u=0;u<t;++u)o[u]=n[u];return o}function spliceOne(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function unwrapListeners(n){for(var t=new Array(n.length),o=0;o<t.length;++o)t[o]=n[o].listener||n[o];return t}function once(n,t){return new Promise(function(o,u){function d(I){n.removeListener(t,C),u(I)}function C(){typeof n.removeListener=="function"&&n.removeListener("error",d),o([].slice.call(arguments))}eventTargetAgnosticAddListener(n,t,C,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(n,d,{once:!0})})}function addErrorHandlerIfEventEmitter(n,t,o){typeof n.on=="function"&&eventTargetAgnosticAddListener(n,"error",t,o)}function eventTargetAgnosticAddListener(n,t,o,u){if(typeof n.on=="function")u.once?n.once(t,o):n.on(t,o);else if(typeof n.addEventListener=="function")n.addEventListener(t,function d(C){u.once&&n.removeEventListener(t,d),o(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var EventEmitter$1$1=events.exports;function decodeBase64(n,t){var o=atob(n);if(t){for(var u=new Uint8Array(o.length),d=0,C=o.length;d<C;++d)u[d]=o.charCodeAt(d);return String.fromCharCode.apply(null,new Uint16Array(u.buffer))}return o}function createURL(n,t,o){var u=t===void 0?null:t,d=o===void 0?!1:o,C=decodeBase64(n,d),I=C.indexOf(`
`,10)+1,f=C.substring(I)+(u?"//# sourceMappingURL="+u:""),A=new Blob([f],{type:"application/javascript"});return URL.createObjectURL(A)}function createBase64WorkerFactory(n,t,o){var u;return function(C){return u=u||createURL(n,t,o),new Worker(u,C)}}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class CannonWorkerAPI extends EventEmitter$1$1{constructor(o){let{allowSleep:u=!1,axisIndex:d=0,broadphase:C="Naive",defaultContactMaterial:I={contactEquationStiffness:1e6},frictionGravity:f=null,gravity:A=[0,-9.81,0],iterations:y=5,quatNormalizeFast:G=!1,quatNormalizeSkip:S=0,size:w=1e3,solver:M="GS",tolerance:V=.001}=o;super();qh(this,"messageQueue",[]);qh(this,"worker",null);this.config={allowSleep:u,axisIndex:d,broadphase:C,defaultContactMaterial:I,frictionGravity:f,gravity:A,iterations:y,quatNormalizeFast:G,quatNormalizeSkip:S,size:w,solver:M,tolerance:V},this.buffers={positions:new Float32Array(w*3),quaternions:new Float32Array(w*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(o){this.config.axisIndex=o,this.postMessage({op:"setAxisIndex",props:o})}get broadphase(){return this.config.broadphase}set broadphase(o){this.config.broadphase=o,this.postMessage({op:"setBroadphase",props:o})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(o){this.config.frictionGravity=o,this.postMessage({op:"setFrictionGravity",props:o})}get gravity(){return this.config.gravity}set gravity(o){this.config.gravity=o,this.postMessage({op:"setGravity",props:o})}get iterations(){return this.config.iterations}set iterations(o){this.config.iterations=o,this.postMessage({op:"setIterations",props:o})}get tolerance(){return this.config.tolerance}set tolerance(o){this.config.tolerance=o,this.postMessage({op:"setTolerance",props:o})}addBodies(o){let{props:u,type:d,uuid:C}=o;this.postMessage({op:"addBodies",props:u,type:d,uuid:C})}addConstraint(o){let{props:[u,d,C],type:I,uuid:f}=o;this.postMessage({op:"addConstraint",props:[u,d,C],type:I,uuid:f})}addContactMaterial(o){let{props:u,uuid:d}=o;this.postMessage({op:"addContactMaterial",props:u,uuid:d})}addRay(o){let{props:u,uuid:d}=o;this.postMessage({op:"addRay",props:u,uuid:d})}addRaycastVehicle(o){let{props:[u,d,C,I,f,A],uuid:y}=o;this.postMessage({op:"addRaycastVehicle",props:[u,d,C,I,f,A],uuid:y})}addSpring(o){let{props:[u,d,C],uuid:I}=o;this.postMessage({op:"addSpring",props:[u,d,C],uuid:I})}applyForce(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyForce",props:u,uuid:d})}applyImpulse(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyImpulse",props:u,uuid:d})}applyLocalForce(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyLocalForce",props:u,uuid:d})}applyLocalImpulse(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyLocalImpulse",props:u,uuid:d})}applyRaycastVehicleEngineForce(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyRaycastVehicleEngineForce",props:u,uuid:d})}applyTorque(o){let{props:u,uuid:d}=o;this.postMessage({op:"applyTorque",props:u,uuid:d})}connect(){this.worker=new WorkerFactory,this.worker.onmessage=o=>{if(o.data.op==="frame"){this.buffers.positions=o.data.positions,this.buffers.quaternions=o.data.quaternions,this.emit(o.data.op,o.data);return}this.emit(o.data.type,o.data)};for(const o of this.messageQueue)this.worker.postMessage(o);this.messageQueue.length=0}disableConstraint(o){let{uuid:u}=o;this.postMessage({op:"disableConstraint",uuid:u})}disableConstraintMotor(o){let{uuid:u}=o;this.postMessage({op:"disableConstraintMotor",uuid:u})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(o){let{uuid:u}=o;this.postMessage({op:"enableConstraint",uuid:u})}enableConstraintMotor(o){let{uuid:u}=o;this.postMessage({op:"enableConstraintMotor",uuid:u})}init(){const{allowSleep:o,axisIndex:u,broadphase:d,defaultContactMaterial:C,frictionGravity:I,gravity:f,iterations:A,quatNormalizeFast:y,quatNormalizeSkip:G,solver:S,tolerance:w}=this.config;this.postMessage({op:"init",props:{allowSleep:o,axisIndex:u,broadphase:d,defaultContactMaterial:C,frictionGravity:I,gravity:f,iterations:A,quatNormalizeFast:y,quatNormalizeSkip:G,solver:S,tolerance:w}})}removeBodies(o){let{uuid:u}=o;this.postMessage({op:"removeBodies",uuid:u})}removeConstraint(o){let{uuid:u}=o;this.postMessage({op:"removeConstraint",uuid:u})}removeContactMaterial(o){let{uuid:u}=o;this.postMessage({op:"removeContactMaterial",uuid:u})}removeRay(o){let{uuid:u}=o;this.postMessage({op:"removeRay",uuid:u})}removeRaycastVehicle(o){let{uuid:u}=o;this.postMessage({op:"removeRaycastVehicle",uuid:u})}removeSpring(o){let{uuid:u}=o;this.postMessage({op:"removeSpring",uuid:u})}setAllowSleep(o){let{props:u,uuid:d}=o;this.postMessage({op:"setAllowSleep",props:u,uuid:d})}setAngularDamping(o){let{props:u,uuid:d}=o;this.postMessage({op:"setAngularDamping",props:u,uuid:d})}setAngularFactor(o){let{props:u,uuid:d}=o;this.postMessage({op:"setAngularFactor",props:u,uuid:d})}setAngularVelocity(o){let{props:u,uuid:d}=o;this.postMessage({op:"setAngularVelocity",props:u,uuid:d})}setCollisionFilterGroup(o){let{props:u,uuid:d}=o;this.postMessage({op:"setCollisionFilterGroup",props:u,uuid:d})}setCollisionFilterMask(o){let{props:u,uuid:d}=o;this.postMessage({op:"setCollisionFilterMask",props:u,uuid:d})}setCollisionResponse(o){let{props:u,uuid:d}=o;this.postMessage({op:"setCollisionResponse",props:u,uuid:d})}setConstraintMotorMaxForce(o){let{props:u,uuid:d}=o;this.postMessage({op:"setConstraintMotorMaxForce",props:u,uuid:d})}setConstraintMotorSpeed(o){let{props:u,uuid:d}=o;this.postMessage({op:"setConstraintMotorSpeed",props:u,uuid:d})}setFixedRotation(o){let{props:u,uuid:d}=o;this.postMessage({op:"setFixedRotation",props:u,uuid:d})}setIsTrigger(o){let{props:u,uuid:d}=o;this.postMessage({op:"setIsTrigger",props:u,uuid:d})}setLinearDamping(o){let{props:u,uuid:d}=o;this.postMessage({op:"setLinearDamping",props:u,uuid:d})}setLinearFactor(o){let{props:u,uuid:d}=o;this.postMessage({op:"setLinearFactor",props:u,uuid:d})}setMass(o){let{props:u,uuid:d}=o;this.postMessage({op:"setMass",props:u,uuid:d})}setMaterial(o){let{props:u,uuid:d}=o;this.postMessage({op:"setMaterial",props:u,uuid:d})}setPosition(o){let{props:u,uuid:d}=o;this.postMessage({op:"setPosition",props:u,uuid:d})}setQuaternion(o){let{props:[u,d,C,I],uuid:f}=o;this.postMessage({op:"setQuaternion",props:[u,d,C,I],uuid:f})}setRaycastVehicleBrake(o){let{props:u,uuid:d}=o;this.postMessage({op:"setRaycastVehicleBrake",props:u,uuid:d})}setRaycastVehicleSteeringValue(o){let{props:u,uuid:d}=o;this.postMessage({op:"setRaycastVehicleSteeringValue",props:u,uuid:d})}setRotation(o){let{props:u,uuid:d}=o;this.postMessage({op:"setRotation",props:u,uuid:d})}setSleepSpeedLimit(o){let{props:u,uuid:d}=o;this.postMessage({op:"setSleepSpeedLimit",props:u,uuid:d})}setSleepTimeLimit(o){let{props:u,uuid:d}=o;this.postMessage({op:"setSleepTimeLimit",props:u,uuid:d})}setSpringDamping(o){let{props:u,uuid:d}=o;this.postMessage({op:"setSpringDamping",props:u,uuid:d})}setSpringRestLength(o){let{props:u,uuid:d}=o;this.postMessage({op:"setSpringRestLength",props:u,uuid:d})}setSpringStiffness(o){let{props:u,uuid:d}=o;this.postMessage({op:"setSpringStiffness",props:u,uuid:d})}setUserData(o){let{props:u,uuid:d}=o;this.postMessage({op:"setUserData",props:u,uuid:d})}setVelocity(o){let{props:u,uuid:d}=o;this.postMessage({op:"setVelocity",props:u,uuid:d})}sleep(o){let{uuid:u}=o;this.postMessage({op:"sleep",uuid:u})}step(o){var u;const{buffers:{positions:d,quaternions:C}}=this;!d.byteLength&&!C.byteLength||(u=this.worker)==null||u.postMessage({op:"step",positions:d,props:o,quaternions:C},[d.buffer,C.buffer])}subscribe(o){let{props:{id:u,target:d,type:C},uuid:I}=o;this.postMessage({op:"subscribe",props:{id:u,target:d,type:C},uuid:I})}terminate(){var o;(o=this.worker)==null||o.terminate(),this.worker=null}unsubscribe(o){let{props:u}=o;this.postMessage({op:"unsubscribe",props:u})}wakeUp(o){let{uuid:u}=o;this.postMessage({op:"wakeUp",uuid:u})}postMessage(o){if(this.worker)return this.worker.postMessage(o);this.messageQueue.push(o)}}class Mat3$1{constructor(t){t===void 0&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const o=this.elements;o[0]=t.x,o[4]=t.y,o[8]=t.z}getTrace(t){t===void 0&&(t=new Vec3$1);const o=this.elements;return t.x=o[0],t.y=o[4],t.z=o[8],t}vmult(t,o){o===void 0&&(o=new Vec3$1);const u=this.elements,d=t.x,C=t.y,I=t.z;return o.x=u[0]*d+u[1]*C+u[2]*I,o.y=u[3]*d+u[4]*C+u[5]*I,o.z=u[6]*d+u[7]*C+u[8]*I,o}smult(t){for(let o=0;o<this.elements.length;o++)this.elements[o]*=t}mmult(t,o){o===void 0&&(o=new Mat3$1);const u=this.elements,d=t.elements,C=o.elements,I=u[0],f=u[1],A=u[2],y=u[3],G=u[4],S=u[5],w=u[6],M=u[7],V=u[8],T=d[0],H=d[1],J=d[2],z=d[3],L=d[4],K=d[5],O=d[6],Q=d[7],ee=d[8];return C[0]=I*T+f*z+A*O,C[1]=I*H+f*L+A*Q,C[2]=I*J+f*K+A*ee,C[3]=y*T+G*z+S*O,C[4]=y*H+G*L+S*Q,C[5]=y*J+G*K+S*ee,C[6]=w*T+M*z+V*O,C[7]=w*H+M*L+V*Q,C[8]=w*J+M*K+V*ee,o}scale(t,o){o===void 0&&(o=new Mat3$1);const u=this.elements,d=o.elements;for(let C=0;C!==3;C++)d[3*C+0]=t.x*u[3*C+0],d[3*C+1]=t.y*u[3*C+1],d[3*C+2]=t.z*u[3*C+2];return o}solve(t,o){o===void 0&&(o=new Vec3$1);const u=3,d=4,C=[];let I,f;for(I=0;I<u*d;I++)C.push(0);for(I=0;I<3;I++)for(f=0;f<3;f++)C[I+d*f]=this.elements[I+3*f];C[3+4*0]=t.x,C[3+4*1]=t.y,C[3+4*2]=t.z;let A=3;const y=A;let G;const S=4;let w;do{if(I=y-A,C[I+d*I]===0){for(f=I+1;f<y;f++)if(C[I+d*f]!==0){G=S;do w=S-G,C[w+d*I]+=C[w+d*f];while(--G);break}}if(C[I+d*I]!==0)for(f=I+1;f<y;f++){const M=C[I+d*f]/C[I+d*I];G=S;do w=S-G,C[w+d*f]=w<=I?0:C[w+d*f]-C[w+d*I]*M;while(--G)}}while(--A);if(o.z=C[2*d+3]/C[2*d+2],o.y=(C[1*d+3]-C[1*d+2]*o.z)/C[1*d+1],o.x=(C[0*d+3]-C[0*d+2]*o.z-C[0*d+1]*o.y)/C[0*d+0],isNaN(o.x)||isNaN(o.y)||isNaN(o.z)||o.x===1/0||o.y===1/0||o.z===1/0)throw`Could not solve equation! Got x=[${o.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return o}e(t,o,u){if(u===void 0)return this.elements[o+3*t];this.elements[o+3*t]=u}copy(t){for(let o=0;o<t.elements.length;o++)this.elements[o]=t.elements[o];return this}toString(){let t="";const o=",";for(let u=0;u<9;u++)t+=this.elements[u]+o;return t}reverse(t){t===void 0&&(t=new Mat3$1);const o=3,u=6,d=reverse_eqns$1;let C,I;for(C=0;C<3;C++)for(I=0;I<3;I++)d[C+u*I]=this.elements[C+3*I];d[3+6*0]=1,d[3+6*1]=0,d[3+6*2]=0,d[4+6*0]=0,d[4+6*1]=1,d[4+6*2]=0,d[5+6*0]=0,d[5+6*1]=0,d[5+6*2]=1;let f=3;const A=f;let y;const G=u;let S;do{if(C=A-f,d[C+u*C]===0){for(I=C+1;I<A;I++)if(d[C+u*I]!==0){y=G;do S=G-y,d[S+u*C]+=d[S+u*I];while(--y);break}}if(d[C+u*C]!==0)for(I=C+1;I<A;I++){const w=d[C+u*I]/d[C+u*C];y=G;do S=G-y,d[S+u*I]=S<=C?0:d[S+u*I]-d[S+u*C]*w;while(--y)}}while(--f);C=2;do{I=C-1;do{const w=d[C+u*I]/d[C+u*C];y=u;do S=u-y,d[S+u*I]=d[S+u*I]-d[S+u*C]*w;while(--y)}while(I--)}while(--C);C=2;do{const w=1/d[C+u*C];y=u;do S=u-y,d[S+u*C]=d[S+u*C]*w;while(--y)}while(C--);C=2;do{I=2;do{if(S=d[o+I+u*C],isNaN(S)||S===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(C,I,S)}while(I--)}while(C--);return t}setRotationFromQuaternion(t){const o=t.x,u=t.y,d=t.z,C=t.w,I=o+o,f=u+u,A=d+d,y=o*I,G=o*f,S=o*A,w=u*f,M=u*A,V=d*A,T=C*I,H=C*f,J=C*A,z=this.elements;return z[3*0+0]=1-(w+V),z[3*0+1]=G-J,z[3*0+2]=S+H,z[3*1+0]=G+J,z[3*1+1]=1-(y+V),z[3*1+2]=M-T,z[3*2+0]=S-H,z[3*2+1]=M+T,z[3*2+2]=1-(y+w),this}transpose(t){t===void 0&&(t=new Mat3$1);const o=this.elements,u=t.elements;let d;return u[0]=o[0],u[4]=o[4],u[8]=o[8],d=o[1],u[1]=o[3],u[3]=d,d=o[2],u[2]=o[6],u[6]=d,d=o[5],u[5]=o[7],u[7]=d,t}}const reverse_eqns$1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3$1{constructor(t,o,u){t===void 0&&(t=0),o===void 0&&(o=0),u===void 0&&(u=0),this.x=t,this.y=o,this.z=u}cross(t,o){o===void 0&&(o=new Vec3$1);const u=t.x,d=t.y,C=t.z,I=this.x,f=this.y,A=this.z;return o.x=f*C-A*d,o.y=A*u-I*C,o.z=I*d-f*u,o}set(t,o,u){return this.x=t,this.y=o,this.z=u,this}setZero(){this.x=this.y=this.z=0}vadd(t,o){if(o)o.x=t.x+this.x,o.y=t.y+this.y,o.z=t.z+this.z;else return new Vec3$1(this.x+t.x,this.y+t.y,this.z+t.z)}vsub(t,o){if(o)o.x=this.x-t.x,o.y=this.y-t.y,o.z=this.z-t.z;else return new Vec3$1(this.x-t.x,this.y-t.y,this.z-t.z)}crossmat(){return new Mat3$1([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,o=this.y,u=this.z,d=Math.sqrt(t*t+o*o+u*u);if(d>0){const C=1/d;this.x*=C,this.y*=C,this.z*=C}else this.x=0,this.y=0,this.z=0;return d}unit(t){t===void 0&&(t=new Vec3$1);const o=this.x,u=this.y,d=this.z;let C=Math.sqrt(o*o+u*u+d*d);return C>0?(C=1/C,t.x=o*C,t.y=u*C,t.z=d*C):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,o=this.y,u=this.z;return Math.sqrt(t*t+o*o+u*u)}lengthSquared(){return this.dot(this)}distanceTo(t){const o=this.x,u=this.y,d=this.z,C=t.x,I=t.y,f=t.z;return Math.sqrt((C-o)*(C-o)+(I-u)*(I-u)+(f-d)*(f-d))}distanceSquared(t){const o=this.x,u=this.y,d=this.z,C=t.x,I=t.y,f=t.z;return(C-o)*(C-o)+(I-u)*(I-u)+(f-d)*(f-d)}scale(t,o){o===void 0&&(o=new Vec3$1);const u=this.x,d=this.y,C=this.z;return o.x=t*u,o.y=t*d,o.z=t*C,o}vmul(t,o){return o===void 0&&(o=new Vec3$1),o.x=t.x*this.x,o.y=t.y*this.y,o.z=t.z*this.z,o}addScaledVector(t,o,u){return u===void 0&&(u=new Vec3$1),u.x=this.x+t*o.x,u.y=this.y+t*o.y,u.z=this.z+t*o.z,u}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(t){return t===void 0&&(t=new Vec3$1),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,o){const u=this.length();if(u>0){const d=Vec3_tangents_n$1,C=1/u;d.set(this.x*C,this.y*C,this.z*C);const I=Vec3_tangents_randVec$1;Math.abs(d.x)<.9?(I.set(1,0,0),d.cross(I,t)):(I.set(0,1,0),d.cross(I,t)),d.cross(t,o)}else t.set(1,0,0),o.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,o,u){const d=this.x,C=this.y,I=this.z;u.x=d+(t.x-d)*o,u.y=C+(t.y-C)*o,u.z=I+(t.z-I)*o}almostEquals(t,o){return o===void 0&&(o=1e-6),!(Math.abs(this.x-t.x)>o||Math.abs(this.y-t.y)>o||Math.abs(this.z-t.z)>o)}almostZero(t){return t===void 0&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,o){return this.negate(antip_neg$1),antip_neg$1.almostEquals(t,o)}clone(){return new Vec3$1(this.x,this.y,this.z)}}Vec3$1.ZERO=new Vec3$1(0,0,0);Vec3$1.UNIT_X=new Vec3$1(1,0,0);Vec3$1.UNIT_Y=new Vec3$1(0,1,0);Vec3$1.UNIT_Z=new Vec3$1(0,0,1);const Vec3_tangents_n$1=new Vec3$1,Vec3_tangents_randVec$1=new Vec3$1,antip_neg$1=new Vec3$1;class AABB$1{constructor(t){t===void 0&&(t={}),this.lowerBound=new Vec3$1,this.upperBound=new Vec3$1,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,o,u,d){const C=this.lowerBound,I=this.upperBound,f=u;C.copy(t[0]),f&&f.vmult(C,C),I.copy(C);for(let A=1;A<t.length;A++){let y=t[A];f&&(f.vmult(y,tmp$1$1),y=tmp$1$1),y.x>I.x&&(I.x=y.x),y.x<C.x&&(C.x=y.x),y.y>I.y&&(I.y=y.y),y.y<C.y&&(C.y=y.y),y.z>I.z&&(I.z=y.z),y.z<C.z&&(C.z=y.z)}return o&&(o.vadd(C,C),o.vadd(I,I)),d&&(C.x-=d,C.y-=d,C.z-=d,I.x+=d,I.y+=d,I.z+=d),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return new AABB$1().copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const o=this.lowerBound,u=this.upperBound,d=t.lowerBound,C=t.upperBound,I=d.x<=u.x&&u.x<=C.x||o.x<=C.x&&C.x<=u.x,f=d.y<=u.y&&u.y<=C.y||o.y<=C.y&&C.y<=u.y,A=d.z<=u.z&&u.z<=C.z||o.z<=C.z&&C.z<=u.z;return I&&f&&A}volume(){const t=this.lowerBound,o=this.upperBound;return(o.x-t.x)*(o.y-t.y)*(o.z-t.z)}contains(t){const o=this.lowerBound,u=this.upperBound,d=t.lowerBound,C=t.upperBound;return o.x<=d.x&&u.x>=C.x&&o.y<=d.y&&u.y>=C.y&&o.z<=d.z&&u.z>=C.z}getCorners(t,o,u,d,C,I,f,A){const y=this.lowerBound,G=this.upperBound;t.copy(y),o.set(G.x,y.y,y.z),u.set(G.x,G.y,y.z),d.set(y.x,G.y,G.z),C.set(G.x,y.y,G.z),I.set(y.x,G.y,y.z),f.set(y.x,y.y,G.z),A.copy(G)}toLocalFrame(t,o){const u=transformIntoFrame_corners$1,d=u[0],C=u[1],I=u[2],f=u[3],A=u[4],y=u[5],G=u[6],S=u[7];this.getCorners(d,C,I,f,A,y,G,S);for(let w=0;w!==8;w++){const M=u[w];t.pointToLocal(M,M)}return o.setFromPoints(u)}toWorldFrame(t,o){const u=transformIntoFrame_corners$1,d=u[0],C=u[1],I=u[2],f=u[3],A=u[4],y=u[5],G=u[6],S=u[7];this.getCorners(d,C,I,f,A,y,G,S);for(let w=0;w!==8;w++){const M=u[w];t.pointToWorld(M,M)}return o.setFromPoints(u)}overlapsRay(t){const{direction:o,from:u}=t,d=1/o.x,C=1/o.y,I=1/o.z,f=(this.lowerBound.x-u.x)*d,A=(this.upperBound.x-u.x)*d,y=(this.lowerBound.y-u.y)*C,G=(this.upperBound.y-u.y)*C,S=(this.lowerBound.z-u.z)*I,w=(this.upperBound.z-u.z)*I,M=Math.max(Math.max(Math.min(f,A),Math.min(y,G)),Math.min(S,w)),V=Math.min(Math.min(Math.max(f,A),Math.max(y,G)),Math.max(S,w));return!(V<0||M>V)}}const tmp$1$1=new Vec3$1,transformIntoFrame_corners$1=[new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1];class Quaternion$1{constructor(t,o,u,d){t===void 0&&(t=0),o===void 0&&(o=0),u===void 0&&(u=0),d===void 0&&(d=1),this.x=t,this.y=o,this.z=u,this.w=d}set(t,o,u,d){return this.x=t,this.y=o,this.z=u,this.w=d,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,o){const u=Math.sin(o*.5);return this.x=t.x*u,this.y=t.y*u,this.z=t.z*u,this.w=Math.cos(o*.5),this}toAxisAngle(t){t===void 0&&(t=new Vec3$1),this.normalize();const o=2*Math.acos(this.w),u=Math.sqrt(1-this.w*this.w);return u<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/u,t.y=this.y/u,t.z=this.z/u),[t,o]}setFromVectors(t,o){if(t.isAntiparallelTo(o)){const u=sfv_t1$1,d=sfv_t2$1;t.tangents(u,d),this.setFromAxisAngle(u,Math.PI)}else{const u=t.cross(o);this.x=u.x,this.y=u.y,this.z=u.z,this.w=Math.sqrt(t.length()**2*o.length()**2)+t.dot(o),this.normalize()}return this}mult(t,o){o===void 0&&(o=new Quaternion$1);const u=this.x,d=this.y,C=this.z,I=this.w,f=t.x,A=t.y,y=t.z,G=t.w;return o.x=u*G+I*f+d*y-C*A,o.y=d*G+I*A+C*f-u*y,o.z=C*G+I*y+u*A-d*f,o.w=I*G-u*f-d*A-C*y,o}inverse(t){t===void 0&&(t=new Quaternion$1);const o=this.x,u=this.y,d=this.z,C=this.w;this.conjugate(t);const I=1/(o*o+u*u+d*d+C*C);return t.x*=I,t.y*=I,t.z*=I,t.w*=I,t}conjugate(t){return t===void 0&&(t=new Quaternion$1),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,o){o===void 0&&(o=new Vec3$1);const u=t.x,d=t.y,C=t.z,I=this.x,f=this.y,A=this.z,y=this.w,G=y*u+f*C-A*d,S=y*d+A*u-I*C,w=y*C+I*d-f*u,M=-I*u-f*d-A*C;return o.x=G*y+M*-I+S*-A-w*-f,o.y=S*y+M*-f+w*-I-G*-A,o.z=w*y+M*-A+G*-f-S*-I,o}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,o){o===void 0&&(o="YZX");let u,d,C;const I=this.x,f=this.y,A=this.z,y=this.w;switch(o){case"YZX":const G=I*f+A*y;if(G>.499&&(u=2*Math.atan2(I,y),d=Math.PI/2,C=0),G<-.499&&(u=-2*Math.atan2(I,y),d=-Math.PI/2,C=0),u===void 0){const S=I*I,w=f*f,M=A*A;u=Math.atan2(2*f*y-2*I*A,1-2*w-2*M),d=Math.asin(2*G),C=Math.atan2(2*I*y-2*f*A,1-2*S-2*M)}break;default:throw new Error(`Euler order ${o} not supported yet.`)}t.y=u,t.z=d,t.x=C}setFromEuler(t,o,u,d){d===void 0&&(d="XYZ");const C=Math.cos(t/2),I=Math.cos(o/2),f=Math.cos(u/2),A=Math.sin(t/2),y=Math.sin(o/2),G=Math.sin(u/2);return d==="XYZ"?(this.x=A*I*f+C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f-A*y*G):d==="YXZ"?(this.x=A*I*f+C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f+A*y*G):d==="ZXY"?(this.x=A*I*f-C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f-A*y*G):d==="ZYX"?(this.x=A*I*f-C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f+A*y*G):d==="YZX"?(this.x=A*I*f+C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f-A*y*G):d==="XZY"&&(this.x=A*I*f-C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f+A*y*G),this}clone(){return new Quaternion$1(this.x,this.y,this.z,this.w)}slerp(t,o,u){u===void 0&&(u=new Quaternion$1);const d=this.x,C=this.y,I=this.z,f=this.w;let A=t.x,y=t.y,G=t.z,S=t.w,w,M,V,T,H;return M=d*A+C*y+I*G+f*S,M<0&&(M=-M,A=-A,y=-y,G=-G,S=-S),1-M>1e-6?(w=Math.acos(M),V=Math.sin(w),T=Math.sin((1-o)*w)/V,H=Math.sin(o*w)/V):(T=1-o,H=o),u.x=T*d+H*A,u.y=T*C+H*y,u.z=T*I+H*G,u.w=T*f+H*S,u}integrate(t,o,u,d){d===void 0&&(d=new Quaternion$1);const C=t.x*u.x,I=t.y*u.y,f=t.z*u.z,A=this.x,y=this.y,G=this.z,S=this.w,w=o*.5;return d.x+=w*(C*S+I*G-f*y),d.y+=w*(I*S+f*A-C*G),d.z+=w*(f*S+C*y-I*A),d.w+=w*(-C*A-I*y-f*G),d}}const sfv_t1$1=new Vec3$1,sfv_t2$1=new Vec3$1,SHAPE_TYPES$1={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape$1{constructor(t){t===void 0&&(t={}),this.id=Shape$1.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,o){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,o,u,d){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape$1.idCounter=0;Shape$1.types=SHAPE_TYPES$1;class Transform$1{constructor(t){t===void 0&&(t={}),this.position=new Vec3$1,this.quaternion=new Quaternion$1,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,o){return Transform$1.pointToLocalFrame(this.position,this.quaternion,t,o)}pointToWorld(t,o){return Transform$1.pointToWorldFrame(this.position,this.quaternion,t,o)}vectorToWorldFrame(t,o){return o===void 0&&(o=new Vec3$1),this.quaternion.vmult(t,o),o}static pointToLocalFrame(t,o,u,d){return d===void 0&&(d=new Vec3$1),u.vsub(t,d),o.conjugate(tmpQuat$1$1),tmpQuat$1$1.vmult(d,d),d}static pointToWorldFrame(t,o,u,d){return d===void 0&&(d=new Vec3$1),o.vmult(u,d),d.vadd(t,d),d}static vectorToWorldFrame(t,o,u){return u===void 0&&(u=new Vec3$1),t.vmult(o,u),u}static vectorToLocalFrame(t,o,u,d){return d===void 0&&(d=new Vec3$1),o.w*=-1,o.vmult(u,d),o.w*=-1,d}}const tmpQuat$1$1=new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Quaternion$1;new AABB$1;new Mat3$1;new Mat3$1;new Mat3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;class RaycastResult$1{constructor(){this.rayFromWorld=new Vec3$1,this.rayToWorld=new Vec3$1,this.hitNormalWorld=new Vec3$1,this.hitPointWorld=new Vec3$1,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,o,u,d,C,I,f){this.rayFromWorld.copy(t),this.rayToWorld.copy(o),this.hitNormalWorld.copy(u),this.hitPointWorld.copy(d),this.shape=C,this.body=I,this.distance=f}}let _Shape$types$SPHERE$1,_Shape$types$PLANE$1,_Shape$types$BOX$1,_Shape$types$CYLINDER$1,_Shape$types$CONVEXPO$1,_Shape$types$HEIGHTFI$1,_Shape$types$TRIMESH$1;const RAY_MODES$1={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE$1=Shape$1.types.SPHERE;_Shape$types$PLANE$1=Shape$1.types.PLANE;_Shape$types$BOX$1=Shape$1.types.BOX;_Shape$types$CYLINDER$1=Shape$1.types.CYLINDER;_Shape$types$CONVEXPO$1=Shape$1.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI$1=Shape$1.types.HEIGHTFIELD;_Shape$types$TRIMESH$1=Shape$1.types.TRIMESH;class Ray$1{get[_Shape$types$SPHERE$1](){return this._intersectSphere}get[_Shape$types$PLANE$1](){return this._intersectPlane}get[_Shape$types$BOX$1](){return this._intersectBox}get[_Shape$types$CYLINDER$1](){return this._intersectConvex}get[_Shape$types$CONVEXPO$1](){return this._intersectConvex}get[_Shape$types$HEIGHTFI$1](){return this._intersectHeightfield}get[_Shape$types$TRIMESH$1](){return this._intersectTrimesh}constructor(t,o){t===void 0&&(t=new Vec3$1),o===void 0&&(o=new Vec3$1),this.from=t.clone(),this.to=o.clone(),this.direction=new Vec3$1,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray$1.ANY,this.result=new RaycastResult$1,this.hasHit=!1,this.callback=u=>{}}intersectWorld(t,o){return this.mode=o.mode||Ray$1.ANY,this.result=o.result||new RaycastResult$1,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=typeof o.collisionFilterMask<"u"?o.collisionFilterMask:-1,this.collisionFilterGroup=typeof o.collisionFilterGroup<"u"?o.collisionFilterGroup:-1,this.checkCollisionResponse=typeof o.checkCollisionResponse<"u"?o.checkCollisionResponse:!0,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1$1),tmpArray$1.length=0,t.broadphase.aabbQuery(t,tmpAABB$1$1,tmpArray$1),this.intersectBodies(tmpArray$1),this.hasHit}intersectBody(t,o){o&&(this.result=o,this.updateDirection());const u=this.checkCollisionResponse;if(u&&!t.collisionResponse||(this.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&this.collisionFilterMask)===0)return;const d=intersectBody_xi$1,C=intersectBody_qi$1;for(let I=0,f=t.shapes.length;I<f;I++){const A=t.shapes[I];if(!(u&&!A.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[I],C),t.quaternion.vmult(t.shapeOffsets[I],d),d.vadd(t.position,d),this.intersectShape(A,C,d,t),this.result.shouldStop))break}}intersectBodies(t,o){o&&(this.result=o,this.updateDirection());for(let u=0,d=t.length;!this.result.shouldStop&&u<d;u++)this.intersectBody(t[u])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,o,u,d){const C=this.from;if(distanceFromIntersection$1(C,this.direction,u)>t.boundingSphereRadius)return;const f=this[t.type];f&&f.call(this,t,o,u,d,t)}_intersectBox(t,o,u,d,C){return this._intersectConvex(t.convexPolyhedronRepresentation,o,u,d,C)}_intersectPlane(t,o,u,d,C){const I=this.from,f=this.to,A=this.direction,y=new Vec3$1(0,0,1);o.vmult(y,y);const G=new Vec3$1;I.vsub(u,G);const S=G.dot(y);f.vsub(u,G);const w=G.dot(y);if(S*w>0||I.distanceTo(f)<S)return;const M=y.dot(A);if(Math.abs(M)<this.precision)return;const V=new Vec3$1,T=new Vec3$1,H=new Vec3$1;I.vsub(u,V);const J=-y.dot(V)/M;A.scale(J,T),I.vadd(T,H),this.reportIntersection(y,H,C,d,-1)}getAABB(t){const{lowerBound:o,upperBound:u}=t,d=this.to,C=this.from;o.x=Math.min(d.x,C.x),o.y=Math.min(d.y,C.y),o.z=Math.min(d.z,C.z),u.x=Math.max(d.x,C.x),u.y=Math.max(d.y,C.y),u.z=Math.max(d.z,C.z)}_intersectHeightfield(t,o,u,d,C){t.data,t.elementSize;const I=intersectHeightfield_localRay$1;I.from.copy(this.from),I.to.copy(this.to),Transform$1.pointToLocalFrame(u,o,I.from,I.from),Transform$1.pointToLocalFrame(u,o,I.to,I.to),I.updateDirection();const f=intersectHeightfield_index$1;let A,y,G,S;A=y=0,G=S=t.data.length-1;const w=new AABB$1;I.getAABB(w),t.getIndexOfPosition(w.lowerBound.x,w.lowerBound.y,f,!0),A=Math.max(A,f[0]),y=Math.max(y,f[1]),t.getIndexOfPosition(w.upperBound.x,w.upperBound.y,f,!0),G=Math.min(G,f[0]+1),S=Math.min(S,f[1]+1);for(let M=A;M<G;M++)for(let V=y;V<S;V++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(M,V,w),!!w.overlapsRay(I)){if(t.getConvexTrianglePillar(M,V,!1),Transform$1.pointToWorldFrame(u,o,t.pillarOffset,worldPillarOffset$1),this._intersectConvex(t.pillarConvex,o,worldPillarOffset$1,d,C,intersectConvexOptions$1),this.result.shouldStop)return;t.getConvexTrianglePillar(M,V,!0),Transform$1.pointToWorldFrame(u,o,t.pillarOffset,worldPillarOffset$1),this._intersectConvex(t.pillarConvex,o,worldPillarOffset$1,d,C,intersectConvexOptions$1)}}}_intersectSphere(t,o,u,d,C){const I=this.from,f=this.to,A=t.radius,y=(f.x-I.x)**2+(f.y-I.y)**2+(f.z-I.z)**2,G=2*((f.x-I.x)*(I.x-u.x)+(f.y-I.y)*(I.y-u.y)+(f.z-I.z)*(I.z-u.z)),S=(I.x-u.x)**2+(I.y-u.y)**2+(I.z-u.z)**2-A**2,w=G**2-4*y*S,M=Ray_intersectSphere_intersectionPoint$1,V=Ray_intersectSphere_normal$1;if(!(w<0))if(w===0)I.lerp(f,w,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1);else{const T=(-G-Math.sqrt(w))/(2*y),H=(-G+Math.sqrt(w))/(2*y);if(T>=0&&T<=1&&(I.lerp(f,T,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1)),this.result.shouldStop)return;H>=0&&H<=1&&(I.lerp(f,H,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1))}}_intersectConvex(t,o,u,d,C,I){const f=intersectConvex_normal$1,A=intersectConvex_vector$1,y=I&&I.faceList||null,G=t.faces,S=t.vertices,w=t.faceNormals,M=this.direction,V=this.from,T=this.to,H=V.distanceTo(T),J=y?y.length:G.length,z=this.result;for(let L=0;!z.shouldStop&&L<J;L++){const K=y?y[L]:L,O=G[K],Q=w[K],ee=o,ie=u;A.copy(S[O[0]]),ee.vmult(A,A),A.vadd(ie,A),A.vsub(V,A),ee.vmult(Q,f);const te=M.dot(f);if(Math.abs(te)<this.precision)continue;const se=f.dot(A)/te;if(!(se<0)){M.scale(se,intersectPoint$1),intersectPoint$1.vadd(V,intersectPoint$1),a$1.copy(S[O[0]]),ee.vmult(a$1,a$1),ie.vadd(a$1,a$1);for(let ae=1;!z.shouldStop&&ae<O.length-1;ae++){b$1.copy(S[O[ae]]),c$1.copy(S[O[ae+1]]),ee.vmult(b$1,b$1),ee.vmult(c$1,c$1),ie.vadd(b$1,b$1),ie.vadd(c$1,c$1);const le=intersectPoint$1.distanceTo(V);!(Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1))||le>H||this.reportIntersection(f,intersectPoint$1,C,d,K)}}}}_intersectTrimesh(t,o,u,d,C,I){const f=intersectTrimesh_normal$1,A=intersectTrimesh_triangles$1,y=intersectTrimesh_treeTransform$1,G=intersectConvex_vector$1,S=intersectTrimesh_localDirection$1,w=intersectTrimesh_localFrom$1,M=intersectTrimesh_localTo$1,V=intersectTrimesh_worldIntersectPoint$1,T=intersectTrimesh_worldNormal$1,H=t.indices;t.vertices;const J=this.from,z=this.to,L=this.direction;y.position.copy(u),y.quaternion.copy(o),Transform$1.vectorToLocalFrame(u,o,L,S),Transform$1.pointToLocalFrame(u,o,J,w),Transform$1.pointToLocalFrame(u,o,z,M),M.x*=t.scale.x,M.y*=t.scale.y,M.z*=t.scale.z,w.x*=t.scale.x,w.y*=t.scale.y,w.z*=t.scale.z,M.vsub(w,S),S.normalize();const K=w.distanceSquared(M);t.tree.rayQuery(this,y,A);for(let O=0,Q=A.length;!this.result.shouldStop&&O!==Q;O++){const ee=A[O];t.getNormal(ee,f),t.getVertex(H[ee*3],a$1),a$1.vsub(w,G);const ie=S.dot(f),te=f.dot(G)/ie;if(te<0)continue;S.scale(te,intersectPoint$1),intersectPoint$1.vadd(w,intersectPoint$1),t.getVertex(H[ee*3+1],b$1),t.getVertex(H[ee*3+2],c$1);const se=intersectPoint$1.distanceSquared(w);!(Ray$1.pointInTriangle(intersectPoint$1,b$1,a$1,c$1)||Ray$1.pointInTriangle(intersectPoint$1,a$1,b$1,c$1))||se>K||(Transform$1.vectorToWorldFrame(o,f,T),Transform$1.pointToWorldFrame(u,o,intersectPoint$1,V),this.reportIntersection(T,V,C,d,ee))}A.length=0}reportIntersection(t,o,u,d,C){const I=this.from,f=this.to,A=I.distanceTo(o),y=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(y.hitFaceIndex=typeof C<"u"?C:-1,this.mode){case Ray$1.ALL:this.hasHit=!0,y.set(I,f,t,o,u,d,A),y.hasHit=!0,this.callback(y);break;case Ray$1.CLOSEST:(A<y.distance||!y.hasHit)&&(this.hasHit=!0,y.hasHit=!0,y.set(I,f,t,o,u,d,A));break;case Ray$1.ANY:this.hasHit=!0,y.hasHit=!0,y.set(I,f,t,o,u,d,A),y.shouldStop=!0;break}}static pointInTriangle(t,o,u,d){d.vsub(o,v0$1),u.vsub(o,v1$1),t.vsub(o,v2$1);const C=v0$1.dot(v0$1),I=v0$1.dot(v1$1),f=v0$1.dot(v2$1),A=v1$1.dot(v1$1),y=v1$1.dot(v2$1);let G,S;return(G=A*f-I*y)>=0&&(S=C*y-I*f)>=0&&G+S<C*A-I*I}}Ray$1.CLOSEST=RAY_MODES$1.CLOSEST;Ray$1.ANY=RAY_MODES$1.ANY;Ray$1.ALL=RAY_MODES$1.ALL;const tmpAABB$1$1=new AABB$1,tmpArray$1=[],v1$1=new Vec3$1,v2$1=new Vec3$1,intersectBody_xi$1=new Vec3$1,intersectBody_qi$1=new Quaternion$1,intersectPoint$1=new Vec3$1,a$1=new Vec3$1,b$1=new Vec3$1,c$1=new Vec3$1;new Vec3$1;new RaycastResult$1;const intersectConvexOptions$1={faceList:[0]},worldPillarOffset$1=new Vec3$1,intersectHeightfield_localRay$1=new Ray$1,intersectHeightfield_index$1=[],Ray_intersectSphere_intersectionPoint$1=new Vec3$1,Ray_intersectSphere_normal$1=new Vec3$1,intersectConvex_normal$1=new Vec3$1;new Vec3$1;new Vec3$1;const intersectConvex_vector$1=new Vec3$1,intersectTrimesh_normal$1=new Vec3$1,intersectTrimesh_localDirection$1=new Vec3$1,intersectTrimesh_localFrom$1=new Vec3$1,intersectTrimesh_localTo$1=new Vec3$1,intersectTrimesh_worldNormal$1=new Vec3$1,intersectTrimesh_worldIntersectPoint$1=new Vec3$1;new AABB$1;const intersectTrimesh_triangles$1=[],intersectTrimesh_treeTransform$1=new Transform$1,v0$1=new Vec3$1,intersect$1=new Vec3$1;function distanceFromIntersection$1(n,t,o){o.vsub(n,v0$1);const u=v0$1.dot(t);return t.scale(u,intersect$1),intersect$1.vadd(n,intersect$1),o.distanceTo(intersect$1)}new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Ray$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1(1,0,0),new Vec3$1(0,1,0),new Vec3$1(0,0,1);new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Transform$1;new AABB$1;Shape$1.types.SPHERE,Shape$1.types.SPHERE|Shape$1.types.PLANE,Shape$1.types.BOX|Shape$1.types.BOX,Shape$1.types.SPHERE|Shape$1.types.BOX,Shape$1.types.PLANE|Shape$1.types.BOX,Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.PLANE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.BOX|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.SPHERE|Shape$1.types.HEIGHTFIELD,Shape$1.types.BOX|Shape$1.types.HEIGHTFIELD,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.HEIGHTFIELD,Shape$1.types.PARTICLE|Shape$1.types.SPHERE,Shape$1.types.PLANE|Shape$1.types.PARTICLE,Shape$1.types.BOX|Shape$1.types.PARTICLE,Shape$1.types.PARTICLE|Shape$1.types.CONVEXPOLYHEDRON,Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.CYLINDER,Shape$1.types.PLANE|Shape$1.types.CYLINDER,Shape$1.types.BOX|Shape$1.types.CYLINDER,Shape$1.types.CONVEXPOLYHEDRON|Shape$1.types.CYLINDER,Shape$1.types.HEIGHTFIELD|Shape$1.types.CYLINDER,Shape$1.types.PARTICLE|Shape$1.types.CYLINDER,Shape$1.types.SPHERE|Shape$1.types.TRIMESH,Shape$1.types.PLANE|Shape$1.types.TRIMESH;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1,new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Quaternion$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new Vec3$1;new AABB$1;new Ray$1;const performance$1=globalThis.performance||{};if(!performance$1.now){let n=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(n=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-n}new Vec3$1;class Mat3{constructor(t){t===void 0&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const o=this.elements;o[0]=t.x,o[4]=t.y,o[8]=t.z}getTrace(t){t===void 0&&(t=new Vec3);const o=this.elements;return t.x=o[0],t.y=o[4],t.z=o[8],t}vmult(t,o){o===void 0&&(o=new Vec3);const u=this.elements,d=t.x,C=t.y,I=t.z;return o.x=u[0]*d+u[1]*C+u[2]*I,o.y=u[3]*d+u[4]*C+u[5]*I,o.z=u[6]*d+u[7]*C+u[8]*I,o}smult(t){for(let o=0;o<this.elements.length;o++)this.elements[o]*=t}mmult(t,o){o===void 0&&(o=new Mat3);const u=this.elements,d=t.elements,C=o.elements,I=u[0],f=u[1],A=u[2],y=u[3],G=u[4],S=u[5],w=u[6],M=u[7],V=u[8],T=d[0],H=d[1],J=d[2],z=d[3],L=d[4],K=d[5],O=d[6],Q=d[7],ee=d[8];return C[0]=I*T+f*z+A*O,C[1]=I*H+f*L+A*Q,C[2]=I*J+f*K+A*ee,C[3]=y*T+G*z+S*O,C[4]=y*H+G*L+S*Q,C[5]=y*J+G*K+S*ee,C[6]=w*T+M*z+V*O,C[7]=w*H+M*L+V*Q,C[8]=w*J+M*K+V*ee,o}scale(t,o){o===void 0&&(o=new Mat3);const u=this.elements,d=o.elements;for(let C=0;C!==3;C++)d[3*C+0]=t.x*u[3*C+0],d[3*C+1]=t.y*u[3*C+1],d[3*C+2]=t.z*u[3*C+2];return o}solve(t,o){o===void 0&&(o=new Vec3);const u=3,d=4,C=[];let I,f;for(I=0;I<u*d;I++)C.push(0);for(I=0;I<3;I++)for(f=0;f<3;f++)C[I+d*f]=this.elements[I+3*f];C[3+4*0]=t.x,C[3+4*1]=t.y,C[3+4*2]=t.z;let A=3;const y=A;let G;const S=4;let w;do{if(I=y-A,C[I+d*I]===0){for(f=I+1;f<y;f++)if(C[I+d*f]!==0){G=S;do w=S-G,C[w+d*I]+=C[w+d*f];while(--G);break}}if(C[I+d*I]!==0)for(f=I+1;f<y;f++){const M=C[I+d*f]/C[I+d*I];G=S;do w=S-G,C[w+d*f]=w<=I?0:C[w+d*f]-C[w+d*I]*M;while(--G)}}while(--A);if(o.z=C[2*d+3]/C[2*d+2],o.y=(C[1*d+3]-C[1*d+2]*o.z)/C[1*d+1],o.x=(C[0*d+3]-C[0*d+2]*o.z-C[0*d+1]*o.y)/C[0*d+0],isNaN(o.x)||isNaN(o.y)||isNaN(o.z)||o.x===1/0||o.y===1/0||o.z===1/0)throw`Could not solve equation! Got x=[${o.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return o}e(t,o,u){if(u===void 0)return this.elements[o+3*t];this.elements[o+3*t]=u}copy(t){for(let o=0;o<t.elements.length;o++)this.elements[o]=t.elements[o];return this}toString(){let t="";const o=",";for(let u=0;u<9;u++)t+=this.elements[u]+o;return t}reverse(t){t===void 0&&(t=new Mat3);const o=3,u=6,d=reverse_eqns;let C,I;for(C=0;C<3;C++)for(I=0;I<3;I++)d[C+u*I]=this.elements[C+3*I];d[3+6*0]=1,d[3+6*1]=0,d[3+6*2]=0,d[4+6*0]=0,d[4+6*1]=1,d[4+6*2]=0,d[5+6*0]=0,d[5+6*1]=0,d[5+6*2]=1;let f=3;const A=f;let y;const G=u;let S;do{if(C=A-f,d[C+u*C]===0){for(I=C+1;I<A;I++)if(d[C+u*I]!==0){y=G;do S=G-y,d[S+u*C]+=d[S+u*I];while(--y);break}}if(d[C+u*C]!==0)for(I=C+1;I<A;I++){const w=d[C+u*I]/d[C+u*C];y=G;do S=G-y,d[S+u*I]=S<=C?0:d[S+u*I]-d[S+u*C]*w;while(--y)}}while(--f);C=2;do{I=C-1;do{const w=d[C+u*I]/d[C+u*C];y=u;do S=u-y,d[S+u*I]=d[S+u*I]-d[S+u*C]*w;while(--y)}while(I--)}while(--C);C=2;do{const w=1/d[C+u*C];y=u;do S=u-y,d[S+u*C]=d[S+u*C]*w;while(--y)}while(C--);C=2;do{I=2;do{if(S=d[o+I+u*C],isNaN(S)||S===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(C,I,S)}while(I--)}while(C--);return t}setRotationFromQuaternion(t){const o=t.x,u=t.y,d=t.z,C=t.w,I=o+o,f=u+u,A=d+d,y=o*I,G=o*f,S=o*A,w=u*f,M=u*A,V=d*A,T=C*I,H=C*f,J=C*A,z=this.elements;return z[3*0+0]=1-(w+V),z[3*0+1]=G-J,z[3*0+2]=S+H,z[3*1+0]=G+J,z[3*1+1]=1-(y+V),z[3*1+2]=M-T,z[3*2+0]=S-H,z[3*2+1]=M+T,z[3*2+2]=1-(y+w),this}transpose(t){t===void 0&&(t=new Mat3);const o=this.elements,u=t.elements;let d;return u[0]=o[0],u[4]=o[4],u[8]=o[8],d=o[1],u[1]=o[3],u[3]=d,d=o[2],u[2]=o[6],u[6]=d,d=o[5],u[5]=o[7],u[7]=d,t}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(t,o,u){t===void 0&&(t=0),o===void 0&&(o=0),u===void 0&&(u=0),this.x=t,this.y=o,this.z=u}cross(t,o){o===void 0&&(o=new Vec3);const u=t.x,d=t.y,C=t.z,I=this.x,f=this.y,A=this.z;return o.x=f*C-A*d,o.y=A*u-I*C,o.z=I*d-f*u,o}set(t,o,u){return this.x=t,this.y=o,this.z=u,this}setZero(){this.x=this.y=this.z=0}vadd(t,o){if(o)o.x=t.x+this.x,o.y=t.y+this.y,o.z=t.z+this.z;else return new Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}vsub(t,o){if(o)o.x=this.x-t.x,o.y=this.y-t.y,o.z=this.z-t.z;else return new Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,o=this.y,u=this.z,d=Math.sqrt(t*t+o*o+u*u);if(d>0){const C=1/d;this.x*=C,this.y*=C,this.z*=C}else this.x=0,this.y=0,this.z=0;return d}unit(t){t===void 0&&(t=new Vec3);const o=this.x,u=this.y,d=this.z;let C=Math.sqrt(o*o+u*u+d*d);return C>0?(C=1/C,t.x=o*C,t.y=u*C,t.z=d*C):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,o=this.y,u=this.z;return Math.sqrt(t*t+o*o+u*u)}lengthSquared(){return this.dot(this)}distanceTo(t){const o=this.x,u=this.y,d=this.z,C=t.x,I=t.y,f=t.z;return Math.sqrt((C-o)*(C-o)+(I-u)*(I-u)+(f-d)*(f-d))}distanceSquared(t){const o=this.x,u=this.y,d=this.z,C=t.x,I=t.y,f=t.z;return(C-o)*(C-o)+(I-u)*(I-u)+(f-d)*(f-d)}scale(t,o){o===void 0&&(o=new Vec3);const u=this.x,d=this.y,C=this.z;return o.x=t*u,o.y=t*d,o.z=t*C,o}vmul(t,o){return o===void 0&&(o=new Vec3),o.x=t.x*this.x,o.y=t.y*this.y,o.z=t.z*this.z,o}addScaledVector(t,o,u){return u===void 0&&(u=new Vec3),u.x=this.x+t*o.x,u.y=this.y+t*o.y,u.z=this.z+t*o.z,u}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(t){return t===void 0&&(t=new Vec3),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,o){const u=this.length();if(u>0){const d=Vec3_tangents_n,C=1/u;d.set(this.x*C,this.y*C,this.z*C);const I=Vec3_tangents_randVec;Math.abs(d.x)<.9?(I.set(1,0,0),d.cross(I,t)):(I.set(0,1,0),d.cross(I,t)),d.cross(t,o)}else t.set(1,0,0),o.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,o,u){const d=this.x,C=this.y,I=this.z;u.x=d+(t.x-d)*o,u.y=C+(t.y-C)*o,u.z=I+(t.z-I)*o}almostEquals(t,o){return o===void 0&&(o=1e-6),!(Math.abs(this.x-t.x)>o||Math.abs(this.y-t.y)>o||Math.abs(this.z-t.z)>o)}almostZero(t){return t===void 0&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,o){return this.negate(antip_neg),antip_neg.almostEquals(t,o)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(t){t===void 0&&(t={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,o,u,d){const C=this.lowerBound,I=this.upperBound,f=u;C.copy(t[0]),f&&f.vmult(C,C),I.copy(C);for(let A=1;A<t.length;A++){let y=t[A];f&&(f.vmult(y,tmp$1),y=tmp$1),y.x>I.x&&(I.x=y.x),y.x<C.x&&(C.x=y.x),y.y>I.y&&(I.y=y.y),y.y<C.y&&(C.y=y.y),y.z>I.z&&(I.z=y.z),y.z<C.z&&(C.z=y.z)}return o&&(o.vadd(C,C),o.vadd(I,I)),d&&(C.x-=d,C.y-=d,C.z-=d,I.x+=d,I.y+=d,I.z+=d),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return new AABB().copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const o=this.lowerBound,u=this.upperBound,d=t.lowerBound,C=t.upperBound,I=d.x<=u.x&&u.x<=C.x||o.x<=C.x&&C.x<=u.x,f=d.y<=u.y&&u.y<=C.y||o.y<=C.y&&C.y<=u.y,A=d.z<=u.z&&u.z<=C.z||o.z<=C.z&&C.z<=u.z;return I&&f&&A}volume(){const t=this.lowerBound,o=this.upperBound;return(o.x-t.x)*(o.y-t.y)*(o.z-t.z)}contains(t){const o=this.lowerBound,u=this.upperBound,d=t.lowerBound,C=t.upperBound;return o.x<=d.x&&u.x>=C.x&&o.y<=d.y&&u.y>=C.y&&o.z<=d.z&&u.z>=C.z}getCorners(t,o,u,d,C,I,f,A){const y=this.lowerBound,G=this.upperBound;t.copy(y),o.set(G.x,y.y,y.z),u.set(G.x,G.y,y.z),d.set(y.x,G.y,G.z),C.set(G.x,y.y,G.z),I.set(y.x,G.y,y.z),f.set(y.x,y.y,G.z),A.copy(G)}toLocalFrame(t,o){const u=transformIntoFrame_corners,d=u[0],C=u[1],I=u[2],f=u[3],A=u[4],y=u[5],G=u[6],S=u[7];this.getCorners(d,C,I,f,A,y,G,S);for(let w=0;w!==8;w++){const M=u[w];t.pointToLocal(M,M)}return o.setFromPoints(u)}toWorldFrame(t,o){const u=transformIntoFrame_corners,d=u[0],C=u[1],I=u[2],f=u[3],A=u[4],y=u[5],G=u[6],S=u[7];this.getCorners(d,C,I,f,A,y,G,S);for(let w=0;w!==8;w++){const M=u[w];t.pointToWorld(M,M)}return o.setFromPoints(u)}overlapsRay(t){const{direction:o,from:u}=t,d=1/o.x,C=1/o.y,I=1/o.z,f=(this.lowerBound.x-u.x)*d,A=(this.upperBound.x-u.x)*d,y=(this.lowerBound.y-u.y)*C,G=(this.upperBound.y-u.y)*C,S=(this.lowerBound.z-u.z)*I,w=(this.upperBound.z-u.z)*I,M=Math.max(Math.max(Math.min(f,A),Math.min(y,G)),Math.min(S,w)),V=Math.min(Math.min(Math.max(f,A),Math.max(y,G)),Math.max(S,w));return!(V<0||M>V)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class Quaternion{constructor(t,o,u,d){t===void 0&&(t=0),o===void 0&&(o=0),u===void 0&&(u=0),d===void 0&&(d=1),this.x=t,this.y=o,this.z=u,this.w=d}set(t,o,u,d){return this.x=t,this.y=o,this.z=u,this.w=d,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,o){const u=Math.sin(o*.5);return this.x=t.x*u,this.y=t.y*u,this.z=t.z*u,this.w=Math.cos(o*.5),this}toAxisAngle(t){t===void 0&&(t=new Vec3),this.normalize();const o=2*Math.acos(this.w),u=Math.sqrt(1-this.w*this.w);return u<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/u,t.y=this.y/u,t.z=this.z/u),[t,o]}setFromVectors(t,o){if(t.isAntiparallelTo(o)){const u=sfv_t1,d=sfv_t2;t.tangents(u,d),this.setFromAxisAngle(u,Math.PI)}else{const u=t.cross(o);this.x=u.x,this.y=u.y,this.z=u.z,this.w=Math.sqrt(t.length()**2*o.length()**2)+t.dot(o),this.normalize()}return this}mult(t,o){o===void 0&&(o=new Quaternion);const u=this.x,d=this.y,C=this.z,I=this.w,f=t.x,A=t.y,y=t.z,G=t.w;return o.x=u*G+I*f+d*y-C*A,o.y=d*G+I*A+C*f-u*y,o.z=C*G+I*y+u*A-d*f,o.w=I*G-u*f-d*A-C*y,o}inverse(t){t===void 0&&(t=new Quaternion);const o=this.x,u=this.y,d=this.z,C=this.w;this.conjugate(t);const I=1/(o*o+u*u+d*d+C*C);return t.x*=I,t.y*=I,t.z*=I,t.w*=I,t}conjugate(t){return t===void 0&&(t=new Quaternion),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,o){o===void 0&&(o=new Vec3);const u=t.x,d=t.y,C=t.z,I=this.x,f=this.y,A=this.z,y=this.w,G=y*u+f*C-A*d,S=y*d+A*u-I*C,w=y*C+I*d-f*u,M=-I*u-f*d-A*C;return o.x=G*y+M*-I+S*-A-w*-f,o.y=S*y+M*-f+w*-I-G*-A,o.z=w*y+M*-A+G*-f-S*-I,o}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,o){o===void 0&&(o="YZX");let u,d,C;const I=this.x,f=this.y,A=this.z,y=this.w;switch(o){case"YZX":const G=I*f+A*y;if(G>.499&&(u=2*Math.atan2(I,y),d=Math.PI/2,C=0),G<-.499&&(u=-2*Math.atan2(I,y),d=-Math.PI/2,C=0),u===void 0){const S=I*I,w=f*f,M=A*A;u=Math.atan2(2*f*y-2*I*A,1-2*w-2*M),d=Math.asin(2*G),C=Math.atan2(2*I*y-2*f*A,1-2*S-2*M)}break;default:throw new Error(`Euler order ${o} not supported yet.`)}t.y=u,t.z=d,t.x=C}setFromEuler(t,o,u,d){d===void 0&&(d="XYZ");const C=Math.cos(t/2),I=Math.cos(o/2),f=Math.cos(u/2),A=Math.sin(t/2),y=Math.sin(o/2),G=Math.sin(u/2);return d==="XYZ"?(this.x=A*I*f+C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f-A*y*G):d==="YXZ"?(this.x=A*I*f+C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f+A*y*G):d==="ZXY"?(this.x=A*I*f-C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f-A*y*G):d==="ZYX"?(this.x=A*I*f-C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f+A*y*G):d==="YZX"?(this.x=A*I*f+C*y*G,this.y=C*y*f+A*I*G,this.z=C*I*G-A*y*f,this.w=C*I*f-A*y*G):d==="XZY"&&(this.x=A*I*f-C*y*G,this.y=C*y*f-A*I*G,this.z=C*I*G+A*y*f,this.w=C*I*f+A*y*G),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(t,o,u){u===void 0&&(u=new Quaternion);const d=this.x,C=this.y,I=this.z,f=this.w;let A=t.x,y=t.y,G=t.z,S=t.w,w,M,V,T,H;return M=d*A+C*y+I*G+f*S,M<0&&(M=-M,A=-A,y=-y,G=-G,S=-S),1-M>1e-6?(w=Math.acos(M),V=Math.sin(w),T=Math.sin((1-o)*w)/V,H=Math.sin(o*w)/V):(T=1-o,H=o),u.x=T*d+H*A,u.y=T*C+H*y,u.z=T*I+H*G,u.w=T*f+H*S,u}integrate(t,o,u,d){d===void 0&&(d=new Quaternion);const C=t.x*u.x,I=t.y*u.y,f=t.z*u.z,A=this.x,y=this.y,G=this.z,S=this.w,w=o*.5;return d.x+=w*(C*S+I*G-f*y),d.y+=w*(I*S+f*A-C*G),d.z+=w*(f*S+C*y-I*A),d.w+=w*(-C*A-I*y-f*G),d}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(t){t===void 0&&(t={}),this.id=Shape.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,o){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,o,u,d){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(t){t===void 0&&(t={}),this.position=new Vec3,this.quaternion=new Quaternion,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,o){return Transform.pointToLocalFrame(this.position,this.quaternion,t,o)}pointToWorld(t,o){return Transform.pointToWorldFrame(this.position,this.quaternion,t,o)}vectorToWorldFrame(t,o){return o===void 0&&(o=new Vec3),this.quaternion.vmult(t,o),o}static pointToLocalFrame(t,o,u,d){return d===void 0&&(d=new Vec3),u.vsub(t,d),o.conjugate(tmpQuat$1),tmpQuat$1.vmult(d,d),d}static pointToWorldFrame(t,o,u,d){return d===void 0&&(d=new Vec3),o.vmult(u,d),d.vadd(t,d),d}static vectorToWorldFrame(t,o,u){return u===void 0&&(u=new Vec3),t.vmult(o,u),u}static vectorToLocalFrame(t,o,u,d){return d===void 0&&(d=new Vec3),o.w*=-1,o.vmult(u,d),o.w*=-1,d}}const tmpQuat$1=new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Quaternion;new AABB;new Mat3;new Mat3;new Mat3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,o,u,d,C,I,f){this.rayFromWorld.copy(t),this.rayToWorld.copy(o),this.hitNormalWorld.copy(u),this.hitPointWorld.copy(d),this.shape=C,this.body=I,this.distance=f}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(t,o){t===void 0&&(t=new Vec3),o===void 0&&(o=new Vec3),this.from=t.clone(),this.to=o.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=u=>{}}intersectWorld(t,o){return this.mode=o.mode||Ray.ANY,this.result=o.result||new RaycastResult,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=typeof o.collisionFilterMask<"u"?o.collisionFilterMask:-1,this.collisionFilterGroup=typeof o.collisionFilterGroup<"u"?o.collisionFilterGroup:-1,this.checkCollisionResponse=typeof o.checkCollisionResponse<"u"?o.checkCollisionResponse:!0,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,t.broadphase.aabbQuery(t,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(t,o){o&&(this.result=o,this.updateDirection());const u=this.checkCollisionResponse;if(u&&!t.collisionResponse||(this.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&this.collisionFilterMask)===0)return;const d=intersectBody_xi,C=intersectBody_qi;for(let I=0,f=t.shapes.length;I<f;I++){const A=t.shapes[I];if(!(u&&!A.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[I],C),t.quaternion.vmult(t.shapeOffsets[I],d),d.vadd(t.position,d),this.intersectShape(A,C,d,t),this.result.shouldStop))break}}intersectBodies(t,o){o&&(this.result=o,this.updateDirection());for(let u=0,d=t.length;!this.result.shouldStop&&u<d;u++)this.intersectBody(t[u])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,o,u,d){const C=this.from;if(distanceFromIntersection(C,this.direction,u)>t.boundingSphereRadius)return;const f=this[t.type];f&&f.call(this,t,o,u,d,t)}_intersectBox(t,o,u,d,C){return this._intersectConvex(t.convexPolyhedronRepresentation,o,u,d,C)}_intersectPlane(t,o,u,d,C){const I=this.from,f=this.to,A=this.direction,y=new Vec3(0,0,1);o.vmult(y,y);const G=new Vec3;I.vsub(u,G);const S=G.dot(y);f.vsub(u,G);const w=G.dot(y);if(S*w>0||I.distanceTo(f)<S)return;const M=y.dot(A);if(Math.abs(M)<this.precision)return;const V=new Vec3,T=new Vec3,H=new Vec3;I.vsub(u,V);const J=-y.dot(V)/M;A.scale(J,T),I.vadd(T,H),this.reportIntersection(y,H,C,d,-1)}getAABB(t){const{lowerBound:o,upperBound:u}=t,d=this.to,C=this.from;o.x=Math.min(d.x,C.x),o.y=Math.min(d.y,C.y),o.z=Math.min(d.z,C.z),u.x=Math.max(d.x,C.x),u.y=Math.max(d.y,C.y),u.z=Math.max(d.z,C.z)}_intersectHeightfield(t,o,u,d,C){t.data,t.elementSize;const I=intersectHeightfield_localRay;I.from.copy(this.from),I.to.copy(this.to),Transform.pointToLocalFrame(u,o,I.from,I.from),Transform.pointToLocalFrame(u,o,I.to,I.to),I.updateDirection();const f=intersectHeightfield_index;let A,y,G,S;A=y=0,G=S=t.data.length-1;const w=new AABB;I.getAABB(w),t.getIndexOfPosition(w.lowerBound.x,w.lowerBound.y,f,!0),A=Math.max(A,f[0]),y=Math.max(y,f[1]),t.getIndexOfPosition(w.upperBound.x,w.upperBound.y,f,!0),G=Math.min(G,f[0]+1),S=Math.min(S,f[1]+1);for(let M=A;M<G;M++)for(let V=y;V<S;V++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(M,V,w),!!w.overlapsRay(I)){if(t.getConvexTrianglePillar(M,V,!1),Transform.pointToWorldFrame(u,o,t.pillarOffset,worldPillarOffset),this._intersectConvex(t.pillarConvex,o,worldPillarOffset,d,C,intersectConvexOptions),this.result.shouldStop)return;t.getConvexTrianglePillar(M,V,!0),Transform.pointToWorldFrame(u,o,t.pillarOffset,worldPillarOffset),this._intersectConvex(t.pillarConvex,o,worldPillarOffset,d,C,intersectConvexOptions)}}}_intersectSphere(t,o,u,d,C){const I=this.from,f=this.to,A=t.radius,y=(f.x-I.x)**2+(f.y-I.y)**2+(f.z-I.z)**2,G=2*((f.x-I.x)*(I.x-u.x)+(f.y-I.y)*(I.y-u.y)+(f.z-I.z)*(I.z-u.z)),S=(I.x-u.x)**2+(I.y-u.y)**2+(I.z-u.z)**2-A**2,w=G**2-4*y*S,M=Ray_intersectSphere_intersectionPoint,V=Ray_intersectSphere_normal;if(!(w<0))if(w===0)I.lerp(f,w,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1);else{const T=(-G-Math.sqrt(w))/(2*y),H=(-G+Math.sqrt(w))/(2*y);if(T>=0&&T<=1&&(I.lerp(f,T,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1)),this.result.shouldStop)return;H>=0&&H<=1&&(I.lerp(f,H,M),M.vsub(u,V),V.normalize(),this.reportIntersection(V,M,C,d,-1))}}_intersectConvex(t,o,u,d,C,I){const f=intersectConvex_normal,A=intersectConvex_vector,y=I&&I.faceList||null,G=t.faces,S=t.vertices,w=t.faceNormals,M=this.direction,V=this.from,T=this.to,H=V.distanceTo(T),J=y?y.length:G.length,z=this.result;for(let L=0;!z.shouldStop&&L<J;L++){const K=y?y[L]:L,O=G[K],Q=w[K],ee=o,ie=u;A.copy(S[O[0]]),ee.vmult(A,A),A.vadd(ie,A),A.vsub(V,A),ee.vmult(Q,f);const te=M.dot(f);if(Math.abs(te)<this.precision)continue;const se=f.dot(A)/te;if(!(se<0)){M.scale(se,intersectPoint),intersectPoint.vadd(V,intersectPoint),a.copy(S[O[0]]),ee.vmult(a,a),ie.vadd(a,a);for(let ae=1;!z.shouldStop&&ae<O.length-1;ae++){b.copy(S[O[ae]]),c.copy(S[O[ae+1]]),ee.vmult(b,b),ee.vmult(c,c),ie.vadd(b,b),ie.vadd(c,c);const le=intersectPoint.distanceTo(V);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||le>H||this.reportIntersection(f,intersectPoint,C,d,K)}}}}_intersectTrimesh(t,o,u,d,C,I){const f=intersectTrimesh_normal,A=intersectTrimesh_triangles,y=intersectTrimesh_treeTransform,G=intersectConvex_vector,S=intersectTrimesh_localDirection,w=intersectTrimesh_localFrom,M=intersectTrimesh_localTo,V=intersectTrimesh_worldIntersectPoint,T=intersectTrimesh_worldNormal,H=t.indices;t.vertices;const J=this.from,z=this.to,L=this.direction;y.position.copy(u),y.quaternion.copy(o),Transform.vectorToLocalFrame(u,o,L,S),Transform.pointToLocalFrame(u,o,J,w),Transform.pointToLocalFrame(u,o,z,M),M.x*=t.scale.x,M.y*=t.scale.y,M.z*=t.scale.z,w.x*=t.scale.x,w.y*=t.scale.y,w.z*=t.scale.z,M.vsub(w,S),S.normalize();const K=w.distanceSquared(M);t.tree.rayQuery(this,y,A);for(let O=0,Q=A.length;!this.result.shouldStop&&O!==Q;O++){const ee=A[O];t.getNormal(ee,f),t.getVertex(H[ee*3],a),a.vsub(w,G);const ie=S.dot(f),te=f.dot(G)/ie;if(te<0)continue;S.scale(te,intersectPoint),intersectPoint.vadd(w,intersectPoint),t.getVertex(H[ee*3+1],b),t.getVertex(H[ee*3+2],c);const se=intersectPoint.distanceSquared(w);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||se>K||(Transform.vectorToWorldFrame(o,f,T),Transform.pointToWorldFrame(u,o,intersectPoint,V),this.reportIntersection(T,V,C,d,ee))}A.length=0}reportIntersection(t,o,u,d,C){const I=this.from,f=this.to,A=I.distanceTo(o),y=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(y.hitFaceIndex=typeof C<"u"?C:-1,this.mode){case Ray.ALL:this.hasHit=!0,y.set(I,f,t,o,u,d,A),y.hasHit=!0,this.callback(y);break;case Ray.CLOSEST:(A<y.distance||!y.hasHit)&&(this.hasHit=!0,y.hasHit=!0,y.set(I,f,t,o,u,d,A));break;case Ray.ANY:this.hasHit=!0,y.hasHit=!0,y.set(I,f,t,o,u,d,A),y.shouldStop=!0;break}}static pointInTriangle(t,o,u,d){d.vsub(o,v0),u.vsub(o,v1),t.vsub(o,v2);const C=v0.dot(v0),I=v0.dot(v1),f=v0.dot(v2),A=v1.dot(v1),y=v1.dot(v2);let G,S;return(G=A*f-I*y)>=0&&(S=C*y-I*f)>=0&&G+S<C*A-I*I}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3;new Vec3;new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(n,t,o){o.vsub(n,v0);const u=v0.dot(t);return t.scale(u,intersect),intersect.vadd(n,intersect),o.distanceTo(intersect)}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Ray;new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Transform;new AABB;Shape.types.SPHERE,Shape.types.SPHERE|Shape.types.PLANE,Shape.types.BOX|Shape.types.BOX,Shape.types.SPHERE|Shape.types.BOX,Shape.types.PLANE|Shape.types.BOX,Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,Shape.types.SPHERE|Shape.types.HEIGHTFIELD,Shape.types.BOX|Shape.types.HEIGHTFIELD,Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,Shape.types.PARTICLE|Shape.types.SPHERE,Shape.types.PLANE|Shape.types.PARTICLE,Shape.types.BOX|Shape.types.PARTICLE,Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.CYLINDER,Shape.types.PLANE|Shape.types.CYLINDER,Shape.types.BOX|Shape.types.CYLINDER,Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,Shape.types.PARTICLE|Shape.types.CYLINDER,Shape.types.SPHERE|Shape.types.TRIMESH,Shape.types.PLANE|Shape.types.TRIMESH;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Quaternion;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new AABB;new Ray;const performance$2=globalThis.performance||{};if(!performance$2.now){let n=Date.now();performance$2.timing&&performance$2.timing.navigationStart&&(n=performance$2.timing.navigationStart),performance$2.now=()=>Date.now()-n}new Vec3;const debugContext=reactExports.createContext(null),useDebugContext=()=>reactExports.useContext(debugContext),physicsContext=reactExports.createContext(null),usePhysicsContext=()=>{const n=reactExports.useContext(physicsContext);if(!n)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return n};new Vector3(1,1,1);new Vector3;new Matrix4;const temp=new Object3D;function useForwardedRef(n){const t=reactExports.useRef(null);return n&&typeof n!="function"?n:t}function capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)}function getUUID(n,t){const o=t===void 0?"":`/${t}`;return typeof n=="function"?null:n&&n.current&&`${n.current.uuid}${o}`}const e=new Euler,q$1=new Quaternion$2,quaternionToRotation=n=>t=>n(e.setFromQuaternion(q$1.fromArray(t)).toArray());let incrementingId=0;function subscribe(n,t,o,u,d,C){return C===void 0&&(C="bodies"),I=>{const f=incrementingId++;o[f]={[u]:I};const A=getUUID(n,d);return A&&t.subscribe({props:{id:f,target:C,type:u},uuid:A}),()=>{delete o[f],t.unsubscribe({props:f})}}}function prepare(n,t){let{position:o=[0,0,0],rotation:u=[0,0,0],userData:d={}}=t;n.userData=d,n.position.set(...o),n.rotation.set(...u),n.updateMatrix()}function setupCollision(n,t,o){let{onCollide:u,onCollideBegin:d,onCollideEnd:C}=t;n[o]={collide:u,collideBegin:d,collideEnd:C}}function useBody(n,t,o,u,d){u===void 0&&(u=null),d===void 0&&(d=[]);const C=useForwardedRef(u),{events:I,refs:f,scaleOverrides:A,subscriptions:y,worker:G}=usePhysicsContext(),S=useDebugContext();reactExports.useLayoutEffect(()=>{C.current||(C.current=new Object3D);const M=C.current,V=G,T=M instanceof InstancedMesh?(M.instanceMatrix.setUsage(DynamicDrawUsage),M.count):1,H=M instanceof InstancedMesh?new Array(T).fill(0).map((z,L)=>`${M.uuid}/${L}`):[M.uuid],J=M instanceof InstancedMesh?H.map((z,L)=>{const K=t(L);return prepare(temp,K),M.setMatrixAt(L,temp.matrix),M.instanceMatrix.needsUpdate=!0,f[z]=M,S==null||S.add(z,K,n),setupCollision(I,K,z),{...K,args:o(K.args)}}):H.map((z,L)=>{const K=t(L);return prepare(M,K),f[z]=M,S==null||S.add(z,K,n),setupCollision(I,K,z),{...K,args:o(K.args)}});return V.addBodies({props:J.map(z=>{let{onCollide:L,onCollideBegin:K,onCollideEnd:O,...Q}=z;return{onCollide:!!L,...Q}}),type:n,uuid:H}),()=>{H.forEach(z=>{delete f[z],S==null||S.remove(z),delete I[z]}),V.removeBodies({uuid:H})}},d);const w=reactExports.useMemo(()=>{const M=(L,K)=>{const O=`set${capitalize(L)}`;return{set:Q=>{const ee=getUUID(C,K);ee&&G[O]({props:Q,uuid:ee})},subscribe:subscribe(C,G,y,L,K)}},V=L=>({copy:O=>{let{w:Q,x:ee,y:ie,z:te}=O;const se=getUUID(C,L);se&&G.setQuaternion({props:[ee,ie,te,Q],uuid:se})},set:(O,Q,ee,ie)=>{const te=getUUID(C,L);te&&G.setQuaternion({props:[O,Q,ee,ie],uuid:te})},subscribe:subscribe(C,G,y,"quaternion",L)}),T=L=>({copy:K=>{let{x:O,y:Q,z:ee}=K;const ie=getUUID(C,L);ie&&G.setRotation({props:[O,Q,ee],uuid:ie})},set:(K,O,Q)=>{const ee=getUUID(C,L);ee&&G.setRotation({props:[K,O,Q],uuid:ee})},subscribe:K=>{const O=incrementingId++,Q="bodies",ee="quaternion",ie=getUUID(C,L);return y[O]={[ee]:quaternionToRotation(K)},ie&&G.subscribe({props:{id:O,target:Q,type:ee},uuid:ie}),()=>{delete y[O],G.unsubscribe({props:O})}}}),H=(L,K)=>{const O=`set${capitalize(L)}`;return{copy:Q=>{let{x:ee,y:ie,z:te}=Q;const se=getUUID(C,K);se&&G[O]({props:[ee,ie,te],uuid:se})},set:(Q,ee,ie)=>{const te=getUUID(C,K);te&&G[O]({props:[Q,ee,ie],uuid:te})},subscribe:subscribe(C,G,y,L,K)}};function J(L){return{allowSleep:M("allowSleep",L),angularDamping:M("angularDamping",L),angularFactor:H("angularFactor",L),angularVelocity:H("angularVelocity",L),applyForce(K,O){const Q=getUUID(C,L);Q&&G.applyForce({props:[K,O],uuid:Q})},applyImpulse(K,O){const Q=getUUID(C,L);Q&&G.applyImpulse({props:[K,O],uuid:Q})},applyLocalForce(K,O){const Q=getUUID(C,L);Q&&G.applyLocalForce({props:[K,O],uuid:Q})},applyLocalImpulse(K,O){const Q=getUUID(C,L);Q&&G.applyLocalImpulse({props:[K,O],uuid:Q})},applyTorque(K){const O=getUUID(C,L);O&&G.applyTorque({props:[K],uuid:O})},collisionFilterGroup:M("collisionFilterGroup",L),collisionFilterMask:M("collisionFilterMask",L),collisionResponse:M("collisionResponse",L),fixedRotation:M("fixedRotation",L),isTrigger:M("isTrigger",L),linearDamping:M("linearDamping",L),linearFactor:H("linearFactor",L),mass:M("mass",L),material:M("material",L),position:H("position",L),quaternion:V(L),rotation:T(L),scaleOverride(K){const O=getUUID(C,L);O&&(A[O]=new Vector3(...K))},sleep(){const K=getUUID(C,L);K&&G.sleep({uuid:K})},sleepSpeedLimit:M("sleepSpeedLimit",L),sleepTimeLimit:M("sleepTimeLimit",L),userData:M("userData",L),velocity:H("velocity",L),wakeUp(){const K=getUUID(C,L);K&&G.wakeUp({uuid:K})}}}const z={};return{...J(void 0),at:L=>z[L]||(z[L]=J(L))}},[]);return[C,w]}function usePlane(n,t,o){return useBody("Plane",n,()=>[],t,o)}function useBox(n,t,o){const u=[1,1,1];return useBody("Box",n,function(d){return d===void 0&&(d=u),d},t,o)}function useCylinder(n,t,o){return useBody("Cylinder",n,function(u){return u===void 0&&(u=[]),u},t,o)}function useSphere(n,t,o){return useBody("Sphere",n,function(u){if(u===void 0&&(u=[1]),!Array.isArray(u))throw new Error("useSphere args must be an array");return[u[0]]},t,o)}const v=new Vector3,s=new Vector3(1,1,1),q=new Quaternion$2,m=new Matrix4;function apply(n,t,o,u,d){return u===void 0&&(u=s),n!==void 0?(m.compose(v.fromArray(t,n*3),q.fromArray(o,n*4),u),d&&(d.matrixAutoUpdate=!1,d.matrix.copy(m)),m):m.identity()}const unique=()=>{const n=[];return t=>n.includes(t)?!1:!!n.push(t)};function PhysicsProvider(n){let{allowSleep:t=!1,axisIndex:o=0,broadphase:u="Naive",children:d,defaultContactMaterial:C={contactEquationStiffness:1e6},frictionGravity:I=null,gravity:f=[0,-9.81,0],isPaused:A=!1,iterations:y=5,maxSubSteps:G=10,quatNormalizeFast:S=!1,quatNormalizeSkip:w=0,shouldInvalidate:M=!0,size:V=1e3,solver:T="GS",stepSize:H=1/60,tolerance:J=.001}=n;const{invalidate:z}=useThree(),[{bodies:L,events:K,refs:O,scaleOverrides:Q,subscriptions:ee,worker:ie}]=reactExports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new CannonWorkerAPI({allowSleep:t,axisIndex:o,broadphase:u,defaultContactMaterial:C,frictionGravity:I,gravity:f,iterations:y,quatNormalizeFast:S,quatNormalizeSkip:w,size:V,solver:T,tolerance:J})}));let te=0;const se=reactExports.useCallback((Re,Se)=>{A||(te+=Se,ie.step({maxSubSteps:G,stepSize:H,timeSinceLastCalled:te}),te=0)},[A,G,H]),ae=Re=>{var Se;let{body:Ze,contact:{bi:he,bj:Ie,...Be},target:ue,...me}=Re;const xe=(Se=K[ue])==null?void 0:Se.collide;xe&&xe({body:O[Ze],contact:{bi:O[he],bj:O[Ie],...Be},target:O[ue],...me})},le=Re=>{var Se,Ze;let{bodyA:he,bodyB:Ie}=Re;const Be=(Se=K[he])==null?void 0:Se.collideBegin;Be&&Be({body:O[Ie],op:"event",target:O[he],type:"collideBegin"});const ue=(Ze=K[Ie])==null?void 0:Ze.collideBegin;ue&&ue({body:O[he],op:"event",target:O[Ie],type:"collideBegin"})},ge=Re=>{var Se,Ze;let{bodyA:he,bodyB:Ie}=Re;const Be=(Se=K[he])==null?void 0:Se.collideEnd;Be&&Be({body:O[Ie],op:"event",target:O[he],type:"collideEnd"});const ue=(Ze=K[Ie])==null?void 0:Ze.collideEnd;ue&&ue({body:O[he],op:"event",target:O[Ie],type:"collideEnd"})},be=Re=>{let{active:Se,bodies:Ze=[],observations:he,positions:Ie,quaternions:Be}=Re;for(let ue=0;ue<Ze.length;ue++)L[Ze[ue]]=ue;if(he.forEach(ue=>{let[me,xe,Je]=ue;const Ee=(ee[me]||{})[Je];Ee&&Ee(xe)}),!!Se){for(const ue of Object.values(O).filter(unique()))if(ue instanceof InstancedMesh)for(let me=0;me<ue.count;me++){const xe=`${ue.uuid}/${me}`,Je=L[xe];Je!==void 0&&(ue.setMatrixAt(me,apply(Je,Ie,Be,Q[xe])),ue.instanceMatrix.needsUpdate=!0)}else{const me=Q[ue.uuid]||ue.scale;apply(L[ue.uuid],Ie,Be,me,ue)}M&&z()}},Xe=Re=>{var Se;let{body:Ze,ray:{uuid:he,...Ie},...Be}=Re;const ue=(Se=K[he])==null?void 0:Se.rayhit;ue&&ue({body:Ze?O[Ze]:null,ray:{uuid:he,...Ie},...Be})};useFrame(se),reactExports.useEffect(()=>(ie.connect(),ie.init(),ie.on("collide",ae),ie.on("collideBegin",le),ie.on("collideEnd",ge),ie.on("frame",be),ie.on("rayhit",Xe),()=>{ie.terminate(),ie.removeAllListeners()}),[]),reactExports.useEffect(()=>{ie.axisIndex=o},[o]),reactExports.useEffect(()=>{ie.broadphase=u},[u]),reactExports.useEffect(()=>{ie.gravity=f},[f]),reactExports.useEffect(()=>{ie.iterations=y},[y]),reactExports.useEffect(()=>{ie.tolerance=J},[J]);const Ce=reactExports.useMemo(()=>({bodies:L,events:K,refs:O,scaleOverrides:Q,subscriptions:ee,worker:ie}),[L,K,O,ee,ie]);return jsxRuntimeExports.jsx(physicsContext.Provider,{value:Ce,children:d})}function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var u in o)({}).hasOwnProperty.call(o,u)&&(n[u]=o[u])}return n},_extends.apply(null,arguments)}var __defProp$1=Object.defineProperty,__defNormalProp$1=(n,t,o)=>t in n?__defProp$1(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,__publicField$1=(n,t,o)=>(__defNormalProp$1(n,t+"",o),o);class EventDispatcher{constructor(){__publicField$1(this,"_listeners")}addEventListener(t,o){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[t]===void 0&&(u[t]=[]),u[t].indexOf(o)===-1&&u[t].push(o)}hasEventListener(t,o){if(this._listeners===void 0)return!1;const u=this._listeners;return u[t]!==void 0&&u[t].indexOf(o)!==-1}removeEventListener(t,o){if(this._listeners===void 0)return;const d=this._listeners[t];if(d!==void 0){const C=d.indexOf(o);C!==-1&&d.splice(C,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const u=this._listeners[t.type];if(u!==void 0){t.target=this;const d=u.slice(0);for(let C=0,I=d.length;C<I;C++)d[C].call(this,t);t.target=null}}}var __defProp=Object.defineProperty,__defNormalProp=(n,t,o)=>t in n?__defProp(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,__publicField=(n,t,o)=>(__defNormalProp(n,typeof t!="symbol"?t+"":t,o),o);const _ray=new Ray$2,_plane=new Plane,TILT_LIMIT=Math.cos(70*(Math.PI/180)),moduloWrapAround=(n,t)=>(n%t+t)%t;let OrbitControls$1=class extends EventDispatcher{constructor(t,o){super(),__publicField(this,"object"),__publicField(this,"domElement"),__publicField(this,"enabled",!0),__publicField(this,"target",new Vector3),__publicField(this,"minDistance",0),__publicField(this,"maxDistance",1/0),__publicField(this,"minZoom",0),__publicField(this,"maxZoom",1/0),__publicField(this,"minPolarAngle",0),__publicField(this,"maxPolarAngle",Math.PI),__publicField(this,"minAzimuthAngle",-1/0),__publicField(this,"maxAzimuthAngle",1/0),__publicField(this,"enableDamping",!1),__publicField(this,"dampingFactor",.05),__publicField(this,"enableZoom",!0),__publicField(this,"zoomSpeed",1),__publicField(this,"enableRotate",!0),__publicField(this,"rotateSpeed",1),__publicField(this,"enablePan",!0),__publicField(this,"panSpeed",1),__publicField(this,"screenSpacePanning",!0),__publicField(this,"keyPanSpeed",7),__publicField(this,"zoomToCursor",!1),__publicField(this,"autoRotate",!1),__publicField(this,"autoRotateSpeed",2),__publicField(this,"reverseOrbit",!1),__publicField(this,"reverseHorizontalOrbit",!1),__publicField(this,"reverseVerticalOrbit",!1),__publicField(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),__publicField(this,"mouseButtons",{LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN}),__publicField(this,"touches",{ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN}),__publicField(this,"target0"),__publicField(this,"position0"),__publicField(this,"zoom0"),__publicField(this,"_domElementKeyEvents",null),__publicField(this,"getPolarAngle"),__publicField(this,"getAzimuthalAngle"),__publicField(this,"setPolarAngle"),__publicField(this,"setAzimuthalAngle"),__publicField(this,"getDistance"),__publicField(this,"getZoomScale"),__publicField(this,"listenToKeyEvents"),__publicField(this,"stopListenToKeyEvents"),__publicField(this,"saveState"),__publicField(this,"reset"),__publicField(this,"update"),__publicField(this,"connect"),__publicField(this,"dispose"),__publicField(this,"dollyIn"),__publicField(this,"dollyOut"),__publicField(this,"getScale"),__publicField(this,"setScale"),this.object=t,this.domElement=o,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>G.phi,this.getAzimuthalAngle=()=>G.theta,this.setPolarAngle=ye=>{let Ye=moduloWrapAround(ye,2*Math.PI),_e=G.phi;_e<0&&(_e+=2*Math.PI),Ye<0&&(Ye+=2*Math.PI);let Ne=Math.abs(Ye-_e);2*Math.PI-Ne<Ne&&(Ye<_e?Ye+=2*Math.PI:_e+=2*Math.PI),S.phi=Ye-_e,u.update()},this.setAzimuthalAngle=ye=>{let Ye=moduloWrapAround(ye,2*Math.PI),_e=G.theta;_e<0&&(_e+=2*Math.PI),Ye<0&&(Ye+=2*Math.PI);let Ne=Math.abs(Ye-_e);2*Math.PI-Ne<Ne&&(Ye<_e?Ye+=2*Math.PI:_e+=2*Math.PI),S.theta=Ye-_e,u.update()},this.getDistance=()=>u.object.position.distanceTo(u.target),this.listenToKeyEvents=ye=>{ye.addEventListener("keydown",Rt),this._domElementKeyEvents=ye},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Rt),this._domElementKeyEvents=null},this.saveState=()=>{u.target0.copy(u.target),u.position0.copy(u.object.position),u.zoom0=u.object.zoom},this.reset=()=>{u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.zoom=u.zoom0,u.object.updateProjectionMatrix(),u.dispatchEvent(d),u.update(),A=f.NONE},this.update=(()=>{const ye=new Vector3,Ye=new Vector3(0,1,0),_e=new Quaternion$2().setFromUnitVectors(t.up,Ye),Ne=_e.clone().invert(),St=new Vector3,et=new Quaternion$2,lt=2*Math.PI;return function(){const _t=u.object.position;_e.setFromUnitVectors(t.up,Ye),Ne.copy(_e).invert(),ye.copy(_t).sub(u.target),ye.applyQuaternion(_e),G.setFromVector3(ye),u.autoRotate&&A===f.NONE&&be(le()),u.enableDamping?(G.theta+=S.theta*u.dampingFactor,G.phi+=S.phi*u.dampingFactor):(G.theta+=S.theta,G.phi+=S.phi);let Jt=u.minAzimuthAngle,oi=u.maxAzimuthAngle;isFinite(Jt)&&isFinite(oi)&&(Jt<-Math.PI?Jt+=lt:Jt>Math.PI&&(Jt-=lt),oi<-Math.PI?oi+=lt:oi>Math.PI&&(oi-=lt),Jt<=oi?G.theta=Math.max(Jt,Math.min(oi,G.theta)):G.theta=G.theta>(Jt+oi)/2?Math.max(Jt,G.theta):Math.min(oi,G.theta)),G.phi=Math.max(u.minPolarAngle,Math.min(u.maxPolarAngle,G.phi)),G.makeSafe(),u.enableDamping===!0?u.target.addScaledVector(M,u.dampingFactor):u.target.add(M),u.zoomToCursor&&te||u.object.isOrthographicCamera?G.radius=ue(G.radius):G.radius=ue(G.radius*w),ye.setFromSpherical(G),ye.applyQuaternion(Ne),_t.copy(u.target).add(ye),u.object.matrixAutoUpdate||u.object.updateMatrix(),u.object.lookAt(u.target),u.enableDamping===!0?(S.theta*=1-u.dampingFactor,S.phi*=1-u.dampingFactor,M.multiplyScalar(1-u.dampingFactor)):(S.set(0,0,0),M.set(0,0,0));let Si=!1;if(u.zoomToCursor&&te){let ni=null;if(u.object instanceof PerspectiveCamera&&u.object.isPerspectiveCamera){const gi=ye.length();ni=ue(gi*w);const Ri=gi-ni;u.object.position.addScaledVector(ee,Ri),u.object.updateMatrixWorld()}else if(u.object.isOrthographicCamera){const gi=new Vector3(ie.x,ie.y,0);gi.unproject(u.object),u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom/w)),u.object.updateProjectionMatrix(),Si=!0;const Ri=new Vector3(ie.x,ie.y,0);Ri.unproject(u.object),u.object.position.sub(Ri).add(gi),u.object.updateMatrixWorld(),ni=ye.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),u.zoomToCursor=!1;ni!==null&&(u.screenSpacePanning?u.target.set(0,0,-1).transformDirection(u.object.matrix).multiplyScalar(ni).add(u.object.position):(_ray.origin.copy(u.object.position),_ray.direction.set(0,0,-1).transformDirection(u.object.matrix),Math.abs(u.object.up.dot(_ray.direction))<TILT_LIMIT?t.lookAt(u.target):(_plane.setFromNormalAndCoplanarPoint(u.object.up,u.target),_ray.intersectPlane(_plane,u.target))))}else u.object instanceof OrthographicCamera&&u.object.isOrthographicCamera&&(Si=w!==1,Si&&(u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom/w)),u.object.updateProjectionMatrix()));return w=1,te=!1,Si||St.distanceToSquared(u.object.position)>y||8*(1-et.dot(u.object.quaternion))>y?(u.dispatchEvent(d),St.copy(u.object.position),et.copy(u.object.quaternion),Si=!1,!0):!1}})(),this.connect=ye=>{u.domElement=ye,u.domElement.style.touchAction="none",u.domElement.addEventListener("contextmenu",Oe),u.domElement.addEventListener("pointerdown",de),u.domElement.addEventListener("pointercancel",nt),u.domElement.addEventListener("wheel",rt)},this.dispose=()=>{var ye,Ye,_e,Ne,St,et;u.domElement&&(u.domElement.style.touchAction="auto"),(ye=u.domElement)==null||ye.removeEventListener("contextmenu",Oe),(Ye=u.domElement)==null||Ye.removeEventListener("pointerdown",de),(_e=u.domElement)==null||_e.removeEventListener("pointercancel",nt),(Ne=u.domElement)==null||Ne.removeEventListener("wheel",rt),(St=u.domElement)==null||St.ownerDocument.removeEventListener("pointermove",De),(et=u.domElement)==null||et.ownerDocument.removeEventListener("pointerup",nt),u._domElementKeyEvents!==null&&u._domElementKeyEvents.removeEventListener("keydown",Rt)};const u=this,d={type:"change"},C={type:"start"},I={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let A=f.NONE;const y=1e-6,G=new Spherical,S=new Spherical;let w=1;const M=new Vector3,V=new Vector2,T=new Vector2,H=new Vector2,J=new Vector2,z=new Vector2,L=new Vector2,K=new Vector2,O=new Vector2,Q=new Vector2,ee=new Vector3,ie=new Vector2;let te=!1;const se=[],ae={};function le(){return 2*Math.PI/60/60*u.autoRotateSpeed}function ge(){return Math.pow(.95,u.zoomSpeed)}function be(ye){u.reverseOrbit||u.reverseHorizontalOrbit?S.theta+=ye:S.theta-=ye}function Xe(ye){u.reverseOrbit||u.reverseVerticalOrbit?S.phi+=ye:S.phi-=ye}const Ce=(()=>{const ye=new Vector3;return function(_e,Ne){ye.setFromMatrixColumn(Ne,0),ye.multiplyScalar(-_e),M.add(ye)}})(),Re=(()=>{const ye=new Vector3;return function(_e,Ne){u.screenSpacePanning===!0?ye.setFromMatrixColumn(Ne,1):(ye.setFromMatrixColumn(Ne,0),ye.crossVectors(u.object.up,ye)),ye.multiplyScalar(_e),M.add(ye)}})(),Se=(()=>{const ye=new Vector3;return function(_e,Ne){const St=u.domElement;if(St&&u.object instanceof PerspectiveCamera&&u.object.isPerspectiveCamera){const et=u.object.position;ye.copy(et).sub(u.target);let lt=ye.length();lt*=Math.tan(u.object.fov/2*Math.PI/180),Ce(2*_e*lt/St.clientHeight,u.object.matrix),Re(2*Ne*lt/St.clientHeight,u.object.matrix)}else St&&u.object instanceof OrthographicCamera&&u.object.isOrthographicCamera?(Ce(_e*(u.object.right-u.object.left)/u.object.zoom/St.clientWidth,u.object.matrix),Re(Ne*(u.object.top-u.object.bottom)/u.object.zoom/St.clientHeight,u.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),u.enablePan=!1)}})();function Ze(ye){u.object instanceof PerspectiveCamera&&u.object.isPerspectiveCamera||u.object instanceof OrthographicCamera&&u.object.isOrthographicCamera?w=ye:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),u.enableZoom=!1)}function he(ye){Ze(w/ye)}function Ie(ye){Ze(w*ye)}function Be(ye){if(!u.zoomToCursor||!u.domElement)return;te=!0;const Ye=u.domElement.getBoundingClientRect(),_e=ye.clientX-Ye.left,Ne=ye.clientY-Ye.top,St=Ye.width,et=Ye.height;ie.x=_e/St*2-1,ie.y=-(Ne/et)*2+1,ee.set(ie.x,ie.y,1).unproject(u.object).sub(u.object.position).normalize()}function ue(ye){return Math.max(u.minDistance,Math.min(u.maxDistance,ye))}function me(ye){V.set(ye.clientX,ye.clientY)}function xe(ye){Be(ye),K.set(ye.clientX,ye.clientY)}function Je(ye){J.set(ye.clientX,ye.clientY)}function Ve(ye){T.set(ye.clientX,ye.clientY),H.subVectors(T,V).multiplyScalar(u.rotateSpeed);const Ye=u.domElement;Ye&&(be(2*Math.PI*H.x/Ye.clientHeight),Xe(2*Math.PI*H.y/Ye.clientHeight)),V.copy(T),u.update()}function Ee(ye){O.set(ye.clientX,ye.clientY),Q.subVectors(O,K),Q.y>0?he(ge()):Q.y<0&&Ie(ge()),K.copy(O),u.update()}function Ct(ye){z.set(ye.clientX,ye.clientY),L.subVectors(z,J).multiplyScalar(u.panSpeed),Se(L.x,L.y),J.copy(z),u.update()}function st(ye){Be(ye),ye.deltaY<0?Ie(ge()):ye.deltaY>0&&he(ge()),u.update()}function wt(ye){let Ye=!1;switch(ye.code){case u.keys.UP:Se(0,u.keyPanSpeed),Ye=!0;break;case u.keys.BOTTOM:Se(0,-u.keyPanSpeed),Ye=!0;break;case u.keys.LEFT:Se(u.keyPanSpeed,0),Ye=!0;break;case u.keys.RIGHT:Se(-u.keyPanSpeed,0),Ye=!0;break}Ye&&(ye.preventDefault(),u.update())}function Qe(){if(se.length==1)V.set(se[0].pageX,se[0].pageY);else{const ye=.5*(se[0].pageX+se[1].pageX),Ye=.5*(se[0].pageY+se[1].pageY);V.set(ye,Ye)}}function Ue(){if(se.length==1)J.set(se[0].pageX,se[0].pageY);else{const ye=.5*(se[0].pageX+se[1].pageX),Ye=.5*(se[0].pageY+se[1].pageY);J.set(ye,Ye)}}function Ge(){const ye=se[0].pageX-se[1].pageX,Ye=se[0].pageY-se[1].pageY,_e=Math.sqrt(ye*ye+Ye*Ye);K.set(0,_e)}function Gt(){u.enableZoom&&Ge(),u.enablePan&&Ue()}function ot(){u.enableZoom&&Ge(),u.enableRotate&&Qe()}function vt(ye){if(se.length==1)T.set(ye.pageX,ye.pageY);else{const _e=It(ye),Ne=.5*(ye.pageX+_e.x),St=.5*(ye.pageY+_e.y);T.set(Ne,St)}H.subVectors(T,V).multiplyScalar(u.rotateSpeed);const Ye=u.domElement;Ye&&(be(2*Math.PI*H.x/Ye.clientHeight),Xe(2*Math.PI*H.y/Ye.clientHeight)),V.copy(T)}function at(ye){if(se.length==1)z.set(ye.pageX,ye.pageY);else{const Ye=It(ye),_e=.5*(ye.pageX+Ye.x),Ne=.5*(ye.pageY+Ye.y);z.set(_e,Ne)}L.subVectors(z,J).multiplyScalar(u.panSpeed),Se(L.x,L.y),J.copy(z)}function Tt(ye){const Ye=It(ye),_e=ye.pageX-Ye.x,Ne=ye.pageY-Ye.y,St=Math.sqrt(_e*_e+Ne*Ne);O.set(0,St),Q.set(0,Math.pow(O.y/K.y,u.zoomSpeed)),he(Q.y),K.copy(O)}function xt(ye){u.enableZoom&&Tt(ye),u.enablePan&&at(ye)}function ve(ye){u.enableZoom&&Tt(ye),u.enableRotate&&vt(ye)}function de(ye){var Ye,_e;u.enabled!==!1&&(se.length===0&&((Ye=u.domElement)==null||Ye.ownerDocument.addEventListener("pointermove",De),(_e=u.domElement)==null||_e.ownerDocument.addEventListener("pointerup",nt)),gt(ye),ye.pointerType==="touch"?Mt(ye):dt(ye))}function De(ye){u.enabled!==!1&&(ye.pointerType==="touch"?Yt(ye):ze(ye))}function nt(ye){var Ye,_e,Ne;pt(ye),se.length===0&&((Ye=u.domElement)==null||Ye.releasePointerCapture(ye.pointerId),(_e=u.domElement)==null||_e.ownerDocument.removeEventListener("pointermove",De),(Ne=u.domElement)==null||Ne.ownerDocument.removeEventListener("pointerup",nt)),u.dispatchEvent(I),A=f.NONE}function dt(ye){let Ye;switch(ye.button){case 0:Ye=u.mouseButtons.LEFT;break;case 1:Ye=u.mouseButtons.MIDDLE;break;case 2:Ye=u.mouseButtons.RIGHT;break;default:Ye=-1}switch(Ye){case MOUSE.DOLLY:if(u.enableZoom===!1)return;xe(ye),A=f.DOLLY;break;case MOUSE.ROTATE:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(u.enablePan===!1)return;Je(ye),A=f.PAN}else{if(u.enableRotate===!1)return;me(ye),A=f.ROTATE}break;case MOUSE.PAN:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(u.enableRotate===!1)return;me(ye),A=f.ROTATE}else{if(u.enablePan===!1)return;Je(ye),A=f.PAN}break;default:A=f.NONE}A!==f.NONE&&u.dispatchEvent(C)}function ze(ye){if(u.enabled!==!1)switch(A){case f.ROTATE:if(u.enableRotate===!1)return;Ve(ye);break;case f.DOLLY:if(u.enableZoom===!1)return;Ee(ye);break;case f.PAN:if(u.enablePan===!1)return;Ct(ye);break}}function rt(ye){u.enabled===!1||u.enableZoom===!1||A!==f.NONE&&A!==f.ROTATE||(ye.preventDefault(),u.dispatchEvent(C),st(ye),u.dispatchEvent(I))}function Rt(ye){u.enabled===!1||u.enablePan===!1||wt(ye)}function Mt(ye){switch(mt(ye),se.length){case 1:switch(u.touches.ONE){case TOUCH.ROTATE:if(u.enableRotate===!1)return;Qe(),A=f.TOUCH_ROTATE;break;case TOUCH.PAN:if(u.enablePan===!1)return;Ue(),A=f.TOUCH_PAN;break;default:A=f.NONE}break;case 2:switch(u.touches.TWO){case TOUCH.DOLLY_PAN:if(u.enableZoom===!1&&u.enablePan===!1)return;Gt(),A=f.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(u.enableZoom===!1&&u.enableRotate===!1)return;ot(),A=f.TOUCH_DOLLY_ROTATE;break;default:A=f.NONE}break;default:A=f.NONE}A!==f.NONE&&u.dispatchEvent(C)}function Yt(ye){switch(mt(ye),A){case f.TOUCH_ROTATE:if(u.enableRotate===!1)return;vt(ye),u.update();break;case f.TOUCH_PAN:if(u.enablePan===!1)return;at(ye),u.update();break;case f.TOUCH_DOLLY_PAN:if(u.enableZoom===!1&&u.enablePan===!1)return;xt(ye),u.update();break;case f.TOUCH_DOLLY_ROTATE:if(u.enableZoom===!1&&u.enableRotate===!1)return;ve(ye),u.update();break;default:A=f.NONE}}function Oe(ye){u.enabled!==!1&&ye.preventDefault()}function gt(ye){se.push(ye)}function pt(ye){delete ae[ye.pointerId];for(let Ye=0;Ye<se.length;Ye++)if(se[Ye].pointerId==ye.pointerId){se.splice(Ye,1);return}}function mt(ye){let Ye=ae[ye.pointerId];Ye===void 0&&(Ye=new Vector2,ae[ye.pointerId]=Ye),Ye.set(ye.pageX,ye.pageY)}function It(ye){const Ye=ye.pointerId===se[0].pointerId?se[1]:se[0];return ae[Ye.pointerId]}this.dollyIn=(ye=ge())=>{Ie(ye),u.update()},this.dollyOut=(ye=ge())=>{he(ye),u.update()},this.getScale=()=>w,this.setScale=ye=>{Ze(ye),u.update()},this.getZoomScale=()=>ge(),o!==void 0&&this.connect(o),this.update()}};function shaderMaterial(n,t,o,u){var d;return d=class extends ShaderMaterial{constructor(C){super({vertexShader:t,fragmentShader:o,...C});for(const I in n)this.uniforms[I]=new Uniform(n[I]),Object.defineProperty(this,I,{get(){return this.uniforms[I].value},set(f){this.uniforms[I].value=f}})}},d.key=MathUtils.generateUUID(),d}const getVersion=()=>parseInt(REVISION.replace(/\D+/g,"")),version$1=getVersion(),OrbitControls=reactExports.forwardRef(({makeDefault:n,camera:t,regress:o,domElement:u,enableDamping:d=!0,keyEvents:C=!1,onChange:I,onStart:f,onEnd:A,...y},G)=>{const S=useThree(Q=>Q.invalidate),w=useThree(Q=>Q.camera),M=useThree(Q=>Q.gl),V=useThree(Q=>Q.events),T=useThree(Q=>Q.setEvents),H=useThree(Q=>Q.set),J=useThree(Q=>Q.get),z=useThree(Q=>Q.performance),L=t||w,K=u||V.connected||M.domElement,O=reactExports.useMemo(()=>new OrbitControls$1(L),[L]);return useFrame(()=>{O.enabled&&O.update()},-1),reactExports.useEffect(()=>(C&&O.connect(C===!0?K:C),O.connect(K),()=>void O.dispose()),[C,K,o,O,S]),reactExports.useEffect(()=>{const Q=te=>{S(),o&&z.regress(),I&&I(te)},ee=te=>{f&&f(te)},ie=te=>{A&&A(te)};return O.addEventListener("change",Q),O.addEventListener("start",ee),O.addEventListener("end",ie),()=>{O.removeEventListener("start",ee),O.removeEventListener("end",ie),O.removeEventListener("change",Q)}},[I,f,A,O,S,T]),reactExports.useEffect(()=>{if(n){const Q=J().controls;return H({controls:O}),()=>H({controls:Q})}},[n,O]),reactExports.createElement("primitive",_extends({ref:G,object:O,enableDamping:d},y))}),GridMaterial=shaderMaterial({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new Color,sectionColor:new Color,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Vector3,worldPlanePosition:new Vector3},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${version$1>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Grid=reactExports.forwardRef(({args:n,cellColor:t="#000000",sectionColor:o="#2080ff",cellSize:u=.5,sectionSize:d=1,followCamera:C=!1,infiniteGrid:I=!1,fadeDistance:f=100,fadeStrength:A=1,fadeFrom:y=1,cellThickness:G=.5,sectionThickness:S=1,side:w=BackSide,...M},V)=>{extend({GridMaterial});const T=reactExports.useRef(null);reactExports.useImperativeHandle(V,()=>T.current,[]);const H=new Plane,J=new Vector3(0,1,0),z=new Vector3(0,0,0);useFrame(O=>{H.setFromNormalAndCoplanarPoint(J,z).applyMatrix4(T.current.matrixWorld);const Q=T.current.material,ee=Q.uniforms.worldCamProjPosition,ie=Q.uniforms.worldPlanePosition;H.projectPoint(O.camera.position,ee.value),ie.value.set(0,0,0).applyMatrix4(T.current.matrixWorld)});const L={cellSize:u,sectionSize:d,cellColor:t,sectionColor:o,cellThickness:G,sectionThickness:S},K={fadeDistance:f,fadeStrength:A,fadeFrom:y,infiniteGrid:I,followCamera:C};return reactExports.createElement("mesh",_extends({ref:T,frustumCulled:!1},M),reactExports.createElement("gridMaterial",_extends({transparent:!0,"extensions-derivatives":!0,side:w},L,K)),reactExports.createElement("planeGeometry",{args:n}))});function Sphere({config:n,id:t,onPositionUpdate:o}){const{mass:u,radius:d,position:C,velocity:I,rotation:f=[0,0,0],color:A="red",restitution:y=.7}=n,[G,S]=useSphere(()=>({mass:u,position:C,velocity:I,rotation:f,args:[d],material:{restitution:y}})),w=reactExports.useRef(performance.now()/1e3),M=reactExports.useRef({x:C[0],y:C[1],z:C[2]}),V=.05;return useFrame(()=>{S.position.subscribe(T=>{const[H,J,z]=T,L=performance.now()/1e3-w.current;(Math.abs(H-M.current.x)>V||Math.abs(J-M.current.y)>V||Math.abs(z-M.current.z)>V)&&(M.current={x:H,y:J,z},o({id:t,x:H,y:J,z,t:L}))})}),reactExports.useEffect(()=>{w.current=performance.now()/1e3,M.current={x:C[0],y:C[1],z:C[2]}},[C,I]),jsxRuntimeExports.jsxs("mesh",{ref:G,castShadow:!0,children:[jsxRuntimeExports.jsx("sphereGeometry",{args:[d,32,32]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:A})]})}function Box({config:n,id:t,onPositionUpdate:o}){const{mass:u,dimensions:d,position:C,velocity:I,rotation:f=[0,0,0],color:A="green",restitution:y=.7}=n,[G,S,w]=d||[1,1,1],[M,V]=useBox(()=>({mass:u,position:C,velocity:I,rotation:f,args:[G,S,w],material:{restitution:y}})),T=reactExports.useRef(performance.now()/1e3),H=reactExports.useRef({x:C[0],y:C[1],z:C[2]}),J=.05;return useFrame(()=>{V.position.subscribe(z=>{const[L,K,O]=z,Q=performance.now()/1e3-T.current;(Math.abs(L-H.current.x)>J||Math.abs(K-H.current.y)>J||Math.abs(O-H.current.z)>J)&&(H.current={x:L,y:K,z:O},o({id:t,x:L,y:K,z:O,t:Q}))})}),reactExports.useEffect(()=>{T.current=performance.now()/1e3,H.current={x:C[0],y:C[1],z:C[2]}},[C,I]),jsxRuntimeExports.jsxs("mesh",{ref:M,castShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[G,S,w]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:A})]})}function Cylinder({config:n,id:t,onPositionUpdate:o}){const{mass:u,radius:d,height:C,position:I,velocity:f,rotation:A=[0,0,0],color:y="blue",restitution:G=.7}=n,[S,w]=useCylinder(()=>({mass:u,position:I,velocity:f,rotation:A,args:[d,d,C,16],material:{restitution:G}})),M=reactExports.useRef(performance.now()/1e3),V=reactExports.useRef({x:I[0],y:I[1],z:I[2]}),T=.05;return useFrame(()=>{w.position.subscribe(H=>{const[J,z,L]=H,K=performance.now()/1e3-M.current;(Math.abs(J-V.current.x)>T||Math.abs(z-V.current.y)>T||Math.abs(L-V.current.z)>T)&&(V.current={x:J,y:z,z:L},o({id:t,x:J,y:z,z:L,t:K}))})}),reactExports.useEffect(()=>{M.current=performance.now()/1e3,V.current={x:I[0],y:I[1],z:I[2]}},[I,f]),jsxRuntimeExports.jsxs("mesh",{ref:S,castShadow:!0,children:[jsxRuntimeExports.jsx("cylinderGeometry",{args:[d,d,C,16]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:y})]})}function SceneBox({config:n,id:t,onPositionUpdate:o}){const{mass:u=0,dimensions:d=[10,.2,10],position:C=[0,0,0],velocity:I=[0,0,0],rotation:f=[0,0,0],color:A="#88aa88",restitution:y=.3}=n,[G,S,w]=d,[M,V]=useBox(()=>({mass:u,position:C,velocity:I,rotation:f,args:[G,S,w],material:{friction:.5,restitution:y}})),T=reactExports.useRef(performance.now()/1e3),H=reactExports.useRef({x:C[0],y:C[1],z:C[2]}),J=.05;return useFrame(()=>{V.position.subscribe(z=>{const[L,K,O]=z,Q=performance.now()/1e3-T.current;(Math.abs(L-H.current.x)>J||Math.abs(K-H.current.y)>J||Math.abs(O-H.current.z)>J)&&(H.current={x:L,y:K,z:O},o({id:t,x:L,y:K,z:O,t:Q}))})}),reactExports.useEffect(()=>{T.current=performance.now()/1e3,H.current={x:C[0],y:C[1],z:C[2]}},[C,I]),jsxRuntimeExports.jsxs("mesh",{ref:M,receiveShadow:!0,castShadow:!0,children:[jsxRuntimeExports.jsx("boxGeometry",{args:[G,S,w]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:A})]})}function GroundPlane(){const[n]=usePlane(()=>({mass:0,rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.5,restitution:.3}}));return jsxRuntimeExports.jsxs("mesh",{ref:n,receiveShadow:!0,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[100,100]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#88aa88",side:DoubleSide})]})}function FpsCounter({setFps:n}){const t=reactExports.useRef(performance.now()),o=reactExports.useRef(0);return useFrame(()=>{const u=performance.now();o.current+=1;const d=u-t.current;d>=1e3&&(n(Math.round(o.current*1e3/d)),o.current=0,t.current=u)}),null}function SimpleGrid(){return jsxRuntimeExports.jsx(Grid,{position:[0,.01,0],args:[100,100],cellColor:"#aaaaaa",sectionColor:"#888888",sectionSize:10,cellSize:1,fadeDistance:200,fadeStrength:1,infiniteGrid:!1})}function Visualizer({scene:n,onPositionUpdate:t}){const[o,u]=reactExports.useState(0),{gravity:d=[0,-9.81,0],contactMaterial:C={}}=n||{},I=(n==null?void 0:n.objects)||[],f={friction:C.friction||.5,restitution:C.restitution||.7},A=y=>{t(y)};return jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",background:"#d0e0f0"},children:[jsxRuntimeExports.jsxs(Canvas,{style:{height:"100%",width:"100%"},shadows:!0,gl:{logLevel:"errors"},camera:{position:[10,5,25],fov:50,near:.1,far:2e4},children:[jsxRuntimeExports.jsx("ambientLight",{intensity:.6}),jsxRuntimeExports.jsx("directionalLight",{position:[8,10,5],intensity:1,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024}),jsxRuntimeExports.jsx("pointLight",{position:[-10,-10,-10],intensity:.3}),jsxRuntimeExports.jsxs(PhysicsProvider,{gravity:d,defaultContactMaterial:f,children:[jsxRuntimeExports.jsx(GroundPlane,{})," ",I.map((y,G)=>{var w;const S=y.id||`${((w=y.type)==null?void 0:w.toLowerCase())||"obj"}-${G}`;switch(y.type){case"Sphere":return jsxRuntimeExports.jsx(Sphere,{config:y,id:S,onPositionUpdate:A},S);case"Box":return jsxRuntimeExports.jsx(Box,{config:y,id:S,onPositionUpdate:A},S);case"Cylinder":return jsxRuntimeExports.jsx(Cylinder,{config:y,id:S,onPositionUpdate:A},S);case"Plane":return jsxRuntimeExports.jsx(SceneBox,{config:y,id:S,onPositionUpdate:A},S);default:return console.warn(`Unsupported object type: ${y.type}`),null}})]}),jsxRuntimeExports.jsx(OrbitControls,{}),jsxRuntimeExports.jsx("axesHelper",{args:[5]}),jsxRuntimeExports.jsx(SimpleGrid,{}),jsxRuntimeExports.jsx(FpsCounter,{setFps:u})]}),jsxRuntimeExports.jsxs("div",{className:"fps-counter",style:{position:"absolute",fontSize:"12px",top:"10px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"5px 8px",borderRadius:"4px",zIndex:10},children:["FPS: ",o]})]})}var jxg={};try{typeof JXG=="object"&&!JXG.extend&&(jxg=JXG)}catch{}jxg.extend=function(n,t,o,u){var d,C;o=o||!1,u=u||!1;for(d in t)(!o||o&&t.hasOwnProperty(d))&&(u?C=d.toLowerCase():C=d,n[C]=t[d])};jxg.defineConstant=function(n,t,o,u){u=u||!1,!(u&&jxg.exists(n[t]))&&Object.defineProperty(n,t,{value:o,writable:!1,enumerable:!0,configurable:!1})};jxg.extendConstants=function(n,t,o,u){var d,C;o=o||!1,u=u||!1;for(d in t)(!o||o&&t.hasOwnProperty(d))&&(u?C=d.toUpperCase():C=d,this.defineConstant(n,C,t[d]))};jxg.extend(jxg,{boards:{},readers:{},elements:{},registerElement:function(n,t){n=n.toLowerCase(),this.elements[n]=t},registerReader:function(n,t){var o,u;for(o=0;o<t.length;o++)u=t[o].toLowerCase(),typeof this.readers[u]!="function"&&(this.readers[u]=n)},shortcut:function(n,t){return function(){return n[t].apply(this,arguments)}},getRef:function(n,t){return jxg.deprecated("JXG.getRef()","Board.select()"),n.select(t)},getReference:function(n,t){return jxg.deprecated("JXG.getReference()","Board.select()"),n.select(t)},getBoardByContainerId:function(n){var t;for(t in JXG.boards)if(JXG.boards.hasOwnProperty(t)&&JXG.boards[t].container===n)return JXG.boards[t];return null},deprecated:function(n,t){var o=n+" is deprecated.";t&&(o+=" Please use "+t+" instead."),jxg.warn(o)},warn:function(n){typeof window=="object"&&window.console&&console.warn?console.warn("WARNING:",n):typeof document=="object"&&document.getElementById("warning")&&(document.getElementById("debug").innerHTML+="WARNING: "+n+"<br />")},debugInt:function(n){var t,o;for(t=0;t<arguments.length;t++)o=arguments[t],typeof window=="object"&&window.console&&console.log?console.log(o):typeof document=="object"&&document.getElementById("debug")&&(document.getElementById("debug").innerHTML+=o+"<br/>")},debugWST:function(n){var t=new Error;jxg.debugInt.apply(this,arguments),t&&t.stack&&(jxg.debugInt("stacktrace"),jxg.debugInt(t.stack.split(`
`).slice(1).join(`
`)))},debugLine:function(n){var t=new Error;jxg.debugInt.apply(this,arguments),t&&t.stack&&jxg.debugInt("Called from",t.stack.split(`
`).slice(2,3).join(`
`))},debug:function(n){jxg.debugInt.apply(this,arguments)},themes:{}});const JXG$1=jxg;var major=1,minor=10,patch=1,version=major+"."+minor+"."+patch,constants;constants={version,licenseText:"JSXGraph v"+version+" Copyright (C) see https://jsxgraph.org",COORDS_BY_USER:1,COORDS_BY_SCREEN:2,OBJECT_TYPE_ARC:1,OBJECT_TYPE_ARROW:2,OBJECT_TYPE_AXIS:3,OBJECT_TYPE_AXISPOINT:4,OBJECT_TYPE_TICKS:5,OBJECT_TYPE_CIRCLE:6,OBJECT_TYPE_CONIC:7,OBJECT_TYPE_CURVE:8,OBJECT_TYPE_GLIDER:9,OBJECT_TYPE_IMAGE:10,OBJECT_TYPE_LINE:11,OBJECT_TYPE_POINT:12,OBJECT_TYPE_SLIDER:13,OBJECT_TYPE_CAS:14,OBJECT_TYPE_GXTCAS:15,OBJECT_TYPE_POLYGON:16,OBJECT_TYPE_SECTOR:17,OBJECT_TYPE_TEXT:18,OBJECT_TYPE_ANGLE:19,OBJECT_TYPE_INTERSECTION:20,OBJECT_TYPE_TURTLE:21,OBJECT_TYPE_VECTOR:22,OBJECT_TYPE_OPROJECT:23,OBJECT_TYPE_GRID:24,OBJECT_TYPE_TANGENT:25,OBJECT_TYPE_HTMLSLIDER:26,OBJECT_TYPE_CHECKBOX:27,OBJECT_TYPE_INPUT:28,OBJECT_TYPE_BUTTON:29,OBJECT_TYPE_TRANSFORMATION:30,OBJECT_TYPE_FOREIGNOBJECT:31,OBJECT_TYPE_VIEW3D:32,OBJECT_TYPE_POINT3D:33,OBJECT_TYPE_LINE3D:34,OBJECT_TYPE_PLANE3D:35,OBJECT_TYPE_CURVE3D:36,OBJECT_TYPE_SURFACE3D:37,OBJECT_TYPE_MEASUREMENT:38,OBJECT_TYPE_INTERSECTION_LINE3D:39,OBJECT_TYPE_SPHERE3D:40,OBJECT_TYPE_CIRCLE3D:41,OBJECT_TYPE_INTERSECTION_CIRCLE3D:42,OBJECT_TYPE_TEXT3D:43,OBJECT_CLASS_POINT:1,OBJECT_CLASS_LINE:2,OBJECT_CLASS_CIRCLE:3,OBJECT_CLASS_CURVE:4,OBJECT_CLASS_AREA:5,OBJECT_CLASS_OTHER:6,OBJECT_CLASS_TEXT:7,OBJECT_CLASS_3D:8};JXG$1.extendConstants(JXG$1,constants);const Const=constants;var undef,memoizer=function(n){var t,o;return n.memo||(t={},o=Array.prototype.join,n.memo=function(){var u=o.call(arguments);return t[u]!==undef?t[u]:t[u]=n.apply(this,arguments)}),n.memo};JXG$1.Math={eps:1e-6,relDif:function(n,t){var o=Math.abs(n),u=Math.abs(t);return u=Math.max(o,u),u===0?0:Math.abs(n-t)/u},mod:function(n,t){return n-Math.floor(n/t)*t},wrap:function(n,t,o){return t+this.mod(n-t,o-t)},clamp:function(n,t,o){return Math.min(Math.max(n,t),o)},wrapAndClamp:function(n,t,o,u){var d=.5*(t+o),C=.5*u;return this.clamp(this.wrap(n,d-C,d+C),t,o)},vector:function(n,t){var o,u;for(t=t||0,o=[],u=0;u<n;u++)o[u]=t;return o},matrix:function(n,t,o){var u,d,C;for(o=o||0,t=t||n,u=[],d=0;d<n;d++)for(u[d]=[],C=0;C<t;C++)u[d][C]=o;return u},identity:function(n,t){var o,u;for(t===undef&&typeof t!="number"&&(t=n),o=this.matrix(n,t),u=0;u<Math.min(n,t);u++)o[u][u]=1;return o},frustum:function(n,t,o,u,d,C){var I=this.matrix(4,4);return I[0][0]=d*2/(t-n),I[0][1]=0,I[0][2]=(t+n)/(t-n),I[0][3]=0,I[1][0]=0,I[1][1]=d*2/(u-o),I[1][2]=(u+o)/(u-o),I[1][3]=0,I[2][0]=0,I[2][1]=0,I[2][2]=-(C+d)/(C-d),I[2][3]=-(C*d*2)/(C-d),I[3][0]=0,I[3][1]=0,I[3][2]=-1,I[3][3]=0,I},projection:function(n,t,o,u){var d=o*Math.tan(n/2),C=d*t;return this.frustum(-C,C,-d,d,o,u)},matVecMult:function(n,t){var o,u,d,C=n.length,I=t.length,f=[];if(I===3)for(o=0;o<C;o++)f[o]=n[o][0]*t[0]+n[o][1]*t[1]+n[o][2]*t[2];else for(o=0;o<C;o++){for(u=0,d=0;d<I;d++)u+=n[o][d]*t[d];f[o]=u}return f},matMatMult:function(n,t){var o,u,d,C,I=n.length,f=I>0?t[0].length:0,A=t.length,y=this.matrix(I,f);for(o=0;o<I;o++)for(u=0;u<f;u++){for(d=0,C=0;C<A;C++)d+=n[o][C]*t[C][u];y[o][u]=d}return y},transpose:function(n){var t,o,u,d,C;for(d=n.length,C=n.length>0?n[0].length:0,t=this.matrix(C,d),o=0;o<C;o++)for(u=0;u<d;u++)t[o][u]=n[u][o];return t},inverse:function(n){var t,o,u,d,C,I,f,A=n.length,y=[],G=[],S=[];for(t=0;t<A;t++){for(y[t]=[],o=0;o<A;o++)y[t][o]=n[t][o];G[t]=t}for(o=0;o<A;o++){for(C=Math.abs(y[o][o]),I=o,t=o+1;t<A;t++)Math.abs(y[t][o])>C&&(C=Math.abs(y[t][o]),I=t);if(C<=this.eps)return[];if(I>o){for(u=0;u<A;u++)f=y[o][u],y[o][u]=y[I][u],y[I][u]=f;f=G[o],G[o]=G[I],G[I]=f}for(d=1/y[o][o],t=0;t<A;t++)y[t][o]*=d;for(y[o][o]=d,u=0;u<A;u++)if(u!==o){for(t=0;t<A;t++)t!==o&&(y[t][u]-=y[t][o]*y[o][u]);y[o][u]=-d*y[o][u]}}for(t=0;t<A;t++){for(u=0;u<A;u++)S[G[u]]=y[t][u];for(u=0;u<A;u++)y[t][u]=S[u]}return y},innerProduct:function(n,t,o){var u,d=0;for((o===undef||!JXG$1.isNumber(o))&&(o=n.length),u=0;u<o;u++)d+=n[u]*t[u];return d},crossProduct:function(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]},norm:function(n,t){var o,u=0;for((t===undef||!JXG$1.isNumber(t))&&(t=n.length),o=0;o<t;o++)u+=n[o]*n[o];return Math.sqrt(u)},axpy:function(n,t,o){var u,d=t.length,C=[];for(u=0;u<d;u++)C[u]=n*t[u]+o[u];return C},factorial:memoizer(function(n){return n<0?NaN:(n=Math.floor(n),n===0||n===1?1:n*this.factorial(n-1))}),binomial:memoizer(function(n,t){var o,u;if(t>n||t<0)return NaN;if(t=Math.round(t),n=Math.round(n),t===0||t===n)return 1;for(o=1,u=0;u<t;u++)o*=n-u,o/=u+1;return o}),cosh:Math.cosh||function(n){return(Math.exp(n)+Math.exp(-n))*.5},sinh:Math.sinh||function(n){return(Math.exp(n)-Math.exp(-n))*.5},acosh:Math.acosh||function(n){return Math.log(n+Math.sqrt(n*n-1))},asinh:Math.asinh||function(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))},cot:function(n){return 1/Math.tan(n)},acot:function(n){return(n>=0?.5:-.5)*Math.PI-Math.atan(n)},nthroot:function(n,t){var o=1/t;return t<=0||Math.floor(t)!==t?NaN:n===0?0:n>0?Math.exp(o*Math.log(n)):t%2===1?-Math.exp(o*Math.log(-n)):NaN},cbrt:Math.cbrt||function(n){return this.nthroot(n,3)},pow:function(n,t){return n===0?t===0?1:0:Math.floor(t)===t?Math.pow(n,t):n>0?Math.exp(t*Math.log(n)):NaN},ratpow:function(n,t,o){var u;return t===0?1:o===0?NaN:(u=this.gcd(t,o),this.nthroot(this.pow(n,t/u),o/u))},log10:function(n){return Math.log(n)/Math.log(10)},log2:function(n){return Math.log(n)/Math.log(2)},log:function(n,t){return t!==void 0&&JXG$1.isNumber(t)?Math.log(n)/Math.log(t):Math.log(n)},sign:Math.sign||function(n){return n=+n,n===0||isNaN(n)?n:n>0?1:-1},squampow:function(n,t){var o;if(Math.floor(t)===t){for(o=1,t<0&&(n=1/n,t*=-1);t!==0;)t&1&&(o*=n),t>>=1,n*=n;return o}return this.pow(n,t)},gcd:function(n,t){var o,u=!0;if(n=Math.abs(n),t=Math.abs(t),!(JXG$1.isNumber(n)&&JXG$1.isNumber(t)))return NaN;for(t>n&&(o=n,n=t,t=o);u;){if(n%=t,n===0)return t;if(t%=n,t===0)return n}},lcm:function(n,t){var o;return JXG$1.isNumber(n)&&JXG$1.isNumber(t)?(o=n*t,o!==0?o/this.gcd(n,t):0):NaN},roundToStep:function(n,t,o,u){var d=n,C,I;if(!JXG$1.exists(t)&&!JXG$1.exists(o)&&!JXG$1.exists(u))return d;if(JXG$1.exists(u)&&(d=Math.min(d,u)),JXG$1.exists(o)&&(d=Math.max(d,o)),I=o||0,JXG$1.exists(t)){if(C=(d-I)/t,Number.isInteger(C))return d;C=Math.round(C),d=I+C*t}return JXG$1.exists(u)&&(d=Math.min(d,u)),JXG$1.exists(o)&&(d=Math.max(d,o)),d},erf:function(n){return this.ProbFuncs.erf(n)},erfc:function(n){return this.ProbFuncs.erfc(n)},erfi:function(n){return this.ProbFuncs.erfi(n)},ndtr:function(n){return this.ProbFuncs.ndtr(n)},ndtri:function(n){return this.ProbFuncs.ndtri(n)},hypot:function(){var n,t,o,u;for(t=arguments.length,n=0,u=0;n<t;n++)o=arguments[n],u+=o*o;return Math.sqrt(u)},hstep:function(n){return n>0?1:n<0?0:.5},gamma:function(n){var t,o,u,d,C,I=7,f=[1,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(n<.5)o=Math.PI/(Math.sin(Math.PI*n)*this.gamma(1-n));else{for(n-=1,t=f[0],C=f.length,d=1;d<C;d++)t+=f[d]/(n+d);u=n+I+.5,o=Math.sqrt(2*Math.PI)*Math.pow(u,n+.5)*Math.exp(-u)*t}return o},lt:function(n,t){return n<t},leq:function(n,t){return n<=t},gt:function(n,t){return n>t},geq:function(n,t){return n>=t},eq:function(n,t){return n===t},neq:function(n,t){return n!==t},and:function(n,t){return n&&t},not:function(n){return!n},or:function(n,t){return n||t},xor:function(n,t){return(n||t)&&!(n&&t)},decToFraction:function(n,t){var o,u,d,C,I,f,A,y,G,S=0,w=20;for(t=JXG$1.def(t,.001),n=Math.round(n*1e12)*1e-12,u=n<0?-1:1,n=Math.abs(n),o=Math.floor(n),n-=Math.floor(n),d=0,f=1,C=I=d,G=0,A=y=1;n-Math.floor(n)>t&&S<w;)n=1/(n-d),d=Math.floor(n),C=f+d*I,A=G+d*y,f=I,G=y,I=C,y=A,S++;return[u,o,C,A]},normalize:function(n){var t,o,u=2*n[3],d=n[4]/u;return n[5]=d,n[6]=-n[1]/u,n[7]=-n[2]/u,isFinite(d)?Math.abs(d)>=1?(n[0]=(n[6]*n[6]+n[7]*n[7]-d*d)/(2*d),n[1]=-n[6]/d,n[2]=-n[7]/d,n[3]=1/(2*d),n[4]=1):(o=d<=0?-1:1,n[0]=o*(n[6]*n[6]+n[7]*n[7]-d*d)*.5,n[1]=-o*n[6],n[2]=-o*n[7],n[3]=o/2,n[4]=o*d):(t=this.hypot(n[1],n[2]),n[0]/=t,n[1]/=t,n[2]/=t,n[3]=0,n[4]=1),n},toGL:function(n){var t,o,u;if(typeof Float32Array=="function"?t=new Float32Array(16):t=new Array(16),n.length!==4&&n[0].length!==4)return t;for(o=0;o<4;o++)for(u=0;u<4;u++)t[o+4*u]=n[o][u];return t},Vieta:function(n){var t=n.length,o=[],u,d,C;for(o=n.slice(),u=1;u<t;++u){for(C=o[u],o[u]*=o[u-1],d=u-1;d>=1;--d)o[d]+=o[d-1]*C;o[0]+=C}return o}};const Mat=JXG$1.Math;JXG$1.extend(JXG$1,{isBoard:function(n){return n!==null&&typeof n=="object"&&this.isNumber(n.BOARD_MODE_NONE)&&this.isObject(n.objects)&&this.isObject(n.jc)&&this.isFunction(n.update)&&!!n.containerObj&&this.isString(n.id)},isId:function(n,t){return typeof t=="string"&&!!n.objects[t]},isName:function(n,t){return typeof t=="string"&&!!n.elementsByName[t]},isGroup:function(n,t){return typeof t=="string"&&!!n.groups[t]},isString:function(n){return typeof n=="string"},isNumber:function(n,t,o){var u=typeof n=="number"||Object.prototype.toString.call(n)==="[Object Number]";return t=t||!1,o=o===void 0?!0:o,t&&(u=u||""+parseFloat(n)===n),o||(u=u&&!isNaN(n)),u},isFunction:function(n){return typeof n=="function"},isArray:function(n){var t;return Array.isArray?t=Array.isArray(n):t=n!==null&&typeof n=="object"&&typeof n.splice=="function"&&typeof n.join=="function",t},isObject:function(n){return typeof n=="object"&&!this.isArray(n)},isDocumentOrFragment:function(n){return this.isObject(n)&&(n.nodeType===9||n.nodeType===11)},isPoint:function(n){return n!==null&&typeof n=="object"&&this.exists(n.elementClass)?n.elementClass===Const.OBJECT_CLASS_POINT:!1},isPoint3D:function(n){return n!==null&&typeof n=="object"&&this.exists(n.type)?n.type===Const.OBJECT_TYPE_POINT3D:!1},isPointType:function(n,t){var o,u;return this.isArray(t)||this.isFunction(t)&&(o=t(),this.isArray(o)&&o.length>1)?!0:(u=n.select(t),this.isPoint(u))},isPointType3D:function(n,t){var o,u;return this.isArray(t)&&t.length>=3||this.isFunction(t)&&(o=t(),this.isArray(o)&&o.length>=3)?!0:(u=n.select(t),this.isPoint3D(u))},isTransformationOrArray:function(n){if(n!==null){if(this.isArray(n)&&n.length>0)return this.isTransformationOrArray(n[0]);if(typeof n=="object")return n.type===Const.OBJECT_TYPE_TRANSFORMATION}return!1},isEmpty:function(n){return Object.keys(n).length===0},exists:function(n,t){var o=!(n==null||n===null);return t=t||!1,t?o&&n!=="":o},def:function(n,t){return this.exists(n)?n:t},str2Bool:function(n){return this.exists(n)?typeof n=="boolean"?n:this.isString(n)?n.toLowerCase()==="true":!1:!0},cssParse:function(n){var t=n;return this.isString(t)?(t=t.replace(/\s*;\s*$/g,""),t=t.replace(/\s*;\s*/g,'","'),t=t.replace(/\s*:\s*/g,'":"'),t=t.trim(),t='{"'+t+'"}',JSON.parse(t)):{}},cssStringify:function(n){var t="",o,u;if(!this.isObject(n))return"";for(o in n)n.hasOwnProperty(o)&&(u=n[o],!(!this.isString(u)&&!this.isNumber(u))&&(t+=o+":"+u+"; "));return t=t.trim(),t},createEvalFunction:function(n,t,o){var u=[],d,C,I,f={};for(C=0;C<o;C++){u[C]=JXG$1.createFunction(t[C],n);for(I in u[C].deps)f[I]=u[C].deps}return d=function(A){return u[A]()},d.deps=f,d},createFunction:function(n,t,o,u){var d=null;return this.isString(n)?d=t.jc.snippet(n,!0,o,!1):this.isFunction(n)?(d=n,d.deps=this.isObject(n.deps)?n.deps:{}):this.isNumber(n)&&(d=function(){return n},d.deps={}),d!==null&&(d.origin=n),d},providePoints:function(n,t,o,u,d){var C,I,f,A=0,y=[],G,S;for(this.isArray(t)||(t=[t]),f=t.length,this.exists(d)&&(A=d.length),A===0&&(G=this.copyAttributes(o,n.options,u)),C=0;C<f;++C)if(A>0&&(I=Math.min(C,A-1),G=this.copyAttributes(o,n.options,u,d[I].toLowerCase())),this.isArray(t[C])&&t[C].length>1?(y.push(n.create("point",t[C],G)),y[y.length-1]._is_new=!0):this.isFunction(t[C])?(S=t[C](),this.isArray(S)&&S.length>1&&(y.push(n.create("point",[t[C]],G)),y[y.length-1]._is_new=!0)):y.push(n.select(t[C])),!this.isPoint(y[C]))return!1;return y},providePoints3D:function(n,t,o,u,d){var C,I,f,A=0,y=[],G,S;for(this.isArray(t)||(t=[t]),f=t.length,this.exists(d)&&(A=d.length),A===0&&(G=this.copyAttributes(o,n.board.options,u)),C=0;C<f;++C)if(A>0&&(I=Math.min(C,A-1),G=this.copyAttributes(o,n.board.options,u,d[I])),this.isArray(t[C])&&t[C].length>1?(y.push(n.create("point3d",t[C],G)),y[y.length-1]._is_new=!0):this.isFunction(t[C])?(S=t[C](),this.isArray(S)&&S.length>1&&(y.push(n.create("point3d",[t[C]],G)),y[y.length-1]._is_new=!0)):y.push(n.select(t[C])),!this.isPoint3D(y[C]))return!1;return y},bind:function(n,t){return function(){return n.apply(t,arguments)}},evaluate:function(n){return this.isFunction(n)?n():n},indexOf:function(n,t,o){var u,d=this.exists(o);if(Array.indexOf&&!d)return n.indexOf(t);for(u=0;u<n.length;u++)if(d&&n[u][o]===t||!d&&n[u]===t)return u;return-1},eliminateDuplicates:function(n){var t,o=n.length,u=[],d={};for(t=0;t<o;t++)d[n[t]]=0;for(t in d)d.hasOwnProperty(t)&&u.push(t);return u},swap:function(n,t,o){var u;return u=n[t],n[t]=n[o],n[o]=u,n},uniqueArray:function(n){var t,o,u,d=[];if(n.length===0)return[];for(t=0;t<n.length;t++){if(u=this.isArray(n[t]),!this.exists(n[t])){n[t]="";continue}for(o=t+1;o<n.length;o++)u&&JXG$1.cmpArrays(n[t],n[o])?n[t]=[]:!u&&n[t]===n[o]&&(n[t]="")}for(o=0,t=0;t<n.length;t++)u=this.isArray(n[t]),!u&&n[t]!==""?(d[o]=n[t],o++):u&&n[t].length!==0&&(d[o]=n[t].slice(0),o++);return n=d,d},isInArray:function(n,t){return JXG$1.indexOf(n,t)>-1},coordsArrayToMatrix:function(n,t){var o,u=[],d=[];for(o=0;o<n.length;o++)t?(u.push(n[o].usrCoords[1]),d.push(n[o].usrCoords[2])):d.push([n[o].usrCoords[1],n[o].usrCoords[2]]);return t&&(d=[u,d]),d},cmpArrays:function(n,t){var o;if(n===t)return!0;if(n.length!==t.length)return!1;for(o=0;o<n.length;o++)if(this.isArray(n[o])&&this.isArray(t[o])){if(!this.cmpArrays(n[o],t[o]))return!1}else if(n[o]!==t[o])return!1;return!0},removeElementFromArray:function(n,t){var o;for(o=0;o<n.length;o++)if(n[o]===t)return n.splice(o,1),n;return n},trunc:function(n,t){return t=JXG$1.def(t,0),this.toFixed(n,t)},_decimalAdjust:function(n,t,o){return o===void 0||+o==0?Math[n](t):(t=+t,o=+o,isNaN(t)||!(typeof o=="number"&&o%1===0)?NaN:(t=t.toString().split("e"),t=Math[n](+(t[0]+"e"+(t[1]?+t[1]-o:-o))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+o:o))))},_round10:function(n,t){return this._decimalAdjust("round",n,t)},_floor10:function(n,t){return this._decimalAdjust("floor",n,t)},_ceil10:function(n,t){return this._decimalAdjust("ceil",n,t)},toFixed:function(n,t){return this._round10(n,-t).toFixed(t)},autoDigits:function(n){var t=Math.abs(n),o;return t>=.1?o=this.toFixed(n,2):t>=.01?o=this.toFixed(n,4):t>=1e-4?o=this.toFixed(n,6):o=n,o},parseNumber:function(n,t,o){var u;return this.isString(n)&&n.indexOf("%")>-1?(u=n.replace(/\s+%\s+/,""),parseFloat(u)*t*.01):this.isString(n)&&n.indexOf("fr")>-1?(u=n.replace(/\s+fr\s+/,""),parseFloat(u)*t):this.isString(n)&&n.indexOf("px")>-1?(u=n.replace(/\s+px\s+/,""),u=parseFloat(u),this.isFunction(o)?o(u):this.isNumber(o)?u*o:u):parseFloat(n)},parsePosition:function(n){var t,o,u="",d="";if(n=n.trim(),n!=="")for(t=n.split(/[ ,]+/),o=0;o<t.length;o++)t[o]==="left"||t[o]==="right"?u=t[o]:d=t[o];return{side:u,pos:d}},keys:function(n,t){var o=[],u;for(u in n)t?n.hasOwnProperty(u)&&o.push(u):o.push(u);return o},clone:function(n){var t={};return t.prototype=n,t},cloneAndCopy:function(n,t){var o,u=function(){};u.prototype=n;for(o in t)u[o]=t[o];return u},merge:function(n,t){var o,u,d,C;for(o in t)if(t.hasOwnProperty(o))if(d=t[o],this.isArray(d))for(n[o]||(n[o]=[]),u=0;u<d.length;u++)C=t[o][u],typeof t[o][u]=="object"?n[o][u]=this.merge(n[o][u],C):n[o][u]=t[o][u];else typeof d=="object"?(n[o]||(n[o]={}),n[o]=this.merge(n[o],d)):(typeof n=="boolean"&&(n={}),n[o]=d);return n},deepCopy:function(n,t,o){var u,d,C,I;if(o=o||!1,typeof n!="object"||n===null)return n;if(this.isArray(n))for(u=[],d=0;d<n.length;d++)C=n[d],C!==null&&typeof C=="object"?this.exists(C.board)?u[d]=C.id:u[d]=this.deepCopy(C,{},o):u[d]=C;else{u={};for(d in n)n.hasOwnProperty(d)&&(I=o?d.toLowerCase():d,C=n[d],C!==null&&typeof C=="object"?this.exists(C.board)?u[I]=C.id:u[I]=this.deepCopy(C,{},o):u[I]=C);for(d in t)t.hasOwnProperty(d)&&(I=o?d.toLowerCase():d,C=t[d],C!==null&&typeof C=="object"?this.isArray(C)||!this.exists(u[I])?u[I]=this.deepCopy(C,{},o):u[I]=this.deepCopy(u[I],C,o):u[I]=C)}return u},mergeAttr:function(n,t,o,u){var d,C,I;o=o||!0,u=u||!1;for(d in t)t.hasOwnProperty(d)&&(C=o?d.toLowerCase():d,C!==d&&n.hasOwnProperty(d)&&(n.hasOwnProperty(C)?this.mergeAttr(n[C],n[d],o):n[C]=n[d],delete n[d]),I=t[d],this.isObject(I)&&I!==null&&!this.isDocumentOrFragment(I)&&!this.exists(I.board)&&typeof I.valueOf()!="string"?((n[C]===void 0||n[C]===null||!this.isObject(n[C]))&&(n[C]={}),this.mergeAttr(n[C],I,o)):(!u||this.exists(I))&&(n[C]=I))},keysToLowerCase:function(n){var t,o,u=Object.keys(n),d=u.length,C={};if(typeof n!="object")return n;for(;d--;)t=u[d],n.hasOwnProperty(t)&&(o=n[t],typeof o=="object"&&o!==null&&!this.isArray(o)&&!this.exists(o.nodeType)&&!this.exists(o.board)?C[t.toLowerCase()]=this.keysToLowerCase(o):C[t.toLowerCase()]=o);return C},copyAttributes:function(n,t,o){var u,d,C,I,f,A,y={circle:1,curve:1,foreignobject:1,image:1,line:1,point:1,polygon:1,text:1,ticks:1,integral:1};for(I=arguments.length,I<3||y[o]?u=JXG$1.deepCopy(t.elements,null,!0):u={},I<4&&this.exists(o)&&this.exists(t.layer[o])&&(u.layer=t.layer[o]),f=t,A=!0,C=2;C<I;C++)if(d=arguments[C],this.exists(f[d]))f=f[d];else{A=!1;break}for(A&&(u=JXG$1.deepCopy(u,f,!0)),f=typeof n=="object"?this.keysToLowerCase(n):{},A=!0,C=3;C<I;C++)if(d=arguments[C].toLowerCase(),this.exists(f[d]))f=f[d];else{A=!1;break}if(A&&this.mergeAttr(u,f,!0),arguments[2]==="board")return u;for(f=t,A=!0,C=2;C<I;C++)if(d=arguments[C],this.exists(f[d]))f=f[d];else{A=!1;break}return A&&this.exists(f.label)&&(u.label=JXG$1.deepCopy(f.label,u.label,!0)),u.label=JXG$1.deepCopy(t.label,u.label,!0),u},copyPrototypeMethods:function(n,t,o){var u;n.prototype[o]=t.prototype.constructor;for(u in t.prototype)t.prototype.hasOwnProperty(u)&&(n.prototype[u]=t.prototype[u])},toJSON:function(n,t){var o,u,d,C,I;if(t=JXG$1.def(t,!1),JSON!==void 0&&JSON.stringify&&!t)try{return C=JSON.stringify(n),C}catch{}switch(typeof n){case"object":if(n){if(o=[],this.isArray(n)){for(d=0;d<n.length;d++)o.push(JXG$1.toJSON(n[d],t));return"["+o.join(",")+"]"}for(u in n)if(n.hasOwnProperty(u)){try{I=JXG$1.toJSON(n[u],t)}catch{I=""}t?o.push(u+":"+I):o.push('"'+u+'":'+I)}return"{"+o.join(",")+"} "}return"null";case"string":return"'"+n.replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return n.toString()}return"0"},clearVisPropOld:function(n){return n.visPropOld={cssclass:"",cssdefaultstyle:"",cssstyle:"",fillcolor:"",fillopacity:"",firstarrow:!1,fontsize:-1,lastarrow:!1,left:-1e5,linecap:"",shadow:!1,strokecolor:"",strokeopacity:"",strokewidth:"",tabindex:-1e5,transitionduration:0,top:-1e5,visible:null},n},isInObject:function(n,t){var o;for(o in n)if(n.hasOwnProperty(o)&&n[o]===t)return!0;return!1},escapeHTML:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(n){return n.replace(/<\/?[^>]+>/gi,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},capitalize:function(n){return n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()},trimNumber:function(n){return n=n.replace(/^0+/,""),n=n.replace(/0+$/,""),(n[n.length-1]==="."||n[n.length-1]===",")&&(n=n.slice(0,-1)),(n[0]==="."||n[0]===",")&&(n="0"+n),n},filterElements:function(n,t){var o,u,d,C,I,f,A,y=n.length,G=[];if(typeof t!="function"&&typeof t!="object")return G;for(o=0;o<y;o++){if(A=!0,d=n[o],typeof t=="object"){for(u in t)if(t.hasOwnProperty(u)&&(C=u.toLowerCase(),typeof d[u]=="function"?I=d[u]():I=d[u],d.visProp&&typeof d.visProp[C]=="function"?f=d.visProp[C]():f=d.visProp&&d.visProp[C],typeof t[u]=="function"?A=t[u](I)||t[u](f):A=I===t[u]||f===t[u],!A))break}else typeof t=="function"&&(A=t(d));A&&G.push(d)}return G},trim:function(n){return n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},toFraction:function(n,t,o){var u=Mat.decToFraction(n,o),d="";return u[1]===0&&u[2]===0?d+="0":(u[0]<0&&(d+="-"),u[2]===0?d+=u[1]:u[2]===1&&u[3]===1||(u[1]!==0&&(d+=u[1]+" "),t===!0?d+="\\frac{"+u[2]+"}{"+u[3]+"}":d+=u[2]+"/"+u[3])),d},concat:function(n,t){var o,u=t.length;for(o=0;o<u;o++)n.push(t[o]);return n},sanitizeHTML:function(n,t){return typeof html_sanitize=="function"&&t?html_sanitize(n,function(){},function(o){return o}):(n&&typeof n=="string"&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;")),n)},evalSlider:function(n){return n&&n.type===Const.OBJECT_TYPE_GLIDER&&typeof n.Value=="function"?n.Value():n},stack2jsxgraph:function(n){var t;return t=n.replace(/%pi/g,"PI").replace(/%e/g,"EULER").replace(/%phi/g,"1.618033988749895").replace(/%gamma/g,"0.5772156649015329").trim(),t[0]==="["&&t[t.length-1]==="]"&&(t=t.slice(1,-1).split(/\s*,\s*/)),t}});JXG$1.extendConstants(JXG$1,{});JXG$1.extend(JXG$1,{isTouchEvent:function(n){return JXG$1.exists(n.touches)},isPointerEvent:function(n){return JXG$1.exists(n.pointerId)},isMouseEvent:function(n){return!JXG$1.isTouchEvent(n)&&!JXG$1.isPointerEvent(n)},getNumberOfTouchPoints:function(n){var t=-1;return JXG$1.isTouchEvent(n)&&(t=n.touches.length),t},isFirstTouch:function(n){var t=JXG$1.getNumberOfTouchPoints(n);return JXG$1.isPointerEvent(n)?n.isPrimary:t===1},isBrowser:typeof window=="object"&&typeof document=="object",supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch{return!1}},supportsVML:function(){return this.isBrowser&&!!document.namespaces},supportsSVG:function(){var n;return this.isBrowser?(n=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,n):!1},supportsCanvas:function(){var n=!1;return this.isNode()&&(n=!0),n||this.isBrowser&&!!document.createElement("canvas").getContext},isNode:function(){return!this.isBrowser&&typeof process<"u"&&process.release.name.search(/node|io.js/)!==-1},isWebWorker:function(){return!this.isBrowser&&typeof self=="object"&&typeof self.postMessage=="function"},supportsPointerEvents:function(){return!!(this.isBrowser&&window.navigator&&(window.PointerEvent||window.navigator.pointerEnabled||window.navigator.msPointerEnabled))},isTouchDevice:function(){return this.isBrowser&&window.ontouchstart!==void 0},isAndroid:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")>-1},isWebkitAndroid:function(){return this.isAndroid()&&navigator.userAgent.indexOf(" AppleWebKit/")>-1},isApple:function(){return JXG$1.exists(navigator)&&(navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPhone")>-1)},isWebkitApple:function(){return this.isApple()&&navigator.userAgent.search(/Mobile\/[0-9A-Za-z.]*Safari/)>-1},isMetroApp:function(){return typeof window=="object"&&window.clientInformation&&window.clientInformation.appVersion&&window.clientInformation.appVersion.indexOf("MSAppHost")>-1},isMozilla:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1},isFirefoxOS:function(){return JXG$1.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")===-1&&navigator.userAgent.toLowerCase().indexOf("apple")===-1&&navigator.userAgent.toLowerCase().indexOf("mobile")>-1&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1},isDesktop:function(){return!0},isMobile:function(){return!0},ieVersion:function(){var n,t,o=3;if(typeof document!="object")return 0;n=document.createElement("div"),t=n.getElementsByTagName("i");do n.innerHTML="<!--[if gt IE "+ ++o+"]><i></i><![endif]-->";while(t[0]);return o>4?o:void 0}(),getDimensions:function(n,t){var o,u,d,C,I,f,A,y,G,S=/\d+(\.\d*)?px/;if(!this.isBrowser||n===null)return{width:500,height:500};if(t=t||document,o=JXG$1.isString(n)?t.getElementById(n):n,!JXG$1.exists(o))throw new Error(`
JSXGraph: HTML container element '`+n+"' not found.");return u=o.style.display,u!=="none"&&u!==null?o.clientWidth>0&&o.clientHeight>0?{width:o.clientWidth,height:o.clientHeight}:(G=window.getComputedStyle?window.getComputedStyle(o):o.style,{width:S.test(G.width)?parseFloat(G.width):0,height:S.test(G.height)?parseFloat(G.height):0}):(d=o.style,C=d.visibility,I=d.position,f=d.display,d.visibility="hidden",d.position="absolute",d.display="block",A=o.clientWidth,y=o.clientHeight,d.display=f,d.position=I,d.visibility=C,{width:A,height:y})},addEvent:function(n,t,o,u,d){var C=function(){return o.apply(u,arguments)};C.origin=o,typeof u=="object"&&JXG$1.exists(u.BOARD_MODE_NONE)&&(u["x_internal"+t]=u["x_internal"+t]||[],u["x_internal"+t].push(C)),JXG$1.exists(n)&&JXG$1.exists(n.addEventListener)&&(d=d||!1,n.addEventListener(t,C,d)),JXG$1.exists(n)&&JXG$1.exists(n.attachEvent)&&n.attachEvent("on"+t,C)},removeEvent:function(n,t,o,u){var d;if(!JXG$1.exists(u)){JXG$1.debug("no such owner");return}if(!JXG$1.exists(u["x_internal"+t])){JXG$1.debug("removeEvent: no such type: "+t);return}if(!JXG$1.isArray(u["x_internal"+t])){JXG$1.debug("owner[x_internal + "+t+"] is not an array");return}if(d=JXG$1.indexOf(u["x_internal"+t],o,"origin"),d===-1){JXG$1.debug("removeEvent: no such event function in internal list: "+o);return}try{JXG$1.exists(n)&&JXG$1.exists(n.removeEventListener)&&n.removeEventListener(t,u["x_internal"+t][d],!1),JXG$1.exists(n)&&JXG$1.exists(n.detachEvent)&&n.detachEvent("on"+t,u["x_internal"+t][d])}catch{JXG$1.debug("removeEvent: event not registered in browser: ("+t+" -- "+o+")")}u["x_internal"+t].splice(d,1)},removeAllEvents:function(n,t,o){var u,d;if(o["x_internal"+t]){for(d=o["x_internal"+t].length,u=d-1;u>=0;u--)JXG$1.removeEvent(n,t,o["x_internal"+t][u].origin,o);o["x_internal"+t].length>0&&JXG$1.debug("removeAllEvents: Not all events could be removed.")}},getPosition:function(n,t,o){var u,d,C,I=0,f=0;if(n||(n=window.event),C=n.touches,JXG$1.exists(C)&&C.length===0&&(C=n.changedTouches),JXG$1.exists(t)&&JXG$1.exists(C))if(t===-1){for(d=C.length,u=0;u<d;u++)if(C[u]){n=C[u];break}}else n=C[t];return n.clientX&&(I=n.clientX,f=n.clientY),[I,f]},getOffset:function(n){var t,o=n,u=n,d=o.offsetLeft-o.scrollLeft,C=o.offsetTop-o.scrollTop;for(t=this.getCSSTransform([d,C],o),d=t[0],C=t[1],o=o.offsetParent;o;){for(d+=o.offsetLeft,C+=o.offsetTop,o.offsetParent&&(d+=o.clientLeft-o.scrollLeft,C+=o.clientTop-o.scrollTop),t=this.getCSSTransform([d,C],o),d=t[0],C=t[1],u=u.parentNode;u!==o;)d+=u.clientLeft-u.scrollLeft,C+=u.clientTop-u.scrollTop,t=this.getCSSTransform([d,C],u),d=t[0],C=t[1],u=u.parentNode;o=o.offsetParent}return[d,C]},getStyle:function(n,t){var o,u=n.ownerDocument;return u.defaultView&&u.defaultView.getComputedStyle?o=u.defaultView.getComputedStyle(n,null).getPropertyValue(t):n.currentStyle&&JXG$1.ieVersion>=9?o=n.currentStyle[t]:n.style&&(t=t.replace(/-([a-z]|[0-9])/gi,function(d,C){return C.toUpperCase()}),o=n.style[t]),o},getProp:function(n,t){var o=parseInt(this.getStyle(n,t),10);return isNaN(o)?0:o},getCSSTransform:function(n,t){var o,u,d,C,I,f,A,y,G=["transform","webkitTransform","MozTransform","msTransform","oTransform"];for(f=G.length,o=0,d="";o<f;o++)if(JXG$1.exists(t.style[G[o]])){d=t.style[G[o]];break}if(d!==""&&(I=d.indexOf("("),I>0)){for(f=d.length,C=d.substring(I+1,f-1),y=C.split(","),u=0,A=y.length;u<A;u++)y[u]=parseFloat(y[u]);d.indexOf("matrix")===0?(n[0]+=y[4],n[1]+=y[5]):d.indexOf("translateX")===0?n[0]+=y[0]:d.indexOf("translateY")===0?n[1]+=y[0]:d.indexOf("translate")===0&&(n[0]+=y[0],n[1]+=y[1])}return JXG$1.exists(t.style.zoom)&&(d=t.style.zoom,d!==""&&(n[0]*=parseFloat(d),n[1]*=parseFloat(d))),n},getCSSTransformMatrix:function(n){var t,o,u,d,C,I,f,A,y,G=n.ownerDocument,S=["transform","webkitTransform","MozTransform","msTransform","oTransform"],w=[[1,0,0],[0,1,0],[0,0,1]];if(G.defaultView&&G.defaultView.getComputedStyle)y=G.defaultView.getComputedStyle(n,null),u=y.getPropertyValue("-webkit-transform")||y.getPropertyValue("-moz-transform")||y.getPropertyValue("-ms-transform")||y.getPropertyValue("-o-transform")||y.getPropertyValue("transform");else for(f=S.length,t=0,u="";t<f;t++)if(JXG$1.exists(n.style[S[t]])){u=n.style[S[t]];break}if(u!==""&&(I=u.indexOf("("),I>0)){for(f=u.length,d=u.substring(I+1,f-1),C=d.split(","),o=0,A=C.length;o<A;o++)C[o]=parseFloat(C[o]);u.indexOf("matrix")===0?w=[[1,0,0],[0,C[0],C[1]],[0,C[2],C[3]]]:u.indexOf("scaleX")===0?w[1][1]=C[0]:u.indexOf("scaleY")===0?w[2][2]=C[0]:u.indexOf("scale")===0&&(w[1][1]=C[0],w[2][2]=C[1])}return JXG$1.exists(n.style.zoom)&&(u=n.style.zoom,u!==""&&(w[1][1]*=parseFloat(u),w[2][2]*=parseFloat(u))),w},timedChunk:function(n,t,o,u){var d=n.slice(),C=function(){var I=+new Date;do t.call(o,d.shift());while(d.length>0&&+new Date-I<300);d.length>0?window.setTimeout(C,1):u(n)};window.setTimeout(C,1)},scaleJSXGraphDiv:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M,V=u,T,H=[":fullscreen",":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"],J=H.length,z;for(I=o.getElementById(n).getBoundingClientRect(),C=I.height,d=I.width,S=o.getElementById(t),y=S._cssFullscreenStore.w,G=S._cssFullscreenStore.h,T=G/y,y>d*V&&(y=d*V,G=y*T),G>C*V&&(G=C*V,y=G/T),f=y,A=G,T>1,T<C/d?w=d*V/y:w=C*V/G,M=(C-A)*.5,z=0;z<J;z++)try{S.style.width=f+"px !important",S.style.height=A+"px !important",S.style.margin="0 auto",S.style.transform=S._cssFullscreenStore.transform+" matrix("+w+",0,0,"+w+",0,"+M+")";break}catch(L){JXG$1.debug(`JXG.scaleJSXGraphDiv:
`+L)}z===J&&JXG$1.debug("JXG.scaleJSXGraphDiv: Could not set any CSS property.")}});JXG$1.XML={cleanWhitespace:function(n){for(var t=n.firstChild;JXG$1.exists(t);)t.nodeType===3&&!/\S/.test(t.nodeValue)?n.removeChild(t):t.nodeType===1&&this.cleanWhitespace(t),t=t.nextSibling},parse:function(n){var t,o,u;return typeof DOMParser=="function"||typeof DOMParser=="object"?u=DOMParser:u=function(){this.parseFromString=function(d){var C;return typeof ActiveXObject=="function"&&(C=new ActiveXObject("MSXML.DomDocument"),C.loadXML(d)),C}},t=new u,o=t.parseFromString(n,"text/xml"),this.cleanWhitespace(o),o}};JXG$1.XML;JXG$1.EventEmitter={eventHandlers:{},suspended:{},trigger:function(n,t){var o,u,d,C,I,f;for(I=n.length,u=0;u<I;u++)if(C=this.eventHandlers[n[u]],!this.suspended[n[u]]){if(this.suspended[n[u]]=!0,C)for(f=C.length,o=0;o<f;o++)d=C[o],d.handler.apply(d.context,t);this.suspended[n[u]]=!1}return this},on:function(n,t,o){return JXG$1.isArray(this.eventHandlers[n])||(this.eventHandlers[n]=[]),o=JXG$1.def(o,this),this.eventHandlers[n].push({handler:t,context:o}),this},off:function(n,t){var o;return!n||!JXG$1.isArray(this.eventHandlers[n])?this:(t?(o=JXG$1.indexOf(this.eventHandlers[n],t,"handler"),o>-1&&this.eventHandlers[n].splice(o,1),this.eventHandlers[n].length===0&&delete this.eventHandlers[n]):delete this.eventHandlers[n],this)},eventify:function(n){n.eventHandlers={clicks:0},n.on=this.on,n.off=this.off,n.triggerEventHandlers=this.trigger,n.trigger=this.trigger,n.suspended={}}};const EventEmitter=JXG$1.EventEmitter;JXG$1.Coords=function(n,t,o,u){this.board=o,this.usrCoords=[],this.scrCoords=[],this.emitter=!JXG$1.exists(u)||u,this.emitter&&EventEmitter.eventify(this),this.setCoordinates(n,t,!1,!0)};JXG$1.extend(JXG$1.Coords.prototype,{normalizeUsrCoords:function(){Math.abs(this.usrCoords[0])>Mat.eps&&(this.usrCoords[1]/=this.usrCoords[0],this.usrCoords[2]/=this.usrCoords[0],this.usrCoords[0]=1)},usr2screen:function(n){var t=Math.round,o=this.board,u=this.usrCoords,d=o.origin.scrCoords;n===!0?(this.scrCoords[0]=t(u[0]),this.scrCoords[1]=t(u[0]*d[1]+u[1]*o.unitX),this.scrCoords[2]=t(u[0]*d[2]-u[2]*o.unitY)):(this.scrCoords[0]=u[0],this.scrCoords[1]=u[0]*d[1]+u[1]*o.unitX,this.scrCoords[2]=u[0]*d[2]-u[2]*o.unitY)},screen2usr:function(){var n=this.board.origin.scrCoords,t=this.scrCoords,o=this.board;this.usrCoords[0]=1,this.usrCoords[1]=(t[1]-n[1])/o.unitX,this.usrCoords[2]=(n[2]-t[2])/o.unitY},distance:function(n,t){var o=0,u,d=this.usrCoords,C=this.scrCoords,I;return n===Const.COORDS_BY_USER?(u=t.usrCoords,I=d[0]-u[0],o=I*I,o>Mat.eps*Mat.eps?Number.POSITIVE_INFINITY:Mat.hypot(d[1]-u[1],d[2]-u[2])):(u=t.scrCoords,Mat.hypot(C[1]-u[1],C[2]-u[2]))},setCoordinates:function(n,t,o,u){var d=this.usrCoords,C=this.scrCoords,I=[d[0],d[1],d[2]],f=[C[0],C[1],C[2]];return n===Const.COORDS_BY_USER?(t.length===2?(d[0]=1,d[1]=t[0],d[2]=t[1]):(d[0]=t[0],d[1]=t[1],d[2]=t[2],this.normalizeUsrCoords()),this.usr2screen(o)):(t.length===2?(C[1]=t[0],C[2]=t[1]):(C[1]=t[1],C[2]=t[2]),this.screen2usr()),this.emitter&&!u&&(f[1]!==C[1]||f[2]!==C[2])&&this.triggerEventHandlers(["update"],[I,f]),this},copy:function(n,t){return t===void 0&&(t=0),this[n].slice(t)},isReal:function(){return!isNaN(this.usrCoords[1]+this.usrCoords[2])&&Math.abs(this.usrCoords[0])>Mat.eps},__evt__update:function(n,t){},__evt:function(){}});const Coords=JXG$1.Coords;JXG$1.Expect={each:function(n,t,o){var u,d,C=[];if(JXG$1.exists(n.length))for(d=n.length,u=0;u<d;u++)C.push(t.call(this,n[u],o));return C},coords:function(n,t){var o=n;return n&&n.elementClass===Const.OBJECT_CLASS_POINT?o=n.coords:n.usrCoords&&n.scrCoords&&n.usr2screen&&(o=n),t&&(o=new Coords(Const.COORDS_BY_USER,o.usrCoords,o.board)),o},coordsArray:function(n,t){var o;return JXG$1.isArray(n)?o=n:o=this.coords(n).usrCoords,o.length<3&&o.unshift(1),t&&(o=[o[0],o[1],o[2]]),o}};const Expect=JXG$1.Expect;Mat.ProbFuncs={MAXNUM:17014118346046923e22,SQRTH:.7071067811865476,SQRT2:1.4142135623730951,MAXLOG:708.3964185322641,P:[2461969814735305e-25,.5641895648310689,7.463210564422699,48.63719709856814,196.5208329560771,526.4451949954773,934.5285271719576,1027.5518868951572,557.5353353693994],Q:[13.228195115474499,86.70721408859897,354.9377788878199,975.7085017432055,1823.9091668790973,2246.3376081871097,1656.6630919416134,557.5353408177277],R:[.5641895835477551,1.275366707599781,5.019050422511805,6.160210979930536,7.4097426995044895,2.9788666537210022],S:[2.2605286322011726,9.396035249380015,12.048953980809666,17.08144507475659,9.608968090632859,3.369076451000815],T:[9.604973739870516,90.02601972038427,2232.005345946843,7003.325141128051,55592.30130103949],U:[33.56171416475031,521.3579497801527,4594.323829709801,22629.000061389095,49267.39426086359],M:128,MINV:.0078125,expx2:function(n,t){var o,u,d,C;return n=Math.abs(n),t<0&&(n=-n),d=this.MINV*Math.floor(this.M*n+.5),C=n-d,o=d*d,u=2*d*C+C*C,t<0&&(o=-o,u=-u),o+u>this.MAXLOG?1/0:(o=Math.exp(o)*Math.exp(u),o)},polevl:function(n,t,o){var u,d;if(JXG$1.exists(t.reduce))return t.reduce(function(C,I){return C*n+I},0);for(d=0,u=0;d<=o;d++)u=u*n+t[d];return u},p1evl:function(n,t,o){var u,d;if(JXG$1.exists(t.reduce))return t.reduce(function(C,I){return C*n+I},1);for(d=0,u=1;d<o;d++)u=u*n+t[d];return u},ndtr:function(n){var t,o,u;return t=n*this.SQRTH,u=Math.abs(t),u<1?o=.5+.5*this.erf(t):(o=.5*this.erfce(u),u=this.expx2(n,-1),o=o*Math.sqrt(u),t>0&&(o=1-o)),o},_underflow:function(n){return console.log("erfc","UNDERFLOW"),n<0?2:0},erfc:function(n){var t,o,u,d,C;return n<0?u=-n:u=n,u<1?1-this.erf(n):(C=-n*n,C<-this.MAXLOG?this._underflow(n):(C=this.expx2(n,-1),u<8?(t=this.polevl(u,this.P,8),o=this.p1evl(u,this.Q,8)):(t=this.polevl(u,this.R,5),o=this.p1evl(u,this.S,6)),d=C*t/o,n<0&&(d=2-d),d===0?this._underflow(n):d))},erfce:function(n){var t,o;return n<8?(t=this.polevl(n,this.P,8),o=this.p1evl(n,this.Q,8)):(t=this.polevl(n,this.R,5),o=this.p1evl(n,this.S,6)),t/o},erf:function(n){var t,o;return Math.abs(n)>1?1-this.erfc(n):(o=n*n,t=n*this.polevl(o,this.T,4)/this.p1evl(o,this.U,5),t)},s2pi:2.5066282746310007,P0:[-59.96335010141079,98.00107541859997,-56.67628574690703,13.931260938727968,-1.2391658386738125],Q0:[1.9544885833814176,4.676279128988815,86.36024213908905,-225.46268785411937,200.26021238006066,-82.03722561683334,15.90562251262117,-1.1833162112133],P1:[4.0554489230596245,31.525109459989388,57.16281922464213,44.08050738932008,14.684956192885803,2.1866330685079025,-.1402560791713545,-.03504246268278482,-.0008574567851546854],Q1:[15.779988325646675,45.39076351288792,41.3172038254672,15.04253856929075,2.504649462083094,-.14218292285478779,-.03808064076915783,-.0009332594808954574],P2:[3.2377489177694603,6.915228890689842,3.9388102529247444,1.3330346081580755,.20148538954917908,.012371663481782003,.00030158155350823543,26580697468673755e-22,6239745391849833e-24],Q2:[6.02427039364742,3.6798356385616087,1.3770209948908132,.21623699359449663,.013420400608854318,.00032801446468212774,28924786474538068e-22,6790194080099813e-24],ndtri:function(n){var t,o,u,d,C,I,f;return n<=0?-1/0:n>=1?1/0:(f=1,o=n,o>1-.1353352832366127&&(o=1-o,f=0),o>.1353352832366127?(o=o-.5,d=o*o,t=o+o*(d*this.polevl(d,this.P0,4)/this.p1evl(d,this.Q0,8)),t=t*this.s2pi,t):(t=Math.sqrt(-2*Math.log(o)),C=t-Math.log(t)/t,u=1/t,t<8?I=u*this.polevl(u,this.P1,8)/this.p1evl(u,this.Q1,8):I=u*this.polevl(u,this.P2,8)/this.p1evl(u,this.Q2,8),t=C-I,f!==0&&(t=-t),t))},erfi:function(n){return this.ndtri((n+1)*.5)*this.SQRTH}};Mat.ProbFuncs;JXG$1.Math.DoubleBits=function(){var n=new Float64Array(1),t=new Uint32Array(n.buffer),o,u,d,C,I,f,A,y;Float64Array!==void 0&&(n[0]=1,t[1]===1072693248?(o=function(G){return n[0]=G,[t[0],t[1]]},u=function(G,S){return t[0]=G,t[1]=S,n[0]},d=function(G){return n[0]=G,t[0]},C=function(G){return n[0]=G,t[1]},this.doubleBits=o,this.pack=u,this.lo=d,this.hi=C):t[0]===1072693248&&(I=function(G){return n[0]=G,[t[1],t[0]]},f=function(G,S){return t[1]=G,t[0]=S,n[0]},A=function(G){return n[0]=G,t[1]},y=function(G){return n[0]=G,t[0]},this.doubleBits=I,this.pack=f,this.lo=A,this.hi=y))};JXG$1.extend(JXG$1.Math.DoubleBits.prototype,{sign:function(n){return this.hi(n)>>>31},exponent:function(n){var t=this.hi(n);return(t<<1>>>21)-1023},fraction:function(n){var t=this.lo(n),o=this.hi(n),u=o&(1<<20)-1;return o&2146435072&&(u+=1<<20),[t,u]},denormalized:function(n){var t=this.hi(n);return!(t&2146435072)}});var doubleBits=new JXG$1.Math.DoubleBits,MatInterval=function(n,t){if(n!==void 0&&t!==void 0){if(Mat.IntervalArithmetic.isInterval(n)){if(!Mat.IntervalArithmetic.isSingleton(n))throw new TypeError("JXG.Math.IntervalArithmetic: interval `lo` must be a singleton");this.lo=n.lo}else this.lo=n;if(Mat.IntervalArithmetic.isInterval(t)){if(!Mat.IntervalArithmetic.isSingleton(t))throw new TypeError("JXG.Math.IntervalArithmetic: interval `hi` must be a singleton");this.hi=t.hi}else this.hi=t}else{if(n!==void 0)return Array.isArray(n)?new MatInterval(n[0],n[1]):new MatInterval(n,n);this.lo=this.hi=0}};JXG$1.extend(MatInterval.prototype,{print:function(){console.log("[",this.lo,this.hi,"]")},set:function(n,t){return this.lo=n,this.hi=t,this},bounded:function(n,t){return this.set(Mat.IntervalArithmetic.prev(n),Mat.IntervalArithmetic.next(t))},boundedSingleton:function(n){return this.bounded(n,n)},assign:function(n,t){if(typeof n!="number"||typeof t!="number")throw new TypeError("JXG.Math.Interval#assign: arguments must be numbers");return isNaN(n)||isNaN(t)||n>t?this.setEmpty():this.set(n,t)},setEmpty:function(){return this.set(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},setWhole:function(){return this.set(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},open:function(n,t){return this.assign(Mat.IntervalArithmetic.next(n),Mat.IntervalArithmetic.prev(t))},halfOpenLeft:function(n,t){return this.assign(Mat.IntervalArithmetic.next(n),t)},halfOpenRight:function(n,t){return this.assign(n,Mat.IntervalArithmetic.prev(t))},toArray:function(){return[this.lo,this.hi]},clone:function(){return new MatInterval().set(this.lo,this.hi)}});JXG$1.Math.IntervalArithmetic={Interval:function(n,t){return new MatInterval(n,t)},isInterval:function(n){return n!==null&&typeof n=="object"&&typeof n.lo=="number"&&typeof n.hi=="number"},isSingleton:function(n){return n.lo===n.hi},add:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),new MatInterval(this.addLo(n.lo,t.lo),this.addHi(n.hi,t.hi))},sub:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),new MatInterval(this.subLo(n.lo,t.hi),this.subHi(n.hi,t.lo))},mul:function(n,t){var o,u,d,C,I;return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=n.lo,u=n.hi,d=t.lo,C=t.hi,I=new MatInterval,o<0?u>0?d<0?C>0?(I.lo=Math.min(this.mulLo(o,C),this.mulLo(u,d)),I.hi=Math.max(this.mulHi(o,d),this.mulHi(u,C))):(I.lo=this.mulLo(u,d),I.hi=this.mulHi(o,d)):C>0?(I.lo=this.mulLo(o,C),I.hi=this.mulHi(u,C)):(I.lo=0,I.hi=0):d<0?C>0?(I.lo=this.mulLo(o,C),I.hi=this.mulHi(o,d)):(I.lo=this.mulLo(u,C),I.hi=this.mulHi(o,d)):C>0?(I.lo=this.mulLo(o,C),I.hi=this.mulHi(u,d)):(I.lo=0,I.hi=0):u>0?d<0?C>0?(I.lo=this.mulLo(u,d),I.hi=this.mulHi(u,C)):(I.lo=this.mulLo(u,d),I.hi=this.mulHi(o,C)):C>0?(I.lo=this.mulLo(o,d),I.hi=this.mulHi(u,C)):(I.lo=0,I.hi=0):(I.lo=0,I.hi=0),I)},div:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():this.zeroIn(t)?t.lo!==0?t.hi!==0?this.divZero(n):this.divNegative(n,t.lo):t.hi!==0?this.divPositive(n,t.hi):this.EMPTY.clone():this.divNonZero(n,t)},positive:function(n){return new MatInterval(n.lo,n.hi)},negative:function(n){return JXG$1.isNumber(n)?new MatInterval(-n):new MatInterval(-n.hi,-n.lo)},isEmpty:function(n){return n.lo>n.hi},isWhole:function(n){return n.lo===-1/0&&n.hi===1/0},zeroIn:function(n){return this.hasValue(n,0)},hasValue:function(n,t){return this.isEmpty(n)?!1:n.lo<=t&&t<=n.hi},hasInterval:function(n,t){return this.isEmpty(n)?!0:!this.isEmpty(t)&&t.lo<=n.lo&&n.hi<=t.hi},intervalsOverlap:function(n,t){return this.isEmpty(n)||this.isEmpty(t)?!1:n.lo<=t.lo&&t.lo<=n.hi||t.lo<=n.lo&&n.lo<=t.hi},divNonZero:function(n,t){var o=n.lo,u=n.hi,d=t.lo,C=t.hi,I=new MatInterval;return u<0?C<0?(I.lo=this.divLo(u,d),I.hi=this.divHi(o,C)):(I.lo=this.divLo(o,d),I.hi=this.divHi(u,C)):o<0?C<0?(I.lo=this.divLo(u,C),I.hi=this.divHi(o,C)):(I.lo=this.divLo(o,d),I.hi=this.divHi(u,d)):C<0?(I.lo=this.divLo(u,C),I.hi=this.divHi(o,d)):(I.lo=this.divLo(o,C),I.hi=this.divHi(u,d)),I},divPositive:function(n,t){return n.lo===0&&n.hi===0?n:this.zeroIn(n)?this.WHOLE:n.hi<0?new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(n.hi,t)):new MatInterval(this.divLo(n.lo,t),Number.POSITIVE_INFINITY)},divNegative:function(n,t){return n.lo===0&&n.hi===0?n:this.zeroIn(n)?this.WHOLE:n.hi<0?new MatInterval(this.divLo(n.hi,t),Number.POSITIVE_INFINITY):new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(n.lo,t))},divZero:function(n){return n.lo===0&&n.hi===0?n:this.WHOLE},fmod:function(n,t){var o,u;return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=n.lo<0?t.lo:t.hi,u=n.lo/o,u<0?u=Math.ceil(u):u=Math.floor(u),this.sub(n,this.mul(t,new MatInterval(u))))},multiplicativeInverse:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():this.zeroIn(n)?n.lo!==0?n.hi!==0?this.WHOLE:new MatInterval(Number.NEGATIVE_INFINITY,this.divHi(1,n.lo)):n.hi!==0?new MatInterval(this.divLo(1,n.hi),Number.POSITIVE_INFINITY):this.EMPTY.clone():new MatInterval(this.divLo(1,n.hi),this.divHi(1,n.lo))},pow:function(n,t){var o,u;if(JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n))return this.EMPTY.clone();if(this.isInterval(t)){if(!this.isSingleton(t))return this.EMPTY.clone();t=t.lo}return t===0?n.lo===0&&n.hi===0?this.EMPTY.clone():this.ONE.clone():t<0?this.pow(this.multiplicativeInverse(n),-t):t%1===0?n.hi<0?(o=this.powLo(-n.hi,t),u=this.powHi(-n.lo,t),(t&1)===1?new MatInterval(-u,-o):new MatInterval(o,u)):n.lo<0?(t&1)===1?new MatInterval(-this.powLo(-n.lo,t),this.powHi(n.hi,t)):new MatInterval(0,this.powHi(Math.max(-n.lo,n.hi),t)):new MatInterval(this.powLo(n.lo,t),this.powHi(n.hi,t)):(console.warn("power is not an integer, you should use nth-root instead, returning an empty interval"),this.EMPTY.clone())},sqrt:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.nthRoot(n,2)},nthRoot:function(n,t){var o,u,d,C,I;if(JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)||t<0)return this.EMPTY.clone();if(this.isInterval(t)){if(!this.isSingleton(t))return this.EMPTY.clone();t=t.lo}return o=1/t,n.hi<0?t%1===0&&(t&1)===1?(u=this.powHi(-n.lo,o),d=this.powLo(-n.hi,o),new MatInterval(-u,-d)):this.EMPTY.clone():n.lo<0?(C=this.powHi(n.hi,o),t%1===0&&(t&1)===1?(I=-this.powHi(-n.lo,o),new MatInterval(I,C)):new MatInterval(0,C)):new MatInterval(this.powLo(n.lo,o),this.powHi(n.hi,o))},exp:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.expLo(n.lo),this.expHi(n.hi))},log:function(n){var t;return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():(t=n.lo<=0?Number.NEGATIVE_INFINITY:this.logLo(n.lo),new MatInterval(t,this.logHi(n.hi)))},ln:function(n){return this.log(n)},log10:function(n){return this.isEmpty(n)?this.EMPTY.clone():this.div(this.log(n),this.log(new MatInterval(10,10)))},log2:function(n){return this.isEmpty(n)?this.EMPTY.clone():this.div(this.log(n),this.log(new MatInterval(2,2)))},hull:function(n,t){var o=this.isEmpty(n),u=this.isEmpty(t);return o&&u?this.EMPTY.clone():o?t.clone():u?n.clone():new MatInterval(Math.min(n.lo,t.lo),Math.max(n.hi,t.hi))},intersection:function(n,t){var o,u;return this.isEmpty(n)||this.isEmpty(t)?this.EMPTY.clone():(o=Math.max(n.lo,t.lo),u=Math.min(n.hi,t.hi),o<=u?new MatInterval(o,u):this.EMPTY.clone())},union:function(n,t){if(!this.intervalsOverlap(n,t))throw new Error("Interval#unions do not overlap");return new MatInterval(Math.min(n.lo,t.lo),Math.max(n.hi,t.hi))},difference:function(n,t){if(this.isEmpty(n)||this.isWhole(t))return this.EMPTY.clone();if(this.intervalsOverlap(n,t)){if(n.lo<t.lo&&t.hi<n.hi)throw new Error("Interval.difference: difference creates multiple intervals");return t.lo<=n.lo&&t.hi===1/0||t.hi>=n.hi&&t.lo===-1/0?this.EMPTY.clone():t.lo<=n.lo?new MatInterval().halfOpenLeft(t.hi,n.hi):new MatInterval().halfOpenRight(n.lo,t.lo)}return n.clone()},width:function(n){return this.isEmpty(n)?0:this.subHi(n.hi,n.lo)},abs:function(n){return JXG$1.isNumber(n)&&(n=this.Interval(n)),this.isEmpty(n)?this.EMPTY.clone():n.lo>=0?n.clone():n.hi<=0?this.negative(n):new MatInterval(0,Math.max(-n.lo,n.hi))},max:function(n,t){var o=this.isEmpty(n),u=this.isEmpty(t);return o&&u?this.EMPTY.clone():o?t.clone():u?n.clone():new MatInterval(Math.max(n.lo,t.lo),Math.max(n.hi,t.hi))},min:function(n,t){var o=this.isEmpty(n),u=this.isEmpty(t);return o&&u?this.EMPTY.clone():o?t.clone():u?n.clone():new MatInterval(Math.min(n.lo,t.lo),Math.min(n.hi,t.hi))},onlyInfinity:function(n){return!isFinite(n.lo)&&n.lo===n.hi},_handleNegative:function(n){var t;return n.lo<0&&(n.lo===-1/0?(n.lo=0,n.hi=1/0):(t=Math.ceil(-n.lo/this.piTwiceLow),n.lo+=this.piTwiceLow*t,n.hi+=this.piTwiceLow*t)),n},cos:function(n){var t,o,u,d,C,I,f,A;return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():(t=new MatInterval().set(n.lo,n.hi),this._handleNegative(t),o=this.PI_TWICE,u=this.fmod(t,o),this.width(u)>=o.lo?new MatInterval(-1,1):u.lo>=this.piHigh?(d=this.cos(this.sub(u,this.PI)),this.negative(d)):(C=u.lo,I=u.hi,f=this.cosLo(I),A=this.cosHi(C),I<=this.piLow?new MatInterval(f,A):I<=o.lo?new MatInterval(-1,Math.max(f,A)):new MatInterval(-1,1)))},sin:function(n){return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():this.cos(this.sub(n,this.PI_HALF))},tan:function(n){var t,o,u;return this.isEmpty(n)||this.onlyInfinity(n)?this.EMPTY.clone():(t=new MatInterval().set(n.lo,n.hi),this._handleNegative(t),u=this.PI,o=this.fmod(t,u),o.lo>=this.piHalfLow&&(o=this.sub(o,u)),o.lo<=-this.piHalfLow||o.hi>=this.piHalfLow?this.WHOLE.clone():new MatInterval(this.tanLo(o.lo),this.tanHi(o.hi)))},asin:function(n){var t,o;return this.isEmpty(n)||n.hi<-1||n.lo>1?this.EMPTY.clone():(t=n.lo<=-1?-this.piHalfHigh:this.asinLo(n.lo),o=n.hi>=1?this.piHalfHigh:this.asinHi(n.hi),new MatInterval(t,o))},acos:function(n){var t,o;return this.isEmpty(n)||n.hi<-1||n.lo>1?this.EMPTY.clone():(t=n.hi>=1?0:this.acosLo(n.hi),o=n.lo<=-1?this.piHigh:this.acosHi(n.lo),new MatInterval(t,o))},acot:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.acotLo(n.lo),this.acotHi(n.hi))},atan:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.atanLo(n.lo),this.atanHi(n.hi))},sinh:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.sinhLo(n.lo),this.sinhHi(n.hi))},cosh:function(n){return this.isEmpty(n)?this.EMPTY.clone():n.hi<0?new MatInterval(this.coshLo(n.hi),this.coshHi(n.lo)):n.lo>=0?new MatInterval(this.coshLo(n.lo),this.coshHi(n.hi)):new MatInterval(1,this.coshHi(-n.lo>n.hi?n.lo:n.hi))},tanh:function(n){return this.isEmpty(n)?this.EMPTY.clone():new MatInterval(this.tanhLo(n.lo),this.tanhHi(n.hi))},equal:function(n,t){return this.isEmpty(n)?this.isEmpty(t):!this.isEmpty(t)&&n.lo===t.lo&&n.hi===t.hi},notEqual:function(n,t){return this.isEmpty(n)?!this.isEmpty(t):this.isEmpty(t)||n.hi<t.lo||n.lo>t.hi},lt:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.hi<t.lo},gt:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.lo>t.hi},leq:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.hi<=t.lo},geq:function(n,t){return JXG$1.isNumber(n)&&(n=this.Interval(n)),JXG$1.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(n)||this.isEmpty(t)?!1:n.lo>=t.hi},piLow:(3373259426+273688/(1<<21))/(1<<30),piHigh:(3373259426+273689/(1<<21))/(1<<30),piHalfLow:(3373259426+273688/(1<<21))/(1<<30)*.5,piHalfHigh:(3373259426+273689/(1<<21))/(1<<30)*.5,piTwiceLow:(3373259426+273688/(1<<21))/(1<<30)*2,piTwiceHigh:(3373259426+273689/(1<<21))/(1<<30)*2,identity:function(n){return n},_prev:function(n){return n===1/0?n:this.nextafter(n,-1/0)},_next:function(n){return n===-1/0?n:this.nextafter(n,1/0)},prev:function(n){return this._prev(n)},next:function(n){return this._next(n)},toInteger:function(n){return n<0?Math.ceil(n):Math.floor(n)},addLo:function(n,t){return this.prev(n+t)},addHi:function(n,t){return this.next(n+t)},subLo:function(n,t){return this.prev(n-t)},subHi:function(n,t){return this.next(n-t)},mulLo:function(n,t){return this.prev(n*t)},mulHi:function(n,t){return this.next(n*t)},divLo:function(n,t){return this.prev(n/t)},divHi:function(n,t){return this.next(n/t)},intLo:function(n){return this.toInteger(this.prev(n))},intHi:function(n){return this.toInteger(this.next(n))},logLo:function(n){return this.prev(Math.log(n))},logHi:function(n){return this.next(Math.log(n))},expLo:function(n){return this.prev(Math.exp(n))},expHi:function(n){return this.next(Math.exp(n))},sinLo:function(n){return this.prev(Math.sin(n))},sinHi:function(n){return this.next(Math.sin(n))},cosLo:function(n){return this.prev(Math.cos(n))},cosHi:function(n){return this.next(Math.cos(n))},tanLo:function(n){return this.prev(Math.tan(n))},tanHi:function(n){return this.next(Math.tan(n))},asinLo:function(n){return this.prev(Math.asin(n))},asinHi:function(n){return this.next(Math.asin(n))},acosLo:function(n){return this.prev(Math.acos(n))},acosHi:function(n){return this.next(Math.acos(n))},acotLo:function(n){return this.prev(Mat.acot(n))},acotHi:function(n){return this.next(Mat.acot(n))},atanLo:function(n){return this.prev(Math.atan(n))},atanHi:function(n){return this.next(Math.atan(n))},sinhLo:function(n){return this.prev(Mat.sinh(n))},sinhHi:function(n){return this.next(Mat.sinh(n))},coshLo:function(n){return this.prev(Mat.cosh(n))},coshHi:function(n){return this.next(Mat.cosh(n))},tanhLo:function(n){return this.prev(Mat.tanh(n))},tanhHi:function(n){return this.next(Mat.tanh(n))},sqrtLo:function(n){return this.prev(Math.sqrt(n))},sqrtHi:function(n){return this.next(Math.sqrt(n))},powLo:function(n,t){var o;if(t%1!==0)return this.prev(Math.pow(n,t));for(o=(t&1)===1?n:1,t>>=1;t>0;)n=this.mulLo(n,n),(t&1)===1&&(o=this.mulLo(n,o)),t>>=1;return o},powHi:function(n,t){var o;if(t%1!==0)return this.next(Math.pow(n,t));for(o=(t&1)===1?n:1,t>>=1;t>0;)n=this.mulHi(n,n),(t&1)===1&&(o=this.mulHi(n,o)),t>>=1;return o},disable:function(){this.next=this.prev=this.identity},enable:function(){this.prev=function(n){return this._prev(n)},this.next=function(n){return this._next(n)}},SMALLEST_DENORM:Math.pow(2,-1074),UINT_MAX:-1>>>0,nextafter:function(n,t){var o,u;return isNaN(n)||isNaN(t)?NaN:n===t?n:n===0?t<0?-this.SMALLEST_DENORM:this.SMALLEST_DENORM:(u=doubleBits.hi(n),o=doubleBits.lo(n),t>n==n>0?o===this.UINT_MAX?(u+=1,o=0):o+=1:o===0?(o=this.UINT_MAX,u-=1):o-=1,doubleBits.pack(o,u))}};JXG$1.Math.IntervalArithmetic.PI=new MatInterval(Mat.IntervalArithmetic.piLow,Mat.IntervalArithmetic.piHigh);JXG$1.Math.IntervalArithmetic.PI_HALF=new MatInterval(Mat.IntervalArithmetic.piHalfLow,Mat.IntervalArithmetic.piHalfHigh);JXG$1.Math.IntervalArithmetic.PI_TWICE=new MatInterval(Mat.IntervalArithmetic.piTwiceLow,Mat.IntervalArithmetic.piTwiceHigh);JXG$1.Math.IntervalArithmetic.ZERO=new MatInterval(0);JXG$1.Math.IntervalArithmetic.ONE=new MatInterval(1);JXG$1.Math.IntervalArithmetic.WHOLE=new MatInterval().setWhole();JXG$1.Math.IntervalArithmetic.EMPTY=new MatInterval().setEmpty();const Interval=JXG$1.Math.IntervalArithmetic;Mat.Extrapolate={upper:15,infty:1e4,wynnEps:function(n,t,o){var u=1e20,d=1e-15,C=1,I,f,A,y,G,S;if(o[t]=n,t===0)S=n;else{for(y=0,f=t;f>0;f--)A=y,y=o[f-1],G=o[f]-y,Math.abs(G)<=d?o[f-1]=u:(I=(t-f+1)%2===1?C:1,o[f-1]=A*I+1/G);S=o[t%2]}return S},aitken:function(n,t,o){var u,d=1e20,C=1e-15,I,f,A,y,G;if(o[t]=n,t<2)u=n;else{for(A=t/2,y=1;y<=A;y++)G=t-2*y,I=o[G+2]-2*o[G+1]+o[G],Math.abs(I)<C?o[G]=d:(f=o[G]-o[G+1],o[G]-=f*f/I);u=o[t%2]}return u},brezinski:function(n,t,o){var u,d=1e20,C=1e-15,I,f,A,y,G,S,w;if(o[t]=n,t<3)u=n;else{for(G=t/3,w=t,S=1;S<=G;S++)w-=3,f=o[w+1]-o[w],A=o[w+2]-o[w+1],y=o[w+3]-o[w+2],I=y*(A-f)-f*(y-A),Math.abs(I)<C?o[w]=d:o[w]=o[w+1]-f*A*(y-A)/I;u=o[t%3]}return u},iteration:function(n,t,o,u,d){var C,I,f,A=NaN,y,G=.5,S=[],w="finite",M=t;for(d=d||0,C=1;C<=this.upper;C++){if(M=d===0?t/(C+1):M*G,I=o(n+M,!0),f=this[u](I,C-1,S),isNaN(f)){w="NaN";break}if(I!==0&&f/I>this.infty){A=f,w="infinite";break}if(y=f-A,Math.abs(y)<1e-7)break;A=f}return[A,w,1-(C-1)/this.upper]},levin:function(n,t,o,u,d,C){var I=1e20,f=1e-15,A,y,G,S,w;if(S=1/(u+t),d[t]=n/o,C[t]=1/o,t>0&&(d[t-1]=d[t]-d[t-1],C[t-1]=C[t]-C[t-1],t>1))for(G=(u+t-1)*S,A=2;A<=t;A++)y=(u+t-A)*Math.pow(G,A-2)*S,d[t-A]=d[t-A+1]-y*d[t-A],C[t-A]=C[t-A+1]-y*C[t-A],S*=G;return Math.abs(C[0])<f?w=I:w=d[0]/C[0],w},iteration_levin:function(n,t,o,u){var d,C,I,f=NaN,A,y,G,S,w=1,M=.5,V=[],T=[],H="finite",J=t,z="u";for(u=u||0,A=o(n+t,!0),d=1;d<=this.upper;d++){if(J=u===0?t/(d+1):J*M,C=o(n+J,!0),y=C-A,Math.abs(y)<1?z="u":z="t",z==="u"?S=(w+d)*y:S=y,A=C,I=this.levin(C,d-1,S,w,V,T),G=I-f,isNaN(I)){H="NaN";break}if(C!==0&&I/C>this.infty){f=I,H="infinite";break}if(Math.abs(G)<1e-7)break;f=I}return[f,H,1-(d-1)/this.upper]},limit:function(n,t,o){return this.iteration_levin(n,t,o,0)}};const Extrapolate=Mat.Extrapolate;var predefinedButcher={rk4:{s:4,A:[[0,0,0,0],[.5,0,0,0],[0,.5,0,0],[0,0,1,0]],b:[1/6,1/3,1/3,1/6],c:[0,.5,.5,1]},heun:{s:2,A:[[0,0],[1,0]],b:[.5,.5],c:[0,1]},euler:{s:1,A:[[0]],b:[1],c:[0]}};Mat.Numerics={Gauss:function(n,t){var o,u,d,C,I,f=Mat.eps,A=n.length>0?n[0].length:0;if(A!==t.length||A!==n.length)throw new Error("JXG.Math.Numerics.Gauss: Dimensions don't match. A must be a square matrix and b must be of the same length as A.");for(C=[],I=t.slice(0,A),o=0;o<A;o++)C[o]=n[o].slice(0,A);for(u=0;u<A;u++){for(o=A-1;o>u;o--)if(Math.abs(C[o][u])>f)if(Math.abs(C[u][u])<f)JXG$1.swap(C,o,u),JXG$1.swap(I,o,u);else for(C[o][u]/=C[u][u],I[o]-=C[o][u]*I[u],d=u+1;d<A;d++)C[o][d]-=C[o][u]*C[u][d];if(Math.abs(C[u][u])<f)throw new Error("JXG.Math.Numerics.Gauss(): The given matrix seems to be singular.")}return this.backwardSolve(C,I,!0),I},backwardSolve:function(n,t,o){var u,d,C,I,f;for(o?u=t:u=t.slice(0,t.length),d=n.length,C=n.length>0?n[0].length:0,I=d-1;I>=0;I--){for(f=C-1;f>I;f--)u[I]-=n[I][f]*u[f];u[I]/=n[I][I]}return u},gaussBareiss:function(n){var t,o,u,d,C,I,f,A,y,G=Mat.eps;if(f=n.length,f<=0)return 0;for(n[0].length<f&&(f=n[0].length),A=[],d=0;d<f;d++)A[d]=n[d].slice(0,f);for(o=1,u=1,t=0;t<f-1;t++){if(I=A[t][t],Math.abs(I)<G){for(d=t+1;d<f&&!(Math.abs(A[d][t])>=G);d++);if(d===f)return 0;for(C=t;C<f;C++)y=A[d][C],A[d][C]=A[t][C],A[t][C]=y;u=-u,I=A[t][t]}for(d=t+1;d<f;d++)for(C=t+1;C<f;C++)y=I*A[d][C]-A[d][t]*A[t][C],A[d][C]=y/o;o=I}return u*A[f-1][f-1]},det:function(n){var t=n.length;return t===2&&n[0].length===2?n[0][0]*n[1][1]-n[1][0]*n[0][1]:this.gaussBareiss(n)},Jacobi:function(n){var t,o,u,d,C,I,f,A,y=Mat.eps*Mat.eps,G=0,S=n.length,w=[[0,0,0],[0,0,0],[0,0,0]],M=[[0,0,0],[0,0,0],[0,0,0]],V=0;for(t=0;t<S;t++){for(o=0;o<S;o++)w[t][o]=0,M[t][o]=n[t][o],G+=Math.abs(M[t][o]);w[t][t]=1}if(S===1)return[M,w];if(G<=0)return[M,w];G/=S*S;do{for(A=0,o=1;o<S;o++)for(t=0;t<o;t++)if(d=Math.abs(M[t][o]),A+=d,d>=y){for(d=Math.atan2(2*M[t][o],M[t][t]-M[o][o])*.5,C=Math.sin(d),I=Math.cos(d),u=0;u<S;u++)f=M[u][t],M[u][t]=I*f+C*M[u][o],M[u][o]=-C*f+I*M[u][o],f=w[u][t],w[u][t]=I*f+C*w[u][o],w[u][o]=-C*f+I*w[u][o];for(M[t][t]=I*M[t][t]+C*M[o][t],M[o][o]=-C*M[t][o]+I*M[o][o],M[t][o]=0,u=0;u<S;u++)M[t][u]=M[u][t],M[o][u]=M[u][o]}V+=1}while(Math.abs(A)/G>y&&V<2e3);return[M,w]},NewtonCotes:function(n,t,o){var u,d,C,I=0,f=o&&JXG$1.isNumber(o.number_of_nodes)?o.number_of_nodes:28,A={trapez:!0,simpson:!0,milne:!0},y=o&&o.integration_type&&A.hasOwnProperty(o.integration_type)&&A[o.integration_type]?o.integration_type:"milne",G=(n[1]-n[0])/f;switch(y){case"trapez":for(I=(t(n[0])+t(n[1]))*.5,u=n[0],d=0;d<f-1;d++)u+=G,I+=t(u);I*=G;break;case"simpson":if(f%2>0)throw new Error("JSXGraph:  INT_SIMPSON requires config.number_of_nodes dividable by 2.");for(C=f/2,I=t(n[0])+t(n[1]),u=n[0],d=0;d<C-1;d++)u+=2*G,I+=2*t(u);for(u=n[0]-G,d=0;d<C;d++)u+=2*G,I+=4*t(u);I*=G/3;break;default:if(f%4>0)throw new Error("JSXGraph: Error in INT_MILNE: config.number_of_nodes must be a multiple of 4");for(C=f*.25,I=7*(t(n[0])+t(n[1])),u=n[0],d=0;d<C-1;d++)u+=4*G,I+=14*t(u);for(u=n[0]-3*G,d=0;d<C;d++)u+=4*G,I+=32*(t(u)+t(u+2*G));for(u=n[0]-2*G,d=0;d<C;d++)u+=4*G,I+=12*t(u);I*=2*G/45}return I},Romberg:function(n,t,o){var u,d,C,I,f,A,y,G,S=[],w=0,M=1/0,V=o&&JXG$1.isNumber(o.max_iterations)?o.max_iterations:20,T=o&&JXG$1.isNumber(o.eps)?o.eps:o.eps||1e-7;for(u=n[0],d=n[1],C=d-u,f=1,S[0]=.5*C*(t(u)+t(d)),A=0;A<V;++A){for(I=0,C*=.5,f*=2,G=1,y=1;y<f;y+=2)I+=t(u+y*C);for(S[A+1]=.5*S[A]+I*C,w=S[A+1],y=A-1;y>=0;--y)G*=4,S[y]=S[y+1]+(S[y+1]-S[y])/(G-1),w=S[y];if(Math.abs(w-M)<T*Math.abs(w))break;M=w}return w},GaussLegendre:function(n,t,o){var u,d,C,I,f,A,y=0,G=[],S=[],w,M,V=o&&JXG$1.isNumber(o.n)?o.n:12;if(V>18&&(V=18),G[2]=[.5773502691896257],S[2]=[1],G[4]=[.33998104358485626,.8611363115940526],S[4]=[.6521451548625461,.34785484513745385],G[6]=[.2386191860831969,.6612093864662645,.932469514203152],S[6]=[.46791393457269104,.3607615730481386,.17132449237917036],G[8]=[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],S[8]=[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],G[10]=[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],S[10]=[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],G[12]=[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],S[12]=[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],G[14]=[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],S[14]=[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],G[16]=[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499],S[16]=[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096],G[18]=[.0847750130417353,.2518862256915055,.41175116146284263,.5597708310739475,.6916870430603532,.8037049589725231,.8926024664975557,.9558239495713977,.9915651684209309],S[18]=[.1691423829631436,.16427648374583273,.15468467512626524,.14064291467065065,.12255520671147846,.10094204410628717,.07642573025488905,.0497145488949698,.02161601352648331],G[3]=[0,.7745966692414834],S[3]=[.8888888888888888,.5555555555555556],G[5]=[0,.5384693101056831,.906179845938664],S[5]=[.5688888888888889,.47862867049936647,.23692688505618908],G[7]=[0,.4058451513773972,.7415311855993945,.9491079123427585],S[7]=[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],G[9]=[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],S[9]=[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],G[11]=[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],S[11]=[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],G[13]=[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],S[13]=[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],G[15]=[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],S[15]=[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],G[17]=[0,.17848418149584785,.3512317634538763,.5126905370864769,.6576711592166907,.7815140038968014,.8802391537269859,.9506755217687678,.9905754753144174],S[17]=[.17944647035620653,.17656270536699264,.16800410215645004,.15404576107681028,.13513636846852548,.11188384719340397,.08503614831717918,.0554595293739872,.02414830286854793],u=n[0],d=n[1],I=V+1>>1,w=G[V],M=S[V],A=.5*(d-u),f=.5*(d+u),V&!0)for(y=M[0]*t(f),C=1;C<I;++C)y+=M[C]*(t(f+A*w[C])+t(f-A*w[C]));else for(y=0,C=0;C<I;++C)y+=M[C]*(t(f+A*w[C])+t(f-A*w[C]));return A*y},_rescale_error:function(n,t,o){var u,d,C=22250738585072014e-324,I=2220446049250313e-31;return n=Math.abs(n),o!==0&&n!==0&&(u=Math.pow(200*n/o,1.5),u<1?n=o*u:n=o),t>C/(50*I)&&(d=50*I*t,d>n&&(n=d)),n},_gaussKronrod:function(n,t,o,u,d,C,I){var f=n[0],A=n[1],y,G,S=.5*(f+A),w=.5*(A-f),M=Math.abs(w),V=t(S),T=0,H=V*C[o-1],J=Math.abs(H),z=0,L=0,K=0,O,Q,ee,ie,te,se,ae,le=[],ge=[];for(o%2===0&&(T=V*d[o/2-1]),y=Math.floor((o-1)/2),O=0;O<y;O++)Q=O*2+1,ee=w*u[Q],ie=t(S-ee),te=t(S+ee),se=ie+te,le[Q]=ie,ge[Q]=te,T+=d[O]*se,H+=C[Q]*se,J+=C[Q]*(Math.abs(ie)+Math.abs(te));for(y=Math.floor(o/2),O=0;O<y;O++)ae=O*2,ee=w*u[ae],ie=t(S-ee),te=t(S+ee),le[ae]=ie,ge[ae]=te,H+=C[ae]*(ie+te),J+=C[ae]*(Math.abs(ie)+Math.abs(te));for(L=H*.5,z=C[o-1]*Math.abs(V-L),O=0;O<o-1;O++)z+=C[O]*(Math.abs(le[O]-L)+Math.abs(ge[O]-L));return K=(H-T)*w,H*=w,J*=M,z*=M,G=H,I.abserr=this._rescale_error(K,J,z),I.resabs=J,I.resasc=z,G},GaussKronrod15:function(n,t,o){var u=[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],d=[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694],C=[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782];return this._gaussKronrod(n,t,8,u,d,C,o)},GaussKronrod21:function(n,t,o){var u=[.9956571630258081,.9739065285171717,.9301574913557082,.8650633666889845,.7808177265864169,.6794095682990244,.5627571346686047,.4333953941292472,.2943928627014602,.14887433898163122,0],d=[.06667134430868814,.1494513491505806,.21908636251598204,.26926671930999635,.29552422471475287],C=[.011694638867371874,.032558162307964725,.054755896574351995,.07503967481091996,.0931254545836976,.10938715880229764,.12349197626206584,.13470921731147334,.14277593857706009,.14773910490133849,.1494455540029169];return this._gaussKronrod(n,t,11,u,d,C,o)},GaussKronrod31:function(n,t,o){var u=[.9980022986933971,.9879925180204854,.9677390756791391,.937273392400706,.8972645323440819,.8482065834104272,.790418501442466,.7244177313601701,.650996741297417,.5709721726085388,.4850818636402397,.3941513470775634,.29918000715316884,.20119409399743451,.1011420669187175,0],d=[.03075324199611727,.07036604748810812,.10715922046717194,.13957067792615432,.16626920581699392,.1861610000155622,.19843148532711158,.2025782419255613],C=[.005377479872923349,.015007947329316122,.02546084732671532,.03534636079137585,.04458975132476488,.05348152469092809,.06200956780067064,.06985412131872826,.07684968075772038,.08308050282313302,.08856444305621176,.09312659817082532,.09664272698362368,.09917359872179196,.10076984552387559,.10133000701479154];return this._gaussKronrod(n,t,16,u,d,C,o)},_workspace:function(n,t){return{limit:t,size:0,nrmax:0,i:0,alist:[n[0]],blist:[n[1]],rlist:[0],elist:[0],order:[0],level:[0],qpsrt:function(){var o=this.size-1,u=this.limit,d,C,I,f,A,y=this.nrmax,G=this.order[y];if(o<2){this.order[0]=0,this.order[1]=1,this.i=G;return}for(d=this.elist[G];y>0&&d>this.elist[this.order[y-1]];)this.order[y]=this.order[y-1],y--;for(o<u/2+2?A=o:A=u-o+1,I=y+1;I<A&&d<this.elist[this.order[I]];)this.order[I-1]=this.order[I],I++;for(this.order[I-1]=G,C=this.elist[o],f=A-1;f>I-2&&C>=this.elist[this.order[f]];)this.order[f+1]=this.order[f],f--;this.order[f+1]=o,G=this.order[y],this.i=G,this.nrmax=y},set_initial_result:function(o,u){this.size=1,this.rlist[0]=o,this.elist[0]=u},update:function(o,u,d,C,I,f,A,y){var G=this.i,S=this.size,w=this.level[this.i]+1;y>C?(this.alist[G]=I,this.rlist[G]=A,this.elist[G]=y,this.level[G]=w,this.alist[S]=o,this.blist[S]=u,this.rlist[S]=d,this.elist[S]=C,this.level[S]=w):(this.blist[G]=u,this.rlist[G]=d,this.elist[G]=C,this.level[G]=w,this.alist[S]=I,this.blist[S]=f,this.rlist[S]=A,this.elist[S]=y,this.level[S]=w),this.size++,w>this.maximum_level&&(this.maximum_level=w),this.qpsrt()},retrieve:function(){var o=this.i;return{a:this.alist[o],b:this.blist[o],r:this.rlist[o],e:this.elist[o]}},sum_results:function(){var o=this.size,u,d=0;for(u=0;u<o;u++)d+=this.rlist[u];return d},subinterval_too_small:function(o,u,d){var C=2220446049250313e-31,I=22250738585072014e-324,f=(1+100*C)*(Math.abs(u)+1e3*I);return Math.abs(o)<=f&&Math.abs(d)<=f}}},Qag:function(n,t,o){var u=2220446049250313e-31,d=this._workspace(n,1e3),C=o&&JXG$1.isNumber(o.limit)?o.limit:15,I=o&&JXG$1.isNumber(o.epsrel)?o.epsrel:1e-7,f=o&&JXG$1.isNumber(o.epsabs)?o.epsabs:1e-7,A=o&&JXG$1.isFunction(o.q)?o.q:this.GaussKronrod15,y={},G,S,w,M,V,T,H,J,z=0,L=0,K=0,O=0,Q,ee,ie,te,se,ae,le,ge,be,Xe=0,Ce=0,Re=0,Se=0,Ze=0,he=0,Ie,Be,ue,me;if(C>d.limit&&JXG$1.warn("iteration limit exceeds available workspace"),f<=0&&(I<50*Mat.eps||I<5e-29)&&JXG$1.warn("tolerance cannot be acheived with given epsabs and epsrel"),w=A.apply(this,[n,t,y]),M=y.abserr,V=y.resabs,T=y.resasc,d.set_initial_result(w,M),J=Math.max(f,I*Math.abs(w)),Q=50*u*V,M<=Q&&M>J)return H=w,JXG$1.warn("cannot reach tolerance because of roundoff error on first attempt"),-1/0;if(M<=J&&M!==T||M===0)return H=w,H;if(C===1)return H=w,JXG$1.warn("a maximum of one iteration was insufficient"),-1/0;G=w,S=M,z=1;do Xe=0,Ce=0,Re=0,Se=0,Ze=0,he=0,ue=d.retrieve(),ae=ue.a,le=ue.b,ge=ue.r,be=ue.e,ee=ae,ie=.5*(ae+le),te=ie,se=le,Xe=A.apply(this,[[ee,ie],t,y]),Se=y.abserr,Ie=y.resasc,Ce=A.apply(this,[[te,se],t,y]),Ze=y.abserr,Be=y.resasc,Re=Xe+Ce,he=Se+Ze,S+=he-be,G+=Re-ge,Ie!==Se&&Be!==Ze&&(me=ge-Re,Math.abs(me)<=1e-5*Math.abs(Re)&&he>=.99*be&&L++,z>=10&&he>be&&K++),J=Math.max(f,I*Math.abs(G)),S>J&&((L>=6||K>=20)&&(O=2),d.subinterval_too_small(ee,te,se)&&(O=3)),d.update(ee,ie,Xe,Se,te,se,Ce,Ze),ue=d.retrieve(),ae=ue.a_i,le=ue.b_i,ge=ue.r_i,be=ue.e_i,z++;while(z<C&&!O&&S>J);return H=d.sum_results(),H},I:function(n,t){return this.Qag(n,t,{q:this.GaussKronrod15,limit:15,epsrel:1e-7,epsabs:1e-7})},Newton:function(n,t,o){var u,d=0,C=Mat.eps,I=n.apply(o,[t]);for(JXG$1.isArray(t)&&(t=t[0]);d<50&&Math.abs(I)>C;)u=this.D(n,o)(t),Math.abs(u)>C?t-=I/u:t+=Math.random()*.2-1,I=n.apply(o,[t]),d+=1;return t},root:function(n,t,o){return this.chandrupatla(n,t,o)},generalizedNewton:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M,V,T,H,J,z=0;for(this.generalizedNewton.t1memo?(d=this.generalizedNewton.t1memo,C=this.generalizedNewton.t2memo):(d=o,C=u),G=n.X(d)-t.X(C),S=n.Y(d)-t.Y(C),M=G*G+S*S,V=this.D(n.X,n),T=this.D(t.X,t),H=this.D(n.Y,n),J=this.D(t.Y,t);M>Mat.eps&&z<10;)I=V(d),f=-T(C),A=H(d),y=-J(C),w=I*y-f*A,d-=(y*G-f*S)/w,C-=(I*S-A*G)/w,G=n.X(d)-t.X(C),S=n.Y(d)-t.Y(C),M=G*G+S*S,z+=1;return this.generalizedNewton.t1memo=d,this.generalizedNewton.t2memo=C,Math.abs(d)<Math.abs(C)?[n.X(d),n.Y(d)]:[t.X(C),t.Y(C)]},Neville:function(n){var t=[],o=function(C){return function(I,f){var A,y,G,S=Mat.binomial,w=n.length,M=w-1,V=0,T=0;if(!f)for(G=1,A=0;A<w;A++)t[A]=S(M,A)*G,G*=-1;for(y=I,A=0;A<w;A++){if(y===0)return n[A][C]();G=t[A]/y,y-=1,V+=n[A][C]()*G,T+=G}return V/T}},u=o("X"),d=o("Y");return[u,d,0,function(){return n.length-1}]},splineDef:function(n,t){var o,u,d,C=Math.min(n.length,t.length),I=[],f=[],A=[],y=[],G=[],S=[];if(C===2)return[0,0];for(u=0;u<C;u++)o={X:n[u],Y:t[u]},A.push(o);for(A.sort(function(w,M){return w.X-M.X}),u=0;u<C;u++)n[u]=A[u].X,t[u]=A[u].Y;for(u=0;u<C-1;u++)y.push(n[u+1]-n[u]);for(u=0;u<C-2;u++)G.push(6*(t[u+2]-t[u+1])/y[u+1]-6*(t[u+1]-t[u])/y[u]);for(I.push(2*(y[0]+y[1])),f.push(G[0]),u=0;u<C-3;u++)d=y[u+1]/I[u],I.push(2*(y[u+1]+y[u+2])-d*y[u+1]),f.push(G[u+1]-d*f[u]);for(S[C-3]=f[C-3]/I[C-3],u=C-4;u>=0;u--)S[u]=(f[u]-y[u+1]*S[u+1])/I[u];for(u=C-3;u>=0;u--)S[u+1]=S[u];return S[0]=0,S[C-1]=0,S},splineEval:function(n,t,o,u){var d,C,I,f,A,y,G,S=Math.min(t.length,o.length),w=1,M=!1,V=[];for(JXG$1.isArray(n)?(w=n.length,M=!0):n=[n],d=0;d<w;d++){if(n[d]<t[0]||t[d]>t[S-1])return NaN;for(C=1;C<S&&!(n[d]<=t[C]);C++);C-=1,I=o[C],f=(o[C+1]-o[C])/(t[C+1]-t[C])-(t[C+1]-t[C])/6*(u[C+1]+2*u[C]),A=u[C]/2,y=(u[C+1]-u[C])/(6*(t[C+1]-t[C])),G=n[d]-t[C],V.push(I+(f+(A+y*G)*G)*G)}return M?V:V[0]},generatePolynomialTerm:function(n,t,o,u){var d,C=[];for(d=t;d>=0;d--)JXG$1.concat(C,["(",n[d].toPrecision(u),")"]),d>1?JXG$1.concat(C,["*",o,"<sup>",d,"<","/sup> + "]):d===1&&JXG$1.concat(C,["*",o," + "]);return C.join("")},lagrangePolynomial:function(n){var t=[],o=this,u=function(d,C){var I,f,A,y,G=n.length,S=0,w=0;if(!C)for(I=0;I<G;I++){for(t[I]=1,A=n[I].X(),f=0;f<G;f++)f!==I&&(t[I]*=A-n[f].X());t[I]=1/t[I]}for(I=0;I<G;I++){if(A=n[I].X(),d===A)return n[I].Y();y=t[I]/(d-A),w+=y,S+=y*n[I].Y()}return S/w};return u.getTerm=function(d,C,I){return o.lagrangePolynomialTerm(n,d,C,I)()},u.getCoefficients=function(){return o.lagrangePolynomialCoefficients(n)()},u},lagrangePolynomialTerm:function(n,t,o,u){var d=this;return function(){var C=n.length,I=[],f=!0,A,y,G,S;for(o=o||"x",u===void 0&&(u=" * "),A=C-1,I=d.lagrangePolynomialCoefficients(n)(),y="",G=0;G<I.length;G++)S=I[G],!(Math.abs(S)<Mat.eps)&&(JXG$1.exists(t)&&(S=JXG$1._round10(S,-t)),f?(y+=S>0?S:"-"+-S,f=!1):y+=S>0?" + "+S:" - "+-S,A-G>1?y+=u+o+"^"+(A-G):A-G===1&&(y+=u+o));return y}},lagrangePolynomialCoefficients:function(n){return function(){var t=n.length,o=[],u=[],d=[],C,I,f,A;for(I=0;I<t;I++)d[I]=0;for(C=0;C<t;C++){for(f=n[C].Y(),A=n[C].X(),o=[],I=0;I<t;I++)I!==C&&(f/=A-n[I].X(),o.push(n[I].X()));for(u=[1].concat(Mat.Vieta(o)),I=0;I<u.length;I++)d[I]+=(I%2===1?-1:1)*u[I]*f}return d}},_initCubicPoly:function(n,t,o,u){return[n,o,-3*n+3*t-2*o-u,2*n-2*t+o+u]},CardinalSpline:function(n,t,o){var u,d=[],C,I,f,A=this;return JXG$1.isFunction(t)?f=t:f=function(){return t},o===void 0&&(o="uniform"),C=function(y){return function(G,S){var w,M,V,T,H,J,z,L,K,O;if(n.length<2)return NaN;if(!S)for(I=f(),V={X:function(){return 2*n[0].X()-n[1].X()},Y:function(){return 2*n[0].Y()-n[1].Y()},Dist:function(Q){var ee=this.X()-Q.X(),ie=this.Y()-Q.Y();return Mat.hypot(ee,ie)}},T={X:function(){return 2*n[n.length-1].X()-n[n.length-2].X()},Y:function(){return 2*n[n.length-1].Y()-n[n.length-2].Y()},Dist:function(Q){var ee=this.X()-Q.X(),ie=this.Y()-Q.Y();return Mat.hypot(ee,ie)}},u=[V].concat(n,[T]),O=u.length,d[y]=[],w=0;w<O-3;w++)o==="centripetal"?(z=u[w].Dist(u[w+1]),L=u[w+2].Dist(u[w+1]),K=u[w+3].Dist(u[w+2]),z=Math.sqrt(z),L=Math.sqrt(L),K=Math.sqrt(K),L<Mat.eps&&(L=1),z<Mat.eps&&(z=L),K<Mat.eps&&(K=L),H=(u[w+1][y]()-u[w][y]())/z-(u[w+2][y]()-u[w][y]())/(L+z)+(u[w+2][y]()-u[w+1][y]())/L,J=(u[w+2][y]()-u[w+1][y]())/L-(u[w+3][y]()-u[w+1][y]())/(K+L)+(u[w+3][y]()-u[w+2][y]())/K,H*=L,J*=L,d[y][w]=A._initCubicPoly(u[w+1][y](),u[w+2][y](),I*H,I*J)):d[y][w]=A._initCubicPoly(u[w+1][y](),u[w+2][y](),I*(u[w+2][y]()-u[w][y]()),I*(u[w+3][y]()-u[w+1][y]()));return isNaN(G)?NaN:(O=n.length,G<=0?n[0][y]():G>=O?n[O-1][y]():(w=Math.floor(G),w===G?n[w][y]():(G-=w,M=d[y][w],M===void 0?NaN:((M[3]*G+M[2])*G+M[1])*G+M[0])))}},[C("X"),C("Y"),0,function(){return n.length-1}]},CatmullRomSpline:function(n,t){return this.CardinalSpline(n,.5,t)},regressionPolynomial:function(n,t,o){var u,d,C,I,f,A,y="";if(JXG$1.isPoint(n)&&JXG$1.isFunction(n.Value))d=function(){return n.Value()};else if(JXG$1.isFunction(n))d=n;else if(JXG$1.isNumber(n))d=function(){return n};else throw new Error("JSXGraph: Can't create regressionPolynomial from degree of type'"+typeof n+"'.");if(arguments.length===3&&JXG$1.isArray(t)&&JXG$1.isArray(o))f=0;else if(arguments.length===2&&JXG$1.isArray(t)&&t.length>0&&JXG$1.isPoint(t[0]))f=1;else if(arguments.length===2&&JXG$1.isArray(t)&&t.length>0&&t[0].usrCoords&&t[0].scrCoords)f=2;else throw new Error("JSXGraph: Can't create regressionPolynomial. Wrong parameters.");return A=function(G,S){var w,M,V,T,H,J,z,L,K,O=t.length;if(K=Math.floor(d()),!S){if(f===1)for(C=[],I=[],w=0;w<O;w++)C[w]=t[w].X(),I[w]=t[w].Y();if(f===2)for(C=[],I=[],w=0;w<O;w++)C[w]=t[w].usrCoords[1],I[w]=t[w].usrCoords[2];if(f===0)for(C=[],I=[],w=0;w<O;w++)JXG$1.isFunction(t[w])?C.push(t[w]()):C.push(t[w]),JXG$1.isFunction(o[w])?I.push(o[w]()):I.push(o[w]);for(V=[],M=0;M<O;M++)V.push([1]);for(w=1;w<=K;w++)for(M=0;M<O;M++)V[M][w]=V[M][w-1]*C[M];H=I,T=Mat.transpose(V),J=Mat.matMatMult(T,V),z=Mat.matVecMult(T,H),u=Mat.Numerics.Gauss(J,z),y=Mat.Numerics.generatePolynomialTerm(u,K,"x",3)}for(L=u[K],w=K-1;w>=0;w--)L=L*G+u[w];return L},A.getTerm=function(){return y},A},bezier:function(n){var t,o,u=function(d){return function(C,I){var f=Math.floor(C)*3,A=C%1,y=1-A;return I||(o=3*Math.floor((n.length-1)/3),t=Math.floor(o/3)),C<0?n[0][d]():C>=t?n[o][d]():isNaN(C)?NaN:y*y*(y*n[f][d]()+3*A*n[f+1][d]())+(3*y*n[f+2][d]()+A*n[f+3][d]())*A*A}};return[u("X"),u("Y"),0,function(){return Math.floor(n.length/3)}]},bspline:function(n,t){var o,u=function(I,f){var A,y=[];for(A=0;A<I+f+1;A++)A<f?y[A]=0:A<=I?y[A]=A-f+1:y[A]=I-f+2;return y},d=function(I,f,A,y){var G,S,w,M,V,T=[];for(f[y]<=I&&I<f[y+1]?T[y]=1:T[y]=0,G=2;G<=A;G++)for(S=y-G+1;S<=y;S++)S<=y-G+1||S<0?w=0:w=T[S],S>=y?M=0:M=T[S+1],V=f[S+G-1]-f[S],V===0?T[S]=0:T[S]=(I-f[S])/V*w,V=f[S+G]-f[S+1],V!==0&&(T[S]+=(f[S+G]-I)/V*M);return T},C=function(I){return function(f,A){var y,G,S,w=[],M=n.length,V=M-1,T=t;if(V<=0)return NaN;if(V+2<=T&&(T=V+1),f<=0)return n[0][I]();if(f>=V-T+2)return n[V][I]();for(S=Math.floor(f)+T-1,o=u(V,T),w=d(f,o,T,S),y=0,G=S-T+1;G<=S;G++)G<M&&G>=0&&(y+=n[G][I]()*w[G]);return y}};return[C("X"),C("Y"),0,function(){return n.length-1}]},D:function(n,t){return JXG$1.exists(t)?function(o,u){var d=1e-5,C=d*2;return(n.apply(t,[o+d,u])-n.apply(t,[o-d,u]))/C}:function(o,u){var d=1e-5,C=d*2;return(n(o+d,u)-n(o-d,u))/C}},_riemannValue:function(n,t,o,u){var d,C,I,f;if(u<0&&(o!=="trapezoidal"&&(n=n+u),u*=-1,o==="lower"?o="upper":o==="upper"&&(o="lower")),f=u*.01,o==="right")d=t(n+u);else if(o==="middle")d=t(n+u*.5);else if(o==="left"||o==="trapezoidal")d=t(n);else if(o==="lower"){for(d=t(n),I=n+f;I<=n+u;I+=f)C=t(I),C<d&&(d=C);C=t(n+u),C<d&&(d=C)}else if(o==="upper"){for(d=t(n),I=n+f;I<=n+u;I+=f)C=t(I),C>d&&(d=C);C=t(n+u),C>d&&(d=C)}else o==="random"?d=t(n+u*Math.random()):o==="simpson"?d=(t(n)+4*t(n+u*.5)+t(n+u))/6:d=t(n);return d},riemann:function(n,t,o,u,d){var C,I,f,A,y,G,S,w,M,V,T,H=30,J=[],z=[],L=u,K=0,O,Q,ee;if(JXG$1.isArray(n)?(ee=n[0],Q=n[1]):Q=n,t=Math.floor(t),t<=0)return[J,z,K];for(I=(d-u)/t,C=0;C<t;C++){if(o==="simpson"){for(K+=this._riemannValue(L,Q,o,I)*I,T=I*.5,S=Q(L),w=Q(L+T),M=Q(L+2*T),A=(M+S-2*w)/(T*T)*.5,y=(M-S)/(2*T),G=w,f=0;f<H;f++)V=f*I/H-T,J.push(L+V+T),z.push(A*V*V+y*V+G);L+=I,O=M}else O=this._riemannValue(L,Q,o,I),J.push(L),z.push(O),L+=I,o==="trapezoidal"?(M=Q(L),K+=(O+M)*.5*I,O=M):K+=O*I,J.push(L),z.push(O);J.push(L),z.push(O)}for(C=0;C<t;C++){if(o==="simpson"&&ee){for(K-=this._riemannValue(L,ee,o,-I)*I,T=I*.5,S=ee(L),w=ee(L-T),M=ee(L-2*T),A=(M+S-2*w)/(T*T)*.5,y=(M-S)/(2*T),G=w,f=0;f<H;f++)V=f*I/H-T,J.push(L-V-T),z.push(A*V*V+y*V+G);L-=I,O=M}else ee?O=this._riemannValue(L,ee,o,-I):O=0,J.push(L),z.push(O),L-=I,ee&&(o==="trapezoidal"?(M=ee(L),K-=(O+M)*.5*I,O=M):K-=O*I);J.push(L),z.push(O),J.push(L),z.push(Q(L))}return[J,z,K]},riemannsum:function(n,t,o,u,d){return JXG$1.deprecated("Numerics.riemannsum()","Numerics.riemann()[2]"),this.riemann(n,t,o,u,d)[2]},rungeKutta:function(n,t,o,u,d){var C,I,f,A,y,G,S=[],w=[],M=(o[1]-o[0])/u,V=o[0],T=t.length,H=[],J=0;for(JXG$1.isString(n)&&(n=predefinedButcher[n]||predefinedButcher.euler),G=n.s,S=t.slice(),I=0;I<=u;I++){for(H[J]=S.slice(),J++,A=[],f=0;f<G;f++){for(C=0;C<T;C++)w[C]=0;for(y=0;y<f;y++)for(C=0;C<T;C++)w[C]+=n.A[f][y]*M*A[y][C];for(C=0;C<T;C++)w[C]+=S[C];A.push(d(V+n.c[f]*M,w))}for(C=0;C<T;C++)w[C]=0;for(y=0;y<G;y++)for(C=0;C<T;C++)w[C]+=n.b[y]*A[y][C];for(C=0;C<T;C++)S[C]=S[C]+M*w[C];V+=M}return H},maxIterationsRoot:80,maxIterationsMinimize:500,findBracket:function(n,t,o){var u,d,C,I,f,A,y,G,S,w;if(JXG$1.isArray(t))return t;for(u=t,C=n.call(o,u),d=u===0?1:u,I=[u-.1*d,u+.1*d,u-1,u+1,u-.5*d,u+.5*d,u-.6*d,u+.6*d,u-1*d,u+1*d,u-2*d,u+2*d,u-5*d,u+5*d,u-10*d,u+10*d,u-50*d,u+50*d,u-100*d,u+100*d],w=I.length,S=0;S<w&&(f=I[S],A=n.call(o,f),!(C*A<=0));S++);return f<u&&(y=u,u=f,f=y,G=C,C=A,A=G),[u,C,f,A]},fzero:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L=Mat.eps,K=this.maxIterationsRoot,O=0;if(JXG$1.isArray(t)){if(t.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");G=this.findDomain(n,t,o),u=G[0],d=G[1],I=n.call(o,u),f=n.call(o,d)}else y=this.findBracket(n,t,o),u=y[0],I=y[1],d=y[2],f=y[3];if(Math.abs(I)<=L)return u;if(Math.abs(f)<=L)return d;if(I*f>0)return JXG$1.isArray(t)?this.fminbr(n,[u,d],o):this.Newton(n,u,o);for(C=u,A=I;O<K;){if(S=d-u,Math.abs(A)<Math.abs(f)&&(u=d,d=C,C=u,I=f,f=A,A=I),T=2*L*Math.abs(d)+L*.5,z=(C-d)*.5,Math.abs(z)<=T||Math.abs(f)<=L)return d;Math.abs(S)>=T&&Math.abs(I)>Math.abs(f)&&(V=C-d,u===C?(w=f/I,H=V*w,J=1-w):(J=I/A,w=f/A,M=f/I,H=M*(V*J*(J-w)-(d-u)*(w-1)),J=(J-1)*(w-1)*(M-1)),H>0?J=-J:H=-H,H<.75*V*J-Math.abs(T*J)*.5&&H<Math.abs(S*J*.5)&&(z=H/J)),Math.abs(z)<T&&(z=z>0?T:-T),u=d,I=f,d+=z,f=n.call(o,d),(f>0&&A>0||f<0&&A<0)&&(C=u,A=I),O++}return d},chandrupatla:function(n,t,o){var u,d,C,I,f,A=0,y=this.maxIterationsRoot,G=1+Math.random()*.001,S=.5*G,w=Mat.eps,M=1e-5,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe,Ce,Re,Se;if(JXG$1.isArray(t)){if(t.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");u=t[0],C=n.call(o,u),d=t[1],I=n.call(o,d)}else f=this.findBracket(n,t,o),u=f[0],C=f[1],d=f[2],I=f[3];if(C*I>0)return JXG$1.isArray(t)?this.fminbr(n,[u,d],o):this.Newton(n,u,o);V=u,T=d,z=C,L=I;do{if(J=V+S*(T-V),O=n.call(o,J),Math.sign(O)===Math.sign(z)?(H=V,V=J,K=z,z=O):(H=T,T=V,K=L,L=z),V=J,z=O,Q=V,ee=z,Math.abs(L)<Math.abs(z)&&(Q=T,ee=L),ie=2*w*Math.abs(Q)+.5*M,te=ie/Math.abs(T-V),te>.5||ee===0)break;se=(V-T)/(H-T),ae=(z-L)/(K-L),le=1-Math.sqrt(1-se),ge=Math.sqrt(se),le<ae&&ae<ge?(be=(H-V)/(T-V),Xe=z/(L-z),Ce=K/(L-K),Re=z/(K-z),Se=L/(K-L),S=Xe*Ce+Re*Se*be):S=.5*G,S<te&&(S=te),S>1-te&&(S=1-te),A++}while(A<=y);return Q},findDomain:function(n,t,o){var u,d,C,I,f,A=.3819660112501453,y=.001,G,S=20;if(!JXG$1.isArray(t)||t.length<2)throw new Error("JXG.Math.Numerics.findDomain: length of array x0 has to be at least two.");if(f=t.slice(),u=f[0],d=f[1],I=n.call(o,u),isNaN(I)){for(G=0;d-u>y&&G<S;)C=(d-u)*A+u,I=n.call(o,C),isNaN(I)?u=C:d=C,G++;f[0]=u}if(u=f[0],d=f[1],I=n.call(o,d),isNaN(I)){for(G=0;d-u>y&&G<S;)C=d-(d-u)*A,I=n.call(o,C),isNaN(I)?d=C:u=C,G++;f[0]=d}return f},fminbr:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K=(3-Math.sqrt(5))*.5,O=Mat.eps,Q=Mat.eps,ee=this.maxIterationsMinimize,ie=0;if(!JXG$1.isArray(t)||t.length<2)throw new Error("JXG.Math.Numerics.fminbr: length of array x0 has to be at least two.");for(S=this.findDomain(n,t,o),u=S[0],d=S[1],I=u+K*(d-u),y=n.call(o,I),C=I,f=I,A=y,G=y;ie<ee;){if(w=d-u,M=(u+d)*.5,V=Q*Math.abs(C)+O/3,Math.abs(C-M)+w*.5<=2*V)return C;T=K*(C<M?d-C:u-C),Math.abs(C-f)>=V&&(z=(C-f)*(A-y),J=(C-I)*(A-G),H=(C-I)*J-(C-f)*z,J=2*(J-z),J>0?H=-H:J=-J,Math.abs(H)<Math.abs(T*J)&&H>J*(u-C+2*V)&&H<J*(d-C-2*V)&&(T=H/J)),Math.abs(T)<V&&(T>0?T=V:T=-V),z=C+T,L=n.call(o,z),L<=A?(z<C?d=C:u=C,I=f,f=C,C=z,y=G,G=A,A=L):(z<C?u=z:d=z,L<=G||f===C?(I=f,f=z,y=G,G=L):(L<=y||I===C||I===f)&&(I=z,y=L)),ie+=1}return C},glomin:function(n,t){var o,u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be=1e7,Xe=Mat.eps,Ce=Mat.eps*Mat.eps,Re=Mat.eps*Mat.eps*Mat.eps;if(se=t[0],ae=t[1],le=n(se)<n(ae)?se:ae,o=ae,ge=o,u=se,z=n(ae),Q=z,K=n(se),J=K,z<J?J=z:ge=se,ae<=se)return J;for(G=.5*(1+16*Re)*be,le<=se||ae<=le?H=.5*(se+ae):H=le,L=n(H),y=3,C=u-H,A=9/11,L<J&&(ge=H,J=L);;){if(I=u-o,f=H-o,te=ae-u,ee=K-L,ie=K-z,V=I*I*ee-C*C*ie,S=V,M=2*(C*ie-I*ee),w=M,y<1e6||K<=J)for(;w*(V*(Q-K)+te*w*(K-J+Xe))<te*G*V*(te*w-V)&&(d=u+V/w,O=n(d),O<J&&(ge=d,J=O)),y=1611*y%1048576,w=1,V=(ae-se)*1e-5*y,!(te<=V););else for(y=1611*y%1048576,w=1,V=(ae-se)*1e-5*y;V<te;)w*(V*(Q-K)+te*w*(K-J+Xe))<te*G*V*(te*w-V)&&(d=u+V/w,O=n(d),O<J&&(ge=d,J=O)),y=1611*y%1048576,w=1,V=(ae-se)*1e-5*y;for(V=G*C*I*f,T=Math.sqrt((K-J+Xe)/G),A=.5*(1+A),S=A*(S+2*V*T),w=w+.5*M,V=-.5*(C+(ee+2.01*Ce)/(C*G)),V<T||C<0?V=u+T:V=u+V,0<S*w?d=u+S/w:d=V;d=Math.max(d,V),ae<=d?(d=ae,O=Q):O=n(d),O<J&&(ge=d,J=O),C=d-u,!(d<=V||(S=2*(K-O)/(be*C),(1+9*Re)*C<=Math.abs(S))||.5*G*(C*C+S*S)<=K-J+(O-J)+2*Xe);)d=.5*(u+d),A=.9*A;if(ae<=d)break;o=H,H=u,u=d,z=L,L=K,K=O}return[ge,J]},polzeros:function(n,t,o,u,d){var C,I,f,A=[],y=[],G=[],S=function(H,J,z){var L,K,O=H.length-1;if(z=z||!1,z)for(K=JXG$1.C.mult(O,H[O]),L=O-1;L>0;L--)K.mult(J),K.add(JXG$1.C.mult(H[L],L));else for(K=JXG$1.C.copy(H[O]),L=O-1;L>=0;L--)K.mult(J),K.add(H[L]);return K},w=function(H,J,z){var L,K,O=H.length-1;if(z=z||!1,z)for(K=JXG$1.C.mult(O,H[0]),L=O-1;L>0;L--)K.mult(J),K.add(JXG$1.C.mult(H[O-L],L));else for(K=JXG$1.C.copy(H[0]),L=O-1;L>=0;L--)K.mult(J),K.add(H[O-L]);return K},M=function(H,J){var z,L,K=H.length-1;for(L=H[K],z=K-1;z>=0;z--)L=L*J+H[z];return L},V=function(H){var J,z,L=H.length-1,K=Math.PI*2/L,O=Math.PI/L*.5,Q,ee,ie=[];for(Q=JXG$1.C.mult(-1,H[L-1]),Q.div(JXG$1.C.mult(L,H[L])),ee=JXG$1.C.div(S(H,Q),H[L]),z=Math.pow(JXG$1.C.abs(ee),1/L),z===0&&(z=1),J=0;J<L;J++)H=new JXG$1.Complex(z*Math.cos(K*J+O),z*Math.sin(K*J+O)),ie[J]=JXG$1.C.add(Q,H);return ie},T=function(H,J,z,L){var K,O,Q,ee=[],ie=[],te,se,ae=0,le,ge,be,Xe,Ce=L.length;for(O=0;O<Ce;O++)ee.push(!1);for(O=0;O<H.length;O++)ie.push(JXG$1.C.abs(H[O])*(4*O+1));for(K=0;K<z&&ae<Ce;K++)for(O=0;O<Ce;O++)if(!ee[O]){if(le=S(H,L[O]),se=JXG$1.C.abs(L[O]),JXG$1.C.abs(le)<J*M(ie,se)){if(ee[O]=!0,ae++,ae===Ce)break;continue}for(se>1?(te=JXG$1.C.div(1,L[O]),Xe=w(H,te,!0),Xe.div(w(H,te)),Xe.mult(te),le=JXG$1.C.sub(Ce,Xe),le=JXG$1.C.div(L[O],le)):le.div(S(H,L[O],!0)),ge=new JXG$1.Complex(0),Q=0;Q<Ce;Q++)Q!==O&&(be=JXG$1.C.sub(L[O],L[Q]),be=JXG$1.C.div(1,be),ge.add(be));ge.mult(le),ge=JXG$1.C.sub(1,ge),le.div(ge),L[O].sub(le)}return K};for(o=o||Number.EPSILON,u=u||30,I=n.length,JXG$1.isNumber(t)&&t>=0&&t<I-1&&(I=t+1),C=0;C<I;C++)A.push(new JXG$1.Complex(n[C]));for(C=0;C<I;C++)if(A[C].real!==0||A[C].imaginary!==0){f=C;break}for(C=0;C<f;C++)y.push(new JXG$1.Complex(0));for(A=A.slice(f),I=A.length,C=I-1;C>=0&&!(A[C].real!==0||A[C].imaginary!==0);C--)A.pop();if(I=A.length,I===0)return[];if(d)for(C=0;C<I-1;C++)G.push(new JXG$1.Complex(d[C]));else G=V(A);return T(A,o,u,G),G=y.concat(G),G.sort(function(H,J){return H.real<J.real?-1:H.real>J.real?1:0}),G},RamerDouglasPeucker:function(n,t){var o=[],u=[],d,C,I,f=!0,A=function(G,S,w){var M,V,T,H,J,z,L,K,O,Q,ee,ie=Mat.eps*Mat.eps,te=1e4,se=0,ae=S;if(w-S<2)return[-1,0];if(T=G[S].scrCoords,H=G[w].scrCoords,isNaN(T[1])||isNaN(T[2]))return[NaN,S];if(isNaN(H[1])||isNaN(H[2]))return[NaN,w];for(V=S+1;V<w;V++){if(J=G[V].scrCoords,isNaN(J[1])||isNaN(J[2]))return[NaN,V];z=J[1]-T[1],L=J[2]-T[2],K=H[1]-T[1],O=H[2]-T[2],z=z===1/0?te:z,L=L===1/0?te:L,K=K===1/0?te:K,O=O===1/0?te:O,z=z===-1/0?-1e4:z,L=L===-1/0?-1e4:L,K=K===-1/0?-1e4:K,O=O===-1/0?-1e4:O,Q=K*K+O*O,Q>ie?(ee=(z*K+L*O)/Q,ee<0?ee=0:ee>1&&(ee=1),z=z-ee*K,L=L-ee*O,M=z*z+L*L):(ee=0,M=z*z+L*L),M>se&&(se=M,ae=V)}return[Math.sqrt(se),ae]},y=function(G,S,w,M,V){var T=A(G,S,w),H=T[1];if(isNaN(T[0])){y(G,S,H-1,M,V),V.push(G[H]);do++H;while(H<=w&&isNaN(G[H].scrCoords[1]+G[H].scrCoords[2]));H<=w&&V.push(G[H]),y(G,H+1,w,M,V)}else T[0]>M?(y(G,S,H,M,V),y(G,H,w,M,V)):V.push(G[w])};for(I=n.length,d=0;f;){for(;d<I&&isNaN(n[d].scrCoords[1]+n[d].scrCoords[2]);)d+=1;for(C=d+1;C<I&&!isNaN(n[C].scrCoords[1]+n[C].scrCoords[2]);)C+=1;if(C--,d<I&&C>d&&(u=[],u[0]=n[d],y(n,d,C,t,u),o=o.concat(u)),d>=I)break;C<I-1&&o.push(n[C+1]),d=C+1}return o},RamerDouglasPeuker:function(n,t){return JXG$1.deprecated("Numerics.RamerDouglasPeuker()","Numerics.RamerDouglasPeucker()"),this.RamerDouglasPeucker(n,t)},Visvalingam:function(n,t){var o,u,d,C,I=[],f=[],A=[],y,G,S,w,M;if(u=n.length,u<=2)return n;for(I[0]={used:!0,lft:null,node:null},y=0,o=1;o<u-1;o++)d=Math.abs(JXG$1.Math.Numerics.det([n[o-1].usrCoords,n[o].usrCoords,n[o+1].usrCoords])),isNaN(d)||(M={v:d,idx:o},f.push(M),I[o]={used:!0,lft:y,node:M},I[y].rt=o,y=o);for(I[u-1]={used:!0,rt:null,lft:y,node:null},I[y].rt=u-1,C=-1/0;f.length>t;)f.sort(function(V,T){return T.v-V.v}),o=f.pop().idx,I[o].used=!1,C=I[o].node.v,y=I[o].lft,G=I[o].rt,I[y].rt=G,I[G].lft=y,S=I[y].lft,S!==null&&(d=Math.abs(JXG$1.Math.Numerics.det([n[S].usrCoords,n[y].usrCoords,n[G].usrCoords])),I[y].node.v=d>=C?d:C),w=I[G].rt,w!==null&&(d=Math.abs(JXG$1.Math.Numerics.det([n[y].usrCoords,n[G].usrCoords,n[w].usrCoords])),I[G].node.v=d>=C?d:C);o=0,A=[n[o]];do o=I[o].rt,A.push(n[o]);while(I[o].rt!==null);return A}};const Numerics=Mat.Numerics;Mat.Geometry={};JXG$1.extend(Mat.Geometry,{angle:function(n,t,o){var u,d,C,I,f=[],A=[],y=[];return JXG$1.deprecated("Geometry.angle()","Geometry.rad()"),n.coords?(f[0]=n.coords.usrCoords[1],f[1]=n.coords.usrCoords[2]):(f[0]=n[0],f[1]=n[1]),t.coords?(A[0]=t.coords.usrCoords[1],A[1]=t.coords.usrCoords[2]):(A[0]=t[0],A[1]=t[1]),o.coords?(y[0]=o.coords.usrCoords[1],y[1]=o.coords.usrCoords[2]):(y[0]=o[0],y[1]=o[1]),u=f[0]-A[0],d=f[1]-A[1],C=y[0]-A[0],I=y[1]-A[1],Math.atan2(u*I-d*C,u*C+d*I)},trueAngle:function(n,t,o){return this.rad(n,t,o)*57.29577951308232},rad:function(n,t,o){var u,d,C,I,f,A,y;return n.coords?(u=n.coords.usrCoords[1],d=n.coords.usrCoords[2]):(u=n[0],d=n[1]),t.coords?(C=t.coords.usrCoords[1],I=t.coords.usrCoords[2]):(C=t[0],I=t[1]),o.coords?(f=o.coords.usrCoords[1],A=o.coords.usrCoords[2]):(f=o[0],A=o[1]),y=Math.atan2(A-I,f-C)-Math.atan2(d-I,u-C),y<0&&(y+=6.283185307179586),y},angleBisector:function(n,t,o,u){var d,C,I,f=n.coords.usrCoords,A=t.coords.usrCoords,y=o.coords.usrCoords,G,S;return JXG$1.exists(u)||(u=n.board),A[0]===0?new Coords(Const.COORDS_BY_USER,[1,(f[1]+y[1])*.5,(f[2]+y[2])*.5],u):(G=f[1]-A[1],S=f[2]-A[2],d=Math.atan2(S,G),G=y[1]-A[1],S=y[2]-A[2],C=Math.atan2(S,G),I=(d+C)*.5,d>C&&(I+=Math.PI),G=Math.cos(I)+A[1],S=Math.sin(I)+A[2],new Coords(Const.COORDS_BY_USER,[1,G,S],u))},reflection:function(n,t,o){var u,d,C,I,f,A,y,G=t.coords.usrCoords,S=n.point1.coords.usrCoords,w=n.point2.coords.usrCoords;return JXG$1.exists(o)||(o=t.board),f=w[1]-S[1],A=w[2]-S[2],u=G[1]-S[1],d=G[2]-S[2],y=(f*d-A*u)/(f*f+A*A),C=G[1]+2*y*A,I=G[2]-2*y*f,new Coords(Const.COORDS_BY_USER,[C,I],o)},rotation:function(n,t,o,u){var d,C,I,f,A,y,G=t.coords.usrCoords,S=n.coords.usrCoords;return JXG$1.exists(u)||(u=t.board),d=G[1]-S[1],C=G[2]-S[2],I=Math.cos(o),f=Math.sin(o),A=d*I-C*f+S[1],y=d*f+C*I+S[2],new Coords(Const.COORDS_BY_USER,[A,y],u)},perpendicular:function(n,t,o){var u,d,C,I,f,A=n.point1.coords.usrCoords,y=n.point2.coords.usrCoords,G=t.coords.usrCoords;return JXG$1.exists(o)||(o=t.board),t===n.point1?(u=A[1]+y[2]-A[2],d=A[2]-y[1]+A[1],f=A[0]*y[0],Math.abs(f)<Mat.eps&&(u=y[2],d=-y[1]),I=[f,u,d],C=!0):t===n.point2?(u=y[1]+A[2]-y[2],d=y[2]-A[1]+y[1],f=A[0]*y[0],Math.abs(f)<Mat.eps&&(u=A[2],d=-A[1]),I=[f,u,d],C=!1):Math.abs(Mat.innerProduct(G,n.stdform,3))<Mat.eps?(u=G[1]+y[2]-G[2],d=G[2]-y[1]+G[1],f=y[0],Math.abs(f)<Mat.eps&&(u=y[2],d=-y[1]),C=!0,Math.abs(f)>Mat.eps&&Math.abs(u-G[1])<Mat.eps&&Math.abs(d-G[2])<Mat.eps&&(u=G[1]+A[2]-G[2],d=G[2]-A[1]+G[1],C=!1),I=[f,u,d]):(I=[0,n.stdform[1],n.stdform[2]],I=Mat.crossProduct(I,G),I=Mat.crossProduct(I,n.stdform),C=!0),[new Coords(Const.COORDS_BY_USER,I,o),C]},circumcenterMidpoint:function(){JXG$1.deprecated("Geometry.circumcenterMidpoint()","Geometry.circumcenter()"),this.circumcenter.apply(this,arguments)},circumcenter:function(n,t,o,u){var d,C,I,f,A=n.coords.usrCoords,y=t.coords.usrCoords,G=o.coords.usrCoords;return JXG$1.exists(u)||(u=n.board),d=[y[0]-A[0],-y[2]+A[2],y[1]-A[1]],C=[(A[0]+y[0])*.5,(A[1]+y[1])*.5,(A[2]+y[2])*.5],I=Mat.crossProduct(d,C),d=[G[0]-y[0],-G[2]+y[2],G[1]-y[1]],C=[(y[0]+G[0])*.5,(y[1]+G[1])*.5,(y[2]+G[2])*.5],f=Mat.crossProduct(d,C),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(I,f),u)},distance:function(n,t,o){var u,d=0;for(o||(o=Math.min(n.length,t.length)),u=0;u<o;u++)d+=(n[u]-t[u])*(n[u]-t[u]);return Math.sqrt(d)},affineDistance:function(n,t,o){var u;return u=this.distance(n,t,o),u>Mat.eps&&(Math.abs(n[0])<Mat.eps||Math.abs(t[0])<Mat.eps)?1/0:u},affineRatio:function(n,t,o){var u=0,d;return JXG$1.exists(n.usrCoords)&&(n=n.usrCoords),JXG$1.exists(t.usrCoords)&&(t=t.usrCoords),JXG$1.exists(o.usrCoords)&&(o=o.usrCoords),d=t[1]-n[1],Math.abs(d)>Mat.eps?u=(o[1]-n[1])/d:u=(o[2]-n[2])/(t[2]-n[2]),u},sortVertices:function(n){for(var t,o=Expect.each(n,Expect.coordsArray),u=o.length,d=null;o[0][0]===o[u-1][0]&&o[0][1]===o[u-1][1]&&o[0][2]===o[u-1][2];)d=o.pop(),u--;return t=o[0],o.sort(function(C,I){var f=C[2]===t[2]&&C[1]===t[1]?-1/0:Math.atan2(C[2]-t[2],C[1]-t[1]),A=I[2]===t[2]&&I[1]===t[1]?-1/0:Math.atan2(I[2]-t[2],I[1]-t[1]);return f-A}),d!==null&&o.push(d),o},signedTriangle:function(n,t,o){var u=Expect.coordsArray(n),d=Expect.coordsArray(t),C=Expect.coordsArray(o);return .5*((d[1]-u[1])*(C[2]-u[2])-(d[2]-u[2])*(C[1]-u[1]))},signedPolygon:function(n,t){var o,u,d=0,C=Expect.each(n,Expect.coordsArray);for(t===void 0&&(t=!0),t?C.unshift(C[C.length-1]):C=this.sortVertices(C),u=C.length,o=1;o<u;o++)d+=C[o-1][1]*C[o][2]-C[o][1]*C[o-1][2];return .5*d},GrahamScan:function(n){var t,o=1,u=Expect.each(n,Expect.coordsArray),d=u.length;for(u=this.sortVertices(u),d=u.length,t=2;t<d;t++){for(;this.signedTriangle(u[o-1],u[o],u[t])<=0;){if(o>1)o-=1;else if(t===d-1)break;t+=1}o+=1,u=JXG$1.swap(u,o,t)}return u.slice(0,o)},calcStraight:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M;JXG$1.exists(u)||(u=10),y=JXG$1.evaluate(n.visProp.straightfirst),G=JXG$1.evaluate(n.visProp.straightlast),Math.abs(t.scrCoords[0])<Mat.eps&&(y=!0),Math.abs(o.scrCoords[0])<Mat.eps&&(G=!0),!(!y&&!G)&&(S=[],S[0]=n.stdform[0]-n.stdform[1]*n.board.origin.scrCoords[1]/n.board.unitX+n.stdform[2]*n.board.origin.scrCoords[2]/n.board.unitY,S[1]=n.stdform[1]/n.board.unitX,S[2]=-n.stdform[2]/n.board.unitY,!isNaN(S[0]+S[1]+S[2])&&(d=!1,C=!1,d=!y&&Math.abs(t.usrCoords[0])>=Mat.eps&&t.scrCoords[1]>=0&&t.scrCoords[1]<=n.board.canvasWidth&&t.scrCoords[2]>=0&&t.scrCoords[2]<=n.board.canvasHeight,C=!G&&Math.abs(o.usrCoords[0])>=Mat.eps&&o.scrCoords[1]>=0&&o.scrCoords[1]<=n.board.canvasWidth&&o.scrCoords[2]>=0&&o.scrCoords[2]<=n.board.canvasHeight,I=this.meetLineBoard(S,n.board,u),f=I[0],A=I[1],!(!d&&!C&&(!y&&G&&!this.isSameDirection(t,o,f)&&!this.isSameDirection(t,o,A)||y&&!G&&!this.isSameDirection(o,t,f)&&!this.isSameDirection(o,t,A)))&&(d?C||(this.isSameDir(t,o,f,A)?M=A:M=f):C?this.isSameDir(t,o,f,A)?w=f:w=A:this.isSameDir(t,o,f,A)?(w=f,M=A):(M=f,w=A),w&&t.setCoordinates(Const.COORDS_BY_USER,w.usrCoords),M&&o.setCoordinates(Const.COORDS_BY_USER,M.usrCoords))))},calcLineDelimitingPoints:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M=!1,V=!1;A=JXG$1.evaluate(n.visProp.straightfirst),y=JXG$1.evaluate(n.visProp.straightlast),Math.abs(t.scrCoords[0])<Mat.eps&&(A=!0),Math.abs(o.scrCoords[0])<Mat.eps&&(y=!0),G=[],G[0]=n.stdform[0]-n.stdform[1]*n.board.origin.scrCoords[1]/n.board.unitX+n.stdform[2]*n.board.origin.scrCoords[2]/n.board.unitY,G[1]=n.stdform[1]/n.board.unitX,G[2]=-n.stdform[2]/n.board.unitY,!isNaN(G[0]+G[1]+G[2])&&(M=!A,V=!y,d=n.board.getBoundingBox(),C=n.getSlope(),C>=0?(I=this.projectPointToLine({coords:{usrCoords:[1,d[2],d[1]]}},n,n.board),f=this.projectPointToLine({coords:{usrCoords:[1,d[0],d[3]]}},n,n.board)):(I=this.projectPointToLine({coords:{usrCoords:[1,d[0],d[1]]}},n,n.board),f=this.projectPointToLine({coords:{usrCoords:[1,d[2],d[3]]}},n,n.board)),!(!M&&!V&&(!A&&!y&&(u=t.distance(Const.COORDS_BY_USER,o),Math.abs(t.distance(Const.COORDS_BY_USER,I)+I.distance(Const.COORDS_BY_USER,o)-u)>Mat.eps||Math.abs(t.distance(Const.COORDS_BY_USER,f)+f.distance(Const.COORDS_BY_USER,o)-u)>Mat.eps)||!A&&y&&!this.isSameDirection(t,o,I)&&!this.isSameDirection(t,o,f)||A&&!y&&!this.isSameDirection(o,t,I)&&!this.isSameDirection(o,t,f)))&&(M?V||(this.isSameDir(t,o,I,f)?w=f:w=I):V?this.isSameDir(t,o,I,f)?S=I:S=f:this.isSameDir(t,o,I,f)?(S=I,w=f):(w=I,S=f),S&&t.setCoordinates(Const.COORDS_BY_USER,S.usrCoords),w&&o.setCoordinates(Const.COORDS_BY_USER,w.usrCoords)))},calcLabelQuadrant:function(n){var t;return n<0&&(n+=2*Math.PI),t=Math.floor((n+Math.PI/8)/(Math.PI/4))%8,["rt","urt","top","ulft","lft","llft","lrt"][t]},isSameDir:function(n,t,o,u){var d=t.usrCoords[1]-n.usrCoords[1],C=t.usrCoords[2]-n.usrCoords[2],I=u.usrCoords[1]-o.usrCoords[1],f=u.usrCoords[2]-o.usrCoords[2];return Math.abs(t.usrCoords[0])<Mat.eps&&(d=t.usrCoords[1],C=t.usrCoords[2]),Math.abs(n.usrCoords[0])<Mat.eps&&(d=-n.usrCoords[1],C=-n.usrCoords[2]),d*I+C*f>=0},isSameDirection:function(n,t,o){var u,d,C,I,f=!1;return u=t.usrCoords[1]-n.usrCoords[1],d=t.usrCoords[2]-n.usrCoords[2],C=o.usrCoords[1]-n.usrCoords[1],I=o.usrCoords[2]-n.usrCoords[2],Math.abs(u)<Mat.eps&&(u=0),Math.abs(d)<Mat.eps&&(d=0),Math.abs(C)<Mat.eps&&(C=0),Math.abs(I)<Mat.eps&&(I=0),(u>=0&&C>=0||u<=0&&C<=0)&&(f=d>=0&&I>=0||d<=0&&I<=0),f},det3p:function(n,t,o){var u,d,C;return JXG$1.isPoint(n)?u=n.Coords(!0):u=n,JXG$1.isPoint(t)?d=t.Coords(!0):d=t,JXG$1.isPoint(o)?C=o.Coords(!0):C=o,(u[1]-C[1])*(d[2]-C[2])-(d[1]-C[1])*(u[2]-C[2])},windingNumber:function(n,t,o){var u=0,d=t.length,C=n[1],I=n[2],f,A,y,G,S,w,M=0;if(d===0)return 0;if(o=o||!1,o&&(M=1),isNaN(C)||isNaN(I)||(JXG$1.exists(t[0].coords)?(f=t[0].coords,A=t[d-1].coords):(f=t[0],A=t[d-1]),f.usrCoords[1]===C&&f.usrCoords[2]===I))return 1;for(w=0;w<d-M;w++)if(JXG$1.exists(t[w].coords)?(A=t[w].coords.usrCoords,y=t[(w+1)%d].coords.usrCoords):(A=t[w].usrCoords,y=t[(w+1)%d].usrCoords),!(A[0]===0||y[0]===0||isNaN(A[1])||isNaN(y[1])||isNaN(A[2])||isNaN(y[2]))){if(y[2]===I){if(y[1]===C)return 1;if(A[2]===I&&y[1]>C==A[1]<C)return 0}if(A[2]<I!=y[2]<I)if(S=2*(y[2]>A[2]?1:0)-1,A[1]>=C)if(y[1]>C)u+=S;else{if(G=this.det3p(A,y,n),G===0)return 0;G>0+Mat.eps==y[2]>A[2]&&(u+=S)}else y[1]>C&&(G=this.det3p(A,y,n),G>0+Mat.eps==y[2]>A[2]&&(u+=S))}return u},pnpoly:function(n,t,o,u){var d,C,I,f,A,y,G,S,w=o,M=!1;for(u===Const.COORDS_BY_USER?(S=new Coords(Const.COORDS_BY_USER,[n,t],this.board),y=S.scrCoords[1],G=S.scrCoords[2]):(y=n,G=t),A=o.length,d=0,C=A-2;d<A-1;C=d++)I=JXG$1.exists(w[d].coords)?w[d].coords:w[d],f=JXG$1.exists(w[C].coords)?w[C].coords:w[C],I.scrCoords[2]>G!=f.scrCoords[2]>G&&y<(f.scrCoords[1]-I.scrCoords[1])*(G-I.scrCoords[2])/(f.scrCoords[2]-I.scrCoords[2])+I.scrCoords[1]&&(M=!M);return M},intersectionFunction:function(n,t,o,u,d,C){var I,f=this,A=!1,y=!1;return A=t.elementClass===Const.OBJECT_CLASS_CURVE&&(t.type===Const.OBJECT_TYPE_ARC||t.type===Const.OBJECT_TYPE_SECTOR),y=o.elementClass===Const.OBJECT_CLASS_CURVE&&(o.type===Const.OBJECT_TYPE_ARC||o.type===Const.OBJECT_TYPE_SECTOR),(t.elementClass===Const.OBJECT_CLASS_CURVE||o.elementClass===Const.OBJECT_CLASS_CURVE)&&(t.elementClass===Const.OBJECT_CLASS_CURVE||t.elementClass===Const.OBJECT_CLASS_CIRCLE)&&(o.elementClass===Const.OBJECT_CLASS_CURVE||o.elementClass===Const.OBJECT_CLASS_CIRCLE)?I=function(){return f.meetCurveCurve(t,o,u,d,t.board)}:t.elementClass===Const.OBJECT_CLASS_CURVE&&!A&&o.elementClass===Const.OBJECT_CLASS_LINE||o.elementClass===Const.OBJECT_CLASS_CURVE&&!y&&t.elementClass===Const.OBJECT_CLASS_LINE?I=function(){return f.meetCurveLine(t,o,u,t.board,JXG$1.evaluate(C))}:t.type===Const.OBJECT_TYPE_POLYGON||o.type===Const.OBJECT_TYPE_POLYGON?t.elementClass===Const.OBJECT_CLASS_LINE?I=function(){var G=JXG$1.evaluate(t.visProp.straightfirst),S=JXG$1.evaluate(t.visProp.straightlast),w=JXG$1.evaluate(o.visProp.straightfirst),M=JXG$1.evaluate(o.visProp.straightlast),V;return V=!JXG$1.evaluate(C)&&(!G||!S||!w||!M),f.meetPolygonLine(o,t,u,t.board,V)}:o.elementClass===Const.OBJECT_CLASS_LINE?I=function(){var G=JXG$1.evaluate(t.visProp.straightfirst),S=JXG$1.evaluate(t.visProp.straightlast),w=JXG$1.evaluate(o.visProp.straightfirst),M=JXG$1.evaluate(o.visProp.straightlast),V;return V=!JXG$1.evaluate(C)&&(!G||!S||!w||!M),f.meetPolygonLine(t,o,u,t.board,V)}:I=function(){return f.meetPathPath(t,o,u,t.board)}:t.elementClass===Const.OBJECT_CLASS_LINE&&o.elementClass===Const.OBJECT_CLASS_LINE?I=function(){var G,S,w=JXG$1.evaluate(t.visProp.straightfirst),M=JXG$1.evaluate(t.visProp.straightlast),V=JXG$1.evaluate(o.visProp.straightfirst),T=JXG$1.evaluate(o.visProp.straightlast);return!JXG$1.evaluate(C)&&(!w||!M||!V||!T)?(G=f.meetSegmentSegment(t.point1.coords.usrCoords,t.point2.coords.usrCoords,o.point1.coords.usrCoords,o.point2.coords.usrCoords),!w&&G[1]<0||!M&&G[1]>1||!V&&G[2]<0||!T&&G[2]>1?S=[0,NaN,NaN]:S=G[0],new Coords(Const.COORDS_BY_USER,S,t.board)):f.meet(t.stdform,o.stdform,u,t.board)}:I=function(){var G=f.meet(t.stdform,o.stdform,u,t.board),S=!0,w,M,V;return JXG$1.evaluate(C)?G:t.elementClass===Const.OBJECT_CLASS_LINE&&(w=JXG$1.evaluate(t.visProp.straightfirst),M=JXG$1.evaluate(t.visProp.straightlast),(!w||!M)&&(V=f.affineRatio(t.point1.coords,t.point2.coords,G),!M&&V>1+Mat.eps||!w&&V<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):o.elementClass===Const.OBJECT_CLASS_LINE&&(w=JXG$1.evaluate(o.visProp.straightfirst),M=JXG$1.evaluate(o.visProp.straightlast),(!w||!M)&&(V=f.affineRatio(o.point1.coords,o.point2.coords,G),!M&&V>1+Mat.eps||!w&&V<0-Mat.eps))?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):A&&(S=f.coordsOnArc(t,G),S&&y&&(S=f.coordsOnArc(o,G)),!S)?new Coords(JXG$1.COORDS_BY_USER,[0,NaN,NaN],t.board):G},I},otherIntersectionFunction:function(n,t,o,u){var d,C,I,f,A=this;return I=n[0],f=n[1],C=I.board,d=function(){var y,G,S,w,M,V=t.length,T=JXG$1.evaluate(u);for(y=V;y>=0;y--){for(I.elementClass===Const.OBJECT_CLASS_CIRCLE&&[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_LINE].indexOf(f.elementClass)>=0?S=A.meet(I.stdform,f.stdform,y,C):I.elementClass===Const.OBJECT_CLASS_CURVE&&[Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_CIRCLE].indexOf(f.elementClass)>=0?S=A.meetCurveCurve(I,f,y,0,C,"segment"):I.elementClass===Const.OBJECT_CLASS_CURVE&&f.elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.exists(I.dataX)?S=JXG$1.Math.Geometry.meetCurveLine(I,f,y,I.board,JXG$1.evaluate(o)):S=JXG$1.Math.Geometry.meetCurveLineContinuous(I,f,y,I.board)),M=!1,G=0;!M&&G<V;G++)w=S.distance(JXG$1.COORDS_BY_USER,t[G].coords),w<T&&(M=!0);if(!M)return S}return S},d},intersectionFunction3D:function(n,t,o,u){var d,C=this;return t.type===Const.OBJECT_TYPE_PLANE3D?o.type===Const.OBJECT_TYPE_PLANE3D?d=()=>n.intersectionPlanePlane(t,o)[u]:o.type===Const.OBJECT_TYPE_SPHERE3D&&(d=C.meetPlaneSphere(t,o)):t.type===Const.OBJECT_TYPE_SPHERE3D&&(o.type===Const.OBJECT_TYPE_PLANE3D?d=C.meetPlaneSphere(o,t):o.type===Const.OBJECT_TYPE_SPHERE3D&&(d=C.meetSphereSphere(t,o))),d},coordsOnArc:function(n,t){var o=this.rad(n.radiuspoint,n.center,t.usrCoords.slice(1)),u=0,d=this.rad(n.radiuspoint,n.center,n.anglepoint),C=JXG$1.evaluate(n.visProp.selection);return(C==="minor"&&d>Math.PI||C==="major"&&d<Math.PI)&&(u=d,d=2*Math.PI),!(o<u||o>d)},meet:function(n,t,o,u){var d,C=Mat.eps;return Math.abs(n[3])<C&&Math.abs(t[3])<C?d=this.meetLineLine(n,t,o,u):Math.abs(n[3])>=C&&Math.abs(t[3])<C?d=this.meetLineCircle(t,n,o,u):Math.abs(n[3])<C&&Math.abs(t[3])>=C?d=this.meetLineCircle(n,t,o,u):d=this.meetCircleCircle(n,t,o,u),d},meetLineBoard:function(n,t,o){var u=[],d,C,I,f;for(JXG$1.exists(o)||(o=0),u[0]=Mat.crossProduct(n,[o,0,1]),u[1]=Mat.crossProduct(n,[o,1,0]),u[2]=Mat.crossProduct(n,[-o-t.canvasHeight,0,1]),u[3]=Mat.crossProduct(n,[-o-t.canvasWidth,1,0]),I=0;I<4;I++)if(Math.abs(u[I][0])>Mat.eps){for(f=2;f>0;f--)u[I][f]/=u[I][0];u[I][0]=1}return Math.abs(u[1][0])<Mat.eps?(d=u[0],C=u[2]):Math.abs(u[0][0])<Mat.eps?(d=u[1],C=u[3]):u[1][2]<0?(d=u[0],u[3][2]>t.canvasHeight?C=u[2]:C=u[3]):u[1][2]>t.canvasHeight?(d=u[2],u[3][2]<0?C=u[0]:C=u[3]):(d=u[1],u[3][2]<0?C=u[0]:u[3][2]>t.canvasHeight?C=u[2]:C=u[3]),[new Coords(Const.COORDS_BY_SCREEN,d.slice(1),t),new Coords(Const.COORDS_BY_SCREEN,C.slice(1),t)]},meetLineLine:function(n,t,o,u){var d=isNaN(n[5]+t[5])?[0,0,0]:Mat.crossProduct(n,t);return Math.abs(d[0])<1e-14&&(d[0]=0),new Coords(Const.COORDS_BY_USER,d,u)},meetLineCircle:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M;return t[4]<Mat.eps?Math.abs(Mat.innerProduct([1,t[6],t[7]],n,3))<Mat.eps?new Coords(Const.COORDS_BY_USER,t.slice(6,8),u):new Coords(Const.COORDS_BY_USER,[NaN,NaN],u):(I=t[0],C=t.slice(1,3),d=t[3],f=n[0],A=n.slice(1,3),y=d,G=C[0]*A[1]-C[1]*A[0],S=d*f*f-(C[0]*A[0]+C[1]*A[1])*f+I,w=G*G-4*y*S,w>-Mat.eps*Mat.eps?(w=Math.sqrt(Math.abs(w)),M=[(-G+w)/(2*y),(-G-w)/(2*y)],JXG$1.evaluate(o)===0?new Coords(Const.COORDS_BY_USER,[-M[0]*-A[1]-f*A[0],-M[0]*A[0]-f*A[1]],u):new Coords(Const.COORDS_BY_USER,[-M[1]*-A[1]-f*A[0],-M[1]*A[0]-f*A[1]],u)):new Coords(Const.COORDS_BY_USER,[0,0,0],u))},meetCircleCircle:function(n,t,o,u){var d;return n[4]<Mat.eps?Math.abs(this.distance(n.slice(6,2),t.slice(6,8))-t[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,n.slice(6,8),u):new Coords(Const.COORDS_BY_USER,[0,0,0],u):t[4]<Mat.eps?Math.abs(this.distance(t.slice(6,2),n.slice(6,8))-n[4])<Mat.eps?new Coords(Const.COORDS_BY_USER,t.slice(6,8),u):new Coords(Const.COORDS_BY_USER,[0,0,0],u):(d=[t[3]*n[0]-n[3]*t[0],t[3]*n[1]-n[3]*t[1],t[3]*n[2]-n[3]*t[2],0,1,1/0,1/0,1/0],d=Mat.normalize(d),this.meetLineCircle(d,n,o,u))},meetCurveCurve:function(n,t,o,u,d,C){var I;return JXG$1.exists(C)&&C==="newton"?I=Numerics.generalizedNewton(n,t,JXG$1.evaluate(o),u):n.bezierDegree===3||t.bezierDegree===3?I=this.meetBezierCurveRedBlueSegments(n,t,o):I=this.meetCurveRedBlueSegments(n,t,o),new Coords(Const.COORDS_BY_USER,I,d)},meetCurveLine:function(n,t,o,u,d){var C=[0,NaN,NaN],I,f;return JXG$1.exists(u)||(u=n.board),n.elementClass===Const.OBJECT_CLASS_CURVE?(I=n,f=t):(I=t,f=n),C=this.meetCurveLineDiscrete(I,f,o,u,!d),C},meetCurveLineContinuous:function(n,t,o,u,d){var C,I,f,A,y,G,S,w=Mat.eps,M=Mat.eps,V,T,H,J,z,L,K;for(A=this.meetCurveLineDiscrete(n,t,o,u,d),y=A.usrCoords[1],G=A.usrCoords[2],C=function(O){var Q,ee;return O>n.maxX()||O<n.minX()?1/0:(Q=n.X(O)-y,ee=n.Y(O)-G,Q*Q+ee*ee)},I=function(O){var Q=t.stdform[0]+t.stdform[1]*n.X(O)+t.stdform[2]*n.Y(O);return Q*Q},V=50,T=(n.maxX()-n.minX())/V,H=n.minX(),z=1e-4,J=NaN,L=0;L<V&&(f=Numerics.root(C,[Math.max(H,n.minX()),Math.min(H+T,n.maxX())]),K=Math.abs(C(f)),!(K<=z&&(z=K,J=f,z<w)));L++)H+=T;return f=J,f=Numerics.root(I,[Math.max(f-T,n.minX()),Math.min(f+T,n.maxX())]),K=I(f),isNaN(K)||Math.abs(K)>M?S=0:S=1,new Coords(Const.COORDS_BY_USER,[S,n.X(f),n.Y(f)],u)},meetCurveLineDiscrete:function(n,t,o,u,d){var C,I,f=JXG$1.evaluate(o),A,y,G,S,w=t.point1.coords.usrCoords,M=t.point2.coords.usrCoords,V,T,H=0,J=n.numberPoints,z=JXG$1.evaluate(t.visProp.straightfirst),L=JXG$1.evaluate(t.visProp.straightlast);for(S=new Coords(Const.COORDS_BY_USER,[0,NaN,NaN],u),w[0]===0?w=[1,M[1]+t.stdform[2],M[2]-t.stdform[1]]:M[0]===0&&(M=[1,w[1]+t.stdform[2],w[2]-t.stdform[1]]),y=n.points[0].usrCoords,C=1;C<J;C+=n.bezierDegree)if(A=y.slice(0),y=n.points[C].usrCoords,V=this.distance(A,y),V>Mat.eps){for(n.bezierDegree===3?T=this.meetBeziersegmentBeziersegment([n.points[C-1].usrCoords.slice(1),n.points[C].usrCoords.slice(1),n.points[C+1].usrCoords.slice(1),n.points[C+2].usrCoords.slice(1)],[w.slice(1),M.slice(1)],d):T=[this.meetSegmentSegment(A,y,w,M)],I=0;I<T.length;I++)if(G=T[I],0<=G[1]&&G[1]<=1){if(H===f)return d&&(!z&&G[2]<0||!L&&G[2]>1)||(S=new Coords(Const.COORDS_BY_USER,G[0],u)),S;H+=1}}return S},meetCurveRedBlueSegments:function(n,t,o){var u,d,C=JXG$1.evaluate(o),I,f,A,y,G,S,w,M=0,V=t.numberPoints,T=n.numberPoints;if(V<=1||T<=1)return[0,NaN,NaN];for(u=1;u<T;u++)for(I=n.points[u-1].usrCoords,f=n.points[u].usrCoords,S=Math.min(I[1],f[1]),w=Math.max(I[1],f[1]),y=t.points[0].usrCoords,d=1;d<V;d++)if(A=y,y=t.points[d].usrCoords,Math.min(A[1],y[1])<w&&Math.max(A[1],y[1])>S&&(G=this.meetSegmentSegment(I,f,A,y),G[1]>=0&&G[2]>=0&&(G[1]<1&&G[2]<1||u===T-1&&G[1]===1||d===V-1&&G[2]===1))){if(M===C)return G[0];M++}return[0,NaN,NaN]},meetSegmentSegment:function(n,t,o,u){var d,C,I,f,A=Mat.crossProduct(n,t),y=Mat.crossProduct(o,u),G=Mat.crossProduct(A,y);return Math.abs(G[0])<Mat.eps?[G,1/0,1/0]:(G[1]/=G[0],G[2]/=G[0],G[0]/=G[0],I=Math.abs(t[1]-t[0]*n[1])<Mat.eps?2:1,f=n[I]/n[0],d=(G[I]-f)/(t[0]!==0?t[I]/t[0]-f:t[I]),I=Math.abs(u[1]-u[0]*o[1])<Mat.eps?2:1,f=o[I]/o[0],C=(G[I]-f)/(u[0]!==0?u[I]/u[0]-f:u[I]),[G,d,C])},meetPathPath:function(n,t,o,u){var d,C,I,f,A=JXG$1.evaluate(o);return d=JXG$1.Math.Clip._getPath(n,u),I=d.length,I>0&&this.distance(d[0].coords.usrCoords,d[I-1].coords.usrCoords,3)<Mat.eps&&d.pop(),C=JXG$1.Math.Clip._getPath(t,u),I=C.length,I>0&&this.distance(C[0].coords.usrCoords,C[I-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&C.pop(),o<0||JXG$1.Math.Clip.isEmptyCase(d,C,"intersection")?new Coords(Const.COORDS_BY_USER,[0,0,0],u):(JXG$1.Math.Clip.makeDoublyLinkedList(d),JXG$1.Math.Clip.makeDoublyLinkedList(C),f=JXG$1.Math.Clip.findIntersections(d,C,u)[0],A<f.length?f[A].coords:new Coords(Const.COORDS_BY_USER,[0,0,0],u))},meetPolygonLine:function(n,t,o,u,d){var C,I=JXG$1.evaluate(o),f,A,y=[0,0,0],G=n.borders.length,S=[];for(C=0;C<G;C++)A=n.borders[C],f=this.meetSegmentSegment(A.point1.coords.usrCoords,A.point2.coords.usrCoords,t.point1.coords.usrCoords,t.point2.coords.usrCoords),(!d||f[2]>=0&&f[2]<1)&&f[1]>=0&&f[1]<1&&S.push(f[0]);return I>=0&&I<S.length&&(y=S[I]),new Coords(Const.COORDS_BY_USER,y,u)},meetPlaneSphere:function(n,t){var o=function(){return n.normal[0]*t.center.X()+n.normal[1]*t.center.Y()+n.normal[2]*t.center.Z()-n.d};return[[function(){return t.center.X()-o()*n.normal[0]},function(){return t.center.Y()-o()*n.normal[1]},function(){return t.center.Z()-o()*n.normal[2]}],[()=>n.normal[0],()=>n.normal[1],()=>n.normal[2]],function(){var u=t.Radius(),d=o();return Math.sqrt(u*u-d*d)}]},meetSphereSphere:function(n,t){var o=function(){var u=n.center.distance(t.center),d=n.Radius(),C=t.Radius();return(d-C)*(d+C)/(u*u)};return[[function(){var u=o();return .5*((1-u)*n.center.X()+(1+u)*t.center.X())},function(){var u=o();return .5*((1-u)*n.center.Y()+(1+u)*t.center.Y())},function(){var u=o();return .5*((1-u)*n.center.Z()+(1+u)*t.center.Z())}],[()=>t.center.X()-n.center.X(),()=>t.center.Y()-n.center.Y(),()=>t.center.Z()-n.center.Z()],function(){var u=n.center.distance(t.center),d=n.Radius(),C=t.Radius(),I=o(),f=.5*(d*d+C*C-.5*u*u*(1+I*I));return Math.sqrt(f)}]},_bezierSplit:function(n){var t,o,u,d,C,I;return t=[(n[0][0]+n[1][0])*.5,(n[0][1]+n[1][1])*.5],o=[(n[1][0]+n[2][0])*.5,(n[1][1]+n[2][1])*.5],u=[(n[2][0]+n[3][0])*.5,(n[2][1]+n[3][1])*.5],d=[(t[0]+o[0])*.5,(t[1]+o[1])*.5],C=[(o[0]+u[0])*.5,(o[1]+u[1])*.5],I=[(d[0]+C[0])*.5,(d[1]+C[1])*.5],[[n[0],t,d,I],[I,C,u,n[3]]]},_bezierBbox:function(n){var t=[];return n.length===4?(t[0]=Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),t[1]=Math.max(n[0][1],n[1][1],n[2][1],n[3][1]),t[2]=Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),t[3]=Math.min(n[0][1],n[1][1],n[2][1],n[3][1])):(t[0]=Math.min(n[0][0],n[1][0]),t[1]=Math.max(n[0][1],n[1][1]),t[2]=Math.max(n[0][0],n[1][0]),t[3]=Math.min(n[0][1],n[1][1])),t},_bezierOverlap:function(n,t){return n[2]>=t[0]&&n[0]<=t[2]&&n[1]>=t[3]&&n[3]<=t[1]},_bezierListConcat:function(n,t,o,u){var d,C=JXG$1.exists(u),I=0,f=t.length,A=n.length;for(A>0&&f>0&&(n[A-1][1]===1&&t[0][1]===0||C&&n[A-1][2]===1&&t[0][2]===0)&&(I=1),d=I;d<f;d++)C&&(t[d][2]*=.5,t[d][2]+=u),t[d][1]*=.5,t[d][1]+=o,n.push(t[d])},_bezierMeetSubdivision:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T=[],H=5;return d=this._bezierBbox(t),u=this._bezierBbox(n),this._bezierOverlap(d,u)?o<H?(C=this._bezierSplit(n),A=C[0],y=C[1],C=this._bezierSplit(t),I=C[0],f=C[1],this._bezierListConcat(T,this._bezierMeetSubdivision(A,I,o+1),0,0),this._bezierListConcat(T,this._bezierMeetSubdivision(A,f,o+1),0,.5),this._bezierListConcat(T,this._bezierMeetSubdivision(y,I,o+1),.5,0),this._bezierListConcat(T,this._bezierMeetSubdivision(y,f,o+1),.5,.5),T):(M=[1].concat(n[0]),V=[1].concat(n[3]),S=[1].concat(t[0]),w=[1].concat(t[3]),G=this.meetSegmentSegment(M,V,S,w),G[1]>=0&&G[2]>=0&&G[1]<=1&&G[2]<=1?[G]:[]):[]},_bezierLineMeetSubdivision:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M,V=[],T=5;return d=this._bezierBbox(t),C=this._bezierBbox(n),u&&!this._bezierOverlap(C,d)?[]:o<T?(I=this._bezierSplit(n),f=I[0],A=I[1],this._bezierListConcat(V,this._bezierLineMeetSubdivision(f,t,o+1),0),this._bezierListConcat(V,this._bezierLineMeetSubdivision(A,t,o+1),.5),V):(w=[1].concat(n[0]),M=[1].concat(n[3]),G=[1].concat(t[0]),S=[1].concat(t[1]),y=this.meetSegmentSegment(w,M,G,S),y[1]>=0&&y[1]<=1&&(!u||y[2]>=0&&y[2]<=1)?[y]:[])},meetBeziersegmentBeziersegment:function(n,t,o){var u,d,C;for(n.length===4&&t.length===4?u=this._bezierMeetSubdivision(n,t,0):u=this._bezierLineMeetSubdivision(n,t,0,o),u.sort(function(I,f){return(I[1]-f[1])*1e7+(I[2]-f[2])}),d=[],C=0;C<u.length;C++)(C===0||u[C][1]!==u[C-1][1]||u[C][2]!==u[C-1][2])&&d.push(u[C]);return d},meetBezierCurveRedBlueSegments:function(n,t,o){var u,d,C,I,f=JXG$1.evaluate(o),A,y,G,S,w,M,V,T=0,H=0,J,z,L=[];if(t.numberPoints<t.bezierDegree+1||n.numberPoints<n.bezierDegree+1)return[0,NaN,NaN];for(n.bezierDegree===1&&t.bezierDegree===3&&(y=n,n=t,t=y),J=t.numberPoints-t.bezierDegree,z=n.numberPoints-n.bezierDegree,n.type===Const.OBJECT_TYPE_SECTOR&&(T=3,z-=3),t.type===Const.OBJECT_TYPE_SECTOR&&(H=3,J-=3),d=T;d<z;d+=n.bezierDegree)for(u=n.points,G=[u[d].usrCoords.slice(1),u[d+1].usrCoords.slice(1)],n.bezierDegree===3&&(G[2]=u[d+2].usrCoords.slice(1),G[3]=u[d+3].usrCoords.slice(1)),w=this._bezierBbox(G),C=H;C<J;C+=t.bezierDegree)if(u=t.points,S=[u[C].usrCoords.slice(1),u[C+1].usrCoords.slice(1)],t.bezierDegree===3&&(S[2]=u[C+2].usrCoords.slice(1),S[3]=u[C+3].usrCoords.slice(1)),M=this._bezierBbox(S),this._bezierOverlap(w,M)){if(V=this.meetBeziersegmentBeziersegment(G,S),V.length===0)continue;for(I=0;I<V.length;I++)A=V[I],!(A[1]<-Mat.eps||A[1]>1+Mat.eps||A[2]<-Mat.eps||A[2]>1+Mat.eps)&&L.push(A);if(L.length>f)return L[f][0]}return L.length>f?L[f][0]:[0,NaN,NaN]},bezierSegmentEval:function(n,t){var o,u,d,C=1-n;return u=0,d=0,o=C*C*C,u+=o*t[0][0],d+=o*t[0][1],o=3*n*C*C,u+=o*t[1][0],d+=o*t[1][1],o=3*n*n*C,u+=o*t[2][0],d+=o*t[2][1],o=n*n*n,u+=o*t[3][0],d+=o*t[3][1],[1,u,d]},bezierArc:function(n,t,o,u,d){var C,I,f,A,y,G,S,w,M=t[1],V=t[2],T=t[0],H=[],J=[],z,L,K,O,Q,ee,ie,te,se,ae;for(y=this.distance(t,n),M/=T,V/=T,G=this.rad(n.slice(1),t.slice(1),o.slice(1)),d===-1&&(G=2*Math.PI-G),w=G/4,C=n,C[1]/=C[0],C[2]/=C[0],C[0]/=C[0],A=C.slice(0),u?(H=[M,M+.333*(C[1]-M),M+.666*(C[1]-M),C[1]],J=[V,V+.333*(C[2]-V),V+.666*(C[2]-V),C[2]]):(H=[C[1]],J=[C[2]]);G>Mat.eps;)G>w?(S=w,G-=w):(S=G,G=0),z=Math.cos(d*S),L=Math.sin(d*S),ae=[[1,0,0],[M*(1-z)+V*L,z,-L],[V*(1-z)-M*L,L,z]],te=Mat.matVecMult(ae,C),A=[te[0]/te[0],te[1]/te[0],te[2]/te[0]],K=C[1]-M,O=C[2]-V,Q=A[1]-M,ee=A[2]-V,se=Mat.hypot(K+Q,O+ee),Math.abs(ee-O)>Mat.eps?ie=(K+Q)*(y/se-.5)/(ee-O)*8/3:ie=(O+ee)*(y/se-.5)/(K-Q)*8/3,I=[1,C[1]-ie*O,C[2]+ie*K],f=[1,A[1]+ie*ee,A[2]-ie*Q],JXG$1.concat(H,[I[1],f[1],A[1]]),JXG$1.concat(J,[I[2],f[2],A[2]]),C=A.slice(0);return u&&(JXG$1.concat(H,[A[1]+.333*(M-A[1]),A[1]+.666*(M-A[1]),M]),JXG$1.concat(J,[A[2]+.333*(V-A[2]),A[2]+.666*(V-A[2]),V])),[H,J]},projectPointToCircle:function(n,t,o){var u,d,C,I,f,A=t.center.coords.usrCoords;return JXG$1.exists(o)||(o=n.board),JXG$1.isPoint(n)?(u=n.coords.distance(Const.COORDS_BY_USER,t.center.coords),d=n.coords.usrCoords):(u=n.distance(Const.COORDS_BY_USER,t.center.coords),d=n.usrCoords),Math.abs(u)<Mat.eps&&(u=Mat.eps),f=t.Radius()/u,C=A[1]+f*(d[1]-A[1]),I=A[2]+f*(d[2]-A[2]),new Coords(Const.COORDS_BY_USER,[C,I],o)},projectPointToLine:function(n,t,o){var u=[0,t.stdform[1],t.stdform[2]],d;return JXG$1.exists(o)||(JXG$1.exists(n.coords)?o=n.board:o=t.board),JXG$1.exists(n.coords)?d=n.coords.usrCoords:d=n.usrCoords,u=Mat.crossProduct(u,d),new Coords(Const.COORDS_BY_USER,Mat.crossProduct(u,t.stdform),o)},projectCoordsToSegment:function(n,t,o){var u,d,C=[o[1]-t[1],o[2]-t[2]],I=[n[1]-t[1],n[2]-t[2]];return Math.abs(C[0])<Mat.eps&&Math.abs(C[1])<Mat.eps?[t,0]:(u=Mat.innerProduct(I,C),d=Mat.innerProduct(C,C),u/=d,[[1,u*C[0]+t[1],u*C[1]+t[2]],u])},projectCoordsToBeziersegment:function(n,t,o){var u,d=function(C){var I=[1,t.X(o+C),t.Y(o+C)];return I[1]-=n[1],I[2]-=n[2],I[1]*I[1]+I[2]*I[2]};return u=JXG$1.Math.Numerics.fminbr(d,[0,1]),[[1,t.X(u+o),t.Y(u+o)],u]},projectPointToCurve:function(n,t,o){JXG$1.exists(o)||(o=n.board);var u=n.X(),d=n.Y(),C=n.position,I;return JXG$1.exists(C)||(C=JXG$1.evaluate(t.visProp.curvetype)==="functiongraph"?u:0),I=this.projectCoordsToCurve(u,d,C,t,o),I},projectCoordsToCurve:function(n,t,o,u,d){var C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe=Number.POSITIVE_INFINITY;if(JXG$1.exists(d)||(d=u.board),JXG$1.evaluate(u.visProp.curvetype)==="plot"){if(o=0,y=Xe,u.numberPoints===0?C=[0,1,1]:C=[u.Z(0),u.X(0),u.Y(0)],u.numberPoints>1)for(w=[1,n,t],u.bezierDegree===3?A=0:T=[u.Z(0),u.X(0),u.Y(0)],f=0;f<u.numberPoints-1;f++)u.bezierDegree===3?J=this.projectCoordsToBeziersegment(w,u,A):(H=[u.Z(f+1),u.X(f+1),u.Y(f+1)],J=this.projectCoordsToSegment(w,T,H)),S=J[1],M=J[0],0<=S&&S<=1?(G=this.distance(M,w),V=f+S):S<0?(M=T,G=this.distance(T,w),V=f):S>1&&f===u.numberPoints-2&&(M=H,G=this.distance(M,w),V=u.numberPoints-1),G<y&&(y=G,o=V,C=M),u.bezierDegree===3?(A++,f+=2):T=H;I=new Coords(Const.COORDS_BY_USER,C,d)}else{for(ge=u.minX(),be=u.maxX(),ae=ge,le=be,JXG$1.evaluate(u.visProp.curvetype)==="functiongraph"&&(Q=Math.abs(t-u.Y(n)),isNaN(Q)||(ae=n-Q,le=n+Q)),z=function(Ce){var Re,Se;return Ce<ge||Ce>u.maxX_glob?1/0:(Re=n-u.X(Ce),Se=t-u.Y(Ce),Re*Re+Se*Se)},O=z(o),se=50,ee=(le-ae)/se,L=ae,f=0;f<se;f++)K=z(L),(K<O||O===1/0||isNaN(O))&&(o=L,O=K),L+=ee;for(ie=ee,f=0;f<20&&isNaN(z(o-ie));f++,ie*=.5);for(isNaN(z(o-ie))&&(ie=0),te=ee,f=0;f<20&&isNaN(z(o+te));f++,te*=.5);isNaN(z(o+te))&&(te=0),o=Numerics.fminbr(z,[Math.max(o-ie,ae),Math.min(o+te,le)]),o=o<ge?ge:o,o=o>be?be:o,I=new Coords(Const.COORDS_BY_USER,[u.X(o),u.Y(o)],d)}return[u.updateTransform(I),o]},projectCoordsToPolygon:function(n,t){var o,u=t.vertices.length,d=1/0,C,I,f,A;for(o=0;o<u-1;o++)I=JXG$1.Math.Geometry.projectCoordsToSegment(n,t.vertices[o].coords.usrCoords,t.vertices[o+1].coords.usrCoords),0<=I[1]&&I[1]<=1?(C=JXG$1.Math.Geometry.distance(I[0],n,3),f=I[0]):I[1]<0?(C=JXG$1.Math.Geometry.distance(t.vertices[o].coords.usrCoords,n,3),f=t.vertices[o].coords.usrCoords):(C=JXG$1.Math.Geometry.distance(t.vertices[o+1].coords.usrCoords,n,3),f=t.vertices[o+1].coords.usrCoords),C<d&&(A=f.slice(0),d=C);return A},projectPointToTurtle:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M=0,V=0,T=Number.POSITIVE_INFINITY,H=t.objects.length;for(JXG$1.exists(o)||(o=n.board),f=0;f<H;f++)y=t.objects[f],y.elementClass===Const.OBJECT_CLASS_CURVE&&(S=this.projectPointToCurve(n,y),u=S[0],w=S[1],A=this.distance(u.usrCoords,n.coords.usrCoords),A<T&&(C=u.usrCoords[1],I=u.usrCoords[2],d=w,T=A,G=y,V=M),M+=y.numberPoints);return u=new Coords(Const.COORDS_BY_USER,[C,I],o),[G.updateTransform(u),d+V]},projectPointToPoint:function(n,t){return t.coords},projectPointToBoard:function(n,t){var o,u,d,C=t||n.board,I=[[1,1,0,0,3,0,1],[-1,2,1,0,1,2,1],[-1,1,2,2,1,2,3],[1,2,3,0,3,2,3]],f=n.coords||n,A=C.getBoundingBox();for(o=0;o<4;o++)d=I[o],d[0]*f.usrCoords[d[1]]<d[0]*A[d[2]]&&(u=Mat.crossProduct([1,A[d[3]],A[d[4]]],[1,A[d[5]],A[d[6]]]),u[3]=0,u=Mat.normalize(u),f=this.projectPointToLine({coords:f},{stdform:u},C));return f},projectCoordsToParametric:function(n,t,o){var u,d,C=0,I=200,f=o.length,A;return f===1?u=.1*(t.range[1]-t.range[0]):f===2&&(u=.1*Math.min(t.range_u[1]-t.range_u[0],t.range_v[1]-t.range_v[0])),d=u/5e6,A=function(y,G,S,w){var M=n[0]-t.X.apply(null,S),V=n[1]-t.Y.apply(null,S),T=n[2]-t.Z.apply(null,S);return y===1?(w[0]=S[0]-t.range[0],w[1]=-S[0]+t.range[1]):y===2&&(w[0]=S[0]-t.range_u[0],w[1]=-S[0]+t.range_u[1],w[2]=S[1]-t.range_v[0],w[3]=-S[1]+t.range_v[1]),M*M+V*V+T*T},Mat.Nlp.FindMinimum(A,f,2*f,o,u,d,C,I),[1,t.X.apply(null,o),t.Y.apply(null,o),t.Z.apply(null,o)]},projectScreenCoordsToParametric:function(n,t,o){var u,d,C=0,I=200,f=o.length,A;return f===1?u=.1*(t.range[1]-t.range[0]):f===2&&(u=.1*Math.min(t.range_u[1]-t.range_u[0],t.range_v[1]-t.range_v[0])),d=u/5e6,A=function(y,G,S,w){var M=[1,t.X.apply(null,S),t.Y.apply(null,S),t.Z.apply(null,S)],V=t.view.project3DTo2D(M),T=n[0]-V[1],H=n[1]-V[2];return y===1?(w[0]=S[0]-t.range[0],w[1]=-S[0]+t.range[1]):y===2&&(w[0]=S[0]-t.range_u[0],w[1]=-S[0]+t.range_u[1],w[2]=S[1]-t.range_v[0],w[3]=-S[1]+t.range_v[1]),T*T+H*H},Mat.Nlp.FindMinimum(A,f,2*f,o,u,d,C,I),[1,t.X.apply(null,o),t.Y.apply(null,o),t.Z.apply(null,o)]},distPointLine:function(n,t){var o=t[1],u=t[2],d=t[0],C;return Math.abs(o)+Math.abs(u)<Mat.eps?Number.POSITIVE_INFINITY:(C=o*n[1]+u*n[2]+d,o*=o,u*=u,Math.abs(C)/Math.sqrt(o+u))},distPointSegment:function(n,t,o){var u,d,C,I,f,A,y=Mat.eps*Mat.eps,G=1e6;return u=n[1]-t[1],d=n[2]-t[2],u=u===1/0?G:u===-1/0?-1e6:u,d=d===1/0?G:d===-1/0?-1e6:d,C=o[1]-t[1],I=o[2]-t[2],C=C===1/0?G:C===-1/0?-1e6:C,I=I===1/0?G:I===-1/0?-1e6:I,f=C*C+I*I,f>y&&(A=(u*C+d*I)/f,A<0?A=0:A>1&&(A=1),u-=A*C,d-=A*I),Mat.hypot(u,d)},reuleauxPolygon:function(n,t){var o,u=Math.PI*2,d=u/t,C=(t-1)/2,I=0,f=function(A,y){return function(G,S){var w=(G%u+u)%u,M=Math.floor(w/d)%t;return S||(I=n[0].Dist(n[C]),o=Mat.Geometry.rad([n[0].X()+1,n[0].Y()],n[0],n[C%t])),isNaN(M)?M:(w=w*.5+M*d*.5+o,n[M][A]()+I*Math[y](w))}};return[f("X","cos"),f("Y","sin"),0,u]},meet3Planes:function(n,t,o,u,d,C){var I=[0,0,0],f,A,y,G,S;for(f=Mat.crossProduct(d,n),A=Mat.crossProduct(n,o),y=Mat.crossProduct(o,d),G=Mat.innerProduct(n,y,3),S=0;S<3;S++)I[S]=(t*y[S]+u*f[S]+C*A[S])/G;return I},meetPlanePlane:function(n,t,o,u){var d,C,I,f=[0,0,0],A=[0,0,0];for(d=0;d<3;d++)f[d]=JXG$1.evaluate(n[d]),A[d]=JXG$1.evaluate(t[d]);for(C=Mat.crossProduct(f,A),d=0;d<3;d++)f[d]=JXG$1.evaluate(o[d]),A[d]=JXG$1.evaluate(u[d]);return I=Mat.crossProduct(f,A),Mat.crossProduct(C,I)},project3DTo3DPlane:function(n,t,o){var u=[0,0,0],d,C,I,f;return o=o||[0,0,0],d=Mat.norm(t),C=Mat.innerProduct(n,t,3),I=Mat.innerProduct(o,t,3),f=(C-I)/d,u=Mat.axpy(-f,t,n),u},getPlaneBounds:function(n,t,o,u,d){var C,I,f,A,y,G,S;return n[2]+t[0]!==0?(y=[[n[0],t[0]],[n[1],t[1]]],G=[u-o[0],u-o[1]],S=Numerics.Gauss(y,G),C=S[0],I=S[1],G=[d-o[0],d-o[1]],S=Numerics.Gauss(y,G),f=S[0],A=S[1],[C,f,I,A]):null}});const Geometry=Mat.Geometry;Mat.Quadtree=function(n,t,o){t=t||{capacity:10,pointType:"coords"},this.config={},this.config.capacity=t.capacity||10,this.config.pointType=t.pointType||"coords",this.points=[],this.xlb=n[0],this.xub=n[2],this.ylb=n[3],this.yub=n[1],this.parent=o||null,this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null};JXG$1.extend(Mat.Quadtree.prototype,{contains:function(n,t){return this.xlb<n&&n<=this.xub&&this.ylb<t&&t<=this.yub},insert:function(n){switch(this.config.pointType){case"coords":if(!this.contains(n.usrCoords[1],n.usrCoords[2]))return!1;break;case"object":if(!this.contains(n.x,n.y))return!1;break}return this.points.length<this.config.capacity&&this.northWest===null?(this.points.push(n),!0):(this.northWest===null&&this.subdivide(),this.northWest.insert(n)||this.northEast.insert(n)||this.southEast.insert(n)?!0:!!this.southWest.insert(n))},subdivide:function(){var n=this.xlb+(this.xub-this.xlb)*.5,t=this.ylb+(this.yub-this.ylb)*.5;this.northWest=new Mat.Quadtree([this.xlb,this.yub,n,t],this.config,this),this.northEast=new Mat.Quadtree([n,this.yub,this.xub,t],this.config,this),this.southEast=new Mat.Quadtree([this.xlb,t,n,this.ylb],this.config,this),this.southWest=new Mat.Quadtree([n,t,this.xub,this.ylb],this.config,this)},_query:function(n,t){var o;if(this.contains(n,t)){if(this.northWest===null)return this;if(o=this.northWest._query(n,t),o||(o=this.northEast._query(n,t),o)||(o=this.southEast._query(n,t),o)||(o=this.southWest._query(n,t),o))return o}return!1},query:function(n,t){var o,u;return JXG$1.exists(t)?(o=n,u=t):(o=n.usrCoords[1],u=n.usrCoords[2]),this._query(o,u)},hasPoint:function(n,t,o){var u,d,C;if(this.contains(n,t)){switch(C=this.points.length,this.config.pointType){case"coords":for(d=0;d<C;d++)if(Geometry.distance([n,t],this.points[d].usrCoords.slice(1),2)<o)return!0;break;case"object":for(d=0;d<C;d++)if(Geometry.distance([n,t],[this.points[d].x,this.points[d].y],2)<o)return!0;break}if(this.northWest===null)return!1;if(u=this.northWest.hasPoint(n,t,o),u||(u=this.northEast.hasPoint(n,t,o),u)||(u=this.southEast.hasPoint(n,t,o),u)||(u=this.southWest.hasPoint(n,t,o),u))return u}return!1},getAllPoints:function(){var n=[];return this.getAllPointsRecursive(n),n},getAllPointsRecursive(n){Array.prototype.push.apply(n,this.points.slice()),this.northWest!==null&&(this.northWest.getAllPointsRecursive(n),this.northEast.getAllPointsRecursive(n),this.southEast.getAllPointsRecursive(n),this.southWest.getAllPointsRecursive(n))}});const QDT=Mat.Quadtree;Mat.BoxQuadtree=function(n,t,o){var u,d,C,I;n--,this.depth=n,this.capacity=t,this.items=[],this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null,this.bbox=null,this.cx=null,this.cy=null,o&&(u=o[0],d=o[1],C=o[2],I=o[3],this.cx=(u+C)*.5,this.cy=(d+I)*.5,this.bbox=[u,d,C,I])};JXG$1.extend(Mat.BoxQuadtree.prototype,{insert:function(n){var t,o,u,d,C,I,f,A=[],y=[],G=[],S=[],w,M,V,T;if(this.bbox===null){for(o=n.length,u=I=1/0,C=d=-1/0,t=0;t<n.length;t++)f=n[t],u=f.xlb<u?f.xlb:u,d=f.yub>d?f.yub:d,C=f.xub>C?f.xub:C,I=f.ylb<I?f.ylb:I;this.cx=(u+C)*.5,this.cy=(d+I)*.5,this.bbox=[u,d,C,I]}else u=this.bbox[0],d=this.bbox[1],C=this.bbox[2],I=this.bbox[3];if(this.depth===0||this.items.length+n.length<this.capacity)return this.items=this.items.concat(n),this;for(o=n.length,t=0;t<o;t++)f=n[t],w=f.xlb<=this.cx&&f.yub>this.cy,V=f.xlb<=this.cx&&f.ylb<=this.cy,M=f.xub>this.cx&&f.yub>this.cy,T=f.xub>this.cx&&f.ylb<=this.cy,w&&M&&T&&V?this.items.push(f):(w&&A.push(f),V&&G.push(f),M&&y.push(f),T&&S.push(f));return this.subdivide(A,G,y,S,u,d,C,I),this},insertItem:function(n){var t,o,u,d,C=[],I=[],f=[],A=[],y,G,S,w;return this.bbox===null?(t=d=1/0,u=o=-1/0,t=n.xlb<t?n.xlb:t,o=n.yub>o?n.yub:o,u=n.xub>u?n.xub:u,d=n.ylb<d?n.ylb:d,this.cx=(t+u)*.5,this.cy=(o+d)*.5,this.bbox=[t,o,u,d]):(t=this.bbox[0],o=this.bbox[1],u=this.bbox[2],d=this.bbox[3]),this.depth===0||this.items.length+1<this.capacity?(this.items.push(n),this):(y=n.xlb<=this.cx&&n.yub>this.cy,S=n.xlb<=this.cx&&n.ylb<=this.cy,G=n.xub>this.cx&&n.yub>this.cy,w=n.xub>this.cx&&n.ylb<=this.cy,y&&G&&w&&S?this.items.push(n):(y&&C.push(n),S&&f.push(n),G&&I.push(n),w&&A.push(n)),this.subdivide(C,f,I,A,t,o,u,d),this)},subdivide:function(n,t,o,u,d,C,I,f){return n.length>0&&(this.northWest===null&&(this.northWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[d,C,this.cx,this.cy])),this.northWest.insert(n)),t.length>0&&(this.southWest===null&&(this.southWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[d,this.cy,this.cx,f])),this.southWest.insert(t)),o.length>0&&(this.northEast===null&&(this.northEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,C,I,this.cy])),this.northEast.insert(o)),u.length>0&&(this.southEast===null&&(this.southEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,this.cy,I,f])),this.southEast.insert(u)),this},find:function(n){var t=function(C){return n[2]>=C.xlb&&n[0]<=C.xub&&n[3]<=C.yub&&n[1]>=C.ylb},o=[],u,d;for(d=this.items.length,u=0;u<d;u++)t(this.items[u])&&o.push(this.items[u]);return this.northWest!==null&&n[0]<=this.cx&n[1]>=this.cy&&JXG$1.concat(o,this.northWest.find(n)),this.southWest!==null&&n[0]<=this.cx&n[3]<=this.cy&&JXG$1.concat(o,this.southWest.find(n)),this.northEast!==null&&n[2]>=this.cx&n[1]>=this.cy&&JXG$1.concat(o,this.northEast.find(n)),this.southEast!==null&&n[2]>=this.cx&n[3]<=this.cy&&JXG$1.concat(o,this.southEast.find(n)),o},analyzeTree:function(){var n={number_items:this.items.length,depth:1},t;return this.northWest!==null&&(t=this.northWest.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.southWest!==null&&(t=this.southWest.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.northEast!==null&&(t=this.northEast.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),this.southEast!==null&&(t=this.southEast.analyzeTree(),n.number_items+=t.number_items,n.depth=Math.max(n.depth,1+t.depth)),n},plot:function(){var n=[],t=[],o;return n.push(this.bbox[0]),t.push(this.bbox[3]),n.push(this.bbox[2]),t.push(this.bbox[3]),n.push(this.bbox[2]),t.push(this.bbox[1]),n.push(this.bbox[0]),t.push(this.bbox[1]),n.push(this.bbox[0]),t.push(this.bbox[3]),n.push(NaN),t.push(NaN),this.northWest!==null&&(o=this.northWest.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.northEast!==null&&(o=this.northEast.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.southEast!==null&&(o=this.southEast.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),this.southWest!==null&&(o=this.southWest.plot(),JXG$1.concat(n,o[0]),JXG$1.concat(t,o[1])),[n,t]}});const Quadtree=Mat.BoxQuadtree;JXG$1.Math.Nlp={arr:function(n){return new Float64Array(n)},arr2:function(n,t){for(var o=0,u=new Array(n);o<n;)u[o]=this.arr(t),o++;return u},arraycopy:function(n,t,o,u,d){for(var C=0;C<d;)o[C+u]=n[C+t],C++},lastNumberOfEvaluations:0,GetLastNumberOfEvaluations:function(){return this.lastNumberOfEvaluations},Normal:0,MaxIterationsReached:1,DivergingRoundingErrors:2,FindMinimum:function(n,t,o,u,d,C,I,f,A){var y=o+2,G,S=this.arr(t+1),w=this,M;return this.lastNumberOfEvaluations=0,A&&console.log("Experimental feature 'testForRoundingErrors' is activated."),S[0]=0,this.arraycopy(u,0,S,1,t),M=function(V,T,H,J){var z=w.arr(V),L,K;return w.lastNumberOfEvaluations=w.lastNumberOfEvaluations+1,w.arraycopy(H,1,z,0,V),L=w.arr(T),K=n(V,T,z,L),w.arraycopy(L,0,J,1,T),K},G=this.cobylb(M,t,o,y,S,d,C,I,f,A),this.arraycopy(S,1,u,0,t),G},cobylb:function(n,t,o,u,d,C,I,f,A,y){var G=-1,S=.25,w=2.1,M=.5,V=1.1,T=0,H=0,J,z=t+1,L=o+1,K=C,O=0,Q=!1,ee=!1,ie=0,te=0,se=0,ae=this.arr(1+u),le=this.arr2(1+t,1+z),ge=this.arr2(1+t,1+t),be=this.arr2(1+u,1+z),Xe=this.arr2(1+t,1+L),Ce=this.arr(1+t),Re=this.arr(1+t),Se=this.arr(1+t),Ze=this.arr(1+t),he=this.arr(1+t),Ie,Be,ue,me,xe,Je,Ve,Ee,Ct,st,wt,Qe,Ue,Ge,Gt,ot,vt,at,Tt,xt,ve,de,De,nt,dt,ze,rt,Rt,Mt,Yt,Oe=!0;for(f>=2&&console.log("The initial value of RHO is "+K+" and PARMU is set to zero."),Ve=0,xe=1/K,Ie=1;Ie<=t;++Ie)le[Ie][z]=d[Ie],le[Ie][Ie]=K,ge[Ie][Ie]=xe;Ee=z,Ct=!1;e:do{if(Ve>=A&&Ve>0){G=this.MaxIterationsReached;break e}for(++Ve,T=n(t,o,d,ae),H=0,ue=1;ue<=o;++ue)H=Math.max(H,-ae[ue]);if((Ve===f-1||f===3)&&this.PrintIterationResult(Ve,T,H,d,t,f),ae[L]=T,ae[u]=H,st=!0,!Ct){for(st=!1,Ie=1;Ie<=u;++Ie)be[Ie][Ee]=ae[Ie];if(Ve<=z){if(Ee<=t)if(be[L][z]<=T)d[Ee]=le[Ee][z];else{for(le[Ee][z]=d[Ee],ue=1;ue<=u;++ue)be[ue][Ee]=be[ue][z],be[ue][z]=ae[ue];for(ue=1;ue<=Ee;++ue){for(le[Ee][ue]=-K,xe=0,Ie=ue;Ie<=Ee;++Ie)xe-=ge[Ie][ue];ge[Ee][ue]=xe}}if(Ve<=t){Ee=Ve,d[Ee]+=K;continue e}}Ct=!0}t:do{i:do{if(!st){for(wt=be[L][z]+O*be[u][z],Qe=z,Be=1;Be<=t;++Be)xe=be[L][Be]+O*be[u][Be],xe<wt?(Qe=Be,wt=xe):xe===wt&&O===0&&be[u][Be]<be[u][Qe]&&(Qe=Be);if(Qe<=t){for(Ie=1;Ie<=u;++Ie)xe=be[Ie][z],be[Ie][z]=be[Ie][Qe],be[Ie][Qe]=xe;for(Ie=1;Ie<=t;++Ie){for(xe=le[Ie][Qe],le[Ie][Qe]=0,le[Ie][z]+=xe,Je=0,ue=1;ue<=t;++ue)le[Ie][ue]-=xe,Je-=ge[ue][Ie];ge[Qe][Ie]=Je}}if(Ue=0,y)for(Ie=1;Ie<=t;++Ie)for(Be=1;Be<=t;++Be)xe=this.DOT_PRODUCT_ROW_COL(ge,Ie,le,Be,1,t)-(Ie===Be?1:0),Ue=Math.max(Ue,Math.abs(xe));if(Ue>.1){G=this.DivergingRoundingErrors;break e}for(ue=1;ue<=L;++ue){for(ae[ue]=-be[ue][z],Be=1;Be<=t;++Be)he[Be]=be[ue][Be]+ae[ue];for(Ie=1;Ie<=t;++Ie)Xe[Ie][ue]=(ue===L?-1:1)*this.DOT_PRODUCT_ROW_COL(he,-1,ge,Ie,1,t)}for(Q=!0,ie=S*K,Ge=w*K,Be=1;Be<=t;++Be){for(Gt=0,ot=0,ue=1;ue<=t;++ue)Gt+=ge[Be][ue]*ge[Be][ue],ot+=le[ue][Be]*le[ue][Be];Ce[Be]=1/Math.sqrt(Gt),Re[Be]=Math.sqrt(ot),(Ce[Be]<ie||Re[Be]>Ge)&&(Q=!1)}if(!Ct&&!Q){for(Ee=0,xe=Ge,Be=1;Be<=t;++Be)Re[Be]>xe&&(Ee=Be,xe=Re[Be]);if(Ee===0)for(Be=1;Be<=t;++Be)Ce[Be]<xe&&(Ee=Be,xe=Ce[Be]);for(xe=M*K*Ce[Ee],ue=1;ue<=t;++ue)Ze[ue]=xe*ge[Ee][ue];for(vt=0,at=0,J=0,ue=1;ue<=L;++ue)J=this.DOT_PRODUCT_ROW_COL(Ze,-1,Xe,ue,1,t),ue<L&&(xe=be[ue][z],vt=Math.max(vt,-J-xe),at=Math.max(at,J-xe));for(Tt=O*(vt-at)>2*J?-1:1,xe=0,Ie=1;Ie<=t;++Ie)Ze[Ie]=Tt*Ze[Ie],le[Ie][Ee]=Ze[Ie],xe+=ge[Ee][Ie]*Ze[Ie];for(ue=1;ue<=t;++ue)ge[Ee][ue]/=xe;for(Be=1;Be<=t;++Be){if(Be!==Ee)for(xe=this.DOT_PRODUCT_ROW_COL(ge,Be,Ze,-1,1,t),ue=1;ue<=t;++ue)ge[Be][ue]-=xe*ge[Ee][ue];d[Be]=le[Be][z]+Ze[Be]}continue e}if(ee=this.trstlp(t,o,Xe,ae,K,Ze),!ee){for(xe=0,ue=1;ue<=t;++ue)xe+=Ze[ue]*Ze[ue];if(xe<.25*K*K){Ct=!0;break i}}for(J=0,xt=0,ae[L]=0,ue=1;ue<=L;++ue)J=ae[ue]-this.DOT_PRODUCT_ROW_COL(Ze,-1,Xe,ue,1,t),ue<L&&(xt=Math.max(xt,J));if(te=be[u][z]-xt,ve=te>0?J/te:0,O<1.5*ve){for(O=2*ve,f>=2&&console.log("Increase in PARMU to "+O),de=be[L][z]+O*be[u][z],Be=1;Be<=t;++Be)if(xe=be[L][Be]+O*be[u][Be],xe<de||xe===de&&O===0&&be[u][Be]<be[u][z])continue t}for(se=O*te-J,ue=1;ue<=t;++ue)d[ue]=le[ue][z]+Ze[ue];Ct=!0;continue e}for(st=!1,De=be[L][z]+O*be[u][z],nt=T+O*H,dt=De-nt,O===0&&T===be[L][z]&&(se=te,dt=be[u][z]-H),ze=dt<=0?1:0,Ee=0,Be=1;Be<=t;++Be)xe=Math.abs(this.DOT_PRODUCT_ROW_COL(ge,Be,Ze,-1,1,t)),xe>ze&&(Ee=Be,ze=xe),Se[Be]=xe*Ce[Be];for(rt=V*K,me=0,Be=1;Be<=t;++Be)if(Se[Be]>=ie||Se[Be]>=Ce[Be]){if(xe=Re[Be],dt>0){for(xe=0,ue=1;ue<=t;++ue)xe+=Math.pow(Ze[ue]-le[ue][Be],2);xe=Math.sqrt(xe)}xe>rt&&(me=Be,rt=xe)}if(me>0&&(Ee=me),Ee!==0){for(xe=0,Ie=1;Ie<=t;++Ie)le[Ie][Ee]=Ze[Ie],xe+=ge[Ee][Ie]*Ze[Ie];for(ue=1;ue<=t;++ue)ge[Ee][ue]/=xe;for(Be=1;Be<=t;++Be)if(Be!==Ee)for(xe=this.DOT_PRODUCT_ROW_COL(ge,Be,Ze,-1,1,t),ue=1;ue<=t;++ue)ge[Be][ue]-=xe*ge[Ee][ue];for(ue=1;ue<=u;++ue)be[ue][Ee]=ae[ue];if(dt>0&&dt>=.1*se)continue t}}while(!1);if(!Q){Ct=!1;continue t}if(K<=I){G=this.Normal;break e}if(Rt=0,Mt=0,K*=.5,K<=1.5*I&&(K=I),O>0){for(Yt=0,ue=1;ue<=L;++ue){for(Rt=be[ue][z],Mt=Rt,Ie=1;Ie<=t;++Ie)Rt=Math.min(Rt,be[ue][Ie]),Mt=Math.max(Mt,be[ue][Ie]);ue<=o&&Rt<.5*Mt&&(xe=Math.max(Mt,0)-Rt,Yt=Yt<=0?xe:Math.min(Yt,xe))}Yt===0?O=0:Mt-Rt<O*Yt&&(O=(Mt-Rt)/Yt)}f>=2&&console.log("Reduction in RHO to "+K+"  and PARMU = "+O),f===2&&this.PrintIterationResult(Ve,be[L][z],be[u][z],this.COL(le,z),t,f)}while(Oe)}while(Oe);switch(G){case this.Normal:if(f>=1&&console.log("%nNormal return from subroutine COBYLA%n"),ee)return f>=1&&this.PrintIterationResult(Ve,T,H,d,t,f),G;break;case this.MaxIterationsReached:f>=1&&console.log("%nReturn from subroutine COBYLA because the MAXFUN limit has been reached.%n");break;case this.DivergingRoundingErrors:f>=1&&console.log("%nReturn from subroutine COBYLA because rounding errors are becoming damaging.%n");break}for(ue=1;ue<=t;++ue)d[ue]=le[ue][z];return T=be[L][z],H=be[u][z],f>=1&&this.PrintIterationResult(Ve,T,H,d,t,f),G},trstlp:function(n,t,o,u,d,C){var I=0,f=0,A=0,y=this.arr2(1+n,1+n),G=this.arr(2+t),S=this.arr(2+t),w=this.arr(1+n),M=this.arr(1+n),V=this.arr(2+t),T=this.arr(2+t),H=t,J=0,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe,Ce,Re,Se,Ze,he,Ie,Be,ue,me,xe,Je,Ve,Ee,Ct,st,wt,Qe,Ue,Ge,Gt,ot=!0;for(K=1;K<=n;++K)y[K][K]=1,C[K]=0;if(z=0,L=0,t>=1){for(O=1;O<=t;++O)u[O]>L&&(L=u[O],z=O);for(O=1;O<=t;++O)T[O]=O,S[O]=L-u[O]}Q=!0;do e:do{(!Q||Q&&L===0)&&(H=t+1,z=H,T[H]=H,S[H]=0),Q=!1,ee=0,ie=0,te=0,se=0;t:do{if(ae=H===t?L:-this.DOT_PRODUCT_ROW_COL(C,-1,o,H,1,n),ie===0||ae<ee?(ee=ae,f=J,ie=3):J>f?(f=J,ie=3):--ie,ie===0)break e;if(le=0,z<=J){if(z<J){ge=T[z],be=S[z],O=z;do{for(Ce=O+1,Re=T[Ce],Se=this.DOT_PRODUCT(this.PART(this.COL(y,O),1,n),this.PART(this.COL(o,Re),1,n)),I=Mat.hypot(Se,G[Ce]),Ze=G[Ce]/I,he=Se/I,G[Ce]=Ze*G[O],G[O]=I,K=1;K<=n;++K)I=Ze*y[K][Ce]+he*y[K][O],y[K][Ce]=Ze*y[K][O]-he*y[K][Ce],y[K][O]=I;T[O]=Re,S[O]=S[Ce],O=Ce}while(O<J);T[O]=ge,S[O]=be}if(--J,H>t)for(I=1/G[J],O=1;O<=n;++O)w[O]=I*y[O][J];else for(I=this.DOT_PRODUCT_ROW_COL(w,-1,y,J+1,1,n),O=1;O<=n;++O)w[O]-=I*y[O][J+1]}else{for(Re=T[z],O=1;O<=n;++O)M[O]=o[O][Re];for(Ie=0,O=n;O>J;){for(Se=0,Be=0,K=1;K<=n;++K)I=y[K][O]*M[K],Se+=I,Be+=Math.abs(I);if(ue=Be+.1*Math.abs(Se),me=Be+.2*Math.abs(Se),(Be>=ue||ue>=me)&&(Se=0),Ie===0)Ie=Se;else for(Ce=O+1,I=Mat.hypot(Se,Ie),Ze=Se/I,he=Ie/I,Ie=I,K=1;K<=n;++K)I=Ze*y[K][O]+he*y[K][Ce],y[K][Ce]=Ze*y[K][Ce]-he*y[K][O],y[K][O]=I;--O}if(Ie===0){le=-1,O=J;do{for(xe=0,Je=0,K=1;K<=n;++K)I=y[K][O]*M[K],xe+=I,Je+=Math.abs(I);if(ue=Je+.1*Math.abs(xe),me=Je+.2*Math.abs(xe),Je<ue&&ue<me){if(I=xe/G[O],I>0&&T[O]<=t&&(Gt=S[O]/I,(le<0||Gt<le)&&(le=Gt)),O>=2)for(Ve=T[O],K=1;K<=n;++K)M[K]-=I*o[K][Ve];V[O]=I}else V[O]=0}while(--O>0);if(le<0)break e;for(O=1;O<=J;++O)S[O]=Math.max(0,S[O]-le*V[O]);if(z<J){ge=T[z],be=S[z],O=z;do{for(Ce=O+1,Ve=T[Ce],Se=this.DOT_PRODUCT(this.PART(this.COL(y,O),1,n),this.PART(this.COL(o,Ve),1,n)),I=Mat.hypot(Se,G[Ce]),Ze=G[Ce]/I,he=Se/I,G[Ce]=Ze*G[O],G[O]=I,K=1;K<=n;++K)I=Ze*y[K][Ce]+he*y[K][O],y[K][Ce]=Ze*y[K][O]-he*y[K][Ce],y[K][O]=I;T[O]=Ve,S[O]=S[Ce],O=Ce}while(O<J);T[O]=ge,S[O]=be}if(I=this.DOT_PRODUCT(this.PART(this.COL(y,J),1,n),this.PART(this.COL(o,Re),1,n)),I===0)break e;G[J]=I,S[z]=0,S[J]=le}else++J,G[J]=Ie,S[z]=S[J],S[J]=0;if(T[z]=T[J],T[J]=Re,H>t&&Re!==H){for(O=J-1,Se=this.DOT_PRODUCT(this.PART(this.COL(y,O),1,n),this.PART(this.COL(o,Re),1,n)),I=Mat.hypot(Se,G[J]),Ze=G[J]/I,he=Se/I,G[J]=Ze*G[O],G[O]=I,K=1;K<=n;++K)I=Ze*y[K][J]+he*y[K][O],y[K][J]=Ze*y[K][O]-he*y[K][J],y[K][O]=I;T[J]=T[O],T[O]=Re,I=S[O],S[O]=S[J],S[J]=I}if(H>t)for(I=1/G[J],O=1;O<=n;++O)w[O]=I*y[O][J];else for(Re=T[J],I=(this.DOT_PRODUCT_ROW_COL(w,-1,o,Re,1,n)-1)/G[J],O=1;O<=n;++O)w[O]-=I*y[O][J]}for(Ee=d*d,st=0,Ct=0,K=1;K<=n;++K)Math.abs(C[K])>=1e-6*d&&(Ee-=C[K]*C[K]),st+=C[K]*w[K],Ct+=w[K]*w[K];if(Ee<=0)break e;if(I=Math.sqrt(Ct*Ee),Math.abs(st)>=1e-6*I&&(I=Math.sqrt(Ct*Ee+st*st)),se=Ee/(I+st),te=se,H===t){if(ue=te+.1*L,me=te+.2*L,te>=ue||ue>=me)break t;te=Math.min(te,L)}for(O=1;O<=n;++O)M[O]=C[O]+te*w[O];if(H===t)for(A=L,L=0,O=1;O<=J;++O)Re=T[O],I=u[Re]-this.DOT_PRODUCT_ROW_COL(M,-1,o,Re,1,n),L=Math.max(L,I);O=J;do{for(wt=0,Qe=0,K=1;K<=n;++K)I=y[K][O]*M[K],wt+=I,Qe+=Math.abs(I);if(ue=Qe+.1*Math.abs(wt),me=Qe+.2*Math.abs(wt),(Qe>=ue||ue>=me)&&(wt=0),V[O]=wt/G[O],O>=2)for(Re=T[O],K=1;K<=n;++K)M[K]-=V[O]*o[K][Re]}while(O-->=2);for(H>t&&(V[J]=Math.max(0,V[J])),O=1;O<=n;++O)M[O]=C[O]+te*w[O];if(H>J)for(Ue=J+1,O=Ue;O<=H;++O){for(Re=T[O],Xe=L-u[Re],Ge=L+Math.abs(u[Re]),K=1;K<=n;++K)I=o[K][Re]*M[K],Xe+=I,Ge+=Math.abs(I);ue=Ge+.1*Math.abs(Xe),me=Ge+.2*Math.abs(Xe),(Ge>=ue||ue>=me)&&(Xe=0),V[O]=Xe}for(le=1,z=0,O=1;O<=H;++O)V[O]<0&&(I=S[O]/(S[O]-V[O]),I<le&&(le=I,z=O));for(I=1-le,O=1;O<=n;++O)C[O]=I*C[O]+le*M[O];for(O=1;O<=H;++O)S[O]=Math.max(0,I*S[O]+le*V[O]);H===t&&(L=A+le*(L-A))}while(z>0);if(te===se)return!0}while(ot);while(H===t);return!1},PrintIterationResult:function(n,t,o,u,d,C){C>1&&console.log("NFVALS = "+n+"  F = "+t+"  MAXCV = "+o),C>1&&console.log("X = "+this.PART(u,1,d))},ROW:function(n,t){return n[t].slice()},COL:function(n,t){var o,u=n.length,d=[];for(o=0;o<u;++o)d[o]=n[o][t];return d},PART:function(n,t,o){return n.slice(t,o+1)},FORMAT:function(n){return n.join(",")},DOT_PRODUCT:function(n,t){var o,u=0,d=n.length;for(o=0;o<d;++o)u+=n[o]*t[o];return u},DOT_PRODUCT_ROW_COL:function(n,t,o,u,d,C){var I,f=0;if(t===-1)for(I=d;I<=C;++I)f+=n[I]*o[I][u];else if(u===-1)for(I=d;I<=C;++I)f+=n[t][I]*o[I];else for(I=d;I<=C;++I)f+=n[t][I]*o[I][u];return f}};JXG$1.Math.Nlp;Mat.Statistics={sum:function(n){var t,o=n.length,u=0;for(t=0;t<o;t++)u+=n[t];return u},prod:function(n){var t,o=n.length,u=1;for(t=0;t<o;t++)u*=n[t];return u},mean:function(n){return n.length>0?this.sum(n)/n.length:0},median:function(n){var t,o;return n.length>0?(ArrayBuffer.isView(n)?(t=new Float64Array(n),t.sort()):(t=n.slice(0),t.sort(function(u,d){return u-d})),o=t.length,o&1?t[parseInt(o*.5,10)]:(t[o*.5-1]+t[o*.5])*.5):0},percentile:function(n,t){var o,u,d,C,I=[],f;if(n.length>0){for(ArrayBuffer.isView(n)?(o=new Float64Array(n),o.sort()):(o=n.slice(0),o.sort(function(A,y){return A-y})),u=o.length,JXG$1.isArray(t)?C=t:C=[t],d=0;d<C.length;d++)f=u*C[d]*.01,parseInt(f,10)===f?I.push((o[f-1]+o[f])*.5):I.push(o[parseInt(f,10)]);return JXG$1.isArray(t)?I:I[0]}return 0},variance:function(n){var t,o,u,d=n.length;if(d>1){for(t=this.mean(n),o=0,u=0;u<d;u++)o+=(n[u]-t)*(n[u]-t);return o/(n.length-1)}return 0},sd:function(n){return Math.sqrt(this.variance(n))},weightedMean:function(n,t){if(n.length!==t.length)throw new Error("JSXGraph error (Math.Statistics.weightedMean): Array dimension mismatch.");return n.length>0?this.mean(this.multiply(n,t)):0},max:function(n){return Math.max.apply(this,n)},min:function(n){return Math.min.apply(this,n)},range:function(n){return[this.min(n),this.max(n)]},abs:function(n){var t,o,u;if(JXG$1.isArray(n))if(n.map)u=n.map(Math.abs);else for(o=n.length,u=[],t=0;t<o;t++)u[t]=Math.abs(n[t]);else ArrayBuffer.isView(n)?u=n.map(Math.abs):u=Math.abs(n);return u},add:function(n,t){var o,u,d=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,o=0;o<u;o++)d[o]=n[o]+t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,o=0;o<u;o++)d[o]=n+t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),o=0;o<u;o++)d[o]=n[o]+t[o];else d=n+t;return d},div:function(n,t){var o,u,d=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,o=0;o<u;o++)d[o]=n[o]/t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,o=0;o<u;o++)d[o]=n/t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),o=0;o<u;o++)d[o]=n[o]/t[o];else d=n/t;return d},divide:function(){JXG$1.deprecated("Statistics.divide()","Statistics.div()"),Mat.Statistics.div.apply(Mat.Statistics,arguments)},mod:function(n,t,o){var u,d,C=[],I=function(f,A){return f%A};if(o=JXG$1.def(o,!1),o&&(I=Mat.mod),n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(d=n.length,u=0;u<d;u++)C[u]=I(n[u],t);else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(d=t.length,u=0;u<d;u++)C[u]=I(n,t[u]);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(d=Math.min(n.length,t.length),u=0;u<d;u++)C[u]=I(n[u],t[u]);else C=I(n,t);return C},multiply:function(n,t){var o,u,d=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,o=0;o<u;o++)d[o]=n[o]*t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,o=0;o<u;o++)d[o]=n*t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),o=0;o<u;o++)d[o]=n[o]*t[o];else d=n*t;return d},subtract:function(n,t){var o,u,d=[];if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,o=0;o<u;o++)d[o]=n[o]-t;else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,o=0;o<u;o++)d[o]=n-t[o];else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),o=0;o<u;o++)d[o]=n[o]-t[o];else d=n-t;return d},TheilSenRegression:function(n){var t,o,u=[],d=[],C=[];for(t=0;t<n.length;t++){for(d.length=0,o=0;o<n.length;o++)Math.abs(n[o].usrCoords[1]-n[t].usrCoords[1])>Mat.eps&&(d[o]=(n[o].usrCoords[2]-n[t].usrCoords[2])/(n[o].usrCoords[1]-n[t].usrCoords[1]));u[t]=this.median(d),C.push(n[t].usrCoords[2]-u[t]*n[t].usrCoords[1])}return[this.median(C),this.median(u),-1]},generateGaussian:function(n,t){var o,u,d;if(this.hasSpare)return this.hasSpare=!1,this.spare*t+n;do o=Math.random()*2-1,u=Math.random()*2-1,d=o*o+u*u;while(d>=1||d===0);return d=Math.sqrt(-2*Math.log(d)/d),this.spare=u*d,this.hasSpare=!0,n+t*o*d},randomNormal:function(n,t){return this.generateGaussian(n,t)},randomUniform:function(n,t){return Math.random()*(t-n)+n},randomExponential:function(n){var t;if(n<=0)return NaN;do t=Math.random();while(t===0);return-Math.log(t)/n},randomGamma:function(n,t,o){var u,d,C,I,f,A;if(n<=0)return NaN;if(t=t||1,o=o||0,n===1)return t*this.randomExponential(1)+o;if(n<1){f=Math.E/(n+Math.E);do{u=Math.random();do d=Math.random();while(d===0);u<f?(C=Math.pow(d,1/n),A=Math.exp(-C)):(C=1-Math.log(d),A=Math.pow(C,n-1)),u=Math.random()}while(u>=A);return t*C+o}do if(I=Math.tan(Math.PI*Math.random()),C=Math.sqrt(2*n-1)*I+n-1,C>0)d=Math.random();else continue;while(C<=0||d>(1+I*I)*Math.exp((n-1)*Math.log(C/(n-1))-Math.sqrt(2*n-1)*I));return t*C+o},randomBeta:function(n,t){var o,u,d;return n<=0||t<=0?NaN:(o=this.randomGamma(n),u=this.randomGamma(t),d=o/(o+u),d)},randomChisquare:function(n){return n<=0?NaN:2*this.randomGamma(n*.5)},randomF:function(n,t){var o,u;return n<=0||t<=0?NaN:(o=this.randomChisquare(n),u=this.randomChisquare(t),o*t/(u*n))},randomT:function(n){var t,o;return n<=0?NaN:(t=this.randomNormal(0,1),o=this.randomChisquare(n),t/Math.sqrt(o/n))},randomBinomial:function(n,t){var o,u,d,C,I,f;if(t<0||t>1||n<0)return NaN;if(t===0)return 0;if(t===1)return n;if(n===0)return 0;if(n===1)return Math.random()<t?1:0;if(t>.5)return n-this.randomBinomial(n,1-t);if(n<100){if(o=-1,u=0,d=Math.log(1-t),d===0)return 0;do o+=1,u+=Math.floor(Math.log(Math.random())/d)+1;while(u<n)}else C=1+Math.floor(n*.5),I=n-C+1,o=this.randomBeta(C,I),o>=t?(f=this.randomBinomial(C-1,t/o),o=f):(f=this.randomBinomial(I-1,(t-o)/(1-o)),o=C+f);return o},randomGeometric:function(n){var t;return n<0||n>1?NaN:(t=Math.random(),Math.ceil(Math.log(t)/Math.log(1-n)))},randomPoisson:function(n){var t=Math.exp(-n),o,u=0,d=1,C,I=7/8;if(n<=0)return NaN;if(n<10){do d*=Math.random(),u+=1;while(d>t);o=u-1}else u=Math.floor(I*n),C=this.randomGamma(u),C<n?o=u+this.randomPoisson(n-C):o=this.randomBinomial(u-1,n/C);return o},randomPareto:function(n,t){var o=Math.random();return n<=0||t<=0?NaN:t*Math.pow(1-o,-1/n)},randomHypergeometric:function(n,t,o){var u,d,C=0,I=n+t-o,f=Math.min(n,t),A=f;if(n<1||t<1||o>n+t)return NaN;for(u=o;A*u>0;)d=Math.random(),A-=Math.floor(d+A/(I+u)),u-=1;return C=f-A,n<=t?C:o-C},histogram:function(n,t){var o,u,d,C,I,f,A,y,G,S=[],w=[],M=0;for(f=t.bins||10,y=t.range||!1,y===!1?(C=Math.min.apply(null,n),I=Math.max.apply(null,n)):(C=y[0],I=y[1]),f>0?A=(I-C)/(f-1):A=0,o=0;o<f;o++)S.push(0),w.push(C+o*A);for(u=n.length,o=0;o<u;o++)d=Math.floor((n[o]-C)/A),d>=0&&d<f?S[d]+=1:M+=1;if(t.density)for(G=JXG$1.Math.Statistics.sum(S)+M,o=0;o<f;o++)S[o]/=G*A;if(t.cumulative){if(t.density)for(o=0;o<f;o++)S[o]*=A;for(o=1;o<f;o++)S[o]+=S[o-1]}return[S,w]}};const Statistics=Mat.Statistics;Mat.Plot={checkReal:function(n){var t=!1,o,u,d=n.length;for(o=0;o<d;o++)if(u=n[o].usrCoords,!isNaN(u[1])&&!isNaN(u[2])&&Math.abs(u[0])>Mat.eps){t=!0;break}return t},updateParametricCurveNaive:function(n,t,o,u){var d,C,I=!1,f=(o-t)/u;for(d=0;d<u;d++)C=t+d*f,n.points[d].setCoordinates(Const.COORDS_BY_USER,[n.X(C,I),n.Y(C,I)],!1),n.points[d]._t=C,I=!0;return n},isSegmentOutside:function(n,t,o,u,d){return t<0&&u<0||t>d.canvasHeight&&u>d.canvasHeight||n<0&&o<0||n>d.canvasWidth&&o>d.canvasWidth},isDistOK:function(n,t,o,u){return Math.abs(n)<o&&Math.abs(t)<u&&!isNaN(n+t)},isSegmentDefined:function(n,t,o,u){return!(isNaN(n+t)&&isNaN(o+u))},updateParametricCurveOld:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T=!1,H=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),J=[],z=[],L=[],K=[],O=!1,Q=0,ee=function(ie,te,se){var ae,le=se[1]-ie[1],ge=se[2]-ie[2],be=te[0]-ie[1],Xe=te[1]-ie[2],Ce=be*be+Xe*Xe;return Ce>=Mat.eps&&(ae=(le*be+ge*Xe)/Ce,ae>0&&(ae<=1?(le-=ae*be,ge-=ae*Xe):(le-=be,ge-=Xe))),Mat.hypot(le,ge)};for(JXG$1.deprecated("Curve.updateParametricCurveOld()"),n.board.updateQuality===n.board.BOARD_QUALITY_LOW?(w=15,M=10,V=10):(w=21,M=.7,V=.7),K[0]=o-t,u=1;u<w;u++)K[u]=K[u-1]*.5;u=1,J[0]=1,z[0]=0,d=t,H.setCoordinates(Const.COORDS_BY_USER,[n.X(d,T),n.Y(d,T)],!1),T=!0,A=H.scrCoords[1],y=H.scrCoords[2],d=o,H.setCoordinates(Const.COORDS_BY_USER,[n.X(d,T),n.Y(d,T)],!1),I=H.scrCoords[1],f=H.scrCoords[2],L[0]=[I,f],G=1,S=0,n.points=[],n.points[Q++]=new Coords(Const.COORDS_BY_SCREEN,[A,y],n.board,!1);do{for(O=this.isDistOK(I-A,f-y,M,V)||this.isSegmentOutside(A,y,I,f,n.board);S<w&&(!O||S<6)&&(S<=7||this.isSegmentDefined(A,y,I,f));)J[G]=u,z[G]=S,L[G]=[I,f],G+=1,u=2*u-1,S++,d=t+u*K[S],H.setCoordinates(Const.COORDS_BY_USER,[n.X(d,T),n.Y(d,T)],!1,!0),I=H.scrCoords[1],f=H.scrCoords[2],O=this.isDistOK(I-A,f-y,M,V)||this.isSegmentOutside(A,y,I,f,n.board);Q>1&&(C=ee(n.points[Q-2].scrCoords,[I,f],n.points[Q-1].scrCoords),C<.015&&(Q-=1)),n.points[Q]=new Coords(Const.COORDS_BY_SCREEN,[I,f],n.board,!1),n.points[Q]._t=d,Q+=1,A=I,y=f,G-=1,I=L[G][0],f=L[G][1],S=z[G]+1,u=J[G]*2}while(G>0&&Q<5e5);return n.numberPoints=n.points.length,n},_insertPoint_v2:function(n,t,o){var u=!isNaN(this._lastCrds[1]+this._lastCrds[2]),d=!isNaN(t.scrCoords[1]+t.scrCoords[2]),C=n.board.canvasWidth,I=n.board.canvasHeight,f=500;d=d&&t.scrCoords[1]>-500&&t.scrCoords[2]>-500&&t.scrCoords[1]<C+f&&t.scrCoords[2]<I+f,(!d&&u||d&&(!u||Math.abs(t.scrCoords[1]-this._lastCrds[1])>.7||Math.abs(t.scrCoords[2]-this._lastCrds[2])>.7))&&(t._t=o,n.points.push(t),this._lastCrds=t.copy("scrCoords"))},neighborhood_isNaN_v2:function(n,t){var o,u=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),d,C;return d=t+Mat.eps,u.setCoordinates(Const.COORDS_BY_USER,[n.X(d,!0),n.Y(d,!0)],!1),C=u.usrCoords,o=isNaN(C[1]+C[2]),!(!o&&(d=t-Mat.eps,u.setCoordinates(Const.COORDS_BY_USER,[n.X(d,!0),n.Y(d,!0)],!1),C=u.usrCoords,o=isNaN(C[1]+C[2]),!o))},_borderCase:function(n,t,o,u,d,C,I,f){var A,y,G,S=null,w,M=30,V=!1,T,H;if(f<=1){if(y=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),isNaN(t[1]+t[2])&&!isNaN(u[1]+u[2])&&!this.neighborhood_isNaN_v2(n,d)||isNaN(o[1]+o[2])&&!isNaN(u[1]+u[2])&&!this.neighborhood_isNaN_v2(n,C)||isNaN(u[1]+u[2])&&(!isNaN(t[1]+t[2])||!isNaN(o[1]+o[2]))&&!this.neighborhood_isNaN_v2(n,I))return!1;w=0;do{if(isNaN(t[1]+t[2])&&!isNaN(u[1]+u[2]))T=d,H=I;else if(isNaN(o[1]+o[2])&&!isNaN(u[1]+u[2]))T=C,H=I;else if(isNaN(u[1]+u[2])&&!isNaN(o[1]+o[2]))T=I,H=C;else if(isNaN(u[1]+u[2])&&!isNaN(t[1]+t[2]))T=I,H=d;else return!1;A=.5*(T+H),y.setCoordinates(Const.COORDS_BY_USER,[n.X(A,!0),n.Y(A,!0)],!1),G=y.usrCoords,V=isNaN(G[1]+G[2]),V?T=A:H=A,++w}while(V&&w<M);if(w<M&&(S=G.slice(),u=G.slice(),H=A),S!==null)return this._insertPoint_v2(n,new Coords(Const.COORDS_BY_USER,S,n.board,!1)),!0}return!1},_plotRecursive_v2:function(n,t,o,u,d,C,I){var f,A,y,G=0,S,w,M,V=.5,T=.99,H=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1);if(!(n.numberPoints>65536))return C<this.nanLevel&&this._isUndefined(n,t,o,u,d)?this:C<this.nanLevel&&this._isOutside(t,o,u,d,n.board)?this:(f=(o+d)*.5,H.setCoordinates(Const.COORDS_BY_USER,[n.X(f,!0),n.Y(f,!0)],!1),A=H.scrCoords,this._borderCase(n,t,u,A,o,d,f,C)?this:(y=this._triangleDists(t,u,A),S=C<this.smoothLevel&&y[3]<I,w=C<=this.jumpLevel&&(isNaN(y[0])||isNaN(y[1])||isNaN(y[2]))||C<this.jumpLevel&&(y[2]>T*y[0]||y[1]>T*y[0]||y[0]===1/0||y[1]===1/0||y[2]===1/0),M=C<this.smoothLevel+2&&y[0]<V*(y[1]+y[2]),M&&(G=0,S=!1),--C,w?this._insertPoint_v2(n,new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],n.board,!1),f):C<=G||S?this._insertPoint_v2(n,H,f):(this._plotRecursive_v2(n,t,o,A,f,C,I),isNaN(H.scrCoords[1]+H.scrCoords[2])||this._insertPoint_v2(n,H,f),this._plotRecursive_v2(n,A,f,u,d,C,I)),this))},updateParametricCurve_v2:function(n,t,o){var u,d,C,I,f=!1,A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),y=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G,S,w,M,V;return n.board.updateQuality===n.board.BOARD_QUALITY_LOW?(G=JXG$1.evaluate(n.visProp.recursiondepthlow)||13,S=2,this.smoothLevel=G-6,this.jumpLevel=3):(G=JXG$1.evaluate(n.visProp.recursiondepthhigh)||17,S=2,this.smoothLevel=G-9,this.jumpLevel=2),this.nanLevel=G-4,n.points=[],this.xterm==="x"?(M=n.board.getBoundingBox(),w=(M[2]-M[0])*.3,u=Math.max(t,M[0]-w),d=Math.min(o,M[2]+w)):(u=t,d=o),A.setCoordinates(Const.COORDS_BY_USER,[n.X(u,f),n.Y(u,f)],!1),f=!0,y.setCoordinates(Const.COORDS_BY_USER,[n.X(d,f),n.Y(d,f)],!1),V=this._findStartPoint(n,A.scrCoords,u,y.scrCoords,d),A.setCoordinates(Const.COORDS_BY_SCREEN,V[0],!1),u=V[1],V=this._findStartPoint(n,y.scrCoords,d,A.scrCoords,u),y.setCoordinates(Const.COORDS_BY_SCREEN,V[0],!1),d=V[1],this._visibleArea=[u,d],C=A.copy("scrCoords"),I=y.copy("scrCoords"),A._t=u,n.points.push(A),this._lastCrds=A.copy("scrCoords"),this._plotRecursive_v2(n,C,u,I,d,G,S),y._t=d,n.points.push(y),n.numberPoints=n.points.length,n},_insertLimesPoint:function(n,t,o,u,d){var C,I,f;Math.abs(this._lastUsrCrds[1])===1/0&&Math.abs(d.left_x)===1/0||Math.abs(this._lastUsrCrds[2])===1/0&&Math.abs(d.left_y)===1/0||(C=new Coords(Const.COORDS_BY_USER,[d.left_x,d.left_y],n.board),C._t=o,n.points.push(C),!isNaN(d.left_x)&&!isNaN(d.left_y)&&!isNaN(d.right_x)&&!isNaN(d.right_y)&&(Math.abs(d.left_x-d.right_x)>Mat.eps||Math.abs(d.left_y-d.right_y)>Mat.eps)&&(I=new Coords(Const.COORDS_BY_SCREEN,t,n.board),I._t=o,n.points.push(I)),f=new Coords(Const.COORDS_BY_USER,[d.right_x,d.right_y],n.board),f._t=o,n.points.push(f),this._lastScrCrds=f.copy("scrCoords"),this._lastUsrCrds=f.copy("usrCoords"))},_insertPoint:function(n,t,o,u,d){var C=!isNaN(this._lastScrCrds[1]+this._lastScrCrds[2]),I=!isNaN(t[1]+t[2]),f=n.board.canvasWidth,A=n.board.canvasHeight,y,G=.8,S=500;if(JXG$1.exists(d)){this._insertLimesPoint(n,t,o,u,d);return}I=I&&t[1]>-500&&t[2]>-500&&t[1]<f+S&&t[2]<A+S,!(!C&&!I)&&(I&&C&&Math.abs(t[1]-this._lastScrCrds[1])<G&&Math.abs(t[2]-this._lastScrCrds[2])<G||Math.abs(t[1])===1/0&&Math.abs(this._lastUsrCrds[1])===1/0||Math.abs(t[2])===1/0&&Math.abs(this._lastUsrCrds[2])===1/0||(y=new Coords(Const.COORDS_BY_SCREEN,t,n.board),y._t=o,n.points.push(y),this._lastScrCrds=y.copy("scrCoords"),this._lastUsrCrds=y.copy("usrCoords")))},_triangleDists:function(n,t,o){var u,d,C,I,f;return u=[n[0]*t[0],(n[1]+t[1])*.5,(n[2]+t[2])*.5],d=Geometry.distance(n,t,3),C=Geometry.distance(n,o,3),I=Geometry.distance(o,t,3),f=Geometry.distance(o,u,3),[d,C,I,f]},_isUndefined:function(n,t,o,u,d){var C,I,f;if(!isNaN(t[1]+t[2])||!isNaN(u[1]+u[2]))return!1;for(f=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),I=0;I<20;++I)if(C=o+Math.random()*(d-o),f.setCoordinates(Const.COORDS_BY_USER,[n.X(C,!0),n.Y(C,!0)],!1),!isNaN(f.scrCoords[0]+f.scrCoords[1]+f.scrCoords[2]))return!1;return!0},_isOutside:function(n,t,o,u,d){var C=500,I=d.canvasWidth,f=d.canvasHeight;return n[1]<-500&&o[1]<-500||n[2]<-500&&o[2]<-500||n[1]>I+C&&o[1]>I+C||n[2]>f+C&&o[2]>f+C},_isOutsidePoint:function(n,t){var o=500,u=t.canvasWidth,d=t.canvasHeight;return n[1]<-500||n[2]<-500||n[1]>u+o||n[2]>d+o},_findStartPoint:function(n,t,o,u,d){return[t,o]},_getBorderPos:function(n,t,o,u,d,C,I){var f,A,y,G,S=30,w=!1,M,V;if(A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G=0,isNaN(o[1]+o[2])&&!isNaN(d[1]+d[2]))V=t,M=u;else if(isNaN(I[1]+I[2])&&!isNaN(d[1]+d[2]))V=C,M=u;else if(isNaN(d[1]+d[2])&&!isNaN(I[1]+I[2]))V=u,M=C;else if(isNaN(d[1]+d[2])&&!isNaN(o[1]+o[2]))V=u,M=t;else return!1;do f=.5*(M+V),A.setCoordinates(Const.COORDS_BY_USER,[n.X(f,!0),n.Y(f,!0)],!1),y=A.usrCoords,w=isNaN(y[1]+y[2]),w?V=f:M=f,++G;while(G<S&&Math.abs(M-V)>Mat.eps);return f},_getCuspPos:function(n,t,o){var u=[n.X(t,!0),n.Y(t,!0)],d=[n.X(o,!0),n.Y(o,!0)],C=function(I){var f=[n.X(I,!0),n.Y(I,!0)];return-(Mat.hypot(u[0]-f[0],u[1]-f[1])+Mat.hypot(d[0]-f[0],d[1]-f[1]))};return Numerics.fminbr(C,[t,o],n)},_getJumpPos:function(n,t,o){var u=function(d){var C=Mat.eps*Mat.eps,I=[n.X(d,!0),n.Y(d,!0)],f=[n.X(d+C,!0),n.Y(d+C,!0)];return-Math.abs((f[1]-I[1])/(f[0]-I[0]))};return Numerics.fminbr(u,[t,o],n)},_getLimits:function(n,t){var o,u=2/(n.maxX()-n.minX()),d,C,I,f;return o=Extrapolate.limit(t,-u,n.X),d=o[0],o[1]==="infinite"&&(d=Math.sign(d)*(1/0)),o=Extrapolate.limit(t,-u,n.Y),I=o[0],o[1]==="infinite"&&(I=Math.sign(I)*(1/0)),o=Extrapolate.limit(t,u,n.X),C=o[0],o[1]==="infinite"&&(C=Math.sign(C)*(1/0)),o=Extrapolate.limit(t,u,n.Y),f=o[0],o[1]==="infinite"&&(f=Math.sign(f)*(1/0)),{left_x:d,left_y:I,right_x:C,right_y:f,t}},_getLimes:function(n,t,o,u,d,C,I,f,A){var y;return f==="border"?y=this._getBorderPos(n,t,o,u,d,C,I):f==="cusp"?y=this._getCuspPos(n,t,C):f==="jump"&&(y=this._getJumpPos(n,t,C)),this._getLimits(n,y)},_plotNonRecursive:function(n,t,o,u,d,C){var I,f,A,y=0,G=null,S,w,M=!1,V="",T,H,J,z,L,K=[],O=0,Q;for(J=n.board.origin.scrCoords,K[O++]=[t,o,u,d,C,1/0];O>0;){if(Q=K[--O],t=Q[0],o=Q[1],u=Q[2],d=Q[3],z=Q[4],L=Q[5],M=!1,V="",G=null,n.points.length>65536)return;z<this.nanLevel&&(this._isUndefined(n,t,o,u,d)||this._isOutside(t,o,u,d,n.board))||(I=(o+d)*.5,T=n.X(I,!0),H=n.Y(I,!0),f=[1,J[1]+T*n.board.unitX,J[2]-H*n.board.unitY],A=this._triangleDists(t,u,f),S=isNaN(t[1]+t[2]),w=isNaN(u[1]+u[2]),S&&!w||!S&&w?V="border":A[0]>.66*L||A[0]<this.cusp_threshold*(A[1]+A[2])||A[1]>5*A[2]||A[2]>5*A[1]?V="cusp":(A[2]>this.jump_threshold*A[0]||A[1]>this.jump_threshold*A[0]||A[0]===1/0||A[1]===1/0||A[2]===1/0)&&(V="jump"),M=V===""&&z<this.smoothLevel&&A[3]<this.smooth_threshold,z<this.testLevel&&!M&&(V===""?M=!0:G=this._getLimes(n,o,t,I,f,d,u,V,z)),G!==null?(f=[1,NaN,NaN],this._insertPoint(n,f,I,z,G)):z<=y||M?this._insertPoint(n,f,I,z,null):(K[O++]=[f,I,u,d,z-1,A[0]],K[O++]=[t,o,f,I,z-1,A[0]]))}return this},updateParametricCurve_v3:function(n,t,o){var u,d,C,I,f=!1,A=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),y=new Coords(Const.COORDS_BY_USER,[0,0],n.board,!1),G,S,w,M;return n.board.updateQuality===n.board.BOARD_QUALITY_LOW?G=JXG$1.evaluate(n.visProp.recursiondepthlow)||14:G=JXG$1.evaluate(n.visProp.recursiondepthhigh)||17,this.smoothLevel=7,this.nanLevel=G-4,this.testLevel=4,this.cusp_threshold=.5,this.jump_threshold=.99,this.smooth_threshold=2,n.points=[],n.xterm==="x"?(w=n.board.getBoundingBox(),S=(w[2]-w[0])*.3,u=Math.max(t,w[0]-S),d=Math.min(o,w[2]+S)):(u=t,d=o),A.setCoordinates(Const.COORDS_BY_USER,[n.X(u,f),n.Y(u,f)],!1),f=!0,y.setCoordinates(Const.COORDS_BY_USER,[n.X(d,f),n.Y(d,f)],!1),M=this._findStartPoint(n,A.scrCoords,u,y.scrCoords,d),A.setCoordinates(Const.COORDS_BY_SCREEN,M[0],!1),u=M[1],M=this._findStartPoint(n,y.scrCoords,d,A.scrCoords,u),y.setCoordinates(Const.COORDS_BY_SCREEN,M[0],!1),d=M[1],this._visibleArea=[u,d],C=A.copy("scrCoords"),I=y.copy("scrCoords"),A._t=u,n.points.push(A),this._lastScrCrds=A.copy("scrCoords"),this._lastUsrCrds=A.copy("usrCoords"),this._plotNonRecursive(n,C,u,I,d,G),y._t=d,n.points.push(y),n.numberPoints=n.points.length,n},_criticalInterval:function(n,t,o){var u,d,C,I,f,A,y=!1,G,S=-1/0,w=!1,M=!1,V=0,T=[],H=[],J=[];for(G=Statistics.abs(n),I=Statistics.median(G),I<1e-7?(I=1e-7,w=!0):I*=this.criticalThreshold,u=0;u<t;u++)G[u]>I?(J.push({i:u,v:n[u],group:V}),S=u,y||(y=!0)):y&&u>S+4&&(J.length>0&&T.push(J.slice(0)),J=[],y=!1,V++);for(y&&J.length>1&&T.push(J.slice(0)),w&&T.length===0&&(M=!0),d=0;d<T.length;d++)if(H[d]="point",C=T[d].length,!(C<64)){for(A=0,f=Math.sign(T[d][0].v),u=1;u<C;u++)Math.sign(T[d][u].v)!==f&&(A++,f=Math.sign(T[d][u].v));A*6>C&&(H[d]="interval")}return{smooth:M,groups:T,types:H}},Component:function(){this.left_isNaN=!1,this.right_isNaN=!1,this.left_t=null,this.right_t=null,this.t_values=[],this.x_values=[],this.y_values=[],this.len=0},findComponents:function(n,t,o,u){var d,C,I,f,A,y=[],G,S=0,w=0,M=0,V=!1,T=!1;for(I=(o-t)/u,y[S]=new this.Component,G=y[S],d=0,C=t;d<=u;d++,C+=I)f=n.X(C,T),A=n.Y(C,T),isNaN(f)||isNaN(A)?(M++,M>1&&V&&(G.right_isNaN=!0,G.right_t=C-I,G.len=w,V=!1,S++,y[S]=new this.Component,G=y[S],M=0)):(V||(V=!0,w=0,M>0&&(G.left_t=C-I,G.left_isNaN=!0)),M=0,G.t_values[w]=C,G.x_values[w]=f,G.y_values[w]=A,w++),d===0&&(T=!0);return V?G.len=w:y.pop(),y},getPointType:function(n,t,o,u,d,C,I){var f=d[0],A=C[0],y=u.length,G={idx:t,t:o,x:f[t],y:A[t],type:"other"};return t<5?(G.type="borderleft",G.idx=0,G.t=u[0],G.x=f[0],G.y=A[0],G):(t>I-6&&(G.type="borderright",G.idx=y-1,G.t=u[y-1],G.x=f[y-1],G.y=A[y-1]),G)},newtonApprox:function(n,t,o,u,d){var C,I=0;for(C=u;C>0;C--)I=(I+d[C][n])*(t-(C-1)*o)/C;return I+d[0][n]},thiele:function(n,t,o,u,d){var C,I=0;for(C=d;C>1;C--)I=(n-o[u+C])/(t[C][u+1]-t[C-2][u+1]+I);return t[0][u+1]+(n-o[u+1])/(t[1][u+1]+I)},differenceMethodExperiments:function(n,t){var o,u,d,C,I=n.t_values,f=n.x_values,A=n.y_values,y=[],G=[],S=[],w=[],M=[],V=[],T=[],H=[],J,z,L=0,K,O,Q,ee,ie,te=[];for(J=I[1]-I[0],M.push([]),V.push([]),T.push([]),H.push([]),d=A.length,o=0;o<d;o++)M[0][o]=f[o],V[0][o]=A[o],T[0][o]=f[o],H[0][o]=A[o];for(M.push([]),V.push([]),T.push([]),H.push([]),z=J,d=A.length-1,o=0;o<d;o++)y[o]=f[o+1]-f[o],G[o]=A[o+1]-A[o],S[o]=y[o],w[o]=G[o],M[1][o]=y[o],V[1][o]=G[o],T[1][o]=z/y[o],H[1][o]=z/G[o];for(d--,C=Math.min(8,A.length-1),u=1;u<C;u++){for(M.push([]),V.push([]),T.push([]),H.push([]),z*=J,o=0;o<d;o++)y[o]=y[o+1]-y[o],G[o]=G[o+1]-G[o],M[u+1][o]=y[o],V[u+1][o]=G[o],T[u+1][o]=z/(T[u][o+1]-T[u][o])+T[u-1][o+1],H[u+1][o]=z/(H[u][o+1]-H[u][o])+H[u-1][o+1];if(ie=this._criticalPoints(G,d,u),ie===!1){console.log("Polynomial of degree",u),ie=[];break}if(ie.length>0&&(L++,L>1&&u%2===0))break;d--}for(o=0;o<ie.length;o++){for(O=-1/0,Q=0;Q<ie[o].length;Q++)ee=Math.abs(ie[o][Q].v),ee>O&&(O=ee,K=Q);K=Math.floor(ie[o][K].i+u/2),te.push(this.getPointType(t,K,I,f,A,S,w,d+1))}return[te,M,V,T,H]},getCenterOfCriticalInterval:function(n,t,o){var u,d,C,I,f=0,A=0,y=o[1]-o[0],G,S=[];for(u=-1/0,S=[],d=0;d<n.length;d++)I=Math.abs(n[d].v),I>u?(S=[d],u=I,C=d):u===I&&S.push(d);if(S.length>0&&(G=S.reduce(function(w,M){return w+M},0)/S.length,C=Math.floor(G),G+=n[0].i),u<1/0){for(d=0;d<n.length;d++)f+=Math.abs(n[d].v)*n[d].i,A+=Math.abs(n[d].v);G=f/A}return G+=t/2,[n[C].i+t/2,G,o[Math.floor(G)]+y*(G-Math.floor(G))]},differenceMethod:function(n,t){var o,u,d,C,I=n.t_values,f=n.x_values,A=n.y_values,y=[],G=[],S=0,w=-1,M=-1,V,T,H,J,z,L=[],K,O=[];for(d=A.length,y.push(new Float64Array(f)),G.push(new Float64Array(A)),d--,C=Math.min(12,d),u=0;u<C&&(y.push(new Float64Array(d)),G.push(new Float64Array(d)),y[u+1]=y[u].map(function(Q,ee,ie){return ie[ee+1]-Q}),G[u+1]=G[u].map(function(Q,ee,ie){return ie[ee+1]-Q}),J=this._criticalInterval(G[u+1],d,u),J.smooth===!0&&(M=u,L=[]),H=this._criticalInterval(y[u+1],d,u),w===-1&&H.smooth===!0&&(w=u),!(M>=0));u++){if(J.groups.length>0&&(S++,S>2&&(u+1)%2===0)){L=J.groups,K=J.types;break}d--}for(o=0;o<L.length;o++)K[o]!=="interval"&&(T=this.getCenterOfCriticalInterval(L[o],u+1,I),V=J[0],V=Math.floor(T[1]),z=T[2],O.push(this.getPointType(t,V,z,I,y,G,d+1)));return[O,y,G,w,M]},_insertPoint_v4:function(n,t,o,u){var d,C=null,I,f,A=.8;n.points.length>0&&(C=n.points[n.points.length-1].scrCoords),d=new Coords(Const.COORDS_BY_USER,t,n.board),!(C!==null&&(I=d.scrCoords[1]-C[1],f=d.scrCoords[2]-C[2],I*I+f*f<A*A))&&(d._t=o,n.points.push(d))},getInterval:function(n,t,o){var u,d;return Interval.disable(),u=Interval.Interval(t,o),n.board.mathLib=Interval,n.board.mathLibJXG=Interval,d=n.Y(u,!0),n.board.mathLib=Math,n.board.mathLibJXG=JXG$1.Math,d},sign:function(n){return n<0?-1:n>0?1:0},handleBorder:function(n,t,o,u,d){var C=o.idx,I,f,A,y=32,G,S,w,M,V,T,H,J,z;if(z=t.t_values[1]-t.t_values[0],o.type==="borderleft"?(I=t.left_isNaN?t.left_t:o.t-z,f=I,A=f+z):o.type==="borderright"?(I=t.right_isNaN?t.right_t:o.t+z,A=I,f=A-z):console.log("No bordercase!!!"),H=this.findComponents(n,f,A,y),H.length!==0){for(o.type==="borderleft"&&(f=H[0].left_t,A=H[0].t_values[0],z=H[0].t_values[1]-H[0].t_values[0],f=f===null?A-z:f,I=f,G=this.getInterval(n,f,A),JXG$1.isObject(G)&&(M=G.lo,V=G.hi,S=n.X(I,!0),w=d[1][C]<0?V:M,this._insertPoint_v4(n,[1,S,w],I))),J=H[0].t_values.length,T=0;T<J;T++)I=H[0].t_values[T],S=H[0].x_values[T],w=H[0].y_values[T],this._insertPoint_v4(n,[1,S,w],I);o.type==="borderright"&&(f=H[0].t_values[J-1],A=H[0].right_t,z=H[0].t_values[1]-H[0].t_values[0],A=A===null?f+z:A,I=A,G=this.getInterval(n,f,A),JXG$1.isObject(G)&&(M=G.lo,V=G.hi,S=n.X(I,!0),w=d[1][C]>0?V:M,this._insertPoint_v4(n,[1,S,w],I)))}},_seconditeration_v4:function(n,t,o,u,d){var C,I,f,A,y,G,S,w,M,V,T,H,J;for(I=t.t_values[o.idx-2],f=t.t_values[o.idx+2],y=this.findComponents(n,I,f,64),S=0;S<y.length;S++){for(G=y[S],A=this.differenceMethod(G,n),w=A[0],V=A[1],T=A[2],H=0,M=0;M<=w.length;M++){for(M===w.length?J=G.len:J=w[M].idx,C=H;C<J;C++)!isNaN(G.x_values[C])&&!isNaN(G.y_values[C])&&this._insertPoint_v4(n,[1,G.x_values[C],G.y_values[C]],G.t_values[C]);M<w.length&&(this.handleSingularity(n,G,w[M],V,T),H=w[M].idx+1)}J=G.len,S<y.length-1&&this._insertPoint_v4(n,[1,NaN,NaN],G.right_t)}return this},_recurse_v4:function(n,t,o,u,d,C,I,f){var A=2,y=(t+o)*.5,G=n.X(y,!0),S=n.Y(y,!0),w,M;if(f===0){this._insertPoint_v4(n,[1,NaN,NaN],y);return}w=(G-u)*n.board.unitX,M=(S-d)*n.board.unitY,Mat.hypot(w,M)>A?this._recurse_v4(n,t,y,u,d,G,S,f-1):this._insertPoint_v4(n,[1,G,S],y),w=(G-C)*n.board.unitX,M=(S-I)*n.board.unitY,Mat.hypot(w,M)>A?this._recurse_v4(n,y,o,G,S,C,I,f-1):this._insertPoint_v4(n,[1,G,S],y)},handleSingularity:function(n,t,o,u,d){var C=o.idx,I,f,A,y,G,S,w,M,V,T,H,J=100,z=5,L=3;I=o.t,console.log("HandleSingularity at t =",I),f=t.t_values[C-z],A=t.t_values[C+z],y=this.getInterval(n,f,A),JXG$1.isObject(y)?(M=y.lo,V=y.hi):d[0][C-1]<d[0][C+1]?(M=d[0][C-1],V=d[0][C+1]):(M=d[0][C+1],V=d[0][C-1]),w=n.X(I,!0),T=(d[0][C-L]-d[0][C-z])/(t.t_values[C-L]-t.t_values[C-z]),H=(d[0][C+L]-d[0][C+z])/(t.t_values[C+L]-t.t_values[C+z]),console.log(":::",T,H),T<-100?(this._insertPoint_v4(n,[1,w,M],I,!0),H<=J&&this._insertPoint_v4(n,[1,NaN,NaN],I)):T>J?(this._insertPoint_v4(n,[1,w,V],I),H>=-100&&this._insertPoint_v4(n,[1,NaN,NaN],I)):(M===-1/0&&(this._insertPoint_v4(n,[1,w,M],I,!0),this._insertPoint_v4(n,[1,NaN,NaN],I)),V===1/0&&(this._insertPoint_v4(n,[1,NaN,NaN],I),this._insertPoint_v4(n,[1,w,V],I,!0)),o.t<t.t_values[C]?(G=C-1,S=C):(G=C,S=C+1),f=t.t_values[G],A=t.t_values[S],this._recurse_v4(n,f,A,u[0][G],d[0][G],u[0][S],d[0][S],10)),H<-100?this._insertPoint_v4(n,[1,w,V],I):H>J&&this._insertPoint_v4(n,[1,w,M],I)},steps:1021,criticalThreshold:1e3,plot_v4:function(n,t,o,u){var d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L=(o-t)/u,K=function(ee){return n.Y(ee,!0)},O=function(ee){return-n.Y(ee,!0)},Q=L*.5;for(I=this.findComponents(n,t,o,u),f=0;f<I.length;f++){for(A=I[f],w=this.differenceMethod(A,n),y=w[0],M=w[1],V=w[2],(y.length===0||y[0].type!=="borderleft")&&y.unshift({idx:0,t:A.t_values[0],x:A.x_values[0],y:A.y_values[0],type:"borderleft"}),y[y.length-1].type!=="borderright"&&(C=A.t_values.length,y.push({idx:C-1,t:A.t_values[C-1],x:A.x_values[C-1],y:A.y_values[C-1],type:"borderright"})),S=0,G=0;G<=y.length;G++){for(G===y.length?C=A.len:C=y[G].idx-1,d=S;d<C-2;d++)this._insertPoint_v4(n,[1,A.x_values[d],A.y_values[d]],A.t_values[d]),d>=S+3&&d<C-3&&V.length>3&&Math.abs(V[2][d])>.2*Math.abs(V[0][d])&&(T=A.t_values[d],Q=L*.25,z=this.getInterval(n,T,T+L),JXG$1.isObject(z)?V[2][d]>0?this._insertPoint_v4(n,[1,T+Q,z.lo],T+Q):this._insertPoint_v4(n,[1,T+L-Q,z.hi],T+L-Q):(H=Numerics.fminbr(K,[T,T+L]),J=Numerics.fminbr(O,[T,T+L]),H<J?(this._insertPoint_v4(n,[1,n.X(H,!0),n.Y(H,!0)],H),this._insertPoint_v4(n,[1,n.X(J,!0),n.Y(J,!0)],J)):(this._insertPoint_v4(n,[1,n.X(J,!0),n.Y(J,!0)],J),this._insertPoint_v4(n,[1,n.X(H,!0),n.Y(H,!0)],H))));G<y.length&&(d=y[G].idx,y[G].type==="borderleft"||y[G].type==="borderright"?this.handleBorder(n,A,y[G],M,V):this._seconditeration_v4(n,A,y[G],M,V),S=y[G].idx+1+1)}C=A.len,f<I.length-1&&this._insertPoint_v4(n,[1,NaN,NaN],A.right_t)}},updateParametricCurve_v4:function(n,t,o){var u,d,C,I;n.xterm==="x"?(I=n.board.getBoundingBox(),C=(I[2]-I[0])*.3,u=Math.max(t,I[0]-C),d=Math.min(o,I[2]+C)):(u=t,d=o),n.points=[],this.plot_v4(n,u,d,this.steps),n.numberPoints=n.points.length},updateParametricCurve:function(n,t,o){return this.updateParametricCurve_v2(n,t,o)}};const Plot=Mat.Plot;Mat.ImplicitPlot=function(n,t,o,u,d){var C={resolution_out:5,resolution_in:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0,unitX:10,unitY:10};this.config=JXG$1.merge(C,t),this.f=o,this.dfx=null,this.dfy=null,JXG$1.isFunction(u)?this.dfx=u:this.dfx=function(I,f){var A=Mat.eps*Mat.eps;return(this.f(I+A,f)-this.f(I-A,f))*.5/A},JXG$1.isFunction(d)?this.dfy=d:this.dfy=function(I,f){var A=Mat.eps*Mat.eps;return(this.f(I,f+A)-this.f(I,f-A))*.5/A},this.bbox=n,this.qdt=new Quadtree(20,5,n),this.components=[]};JXG$1.extend(Mat.ImplicitPlot.prototype,{plot:function(){var n,t,o,u,d,C,I=[],f=[],A=[],y=0,G,S=this,w=function(H){return S.f(n,H)},M=function(H){return-S.f(n,H)},V=function(H){return S.f(H,t)},T=function(H){return-S.f(H,t)};for(o=Math.min(this.bbox[0],this.bbox[2])-Mat.eps,u=Math.max(this.bbox[0],this.bbox[2]),d=Math.min(this.bbox[1],this.bbox[3])+Mat.eps,C=Math.max(this.bbox[1],this.bbox[3]),G=this.config.resolution_out/this.config.unitX,G*=1+Mat.eps,n=o;n<u;n+=G)A=this.searchLine(w,M,n,[d,C],"vertical",y,I,f),A!==!1&&(I=A[0],f=A[1],y=A[2]);for(G=this.config.resolution_out/this.config.unitY,G*=1+Mat.eps,t=d;t<C;t+=G)A=this.searchLine(V,T,t,[o,u],"horizontal",y,I,f),A!==!1&&(I=A[0],f=A[1],y=A[2]);return[I,f,y]},searchLine:function(n,t,o,u,d,C,I,f){var A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee=this.config.tol_u0,ie=u[0],te=u[1];if(A=Numerics.fminbr(n,[ie,te]),w=n(A),y=Numerics.fminbr(t,[ie,te]),M=n(y),w<ee&&M>-ee){if(V=A,A=Math.min(V,y),y=Math.max(V,y),G=Numerics.fzero(n,[A,y]),S=n(G),Math.abs(S)>Math.max((M-w)*Mat.eps,.001))return!1;if(d==="vertical"?(J=[1,o,G],Q=this.config.resolution_in/this.config.unitY):(J=[1,G,o],Q=this.config.resolution_in/this.config.unitX),Q*=1+Mat.eps,H=this.curveContainsPoint(J,I,f,Q*2,this.config.qdt_box),!H){if(K=this.traceComponent(J,1),K.length>0){for(C>0&&(I.push(NaN),f.push(NaN)),O=I.length,L=K[0].length,z=1;z<L;z++)this.qdt.insertItem({xlb:Math.min(K[0][z-1],K[0][z]),xub:Math.max(K[0][z-1],K[0][z]),ylb:Math.min(K[1][z-1],K[1][z]),yub:Math.max(K[1][z-1],K[1][z]),idx1:O+z-1,idx2:O+z,comp:C});C++,JXG$1.concat(I,K[0]),JXG$1.concat(f,K[1])}}return T=G-Q*.01,T-ie>Q&&(K=this.searchLine(n,t,o,[ie,T],d,C,I,f),K!==!1&&(I=K[0],f=K[1],C=K[2])),T=G+Q*.01,te-T>Q&&(K=this.searchLine(n,t,o,[T,te],d,C,I,f),K!==!1&&(I=K[0],f=K[1],C=K[2])),[I,f,C]}return!1},curveContainsPoint:function(n,t,o,u,d){var C,I,f,A,y=n[1],G=n[2];for(f=this.qdt.find([y-d,G+d,y+d,G-d]),I=f.length,C=0;C<I;C++)if(A=Geometry.distPointSegment(n,[1,t[f[C].idx1],o[f[C].idx1]],[1,t[f[C].idx2],o[f[C].idx2]]),A<u)return!0;return!1},traceComponent:function(n){var t=[],o=[],u=[];return u=this.tracing(n,1),u.length===0||(t=u[0],o=u[1]),u[2]||(u=this.tracing(n,-1),u.length===0||(t=u[0].reverse().concat(t.slice(1)),o=u[1].reverse().concat(o.slice(1)))),t.length<6&&(t.push(t[t.length-1]),o.push(o[o.length-1])),[t,o]},tracing:function(n,t){var o=[],u=[],d=[],C,I,f,A,y,G,S=0,w=0,M=!1,V,T,H,J,z,L,K,O,Q,ee=!1,ie=!1,te=this.config.kappa_0,se=this.config.delta_0,ae=this.config.alpha_0,le=this.config.h_initial,ge=this.config.max_steps,be=t,Xe=[],Ce=[],Re=[],Se,Ze,he,Ie;if(o=n.slice(1),Xe.push(o[0]),Ce.push(o[1]),C=this.tangent(o),C===!1)return[];this.dfx(o[0],o[1]),this.dfy(o[0],o[1]);do{if(C=this.tangent(o),C===!1){o=u.slice(),Xe.push(o[0]),Ce.push(o[1]);break}if(Xe.length===1)f=C.slice();else if(Xe.length===2)Re.push(Xe.length-1);else if(ee&&Xe.length>2&&!ie){if(J=Geometry.distPointSegment([1,o[0],o[1]],[1,Xe[0],Ce[0]],[1,Xe[1],Ce[1]]),J<this.config.loop_dist*le&&Mat.innerProduct(C,f,2)>this.config.loop_dir){o=n.slice(1),Xe.push(o[0]),Ce.push(o[1]),M=!0;break}if(this.config.loop_detection){for(Se=Xe.length-1,Ze=Math.floor(Mat.log2(Se)),he=0;he<=Ze&&(J=Geometry.distPointSegment([1,o[0],o[1]],[1,Xe[Re[he]-1],Ce[Re[he]-1]],[1,Xe[Re[he]],Ce[Re[he]]]),!(J<this.config.loop_dist*le&&(I=this.tangent([Xe[Re[he]],Ce[Re[he]]]),Mat.innerProduct(C,I,2)>this.config.loop_dir)));he++);if(he<=Ze){M=!0;break}for(Ze=1,Ie=0,he=0;he<100&&(Se+1)%Ze===0;he++)Ze*=2,Ie++;Re[Ie]=Se}}u[0]=o[0]+le*be*C[0],u[1]=o[1]+le*be*C[1],w=0;do A=[this.dfx(u[0],u[1]),this.dfy(u[0],u[1])],H=A[0]*A[0]+A[1]*A[1],y=this.f(u[0],u[1])/H,d[0]=u[0]-A[0]*y,d[1]=u[1]-A[1]*y,w===0?V=Math.abs(y)*Math.sqrt(H):w===1&&(T=Math.abs(y)*Math.sqrt(H)),u[0]=d[0],u[1]=d[1],w++;while(w<20&&Math.abs(this.f(u[0],u[1]))>this.config.tol_newton);if(K=V,w>1?L=T/V:L=0,I=this.tangent(u),G=Mat.innerProduct(C,I,2),G=Math.max(-1,Math.min(1,G)),O=Math.acos(G),ie=!1,z=Geometry.distance(o,u,2),z<this.config.tol_progress){o=u.slice(),Xe.push(o[0]),Ce.push(o[1]);break}else if(G<0&&!(le>this.config.h_critical))if(ie=!0,this.isBifurcation(o,this.config.tol_cusp))be*=-1,O=0;else{o=u.slice(),Xe.push(o[0]),Ce.push(o[1]);break}if(!ie&&(Q=Math.max(Math.sqrt(L/te),Math.sqrt(K/se),O/ae),isNaN(Q)&&(Q=1),Q=Math.max(Math.min(Q,2),.5),le/=Q,le=Math.min(this.config.h_max,le),Q>=2)){if(S++,S>=3*ge)break;ee=!1;continue}o=u.slice(),Xe.push(o[0]),Ce.push(o[1]),ee=!0,S++}while(S<ge&&o[0]>=this.bbox[0]&&o[1]<=this.bbox[1]&&o[0]<=this.bbox[2]&&o[1]>=this.bbox[3]);return[Xe,Ce,M]},isBifurcation:function(n,t){var o=Mat.eps*Mat.eps*100,u,d,C,I,f,A,y,G,S,w;return u=n[0],d=n[1],C=.5*(this.dfx(u+o,d)-this.dfx(u-o,d))/o,I=.5*(this.dfx(u,d+o)-this.dfx(u,d-o))/o,f=.5*(this.dfy(u+o,d)-this.dfy(u-o,d))/o,A=.5*(this.dfy(u,d+o)-this.dfy(u,d-o))/o,y=C+A,w=y*y-4*(C*A-I*f),G=.5*(y+Math.sqrt(w)),S=.5*(y-Math.sqrt(w)),Math.abs(G)>t&&Math.abs(S)>t},handleCriticalPoint:function(n,t,o,u){var d=Math.atan2(u*t[1],u*t[0]),C=function(y){var G=n[0]+o*Math.cos(y),S=n[1]+o*Math.sin(y);return this.f(G,S)},I,f,A;return A=Numerics.root(C,d),I=n[0]+o*Math.cos(A),f=n[1]+o*Math.sin(A),[I,f]},updateA:function(n,t,o){var u=[o[0]-t[0],o[1]-t[1]],d=this.f(o[0],o[1])-this.f(t[0],t[1]),C,I;return I=u[0]*u[0]+u[1]*u[1],C=d-(n[0]*u[0]+n[1]*u[1]),C/=I,n[0]+=C*u[0],n[1]+=C*u[1],n},tangent_A:function(n){var t=[-n[1],n[0]],o=Mat.norm(t,2);return o<Mat.eps,[t[0]/o,t[1]/o]},tangent:function(n){var t=[-this.dfy(n[0],n[1]),this.dfx(n[0],n[1])],o=Mat.norm(t,2);return o<Mat.eps*Mat.eps?!1:[t[0]/o,t[1]/o]}});const ImplicitPlot=Mat.ImplicitPlot;Mat.Metapost={MP_ENDPOINT:0,MP_EXPLICIT:1,MP_GIVEN:2,MP_CURL:3,MP_OPEN:4,MP_END_CYCLE:5,UNITY:1,FRACTION_ONE:1,FRACTION_THREE:3,ONE_EIGHTY_DEG:Math.PI,THREE_SIXTY_DEG:2*Math.PI,EPS_SQ:1e-5*1e-5,make_choices:function(n){var t,o,u,d,C,I,f,A,y,G,S,w,M,V,T,H=!0;f=n[0];do{if(!f)break;I=f.next,f.rtype>this.MP_EXPLICIT&&(f.x-I.x)*(f.x-I.x)+(f.y-I.y)*(f.y-I.y)<this.EPS_SQ&&(f.rtype=this.MP_EXPLICIT,f.ltype===this.MP_OPEN&&(f.ltype=this.MP_CURL,f.set_left_curl(this.UNITY)),I.ltype=this.MP_EXPLICIT,I.rtype===this.MP_OPEN&&(I.rtype=this.MP_CURL,I.set_right_curl(this.UNITY)),f.rx=f.x,I.lx=f.x,f.ry=f.y,I.ly=f.y),f=I}while(f!==n[0]);for(o=n[0];H&&!(o.ltype!==this.MP_OPEN||o.rtype!==this.MP_OPEN);)if(o=o.next,o===n[0]){o.ltype=this.MP_END_CYCLE;break}for(f=o;H&&f;){if(I=f.next,f.rtype>=this.MP_GIVEN){for(;I.ltype===this.MP_OPEN&&I.rtype===this.MP_OPEN;)I=I.next;for(u=0,A=f,C=n.length,w=[],M=[],V=[],T=[null];H&&(G=A.next,w.push(G.x-A.x),M.push(G.y-A.y),V.push(this.mp_pyth_add(w[u],M[u])),u>0&&(S=M[u-1]/V[u-1],y=w[u-1]/V[u-1],T.push(Math.atan2(M[u]*y-w[u]*S,w[u]*y+M[u]*S))),u++,A=G,A===I&&(C=u),!(u>=C&&A.ltype!==this.MP_END_CYCLE)););u===C?T.push(0):T.push(T[1]),I.ltype===this.MP_OPEN&&(d=I.rx-I.x,t=I.ry-I.y,d*d+t*t<this.EPS_SQ?(I.ltype=this.MP_CURL,I.set_left_curl(this.UNITY)):(I.ltype=this.MP_GIVEN,I.set_left_given(Math.atan2(t,d)))),f.rtype===this.MP_OPEN&&f.ltype===this.MP_EXPLICIT&&(d=f.x-f.lx,t=f.y-f.ly,d*d+t*t<this.EPS_SQ?(f.rtype=this.MP_CURL,f.set_right_curl(this.UNITY)):(f.rtype=this.MP_GIVEN,f.set_right_given(Math.atan2(t,d)))),this.mp_solve_choices(f,I,C,w,M,V,T)}else f.rtype===this.MP_ENDPOINT&&(f.rx=f.x,f.ry=f.y,I.lx=I.x,I.ly=I.y);if(f=I,f===o)break}},mp_solve_choices:function(n,t,o,u,d,C,I){var f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe,Ce,Re=!0;for(S=C.length+1,H=new Array(S),T=new Array(S),y=new Array(S),O=new Array(S),Xe=0;Xe<S;Xe++)O[Xe]=y[Xe]=T[Xe]=H[Xe]=0;for(M=0,V=n,z=0;Re;){if(L=V.next,M===0)if(V.rtype===this.MP_GIVEN){if(L.ltype===this.MP_GIVEN){f=Math.atan2(d[0],u[0]),te=this.mp_n_sin_cos(n.right_given()-f),se=te[0],ae=te[1],le=this.mp_n_sin_cos(t.left_given()-f),ge=le[0],be=le[1],this.mp_set_controls(n,t,u[0],d[0],ae,se,-be,ge);return}y[0]=V.right_given()-Math.atan2(d[0],u[0]),y[0]=this.reduce_angle(y[0]),H[0]=0,T[0]=0}else if(V.rtype===this.MP_CURL){if(L.ltype===this.MP_CURL){n.rtype=this.MP_EXPLICIT,t.ltype=this.MP_EXPLICIT,J=Math.abs(t.left_tension()),Q=Math.abs(n.right_tension()),K=this.UNITY/(3*Q),n.rx=n.x+u[0]*K,n.ry=n.y+d[0]*K,K=this.UNITY/(3*J),t.lx=t.x-u[0]*K,t.ly=t.y-d[0]*K;return}ie=V.right_curl(),J=Math.abs(L.left_tension()),Q=Math.abs(V.right_tension()),H[0]=this.mp_curl_ratio(ie,Q,J),y[0]=-I[1]*H[0],T[0]=0}else V.rtype===this.MP_OPEN&&(H[0]=0,y[0]=0,T[0]=this.FRACTION_ONE);else if(V.ltype===this.MP_END_CYCLE||V.ltype===this.MP_OPEN){if(f=this.UNITY/(3*Math.abs(z.right_tension())-this.UNITY),ee=C[M]*(this.FRACTION_THREE-this.UNITY/Math.abs(z.right_tension())),G=this.UNITY/(3*Math.abs(L.left_tension())-this.UNITY),w=C[M-1]*(this.FRACTION_THREE-this.UNITY/Math.abs(L.left_tension())),ie=this.FRACTION_ONE-H[M-1]*f,ee=ee*ie,J=Math.abs(V.left_tension()),Q=Math.abs(V.right_tension()),J<Q?ee*=Math.pow(J/Q,2):J>Q&&(w*=Math.pow(Q/J,2)),K=w/(w+ee),H[M]=K*G,A=-I[M+1]*H[M],z.rtype===this.MP_CURL?(T[M]=0,y[M]=A-I[1]*(this.FRACTION_ONE-K)):(K=(this.FRACTION_ONE-K)/ie,A=A-I[M]*K,K=K*f,y[M]=A-y[M-1]*K,T[M]=-T[M-1]*K),V.ltype===this.MP_END_CYCLE){for(f=0,G=this.FRACTION_ONE;Re&&(M-=1,M===0&&(M=o),f=y[M]-f*H[M],G=T[M]-G*H[M],M!==o););for(f=f/(this.FRACTION_ONE-G),O[o]=f,y[0]=f,Ce=1;Ce<o;Ce++)y[Ce]=y[Ce]+f*T[Ce];break}}else{if(V.ltype===this.MP_CURL){ie=V.left_curl(),J=Math.abs(V.left_tension()),Q=Math.abs(z.right_tension()),K=this.mp_curl_ratio(ie,J,Q),O[o]=-(y[o-1]*K)/(this.FRACTION_ONE-K*H[o-1]);break}if(V.ltype===this.MP_GIVEN){O[o]=V.left_given()-Math.atan2(d[o-1],u[o-1]),O[o]=this.reduce_angle(O[o]);break}}z=V,V=L,M+=1}for(M=o-1;M>-1;M--)O[M]=y[M]-O[M+1]*H[M];for(V=n,M=0;Re&&(L=V.next,te=this.mp_n_sin_cos(O[M]),se=te[0],ae=te[1],le=this.mp_n_sin_cos(-I[M+1]-O[M+1]),ge=le[0],be=le[1],this.mp_set_controls(V,L,u[M],d[M],ae,se,be,ge),M++,V=L,M!==o););},mp_n_sin_cos:function(n){return[Math.cos(n),Math.sin(n)]},mp_set_controls:function(n,t,o,u,d,C,I,f){var A,y,G,S,w;G=Math.abs(t.left_tension()),A=Math.abs(n.right_tension()),w=this.mp_velocity(d,C,I,f,A),y=this.mp_velocity(I,f,d,C,G),(n.right_tension()<0||t.left_tension()<0)&&(d>=0&&I>=0||d<=0&&I<=0)&&(S=Math.abs(d)*f+Math.abs(I)*C,S>0&&(S*=1.00024414062,n.right_tension()<0&&this.mp_ab_vs_cd(Math.abs(I),this.FRACTION_ONE,w,S)<0&&(w=Math.abs(I)/S),t.left_tension()<0&&this.mp_ab_vs_cd(Math.abs(d),this.FRACTION_ONE,y,S)<0&&(y=Math.abs(d)/S))),n.rx=n.x+(o*C-u*d)*w,n.ry=n.y+(u*C+o*d)*w,t.lx=t.x-(o*f+u*I)*y,t.ly=t.y-(u*f-o*I)*y,n.rtype=this.MP_EXPLICIT,t.ltype=this.MP_EXPLICIT},mp_pyth_add:function(n,t){return Mat.hypot(n,t)},mp_curl_ratio:function(n,t,o){var u=1/t,d=1/o;return Math.min(4,((3-u)*u*u*n+d*d*d)/(u*u*u*n+(3-d)*d*d))},mp_ab_vs_cd:function(n,t,o,u){return n*t===o*u?0:n*t>o*u?1:-1},mp_velocity:function(n,t,o,u,d){return Math.min(4,(2+Math.sqrt(2)*(n-o/16)*(o-n/16)*(t-u))/(1.5*d*(2+(Math.sqrt(5)-1)*t+(3-Math.sqrt(5))*u)))},reduce_angle:function(n){return Math.abs(n)>this.ONE_EIGHTY_DEG&&(n>0?n-=this.THREE_SIXTY_DEG:n+=this.THREE_SIXTY_DEG),n},makeknots:function(n,t){var o,u,d=[];for(u=n.length,o=0;o<u;o++)d.push({x:n[o][0],y:n[o][1],ltype:this.MP_OPEN,rtype:this.MP_OPEN,lx:!1,rx:!1,ly:t,ry:t,left_curl:function(){return this.lx||0},right_curl:function(){return this.rx||0},left_tension:function(){return this.ly||1},right_tension:function(){return this.ry||1},set_right_curl:function(C){this.rx=C||0},set_left_curl:function(C){this.lx=C||0}});for(u=d.length,o=0;o<u;o++)d[o].next=d[o+1]||d[o],d[o].set_right_given=d[o].set_right_curl,d[o].set_left_given=d[o].set_left_curl,d[o].right_given=d[o].right_curl,d[o].left_given=d[o].left_curl;return d[u-1].next=d[0],d},curve:function(n,t){var o,u,d,C,I,f,A=!1,y=[],G=[];t=t||{tension:1,direction:{},curl:{},isClosed:!1},I=1,t.hasOwnProperty("tension")&&(I=JXG$1.evaluate(t.tension)),o=this.makeknots(n,I),u=o.length,JXG$1.exists(t.isClosed)&&JXG$1.evaluate(t.isClosed)&&(A=!0),A||(o[0].ltype=this.MP_ENDPOINT,o[0].rtype=this.MP_CURL,o[u-1].rtype=this.MP_ENDPOINT,o[u-1].ltype=this.MP_CURL);for(C in t)if(t.hasOwnProperty(C)){if(d=parseInt(C,10),isNaN(d)||d<0||d>=u)continue;if(f=t[d],JXG$1.exists(f.type))switch(f.type){case"curl":I=JXG$1.evaluate(f.curl),d===0?(o[d].rtype=this.MP_CURL,o[d].set_right_curl(I)):d===u-1?(o[d].ltype=this.MP_CURL,o[d].set_left_curl(I)):(o[d].ltype=this.MP_CURL,o[d].rtype=this.MP_CURL,o[d].lx=I,o[d].rx=I);break}JXG$1.exists(f.direction)&&(I=JXG$1.evaluate(f.direction),JXG$1.isArray(I)?(I[0]!==!1&&(o[d].lx=I[0]*Math.PI/180,o[d].ltype=this.MP_GIVEN),I[1]!==!1&&(o[d].rx=I[1]*Math.PI/180,o[d].rtype=this.MP_GIVEN)):(o[d].lx=I*Math.PI/180,o[d].rx=I*Math.PI/180,o[d].ltype=o[d].rtype=this.MP_GIVEN)),JXG$1.exists(f.tension)&&(I=JXG$1.evaluate(f.tension),JXG$1.isArray(I)?(I[0]!==!1&&(o[d].ly=JXG$1.evaluate(I[0])),I[1]!==!1&&(o[d].ry=JXG$1.evaluate(I[1]))):(o[d].ly=I,o[d].ry=I))}for(this.make_choices(o),d=0;d<u-1;d++)y.push(o[d].x),y.push(o[d].rx),y.push(o[d+1].lx),G.push(o[d].y),G.push(o[d].ry),G.push(o[d+1].ly);return y.push(o[u-1].x),G.push(o[u-1].y),A&&(y.push(o[u-1].rx),G.push(o[u-1].ry),y.push(o[0].lx),G.push(o[0].ly),y.push(o[0].x),G.push(o[0].y)),[y,G]}};const Metapost=Mat.Metapost;Mat.Clip={_isSeparator:function(n){return isNaN(n.coords.usrCoords[1])&&isNaN(n.coords.usrCoords[2])},makeDoublyLinkedList:function(n){var t,o=null,u=[],d=n.length;if(d>0)for(t=0;t<d;t++){if(this._isSeparator(n[t])){n[t]._next=n[(t+1)%d],n[t]._prev=n[(d+t-1)%d];continue}o===null&&(o=t,u.push(o)),this._isSeparator(n[(t+1)%d])||t===d-1?(n[t]._next=n[o],n[o]._prev=n[t],n[t]._end=!0,o=null):(n[t]._next=n[(t+1)%d],n[o]._prev=n[t]),this._isSeparator(n[(d+t-1)%d])||(n[t]._prev=n[(d+t-1)%d])}return u},Vertex:function(n,t,o,u,d,C){this.pos=t,this.intersection=!0,this.coords=n,this.elementClass=Const.OBJECT_CLASS_POINT,this.data={alpha:o,path:u,pathname:d,done:!1,type:C,idx:0},this.neighbour=null,this.entry_exit=!1},_addToList:function(n,t,o){var u=n.length,d=Mat.eps*Mat.eps;u>0&&Math.abs(n[u-1].coords.usrCoords[0]-t.usrCoords[0])<d&&Math.abs(n[u-1].coords.usrCoords[1]-t.usrCoords[1])<d&&Math.abs(n[u-1].coords.usrCoords[2]-t.usrCoords[2])<d||n.push({pos:o,intersection:!1,coords:t,elementClass:Const.OBJECT_CLASS_POINT})},sortIntersections:function(n){var t,o,u,d,C,I,f=[],A=n.length;for(t=0;t<A;t++)if(n[t].sort(function(y,G){return y.data.alpha>G.data.alpha?1:-1}),n[t].length>0){for(C=n[t].length-1,u=n[t][0],d=u.data.path[u.pos],I=d._next,t===A-1&&(d._end=!1),u.data.alpha===0&&u.data.type==="T"?(d.intersection=!0,d.data=u.data,d.neighbour=u.neighbour,d.neighbour.neighbour=d,d.entry_exit=!1,n[t][0]=d):(u._prev=d,u._prev._next=u),o=1;o<=C;o++)u=n[t][o],u._prev=n[t][o-1],u._prev._next=u;u=n[t][C],u._next=I,u._next._prev=u,t===A-1&&(u._end=!0),f=f.concat(n[t])}return f},_inbetween:function(n,t,o){var u,d=Mat.eps*Mat.eps,C=o[1]-t[1],I=o[2]-t[2],f=n[1]-t[1],A=n[2]-t[2];return C===0&&I===0&&f===0&&A===0?!0:(Math.abs(f)<d&&Math.abs(C)<d?u=A/I:u=f/C,Math.abs(u)<d&&(u=0),u)},_print_array:function(n){var t,o;for(t=0;t<n.length;t++)try{o="",n[t]._end&&(o=" end"),console.log(t,n[t].coords.usrCoords,n[t].data.type,"	","prev",n[t]._prev.coords.usrCoords,"next",n[t]._next.coords.usrCoords+o)}catch{console.log(t,n[t].coords.usrCoords)}},_print_list:function(n){for(var t=0,o;t<100&&(n.data?o=n.data.alpha:o="-",console.log("	",n.coords.usrCoords,`
		is:`,n.intersection,"end:",n._end,o,`
		-:`,n._prev.coords.usrCoords,`
		+:`,n._next.coords.usrCoords,`
		n:`,n.intersection?n.neighbour.coords.usrCoords:"-"),!n._end);)n=n._next,t++},_noOverlap:function(n,t,o,u){var d,C=Math.sqrt(Mat.eps),I,f,A,y,G=!1;for(d=0;d<3;d++)if(I=Math.min(n[d],t[d]),f=Math.max(n[d],t[d]),A=Math.min(o[d],u[d]),y=Math.max(o[d],u[d]),f<A-C||I>y+C){G=!0;break}return G},findIntersections:function(n,t,o){var u=[],d=Mat.eps*100,C,I,f,A=n.length,y=t.length,G,S,w,M,V,T,H,J,z,L,K=[],O=[],Q=[],ee=[],ie=!1,te=!1;for(I=0;I<y;I++)ee.push([]);for(C=0;C<A;C++){if(Q.push([]),this._isSeparator(n[C])||this._isSeparator(n[(C+1)%A])){ie=!0;continue}if(ie&&C===A-1)break;for(G=n[C].coords.usrCoords,S=n[(C+1)%A].coords.usrCoords,I=0;I<y;I++){if(this._isSeparator(t[I])||this._isSeparator(t[(I+1)%y])){te=!0;continue}if(te&&I===y-1)break;if(w=t[I].coords.usrCoords,M=t[(I+1)%y].coords.usrCoords,!this._noOverlap(G,S,w,M)&&(u=Geometry.meetSegmentSegment(G,S,w,M),V=Geometry.distance(G,S,3),T=Geometry.distance(w,M,3),u[1]*V>-d&&u[1]<1-d/V&&u[2]*T>-d&&u[2]<1-d/T||u[1]===1/0&&u[2]===1/0&&Mat.norm(u[0],3)<d)){if(f=new Coords(Const.COORDS_BY_USER,u[0],o),J="X",Math.abs(u[1])*V<d||Math.abs(u[2])*T<d)J="T",Math.abs(u[1])*V<d&&(u[1]=0),Math.abs(u[2])*T<d&&(u[2]=0),u[1]===0?f=new Coords(Const.COORDS_BY_USER,G,o):f=new Coords(Const.COORDS_BY_USER,w,o);else if(u[1]===1/0&&u[2]===1/0&&Mat.norm(u[0],3)<d){H=this._inbetween(G,w,M),H>=0&&H<1&&(J="T",f=new Coords(Const.COORDS_BY_USER,G,o),u[1]=0,u[2]=H,z=new this.Vertex(f,C,u[1],n,"S",J),L=new this.Vertex(f,I,u[2],t,"C",J),z.neighbour=L,L.neighbour=z,Q[C].push(z),ee[I].push(L)),H=this._inbetween(w,G,S),Geometry.distance(G,w,3)>d&&H>=0&&H<1&&(J="T",f=new Coords(Const.COORDS_BY_USER,w,o),u[1]=H,u[2]=0,z=new this.Vertex(f,C,u[1],n,"S",J),L=new this.Vertex(f,I,u[2],t,"C",J),z.neighbour=L,L.neighbour=z,Q[C].push(z),ee[I].push(L));continue}z=new this.Vertex(f,C,u[1],n,"S",J),L=new this.Vertex(f,I,u[2],t,"C",J),z.neighbour=L,L.neighbour=z,Q[C].push(z),ee[I].push(L)}}}for(K=this.sortIntersections(Q),C=0;C<K.length;C++)K[C].data.idx=C,K[C].neighbour.data.idx=C;return O=this.sortIntersections(ee),[K,O]},_getPosition:function(n,t,o,u){var d=Geometry.det3p(n,t,o),C=Geometry.det3p(n,o,u),I=Geometry.det3p(t,o,u);return I>=0?d>=0&&C>=0?"left":"right":d>=0||C>=0?"left":"right"},_classifyDegenerateIntersections:function(n){var t,o,u,d,C,I,f,A,y,G,S,w,M,V,T=!0;for(y=Geometry.det3p,f=0,n._tours=0;T;){if(n.intersection&&n.data.type==="T"&&(t=n._next.coords.usrCoords,o=n._prev.coords.usrCoords,Geometry.distance(n.coords.usrCoords,t,3)<Mat.eps&&(t=n._next._next.coords.usrCoords),Geometry.distance(n.coords.usrCoords,o,3)<Mat.eps&&(o=n._prev._prev.coords.usrCoords),C=n.neighbour,d=C._prev.coords.usrCoords,u=C._next.coords.usrCoords,Geometry.distance(C.coords.usrCoords,u,3)<Mat.eps&&(u=C._next._next.coords.usrCoords),Geometry.distance(C.coords.usrCoords,d,3)<Mat.eps&&(d=C._prev._prev.coords.usrCoords),S=y(n.coords.usrCoords,o,d),w=y(n.coords.usrCoords,t,u),M=y(n.coords.usrCoords,o,u),V=y(n.coords.usrCoords,t,d),S===0&&w===0&&M===0&&V===0&&(n.coords.usrCoords[1]*=1+Math.random()*Mat.eps,n.coords.usrCoords[2]*=1+Math.random()*Mat.eps,C.coords.usrCoords[1]=n.coords.usrCoords[1],C.coords.usrCoords[2]=n.coords.usrCoords[2],S=y(n.coords.usrCoords,o,d),w=y(n.coords.usrCoords,t,u),M=y(n.coords.usrCoords,o,u),V=y(n.coords.usrCoords,t,d)),G=!1,S===0?Geometry.affineRatio(n.coords.usrCoords,o,d)<0&&(G=!0):w===0?Geometry.affineRatio(n.coords.usrCoords,t,u)<0&&(G=!0):M===0?Geometry.affineRatio(n.coords.usrCoords,o,u)>0&&(G=!0):V===0&&Geometry.affineRatio(n.coords.usrCoords,t,d)>0&&(G=!0),G&&(A=d,d=u,u=A,A=S,S=M,M=A,A=w,w=V,V=A),JXG$1.exists(n.delayedStatus)||(n.delayedStatus=[]),S===0&&w===0?n.delayedStatus=["on","on"]:S===0?(I=this._getPosition(t,d,C.coords.usrCoords,u),n.delayedStatus=["on",I]):w===0?(I=this._getPosition(o,d,C.coords.usrCoords,u),n.delayedStatus=[I,"on"]):n.delayedStatus.length===0&&(this._getPosition(o,d,C.coords.usrCoords,u)!==this._getPosition(t,d,C.coords.usrCoords,u)?n.data.type="X":n.data.type="B")),JXG$1.exists(n._tours)&&n._tours++,n._tours>3||n._end||f>1e3){f>1e3&&console.log("Clipping: _classifyDegenerateIntersections exit"),JXG$1.exists(n._tours)&&delete n._tours;break}n.intersection&&f++,n=n._next}},_handleIntersectionChains:function(n){for(var t=0,o="Null",u,d=!0,C=!1,I=!1;d&&(n.intersection===!0&&(n.data.type==="T"&&(n.delayedStatus[0]!=="on"&&n.delayedStatus[1]==="on"?(C=!0,u=n,o=n.delayedStatus[0]):C&&n.delayedStatus[0]==="on"&&n.delayedStatus[1]==="on"?n.data.type="B":C&&n.delayedStatus[0]==="on"&&n.delayedStatus[1]!=="on"&&(C=!1,o===n.delayedStatus[1]?(u.data.type="DB",n.data.type="DB"):(u.data.type="DX",n.data.type="DX"))),t++),n._end&&(I=!0),!(I&&!C));){if(t>1e3){console.log("Warning: _handleIntersectionChains: intersection chain reached maximum numbers of iterations");break}n=n._next}},_handleFullyDegenerateCase:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z=[n,t];for(C=0;C<2;C++){for(u=z[C],M=u.length,S=0,J=!0;S<M;S++)if(!u[S].intersection){J=!1;break}if(J)for(d=z[(C+1)%2],V=d.length,S=0;S<M;S++){for(A=u[S].coords.usrCoords,y=u[S]._next.coords.usrCoords,I=[(A[0]+y[0])*.5,(A[1]+y[1])*.5,(A[2]+y[2])*.5],w=0,T=!1;w<V;w++)if(Math.abs(Geometry.det3p(d[w].coords.usrCoords,d[(w+1)%V].coords.usrCoords,I))<Mat.eps){T=!0;break}if(!T){f=new Coords(Const.COORDS_BY_USER,I,o),G={pos:S,intersection:!1,coords:f,elementClass:Const.OBJECT_CLASS_POINT},H=u[S]._next,u[S]._next=G,G._prev=u[S],G._next=H,H._prev=G,u[S]._end&&(u[S]._end=!1,G._end=!0);break}}}},_getStatus:function(n,t){for(var o;n.intersection&&!n._end;)n=n._next;return Geometry.windingNumber(n.coords.usrCoords,t)===0?o="entry":o="exit",[n,o]},markEntryExit:function(n,t,o){var u,d,C,I,f,A,y,G=!0,S=null,w=0;for(A=o.length,f=0;f<A;f++)for(y=o[f],this._classifyDegenerateIntersections(n[y]),this._handleIntersectionChains(n[y]),I=this._getStatus(n[y],t),d=I[0],u=I[1],d._starter=!0,C=0,S=null,w=0;G&&(d.intersection===!0&&(d.data.type==="X"&&w===1&&(S.entry_exit=u,u==="exit"&&(S.data.type="X"),w=2),(d.data.type==="X"||d.data.type==="DB")&&(d.entry_exit=u,u=u==="entry"?"exit":"entry"),d.data.type==="DX"&&(w===0?(S=d,w=1):w===1?(d.entry_exit=u,S.entry_exit=u,u==="exit"?S.data.type="X":d.data.type="X",u=u==="entry"?"exit":"entry",S=null,w=0):w===2&&(d.entry_exit=u,d.data.type="X",u=u==="entry"?"exit":"entry",S=null,w=0))),d=d._next,!(JXG$1.exists(d._starter)||C>1e4));)C++},_stayOnPath:function(n,t){var o=!0;return n.intersection&&n.data.type!=="B"&&(o=t===n.entry_exit),o},_addVertex:function(n,t,o){return!isNaN(t.coords.usrCoords[1])&&!isNaN(t.coords.usrCoords[2])&&n.push(t),t.intersection&&t.data.done?(o&&console.log("Add last intersection point",t.coords.usrCoords,"on",t.data.pathname,t.entry_exit,t.data.type),!0):(t.intersection&&(t.data.done=!0,o&&console.log("Add intersection point",t.coords.usrCoords,"on",t.data.pathname,t.entry_exit,t.data.type)),!1)},tracing:function(n,t,o){for(var u,d,C,I,f=0,A=1e4,y=0,G=[],S=!1,w=!1;y<t.length&&f<A;){if(C=t[y],C.data.done||C.data.type!=="X"){y++;continue}G.length>0&&G.push([NaN,NaN]),I=C.data.idx,u=n,S=this._addVertex(G,C,w),d=C.entry_exit;do{if(S)break;if(o==="intersection"&&C.entry_exit==="entry"||o==="union"&&C.entry_exit==="exit"||o==="difference"&&u===n==(C.entry_exit==="exit")){do if(C=C._next,S=this._addVertex(G,C,w),S)break;while(this._stayOnPath(C,d));f++}else{do if(C=C._prev,S=this._addVertex(G,C,w),S)break;while(this._stayOnPath(C,d));f++}if(S)break;if(!C.neighbour)return console.log("Tracing: emergency break - no neighbour!!!!!!!!!!!!!!!!!",f),[[0],[0]];if(C=C.neighbour,C.data.done)break;C.data.done=!0,d=C.entry_exit,u=C.data.path}while(C.data.idx!==I&&f<A);f>=A&&console.log("Tracing: stopping an infinite loop!",f),y++}return this._getCoordsArrays(G,!1)},isEmptyCase:function(n,t,o){return o==="intersection"&&(n.length===0||t.length===0)||o==="union"&&n.length===0&&t.length===0||o==="difference"&&n.length===0},_getCoordsArrays:function(n,t){var o=[],u=[],d,C=n.length;for(d=0;d<C;d++)n[d].coords?(o.push(n[d].coords.usrCoords[1]),u.push(n[d].coords.usrCoords[2])):(o.push(n[d][0]),u.push(n[d][1]));return t&&C>0&&(n[0].coords?(o.push(n[0].coords.usrCoords[1]),u.push(n[0].coords.usrCoords[2])):(o.push(n[0][0]),u.push(n[0][1]))),[o,u]},handleEmptyIntersection:function(n,t,o){var u,d,C=!1,I=[];if(n.length===0)return o==="union"?I=t:I=[],this._getCoordsArrays(I,!0);if(t.length===0)return o==="intersection"?I=[]:I=n,this._getCoordsArrays(I,!0);if(n.length>0)for(u=n[0];u.intersection&&(u=u._next,!u._end););if(t.length>0)for(d=t[0];d.intersection&&(d=d._next,!d._end););return Geometry.windingNumber(u.coords.usrCoords,t)===0?Geometry.windingNumber(d.coords.usrCoords,n)!==0?(o==="union"?(JXG$1.concat(I,n),I.push(n[0])):o==="difference"&&(JXG$1.concat(I,n),I.push(n[0]),Geometry.signedPolygon(n)*Geometry.signedPolygon(t)>0&&I.reverse(),I.push([NaN,NaN])),(o==="difference"||o==="intersection")&&(JXG$1.concat(I,t),I.push(t[0]),C=!1)):o==="difference"?(JXG$1.concat(I,n),C=!0):o==="union"&&(JXG$1.concat(I,n),I.push(n[0]),I.push([NaN,NaN]),JXG$1.concat(I,t),I.push(t[0])):o==="intersection"?(JXG$1.concat(I,n),C=!0):o==="union"&&(JXG$1.concat(I,t),I.push(t[0])),this._getCoordsArrays(I,C)},_countCrossingIntersections:function(n){var t,o=n.length,u=0;for(t=0;t<o;t++)n[t].data.type==="X"&&u++;return u},_getPath:function(n,t){var o,u,d,C,I,f,A,y=[];if(n.elementClass===Const.OBJECT_CLASS_CURVE&&(n.type===Const.OBJECT_TYPE_ARC||n.type===Const.OBJECT_TYPE_SECTOR)){for(I=Geometry.rad(n.radiuspoint,n.center,n.anglepoint),A=Math.floor(I*180/Math.PI),d=n.Radius(),C=I/A,f=Math.atan2(n.radiuspoint.coords.usrCoords[2]-n.center.coords.usrCoords[2],n.radiuspoint.coords.usrCoords[1]-n.center.coords.usrCoords[1]),n.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(y,n.center.coords,0),o=0;o<=A;o++)this._addToList(y,new Coords(Const.COORDS_BY_USER,[n.center.coords.usrCoords[0],n.center.coords.usrCoords[1]+Math.cos(o*C+f)*d,n.center.coords.usrCoords[2]+Math.sin(o*C+f)*d],t),o+1);n.type===Const.OBJECT_TYPE_SECTOR&&this._addToList(y,n.center.coords,A+2)}else if(n.elementClass===Const.OBJECT_CLASS_CURVE&&JXG$1.exists(n.points))for(u=n.numberPoints,o=0;o<u;o++)this._addToList(y,n.points[o],o);else if(n.type===Const.OBJECT_TYPE_POLYGON)for(o=0;o<n.vertices.length;o++)this._addToList(y,n.vertices[o].coords,o);else if(n.elementClass===Const.OBJECT_CLASS_CIRCLE)for(A=359,d=n.Radius(),C=2*Math.PI/A,o=0;o<=A;o++)this._addToList(y,new Coords(Const.COORDS_BY_USER,[n.center.coords.usrCoords[0],n.center.coords.usrCoords[1]+Math.cos(o*C)*d,n.center.coords.usrCoords[2]+Math.sin(o*C)*d],t),o);else if(JXG$1.isArray(n))for(u=n.length,o=0;o<u;o++)JXG$1.exists(n[o].coords)?this._addToList(y,n[o].coords,o):JXG$1.isArray(n[o])?this._addToList(y,new Coords(Const.COORDS_BY_USER,n[o],t),o):JXG$1.exists(n[o].usrCoords)&&this._addToList(y,n[o],o);return y},greinerHormann:function(n,t,o,u){var d,C=[],I=[],f=[],A,y,G=[];return C=this._getPath(n,u),d=C.length,d>0&&Geometry.distance(C[0].coords.usrCoords,C[d-1].coords.usrCoords,3)<Mat.eps&&C.pop(),I=this._getPath(t,u),d=I.length,d>0&&Geometry.distance(I[0].coords.usrCoords,I[d-1].coords.usrCoords,3)<Mat.eps*Mat.eps&&I.pop(),this.isEmptyCase(C,I,o)?[[],[]]:(A=this.makeDoublyLinkedList(C),y=this.makeDoublyLinkedList(I),G=this.findIntersections(C,I,u),f=G[0],this._handleFullyDegenerateCase(C,I,u),this.markEntryExit(C,I,A),this.markEntryExit(I,C,y),this._countCrossingIntersections(f)===0?this.handleEmptyIntersection(C,I,o):this.tracing(C,f,o))},union:function(n,t,o){return this.greinerHormann(n,t,"union",o)},intersection:function(n,t,o){return this.greinerHormann(n,t,"intersection",o)},difference:function(n,t,o){return this.greinerHormann(n,t,"difference",o)}};const Clip=Mat.Clip;Mat.Poly={};Mat.Poly.Ring=function(n){this.vars=n};JXG$1.extend(Mat.Poly.Ring.prototype,{});Mat.Poly.Monomial=function(n,t,o){var u;if(!JXG$1.exists(n))throw new Error("JSXGraph error: In JXG.Math.Poly.monomial missing parameter 'ring'.");for(JXG$1.isArray(o)||(o=[]),o=o.slice(0,n.vars.length),u=o.length;u<n.vars.length;u++)o.push(0);this.ring=n,this.coefficient=t||0,this.exponents=JXG$1.deepCopy(o)};JXG$1.extend(Mat.Poly.Monomial.prototype,{copy:function(){return new Mat.Poly.Monomial(this.ring,this.coefficient,this.exponents)},print:function(){var n=[],t;for(t=0;t<this.ring.vars.length;t++)n.push(this.ring.vars[t]+"^"+this.exponents[t]);return this.coefficient+"*"+n.join("*")}});Mat.Poly.Polynomial=function(n,t){var o=function(){},u;if(!JXG$1.exists(n))throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial missing parameter 'ring'.");JXG$1.exists(t)&&JXG$1.isString(t)?u=o():u=[],this.ring=n,this.monomials=u};JXG$1.extend(Mat.Poly.Polynomial.prototype,{findSignature:function(n){var t;for(t=0;t<this.monomials.length;t++)if(JXG$1.cmpArrays(this.monomials[t].exponents,n))return t;return-1},addSubMonomial:function(n,t){var o;o=this.findSignature(n.exponents),o>-1?this.monomials[o].coefficient+=t*n.coefficient:(n.coefficient*=t,this.monomials.push(n))},add:function(n){var t;if(JXG$1.exists(n)&&n.ring===this.ring)if(JXG$1.isArray(n.exponents))this.addSubMonomial(n,1);else for(t=0;t<n.monomials.length;t++)this.addSubMonomial(n.monomials[t],1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.add either summand is undefined or rings don't match.")},sub:function(n){var t;if(JXG$1.exists(n)&&n.ring===this.ring)if(JXG$1.isArray(n.exponents))this.addSubMonomial(n,-1);else for(t=0;t<n.monomials.length;t++)this.addSubMonomial(n.monomials[t],-1);else throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.sub either summand is undefined or rings don't match.")},copy:function(){var n,t;for(t=new Mat.Poly.Polynomial(this.ring),n=0;n<this.monomials.length;n++)t.monomials.push(this.monomials[n].copy());return t},print:function(){var n=[],t;for(t=0;t<this.monomials.length;t++)n.push("("+this.monomials[t].print()+")");return n.join("+")}});Mat.Poly;JXG$1.Complex=function(n,t){this.isComplex=!0,n&&n.isComplex&&(t=n.imaginary,n=n.real),this.real=n||0,this.imaginary=t||0,this.absval=0,this.angle=0};JXG$1.extend(JXG$1.Complex.prototype,{toString:function(){return this.real+" + "+this.imaginary+"i"},add:function(n){return JXG$1.isNumber(n)?this.real+=n:(this.real+=n.real,this.imaginary+=n.imaginary),this},sub:function(n){return JXG$1.isNumber(n)?this.real-=n:(this.real-=n.real,this.imaginary-=n.imaginary),this},mult:function(n){var t,o;return JXG$1.isNumber(n)?(this.real*=n,this.imaginary*=n):(t=this.real,o=this.imaginary,this.real=t*n.real-o*n.imaginary,this.imaginary=t*n.imaginary+o*n.real),this},div:function(n){var t,o,u;if(JXG$1.isNumber(n)){if(Math.abs(n)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;this.real/=n,this.imaginary/=n}else{if(Math.abs(n.real)<Math.eps&&Math.abs(n.imaginary)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;t=n.real*n.real+n.imaginary*n.imaginary,u=this.real,o=this.imaginary,this.real=(u*n.real+o*n.imaginary)/t,this.imaginary=(o*n.real-u*n.imaginary)/t}return this},conj:function(){return this.imaginary*=-1,this}});JXG$1.C={};JXG$1.C.add=function(n,t){var o=new JXG$1.Complex(n);return o.add(t),o};JXG$1.C.sub=function(n,t){var o=new JXG$1.Complex(n);return o.sub(t),o};JXG$1.C.mult=function(n,t){var o=new JXG$1.Complex(n);return o.mult(t),o};JXG$1.C.div=function(n,t){var o=new JXG$1.Complex(n);return o.div(t),o};JXG$1.C.conj=function(n){var t=new JXG$1.Complex(n);return t.conj(),t};JXG$1.C.abs=function(n){var t=new JXG$1.Complex(n);return t.conj(),t.mult(n),Math.sqrt(t.real)};JXG$1.C.copy=function(n){return new JXG$1.Complex(n)};JXG$1.Complex.C=JXG$1.C;const Complex=JXG$1.Complex;var simpleColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},colorDefs=[{re:/^\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d.]{1,3})\s*\)\s*$/,example:["rgba(123, 234, 45, 0.5)","rgba(255,234,245,1.0)"],process:function(n){return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}},{re:/^\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(n){return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(n){return[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(n){return[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]}}];JXG$1.rgbParser=function(n,t,o){var u,d,C,I,f,A,y,G,S,w=n,M;if(!JXG$1.exists(n))return[];if(JXG$1.exists(t)&&JXG$1.exists(o)&&(w=[n,t,o]),u=w,M=!1,JXG$1.isArray(u)){for(A=0;A<3;A++)M=M||/\./.test(w[A].toString());for(A=0;A<3;A++)M=M&&w[A]>=0&&w[A]<=1;return M?[Math.ceil(w[0]*255),Math.ceil(w[1]*255),Math.ceil(w[2]*255)]:w}for(typeof w=="string"&&(u=w),u.charAt(0)==="#"&&(u=u.slice(1,7)),u=u.replace(/ /g,"").toLowerCase(),u=simpleColors[u]||u,A=0;A<colorDefs.length;A++)C=colorDefs[A].re,I=colorDefs[A].process,f=C.exec(u),f&&(d=I(f),y=d[0],G=d[1],S=d[2]);return isNaN(y)||isNaN(G)||isNaN(S)?[]:(y=y<0||isNaN(y)?0:y>255?255:y,G=G<0||isNaN(G)?0:G>255?255:G,S=S<0||isNaN(S)?0:S>255?255:S,[y,G,S])};JXG$1.isColor=function(n){var t=new Option().style;return t.color=n,t.color!==""};JXG$1.rgb2css=function(n,t,o){var u;return u=JXG$1.rgbParser(n,t,o),"rgb("+u[0]+", "+u[1]+", "+u[2]+")"};JXG$1.rgb2hex=function(n,t,o){var u,d,C;return u=JXG$1.rgbParser(n,t,o),d=u[1],C=u[2],u=u[0],u=u.toString(16),d=d.toString(16),C=C.toString(16),u.length===1&&(u="0"+u),d.length===1&&(d="0"+d),C.length===1&&(C="0"+C),"#"+u+d+C};JXG$1.hex2rgb=function(n){return JXG$1.deprecated("JXG.hex2rgb()","JXG.rgb2css()"),JXG$1.rgb2css(n)};JXG$1.hsv2rgb=function(n,t,o){var u,d,C,I,f,A,y,G,S;if(n=(n%360+360)%360,t===0)if(isNaN(n)||n<Mat.eps)u=o,d=o,C=o;else return"#ffffff";else switch(n>=360?A=0:A=n,A=A/60,f=Math.floor(A),I=A-f,y=o*(1-t),G=o*(1-t*I),S=o*(1-t*(1-I)),f){case 0:u=o,d=S,C=y;break;case 1:u=G,d=o,C=y;break;case 2:u=y,d=o,C=S;break;case 3:u=y,d=G,C=o;break;case 4:u=S,d=y,C=o;break;case 5:u=o,d=y,C=G;break}return u=Math.round(u*255).toString(16),u=u.length===2?u:u.length===1?"0"+u:"00",d=Math.round(d*255).toString(16),d=d.length===2?d:d.length===1?"0"+d:"00",C=Math.round(C*255).toString(16),C=C.length===2?C:C.length===1?"0"+C:"00",["#",u,d,C].join("")};JXG$1.rgb2hsv=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T;return u=JXG$1.rgbParser(n,t,o),d=u[1],C=u[2],u=u[0],I=u/255,f=d/255,A=C/255,V=Math.max(u,d,C),T=Math.min(u,d,C),y=V/255,G=T/255,M=y,w=0,M>0&&(w=(M-G)/M),S=1/(y-G),w>0&&(V===u?S=(f-A)*S:V===d?S=2+(A-I)*S:S=4+(I-f)*S),S*=60,S<0&&(S+=360),V===T&&(S=0),[S,w,M]};JXG$1.rgb2LMS=function(n,t,o){var u,d,C,I,f,A,y,G=[[.05059983,.08585369,.0095242],[.01893033,.08925308,.01370054],[.00292202,.00975732,.07145979]];return u=JXG$1.rgbParser(n,t,o),d=u[1],C=u[2],u=u[0],u=Math.pow(u,.476190476),d=Math.pow(d,.476190476),C=Math.pow(C,.476190476),I=u*G[0][0]+d*G[0][1]+C*G[0][2],f=u*G[1][0]+d*G[1][1]+C*G[1][2],A=u*G[2][0]+d*G[2][1]+C*G[2][2],y=[I,f,A],y.l=I,y.m=f,y.s=A,y};JXG$1.LMS2rgb=function(n,t,o){var u,d,C,I,f=[[30.830854,-29.832659,1.610474],[-6.481468,17.715578,-2.532642],[-.37569,-1.199062,14.273846]],A=function(y){for(var G=127,S=64;S>0;){if(Math.pow(G,.476190476)>y)G-=S;else{if(Math.pow(G+1,.476190476)>y)return G;G+=S}S/=2}return G===254&&13.994955247<y?255:G};return u=n*f[0][0]+t*f[0][1]+o*f[0][2],d=n*f[1][0]+t*f[1][1]+o*f[1][2],C=n*f[2][0]+t*f[2][1]+o*f[2][2],u=A(u),d=A(d),C=A(C),I=[u,d,C],I.r=u,I.g=d,I.b=C,I};JXG$1.rgba2rgbo=function(n){var t;return n.length===9&&n.charAt(0)==="#"?(t=parseInt(n.slice(7,9).toUpperCase(),16)/255,n=n.slice(0,7)):t=1,[n,t]};JXG$1.rgbo2rgba=function(n,t){var o;return n==="none"||n==="transparent"?n:(o=Math.round(t*255).toString(16),o.length===1&&(o="0"+o),JXG$1.rgb2hex(n)+o)};JXG$1.rgb2bw=function(n){var t,o,u,d="0123456789ABCDEF";return n==="none"||(u=JXG$1.rgbParser(n),t=Math.floor(.3*u[0]+.59*u[1]+.11*u[2]),o=d.charAt(t>>4&15)+d.charAt(t&15),n="#"+o+o+o),n};JXG$1.rgb2cb=function(n,t){var o,u,d,C,I,f,A,y,G,S,w,M,V,T="0123456789ABCDEF";if(n==="none")return n;switch(I=JXG$1.rgb2LMS(n),u=I[0],d=I[1],C=I[2],t=t.toLowerCase(),t){case"protanopia":A=-.06150039994295001,y=.08277001656812001,G=-.013200141220000003,S=.05858939668799999,w=-.07934519995360001,M=.013289415272000003,V=.6903216543277437,f=C/d,f<V?u=-(y*d+G*C)/A:u=-(w*d+M*C)/S;break;case"tritanopia":A=-.00058973116217,y=.007690316482,G=-.01011703519052,S=.025495080838999994,w=-.0422740347,M=.017005316784,V=.8349489908460004,f=d/u,f<V?C=-(A*u+y*d)/G:C=-(S*u+w*d)/M;break;default:A=-.06150039994295001,y=.08277001656812001,G=-.013200141220000003,S=.05858939668799999,w=-.07934519995360001,M=.013289415272000003,V=.5763833686400911,f=C/u,f<V?d=-(A*u+G*C)/y:d=-(S*u+M*C)/w;break}return o=JXG$1.LMS2rgb(u,d,C),f=T.charAt(o[0]>>4&15)+T.charAt(o[0]&15),n="#"+f,f=T.charAt(o[1]>>4&15)+T.charAt(o[1]&15),n+=f,f=T.charAt(o[2]>>4&15)+T.charAt(o[2]&15),n+=f,n};JXG$1.shadeColor=function(n,t){var o=JXG$1.rgbParser(n),u=o[0],d=o[1],C=o[2];return u=parseInt(u+255*t),d=parseInt(d+255*t),C=parseInt(C+255*t),u=u>0?u:0,d=d>0?d:0,C=C>0?C:0,u=u<255?u:255,d=d<255?d:255,C=C<255?C:255,u=Math.round(u),d=Math.round(d),C=Math.round(C),JXG$1.rgb2hex([u,d,C])};JXG$1.lightenColor=function(n,t){return JXG$1.shadeColor(n,t)};JXG$1.darkenColor=function(n,t){return JXG$1.shadeColor(n,-1*t)};JXG$1.autoHighlight=function(n){var t=JXG$1.rgba2rgbo(n),o=t[0],u=t[1];return n.charAt(0)==="#"?(u<.3?u*=1.8:u*=.4,JXG$1.rgbo2rgba(o,u)):n};JXG$1.contrast=function(n,t,o,u){var d,C="#000000",I,f,A,y;return t=t||"#000000",o=o||"#ffffff",u=u||7,d=JXG$1.rgbParser(n),I=JXG$1.rgbParser(C),f=.2126*Math.pow(d[0]/255,2.2)+.7152*Math.pow(d[1]/255,2.2)+.0722*Math.pow(d[2]/255,2.2),A=.2126*Math.pow(I[0]/255,2.2)+.7152*Math.pow(I[1]/255,2.2)+.0722*Math.pow(I[2]/255,2.2),f>A?y=Math.floor((f+.05)/(A+.05)):y=Math.floor((A+.05)/(f+.05)),y=y-1,y>u?t:o};JXG$1.setClassicColors=function(){JXG$1.Options.elements.strokeColor="blue",JXG$1.Options.elements.fillColor="red",JXG$1.Options.hatch.strokeColor="blue",JXG$1.Options.angle.fillColor="#ff7f00",JXG$1.Options.angle.highlightFillColor="#ff7f00",JXG$1.Options.angle.strokeColor="#ff7f00",JXG$1.Options.angle.label.strokeColor="blue",JXG$1.Options.arc.strokeColor="blue",JXG$1.Options.circle.center.fillColor="red",JXG$1.Options.circle.center.strokeColor="blue",JXG$1.Options.circumcircle.strokeColor="blue",JXG$1.Options.circumcircle.center.fillColor="red",JXG$1.Options.circumcircle.center.strokeColor="blue",JXG$1.Options.circumcirclearc.strokeColor="blue",JXG$1.Options.circumcirclesector.strokeColor="blue",JXG$1.Options.circumcirclesector.fillColor="green",JXG$1.Options.circumcirclesector.highlightFillColor="green",JXG$1.Options.conic.strokeColor="blue",JXG$1.Options.curve.strokeColor="blue",JXG$1.Options.incircle.strokeColor="blue",JXG$1.Options.incircle.center.fillColor="red",JXG$1.Options.incircle.center.strokeColor="blue",JXG$1.Options.inequality.fillColor="red",JXG$1.Options.integral.fillColor="red",JXG$1.Options.integral.curveLeft.color="red",JXG$1.Options.integral.curveRight.color="red",JXG$1.Options.line.strokeColor="blue",JXG$1.Options.point.fillColor="red",JXG$1.Options.point.strokeColor="red",JXG$1.Options.polygon.fillColor="green",JXG$1.Options.polygon.highlightFillColor="green",JXG$1.Options.polygon.vertices.strokeColor="red",JXG$1.Options.polygon.vertices.fillColor="red",JXG$1.Options.regularpolygon.fillColor="green",JXG$1.Options.regularpolygon.highlightFillColor="green",JXG$1.Options.regularpolygon.vertices.strokeColor="red",JXG$1.Options.regularpolygon.vertices.fillColor="red",JXG$1.Options.riemannsum.fillColor="yellow",JXG$1.Options.sector.fillColor="green",JXG$1.Options.sector.highlightFillColor="green",JXG$1.Options.semicircle.center.fillColor="red",JXG$1.Options.semicircle.center.strokeColor="blue",JXG$1.Options.slopetriangle.fillColor="red",JXG$1.Options.slopetriangle.highlightFillColor="red",JXG$1.Options.turtle.arrow.strokeColor="blue"};JXG$1.extend(JXG$1,{paletteWong:{black:"#000000",orange:"#E69F00",skyblue:"#56B4E9",bluishgreen:"#009E73",yellow:"#F0E442",darkblue:"#0072B2",vermillion:"#D55E00",reddishpurple:"#CC79A7",blue:"#0072B2",red:"#D55E00",green:"#009E73",purple:"#CC79A7",white:"#ffffff"}});JXG$1.palette=JXG$1.paletteWong;JXG$1.Options={jc:{enabled:!0,compile:!0},board:{animationDelay:35,axis:!1,boundingBox:[-5,5,5,-5],browserPan:!1,clickDelay:600,dblClickSuppressClick:!1,defaultAxes:{x:{name:"x",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"middle",anchorY:"top",fontSize:12,offset:[0,-3]},tickEndings:[0,1],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}},y:{name:"y",fixed:!0,ticks:{label:{visible:"inherit",anchorX:"right",anchorY:"middle",fontSize:12,offset:[-6,0]},tickEndings:[1,0],majorTickEndings:[1,1],drawZero:!1,needsRegularUpdate:!1,visible:"inherit"}}},description:"",document:!1,drag:{enabled:!0},fullscreen:{symbol:'<svg height="1em" width="1em" version="1.1" viewBox="10 10 18 18"><path fill="#666" d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path><path fill="#666" d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path><path fill="#666" d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path><path fill="#666" d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',scale:.85,id:null},ignoreLabels:!0,intl:{enabled:!1},keepAspectRatio:!1,keyboard:{enabled:!0,dx:10,dy:10,panShift:!0,panCtrl:!1},logging:{enabled:!1},minimizeReflow:"none",maxBoundingBox:[-1/0,1/0,1/0,-1/0],maxFrameRate:40,maxNameLength:1,moveTarget:null,offsetX:0,offsetY:0,pan:{enabled:!0,needShift:!0,needTwoFingers:!1},registerEvents:!0,renderer:"auto",resize:{enabled:!0,throttle:10},screenshot:{scale:1,type:"png",symbol:"⌘",css:"background-color:#eeeeee; opacity:1.0; border:2px solid black; border-radius:10px; text-align:center",cssButton:"padding: 4px 10px; border: solid #356AA0 1px; border-radius: 5px; position: absolute; right: 2ex; top: 2ex; background-color: rgba(255, 255, 255, 0.3);"},selection:{enabled:!1,name:"selectionPolygon",needShift:!1,needCtrl:!0,fillColor:"#ffff00",visible:!1,withLines:!1,vertices:{visible:!1}},showClearTraces:!1,showCopyright:!0,showFullscreen:!1,showInfobox:!0,showNavigation:!0,showReload:!1,showScreenshot:!1,showZoom:!0,takeFirst:!1,takeSizeFromFile:!1,theme:"default",title:"",viewport:[0,0,0,0],zoom:{enabled:!0,factorX:1.25,factorY:1.25,wheel:!0,needShift:!0,center:"auto",min:1e-4,max:1e4,pinch:!0,pinchHorizontal:!0,pinchVertical:!0,pinchSensitivity:7},zoomX:1,zoomY:1},navbar:{strokeColor:"#333333",fillColor:"transparent",highlightFillColor:"#aaaaaa",padding:"2px",position:"absolute",fontSize:"14px",cursor:"pointer",zIndex:"100",right:"5px",bottom:"5px"},elements:{dash:0,dashScale:!1,draft:{draft:!1,strokeColor:"#565656",fillColor:"#565656",strokeOpacity:.8,fillOpacity:.8,strokeWidth:1},dragToTopOfLayer:!1,fillColor:JXG$1.palette.red,fillOpacity:1,fixed:!1,frozen:!1,gradient:null,gradientAngle:0,gradientCX:.5,gradientCY:.5,gradientEndOffset:1,gradientFX:.5,gradientFY:.5,gradientFR:0,gradientR:.5,gradientSecondColor:"#ffffff",gradientSecondOpacity:1,gradientStartOffset:0,highlight:!0,highlightFillColor:"none",highlightFillOpacity:1,highlightStrokeColor:"#c3d9ff",highlightStrokeOpacity:1,highlightStrokeWidth:2,isLabel:!1,layer:0,lineCap:"butt",needsRegularUpdate:!0,nonnegativeOnly:!1,precision:"inherit",priv:!1,rotatable:!0,scalable:!0,shadow:{enabled:!1,color:[0,0,0],opacity:1,blur:3,blend:.1,offset:[5,5]},snapToGrid:!1,strokeColor:JXG$1.palette.blue,strokeOpacity:1,strokeWidth:2,tabindex:0,trace:!1,traceAttributes:{},transitionDuration:100,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width"],visible:!0,viewport:"inherit",withLabel:!1},ticks:{generateLabelText:null,generateLabelValue:null,drawLabels:!1,label:{},beautifulScientificTickLabels:!1,useUnicodeMinus:!0,anchor:"left",drawZero:!1,insertTicks:!1,minTicksDistance:10,minorHeight:4,majorHeight:10,tickEndings:[1,1],majorTickEndings:[1,1],ignoreInfiniteTickEndings:!0,minorTicks:4,ticksPerLabel:!1,scale:1,scaleSymbol:"",labels:[],maxLabelLength:5,precision:3,digits:3,ticksDistance:1,face:"|",strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"none",highlightFillColor:"none",visible:"inherit",includeBoundaries:!1,type:"linear",intl:{enabled:"inherit",options:{}},minorTicksInArrow:!1,majorTicksInArrow:!0,labelInArrow:!0,minorTicksInMargin:!1,majorTicksInMargin:!0,labelInMargin:!0},hatch:{drawLabels:!1,drawZero:!0,majorHeight:20,anchor:"middle",face:"|",strokeWidth:2,strokeColor:JXG$1.palette.blue,ticksDistance:.2},precision:{touch:30,touchMax:100,mouse:4,pen:4,epsilon:1e-4,hasPoint:4},layer:{numlayers:20,unused9:19,unused8:18,unused7:17,unused6:16,unused5:15,unused4:14,unused3:13,unused2:12,unused1:11,unused0:10,text:9,point:9,glider:9,arc:8,line:7,circle:6,curve:5,turtle:5,polygon:3,sector:3,angle:3,integral:3,axis:2,ticks:2,grid:1,image:0,trace:0},angle:{withLabel:!0,radius:"auto",type:"sector",orthoType:"square",orthoSensitivity:1,fillColor:JXG$1.palette.orange,highlightFillColor:JXG$1.palette.orange,strokeColor:JXG$1.palette.orange,fillOpacity:.3,highlightFillOpacity:.3,radiuspoint:{withLabel:!1,visible:!1,name:""},pointsquare:{withLabel:!1,visible:!1,name:""},dot:{visible:!1,strokeColor:"none",fillColor:"#000000",size:2,face:"o",withLabel:!1,name:""},label:{position:"top",offset:[0,0],strokeColor:JXG$1.palette.blue},arc:{visible:!1,fillColor:"none"}},arc:{selection:"auto",hasInnerPoints:!1,label:{anchorX:"auto",anchorY:"auto"},firstArrow:!1,lastArrow:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",useDirection:!1,center:{},radiusPoint:{},anglePoint:{}},arrow:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},arrowparallel:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},axis:{name:"",needsRegularUpdate:!1,strokeWidth:1,lastArrow:{type:1,highlightSize:8,size:8},strokeColor:"#666666",highlightStrokeWidth:1,highlightStrokeColor:"#888888",position:"static",anchor:"",anchorDist:"10%",ticksAutoPos:!1,ticksAutoPosThreshold:"5%",withTicks:!0,straightFirst:!0,straightLast:!0,margin:-4,withLabel:!1,scalable:!1,ticks:{label:{offset:[4,-9],parse:!1,needsRegularUpdate:!1,display:"internal",visible:"inherit",layer:9},visible:"inherit",needsRegularUpdate:!1,strokeWidth:1,strokeColor:"#666666",highlightStrokeColor:"#888888",drawLabels:!0,drawZero:!1,insertTicks:!0,minTicksDistance:5,minorHeight:10,majorHeight:-1,tickEndings:[0,1],majorTickEndings:[1,1],minorTicks:4,ticksDistance:1,strokeOpacity:.25},point1:{needsRegularUpdate:!1,visible:!1},point2:{needsRegularUpdate:!1,visible:!1},tabindex:-1,label:{position:"lft",offset:[10,10]}},bisector:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},bisectorlines:{line1:{strokeColor:"#000000"},line2:{strokeColor:"#000000"}},boxplot:{dir:"vertical",smallWidth:.5,strokeWidth:2,strokeColor:JXG$1.palette.blue,fillColor:JXG$1.palette.blue,fillOpacity:.2,highlightStrokeWidth:2,highlightStrokeColor:JXG$1.palette.blue,highlightFillColor:JXG$1.palette.blue,highlightFillOpacity:.1},button:{disabled:!1,display:"html"},cardinalspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.05,fillOpacity:.05,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},chart:{chartStyle:"line",colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],highlightcolors:null,fillcolor:null,highlightonsector:!1,highlightbysize:!1,fillOpacity:.6,withLines:!1,label:{}},checkbox:{disabled:!1,checked:!1,display:"html"},circle:{hasInnerPoints:!1,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},label:{position:"urt"}},circumcircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},circumcirclearc:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,name:""}},circumcirclesector:{useDirection:!0,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},comb:{frequency:.2,width:.4,angle:Math.PI/3,reverse:!1,point1:{visible:!1,withLabel:!1,fixed:!1,name:""},point2:{visible:!1,withLabel:!1,fixed:!1,name:""},strokeWidth:1,strokeColor:"#0000ff",fillColor:"none"},conic:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",foci:{fixed:!1,visible:!1,withLabel:!1,name:""},center:{visible:!1,withLabel:!1,name:""},point:{withLabel:!1,name:""},line:{visible:!1}},curve:{strokeWidth:1,strokeColor:JXG$1.palette.blue,fillColor:"none",fixed:!0,curveType:null,doAdvancedPlot:!0,doAdvancedPlotOld:!1,firstArrow:!1,handDrawing:!1,label:{position:"lft"},lastArrow:!1,lineCap:"round",numberPointsHigh:1600,numberPointsLow:400,plotVersion:2,recursionDepthHigh:17,recursionDepthLow:15},foreignobject:{fixed:!0,visible:!0,needsRegularUpdate:!1,attractors:[]},functiongraph:{},glider:{label:{}},grid:{needsRegularUpdate:!1,hasGrid:!1,highlight:!1,gridX:null,gridY:null,majorStep:"auto",minorElements:0,forceSquare:!1,includeBoundaries:!1,size:void 0,face:void 0,margin:void 0,drawZero:void 0,polygonVertices:void 0,major:{size:5,face:"line",margin:0,drawZero:!0,polygonVertices:6},minor:{visible:"inherit",size:3,face:"point",margin:0,drawZero:!0,polygonVertices:6},snapToGrid:!1,strokeColor:"#c0c0c0",strokeWidth:1,strokeOpacity:.5,dash:0,theme:0,themes:[{},{forceSquare:"min",major:{face:"line"}},{major:{face:"line"},minor:{size:3,face:"point"},minorElements:"auto"},{major:{face:"line"},minor:{face:"line",strokeOpacity:.25},minorElements:"auto"},{major:{face:"line"},minor:{face:"+",size:"95%"},minorElements:"auto"},{major:{face:"+",size:10,strokeOpacity:1},minor:{face:"point",size:3},minorElements:"auto"},{major:{face:"circle",size:8,fillColor:"#c0c0c0"},minor:{face:"point",size:3},minorElements:"auto"}]},group:{needsRegularUpdate:!0},htmlslider:{widthRange:100,widthOut:34,step:.01,frozen:!0,isLabel:!1,strokeColor:"#000000",display:"html",anchorX:"left",anchorY:"middle",withLabel:!1},image:{imageString:null,fillOpacity:1,highlightFillOpacity:.6,cssClass:"JXGimage",highlightCssClass:"JXGimageHighlight",rotate:0,snapSizeX:1,snapSizeY:1,attractors:[]},implicitcurve:{margin:1,resolution_outer:5,resolution_inner:5,max_steps:1024,alpha_0:.05,tol_u0:Mat.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0},incircle:{fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},inequality:{fillColor:JXG$1.palette.red,fillOpacity:.2,strokeColor:"none",inverse:!1},infobox:{distanceX:-20,distanceY:25,intl:{enabled:"inherit",options:{}},fontSize:12,isLabel:!1,strokeColor:"#bbbbbb",display:"html",anchorX:"left",anchorY:"middle",cssClass:"JXGinfobox",rotate:0,visible:!0,parse:!1,transitionDuration:0,needsRegularUpdate:!1,tabindex:null,viewport:[0,0,0,0]},integral:{axis:"x",withLabel:!0,fixed:!0,strokeWidth:0,strokeOpacity:0,fillColor:JXG$1.palette.red,fillOpacity:.3,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.2,curveLeft:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseLeft:{visible:!1,fixed:!1,withLabel:!1,name:""},curveRight:{visible:!0,withLabel:!1,color:JXG$1.palette.red,fillOpacity:.8,layer:9},baseRight:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{fontSize:20,digits:4,intl:{enabled:!1,options:{}}}},input:{disabled:!1,maxlength:524288,display:"html"},intersection:{alwaysIntersect:!0},label:{visible:"inherit",strokeColor:"#000000",strokeOpacity:1,highlightStrokeOpacity:.666666,highlightStrokeColor:"#000000",fixed:!0,position:"urt",distance:1.5,offset:[10,10],autoPosition:!1,autoPositionMinDistance:12,autoPositionMaxDistance:28,autoPositionWhitelist:[]},legend:{style:"vertical",labels:["1","2","3","4","5","6","7","8"],colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],rowHeight:20,strokeWidth:5},line:{firstArrow:!1,lastArrow:!1,margin:0,straightFirst:!0,straightLast:!0,fillColor:"none",highlightFillColor:"none",strokeColor:JXG$1.palette.blue,highlightStrokeColor:"#c3d9ff",withTicks:!1,point1:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},point2:{fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},ticks:{drawLabels:!0,label:{offset:[4,-9]},drawZero:!1,insertTicks:!1,ticksDistance:1,minTicksDistance:50,minorHeight:4,majorHeight:-1,minorTicks:4,strokeOpacity:.3,visible:"inherit"},label:{position:"llft"},snapToGrid:!1,snapSizeX:1,snapSizeY:1,touchFirstPoint:!1,touchLastPoint:!1},locus:{translateToOrigin:!1,translateTo10:!1,stretch:!1,toOrigin:null,to10:null},measurement:{baseUnit:"",units:{},dim:null,showPrefix:!0,showSuffix:!0,prefix:"",suffix:"",formatPrefix:function(n){return n},formatSuffix:function(n){return n},formatCoords:function(n,t,o){return parseFloat(o)!==1?"(NaN | NaN)":"("+n+", "+t+")"},formatDirection:function(n,t){return"("+n+", "+t+")"}},metapostspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.5,fillOpacity:.5,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},mirrorelement:{fixed:!0,point:{},center:{},type:"Euclidean"},nonreflexangle:{},normal:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},orthogonalprojection:{},otherintersection:{alwaysIntersect:!0,precision:.001},parallel:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{position:"llft"}},parallelogram:{parallelpoint:{withLabel:!1,name:""}},parallelpoint:{},perpendicular:{strokeColor:"#000000",straightFirst:!0,straightLast:!0},perpendicularsegment:{strokeColor:"#000000",straightFirst:!1,straightLast:!1,point:{visible:!1,fixed:!0,withLabel:!1,name:""}},point:{withLabel:!0,label:{},style:5,face:"o",size:3,sizeUnit:"screen",strokeWidth:2,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width","width","height","rx","ry"],fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",zoom:!1,showInfobox:"inherit",infoboxDigits:"auto",draft:!1,attractors:[],attractorUnit:"user",attractorDistance:0,snatchDistance:0,snapToGrid:!1,attractToGrid:!1,snapSizeX:1,snapSizeY:1,snapToPoints:!1,ignoredSnapToPoints:[]},polygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"},visible:"inherit"},highlightByStrokeWidth:!1,vertices:{layer:9,withLabel:!1,name:"",strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1,visible:"inherit"},label:{offset:[0,0]}},polygonalchain:{fillColor:"none",highlightFillColor:"none"},prescribedangle:{anglePoint:{size:2,visible:!1,withLabel:!1}},reflection:{fixed:!0,center:{},type:"Euclidean"},reflexangle:{},regularpolygon:{hasInnerPoints:!1,fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"}},vertices:{layer:9,withLabel:!0,strokeColor:JXG$1.palette.red,fillColor:JXG$1.palette.red,fixed:!1},label:{offset:[0,0]}},riemannsum:{withLabel:!1,fillOpacity:.3,fillColor:JXG$1.palette.yellow},sector:{fillColor:JXG$1.palette.yellow,highlightFillColor:JXG$1.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,highlightOnSector:!1,highlightStrokeWidth:0,selection:"auto",arc:{visible:!1,fillColor:"none",withLabel:!1,name:"",center:{visible:!1,withLabel:!1,name:""},radiusPoint:{visible:!1,withLabel:!1,name:""},anglePoint:{visible:!1,withLabel:!1,name:""}},radiusPoint:{visible:!1,withLabel:!1},center:{visible:!1,withLabel:!1},anglePoint:{visible:!1,withLabel:!1},label:{offset:[0,0],anchorX:"auto",anchorY:"auto"}},segment:{label:{position:"top"}},semicircle:{center:{visible:!1,withLabel:!1,fixed:!1,fillColor:JXG$1.palette.red,strokeColor:JXG$1.palette.red,highlightFillColor:"#eeeeee",highlightStrokeColor:JXG$1.palette.red,name:""}},slider:{snapWidth:-1,snapValues:[],snapValueDistance:0,precision:2,digits:2,intl:{enabled:"inherit",options:{}},firstArrow:!1,lastArrow:!1,withTicks:!0,withLabel:!0,suffixLabel:null,unitLabel:null,postLabel:null,layer:9,showInfobox:!1,name:"",visible:!0,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"#ffffff",highlightFillColor:"none",size:6,point1:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},point2:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},baseline:{needsRegularUpdate:!1,visible:"inherit",fixed:!0,scalable:!1,tabindex:null,name:"",strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888"},ticks:{needsRegularUpdate:!1,fixed:!0,drawLabels:!1,digits:2,includeBoundaries:!0,drawZero:!0,label:{offset:[-4,-14],display:"internal"},minTicksDistance:30,insertTicks:!0,ticksDistance:1,minorHeight:4,majorHeight:5,minorTicks:0,strokeOpacity:1,strokeWidth:1,tickEndings:[0,1],majortickEndings:[0,1],strokeColor:"#000000",visible:"inherit"},highline:{strokeWidth:3,visible:"inherit",fixed:!0,tabindex:null,name:"",strokeColor:"#000000",highlightStrokeColor:"#888888"},label:{visible:"inherit",strokeColor:"#000000"},moveOnUp:!0},slopefield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!1,size:5,angle:Math.PI*.125}},slopetriangle:{fillColor:JXG$1.palette.red,fillOpacity:.4,highlightFillColor:JXG$1.palette.red,highlightFillOpacity:.3,borders:{lastArrow:{type:1,size:6}},glider:{fixed:!0,visible:!1,withLabel:!1},baseline:{visible:!1,withLabel:!1,name:""},basepoint:{visible:!1,withLabel:!1,name:""},tangent:{visible:!1,withLabel:!1,name:""},toppoint:{visible:!1,withLabel:!1,name:""},label:{visible:!0,position:"first"}},smartlabelangle:{cssClass:"smart-label-solid smart-label-angle",highlightCssClass:"smart-label-solid smart-label-angle",anchorX:"left",anchorY:"middle",unit:"",prefix:"",suffix:"",measure:"deg",useMathJax:!0},smartlabelcircle:{cssClass:"smart-label-solid smart-label-circle",highlightCssClass:"smart-label-solid smart-label-circle",anchorX:"middle",useMathJax:!0,unit:"",prefix:"",suffix:"",measure:"radius"},smartlabelline:{cssClass:"smart-label-solid smart-label-line",highlightCssClass:"smart-label-solid smart-label-line",anchorX:"middle",useMathJax:!0,unit:"",measure:"length"},smartlabelpoint:{cssClass:"smart-label-solid smart-label-point",highlightCssClass:"smart-label-solid smart-label-point",anchorX:"middle",anchorY:"top",useMathJax:!0,dir:"row",unit:""},smartlabelpolygon:{cssClass:"smart-label-solid smart-label-polygon",highlightCssClass:"smart-label-solid smart-label-polygon",anchorX:"middle",useMathJax:!0,unit:"",measure:"area"},stepfunction:{},tangent:{},tangentto:{polar:{visible:!1,strokeWidth:1,dash:3},point:{visible:!1}},tapemeasure:{strokeColor:"#000000",strokeWidth:2,highlightStrokeColor:"#000000",withTicks:!0,withLabel:!0,rotate:0,precision:2,digits:2,point1:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},point2:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},ticks:{drawLabels:!1,drawZero:!0,insertTicks:!0,ticksDistance:.1,minorHeight:8,majorHeight:16,minorTicks:4,tickEndings:[0,1],majorTickEndings:[0,1],strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",visible:"inherit",label:{anchorY:"top",anchorX:"middle",offset:[0,-10]}},label:{position:"top"}},text:{fontSize:12,fontUnit:"px",formatNumber:!1,digits:2,intl:{enabled:"inherit",options:{minimumFractionDigits:0,maximumFractionDigits:2}},parse:!0,useCaja:!1,isLabel:!1,strokeColor:"#000000",highlightStrokeColor:"#000000",highlightStrokeOpacity:.666666,cssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",highlightCssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",cssStyle:"",highlightCssStyle:"",transitionProperties:["color","opacity"],useASCIIMathML:!1,useMathJax:!1,useKatex:!1,katexMacros:{},toFraction:!1,display:"html",anchor:null,anchorX:"left",anchorY:"middle",cssClass:"JXGtext",highlightCssClass:"JXGtext",dragArea:"all",withLabel:!1,rotate:0,visible:!0,snapSizeX:1,snapSizeY:1,attractors:[]},tracecurve:{strokeColor:"#000000",fillColor:"none",numberPoints:100},turtle:{strokeWidth:1,fillColor:"none",strokeColor:"#000000",arrow:{strokeWidth:2,withLabel:!1,strokeColor:JXG$1.palette.red,lastArrow:!0}},vectorfield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:JXG$1.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},shortcuts:{color:["strokeColor","fillColor"],opacity:["strokeOpacity","fillOpacity"],highlightColor:["highlightStrokeColor","highlightFillColor"],highlightOpacity:["highlightStrokeOpacity","highlightFillOpacity"],strokeWidth:["strokeWidth","highlightStrokeWidth"]}};JXG$1.Validator=function(){var n,t=function(M){return/^[0-9]+px$/.test(M)},o=function(M){return M==="html"||M==="internal"},u=function(M){return JXG$1.isString(M)},d=function(M){return JXG$1.exists(JXG$1.normalizePointFace(M))},C=function(M){return Math.abs(M-Math.round(M))<Mat.eps},I=function(M){return C(M)&&M>=0},f=function(M){return C(M)&&M>0},A=function(M){return M==="vml"||M==="svg"||M==="canvas"||M==="no"},y=function(M){return M>0},G=function(M){return M>=0},S={},w={attractorDistance:G,color:u,display:o,doAdvancedPlot:!1,draft:!1,drawLabels:!1,drawZero:!1,face:d,factor:JXG$1.isNumber,fillColor:u,fillOpacity:JXG$1.isNumber,firstArrow:!1,fontSize:C,dash:C,gridX:JXG$1.isNumber,gridY:JXG$1.isNumber,hasGrid:!1,highlightFillColor:u,highlightFillOpacity:JXG$1.isNumber,highlightStrokeColor:u,highlightStrokeOpacity:JXG$1.isNumber,insertTicks:!1,lastArrow:!1,layer:I,majorHeight:C,minorHeight:C,minorTicks:G,minTicksDistance:f,numberPointsHigh:f,numberPointsLow:f,opacity:JXG$1.isNumber,radius:JXG$1.isNumber,RDPsmoothing:!1,renderer:A,right:t,showCopyright:!1,showInfobox:!1,showNavigation:!1,size:G,snapSizeX:y,snapSizeY:y,snapWidth:JXG$1.isNumber,snapToGrid:!1,snatchDistance:G,straightFirst:!1,straightLast:!1,stretch:!1,strokeColor:u,strokeOpacity:JXG$1.isNumber,strokeWidth:G,takeFirst:!1,takeSizeFromFile:!1,to10:!1,toOrigin:!1,translateTo10:!1,translateToOrigin:!1,useASCIIMathML:!1,useDirection:!1,useMathJax:!1,withLabel:!1,withTicks:!1,zoom:!1};for(n in w)w.hasOwnProperty(n)&&(S[n.toLowerCase()]=w[n]);return S}();JXG$1.normalizePointFace=function(n){var t={cross:"x",x:"x",circle:"o",o:"o",square:"[]","[]":"[]",plus:"+","+":"+",divide:"|","|":"|",minus:"-","-":"-",diamond:"<>","<>":"<>",diamond2:"<<>>","<<>>":"<<>>",triangleup:"^",A:"^",a:"^","^":"^",triangledown:"v",v:"v",triangleleft:"<","<":"<",triangleright:">",">":">"};return t[n]};JXG$1.useStandardOptions=function(n){var t,o,u,d,C=JXG$1.Options,I=n.hasGrid;n.options.grid.hasGrid=C.grid.hasGrid,n.options.grid.gridX=C.grid.gridX,n.options.grid.gridY=C.grid.gridY,n.options.grid.gridColor=C.grid.gridColor,n.options.grid.gridOpacity=C.grid.gridOpacity,n.options.grid.gridDash=C.grid.gridDash,n.options.grid.snapToGrid=C.grid.snapToGrid,n.options.grid.snapSizeX=C.grid.SnapSizeX,n.options.grid.snapSizeY=C.grid.SnapSizeY,n.takeSizeFromFile=C.takeSizeFromFile,d=function(f,A){f.visProp.fillcolor=A.fillColor,f.visProp.highlightfillcolor=A.highlightFillColor,f.visProp.strokecolor=A.strokeColor,f.visProp.highlightstrokecolor=A.highlightStrokeColor};for(t in n.objects)if(n.objects.hasOwnProperty(t))if(u=n.objects[t],u.elementClass===Const.OBJECT_CLASS_POINT)d(u,C.point);else if(u.elementClass===Const.OBJECT_CLASS_LINE)for(d(u,C.line),o=0;o<u.ticks.length;o++)u.ticks[o].majorTicks=C.line.ticks.majorTicks,u.ticks[o].minTicksDistance=C.line.ticks.minTicksDistance,u.ticks[o].visProp.minorheight=C.line.ticks.minorHeight,u.ticks[o].visProp.majorheight=C.line.ticks.majorHeight;else u.elementClass===Const.OBJECT_CLASS_CIRCLE?d(u,C.circle):u.type===Const.OBJECT_TYPE_ANGLE?d(u,C.angle):u.type===Const.OBJECT_TYPE_ARC?d(u,C.arc):u.type===Const.OBJECT_TYPE_POLYGON?d(u,C.polygon):u.type===Const.OBJECT_TYPE_CONIC?d(u,C.conic):u.type===Const.OBJECT_TYPE_CURVE?d(u,C.curve):u.type===Const.OBJECT_TYPE_SECTOR&&(u.arc.visProp.fillcolor=C.sector.fillColor,u.arc.visProp.highlightfillcolor=C.sector.highlightFillColor,u.arc.visProp.fillopacity=C.sector.fillOpacity,u.arc.visProp.highlightfillopacity=C.sector.highlightFillOpacity);n.fullUpdate(),I&&!n.hasGrid?n.removeGrids(n):!I&&n.hasGrid&&n.create("grid",[])};JXG$1.useBlackWhiteOptions=function(n){var t=JXG$1.Options;t.point.fillColor=JXG$1.rgb2bw(t.point.fillColor),t.point.highlightFillColor=JXG$1.rgb2bw(t.point.highlightFillColor),t.point.strokeColor=JXG$1.rgb2bw(t.point.strokeColor),t.point.highlightStrokeColor=JXG$1.rgb2bw(t.point.highlightStrokeColor),t.line.fillColor=JXG$1.rgb2bw(t.line.fillColor),t.line.highlightFillColor=JXG$1.rgb2bw(t.line.highlightFillColor),t.line.strokeColor=JXG$1.rgb2bw(t.line.strokeColor),t.line.highlightStrokeColor=JXG$1.rgb2bw(t.line.highlightStrokeColor),t.circle.fillColor=JXG$1.rgb2bw(t.circle.fillColor),t.circle.highlightFillColor=JXG$1.rgb2bw(t.circle.highlightFillColor),t.circle.strokeColor=JXG$1.rgb2bw(t.circle.strokeColor),t.circle.highlightStrokeColor=JXG$1.rgb2bw(t.circle.highlightStrokeColor),t.arc.fillColor=JXG$1.rgb2bw(t.arc.fillColor),t.arc.highlightFillColor=JXG$1.rgb2bw(t.arc.highlightFillColor),t.arc.strokeColor=JXG$1.rgb2bw(t.arc.strokeColor),t.arc.highlightStrokeColor=JXG$1.rgb2bw(t.arc.highlightStrokeColor),t.polygon.fillColor=JXG$1.rgb2bw(t.polygon.fillColor),t.polygon.highlightFillColor=JXG$1.rgb2bw(t.polygon.highlightFillColor),t.sector.fillColor=JXG$1.rgb2bw(t.sector.fillColor),t.sector.highlightFillColor=JXG$1.rgb2bw(t.sector.highlightFillColor),t.curve.strokeColor=JXG$1.rgb2bw(t.curve.strokeColor),t.grid.gridColor=JXG$1.rgb2bw(t.grid.gridColor),JXG$1.useStandardOptions(n)};JXG$1.Options.normalizePointFace=JXG$1.normalizePointFace;const Options=JXG$1.Options;JXG$1.AbstractRenderer=function(){this.vOffsetText=0,this.enhancedRendering=!0,this.container=null,this.type="",this.supportsForeignObject=!1,this.dashArray=[[2,2],[5,5],[10,10],[20,20],[20,10,10,10],[20,5,10,5],[0,5]]};JXG$1.extend(JXG$1.AbstractRenderer.prototype,{_updateVisual:function(n,t,o){(o||this.enhancedRendering)&&(t=t||{},this.setObjectViewport(n),this.setObjectTransition(n),JXG$1.evaluate(n.visProp.draft)?this.setDraft(n):(t.stroke||(n.highlighted?(this.setObjectStrokeColor(n,n.visProp.highlightstrokecolor,n.visProp.highlightstrokeopacity),this.setObjectStrokeWidth(n,n.visProp.highlightstrokewidth)):(this.setObjectStrokeColor(n,n.visProp.strokecolor,n.visProp.strokeopacity),this.setObjectStrokeWidth(n,n.visProp.strokewidth))),t.fill||(n.highlighted?this.setObjectFillColor(n,n.visProp.highlightfillcolor,n.visProp.highlightfillopacity):this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity)),t.dash||this.setDashStyle(n,n.visProp),t.shadow||this.setShadow(n),t.tabindex||this.setTabindex(n)))},_getHighlighted:function(n){var t=!1,o;return(!JXG$1.exists(n.board)||!JXG$1.exists(n.board.highlightedObjects))&&(t=!0),!t&&JXG$1.exists(n.board.highlightedObjects[n.id])?o="highlight":o="",o},drawPoint:function(n){var t,o=Options.normalizePointFace(JXG$1.evaluate(n.visProp.face));o==="o"?t="ellipse":o==="[]"?t="rect":t="path",n.rendNode=this.appendChildPrim(this.createPrim(t,n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,t),this._updateVisual(n,{dash:!0,shadow:!0},!0),this.updatePoint(n)},updatePoint:function(n){var t=JXG$1.evaluate(n.visProp.size),o=Options.normalizePointFace(JXG$1.evaluate(n.visProp.face)),u=JXG$1.evaluate(n.visProp.sizeunit),d=JXG$1.evaluate(n.visProp.zoom),C;isNaN(n.coords.scrCoords[2]+n.coords.scrCoords[1])||(u==="user"&&(t*=Math.sqrt(Math.abs(n.board.unitX*n.board.unitY))),t*=!n.board||!d?1:Math.sqrt(n.board.zoomX*n.board.zoomY),C=t===0?0:t+1,o==="o"?this.updateEllipsePrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2],C,C):o==="[]"?this.updateRectPrim(n.rendNode,n.coords.scrCoords[1]-t,n.coords.scrCoords[2]-t,t*2,t*2):this.updatePathPrim(n.rendNode,this.updatePathStringPoint(n,t,o),n.board),this._updateVisual(n,{dash:!1,shadow:!1}),this.setShadow(n))},changePointStyle:function(n){var t=this.getElementById(n.id);JXG$1.exists(t)&&this.remove(t),this.drawPoint(n),JXG$1.clearVisPropOld(n),n.visPropCalc.visible||this.display(n,!1),JXG$1.evaluate(n.visProp.draft)&&this.setDraft(n)},drawLine:function(n){n.rendNode=this.appendChildPrim(this.createPrim("line",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"lines"),this.updateLine(n)},updateLine:function(n){this._updateVisual(n),this.updatePathWithArrowHeads(n),this.setLineCap(n)},drawCurve:function(n){n.rendNode=this.appendChildPrim(this.createPrim("path",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"path"),this.updateCurve(n)},updateCurve:function(n){this._updateVisual(n),this.updatePathWithArrowHeads(n),this.setLineCap(n)},updatePathWithArrowHeads:function(n,t){var o=n.visProp,u=t?"highlight":"",d,C;t&&o.highlightstrokewidth?d=Math.max(JXG$1.evaluate(o.highlightstrokewidth),JXG$1.evaluate(o.strokewidth)):d=JXG$1.evaluate(o.strokewidth),C=this.getArrowHeadData(n,d,u),this.makeArrows(n,C),n.elementClass===Const.OBJECT_CLASS_LINE?this.updateLineWithEndings(n,C):n.elementClass===Const.OBJECT_CLASS_CURVE&&this.updatePath(n),this.setArrowSize(n,C)},getArrowHeadData:function(n,t,o){var u=Mat.eps,d,C,I=0,f=0,A=0,y=0,G=JXG$1.evaluate(n.visProp.firstarrow),S=JXG$1.evaluate(n.visProp.lastarrow),w,M;return(G||S)&&(JXG$1.exists(G.type)?d=JXG$1.evaluate(G.type):n.elementClass===Const.OBJECT_CLASS_LINE?d=1:d=7,JXG$1.exists(S.type)?C=JXG$1.evaluate(S.type):n.elementClass===Const.OBJECT_CLASS_LINE?C=1:C=7,G&&(M=6,JXG$1.exists(G.size)&&(M=JXG$1.evaluate(G.size)),o!==""&&JXG$1.exists(G[o+"size"])&&(M=JXG$1.evaluate(G[o+"size"])),w=t*M,d===2?(w*=.5,u+=t*M):d===3?(w=t*M/3,u+=t):d===4||d===5||d===6?(w=t*M/1.5,u+=t*M):d===7?(w=0,M=10,u+=t):u+=t*M,I+=w,A=M),S&&(M=6,JXG$1.exists(S.size)&&(M=JXG$1.evaluate(S.size)),o!==""&&JXG$1.exists(S[o+"size"])&&(M=JXG$1.evaluate(S[o+"size"])),w=t*M,C===2?(w*=.5,u+=t*M):C===3?(w=t*M/3,u+=t):C===4||C===5||C===6?(w=t*M/1.5,u+=t*M):C===7?(w=0,M=10,u+=t):u+=t*M,f+=w,y=M)),n.visPropCalc.typeFirst=d,n.visPropCalc.typeLast=C,{evFirst:G,evLast:S,typeFirst:d,typeLast:C,offFirst:I,offLast:f,sizeFirst:A,sizeLast:y,showFirst:1,showLast:1,minLen:u,strokeWidth:t}},updateLineWithEndings:function(n,t){var o,u,d=null;return o=new Coords(Const.COORDS_BY_USER,n.point1.coords.usrCoords,n.board),u=new Coords(Const.COORDS_BY_USER,n.point2.coords.usrCoords,n.board),d=JXG$1.evaluate(n.visProp.margin),Geometry.calcStraight(n,o,u,d),this.handleTouchpoints(n,o,u,t),this.getPositionArrowHead(n,o,u,t),this.updateLinePrim(n.rendNode,o.scrCoords[1],o.scrCoords[2],u.scrCoords[1],u.scrCoords[2],n.board),this},updatePath:function(n){return JXG$1.evaluate(n.visProp.handdrawing)?this.updatePathPrim(n.rendNode,this.updatePathStringBezierPrim(n),n.board):this.updatePathPrim(n.rendNode,this.updatePathStringPrim(n),n.board),this},getPositionArrowHead:function(n,t,o,u){var d,C,I,f,A;return(u.evFirst||u.evLast)&&(C=I=f=A=0,d=t.distance(Const.COORDS_BY_SCREEN,o),u.evFirst&&n.board.renderer.type!=="vml"&&(d>=u.minLen?(C=(o.scrCoords[1]-t.scrCoords[1])*u.offFirst/d,I=(o.scrCoords[2]-t.scrCoords[2])*u.offFirst/d):u.showFirst=0),u.evLast&&n.board.renderer.type!=="vml"&&(d>=u.minLen?(f=(o.scrCoords[1]-t.scrCoords[1])*u.offLast/d,A=(o.scrCoords[2]-t.scrCoords[2])*u.offLast/d):u.showLast=0),t.setCoordinates(Const.COORDS_BY_SCREEN,[t.scrCoords[1]+C,t.scrCoords[2]+I],!1,!0),o.setCoordinates(Const.COORDS_BY_SCREEN,[o.scrCoords[1]-f,o.scrCoords[2]-A],!1,!0)),this},handleTouchpoints:function(n,t,o,u){var d,C,I,f,A,y,G;return(u.evFirst||u.evLast)&&(I=f=A=y=G=0,d=JXG$1.evaluate(n.point1.visProp.size)+JXG$1.evaluate(n.point1.visProp.strokewidth),C=JXG$1.evaluate(n.point2.visProp.size)+JXG$1.evaluate(n.point2.visProp.strokewidth),u.evFirst&&JXG$1.evaluate(n.visProp.touchfirstpoint)&&JXG$1.evaluate(n.point1.visProp.visible)&&(I=t.distance(Const.COORDS_BY_SCREEN,o),f=(o.scrCoords[1]-t.scrCoords[1])*d/I,A=(o.scrCoords[2]-t.scrCoords[2])*d/I),u.evLast&&JXG$1.evaluate(n.visProp.touchlastpoint)&&JXG$1.evaluate(n.point2.visProp.visible)&&(I=t.distance(Const.COORDS_BY_SCREEN,o),y=(o.scrCoords[1]-t.scrCoords[1])*C/I,G=(o.scrCoords[2]-t.scrCoords[2])*C/I),t.setCoordinates(Const.COORDS_BY_SCREEN,[t.scrCoords[1]+f,t.scrCoords[2]+A],!1,!0),o.setCoordinates(Const.COORDS_BY_SCREEN,[o.scrCoords[1]-y,o.scrCoords[2]-G],!1,!0)),this},setArrowSize:function(n,t){return t.evFirst&&this._setArrowWidth(n.rendNodeTriangleStart,t.showFirst*t.strokeWidth,n.rendNode,t.sizeFirst),t.evLast&&this._setArrowWidth(n.rendNodeTriangleEnd,t.showLast*t.strokeWidth,n.rendNode,t.sizeLast),this},setLineCap:function(n){},drawTicks:function(n){n.rendNode=this.appendChildPrim(this.createPrim("path",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"path")},updateTicks:function(n){},drawEllipse:function(n){n.rendNode=this.appendChildPrim(this.createPrim("ellipse",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"ellipse"),this.updateEllipse(n)},updateEllipse:function(n){this._updateVisual(n);var t=n.Radius();Math.abs(n.center.coords.usrCoords[0])>Mat.eps&&!isNaN(t+n.center.coords.scrCoords[1]+n.center.coords.scrCoords[2])&&t*n.board.unitX<2e6&&this.updateEllipsePrim(n.rendNode,n.center.coords.scrCoords[1],n.center.coords.scrCoords[2],t*n.board.unitX,t*n.board.unitY),this.setLineCap(n)},drawPolygon:function(n){n.rendNode=this.appendChildPrim(this.createPrim("polygon",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"polygon"),this.updatePolygon(n)},updatePolygon:function(n){this._updateVisual(n,{stroke:!0,dash:!0}),this.updatePolygonPrim(n.rendNode,n)},displayCopyright:function(n,t){},drawInternalText:function(n){},updateInternalText:function(n){},drawText:function(n){var t,o,u,d;JXG$1.evaluate(n.visProp.display)==="html"&&JXG$1.isBrowser&&this.type!=="no"?(t=this.container.ownerDocument.createElement("div"),t.style.position="absolute",t.className=JXG$1.evaluate(n.visProp.cssclass),u=JXG$1.evaluate(n.visProp.layer),JXG$1.exists(u)||(u=0),this.container.style.zIndex===""?o=0:o=parseInt(this.container.style.zIndex,10),t.style.zIndex=o+u,this.container.appendChild(t),t.setAttribute("id",this.container.id+"_"+n.id)):t=this.drawInternalText(n),n.rendNode=t,n.htmlStr="",n.visProp.islabel&&JXG$1.exists(n.visProp.anchor)?(d=JXG$1.evaluate(n.visProp.anchor.visProp.visible),n.prepareUpdate().updateVisibility(d)):n.prepareUpdate().updateVisibility(),this.updateText(n)},updateText:function(n){var t=n.plaintext,o,u,d,C,I,f,A,y,G,S,w;if(n.visPropCalc.visible)if(this.updateTextStyle(n,!1),JXG$1.evaluate(n.visProp.display)==="html"&&this.type!=="no"){if(isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])||(u=n.coords.scrCoords[1],u=Math.abs(u)<1e6?u:1e6,I=n.getAnchorX(),I==="right"?(o=n.board.canvasWidth-u,S="right"):I==="middle"?(o=u-.5*n.size[0],S="center"):(o=u,S="left"),n.visPropOld.left!==I+o&&(I==="right"?(n.rendNode.style.right=o+"px",n.rendNode.style.left="auto"):(n.rendNode.style.left=o+"px",n.rendNode.style.right="auto"),n.visPropOld.left=I+o),u=n.coords.scrCoords[2]+this.vOffsetText,u=Math.abs(u)<1e6?u:1e6,f=n.getAnchorY(),f==="bottom"?(o=n.board.canvasHeight-u,w="bottom"):f==="middle"?(o=u-.5*n.size[1],w="center"):(o=u,w="top"),n.visPropOld.top!==f+o&&(f==="bottom"?(n.rendNode.style.top="auto",n.rendNode.style.bottom=o+"px"):(n.rendNode.style.bottom="auto",n.rendNode.style.top=o+"px"),n.visPropOld.top=f+o)),n.htmlStr!==t){try{n.type===JXG$1.OBJECT_TYPE_BUTTON?n.rendNodeButton.innerHTML=t:n.type===JXG$1.OBJECT_TYPE_CHECKBOX||n.type===JXG$1.OBJECT_TYPE_INPUT?n.rendNodeLabel.innerHTML=t:n.rendNode.innerHTML=t}catch{d=n.rendNode.parentNode,n.rendNode.parentNode.removeChild(n.rendNode),n.rendNode.innerHTML=t,d.appendChild(n.rendNode)}if(n.htmlStr=t,JXG$1.evaluate(n.visProp.usemathjax))try{MathJax.typeset?MathJax.typeset([n.rendNode]):MathJax.Hub.Queue(["Typeset",MathJax.Hub,n.rendNode])}catch{JXG$1.debug("MathJax (not yet) loaded")}else if(JXG$1.evaluate(n.visProp.usekatex))try{n.rendNode.innerHTML.indexOf("<span")===0&&n.rendNode.innerHTML.indexOf("<label")>0&&(n.rendNode.innerHTML.indexOf("<checkbox")>0||n.rendNode.innerHTML.indexOf("<input")>0)?C=n.rendNodeLabel:n.rendNode.innerHTML.indexOf("<button")===0?C=n.rendNodeButton:C=n.rendNode,C&&katex.render(t,C,{macros:JXG$1.evaluate(n.visProp.katexmacros),throwOnError:!1})}catch{JXG$1.debug("KaTeX not loaded (yet)")}else if(JXG$1.evaluate(n.visProp.useasciimathml))try{AMprocessNode(n.rendNode,!1)}catch{JXG$1.debug("AsciiMathML not loaded (yet)")}}A=JXG$1.evaluate(n.visProp.rotate),A!==0&&(A*=Math.PI/180,y=Math.cos(A),G=Math.sin(A),n.rendNode.style.transform="matrix("+[y,-1*G,G,y,0,0].join(",")+")",n.rendNode.style["transform-origin"]=S+" "+w),this.transformImage(n,n.transformations)}else this.updateInternalText(n)},_css2js:function(n){var t=[],o,u,d,C,I,f=JXG$1.trim(n).replace(/;$/,"").split(";");for(u=f.length,o=0;o<u;++o)JXG$1.trim(f[o])!==""&&(I=f[o].split(":"),d=JXG$1.trim(I[0].replace(/-([a-z])/gi,function(A,y){return y.toUpperCase()})),C=JXG$1.trim(I[1]),t.push({key:d,val:C}));return t},updateTextStyle:function(n,t){var o,u,d,C,I,f=n.visProp,A=JXG$1.isBrowser?f.display:"internal",y=["rendNode","rendNodeTag","rendNodeLabel"],G=y.length,S=JXG$1.evaluate(f.fontunit),w,M,V,T,H=["cssdefaultstyle","cssstyle"],J=H.length;if(t?(d=f.highlightstrokecolor,u=f.highlightstrokeopacity,C=f.highlightcssclass):(d=f.strokecolor,u=f.strokeopacity,C=f.cssclass),this.type!=="no"&&(A==="html"||this.type!=="canvas")){for(V=0;V<J;V++)if(T=JXG$1.evaluate(f[(t?"highlight":"")+H[V]]),T!==""&&n.visPropOld[H[V]]!==T){for(w=this._css2js(T),I=0;I<G;I++)if(JXG$1.exists(n[y[I]]))for(M in w)w.hasOwnProperty(M)&&(n[y[I]].style[w[M].key]=w[M].val);n.visPropOld[H[V]]=T}if(o=JXG$1.evaluate(f.fontsize),n.visPropOld.fontsize!==o){n.needsSizeUpdate=!0;try{for(I=0;I<G;I++)JXG$1.exists(n[y[I]])&&(n[y[I]].style.fontSize=o+S)}catch{for(I=0;I<G;I++)JXG$1.exists(n[y[I]])&&(n[y[I]].style.fontSize=o)}n.visPropOld.fontsize=o}}return this.setTabindex(n),this.setObjectTransition(n),A==="html"&&this.type!=="no"?(this.setObjectViewport(n,!0),n.visPropOld.cssclass!==C&&(n.rendNode.className=C,n.visPropOld.cssclass=C,n.needsSizeUpdate=!0),this.setObjectStrokeColor(n,d,u)):this.updateInternalTextStyle(n,d,u),this},updateInternalTextStyle:function(n,t,o){this.setObjectStrokeColor(n,t,o)},drawImage:function(n){},updateImage:function(n){this.updateRectPrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),this.updateImageURL(n),this.transformImage(n,n.transformations),this._updateVisual(n,{stroke:!0,dash:!0},!0)},joinTransforms:function(n,t){var o,u=n.board.origin.scrCoords[1],d=n.board.origin.scrCoords[2],C=n.board.unitX,I=n.board.unitY,f=t.length,A=[[1,0,0],[-u/C,1/C,0],[d/I,0,-1/I]];for(o=0;o<f;o++)A=Mat.matMatMult(t[o].matrix,A);return A=Mat.matMatMult([[1,0,0],[u,C,0],[d,0,-I]],A),A},transformImage:function(n,t){},updateImageURL:function(n){},updateImageStyle:function(n,t){n.rendNode.className=JXG$1.evaluate(t?n.visProp.highlightcssclass:n.visProp.cssclass)},drawForeignObject:function(n){},updateForeignObject:function(n){},appendChildPrim:function(n,t){},appendNodesToElement:function(n,t){},createPrim:function(n,t){return null},remove:function(n){},makeArrows:function(n,t){},_setArrowWidth:function(n,t,o){},updateEllipsePrim:function(n,t,o,u,d){},updateLinePrim:function(n,t,o,u,d,C){},updatePathPrim:function(n,t,o){},updatePathStringPoint:function(n,t,o){},updatePathStringPrim:function(n){},updatePathStringBezierPrim:function(n){},updatePolygonPrim:function(n,t){},updateRectPrim:function(n,t,o,u,d){},setPropertyPrim:function(n,t,o){},setTabindex:function(n){var t;n.board.attr.keyboard.enabled&&JXG$1.exists(n.rendNode)&&(t=JXG$1.evaluate(n.visProp.tabindex),(!n.visPropCalc.visible||JXG$1.evaluate(n.visProp.fixed))&&(t=null),t!==n.visPropOld.tabindex&&(n.rendNode.setAttribute("tabindex",t),n.visPropOld.tabindex=t))},display:function(n,t){n&&(n.visPropOld.visible=t)},show:function(n){},hide:function(n){},setBuffering:function(n,t){},setDashStyle:function(n){},setDraft:function(n){if(JXG$1.evaluate(n.visProp.draft)){var t=n.board.options.elements.draft.color,o=n.board.options.elements.draft.opacity;this.setObjectViewport(n),this.setObjectTransition(n),n.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(n,t,o):(n.elementClass===Const.OBJECT_CLASS_POINT?this.setObjectFillColor(n,t,o):this.setObjectFillColor(n,"none",0),this.setObjectStrokeColor(n,t,o),this.setObjectStrokeWidth(n,n.board.options.elements.draft.strokeWidth))}},removeDraft:function(n){this.setObjectViewport(n),this.setObjectTransition(n),n.type===Const.OBJECT_TYPE_POLYGON?this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity):(n.type===Const.OBJECT_CLASS_POINT&&this.setObjectFillColor(n,n.visProp.fillcolor,n.visProp.fillopacity),this.setObjectStrokeColor(n,n.visProp.strokecolor,n.visProp.strokeopacity),this.setObjectStrokeWidth(n,n.visProp.strokewidth))},setGradient:function(n){},updateGradient:function(n){},setObjectTransition:function(n,t){},setObjectViewport:function(n,t){},setObjectFillColor:function(n,t,o){},setObjectStrokeColor:function(n,t,o){},setObjectStrokeWidth:function(n,t){},setShadow:function(n){},highlight:function(n,t){var o,u,d=n.visProp,C;if(this.setObjectViewport(n),this.setObjectTransition(n),!d.draft){if(n.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(n,d.highlightfillcolor,d.highlightfillopacity),u=JXG$1.evaluate(d.highlightbystrokewidth),o=0;o<n.borders.length;o++)this.highlight(n.borders[o],!u);else n.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(n,!0):n.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(n,!0),this.setObjectFillColor(n,d.highlightfillcolor,d.highlightfillopacity)):(this.setObjectStrokeColor(n,d.highlightstrokecolor,d.highlightstrokeopacity),this.setObjectFillColor(n,d.highlightfillcolor,d.highlightfillopacity));d.highlightstrokewidth&&!t&&(C=Math.max(JXG$1.evaluate(d.highlightstrokewidth),JXG$1.evaluate(d.strokewidth)),this.setObjectStrokeWidth(n,C),(n.elementClass===Const.OBJECT_CLASS_LINE||n.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(n,!0))}return this},noHighlight:function(n){var t,o=n.visProp,u;if(this.setObjectViewport(n),this.setObjectTransition(n),!JXG$1.evaluate(n.visProp.draft)){if(n.type===Const.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(n,o.fillcolor,o.fillopacity),t=0;t<n.borders.length;t++)this.noHighlight(n.borders[t]);else n.elementClass===Const.OBJECT_CLASS_TEXT?this.updateTextStyle(n,!1):n.type===Const.OBJECT_TYPE_IMAGE?(this.updateImageStyle(n,!1),this.setObjectFillColor(n,o.fillcolor,o.fillopacity)):(this.setObjectStrokeColor(n,o.strokecolor,o.strokeopacity),this.setObjectFillColor(n,o.fillcolor,o.fillopacity));u=JXG$1.evaluate(o.strokewidth),this.setObjectStrokeWidth(n,u),(n.elementClass===Const.OBJECT_CLASS_LINE||n.elementClass===Const.OBJECT_CLASS_CURVE)&&this.updatePathWithArrowHeads(n,!1)}return this},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(n,t){var o,u,d=function(I){I||(I=window.event),I.stopPropagation?I.stopPropagation():I.cancelBubble=!0},C=function(I,f,A,y){var G;A=A||"",G=o.createElement("span"),G.innerHTML=I,G.style.paddingLeft="7px",G.style.paddingRight="7px",G.classList!==void 0&&(G.classList.add("JXG_navigation_button"),G.classList.add("JXG_navigation_button_"+y)),G.setAttribute("id",A+"_navigation_"+y),u.appendChild(G),JXG$1.addEvent(G,"click",function(S){return JXG$1.bind(f,n)(),!1},n),JXG$1.addEvent(G,"pointerup",d,n),JXG$1.addEvent(G,"pointerdown",d,n),JXG$1.addEvent(G,"pointerleave",d,n),JXG$1.addEvent(G,"mouseup",d,n),JXG$1.addEvent(G,"mousedown",d,n),JXG$1.addEvent(G,"touchend",d,n),JXG$1.addEvent(G,"touchstart",d,n)};JXG$1.isBrowser&&this.type!=="no"&&(o=n.containerObj.ownerDocument,u=o.createElement("div"),u.setAttribute("id",n.container+"_navigationbar"),u.style.color=t.strokecolor,u.style.backgroundColor=t.fillcolor,u.style.padding=t.padding,u.style.position=t.position,u.style.fontSize=t.fontsize,u.style.cursor=t.cursor,u.style.zIndex=t.zindex,n.containerObj.appendChild(u),u.style.right=t.right,u.style.bottom=t.bottom,u.classList!==void 0&&u.classList.add("JXG_navigation"),n.attr.showfullscreen&&C(n.attr.fullscreen.symbol,function(){n.toFullscreen(n.attr.fullscreen.id)},n.container,"fullscreen"),n.attr.showscreenshot&&C(n.attr.screenshot.symbol,function(){window.setTimeout(function(){n.renderer.screenshot(n,"",!1)},330)},n.container,"screenshot"),n.attr.showreload&&C("↻",function(){n.reload()},n.container,"reload"),n.attr.showcleartraces&&C("⊗",function(){n.clearTraces()},n.container,"cleartraces"),n.attr.shownavigation&&(n.attr.showzoom&&(C("–",n.zoomOut,n.container,"out"),C("o",n.zoom100,n.container,"100"),C("+",n.zoomIn,n.container,"in")),C("←",n.clickLeftArrow,n.container,"left"),C("↓",n.clickUpArrow,n.container,"down"),C("↑",n.clickDownArrow,n.container,"up"),C("→",n.clickRightArrow,n.container,"right")))},getElementById:function(n){var t;return JXG$1.exists(this.container)?(t=this.container.id+"_"+n,JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(t=CSS.escape(t)),this.container.querySelector("#"+t)):""},removeToInsertLater:function(n){var t=n.parentNode,o=n.nextSibling;if(t!==null)return t.removeChild(n),function(){o?t.insertBefore(n,o):t.appendChild(n)}},resize:function(n,t){},createTouchpoints:function(n){},showTouchpoint:function(n){},hideTouchpoint:function(n){},updateTouchpoint:function(n,t){},dumpToDataURI:function(n){},dumpToCanvas:function(n,t,o,u){},screenshot:function(n){},setLayer:function(n,t){}});const AbstractRenderer=JXG$1.AbstractRenderer;var UTF8_ACCEPT=0,UTF8D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,12,24,36,60,96,84,12,12,12,48,72,12,12,12,12,12,12,12,12,12,12,12,12,12,0,12,12,12,12,12,0,12,0,12,12,12,24,12,12,12,12,12,24,12,24,12,12,12,12,12,12,12,12,12,24,12,12,12,12,12,24,12,12,12,12,12,12,12,24,12,12,12,12,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,12,12,12,12,12];JXG$1.Util=JXG$1.Util||{};JXG$1.Util.UTF8={encode:function(n){var t,o,u="",d=n.length;if(n=n.replace(/\r\n/g,`
`),typeof unescape=="function"&&typeof encodeURIComponent=="function")return unescape(encodeURIComponent(n));for(t=0;t<d;t++)o=n.charCodeAt(t),o<128?u+=String.fromCharCode(o):o>127&&o<2048?(u+=String.fromCharCode(o>>6|192),u+=String.fromCharCode(o&63|128)):(u+=String.fromCharCode(o>>12|224),u+=String.fromCharCode(o>>6&63|128),u+=String.fromCharCode(o&63|128));return u},decode:function(n){var t,o,u,d=0,C=0,I=UTF8_ACCEPT,f=[],A=n.length,y=[];for(t=0;t<A;t++)o=n.charCodeAt(t),u=UTF8D[o],I!==UTF8_ACCEPT?C=o&63|C<<6:C=255>>u&o,I=UTF8D[256+I+u],I===UTF8_ACCEPT&&(C>65535?f.push(55232+(C>>10),56320+(C&1023)):f.push(C),d++,d%1e4===0&&(y.push(String.fromCharCode.apply(null,f)),f=[]));return y.push(String.fromCharCode.apply(null,f)),y.join("")},asciiCharCodeAt:function(n,t){var o=n.charCodeAt(t);if(o>255)switch(o){case 8364:o=128;break;case 8218:o=130;break;case 402:o=131;break;case 8222:o=132;break;case 8230:o=133;break;case 8224:o=134;break;case 8225:o=135;break;case 710:o=136;break;case 8240:o=137;break;case 352:o=138;break;case 8249:o=139;break;case 338:o=140;break;case 381:o=142;break;case 8216:o=145;break;case 8217:o=146;break;case 8220:o=147;break;case 8221:o=148;break;case 8226:o=149;break;case 8211:o=150;break;case 8212:o=151;break;case 732:o=152;break;case 8482:o=153;break;case 353:o=154;break;case 8250:o=155;break;case 339:o=156;break;case 382:o=158;break;case 376:o=159;break}return o}};const Encoding=JXG$1.Util.UTF8;var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad="=";JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Base64={_getByte:function(n,t){return n.charCodeAt(t)&255},_getIndex:function(n,t){return alphabet.indexOf(n.charAt(t))},encode:function(n){var t,o,u,d,C,I=[];for(C=Encoding.encode(n),u=C.length,d=u%3,t=0;t<u-d;t+=3)o=this._getByte(C,t)<<16|this._getByte(C,t+1)<<8|this._getByte(C,t+2),I.push(alphabet.charAt(o>>18),alphabet.charAt(o>>12&63),alphabet.charAt(o>>6&63),alphabet.charAt(o&63));switch(d){case 1:o=this._getByte(C,u-1),I.push(alphabet.charAt(o>>2),alphabet.charAt(o<<4&63),pad,pad);break;case 2:o=this._getByte(C,u-2)<<8|this._getByte(C,u-1),I.push(alphabet.charAt(o>>10),alphabet.charAt(o>>4&63),alphabet.charAt(o<<2&63),pad);break}return I.join("")},decode:function(n,t){var o,u,d,C,I,f,A=[],y=[];if(o=n.replace(/[^A-Za-z0-9+/=]/g,""),d=o.length,d%4!==0)throw new Error("JSXGraph/utils/base64: Can't decode string (invalid input length).");for(o.charAt(d-1)===pad&&(C=1,o.charAt(d-2)===pad&&(C=2),d-=4),u=0;u<d;u+=4)I=this._getIndex(o,u)<<18|this._getIndex(o,u+1)<<12|this._getIndex(o,u+2)<<6|this._getIndex(o,u+3),y.push(I>>16,I>>8&255,I&255),u%1e4===0&&(A.push(String.fromCharCode.apply(null,y)),y=[]);switch(C){case 1:I=this._getIndex(o,d)<<12|this._getIndex(o,d+1)<<6|this._getIndex(o,d+2),y.push(I>>10,I>>2&255);break;case 2:I=this._getIndex(o,u)<<6|this._getIndex(o,u+1),y.push(I>>4);break}return A.push(String.fromCharCode.apply(null,y)),f=A.join(""),t&&(f=Encoding.decode(f)),f},decodeAsArray:function(n){var t,o=this.decode(n),u=[],d=o.length;for(t=0;t<d;t++)u[t]=o.charCodeAt(t);return u}};const Base64=JXG$1.Util.Base64;JXG$1.FileReader={handleRemoteFile:function(n,t,o,u,d,C){var I=!1;try{I=new XMLHttpRequest,o.toLowerCase()==="raw"?I.overrideMimeType("text/plain; charset="+d):I.overrideMimeType("text/xml; charset="+d)}catch{try{I=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{I=new ActiveXObject("Microsoft.XMLHTTP")}catch{I=!1}}}if(!I){JXG$1.debug("AJAX not activated!");return}I.open("GET",n,u),o.toLowerCase()==="raw"?this.cbp=function(){var f=I;f.readyState===4&&t(f.responseText)}:this.cbp=function(){var f=I,A="";f.readyState===4&&(JXG$1.exists(f.responseStream)&&(f.responseText.slice(0,2)==="PK"||Encoding.asciiCharCodeAt(f.responseText.slice(0,1),0)===31)?A=Base64.decode(jxgBinFileReader(f)):A=f.responseText,this.parseString(A,t,o,C))},this.cb=JXG$1.bind(this.cbp,this),I.onreadystatechange=this.cb;try{I.send(null)}catch{throw new Error("JSXGraph: A problem occurred while trying to read remote file '"+n+"'.")}},handleLocalFile:function(n,t,o,u,d,C){JXG$1.exists(u)||(u=!0),o.toLowerCase()==="raw"?this.cbp=function(f){t(f.target.result)}:this.cbp=function(f){var A=f.target.result;this.parseString(A,t,o,C)},this.cb=JXG$1.bind(this.cbp,this);var I=new FileReader;I.onload=this.cb,o.toLowerCase()==="raw"?I.readAsText(n):I.readAsText(n,d)},parseFileContent:function(n,t,o,u,d,C){JXG$1.isString(n)||FileReader===void 0?this.handleRemoteFile(n,t,o,u,d,C):this.handleLocalFile(n,t,o,u,d,C)},parseString:function(n,t,o,u){var d,C;if(o=o.toLowerCase(),d=JXG$1.readers[o],JXG$1.exists(d))C=new d(t,n),C.read();else if(o!=="jessiecode")throw new Error("JSXGraph: There is no reader available for '"+o+"'.");JXG$1.isFunction(u)&&u(t)}};!JXG$1.isMetroApp()&&JXG$1.isBrowser&&typeof navigator=="object"&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&document&&document.write&&document.write(`<script type="text/vbscript">
Function Base64Encode(inData)
  Const Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
  Dim cOut, sOut, I
  For I = 1 To LenB(inData) Step 3
    Dim nGroup, pOut, sGroup
    nGroup = &H10000 * AscB(MidB(inData, I, 1)) + _
      &H100 * MyASC(MidB(inData, I + 1, 1)) + MyASC(MidB(inData, I + 2, 1))
    nGroup = Oct(nGroup)
    nGroup = String(8 - Len(nGroup), "0") & nGroup
    pOut = Mid(Base64, CLng("&o" & Mid(nGroup, 1, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 3, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 5, 2)) + 1, 1) + _
      Mid(Base64, CLng("&o" & Mid(nGroup, 7, 2)) + 1, 1)
    sOut = sOut + pOut
  Next
  Select Case LenB(inData) Mod 3
    Case 1: '8 bit final
      sOut = Left(sOut, Len(sOut) - 2) + "=="
    Case 2: '16 bit final
      sOut = Left(sOut, Len(sOut) - 1) + "="
  End Select
  Base64Encode = sOut
End Function

Function MyASC(OneChar)
  If OneChar = "" Then MyASC = 0 Else MyASC = AscB(OneChar)
End Function

Function jxgBinFileReader(xhr)
    Dim byteString
    Dim b64String
    Dim i
    byteString = xhr.responseBody
    ReDim byteArray(LenB(byteString))
    For i = 1 To LenB(byteString)
        byteArray(i-1) = AscB(MidB(byteString, i, 1))
    Next
    b64String = Base64Encode(byteString)
    jxgBinFileReader = b64String
End Function
<\/script>
`);const FileReader$1=JXG$1.FileReader;JXG$1.GeonextParser={replacePow:function(n){var t,o,u,d,C,I,f,A,y,G,S,w;for(n=n.replace(/(\s*)\^(\s*)/g,"^"),G=n.indexOf("^"),d=-1;G>=0&&G<n.length-1;){if(d===G)throw new Error("JSXGraph: Error while parsing expression '"+n+"'");if(d=G,y=n.slice(0,G),S=n.slice(G+1),y.charAt(y.length-1)===")"){for(t=1,o=y.length-2;o>=0&&t>0;)u=y.charAt(o),u===")"?t++:u==="("&&(t-=1),o-=1;if(t===0){for(C="",f=y.substring(0,o+1),A=o;A>=0&&f.slice(A,A+1).match(/([\w.]+)/);)C=RegExp.$1+C,A-=1;C+=y.substring(o+1,y.length),C=C.replace(/([()+*%^\-/\][])/g,"\\$1")}else throw new Error("JSXGraph: Missing '(' in expression")}else C="[\\w\\.]+";if(S.match(/^([\w.]*\()/)){for(t=1,o=RegExp.$1.length;o<S.length&&t>0;)u=S.charAt(o),u===")"?t-=1:u==="("&&(t+=1),o+=1;if(t===0)I=S.substring(0,o),I=I.replace(/([()+*%^\-/[\]])/g,"\\$1");else throw new Error("JSXGraph: Missing ')' in expression")}else I="[\\w\\.]+";w=new RegExp("("+C+")\\^("+I+")"),n=n.replace(w,"pow($1,$2)"),G=n.indexOf("^")}return n},replaceIf:function(n){var t,o,u,d,C,I,f,A,y,G="",S=null,w=null,M=null;if(u=n.indexOf("If("),u<0)return n;for(n=n.replace(/""/g,"0");u>=0;){for(t=n.slice(0,u),o=n.slice(u+3),C=1,d=0,I=-1,f=-1;d<o.length&&C>0;)A=o.charAt(d),A===")"?C-=1:A==="("?C+=1:A===","&&C===1&&(I<0?I=d:f=d),d+=1;if(y=o.slice(0,d-1),o=o.slice(d),I<0||f<0)return"";S=y.slice(0,I),w=y.slice(I+1,f),M=y.slice(f+1),S=this.replaceIf(S),w=this.replaceIf(w),M=this.replaceIf(M),G+=t+"(("+S+")?("+w+"):("+M+"))",n=o,S=null,w=null,u=n.indexOf("If(")}return G+=o,G},replaceNameById:function(n,t,o){var u,d,C,I,f=0,A=["X","Y","L","V"],y=function(G){return o?"$('"+G+"')":G};for(I=0;I<A.length;I++)for(f=n.indexOf(A[I]+"(");f>=0;)f>=0&&(u=n.indexOf(")",f+2),u>=0&&(d=n.slice(f+2,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+2)+(o?"$('":"")+y(C.id)+n.slice(u)))),u=n.indexOf(")",f+2),f=n.indexOf(A[I]+"(",u);for(f=n.indexOf("Dist(");f>=0;)f>=0&&(u=n.indexOf(",",f+5),u>=0&&(d=n.slice(f+5,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+5)+y(C.id)+n.slice(u)))),u=n.indexOf(",",f+5),f=n.indexOf(",",u),u=n.indexOf(")",f+1),u>=0&&(d=n.slice(f+1,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+1)+y(C.id)+n.slice(u))),u=n.indexOf(")",f+1),f=n.indexOf("Dist(",u);for(A=["Deg","Rad"],I=0;I<A.length;I++)for(f=n.indexOf(A[I]+"(");f>=0;)f>=0&&(u=n.indexOf(",",f+4),u>=0&&(d=n.slice(f+4,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+4)+y(C.id)+n.slice(u)))),u=n.indexOf(",",f+4),f=n.indexOf(",",u),u=n.indexOf(",",f+1),u>=0&&(d=n.slice(f+1,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+1)+y(C.id)+n.slice(u))),u=n.indexOf(",",f+1),f=n.indexOf(",",u),u=n.indexOf(")",f+1),u>=0&&(d=n.slice(f+1,u),d=d.replace(/\\(['"])?/g,"$1"),C=t.elementsByName[d],C&&(n=n.slice(0,f+1)+y(C.id)+n.slice(u))),u=n.indexOf(")",f+1),f=n.indexOf(A[I]+"(",u);return n},replaceIdByObj:function(n){var t=/(X|Y|L)\(([\w_]+)\)/g;return n=n.replace(t,"$('$2').$1()"),t=/(V)\(([\w_]+)\)/g,n=n.replace(t,"$('$2').Value()"),t=/(Dist)\(([\w_]+),([\w_]+)\)/g,n=n.replace(t,"dist($('$2'), $('$3'))"),t=/(Deg)\(([\w_]+),([ \w[\w_]+),([\w_]+)\)/g,n=n.replace(t,"deg($('$2'),$('$3'),$('$4'))"),t=/Rad\(([\w_]+),([\w_]+),([\w_]+)\)/g,n=n.replace(t,"rad($('$1'),$('$2'),$('$3'))"),t=/N\((.+)\)/g,n=n.replace(t,"($1)"),n},geonext2JS:function(n,t){var o,u,d,C=["Abs","ACos","ASin","ATan","Ceil","Cos","Exp","Factorial","Floor","Log","Max","Min","Random","Round","Sin","Sqrt","Tan","Trunc"],I=["abs","acos","asin","atan","ceil","cos","exp","factorial","floor","log","max","min","random","round","sin","sqrt","tan","ceil"];for(n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),u=n,u=this.replaceNameById(u,t),u=this.replaceIf(u),u=this.replacePow(u),u=this.replaceIdByObj(u),d=0;d<C.length;d++)o=new RegExp(["(\\W|^)(",C[d],")"].join(""),"ig"),u=u.replace(o,["$1",I[d]].join(""));return u=u.replace(/True/g,"true"),u=u.replace(/False/g,"false"),u=u.replace(/fasle/g,"false"),u=u.replace(/Pi/g,"PI"),u=u.replace(/"/g,"'"),u},findDependencies:function(n,t,o){var u,d,C,I;JXG$1.exists(o)||(o=n.board),u=o.elementsByName;for(d in u)u.hasOwnProperty(d)&&d!==n.name&&(u[d].elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(u[d].visProp.islabel)||(I=d.replace(/\[/g,"\\["),I=I.replace(/\]/g,"\\]"),C=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+I+")(,[\\w\\[\\]'_ ]+)*\\)","g"),t.search(C)>=0&&u[d].addChild(n)):(I=d.replace(/\[/g,"\\["),I=I.replace(/\]/g,"\\]"),C=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+I+")(,[\\w\\[\\]'_ ]+)*\\)","g"),t.search(C)>=0&&u[d].addChild(n)))},gxt2jc:function(n,t){var o;return n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),o=n,o=this.replaceNameById(o,t,!0),o=o.replace(/True/g,"true"),o=o.replace(/False/g,"false"),o=o.replace(/fasle/g,"false"),o}};const GeonextParser=JXG$1.GeonextParser;JXG$1.GeometryElement=function(n,t,o,u){var d,C,I;if(this.needsUpdate=!0,this.isDraggable=!1,this.isReal=!0,this.childElements={},this.hasLabel=!1,this.highlighted=!1,this.notExistingParents={},this.traces={},this.numTraces=0,this.transformations=[],this.baseElement=null,this.descendants={},this.ancestors={},this.parents=[],this.symbolic={},this.rendNode=null,this.elType="",this.dump=!0,this.subs={},this.inherits=[],this._pos=-1,this.stdform=[1,0,0,0,1,1,0,0],this.methodMap={setLabel:"setLabel",label:"label",setName:"setName",getName:"getName",Name:"getName",addTransform:"addTransform",setProperty:"setAttribute",setAttribute:"setAttribute",addChild:"addChild",animate:"animate",on:"on",off:"off",trigger:"trigger",addTicks:"addTicks",removeTicks:"removeTicks",removeAllTicks:"removeAllTicks",Bounds:"bounds"},this.quadraticform=[[1,0,0],[0,1,0],[0,0,1]],this.visProp={},this.visPropCalc={visible:!1},EventEmitter.eventify(this),this.mouseover=!1,this.lastDragTime=new Date,this.view=null,arguments.length>0){this.board=n,this.type=o,this._org_type=o,this.elementClass=u||Const.OBJECT_CLASS_OTHER,this.id=t.id,d=t.name,JXG$1.exists(d)||(d=this.board.generateName(this)),d!==""&&(this.board.elementsByName[d]=this),this.name=d,this.needsRegularUpdate=t.needsregularupdate,JXG$1.clearVisPropOld(this),I=this.resolveShortcuts(t);for(C in I)I.hasOwnProperty(C)&&this._set(C,I[C]);this.visProp.draft=I.draft&&I.draft.draft}};JXG$1.extend(JXG$1.GeometryElement.prototype,{addChild:function(n){var t,o;this.childElements[n.id]=n,this.addDescendants(n),n.ancestors[this.id]=this;for(t in this.descendants)if(this.descendants.hasOwnProperty(t)){this.descendants[t].ancestors[this.id]=this;for(o in this.ancestors)this.ancestors.hasOwnProperty(o)&&(this.descendants[t].ancestors[this.ancestors[o].id]=this.ancestors[o])}for(t in this.ancestors)if(this.ancestors.hasOwnProperty(t))for(o in this.descendants)this.descendants.hasOwnProperty(o)&&(this.ancestors[t].descendants[this.descendants[o].id]=this.descendants[o]);return this},addDescendants:function(n){var t;this.descendants[n.id]=n;for(t in n.childElements)n.childElements.hasOwnProperty(t)&&this.addDescendants(n.childElements[t]);return this},addParents:function(n){var t,o,u;for(JXG$1.isArray(n)?u=n:u=arguments,o=u.length,t=0;t<o;++t)JXG$1.exists(u[t])&&(JXG$1.isId(this.board,u[t])?this.parents.push(u[t]):JXG$1.exists(u[t].id)&&this.parents.push(u[t].id));this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(n){this.parents=[],this.addParents(n)},addParentsFromJCFunctions:function(n){var t,o,u;for(t=0;t<n.length;t++)for(o in n[t].deps)u=n[t].deps[o],this.addParents(u),u.addChild(this);return this},removeChild:function(n){return delete this.childElements[n.id],this.removeDescendants(n),delete n.ancestors[this.id],this},removeDescendants:function(n){var t;delete this.descendants[n.id];for(t in n.childElements)n.childElements.hasOwnProperty(t)&&this.removeDescendants(n.childElements[t]);return this},countChildren:function(){var n,t,o=0;t=this.childElements;for(n in t)t.hasOwnProperty(n)&&n.indexOf("Label")<0&&o++;return o},getName:function(){return this.name},addTransform:function(n){return this},draggable:function(){return this.isDraggable&&!JXG$1.evaluate(this.visProp.fixed)&&this.type!==Const.OBJECT_TYPE_GLIDER},setPosition:function(n,t){var o=[],u,d,C,I;if(!JXG$1.exists(this.parents))return this;for(C=this.parents.length,d=0;d<C;++d)if(u=this.board.select(this.parents[d]),JXG$1.isPoint(u)){if(!u.draggable())return this;o.push(u)}if(t.length===3&&(t=t.slice(1)),I=this.board.create("transform",t,{type:"translate"}),C=o.length,C>0){if(I.applyOnce(o),JXG$1.exists(this.view)&&this.view.elType==="view3d")for(d=0;d<this.parents.length;++d)u=this.view.select(this.parents[d]),JXG$1.exists(u.setPosition2D)&&u.setPosition2D(I)}else this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(I):this.addTransform(I);for(d=0;d<C;++d)o[d].type===Const.OBJECT_TYPE_GLIDER&&o[d].updateGlider();return this},setPositionDirectly:function(n,t,o){var u=new Coords(n,t,this.board,!1),d=new Coords(n,o,this.board,!1),C=Statistics.subtract(u.usrCoords,d.usrCoords);return this.setPosition(Const.COORDS_BY_USER,C),this},generatePolynomial:function(){return[]},animate:function(n,t,o){o=o||{};var u,d,C,I=this.board.attr.animationdelay,f=Math.ceil(t/I),A=this,y=function(S,w,M){var V,T,H,J,z;for(V=JXG$1.rgb2hsv(S),T=JXG$1.rgb2hsv(w),H=(T[0]-V[0])/f,J=(T[1]-V[1])/f,z=(T[2]-V[2])/f,A.animationData[M]=[],C=0;C<f;C++)A.animationData[M][f-C-1]=JXG$1.hsv2rgb(V[0]+(C+1)*H,V[1]+(C+1)*J,V[2]+(C+1)*z)},G=function(S,w,M,V){var T,H;if(S=parseFloat(S),w=parseFloat(w),!(isNaN(S)||isNaN(w)))for(H=(w-S)/f,A.animationData[M]=[],C=0;C<f;C++)T=S+(C+1)*H,A.animationData[M][f-C-1]=V?Math.floor(T):T};this.animationData={};for(u in n)if(n.hasOwnProperty(u))switch(d=u.toLowerCase(),d){case"strokecolor":case"fillcolor":y(this.visProp[d],n[u],d);break;case"size":if(!JXG$1.isPoint(this))break;G(this.visProp[d],n[u],d,!0);break;case"strokeopacity":case"strokewidth":case"fillopacity":G(this.visProp[d],n[u],d,!1);break}return this.animationCallback=o.callback,this.board.addAnimation(this),this},update:function(){return JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(),this},updateRenderer:function(){return this},fullUpdate:function(n){return this.prepareUpdate().update().updateVisibility(n).updateRenderer()},setDisplayRendNode:function(n){var t,o,u,d,C;if(n===void 0&&(n=this.visPropCalc.visible),n===this.visPropOld.visible)return this;for(this.board.renderer.display(this,n),o=this.inherits.length,u=0;u<o;u++)if(C=this.inherits[u],JXG$1.isArray(C))for(d=C.length,t=0;t<d;t++)JXG$1.exists(C[t])&&JXG$1.exists(C[t].rendNode)&&JXG$1.evaluate(C[t].visProp.visible)==="inherit"&&C[t].setDisplayRendNode(n);else JXG$1.exists(C)&&JXG$1.exists(C.rendNode)&&JXG$1.evaluate(C.visProp.visible)==="inherit"&&C.setDisplayRendNode(n);return this.hasLabel&&JXG$1.exists(this.label)&&JXG$1.exists(this.label.rendNode)&&JXG$1.evaluate(this.label.visProp.visible)==="inherit"&&this.label.setDisplayRendNode(n),this},hide:function(){return this.setAttribute({visible:!1}),this},hideElement:function(){return this.hide(),this},show:function(){return this.setAttribute({visible:!0}),this},showElement:function(){return this.show(),this},updateVisibility:function(n){var t,o,u,d,C,I;if(this.needsUpdate){if(JXG$1.exists(this.view)&&JXG$1.evaluate(this.view.visProp.visible)===!1)this.visPropCalc.visible=!1;else for(n!==void 0?this.visPropCalc.visible=n:(I=JXG$1.evaluate(this.visProp.visible),JXG$1.exists(this.hiddenByParent)&&this.hiddenByParent&&(I=!1),I!=="inherit"&&(this.visPropCalc.visible=I)),o=this.inherits.length,u=0;u<o;u++)if(C=this.inherits[u],JXG$1.isArray(C))for(d=C.length,t=0;t<d;t++)JXG$1.exists(C[t])&&JXG$1.evaluate(C[t].visProp.visible)==="inherit"&&C[t].prepareUpdate().updateVisibility(this.visPropCalc.visible);else JXG$1.exists(C)&&JXG$1.evaluate(C.visProp.visible)==="inherit"&&C.prepareUpdate().updateVisibility(this.visPropCalc.visible);JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp)&&JXG$1.evaluate(this.label.visProp.visible)&&this.label.prepareUpdate().updateVisibility(this.visPropCalc.visible)}return this},_set:function(n,t){var o;if(n=n.toLocaleLowerCase(),this.visProp.hasOwnProperty(n)&&n.indexOf("color")>=0&&JXG$1.isString(t)&&t.length===9&&t.charAt(0)==="#")t=JXG$1.rgba2rgbo(t),this.visProp[n]=t[0],this.visProp[n.replace("color","opacity")]=t[1];else if(t!==null&&JXG$1.isObject(t)&&!JXG$1.exists(t.id)&&!JXG$1.exists(t.name)){this.visProp[n]={};for(o in t)t.hasOwnProperty(o)&&(this.visProp[n][o.toLocaleLowerCase()]=t[o])}else this.visProp[n]=t},resolveShortcuts:function(n){var t,o,u,d=["traceattributes","traceAttributes"];for(t in Options.shortcuts)if(Options.shortcuts.hasOwnProperty(t)){if(JXG$1.exists(n[t]))for(o=0;o<Options.shortcuts[t].length;o++)JXG$1.exists(n[Options.shortcuts[t][o]])||(n[Options.shortcuts[t][o]]=n[t]);for(u=0;u<d.length;u++)JXG$1.isObject(n[d[u]])&&(n[d[u]]=this.resolveShortcuts(n[d[u]]))}return n},setLabel:function(n){this.hasLabel||this.setAttribute({withlabel:!0}),this.setLabelText(n)},setLabelText:function(n){return JXG$1.exists(this.label)&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.label.setText(n)),this},setName:function(n){n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.elType!=="slider"&&this.setLabelText(n),this.setAttribute({name:n})},setProperty:function(){JXG$1.deprecated("setProperty()","setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(n){var t,o,u,d,C,I,f,A,y,G={};for(t=0;t<arguments.length;t++)I=arguments[t],JXG$1.isString(I)?(A=I.split(":"),G[JXG$1.trim(A[0])]=JXG$1.trim(A[1])):JXG$1.isArray(I)?G[I[0]]=I[1]:JXG$1.extend(G,I);G=this.resolveShortcuts(G);for(t in G)if(G.hasOwnProperty(t)){if(d=t.replace(/\s+/g,"").toLowerCase(),C=G[t],JXG$1.isObject(C)&&JXG$1.exists(this.visProp[d])){if(this.visProp[d]=JXG$1.merge(this.visProp[d],C),this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.exists(this.labels))for(u=this.labels.length,o=0;o<u;o++)this.labels[o].setAttribute(C);else if(JXG$1.exists(this[d]))if(JXG$1.isArray(this[d]))for(o=0;o<this[d].length;o++)this[d][o].setAttribute(C);else this[d].setAttribute(C);continue}switch(y=this.visProp[d],d){case"checked":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeCheckbox.checked=!!C);break;case"disabled":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.disabled=!!C);break;case"face":JXG$1.isPoint(this)&&(this.visProp.face=C,this.board.renderer.changePointStyle(this));break;case"generatelabelvalue":this.type===Const.OBJECT_TYPE_TICKS&&JXG$1.isFunction(C)&&(this.generateLabelValue=C);break;case"gradient":this.visProp.gradient=C,this.board.renderer.setGradient(this);break;case"gradientsecondcolor":C=JXG$1.rgba2rgbo(C),this.visProp.gradientsecondcolor=C[0],this.visProp.gradientsecondopacity=C[1],this.board.renderer.updateGradient(this);break;case"gradientsecondopacity":this.visProp.gradientsecondopacity=C,this.board.renderer.updateGradient(this);break;case"infoboxtext":JXG$1.isString(C)?this.infoboxText=C:this.infoboxText=!1;break;case"labelcolor":C=JXG$1.rgba2rgbo(C),f=C[1],C=C[0],f===0&&JXG$1.exists(this.label)&&this.hasLabel&&this.label.hideElement(),JXG$1.exists(this.label)&&this.hasLabel&&(this.label.visProp.strokecolor=C,this.board.renderer.setObjectStrokeColor(this.label,C,f)),this.elementClass===Const.OBJECT_CLASS_TEXT&&(this.visProp.strokecolor=C,this.visProp.strokeopacity=f,this.board.renderer.setObjectStrokeColor(this,C,f));break;case"layer":this.board.renderer.setLayer(this,JXG$1.evaluate(C)),this._set(d,C);break;case"maxlength":JXG$1.exists(this.rendNodeTag)&&(this.rendNodeTag.maxlength=!!C);break;case"name":y=this.name,delete this.board.elementsByName[this.name],this.name=C,this.board.elementsByName[this.name]=this;break;case"needsregularupdate":this.needsRegularUpdate=!(C==="false"||C===!1),this.board.renderer.setBuffering(this,this.needsRegularUpdate?"auto":"static");break;case"onpolygon":this.type===Const.OBJECT_TYPE_GLIDER&&(this.onPolygon=!!C);break;case"radius":(this.type===Const.OBJECT_TYPE_ANGLE||this.type===Const.OBJECT_TYPE_SECTOR)&&this.setRadius(C);break;case"rotate":(this.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(this.visProp.display)==="internal"||this.type===Const.OBJECT_TYPE_IMAGE)&&this.addRotation(C);break;case"tabindex":JXG$1.exists(this.rendNode)&&(this.rendNode.setAttribute("tabindex",C),this._set(d,C));break;case"trace":C==="false"||C===!1?(this.clearTrace(),this.visProp.trace=!1):C==="pause"?this.visProp.trace=!1:this.visProp.trace=!0;break;case"visible":C==="false"?this.visProp.visible=!1:C==="true"?this.visProp.visible=!0:this.visProp.visible=C,this.setDisplayRendNode(JXG$1.evaluate(this.visProp.visible)),JXG$1.evaluate(this.visProp.visible)&&JXG$1.exists(this.updateSize)&&this.updateSize();break;case"withlabel":this.visProp.withlabel=C,JXG$1.evaluate(C)?(this.label||this.createLabel(),this.label.setAttribute({visible:"inherit"})):this.label&&this.hasLabel&&this.label.setAttribute({visible:!1}),this.hasLabel=C;break;case"straightfirst":case"straightlast":this._set(d,C);for(o in this.childElements)this.childElements.hasOwnProperty(o)&&this.childElements[o].elType==="glider"&&this.childElements[o].fullUpdate();break;default:JXG$1.exists(this.visProp[d])&&(!JXG$1.Validator[d]||JXG$1.Validator[d]&&JXG$1.Validator[d](C)||JXG$1.Validator[d]&&JXG$1.isFunction(C)&&JXG$1.Validator[d](C()))&&(C=C.toLowerCase&&C.toLowerCase()==="false"?!1:C,this._set(d,C));break}this.triggerEventHandlers(["attribute:"+d],[y,C,this])}return this.triggerEventHandlers(["attribute"],[G,this]),JXG$1.evaluate(this.visProp.needsregularupdate)?this.board.update(this):this.board.fullUpdate(),this.elementClass===Const.OBJECT_CLASS_TEXT&&this.updateSize(),this},getProperty:function(){JXG$1.deprecated("getProperty()","getAttribute()"),this.getProperty.apply(this,arguments)},getAttribute:function(n){var t;switch(n=n.toLowerCase(),n){case"needsregularupdate":t=this.needsRegularUpdate;break;case"labelcolor":t=this.label.visProp.strokecolor;break;case"infoboxtext":t=this.infoboxText;break;case"withlabel":t=this.hasLabel;break;default:t=this.visProp[n];break}return t},setDash:function(n){return this.setAttribute({dash:n}),this},prepareUpdate:function(){return this.needsUpdate=!0,this},remove:function(){return this.board.renderer.remove(this.rendNode),this.hasLabel&&this.board.renderer.remove(this.board.renderer.getElementById(this.label.id)),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},getLabelAnchor:function(){return new Coords(Const.COORDS_BY_USER,[0,0],this.board)},setArrow:function(n,t){return this.visProp.firstarrow=n,this.visProp.lastarrow=t,t&&(this.type=Const.OBJECT_TYPE_VECTOR,this.elType="arrow"),this.prepareUpdate().update().updateVisibility().updateRenderer(),this},createGradient:function(){var n=JXG$1.evaluate(this.visProp.gradient);(n==="linear"||n==="radial")&&this.board.renderer.setGradient(this)},createLabel:function(){var n,t=this;return JXG$1.elements.text?(n=JXG$1.deepCopy(this.visProp.label,null),n.id=this.id+"Label",n.isLabel=!0,n.anchor=this,n.priv=this.visProp.priv,this.visProp.withlabel&&(this.label=JXG$1.elements.text(this.board,[0,0,function(){return JXG$1.isFunction(t.name)?t.name():t.name}],n),this.label.needsUpdate=!0,this.label.dump=!1,this.label.fullUpdate(),this.hasLabel=!0)):JXG$1.debug("JSXGraph: Can't create label: text element is not available. Make sure you include base/text"),this},highlight:function(n){return n=JXG$1.def(n,!1),JXG$1.evaluate(this.visProp.highlight)&&(!this.highlighted||n)&&(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this)),this},noHighlight:function(){return this.highlighted&&(this.highlighted=!1,delete this.board.highlightedObjects[this.id],this.board.renderer.noHighlight(this)),this},clearTrace:function(){var n;for(n in this.traces)this.traces.hasOwnProperty(n)&&this.board.renderer.remove(this.traces[n]);return this.numTraces=0,this},cloneToBackground:function(){return this},bounds:function(){return[0,0,0,0]},normalize:function(){return this.stdform=Mat.normalize(this.stdform),this},toJSON:function(){var n,t,o=['{"name":',this.name];o.push(', "id":'+this.id),n=[];for(t in this.visProp)this.visProp.hasOwnProperty(t)&&JXG$1.exists(this.visProp[t])&&n.push('"'+t+'":'+this.visProp[t]);return o.push(', "visProp":{'+n.toString()+"}"),o.push("}"),o.join("")},addRotation:function(n){var t,o,u,d,C,I=this;return(this.elementClass===Const.OBJECT_CLASS_TEXT||this.type===Const.OBJECT_TYPE_IMAGE)&&n!==0&&(t=this.board.create("transform",[function(){return-I.X()},function(){return-I.Y()}],{type:"translate"}),o=this.board.create("transform",[function(){return I.X()},function(){return I.Y()}],{type:"translate"}),u=this.board.create("transform",[function(){return I.board.unitX/I.board.unitY},function(){return 1}],{type:"scale"}),d=this.board.create("transform",[function(){return I.board.unitY/I.board.unitX},function(){return 1}],{type:"scale"}),C=this.board.create("transform",[function(){return JXG$1.evaluate(n)*Math.PI/180}],{type:"rotate"}),t.bindTo(this),u.bindTo(this),C.bindTo(this),d.bindTo(this),o.bindTo(this)),this},highlightStrokeColor:function(n){return JXG$1.deprecated("highlightStrokeColor()","setAttribute()"),this.setAttribute({highlightStrokeColor:n}),this},strokeColor:function(n){return JXG$1.deprecated("strokeColor()","setAttribute()"),this.setAttribute({strokeColor:n}),this},strokeWidth:function(n){return JXG$1.deprecated("strokeWidth()","setAttribute()"),this.setAttribute({strokeWidth:n}),this},fillColor:function(n){return JXG$1.deprecated("fillColor()","setAttribute()"),this.setAttribute({fillColor:n}),this},highlightFillColor:function(n){return JXG$1.deprecated("highlightFillColor()","setAttribute()"),this.setAttribute({highlightFillColor:n}),this},labelColor:function(n){return JXG$1.deprecated("labelColor()","setAttribute()"),this.setAttribute({labelColor:n}),this},dash:function(n){return JXG$1.deprecated("dash()","setAttribute()"),this.setAttribute({dash:n}),this},visible:function(n){return JXG$1.deprecated("visible()","setAttribute()"),this.setAttribute({visible:n}),this},shadow:function(n){return JXG$1.deprecated("shadow()","setAttribute()"),this.setAttribute({shadow:n}),this},getType:function(){return this.elType},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},snapToGrid:function(){return this},snapToPoints:function(){return this},getAttributes:function(){var n=JXG$1.deepCopy(this.visProp),t=[],o,u=t.length;for(n.id=this.id,n.name=this.name,o=0;o<u;o++)delete n[t[o]];return n},hasPoint:function(n,t){return!1},addTicks:function(n){return(n.id===""||!JXG$1.exists(n.id))&&(n.id=this.id+"_ticks_"+(this.ticks.length+1)),this.board.renderer.drawTicks(n),this.ticks.push(n),n.id},removeAllTicks:function(){var n;if(JXG$1.exists(this.ticks)){for(n=this.ticks.length-1;n>=0;n--)this.removeTicks(this.ticks[n]);this.ticks=[],this.board.update()}},removeTicks:function(n){var t,o;if(JXG$1.exists(this.defaultTicks)&&this.defaultTicks===n&&(this.defaultTicks=null),JXG$1.exists(this.ticks)){for(t=this.ticks.length-1;t>=0;t--)if(this.ticks[t]===n){if(this.board.removeObject(this.ticks[t]),this.ticks[t].ticks)for(o=0;o<this.ticks[t].ticks.length;o++)JXG$1.exists(this.ticks[t].labels[o])&&this.board.removeObject(this.ticks[t].labels[o]);delete this.ticks[t];break}}},getSnapSizes:function(){var n,t,o;return n=JXG$1.evaluate(this.visProp.snapsizex),t=JXG$1.evaluate(this.visProp.snapsizey),n<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(o=this.board.defaultAxes.x.defaultTicks,n=o.ticksDelta*(JXG$1.evaluate(o.visProp.minorticks)+1)),t<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(o=this.board.defaultAxes.y.defaultTicks,t=o.ticksDelta*(JXG$1.evaluate(o.visProp.minorticks)+1)),[n,t]},handleSnapToGrid:function(n,t){var o,u,d,C,I,f,A,y,G,S,w,M=!1,V=JXG$1.evaluate(this.visProp.attracttogrid),T=JXG$1.evaluate(this.visProp.attractorunit),H=JXG$1.evaluate(this.visProp.attractordistance);return!JXG$1.exists(this.coords)||JXG$1.evaluate(this.visProp.fixed)?this:(M=JXG$1.evaluate(this.visProp.snaptogrid)||V||n===!0,M&&(o=this.coords.usrCoords[1],u=this.coords.usrCoords[2],G=this.getSnapSizes(),S=G[0],w=G[1],S>0&&w>0&&(y=this.board.getBoundingBox(),d=Math.round(o/S)*S,C=Math.round(u/w)*w,I=new JXG$1.Coords(Const.COORDS_BY_USER,[d,C],this.board),(!V||I.distance(T==="screen"?Const.COORDS_BY_SCREEN:Const.COORDS_BY_USER,this.coords)<H)&&(o=d,u=C,t||(f=Math.min(y[0],y[2]),A=Math.max(y[0],y[2]),o<f&&o>f-S?o+=S:o>A&&o<A+S&&(o-=S),f=Math.min(y[1],y[3]),A=Math.max(y[1],y[3]),u<f&&u>f-w?u+=w:u>A&&u<A+w&&(u-=w)),this.coords.setCoordinates(Const.COORDS_BY_USER,[o,u])))),this)},getBoundingBox:function(){var n,t,o,u,d,C=[1/0,1/0,-1/0,-1/0];if(this.type===Const.OBJECT_TYPE_POLYGON){if(t=this.vertices.length-1,t<=0)return C;for(n=0;n<t;n++)o=this.vertices[n].X(),C[0]=o<C[0]?o:C[0],C[2]=o>C[2]?o:C[2],o=this.vertices[n].Y(),C[1]=o<C[1]?o:C[1],C[3]=o>C[3]?o:C[3]}else if(this.elementClass===Const.OBJECT_CLASS_CIRCLE)u=this.center.X(),d=this.center.Y(),C=[u-this.radius,d+this.radius,u+this.radius,d-this.radius];else if(this.elementClass===Const.OBJECT_CLASS_CURVE){if(t=this.vertices.length,t===0)return C;for(n=0;n<t;n++)o=this.points[n].coords.usrCoords[1],C[0]=o<C[0]?o:C[0],C[2]=o>C[2]?o:C[2],o=this.points[n].coords.usrCoords[1],C[1]=o<C[1]?o:C[1],C[3]=o>C[3]?o:C[3]}return C},addEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"on"),removeEvent:JXG$1.shortcut(JXG$1.GeometryElement.prototype,"off"),formatNumberLocale:function(n,t){var o,u,d,C={},I={maximumfractiondigits:"maximumFractionDigits",minimumfractiondigits:"minimumFractionDigits",compactdisplay:"compactDisplay",currencydisplay:"currencyDisplay",currencysign:"currencySign",localematcher:"localeMatcher",numberingsystem:"numberingSystem",signdisplay:"signDisplay",unitdisplay:"unitDisplay",usegrouping:"useGrouping",roundingmode:"roundingMode",roundingpriority:"roundingPriority",roundingincrement:"roundingIncrement",trailingzerodisplay:"trailingZeroDisplay",minimumintegerdigits:"minimumIntegerDigits",minimumsignificantdigits:"minimumSignificantDigits",maximumsignificantdigits:"maximumSignificantDigits"};if(JXG$1.exists(Intl)&&this.useLocale()){o=JXG$1.evaluate(this.visProp.intl.locale)||JXG$1.evaluate(this.board.attr.intl.locale),u=JXG$1.evaluate(this.visProp.intl.options)||{};for(d in u)u.hasOwnProperty(d)&&(I.hasOwnProperty(d)?C[I[d]]=JXG$1.evaluate(u[d]):C[d]=JXG$1.evaluate(u[d]));return d="maximumfractiondigits",JXG$1.exists(u[d])||(C[I[d]]=t),Intl.NumberFormat(o,C).format(n)}return n},useLocale:function(){var n;return!JXG$1.exists(this.visProp.intl)||!JXG$1.exists(this.visProp.intl.enabled)?!1:(n=JXG$1.evaluate(this.visProp.intl.enabled),n===!0||n==="inherit"&&JXG$1.evaluate(this.board.attr.intl.enabled)===!0)},__evt__over:function(n){},__evt__mouseover:function(n){},__evt__out:function(n){},__evt__mouseout:function(n){},__evt__move:function(n){},__evt__mousemove:function(n){},__evt__drag:function(n){},__evt__mousedrag:function(n){},__evt__pendrag:function(n){},__evt__touchdrag:function(n){},__evt__keydrag:function(n){},__evt__down:function(n){},__evt__mousedown:function(n){},__evt__pendown:function(n){},__evt__touchdown:function(n){},__evt__click:function(n){},__evt__dblclick:function(n){},__evt__mouseclick:function(n){},__evt__mousedblclick:function(n){},__evt__pointerclick:function(n){},__evt__pointerdblclick:function(n){},__evt__up:function(n){},__evt__mouseup:function(n){},__evt__penup:function(n){},__evt__touchup:function(n){},__evt__attribute:function(n,t){},__evt__attribute_:function(n,t,o){},__evt:function(){}});const GeometryElement=JXG$1.GeometryElement;JXG$1.CoordsElement=function(n,t){var o;for(JXG$1.exists(n)||(n=[1,0,0]),o=0;o<n.length;++o)n[o]=parseFloat(n[o]);this.coords=new Coords(Const.COORDS_BY_USER,n,this.board),this.initialCoords=new Coords(Const.COORDS_BY_USER,n,this.board),this.position=null,this.isConstrained=!1,this.onPolygon=!1,this.slideObject=null,this.slideObjects=[],this.needsUpdateFromParent=!0,this.groups=[],this.Xjc=null,this.Yjc=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{move:"moveTo",moveTo:"moveTo",moveAlong:"moveAlong",visit:"visit",glide:"makeGlider",makeGlider:"makeGlider",intersect:"makeIntersection",makeIntersection:"makeIntersection",X:"X",Y:"Y",Coords:"Coords",free:"free",setPosition:"setGliderPosition",setGliderPosition:"setGliderPosition",addConstraint:"addConstraint",dist:"Dist",Dist:"Dist",onPolygon:"onPolygon",startAnimation:"startAnimation",stopAnimation:"stopAnimation"}),JXG$1.exists(this.element)&&this.addAnchor(n,t),this.isDraggable=!0};JXG$1.extend(JXG$1.CoordsElement.prototype,{updateConstraint:function(){return this},updateCoords:function(n){return this.needsUpdate?(JXG$1.exists(n)||(n=!1),JXG$1.evaluate(this.visProp.frozen)||this.updateConstraint(),this.type===Const.OBJECT_TYPE_GLIDER&&(this.isConstrained&&(n=!1),n?this.updateGliderFromParent():this.updateGlider()),this.updateTransform(n),this):this},updateGlider:function(){var n,t,o,u,d,C,I,f,A,y,G,S,w=2*Math.PI,M,V,T,H,J,z=!1,L,K,O,Q=this.slideObject,ee,ie,te=[],se;if(this.needsUpdateFromParent=!1,Q.elementClass===Const.OBJECT_CLASS_CIRCLE)JXG$1.evaluate(this.visProp.isgeonext)&&(w=1),H=Geometry.projectPointToCircle(this,Q,this.board),J=Geometry.rad([Q.center.X()+1,Q.center.Y()],Q.center,this)/w;else if(Q.elementClass===Const.OBJECT_CLASS_LINE){if(this.onPolygon){if(u=Q.point1.coords.usrCoords,d=Q.point2.coords.usrCoords,n=1,t=d[n]-u[n],Math.abs(t)<Mat.eps&&(n=2,t=d[n]-u[n]),I=Geometry.projectPointToLine(this,Q,this.board),f=(I.usrCoords[n]-u[n])/t,C=Q.parentPolygon,f<0){for(n=0;n<C.borders.length;n++)if(Q===C.borders[n]){Q=C.borders[(n-1+C.borders.length)%C.borders.length];break}}else if(f>1){for(n=0;n<C.borders.length;n++)if(Q===C.borders[n]){Q=C.borders[(n+1+C.borders.length)%C.borders.length];break}}Q.id!==this.slideObject.id&&(this.slideObject=Q)}u=Q.point1.coords,d=Q.point2.coords,t=u.distance(Const.COORDS_BY_USER,d),t<Mat.eps?(H=u,z=!0,J=0):(H=Geometry.projectPointToLine(this,Q,this.board),u=u.usrCoords.slice(0),d=d.usrCoords.slice(0),Math.abs(d[0])<Mat.eps?(n=1,t=d[n],Math.abs(t)<Mat.eps&&(n=2,t=d[n]),t=(H.usrCoords[n]-u[n])/t,y=t>=0?1:-1,t=Math.abs(t),J=y*t/(t+1)):Math.abs(u[0])<Mat.eps?(n=1,t=u[n],Math.abs(t)<Mat.eps&&(n=2,t=u[n]),t=(H.usrCoords[n]-d[n])/t,t<0?J=(1-2*t)/(1-t):J=1/(t+1)):(n=1,t=d[n]-u[n],Math.abs(t)<Mat.eps&&(n=2,t=d[n]-u[n]),J=(H.usrCoords[n]-u[n])/t)),K=this.findClosestSnapValue(J),K!==null?(O=JXG$1.evaluate(this.visProp.snapvalues),J=(O[K]-this._smin)/(this._smax-this._smin),this.update(!0)):(L=JXG$1.evaluate(this.visProp.snapwidth),JXG$1.evaluate(L)>0&&Math.abs(this._smax-this._smin)>=Mat.eps&&(J=Math.max(Math.min(J,1),0),o=J*(this._smax-this._smin)+this._smin,o=Math.round(o/L)*L,J=(o-this._smin)/(this._smax-this._smin),this.update(!0))),u=Q.point1.coords,!JXG$1.evaluate(Q.visProp.straightfirst)&&Math.abs(u.usrCoords[0])>Mat.eps&&J<0&&(H=u,z=!0,J=0),d=Q.point2.coords,!JXG$1.evaluate(Q.visProp.straightlast)&&Math.abs(d.usrCoords[0])>Mat.eps&&J>1&&(H=d,z=!0,J=1)}else if(Q.type===Const.OBJECT_TYPE_TURTLE)this.updateConstraint(),ee=Geometry.projectPointToTurtle(this,Q,this.board),H=ee[0],J=ee[1];else if(Q.elementClass===Const.OBJECT_CLASS_CURVE)if(Q.type===Const.OBJECT_TYPE_ARC||Q.type===Const.OBJECT_TYPE_SECTOR)H=Geometry.projectPointToCircle(this,Q,this.board),A=Geometry.rad(Q.radiuspoint,Q.center,this),G=0,S=Geometry.rad(Q.radiuspoint,Q.center,Q.anglepoint),J=A,L=JXG$1.evaluate(Q.visProp.selection),(L==="minor"&&S>Math.PI||L==="major"&&S<Math.PI)&&(G=S,S=2*Math.PI),(A<G||A>S)&&(J=S,(A<G&&A>G*.5||A>S&&A>S*.5+Math.PI)&&(J=G),this.needsUpdateFromParent=!0,this.updateGliderFromParent()),w=S-G,this.visProp.isgeonext&&(w=1),Math.abs(w)>Mat.eps&&(J/=w);else if(this.updateConstraint(),Q.transformations.length>0){for(se=!1,ee=Q.getTransformationSource(),ee[0]&&(se=ee[0],te.push(Q),te.push(ee[1]));ee[0]&&JXG$1.exists(ee[1]._transformationSource);)ee=ee[1].getTransformationSource(),te.push(ee[1]);if(ie=this.coords.usrCoords,se){for(n=0;n<te.length;n++)te[n].updateTransformMatrix(),T=Mat.inverse(te[n].transformMat),ie=Mat.matVecMult(T,ie);for(M=new Coords(Const.COORDS_BY_USER,ie,this.board).usrCoords,V=Geometry.projectCoordsToCurve(M[1],M[2],this.position||0,te[te.length-1],this.board),ie=V[0].usrCoords,n=te.length-2;n>=0;n--)ie=Mat.matVecMult(te[n].transformMat,ie);V[0]=new Coords(Const.COORDS_BY_USER,ie,this.board)}else Q.updateTransformMatrix(),T=Mat.inverse(Q.transformMat),ie=Mat.matVecMult(T,ie),M=new Coords(Const.COORDS_BY_USER,ie,this.board).usrCoords,V=Geometry.projectCoordsToCurve(M[1],M[2],this.position||0,Q,this.board);H=V[0],J=V[1]}else ee=Geometry.projectPointToCurve(this,Q,this.board),H=ee[0],J=ee[1];else JXG$1.isPoint(Q)&&(H=Geometry.projectPointToPoint(this,Q,this.board),J=this.position);this.coords.setCoordinates(Const.COORDS_BY_USER,H.usrCoords,z),this.position=J},findClosestSnapValue:function(n){var t,o,u,d,C=null;if(u=JXG$1.evaluate(this.visProp.snapvalues),d=JXG$1.evaluate(this.visProp.snapvaluedistance),JXG$1.isArray(u)&&Math.abs(this._smax-this._smin)>=Mat.eps&&d>0)for(t=0;t<u.length;t++)o=Math.abs(n*(this._smax-this._smin)+this._smin-u[t]),o<d&&(d=o,C=t);return C},updateGliderFromParent:function(){var n,t,o,u,d,C=this.slideObject,I=[],f,A,y,G,S,w,M,V=2*Math.PI;if(!this.needsUpdateFromParent){this.needsUpdateFromParent=!0;return}if(C.elementClass===Const.OBJECT_CLASS_CIRCLE)o=C.Radius(),JXG$1.evaluate(this.visProp.isgeonext)&&(V=1),d=[C.center.X()+o*Math.cos(this.position*V),C.center.Y()+o*Math.sin(this.position*V)];else if(C.elementClass===Const.OBJECT_CLASS_LINE)n=C.point1.coords.usrCoords,t=C.point2.coords.usrCoords,n[0]===0&&n[1]===0&&n[2]===0||t[0]===0&&t[1]===0&&t[2]===0?d=[0,0,0]:Math.abs(t[0])<Mat.eps?(u=Math.min(Math.abs(this.position),1-Mat.eps),u/=1-u,this.position<0&&(u=-u),d=[n[0]+u*t[0],n[1]+u*t[1],n[2]+u*t[2]]):Math.abs(n[0])<Mat.eps?(u=Math.max(this.position,Mat.eps),u=Math.min(u,2-Mat.eps),u>1?u=(u-1)/(u-2):u=(1-u)/u,d=[t[0]+u*n[0],t[1]+u*n[1],t[2]+u*n[2]]):(u=this.position,d=[n[0]+u*(t[0]-n[0]),n[1]+u*(t[1]-n[1]),n[2]+u*(t[2]-n[2])]);else if(C.type===Const.OBJECT_TYPE_TURTLE)this.coords.setCoordinates(Const.COORDS_BY_USER,[C.Z(this.position),C.X(this.position),C.Y(this.position)]),this.updateConstraint(),d=Geometry.projectPointToTurtle(this,C,this.board)[0].usrCoords;else if(C.elementClass===Const.OBJECT_CLASS_CURVE){for(y=!1,f=C.getTransformationSource(),f[0]&&(y=f[0],I.push(C),I.push(f[1]));f[0]&&JXG$1.exists(f[1]._transformationSource);)f=f[1].getTransformationSource(),I.push(f[1]);if(y?this.coords.setCoordinates(Const.COORDS_BY_USER,[I[I.length-1].Z(this.position),I[I.length-1].X(this.position),I[I.length-1].Y(this.position)]):this.coords.setCoordinates(Const.COORDS_BY_USER,[C.Z(this.position),C.X(this.position),C.Y(this.position)]),C.type===Const.OBJECT_TYPE_ARC||C.type===Const.OBJECT_TYPE_SECTOR)G=Geometry.rad([C.center.X()+1,C.center.Y()],C.center,C.radiuspoint),S=0,M=Geometry.rad(C.radiuspoint,C.center,C.anglepoint),(C.visProp.selection==="minor"&&M>Math.PI||C.visProp.selection==="major"&&M<Math.PI)&&(S=M,M=2*Math.PI),V=M-S,JXG$1.evaluate(this.visProp.isgeonext)&&(V=1),w=this.position*V,(w<S||w>M)&&(w=M,(w<S&&w>S*.5||w>M&&w>M*.5+Math.PI)&&(w=S),this.position=w,Math.abs(V)>Mat.eps&&(this.position/=V)),o=C.Radius(),d=[C.center.X()+o*Math.cos(this.position*V+G),C.center.Y()+o*Math.sin(this.position*V+G)];else if(this.updateConstraint(),y)for(d=Geometry.projectPointToCurve(this,I[I.length-1],this.board)[0].usrCoords,A=I.length-2;A>=0;A--)d=new Coords(Const.COORDS_BY_USER,Mat.matVecMult(I[A].transformMat,d),this.board).usrCoords;else d=Geometry.projectPointToCurve(this,C,this.board)[0].usrCoords}else JXG$1.isPoint(C)&&(d=Geometry.projectPointToPoint(this,C,this.board).usrCoords);this.coords.setCoordinates(Const.COORDS_BY_USER,d,!1)},updateRendererGeneric:function(n){return!this.needsUpdate||!this.board.renderer?this:(this.visPropCalc.visible&&(this.isReal=!isNaN(this.coords.usrCoords[1]+this.coords.usrCoords[2]),this.isReal=Math.abs(this.coords.usrCoords[0])>Mat.eps?this.isReal:!1,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer[n](this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this)},X:function(){return this.coords.usrCoords[1]},Y:function(){return this.coords.usrCoords[2]},Z:function(){return this.coords.usrCoords[0]},Coords:function(n){return n?this.coords.usrCoords.slice():this.coords.usrCoords.slice(1)},XEval:function(){return this.coords.usrCoords[1]},YEval:function(){return this.coords.usrCoords[2]},ZEval:function(){return this.coords.usrCoords[0]},Dist:function(n){return this.isReal&&n.isReal?this.coords.distance(Const.COORDS_BY_USER,n.coords):NaN},snapToGrid:function(n){return this.handleSnapToGrid(n)},handleSnapToPoints:function(n){var t,o,u,d=0,C,I=1/0,f=null,A,y,G=JXG$1.evaluate(this.visProp.ignoredsnaptopoints),S,w,M=!1;if(C=this.board.objectsList.length,G&&(S=G.length),JXG$1.evaluate(this.visProp.snaptopoints)||n){for(A=JXG$1.evaluate(this.visProp.attractorunit),y=JXG$1.evaluate(this.visProp.attractordistance),t=0;t<C;t++){if(o=this.board.objectsList[t],G){for(M=!1,w=0;w<S;w++)if(o===this.board.select(G[w])){M=!0;break}if(M)continue}JXG$1.isPoint(o)&&o!==this&&o.visPropCalc.visible&&(u=Geometry.projectPointToPoint(this,o,this.board),A==="screen"?d=u.distance(Const.COORDS_BY_SCREEN,this.coords):d=u.distance(Const.COORDS_BY_USER,this.coords),d<y&&d<I&&(I=d,f=u))}f!==null&&this.coords.setCoordinates(Const.COORDS_BY_USER,f.usrCoords)}return this},snapToPoints:function(n){return this.handleSnapToPoints(n)},handleAttractors:function(){var n,t,o,u=0,d,C=JXG$1.evaluate(this.visProp.attractorunit),I=JXG$1.evaluate(this.visProp.attractordistance),f=JXG$1.evaluate(this.visProp.snatchdistance),A=JXG$1.evaluate(this.visProp.attractors),y=A.length;if(I!==0){for(n=0;n<y;n++)if(t=this.board.select(A[n]),JXG$1.exists(t)&&t!==this){if(JXG$1.isPoint(t)?o=Geometry.projectPointToPoint(this,t,this.board):t.elementClass===Const.OBJECT_CLASS_LINE?(d=Geometry.projectCoordsToSegment(this.coords.usrCoords,t.point1.coords.usrCoords,t.point2.coords.usrCoords),!JXG$1.evaluate(t.visProp.straightfirst)&&d[1]<0?o=t.point1.coords:!JXG$1.evaluate(t.visProp.straightlast)&&d[1]>1?o=t.point2.coords:o=new Coords(Const.COORDS_BY_USER,d[0],this.board)):t.elementClass===Const.OBJECT_CLASS_CIRCLE?o=Geometry.projectPointToCircle(this,t,this.board):t.elementClass===Const.OBJECT_CLASS_CURVE?o=Geometry.projectPointToCurve(this,t,this.board)[0]:t.type===Const.OBJECT_TYPE_TURTLE?o=Geometry.projectPointToTurtle(this,t,this.board)[0]:t.type===Const.OBJECT_TYPE_POLYGON&&(o=new Coords(Const.COORDS_BY_USER,Geometry.projectCoordsToPolygon(this.coords.usrCoords,t),this.board)),C==="screen"?u=o.distance(Const.COORDS_BY_SCREEN,this.coords):u=o.distance(Const.COORDS_BY_USER,this.coords),u<I){this.type===Const.OBJECT_TYPE_GLIDER&&(t===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===t)||this.makeGlider(t);break}u>=f&&(t===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===t)&&this.popSlideObject()}return this}},setPositionDirectly:function(n,t){var o,u,d,C=this.coords,I;if(this.relativeCoords)return u=new Coords(n,t,this.board),JXG$1.evaluate(this.visProp.islabel)?(d=Statistics.subtract(u.scrCoords,C.scrCoords),this.relativeCoords.scrCoords[1]+=d[1],this.relativeCoords.scrCoords[2]+=d[2]):(d=Statistics.subtract(u.usrCoords,C.usrCoords),this.relativeCoords.usrCoords[1]+=d[1],this.relativeCoords.usrCoords[2]+=d[2]),this;for(this.coords.setCoordinates(n,t),this.handleSnapToGrid(),this.handleSnapToPoints(),this.handleAttractors(),o=this.transformations.length-1;o>=0;o--)n===Const.COORDS_BY_SCREEN?I=new Coords(n,t,this.board).usrCoords:(t.length===2&&(t=[1].concat(t)),I=t),this.initialCoords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(Mat.inverse(this.transformations[o].matrix),I));return this.prepareUpdate().update(),this.board.isSuspendedUpdate&&this.type===Const.OBJECT_TYPE_GLIDER&&this.updateGlider(),this},setPositionByTransform:function(n,t){var o;return t=new Coords(n,t,this.board),o=this.board.create("transform",t.usrCoords.slice(1),{type:"translate"}),this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(o):this.addTransform(this,o),this.prepareUpdate().update(),this},setPosition:function(n,t){return this.setPositionDirectly(n,t)},setGliderPosition:function(n){return this.type===Const.OBJECT_TYPE_GLIDER&&(this.position=n,this.board.update()),this},makeGlider:function(n){var t=this.board.select(n),o=!1,u,d,C;if(t.type===Const.OBJECT_TYPE_POLYGON){for(u=Number.MAX_VALUE,d=0;d<t.borders.length;d++)C=JXG$1.Math.Geometry.distPointLine(this.coords.usrCoords,t.borders[d].stdform),C<u&&(u=C,n=t.borders[d]);t=this.board.select(n),o=!0}if(JXG$1.exists(t)){if(t.type===Const.OBJECT_TYPE_TICKS)throw new Error("JSXGraph: gliders on ticks are not possible.")}else throw new Error("JSXGraph: slide object undefined.");return this.slideObject=this.board.select(n),this.slideObjects.push(this.slideObject),this.addParents(n),this.type=Const.OBJECT_TYPE_GLIDER,this.elType="glider",this.visProp.snapwidth=-1,this.slideObject.addChild(this),this.isDraggable=!0,this.onPolygon=o,this.generatePolynomial=function(){return this.slideObject.generatePolynomial(this)},this.updateGlider(),this.needsUpdateFromParent=!0,this.updateGliderFromParent(),this},popSlideObject:function(){this.slideObjects.length>0&&(this.slideObjects.pop(),this.slideObject.removeChild(this),this.slideObjects.length===0?(this.type=this._org_type,this.type===Const.OBJECT_TYPE_POINT?this.elType="point":this.elementClass===Const.OBJECT_CLASS_TEXT?this.elType="text":this.type===Const.OBJECT_TYPE_IMAGE?this.elType="image":this.type===Const.OBJECT_TYPE_FOREIGNOBJECT&&(this.elType="foreignobject"),this.slideObject=null):this.slideObject=this.slideObjects[this.slideObjects.length-1])},free:function(){var n,t;if(this.type!==Const.OBJECT_TYPE_GLIDER)if(this.transformations.length=0,delete this.updateConstraint,this.isConstrained=!1,!this.isDraggable)this.isDraggable=!0,this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"),this.XEval=function(){return this.coords.usrCoords[1]},this.YEval=function(){return this.coords.usrCoords[2]},this.ZEval=function(){return this.coords.usrCoords[0]},this.Xjc=null,this.Yjc=null;else return;for(n in this.board.objects)this.board.objects.hasOwnProperty(n)&&(t=this.board.objects[n],t.descendants&&(delete t.descendants[this.id],delete t.childElements[this.id],this.hasLabel&&(delete t.descendants[this.label.id],delete t.childElements[this.label.id])));this.ancestors={},this.parents=[],this.slideObject=null,this.slideObjects=[],this.elementClass===Const.OBJECT_CLASS_POINT?(this.type=Const.OBJECT_TYPE_POINT,this.elType="point"):this.elementClass===Const.OBJECT_CLASS_TEXT?(this.type=this._org_type,this.elType="text"):this.elementClass===Const.OBJECT_CLASS_OTHER&&(this.type=this._org_type,this.elType="image")},addConstraint:function(n){var t,o,u=[],d=["X","Y"],C=function(f){return function(){return f}},I=function(f){return function(){return f.Value()}};for(this.elementClass===Const.OBJECT_CLASS_POINT&&(this.type=Const.OBJECT_TYPE_CAS),this.isDraggable=!1,t=0;t<n.length;t++)o=n[t],JXG$1.isString(o)?(u[t]=this.board.jc.snippet(o,!0,null,!0),this.addParentsFromJCFunctions([u[t]]),n.length===2&&(this[d[t]+"jc"]=n[t])):JXG$1.isFunction(o)?u[t]=o:JXG$1.isNumber(o)?u[t]=C(o):JXG$1.isObject(o)&&JXG$1.isFunction(o.Value)&&(u[t]=I(o)),u[t].origin=o;return n.length===1?this.updateConstraint=function(){var f=u[0]();return JXG$1.isArray(f)?this.coords.setCoordinates(Const.COORDS_BY_USER,f):this.coords=f,this}:n.length===2?(this.XEval=u[0],this.YEval=u[1],this.addParents([u[0].origin,u[1].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.XEval(),this.YEval()]),this}):(this.ZEval=u[0],this.XEval=u[1],this.YEval=u[2],this.addParents([u[0].origin,u[1].origin,u[2].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()]),this}),this.isConstrained=!0,this.prepareUpdate().update(),this.board.isSuspendedUpdate||(this.updateVisibility().updateRenderer(),this.hasLabel&&this.label.fullUpdate()),this},addAnchor:function(n,t){t?this.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,n.slice(0,2),this.board):this.relativeCoords=new Coords(Const.COORDS_BY_USER,n,this.board),this.element.addChild(this),t&&this.addParents(this.element),this.XEval=function(){var o,u,d,C;return JXG$1.evaluate(this.visProp.islabel)?(C=JXG$1.evaluate(this.visProp.offset),o=parseFloat(C[0]),d=this.element.getLabelAnchor(),u=new Coords(Const.COORDS_BY_SCREEN,[o+this.relativeCoords.scrCoords[1]+d.scrCoords[1],0],this.board),u.usrCoords[1]):(d=this.element.getTextAnchor(),this.relativeCoords.usrCoords[1]+d.usrCoords[1])},this.YEval=function(){var o,u,d,C;return JXG$1.evaluate(this.visProp.islabel)?(C=JXG$1.evaluate(this.visProp.offset),o=-parseFloat(C[1]),d=this.element.getLabelAnchor(),u=new Coords(Const.COORDS_BY_SCREEN,[0,o+this.relativeCoords.scrCoords[2]+d.scrCoords[2]],this.board),u.usrCoords[2]):(d=this.element.getTextAnchor(),this.relativeCoords.usrCoords[2]+d.usrCoords[2])},this.ZEval=JXG$1.createFunction(1,this.board,""),this.updateConstraint=function(){this.coords.setCoordinates(Const.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()])},this.isConstrained=!0,this.updateConstraint()},updateTransform:function(n){var t;if(this.transformations.length===0)return this;for(t=0;t<this.transformations.length;t++)this.transformations[t].update();return this},addTransform:function(n,t){var o,u=JXG$1.isArray(t)?t:[t],d=u.length;for(this.transformations.length===0&&(this.baseElement=n),o=0;o<d;o++)this.transformations.push(u[o]);return this},startAnimation:function(n,t,o){var u=JXG$1.evaluate(n),d=JXG$1.evaluate(t),C=this;return o=JXG$1.evaluate(o)||250,this.type===Const.OBJECT_TYPE_GLIDER&&!JXG$1.exists(this.intervalCode)&&(this.intervalCode=window.setInterval(function(){C._anim(u,d)},o),JXG$1.exists(this.intervalCount)||(this.intervalCount=0)),this},stopAnimation:function(){return JXG$1.exists(this.intervalCode)&&(window.clearInterval(this.intervalCode),delete this.intervalCode),this},moveAlong:function(n,t,o){o=o||{};var u,d,C=[],I=[],f=this.board.attr.animationdelay,A=t/f,y,G,S,w=function(M,V){return function(){return n[M][V]}};if(JXG$1.isArray(n)){for(y=n.length,u=0;u<y;u++)JXG$1.isPoint(n[u])?I[u]=n[u]:I[u]={elementClass:Const.OBJECT_CLASS_POINT,X:w(u,0),Y:w(u,1)};if(t=t||0,t===0)return this.setPosition(Const.COORDS_BY_USER,[I[I.length-1].X(),I[I.length-1].Y()]),this.board.update(this);if(!JXG$1.exists(o.interpolate)||o.interpolate)for(d=Numerics.Neville(I),u=0;u<A;u++)C[u]=[],C[u][0]=d[0]((A-u)/A*d[3]()),C[u][1]=d[1]((A-u)/A*d[3]());else{for(y=n.length-1,u=0;u<A;++u)G=Math.floor(u/A*y),S=u/A*y-G,C[u]=[],C[u][0]=(1-S)*I[G].X()+S*I[G+1].X(),C[u][1]=(1-S)*I[G].Y()+S*I[G+1].Y();C.push([I[y].X(),I[y].Y()]),C.reverse()}this.animationPath=C}else JXG$1.isFunction(n)&&(this.animationPath=n,this.animationStart=new Date().getTime());return this.animationCallback=o.callback,this.board.addAnimation(this),this},moveTo:function(n,t,o){o=o||{},n=new Coords(Const.COORDS_BY_USER,n,this.board);var u,d=this.board.attr.animationdelay,C=Math.ceil(t/d),I=[],f=this.coords.usrCoords[1],A=this.coords.usrCoords[2],y=n.usrCoords[1]-f,G=n.usrCoords[2]-A,S=function(w){let M=w/C;if(o.effect){if(o.effect==="<>")return Math.pow(Math.sin(M*Math.PI/2),2);if(o.effect==="<")return M*M*M;if(o.effect===">")return 1-Math.pow(1-M,3);if(o.effect==="==")return w/C;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return w/C};if(!JXG$1.exists(t)||t===0||Math.abs(n.usrCoords[0]-this.coords.usrCoords[0])>Mat.eps)return this.setPosition(Const.COORDS_BY_USER,n.usrCoords),this.board.update(this);if(!JXG$1.exists(o.callback)&&Math.abs(y)<Mat.eps&&Math.abs(G)<Mat.eps)return this;for(u=C;u>=0;u--)I[C-u]=[n.usrCoords[0],f+y*S(u),A+G*S(u)];return this.animationPath=I,this.animationCallback=o.callback,this.board.addAnimation(this),this},visit:function(n,t,o){n=new Coords(Const.COORDS_BY_USER,n,this.board);var u,d,C,I=this.board.attr.animationdelay,f=[],A=this.coords.usrCoords[1],y=this.coords.usrCoords[2],G=n.usrCoords[1]-A,S=n.usrCoords[2]-y,w=function(M){var V=M<C/2?2*M/C:2*(C-M)/C;if(o.effect){if(o.effect==="<>")return Math.pow(Math.sin(V*Math.PI/2),2);if(o.effect==="<")return V*V*V;if(o.effect===">")return 1-Math.pow(1-V,3);if(o.effect==="==")return V;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return V};for(JXG$1.isNumber(o)?o={repeat:o}:(o=o||{},JXG$1.exists(o.repeat)||(o.repeat=1)),C=Math.ceil(t/(I*o.repeat)),d=0;d<o.repeat;d++)for(u=C;u>=0;u--)f[d*(C+1)+C-u]=[n.usrCoords[0],A+G*w(u),y+S*w(u)];return this.animationPath=f,this.animationCallback=o.callback,this.board.addAnimation(this),this},_anim:function(n,t){var o,u,d,C,I,f,A,y,G;return this.intervalCount+=1,this.intervalCount>t&&(this.intervalCount=0),this.slideObject.elementClass===Const.OBJECT_CLASS_LINE?(A=this.slideObject.point1.coords.scrCoords,y=this.slideObject.point2.coords.scrCoords,o=Math.round((y[1]-A[1])*this.intervalCount/t),u=Math.round((y[2]-A[2])*this.intervalCount/t),n>0?C=this.slideObject.point1:(C=this.slideObject.point2,o*=-1,u*=-1),this.coords.setCoordinates(Const.COORDS_BY_SCREEN,[C.coords.scrCoords[1]+o,C.coords.scrCoords[2]+u])):this.slideObject.elementClass===Const.OBJECT_CLASS_CURVE?(n>0?I=(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/t+this.slideObject.minX():I=-(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/t+this.slideObject.maxX(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.X(I),this.slideObject.Y(I)]),G=Geometry.projectPointToCurve(this,this.slideObject,this.board),this.coords=G[0],this.position=G[1]):this.slideObject.elementClass===Const.OBJECT_CLASS_CIRCLE&&(d=2*Math.PI,n<0?d*=this.intervalCount/t:d*=(t-this.intervalCount)/t,f=this.slideObject.Radius(),this.coords.setCoordinates(Const.COORDS_BY_USER,[this.slideObject.center.coords.usrCoords[1]+f*Math.cos(d),this.slideObject.center.coords.usrCoords[2]+f*Math.sin(d)])),this.board.update(this),this},getTextAnchor:function(){return this.coords},getLabelAnchor:function(){return this.coords},getParents:function(){var n=[this.Z(),this.X(),this.Y()];return this.parents.length!==0&&(n=this.parents),this.type===Const.OBJECT_TYPE_GLIDER&&(n=[this.X(),this.Y(),this.slideObject.id]),n}});JXG$1.CoordsElement.create=function(n,t,o,u,d,C){var I,f=!1,A;for(A=0;A<o.length;A++)(JXG$1.isFunction(o[A])||JXG$1.isString(o[A]))&&(f=!0);if(f)I=new n(t,[0,0],u,d,C),I.addConstraint(o);else if(JXG$1.isNumber(o[0])&&JXG$1.isNumber(o[1]))I=new n(t,o,u,d,C),JXG$1.exists(u.slideobject)?I.makeGlider(u.slideobject):I.baseElement=I,I.isDraggable=!0;else if(JXG$1.isObject(o[0])&&JXG$1.isTransformationOrArray(o[1]))I=new n(t,[0,0],u,d,C),I.addTransform(o[0],o[1]),I.isDraggable=!1;else return!1;return I.handleSnapToGrid(),I.handleSnapToPoints(),I.handleAttractors(),I.addParents(o),I};const CoordsElement=JXG$1.CoordsElement;var priv$5={HTMLSliderInputEventHandler:function(){this._val=parseFloat(this.rendNodeRange.value),this.rendNodeOut.value=this.rendNodeRange.value,this.board.update()}};JXG$1.Text=function(n,t,o,u){var d;this.constructor(n,o,Const.OBJECT_TYPE_TEXT,Const.OBJECT_CLASS_TEXT),this.element=this.board.select(o.anchor),this.coordsConstructor(t,JXG$1.evaluate(this.visProp.islabel)),this.content="",this.plaintext="",this.plaintextOld=null,this.orgText="",this.needsSizeUpdate=!1,this.hiddenByParent=!1,this.size=[1,1],this.id=this.board.setId(this,"T"),this.board.renderer.drawText(this),this.board.finalizeAdding(this),d=this.visProp.visible,this.visProp.visible=!0,this.setText(u),this.visProp.visible=d,JXG$1.isString(this.content)&&this.notifyParents(this.content),this.elType="text",this.methodMap=JXG$1.deepCopy(this.methodMap,{setText:"setTextJessieCode",move:"setCoords",Size:"getSize",setAutoPosition:"setAutoPosition"})};JXG$1.Text.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Text.prototype,{hasPoint:function(n,t){var o,u,d,C,I,f,A,y;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(A=this.board._inputDevice,y=JXG$1.evaluate(this.visProp.precision[A])):y=this.board.options.precision.hasPoint,this.transformations.length>0&&(o=Mat.matVecMult(Mat.inverse(this.board.renderer.joinTransforms(this,this.transformations)),[1,n,t]),n=o[1],t=o[2]),I=this.getAnchorX(),I==="right"?o=this.coords.scrCoords[1]-this.size[0]:I==="middle"?o=this.coords.scrCoords[1]-.5*this.size[0]:o=this.coords.scrCoords[1],u=o+this.size[0],f=this.getAnchorY(),f==="top"?C=this.coords.scrCoords[2]+this.size[1]:f==="middle"?C=this.coords.scrCoords[2]+.5*this.size[1]:C=this.coords.scrCoords[2],d=C-this.size[1],JXG$1.evaluate(this.visProp.dragarea)==="all"?n>=o-y&&n<u+y&&t>=d-y&&t<=C+y:t>=d-y&&t<=C+y&&(n>=o-y&&n<=o+2*y||n>=u-2*y&&n<=u+y)},_createFctUpdateText:function(n){var t,o,u,d,C,I,f=JXG$1.evaluate(this.visProp.parse),A=JXG$1.evaluate(this.visProp.usemathjax),y=JXG$1.evaluate(this.visProp.usekatex),G=!1;if(this.orgText=n,JXG$1.isFunction(n))this.updateText=function(){d=n().toString(),f&&!A&&!y?this.plaintext=this.replaceSub(this.replaceSup(this.convertGeonextAndSketchometry2CSS(d,!1))):this.plaintext=d};else if(JXG$1.isNumber(n)&&JXG$1.evaluate(this.visProp.formatnumber)?JXG$1.evaluate(this.visProp.tofraction)?A?this.content="\\("+JXG$1.toFraction(n,!0)+"\\)":this.content=JXG$1.toFraction(n,y):(u=JXG$1.evaluate(this.visProp.digits),this.useLocale()?this.content=this.formatNumberLocale(n,u):this.content=JXG$1.toFixed(n,u)):JXG$1.isString(n)&&f?(JXG$1.evaluate(this.visProp.useasciimathml)?this.content="'`"+n+"`'":A||y?(this.content=this.valueTagToJessieCode(n),JXG$1.isArray(this.content)||(this.content=this.content.replace(/\\/g,"\\\\"))):this.content=this.poorMansTeX(this.valueTagToJessieCode(n)),G=!0):this.content=n,G){if(JXG$1.isArray(this.content)){for(I=this,C=0;C<this.content.length;C++)if(this.content[C][0]!=='"'){this.content[C]=this.board.jc.snippet(this.content[C],!0,"",!1);for(o in this.content[C].deps)this.addParents(this.content[C].deps[o]),this.content[C].deps[o].addChild(this)}t=function(){var S,w,M=JXG$1.evaluate(I.visProp.digits),V="";for(S=0;S<I.content.length;S++)JXG$1.isFunction(I.content[S])?(w=I.content[S](),I.useLocale()?w=I.formatNumberLocale(w,M):w=JXG$1.toFixed(w,M)):(w=I.content[S],w[0]==='"'&&w[w.length-1]==='"'&&(w=w.slice(1,-1))),V+=w;return V}}else{t=this.board.jc.snippet(this.content,!0,"",!1);for(o in t.deps)this.addParents(t.deps[o]),t.deps[o].addChild(this)}this.updateText=function(){this.plaintext=this.unescapeTicks(t())}}else this.updateText=function(){this.plaintext=this.content}},_setText:function(n){return this._createFctUpdateText(n),this.updateText(),this.fullUpdate(),(!this.board.infobox||this.id!==this.board.infobox.id)&&this.updateSize(),this},setTextJessieCode:function(n){var t;return this.visProp.castext=n,JXG$1.isFunction(n)?t=function(){return JXG$1.sanitizeHTML(n())}:JXG$1.isNumber(n)?t=n:t=JXG$1.sanitizeHTML(n),this._setText(t)},setText:function(n){return this._setText(n)},updateSize:function(){var n,t,o,u=JXG$1.evaluate(this.visProp.display);return!JXG$1.isBrowser||this.board.renderer.type==="no"?this:(o=this.rendNode,u==="html"||this.board.renderer.type==="vml"?JXG$1.exists(o.offsetWidth)?(t=this,window.setTimeout(function(){t.size=[o.offsetWidth,o.offsetHeight],t.needsUpdate=!0,t.updateRenderer()},0)):this.size=this.crudeSizeEstimate():u==="internal"&&(this.board.renderer.type==="svg"?(t=this,window.setTimeout(function(){try{n=o.getBBox(),t.size=[n.width,n.height],t.needsUpdate=!0,t.updateRenderer()}catch{}},0)):this.board.renderer.type==="canvas"&&(this.size=this.crudeSizeEstimate())),this)},crudeSizeEstimate:function(){var n=parseFloat(JXG$1.evaluate(this.visProp.fontsize));return[n*this.plaintext.length*.45,n*.9]},utf8_decode:function(n){return n.replace(/&#x(\w+);/g,function(t,o){return String.fromCharCode(parseInt(o,16))})},replaceSub:function(n){if(!n.indexOf)return n;for(var t,o=n.indexOf("_{");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/_\{/,"<sub>"),t=n.indexOf("}",o+4),t>=0&&(n=n.slice(0,t)+n.slice(t).replace(/\}/,"</sub>")),o=n.indexOf("_{");for(o=n.indexOf("_");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/_(.?)/,"<sub>$1</sub>"),o=n.indexOf("_");return n},replaceSup:function(n){if(!n.indexOf)return n;for(var t,o=n.indexOf("^{");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/\^\{/,"<sup>"),t=n.indexOf("}",o+4),t>=0&&(n=n.slice(0,t)+n.slice(t).replace(/\}/,"</sup>")),o=n.indexOf("^{");for(o=n.indexOf("^");o>=0;)n=n.slice(0,o)+n.slice(o).replace(/\^(.?)/,"<sup>$1</sup>"),o=n.indexOf("^");return n},getSize:function(){return this.size},setCoords:function(n,t){var o,u,d;return JXG$1.isArray(n)&&n.length>1&&(t=n[1],n=n[0]),JXG$1.evaluate(this.visProp.islabel)&&JXG$1.exists(this.element)?(o=this.element.getLabelAnchor(),u=(n-o.usrCoords[1])*this.board.unitX,d=-(t-o.usrCoords[2])*this.board.unitY,this.relativeCoords.setCoordinates(Const.COORDS_BY_SCREEN,[u,d])):this.coords.setCoordinates(Const.COORDS_BY_USER,[n,t]),this.fullUpdate(),this},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateText(),JXG$1.evaluate(this.visProp.display)==="internal"&&JXG$1.isString(this.plaintext)&&(this.plaintext=this.utf8_decode(this.plaintext)),this.checkForSizeUpdate(),this.needsSizeUpdate&&this.updateSize(),this):this},checkForSizeUpdate:function(){this.board.infobox&&this.id===this.board.infobox.id?this.needsSizeUpdate=!1:(this.needsSizeUpdate=this.plaintextOld!==this.plaintext,this.needsSizeUpdate&&(this.plaintextOld=this.plaintext))},updateRenderer:function(){return JXG$1.evaluate(this.visProp.autoposition)&&this.setAutoPosition().updateConstraint(),this.updateRendererGeneric("updateText")},expandShortMath:function(n){var t=/([)0-9.])\s*([(a-zA-Z_])/g;return n.replace(t,"$1*$2")},generateTerm:function(n,t,o){var u,d,C,I,f='""';if(n=n||"",n=n.replace(/\r/g,""),n=n.replace(/\n/g,""),n=n.replace(/"/g,"'"),n=n.replace(/'/g,"\\'"),n=n.replace(/&amp;arc;/g,"&ang;"),n=n.replace(/<arc\s*\/>/g,"&ang;"),n=n.replace(/&lt;arc\s*\/&gt;/g,"&ang;"),n=n.replace(/&lt;sqrt\s*\/&gt;/g,"&radic;"),n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>"),C=n.indexOf("<value>"),I=n.indexOf("</value>"),C>=0)for(;C>=0;)f+=' + "'+this.replaceSub(this.replaceSup(n.slice(0,C)))+'"',d=n.slice(C+7,I),d=d.replace(/\s+/g,""),t===!0&&(d=this.expandShortMath(d)),o?u=d:u=GeonextParser.geonext2JS(d,this.board),u=u.replace(/\\"/g,"'"),u=u.replace(/\\'/g,"'"),u.indexOf("toFixed")<0&&JXG$1.isNumber(JXG$1.bind(this.board.jc.snippet(u,!0,"",!1),this)())?f+="+("+u+").toFixed("+JXG$1.evaluate(this.visProp.digits)+")":f+="+("+u+")",n=n.slice(I+8),C=n.indexOf("<value>"),I=n.indexOf("</value>");return f+=' + "'+this.replaceSub(this.replaceSup(n))+'"',f=this.convertGeonextAndSketchometry2CSS(f),f=f.replace(/&amp;/g,"&"),f=f.replace(/"/g,"'"),f},valueTagToJessieCode:function(n){var t,o,u,d,C=[],I='"';if(n=n||"",n=n.replace(/\r/g,""),n=n.replace(/\n/g,""),n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>"),u=n.indexOf("<value>"),d=n.indexOf("</value>"),u>=0)for(;u>=0;)C.push(I+this.escapeTicks(n.slice(0,u))+I),o=n.slice(u+7,d),o=o.replace(/\s+/g,""),o=this.expandShortMath(o),t=o,t=t.replace(/\\"/g,"'").replace(/\\'/g,"'"),C.push("("+t+")"),n=n.slice(d+8),u=n.indexOf("<value>"),d=n.indexOf("</value>");for(C.push(I+this.escapeTicks(n)+I),u=0;u<C.length;u++)C[u]=C[u].replace(/&amp;/g,"&");return C},poorMansTeX:function(n){var t,o;if(JXG$1.isArray(n)){for(o=[],t=0;t<n.length;t++)o.push(this.poorMansTeX(n[t]));return o}return n=n.replace(/<arc\s*\/*>/g,"&ang;").replace(/&lt;arc\s*\/*&gt;/g,"&ang;").replace(/<sqrt\s*\/*>/g,"&radic;").replace(/&lt;sqrt\s*\/*&gt;/g,"&radic;"),this.convertGeonextAndSketchometry2CSS(this.replaceSub(this.replaceSup(n)),!0)},escapeTicks:function(n){return n.replace(/"/g,"%22").replace(/'/g,"%27")},unescapeTicks:function(n){return n.replace(/%22/g,'"').replace(/%27/g,"'")},convertGeonext2CSS:function(n){return JXG$1.isString(n)&&(n=n.replace(/(<|&lt;)overline(>|&gt;)/g,"<span style=text-decoration:overline;>"),n=n.replace(/(<|&lt;)\/overline(>|&gt;)/g,"</span>"),n=n.replace(/(<|&lt;)arrow(>|&gt;)/g,"<span style=text-decoration:overline;>"),n=n.replace(/(<|&lt;)\/arrow(>|&gt;)/g,"</span>")),n},convertSketchometry2CSS:function(n,t){var o='<span class="sketcho sketcho-inherit sketcho-',u='"></span>';return JXG$1.isString(n)&&(t&&(o=this.escapeTicks(o),u=this.escapeTicks(u)),n=n.replace(/(<|&lt;)sketchofont(>|&gt;)/g,o),n=n.replace(/(<|&lt;)\/sketchofont(>|&gt;)/g,u)),n},convertGeonextAndSketchometry2CSS:function(n,t){return n=this.convertGeonext2CSS(n),n=this.convertSketchometry2CSS(n,t),n},notifyParents:function(n){var t,o=null;n=n.replace(/&lt;value&gt;/g,"<value>"),n=n.replace(/&lt;\/value&gt;/g,"</value>");do t=/<value>([\w\s*/^\-+()[\],<>=!]+)<\/value>/,o=t.exec(n),o!==null&&(GeonextParser.findDependencies(this,o[1],this.board),n=n.slice(o.index),n=n.replace(t,""));while(o!==null);return this},getParents:function(){var n;return this.relativeCoords!==void 0?n=[this.relativeCoords.usrCoords[1],this.relativeCoords.usrCoords[2],this.orgText]:n=[this.Z(),this.X(),this.Y(),this.orgText],this.parents.length!==0&&(n=this.parents),n},bounds:function(){var n=this.coords.usrCoords;return JXG$1.evaluate(this.visProp.islabel)||this.board.unitY===0||this.board.unitX===0?[0,0,0,0]:[n[1],n[2]+this.size[1]/this.board.unitY,n[1]+this.size[0]/this.board.unitX,n[2]]},getAnchorX:function(){var n=JXG$1.evaluate(this.visProp.anchorx);if(n==="auto")switch(this.visProp.position){case"top":case"bot":return"middle";case"rt":case"lrt":case"urt":return"left";case"lft":case"llft":case"ulft":default:return"right"}return n},getAnchorY:function(){var n=JXG$1.evaluate(this.visProp.anchory);if(n==="auto")switch(this.visProp.position){case"top":case"ulft":case"urt":return"bottom";case"bot":case"lrt":case"llft":return"top";case"rt":case"lft":default:return"middle"}return n},getNumberOfConflicts:function(n,t,o,u,d){d=d||[];var C=0,I,f,A,y,G;for(y=this.board.options.precision.hasPoint,this.board.options.precision.hasPoint=(o+u)*.25,I=0,A=this.board.objectsList.length;I<A;I++)f=this.board.objectsList[I],G=f.visProp.hasinnerpoints,f.visProp.hasinnerpoints=!1,f.visPropCalc.visible&&f.elType!=="axis"&&f.elType!=="ticks"&&f!==this.board.infobox&&f!==this&&f.hasPoint(n,t)&&d.indexOf(f.id)===-1&&C++,f.visProp.hasinnerpoints=G;return this.board.options.precision.hasPoint=y,C},setAutoPosition:function(){var n,t,o,u,d,C=this.size[0],I=this.size[1],f,A,y={conflicts:1/0,angle:0,r:0},G,S,w,M,V,T=12,H=2*Math.PI/T,J,z,L,K,O;if(this===this.board.infobox||!this.visPropCalc.visible||!JXG$1.evaluate(this.visProp.islabel)||!this.element)return this;if(M=JXG$1.evaluate(this.visProp.offset),d=this.element.getLabelAnchor(),o=d.scrCoords[1],u=d.scrCoords[2],z=M[0],L=M[1],w=this.getNumberOfConflicts(o+z,u-L,C,I,JXG$1.evaluate(this.visProp.autopositionwhitelist)),w===0)return this;for(V=JXG$1.evaluate(this.visProp.autopositionmindistance),G=JXG$1.evaluate(this.visProp.autopositionmaxdistance),S=.2*V,f=Math.atan2(L,z),y.conflicts=w,y.angle=f,y.r=V;y.conflicts>0&&V<=G;){for(J=1,A=f+H;J<T&&y.conflicts>0&&(K=Math.cos(A),O=Math.sin(A),n=o+V*K,t=u-V*O,w=this.getNumberOfConflicts(n,t,C,I,JXG$1.evaluate(this.visProp.autopositionwhitelist)),w<y.conflicts&&(y.conflicts=w,y.angle=A,y.r=V),y.conflicts!==0);J++)A+=H;V+=S}return V=y.r,K=Math.cos(y.angle),O=Math.sin(y.angle),this.visProp.offset=[V*K,V*O],K<-.2?this.visProp.anchorx="right":K>.2?this.visProp.anchorx="left":this.visProp.anchorx="middle",this}});JXG$1.createText=function(n,t,o){var u,d=JXG$1.copyAttributes(o,n.options,"text"),C=t.slice(0,-1),I=t[t.length-1];if(d.anchor=d.parent||d.anchor,u=CoordsElement.create(JXG$1.Text,n,C,d,I),!u)throw new Error("JSXGraph: Can't create text with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return d.rotate!==0&&u.addRotation(d.rotate),u};JXG$1.registerElement("text",JXG$1.createText);JXG$1.createHTMLSlider=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"htmlslider");if(t.length!==2||t[0].length!==2||t[1].length!==3)throw new Error("JSXGraph: Can't create htmlslider with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parents are: [[x,y], [min, start, max]]`);C.anchor=C.parent||C.anchor,C.fixed=C.fixed||!0,d=[t[0][0],t[0][1],'<form style="display:inline"><input type="range" /><span></span><input type="text" /></form>'],u=JXG$1.createText(n,d,C),u.type=JXG$1.OBJECT_TYPE_HTMLSLIDER,u.rendNodeForm=u.rendNode.childNodes[0],u.rendNodeRange=u.rendNodeForm.childNodes[0],u.rendNodeRange.min=t[1][0],u.rendNodeRange.max=t[1][2],u.rendNodeRange.step=C.step,u.rendNodeRange.value=t[1][1],u.rendNodeLabel=u.rendNodeForm.childNodes[1],u.rendNodeLabel.id=u.rendNode.id+"_label",C.withlabel&&(u.rendNodeLabel.innerHTML=u.name+"="),u.rendNodeOut=u.rendNodeForm.childNodes[2],u.rendNodeOut.value=t[1][1];try{u.rendNodeForm.id=u.rendNode.id+"_form",u.rendNodeRange.id=u.rendNode.id+"_range",u.rendNodeOut.id=u.rendNode.id+"_out"}catch(I){JXG$1.debug(I)}return u.rendNodeRange.style.width=C.widthrange+"px",u.rendNodeRange.style.verticalAlign="middle",u.rendNodeOut.style.width=C.widthout+"px",u._val=t[1][1],JXG$1.supportsVML()?JXG$1.addEvent(u.rendNodeForm,"change",priv$5.HTMLSliderInputEventHandler,u):JXG$1.addEvent(u.rendNodeForm,"input",priv$5.HTMLSliderInputEventHandler,u),u.Value=function(){return this._val},u};JXG$1.registerElement("htmlslider",JXG$1.createHTMLSlider);const Text=JXG$1.Text;Object.create||(Object.create=function(n,t){if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object prototype may only be an Object: "+n);if(n===null)throw new Error("This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.");if(typeof t<"u")throw new Error("This browser's implementation of Object.create is a shim and doesn't support a second argument.");function o(){}return o.prototype=n,new o});var priv$4={modules:{math:Mat,"math/geometry":Geometry,"math/statistics":Statistics,"math/numerics":Mat.Numerics}};JXG$1.JessieCode=function(n,t){this.scope={id:0,hasChild:!0,args:[],locals:{},context:null,previous:null},this.scopes=[],this.scopes.push(this.scope),this.dpstack=[[]],this.pscope=0,this.propstack=[{}],this.propscope=0,this.lhs=[],this.isLHS=!1,this.warnLog="jcwarn",this.$log=[],this.builtIn=this.defineBuiltIn(),this.operands=this.getPossibleOperands(),this.board=null,this.forceValueCall=!1,this.lineToElement={},this.parCurLine=1,this.parCurColumn=0,this.line=1,this.col=1,JXG$1.CA&&(this.CA=new JXG$1.CA(this.node,this.createNode,this)),this.code="",typeof n=="string"&&this.parse(n,t)};JXG$1.extend(JXG$1.JessieCode.prototype,{node:function(n,t,o){return{type:n,value:t,children:o}},createNode:function(n,t,o){var u=this.node(n,t,[]),d;for(d=2;d<arguments.length;d++)u.children.push(arguments[d]);return u.type==="node_const"&&JXG$1.isNumber(u.value)&&(u.isMath=!0),u.line=this.parCurLine,u.col=this.parCurColumn,u},pushScope:function(n){var t={args:n,locals:{},context:null,previous:this.scope};return this.scope.hasChild=!0,this.scope=t,t.id=this.scopes.push(t)-1,t},popScope:function(){var n=this.scope.previous;return this.scope=n!==null?n:this.scope,this.scope},getElementById:function(n){return this.board.objects[n]},log:function(){this.$log.push(arguments),typeof console=="object"&&console.log&&console.log.apply(console,arguments)},creator:function(){var n={},t;return t=function(o){var u;return typeof n[this.board.id+o]=="function"?u=n[this.board.id+o]:(u=function(d){return function(C,I){var f;return JXG$1.exists(I)?f=I:f={},f.name===void 0&&f.id===void 0&&(f.name=d.lhs[d.scope.id]!==0?d.lhs[d.scope.id]:""),d.board.create(o,C,f)}}(this),u.creator=!0,n[this.board.id+o]=u),u},t.clearCache=function(){n={}},t}(),letvar:function(n,t){this.builtIn[n]&&this._warn('"'+n+'" is a predefined value.'),this.scope.locals[n]=t},isLocalVariable:function(n){for(var t=this.scope;t!==null;){if(JXG$1.exists(t.locals[n]))return t;t=t.previous}return null},isParameter:function(n){for(var t=this.scope;t!==null;){if(JXG$1.indexOf(t.args,n)>-1)return t;t=t.previous}return null},isCreator:function(n){return!!JXG$1.elements[n]},isMathMethod:function(n){return n!=="E"&&!!Math[n]},isBuiltIn:function(n){return!!this.builtIn[n]},getvar:function(n,t,o){var u;if(t=JXG$1.def(t,!1),u=this.isLocalVariable(n),u!==null)return u.locals[n];if(n==="$board"||n==="EULER"||n==="PI")return this.builtIn[n];if(o){if(this.isBuiltIn(n))return this.builtIn[n];if(this.isMathMethod(n))return Math[n];if(this.isCreator(n))return this.creator(n)}if(!t&&(u=this.board.select(n),u!==n))return u},resolve:function(n){for(var t=this.scope;t!==null;){if(JXG$1.exists(t.locals[n]))return t.locals[n];t=t.previous}},getvarJS:function(n,t,o){var u,d="",C;return t=JXG$1.def(t,!1),o=JXG$1.def(o,!1),u=this.isParameter(n),u!==null?n:(u=this.isLocalVariable(n),u!==null&&!o?"$jc$.resolve('"+n+"')":this.isCreator(n)?"(function () { var a = Array.prototype.slice.call(arguments, 0), props = "+(o?"a.pop()":"{}")+"; return $jc$.board.create.apply($jc$.board, ['"+n+"'].concat([a, props])); })":(o&&this._error("Syntax error (attribute values are allowed with element creators only)"),this.isBuiltIn(n)?(d=this.builtIn[n].src||this.builtIn[n],JXG$1.isNumber(d)||d.match(/board\.select/)?d:(n=d.split(".").pop(),JXG$1.exists(this.board.mathLib)&&(C=new RegExp("^Math."+n),C.exec(d)!==null)?d.replace(C,"$jc$.board.mathLib."+n):JXG$1.exists(this.board.mathLibJXG)?(C=new RegExp("^JXG.Math."),C.exec(d)!==null?d.replace(C,"$jc$.board.mathLibJXG."):d):d)):this.isMathMethod(n)?"$jc$.board.mathLib."+n:t?"":(JXG$1.isId(this.board,n)?(d="$jc$.board.objects['"+n+"']",this.board.objects[n].elType==="slider"&&(d+=".Value()")):JXG$1.isName(this.board,n)?(d="$jc$.board.elementsByName['"+n+"']",this.board.elementsByName[n].elType==="slider"&&(d+=".Value()")):JXG$1.isGroup(this.board,n)&&(d="$jc$.board.groups['"+n+"']"),d)))},makeMap:function(n){return n.isMap=!0,n},functionCodeJS:function(n){var t=n.children[0].join(", "),o="",u="";return n.value==="op_map"&&(o="{ return  ",u=" }"),"function ("+t+`) {
var $oldscope$ = $jc$.scope;
$jc$.scope = $jc$.scopes[`+this.scope.id+`];
var r = (function () `+o+this.compile(n.children[1],!0)+u+`)();
$jc$.scope = $oldscope$;
return r;
}`},defineFunction:function(node){var fun,i,that=this,list=node.children[0],scope=this.pushScope(list);if(this.board.options.jc.compile){for(this.isLHS=!1,i=0;i<list.length;i++)scope.locals[list[i]]=list[i];this.replaceNames(node.children[1]),fun=function(jc){var fun,str="var f = function($jc$) { return "+jc.functionCodeJS(node)+"}; f;";try{for(fun=eval(str)(jc),scope.argtypes=[],i=0;i<list.length;i++)scope.argtypes.push(that.resolveType(list[i],node));return fun}catch(n){return jc._warn(`error compiling function

`+str+`

`+n.toString()),function(){}}}(this),this.popScope()}else fun=function(n,t,o){return function(){var u,d;for(d=t.scope,t.scope=t.scopes[o],u=0;u<n.length;u++)t.scope.locals[n[u]]=arguments[u];return u=t.execute(node.children[1]),t.scope=d,u}}(list,this,scope.id);return fun.node=node,fun.scope=scope,fun.toJS=fun.toString,fun.toString=function(n){return function(){return n.compile(n.replaceIDs(JXG$1.deepCopy(node)))}}(this),fun.deps={},this.collectDependencies(node.children[1],node.children[0],fun.deps),fun},mergeAttributes:function(n){var t,o={};for(t=0;t<arguments.length;t++)o=JXG$1.deepCopy(o,arguments[t],!0);return o},setProp:function(n,t,o){var u={},d,C;n.elementClass===Const.OBJECT_CLASS_POINT&&(t==="X"||t==="Y")?(t=t.toLowerCase(),n.isDraggable&&typeof o=="number"?(d=t==="x"?o:n.X(),C=t==="y"?o:n.Y(),n.setPosition(Const.COORDS_BY_USER,[d,C])):n.isDraggable&&(typeof o=="function"||typeof o=="string")?(d=t==="x"?o:n.coords.usrCoords[1],C=t==="y"?o:n.coords.usrCoords[2],n.addConstraint([d,C])):n.isDraggable||(d=t==="x"?o:n.XEval.origin,C=t==="y"?o:n.YEval.origin,n.addConstraint([d,C])),this.board.update()):n.elementClass===Const.OBJECT_CLASS_TEXT&&(t==="X"||t==="Y")?(typeof o=="number"?n[t]=function(){return o}:typeof o=="function"?(n.isDraggable=!1,n[t]=o):typeof o=="string"&&(n.isDraggable=!1,n[t]=JXG$1.createFunction(o,this.board),n[t+"jc"]=o),n[t].origin=o,this.board.update()):n.type&&n.elementClass&&n.visProp?JXG$1.exists(n[n.methodMap[t]])&&typeof n[n.methodMap[t]]!="function"?n[n.methodMap[t]]=o:(u[t]=o,n.setAttribute(u)):n[t]=o},_genericParse:function(n,t,o,u){var d,C,I,f,A=n.replace(/\r\n/g,`
`).split(`
`),y=[];u||(this.code+=n+`
`),Text&&(C=Text.prototype.setText,Text.prototype.setText=Text.prototype.setTextJessieCode);try{for(JXG$1.exists(o)||(o=!1),d=0;d<A.length;d++)o&&(A[d]=JXG$1.GeonextParser.geonext2JS(A[d],this.board)),y.push(A[d]);switch(n=y.join(`
`),I=parser.parse(n),this.CA&&(I=this.CA.expandDerivatives(I,null,I),I=this.CA.removeTrivialNodes(I)),t){case"parse":f=this.execute(I);break;case"manipulate":f=this.compile(I);break;case"getAst":f=I;break;default:f=!1}}catch(G){throw G}finally{Text&&(Text.prototype.setText=C)}return f},parse:function(n,t,o){return this._genericParse(n,"parse",t,o)},manipulate:function(n,t,o){return this._genericParse(n,"manipulate",t,o)},getAST:function(n,t,o){return this._genericParse(n,"getAst",t,o)},snippet:function(n,t,o,u,d){var C;return t=JXG$1.def(t,!0),o=JXG$1.def(o,""),u=JXG$1.def(u,!1),this.forceValueCall=JXG$1.def(d,!0),C=(t?" function ("+o+") { return ":"")+n+(t?"; }":"")+";",this.parse(C,u,!0)},replaceIDs:function(n){var t,o;if(n.replaced&&(o=this.board.objects[n.children[1][0].value],JXG$1.exists(o)&&o.name!==""&&(n.type="node_var",n.value=o.name,n.children.length=0,delete n.replaced)),JXG$1.isArray(n))for(t=0;t<n.length;t++)n[t]=this.replaceIDs(n[t]);if(n.children)for(t=n.children.length;t>0;t--)JXG$1.exists(n.children[t-1])&&(n.children[t-1]=this.replaceIDs(n.children[t-1]));return n},replaceNames:function(n,t){var o,u,d=!1;if(t!==void 0&&(d=t),u=n.value,n.type==="node_op"&&u==="op_lhs"&&n.children.length===1?this.isLHS=!0:n.type==="node_var"&&(this.isLHS?this.letvar(u,!0):!JXG$1.exists(this.getvar(u,!0))&&JXG$1.exists(this.board.elementsByName[u])&&(d&&this.board.elementsByName[u].elType!=="slider"&&(d=!1),n=this.createReplacementNode(n,d))),JXG$1.isArray(n))for(o=0;o<n.length;o++)n[o]=this.replaceNames(n[o],d);if(n.children)for(this.forceValueCall&&(n.value==="op_execfun"&&n.children[0].value!=="V"&&n.children[0].value!=="$"&&(JXG$1.exists(Math[n.children[0].value])||JXG$1.exists(Mat[n.children[0].value]))&&n.children[1][0].type==="node_var"||n.value==="op_return"&&n.children.length===1&&n.children[0].type==="node_var")&&(d=!0),o=n.children.length;o>0;o--)JXG$1.exists(n.children[o-1])&&(n.children[o-1]=this.replaceNames(n.children[o-1],d));return n.type==="node_op"&&n.value==="op_lhs"&&n.children.length===1&&(this.isLHS=!1),n},createReplacementNode:function(n,t){var o=n.value,u=this.board.elementsByName[o];return n=this.createNode("node_op","op_execfun",this.createNode("node_var",t===!0?"$value":"$"),[this.createNode("node_str",u.id)]),n.replaced=!0,n},collectDependencies:function(n,t,o){var u,d,C,I;if(JXG$1.isArray(n)){for(I=n.length,u=0;u<I;u++)this.collectDependencies(n[u],t,o);return}if(d=n.value,n.type==="node_var"&&t.indexOf(d)<0&&(C=this.getvar(d),C&&C.visProp&&C.elType&&C.elementClass&&C.id&&C.elType==="slider"&&(o[C.id]=C)),n.type==="node_op"&&n.value==="op_execfun"&&n.children.length>1&&(n.children[0].value==="$"||n.children[0].value==="$value")&&n.children[1].length>0&&(C=n.children[1][0].value,o[C]=this.board.objects[C]),n.children)for(u=n.children.length;u>0;u--)JXG$1.exists(n.children[u-1])&&this.collectDependencies(n.children[u-1],t,o)},resolveProperty:function(n,t,o){return o=JXG$1.def(o,!1),n&&n.methodMap&&(JXG$1.exists(n.subs)&&JXG$1.exists(n.subs[t])?n=n.subs:JXG$1.exists(n.methodMap[t])?t=n.methodMap[t]:(n=n.visProp,t=t.toLowerCase())),JXG$1.isFunction(n)&&this._error("Accessing function properties is not allowed."),JXG$1.exists(n)||this._error(n+" is not an object"),JXG$1.exists(n[t])||this._error("unknown property "+t),o&&typeof n[t]=="function"?function(){return n[t].apply(n,arguments)}:n[t]},resolveType:function(n,t){var o,u,d="any";if(JXG$1.isArray(t)){for(o=0;o<t.length;o++)if(u=this.resolveType(n,t[o]),u!=="any")return d=u,d}if(t.type==="node_op"&&t.value==="op_execfun"&&t.children[0].type==="node_var"&&t.children[0].value===n)return"function";if(t.type==="node_op"){for(o=0;o<t.children.length;o++)if(t.children[0].type==="node_var"&&t.children[0].value===n&&(t.value==="op_add"||t.value==="op_sub"||t.value==="op_mul"||t.value==="op_div"||t.value==="op_mod"||t.value==="op_exp"||t.value==="op_neg"))return"any";for(o=0;o<t.children.length;o++)if(u=this.resolveType(n,t.children[o]),u!=="any")return d=u,d}return"any"},getLHS:function(n){var t;if(n.type==="node_var")t={o:this.scope.locals,what:n.value};else if(n.type==="node_op"&&n.value==="op_property")t={o:this.execute(n.children[0]),what:n.children[1]};else if(n.type==="node_op"&&n.value==="op_extvalue")t={o:this.execute(n.children[0]),what:this.execute(n.children[1])};else throw new Error("Syntax error: Invalid left-hand side of assignment.");return t},getLHSCompiler:function(n,t){var o;if(n.type==="node_var")o=n.value;else if(n.type==="node_op"&&n.value==="op_property")o=[this.compile(n.children[0],t),"'"+n.children[1]+"'"];else if(n.type==="node_op"&&n.value==="op_extvalue")o=[this.compile(n.children[0],t),n.children[1].type==="node_const"?n.children[1].value:this.compile(n.children[1],t)];else throw new Error("Syntax error: Invalid left-hand side of assignment.");return o},execute:function(n){var t,o,u,d,C,I,f,A,y=[],G,S,w;if(t=0,!n)return t;switch(this.line=n.line,this.col=n.col,n.type){case"node_op":switch(n.value){case"op_none":n.children[0]&&this.execute(n.children[0]),n.children[1]&&(t=this.execute(n.children[1]));break;case"op_assign":o=this.getLHS(n.children[0]),this.lhs[this.scope.id]=o.what,o.o.type&&o.o.elementClass&&o.o.methodMap&&o.what==="label"&&this._error("Left-hand side of assignment is read-only."),t=this.execute(n.children[1]),o.o!==this.scope.locals||JXG$1.isArray(o.o)&&typeof o.what=="number"?this.setProp(o.o,o.what,t):this.letvar(o.what,t),this.lhs[this.scope.id]=0;break;case"op_if":this.execute(n.children[0])&&(t=this.execute(n.children[1]));break;case"op_conditional":case"op_if_else":this.execute(n.children[0])?t=this.execute(n.children[1]):t=this.execute(n.children[2]);break;case"op_while":for(;this.execute(n.children[0]);)this.execute(n.children[1]);break;case"op_do":do this.execute(n.children[0]);while(this.execute(n.children[1]));break;case"op_for":for(this.execute(n.children[0]);this.execute(n.children[1]);this.execute(n.children[2]))this.execute(n.children[3]);break;case"op_proplst":n.children[0]&&this.execute(n.children[0]),n.children[1]&&this.execute(n.children[1]);break;case"op_emptyobject":t={};break;case"op_proplst_val":this.propstack.push({}),this.propscope++,this.execute(n.children[0]),t=this.propstack[this.propscope],this.propstack.pop(),this.propscope--;break;case"op_prop":this.propstack[this.propscope][n.children[0]]=this.execute(n.children[1]);break;case"op_array":for(t=[],C=n.children[0].length,u=0;u<C;u++)t.push(this.execute(n.children[0][u]));break;case"op_extvalue":t=this.execute(n.children[0]),u=this.execute(n.children[1]),typeof u=="number"&&Math.abs(Math.round(u)-u)<Mat.eps?t=t[u]:t=I;break;case"op_return":if(this.scope===0)this._error("Unexpected return.");else return this.execute(n.children[0]);break;case"op_map":!n.children[1].isMath&&n.children[1].type!=="node_var"&&this._error("execute: In a map only function calls and mathematical expressions are allowed."),G=this.defineFunction(n),G.isMap=!0,t=G;break;case"op_function":G=this.defineFunction(n),G.isMap=!1,t=G;break;case"op_execfun":if(this.dpstack.push([]),this.pscope++,f=n.children[1],JXG$1.exists(n.children[2]))if(n.children[3])for(A=n.children[2],S={},u=0;u<A.length;u++)S=JXG$1.deepCopy(S,this.execute(A[u]),!0);else S=this.execute(n.children[2]);for(n.children[0]._isFunctionName=!0,G=this.execute(n.children[0]),delete n.children[0]._isFunctionName,JXG$1.exists(G)&&JXG$1.exists(G.sc)?w=G.sc:w=this,!G.creator&&JXG$1.exists(n.children[2])&&this._error("Unexpected value. Only element creators are allowed to have a value after the function call."),u=0;u<f.length;u++)JXG$1.exists(G.scope)&&JXG$1.exists(G.scope.argtypes)&&G.scope.argtypes[u]==="function"?(f[u]._isFunctionName=!0,y[u]=this.execute(f[u]),delete f[u]._isFunctionName):y[u]=this.execute(f[u]),this.dpstack[this.pscope].push({line:n.children[1][u].line,col:n.children[1][u].ecol});if(typeof G=="function"&&!G.creator)t=G.apply(w,y);else if(typeof G=="function"&&G.creator){d=this.line;try{for(t=G(y,S),t.jcLineStart=d,t.jcLineEnd=n.eline,u=d;u<=n.line;u++)this.lineToElement[u]=t;t.debugParents=this.dpstack[this.pscope]}catch(M){this._error(M.toString())}}else this._error("Function '"+G+"' is undefined.");this.dpstack.pop(),this.pscope--;break;case"op_property":d=this.execute(n.children[0]),o=n.children[1],t=this.resolveProperty(d,o,!1),JXG$1.exists(t)&&["number","string","boolean"].indexOf(typeof t)<0&&(t.sc=d);break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),this.use(n.children[0].toString());break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),o=this.getvar(n.children[0]),t=this.del(o);break;case"op_eq":t=this.execute(n.children[0])==this.execute(n.children[1]);break;case"op_neq":t=this.execute(n.children[0])!=this.execute(n.children[1]);break;case"op_approx":t=Math.abs(this.execute(n.children[0])-this.execute(n.children[1]))<Mat.eps;break;case"op_gt":t=this.execute(n.children[0])>this.execute(n.children[1]);break;case"op_lt":t=this.execute(n.children[0])<this.execute(n.children[1]);break;case"op_geq":t=this.execute(n.children[0])>=this.execute(n.children[1]);break;case"op_leq":t=this.execute(n.children[0])<=this.execute(n.children[1]);break;case"op_or":t=this.execute(n.children[0])||this.execute(n.children[1]);break;case"op_and":t=this.execute(n.children[0])&&this.execute(n.children[1]);break;case"op_not":t=!this.execute(n.children[0]);break;case"op_add":t=this.add(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_sub":t=this.sub(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_div":t=this.div(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_mod":t=this.mod(this.execute(n.children[0]),this.execute(n.children[1]),!0);break;case"op_mul":t=this.mul(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_exp":t=this.pow(this.execute(n.children[0]),this.execute(n.children[1]));break;case"op_neg":t=this.neg(this.execute(n.children[0]));break}break;case"node_var":t=this.getvar(n.value,!1,n._isFunctionName);break;case"node_const":n.value===null?t=null:t=Number(n.value);break;case"node_const_bool":t=n.value;break;case"node_str":t=n.value.replace(/\\(.)/g,"$1");break}return t},compile:function(n,t){var o,u,d,C="";if(JXG$1.exists(t)||(t=!1),!n)return C;switch(n.type){case"node_op":switch(n.value){case"op_none":n.children[0]&&(C=this.compile(n.children[0],t)),n.children[1]&&(C+=this.compile(n.children[1],t));break;case"op_assign":t?(o=this.getLHSCompiler(n.children[0],t),JXG$1.isArray(o)?C="$jc$.setProp("+o[0]+", "+o[1]+", "+this.compile(n.children[1],t)+`);
`:(this.isLocalVariable(o)!==this.scope&&(this.scope.locals[o]=!0),C="$jc$.scopes["+this.scope.id+"].locals['"+o+"'] = "+this.compile(n.children[1],t)+`;
`)):(o=this.compile(n.children[0]),C=o+" = "+this.compile(n.children[1],t)+`;
`);break;case"op_if":C=" if ("+this.compile(n.children[0],t)+") "+this.compile(n.children[1],t);break;case"op_if_else":C=" if ("+this.compile(n.children[0],t)+")"+this.compile(n.children[1],t),C+=" else "+this.compile(n.children[2],t);break;case"op_conditional":C="(("+this.compile(n.children[0],t)+")?("+this.compile(n.children[1],t),C+="):("+this.compile(n.children[2],t)+"))";break;case"op_while":C=" while ("+this.compile(n.children[0],t)+`) {
`+this.compile(n.children[1],t)+`}
`;break;case"op_do":C=` do {
`+this.compile(n.children[0],t)+"} while ("+this.compile(n.children[1],t)+`);
`;break;case"op_for":C=" for ("+this.compile(n.children[0],t)+this.compile(n.children[1],t)+"; "+this.compile(n.children[2],t).slice(0,-2)+`) {
`+this.compile(n.children[3],t)+`
}
`;break;case"op_proplst":n.children[0]&&(C=this.compile(n.children[0],t)+", "),C+=this.compile(n.children[1],t);break;case"op_prop":C=n.children[0]+": "+this.compile(n.children[1],t);break;case"op_emptyobject":C=t?"{}":"<< >>";break;case"op_proplst_val":C=this.compile(n.children[0],t);break;case"op_array":for(d=[],u=0;u<n.children[0].length;u++)d.push(this.compile(n.children[0][u],t));C="["+d.join(", ")+"]";break;case"op_extvalue":C=this.compile(n.children[0],t)+"["+this.compile(n.children[1],t)+"]";break;case"op_return":C=" return "+this.compile(n.children[0],t)+`;
`;break;case"op_map":!n.children[1].isMath&&n.children[1].type!=="node_var"&&this._error("compile: In a map only function calls and mathematical expressions are allowed."),d=n.children[0],t?C=" $jc$.makeMap(function ("+d.join(", ")+") { return "+this.compile(n.children[1],t)+"; })":C="map ("+d.join(", ")+") -> "+this.compile(n.children[1],t);break;case"op_function":d=n.children[0],this.pushScope(d),t?C=this.functionCodeJS(n):C=" function ("+d.join(", ")+") "+this.compile(n.children[1],t),this.popScope();break;case"op_execfunmath":console.log("op_execfunmath: TODO"),C="-1";break;case"op_execfun":if(n.children[2]){for(d=[],u=0;u<n.children[2].length;u++)d.push(this.compile(n.children[2][u],t));t?o="$jc$.mergeAttributes("+d.join(", ")+")":o=d.join(", ")}for(n.children[0].withProps=!!n.children[2],d=[],u=0;u<n.children[1].length;u++)d.push(this.compile(n.children[1][u],t));C=this.compile(n.children[0],t)+"("+d.join(", ")+(n.children[2]&&t?", "+o:"")+")"+(n.children[2]&&!t?" "+o:""),t&&(C+=`
`),t&&n.children[0].value==="$"&&(C="$jc$.board.objects["+this.compile(n.children[1][0],t)+"]");break;case"op_property":t&&n.children[1]!=="X"&&n.children[1]!=="Y"?C="$jc$.resolveProperty("+this.compile(n.children[0],t)+", '"+n.children[1]+"', true)":C=this.compile(n.children[0],t)+"."+n.children[1];break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),t?C="$jc$.use('":C="use('",C+=n.children[0].toString()+"');";break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),t?C="$jc$.del(":C="remove(",C+=this.compile(n.children[0],t)+")";break;case"op_eq":C="("+this.compile(n.children[0],t)+" === "+this.compile(n.children[1],t)+")";break;case"op_neq":C="("+this.compile(n.children[0],t)+" !== "+this.compile(n.children[1],t)+")";break;case"op_approx":C="("+this.compile(n.children[0],t)+" ~= "+this.compile(n.children[1],t)+")";break;case"op_gt":t?C="$jc$.gt("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" > "+this.compile(n.children[1],t)+")";break;case"op_lt":t?C="$jc$.lt("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" < "+this.compile(n.children[1],t)+")";break;case"op_geq":t?C="$jc$.geq("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" >= "+this.compile(n.children[1],t)+")";break;case"op_leq":t?C="$jc$.leq("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" <= "+this.compile(n.children[1],t)+")";break;case"op_or":C="("+this.compile(n.children[0],t)+" || "+this.compile(n.children[1],t)+")";break;case"op_and":C="("+this.compile(n.children[0],t)+" && "+this.compile(n.children[1],t)+")";break;case"op_not":C="!("+this.compile(n.children[0],t)+")";break;case"op_add":t?C="$jc$.add("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" + "+this.compile(n.children[1],t)+")";break;case"op_sub":t?C="$jc$.sub("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" - "+this.compile(n.children[1],t)+")";break;case"op_div":t?C="$jc$.div("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" / "+this.compile(n.children[1],t)+")";break;case"op_mod":t?C="$jc$.mod("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+", true)":C="("+this.compile(n.children[0],t)+" % "+this.compile(n.children[1],t)+")";break;case"op_mul":t?C="$jc$.mul("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+" * "+this.compile(n.children[1],t)+")";break;case"op_exp":t?C="$jc$.pow("+this.compile(n.children[0],t)+", "+this.compile(n.children[1],t)+")":C="("+this.compile(n.children[0],t)+"^"+this.compile(n.children[1],t)+")";break;case"op_neg":t?C="$jc$.neg("+this.compile(n.children[0],t)+")":C="(-"+this.compile(n.children[0],t)+")";break}break;case"node_var":t?C=this.getvarJS(n.value,!1,n.withProps):C=n.value;break;case"node_const":C=n.value;break;case"node_const_bool":C=n.value;break;case"node_str":C="'"+n.value+"'";break}return n.needsBrackets&&(C=`{
`+C+` }
`),n.needsAngleBrackets&&(t?C=`{
`+C+` }
`:C="<< "+C+` >>
`),C},getName:function(n,t){var o="";return JXG$1.exists(n)&&JXG$1.exists(n.getName)?(o=n.getName(),(!JXG$1.exists(o)||o==="")&&t&&(o=n.id)):t&&(o=n.id),o},X:function(n){return n.X()},Y:function(n){return n.Y()},V:function(n){return n.Value()},L:function(n){return n.L()},area:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Area))&&this._error("Error: Can't calculate area."),n.Area()},perimeter:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Perimeter))&&this._error("Error: Can't calculate perimeter."),n.Perimeter()},dist:function(n,t){return(!JXG$1.exists(n)||!JXG$1.exists(n.Dist))&&this._error("Error: Can't calculate distance."),n.Dist(t)},radius:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Radius))&&this._error("Error: Can't calculate radius."),n.Radius()},slope:function(n){return(!JXG$1.exists(n)||!JXG$1.exists(n.Slope))&&this._error("Error: Can't calculate slope."),n.Slope()},add:function(n,t){var o,u,d;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))d=Interval.add(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),d=[],o=0;o<u;o++)d[o]=n[o]+t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?d=n+t:JXG$1.isString(n)||JXG$1.isString(t)?d=n.toString()+t.toString():this._error("Operation + not defined on operands "+typeof n+" and "+typeof t);return d},sub:function(n,t){var o,u,d;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))d=Interval.sub(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))for(u=Math.min(n.length,t.length),d=[],o=0;o<u;o++)d[o]=n[o]-t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?d=n-t:this._error("Operation - not defined on operands "+typeof n+" and "+typeof t);return d},neg:function(n){var t,o,u;if(n=JXG$1.evalSlider(n),Interval.isInterval(n))u=Interval.negative(n);else if(JXG$1.isArray(n))for(o=n.length,u=[],t=0;t<o;t++)u[t]=-n[t];else JXG$1.isNumber(n)?u=-n:this._error("Unary operation - not defined on operand "+typeof n);return u},mul:function(n,t){var o,u,d;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),JXG$1.isArray(n)&&JXG$1.isNumber(t)&&(o=n,n=t,t=n),Interval.isInterval(n)||Interval.isInterval(t))d=Interval.mul(n,t);else if(JXG$1.isArray(n)&&JXG$1.isArray(t))u=Math.min(n.length,t.length),d=Mat.innerProduct(n,t,u);else if(JXG$1.isNumber(n)&&JXG$1.isArray(t))for(u=t.length,d=[],o=0;o<u;o++)d[o]=n*t[o];else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?d=n*t:this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return d},div:function(n,t){var o,u,d;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))d=Interval.div(n,t);else if(JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,d=[],o=0;o<u;o++)d[o]=n[o]/t;else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?d=n/t:this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return d},mod:function(n,t){var o,u,d;if(n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t))return Interval.fmod(n,t);if(JXG$1.isArray(n)&&JXG$1.isNumber(t))for(u=n.length,d=[],o=0;o<u;o++)d[o]=Mat.mod(n[o],t,!0);else JXG$1.isNumber(n)&&JXG$1.isNumber(t)?d=Mat.mod(n,t,!0):this._error("Operation * not defined on operands "+typeof n+" and "+typeof t);return d},pow:function(n,t){return n=JXG$1.evalSlider(n),t=JXG$1.evalSlider(t),Interval.isInterval(n)||Interval.isInterval(t)?Interval.pow(n,t):Mat.pow(n,t)},lt:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.lt(n,t):n<t},leq:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.leq(n,t):n<=t},gt:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.gt(n,t):n>t},geq:function(n,t){return Interval.isInterval(n)||Interval.isInterval(t)?Interval.geq(n,t):n>=t},randint:function(n,t,o){return JXG$1.exists(o)||(o=1),Math.round(Math.random()*(t-n)/o)*o+n},DDD:function(n){console.log("Dummy derivative function. This should never appear!")},ifthen:function(n,t,o){return n?t:o},del:function(n){typeof n=="object"&&JXG$1.exists(n.type)&&JXG$1.exists(n.elementClass)&&this.board.removeObject(n)},eval:function(n){return JXG$1.evaluate(n)},use:function(n){var t,o,u=!1;if(typeof n=="string"){for(t in JXG$1.boards)if(JXG$1.boards.hasOwnProperty(t)&&JXG$1.boards[t].container===n){o=JXG$1.boards[t],u=!0;break}}else o=n,u=!0;u?(this.board=o,this.builtIn.$board=o,this.builtIn.$board.src="$jc$.board"):this._error("Board '"+n+"' not found!")},findSymbol:function(n,t){var o,u;for(t=JXG$1.def(t,-1),t===-1?u=this.scope:u=this.scopes[t];u!==null;){for(o in u.locals)if(u.locals.hasOwnProperty(o)&&u.locals[o]===n)return[o,u];u=u.previous}return[]},importModule:function(n){return priv$4.modules[n.toLowerCase()]},defineBuiltIn:function(){var n=this,t={PI:Math.PI,EULER:Math.E,D:n.DDD,X:n.X,Y:n.Y,V:n.V,Value:n.V,L:n.L,Length:n.L,acosh:Mat.acosh,acot:Mat.acot,asinh:Mat.asinh,binomial:Mat.binomial,cbrt:Mat.cbrt,cosh:Mat.cosh,cot:Mat.cot,deg:Geometry.trueAngle,A:n.area,area:n.area,Area:n.area,perimeter:n.perimeter,Perimeter:n.perimeter,dist:n.dist,Dist:n.dist,R:n.radius,radius:n.radius,Radius:n.radius,erf:Mat.erf,erfc:Mat.erfc,erfi:Mat.erfi,factorial:Mat.factorial,gcd:Mat.gcd,lb:Mat.log2,lcm:Mat.lcm,ld:Mat.log2,lg:Mat.log10,ln:Math.log,log:Mat.log,log10:Mat.log10,log2:Mat.log2,ndtr:Mat.ndtr,ndtri:Mat.ndtri,nthroot:Mat.nthroot,pow:Mat.pow,rad:Geometry.rad,ratpow:Mat.ratpow,trunc:JXG$1.trunc,sinh:Mat.sinh,slope:n.slope,Slope:n.slope,randint:n.randint,IfThen:n.ifthen,import:n.importModule,eval:n.eval,use:n.use,remove:n.del,$:n.getElementById,$value:function(o){return n.getElementById(o).Value()},getName:n.getName,name:n.getName,$board:n.board,$log:n.log};return t.rad.sc=Geometry,t.deg.sc=Geometry,t.factorial.sc=Mat,t.X.src="$jc$.X",t.Y.src="$jc$.Y",t.V.src="$jc$.V",t.Value.src="$jc$.V",t.L.src="$jc$.L",t.Length.src="$jc$.L",t.acosh.src="JXG.Math.acosh",t.acot.src="JXG.Math.acot",t.asinh.src="JXG.Math.asinh",t.binomial.src="JXG.Math.binomial",t.cbrt.src="JXG.Math.cbrt",t.cot.src="JXG.Math.cot",t.cosh.src="JXG.Math.cosh",t.deg.src="JXG.Math.Geometry.trueAngle",t.erf.src="JXG.Math.erf",t.erfc.src="JXG.Math.erfc",t.erfi.src="JXG.Math.erfi",t.A.src="$jc$.area",t.area.src="$jc$.area",t.Area.src="$jc$.area",t.perimeter.src="$jc$.perimeter",t.Perimeter.src="$jc$.perimeter",t.dist.src="$jc$.dist",t.Dist.src="$jc$.dist",t.R.src="$jc$.radius",t.radius.src="$jc$.radius",t.Radius.src="$jc$.radius",t.factorial.src="JXG.Math.factorial",t.gcd.src="JXG.Math.gcd",t.lb.src="JXG.Math.log2",t.lcm.src="JXG.Math.lcm",t.ld.src="JXG.Math.log2",t.lg.src="JXG.Math.log10",t.ln.src="Math.log",t.log.src="JXG.Math.log",t.log10.src="JXG.Math.log10",t.log2.src="JXG.Math.log2",t.ndtr.src="JXG.Math.ndtr",t.ndtri.src="JXG.Math.ndtri",t.nthroot.src="JXG.Math.nthroot",t.pow.src="JXG.Math.pow",t.rad.src="JXG.Math.Geometry.rad",t.ratpow.src="JXG.Math.ratpow",t.trunc.src="JXG.trunc",t.sinh.src="JXG.Math.sinh",t.slope.src="$jc$.slope",t.Slope.src="$jc$.slope",t.randint.src="$jc$.randint",t.import.src="$jc$.importModule",t.eval.src="$jc$.eval",t.use.src="$jc$.use",t.remove.src="$jc$.del",t.IfThen.src="$jc$.ifthen",t.$.src="(function (n) { return $jc$.board.select(n); })",t.$value.src="(function (n) { return $jc$.board.select(n).Value(); })",t.getName.src="$jc$.getName",t.name.src="$jc$.getName",t.$board&&(t.$board.src="$jc$.board"),t.$log.src="$jc$.log",t=JXG$1.merge(t,n._addedBuiltIn),t},_addedBuiltIn:{},addBuiltIn:function(n,t){if(JXG$1.exists(this.builtIn)){if(JXG$1.exists(this.builtIn[n]))return;this.builtIn[n]=t,this.builtIn[n].src="$jc$."+n}JXG$1.exists(this._addedBuiltIn[n])||(this._addedBuiltIn[n]=t,this._addedBuiltIn[n].src="$jc$."+n,JXG$1.JessieCode.prototype[n]=t)},getPossibleOperands:function(){var n=["E"],t=this.builtIn||this.defineBuiltIn(),o=Math,u,d,C,I,f,A,y,G,S,w,M,V,T,H;for(T=function(J,z){return J.toLowerCase().localeCompare(z.toLowerCase())},H=function(J,z){var L=null;if(z==="jc")L=t[J];else if(z==="Math")L=o[J];else return;if(!(n.indexOf(J)>=0)){if(JXG$1.isFunction(L))return{name:J,type:"function",numParams:L.length,origin:z};if(JXG$1.isNumber(L))return{name:J,type:"constant",value:L,origin:z};J.startsWith("$")||L!==void 0&&console.error("undefined type",L)}},u=Object.getOwnPropertyNames(t).sort(T),d=Object.getOwnPropertyNames(o).sort(T),C=[],I=0,f=0;I<u.length||f<d.length;)u[I]===d[f]?(A=H(d[f],"Math"),JXG$1.exists(A)&&C.push(A),I++,f++):!JXG$1.exists(d[f])||u[I].toLowerCase().localeCompare(d[f].toLowerCase())<0?(A=H(u[I],"jc"),JXG$1.exists(A)&&C.push(A),I++):(A=H(d[f],"Math"),JXG$1.exists(A)&&C.push(A),f++);for(S=[],w=[],M=[],V={},y=C.length,I=0;I<y;I++){switch(G=C[I],G.type){case"function":S.push(G.name),G.origin==="jc"&&w.push(G.name);break;case"constant":M.push(G.name);break}V[G.name]=G}return{all:V,list:C,functions:S,functions_jessiecode:w,constants:M}},_debug:function(n){typeof console=="object"?console.log(n):JXG$1.isBrowser&&document&&document.getElementById("debug")!==null&&(document.getElementById("debug").innerHTML+=n+"<br />")},_error:function(n){var t=new Error("Error("+this.line+"): "+n);throw t.line=this.line,t},_warn:function(n){typeof console=="object"?console.log("Warning("+this.line+"): "+n):JXG$1.isBrowser&&document&&document.getElementById(this.warnLog)!==null&&(document.getElementById(this.warnLog).innerHTML+="Warning("+this.line+"): "+n+"<br />")},_log:function(n){typeof window!="object"&&typeof self=="object"&&self.postMessage?self.postMessage({type:"log",msg:"Log: "+n.toString()}):console.log("Log: ",arguments)}});var parser=function(){var n=function(Yt,Oe,gt,pt){for(gt=gt||{},pt=Yt.length;pt--;gt[Yt[pt]]=Oe);return gt},t=[2,14],o=[1,13],u=[1,37],d=[1,14],C=[1,15],I=[1,21],f=[1,16],A=[1,17],y=[1,33],G=[1,18],S=[1,19],w=[1,12],M=[1,59],V=[1,60],T=[1,58],H=[1,46],J=[1,48],z=[1,49],L=[1,50],K=[1,51],O=[1,52],Q=[1,53],ee=[1,54],ie=[1,45],te=[1,38],se=[1,39],ae=[5,7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],le=[5,7,8,12,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],ge=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],be=[2,48],Xe=[1,72],Ce=[10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,66,83,86],Re=[1,78],Se=[8,10,16,32,34,35,37,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],Ze=[1,82],he=[8,10,16,32,34,35,37,39,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],Ie=[1,83],Be=[1,84],ue=[1,85],me=[8,10,16,32,34,35,37,39,41,42,43,50,51,53,54,55,57,64,65,66,83,86],xe=[1,89],Je=[1,90],Ve=[1,91],Ee=[1,92],Ct=[1,97],st=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,53,54,55,57,64,65,66,83,86],wt=[1,103],Qe=[1,104],Ue=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,57,64,65,66,83,86],Ge=[1,105],Gt=[1,106],ot=[1,107],vt=[1,126],at=[1,139],Tt=[83,86],xt=[1,150],ve=[10,66,86],de=[8,10,16,20,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,82,83,86],De=[1,167],nt=[10,86],dt={trace:function(){},yy:{},symbols_:{error:2,Program:3,StatementList:4,EOF:5,IfStatement:6,IF:7,"(":8,Expression:9,")":10,Statement:11,ELSE:12,LoopStatement:13,WHILE:14,FOR:15,";":16,DO:17,UnaryStatement:18,USE:19,IDENTIFIER:20,DELETE:21,ReturnStatement:22,RETURN:23,EmptyStatement:24,StatementBlock:25,"{":26,"}":27,ExpressionStatement:28,AssignmentExpression:29,ConditionalExpression:30,LeftHandSideExpression:31,"=":32,LogicalORExpression:33,"?":34,":":35,LogicalANDExpression:36,"||":37,EqualityExpression:38,"&&":39,RelationalExpression:40,"==":41,"!=":42,"~=":43,AdditiveExpression:44,"<":45,">":46,"<=":47,">=":48,MultiplicativeExpression:49,"+":50,"-":51,UnaryExpression:52,"*":53,"/":54,"%":55,ExponentExpression:56,"^":57,"!":58,MemberExpression:59,CallExpression:60,PrimaryExpression:61,FunctionExpression:62,MapExpression:63,".":64,"[":65,"]":66,BasicLiteral:67,ObjectLiteral:68,ArrayLiteral:69,NullLiteral:70,BooleanLiteral:71,StringLiteral:72,NumberLiteral:73,NULL:74,TRUE:75,FALSE:76,STRING:77,NUMBER:78,NAN:79,INFINITY:80,ElementList:81,"<<":82,">>":83,PropertyList:84,Property:85,",":86,PropertyName:87,Arguments:88,AttributeList:89,Attribute:90,FUNCTION:91,ParameterDefinitionList:92,MAP:93,"->":94,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"IF",8:"(",10:")",12:"ELSE",14:"WHILE",15:"FOR",16:";",17:"DO",19:"USE",20:"IDENTIFIER",21:"DELETE",23:"RETURN",26:"{",27:"}",32:"=",34:"?",35:":",37:"||",39:"&&",41:"==",42:"!=",43:"~=",45:"<",46:">",47:"<=",48:">=",50:"+",51:"-",53:"*",54:"/",55:"%",57:"^",58:"!",64:".",65:"[",66:"]",74:"NULL",75:"TRUE",76:"FALSE",77:"STRING",78:"NUMBER",79:"NAN",80:"INFINITY",82:"<<",83:">>",86:",",91:"FUNCTION",93:"MAP",94:"->"},productions_:[0,[3,2],[6,5],[6,7],[13,5],[13,9],[13,7],[18,2],[18,2],[22,2],[22,3],[24,1],[25,3],[4,2],[4,0],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[28,2],[9,1],[29,1],[29,3],[30,1],[30,5],[33,1],[33,3],[36,1],[36,3],[38,1],[38,3],[38,3],[38,3],[40,1],[40,3],[40,3],[40,3],[40,3],[44,1],[44,3],[44,3],[49,1],[49,3],[49,3],[49,3],[56,1],[56,3],[52,1],[52,2],[52,2],[52,2],[31,1],[31,1],[59,1],[59,1],[59,1],[59,3],[59,4],[61,1],[61,1],[61,1],[61,1],[61,3],[67,1],[67,1],[67,1],[67,1],[70,1],[71,1],[71,1],[72,1],[73,1],[73,1],[73,1],[69,2],[69,3],[68,2],[68,3],[84,1],[84,3],[85,3],[87,1],[87,1],[87,1],[60,2],[60,3],[60,2],[60,4],[60,3],[88,2],[88,3],[89,1],[89,3],[90,1],[90,1],[81,1],[81,3],[62,4],[62,5],[63,5],[63,6],[92,1],[92,3]],performAction:function(Oe,gt,pt,mt,It,ye,Ye){var _e=ye.length-1;switch(It){case 1:return ye[_e-1];case 2:this.$=ze.createNode(rt(Ye[_e-4]),"node_op","op_if",ye[_e-2],ye[_e]);break;case 3:this.$=ze.createNode(rt(Ye[_e-6]),"node_op","op_if_else",ye[_e-4],ye[_e-2],ye[_e]);break;case 4:this.$=ze.createNode(rt(Ye[_e-4]),"node_op","op_while",ye[_e-2],ye[_e]);break;case 5:this.$=ze.createNode(rt(Ye[_e-8]),"node_op","op_for",ye[_e-6],ye[_e-4],ye[_e-2],ye[_e]);break;case 6:this.$=ze.createNode(rt(Ye[_e-6]),"node_op","op_do",ye[_e-5],ye[_e-2]);break;case 7:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_use",ye[_e]);break;case 8:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_delete",ye[_e]);break;case 9:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_return",void 0);break;case 10:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_return",ye[_e-1]);break;case 11:case 14:this.$=ze.createNode(rt(Ye[_e]),"node_op","op_none");break;case 12:this.$=ye[_e-1],this.$.needsBrackets=!0;break;case 13:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_none",ye[_e-1],ye[_e]);break;case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 23:case 24:case 26:case 28:case 30:case 32:case 36:case 41:case 44:case 48:case 50:case 52:case 54:case 55:case 56:case 58:case 62:case 81:case 84:case 85:case 86:this.$=ye[_e];break;case 22:case 65:case 93:this.$=ye[_e-1];break;case 25:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_assign",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 27:this.$=ze.createNode(rt(Ye[_e-4]),"node_op","op_conditional",ye[_e-4],ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 29:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_or",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 31:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_and",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 33:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_eq",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 34:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_neq",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 35:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_approx",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 37:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_lt",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 38:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_gt",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 39:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_leq",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 40:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_geq",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 42:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_add",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 43:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_sub",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 45:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_mul",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 46:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_div",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 47:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_mod",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 49:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_exp",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 51:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_not",ye[_e]),this.$.isMath=!1;break;case 53:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_neg",ye[_e]),this.$.isMath=!0;break;case 57:case 63:case 64:case 66:case 67:case 68:case 97:this.$=ye[_e],this.$.isMath=!1;break;case 59:case 91:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_property",ye[_e-2],ye[_e]),this.$.isMath=!0;break;case 60:case 90:this.$=ze.createNode(rt(Ye[_e-3]),"node_op","op_extvalue",ye[_e-3],ye[_e-1]),this.$.isMath=!0;break;case 61:this.$=ze.createNode(rt(Ye[_e]),"node_var",ye[_e]);break;case 69:this.$=ye[_e],this.$.isMath=!0;break;case 70:this.$=ze.createNode(rt(Ye[_e]),"node_const",null);break;case 71:this.$=ze.createNode(rt(Ye[_e]),"node_const_bool",!0);break;case 72:this.$=ze.createNode(rt(Ye[_e]),"node_const_bool",!1);break;case 73:this.$=ze.createNode(rt(Ye[_e]),"node_str",ye[_e].substring(1,ye[_e].length-1));break;case 74:this.$=ze.createNode(rt(Ye[_e]),"node_const",parseFloat(ye[_e]));break;case 75:this.$=ze.createNode(rt(Ye[_e]),"node_const",NaN);break;case 76:this.$=ze.createNode(rt(Ye[_e]),"node_const",1/0);break;case 77:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_array",[]);break;case 78:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_array",ye[_e-1]);break;case 79:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_emptyobject",{}),this.$.needsAngleBrackets=!0;break;case 80:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_proplst_val",ye[_e-1]),this.$.needsAngleBrackets=!0;break;case 82:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_proplst",ye[_e-2],ye[_e]);break;case 83:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_prop",ye[_e-2],ye[_e]);break;case 87:case 89:this.$=ze.createNode(rt(Ye[_e-1]),"node_op","op_execfun",ye[_e-1],ye[_e]),this.$.isMath=!0;break;case 88:this.$=ze.createNode(rt(Ye[_e-2]),"node_op","op_execfun",ye[_e-2],ye[_e-1],ye[_e],!0),this.$.isMath=!1;break;case 92:this.$=[];break;case 94:case 98:case 104:this.$=[ye[_e]];break;case 95:case 99:case 105:this.$=ye[_e-2].concat(ye[_e]);break;case 96:this.$=ze.createNode(rt(Ye[_e]),"node_var",ye[_e]),this.$.isMath=!0;break;case 100:this.$=ze.createNode(rt(Ye[_e-3]),"node_op","op_function",[],ye[_e]),this.$.isMath=!1;break;case 101:this.$=ze.createNode(rt(Ye[_e-4]),"node_op","op_function",ye[_e-2],ye[_e]),this.$.isMath=!1;break;case 102:this.$=ze.createNode(rt(Ye[_e-4]),"node_op","op_map",[],ye[_e]);break;case 103:this.$=ze.createNode(rt(Ye[_e-5]),"node_op","op_map",ye[_e-3],ye[_e]);break}},table:[n([5,7,8,14,15,16,17,19,20,21,23,26,50,51,58,65,74,75,76,77,78,79,80,82,91,93],t,{3:1,4:2}),{1:[3]},{5:[1,3],6:6,7:o,8:u,9:20,11:4,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{1:[2,1]},n(ae,[2,13]),n(le,[2,15]),n(le,[2,16]),n(le,[2,17]),n(le,[2,18]),n(le,[2,19]),n(le,[2,20]),n(le,[2,21]),n([7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],t,{4:61}),{8:[1,62]},{8:[1,63]},{8:[1,64]},{6:6,7:o,8:u,9:20,11:65,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{20:[1,66]},{20:[1,67]},{8:u,9:69,16:[1,68],20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{16:[1,70]},n(le,[2,11]),n(ge,[2,23]),n(ge,[2,24]),n([8,10,16,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],be,{32:[1,71],57:Xe}),n([8,10,16,32,35,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],[2,26],{34:[1,73],37:[1,74]}),n(Ce,[2,54],{88:77,8:Re,64:[1,75],65:[1,76]}),n(Ce,[2,55],{88:79,8:Re,64:[1,81],65:[1,80]}),n(Se,[2,28],{39:Ze}),n(ge,[2,56]),n(ge,[2,57]),n(ge,[2,58]),n(he,[2,30],{41:Ie,42:Be,43:ue}),n(ge,[2,61]),n(ge,[2,62]),n(ge,[2,63]),n(ge,[2,64]),{8:u,9:86,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:[1,87]},{8:[1,88]},n(me,[2,32],{45:xe,46:Je,47:Ve,48:Ee}),n(ge,[2,66]),n(ge,[2,67]),n(ge,[2,68]),n(ge,[2,69]),{20:Ct,72:98,73:99,77:K,78:O,79:Q,80:ee,83:[1,93],84:94,85:95,87:96},{8:u,20:y,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,66:[1,100],67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,81:101,82:ie,91:te,93:se},n(st,[2,36],{50:wt,51:Qe}),n(ge,[2,70]),n(ge,[2,71]),n(ge,[2,72]),n(ge,[2,73]),n(ge,[2,74]),n(ge,[2,75]),n(ge,[2,76]),n(Ue,[2,41],{53:Ge,54:Gt,55:ot}),n(ge,[2,44]),n(ge,[2,50]),{8:u,20:y,31:109,50:M,51:V,52:108,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:110,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:111,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{6:6,7:o,8:u,9:20,11:4,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,27:[1,112],28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:113,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:114,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:115,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{14:[1,116]},n(le,[2,7]),n(le,[2,8]),n(le,[2,9]),{16:[1,117]},n(le,[2,22]),{8:u,20:y,29:118,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:119,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,29:120,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,36:121,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{20:[1,122]},{8:u,9:123,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(ge,[2,87],{89:124,90:125,68:127,20:vt,82:ie}),{8:u,10:[1,128],20:y,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,81:129,82:ie,91:te,93:se},n(ge,[2,89]),{8:u,9:130,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{20:[1,131]},{8:u,20:y,31:109,38:132,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,40:133,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,40:134,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,40:135,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{10:[1,136]},{10:[1,137],20:at,92:138},{10:[1,140],20:at,92:141},{8:u,20:y,31:109,44:142,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,44:143,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,44:144,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,44:145,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(ge,[2,79]),{83:[1,146],86:[1,147]},n(Tt,[2,81]),{35:[1,148]},{35:[2,84]},{35:[2,85]},{35:[2,86]},n(ge,[2,77]),{66:[1,149],86:xt},n(ve,[2,98]),{8:u,20:y,31:109,49:151,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,49:152,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:153,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:154,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,31:109,50:M,51:V,52:155,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(ge,[2,51]),n([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],be,{57:Xe}),n(ge,[2,52]),n(ge,[2,53]),n([5,7,8,10,12,14,15,16,17,19,20,21,23,26,27,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,58,64,65,66,74,75,76,77,78,79,80,82,83,86,91,93],[2,12]),{10:[1,156]},{10:[1,157]},{16:[1,158]},{8:[1,159]},n(le,[2,10]),n(ge,[2,25]),n(ge,[2,49]),{35:[1,160]},n(Se,[2,29],{39:Ze}),n(ge,[2,59]),{66:[1,161]},n([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83],[2,88],{86:[1,162]}),n(ge,[2,94]),n(ge,[2,96]),n(ge,[2,97]),n(de,[2,92]),{10:[1,163],86:xt},{66:[1,164]},n(ge,[2,91]),n(he,[2,31],{41:Ie,42:Be,43:ue}),n(me,[2,33],{45:xe,46:Je,47:Ve,48:Ee}),n(me,[2,34],{45:xe,46:Je,47:Ve,48:Ee}),n(me,[2,35],{45:xe,46:Je,47:Ve,48:Ee}),n(ge,[2,65]),{25:165,26:w},{10:[1,166],86:De},n(nt,[2,104]),{94:[1,168]},{10:[1,169],86:De},n(st,[2,37],{50:wt,51:Qe}),n(st,[2,38],{50:wt,51:Qe}),n(st,[2,39],{50:wt,51:Qe}),n(st,[2,40],{50:wt,51:Qe}),n(ge,[2,80]),{20:Ct,72:98,73:99,77:K,78:O,79:Q,80:ee,85:170,87:96},{8:u,20:y,29:171,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(ge,[2,78]),{8:u,20:y,29:172,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(Ue,[2,42],{53:Ge,54:Gt,55:ot}),n(Ue,[2,43],{53:Ge,54:Gt,55:ot}),n(ge,[2,45]),n(ge,[2,46]),n(ge,[2,47]),{6:6,7:o,8:u,9:20,11:173,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{6:6,7:o,8:u,9:20,11:174,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:175,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:176,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,20:y,29:177,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(ge,[2,60]),{20:vt,68:127,82:ie,90:178},n(de,[2,93]),n(ge,[2,90]),n(ge,[2,100]),{25:179,26:w},{20:[1,180]},{8:u,9:181,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{94:[1,182]},n(Tt,[2,82]),n(Tt,[2,83]),n(ve,[2,99]),n(ae,[2,2],{12:[1,183]}),n(le,[2,4]),{16:[1,184]},{10:[1,185]},n(ge,[2,27]),n(ge,[2,95]),n(ge,[2,101]),n(nt,[2,105]),n(ge,[2,102]),{8:u,9:186,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{6:6,7:o,8:u,9:20,11:187,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{8:u,9:188,20:y,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},{16:[1,189]},n(ge,[2,103]),n(le,[2,3]),{10:[1,190]},n(le,[2,6]),{6:6,7:o,8:u,9:20,11:191,13:7,14:d,15:C,16:I,17:f,18:8,19:A,20:y,21:G,22:9,23:S,24:11,25:5,26:w,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:M,51:V,52:56,56:57,58:T,59:26,60:27,61:29,62:30,63:31,65:H,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:J,75:z,76:L,77:K,78:O,79:Q,80:ee,82:ie,91:te,93:se},n(le,[2,5])],defaultActions:{3:[2,1],97:[2,84],98:[2,85],99:[2,86]},parseError:function(Oe,gt){if(gt.recoverable)this.trace(Oe);else{var pt=new Error(Oe);throw pt.hash=gt,pt}},parse:function(Oe){var gt=this,pt=[0],mt=[null],It=[],ye=this.table,Ye="",_e=0,Ne=0,St=2,et=1,lt=It.slice.call(arguments,1),yt=Object.create(this.lexer),_t={yy:{}};for(var Jt in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Jt)&&(_t.yy[Jt]=this.yy[Jt]);yt.setInput(Oe,_t.yy),_t.yy.lexer=yt,_t.yy.parser=this,typeof yt.yylloc>"u"&&(yt.yylloc={});var oi=yt.yylloc;It.push(oi);var Si=yt.options&&yt.options.ranges;typeof _t.yy.parseError=="function"?this.parseError=_t.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var ni=function(){var Qt;return Qt=yt.lex()||et,typeof Qt!="number"&&(Qt=gt.symbols_[Qt]||Qt),Qt},gi,Ri,vn,Ts,mn={},Bn,Vn,ss,Ti;;){if(Ri=pt[pt.length-1],this.defaultActions[Ri]?vn=this.defaultActions[Ri]:((gi===null||typeof gi>"u")&&(gi=ni()),vn=ye[Ri]&&ye[Ri][gi]),typeof vn>"u"||!vn.length||!vn[0]){var Ji="";Ti=[];for(Bn in ye[Ri])this.terminals_[Bn]&&Bn>St&&Ti.push("'"+this.terminals_[Bn]+"'");yt.showPosition?Ji="Parse error on line "+(_e+1)+`:
`+yt.showPosition()+`
Expecting `+Ti.join(", ")+", got '"+(this.terminals_[gi]||gi)+"'":Ji="Parse error on line "+(_e+1)+": Unexpected "+(gi==et?"end of input":"'"+(this.terminals_[gi]||gi)+"'"),this.parseError(Ji,{text:yt.match,token:this.terminals_[gi]||gi,line:yt.yylineno,loc:oi,expected:Ti})}if(vn[0]instanceof Array&&vn.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Ri+", token: "+gi);switch(vn[0]){case 1:pt.push(gi),mt.push(yt.yytext),It.push(yt.yylloc),pt.push(vn[1]),gi=null,Ne=yt.yyleng,Ye=yt.yytext,_e=yt.yylineno,oi=yt.yylloc;break;case 2:if(Vn=this.productions_[vn[1]][1],mn.$=mt[mt.length-Vn],mn._$={first_line:It[It.length-(Vn||1)].first_line,last_line:It[It.length-1].last_line,first_column:It[It.length-(Vn||1)].first_column,last_column:It[It.length-1].last_column},Si&&(mn._$.range=[It[It.length-(Vn||1)].range[0],It[It.length-1].range[1]]),Ts=this.performAction.apply(mn,[Ye,Ne,_e,_t.yy,vn[1],mt,It].concat(lt)),typeof Ts<"u")return Ts;Vn&&(pt=pt.slice(0,-1*Vn*2),mt=mt.slice(0,-1*Vn),It=It.slice(0,-1*Vn)),pt.push(this.productions_[vn[1]][0]),mt.push(mn.$),It.push(mn._$),ss=ye[pt[pt.length-2]][pt[pt.length-1]],pt.push(ss);break;case 3:return!0}}return!0}},ze={node:function(Yt,Oe,gt){return{type:Yt,value:Oe,children:gt}},createNode:function(Yt,Oe,gt,pt){var mt,It=this.node(Oe,gt,[]);for(mt=3;mt<arguments.length;mt++)It.children.push(arguments[mt]);return It.line=Yt[0],It.col=Yt[1],It.eline=Yt[2],It.ecol=Yt[3],It}},rt=function(Yt){return[Yt.first_line,Yt.first_column,Yt.last_line,Yt.last_column]},Rt=function(){var Yt={EOF:1,parseError:function(gt,pt){if(this.yy.parser)this.yy.parser.parseError(gt,pt);else throw new Error(gt)},setInput:function(Oe,gt){return this.yy=gt||this.yy||{},this._input=Oe,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var Oe=this._input[0];this.yytext+=Oe,this.yyleng++,this.offset++,this.match+=Oe,this.matched+=Oe;var gt=Oe.match(/(?:\r\n?|\n).*/g);return gt?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),Oe},unput:function(Oe){var gt=Oe.length,pt=Oe.split(/(?:\r\n?|\n)/g);this._input=Oe+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-gt),this.offset-=gt;var mt=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),pt.length-1&&(this.yylineno-=pt.length-1);var It=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:pt?(pt.length===mt.length?this.yylloc.first_column:0)+mt[mt.length-pt.length].length-pt[0].length:this.yylloc.first_column-gt},this.options.ranges&&(this.yylloc.range=[It[0],It[0]+this.yyleng-gt]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(Oe){this.unput(this.match.slice(Oe))},pastInput:function(){var Oe=this.matched.substr(0,this.matched.length-this.match.length);return(Oe.length>20?"...":"")+Oe.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var Oe=this.match;return Oe.length<20&&(Oe+=this._input.substr(0,20-Oe.length)),(Oe.substr(0,20)+(Oe.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var Oe=this.pastInput(),gt=new Array(Oe.length+1).join("-");return Oe+this.upcomingInput()+`
`+gt+"^"},test_match:function(Oe,gt){var pt,mt,It;if(this.options.backtrack_lexer&&(It={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(It.yylloc.range=this.yylloc.range.slice(0))),mt=Oe[0].match(/(?:\r\n?|\n).*/g),mt&&(this.yylineno+=mt.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:mt?mt[mt.length-1].length-mt[mt.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+Oe[0].length},this.yytext+=Oe[0],this.match+=Oe[0],this.matches=Oe,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(Oe[0].length),this.matched+=Oe[0],pt=this.performAction.call(this,this.yy,this,gt,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),pt)return pt;if(this._backtrack){for(var ye in It)this[ye]=It[ye];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var Oe,gt,pt,mt;this._more||(this.yytext="",this.match="");for(var It=this._currentRules(),ye=0;ye<It.length;ye++)if(pt=this._input.match(this.rules[It[ye]]),pt&&(!gt||pt[0].length>gt[0].length)){if(gt=pt,mt=ye,this.options.backtrack_lexer){if(Oe=this.test_match(pt,It[ye]),Oe!==!1)return Oe;if(this._backtrack){gt=!1;continue}else return!1}else if(!this.options.flex)break}return gt?(Oe=this.test_match(gt,It[mt]),Oe!==!1?Oe:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var gt=this.next();return gt||this.lex()},begin:function(gt){this.conditionStack.push(gt)},popState:function(){var gt=this.conditionStack.length-1;return gt>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(gt){return gt=this.conditionStack.length-1-Math.abs(gt||0),gt>=0?this.conditionStack[gt]:"INITIAL"},pushState:function(gt){this.begin(gt)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(gt,pt,mt,It){switch(mt){case 0:break;case 1:return 78;case 2:return 78;case 3:return 77;case 4:return 77;case 5:break;case 6:break;case 7:return 7;case 8:return 12;case 9:return 14;case 10:return 17;case 11:return 15;case 12:return 91;case 13:return 93;case 14:return 19;case 15:return 23;case 16:return 21;case 17:return 75;case 18:return 76;case 19:return 74;case 20:return 80;case 21:return 94;case 22:return 94;case 23:return 82;case 24:return 83;case 25:return 26;case 26:return 27;case 27:return 16;case 28:return"#";case 29:return 34;case 30:return 35;case 31:return 79;case 32:return 64;case 33:return 65;case 34:return 66;case 35:return 8;case 36:return 10;case 37:return 58;case 38:return 57;case 39:return 57;case 40:return 53;case 41:return 54;case 42:return 55;case 43:return 50;case 44:return 51;case 45:return 47;case 46:return 45;case 47:return 48;case 48:return 46;case 49:return 41;case 50:return 43;case 51:return 42;case 52:return 39;case 53:return 37;case 54:return 32;case 55:return 86;case 56:return 5;case 57:return 20;case 58:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+\b)/,/^(?:[0-9]+)/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:\/\/.*)/,/^(?:\/\*(.|\n|\r)*?\*\/)/,/^(?:if\b)/,/^(?:else\b)/,/^(?:while\b)/,/^(?:do\b)/,/^(?:for\b)/,/^(?:function\b)/,/^(?:map\b)/,/^(?:use\b)/,/^(?:return\b)/,/^(?:delete\b)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:Infinity\b)/,/^(?:->)/,/^(?:=>)/,/^(?:<<)/,/^(?:>>)/,/^(?:\{)/,/^(?:\})/,/^(?:;)/,/^(?:#)/,/^(?:\?)/,/^(?::)/,/^(?:NaN\b)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:!)/,/^(?:\^)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\/)/,/^(?:%)/,/^(?:\+)/,/^(?:-)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:==)/,/^(?:~=)/,/^(?:!=)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:=)/,/^(?:,)/,/^(?:$)/,/^(?:[A-Za-z_\$][A-Za-z0-9_]*)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58],inclusive:!0}}};return Yt}();dt.lexer=Rt;function Mt(){this.yy={}}return Mt.prototype=dt,dt.Parser=Mt,new Mt}();parser.yy.parseError=parser.parseError;const JessieCode=JXG$1.JessieCode;JXG$1.Composition=function(n){var t,o=this,u=["setAttribute","setParents","prepareUpdate","updateRenderer","update","fullUpdate","highlight","noHighlight"],d=function(C){return function(){var I;for(I in o.elements)o.elements.hasOwnProperty(I)&&JXG$1.exists(o.elements[I][C])&&o.elements[I][C].apply(o.elements[I],arguments);return o}};for(t=0;t<u.length;t++)this[u[t]]=d(u[t]);this.elements={},this.objects=this.elements,this.elementsByName={},this.objectsList=[],this.groups={},this.methodMap={setAttribute:"setAttribute",setProperty:"setAttribute",setParents:"setParents",add:"add",remove:"remove",select:"select"};for(t in n)n.hasOwnProperty(t)&&this.add(t,n[t]);this.dump=!0,this.subs={}};JXG$1.extend(JXG$1.Composition.prototype,{add:function(n,t){return!JXG$1.exists(this[n])&&JXG$1.exists(t)?(JXG$1.exists(t.id)?this.elements[t.id]=t:this.elements[n]=t,JXG$1.exists(t.name)&&(this.elementsByName[t.name]=t),t.on("attribute:name",this.nameListener,this),this.objectsList.push(t),this[n]=t,this.methodMap[n]=t,!0):!1},remove:function(n){var t=!1,o;for(o in this.elements)if(this.elements.hasOwnProperty(o)&&this.elements[o].id===this[n].id){t=!0;break}return t&&(delete this.elements[this[n].id],delete this[n]),t},nameListener:function(n,t,o){delete this.elementsByName[n],this.elementsByName[t]=o},select:function(n){return JXG$1.exists(JXG$1.Board)?JXG$1.Board.prototype.select.call(this,n):new JXG$1.Composition},getParents:function(){return this.parents},getType:function(){return this.elType},getAttributes:function(){var n;for(n in this.subs)this.subs.hasOwnProperty(n)&&this.subs[n].visProp;return this.attr}});const Composition=JXG$1.Composition;JXG$1.Board=function(n,t,o,u,d,C,I,f,A,y,G){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,JXG$1.exists(G.document)&&G.document!==!1?this.document=G.document:JXG$1.isBrowser&&(this.document=document),this.container="",this.id="",this.containerObj=null,JXG$1.isString(n)?(this.container=n,this.containerObj=JXG$1.isBrowser?this.document.getElementById(this.container):null):JXG$1.isBrowser&&(this.containerObj=n,this.container=this.containerObj.getAttribute("id"),this.container===null&&(this.container="null"+parseInt(Math.random()*16777216).toString())),JXG$1.isBrowser&&t.type!=="no"&&this.containerObj===null)throw new Error(`
JSXGraph: HTML container element "`+n+'" not found.');JXG$1.exists(o)&&o!==""&&JXG$1.isBrowser&&!JXG$1.exists(this.document.getElementById(o))?this.id=o:this.id=this.generateId(),this.renderer=t,this.grids=[],this.options=JXG$1.deepCopy(Options),this.attr=G,this.attr.theme!=="default"&&JXG$1.exists(JXG$1.themes[this.attr.theme])&&JXG$1.mergeAttr(this.options,JXG$1.themes[this.attr.theme],!0),this.dimension=2,this.jc=new JessieCode,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,u[0],u[1]],this.zoomX=d,this.zoomY=C,this.unitX=I*this.zoomX,this.unitY=f*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=A,this.canvasHeight=y,EventEmitter.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.clickObjects={},this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this.resizeHandlers=[],this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=JXG$1.Math,this.attr.registerevents===!0?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:typeof this.attr.registerevents=="object"&&(JXG$1.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),JXG$1.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),JXG$1.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),JXG$1.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),JXG$1.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),this.attr.registerevents!==!1&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",getBoundingBox:"getBoundingBox",BoundingBox:"getBoundingBox",getView:"getBoundingBox",View:"getBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}};JXG$1.extend(JXG$1.Board.prototype,{generateName:function(n){var t,o,u=this.attr.maxnamelength,d="",C="",I=[],f="";if(n.type===Const.OBJECT_TYPE_TICKS)return"";for(JXG$1.isPoint(n)||JXG$1.isPoint3D(n)?t=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:n.type===Const.OBJECT_TYPE_ANGLE?t=["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:t=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],!JXG$1.isPoint(n)&&!JXG$1.isPoint3D(n)&&n.elementClass!==Const.OBJECT_CLASS_LINE&&n.type!==Const.OBJECT_TYPE_ANGLE&&(n.type===Const.OBJECT_TYPE_POLYGON?d="P_{":n.elementClass===Const.OBJECT_CLASS_CIRCLE?d="k_{":n.elementClass===Const.OBJECT_CLASS_TEXT?d="t_{":d="s_{",C="}"),o=0;o<u;o++)I[o]=0;for(;I[u-1]<t.length;){for(I[0]=1;I[0]<t.length;I[0]++){for(f=d,o=u;o>0;o--)f+=t[I[o-1]];if(!JXG$1.exists(this.elementsByName[f+C]))return f+C}for(I[0]=t.length,o=1;o<u;o++)I[o-1]===t.length&&(I[o-1]=1,I[o]+=1)}return""},generateId:function(){for(var n=1;JXG$1.exists(JXG$1.boards["jxgBoard"+n]);)n=Math.round(Math.random()*16777216);return"jxgBoard"+n},setId:function(n,t){var o,u=this.numObjects,d=n.id;if(this.numObjects+=1,d===""||!JXG$1.exists(d))for(d=this.id+t+u;JXG$1.exists(this.objects[d]);)o=Math.round(Math.random()*65535),d=this.id+t+u+"-"+o;return n.id=d,this.objects[d]=n,n._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=n,d},finalizeAdding:function(n){JXG$1.evaluate(n.visProp.visible)===!1&&this.renderer.display(n,!1)},finalizeLabel:function(n){n.hasLabel&&!JXG$1.evaluate(n.label.visProp.islabel)&&JXG$1.evaluate(n.label.visProp.visible)===!1&&this.renderer.display(n.label,!1)},checkFrameRate:function(n){var t=!1,o=new Date().getTime();return JXG$1.exists(n.pointerId)&&this.touchMoveLastId!==n.pointerId&&(t=!0,this.touchMoveLastId=n.pointerId),!t&&(o-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(t=!0),t&&(this.touchMoveLast=o),t},getCoordsTopLeftCorner:function(){var n,t,o,u=this.document.ownerDocument||this.document,d=u.documentElement||this.document.body.parentNode,C=u.body,I=this.containerObj,f,A;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||new Date().getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=new Date().getTime(),I.getBoundingClientRect){for(o=I.getBoundingClientRect(),f=1,A=I;A&&JXG$1.exists(A.parentNode);)JXG$1.exists(A.style)&&JXG$1.exists(A.style.zoom)&&A.style.zoom!==""&&(f*=parseFloat(A.style.zoom)),A=A.parentNode;return n=[o.left*f,o.top*f],n[0]+=JXG$1.getProp(I,"border-left-width"),n[1]+=JXG$1.getProp(I,"border-top-width"),this.renderer.type!=="vml"&&(n[0]+=JXG$1.getProp(I,"padding-left"),n[1]+=JXG$1.getProp(I,"padding-top")),this.cPos=n.slice(),this.cPos}return n=JXG$1.getOffset(I),t=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&t.defaultView&&(n[0]+=JXG$1.getProp(d,"margin-left"),n[1]+=JXG$1.getProp(d,"margin-top"),n[0]+=JXG$1.getProp(d,"border-left-width"),n[1]+=JXG$1.getProp(d,"border-top-width"),n[0]+=JXG$1.getProp(d,"padding-left"),n[1]+=JXG$1.getProp(d,"padding-top")),C&&(n[0]+=JXG$1.getProp(C,"left"),n[1]+=JXG$1.getProp(C,"top")),typeof google=="object"&&google.translate&&(n[0]+=10,n[1]+=25),n[0]+=JXG$1.getProp(I,"border-left-width"),n[1]+=JXG$1.getProp(I,"border-top-width"),this.renderer.type!=="vml"&&(n[0]+=JXG$1.getProp(I,"padding-left"),n[1]+=JXG$1.getProp(I,"padding-top")),n[0]+=this.attr.offsetx,n[1]+=this.attr.offsety,this.cPos=n.slice(),this.cPos},getPointLoc:function(n,t){var o,u,d,C;return o=this.getBoundingBox(),u=n,u.length===2&&u.unshift(void 0),d=[0,0],C=t||0,JXG$1.isNumber(C)&&(C=[C,C,C,C]),u[1]>o[2]-C[1]&&(d[0]=1),u[1]<o[0]+C[3]&&(d[0]=-1),u[2]>o[1]-C[0]&&(d[1]=1),u[2]<o[3]+C[2]&&(d[1]=-1),d},getLocationOrigin:function(n){return this.getPointLoc([0,0],n)},getMousePosition:function(n,t){var o=this.getCoordsTopLeftCorner(),u,d;return u=JXG$1.getPosition(n,t,this.document),this.updateCSSTransforms(),d=[1,u[0]-o[0],u[1]-o[1]],d=Mat.matVecMult(this.cssTransMat,d),d[1]/=d[0],d[2]/=d[0],[d[1],d[2]]},initMoveOrigin:function(n,t){this.drag_dx=n-this.origin.scrCoords[1],this.drag_dy=t-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(n,t,o,u){var d,C,I=[],f=[],A,y=this.objectsList.length,G={visProp:{layer:-1e4}};for(this._shiftKey=o.shiftKey,this._ctrlKey=o.ctrlKey,C=0;C<y;C++)d=this.objectsList[C],A=d.hasPoint&&d.hasPoint(n,t),d.visPropCalc.visible&&A&&(d.triggerEventHandlers([u+"down","down"],[o]),this.downObjects.push(d)),A&&d.isDraggable&&d.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(d)||d.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(d.visProp.fixed)&&(d.visProp.layer>G.visProp.layer||d.visProp.layer===G.visProp.layer&&d.lastDragTime.getTime()>=G.lastDragTime.getTime())&&(!this.attr.ignorelabels||!JXG$1.exists(G.label)||d!==G.label)&&(G=d,I.push(G),JXG$1.exists(G.coords)?f.push(Statistics.subtract(G.coords.scrCoords.slice(1),[n,t])):f.push([0,0]));return this.attr.drag.enabled&&I.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(I.length=1,this._drag_offset=f[0]):(I=I.slice(-1),this._drag_offset=f[f.length-1]),this._drag_offset||(this._drag_offset=[0,0]),this.renderer.type==="svg"&&JXG$1.exists(I[0])&&JXG$1.evaluate(I[0].visProp.dragtotopoflayer)&&I.length===1&&JXG$1.exists(I[0].rendNode)&&I[0].rendNode.parentNode.appendChild(I[0].rendNode),I.length>=1&&(I[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[o,I[0]])),I},moveObject:function(n,t,o,u,d){var C=new Coords(Const.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(n,t),this),I,f,A;o&&o.obj&&(I=o.obj,I.coords&&(f=I.coords.scrCoords.slice()),this.addLogEntry("drag",I,C.usrCoords.slice(1)),this.drag_position=[C.scrCoords[1],C.scrCoords[2]],this.drag_position=Statistics.add(this.drag_position,this._drag_offset),this._shiftKey=u.shiftKey,this._ctrlKey=u.ctrlKey,JXG$1.exists(I.coords)?I.setPositionDirectly(Const.COORDS_BY_SCREEN,this.drag_position):(this.displayInfobox(!1),isNaN(o.targets[0].Xprev+o.targets[0].Yprev)||I.setPositionDirectly(Const.COORDS_BY_SCREEN,[C.scrCoords[1],C.scrCoords[2]],[o.targets[0].Xprev,o.targets[0].Yprev]),o.targets[0].Xprev=C.scrCoords[1],o.targets[0].Yprev=C.scrCoords[2]),JXG$1.exists(I.coords)&&(I.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(I),I.prepareUpdate().update(!0).updateRenderer()),I.coords&&(A=I.coords.scrCoords),(!I.coords||f[1]!==A[1]||f[2]!==A[2])&&(I.triggerEventHandlers([d+"drag","drag"],[u]),this.update()),I.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[u,I]),I.lastDragTime=new Date)},twoFingerMove:function(n,t,o){var u;if(JXG$1.exists(n)&&JXG$1.exists(n.obj))u=n.obj;else return;u.elementClass===Const.OBJECT_CLASS_LINE||u.type===Const.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(n.targets,u,t):u.elementClass===Const.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(n.targets,u,t),o&&u.triggerEventHandlers(["touchdrag","drag"],[o])},getTwoFingerTransform(n,t,o,u){var d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q;return d=new Coords(Const.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this).usrCoords,C=d[1],I=d[2],d=new Coords(Const.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this).usrCoords,f=d[1],A=d[2],d=new Coords(Const.COORDS_BY_SCREEN,[n.X,n.Y],this).usrCoords,S=d[1],w=d[2],d=new Coords(Const.COORDS_BY_SCREEN,[t.X,t.Y],this).usrCoords,M=d[1],V=d[2],y=f-C,G=A-I,T=M-S,H=V-w,L=y*y+G*G,J=(T*y+H*G)/L,z=(H*y-T*G)/L,o||(Q=Mat.hypot(J,z),J/=Q,z/=Q),u||(z=0),K=.5*(S+M-J*(C+f)+z*(I+A)),O=.5*(w+V-z*(C+f)-J*(I+A)),[1,0,0,K,J,-z,O,z,J]},twoFingerTouchObject:function(n,t,o){var u,d,C,I,f,A,y=!1;if(JXG$1.exists(n[0])&&JXG$1.exists(n[1])&&!isNaN(n[0].Xprev+n[0].Yprev+n[1].Xprev+n[1].Yprev)){if(d=this.getTwoFingerTransform(n[0],n[1],JXG$1.evaluate(t.visProp.scalable),JXG$1.evaluate(t.visProp.rotatable)),u=this.create("transform",d,{type:"generic"}),u.update(),t.elementClass===Const.OBJECT_CLASS_LINE)C=[],t.point1.draggable()&&C.push(t.point1),t.point2.draggable()&&C.push(t.point2),u.applyOnce(C);else if(t.type===Const.OBJECT_TYPE_POLYGON){for(f=t.vertices.length-1,A=t.visProp,y=JXG$1.evaluate(A.snaptogrid)||JXG$1.evaluate(A.snaptopoints),I=0;I<f&&!y;++I)A=t.vertices[I].visProp,y=y||JXG$1.evaluate(A.snaptogrid)||JXG$1.evaluate(A.snaptopoints),y=y||!t.vertices[I].draggable();if(!y){for(C=[],I=0;I<f;++I)t.vertices[I].draggable()&&C.push(t.vertices[I]);u.applyOnce(C)}}this.update(),t.highlight(!0)}},twoFingerTouchCircle:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M;t.method==="pointCircle"||t.method==="pointLine"||JXG$1.exists(n[0])&&JXG$1.exists(n[1])&&!isNaN(n[0].Xprev+n[0].Yprev+n[1].Xprev+n[1].Yprev)&&(o===n[0].num?(u=n[1],d=n[0]):(u=n[0],d=n[1]),f=new Coords(Const.COORDS_BY_SCREEN,[u.Xprev,u.Yprev],this).usrCoords,I=new Coords(Const.COORDS_BY_SCREEN,[d.Xprev,d.Yprev],this).usrCoords,C=new Coords(Const.COORDS_BY_SCREEN,[d.X,d.Y],this).usrCoords,y=Geometry.rad(I.slice(1),f.slice(1),C.slice(1)),G=this.create("transform",[-f[1],-f[2]],{type:"translate"}),S=this.create("transform",[y],{type:"rotate"}),G.melt(S),JXG$1.evaluate(t.visProp.scalable)&&(A=Geometry.distance(f,C)/Geometry.distance(f,I),w=this.create("transform",[A,A],{type:"scale"}),G.melt(w)),M=this.create("transform",[f[1],f[2]],{type:"translate"}),G.melt(M),t.center.draggable()&&G.applyOnce([t.center]),t.method==="twoPoints"?t.point2.draggable()&&G.applyOnce([t.point2]):t.method==="pointRadius"&&JXG$1.isNumber(t.updateRadius.origin)&&t.setRadius(t.radius*A),this.update(t.center),t.highlight(!0))},highlightElements:function(n,t,o,u){var d,C,I,f={},A=this.objectsList.length;for(d=0;d<A;d++)C=this.objectsList[d],I=C.id,JXG$1.exists(C.hasPoint)&&C.visPropCalc.visible&&C.hasPoint(n,t)&&(this.updateInfobox(C),JXG$1.exists(this.highlightedObjects[I])||(f[I]=C,C.highlight(),this.triggerEventHandlers(["mousehit","hit"],[o,C,u])),C.mouseover?C.triggerEventHandlers(["mousemove","move"],[o]):(C.triggerEventHandlers(["mouseover","over"],[o]),C.mouseover=!0));for(d=0;d<A;d++)C=this.objectsList[d],I=C.id,C.mouseover&&(f[I]||(C.triggerEventHandlers(["mouseout","out"],[o]),C.mouseover=!1))},saveStartPos:function(n,t){var o=[],u,d;if(n.type===Const.OBJECT_TYPE_TICKS)o.push([1,NaN,NaN]);else if(n.elementClass===Const.OBJECT_CLASS_LINE)o.push(n.point1.coords.usrCoords),o.push(n.point2.coords.usrCoords);else if(n.elementClass===Const.OBJECT_CLASS_CIRCLE)o.push(n.center.coords.usrCoords),n.method==="twoPoints"&&o.push(n.point2.coords.usrCoords);else if(n.type===Const.OBJECT_TYPE_POLYGON)for(d=n.vertices.length-1,u=0;u<d;u++)o.push(n.vertices[u].coords.usrCoords);else if(n.type===Const.OBJECT_TYPE_SECTOR)o.push(n.point1.coords.usrCoords),o.push(n.point2.coords.usrCoords),o.push(n.point3.coords.usrCoords);else if(JXG$1.isPoint(n)||n.type===Const.OBJECT_TYPE_GLIDER)o.push(n.coords.usrCoords);else if(n.elementClass===Const.OBJECT_CLASS_CURVE)n.points.length>0&&o.push(n.points[0].usrCoords);else try{o.push(n.coords.usrCoords)}catch(C){JXG$1.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+C)}for(d=o.length,u=0;u<d;u++)t.Zstart.push(o[u][0]),t.Xstart.push(o[u][1]),t.Ystart.push(o[u][2])},mouseOriginMoveStart:function(n){var t,o;return t=this._isRequiredKeyPressed(n,"pan"),t&&(o=this.getMousePosition(n),this.initMoveOrigin(o[0],o[1])),t},mouseOriginMove:function(n){var t=this.mode===this.BOARD_MODE_MOVE_ORIGIN,o;return t&&(o=this.getMousePosition(n),this.moveOrigin(o[0],o[1],!0)),t},touchStartMoveOriginOneFinger:function(n){var t=n.touches,o,u;return o=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&t.length===1,o&&(u=this.getMousePosition(n,0),this.initMoveOrigin(u[0],u[1])),o},touchOriginMove:function(n){var t=this.mode===this.BOARD_MODE_MOVE_ORIGIN,o;return t&&(o=this.getMousePosition(n,0),this.moveOrigin(o[0],o[1],!0)),t},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},suppressDefault:function(n){return JXG$1.exists(n)&&n.preventDefault(),!1},addEventHandlers:function(){JXG$1.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),this.containerObj!==null&&JXG$1.addEvent(this.containerObj,"contextmenu",this.suppressDefault,this)},removeEventHandlers:function(){(this.hasPointerHandlers||this.hasMouseHandlers||this.hasTouchHandlers)&&this.containerObj!==null&&JXG$1.removeEvent(this.containerObj,"contextmenu",this.suppressDefault,this),this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),this.removeResizeEventHandlers()},addResizeEventHandlers:function(){if(this.resizeHandlers=[],JXG$1.isBrowser){try{this.startResizeObserver(),this.resizeHandlers.push("resizeobserver")}catch{JXG$1.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver(),this.resizeHandlers.push("resize")}JXG$1.addEvent(window,"scroll",this.scrollListener,this),this.resizeHandlers.push("scroll");try{window.matchMedia("print").addEventListener("change",this.printListenerMatch.bind(this)),window.matchMedia("screen").addEventListener("change",this.printListenerMatch.bind(this)),this.resizeHandlers.push("print")}catch(n){JXG$1.debug("Error adding printListener",n)}}},removeResizeEventHandlers:function(){var n,t;if(this.resizeHandlers.length>0&&JXG$1.isBrowser){for(n=0;n<this.resizeHandlers.length;n++)switch(t=this.resizeHandlers[n],t){case"resizeobserver":JXG$1.exists(this.resizeObserver)&&this.stopResizeObserver();break;case"resize":JXG$1.removeEvent(window,"resize",this.resizeListener,this),JXG$1.exists(this.intersectionObserver)&&this.stopIntersectionObserver();break;case"scroll":JXG$1.removeEvent(window,"scroll",this.scrollListener,this);break;case"print":window.matchMedia("print").removeEventListener("change",this.printListenerMatch.bind(this),!1),window.matchMedia("screen").removeEventListener("change",this.printListenerMatch.bind(this),!1);break}this.resizeHandlers=[]}},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.addEvent(n,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.addEvent(n,"pointermove",this.pointerMoveListener,this),JXG$1.addEvent(n,"pointerleave",this.pointerLeaveListener,this),JXG$1.addEvent(n,"click",this.pointerClickListener,this),JXG$1.addEvent(n,"dblclick",this.pointerDblClickListener,this)),this.containerObj!==null&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.addEvent(n,"mousemove",this.mouseMoveListener,this),JXG$1.addEvent(n,"click",this.mouseClickListener,this),JXG$1.addEvent(n,"dblclick",this.mouseDblClickListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(n){if(!this.hasTouchHandlers&&JXG$1.isBrowser){var t=this.attr.movetarget||this.containerObj;JXG$1.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.addEvent(t,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var n,t=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],o=t.length;if(!this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(n=0;n<o;n++)JXG$1.addEvent(this.document,t[n],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.addEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&JXG$1.isBrowser&&(JXG$1.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),JXG$1.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),JXG$1.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var n,t=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],o=t.length;if(this.hasFullscreenEventHandlers&&JXG$1.isBrowser){for(n=0;n<o;n++)JXG$1.removeEvent(this.document,t[n],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(JXG$1.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),JXG$1.removeEvent(n,"MSPointerMove",this.pointerMoveListener,this)):(JXG$1.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),JXG$1.removeEvent(n,"pointermove",this.pointerMoveListener,this),JXG$1.removeEvent(n,"pointerleave",this.pointerLeaveListener,this),JXG$1.removeEvent(n,"click",this.pointerClickListener,this),JXG$1.removeEvent(n,"dblclick",this.pointerDblClickListener,this)),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),JXG$1.removeEvent(n,"mousemove",this.mouseMoveListener,this),JXG$1.removeEvent(n,"click",this.mouseClickListener,this),JXG$1.removeEvent(n,"dblclick",this.mouseDblClickListener,this),this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(JXG$1.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),JXG$1.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&JXG$1.isBrowser){var n=this.attr.movetarget||this.containerObj;JXG$1.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),JXG$1.removeEvent(n,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-this.canvasWidth*.1,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-this.canvasHeight*.1),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+this.canvasHeight*.1),this},gestureChangeListener:function(n){var t,o=[],u=[],d,C=10,I=!1,f=this.attr.zoom.factorx,A=this.attr.zoom.factory,y,G,S,w,M,V=!1,T,H,J,z;return this.mode!==this.BOARD_MODE_ZOOM?!0:(n.preventDefault(),G=Geometry.distance([n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY],2),n.scale===void 0&&(n.scale=G/this.prevDist),!JXG$1.exists(this.prevCoords)||(o=[n.touches[0].clientX-this.prevCoords[0][0],n.touches[0].clientY-this.prevCoords[0][1]],u=[n.touches[1].clientX-this.prevCoords[1][0],n.touches[1].clientY-this.prevCoords[1][1]],o[0]*o[0]+o[1]*o[1]<C*C&&u[0]*u[0]+u[1]*u[1]<C*C)||(d=Geometry.rad(o,[0,0],u),this.isPreviousGesture!=="pan"&&Math.abs(d)>Math.PI*.2&&Math.abs(d)<Math.PI*1.8&&(I=!0),this.isPreviousGesture!=="pan"&&!I&&(Math.abs(n.scale)<.77||Math.abs(n.scale)>1.3)&&(I=!0),y=n.scale/this.prevScale,this.prevScale=n.scale,this.prevCoords=[[n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY]],t=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(n,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!I?(this.isPreviousGesture="pan",this.moveOrigin(t.scrCoords[1],t.scrCoords[2],!0)):this.attr.zoom.enabled&&Math.abs(y-1)<.5&&(V=!1,M=this.attr.zoom.center,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(T=Math.abs(n.touches[0].clientX-n.touches[1].clientX),H=Math.abs(n.touches[0].clientY-n.touches[1].clientY),S=Math.abs(Math.atan2(H,T)),w=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&S<w?(this.attr.zoom.factorx=y,this.attr.zoom.factory=1,J=0,z=0,V=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(S-Math.PI*.5)<w?(this.attr.zoom.factorx=1,this.attr.zoom.factory=y,J=0,z=0,V=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=y,this.attr.zoom.factory=y,J=t.usrCoords[1],z=t.usrCoords[2],V=!0),V&&(M==="board"?this.zoomIn():this.zoomIn(J,z),this.attr.zoom.factorx=f,this.attr.zoom.factory=A))),!1)},gestureStartListener:function(n){var t;return n.preventDefault(),this.prevScale=1,this.prevDist=Geometry.distance([n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY],2),this.prevCoords=[[n.touches[0].clientX,n.touches[0].clientY],[n.touches[1].clientX,n.touches[1].clientY]],this.isPreviousGesture="none",t=this.getMousePosition(n,0),this.initMoveOrigin(t[0],t[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(n,t){var o=this.attr[t];return o.enabled?!!((o.needshift&&n.shiftKey||!o.needshift&&!n.shiftKey)&&(o.needctrl&&n.ctrlKey||!o.needctrl&&!n.ctrlKey)):!1},_isPointerRegistered:function(n){var t,o=this._board_touches.length;for(t=0;t<o;t++)if(this._board_touches[t].pointerId===n.pointerId)return!0;return!1},_pointerStorePosition:function(n){var t,o;for(t=0,o=!1;t<this._board_touches.length;t++)if(this._board_touches[t].pointerId===n.pointerId){this._board_touches[t].clientX=n.clientX,this._board_touches[t].clientY=n.clientY,o=!0;break}return!o&&this._board_touches.length<2&&this._board_touches.push({pointerId:n.pointerId,clientX:n.clientX,clientY:n.clientY}),this},_pointerRemoveTouches:function(n){var t;for(t=0;t<this._board_touches.length;t++)if(this._board_touches[t].pointerId===n.pointerId){this._board_touches.splice(t,1);break}return this},_pointerClearTouches:function(n){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(n){if(JXG$1.isBrowser){if(n.pointerType==="touch"||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if(n.pointerType==="mouse")return"mouse";if(n.pointerType==="pen")return"pen"}return"mouse"},pointerDownListener:function(n,t,o){var u,d,C,I,f,A,y,G="mouse",S,w,M;if(!t&&this._isPointerRegistered(n))return!1;if(JXG$1.evaluate(this.attr.movetarget)===null&&JXG$1.exists(n.target)&&JXG$1.exists(n.target.releasePointerCapture)&&n.target.releasePointerCapture(n.pointerId),!t&&n.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?JXG$1.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.addEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&JXG$1.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(A=window.getSelection(),A.removeAllRanges))try{A.removeAllRanges()}catch{}if(this._inputDevice=this._getPointerInputDevice(n),G=this._inputDevice,this.options.precision.hasPoint=this.options.precision[G],I=this.getMousePosition(n),this._testForSelection(n),this.selectingMode){this._startSelecting(I),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[n]);return}if(this.attr.drag.enabled&&t?(f=[t],this.mode=this.BOARD_MODE_DRAG):f=this.initMoveObject(I[0],I[1],n,G),y={num:n.pointerId,X:I[0],Y:I[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},f.length>0){for(w=f[f.length-1],S=!1,u=0;u<this.touches.length;u++)if(this.touches[u].obj===w){d=u,C=this.touches[u].targets.push(y)-1,S=!0;break}S||(C=0,d=this.touches.push({obj:w,targets:[y]})-1),this.dehighlightAll(),w.highlight(!0),this.saveStartPos(w,this.touches[d].targets[C]),n&&n.preventDefault&&!o&&n.preventDefault()}return this.touches.length>0&&!o&&(n.preventDefault(),n.stopPropagation()),JXG$1.isBrowser?(this._getPointerInputDevice(n)!=="touch"?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(n):(this._pointerStorePosition(n),n.touches=this._board_touches,n.touches.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(n)||n.touches.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(n))),M="none",this.mode===this.BOARD_MODE_NONE&&JXG$1.evaluate(this.attr.browserpan)&&!(JXG$1.evaluate(this.attr.pan.enabled)&&!JXG$1.evaluate(this.attr.pan.needtwofingers))&&(M="pan-x pan-y"),this.containerObj.style.touchAction=M,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[n]),!0):!1},_handleClicks:function(n,t){var o=this,u,d,C;if(this.selectingMode){n.stopPropagation();return}if(d=JXG$1.evaluate(this.attr.clickdelay),C=JXG$1.evaluate(this.attr.dblclicksuppressclick),C)this._preventSingleClick=!1,this._singleClickTimer=setTimeout(function(){if(!o._preventSingleClick){o.triggerEventHandlers(t,[n]);for(u in o.clickObjects)o.clickObjects.hasOwnProperty(u)&&(o.clickObjects[u].triggerEventHandlers(t,[n]),delete o.clickObjects[u])}},d);else{o.triggerEventHandlers(t,[n]);for(u in o.clickObjects)o.clickObjects.hasOwnProperty(u)&&o.clickObjects[u].triggerEventHandlers(t,[n]);setTimeout(function(){for(u in o.clickObjects)o.clickObjects.hasOwnProperty(u)&&delete o.clickObjects[u]},d)}n.stopPropagation()},_handleDblClicks:function(n,t){var o;if(this.selectingMode){n.stopPropagation();return}this._preventSingleClick=!0,clearTimeout(this._singleClickTimer),this.triggerEventHandlers(t,[n]);for(o in this.clickObjects)this.clickObjects.hasOwnProperty(o)&&(this.clickObjects[o].triggerEventHandlers(t,[n]),delete this.clickObjects[o]);n.stopPropagation()},pointerClickListener:function(n){this._handleClicks(n,["click","pointerclick"])},pointerDblClickListener:function(n){this._handleDblClicks(n,["dblclick","pointerdblclick"])},mouseClickListener:function(n){this._handleClicks(n,["click","mouseclick"])},mouseDblClickListener:function(n){this._handleDblClicks(n,["dblclick","mousedblclick"])},pointerMoveListener:function(n){var t,o,u,d,C,I="mouse";if(this._getPointerInputDevice(n)==="touch"&&!this._isPointerRegistered(n))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(n))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(n.preventDefault(),n.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(n),I=this._inputDevice,this.options.precision.hasPoint=this.options.precision[I],d=this.options.precision.hasPoint*.3333,u=this.getMousePosition(n),JXG$1.evaluate(this.attr.movetarget)===null&&u[0]<=d||u[1]<=d||u[0]>=this.canvasWidth-d||u[1]>=this.canvasHeight-d)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(u),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[n,this.mode]);else if(!this.mouseOriginMove(n))if(this.mode===this.BOARD_MODE_DRAG){for(t=0;t<this.touches.length;t++)for(C=this.touches[t].targets,o=0;o<C.length;o++)if(C[o].num===n.pointerId){C[o].X=u[0],C[o].Y=u[1],C.length===1?this.moveObject(u[0],u[1],this.touches[t],n,I):C.length===2&&(this.twoFingerMove(this.touches[t],n.pointerId,n),C[o].Xprev=u[0],C[o].Yprev=u[1]);break}}else this._getPointerInputDevice(n)==="touch"&&(this._pointerStorePosition(n),this._board_touches.length===2&&(n.touches=this._board_touches,this.gestureChangeListener(n))),this.highlightElements(u[0],u[1],n,-1);return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[n,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(n){var t,o,u,d,C,I=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[n]),this.displayInfobox(!1),n){for(t=0;t<this.touches.length;t++)for(C=this.touches[t].targets,o=0;o<C.length;o++)if(C[o].num===n.pointerId){C.splice(o,1),C.length===0&&this.touches.splice(t,1);break}}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[n]),this.stopSelectionMode();else for(t=this.downObjects.length-1;t>-1;t--){for(u=!1,o=0;o<this.touches.length;o++)this.touches[o].obj.id===this.downObjects[t].id&&(u=!0);u||(this.downObjects[t].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[n]),JXG$1.exists(this.downObjects[t].coords)||(this.downObjects[t].snapToGrid(),this.downObjects[t].snapToPoints(),I=!0),d=this.downObjects[t].eventHandlers,(JXG$1.exists(d.click)&&d.click.length>0||JXG$1.exists(d.pointerclick)&&d.pointerclick.length>0||JXG$1.exists(d.dblclick)&&d.dblclick.length>0||JXG$1.exists(d.pointerdblclick)&&d.pointerdblclick.length>0)&&(this.clickObjects[this.downObjects[t].id]=this.downObjects[t]),this.downObjects.splice(t,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?JXG$1.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(JXG$1.removeEvent(this.document,"pointerup",this.pointerUpListener,this),JXG$1.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(n.pointerId),this._getPointerInputDevice(n)!=="touch"&&this.dehighlightAll(),I&&this.update(),!0},pointerLeaveListener:function(n){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(n){var t,o,u,d,C,I=this.options.precision.touch,f,A,y,G=n.touches,S,w;for(this.hasTouchEnd||(JXG$1.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,t=0;t<G.length;t++)G[t].jxg_isused=!1;for(t=0;t<this.touches.length;t++)for(w=this.touches[t].targets,d=0;d<w.length;d++){w[d].num=-1,I=this.options.precision.touch;do{for(C=0;C<G.length;C++)if(Math.abs(Math.pow(G[C].screenX-w[d].X,2)+Math.pow(G[C].screenY-w[d].Y,2))<I*I){w[d].num=C,w[d].X=G[C].screenX,w[d].Y=G[C].screenY,G[C].jxg_isused=!0;break}I*=2}while(w[d].num===-1&&I<this.options.precision.touchMax);w[d].num===-1&&(JXG$1.debug("i couldn't find a targettouches for target no "+d+" on "+this.touches[t].obj.name+" ("+this.touches[t].obj.id+"). Removed the target."),JXG$1.debug("eps = "+I+", touchMax = "+Options.precision.touchMax),w.splice(t,1))}for(t=0;t<G.length;t++)if(!G[t].jxg_isused){if(o=this.getMousePosition(n,t),this.selectingMode)return this._startSelecting(o),this.triggerEventHandlers(["touchstartselecting","startselecting"],[n]),n.preventDefault(),n.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(u=this.initMoveObject(o[0],o[1],n,"touch"),u.length!==0){if(f=u[u.length-1],S={num:t,X:G[t].screenX,Y:G[t].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},JXG$1.isPoint(f)||f.elementClass===Const.OBJECT_CLASS_TEXT||f.type===Const.OBJECT_TYPE_TICKS||f.type===Const.OBJECT_TYPE_IMAGE)y=[S],this.saveStartPos(f,y[0]),this.touches.push({obj:f,targets:y}),f.highlight(!0);else if(f.elementClass===Const.OBJECT_CLASS_LINE||f.elementClass===Const.OBJECT_CLASS_CIRCLE||f.elementClass===Const.OBJECT_CLASS_CURVE||f.type===Const.OBJECT_TYPE_POLYGON){for(A=!1,d=0;d<this.touches.length;d++)f.id===this.touches[d].obj.id&&(A=!0,this.touches[d].targets.length===1&&(this.saveStartPos(f,S),this.touches[d].targets.push(S)),G[t].jxg_isused=!0);A||(y=[S],this.saveStartPos(f,y[0]),this.touches.push({obj:f,targets:y}),f.highlight(!0))}}G[t].jxg_isused=!0}return this.touches.length>0&&(n.preventDefault(),n.stopPropagation()),G.length===1&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(n)||G.length===2&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(n)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[n]),!1},touchMoveListener:function(n){var t,o,u,d,C=n.touches;if(!this.checkFrameRate(n))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(n.preventDefault(),n.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(t=0;t<C.length;t++)if(!C[t].jxg_isused){o=this.getMousePosition(n,t),this._moveSelecting(o),this.triggerEventHandlers(["touchmoves","moveselecting"],[n,this.mode]);break}}else if(!this.touchOriginMove(n))if(this.mode===this.BOARD_MODE_DRAG){for(t=0;t<this.touches.length;t++)if(d=this.touches[t].targets,d.length===1){if(C[d[0].num]){if(o=this.getMousePosition(n,d[0].num),o[0]<0||o[0]>this.canvasWidth||o[1]<0||o[1]>this.canvasHeight)return;d[0].X=o[0],d[0].Y=o[1],this.moveObject(o[0],o[1],this.touches[t],n,"touch")}}else if(d.length===2&&d[0].num>-1&&d[1].num>-1&&C[d[0].num]&&C[d[1].num]){if(o=this.getMousePosition(n,d[0].num),u=this.getMousePosition(n,d[1].num),o[0]<0||o[0]>this.canvasWidth||o[1]<0||o[1]>this.canvasHeight||u[0]<0||u[0]>this.canvasWidth||u[1]<0||u[1]>this.canvasHeight)return;d[0].X=o[0],d[0].Y=o[1],d[1].X=u[0],d[1].Y=u[1],this.twoFingerMove(this.touches[t],d[0].num,n),d[0].Xprev=o[0],d[0].Yprev=o[1],d[1].Xprev=u[0],d[1].Yprev=u[1]}}else C.length===2&&this.gestureChangeListener(n),o=this.getMousePosition(n,0),this.highlightElements(o[0],o[1],n,-1);return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[n,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(n){var t,o,u,d=this.options.precision.touch,C=[],I,f,A=n&&n.touches,y,G=!1;if(this.triggerEventHandlers(["touchend","up"],[n]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[n]),this.stopSelectionMode();else if(A&&A.length>0){for(t=0;t<this.touches.length;t++)C[t]=this.touches[t];for(this.touches.length=0,t=0;t<A.length;t++)A[t].jxg_isused=!1;for(t=0;t<C.length;t++){for(I=!1,f=0,y=C[t].targets,o=0;o<y.length;o++)for(y[o].found=!1,u=0;u<A.length;u++)if(Math.abs(Math.pow(A[u].screenX-y[o].X,2)+Math.pow(A[u].screenY-y[o].Y,2))<d*d){y[o].found=!0,y[o].num=u,y[o].X=A[u].screenX,y[o].Y=A[u].screenY,f+=1;break}if(JXG$1.isPoint(C[t].obj)?I=y[0]&&y[0].found:C[t].obj.elementClass===Const.OBJECT_CLASS_LINE?I=y[0]&&y[0].found||y[1]&&y[1].found:C[t].obj.elementClass===Const.OBJECT_CLASS_CIRCLE&&(I=f===1||f===3),I)for(this.touches.push({obj:C[t].obj,targets:[]}),o=0;o<y.length;o++)y[o].found&&this.touches[this.touches.length-1].targets.push({num:y[o].num,X:y[o].screenX,Y:y[o].screenY,Xprev:NaN,Yprev:NaN,Xstart:y[o].Xstart,Ystart:y[o].Ystart,Zstart:y[o].Zstart});else C[t].obj.noHighlight()}}else this.touches.length=0;for(t=this.downObjects.length-1;t>-1;t--){for(I=!1,o=0;o<this.touches.length;o++)this.touches[o].obj.id===this.downObjects[t].id&&(I=!0);I||(this.downObjects[t].triggerEventHandlers(["touchup","up"],[n]),JXG$1.exists(this.downObjects[t].coords)||(this.downObjects[t].snapToGrid(),this.downObjects[t].snapToPoints(),G=!0),this.downObjects.splice(t,1))}return(!A||A.length===0)&&(this.hasTouchEnd&&(JXG$1.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),G&&this.update()),!0},mouseDownListener:function(n){var t,o,u;if(this.document.selection&&JXG$1.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp)JXG$1.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0;else return;if(this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,t=this.getMousePosition(n),this._testForSelection(n),this.selectingMode){this._startSelecting(t),this.triggerEventHandlers(["mousestartselecting","startselecting"],[n]);return}return o=this.initMoveObject(t[0],t[1],n,"mouse"),o.length===0?(this.mode=this.BOARD_MODE_NONE,u=!0):(this.mouse={obj:null,targets:[{X:t[0],Y:t[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=o[o.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),n&&n.preventDefault?n.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(u=this.mouseOriginMoveStart(n)),this.triggerEventHandlers(["mousedown","down"],[n]),u},mouseMoveListener:function(n){var t;if(!this.checkFrameRate(n))return!1;t=this.getMousePosition(n),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(t),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[n,this.mode])):this.mouseOriginMove(n)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(t[0],t[1],this.mouse,n,"mouse"):this.highlightElements(t[0],t[1],n,-1),this.triggerEventHandlers(["mousemove","move"],[n,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(n){var t;if(this.selectingMode===!1&&this.triggerEventHandlers(["mouseup","up"],[n]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&(JXG$1.exists(this.mouse.obj.coords)||(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints())),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(n),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[n]),this.stopSelectionMode();else for(t=0;t<this.downObjects.length;t++)this.downObjects[t].triggerEventHandlers(["mouseup","up"],[n]);this.downObjects.length=0,this.hasMouseUp&&(JXG$1.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(n){var t,o,u;return!this.attr.zoom.enabled||!this.attr.zoom.wheel||!this._isRequiredKeyPressed(n,"zoom")?!0:(n=n||window.event,t=n.detail?-n.detail:n.wheelDelta/40,o=this.attr.zoom.center,o==="board"?u=[]:u=new Coords(Const.COORDS_BY_SCREEN,this.getMousePosition(n),this).usrCoords,t>0?this.zoomIn(u[1],u[2]):this.zoomOut(u[1],u[2]),this.triggerEventHandlers(["mousewheel"],[n]),n.preventDefault(),!1)},keyDownListener:function(n){var t=n.target.id,o,u,d,C,I=0,f=0,A=JXG$1.evaluate(this.attr.keyboard.dx)/this.unitX,y=JXG$1.evaluate(this.attr.keyboard.dy)/this.unitY,G=!1,S=!0,w,M;return!this.attr.keyboard.enabled||t===""||(C=this.containerObj.shadowRoot||document,C.activeElement&&(u=C.activeElement,u.tagName==="INPUT"||u.tagName==="textarea"))?!1:(o=t.replace(this.containerObj.id+"_",""),u=this.select(o),JXG$1.exists(u.coords)&&(M=u.coords.usrCoords.slice(1)),JXG$1.evaluate(this.attr.keyboard.panshift)&&n.shiftKey||JXG$1.evaluate(this.attr.keyboard.panctrl)&&n.ctrlKey?(JXG$1.evaluate(this.attr.zoom.enabled)===!0&&(G=!0),n.keyCode===38?this.clickUpArrow():n.keyCode===40?this.clickDownArrow():n.keyCode===37?this.clickLeftArrow():n.keyCode===39?this.clickRightArrow():G&&n.keyCode===171?this.zoomIn():G&&n.keyCode===173?this.zoomOut():G&&n.keyCode===79?this.zoom100():S=!1):(JXG$1.exists(u.visProp)&&(JXG$1.exists(u.visProp.snaptogrid)&&u.visProp.snaptogrid&&JXG$1.evaluate(u.visProp.snapsizex)&&JXG$1.evaluate(u.visProp.snapsizey)?(d=u.getSnapSizes(),I=d[0],f=d[1],A=I,y=f):JXG$1.exists(u.visProp.attracttogrid)&&u.visProp.attracttogrid&&JXG$1.evaluate(u.visProp.attractordistance)&&JXG$1.evaluate(u.visProp.attractorunit)&&(I=1.1*JXG$1.evaluate(u.visProp.attractordistance),f=I,JXG$1.evaluate(u.visProp.attractorunit)==="screen"&&(I/=this.unitX,f/=this.unitX),A=Math.max(I,A),y=Math.max(f,y))),n.keyCode===38?w=[0,y]:n.keyCode===40?w=[0,-y]:n.keyCode===37?w=[-A,0]:n.keyCode===39?w=[A,0]:S=!1,w&&u.isDraggable&&u.visPropCalc.visible&&(this.geonextCompatibilityMode&&(JXG$1.isPoint(u)||u.elementClass===Const.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!JXG$1.evaluate(u.visProp.fixed)&&(this.mode=this.BOARD_MODE_DRAG,JXG$1.exists(u.coords)&&(w[0]+=M[0],w[1]+=M[1]),JXG$1.exists(u.coords)?(u.setPosition(JXG$1.COORDS_BY_USER,w),this.updateInfobox(u)):(this.displayInfobox(!1),u.setPositionDirectly(Const.COORDS_BY_USER,w,[0,0])),this.triggerEventHandlers(["keymove","move"],[n,this.mode]),u.triggerEventHandlers(["keydrag","drag"],[n]),this.mode=this.BOARD_MODE_NONE)),this.update(),S&&JXG$1.exists(n.preventDefault)&&n.preventDefault(),S)},keyFocusInListener:function(n){var t=n.target.id,o,u;if(!this.attr.keyboard.enabled||t==="")return!1;o=t.replace(this.containerObj.id+"_",""),u=this.select(o),JXG$1.exists(u.highlight)&&(u.highlight(!0),this.focusObjects=[o],u.triggerEventHandlers(["hit"],[n])),JXG$1.exists(u.coords)&&this.updateInfobox(u)},keyFocusOutListener:function(n){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(n,t){var o=n,u=t,d,C,I;n===void 0&&(o=this.containerObj.offsetWidth,u=this.containerObj.offsetHeight),n===void 0&&window&&window.getComputedStyle&&(d=window.getComputedStyle(this.containerObj,null),C=parseFloat(d.getPropertyValue("border-left-width"))+parseFloat(d.getPropertyValue("border-right-width")),isNaN(C)||(o-=C),I=parseFloat(d.getPropertyValue("border-top-width"))+parseFloat(d.getPropertyValue("border-bottom-width")),isNaN(I)||(u-=I)),!(o<=0||u<=0||isNaN(o)||isNaN(u))&&(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),!(JXG$1.exists(this._prevDim)&&this._prevDim.w===o&&this._prevDim.h===u)&&(this.resizeContainer(o,u,!0),this._prevDim={w:o,h:u}))},startResizeObserver:function(){var n=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||(this.resizeObserver=new ResizeObserver(function(t){var o;n._isResizing||(n._isResizing=!0,o=t[0].contentRect,window.setTimeout(function(){try{n.updateContainerDims(o.width,o.height)}catch{n.stopResizeObserver()}finally{n._isResizing=!1}},n.attr.resize.throttle))}),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var n=this;!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled||!this._isScrolling&&!this._isResizing&&(this._isResizing=!0,window.setTimeout(function(){n.updateContainerDims(),n._isResizing=!1},this.attr.resize.throttle))},scrollListener:function(n){var t=this;JXG$1.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout(function(){t._isScrolling=!1},66)))},startIntersectionObserver:function(){var n=this,t={root:null,rootMargin:"0px",threshold:.8};try{this.intersectionObserver=new IntersectionObserver(function(o){isNaN(n.getBoundingBox()[0])&&n.updateContainerDims()},t),this.intersectionObserver.observe(n.containerObj)}catch{JXG$1.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){JXG$1.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},printListener:function(n){this.updateContainerDims()},printListenerMatch:function(n){n.matches&&this.printListener()},initInfobox:function(n){var t=JXG$1.copyAttributes(n,this.options,"infobox");return t.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],t),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(n){var t,o,u,d,C,I,f,A=JXG$1.evaluate(n.visProp.showinfobox);return!JXG$1.evaluate(this.attr.showinfobox)&&A==="inherit"||!A?this:(JXG$1.isPoint(n)&&(u=n.coords.usrCoords[1],d=n.coords.usrCoords[2],I=JXG$1.evaluate(this.infobox.visProp.distancex),f=JXG$1.evaluate(this.infobox.visProp.distancey),this.infobox.setCoords(u+I/this.unitX,d+f/this.unitY),C=JXG$1.evaluate(n.visProp.infoboxdigits),typeof n.infoboxText!="string"?(C==="auto"?this.infobox.useLocale()?(t=this.infobox.formatNumberLocale(u),o=this.infobox.formatNumberLocale(d)):(t=JXG$1.autoDigits(u),o=JXG$1.autoDigits(d)):JXG$1.isNumber(C)?this.infobox.useLocale()?(t=this.infobox.formatNumberLocale(u,C),o=this.infobox.formatNumberLocale(d,C)):(t=JXG$1.toFixed(u,C),o=JXG$1.toFixed(d,C)):(t=u,o=d),this.highlightInfobox(t,o,n)):this.highlightCustomInfobox(n.infoboxText,n),this.displayInfobox(!0)),this)},displayInfobox:function(n){return!n&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===Const.OBJECT_CLASS_POINT?this:(this.infobox.hiddenByParent===n&&(this.infobox.hiddenByParent=!n,this.infobox.prepareUpdate().updateVisibility(n).updateRenderer()),this)},showInfobox:function(n){return this.displayInfobox(n)},highlightInfobox:function(n,t,o){return this.highlightCustomInfobox("("+n+", "+t+")",o),this},highlightCustomInfobox:function(n,t){return this.infobox.setText(n),this},dehighlightAll:function(){var n,t,o={},u=!1;for(n in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(n)&&(t=this.highlightedObjects[n],this.focusObjects.indexOf(n)<0?((this.hasMouseHandlers||this.hasPointerHandlers)&&t.noHighlight(),u=!0):o[n]=t);return this.highlightedObjects=o,this.renderer.type==="canvas"&&u&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(n,t){return[n,t]},getUsrCoordsOfMouse:function(n){var t=this.getCoordsTopLeftCorner(),o=JXG$1.getPosition(n,null,this.document),u=o[0]-t[0],d=o[1]-t[1],C=new Coords(Const.COORDS_BY_SCREEN,[u,d],this);return C.usrCoords.slice(1)},getAllUnderMouse:function(n){var t=this.getAllObjectsUnderMouse(n);return t.push(this.getUsrCoordsOfMouse(n)),t},getAllObjectsUnderMouse:function(n){var t=this.getCoordsTopLeftCorner(),o=JXG$1.getPosition(n,null,this.document),u=o[0]-t[0],d=o[1]-t[1],C=[],I,f,A=this.objectsList.length;for(I=0;I<A;I++)f=this.objectsList[I],f.visPropCalc.visible&&f.hasPoint&&f.hasPoint(u,d)&&(C[C.length]=f);return C},updateCoords:function(){var n,t,o=this.objectsList.length;for(t=0;t<o;t++)n=this.objectsList[t],JXG$1.exists(n.coords)&&(JXG$1.evaluate(n.visProp.frozen)?n.is3D?n.element2D.coords.screen2usr():n.coords.screen2usr():n.is3D?n.element2D.coords.usr2screen():n.coords.usr2screen());return this},moveOrigin:function(n,t,o){var u,d,C,I;return JXG$1.exists(n)&&JXG$1.exists(t)&&(u=this.origin.scrCoords[1],d=this.origin.scrCoords[2],this.origin.scrCoords[1]=n,this.origin.scrCoords[2]=t,o&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),C=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,I=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(C[1]<this.maxboundingbox[0]||C[2]>this.maxboundingbox[1]||I[1]>this.maxboundingbox[2]||I[2]<this.maxboundingbox[3])&&(this.origin.scrCoords[1]=u,this.origin.scrCoords[2]=d)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(n){var t,o,u,d,C,I,f,A=[],y=n.indexOf("<data>"),G=n.indexOf("</data>"),S=function(H,J,z,L){return function(){var K,O;K=H.select(J.id),O=K.coords.usrCoords[L],L===2?K.setPositionDirectly(Const.COORDS_BY_USER,[z(),O]):K.setPositionDirectly(Const.COORDS_BY_USER,[O,z()]),K.prepareUpdate().update()}},w=function(H,J,z){return function(){var L,K;L=H.select(J.id),K=z(),L.setAttribute({visible:K})}},M=function(H,J,z,L){return function(){var K,O;K=H.select(J.id),O=z(),L==="strokewidth"?K.visProp.strokewidth=O:(O=JXG$1.rgba2rgbo(O),K.visProp[L+"color"]=O[0],K.visProp[L+"opacity"]=O[1])}},V=function(H,J,z){return function(){var L=H.select(J.id);L.position=z()}},T=function(H,J,z){return function(){var L=H.select(J.id);L.setStyle(z())}};if(!(y<0)){for(;y>=0;){if(t=n.slice(y+6,G),o=t.indexOf("="),u=t.slice(0,o),d=t.slice(o+1),o=u.indexOf("."),C=u.slice(0,o),I=this.elementsByName[JXG$1.unescapeHTML(C)],f=u.slice(o+1).replace(/\s+/g,"").toLowerCase(),d=JXG$1.createFunction(d,this,"",!0),!JXG$1.exists(this.elementsByName[C]))JXG$1.debug("debug conditions: |"+C+"| undefined");else switch(f){case"x":A.push(S(this,I,d,2));break;case"y":A.push(S(this,I,d,1));break;case"visible":A.push(w(this,I,d));break;case"position":A.push(V(this,I,d));break;case"stroke":A.push(M(this,I,d,"stroke"));break;case"style":A.push(T(this,I,d));break;case"strokewidth":A.push(M(this,I,d,"strokewidth"));break;case"fill":A.push(M(this,I,d,"fill"));break;case"label":break;default:JXG$1.debug('property "'+f+'" in conditions not yet implemented:'+d);break}n=n.slice(G+7),y=n.indexOf("<data>"),G=n.indexOf("</data>")}this.updateConditions=function(){var H;for(H=0;H<A.length;H++)A[H]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var n,t,o=this.getBoundingBox(),u=JXG$1.evaluate(this.options.grid.majorStep),d=JXG$1.evaluate(this.options.grid.gridX),C=JXG$1.evaluate(this.options.grid.gridY),I,f;for(JXG$1.isArray(u)||(u=[u,u]),u.length<2&&(u=[u[0],u[0]]),JXG$1.exists(d)&&(u[0]=d),JXG$1.exists(C)&&(u[1]=C),u[0]==="auto"?u[0]=1:u[0]=JXG$1.parseNumber(u[0],Math.abs(o[1]-o[3]),1/this.unitX),u[1]==="auto"?u[1]=1:u[1]=JXG$1.parseNumber(u[1],Math.abs(o[0]-o[2]),1/this.unitY),n=new Coords(Const.COORDS_BY_USER,[0,0],this),t=new Coords(Const.COORDS_BY_USER,[u[0],u[1]],this),I=n.scrCoords[1]-t.scrCoords[1],f=n.scrCoords[2]-t.scrCoords[2],this.options.grid.snapSizeX=u[0];Math.abs(I)>25;)this.options.grid.snapSizeX*=2,I/=2;for(this.options.grid.snapSizeY=u[1];Math.abs(f)>25;)this.options.grid.snapSizeY*=2,f/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(n,t){var o=this.getBoundingBox(),u=this.attr.zoom.factorx,d=this.attr.zoom.factory,C=(o[2]-o[0])*(1-1/u),I=(o[1]-o[3])*(1-1/d),f=.5,A=.5,y=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX>this.attr.zoom.max&&u>1||this.zoomY>this.attr.zoom.max&&d>1||this.zoomX<y&&u<1||this.zoomY<y&&d<1?this:(JXG$1.isNumber(n)&&JXG$1.isNumber(t)&&(f=(n-o[0])/(o[2]-o[0]),A=(o[1]-t)/(o[1]-o[3])),this.setBoundingBox([o[0]+C*f,o[1]-I*A,o[2]-C*(1-f),o[3]+I*(1-A)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(n,t){var o=this.getBoundingBox(),u=this.attr.zoom.factorx,d=this.attr.zoom.factory,C=(o[2]-o[0])*(1-u),I=(o[1]-o[3])*(1-d),f=.5,A=.5,y=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX<y||this.zoomY<y?this:(JXG$1.isNumber(n)&&JXG$1.isNumber(t)&&(f=(n-o[0])/(o[2]-o[0]),A=(o[1]-t)/(o[1]-o[3])),this.setBoundingBox([o[0]+C*f,o[1]-I*A,o[2]-C*(1-f),o[3]+I*(1-A)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var n,t,o;return JXG$1.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(n=this.getBoundingBox(),t=(n[2]-n[0])*(1-this.zoomX)*.5,o=(n[1]-n[3])*(1-this.zoomY)*.5,this.setBoundingBox([n[0]+t,n[1]-o,n[2]-t,n[3]+o],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var n,t,o,u,d,C=0,I=0,f=0,A=0,y=this.objectsList.length;for(n=0;n<y;n++)d=this.objectsList[n],JXG$1.isPoint(d)&&d.visPropCalc.visible&&(d.coords.usrCoords[1]<C?C=d.coords.usrCoords[1]:d.coords.usrCoords[1]>I&&(I=d.coords.usrCoords[1]),d.coords.usrCoords[2]>A?A=d.coords.usrCoords[2]:d.coords.usrCoords[2]<f&&(f=d.coords.usrCoords[2]));return t=50,o=t/this.unitX,u=t/this.unitY,this.setBoundingBox([C-o,A+u,I+o,f-u],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(n){var t,o,u,d=[1/0,-1/0,-1/0,1/0],C,I,f,A,y;if(!JXG$1.isArray(n)||n.length===0)return this;for(t=0;t<n.length;t++)o=this.select(n[t]),u=o.bounds(),JXG$1.isArray(u)&&(u[0]<d[0]&&(d[0]=u[0]),u[1]>d[1]&&(d[1]=u[1]),u[2]>d[2]&&(d[2]=u[2]),u[3]<d[3]&&(d[3]=u[3]));return JXG$1.isArray(d)&&(C=.5*(d[0]+d[2]),I=.5*(d[1]+d[3]),f=1.5*(d[2]-d[0])*.5,A=1.5*(d[1]-d[3])*.5,y=Math.max(f,A),this.setBoundingBox([C-y,I+y,C+y,I-y],this.keepaspectratio,"update")),this},setZoom:function(n,t){var o=this.attr.zoom.factorx,u=this.attr.zoom.factory;return this.attr.zoom.factorx=n/this.zoomX,this.attr.zoom.factory=t/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=o,this.attr.zoom.factory=u,this},_removeObj:function(n,t){var o,u;if(JXG$1.isArray(n)){for(u=0;u<n.length;u++)this._removeObj(n[u],t);return this}if(n=this.select(n),!JXG$1.exists(n)||JXG$1.isString(n))return this;try{for(o in n.childElements)n.childElements.hasOwnProperty(o)&&n.childElements[o].board._removeObj(n.childElements[o]);for(o in n.objects)n.objects.hasOwnProperty(o)&&n.objects[o].board._removeObj(n.objects[o]);if(t)for(o in this.objects)this.objects.hasOwnProperty(o)&&JXG$1.exists(this.objects[o].childElements)&&JXG$1.exists(this.objects[o].childElements.hasOwnProperty(n.id))&&(delete this.objects[o].childElements[n.id],delete this.objects[o].descendants[n.id]);else if(JXG$1.exists(n.ancestors))for(o in n.ancestors)n.ancestors.hasOwnProperty(o)&&JXG$1.exists(n.ancestors[o].childElements)&&JXG$1.exists(n.ancestors[o].childElements.hasOwnProperty(n.id))&&(delete n.ancestors[o].childElements[n.id],delete n.ancestors[o].descendants[n.id]);if(n._pos>-1)for(this.objectsList.splice(n._pos,1),u=n._pos;u<this.objectsList.length;u++)this.objectsList[u]._pos--;else n.type!==Const.OBJECT_TYPE_TURTLE&&JXG$1.debug("Board.removeObject: object "+n.id+" not found in list.");delete this.objects[n.id],delete this.elementsByName[n.name],n.visProp&&JXG$1.evaluate(n.visProp.trace)&&n.clearTrace(),JXG$1.exists(n.remove)&&n.remove()}catch(d){JXG$1.debug(n.id+": Could not be removed: "+d)}return this},removeObject:function(n,t){var o;if(this.renderer.suspendRedraw(this),JXG$1.isArray(n))for(o=0;o<n.length;o++)this._removeObj(n[o],t);else this._removeObj(n,t);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(n){var t;for(t in n.ancestors)n.ancestors.hasOwnProperty(t)&&this.removeAncestors(n.ancestors[t]);return this.removeObject(n),this},initGeonextBoard:function(){var n,t,o;return n=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),t=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),o=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[n,t],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[n,o],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(n,t,o,u){var d,C,I,f,A;return C=this.canvasWidth,I=this.canvasHeight,u||(d=this.getBoundingBox()),this.canvasWidth=parseFloat(n),this.canvasHeight=parseFloat(t),o||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),u?(f=(this.canvasWidth-C)*.5,A=(this.canvasHeight-I)*.5,this.moveOrigin(this.origin.scrCoords[1]+f,this.origin.scrCoords[2]+A)):this.setBoundingBox(d,this.keepaspectratio,"keep"),this},showDependencies:function(){var n,t,o,u,d;t=`<p>
`;for(n in this.objects)if(this.objects.hasOwnProperty(n)){d=0;for(o in this.objects[n].childElements)this.objects[n].childElements.hasOwnProperty(o)&&(d+=1);d>=0&&(t+="<strong>"+this.objects[n].id+":</strong> ");for(o in this.objects[n].childElements)this.objects[n].childElements.hasOwnProperty(o)&&(t+=this.objects[n].childElements[o].id+"("+this.objects[n].childElements[o].name+"), ");t+=`<p>
`}return t+=`</p>
`,u=window.open(),u.document.open(),u.document.write(t),u.document.close(),this},showXML:function(){var n=window.open("");return n.document.open(),n.document.write("<pre>"+JXG$1.escapeHTML(this.xmlString)+"</pre>"),n.document.close(),this},prepareUpdate:function(){var n,t,o=this.objectsList.length;for(n=0;n<o;n++)t=this.objectsList[n],t.needsUpdate=t.needsRegularUpdate||this.needsFullUpdate;for(n in this.groups)this.groups.hasOwnProperty(n)&&(t=this.groups[n],t.needsUpdate=t.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(n){var t,o;for(n=this.select(n),t=0;t<this.objectsList.length;t++)o=this.objectsList[t],this.needsFullUpdate&&o.elementClass===Const.OBJECT_CLASS_TEXT&&o.updateSize(),o.update(!JXG$1.exists(n)||o.id!==n.id).updateVisibility();for(t in this.groups)this.groups.hasOwnProperty(t)&&this.groups[t].update(n);return this},updateRenderer:function(){var n,t=this.objectsList.length;if(this.renderer){if(this.renderer.type==="canvas")this.updateRendererCanvas();else for(n=0;n<t;n++)this.objectsList[n].updateRenderer();return this}},updateRendererCanvas:function(){var n,t,o,u,d,C=this.objectsList.length,I=this.options.layer,f=this.options.layer.numlayers,A=Number.NEGATIVE_INFINITY;for(o=0;o<f;o++){u=Number.POSITIVE_INFINITY;for(d in I)I.hasOwnProperty(d)&&I[d]>A&&I[d]<u&&(u=I[d]);for(A=u,n=0;n<C;n++)t=this.objectsList[n],t.visProp.layer===u&&t.prepareUpdate().updateRenderer()}return this},addHook:function(n,t,o){return JXG$1.deprecated("Board.addHook()","Board.on()"),t=JXG$1.def(t,"update"),o=JXG$1.def(o,this),this.hooks.push([t,n]),this.on(t,n,o),this.hooks.length-1},addEvent:JXG$1.shortcut(JXG$1.Board.prototype,"on"),removeHook:function(n){return JXG$1.deprecated("Board.removeHook()","Board.off()"),this.hooks[n]&&(this.off(this.hooks[n][0],this.hooks[n][1]),this.hooks[n]=null),this},removeEvent:JXG$1.shortcut(JXG$1.Board.prototype,"off"),updateHooks:function(n){var t=Array.prototype.slice.call(arguments,0);return JXG$1.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),t[0]=JXG$1.def(t[0],"update"),this.triggerEventHandlers([t[0]],arguments),this},addChild:function(n){return JXG$1.exists(n)&&JXG$1.exists(n.containerObj)&&(this.dependentBoards.push(n),this.update()),this},removeChild:function(n){var t;for(t=this.dependentBoards.length-1;t>=0;t--)this.dependentBoards[t]===n&&this.dependentBoards.splice(t,1);return this},update:function(n){var t,o,u,d,C;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,this.attr.minimizereflow==="all"&&this.containerObj&&this.renderer.type!=="vml"&&(C=this.document.activeElement,d=this.renderer.removeToInsertLater(this.containerObj)),this.attr.minimizereflow==="svg"&&this.renderer.type==="svg"&&(C=this.document.activeElement,d=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate().updateElements(n).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),d&&(d(),C.focus()),o=this.dependentBoards.length,t=0;t<o;t++)u=this.dependentBoards[t],JXG$1.exists(u)&&u!==this&&(u.updateQuality=this.updateQuality,u.prepareUpdate().updateElements().updateConditions(),u.renderer.suspendRedraw(this),u.updateRenderer(),u.renderer.unsuspendRedraw(),u.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var n;for(n=0;n<this.grids.length;n++)this.removeObject(this.grids[n]);return this.grids.length=0,this.update(),this},create:function(n,t,o){var u,d;for(n=n.toLowerCase(),JXG$1.exists(t)||(t=[]),JXG$1.exists(o)||(o={}),d=0;d<t.length;d++)JXG$1.isString(t[d])&&!(n==="text"&&d===2)&&!(n==="solidofrevolution3d"&&d===2)&&!(n==="text3d"&&(d===2||d===4))&&!((n==="input"||n==="checkbox"||n==="button")&&(d===2||d===3))&&n!=="curve"&&n!=="functiongraph"&&n!=="implicitcurve"&&(t[d]=this.select(t[d]));if(JXG$1.isFunction(JXG$1.elements[n]))u=JXG$1.elements[n](this,t,o);else throw new Error("JSXGraph: create: Unknown element type given: "+n);return JXG$1.exists(u)?(u.prepareUpdate&&u.update&&u.updateRenderer&&u.fullUpdate(),u):(JXG$1.debug("JSXGraph: create: failure creating "+n),u)},createElement:function(){return JXG$1.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var n;for(n=0;n<this.objectsList.length;n++)this.objectsList[n].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(n,t,o){var u,d,C,I,f=0,A=0,y=1,G,S,w,M,V,T=JXG$1.getDimensions(this.containerObj,this.document);return JXG$1.isArray(n)?n[0]<this.maxboundingbox[0]||n[1]>this.maxboundingbox[1]||n[2]>this.maxboundingbox[2]||n[3]<this.maxboundingbox[3]?this:(JXG$1.exists(o)||(o="reset"),C=this.unitX,I=this.unitY,this.canvasWidth=parseFloat(T.width),this.canvasHeight=parseFloat(T.height),d=this.canvasWidth,u=this.canvasHeight,t?(this.keepaspectratio?(G=C/I,isNaN(G)&&(G=1)):G=1,o==="keep"&&(y=this.zoomX/this.zoomY),S=n[2]-n[0],w=n[1]-n[3],M=C*S,V=I*w,d>=u?M>=V?(this.unitY=u/w,this.unitX=this.unitY*G):(this.unitY=u/Math.abs(S)*Mat.sign(w)/y,this.unitX=this.unitY*G):V>M?(this.unitX=d/S,this.unitY=this.unitX/G):(this.unitX=d/Math.abs(w)*Mat.sign(S)*y,this.unitY=this.unitX/G),f=(d/this.unitX-S)*.5,A=(u/this.unitY-w)*.5,this.keepaspectratio=!0):(this.unitX=d/(n[2]-n[0]),this.unitY=u/(n[1]-n[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(n[0]-f),this.unitY*(n[1]+A)),o==="update"?(this.zoomX*=this.unitX/C,this.zoomY*=this.unitY/I):o==="reset"&&(this.zoomX=JXG$1.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=JXG$1.exists(this.attr.zoomy)?this.attr.zoomy:1),this):this},getBoundingBox:function(){var n=new Coords(Const.COORDS_BY_SCREEN,[0,0],this).usrCoords,t=new Coords(Const.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[n[1],n[2],t[1],t[2]]},_set:function(n,t){n=n.toLocaleLowerCase(),t!==null&&JXG$1.isObject(t)&&!JXG$1.exists(t.id)&&!JXG$1.exists(t.name)?JXG$1.mergeAttr(this.attr[n],t):this.attr[n]=t},setAttribute:function(n){var t,o,u,d,C,I,f,A={};for(t=0;t<arguments.length;t++)o=arguments[t],JXG$1.isString(o)?(u=o.split(":"),A[JXG$1.trim(u[0])]=JXG$1.trim(u[1])):JXG$1.isArray(o)?A[o[0]]=o[1]:JXG$1.extend(A,o);for(t in A)if(A.hasOwnProperty(t)&&(d=t.replace(/\s+/g,"").toLowerCase(),C=A[t]),C=C.toLowerCase&&C.toLowerCase()==="false"?!1:C,I=this.attr[d],I!==C)switch(d){case"axis":C===!1&&JXG$1.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(C,this.keepaspectratio),this._set(d,C);break;case"defaultaxes":JXG$1.exists(this.defaultAxes.x)&&JXG$1.exists(C.x)&&this.defaultAxes.x.setAttribute(C.x),JXG$1.exists(this.defaultAxes.y)&&JXG$1.exists(C.y)&&this.defaultAxes.y.setAttribute(C.y);break;case"description":this.document.getElementById(this.container+"_ARIAdescription").innerHTML=C,this._set(d,C);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=C,this._set(d,C);break;case"keepaspectratio":this._set(d,C),this.setBoundingBox(this.getBoundingBox(),C,"keep");break;case"document":case"maxboundingbox":this[d]=C,this._set(d,C);break;case"zoomx":case"zoomy":this[d]=C,this._set(d,C),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":f=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+d),f&&JXG$1.exists(C.symbol)&&(f.innerHTML=JXG$1.evaluate(C.symbol)),this._set(d,C);break;case"selection":C.visible=!1,C.withLines=!1,C.vertices={visible:!1},this._set(d,C);break;case"showcopyright":this.renderer.type==="svg"&&(f=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")),f?f.style.display=JXG$1.evaluate(C)?"inline":"none":JXG$1.evaluate(C)&&this.renderer.displayCopyright(Const.licenseText,parseInt(this.options.text.fontSize,10)));default:JXG$1.exists(this.attr[d])&&this._set(d,C);break}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[A,this]),this.fullUpdate(),this},addAnimation:function(n){var t=this;return this.animationObjects[n.id]=n,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){t.animate()},n.board.attr.animationdelay)),this},stopAllAnimation:function(){var n;for(n in this.animationObjects)this.animationObjects.hasOwnProperty(n)&&JXG$1.exists(this.animationObjects[n])&&(this.animationObjects[n]=null,delete this.animationObjects[n]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var n,t,o,u,d,C,I,f,A=0,y=null;for(t in this.animationObjects)if(this.animationObjects.hasOwnProperty(t)&&JXG$1.exists(this.animationObjects[t])){if(A+=1,o=this.animationObjects[t],o.animationPath&&(JXG$1.isFunction(o.animationPath)?u=o.animationPath(new Date().getTime()-o.animationStart):u=o.animationPath.pop(),!JXG$1.exists(u)||!JXG$1.isArray(u)&&isNaN(u)?delete o.animationPath:(o.setPositionDirectly(Const.COORDS_BY_USER,u),o.fullUpdate(),y=o)),o.animationData){I=0;for(d in o.animationData)o.animationData.hasOwnProperty(d)&&(C=o.animationData[d].pop(),JXG$1.exists(C)?(I+=1,n={},n[d]=C,o.setAttribute(n)):delete o.animationData[C]);I===0&&delete o.animationData}!JXG$1.exists(o.animationData)&&!JXG$1.exists(o.animationPath)&&(this.animationObjects[t]=null,delete this.animationObjects[t],JXG$1.exists(o.animationCallback)&&(f=o.animationCallback,o.animationCallback=null,f()))}return A===0?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(y),this},migratePoint:function(n,t,o){var u,d,C,I,f,A,y=!1;n=this.select(n),t=this.select(t),JXG$1.exists(n.label)&&(A=n.label.id,y=!0,this.removeObject(n.label));for(d in n.childElements)if(n.childElements.hasOwnProperty(d)){u=n.childElements[d],I=!1;for(C in u)u.hasOwnProperty(C)&&u[C]===n&&(u[C]=t,I=!0);for(I&&delete n.childElements[d],f=0;f<u.parents.length;f++)u.parents[f]===n.id&&(u.parents[f]=t.id);t.addChild(u)}return o&&(y&&(delete t.childElements[A],delete t.descendants[A]),t.label&&this.removeObject(t.label),delete this.elementsByName[t.name],t.name=n.name,y&&t.createLabel()),this.removeObject(n),JXG$1.exists(t.name)&&t.name!==""&&(this.elementsByName[t.name]=t),this.fullUpdate(),this},emulateColorblindness:function(n){var t,o;if(JXG$1.exists(n)||(n="none"),this.currentCBDef===n)return this;for(t in this.objects)this.objects.hasOwnProperty(t)&&(o=this.objects[t],n!=="none"?(this.currentCBDef==="none"&&(o.visPropOriginal={strokecolor:o.visProp.strokecolor,fillcolor:o.visProp.fillcolor,highlightstrokecolor:o.visProp.highlightstrokecolor,highlightfillcolor:o.visProp.highlightfillcolor}),o.setAttribute({strokecolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.strokecolor),n),fillcolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.fillcolor),n),highlightstrokecolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.highlightstrokecolor),n),highlightfillcolor:JXG$1.rgb2cb(JXG$1.evaluate(o.visPropOriginal.highlightfillcolor),n)})):JXG$1.exists(o.visPropOriginal)&&JXG$1.extend(o.visProp,o.visPropOriginal));return this.currentCBDef=n,this.update(),this},select:function(n,t){var o,u,d,C,I=n;if(I===null)return I;if(JXG$1.isString(I)&&I!=="")JXG$1.exists(this.objects[I])?I=this.objects[I]:JXG$1.exists(this.elementsByName[I])?I=this.elementsByName[I]:JXG$1.exists(this.groups[I])&&(I=this.groups[I]);else if(!t&&(JXG$1.isFunction(I)||JXG$1.isObject(I)&&!JXG$1.isFunction(I.setAttribute))){for(o=JXG$1.filterElements(this.objectsList,I),u={},C=o.length,d=0;d<C;d++)u[o[d].id]=o[d];I=new Composition(u)}else JXG$1.isObject(I)&&JXG$1.exists(I.id)&&!JXG$1.exists(this.objects[I.id])&&(I=null);return I},hasPoint:function(n,t){var o=n,u=t,d=this.getBoundingBox();return JXG$1.exists(n)&&JXG$1.isArray(n.usrCoords)&&(o=n.usrCoords[1],u=n.usrCoords[2]),!!(JXG$1.isNumber(o)&&JXG$1.isNumber(u)&&d[0]<o&&o<d[2]&&d[1]>u&&u>d[3])},updateCSSTransforms:function(){var n=this.containerObj,t=n,o=n;if(this.cssTransMat=JXG$1.getCSSTransformMatrix(t),JXG$1.exists(t.getRootNode)){for(t=t.parentNode===t.getRootNode()?t.parentNode.host:t.parentNode;t;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),t=t.parentNode===t.getRootNode()?t.parentNode.host:t.parentNode;this.cssTransMat=Mat.inverse(this.cssTransMat)}else{for(t=t.offsetParent;t;){for(this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),o=o.parentNode;o!==t;)this.cssTransMat=Mat.matMatMult(JXG$1.getCSSTransformMatrix(t),this.cssTransMat),o=o.parentNode;t=t.offsetParent}this.cssTransMat=Mat.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(n){this.isSelecting=!0,this.selectingBox=[[n[0],n[1]],[n[0],n[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(n){this.isSelecting&&(this.selectingBox[1]=[n[0],n[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(n){var t=this.getMousePosition(n);this.isSelecting=!1,this.selectingBox[1]=[t[0],t[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var n=this.selectingBox[0],t=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],n[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[n[0],t[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[t[0],t[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(JXG$1.COORDS_BY_SCREEN,[t[0],n[1]])},_testForSelection:function(n){this._isRequiredKeyPressed(n,"selection")&&(JXG$1.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(n){var t;return JXG$1.exists(this.selectionPolygon)||(t=JXG$1.copyAttributes(n,Options,"board","selection"),t.enabled===!0&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],t))),this},__evt__attribute:function(n){},__evt__down:function(n){},__evt__mousedown:function(n){},__evt__pendown:function(n){},__evt__pointerdown:function(n){},__evt__touchstart:function(n){},__evt__up:function(n){},__evt__mouseup:function(n){},__evt__pointerup:function(n){},__evt__touchend:function(n){},__evt__click:function(n){},__evt__dblclick:function(n){},__evt__mouseclick:function(n){},__evt__mousedblclick:function(n){},__evt__pointerclick:function(n){},__evt__pointerdblclick:function(n){},__evt__move:function(n,t){},__evt__mousemove:function(n,t){},__evt__penmove:function(n,t){},__evt__pointermove:function(n,t){},__evt__touchmove:function(n,t){},__evt__keymove:function(n,t){},__evt__hit:function(n,t,o){},__evt__mousehit:function(n,t,o){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(n){var t,o,u,d,C=this.document,I;return n=n||this.container,this._fullscreen_inner_id=n,u=C.getElementById(n),t="fullscreenwrap_"+n,JXG$1.exists(u._cssFullscreenStore)||(d=this.containerObj.getBoundingClientRect(),u._cssFullscreenStore={w:d.width,h:d.height}),C.getElementById(t)?o=C.getElementById(t):(o=document.createElement("div"),o.classList.add("JXG_wrap_private"),o.setAttribute("id",t),u.parentNode.insertBefore(o,u),o.appendChild(u)),o.requestFullscreen=o.requestFullscreen||o.webkitRequestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen,C.fullscreenElement!==void 0?I=C.fullscreenElement:C.webkitFullscreenElement!==void 0?I=C.webkitFullscreenElement:I=C.msFullscreenElement,I===null?o.requestFullscreen&&(o.requestFullscreen(),this.startFullscreenResizeObserver(o)):(this.stopFullscreenResizeObserver(o),JXG$1.exists(document.exitFullscreen)?document.exitFullscreen():JXG$1.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(n){var t,o,u,d=this.document;t=this._fullscreen_inner_id,JXG$1.exists(t)&&(d.fullscreenElement!==void 0?u=d.fullscreenElement:d.webkitFullscreenElement!==void 0?u=d.webkitFullscreenElement:u=d.msFullscreenElement,o=d.getElementById(t),u?(o._cssFullscreenStore.id=u.id,o._cssFullscreenStore.isFullscreen=!0,o._cssFullscreenStore.margin=o.style.margin,o._cssFullscreenStore.width=o.style.width,o._cssFullscreenStore.height=o.style.height,o._cssFullscreenStore.transform=o.style.transform,o.style.width=o._cssFullscreenStore.w+"px",o.style.height=o._cssFullscreenStore.h+"px",o.style.margin="",JXG$1.scaleJSXGraphDiv(u.id,t,d,JXG$1.evaluate(this.attr.fullscreen.scale)),u=null):JXG$1.exists(o._cssFullscreenStore)&&(o._cssFullscreenStore.isFullscreen=!1,o.style.margin=o._cssFullscreenStore.margin,o.style.width=o._cssFullscreenStore.width,o.style.height=o._cssFullscreenStore.height,o.style.transform=o._cssFullscreenStore.transform,o._cssFullscreenStore=null,o.parentElement.replaceWith(o)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(n){var t=this;return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(this.resizeObserver=new ResizeObserver(function(o){var u,d,C=t.document;t._isResizing||(t._isResizing=!0,window.setTimeout(function(){try{u=t._fullscreen_inner_id,C.fullscreenElement!==void 0?d=C.fullscreenElement:C.webkitFullscreenElement!==void 0?d=C.webkitFullscreenElement:d=C.msFullscreenElement,d!==null&&JXG$1.scaleJSXGraphDiv(d.id,u,C,JXG$1.evaluate(t.attr.fullscreen.scale))}catch{t.stopFullscreenResizeObserver(n)}finally{t._isResizing=!1}},t.attr.resize.throttle))}),this.resizeObserver.observe(n),this)},stopFullscreenResizeObserver:function(n){return!JXG$1.isBrowser||!this.attr.resize||!this.attr.resize.enabled?this:(JXG$1.exists(this.resizeObserver)&&this.resizeObserver.unobserve(n),this)},addLogEntry:function(n,t,o){var u,d,C=this.userLog.length-1;return JXG$1.exists(t.elementClass)&&(d=t.id),JXG$1.evaluate(this.attr.logging.enabled)&&(u=new Date().getTime(),C>=0&&this.userLog[C].type===n&&this.userLog[C].id===d&&u-this.userLog[C].end<500?(this.userLog[C].end=u,this.userLog[C].endpos=o):this.userLog.push({type:n,id:d,start:u,startpos:o,end:u,endpos:o,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(n,t,o,u,d,C,I){var f=this,A=function(){var y=0,G=0,S=0,w=o,M=Numerics.root(function(te){var se=n.X(w),ae=n.Y(w),le=t.X(te),ge=t.Y(te);return(se-le)*(se-le)+(ae-ge)*(ae-ge)},[0,Math.PI*2]),V=0,T=0,H,J=f.create("transform",[function(){return y}],{type:"rotate"}),z=f.create("transform",[function(){return y},function(){return n.X(w)},function(){return n.Y(w)}],{type:"rotate"}),L=f.create("transform",[function(){return G},function(){return S}],{type:"translate"}),K=function(te,se,ae){var le=Numerics.D(te.X)(se),ge=Numerics.D(te.Y)(se),be=Numerics.D(te.X)(ae),Xe=Numerics.D(te.Y)(ae),Ce=Numerics.D(te.X)((se+ae)*.5),Re=Numerics.D(te.Y)((se+ae)*.5),Se=Mat.hypot(le,ge),Ze=Mat.hypot(be,Xe),he=Mat.hypot(Ce,Re);return(Se+4*he+Ze)*(ae-se)/6},O=function(te){return H-K(t,M,te)},Q=Math.PI/18,ee=Q*9,ie=null;return this.rolling=function(){var te,se,ae,le,ge;V=w+d*u,H=K(n,w,V),T=Numerics.root(O,M),te=new Complex(n.X(V),n.Y(V)),se=new Complex(t.X(T),t.Y(T)),ae=new Complex(Numerics.D(n.X)(V),Numerics.D(n.Y)(V)),le=new Complex(Numerics.D(t.X)(T),Numerics.D(t.Y)(T)),ge=Complex.C.div(ae,le),y=Math.atan2(ge.imaginary,ge.real),ge.div(Complex.C.abs(ge)),ge.mult(se),G=te.real-ge.real,S=te.imaginary-ge.imaginary,y<-Q&&y>-ee?(y=-Q,z.applyOnce(I)):y>Q&&y<ee?(y=Q,z.applyOnce(I)):(J.applyOnce(I),L.applyOnce(I),w=V,M=T),f.update()},this.start=function(){return C>0&&(ie=window.setInterval(this.rolling,C)),this},this.stop=function(){return window.clearInterval(ie),this},this};return new A}});const Board=JXG$1.Board;JXG$1.SVGRenderer=function(n,t){var o;for(this.type="svg",this.isIE=navigator.appVersion.indexOf("MSIE")!==-1||navigator.userAgent.match(/Trident\//),this.svgRoot=null,this.svgNamespace="http://www.w3.org/2000/svg",this.xlinkNamespace="http://www.w3.org/1999/xlink",this.container=n,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.svgRoot=this.container.ownerDocument.createElementNS(this.svgNamespace,"svg"),this.svgRoot.style.overflow="hidden",this.svgRoot.style.display="block",this.resize(t.width,t.height),this.container.appendChild(this.svgRoot),this.defs=this.container.ownerDocument.createElementNS(this.svgNamespace,"defs"),this.svgRoot.appendChild(this.defs),this.createShadowFilter=function(u,d,C,I,f,A){var y=this.container.ownerDocument.createElementNS(this.svgNamespace,"filter"),G,S,w,M,V;return y.setAttributeNS(null,"id",u),y.setAttributeNS(null,"width","300%"),y.setAttributeNS(null,"height","300%"),y.setAttributeNS(null,"filterUnits","userSpaceOnUse"),G=this.container.ownerDocument.createElementNS(this.svgNamespace,"feOffset"),G.setAttributeNS(null,"in","SourceGraphic"),G.setAttributeNS(null,"result","offOut"),G.setAttributeNS(null,"dx",A[0]),G.setAttributeNS(null,"dy",A[1]),y.appendChild(G),S=this.container.ownerDocument.createElementNS(this.svgNamespace,"feColorMatrix"),S.setAttributeNS(null,"in","offOut"),S.setAttributeNS(null,"result","colorOut"),S.setAttributeNS(null,"type","matrix"),d==="none"||!JXG$1.isArray(d)||d.length<3?S.setAttributeNS(null,"values","0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 "+C+" 0"):(d[0]/=255,d[1]/=255,d[2]/=255,V=I+" 0 0 0 "+d[0]+"  0 "+I+" 0 0 "+d[1]+"  0 0 "+I+" 0 "+d[2]+"  0 0 0 "+C+" 0",S.setAttributeNS(null,"values",V)),y.appendChild(S),w=this.container.ownerDocument.createElementNS(this.svgNamespace,"feGaussianBlur"),w.setAttributeNS(null,"in","colorOut"),w.setAttributeNS(null,"result","blurOut"),w.setAttributeNS(null,"stdDeviation",f),y.appendChild(w),M=this.container.ownerDocument.createElementNS(this.svgNamespace,"feBlend"),M.setAttributeNS(null,"in","SourceGraphic"),M.setAttributeNS(null,"in2","blurOut"),M.setAttributeNS(null,"mode","normal"),y.appendChild(M),y},this.uniqName=function(){return this.container.id+"_"+Array.prototype.slice.call(arguments).join("_")},this.toStr=function(){var u=Array.prototype.slice.call(arguments).join("");return JXG$1.exists(CSS)&&JXG$1.exists(CSS.escape)&&(u=CSS.escape(u)),u},this.toURL=function(){return"url(#"+this.toStr.apply(this,arguments)+")"},this.defs.appendChild(this.createShadowFilter(this.uniqName("f1"),"none",1,.1,3,[5,5])),this.layer=[],o=0;o<Options.layer.numlayers;o++)this.layer[o]=this.container.ownerDocument.createElementNS(this.svgNamespace,"g"),this.svgRoot.appendChild(this.layer[o]);try{this.foreignObjLayer=this.container.ownerDocument.createElementNS(this.svgNamespace,"foreignObject"),this.foreignObjLayer.setAttribute("display","none"),this.foreignObjLayer.setAttribute("x",0),this.foreignObjLayer.setAttribute("y",0),this.foreignObjLayer.setAttribute("width","100%"),this.foreignObjLayer.setAttribute("height","100%"),this.foreignObjLayer.setAttribute("id",this.uniqName("foreignObj")),this.svgRoot.appendChild(this.foreignObjLayer),this.supportsForeignObject=!0}catch{this.supportsForeignObject=!1}};JXG$1.SVGRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.SVGRenderer.prototype,{_createArrowHead:function(n,t,o){var u,d,C=n.id+"Triangle",I,f;return JXG$1.exists(t)&&(C+=t),JXG$1.exists(o)&&(C+=o),u=this.createPrim("marker",C),u.setAttributeNS(null,"stroke",JXG$1.evaluate(n.visProp.strokecolor)),u.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),u.setAttributeNS(null,"fill",JXG$1.evaluate(n.visProp.strokecolor)),u.setAttributeNS(null,"fill-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),u.setAttributeNS(null,"stroke-width",0),u.setAttributeNS(null,"orient","auto"),u.setAttributeNS(null,"markerUnits","strokeWidth"),d=this.container.ownerDocument.createElementNS(this.svgNamespace,"path"),f=5,t==="Start"?(I=0,o===2?d.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 L 5,5 z"):o===3?d.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z"):o===4?(f=3.31,d.setAttributeNS(null,"d","M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31")):o===5?(f=3.28,d.setAttributeNS(null,"d","M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28")):o===6?(f=2.84,d.setAttributeNS(null,"d","M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84")):o===7?(f=5.2,d.setAttributeNS(null,"d","M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20")):d.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 z"),n.elementClass===Const.OBJECT_CLASS_LINE&&(o===2?I=4.9:o===3?I=3.3:o===4||o===5||o===6?I=6.66:o===7?I=0:I=10)):(I=10,o===2?d.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 L 5,5 z"):o===3?(I=3.3,d.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z")):o===4?(f=3.31,d.setAttributeNS(null,"d","M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31")):o===5?(f=3.28,d.setAttributeNS(null,"d","M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28")):o===6?(f=2.84,d.setAttributeNS(null,"d","M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84")):o===7?(f=5.2,d.setAttributeNS(null,"d","M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20")):d.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 z"),n.elementClass===Const.OBJECT_CLASS_LINE&&(o===2?I=5.1:o===3?I=.02:o===4||o===5||o===6?I=3.33:o===7?I=10:I=.05)),o===7&&(u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"stroke-width",1)),u.setAttributeNS(null,"refY",f),u.setAttributeNS(null,"refX",I),u.appendChild(d),u},_setArrowColor:function(n,t,o,u,d){n&&(JXG$1.isString(t)&&(d!==7?this._setAttribute(function(){n.setAttributeNS(null,"stroke",t),n.setAttributeNS(null,"fill",t),n.setAttributeNS(null,"stroke-opacity",o),n.setAttributeNS(null,"fill-opacity",o)},u.visPropOld.fillcolor):this._setAttribute(function(){n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"stroke",t),n.setAttributeNS(null,"stroke-opacity",o)},u.visPropOld.fillcolor)),this.isIE&&u.rendNode.parentNode.insertBefore(u.rendNode,u.rendNode))},_setArrowWidth:function(n,t,o,u){var d,C;n&&(d=t,C=d*u,n.setAttributeNS(null,"viewBox","0 0 "+d*10+" "+d*10),n.setAttributeNS(null,"markerHeight",C),n.setAttributeNS(null,"markerWidth",C),n.setAttributeNS(null,"display","inherit"),this.isIE&&o.parentNode.insertBefore(o,o))},updateTicks:function(n){var t,o,u,d,C,I,f="",A=n.ticks.length,y,G,S=!0;for(t=0;t<A;t++){for(u=n.ticks[t],C=u[0],I=u[1],y=C.length,G=" M "+C[0]+" "+I[0],JXG$1.isNumber(C[0])||(S=!1),o=1;S&&o<y;++o)JXG$1.isNumber(C[o])?G+=" L "+C[o]+" "+I[o]:S=!1;S&&(f+=G)}d=n.rendNode,JXG$1.exists(d)||(d=this.createPrim("path",n.id),this.appendChildPrim(d,JXG$1.evaluate(n.visProp.layer)),n.rendNode=d),d.setAttributeNS(null,"stroke",JXG$1.evaluate(n.visProp.strokecolor)),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"stroke-opacity",JXG$1.evaluate(n.visProp.strokeopacity)),d.setAttributeNS(null,"stroke-width",JXG$1.evaluate(n.visProp.strokewidth)),this.updatePathPrim(d,f,n.board),this.setObjectViewport(n)},displayCopyright:function(n,t){var o=this.createPrim("text","licenseText"),u;o.setAttributeNS(null,"x","20px"),o.setAttributeNS(null,"y",2+t+"px"),o.setAttributeNS(null,"style","font-family:Arial,Helvetica,sans-serif; font-size:"+t+"px; fill:#356AA0;  opacity:0.3;"),u=this.container.ownerDocument.createTextNode(n),o.appendChild(u),this.appendChildPrim(o,0)},drawInternalText:function(n){var t=this.createPrim("text",n.id);return t.style.whiteSpace="nowrap",n.rendNodeText=this.container.ownerDocument.createTextNode(""),t.appendChild(n.rendNodeText),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),t},updateInternalText:function(n){var t=n.plaintext,o,u=n.getAnchorX(),d=n.getAnchorY();n.rendNode.getAttributeNS(null,"class")!==n.visProp.cssclass&&(n.rendNode.setAttributeNS(null,"class",JXG$1.evaluate(n.visProp.cssclass)),n.needsSizeUpdate=!0),isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])||(o=n.coords.scrCoords[1],n.visPropOld.left!==u+o&&(n.rendNode.setAttributeNS(null,"x",o+"px"),u==="left"?n.rendNode.setAttributeNS(null,"text-anchor","start"):u==="right"?n.rendNode.setAttributeNS(null,"text-anchor","end"):u==="middle"&&n.rendNode.setAttributeNS(null,"text-anchor","middle"),n.visPropOld.left=u+o),o=n.coords.scrCoords[2],n.visPropOld.top!==d+o&&(n.rendNode.setAttributeNS(null,"y",o+this.vOffsetText*.5+"px"),d==="bottom"?(n.rendNode.setAttributeNS(null,"dy","0"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")):d==="top"?(n.rendNode.setAttributeNS(null,"dy","1.6ex"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")):d==="middle"&&(n.rendNode.setAttributeNS(null,"dy","0.6ex"),n.rendNode.setAttributeNS(null,"dominant-baseline","auto")),n.visPropOld.top=d+o)),n.htmlStr!==t&&(n.rendNodeText.data=t,n.htmlStr=t),this.transformImage(n,n.transformations)},updateInternalTextStyle:function(n,t,o,u){this.setObjectViewport(n),this.setObjectFillColor(n,t,o)},drawImage:function(n){var t=this.createPrim("image",n.id);t.setAttributeNS(null,"preserveAspectRatio","none"),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),n.rendNode=t,this.updateImage(n)},transformImage:function(n,t){var o,u,d=n.rendNode,C="",I,f,A=t.length;if(A>0&&(u=this.joinTransforms(n,t),o=[u[1][1],u[2][1],u[1][2],u[2][2],u[1][0],u[2][0]].join(","),o.indexOf("NaN")===-1))if(C+=" matrix("+o+") ",n.elementClass===Const.OBJECT_CLASS_TEXT&&n.visProp.display==="html"){switch(d.style.transform=C,I=-n.coords.scrCoords[1],f=-n.coords.scrCoords[2],JXG$1.evaluate(n.visProp.anchorx)){case"right":I+=n.size[0];break;case"middle":I+=n.size[0]*.5;break}switch(JXG$1.evaluate(n.visProp.anchory)){case"bottom":f+=n.size[1];break;case"middle":f+=n.size[1]*.5;break}d.style["transform-origin"]=I+"px "+f+"px"}else d.setAttributeNS(null,"transform",C)},updateImageURL:function(n){var t=JXG$1.evaluate(n.url);return n._src!==t?(n.imgIsLoaded=!1,n.rendNode.setAttributeNS(this.xlinkNamespace,"xlink:href",t),n._src=t,!0):!1},updateImageStyle:function(n,t){var o=JXG$1.evaluate(t?n.visProp.highlightcssclass:n.visProp.cssclass);n.rendNode.setAttributeNS(null,"class",o)},drawForeignObject:function(n){n.rendNode=this.appendChildPrim(this.createPrim("foreignObject",n.id),JXG$1.evaluate(n.visProp.layer)),this.appendNodesToElement(n,"foreignObject"),this.updateForeignObject(n)},updateForeignObject:function(n){n._useUserSize?n.rendNode.style.overflow="hidden":n.rendNode.style.overflow="visible",this.updateRectPrim(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),n.rendNode.innerHTML=n.content,this._updateVisual(n,{stroke:!0,dash:!0},!0)},appendChildPrim:function(n,t){return JXG$1.exists(t)?t>=Options.layer.numlayers&&(t=Options.layer.numlayers-1):t=0,this.layer[t].appendChild(n),n},createPrim:function(n,t){var o=this.container.ownerDocument.createElementNS(this.svgNamespace,n);return o.setAttributeNS(null,"id",this.uniqName(t)),o.style.position="absolute",n==="path"&&(o.setAttributeNS(null,"stroke-linecap","round"),o.setAttributeNS(null,"stroke-linejoin","round"),o.setAttributeNS(null,"fill-rule","evenodd")),o},remove:function(n){JXG$1.exists(n)&&JXG$1.exists(n.parentNode)&&n.parentNode.removeChild(n)},setLayer:function(n,t){JXG$1.exists(t)?t>=Options.layer.numlayers&&(t=Options.layer.numlayers-1):t=0,this.layer[t].appendChild(n.rendNode)},makeArrows:function(n,t){var o,u,d=t.evFirst,C=t.evLast;if(this.isIE&&n.visPropCalc.visible&&(d||C)){n.rendNode.parentNode.insertBefore(n.rendNode,n.rendNode);return}o=n.rendNodeTriangleStart,d?(u=this.toStr(this.container.id,"_",n.id,"TriangleStart",t.typeFirst),(!JXG$1.exists(o)||o.id!==u)&&(o=this.container.ownerDocument.getElementById(u),o===null&&(o=this._createArrowHead(n,"Start",t.typeFirst),this.defs.appendChild(o)),n.rendNodeTriangleStart=o,n.rendNode.setAttributeNS(null,"marker-start",this.toURL(u)))):(JXG$1.exists(o)&&(this.remove(o),n.rendNodeTriangleStart=null),n.rendNode.setAttributeNS(null,"marker-start",null)),o=n.rendNodeTriangleEnd,C?(u=this.toStr(this.container.id,"_",n.id,"TriangleEnd",t.typeLast),(!JXG$1.exists(o)||o.id!==u)&&(o=this.container.ownerDocument.getElementById(u),o===null&&(o=this._createArrowHead(n,"End",t.typeLast),this.defs.appendChild(o)),n.rendNodeTriangleEnd=o,n.rendNode.setAttributeNS(null,"marker-end",this.toURL(u)))):(JXG$1.exists(o)&&(this.remove(o),n.rendNodeTriangleEnd=null),n.rendNode.setAttributeNS(null,"marker-end",null))},updateEllipsePrim:function(n,t,o,u,d){var C=1e6;C=2e5,t=Math.abs(t)<C?t:C*t/Math.abs(t),o=Math.abs(o)<C?o:C*o/Math.abs(o),u=Math.abs(u)<C?u:C*u/Math.abs(u),d=Math.abs(d)<C?d:C*d/Math.abs(d),n.setAttributeNS(null,"cx",t),n.setAttributeNS(null,"cy",o),n.setAttributeNS(null,"rx",Math.abs(u)),n.setAttributeNS(null,"ry",Math.abs(d))},updateLinePrim:function(n,t,o,u,d){var C=1e6;C=2e5,isNaN(t+o+u+d)||(t=Math.abs(t)<C?t:C*t/Math.abs(t),o=Math.abs(o)<C?o:C*o/Math.abs(o),u=Math.abs(u)<C?u:C*u/Math.abs(u),d=Math.abs(d)<C?d:C*d/Math.abs(d),n.setAttributeNS(null,"x1",t),n.setAttributeNS(null,"y1",o),n.setAttributeNS(null,"x2",u),n.setAttributeNS(null,"y2",d))},updatePathPrim:function(n,t){t===""&&(t="M 0 0"),n.setAttributeNS(null,"d",t)},updatePathStringPoint:function(n,t,o){var u="",d=n.coords.scrCoords,C=t*Math.sqrt(3)*.5,I=t*.5;return o==="x"?u=" M "+(d[1]-t)+" "+(d[2]-t)+" L "+(d[1]+t)+" "+(d[2]+t)+" M "+(d[1]+t)+" "+(d[2]-t)+" L "+(d[1]-t)+" "+(d[2]+t):o==="+"?u=" M "+(d[1]-t)+" "+d[2]+" L "+(d[1]+t)+" "+d[2]+" M "+d[1]+" "+(d[2]-t)+" L "+d[1]+" "+(d[2]+t):o==="|"?u=" M "+d[1]+" "+(d[2]-t)+" L "+d[1]+" "+(d[2]+t):o==="-"?u=" M "+(d[1]-t)+" "+d[2]+" L "+(d[1]+t)+" "+d[2]:o==="<>"||o==="<<>>"?(o==="<<>>"&&(t*=1.41),u=" M "+(d[1]-t)+" "+d[2]+" L "+d[1]+" "+(d[2]+t)+" L "+(d[1]+t)+" "+d[2]+" L "+d[1]+" "+(d[2]-t)+" Z "):o==="^"?u=" M "+d[1]+" "+(d[2]-t)+" L "+(d[1]-C)+" "+(d[2]+I)+" L "+(d[1]+C)+" "+(d[2]+I)+" Z ":o==="v"?u=" M "+d[1]+" "+(d[2]+t)+" L "+(d[1]-C)+" "+(d[2]-I)+" L "+(d[1]+C)+" "+(d[2]-I)+" Z ":o===">"?u=" M "+(d[1]+t)+" "+d[2]+" L "+(d[1]-I)+" "+(d[2]-C)+" L "+(d[1]-I)+" "+(d[2]+C)+" Z ":o==="<"&&(u=" M "+(d[1]-t)+" "+d[2]+" L "+(d[1]+I)+" "+(d[2]-C)+" L "+(d[1]+I)+" "+(d[2]+C)+" Z "),u},updatePathStringPrim:function(n){var t,o,u,d=" M ",C=" L ",I=" C ",f=d,A=5e3,y="";if(n.numberPoints<=0)return"";if(u=Math.min(n.points.length,n.numberPoints),n.bezierDegree===1)for(t=0;t<u;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?f=d:(o[1]=Math.max(Math.min(o[1],A),-5e3),o[2]=Math.max(Math.min(o[2],A),-5e3),y+=f+o[1]+" "+o[2],f=C);else if(n.bezierDegree===3)for(t=0;t<u;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?f=d:(y+=f+o[1]+" "+o[2],f===I&&(t+=1,o=n.points[t].scrCoords,y+=" "+o[1]+" "+o[2],t+=1,o=n.points[t].scrCoords,y+=" "+o[1]+" "+o[2]),f=I),t+=1;return y},updatePathStringBezierPrim:function(n){var t,o,u,d,C,I,f,A=" M ",y=" C ",G=A,S=5e3,w="",M=JXG$1.evaluate(n.visProp.strokewidth),V=JXG$1.evaluate(n.visProp.curvetype)!=="plot";if(n.numberPoints<=0)return"";for(V&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,.5)),f=Math.min(n.points.length,n.numberPoints),o=1;o<3;o++)for(G=A,t=0;t<f;t++)d=n.points[t].scrCoords,isNaN(d[1])||isNaN(d[2])?G=A:(d[1]=Math.max(Math.min(d[1],S),-5e3),d[2]=Math.max(Math.min(d[2],S),-5e3),G===A?w+=G+d[1]+" "+d[2]:(u=2*o,w+=[G,C+(d[1]-C)*.333+M*(u*Math.random()-o)," ",I+(d[2]-I)*.333+M*(u*Math.random()-o)," ",C+(d[1]-C)*.666+M*(u*Math.random()-o)," ",I+(d[2]-I)*.666+M*(u*Math.random()-o)," ",d[1]," ",d[2]].join("")),G=y,C=d[1],I=d[2]);return w},updatePolygonPrim:function(n,t){var o,u="",d,C=t.vertices.length;for(n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"fill-rule","evenodd"),t.elType==="polygonalchain"&&C++,o=0;o<C-1;o++){if(t.vertices[o].isReal)d=t.vertices[o].coords.scrCoords,u=u+d[1]+","+d[2];else{n.setAttributeNS(null,"points","");return}o<C-2&&(u+=" ")}u.indexOf("NaN")===-1&&n.setAttributeNS(null,"points",u)},updateRectPrim:function(n,t,o,u,d){n.setAttributeNS(null,"x",t),n.setAttributeNS(null,"y",o),n.setAttributeNS(null,"width",u),n.setAttributeNS(null,"height",d)},setPropertyPrim:function(n,t,o){t!=="stroked"&&n.setAttributeNS(null,t,o)},display:function(n,t){var o;n&&n.rendNode&&(n.visPropOld.visible=t,o=n.rendNode,t?(o.setAttributeNS(null,"display","inline"),o.style.visibility="inherit"):(o.setAttributeNS(null,"display","none"),o.style.visibility="hidden"))},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),this.display(n,!0)},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),this.display(n,!1)},setBuffering:function(n,t){n.rendNode.setAttribute("buffered-rendering",t)},setDashStyle:function(n){var t=JXG$1.evaluate(n.visProp.dash),o=JXG$1.evaluate(n.visProp.dashscale),u=o?.5*JXG$1.evaluate(n.visProp.strokewidth):1,d=n.rendNode;t>0?d.setAttributeNS(null,"stroke-dasharray",this.dashArray[t-1].map(function(C){return C*u}).join(",")):d.hasAttributeNS(null,"stroke-dasharray")&&d.removeAttributeNS(null,"stroke-dasharray")},setGradient:function(n){var t=n.rendNode,o,u,d,C=JXG$1.evaluate(n.visProp.gradient);C==="linear"||C==="radial"?(o=this.createPrim(C+"Gradient",n.id+"_gradient"),u=this.createPrim("stop",n.id+"_gradient1"),d=this.createPrim("stop",n.id+"_gradient2"),o.appendChild(u),o.appendChild(d),this.defs.appendChild(o),t.setAttributeNS(null,"style","fill:"+this.toURL(this.container.id+"_"+n.id+"_gradient")),n.gradNode1=u,n.gradNode2=d,n.gradNode=o):t.removeAttributeNS(null,"style")},updateGradientAngle:function(n,t){var o=1,u=Math.cos(t),d=Math.sin(t);Math.abs(u)>Math.abs(d)?o/=Math.abs(u):o/=Math.abs(d),u>=0?(n.setAttributeNS(null,"x1",0),n.setAttributeNS(null,"x2",u*o)):(n.setAttributeNS(null,"x1",-u*o),n.setAttributeNS(null,"x2",0)),d>=0?(n.setAttributeNS(null,"y1",0),n.setAttributeNS(null,"y2",d*o)):(n.setAttributeNS(null,"y1",-d*o),n.setAttributeNS(null,"y2",0))},updateGradientCircle:function(n,t,o,u,d,C,I){n.setAttributeNS(null,"cx",t*100+"%"),n.setAttributeNS(null,"cy",o*100+"%"),n.setAttributeNS(null,"r",u*100+"%"),n.setAttributeNS(null,"fx",d*100+"%"),n.setAttributeNS(null,"fy",C*100+"%"),n.setAttributeNS(null,"fr",I*100+"%")},updateGradient:function(n){var t,o,u=n.gradNode1,d=n.gradNode2,C=JXG$1.evaluate(n.visProp.gradient);!JXG$1.exists(u)||!JXG$1.exists(d)||(o=JXG$1.evaluate(n.visProp.fillopacity),o=o>0?o:0,t=JXG$1.evaluate(n.visProp.fillcolor),u.setAttributeNS(null,"style","stop-color:"+t+";stop-opacity:"+o),d.setAttributeNS(null,"style","stop-color:"+JXG$1.evaluate(n.visProp.gradientsecondcolor)+";stop-opacity:"+JXG$1.evaluate(n.visProp.gradientsecondopacity)),u.setAttributeNS(null,"offset",JXG$1.evaluate(n.visProp.gradientstartoffset)*100+"%"),d.setAttributeNS(null,"offset",JXG$1.evaluate(n.visProp.gradientendoffset)*100+"%"),C==="linear"?this.updateGradientAngle(n.gradNode,JXG$1.evaluate(n.visProp.gradientangle)):C==="radial"&&this.updateGradientCircle(n.gradNode,JXG$1.evaluate(n.visProp.gradientcx),JXG$1.evaluate(n.visProp.gradientcy),JXG$1.evaluate(n.visProp.gradientr),JXG$1.evaluate(n.visProp.gradientfx),JXG$1.evaluate(n.visProp.gradientfy),JXG$1.evaluate(n.visProp.gradientfr)))},setObjectTransition:function(n,t){var o,u,d=[],C,I,f=0,A=["rendNode","rendNodeTriangleStart","rendNodeTriangleEnd"];if(t===void 0&&(t=JXG$1.evaluate(n.visProp.transitionduration)),u=JXG$1.evaluate(n.visProp.transitionproperties),!(t===n.visPropOld.transitionduration&&u===n.visPropOld.transitionproperties)){for(JXG$1.exists(u)&&(f=u.length),I=0;I<f;I++)d.push(u[I]+" "+t+"ms");for(C=d.join(", "),f=A.length,I=0;I<f;++I)n[A[I]]&&(o=n[A[I]],o.style.transition=C);n.visPropOld.transitionduration=t,n.visPropOld.transitionproperties=u}},setObjectViewport:function(n,t){},_setAttribute:function(n,t){t===""?n():window.setTimeout(n,1)},setObjectFillColor:function(n,t,o,u){var d,C,I,f,A=JXG$1.evaluate(t),y=JXG$1.evaluate(o),G=JXG$1.evaluate(n.visProp.gradient);y=y>0?y:0,!(n.visPropOld.fillcolor===A&&n.visPropOld.fillopacity===y&&G===null)&&(JXG$1.exists(A)&&A!==!1&&(A.length!==9?(C=A,f=y):(I=JXG$1.rgba2rgbo(A),C=I[0],f=y*I[1]),u===void 0?d=n.rendNode:d=u,C!=="none"&&this._setAttribute(function(){d.setAttributeNS(null,"fill",C)},n.visPropOld.fillcolor),n.type===JXG$1.OBJECT_TYPE_IMAGE?this._setAttribute(function(){d.setAttributeNS(null,"opacity",f)},n.visPropOld.fillopacity):(C==="none"?(f=0,d.setAttributeNS(null,"pointer-events","visibleStroke")):d.setAttributeNS(null,"pointer-events","visiblePainted"),this._setAttribute(function(){d.setAttributeNS(null,"fill-opacity",f)},n.visPropOld.fillopacity)),(G==="linear"||G==="radial")&&this.updateGradient(n)),n.visPropOld.fillcolor=A,n.visPropOld.fillopacity=y)},setObjectStrokeColor:function(n,t,o){var u=JXG$1.evaluate(t),d,C,I=JXG$1.evaluate(o),f,A;I=I>0?I:0,!(n.visPropOld.strokecolor===u&&n.visPropOld.strokeopacity===I)&&(JXG$1.exists(u)&&u!==!1&&(u.length!==9?(d=u,f=I):(C=JXG$1.rgba2rgbo(u),d=C[0],f=I*C[1]),A=n.rendNode,n.elementClass===Const.OBJECT_CLASS_TEXT?JXG$1.evaluate(n.visProp.display)==="html"?this._setAttribute(function(){A.style.color=d,A.style.opacity=f},n.visPropOld.strokecolor):this._setAttribute(function(){A.setAttributeNS(null,"style","fill:"+d),A.setAttributeNS(null,"style","fill-opacity:"+f)},n.visPropOld.strokecolor):this._setAttribute(function(){A.setAttributeNS(null,"stroke",d),A.setAttributeNS(null,"stroke-opacity",f)},n.visPropOld.strokecolor),(n.elementClass===Const.OBJECT_CLASS_CURVE||n.elementClass===Const.OBJECT_CLASS_LINE)&&(JXG$1.evaluate(n.visProp.firstarrow)&&this._setArrowColor(n.rendNodeTriangleStart,d,f,n,n.visPropCalc.typeFirst),JXG$1.evaluate(n.visProp.lastarrow)&&this._setArrowColor(n.rendNodeTriangleEnd,d,f,n,n.visPropCalc.typeLast))),n.visPropOld.strokecolor=u,n.visPropOld.strokeopacity=I)},setObjectStrokeWidth:function(n,t){var o,u=JXG$1.evaluate(t);isNaN(u)||n.visPropOld.strokewidth===u||(o=n.rendNode,this.setPropertyPrim(o,"stroked","true"),JXG$1.exists(u)&&this.setPropertyPrim(o,"stroke-width",u+"px"),n.visPropOld.strokewidth=u)},setLineCap:function(n){var t=JXG$1.evaluate(n.visProp.linecap);t===void 0||t===""||n.visPropOld.linecap===t||!JXG$1.exists(n.rendNode)||(this.setPropertyPrim(n.rendNode,"stroke-linecap",t),n.visPropOld.linecap=t)},setShadow:function(n){var t=JXG$1.evaluate(n.visProp.shadow),o,u,d,C,I,f,A,y,G=!0,S=!1;o=JSON.stringify(t),o!==n.visPropOld.shadow&&(typeof t=="boolean"?(G=!0,S=t,u="none",d=3,C=.1,I=[5,5],f=1):JXG$1.evaluate(t.enabled)?(G=!1,S=!0,u=JXG$1.rgbParser(JXG$1.evaluate(t.color)),d=JXG$1.evaluate(t.blur),C=JXG$1.evaluate(t.blend),I=JXG$1.evaluate(t.offset),f=JXG$1.evaluate(t.opacity)):S=!1,JXG$1.exists(n.rendNode)&&(S?G?n.rendNode.setAttributeNS(null,"filter",this.toURL(this.container.id+"_f1")):(y=this.container.ownerDocument.getElementById(A),y&&this.defs.removeChild(y),A=n.rendNode.id+"_f1",this.defs.appendChild(this.createShadowFilter(A,u,f,C,d,I)),n.rendNode.setAttributeNS(null,"filter",this.toURL(A))):n.rendNode.removeAttributeNS(null,"filter")),n.visPropOld.shadow=o)},suspendRedraw:function(){this.suspendHandle=this.svgRoot.suspendRedraw(1e4)},unsuspendRedraw:function(){this.svgRoot.unsuspendRedraw(this.suspendHandle)},resize:function(n,t){this.svgRoot.setAttribute("width",parseFloat(n)),this.svgRoot.setAttribute("height",parseFloat(t))},createTouchpoints:function(n){var t,o,u,d;for(this.touchpoints=[],t=0;t<n;t++)o="touchpoint1_"+t,d=this.createPrim("path",o),this.appendChildPrim(d,19),d.setAttributeNS(null,"d","M 0 0"),this.touchpoints.push(d),this.setPropertyPrim(d,"stroked","true"),this.setPropertyPrim(d,"stroke-width","1px"),d.setAttributeNS(null,"stroke","#000000"),d.setAttributeNS(null,"stroke-opacity",1),d.setAttributeNS(null,"display","none"),u="touchpoint2_"+t,d=this.createPrim("ellipse",u),this.appendChildPrim(d,19),this.updateEllipsePrim(d,0,0,0,0),this.touchpoints.push(d),this.setPropertyPrim(d,"stroked","true"),this.setPropertyPrim(d,"stroke-width","1px"),d.setAttributeNS(null,"stroke","#000000"),d.setAttributeNS(null,"stroke-opacity",1),d.setAttributeNS(null,"fill","#ffffff"),d.setAttributeNS(null,"fill-opacity",0),d.setAttributeNS(null,"display","none")},showTouchpoint:function(n){this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(this.touchpoints[2*n].setAttributeNS(null,"display","inline"),this.touchpoints[2*n+1].setAttributeNS(null,"display","inline"))},hideTouchpoint:function(n){this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(this.touchpoints[2*n].setAttributeNS(null,"display","none"),this.touchpoints[2*n+1].setAttributeNS(null,"display","none"))},updateTouchpoint:function(n,t){var o,u,d=37;this.touchpoints&&n>=0&&2*n<this.touchpoints.length&&(o=t[0],u=t[1],this.touchpoints[2*n].setAttributeNS(null,"d","M "+(o-d)+" "+u+" L "+(o+d)+" "+u+" M "+o+" "+(u-d)+" L "+o+" "+(u+d)),this.updateEllipsePrim(this.touchpoints[2*n+1],t[0],t[1],25,25))},_getValuesOfDOMElements:function(n){var t=[];if(n.nodeType===1)for(n=n.firstChild;n;)n.id!==void 0&&n.value!==void 0&&t.push([n.id,n.value]),JXG$1.concat(t,this._getValuesOfDOMElements(n)),n=n.nextSibling;return t},_getImgDataURL:function(n){var t,o,u,d,C,I;if(t=n.getElementsByTagName("image"),o=t.length,o>0)for(u=document.createElement("canvas"),I=0;I<o;I++){t[I].setAttribute("crossorigin","anonymous"),d=u.getContext("2d"),u.width=t[I].getAttribute("width"),u.height=t[I].getAttribute("height");try{d.drawImage(t[I],0,0,u.width,u.height),C=u.toDataURL(),t[I].setAttribute("xlink:href",C)}catch(f){console.log("CORS problem! Image can not be used",f)}}return!0},dumpToDataURI:function(n){var t=this.svgRoot,o=window.btoa||Base64.encode,u,d,C,I=[];if(this.container.hasChildNodes()&&JXG$1.exists(this.foreignObjLayer))for(n||this.foreignObjLayer.setAttribute("display","inline");t.nextSibling;)JXG$1.concat(I,this._getValuesOfDOMElements(t.nextSibling)),this.foreignObjLayer.appendChild(t.nextSibling);if(this._getImgDataURL(t),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),u=new XMLSerializer().serializeToString(t),n!==!0)for(C=I.length,d=0;d<C;d++)u=u.replace('id="'+I[d][0]+'"','id="'+I[d][0]+'" value="'+I[d][1]+'"');if(this.isIE&&(u.match(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g)||[]).length>1&&(u=u.replace(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g,"")),u=u.replace(/&nbsp;/g," "),u=u.replace(/url\(&quot;(.*)&quot;\)/g,"url($1)"),JXG$1.exists(this.foreignObjLayer)&&this.foreignObjLayer.hasChildNodes()){for(;this.foreignObjLayer.firstChild;)this.container.appendChild(this.foreignObjLayer.firstChild);this.foreignObjLayer.setAttribute("display","none")}return"data:image/svg+xml;base64,"+o(unescape(encodeURIComponent(u)))},dumpToCanvas:function(n,t,o,u){var d,C,I,f,A=this.container.ownerDocument;return I=A.getElementById(n),I.width=I.width,f=I.getContext("2d"),t!==void 0&&o!==void 0&&(I.style.width=parseFloat(t)+"px",I.style.height=parseFloat(o)+"px",I.setAttribute("width",parseFloat(t)),I.setAttribute("height",parseFloat(o))),C=new Image,d=this.dumpToDataURI(u),C.src=d,"Promise"in window?new Promise(function(y,G){try{C.onload=function(){f.drawImage(C,0,0,t,o),y()}}catch(S){G(S)}}):(C.onload=function(){window.setTimeout(function(){try{f.drawImage(C,0,0,t,o)}catch{console.log("screenshots not longer supported on IE")}},200)},this)},screenshot:function(n,t,o){var u,d=this.container.ownerDocument,C=this.container.parentNode,I,f,A,y,G,S,w,M=n.attr.screenshot,V,T,H,J=!1,z;return this.type==="no"?this:(S=M.scale*this.container.getBoundingClientRect().width,w=M.scale*this.container.getBoundingClientRect().height,t===void 0||t===""?(J=!0,A=new Image,A.style.width=S+"px",A.style.height=w+"px"):(J=!1,A=d.getElementById(t)),J&&(u=d.createElement("div"),u.style.cssText=M.css,u.style.width=S+"px",u.style.height=w+"px",u.style.zIndex=this.container.style.zIndex+120,u.style.position="absolute",u.style.top=this.container.offsetTop+"px",u.style.left=this.container.offsetLeft+"px"),I=d.createElement("canvas"),f=Math.random().toString(36).slice(2,7),I.setAttribute("id",f),I.setAttribute("width",S),I.setAttribute("height",w),I.style.width=S+"px",I.style.height=S+"px",I.style.display="none",C.appendChild(I),J&&(y=d.createElement("span"),G=d.createTextNode("✖"),y.style.cssText=M.cssButton,y.appendChild(G),y.onclick=function(){u.parentNode.removeChild(u)},u.appendChild(A),u.appendChild(y),C.insertBefore(u,this.container.nextSibling)),V=d.getElementById(this.uniqName("navigationbar")),JXG$1.exists(V)&&(T=V.style.display,V.style.display="none",H=this.removeToInsertLater(V)),z=function(){A.src=I.toDataURL("image/png"),C.removeChild(I)},"Promise"in window?this.dumpToCanvas(f,S,w,o).then(z):(this.dumpToCanvas(f,S,w,o),window.setTimeout(z,200)),JXG$1.exists(V)&&(V.style.display=T,H()),this)}});const SVGRenderer=JXG$1.SVGRenderer;JXG$1.VMLRenderer=function(n){this.type="vml",this.container=n,this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.onselectstart=function(){return!1},this.resolution=10,JXG$1.exists(JXG$1.vmlStylesheet)||(n.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),JXG$1.vmlStylesheet=this.container.ownerDocument.createStyleSheet(),JXG$1.vmlStylesheet.addRule(".jxgvml","behavior:url(#default#VML)"));try{n.ownerDocument.namespaces.jxgvml||n.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),this.createNode=function(t){return n.ownerDocument.createElement("<jxgvml:"+t+' class="jxgvml">')}}catch{this.createNode=function(o){return n.ownerDocument.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="jxgvml">')}}this.dashArray=["Solid","1 1","ShortDash","Dash","LongDash","ShortDashDot","LongDashDot"]};JXG$1.VMLRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.VMLRenderer.prototype,{_setAttr:function(n,t,o,u){try{this.container.ownerDocument.documentMode===8?n[t]=o:n.setAttribute(t,o,u)}catch{JXG$1.debug("_setAttr: "+t+" "+o+`<br>
`)}},updateTicks:function(n){var t,o,u,d,C,I=this.resolution,f=[];for(o=n.ticks.length,t=0;t<o;t++)u=n.ticks[t],d=u[0],C=u[1],JXG$1.isNumber(d[0])&&JXG$1.isNumber(d[1])&&f.push(" m "+Math.round(I*d[0])+", "+Math.round(I*C[0])+" l "+Math.round(I*d[1])+", "+Math.round(I*C[1])+" ");JXG$1.exists(n.rendNode)||(n.rendNode=this.createPrim("path",n.id),this.appendChildPrim(n.rendNode,JXG$1.evaluate(n.visProp.layer))),this._setAttr(n.rendNode,"stroked","true"),this._setAttr(n.rendNode,"strokecolor",JXG$1.evaluate(n.visProp.strokecolor),1),this._setAttr(n.rendNode,"strokeweight",JXG$1.evaluate(n.visProp.strokewidth)),this._setAttr(n.rendNodeStroke,"opacity",JXG$1.evaluate(n.visProp.strokeopacity)*100+"%"),this.updatePathPrim(n.rendNode,f,n.board)},displayCopyright:function(n,t){var o,u;o=this.createNode("textbox"),o.style.position="absolute",this._setAttr(o,"id",this.container.id+"_licenseText"),o.style.left=20,o.style.top=2,o.style.fontSize=t,o.style.color="#356AA0",o.style.fontFamily="Arial,Helvetica,sans-serif",this._setAttr(o,"opacity","30%"),o.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 30, enabled = true)",u=this.container.ownerDocument.createTextNode(n),o.appendChild(u),this.appendChildPrim(o,0)},drawInternalText:function(n){var t;return t=this.createNode("textbox"),t.style.position="absolute",n.rendNodeText=this.container.ownerDocument.createTextNode(""),t.appendChild(n.rendNodeText),this.appendChildPrim(t,9),t.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",t},updateInternalText:function(n){var t,o=n.plaintext,u=this.joinTransforms(n,n.transformations),d=[0,0],C,I,f,A,y,G=n.rendNode,S=[],w=n.getAnchorX(),M=n.getAnchorY();if(!isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])){for(w==="right"?d[0]=1:w==="middle"&&(d[0]=.5),M==="bottom"?d[1]=1:M==="middle"&&(d[1]=.5),S[0]=Mat.matVecMult(u,[1,n.coords.scrCoords[1]-d[0]*n.size[0],n.coords.scrCoords[2]+(1-d[1])*n.size[1]+this.vOffsetText]),S[0][1]/=S[0][0],S[0][2]/=S[0][0],S[1]=Mat.matVecMult(u,[1,n.coords.scrCoords[1]+(1-d[0])*n.size[0],n.coords.scrCoords[2]+(1-d[1])*n.size[1]+this.vOffsetText]),S[1][1]/=S[1][0],S[1][2]/=S[1][0],S[2]=Mat.matVecMult(u,[1,n.coords.scrCoords[1]+(1-d[0])*n.size[0],n.coords.scrCoords[2]-d[1]*n.size[1]+this.vOffsetText]),S[2][1]/=S[2][0],S[2][2]/=S[2][0],S[3]=Mat.matVecMult(u,[1,n.coords.scrCoords[1]-d[0]*n.size[0],n.coords.scrCoords[2]-d[1]*n.size[1]+this.vOffsetText]),S[3][1]/=S[3][0],S[3][2]/=S[3][0],C=S[0][1],f=S[0][1],I=S[0][2],A=S[0][2],y=1;y<4;y++)C=Math.max(C,S[y][1]),f=Math.min(f,S[y][1]),I=Math.max(I,S[y][2]),A=Math.min(A,S[y][2]);t=d[0]===1?Math.floor(n.board.canvasWidth-C):Math.floor(f),n.visPropOld.left!==w+t&&(d[0]===1?(n.rendNode.style.right=t+"px",n.rendNode.style.left="auto"):(n.rendNode.style.left=t+"px",n.rendNode.style.right="auto"),n.visPropOld.left=w+t),t=d[1]===1?Math.floor(n.board.canvasHeight-I):Math.floor(A),n.visPropOld.top!==M+t&&(d[1]===1?(n.rendNode.style.bottom=t+"px",n.rendNode.style.top="auto"):(n.rendNode.style.top=t+"px",n.rendNode.style.bottom="auto"),n.visPropOld.top=M+t)}n.htmlStr!==o&&(n.rendNodeText.data=o,n.htmlStr=o),G.filters.item(0).M11=u[1][1],G.filters.item(0).M12=u[1][2],G.filters.item(0).M21=u[2][1],G.filters.item(0).M22=u[2][2],G.filters.item(0).enabled=!0},drawImage:function(n){var t;t=this.container.ownerDocument.createElement("img"),t.style.position="absolute",this._setAttr(t,"id",this.container.id+"_"+n.id),this.container.appendChild(t),this.appendChildPrim(t,JXG$1.evaluate(n.visProp.layer)),t.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand') progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",n.rendNode=t,this.updateImage(n)},transformImage:function(n,t){var o,u,d,C,I,f,A=n.rendNode,y=[],G=t.length;if(G>0){for(o=this.joinTransforms(n,t),y[0]=Mat.matVecMult(o,n.coords.scrCoords),y[0][1]/=y[0][0],y[0][2]/=y[0][0],y[1]=Mat.matVecMult(o,[1,n.coords.scrCoords[1]+n.size[0],n.coords.scrCoords[2]]),y[1][1]/=y[1][0],y[1][2]/=y[1][0],y[2]=Mat.matVecMult(o,[1,n.coords.scrCoords[1]+n.size[0],n.coords.scrCoords[2]-n.size[1]]),y[2][1]/=y[2][0],y[2][2]/=y[2][0],y[3]=Mat.matVecMult(o,[1,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1]]),y[3][1]/=y[3][0],y[3][2]/=y[3][0],u=y[0][1],C=y[0][1],d=y[0][2],I=y[0][2],f=1;f<4;f++)u=Math.max(u,y[f][1]),C=Math.min(C,y[f][1]),d=Math.max(d,y[f][2]),I=Math.min(I,y[f][2]);A.style.left=Math.floor(C)+"px",A.style.top=Math.floor(I)+"px",A.filters.item(0).M11=o[1][1],A.filters.item(0).M12=o[1][2],A.filters.item(0).M21=o[2][1],A.filters.item(0).M22=o[2][2],A.filters.item(0).enabled=!0}},updateImageURL:function(n){var t=JXG$1.evaluate(n.url);this._setAttr(n.rendNode,"src",t)},appendChildPrim:function(n,t){return JXG$1.exists(t)||(t=0),n.style.zIndex=t,this.container.appendChild(n),n},appendNodesToElement:function(n,t){(t==="shape"||t==="path"||t==="polygon")&&(n.rendNodePath=this.getElementById(n.id+"_path")),n.rendNodeFill=this.getElementById(n.id+"_fill"),n.rendNodeStroke=this.getElementById(n.id+"_stroke"),n.rendNodeShadow=this.getElementById(n.id+"_shadow"),n.rendNode=this.getElementById(n.id)},createPrim:function(n,t){var o,u,d=this.createNode("fill"),C=this.createNode("stroke"),I=this.createNode("shadow");return this._setAttr(d,"id",this.container.id+"_"+t+"_fill"),this._setAttr(C,"id",this.container.id+"_"+t+"_stroke"),this._setAttr(I,"id",this.container.id+"_"+t+"_shadow"),n==="circle"||n==="ellipse"?(o=this.createNode("oval"),o.appendChild(d),o.appendChild(C),o.appendChild(I)):n==="polygon"||n==="path"||n==="shape"||n==="line"?(o=this.createNode("shape"),o.appendChild(d),o.appendChild(C),o.appendChild(I),u=this.createNode("path"),this._setAttr(u,"id",this.container.id+"_"+t+"_path"),o.appendChild(u)):(o=this.createNode(n),o.appendChild(d),o.appendChild(C),o.appendChild(I)),o.style.position="absolute",o.style.left="0px",o.style.top="0px",this._setAttr(o,"id",this.container.id+"_"+t),o},remove:function(n){JXG$1.exists(n)&&n.removeNode(!0)},makeArrows:function(n){var t,o=JXG$1.evaluate(n.visProp.firstarrow),u=JXG$1.evaluate(n.visProp.lastarrow);n.visPropOld.firstarrow===o&&n.visPropOld.lastarrow===u||(o?(t=n.rendNodeStroke,this._setAttr(t,"startarrow","block"),this._setAttr(t,"startarrowlength","long")):(t=n.rendNodeStroke,JXG$1.exists(t)&&this._setAttr(t,"startarrow","none")),u?(t=n.rendNodeStroke,this._setAttr(t,"id",this.container.id+"_"+n.id+"stroke"),this._setAttr(t,"endarrow","block"),this._setAttr(t,"endarrowlength","long")):(t=n.rendNodeStroke,JXG$1.exists(t)&&this._setAttr(t,"endarrow","none")),n.visPropOld.firstarrow=o,n.visPropOld.lastarrow=u)},updateEllipsePrim:function(n,t,o,u,d){n.style.left=Math.floor(t-u)+"px",n.style.top=Math.floor(o-d)+"px",n.style.width=Math.floor(Math.abs(u)*2)+"px",n.style.height=Math.floor(Math.abs(d)*2)+"px"},updateLinePrim:function(n,t,o,u,d,C){var I,f=this.resolution;isNaN(t+o+u+d)||(I=["m ",Math.floor(f*t),", ",Math.floor(f*o)," l ",Math.floor(f*u),", ",Math.floor(f*d)],this.updatePathPrim(n,I,C))},updatePathPrim:function(n,t,o){var u=o.canvasWidth,d=o.canvasHeight;t.length<=0&&(t=["m 0,0"]),n.style.width=u,n.style.height=d,this._setAttr(n,"coordsize",[Math.floor(this.resolution*u),Math.floor(this.resolution*d)].join(",")),this._setAttr(n,"path",t.join(""))},updatePathStringPoint:function(n,t,o){var u=[],d=Math.round,C=n.coords.scrCoords,I=t*Math.sqrt(3)*.5,f=t*.5,A=this.resolution;return o==="x"?u.push([" m ",d(A*(C[1]-t)),", ",d(A*(C[2]-t))," l ",d(A*(C[1]+t)),", ",d(A*(C[2]+t))," m ",d(A*(C[1]+t)),", ",d(A*(C[2]-t))," l ",d(A*(C[1]-t)),", ",d(A*(C[2]+t))].join("")):o==="+"?u.push([" m ",d(A*(C[1]-t)),", ",d(A*C[2])," l ",d(A*(C[1]+t)),", ",d(A*C[2])," m ",d(A*C[1]),", ",d(A*(C[2]-t))," l ",d(A*C[1]),", ",d(A*(C[2]+t))].join("")):o==="<>"||o==="<<>>"?(o==="<<>>"&&(t*=1.41),u.push([" m ",d(A*(C[1]-t)),", ",d(A*C[2])," l ",d(A*C[1]),", ",d(A*(C[2]+t))," l ",d(A*(C[1]+t)),", ",d(A*C[2])," l ",d(A*C[1]),", ",d(A*(C[2]-t))," x e "].join(""))):o==="^"?u.push([" m ",d(A*C[1]),", ",d(A*(C[2]-t))," l ",d(A*(C[1]-I)),", ",d(A*(C[2]+f))," l ",d(A*(C[1]+I)),", ",d(A*(C[2]+f))," x e "].join("")):o==="v"?u.push([" m ",d(A*C[1]),", ",d(A*(C[2]+t))," l ",d(A*(C[1]-I)),", ",d(A*(C[2]-f))," l ",d(A*(C[1]+I)),", ",d(A*(C[2]-f))," x e "].join("")):o===">"?u.push([" m ",d(A*(C[1]+t)),", ",d(A*C[2])," l ",d(A*(C[1]-f)),", ",d(A*(C[2]-I))," l ",d(A*(C[1]-f)),", ",d(A*(C[2]+I))," l ",d(A*(C[1]+t)),", ",d(A*C[2])].join("")):o==="<"&&u.push([" m ",d(A*(C[1]-t)),", ",d(A*C[2])," l ",d(A*(C[1]+f)),", ",d(A*(C[2]-I))," l ",d(A*(C[1]+f)),", ",d(A*(C[2]+I))," x e "].join("")),u},updatePathStringPrim:function(n){var t,o,u=[],d=this.resolution,C=Math.round,I=" m ",f=" l ",A=" c ",y=I,G=Math.min(n.numberPoints,8192);if(n.numberPoints<=0)return"";if(G=Math.min(G,n.points.length),n.bezierDegree===1)for(t=0;t<G;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?y=I:(o[1]>2e4?o[1]=2e4:o[1]<-2e4&&(o[1]=-2e4),o[2]>2e4?o[2]=2e4:o[2]<-2e4&&(o[2]=-2e4),u.push([y,C(d*o[1]),", ",C(d*o[2])].join("")),y=f);else if(n.bezierDegree===3)for(t=0;t<G;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?y=I:(u.push([y,C(d*o[1]),", ",C(d*o[2])].join("")),y===A&&(t+=1,o=n.points[t].scrCoords,u.push([" ",C(d*o[1]),", ",C(d*o[2])].join("")),t+=1,o=n.points[t].scrCoords,u.push([" ",C(d*o[1]),", ",C(d*o[2])].join(""))),y=A),t+=1;return u.push(" e"),u},updatePathStringBezierPrim:function(n){var t,o,u,d,C,I,f=[],A=JXG$1.evaluate(n.visProp.strokewidth),y=this.resolution,G=Math.round,S=" m ",w=" c ",M=S,V=JXG$1.evaluate(n.visProp.curvetype)!=="plot",T=Math.min(n.numberPoints,8192);if(n.numberPoints<=0)return"";for(V&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,1)),T=Math.min(T,n.points.length),o=1;o<3;o++)for(M=S,t=0;t<T;t++)d=n.points[t].scrCoords,isNaN(d[1])||isNaN(d[2])?M=S:(d[1]>2e4?d[1]=2e4:d[1]<-2e4&&(d[1]=-2e4),d[2]>2e4?d[2]=2e4:d[2]<-2e4&&(d[2]=-2e4),M===S?f.push([M,G(y*d[1])," ",G(y*d[2])].join("")):(u=2*o,f.push([M,G(y*(C+(d[1]-C)*.333+A*(u*Math.random()-o)))," ",G(y*(I+(d[2]-I)*.333+A*(u*Math.random()-o)))," ",G(y*(C+(d[1]-C)*.666+A*(u*Math.random()-o)))," ",G(y*(I+(d[2]-I)*.666+A*(u*Math.random()-o)))," ",G(y*d[1])," ",G(y*d[2])].join(""))),M=w,C=d[1],I=d[2]);return f.push(" e"),f},updatePolygonPrim:function(n,t){var o,u=t.vertices.length,d=this.resolution,C,I=[];if(this._setAttr(n,"stroked","false"),C=t.vertices[0].coords.scrCoords,!isNaN(C[1]+C[2])){for(I.push(["m ",Math.floor(d*C[1]),",",Math.floor(d*C[2])," l "].join("")),o=1;o<u-1;o++){if(t.vertices[o].isReal){if(C=t.vertices[o].coords.scrCoords,isNaN(C[1]+C[2]))return;I.push(Math.floor(d*C[1])+","+Math.floor(d*C[2]))}else{this.updatePathPrim(n,"",t.board);return}o<u-2&&I.push(", ")}I.push(" x e"),this.updatePathPrim(n,I,t.board)}},updateRectPrim:function(n,t,o,u,d){n.style.left=Math.floor(t)+"px",n.style.top=Math.floor(o)+"px",u>=0&&(n.style.width=u+"px"),d>=0&&(n.style.height=d+"px")},setPropertyPrim:function(n,t,o){var u="",d;switch(t){case"stroke":u="strokecolor";break;case"stroke-width":u="strokeweight";break;case"stroke-dasharray":u="dashstyle";break}u!==""&&(d=JXG$1.evaluate(o),this._setAttr(n,u,d))},display:function(n,t){n&&n.rendNode&&(n.visPropOld.visible=t,t?n.rendNode.style.visibility="inherit":n.rendNode.style.visibility="hidden")},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),n&&n.rendNode&&(n.rendNode.style.visibility="inherit")},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),n&&n.rendNode&&(n.rendNode.style.visibility="hidden")},setDashStyle:function(n,t){var o;t.dash>=0&&(o=n.rendNodeStroke,this._setAttr(o,"dashstyle",this.dashArray[t.dash]))},setGradient:function(n){var t=n.rendNodeFill,o=JXG$1.evaluate(n.visProp.gradient);o==="linear"?(this._setAttr(t,"type","gradient"),this._setAttr(t,"color2",JXG$1.evaluate(n.visProp.gradientsecondcolor)),this._setAttr(t,"opacity2",JXG$1.evaluate(n.visProp.gradientsecondopacity)),this._setAttr(t,"angle",JXG$1.evaluate(n.visProp.gradientangle))):o==="radial"?(this._setAttr(t,"type","gradientradial"),this._setAttr(t,"color2",JXG$1.evaluate(n.visProp.gradientsecondcolor)),this._setAttr(t,"opacity2",JXG$1.evaluate(n.visProp.gradientsecondopacity)),this._setAttr(t,"focusposition",JXG$1.evaluate(n.visProp.gradientpositionx)*100+"%,"+JXG$1.evaluate(n.visProp.gradientpositiony)*100+"%"),this._setAttr(t,"focussize","0,0")):this._setAttr(t,"type","solid")},setObjectFillColor:function(n,t,o){var u=JXG$1.evaluate(t),d,C,I=JXG$1.evaluate(o),f,A=n.rendNode;I=I>0?I:0,!(n.visPropOld.fillcolor===u&&n.visPropOld.fillopacity===I)&&(JXG$1.exists(u)&&u!==!1&&(u.length!==9?(d=u,f=I):(C=JXG$1.rgba2rgbo(u),d=C[0],f=I*C[1]),d==="none"||d===!1?this._setAttr(n.rendNode,"filled","false"):(this._setAttr(n.rendNode,"filled","true"),this._setAttr(n.rendNode,"fillcolor",d),JXG$1.exists(f)&&n.rendNodeFill&&this._setAttr(n.rendNodeFill,"opacity",f*100+"%")),n.type===Const.OBJECT_TYPE_IMAGE&&A.filters.length>1&&(A.filters.item(1).opacity=Math.round(f*100),A.filters.item(1).enabled=!0)),n.visPropOld.fillcolor=u,n.visPropOld.fillopacity=I)},setObjectStrokeColor:function(n,t,o){var u=JXG$1.evaluate(t),d,C,I=JXG$1.evaluate(o),f,A=n.rendNode,y;I=I>0?I:0,!(n.visPropOld.strokecolor===u&&n.visPropOld.strokeopacity===I)&&(JXG$1.exists(u)&&u!==!1&&(u.length!==9?(d=u,f=I):(C=t.rgba2rgbo(u),d=C[0],f=I*C[1]),n.elementClass===Const.OBJECT_CLASS_TEXT?(A.filters.length>1&&(A.filters.item(1).opacity=Math.round(f*100),A.filters.item(1).enabled=!0),A.style.color=d):(d!==!1&&(this._setAttr(A,"stroked","true"),this._setAttr(A,"strokecolor",d)),y=n.rendNodeStroke,JXG$1.exists(f)&&n.type!==Const.OBJECT_TYPE_IMAGE&&this._setAttr(y,"opacity",f*100+"%"))),n.visPropOld.strokecolor=u,n.visPropOld.strokeopacity=I)},setObjectStrokeWidth:function(n,t){var o=JXG$1.evaluate(t),u;isNaN(o)||n.visPropOld.strokewidth===o||(u=n.rendNode,this.setPropertyPrim(u,"stroked","true"),JXG$1.exists(o)&&(this.setPropertyPrim(u,"stroke-width",o),o===0&&JXG$1.exists(n.rendNodeStroke)&&this._setAttr(u,"stroked","false")),n.visPropOld.strokewidth=o)},setShadow:function(n){var t=n.rendNodeShadow,o=JXG$1.evaluate(n.visProp.shadow);!t||n.visPropOld.shadow===o||(o?(this._setAttr(t,"On","True"),this._setAttr(t,"Offset","3pt,3pt"),this._setAttr(t,"Opacity","60%"),this._setAttr(t,"Color","#aaaaaa")):this._setAttr(t,"On","False"),n.visPropOld.shadow=o)},suspendRedraw:function(){this.container.style.display="none"},unsuspendRedraw:function(){this.container.style.display=""}});const VMLRenderer=JXG$1.VMLRenderer;var uuidCharsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",uuidChars=uuidCharsStr.split("");JXG$1.Util=JXG$1.Util||{};JXG$1.Util.genUUID=function(n){var t,o,u=[],d=0;for(n=n||"",n!==""&&n.slice(n.length-1)!=="-"&&(n=n+"-"),o=0;o<36;o++)o===8||o===13||o===18||o===23?u[o]="-":o===14?u[o]="4":(d<=2&&(d=33554432+Math.random()*16777216|0),t=d&15,d=d>>4,u[o]=uuidChars[o===19?t&3|8:t]);return n+u.join("")};const UUID=JXG$1.Util;JXG$1.CanvasRenderer=function(n,t){if(this.type="canvas",this.canvasRoot=null,this.suspendHandle=null,this.canvasId=UUID.genUUID(),this.canvasNamespace=null,JXG$1.isBrowser)this.container=n,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",this.container.style.position===""&&(this.container.style.position="relative"),this.container.innerHTML=['<canvas id="',this.canvasId,'" width="',t.width,'px" height="',t.height,'px"></canvas>'].join(""),this.canvasRoot=this.container.ownerDocument.getElementById(this.canvasId),this.canvasRoot.style.display="block",this.context=this.canvasRoot.getContext("2d");else if(JXG$1.isNode())try{this.canvasRoot=JXG$1.createCanvas(500,500),this.context=this.canvasRoot.getContext("2d")}catch{throw new Error(`JXG.createCanvas not available.
Install the npm package \`canvas\`
and call:
    import { createCanvas } from "canvas.js";
    JXG.createCanvas = createCanvas;
`)}};JXG$1.CanvasRenderer.prototype=new AbstractRenderer;JXG$1.extend(JXG$1.CanvasRenderer.prototype,{_drawPolygon:function(n,t,o){var u,d=n.length,C=this.context;if(d>0){if(o&&(C.lineWidth=0),C.beginPath(),C.moveTo(n[0][0],n[0][1]),t===1)for(u=1;u<d;u++)C.lineTo(n[u][0],n[u][1]);else for(u=1;u<d;u+=3)C.bezierCurveTo(n[u][0],n[u][1],n[u+1][0],n[u+1][1],n[u+2][0],n[u+2][1]);o?(C.lineTo(n[0][0],n[0][1]),C.closePath(),C.fill("evenodd")):C.stroke()}},_fill:function(n){var t=this.context;t.save(),this._setColor(n,"fill")&&t.fill("evenodd"),t.restore()},_rotatePoint:function(n,t,o){return[t*Math.cos(n)-o*Math.sin(n),t*Math.sin(n)+o*Math.cos(n)]},_rotateShape:function(n,t){var o,u=[],d=n.length;if(d<=0)return n;for(o=0;o<d;o++)u.push(this._rotatePoint(t,n[o][0],n[o][1]));return u},updateGradientAngle:function(n,t){var o=1,u=Math.cos(-t),d=Math.sin(-t),C=n.getBoundingBox(),I,f,A,y,G,S,w,M,V,T,H,J;return Math.abs(u)>Math.abs(d)?o/=Math.abs(u):o/=Math.abs(d),u>=0?(A=0,y=u*o):(A=-u*o,y=0),d>=0?(G=0,S=d*o):(G=-d*o,S=0),I=new Coords(Const.COORDS_BY_USER,[C[0],C[1]],n.board),f=new Coords(Const.COORDS_BY_USER,[C[2],C[3]],n.board),H=f.scrCoords[1]-I.scrCoords[1],J=f.scrCoords[2]-I.scrCoords[2],w=I.scrCoords[1]+H*A,V=I.scrCoords[2]+J*G,M=I.scrCoords[1]+H*y,T=I.scrCoords[2]+J*S,this.context.createLinearGradient(w,V,M,T)},updateGradientCircle:function(n,t,o,u,d,C,I){var f=n.getBoundingBox(),A,y,G,S,w,M,V,T,H,J;return A=new Coords(Const.COORDS_BY_USER,[f[0],f[1]],n.board),y=new Coords(Const.COORDS_BY_USER,[f[2],f[3]],n.board),H=y.scrCoords[1]-A.scrCoords[1],J=A.scrCoords[2]-y.scrCoords[2],G=A.scrCoords[1]+H*t,S=y.scrCoords[2]+J*o,M=A.scrCoords[1]+H*d,V=y.scrCoords[2]+J*C,w=u*(H+J)*.5,T=I*(H+J)*.5,this.context.createRadialGradient(M,V,T,G,S,w)},updateGradient:function(n){var t,o=JXG$1.evaluate(n.visProp.gradient),u;return t=JXG$1.evaluate(n.visProp.fillcolor),o==="linear"?u=this.updateGradientAngle(n,JXG$1.evaluate(n.visProp.gradientangle)):o==="radial"&&(u=this.updateGradientCircle(n,JXG$1.evaluate(n.visProp.gradientcx),JXG$1.evaluate(n.visProp.gradientcy),JXG$1.evaluate(n.visProp.gradientr),JXG$1.evaluate(n.visProp.gradientfx),JXG$1.evaluate(n.visProp.gradientfy),JXG$1.evaluate(n.visProp.gradientfr))),u.addColorStop(JXG$1.evaluate(n.visProp.gradientstartoffset),t),u.addColorStop(JXG$1.evaluate(n.visProp.gradientendoffset),JXG$1.evaluate(n.visProp.gradientsecondcolor)),u},_setColor:function(n,t,o){var u=!0,d=n.visProp,C,I,f,A,y,G,S,w;return t=t||"stroke",o=o||t,C=this._getHighlighted(n),w=JXG$1.evaluate(n.visProp.gradient),w==="linear"||w==="radial"?(this.context[o+"Style"]=this.updateGradient(n),u):(f=JXG$1.evaluate(d[C+t+"color"]),f!=="none"&&f!==!1?(G=JXG$1.evaluate(d[C+t+"opacity"]),G=G>0?G:0,f.length!==9?(y=f,S=G):(A=JXG$1.rgba2rgbo(f),y=A[0],S=G*A[1]),this.context.globalAlpha=S,this.context[o+"Style"]=y):u=!1,I=parseFloat(JXG$1.evaluate(d[C+"strokewidth"])),t==="stroke"&&!isNaN(I)&&(I===0?this.context.globalAlpha=0:this.context.lineWidth=I),t==="stroke"&&d.linecap!==void 0&&d.linecap!==""&&(this.context.lineCap=d.linecap),u)},_stroke:function(n){var t=this.context,o=JXG$1.evaluate(n.visProp.dash),u=JXG$1.evaluate(n.visProp.dashscale),d=u?.5*JXG$1.evaluate(n.visProp.strokewidth):1;t.save(),o>0?t.setLineDash&&t.setLineDash(this.dashArray[o-1].map(function(C){return C*d})):this.context.lineDashArray=[],this._setColor(n,"stroke")&&t.stroke(),t.restore()},_translateShape:function(n,t,o){var u,d=[],C=n.length;if(C<=0)return n;for(u=0;u<C;u++)d.push([n[u][0]+t,n[u][1]+o]);return d},drawPoint:function(n){var t=JXG$1.evaluate(n.visProp.face),o=JXG$1.evaluate(n.visProp.size),u=n.coords.scrCoords,d=o*Math.sqrt(3)*.5,C=o*.5,I=parseFloat(JXG$1.evaluate(n.visProp.strokewidth))/2,f=this.context;if(n.visPropCalc.visible)switch(t){case"cross":case"x":f.beginPath(),f.moveTo(u[1]-o,u[2]-o),f.lineTo(u[1]+o,u[2]+o),f.moveTo(u[1]+o,u[2]-o),f.lineTo(u[1]-o,u[2]+o),f.lineCap="round",f.lineJoin="round",f.closePath(),this._stroke(n);break;case"circle":case"o":f.beginPath(),f.arc(u[1],u[2],o+1+I,0,2*Math.PI,!1),f.closePath(),this._fill(n),this._stroke(n);break;case"square":case"[]":if(o<=0)break;f.save(),this._setColor(n,"stroke","fill")&&f.fillRect(u[1]-o-I,u[2]-o-I,o*2+3*I,o*2+3*I),f.restore(),f.save(),this._setColor(n,"fill"),f.fillRect(u[1]-o+I,u[2]-o+I,o*2-I,o*2-I),f.restore();break;case"plus":case"+":f.beginPath(),f.moveTo(u[1]-o,u[2]),f.lineTo(u[1]+o,u[2]),f.moveTo(u[1],u[2]-o),f.lineTo(u[1],u[2]+o),f.lineCap="round",f.lineJoin="round",f.closePath(),this._stroke(n);break;case"divide":case"|":f.beginPath(),f.moveTo(u[1],u[2]-o),f.lineTo(u[1],u[2]+o),f.lineCap="round",f.lineJoin="round",f.closePath(),this._stroke(n);break;case"minus":case"-":f.beginPath(),f.moveTo(u[1]-o,u[2]),f.lineTo(u[1]+o,u[2]),f.lineCap="round",f.lineJoin="round",f.closePath(),this._stroke(n);break;case"diamond2":case"<<>>":o*=1.41;case"diamond":case"<>":f.beginPath(),f.moveTo(u[1]-o,u[2]),f.lineTo(u[1],u[2]+o),f.lineTo(u[1]+o,u[2]),f.lineTo(u[1],u[2]-o),f.closePath(),this._fill(n),this._stroke(n);break;case"triangleup":case"A":case"a":case"^":f.beginPath(),f.moveTo(u[1],u[2]-o),f.lineTo(u[1]-d,u[2]+C),f.lineTo(u[1]+d,u[2]+C),f.closePath(),this._fill(n),this._stroke(n);break;case"triangledown":case"v":f.beginPath(),f.moveTo(u[1],u[2]+o),f.lineTo(u[1]-d,u[2]-C),f.lineTo(u[1]+d,u[2]-C),f.closePath(),this._fill(n),this._stroke(n);break;case"triangleleft":case"<":f.beginPath(),f.moveTo(u[1]-o,u[2]),f.lineTo(u[1]+C,u[2]-d),f.lineTo(u[1]+C,u[2]+d),f.closePath(),this._fill(n),this._stroke(n);break;case"triangleright":case">":f.beginPath(),f.moveTo(u[1]+o,u[2]),f.lineTo(u[1]-C,u[2]-d),f.lineTo(u[1]-C,u[2]+d),f.closePath(),this._fill(n),this._stroke(n);break}},updatePoint:function(n){this.drawPoint(n)},drawArrows:function(n,t,o,u,d){var C,I,f,A,y,G,S,w,M=this.context,V=6,T=1,H,J,z=1,L=1,K,O,Q,ee,ie,te,se,ae,le,ge,be=d.evFirst,Xe=d.evLast;if(JXG$1.evaluate(n.visProp.strokecolor)!=="none"&&(be||Xe)){if(n.elementClass===Const.OBJECT_CLASS_LINE)C=t.scrCoords[1],I=t.scrCoords[2],f=o.scrCoords[1],A=o.scrCoords[2],le=ge=Math.atan2(A-I,f-C);else{if(C=n.points[0].scrCoords[1],I=n.points[0].scrCoords[2],ae=n.points.length-1,ae<1)return;f=n.points[n.points.length-1].scrCoords[1],A=n.points[n.points.length-1].scrCoords[2],ee=n.points[1].scrCoords[1]-n.points[0].scrCoords[1],ie=n.points[1].scrCoords[2]-n.points[0].scrCoords[2],te=n.points[ae].scrCoords[1]-n.points[ae-1].scrCoords[1],se=n.points[ae].scrCoords[2]-n.points[ae-1].scrCoords[2],be&&(le=Math.atan2(ie,ee)),Xe&&(ge=Math.atan2(se,te))}if(y=JXG$1.evaluate(n.visProp[u+"strokewidth"]),be)if(V=d.sizeFirst,G=y*V,T=d.typeFirst,H=T,T===2)w=[[G,-G*.5],[0,0],[G,G*.5],[G*.5,0]];else if(T===3)w=[[G/3,-G*.5],[0,-G*.5],[0,G*.5],[G/3,G*.5]];else if(T===4)for(G/=10,z=3,w=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],Q=w.length,O=0;O<Q;O++)w[O][0]*=-G,w[O][1]*=G,w[O][0]+=10*G,w[O][1]-=3.31*G;else if(T===5)for(G/=10,z=3,w=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],Q=w.length,O=0;O<Q;O++)w[O][0]*=-G,w[O][1]*=G,w[O][0]+=10*G,w[O][1]-=3.28*G;else if(T===6)for(G/=10,z=3,w=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],Q=w.length,O=0;O<Q;O++)w[O][0]*=-G,w[O][1]*=G,w[O][0]+=10*G,w[O][1]-=2.84*G;else if(T===7)for(G=y,z=3,w=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],Q=w.length,O=0;O<Q;O++)w[O][0]*=-G,w[O][1]*=G,w[O][0]+=10*G,w[O][1]-=5.2*G;else w=[[G,-G*.5],[0,0],[G,G*.5]];if(Xe)if(V=d.sizeLast,G=y*V,T=d.typeLast,J=T,T===2)S=[[-G,-G*.5],[0,0],[-G,G*.5],[-G*.5,0]];else if(T===3)S=[[-G/3,-G*.5],[0,-G*.5],[0,G*.5],[-G/3,G*.5]];else if(T===4)for(G/=10,L=3,S=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]],Q=S.length,O=0;O<Q;O++)S[O][0]*=G,S[O][1]*=G,S[O][0]-=10*G,S[O][1]-=3.31*G;else if(T===5)for(G/=10,L=3,S=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]],Q=S.length,O=0;O<Q;O++)S[O][0]*=G,S[O][1]*=G,S[O][0]-=10*G,S[O][1]-=3.28*G;else if(T===6)for(G/=10,L=3,S=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]],Q=S.length,O=0;O<Q;O++)S[O][0]*=G,S[O][1]*=G,S[O][0]-=10*G,S[O][1]-=2.84*G;else if(T===7)for(G=y,L=3,S=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]],Q=S.length,O=0;O<Q;O++)S[O][0]*=G,S[O][1]*=G,S[O][0]-=10*G,S[O][1]-=5.2*G;else S=[[-G,-G*.5],[0,0],[-G,G*.5]];M.save(),this._setColor(n,"stroke","fill")&&(this._setColor(n,"stroke"),be&&(H===7?K=!1:K=!0,this._drawPolygon(this._translateShape(this._rotateShape(w,le),C,I),z,K)),Xe&&(J===7?K=!1:K=!0,this._drawPolygon(this._translateShape(this._rotateShape(S,ge),f,A),L,K))),M.restore()}},drawLine:function(n){var t,o,u=new Coords(Const.COORDS_BY_USER,n.point1.coords.usrCoords,n.board),d=new Coords(Const.COORDS_BY_USER,n.point2.coords.usrCoords,n.board),C=null,I,f,A;n.visPropCalc.visible&&(I=this._getHighlighted(n),f=JXG$1.evaluate(n.visProp[I+"strokewidth"]),A=this.getArrowHeadData(n,f,I),(A.evFirst||A.evLast)&&(C=-4),Geometry.calcStraight(n,u,d,C),this.handleTouchpoints(n,u,d,A),t=new Coords(Const.COORDS_BY_USER,u.usrCoords,n.board),o=new Coords(Const.COORDS_BY_USER,d.usrCoords,n.board),this.getPositionArrowHead(n,u,d,A),this.context.beginPath(),this.context.moveTo(u.scrCoords[1],u.scrCoords[2]),this.context.lineTo(d.scrCoords[1],d.scrCoords[2]),this._stroke(n),(A.evFirst||A.evLast)&&this.drawArrows(n,t,o,I,A))},updateLine:function(n){this.drawLine(n)},drawTicks:function(){},updateTicks:function(n){var t,o,u,d,C=n.ticks.length,I,f,A=this.context;for(A.beginPath(),t=0;t<C;t++)for(o=n.ticks[t],u=o[0],d=o[1],I=u.length,A.moveTo(u[0],d[0]),f=1;f<I;++f)A.lineTo(u[f],d[f]);A.lineCap="round",this._stroke(n)},drawCurve:function(n){var t,o,u;JXG$1.evaluate(n.visProp.handdrawing)?this.updatePathStringBezierPrim(n):this.updatePathStringPrim(n),n.numberPoints>1&&(t=this._getHighlighted(n),o=JXG$1.evaluate(n.visProp[t+"strokewidth"]),u=this.getArrowHeadData(n,o,t),(u.evFirst||u.evLast)&&this.drawArrows(n,null,null,t,u))},updateCurve:function(n){this.drawCurve(n)},drawEllipse:function(n){var t=n.center.coords.scrCoords[1],o=n.center.coords.scrCoords[2],u=n.board.unitX,d=n.board.unitY,C=2*n.Radius(),I=2*n.Radius(),f=C*u,A=I*d,y=t-f/2,G=o-A/2,S=f/2*.5522848,w=A/2*.5522848,M=y+f,V=G+A,T=y+f/2,H=G+A/2,J=this.context;C>0&&I>0&&!isNaN(t+o)&&(J.beginPath(),J.moveTo(y,H),J.bezierCurveTo(y,H-w,T-S,G,T,G),J.bezierCurveTo(T+S,G,M,H-w,M,H),J.bezierCurveTo(M,H+w,T+S,V,T,V),J.bezierCurveTo(T-S,V,y,H+w,y,H),J.closePath(),this._fill(n),this._stroke(n))},updateEllipse:function(n){return this.drawEllipse(n)},displayCopyright:function(n,t){var o=this.context;o.save(),o.font=t+"px Arial",o.fillStyle="#aaa",o.lineWidth=.5,o.fillText(n,10,2+t),o.restore()},drawInternalText:function(n){var t=JXG$1.evaluate(n.visProp.fontsize),o=JXG$1.evaluate(n.visProp.fontunit),u=n.getAnchorX(),d=n.getAnchorY(),C=this.context;return C.save(),this._setColor(n,"stroke","fill")&&!isNaN(n.coords.scrCoords[1]+n.coords.scrCoords[2])&&(C.font=(t>0?t:0)+o+" Arial",this.transformImage(n,n.transformations),u==="left"?C.textAlign="left":u==="right"?C.textAlign="right":u==="middle"&&(C.textAlign="center"),d==="bottom"?C.textBaseline="bottom":d==="top"?C.textBaseline="top":d==="middle"&&(C.textBaseline="middle"),C.fillText(n.plaintext,n.coords.scrCoords[1],n.coords.scrCoords[2])),C.restore(),null},updateInternalText:function(n){this.drawInternalText(n)},setObjectStrokeColor:function(n,t,o){var u=JXG$1.evaluate(t),d,C,I=JXG$1.evaluate(o),f,A;I=I>0?I:0,!(n.visPropOld.strokecolor===u&&n.visPropOld.strokeopacity===I)&&(JXG$1.exists(u)&&u!==!1&&(u.length!==9?(d=u,f=I):(C=JXG$1.rgba2rgbo(u),d=C[0],f=I*C[1]),A=n.rendNode,n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"&&(A.style.color=d,A.style.opacity=f)),n.visPropOld.strokecolor=u,n.visPropOld.strokeopacity=I)},drawImage:function(n){n.rendNode=new Image,n._src="",this.updateImage(n)},updateImage:function(n){var t=this.context,o=JXG$1.evaluate(n.visProp.fillopacity),u=JXG$1.bind(function(){n.imgIsLoaded=!0,!(n.size[0]<=0||n.size[1]<=0)&&(t.save(),t.globalAlpha=o,this.transformImage(n,n.transformations),t.drawImage(n.rendNode,n.coords.scrCoords[1],n.coords.scrCoords[2]-n.size[1],n.size[0],n.size[1]),t.restore())},this);this.updateImageURL(n)?n.rendNode.onload=u:n.imgIsLoaded&&u()},transformImage:function(n,t){var o,u,d,C,I,f=t.length,A=this.context;if(f>0)if(o=this.joinTransforms(n,t),n.elementClass===Const.OBJECT_CLASS_TEXT&&n.visProp.display==="html"){if(u=" matrix("+[o[1][1],o[2][1],o[1][2],o[2][2],o[1][0],o[2][0]].join(",")+") ",u.indexOf("NaN")===-1){switch(I=n.rendNode,I.style.transform=u,d=-n.coords.scrCoords[1],C=-n.coords.scrCoords[2],JXG$1.evaluate(n.visProp.anchorx)){case"right":d+=n.size[0];break;case"middle":d+=n.size[0]*.5;break}switch(JXG$1.evaluate(n.visProp.anchory)){case"bottom":C+=n.size[1];break;case"middle":C+=n.size[1]*.5;break}I.style["transform-origin"]=d+"px "+C+"px"}}else Math.abs(Numerics.det(o))>=Mat.eps&&A.transform(o[1][1],o[2][1],o[1][2],o[2][2],o[1][0],o[2][0])},updateImageURL:function(n){var t;return t=JXG$1.evaluate(n.url),n._src!==t?(n.imgIsLoaded=!1,n.rendNode.src=t,n._src=t,!0):!1},remove:function(n){JXG$1.exists(n)&&JXG$1.exists(n.parentNode)&&n.parentNode.removeChild(n)},updatePathStringPrim:function(n){var t,o,u,d,C,I="M",f="L",A="C",y=I,G=5e3,S=this.context;if(!(n.numberPoints<=0)){if(C=Math.min(n.points.length,n.numberPoints),S.beginPath(),n.bezierDegree===1)for(t=0;t<C;t++)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?y=I:(o[1]>G?o[1]=G:o[1]<-5e3&&(o[1]=-5e3),o[2]>G?o[2]=G:o[2]<-5e3&&(o[2]=-5e3),y===I?S.moveTo(o[1],o[2]):S.lineTo(o[1],o[2]),y=f);else if(n.bezierDegree===3)for(t=0;t<C;)o=n.points[t].scrCoords,isNaN(o[1])||isNaN(o[2])?y=I:(y===I?S.moveTo(o[1],o[2]):(t+=1,u=n.points[t].scrCoords,t+=1,d=n.points[t].scrCoords,S.bezierCurveTo(o[1],o[2],u[1],u[2],d[1],d[2])),y=A),t+=1;S.lineCap="round",this._fill(n),this._stroke(n)}},updatePathStringBezierPrim:function(n){var t,o,u,d,C,I,f,A="M",y="C",G=A,S=5e3,w=JXG$1.evaluate(n.visProp.strokewidth),M=JXG$1.evaluate(n.visProp.curvetype)!=="plot",V=this.context;if(!(n.numberPoints<=0)){for(M&&n.board.options.curve.RDPsmoothing&&(n.points=Numerics.RamerDouglasPeucker(n.points,.5)),f=Math.min(n.points.length,n.numberPoints),V.beginPath(),o=1;o<3;o++)for(G=A,t=0;t<f;t++)d=n.points[t].scrCoords,isNaN(d[1])||isNaN(d[2])?G=A:(d[1]>S?d[1]=S:d[1]<-5e3&&(d[1]=-5e3),d[2]>S?d[2]=S:d[2]<-5e3&&(d[2]=-5e3),G===A?V.moveTo(d[1],d[2]):(u=2*o,V.bezierCurveTo(C+(d[1]-C)*.333+w*(u*Math.random()-o),I+(d[2]-I)*.333+w*(u*Math.random()-o),C+(d[1]-C)*.666+w*(u*Math.random()-o),I+(d[2]-I)*.666+w*(u*Math.random()-o),d[1],d[2])),G=y,C=d[1],I=d[2]);V.lineCap="round",this._fill(n),this._stroke(n)}},updatePolygonPrim:function(n,t){var o,u,d,C=t.vertices.length,I=this.context,f=!0;if(!(C<=0||!t.visPropCalc.visible)){for(t.elType==="polygonalchain"&&C++,I.beginPath(),u=0;!t.vertices[u].isReal&&u<C-1;)u++,f=!1;for(o=t.vertices[u].coords.scrCoords,I.moveTo(o[1],o[2]),d=u;d<C-1;d++)t.vertices[d].isReal||(f=!1),o=t.vertices[d].coords.scrCoords,I.lineTo(o[1],o[2]);I.closePath(),f&&this._fill(t)}},display:function(n,t){n&&n.rendNode&&(n.visPropOld.visible=t,t?n.rendNode.style.visibility="inherit":n.rendNode.style.visibility="hidden")},show:function(n){JXG$1.deprecated("Board.renderer.show()","Board.renderer.display()"),JXG$1.exists(n.rendNode)&&(n.rendNode.style.visibility="inherit")},hide:function(n){JXG$1.deprecated("Board.renderer.hide()","Board.renderer.display()"),JXG$1.exists(n.rendNode)&&(n.rendNode.style.visibility="hidden")},setGradient:function(n){},setShadow:function(n){n.visPropOld.shadow!==n.visProp.shadow&&(n.visPropOld.shadow=n.visProp.shadow)},highlight:function(n){return n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"?this.updateTextStyle(n,!0):(n.board.prepareUpdate(),n.board.renderer.suspendRedraw(n.board),n.board.updateRenderer(),n.board.renderer.unsuspendRedraw()),this},noHighlight:function(n){return n.elementClass===Const.OBJECT_CLASS_TEXT&&JXG$1.evaluate(n.visProp.display)==="html"?this.updateTextStyle(n,!1):(n.board.prepareUpdate(),n.board.renderer.suspendRedraw(n.board),n.board.updateRenderer(),n.board.renderer.unsuspendRedraw()),this},suspendRedraw:function(n){this.context.save(),this.context.clearRect(0,0,this.canvasRoot.width,this.canvasRoot.height),n&&n.attr.showcopyright&&this.displayCopyright(JXG$1.licenseText,12)},unsuspendRedraw:function(){this.context.restore()},resize:function(n,t){this.container?(this.canvasRoot.style.width=parseFloat(n)+"px",this.canvasRoot.style.height=parseFloat(t)+"px",this.canvasRoot.setAttribute("width",2*parseFloat(n)+"px"),this.canvasRoot.setAttribute("height",2*parseFloat(t)+"px")):(this.canvasRoot.width=2*parseFloat(n),this.canvasRoot.height=2*parseFloat(t)),this.context=this.canvasRoot.getContext("2d"),this.context.scale(2,2)},removeToInsertLater:function(){return function(){}}});const CanvasRenderer=JXG$1.CanvasRenderer;JXG$1.NoRenderer=function(){this.enhancedRendering=!1,this.type="no"};JXG$1.extend(JXG$1.NoRenderer.prototype,{drawPoint:function(n){},updatePoint:function(n){},changePointStyle:function(n){},drawLine:function(n){},updateLine:function(n){},drawTicks:function(n){},updateTicks:function(n){},drawCurve:function(n){},updateCurve:function(n){},drawEllipse:function(n){},updateEllipse:function(n){},drawPolygon:function(n){},updatePolygon:function(n){},displayCopyright:function(n,t){},drawInternalText:function(n){},updateInternalText:function(n){},drawText:function(n){},updateText:function(n){},updateTextStyle:function(n,t){},updateInternalTextStyle:function(n,t,o){},drawImage:function(n){},updateImage:function(n){},transformImage:function(n,t){},updateImageURL:function(n){},appendChildPrim:function(n,t){},appendNodesToElement:function(n,t){},createPrim:function(n,t){return null},remove:function(n){},makeArrows:function(n){},updateEllipsePrim:function(n,t,o,u,d){},updateLinePrim:function(n,t,o,u,d,C){},updatePathPrim:function(n,t,o){},updatePathStringPoint:function(n,t,o){},updatePathStringPrim:function(n){},updatePathStringBezierPrim:function(n){},updatePolygonPrim:function(n,t){},updateRectPrim:function(n,t,o,u,d){},setPropertyPrim:function(n,t,o){},display:function(n,t){n&&(n.visPropOld.visible=t)},show:function(n){},hide:function(n){},setBuffering:function(n,t){},setDashStyle:function(n){},setDraft:function(n){},removeDraft:function(n){},setGradient:function(n){},updateGradient:function(n){},setObjectTransition:function(n,t){},setObjectFillColor:function(n,t,o){},setObjectStrokeColor:function(n,t,o){},setObjectStrokeWidth:function(n,t){},setShadow:function(n){},highlight:function(n){},noHighlight:function(n){},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(n){},getElementById:function(n){return null},resize:function(n,t){},removeToInsertLater:function(){return function(){}}});JXG$1.NoRenderer.prototype=new AbstractRenderer;const NoRenderer=JXG$1.NoRenderer;JXG$1.JSXGraph={rendererType:function(){return Options.board.renderer="no",JXG$1.supportsVML()&&(Options.board.renderer="vml",document.onmousemove=function(){var n;return document.body&&(n=document.body.scrollLeft,n+=document.body.scrollTop),n}),JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),JXG$1.supportsSVG()&&(Options.board.renderer="svg"),JXG$1.isNode()&&JXG$1.supportsCanvas()&&(Options.board.renderer="canvas"),(JXG$1.isNode()||Options.renderer==="no")&&(Options.text.display="internal",Options.infobox.display="internal"),Options.board.renderer}(),initRenderer:function(n,t,o,u){var d,C;if((!JXG$1.exists(o)||o===!1)&&typeof document=="object"&&(o=document),typeof o=="object"&&n!==null)for(d=JXG$1.isString(n)?o.getElementById(n):n;d.firstChild;)d.removeChild(d.firstChild);else d=n;return(u===void 0||u==="auto")&&(u=this.rendererType),u==="svg"?C=new SVGRenderer(d,t):u==="vml"?C=new VMLRenderer(d):u==="canvas"?C=new CanvasRenderer(d,t):C=new NoRenderer,C},_setAttributes:function(n,t){var o=JXG$1.copyAttributes(n,t,"board"),u=["drag","fullscreen","intl","keyboard","logging","pan","resize","screenshot","selection","zoom"],d=u.length,C,I;for(C=0;C<d;C++)I=u[C],o[I]=JXG$1.copyAttributes(o,t,"board",I);return o.navbar=JXG$1.copyAttributes(o.navbar,t,"navbar"),o.movetarget=n.moveTarget||n.movetarget||t.board.moveTarget,o},_fillBoard:function(n,t,o){n.initInfobox(t.infobox),n.maxboundingbox=t.maxboundingbox,n.resizeContainer(o.width,o.height,!0,!0),n._createSelectionPolygon(t),n.renderer.drawNavigationBar(n,t.navbar),JXG$1.boards[n.id]=n},_setARIA:function(n,t){var o=t.document,u,d,C,I,f,A;if(typeof o!="object"){if(!JXG$1.isBrowser)return;o=document}d=JXG$1.isString(n)?o.getElementById(n):n,u=d.ownerDocument,I=d.parentNode,f=n+"_ARIAlabel",A=n+"_ARIAdescription",C=u.createElement("div"),C.innerHTML=t.title,C.setAttribute("id",f),C.style.display="none",I.insertBefore(C,d),C=u.createElement("div"),C.innerHTML=t.description,C.setAttribute("id",A),C.style.display="none",I.insertBefore(C,d),d.setAttribute("aria-labelledby",f),d.setAttribute("aria-describedby",A)},_removeARIANodes:function(n){var t,o,u;u=n.document||document,typeof u=="object"&&(o=n.containerObj.getAttribute("aria-labelledby"),t=u.getElementById(o),t&&t.parentNode&&t.parentNode.removeChild(t),o=n.containerObj.getAttribute("aria-describedby"),t=u.getElementById(o),t&&t.parentNode&&t.parentNode.removeChild(t))},initBoard:function(n,t){var o,u,d,C,I,f,A=0,y=0,G,S,w,M,V,T,H,J,z={},L;return t=t||{},t.theme!=="default"&&JXG$1.exists(JXG$1.themes[t.theme])&&(z=JXG$1.themes[t.theme]),J=JXG$1.deepCopy(Options,z,!0),M=this._setAttributes(t,J),S=JXG$1.getDimensions(n,M.document),M.unitx||M.unity?(o=JXG$1.def(M.originx,150),u=JXG$1.def(M.originy,150),d=JXG$1.def(M.unitx,50),C=JXG$1.def(M.unity,50)):(w=M.boundingbox,w[0]<M.maxboundingbox[0]&&(w[0]=M.maxboundingbox[0]),w[1]>M.maxboundingbox[1]&&(w[1]=M.maxboundingbox[1]),w[2]>M.maxboundingbox[2]&&(w[2]=M.maxboundingbox[2]),w[3]<M.maxboundingbox[3]&&(w[3]=M.maxboundingbox[3]),I=parseInt(S.width,10),f=parseInt(S.height,10),JXG$1.exists(w)&&M.keepaspectratio?(d=I/(w[2]-w[0]),C=f/(w[1]-w[3]),Math.abs(d)<Math.abs(C)?(C=Math.abs(d)*C/Math.abs(C),y=(f/C-(w[1]-w[3]))*.5):(d=Math.abs(C)*d/Math.abs(d),A=(I/d-(w[2]-w[0]))*.5)):(d=I/(w[2]-w[0]),C=f/(w[1]-w[3])),o=-d*(w[0]-A),u=C*(w[1]+y)),G=this.initRenderer(n,S,M.document,M.renderer),this._setARIA(n,M),L=new Board(n,G,M.id,[o,u],M.zoomx,M.zoomy,d,C,S.width,S.height,M),L.keepaspectratio=M.keepaspectratio,this._fillBoard(L,M,S),L.suspendUpdate(),M=L.attr,M.axis&&(V=typeof M.axis=="object"?M.axis:{},T=JXG$1.deepCopy(J.board.defaultaxes.x,V),H=JXG$1.deepCopy(J.board.defaultaxes.y,V),M.defaultaxes.x&&(T=JXG$1.deepCopy(T,M.defaultaxes.x)),M.defaultaxes.y&&(H=JXG$1.deepCopy(H,M.defaultaxes.y)),L.defaultAxes={},L.defaultAxes.x=L.create("axis",[[0,0],[1,0]],T),L.defaultAxes.y=L.create("axis",[[0,0],[0,1]],H)),M.grid&&L.create("grid",[],typeof M.grid=="object"?M.grid:{}),L.unsuspendUpdate(),L},loadBoardFromFile:function(n,t,o,u,d){var C,I,f,A,y;return u=u||{},C=this._setAttributes(u),A=JXG$1.getDimensions(n,C.document),I=this.initRenderer(n,A,C.document,C.renderer),this._setARIA(n,C),f=new Board(n,I,"",[150,150],1,1,50,50,A.width,A.height,C),this._fillBoard(f,C,A),y=C.encoding||"iso-8859-1",FileReader$1.parseFileContent(t,f,o,!0,y,d),f},loadBoardFromString:function(n,t,o,u,d){var C,I,f,A;return u=u||{},C=this._setAttributes(u),A=JXG$1.getDimensions(n,C.document),I=this.initRenderer(n,A,C.document,C.renderer),this._setARIA(n,C),f=new Board(n,I,"",[150,150],1,1,50,50,A.width,A.height,C),this._fillBoard(f,C,A),FileReader$1.parseString(t,f,o,!0,d),f},freeBoard:function(n){var t;typeof n=="string"&&(n=JXG$1.boards[n]),this._removeARIANodes(n),n.removeEventHandlers(),n.suspendUpdate();for(t in n.objects)n.objects.hasOwnProperty(t)&&n.objects[t].remove();for(;n.containerObj.firstChild;)n.containerObj.removeChild(n.containerObj.firstChild);for(t in n.objects)n.objects.hasOwnProperty(t)&&delete n.objects[t];delete n.renderer,n.jc.creator.clearCache(),delete n.jc,delete JXG$1.boards[n.id]},registerElement:function(n,t){JXG$1.deprecated("JXG.JSXGraph.registerElement()","JXG.registerElement()"),JXG$1.registerElement(n,t)}};JXG$1.isBrowser&&typeof window=="object"&&typeof document=="object"&&JXG$1.addEvent(window,"load",function(){var n,t,o,u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z=!1,L=document.getElementsByTagName("script"),K=function(Q,ee,ie){var te=JXG$1.JSXGraph.initBoard(d,{boundingbox:ie,keepaspectratio:!0,grid:V,axis:M,showReload:!0});if(ee.toLowerCase().indexOf("script")>-1)te.construct(Q);else try{te.jc.parse(Q)}catch(se){JXG$1.debug(se)}return te},O=function(Q,ee,ie,te){return function(){var se;JXG$1.JSXGraph.freeBoard(Q),se=K(ee,ie,te),se.reload=O(se,ee,ie,te)}};for(t=0;t<L.length;t++)if(n=L[t].getAttribute("type",!1),JXG$1.exists(n)&&(n.toLowerCase()==="text/jessiescript"||n.toLowerCase()==="jessiescript"||n.toLowerCase()==="text/jessiecode"||n.toLowerCase()==="jessiecode")){if(S=L[t].getAttribute("class",!1)||"",f=L[t].getAttribute("width",!1)||"",A=L[t].getAttribute("height",!1)||"",y=L[t].getAttribute("maxwidth",!1)||"100%",G=L[t].getAttribute("aspectratio",!1)||"1/1",w=L[t].getAttribute("boundingbox",!1)||"-5, 5, 5, -5",d=L[t].getAttribute("container",!1),H=L[t].getAttribute("src",!1),w=w.split(","),w.length!==4)w=[-5,5,5,-5];else for(o=0;o<w.length;o++)w[o]=parseFloat(w[o]);if(M=JXG$1.str2Bool(L[t].getAttribute("axis",!1)||"false"),V=JXG$1.str2Bool(L[t].getAttribute("grid",!1)||"false"),JXG$1.exists(d))u=document.getElementById(d);else{d="jessiescript_autgen_jxg_"+t,u=document.createElement("div"),u.setAttribute("id",d),I=f!==""?"width:"+f+";":"",I+=A!==""?"height:"+A+";":"",I+=y!==""?"max-width:"+y+";":"",I+=G!==""?"aspect-ratio:"+G+";":"",u.setAttribute("style",I),u.setAttribute("class","jxgbox "+S);try{document.body.insertBefore(u,L[t])}catch{typeof jQuery=="object"&&jQuery(u).insertBefore(L[t])}}T="",JXG$1.exists(H)?(z=!0,J=new XMLHttpRequest,J.open("GET",H),J.overrideMimeType("text/plain; charset=x-user-defined"),J.addEventListener("load",function(){if(this.status<400)T=this.responseText+`
`+T,C=K(T,n,w),C.reload=O(C,T,n,w);else throw new Error(`
JSXGraph: failed to load file`,H,":",this.responseText)}),J.addEventListener("error",function(Q){throw new Error(`
JSXGraph: failed to load file`,H,":",Q)}),J.send()):z=!1,document.getElementById(d)?(T=L[t].innerHTML,T=T.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""),L[t].innerHTML=T,z||(C=K(T,n,w),C.reload=O(C,T,n,w))):JXG$1.debug("JSXGraph: Apparently the div injection failed. Can't create a board, sorry.")}},window);JXG$1.JSXGraph;JXG$1.Point=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_POINT,Const.OBJECT_CLASS_POINT),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this.elType="point",this.id=this.board.setId(this,"P"),this.board.renderer.drawPoint(this),this.board.finalizeAdding(this),this.createGradient(),this.createLabel()};JXG$1.Point.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Point.prototype,{hasPoint:function(n,t){var o=this.coords.scrCoords,u,d,C,I=JXG$1.evaluate(this.visProp.sizeunit);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(C=this.board._inputDevice,d=JXG$1.evaluate(this.visProp.precision[C])):d=this.board.options.precision.hasPoint,u=parseFloat(JXG$1.evaluate(this.visProp.size)),I==="user"&&(u*=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY))),u+=parseFloat(JXG$1.evaluate(this.visProp.strokewidth))*.5,u<d&&(u=d),Math.abs(o[1]-n)<u+2&&Math.abs(o[2]-t)<u+2},update:function(n){return this.needsUpdate?(this.updateCoords(n),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateTransform:function(n){var t,o;if(this.transformations.length===0||this.baseElement===null)return this;for(this===this.baseElement?(t=this.transformations[0].apply(this.baseElement,"self"),this.coords.setCoordinates(Const.COORDS_BY_USER,t)):t=this.transformations[0].apply(this.baseElement),this.coords.setCoordinates(Const.COORDS_BY_USER,t),o=1;o<this.transformations.length;o++)this.coords.setCoordinates(Const.COORDS_BY_USER,this.transformations[o].apply(this));return this},updateRenderer:function(){return this.updateRendererGeneric("updatePoint"),this},bounds:function(){return this.coords.usrCoords.slice(1).concat(this.coords.usrCoords.slice(1))},makeIntersection:function(n,t,o,u){var d;n=this.board.select(n),t=this.board.select(t),d=Geometry.intersectionFunction(this.board,n,t,o,u,this.visProp.alwaysintersect),this.addConstraint([d]);try{n.addChild(this),t.addChild(this)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof n+"' and '"+typeof t+"'.")}this.type=Const.OBJECT_TYPE_INTERSECTION,this.elType="intersection",this.parents=[n.id,t.id,o,u],this.generatePolynomial=function(){var C=n.generatePolynomial(this),I=t.generatePolynomial(this);return C.length===0||I.length===0?[]:[C[0],I[0]]},this.prepareUpdate().update()},setStyle:function(n){var t=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"],o=[2,3,4,1,2,3,4,2,3,4,2,3,4];return this.visProp.face=t[n],this.visProp.size=o[n],this.board.renderer.changePointStyle(this),this},normalizeFace:function(n){return JXG$1.deprecated("Point.normalizeFace()","JXG.normalizePointFace()"),Options.normalizePointFace(n)},face:function(n){JXG$1.deprecated("Point.face()","Point.setAttribute()"),this.setAttribute({face:n})},size:function(n){JXG$1.deprecated("Point.size()","Point.setAttribute()"),this.setAttribute({size:n})},isOn:function(n,t){var o,u;return t=t||Mat.eps,JXG$1.isPoint(n)?this.Dist(n)<t:n.elementClass===Const.OBJECT_CLASS_LINE?n.elType==="segment"&&!JXG$1.evaluate(this.visProp.alwaysintersect)?(o=JXG$1.Math.Geometry.projectCoordsToSegment(this.coords.usrCoords,n.point1.coords.usrCoords,n.point2.coords.usrCoords),o[1]>=0&&o[1]<=1&&Geometry.distPointLine(this.coords.usrCoords,n.stdform)<t):Geometry.distPointLine(this.coords.usrCoords,n.stdform)<t:n.elementClass===Const.OBJECT_CLASS_CIRCLE?JXG$1.evaluate(n.visProp.hasinnerpoints)?this.Dist(n.center)<n.Radius()+t:Math.abs(this.Dist(n.center)-n.Radius())<t:n.elementClass===Const.OBJECT_CLASS_CURVE?(u=Geometry.projectPointToCurve(this,n,this.board)[0],Geometry.distance(this.coords.usrCoords,u.usrCoords,3)<t):n.type===Const.OBJECT_TYPE_POLYGON?JXG$1.evaluate(n.visProp.hasinnerpoints)&&n.pnpoly(this.coords.usrCoords[1],this.coords.usrCoords[2],JXG$1.COORDS_BY_USER)?!0:(o=Geometry.projectCoordsToPolygon(this.coords.usrCoords,n),Geometry.distance(this.coords.usrCoords,o,3)<t):n.type===Const.OBJECT_TYPE_TURTLE?(u=Geometry.projectPointToTurtle(this,n,this.board),Geometry.distance(this.coords.usrCoords,u.usrCoords,3)<t):!1},cloneToBackground:function(){var n={};return n.id=this.id+"T"+this.numTraces,this.numTraces+=1,n.coords=this.coords,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,n.elementClass=Const.OBJECT_CLASS_POINT,n.board=this.board,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},this.board.renderer.drawPoint(n),this.traces[n.id]=n.rendNode,this}});JXG$1.createPoint=function(n,t,o){var u,d;if(d=JXG$1.copyAttributes(o,n.options,"point"),u=CoordsElement.create(JXG$1.Point,n,t,d),!u)throw new Error("JSXGraph: Can't create point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return u};JXG$1.createGlider=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"glider");return t.length===1?d=[0,0]:d=t.slice(0,2),u=n.create("point",d,C),u.makeGlider(t[t.length-1]),u};JXG$1.createIntersectionPoint=function(n,t,o){var u,d,C,I,f,A,y=JXG$1.copyAttributes(o,n.options,"intersection");t.push(0,0),d=n.select(t[0]),C=n.select(t[1]),f=t[2]||0,A=t[3]||0,u=n.create("point",[0,0,0],y),I=Geometry.intersectionFunction(n,d,C,f,A,u.visProp.alwaysintersect),u.addConstraint([I]);try{d.addChild(u),C.addChild(u)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return u.type=Const.OBJECT_TYPE_INTERSECTION,u.elType="intersection",u.setParents([d.id,C.id]),u.intersectionNumbers=[f,A],u.getParents=function(){return this.parents.concat(this.intersectionNumbers)},u.generatePolynomial=function(){var G=d.generatePolynomial(u),S=C.generatePolynomial(u);return G.length===0||S.length===0?[]:[G[0],S[0]]},u};JXG$1.createOtherIntersectionPoint=function(n,t,o){var u,d,C,I,f,A,y,G=!0,S=JXG$1.copyAttributes(o,n.options,"otherintersection");if(t.length!==3)G=!1;else{for(d=n.select(t[0]),C=n.select(t[1]),JXG$1.isArray(t[2])?f=t[2]:f=[t[2]],I=0;I<f.length;I++)if(f[I]=n.select(f[I]),!JXG$1.isPoint(f[I])){G=!1;break}G&&(y=[d,C],y.sort(function(w,M){return M.elementClass-w.elementClass}),([Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE].indexOf(y[0].elementClass)<0||[Const.OBJECT_CLASS_CIRCLE,Const.OBJECT_CLASS_CURVE,Const.OBJECT_CLASS_LINE].indexOf(y[1].elementClass)<0)&&(G=!1))}if(!G)throw new Error("JSXGraph: Can't create 'other intersection point' with parent types '"+typeof t[0]+"',  '"+typeof t[1]+"'and  '"+typeof t[2]+`'.
Possible parent types: [circle|curve|line,circle|curve|line, point], not two lines`);return u=n.create("point",[0,0,0],S),A=Geometry.otherIntersectionFunction(y,f,u.visProp.alwaysintersect,u.visProp.precision),u.addConstraint([A]),u.type=Const.OBJECT_TYPE_INTERSECTION,u.elType="otherintersection",u.setParents([d.id,C.id]),u.addParents(f),d.addChild(u),C.addChild(u),d.elementClass===Const.OBJECT_CLASS_CIRCLE&&(u.generatePolynomial=function(){var w=d.generatePolynomial(u),M=C.generatePolynomial(u);return w.length===0||M.length===0?[]:[w[0],M[0]]}),u};JXG$1.createPolePoint=function(n,t,o){var u,d,C,I,f,A,y;if(t.length>1&&(I=t[0].type===Const.OBJECT_TYPE_CONIC||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE,f=t[1].type===Const.OBJECT_TYPE_CONIC||t[1].elementClass===Const.OBJECT_CLASS_CIRCLE,A=t[0].elementClass===Const.OBJECT_CLASS_LINE,y=t[1].elementClass===Const.OBJECT_CLASS_LINE),t.length!==2||!(I&&y||A&&f))throw new Error("JSXGraph: Can't create 'pole point' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [conic|circle,line], [line,conic|circle]`);return y?(d=n.select(t[0]),C=n.select(t[1])):(d=n.select(t[1]),C=n.select(t[0])),u=n.create("point",[function(){var G=d.quadraticform,S=C.stdform.slice(0,3);return[JXG$1.Math.Numerics.det([S,G[1],G[2]]),JXG$1.Math.Numerics.det([G[0],S,G[2]]),JXG$1.Math.Numerics.det([G[0],G[1],S])]}],o),u.elType="polepoint",u.setParents([d.id,C.id]),d.addChild(u),C.addChild(u),u};JXG$1.registerElement("point",JXG$1.createPoint);JXG$1.registerElement("glider",JXG$1.createGlider);JXG$1.registerElement("intersection",JXG$1.createIntersectionPoint);JXG$1.registerElement("otherintersection",JXG$1.createOtherIntersectionPoint);JXG$1.registerElement("polepoint",JXG$1.createPolePoint);const Point=JXG$1.Point;JXG$1.Line=function(n,t,o,u){this.constructor(n,u,Const.OBJECT_TYPE_LINE,Const.OBJECT_CLASS_LINE),this.point1=this.board.select(t),this.point2=this.board.select(o),this.ticks=[],this.defaultTicks=null,this.parentPolygon=null,this.id=this.board.setId(this,"L"),this.board.renderer.drawLine(this),this.board.finalizeAdding(this),this.elType="line",this.point1._is_new?(this.addChild(this.point1),delete this.point1._is_new):this.point1.addChild(this),this.point2._is_new?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this),this.inherits.push(this.point1,this.point2),this.updateStdform(),this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{point1:"point1",point2:"point2",getSlope:"Slope",Slope:"Slope",Direction:"Direction",getRise:"getRise",Rise:"getRise",getYIntersect:"getRise",YIntersect:"getRise",getAngle:"getAngle",Angle:"getAngle",L:"L",length:"L",setFixedLength:"setFixedLength",setStraight:"setStraight"})};JXG$1.Line.prototype=new GeometryElement;JXG$1.extend(JXG$1.Line.prototype,{hasPoint:function(n,t){var o=[],u=[1,n,t],d,C,I,f,A,y,G,S,w,M=JXG$1.evaluate(this.visProp.strokewidth);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(w=this.board._inputDevice,S=JXG$1.evaluate(this.visProp.precision[w])):S=this.board.options.precision.hasPoint,S+=M*.5,o[0]=this.stdform[0]-this.stdform[1]*this.board.origin.scrCoords[1]/this.board.unitX+this.stdform[2]*this.board.origin.scrCoords[2]/this.board.unitY,o[1]=this.stdform[1]/this.board.unitX,o[2]=this.stdform[2]/-this.board.unitY,d=Geometry.distPointLine(u,o),isNaN(d)||d>S?!1:JXG$1.evaluate(this.visProp.straightfirst)&&JXG$1.evaluate(this.visProp.straightlast)?!0:(I=this.point1.coords,f=this.point2.coords,C=[0,o[1],o[2]],C=Mat.crossProduct(C,u),C=Mat.crossProduct(C,o),C[1]/=C[0],C[2]/=C[0],C[0]=1,C=new Coords(Const.COORDS_BY_SCREEN,C.slice(1),this.board).usrCoords,A=I.distance(Const.COORDS_BY_USER,f),I=I.usrCoords.slice(0),f=f.usrCoords.slice(0),A<Mat.eps?y=0:(A===Number.POSITIVE_INFINITY&&(A=1/Mat.eps,Math.abs(f[0])<Mat.eps?(A/=Geometry.distance([0,0,0],f),f=[1,I[1]+f[1]*A,I[2]+f[2]*A]):(A/=Geometry.distance([0,0,0],I),I=[1,f[1]+I[1]*A,f[2]+I[2]*A])),G=1,A=f[G]-I[G],Math.abs(A)<Mat.eps&&(G=2,A=f[G]-I[G]),y=(C[G]-I[G])/A),!JXG$1.evaluate(this.visProp.straightfirst)&&y<0?!1:!(!JXG$1.evaluate(this.visProp.straightlast)&&y>1))},update:function(){var n;return this.needsUpdate?(this.constrained&&(JXG$1.isFunction(this.funps)?(n=this.funps(),n&&n.length&&n.length===2&&(this.point1=n[0],this.point2=n[1])):(JXG$1.isFunction(this.funp1)&&(n=this.funp1(),JXG$1.isPoint(n)?this.point1=n:n&&n.length&&n.length===2&&this.point1.setPositionDirectly(Const.COORDS_BY_USER,n)),JXG$1.isFunction(this.funp2)&&(n=this.funp2(),JXG$1.isPoint(n)?this.point2=n:n&&n.length&&n.length===2&&this.point2.setPositionDirectly(Const.COORDS_BY_USER,n)))),this.updateSegmentFixedLength(),this.updateStdform(),JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this):this},updateSegmentFixedLength:function(){var n,t,o,u,d,C,I,f;return this.hasFixedLength?(n=this.point1.Dist(this.point2),t=JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.fixedLength()):Math.abs(this.fixedLength()),o=this.fixedLengthOldCoords[0].distance(Const.COORDS_BY_USER,this.point1.coords),u=this.fixedLengthOldCoords[1].distance(Const.COORDS_BY_USER,this.point2.coords),(o>Mat.eps||u>Mat.eps||n!==t)&&(d=this.point1.isDraggable&&this.point1.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point1.visProp.fixed),C=this.point2.isDraggable&&this.point2.type!==Const.OBJECT_TYPE_GLIDER&&!JXG$1.evaluate(this.point2.visProp.fixed),n>Mat.eps?o>u&&C||o<=u&&C&&!d?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+(this.point2.X()-this.point1.X())*t/n,this.point1.Y()+(this.point2.Y()-this.point1.Y())*t/n]),this.point2.fullUpdate()):(o<=u&&d||o>u&&d&&!C)&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+(this.point1.X()-this.point2.X())*t/n,this.point2.Y()+(this.point1.Y()-this.point2.Y())*t/n]),this.point1.fullUpdate()):(I=Math.random()-.5,f=Math.random()-.5,n=Mat.hypot(I,f),C?(this.point2.setPositionDirectly(Const.COORDS_BY_USER,[this.point1.X()+I*t/n,this.point1.Y()+f*t/n]),this.point2.fullUpdate()):d&&(this.point1.setPositionDirectly(Const.COORDS_BY_USER,[this.point2.X()+I*t/n,this.point2.Y()+f*t/n]),this.point1.fullUpdate())),this.fixedLengthOldCoords[0].setCoordinates(Const.COORDS_BY_USER,this.point1.coords.usrCoords),this.fixedLengthOldCoords[1].setCoordinates(Const.COORDS_BY_USER,this.point2.coords.usrCoords)),this):this},updateStdform:function(){var n=Mat.crossProduct(this.point1.coords.usrCoords,this.point2.coords.usrCoords);this.stdform[0]=n[0],this.stdform[1]=n[1],this.stdform[2]=n[2],this.stdform[3]=0,this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.point1.coords.usrCoords[1]+this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[1]+this.point2.coords.usrCoords[2])&&Mat.innerProduct(this.stdform,this.stdform,3)>=Mat.eps*Mat.eps,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateLine(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},generatePolynomial:function(n){var t=this.point1.symbolic.x,o=this.point1.symbolic.y,u=this.point2.symbolic.x,d=this.point2.symbolic.y,C=n.symbolic.x,I=n.symbolic.y;return[["(",o,")*(",C,")-(",o,")*(",u,")+(",I,")*(",u,")-(",t,")*(",I,")+(",t,")*(",d,")-(",C,")*(",d,")"].join("")]},getRise:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[0]/this.stdform[2]:1/0},Slope:function(){return Math.abs(this.stdform[2])>=Mat.eps?-this.stdform[1]/this.stdform[2]:1/0},getSlope:function(){return this.Slope()},getAngle:function(){return Math.atan2(-this.stdform[1],this.stdform[2])},Direction:function(){var n=this.point1.coords.usrCoords,t=this.point2.coords.usrCoords;return t[0]===0&&n[0]!==0?t.slice(1):n[0]===0&&t[0]!==0?[-n[1],-n[2]]:[t[1]-n[1],t[2]-n[2]]},isVertical:function(){var n=this.Direction();return n[0]===0&&n[1]!==0},isHorizontal:function(){var n=this.Direction();return n[1]===0&&n[0]!==0},setStraight:function(n,t){return this.visProp.straightfirst=n,this.visProp.straightlast=t,this.board.renderer.updateLine(this),this},getTextAnchor:function(){return new Coords(Const.COORDS_BY_USER,[.5*(this.point2.X()+this.point1.X()),.5*(this.point2.Y()+this.point1.Y())],this.board)},setLabelRelativeCoords:function(n){JXG$1.exists(this.label)&&(this.label.relativeCoords=new Coords(Const.COORDS_BY_SCREEN,[n[0],-n[1]],this.board))},getLabelAnchor:function(){var n,t,o,u,d,C,I,f,A=1.5,y=0,G=new Coords(Const.COORDS_BY_USER,this.point1.coords.usrCoords,this.board),S=new Coords(Const.COORDS_BY_USER,this.point2.coords.usrCoords,this.board),w=JXG$1.evaluate(this.visProp.straightfirst),M=JXG$1.evaluate(this.visProp.straightlast);if((w||M)&&Geometry.calcStraight(this,G,S,0),G=G.scrCoords,S=S.scrCoords,!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(o){case"last":n=S[1],t=S[2];break;case"first":n=G[1],t=G[2];break;case"lft":case"llft":case"ulft":G[1]<S[1]+Mat.eps?(n=G[1],t=G[2]):(n=S[1],t=S[2]);break;case"rt":case"lrt":case"urt":G[1]>S[1]+Mat.eps?(n=G[1],t=G[2]):(n=S[1],t=S[2]);break;default:n=.5*(G[1]+S[1]),t=.5*(G[2]+S[2])}else u=JXG$1.parsePosition(o),d=JXG$1.parseNumber(u.pos,1,1),C=S[1]-G[1],I=S[2]-G[2],f=Mat.hypot(C,I),u.pos.indexOf("px")>=0||u.pos.indexOf("fr")>=0||u.pos.indexOf("%")>=0?(u.pos.indexOf("px")>=0&&(d/=f),n=G[1]+d*C,t=G[2]+d*I):(n=G[1]+d*this.board.unitX*C/f,t=G[2]+d*this.board.unitY*I/f),u.side==="left"?C*=-1:I*=-1,JXG$1.exists(this.label)&&(A=.5*JXG$1.evaluate(this.label.visProp.distance)/f),n+=I*this.label.size[0]*A,t+=C*this.label.size[1]*A;return(w||M)&&(JXG$1.exists(this.label)&&(y=JXG$1.evaluate(this.label.visProp.fontsize)),Math.abs(n)<Mat.eps?n=y:this.board.canvasWidth+Mat.eps>n&&n>this.board.canvasWidth-y-Mat.eps&&(n=this.board.canvasWidth-y),Mat.eps+y>t&&t>-Mat.eps?t=y:this.board.canvasHeight+Mat.eps>t&&t>this.board.canvasHeight-y-Mat.eps&&(t=this.board.canvasHeight-y)),new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board)},cloneToBackground:function(){var n={},t,o,u;return n.id=this.id+"T"+this.numTraces,n.elementClass=Const.OBJECT_CLASS_LINE,this.numTraces++,n.point1=this.point1,n.point2=this.point2,n.stdform=this.stdform,n.board=this.board,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},o=this.getSlope(),t=this.getRise(),n.getSlope=function(){return o},n.getRise=function(){return t},u=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawLine(n),this.board.renderer.enhancedRendering=u,this.traces[n.id]=n.rendNode,this},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],u=o.length;for(t=0;t<u;t++)this.point1.transformations.push(o[t]),this.point2.transformations.push(o[t]);return this},snapToGrid:function(n){var t,o,u,d,C,I,f,A,y;return JXG$1.evaluate(this.visProp.snaptogrid)?this.parents.length<3?(this.point1.handleSnapToGrid(!0,!0),this.point2.handleSnapToGrid(!0,!0)):JXG$1.exists(n)&&(A=JXG$1.evaluate(this.visProp.snapsizex),y=JXG$1.evaluate(this.visProp.snapsizey),t=new Coords(Const.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this.board),I=t.usrCoords[1],f=t.usrCoords[2],A<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(C=this.board.defaultAxes.x.defaultTicks,A=C.ticksDelta*(JXG$1.evaluate(C.visProp.minorticks)+1)),y<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(C=this.board.defaultAxes.y.defaultTicks,y=C.ticksDelta*(JXG$1.evaluate(C.visProp.minorticks)+1)),A>0&&y>0&&(o=Geometry.projectPointToLine({coords:t},this,this.board),u=Statistics.subtract([1,Math.round(I/A)*A,Math.round(f/y)*y],o.usrCoords),d=this.board.create("transform",u.slice(1),{type:"translate"}),d.applyOnce([this.point1,this.point2]))):(this.point1.handleSnapToGrid(!1,!0),this.point2.handleSnapToGrid(!1,!0)),this},snapToPoints:function(){var n=JXG$1.evaluate(this.visProp.snaptopoints);return this.parents.length<3&&(this.point1.handleSnapToPoints(n),this.point2.handleSnapToPoints(n)),this},X:function(n){var t,o=this.stdform[2];return t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[1]:this.point2.coords.usrCoords[1],n=(n-.5)*2,(1-Math.abs(n))*t-n*o},Y:function(n){var t,o=this.stdform[1];return t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[2]:this.point2.coords.usrCoords[2],n=(n-.5)*2,(1-Math.abs(n))*t+n*o},Z:function(n){var t=Math.abs(this.point1.coords.usrCoords[0])>Mat.eps?this.point1.coords.usrCoords[0]:this.point2.coords.usrCoords[0];return n=(n-.5)*2,(1-Math.abs(n))*t},L:function(){return this.point1.Dist(this.point2)},setFixedLength:function(n){return this.hasFixedLength?(this.fixedLength=JXG$1.createFunction(n,this.board),this.hasFixedLength=!0,this.addParentsFromJCFunctions([this.fixedLength]),this.board.update(),this):this},minX:function(){return 0},maxX:function(){return 1},bounds:function(){var n=this.point1.coords.usrCoords,t=this.point2.coords.usrCoords;return[Math.min(n[1],t[1]),Math.max(n[2],t[2]),Math.max(n[1],t[1]),Math.min(n[2],t[2])]},remove:function(){this.removeAllTicks(),GeometryElement.prototype.remove.call(this)}});JXG$1.createLine=function(n,t,o){var u,d,C,I,f,A,y=[],G=!1,S=!1,w;if(t.length===2){if(A=JXG$1.copyAttributes(o,n.options,"line","point1"),JXG$1.isArray(t[0])&&t[0].length>1)C=n.create("point",t[0],A);else if(JXG$1.isString(t[0])||JXG$1.isPoint(t[0]))C=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))C=t[0](),S=!0;else if(JXG$1.isFunction(t[0])&&t[0]().length&&t[0]().length>=2)C=JXG$1.createPoint(n,t[0](),A),S=!0;else if(JXG$1.isObject(t[0])&&JXG$1.isTransformationOrArray(t[1]))G=!0,C=n.create("point",[t[0].point1,t[1]],A);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);if(A=JXG$1.copyAttributes(o,n.options,"line","point2"),G)I=n.create("point",[t[0].point2,t[1]],A);else if(JXG$1.isArray(t[1])&&t[1].length>1)I=n.create("point",t[1],A);else if(JXG$1.isString(t[1])||JXG$1.isPoint(t[1]))I=n.select(t[1]);else if(JXG$1.isFunction(t[1])&&JXG$1.isPoint(t[1]()))I=t[1](),S=!0;else if(JXG$1.isFunction(t[1])&&t[1]().length&&t[1]().length>=2)I=JXG$1.createPoint(n,t[1](),A),S=!0;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);A=JXG$1.copyAttributes(o,n.options,"line"),d=new JXG$1.Line(n,C,I,A),S?(d.constrained=!0,d.funp1=t[0],d.funp2=t[1]):G||(d.isDraggable=!0),d.setParents([C.id,I.id])}else if(t.length===3){for(w=!0,f=0;f<3;f++)if(JXG$1.isNumber(t[f]))y[f]=JXG$1.createFunction(t[f]);else if(JXG$1.isFunction(t[f]))y[f]=t[f],w=!1;else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);A=JXG$1.copyAttributes(o,n.options,"line","point1"),w?C=n.create("point",[y[2]()*y[2]()+y[1]()*y[1](),y[2]()-y[1]()*y[0]()+y[2](),-y[1]()-y[2]()*y[0]()-y[1]()],A):C=n.create("point",[function(){return(y[2]()*y[2]()+y[1]()*y[1]())*.5},function(){return(y[2]()-y[1]()*y[0]()+y[2]())*.5},function(){return(-y[1]()-y[2]()*y[0]()-y[1]())*.5}],A),A=JXG$1.copyAttributes(o,n.options,"line","point2"),w?I=n.create("point",[y[2]()*y[2]()+y[1]()*y[1](),-y[1]()*y[0]()+y[2](),-y[2]()*y[0]()-y[1]()],A):I=n.create("point",[function(){return y[2]()*y[2]()+y[1]()*y[1]()},function(){return-y[1]()*y[0]()+y[2]()},function(){return-y[2]()*y[0]()-y[1]()}],A),C.prepareUpdate().update(),I.prepareUpdate().update(),A=JXG$1.copyAttributes(o,n.options,"line"),d=new JXG$1.Line(n,C,I,A),d.isDraggable=w,d.setParents([C,I])}else if(t.length===1&&JXG$1.isFunction(t[0])&&t[0]().length===2&&JXG$1.isPoint(t[0]()[0])&&JXG$1.isPoint(t[0]()[1]))u=t[0](),A=JXG$1.copyAttributes(o,n.options,"line"),d=new JXG$1.Line(n,u[0],u[1],A),d.constrained=!0,d.funps=t[0],d.setParents(u);else if(t.length===1&&JXG$1.isFunction(t[0])&&t[0]().length===3&&JXG$1.isNumber(t[0]()[0])&&JXG$1.isNumber(t[0]()[1])&&JXG$1.isNumber(t[0]()[2]))u=t[0],A=JXG$1.copyAttributes(o,n.options,"line","point1"),C=n.create("point",[function(){var M=u();return[(M[2]*M[2]+M[1]*M[1])*.5,(M[2]-M[1]*M[0]+M[2])*.5,(-M[1]-M[2]*M[0]-M[1])*.5]}],A),A=JXG$1.copyAttributes(o,n.options,"line","point2"),I=n.create("point",[function(){var M=u();return[M[2]*M[2]+M[1]*M[1],-M[1]*M[0]+M[2],-M[2]*M[0]-M[1]]}],A),A=JXG$1.copyAttributes(o,n.options,"line"),d=new JXG$1.Line(n,C,I,A),d.constrained=!0,d.funps=t[0],d.setParents([C,I]);else throw new Error("JSXGraph: Can't create line with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]`);return d};JXG$1.registerElement("line",JXG$1.createLine);JXG$1.createSegment=function(n,t,o){var u,d;if(o.straightFirst=!1,o.straightLast=!1,d=JXG$1.copyAttributes(o,n.options,"segment"),u=n.create("line",t.slice(0,2),d),t.length===3){try{u.hasFixedLength=!0,u.fixedLengthOldCoords=[],u.fixedLengthOldCoords[0]=new Coords(Const.COORDS_BY_USER,u.point1.coords.usrCoords.slice(1,3),n),u.fixedLengthOldCoords[1]=new Coords(Const.COORDS_BY_USER,u.point2.coords.usrCoords.slice(1,3),n),u.setFixedLength(t[2])}catch{throw new Error("JSXGraph: Can't create segment with third parent type '"+typeof t[2]+`'.
Possible third parent types: number or function`)}u.getParents=function(){return this.parents.concat(this.fixedLength())}}return u.elType="segment",u};JXG$1.registerElement("segment",JXG$1.createSegment);JXG$1.createArrow=function(n,t,o){var u,d;return o.straightFirst=!1,o.straightLast=!1,d=JXG$1.copyAttributes(o,n.options,"arrow"),u=n.create("line",t,d),u.type=Const.OBJECT_TYPE_VECTOR,u.elType="arrow",u};JXG$1.registerElement("arrow",JXG$1.createArrow);JXG$1.createAxis=function(n,t,o){var u,d,C,I;d=JXG$1.copyAttributes(o,n.options,"axis");try{u=n.create("line",t,d)}catch{throw new Error("JSXGraph: Can't create axis with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}u.type=Const.OBJECT_TYPE_AXIS,u.isDraggable=!1,u.point1.isDraggable=!1,u.point2.isDraggable=!1,u._point1UsrCoordsOrg=u.point1.coords.usrCoords.slice(),u._point2UsrCoordsOrg=u.point2.coords.usrCoords.slice();for(C in u.ancestors)u.ancestors.hasOwnProperty(C)&&(u.ancestors[C].type=Const.OBJECT_TYPE_AXISPOINT);return JXG$1.exists(d.ticks.ticksdistance)?I=d.ticks.ticksdistance:JXG$1.isArray(d.ticks.ticks)?I=d.ticks.ticks:I=1,u.defaultTicks=n.create("ticks",[u,I],d.ticks),u.defaultTicks.dump=!1,u.elType="axis",u.subs={ticks:u.defaultTicks},u.inherits.push(u.defaultTicks),u.update=function(){var f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te;if(f=this.board.getBoundingBox(),A=JXG$1.evaluate(this.visProp.position),G=this.Direction(),S=this.isHorizontal(),w=this.isVertical(),M=JXG$1.evaluate(this.visProp.ticksautopos),V=JXG$1.evaluate(this.visProp.ticksautoposthreshold),S?V=JXG$1.parseNumber(V,Math.abs(f[1]-f[3]),1/this.board.unitX)*this.board.unitX:w?V=JXG$1.parseNumber(V,Math.abs(f[1]-f[3]),1/this.board.unitY)*this.board.unitY:V=JXG$1.parseNumber(V,1,1),H=JXG$1.evaluate(this.visProp.anchor),J=H.indexOf("left")>-1,z=H.indexOf("right")>-1,L=JXG$1.evaluate(this.visProp.anchordist),S?L=JXG$1.parseNumber(L,Math.abs(f[1]-f[3]),1/this.board.unitX):w?L=JXG$1.parseNumber(L,Math.abs(f[0]-f[2]),1/this.board.unitY):L=0,Q=this.board.getPointLoc(this._point1UsrCoordsOrg,L),K=this.point1.coords.usrCoords.slice(),O=this.point2.coords.usrCoords.slice(),A==="static"||!w&&!S||(A==="fixed"?(S&&(G[0]>0&&z||G[0]<0&&J?(K[2]=f[3]+L,O[2]=f[3]+L):G[0]>0&&J||G[0]<0&&z?(K[2]=f[1]-L,O[2]=f[1]-L):(K=this._point1UsrCoordsOrg.slice(),O=this._point2UsrCoordsOrg.slice())),w&&(G[1]>0&&J||G[1]<0&&z?(K[1]=f[0]+L,O[1]=f[0]+L):G[1]>0&&z||G[1]<0&&J?(K[1]=f[2]-L,O[1]=f[2]-L):(K=this._point1UsrCoordsOrg.slice(),O=this._point2UsrCoordsOrg.slice()))):A==="sticky"&&(S&&(Q[1]<0&&(G[0]>0&&z||G[0]<0&&J)?(K[2]=f[3]+L,O[2]=f[3]+L):Q[1]>0&&(G[0]>0&&J||G[0]<0&&z)?(K[2]=f[1]-L,O[2]=f[1]-L):(K=this._point1UsrCoordsOrg.slice(),O=this._point2UsrCoordsOrg.slice())),w&&(Q[0]<0&&(G[1]>0&&J||G[1]<0&&z)?(K[1]=f[0]+L,O[1]=f[0]+L):Q[0]>0&&(G[1]>0&&z||G[1]<0&&J)?(K[1]=f[2]-L,O[1]=f[2]-L):(K=this._point1UsrCoordsOrg.slice(),O=this._point2UsrCoordsOrg.slice())))),this.point1.setPositionDirectly(JXG$1.COORDS_BY_USER,K),this.point2.setPositionDirectly(JXG$1.COORDS_BY_USER,O),JXG$1.exists(this.defaultTicks)){if(ee=this.defaultTicks.visProp.label,M&&(S||w)){if(JXG$1.exists(ee._anchorx_org)||(ee._anchorx_org=JXG$1.def(ee.anchorx,this.board.options.text.anchorX)),JXG$1.exists(ee._anchory_org)||(ee._anchory_org=JXG$1.def(ee.anchory,this.board.options.text.anchorY)),JXG$1.exists(ee._offset_org)||(ee._offset_org=ee.offset.slice()),te=ee.offset,S){for(T=u.point1.coords.scrCoords[2]-this.board.canvasHeight*.5,ie=ee.anchory,T<0&&Math.abs(T)>V?ee._side==="bottom"&&(ee.anchory==="top"&&(ie="bottom"),te[1]*=-1,ee._side="top"):T>0&&Math.abs(T)>V?ee._side==="top"&&(ee.anchory==="bottom"&&(ie="top"),te[1]*=-1,ee._side="bottom"):(ie=ee._anchory_org,te=ee._offset_org.slice(),ie==="top"?ee._side="bottom":ie==="bottom"?ee._side="top":te[1]<0?ee._side="bottom":ee._side="top"),y=0;y<u.defaultTicks.labels.length;y++)this.defaultTicks.labels[y].visProp.anchory=ie;ee.anchory=ie}else if(w){for(T=u.point1.coords.scrCoords[1]-this.board.canvasWidth*.5,T<0&&Math.abs(T)>V?ee._side==="right"&&(ee.anchorx==="left"&&(ie="right"),te[0]*=-1,ee._side="left"):T>0&&Math.abs(T)>V?ee._side==="left"&&(ee.anchorx==="right"&&(ie="left"),te[0]*=-1,ee._side="right"):(ie=ee._anchorx_org,te=ee._offset_org.slice(),ie==="left"?ee._side="right":ie==="right"||te[0]<0?ee._side="left":ee._side="right"),y=0;y<u.defaultTicks.labels.length;y++)this.defaultTicks.labels[y].visProp.anchorx=ie;ee.anchorx=ie}ee.offset=te}else delete ee._anchorx_org,delete ee._anchory_org,delete ee._offset_org;this.defaultTicks.needsUpdate=!0}return JXG$1.Line.prototype.update.call(this),this},u};JXG$1.registerElement("axis",JXG$1.createAxis);JXG$1.createTangent=function(n,t,o){var u,d,C,I,f,A,y,G,S,w=[];if(t.length===1)u=t[0],d=u.slideObject;else if(t.length===2)if(JXG$1.isPoint(t[0]))u=t[0],d=t[1];else if(JXG$1.isPoint(t[1]))d=t[0],u=t[1];else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);else throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider|point], [point,line|curve|circle|conic]`);if(A=JXG$1.copyAttributes(o,n.options,"tangent"),d.elementClass===Const.OBJECT_CLASS_LINE)f=n.create("line",[d.point1,d.point2],A),f.glider=u;else if(d.elementClass===Const.OBJECT_CLASS_CURVE&&d.type!==Const.OBJECT_TYPE_CONIC){if(G=d.getTransformationSource(),S=G[0],S)for(w.push(d);G[0]&&JXG$1.exists(G[1]._transformationSource);)w.push(G[1]),G=G[1].getTransformationSource();JXG$1.evaluate(d.visProp.curvetype)!=="plot"||S?(f=n.create("line",[function(){var M=d.X,V=d.Y,T,H,J,z,L,K,O,Q;if(u.type===Const.OBJECT_TYPE_GLIDER?Q=u.position:JXG$1.evaluate(d.visProp.curvetype)==="functiongraph"?Q=u.X():Q=Geometry.projectPointToCurve(u,d,n)[1],O=u.Coords(!0),S){for(L=w[w.length-1]._transformationSource,M=L.X,V=L.Y,z=0;z<w.length;z++)w[z].updateTransformMatrix(),K=Mat.inverse(w[z].transformMat),O=Mat.matVecMult(K,O);u.type!==Const.OBJECT_TYPE_GLIDER&&(O[1]/=O[0],O[2]/=O[0],O[0]/=O[0],Q=Geometry.projectCoordsToCurve(O[1],O[2],0,L,n)[1])}if(T=Numerics.D(V)(Q),H=Numerics.D(M)(Q),J=[-O[1]*T+O[2]*H,O[0]*T,-O[0]*H],S)for(z=w.length-1;z>=0;z--)K=Mat.transpose(Mat.inverse(w[z].transformMat)),J=Mat.matVecMult(K,J);return J}],A),u.addChild(f),f.glider=u):(y=function(M,V,T){var H=Math.floor(M),J,z,L,K,O,Q,ee,ie,te,se,ae,le;if(V.bezierDegree===1)H===V.numberPoints-1&&H--;else if(V.bezierDegree===3)V.elType==="sector"?(ae=V.points.slice(3,V.numberPoints-3),le=ae.length):(ae=V.points,le=ae.length),H=Math.floor(M*(le-1)/3)*3,L=(M*(le-1)-H)/3,H>=le-1&&(H=le-4,L=1);else return 0;if(H<0)return 1;switch(V.bezierDegree===1?(J=V.points[H].usrCoords,z=V.points[H+1].usrCoords):(K=ae[H].usrCoords,O=ae[H+1].usrCoords,Q=ae[H+2].usrCoords,ee=ae[H+3].usrCoords,ie=(1-L)*(1-L)*(O[1]-K[1])+2*(1-L)*L*(Q[1]-O[1])+L*L*(ee[1]-Q[1]),te=(1-L)*(1-L)*(O[2]-K[2])+2*(1-L)*L*(Q[2]-O[2])+L*L*(ee[2]-Q[2]),se=Mat.hypot(ie,te),ie/=se,te/=se,J=u.coords.usrCoords,z=[1,J[1]+ie,J[2]+te]),T){case 0:return J[2]*z[1]-J[1]*z[2];case 1:return z[2]-J[2];case 2:return J[1]-z[1];default:return[J[2]*z[1]-J[1]*z[2],z[2]-J[2],J[1]-z[1]]}},f=n.create("line",[function(){var M;return u.type===Const.OBJECT_TYPE_GLIDER?M=u.position:M=Geometry.projectPointToCurve(u,d,n)[1],y(M,d)}],A),u.addChild(f),f.glider=u)}else d.type===Const.OBJECT_TYPE_TURTLE?(f=n.create("line",[function(){var M,V;for(u.type===Const.OBJECT_TYPE_GLIDER?V=u.position:V=Geometry.projectPointToTurtle(u,d,n)[1],M=Math.floor(V),C=0;C<d.objects.length;C++)if(I=d.objects[C],I.type===Const.OBJECT_TYPE_CURVE){if(M<I.numberPoints)break;M-=I.numberPoints}return M===I.numberPoints-1&&M--,M<0?[1,0,0]:[I.Y(M)*I.X(M+1)-I.X(M)*I.Y(M+1),I.Y(M+1)-I.Y(M),I.X(M)-I.X(M+1)]}],A),u.addChild(f),f.glider=u):(d.elementClass===Const.OBJECT_CLASS_CIRCLE||d.type===Const.OBJECT_TYPE_CONIC)&&(f=n.create("line",[function(){return Mat.matVecMult(d.quadraticform,u.coords.usrCoords)}],A),u.addChild(f),f.glider=u);if(!JXG$1.exists(f))throw new Error("JSXGraph: Couldn't create tangent with the given parents.");return f.elType="tangent",f.type=Const.OBJECT_TYPE_TANGENT,f.setParents(t),f};JXG$1.createNormal=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M=[];for(I=0;I<t.length;++I)t[I]=n.select(t[I]);if(t.length===1)u=t[0],d=u.slideObject;else if(t.length===2)if(JXG$1.isPointType(n,t[0]))u=JXG$1.providePoints(n,[t[0]],o,"point")[0],d=t[1];else if(JXG$1.isPointType(n,t[1]))d=t[0],u=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);if(f=JXG$1.copyAttributes(o,n.options,"normal"),d.elementClass===Const.OBJECT_CLASS_LINE)y=JXG$1.copyAttributes(o,n.options,"normal","point"),A=n.create("point",[function(){var V=Mat.crossProduct([1,0,0],d.stdform);return[V[0],-V[2],V[1]]}],y),A.isDraggable=!0,C=n.create("line",[u,A],f),C.point=A,C.subs={point:A},C.inherits.push(A);else if(d.elementClass===Const.OBJECT_CLASS_CIRCLE)C=n.create("line",[d.midpoint,u],f);else if(d.elementClass===Const.OBJECT_CLASS_CURVE){if(S=d.getTransformationSource(),w=S[0],w)for(M.push(d);S[0]&&JXG$1.exists(S[1]._transformationSource);)M.push(S[1]),S=S[1].getTransformationSource();JXG$1.evaluate(d.visProp.curvetype)!=="plot"||w?C=n.create("line",[function(){var V=d.X,T=d.Y,H,J,z,L,K,O,Q,ee;if(u.type===Const.OBJECT_TYPE_GLIDER?ee=u.position:JXG$1.evaluate(d.visProp.curvetype)==="functiongraph"?ee=u.X():ee=Geometry.projectPointToCurve(u,d,n)[1],Q=u.Coords(!0),w){for(K=M[M.length-1]._transformationSource,V=K.X,T=K.Y,L=0;L<M.length;L++)M[L].updateTransformMatrix(),O=Mat.inverse(M[L].transformMat),Q=Mat.matVecMult(O,Q);u.type!==Const.OBJECT_TYPE_GLIDER&&(Q[1]/=Q[0],Q[2]/=Q[0],Q[0]/=Q[0],ee=Geometry.projectCoordsToCurve(Q[1],Q[2],0,K,n)[1])}if(H=Numerics.D(T)(ee),J=Numerics.D(V)(ee),z=[-Q[1]*J-Q[2]*H,Q[0]*J,Q[0]*H],w)for(L=M.length-1;L>=0;L--)O=Mat.transpose(Mat.inverse(M[L].transformMat)),z=Mat.matVecMult(O,z);return z}],f):(G=function(V,T,H){var J=Math.floor(V),z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe,Ce,Re;if(T.bezierDegree===1)J===T.numberPoints-1&&J--,O=V;else if(T.bezierDegree===3)T.elType==="sector"?(Ce=T.points.slice(3,T.numberPoints-3),Re=Ce.length):(Ce=T.points,Re=Ce.length),J=Math.floor(V*(Re-1)/3)*3,O=(V*(Re-1)-J)/3,J>=Re-1&&(J=Re-4,O=1);else return 0;if(J<0)return 1;switch(z=O-J,T.bezierDegree===1?(L=T.points[J].usrCoords,K=T.points[J+1].usrCoords,be=[L[0]+z*(K[0]-L[0]),L[1]+z*(K[1]-L[1]),L[2]+z*(K[2]-L[2])],ge=Mat.crossProduct(L,K),Xe=Mat.crossProduct([1,0,0],ge),Xe=[Xe[0],-Xe[2],Xe[1]],ge=Mat.crossProduct(be,Xe)):(Q=Ce[J].usrCoords,ee=Ce[J+1].usrCoords,ie=Ce[J+2].usrCoords,te=Ce[J+3].usrCoords,se=(1-O)*(1-O)*(ee[1]-Q[1])+2*(1-O)*O*(ie[1]-ee[1])+O*O*(te[1]-ie[1]),ae=(1-O)*(1-O)*(ee[2]-Q[2])+2*(1-O)*O*(ie[2]-ee[2])+O*O*(te[2]-ie[2]),le=Mat.hypot(se,ae),se/=le,ae/=le,L=u.coords.usrCoords,K=[1,L[1]-ae,L[2]+se],ge=[L[2]*K[1]-L[1]*K[2],K[2]-L[2],L[1]-K[1]]),H){case 0:return ge[0];case 1:return ge[1];case 2:return ge[2];default:return ge}},C=n.create("line",[function(){var V;return u.type===Const.OBJECT_TYPE_GLIDER?V=u.position:V=Geometry.projectPointToCurve(u,d,n)[1],G(V,d)}],f),u.addChild(C),C.glider=u)}else if(d.type===Const.OBJECT_TYPE_TURTLE)C=n.create("line",[function(){var V,T,H=Math.floor(u.position),J=u.position-H;for(T=0;T<d.objects.length;T++)if(V=d.objects[T],V.type===Const.OBJECT_TYPE_CURVE){if(H<V.numberPoints)break;H-=V.numberPoints}return H===V.numberPoints-1&&(H-=1,J=1),H<0?1:(V.Y(H)+J*(V.Y(H+1)-V.Y(H)))*(V.Y(H)-V.Y(H+1))-(V.X(H)+J*(V.X(H+1)-V.X(H)))*(V.X(H+1)-V.X(H))},function(){var V,T,H=Math.floor(u.position);for(T=0;T<d.objects.length;T++)if(V=d.objects[T],V.type===Const.OBJECT_TYPE_CURVE){if(H<V.numberPoints)break;H-=V.numberPoints}return H===V.numberPoints-1&&(H-=1),H<0?0:V.X(H+1)-V.X(H)},function(){var V,T,H=Math.floor(u.position);for(T=0;T<d.objects.length;T++)if(V=d.objects[T],V.type===Const.OBJECT_TYPE_CURVE){if(H<V.numberPoints)break;H-=V.numberPoints}return H===V.numberPoints-1&&(H-=1),H<0?0:V.Y(H+1)-V.Y(H)}],f);else throw new Error("JSXGraph: Can't create normal with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line], [point,circle], [glider]`);return C.elType="normal",C.setParents(t),JXG$1.exists(u._is_new)?(C.addChild(u),delete u._is_new):u.addChild(C),d.addChild(C),C};JXG$1.createRadicalAxis=function(n,t,o){var u,d,C;if(t.length!==2||t[0].elementClass!==Const.OBJECT_CLASS_CIRCLE||t[1].elementClass!==Const.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create 'radical axis' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [circle,circle]`);return d=n.select(t[0]),C=n.select(t[1]),u=n.create("line",[function(){var I=d.stdform,f=C.stdform;return Mat.matVecMult(Mat.transpose([I.slice(0,3),f.slice(0,3)]),[f[3],-I[3]])}],o),u.elType="radicalaxis",u.setParents([d.id,C.id]),d.addChild(u),C.addChild(u),u};JXG$1.createPolarLine=function(n,t,o){var u,d,C,I,f,A,y;if(t.length>1&&(I=t[0].type===Const.OBJECT_TYPE_CONIC||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE,f=t[1].type===Const.OBJECT_TYPE_CONIC||t[1].elementClass===Const.OBJECT_CLASS_CIRCLE,A=JXG$1.isPoint(t[0]),y=JXG$1.isPoint(t[1])),t.length!==2||!(I&&y||A&&f))throw new Error("JSXGraph: Can't create 'polar line' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent type: [conic|circle,point], [point,conic|circle]`);return y?(d=n.select(t[0]),C=n.select(t[1])):(d=n.select(t[1]),C=n.select(t[0])),u=n.create("tangent",[d,C],o),u.elType="polarline",u};JXG$1.createTangentTo=function(n,t,o){var u,d,C,I,f,A,y;if(C=n.select(t[0]),I=JXG$1.providePoints(n,t[1],o,"point")[0],f=JXG$1.def(t[2],0),C.type!==Const.OBJECT_TYPE_CIRCLE&&C.type!==Const.OBJECT_TYPE_CONIC||I.elementClass!==Const.OBJECT_CLASS_POINT)throw new Error("JSXGraph: Can't create tangentto with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [circle|conic,point,number]`);return d=JXG$1.copyAttributes(o,n.options,"tangentto"),y=n.create("polar",[C,I],d.polar),A=n.create("intersection",[y,C,f],d.point),u=n.create("tangent",[C,A],d),u.point=A,u.polar=y,u.elType="tangentto",u};JXG$1.registerElement("tangent",JXG$1.createTangent);JXG$1.registerElement("normal",JXG$1.createNormal);JXG$1.registerElement("tangentto",JXG$1.createTangentTo);JXG$1.registerElement("polar",JXG$1.createTangent);JXG$1.registerElement("radicalaxis",JXG$1.createRadicalAxis);JXG$1.registerElement("polarline",JXG$1.createPolarLine);JXG$1.Line;JXG$1.Group=function(n,t,o,u,d){var C,I,f,A;for(this.board=n,this.objects={},C=this.board.numObjects,this.board.numObjects+=1,t===""||!JXG$1.exists(t)?this.id=this.board.id+"Group"+C:this.id=t,this.board.groups[this.id]=this,this.type=Const.OBJECT_TYPE_POINT,this.elementClass=Const.OBJECT_CLASS_POINT,o===""||!JXG$1.exists(o)?this.name="group_"+this.board.generateName(this):this.name=o,delete this.type,this.coords={},this.needsRegularUpdate=d.needsregularupdate,this.rotationCenter="centroid",this.scaleCenter=null,this.rotationPoints=[],this.translationPoints=[],this.scalePoints=[],this.scaleDirections={},this.parents=[],JXG$1.isArray(u)?I=u:I=Array.prototype.slice.call(arguments,3),f=0;f<I.length;f++)A=this.board.select(I[f]),!JXG$1.evaluate(A.visProp.fixed)&&JXG$1.exists(A.coords)&&this.addPoint(A);this.methodMap={ungroup:"ungroup",add:"addPoint",addPoint:"addPoint",addPoints:"addPoints",addGroup:"addGroup",remove:"removePoint",removePoint:"removePoint",setAttribute:"setAttribute",setProperty:"setAttribute"}};JXG$1.extend(JXG$1.Group.prototype,{ungroup:function(){var n,t,o;for(n in this.objects)this.objects.hasOwnProperty(n)&&(t=this.objects[n].point,JXG$1.isArray(t.groups)&&(o=JXG$1.indexOf(t.groups,this.id),o>=0&&delete t.groups[o]));return this.objects={},this},addParents:function(n){var t,o,u;for(JXG$1.isArray(n)?u=n:u=arguments,o=u.length,t=0;t<o;++t)JXG$1.isId(this.board,u[t])?this.parents.push(u[t]):JXG$1.exists(u[t].id)&&this.parents.push(u[t].id);this.parents=JXG$1.uniqueArray(this.parents)},setParents:function(n){return this.parents=[],this.addParents(n),this},getParents:function(){return JXG$1.isArray(this.parents)?this.parents:[]},_updateCoordsCache:function(n){var t;n!==""&&JXG$1.exists(this.objects[n])&&(t=this.objects[n].point,this.coords[t.id]={usrCoords:t.coords.usrCoords.slice(0)})},update:function(){var n,t,o,u,d,C,I,f,A,y,G=null;if(!this.needsUpdate)return this;if(n=this._update_find_drag_type(),n.action==="nothing")return this._updateCoordsCache(n.id),this;if(G=this.objects[n.id].point,n.action==="translation")A=[G.coords.usrCoords[1]-this.coords[n.id].usrCoords[1],G.coords.usrCoords[2]-this.coords[n.id].usrCoords[2]];else if(n.action==="rotation"||n.action==="scaling"){if(n.action==="rotation"?o="rotationCenter":o="scaleCenter",JXG$1.isPoint(this[o]))y=this[o].coords.usrCoords.slice(1);else if(this[o]==="centroid")y=this._update_centroid_center();else if(JXG$1.isArray(this[o]))y=this[o];else if(JXG$1.isFunction(this[o]))y=this[o]();else return this;if(n.action==="rotation")f=Geometry.rad(this.coords[n.id].usrCoords.slice(1),y,this.objects[n.id].point),A=this.board.create("transform",[f,y[0],y[1]],{type:"rotate"}),A.update();else if(n.action==="scaling"){if(d=Geometry.distance(this.coords[n.id].usrCoords.slice(1),y),Math.abs(d)<Mat.eps)return this;d=Geometry.distance(G.coords.usrCoords.slice(1),y)/d,C=this.scaleDirections[n.id].indexOf("x")>=0?d:1,I=this.scaleDirections[n.id].indexOf("y")>=0?d:1,A=this.board.create("transform",[1,0,0,y[0]*(1-C),C,0,y[1]*(1-I),0,I],{type:"generic"}),A.update()}else return this}this._update_apply_transformation(n,A),this.needsUpdate=!1;for(t in this.objects)if(this.objects.hasOwnProperty(t))for(u in this.objects[t].descendants)this.objects[t].descendants.hasOwnProperty(u)&&(this.objects[t].descendants.needsUpdate=this.objects[t].descendants.needsRegularUpdate||this.board.needsFullUpdate);this.board.updateElements(n);for(t in this.objects)this.objects.hasOwnProperty(t)&&this._updateCoordsCache(t);return this},_update_find_drag_type:function(){var n,t,o="nothing",u=[],d;for(n in this.objects)this.objects.hasOwnProperty(n)&&(t=this.objects[n].point,t.coords.distance(Const.COORDS_BY_USER,this.coords[n])>Mat.eps&&u.push(t.id));return u.length===0?{action:o,id:"",changed:u}:(d=u[0],t=this.objects[d].point,u.length>1?o="translation":JXG$1.isInArray(this.rotationPoints,t)&&JXG$1.exists(this.rotationCenter)?o="rotation":JXG$1.isInArray(this.scalePoints,t)&&JXG$1.exists(this.scaleCenter)?o="scaling":JXG$1.isInArray(this.translationPoints,t)&&(o="translation"),{action:o,id:d,changed:u})},_update_centroid_center:function(){var n,t,o;n=[0,0],t=0;for(o in this.coords)this.coords.hasOwnProperty(o)&&(n[0]+=this.coords[o].usrCoords[1],n[1]+=this.coords[o].usrCoords[2],++t);return t>0&&(n[0]/=t,n[1]/=t),n},_update_apply_transformation:function(n,t){var o,u;for(o in this.objects)this.objects.hasOwnProperty(o)&&(JXG$1.exists(this.board.objects[o])?(u=this.objects[o].point,u.id!==n.id?n.action==="translation"?JXG$1.isInArray(n.changed,u.id)||u.coords.setCoordinates(Const.COORDS_BY_USER,[this.coords[o].usrCoords[1]+t[0],this.coords[o].usrCoords[2]+t[1]]):(n.action==="rotation"||n.action==="scaling")&&t.applyOnce([u]):(n.action==="rotation"||n.action==="scaling")&&u.coords.setCoordinates(Const.COORDS_BY_USER,Mat.matVecMult(t.matrix,this.coords[u.id].usrCoords))):delete this.objects[o])},addPoint:function(n){return this.objects[n.id]={point:this.board.select(n)},this._updateCoordsCache(n.id),this.translationPoints.push(n),n.groups.push(this.id),n.groups=JXG$1.uniqueArray(n.groups),this},addPoints:function(n){var t;for(t=0;t<n.length;t++)this.addPoint(n[t]);return this},addGroup:function(n){var t;for(t in n.objects)n.objects.hasOwnProperty(t)&&this.addPoint(n.objects[t].point);return this},removePoint:function(n){return delete this.objects[n.id],this},setRotationCenter:function(n){return this.rotationCenter=n,this},setRotationPoints:function(n){return this._setActionPoints("rotation",n)},addRotationPoint:function(n){return this._addActionPoint("rotation",n)},removeRotationPoint:function(n){return this._removeActionPoint("rotation",n)},setTranslationPoints:function(n){return this._setActionPoints("translation",n)},addTranslationPoint:function(n){return this._addActionPoint("translation",n)},removeTranslationPoint:function(n){return this._removeActionPoint("translation",n)},setScaleCenter:function(n){return this.scaleCenter=n,this},setScalePoints:function(n,t){var o,u,d;for(JXG$1.isArray(n)?o=n:o=arguments,d=o.length,u=0;u<d;++u)this.scaleDirections[this.board.select(o[u]).id]=t||"xy";return this._setActionPoints("scale",n)},addScalePoint:function(n,t){return this._addActionPoint("scale",n),this.scaleDirections[this.board.select(n).id]=t||"xy",this},removeScalePoint:function(n){return this._removeActionPoint("scale",n)},_setActionPoints:function(n,t){var o,u,d;for(JXG$1.isArray(t)?o=t:o=arguments,d=o.length,this[n+"Points"]=[],u=0;u<d;++u)this._addActionPoint(n,o[u]);return this},_addActionPoint:function(n,t){return this[n+"Points"].push(this.board.select(t)),this},_removeActionPoint:function(n,t){var o=this[n+"Points"].indexOf(this.board.select(t));return o>-1&&this[n+"Points"].splice(o,1),this},setProperty:function(){JXG$1.deprecated("Group.setProperty","Group.setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(){var n;for(n in this.objects)this.objects.hasOwnProperty(n)&&this.objects[n].point.setAttribute.apply(this.objects[n].point,arguments);return this}});JXG$1.createGroup=function(n,t,o){var u=JXG$1.copyAttributes(o,n.options,"group"),d=new JXG$1.Group(n,u.id,u.name,t,u);return d.elType="group",d.setParents(t),d};JXG$1.registerElement("group",JXG$1.createGroup);JXG$1.Group;JXG$1.Circle=function(n,t,o,u,d){this.constructor(n,d,Const.OBJECT_TYPE_CIRCLE,Const.OBJECT_CLASS_CIRCLE),this.method=t,this.midpoint=this.board.select(o),this.center=this.board.select(o),this.point2=null,this.radius=0,this.line=null,this.circle=null,this.points=[],t==="twoPoints"?(this.point2=n.select(u),this.radius=this.Radius()):t==="pointRadius"?(this.gxtterm=u,this.updateRadius=JXG$1.createFunction(u,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])):t==="pointLine"?(this.line=n.select(u),this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords)):t==="pointCircle"&&(this.circle=n.select(u),this.radius=this.circle.Radius()),this.id=this.board.setId(this,"C"),this.board.renderer.drawEllipse(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="circle",this.createLabel(),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),t==="pointRadius"?this.notifyParents(u):t==="pointLine"?this.line.addChild(this):t==="pointCircle"?this.circle.addChild(this):t==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{setRadius:"setRadius",getRadius:"getRadius",Area:"Area",area:"Area",Perimeter:"Perimeter",Circumference:"Perimeter",radius:"Radius",Radius:"Radius",Diameter:"Diameter",center:"center",line:"line",point2:"point2"})};JXG$1.Circle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Circle.prototype,{hasPoint:function(n,t){var o,u,d=this.center.coords.usrCoords,C=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),I=this.Radius(),f,A,y;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(u=this.board._inputDevice,o=JXG$1.evaluate(this.visProp.precision[u])):o=this.board.options.precision.hasPoint,f=d[1]-C.usrCoords[1],A=d[2]-C.usrCoords[2],y=Mat.hypot(f,A),o+=JXG$1.evaluate(this.visProp.strokewidth)*.5,o/=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY)),JXG$1.evaluate(this.visProp.hasinnerpoints)?y<I+o:Math.abs(y-I)<o},generatePolynomial:function(n){var t=this.center.symbolic.x,o=this.center.symbolic.y,u=n.symbolic.x,d=n.symbolic.y,C=this.generateRadiusSquared();return C===""?[]:["(("+u+")-("+t+"))^2 + (("+d+")-("+o+"))^2 - ("+C+")"]},generateRadiusSquared:function(){var n,t,o,u,d,C,I="";return this.method==="twoPoints"?(n=this.center.symbolic.x,t=this.center.symbolic.y,o=this.point2.symbolic.x,u=this.point2.symbolic.y,I="(("+o+")-("+n+"))^2 + (("+u+")-("+t+"))^2"):this.method==="pointRadius"?JXG$1.isNumber(this.radius)&&(I=(this.radius*this.radius).toString()):this.method==="pointLine"?(o=this.line.point1.symbolic.x,u=this.line.point1.symbolic.y,d=this.line.point2.symbolic.x,C=this.line.point2.symbolic.y,I="(("+o+")-("+d+"))^2 + (("+u+")-("+C+"))^2"):this.method==="pointCircle"&&(I=this.circle.Radius()),I},update:function(){var n,t,o,u,d,C;if(this.needsUpdate)for(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.method==="pointLine"?this.radius=this.line.point1.coords.distance(Const.COORDS_BY_USER,this.line.point2.coords):this.method==="pointCircle"?this.radius=this.circle.Radius():this.method==="pointRadius"&&(this.radius=this.updateRadius()),this.radius=Math.abs(this.radius),this.updateStdform(),this.updateQuadraticform(),o=this.center.coords.usrCoords[0],n=this.center.coords.usrCoords[1]/o,t=this.center.coords.usrCoords[2]/o,o/=o,u=this.Radius(),d=.551915024494,this.numberPoints=13,this.dataX=[n+u,n+u,n+u*d,n,n-u*d,n-u,n-u,n-u,n-u*d,n,n+u*d,n+u,n+u],this.dataY=[t,t+u*d,t+u,t+u,t+u,t+u*d,t,t-u*d,t-u,t-u,t-u,t-u*d,t],this.bezierDegree=3,C=0;C<this.numberPoints;C++)this.points[C]=new Coords(Const.COORDS_BY_USER,[this.dataX[C],this.dataY[C]],this.board);return this},updateQuadraticform:function(){var n=this.center,t=n.X(),o=n.Y(),u=this.Radius();this.quadraticform=[[t*t+o*o-u*u,-t,-o],[-t,1,0],[-o,0,1]]},updateStdform:function(){this.stdform[3]=.5,this.stdform[4]=this.Radius(),this.stdform[1]=-this.center.coords.usrCoords[1],this.stdform[2]=-this.center.coords.usrCoords[2],isFinite(this.stdform[4])||(this.stdform[0]=JXG$1.exists(this.point2)?-(this.stdform[1]*this.point2.coords.usrCoords[1]+this.stdform[2]*this.point2.coords.usrCoords[2]):0),this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.center.coords.usrCoords[1]+this.center.coords.usrCoords[2]+this.Radius())&&this.center.isReal,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateEllipse(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},notifyParents:function(n){JXG$1.isString(n)&&GeonextParser.findDependencies(this,n,this.board)},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):this.method==="twoPoints"?JXG$1.cmpArrays(this.point2.coords.usrCoords,[0,0,0])||JXG$1.cmpArrays(this.center.coords.usrCoords,[0,0,0])?NaN:this.center.Dist(this.point2):this.method==="pointLine"||this.method==="pointCircle"?this.radius:this.method==="pointRadius"?JXG$1.evaluate(this.visProp.nonnegativeonly)?Math.max(0,this.updateRadius()):Math.abs(this.updateRadius()):NaN},Diameter:function(){return 2*this.Radius()},getRadius:function(){return JXG$1.deprecated("Circle.getRadius()","Circle.Radius()"),this.Radius()},getTextAnchor:function(){return this.center.coords},getLabelAnchor:function(){var n,t,o,u,d,C,I=1.5,f=this.Radius(),A=this.center.coords.usrCoords,y=.7071067811865;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"lft":n=A[1]-f,t=A[2];break;case"llft":n=A[1]-y*f,t=A[2]-y*f;break;case"rt":n=A[1]+f,t=A[2];break;case"lrt":n=A[1]+y*f,t=A[2]-y*f;break;case"urt":n=A[1]+y*f,t=A[2]+y*f;break;case"top":n=A[1],t=A[2]+f;break;case"bot":n=A[1],t=A[2]-f;break;default:n=A[1]-y*f,t=A[2]+y*f;break}else return A=this.center.coords.scrCoords,u=JXG$1.parsePosition(o),d=JXG$1.parseNumber(u.pos,2*Math.PI,1),u.pos.indexOf("fr")<0&&u.pos.indexOf("%")<0&&(u.pos.indexOf("px")>=0?d=0:d*=Math.PI/180),C=1,u.side==="left"&&(C=-1),JXG$1.exists(this.label)&&(I=C*.5*JXG$1.evaluate(this.label.visProp.distance)),n=A[1]+(f*this.board.unitX+this.label.size[0]*I)*Math.cos(d),t=A[2]-(f*this.board.unitY+this.label.size[1]*I)*Math.sin(d),new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board);return new Coords(Const.COORDS_BY_USER,[n,t],this.board)},cloneToBackground:function(){var n,t=this.Radius(),o={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CIRCLE,center:{coords:this.center.coords},Radius:function(){return t},getRadius:function(){return t},board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return o.visProp.layer=this.board.options.layer.trace,this.numTraces++,JXG$1.clearVisPropOld(o),o.visPropCalc={visible:JXG$1.evaluate(o.visProp.visible)},n=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawEllipse(o),this.board.renderer.enhancedRendering=n,this.traces[o.id]=o.rendNode,this},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],u=o.length;for(t=0;t<u;t++)this.center.transformations.push(o[t]),this.method==="twoPoints"&&this.point2.transformations.push(o[t]);return this},snapToGrid:function(){var n=JXG$1.evaluate(this.visProp.snaptogrid);return this.center.handleSnapToGrid(n,!0),this.method==="twoPoints"&&this.point2.handleSnapToGrid(n,!0),this},snapToPoints:function(){var n=JXG$1.evaluate(this.visProp.snaptopoints);return this.center.handleSnapToPoints(n),this.method==="twoPoints"&&this.point2.handleSnapToPoints(n),this},X:function(n){return this.Radius()*Math.cos(n*2*Math.PI)+this.center.coords.usrCoords[1]},Y:function(n){return this.Radius()*Math.sin(n*2*Math.PI)+this.center.coords.usrCoords[2]},Z:function(n){return 1},minX:function(){return 0},maxX:function(){return 1},Area:function(){var n=this.Radius();return n*n*Math.PI},Perimeter:function(){return 2*this.Radius()*Math.PI},bounds:function(){var n=this.center.coords.usrCoords,t=this.Radius();return[n[1]-t,n[2]+t,n[1]+t,n[2]-t]},getParents:function(){return this.parents.length===1?this.parents.concat(this.radius):this.parents}});JXG$1.createCircle=function(n,t,o){var u,d,C,I,f,A=!0,y=["center","point2"];if(d=[],f=n.select(t[0]),JXG$1.isObject(f)&&f.elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isTransformationOrArray(t[1]))return I=JXG$1.copyAttributes(o,n.options,"circle"),u=JXG$1.createEllipse(n,[f.center,f.center,function(){return 2*f.Radius()}],I),u.addTransform(t[1]),u;for(C=0;C<t.length;C++)if(JXG$1.isPointType(n,t[C])){if(t.length<3?d.push(JXG$1.providePoints(n,[t[C]],o,"circle",[y[C]])[0]):d.push(JXG$1.providePoints(n,[t[C]],o,"point")[0]),d[d.length-1]===!1)throw new Error("JSXGraph: Can't create circle from this type. Please provide a point type.")}else d.push(t[C]);if(I=JXG$1.copyAttributes(o,n.options,"circle"),d.length===2&&JXG$1.isPoint(d[0])&&JXG$1.isPoint(d[1]))u=new JXG$1.Circle(n,"twoPoints",d[0],d[1],I);else if((JXG$1.isNumber(d[0])||JXG$1.isFunction(d[0])||JXG$1.isString(d[0]))&&JXG$1.isPoint(d[1]))u=new JXG$1.Circle(n,"pointRadius",d[1],d[0],I);else if((JXG$1.isNumber(d[1])||JXG$1.isFunction(d[1])||JXG$1.isString(d[1]))&&JXG$1.isPoint(d[0]))u=new JXG$1.Circle(n,"pointRadius",d[0],d[1],I);else if(d[0].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(d[1]))u=new JXG$1.Circle(n,"pointCircle",d[1],d[0],I);else if(d[1].elementClass===Const.OBJECT_CLASS_CIRCLE&&JXG$1.isPoint(d[0]))u=new JXG$1.Circle(n,"pointCircle",d[0],d[1],I);else if(d[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(d[1]))u=new JXG$1.Circle(n,"pointLine",d[1],d[0],I);else if(d[1].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(d[0]))u=new JXG$1.Circle(n,"pointLine",d[0],d[1],I);else if(t.length===3&&JXG$1.isPoint(d[0])&&JXG$1.isPoint(d[1])&&JXG$1.isPoint(d[2]))if(JXG$1.elements.circumcircle)u=JXG$1.elements.circumcircle(n,d,I);else throw new Error("JSXGraph: Can't create circle with three points. Please include the circumcircle element (element/composition).");else throw new Error("JSXGraph: Can't create circle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [point,number], [point,function], [point,circle], [point,point,point], [circle,transformation]`);for(u.isDraggable=A,u.setParents(d),u.elType="circle",C=0;C<d.length;C++)JXG$1.isPoint(d[C])&&u.inherits.push(d[C]);return u};JXG$1.registerElement("circle",JXG$1.createCircle);const Circle=JXG$1.Circle;JXG$1.createEllipse=function(n,t,o){var u,d,C,I,f,A,y,G=[],S=JXG$1.copyAttributes(o,n.options,"conic","foci"),w=JXG$1.copyAttributes(o,n.options,"conic","center"),M=JXG$1.copyAttributes(o,n.options,"conic");for(A=0;A<2;A++)if(t[A].length>1)G[A]=n.create("point",t[A],S);else if(JXG$1.isPoint(t[A]))G[A]=n.select(t[A]);else if(JXG$1.isFunction(t[A])&&JXG$1.isPoint(t[A]()))G[A]=t[A]();else if(JXG$1.isString(t[A]))G[A]=n.select(t[A]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(t[2]))f=JXG$1.createFunction(t[2],n);else if(JXG$1.isFunction(t[2])&&JXG$1.isNumber(t[2]()))f=t[2];else{if(JXG$1.isPoint(t[2]))I=n.select(t[2]);else if(t[2].length>1)I=n.create("point",t[2],S);else if(JXG$1.isFunction(t[2])&&JXG$1.isPoint(t[2]()))I=t[2]();else if(JXG$1.isString(t[2]))I=n.select(t[2]);else throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);f=function(){return I.Dist(G[0])+I.Dist(G[1])}}for(JXG$1.exists(t[4])||(t[4]=2*Math.PI),JXG$1.exists(t[3])||(t[3]=0),C=n.create("point",[function(){return(G[0].X()+G[1].X())*.5},function(){return(G[0].Y()+G[1].Y())*.5}],w),d=n.create("curve",[function(V){return 0},function(V){return 0},t[3],t[4]],M),d.majorAxis=f,y=d.hasPoint,u=function(V,T){var H,J,z,L,K,O,Q,ee,ie;T||(H=f(),J=H*H,z=G[0].X(),L=G[0].Y(),K=G[1].X(),O=G[1].Y(),Q=z-K,ee=L-O,ie=(J-z*z-L*L+K*K+O*O)/(2*H),d.quadraticform=[[ie*ie-K*K-O*O,ie*Q/H+K,ie*ee/H+O],[ie*Q/H+K,Q*Q/J-1,Q*ee/J],[ie*ee/H+O,Q*ee/J,ee*ee/J-1]])},d.X=function(V,T){var H=f(),J=G[1].Dist(G[0]),z=.5*(J*J-H*H)/(J*Math.cos(V)-H),L=Math.atan2(G[1].Y()-G[0].Y(),G[1].X()-G[0].X());return T||u(V,T),G[0].X()+Math.cos(L+V)*z},d.Y=function(V,T){var H=f(),J=G[1].Dist(G[0]),z=.5*(J*J-H*H)/(J*Math.cos(V)-H),L=Math.atan2(G[1].Y()-G[0].Y(),G[1].X()-G[0].X());return G[0].Y()+Math.sin(L+V)*z},d.midpoint=d.center=C,d.type=Const.OBJECT_TYPE_CONIC,d.subs={center:d.center},d.inherits.push(d.center,G[0],G[1]),JXG$1.isPoint(I)&&d.inherits.push(I),d.hasPoint=function(V,T){var H,J,z,L,K;return JXG$1.evaluate(this.visProp.hasinnerpoints)?(H=G[0].coords,J=G[1].coords,z=this.majorAxis(),L=new Coords(Const.COORDS_BY_SCREEN,[V,T],this.board),K=L.distance(Const.COORDS_BY_USER,H)+L.distance(Const.COORDS_BY_USER,J),K<=z):y.apply(this,arguments)},C.addChild(d),A=0;A<2;A++)JXG$1.isPoint(G[A])&&G[A].addChild(d);return JXG$1.isPoint(I)&&I.addChild(d),d.setParents(t),d};JXG$1.createHyperbola=function(n,t,o){var u,d,C,I,f,A,y=[],G=JXG$1.copyAttributes(o,n.options,"conic","foci"),S=JXG$1.copyAttributes(o,n.options,"conic","center"),w=JXG$1.copyAttributes(o,n.options,"conic");for(A=0;A<2;A++)if(t[A].length>1)y[A]=n.create("point",t[A],G);else if(JXG$1.isPoint(t[A]))y[A]=n.select(t[A]);else if(JXG$1.isFunction(t[A])&&JXG$1.isPoint(t[A]()))y[A]=t[A]();else if(JXG$1.isString(t[A]))y[A]=n.select(t[A]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);if(JXG$1.isNumber(t[2]))f=JXG$1.createFunction(t[2],n);else if(JXG$1.isFunction(t[2])&&JXG$1.isNumber(t[2]()))f=t[2];else{if(JXG$1.isPoint(t[2]))I=n.select(t[2]);else if(t[2].length>1)I=n.create("point",t[2],G);else if(JXG$1.isFunction(t[2])&&JXG$1.isPoint(t[2]()))I=t[2]();else if(JXG$1.isString(t[2]))I=n.select(t[2]);else throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [point,point,number|function]`);f=function(){return I.Dist(y[0])-I.Dist(y[1])}}for(JXG$1.exists(t[4])||(t[4]=1.0001*Math.PI),JXG$1.exists(t[3])||(t[3]=-1.0001*Math.PI),C=n.create("point",[function(){return(y[0].X()+y[1].X())*.5},function(){return(y[0].Y()+y[1].Y())*.5}],S),d=n.create("curve",[function(M){return 0},function(M){return 0},t[3],t[4]],w),d.majorAxis=f,u=function(M,V){var T,H,J,z,L,K,O,Q,ee;V||(T=f(),H=T*T,J=y[0].X(),z=y[0].Y(),L=y[1].X(),K=y[1].Y(),O=J-L,Q=z-K,ee=(H-J*J-z*z+L*L+K*K)/(2*T),d.quadraticform=[[ee*ee-L*L-K*K,ee*O/T+L,ee*Q/T+K],[ee*O/T+L,O*O/H-1,O*Q/H],[ee*Q/T+K,O*Q/H,Q*Q/H-1]])},d.X=function(M,V){var T=f(),H=y[1].Dist(y[0]),J=.5*(H*H-T*T)/(H*Math.cos(M)+T),z=Math.atan2(y[1].Y()-y[0].Y(),y[1].X()-y[0].X());return V||u(M,V),y[0].X()+Math.cos(z+M)*J},d.Y=function(M,V){var T=f(),H=y[1].Dist(y[0]),J=.5*(H*H-T*T)/(H*Math.cos(M)+T),z=Math.atan2(y[1].Y()-y[0].Y(),y[1].X()-y[0].X());return y[0].Y()+Math.sin(z+M)*J},d.midpoint=d.center=C,d.subs={center:d.center},d.inherits.push(d.center,y[0],y[1]),JXG$1.isPoint(I)&&d.inherits.push(I),d.type=Const.OBJECT_TYPE_CONIC,C.addChild(d),A=0;A<2;A++)JXG$1.isPoint(y[A])&&y[A].addChild(d);return JXG$1.isPoint(I)&&I.addChild(d),d.setParents(t),d};JXG$1.createParabola=function(n,t,o){var u,d,C,I=t[0],f=t[1],A=JXG$1.copyAttributes(o,n.options,"conic","foci"),y=JXG$1.copyAttributes(o,n.options,"conic","center"),G=JXG$1.copyAttributes(o,n.options,"conic"),S;if(t[0].length>1)I=n.create("point",t[0],A);else if(JXG$1.isPoint(t[0]))I=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))I=t[0]();else if(JXG$1.isString(t[0]))I=n.select(t[0]);else throw new Error("JSXGraph: Can't create Parabola with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return JXG$1.isArray(f)&&f.length===2&&(S=JXG$1.copyAttributes(o,n.options,"conic","line"),f=n.create("line",f,S)),JXG$1.exists(t[3])||(t[3]=2*Math.PI),JXG$1.exists(t[2])||(t[2]=0),C=n.create("point",[function(){return Geometry.projectPointToLine(I,f,n).usrCoords}],y),d=n.create("curve",[function(w){return 0},function(w){return 0},t[2],t[3]],G),d.midpoint=d.center=C,d.subs={center:d.center},d.inherits.push(d.center),u=function(w,M){var V,T,H,J,z,L;M||(V=f.stdform[1],T=f.stdform[2],H=f.stdform[0],J=V*V+T*T,z=I.X(),L=I.Y(),d.quadraticform=[[H*H-J*(z*z+L*L),H*V+J*z,H*T+J*L],[H*V+J*z,-T*T,V*T],[H*T+J*L,V*T,-V*V]])},d.X=function(w,M){var V,T,H=f.getAngle(),J=Geometry.distPointLine(I.coords.usrCoords,f.stdform),z=f.point1.coords.usrCoords,L=f.point2.coords.usrCoords,K=I.coords.usrCoords;return z[0]===0?z=[1,L[1]+f.stdform[2],L[2]-f.stdform[1]]:L[0]===0&&(L=[1,z[1]+f.stdform[2],z[2]-f.stdform[1]]),T=(L[1]-z[1])*(K[2]-z[2])-(L[2]-z[2])*(K[1]-z[1])>=0?1:-1,V=T*J/(1-Math.sin(w)),M||u(w,M),I.X()+Math.cos(w+H)*V},d.Y=function(w,M){var V,T,H=f.getAngle(),J=Geometry.distPointLine(I.coords.usrCoords,f.stdform),z=f.point1.coords.usrCoords,L=f.point2.coords.usrCoords,K=I.coords.usrCoords;return z[0]===0?z=[1,L[1]+f.stdform[2],L[2]-f.stdform[1]]:L[0]===0&&(L=[1,z[1]+f.stdform[2],z[2]-f.stdform[1]]),T=(L[1]-z[1])*(K[2]-z[2])-(L[2]-z[2])*(K[1]-z[1])>=0?1:-1,V=T*J/(1-Math.sin(w)),I.Y()+Math.sin(w+H)*V},d.type=Const.OBJECT_TYPE_CONIC,C.addChild(d),JXG$1.isPoint(I)&&(I.addChild(d),d.inherits.push(I)),f.addChild(d),d.setParents(t),d};JXG$1.createConic=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J=[[1,0,0],[0,1,0],[0,0,1]],z=[[1,0,0],[0,1,0],[0,0,1]],L=[],K=[],O=JXG$1.copyAttributes(o,n.options,"conic","point"),Q=JXG$1.copyAttributes(o,n.options,"conic","center"),ee=JXG$1.copyAttributes(o,n.options,"conic");if(t.length===5)H=!0;else if(t.length===6)H=!1;else throw new Error("JSXGraph: Can't create generic Conic with "+t.length+" parameters.");if(H)for(V=0;V<5;V++)if(t[V].length>1)L[V]=n.create("point",t[V],O);else if(JXG$1.isPoint(t[V]))L[V]=n.select(t[V]);else if(JXG$1.isFunction(t[V])&&JXG$1.isPoint(t[V]()))L[V]=t[V]();else if(JXG$1.isString(t[V]))L[V]=n.select(t[V]);else throw new Error("JSXGraph: Can't create Conic section with parent types '"+typeof t[V]+`'.
Possible parent types: [point,point,point,point,point], [a00,a11,a22,a01,a02,a12]`);else T=[[0,0,0],[0,0,0],[0,0,0]],T[0][0]=JXG$1.isFunction(t[2])?function(){return t[2]()}:function(){return t[2]},T[0][1]=JXG$1.isFunction(t[4])?function(){return t[4]()}:function(){return t[4]},T[0][2]=JXG$1.isFunction(t[5])?function(){return t[5]()}:function(){return t[5]},T[1][1]=JXG$1.isFunction(t[0])?function(){return t[0]()}:function(){return t[0]},T[1][2]=JXG$1.isFunction(t[3])?function(){return t[3]()}:function(){return t[3]},T[2][2]=JXG$1.isFunction(t[1])?function(){return t[1]()}:function(){return t[1]};if(f=function(ie){var te,se;for(te=0;te<3;te++)for(se=te;se<3;se++)ie[te][se]+=ie[se][te];for(te=0;te<3;te++)for(se=0;se<te;se++)ie[te][se]=ie[se][te];return ie},I=function(ie,te){var se,ae,le=[[0,0,0],[0,0,0],[0,0,0]];for(se=0;se<3;se++)for(ae=0;ae<3;ae++)le[se][ae]=ie[se]*te[ae];return f(le)},C=function(ie,te,se){var ae,le,ge,be,Xe,Ce=[[0,0,0],[0,0,0],[0,0,0]];for(Xe=Mat.matVecMult(te,se),ge=Mat.innerProduct(se,Xe),Xe=Mat.matVecMult(ie,se),be=Mat.innerProduct(se,Xe),ae=0;ae<3;ae++)for(le=0;le<3;le++)Ce[ae][le]=ge*ie[ae][le]-be*te[ae][le];return Ce},d=n.create("curve",[function(ie){return 0},function(ie){return 0},0,2*Math.PI],ee),u=function(ie,te){var se,ae,le;if(!te){if(H){for(se=0;se<5;se++)K[se]=L[se].coords.usrCoords;w=I(Mat.crossProduct(K[0],K[1]),Mat.crossProduct(K[2],K[3])),M=I(Mat.crossProduct(K[0],K[2]),Mat.crossProduct(K[1],K[3])),z=C(w,M,K[4])}else for(se=0;se<3;se++)for(ae=se;ae<3;ae++)z[se][ae]=T[se][ae](),ae>se&&(z[ae][se]=z[se][ae]);d.quadraticform=z,A=Numerics.Jacobi(z),A[0][0][0]<0&&(A[0][0][0]*=-1,A[0][1][1]*=-1,A[0][2][2]*=-1),J=A[1],S=Math.sqrt(Math.abs(A[0][0][0])),y=Math.sqrt(Math.abs(A[0][1][1])),G=Math.sqrt(Math.abs(A[0][2][2]))}return A[0][1][1]<=0&&A[0][2][2]<=0?le=Mat.matVecMult(J,[1/S,Math.cos(ie)/y,Math.sin(ie)/G]):A[0][1][1]<=0&&A[0][2][2]>0?le=Mat.matVecMult(J,[Math.cos(ie)/S,1/y,Math.sin(ie)/G]):A[0][2][2]<0&&(le=Mat.matVecMult(J,[Math.sin(ie)/S,Math.cos(ie)/y,1/G])),JXG$1.exists(le)?(le[1]/=le[0],le[2]/=le[0],le[0]=1):le=[1,NaN,NaN],le},d.X=function(ie,te){return u(ie,te)[1]},d.Y=function(ie,te){return u(ie,te)[2]},d.midpoint=n.create("point",[function(){var ie=d.quadraticform;return[ie[1][1]*ie[2][2]-ie[1][2]*ie[1][2],ie[1][2]*ie[0][2]-ie[2][2]*ie[0][1],ie[0][1]*ie[1][2]-ie[1][1]*ie[0][2]]}],Q),d.type=Const.OBJECT_TYPE_CONIC,d.center=d.midpoint,d.subs={center:d.center},d.inherits.push(d.center),d.inherits=d.inherits.concat(L),H){for(V=0;V<5;V++)JXG$1.isPoint(L[V])&&L[V].addChild(d);d.setParents(t)}return d.addChild(d.center),d};JXG$1.registerElement("ellipse",JXG$1.createEllipse);JXG$1.registerElement("hyperbola",JXG$1.createHyperbola);JXG$1.registerElement("parabola",JXG$1.createParabola);JXG$1.registerElement("conic",JXG$1.createConic);JXG$1.Polygon=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_POLYGON,Const.OBJECT_CLASS_AREA);var u,d,C,I,f,A=JXG$1.copyAttributes(o,n.options,"polygon","borders");for(this.withLines=o.withlines,this.attr_line=A,this.vertices=[],u=0;u<t.length;u++)this.vertices[u]=this.board.select(t[u]),this.vertices[u]._is_new&&(delete this.vertices[u]._is_new,this.vertices[u]._is_new_pol=!0);if(this.vertices.length>0&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.borders=[],this.withLines)for(C=this.vertices.length-1,I=0;I<C;I++)u=(I+1)%C,A.id=A.ids&&A.ids[u],A.name=A.names&&A.names[u],A.strokecolor=JXG$1.isArray(A.colors)&&A.colors[u%A.colors.length]||A.strokecolor,A.visible=JXG$1.exists(o.borders.visible)?o.borders.visible:o.visible,A.strokecolor===!1&&(A.strokecolor="none"),d=n.create("segment",[this.vertices[u],this.vertices[u+1]],A),d.dump=!1,this.borders[u]=d,d.parentPolygon=this,this.addChild(d);for(this.inherits.push(this.vertices,this.borders),this.id=this.board.setId(this,"Py"),u=0;u<this.vertices.length-1;u++)f=this.board.select(this.vertices[u]),JXG$1.exists(f._is_new_pol)?(this.addChild(f),delete f._is_new_pol):f.addChild(this);this.board.renderer.drawPolygon(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="polygon",this.createLabel(),this.methodMap=JXG$1.deepCopy(this.methodMap,{borders:"borders",vertices:"vertices",A:"Area",Area:"Area",Perimeter:"Perimeter",L:"Perimeter",boundingBox:"bounds",BoundingBox:"bounds",addPoints:"addPoints",insertPoints:"insertPoints",removePoints:"removePoints",Intersect:"intersect"})};JXG$1.Polygon.prototype=new GeometryElement;JXG$1.extend(JXG$1.Polygon.prototype,{pnpoly:function(n,t,o){return Geometry.pnpoly(n,t,this.vertices,o)},hasPoint:function(n,t){var o,u;if(JXG$1.evaluate(this.visProp.hasinnerpoints)&&this.pnpoly(n,t))return!0;for(u=this.borders.length,o=0;o<u;o++)if(this.borders[o].hasPoint(n,t))return!0;return!1},updateRenderer:function(){var n,t;if(!this.needsUpdate)return this;if(this.visPropCalc.visible){for(t=this.vertices.length-(this.elType==="polygonalchain"?0:1),this.isReal=!0,n=0;n<t;++n)if(!this.vertices[n].isReal){this.isReal=!1;break}if(!this.isReal){this.updateVisibility(!1);for(n in this.childElements)this.childElements.hasOwnProperty(n)&&this.childElements[n].setDisplayRendNode(!1)}}return this.visPropCalc.visible&&this.board.renderer.updatePolygon(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this},getTextAnchor:function(){var n,t,o,u,d;if(this.vertices.length===0)return new Coords(Const.COORDS_BY_USER,[1,0,0],this.board);for(n=this.vertices[0].X(),t=this.vertices[0].Y(),o=n,u=t,d=0;d<this.vertices.length;d++)this.vertices[d].X()<n&&(n=this.vertices[d].X()),this.vertices[d].X()>o&&(o=this.vertices[d].X()),this.vertices[d].Y()>t&&(t=this.vertices[d].Y()),this.vertices[d].Y()<u&&(u=this.vertices[d].Y());return new Coords(Const.COORDS_BY_USER,[(n+o)*.5,(t+u)*.5],this.board)},getLabelAnchor:JXG$1.shortcut(JXG$1.Polygon.prototype,"getTextAnchor"),cloneToBackground:function(){var n={},t;return n.id=this.id+"T"+this.numTraces,this.numTraces++,n.vertices=this.vertices,n.visProp=JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0),n.visProp.layer=this.board.options.layer.trace,n.board=this.board,JXG$1.clearVisPropOld(n),n.visPropCalc={visible:JXG$1.evaluate(n.visProp.visible)},t=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawPolygon(n),this.board.renderer.enhancedRendering=t,this.traces[n.id]=n.rendNode,this},hideElement:function(n){var t;if(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),!n)for(t=0;t<this.borders.length;t++)this.borders[t].hideElement();this.hasLabel&&JXG$1.exists(this.label)&&(this.label.hiddenByParent=!0,this.label.visPropCalc.visible&&this.label.hideElement())},showElement:function(n){var t;if(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!0),!n)for(t=0;t<this.borders.length;t++)this.borders[t].showElement().updateRenderer();return JXG$1.exists(this.label)&&this.hasLabel&&this.label.hiddenByParent&&(this.label.hiddenByParent=!1,this.label.visPropCalc.visible||this.label.showElement().updateRenderer()),this},Area:function(){return Math.abs(Geometry.signedPolygon(this.vertices,!0))},Perimeter:function(){var n,t=this.vertices.length,o=0;for(n=1;n<t;++n)o+=this.vertices[n].Dist(this.vertices[n-1]);return o},L:function(){return this.Perimeter()},boundingBox:function(){var n=[0,0,0,0],t,o,u=this.vertices.length-1;if(u===0)return n;for(n[0]=this.vertices[0].X(),n[2]=n[0],n[1]=this.vertices[0].Y(),n[3]=n[1],t=1;t<u;++t)o=this.vertices[t].X(),o<n[0]?n[0]=o:o>n[2]&&(n[2]=o),o=this.vertices[t].Y(),o>n[1]?n[1]=o:o<n[3]&&(n[3]=o);return n},bounds:function(){return this.boundingBox()},remove:function(){var n;for(n=0;n<this.borders.length;n++)this.board.removeObject(this.borders[n]);GeometryElement.prototype.remove.call(this)},findPoint:function(n){var t;if(!JXG$1.isPoint(n))return-1;for(t=0;t<this.vertices.length;t++)if(this.vertices[t].id===n.id)return t;return-1},addPoints:function(n){var t,o=Array.prototype.slice.call(arguments);return this.elType==="polygonalchain"?t=this.vertices.length-1:t=this.vertices.length-2,this.insertPoints.apply(this,[t].concat(o))},insertPoints:function(n,t){var o,u,d,C,I;if(arguments.length===0)return this;if(d=this.vertices.length-1,this.elType==="polygon"&&d--,n<-1||n>d)return this;for(u=arguments.length-1,o=1;o<u+1;o++)I=JXG$1.providePoints(this.board,[arguments[o]],{},"polygon",["vertices"])[0],I._is_new&&(this.addChild(I),delete I._is_new),this.vertices.splice(n+o,0,I);if(this.withLines)for(C=n+1,this.elType==="polygon"?n<0?(this.vertices[this.vertices.length-1]=this.vertices[0],this.borders[this.borders.length-1].point2=this.vertices[this.vertices.length-1]):this.borders[n].point2=this.vertices[C]:n>=0&&(n<this.borders.length?this.borders[n].point2=this.vertices[C]:C=n),o=C;o<C+u;o++)this.borders.splice(o,0,this.board.create("segment",[this.vertices[o],this.vertices[o+1]],this.attr_line));return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},removePoints:function(n){var t,o,u,d,C=[],I=[],f=[],A=[];for(this.elType==="polygon"&&(d=this.vertices.pop()),t=0;t<arguments.length;t++)u=arguments[t],JXG$1.isPoint(u)&&(u=this.findPoint(u)),JXG$1.isNumber(u)&&u>-1&&u<this.vertices.length&&JXG$1.indexOf(f,u)===-1&&f.push(u);if(f.length===0)return this.elType==="polygon"&&this.vertices.push(d),this;for(t=0;t<f.length;t++)this.vertices[f[t]].removeChild(this);for(f=f.sort(),C=this.vertices.slice(),I=this.borders.slice(),this.withLines&&A.push([f[f.length-1]]),t=f.length-1;t>-1;t--)C[f[t]]=-1,this.withLines&&f.length>1&&f[t]-1>f[t-1]&&(A[A.length-1][1]=f[t],A.push([f[t-1]]));for(this.withLines&&(A[A.length-1][1]=f[0]),this.vertices=[],t=0;t<C.length;t++)JXG$1.isPoint(C[t])&&this.vertices.push(C[t]);if(this.elType==="polygon"&&this.vertices.length>1&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.withLines){for(t=0;t<A.length;t++){for(o=A[t][1]-1;o<A[t][0]+1;o++)o<0?this.elType==="polygon"&&(this.board.removeObject(this.borders[I.length-1]),I[I.length-1]=-1):o<I.length&&(this.board.removeObject(this.borders[o]),I[o]=-1);A[t][1]!==0&&A[t][0]!==C.length-1&&(I[A[t][0]-1]=this.board.create("segment",[C[A[t][1]-1],C[A[t][0]+1]],this.attr_line))}for(this.borders=[],t=0;t<I.length;t++)I[t]!==-1&&this.borders.push(I[t]);this.elType==="polygon"&&this.vertices.length>2&&(A[0][1]===this.vertices.length-1||A[A.length-1][1]===0)&&this.borders.push(this.board.create("segment",[this.vertices[this.vertices.length-2],this.vertices[0]],this.attr_line))}return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},getParents:function(){return this.setParents(this.vertices),this.parents},getAttributes:function(){var n=GeometryElement.prototype.getAttributes.call(this),t;if(this.withLines)for(n.lines=n.lines||{},n.lines.ids=[],n.lines.colors=[],t=0;t<this.borders.length;t++)n.lines.ids.push(this.borders[t].id),n.lines.colors.push(this.borders[t].visProp.strokecolor);return n},snapToGrid:function(){var n,t;for(JXG$1.evaluate(this.visProp.snaptogrid)?t=!0:t=!1,n=0;n<this.vertices.length;n++)this.vertices[n].handleSnapToGrid(t,!0)},setPositionDirectly:function(n,t,o){var u,d,C,I,f=new Coords(n,t,this.board),A=new Coords(n,o,this.board);for(I=this.vertices.length-1,C=0;C<I;C++)if(!this.vertices[C].draggable())return this;return u=Statistics.subtract(f.usrCoords,A.usrCoords),d=this.board.create("transform",u.slice(1),{type:"translate"}),d.applyOnce(this.vertices.slice(0,-1)),this},sutherlandHodgman:function(n){var t=JXG$1.Math.Geometry.sortVertices(this.vertices),o=JXG$1.Math.Geometry.sortVertices(n.vertices),u=t.length-1,d=o.length-1,C,I=[],f,A,y,G,S,w,M=function(V,T,H){return(T[1]-V[1])*(H[2]-V[2])-(T[2]-V[2])*(H[1]-V[1])>=0};for(A=0;A<d;A++)I.push(o[A]);for(A=0;A<u;A++)for(f=I.slice(0),C=f.length,I=[],G=f[C-1],y=0;y<C;y++)S=f[y],M(t[A],t[A+1],S)?(M(t[A],t[A+1],G)||(w=JXG$1.Math.Geometry.meetSegmentSegment(G,S,t[A],t[A+1]),w[0][1]/=w[0][0],w[0][2]/=w[0][0],w[0][0]=1,I.push(w[0])),I.push(S)):M(t[A],t[A+1],G)&&(w=JXG$1.Math.Geometry.meetSegmentSegment(G,S,t[A],t[A+1]),w[0][1]/=w[0][0],w[0][2]/=w[0][0],w[0][0]=1,I.push(w[0])),G=S;return I},intersect:function(n){return this.sutherlandHodgman(n)}});JXG$1.createPolygon=function(n,t,o){var u,d,C,I,f=[],A,y,G=!1;if(A=JXG$1.copyAttributes(o,n.options,"polygon"),I=n.select(t[0]),I===null&&(I=t[0]),JXG$1.isObject(I)&&I.type===Const.OBJECT_TYPE_POLYGON&&JXG$1.isTransformationOrArray(t[1]))for(G=!0,C=I.vertices.length-1,y=JXG$1.copyAttributes(o,n.options,"polygon","vertices"),d=0;d<C;d++)y.withlabel&&(y.name=I.vertices[d].name===""?"":I.vertices[d].name+"'"),f.push(n.create("point",[I.vertices[d],t[1]],y));else if(f=JXG$1.providePoints(n,t,o,"polygon",["vertices"]),f===!1)throw new Error("JSXGraph: Can't create polygon / polygonalchain with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon and a transformation can be supplied");if(A=JXG$1.copyAttributes(o,n.options,"polygon"),u=new JXG$1.Polygon(n,f,A),u.isDraggable=!0,G)for(u.prepareUpdate().update().updateVisibility().updateRenderer(),C=I.vertices.length-1,d=0;d<C;d++)f[d].prepareUpdate().update().updateVisibility().updateRenderer();return u};JXG$1.createRegularPolygon=function(n,t,o){var u,d,C,I=[],f,A,y,G;if(A=t.length,C=t[A-1],JXG$1.isNumber(C)&&(t.length!==3||C<3))throw new Error("JSXGraph: A regular polygon needs two point types and a number > 2 as input.");if(JXG$1.isNumber(n.select(C))?(A--,y=!1):(C=A,y=!0),I=JXG$1.providePoints(n,t.slice(0,A),o,"regularpolygon",["vertices"]),I===!1)throw new Error("JSXGraph: Can't create regular polygon with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates");for(G=JXG$1.copyAttributes(o,n.options,"regularpolygon","vertices"),d=2;d<C;d++)f=n.create("transform",[Math.PI*(2-(C-2)/C),I[d-1]],{type:"rotate"}),y?(I[d].addTransform(I[d-2],f),I[d].fullUpdate()):(JXG$1.isArray(G.ids)&&G.ids.length>=C-2&&(G.id=G.ids[d-2]),I[d]=n.create("point",[I[d-2],f],G),I[d].type=Const.OBJECT_TYPE_CAS,I[d].isDraggable=!0,I[d].visProp.fixed=!1);return G=JXG$1.copyAttributes(o,n.options,"regularpolygon"),u=n.create("polygon",I,G),u.elType="regularpolygon",u};JXG$1.createPolygonalChain=function(n,t,o){var u,d;return u=JXG$1.copyAttributes(o,n.options,"polygonalchain"),d=n.create("polygon",t,u),d.elType="polygonalchain",d.vertices.pop(),n.removeObject(d.borders[d.borders.length-1]),d.borders.pop(),d};JXG$1.createParallelogram=function(n,t,o){var u,d,C=[],I,f;if(C=JXG$1.providePoints(n,t,o,"polygon",["vertices"]),C===!1||C.length<3)throw new Error("JSXGraph: Can't create parallelogram with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates.");return f=JXG$1.copyAttributes(o,n.options,"parallelogram","parallelpoint"),d=n.create("parallelpoint",C,f),I=JXG$1.copyAttributes(o,n.options,"parallelogram"),u=n.create("polygon",[C[0],C[1],d,C[2]],I),u.elType="parallelogram",u.parallelPoint=d,u.isDraggable=!0,d.isDraggable=!0,d.visProp.fixed=!1,u};JXG$1.registerElement("polygon",JXG$1.createPolygon);JXG$1.registerElement("regularpolygon",JXG$1.createRegularPolygon);JXG$1.registerElement("polygonalchain",JXG$1.createPolygonalChain);JXG$1.registerElement("parallelogram",JXG$1.createParallelogram);const Polygon=JXG$1.Polygon;JXG$1.Curve=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_CURVE,Const.OBJECT_CLASS_CURVE),this.points=[],this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh),this.bezierDegree=1,this.dataX=null,this.dataY=null,this.ticks=[],this.qdt=null,JXG$1.exists(t[0])?this.varname=t[0]:this.varname="x",this.xterm=t[1],this.yterm=t[2],this.generateTerm(this.varname,this.xterm,this.yterm,t[3],t[4]),this.updateCurve(),this.id=this.board.setId(this,"G"),this.board.renderer.drawCurve(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="curve",this.createLabel(),JXG$1.isString(this.xterm)&&this.notifyParents(this.xterm),JXG$1.isString(this.yterm)&&this.notifyParents(this.yterm),this.methodMap=JXG$1.deepCopy(this.methodMap,{generateTerm:"generateTerm",setTerm:"generateTerm",move:"moveTo",moveTo:"moveTo",MinX:"minX",MaxX:"maxX"})};JXG$1.Curve.prototype=new GeometryElement;JXG$1.extend(JXG$1.Curve.prototype,{minX:function(){var n;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?0:(n=new Coords(Const.COORDS_BY_SCREEN,[-this.board.canvasWidth*.1,0],this.board,!1),n.usrCoords[1])},maxX:function(){var n;return JXG$1.evaluate(this.visProp.curvetype)==="polar"?2*Math.PI:(n=new Coords(Const.COORDS_BY_SCREEN,[this.board.canvasWidth*1.1,0],this.board,!1),n.usrCoords[1])},X:function(n){return NaN},Y:function(n){return NaN},Z:function(n){return 1},hasPoint:function(n,t,o){var u,d,C,I,f,A,y,G,S,w=[],M,V,T=JXG$1.evaluate(this.visProp.numberpointslow),H=(this.maxX()-this.minX())/T,J,z,L=1/0,K,O,Q,ee,ie,te=!0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(z=this.board._inputDevice,J=JXG$1.evaluate(this.visProp.precision[z])):J=this.board.options.precision.hasPoint,A=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board,!1),n=A.usrCoords[1],t=A.usrCoords[2],this.bezierDegree===1&&JXG$1.evaluate(this.visProp.hasinnerpoints)&&(S=Geometry.windingNumber([1,n,t],this.points,!0),S!==0))return!0;if(J+=JXG$1.evaluate(this.visProp.strokewidth)*.5,J*=J,K=this.board.unitX*this.board.unitX,O=this.board.unitY*this.board.unitY,ee=this.minX(),ie=this.maxX(),JXG$1.exists(this._visibleArea)&&(ee=this._visibleArea[0],ie=this._visibleArea[1],H=(ie-ee)/T),Q=JXG$1.evaluate(this.visProp.curvetype),Q==="parameter"||Q==="polar")for(this.transformations.length>0&&(this.updateTransformMatrix(),G=Mat.inverse(this.transformMat),d=Mat.matVecMult(G,[1,n,t]),n=d[1],t=d[2]),C=0,u=ee;C<T;C++){if(I=this.X(u,te),f=this.Y(u,te),L=(n-I)*(n-I)*K+(t-f)*(t-f)*O,L<=J)return!0;u+=H}else if(Q==="plot"||Q==="functiongraph"){for((!JXG$1.exists(o)||o<0)&&(o=0),JXG$1.exists(this.qdt)&&JXG$1.evaluate(this.visProp.useqdt)&&this.bezierDegree!==3?(V=this.qdt.query(new Coords(Const.COORDS_BY_USER,[n,t],this.board)),M=V.points,y=M.length):(M=this.points,y=this.numberPoints-1),C=o;C<y;C++)if(this.bezierDegree===3?w=Geometry.projectCoordsToBeziersegment([1,n,t],this,C):V?(M[C].prev&&(w=Geometry.projectCoordsToSegment([1,n,t],M[C].prev.usrCoords,M[C].usrCoords)),M[C].next&&M[C+1]!==M[C].next&&(w=Geometry.projectCoordsToSegment([1,n,t],M[C].usrCoords,M[C].next.usrCoords))):w=Geometry.projectCoordsToSegment([1,n,t],M[C].usrCoords,M[C+1].usrCoords),w[1]>=0&&w[1]<=1&&(n-w[0][1])*(n-w[0][1])*K+(t-w[0][2])*(t-w[0][2])*O<=J)return!0;return!1}return L<J},allocatePoints:function(){var n,t;if(t=this.numberPoints,this.points.length<this.numberPoints)for(n=this.points.length;n<t;n++)this.points[n]=new Coords(Const.COORDS_BY_USER,[0,0],this.board,!1)},update:function(){return this.needsUpdate&&(JXG$1.evaluate(this.visProp.trace)&&this.cloneToBackground(!0),this.updateCurve()),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=Plot.checkReal(this.points),this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateCurve(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateDataArray:function(){},updateCurve:function(){var n,t,o,u,d,C,I=this.visProp.plotversion,f=!1;if(this.updateTransformMatrix(),this.updateDataArray(),o=this.minX(),u=this.maxX(),JXG$1.exists(this.dataX))for(this.numberPoints=this.dataX.length,t=this.numberPoints,this.allocatePoints(),n=0;n<t;n++)d=n,JXG$1.exists(this.dataY)?(C=n,this.points[n].setCoordinates(Const.COORDS_BY_USER,[this.dataX[n],this.dataY[n]],!1)):(C=this.X(d),this.points[n].setCoordinates(Const.COORDS_BY_USER,[this.dataX[n],this.Y(C,f)],!1)),this.points[n]._t=n,f=!0;else if(JXG$1.evaluate(this.visProp.doadvancedplot)?I===1||JXG$1.evaluate(this.visProp.doadvancedplotold)?Plot.updateParametricCurveOld(this,o,u):I===2?Plot.updateParametricCurve_v2(this,o,u):I===3?Plot.updateParametricCurve_v3(this,o,u):I===4?Plot.updateParametricCurve_v4(this,o,u):Plot.updateParametricCurve_v2(this,o,u):(this.board.updateQuality===this.board.BOARD_QUALITY_HIGH?this.numberPoints=JXG$1.evaluate(this.visProp.numberpointshigh):this.numberPoints=JXG$1.evaluate(this.visProp.numberpointslow),this.allocatePoints(),Plot.updateParametricCurveNaive(this,o,u,this.numberPoints)),t=this.numberPoints,JXG$1.evaluate(this.visProp.useqdt)&&this.board.updateQuality===this.board.BOARD_QUALITY_HIGH)for(this.qdt=new QDT(this.board.getBoundingBox()),n=0;n<this.points.length;n++)this.qdt.insert(this.points[n]),n>0&&(this.points[n].prev=this.points[n-1]),n<t-1&&(this.points[n].next=this.points[n+1]);for(JXG$1.evaluate(this.visProp.curvetype)!=="plot"&&JXG$1.evaluate(this.visProp.rdpsmoothing)&&(this.points=Numerics.RamerDouglasPeucker(this.points,.2),this.numberPoints=this.points.length),t=this.numberPoints,n=0;n<t;n++)this.updateTransform(this.points[n]);return this},updateTransformMatrix:function(){var n,t,o=this.transformations.length;for(this.transformMat=[[1,0,0],[0,1,0],[0,0,1]],t=0;t<o;t++)n=this.transformations[t],n.update(),this.transformMat=Mat.matMatMult(n.matrix,this.transformMat);return this},updateTransform:function(n){var t,o=this.transformations.length;return o>0&&(t=Mat.matVecMult(this.transformMat,n.usrCoords),n.setCoordinates(Const.COORDS_BY_USER,t,!1,!0)),n},addTransform:function(n){var t,o=JXG$1.isArray(n)?n:[n],u=o.length;for(t=0;t<u;t++)this.transformations.push(o[t]);return this},interpolationFunctionFromArray:function(n){var t="data"+n,o=this;return function(u,d){var C,I,f,A,y=o[t],G=y.length,S,w=[];if(isNaN(u))return NaN;if(u<0)return JXG$1.isFunction(y[0])?y[0]():y[0];if(o.bezierDegree===3){if(S=(G-1)/3,u>=S)return JXG$1.isFunction(y[y.length-1])?y[y.length-1]():y[y.length-1];for(C=Math.floor(u)*3,f=u%1,A=1-f,I=0;I<4;I++)JXG$1.isFunction(y[C+I])?w[I]=y[C+I]():w[I]=y[C+I];return A*A*(A*w[0]+3*f*w[1])+(3*A*w[2]+f*w[3])*f*f}if(u>G-2?C=G-2:C=parseInt(Math.floor(u),10),C===u)return JXG$1.isFunction(y[C])?y[C]():y[C];for(I=0;I<2;I++)JXG$1.isFunction(y[C+I])?w[I]=y[C+I]():w[I]=y[C+I];return w[0]+(w[1]-w[0])*(u-C)}},generateTerm:function(n,t,o,u,d){var C,I;JXG$1.isArray(t)?(this.dataX=t,this.numberPoints=this.dataX.length,this.X=this.interpolationFunctionFromArray.apply(this,["X"]),this.visProp.curvetype="plot",this.isDraggable=!0):(this.X=JXG$1.createFunction(t,this.board,n),JXG$1.isString(t)?this.visProp.curvetype="functiongraph":(JXG$1.isFunction(t)||JXG$1.isNumber(t))&&(this.visProp.curvetype="parameter"),this.isDraggable=!0),JXG$1.isArray(o)?(this.dataY=o,this.Y=this.interpolationFunctionFromArray.apply(this,["Y"])):this.Y=JXG$1.createFunction(o,this.board,n),JXG$1.isFunction(t)&&JXG$1.isArray(o)&&(C=JXG$1.createFunction(o[0],this.board,""),I=JXG$1.createFunction(o[1],this.board,""),this.X=function(f){return t(f)*Math.cos(f)+C()},this.X.deps=C.deps,this.Y=function(f){return t(f)*Math.sin(f)+I()},this.Y.deps=I.deps,this.visProp.curvetype="polar"),JXG$1.exists(u)?this.minX=JXG$1.createFunction(u,this.board,""):delete this.minX,JXG$1.exists(d)?this.maxX=JXG$1.createFunction(d,this.board,""):delete this.maxX,this.addParentsFromJCFunctions([this.X,this.Y,this.minX,this.maxX])},notifyParents:function(n){var t,o,u=!1,d;d={xterm:1,yterm:1};for(t in d)if(d.hasOwnProperty(t)&&this.hasOwnProperty(t)&&this[t].origin){u=!0;for(o in this[t].origin.deps)this[t].origin.deps.hasOwnProperty(o)&&this[t].origin.deps[o].addChild(this)}u||GeonextParser.findDependencies(this,n,this.board)},getLabelAnchor:function(){var n,t,o,u,d,C,I,f,A,y,G=1.5,S,w=.05*this.board.canvasWidth,M=.05*this.board.canvasHeight,V=.95*this.board.canvasWidth,T=.95*this.board.canvasHeight;if(!JXG$1.exists(this.label))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o=JXG$1.evaluate(this.label.visProp.position),!JXG$1.isString(o))return new Coords(Const.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(o.indexOf("right")<0&&o.indexOf("left")<0)switch(JXG$1.evaluate(this.visProp.label.position)){case"ulft":n=w,t=M;break;case"llft":n=w,t=T;break;case"rt":n=V,t=.5*T;break;case"lrt":n=V,t=T;break;case"urt":n=V,t=M;break;case"top":n=.5*V,t=M;break;case"bot":n=.5*V,t=T;break;default:n=w,t=.5*T}else return u=JXG$1.parsePosition(o),d=JXG$1.parseNumber(u.pos,this.maxX()-this.minX(),1),u.pos.indexOf("fr")<0&&u.pos.indexOf("%")<0&&(d=0),I=this.minX()+d,n=this.X(I),t=this.Y(I),S=new Coords(Const.COORDS_BY_USER,[n,t],this.board).scrCoords,C=Mat.eps,I<this.minX()+C?(f=(this.X(I+C)-this.X(I))/C,A=(this.Y(I+C)-this.Y(I))/C):I>this.maxX()-C?(f=(this.X(I)-this.X(I-C))/C,A=(this.Y(I)-this.Y(I-C))/C):(f=.5*(this.X(I+C)-this.X(I-C))/C,A=.5*(this.Y(I+C)-this.Y(I-C))/C),y=Mat.hypot(f,A),u.side==="left"?A*=-1:f*=-1,JXG$1.exists(this.label)&&(G=.5*JXG$1.evaluate(this.label.visProp.distance)/y),n=S[1]+A*this.label.size[0]*G,t=S[2]-f*this.label.size[1]*G,new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board);return S=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board,!1),Geometry.projectCoordsToCurve(S.usrCoords[1],S.usrCoords[2],0,this,this.board)[0]},cloneToBackground:function(){var n,t={id:this.id+"T"+this.numTraces,elementClass:Const.OBJECT_CLASS_CURVE,points:this.points.slice(0),bezierDegree:this.bezierDegree,numberPoints:this.numberPoints,board:this.board,visProp:JXG$1.deepCopy(this.visProp,this.visProp.traceattributes,!0)};return t.visProp.layer=this.board.options.layer.trace,t.visProp.curvetype=this.visProp.curvetype,this.numTraces++,JXG$1.clearVisPropOld(t),t.visPropCalc={visible:JXG$1.evaluate(t.visProp.visible)},n=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawCurve(t),this.board.renderer.enhancedRendering=n,this.traces[t.id]=t.rendNode,this},bounds:function(){var n=1/0,t=-1/0,o=1/0,u=-1/0,d=this.points.length,C,I,f;if(this.bezierDegree===3){for(C=0;C<d;C++)this.points[C].X=JXG$1.bind(function(){return this.usrCoords[1]},this.points[C]),this.points[C].Y=JXG$1.bind(function(){return this.usrCoords[2]},this.points[C]);return I=Numerics.bezier(this.points),f=I[3](),n=Numerics.fminbr(function(A){return I[0](A)},[0,f]),t=Numerics.fminbr(function(A){return-I[0](A)},[0,f]),o=Numerics.fminbr(function(A){return I[1](A)},[0,f]),u=Numerics.fminbr(function(A){return-I[1](A)},[0,f]),n=I[0](n),t=I[0](t),o=I[1](o),u=I[1](u),[n,u,t,o]}for(C=0;C<d;C++)n>this.points[C].usrCoords[1]&&(n=this.points[C].usrCoords[1]),t<this.points[C].usrCoords[1]&&(t=this.points[C].usrCoords[1]),o>this.points[C].usrCoords[2]&&(o=this.points[C].usrCoords[2]),u<this.points[C].usrCoords[2]&&(u=this.points[C].usrCoords[2]);return[n,u,t,o]},getParents:function(){var n=[this.xterm,this.yterm,this.minX(),this.maxX()];return this.parents.length!==0&&(n=this.parents),n},moveTo:function(n){var t=[],o;return this.points.length>0&&!JXG$1.evaluate(this.visProp.fixed)?(o=this.points[0],n.length===3?t=[n[0]-o.usrCoords[0],n[1]-o.usrCoords[1],n[2]-o.usrCoords[2]]:t=[n[0]-o.usrCoords[1],n[1]-o.usrCoords[2]],this.setPosition(Const.COORDS_BY_USER,t),this.board.update(this)):this},getTransformationSource:function(){var n,t;return JXG$1.exists(this._transformationSource)&&(t=this._transformationSource,t.elementClass===Const.OBJECT_CLASS_CURVE&&(n=!0)),[n,t]}});JXG$1.createCurve=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"curve");return u=n.select(t[0],!0),JXG$1.isTransformationOrArray(t[1])&&JXG$1.isObject(u)&&(u.type===Const.OBJECT_TYPE_CURVE||u.type===Const.OBJECT_TYPE_ANGLE||u.type===Const.OBJECT_TYPE_ARC||u.type===Const.OBJECT_TYPE_CONIC||u.type===Const.OBJECT_TYPE_SECTOR)?(u.type===Const.OBJECT_TYPE_SECTOR?C=JXG$1.copyAttributes(o,n.options,"sector"):u.type===Const.OBJECT_TYPE_ARC?C=JXG$1.copyAttributes(o,n.options,"arc"):u.type===Const.OBJECT_TYPE_ANGLE?(JXG$1.exists(o.withLabel)||(o.withLabel=!1),C=JXG$1.copyAttributes(o,n.options,"angle")):C=JXG$1.copyAttributes(o,n.options,"curve"),C=JXG$1.copyAttributes(C,n.options,"curve"),d=new JXG$1.Curve(n,["x",[],[]],C),d.updateDataArray=function(){var I,f=u.numberPoints;for(this.bezierDegree=u.bezierDegree,this.dataX=[],this.dataY=[],I=0;I<f;I++)this.dataX.push(u.points[I].usrCoords[1]),this.dataY.push(u.points[I].usrCoords[2]);return this},d.addTransform(t[1]),u.addChild(d),d.setParents([u]),d._transformationSource=u,d):(C=JXG$1.copyAttributes(o,n.options,"curve"),new JXG$1.Curve(n,["x"].concat(t),C))};JXG$1.registerElement("curve",JXG$1.createCurve);JXG$1.createFunctiongraph=function(n,t,o){var u,d=["x","x"].concat(t);return u=JXG$1.copyAttributes(o,n.options,"functiongraph"),u=JXG$1.copyAttributes(u,n.options,"curve"),u.curvetype="functiongraph",new JXG$1.Curve(n,d,u)};JXG$1.registerElement("functiongraph",JXG$1.createFunctiongraph);JXG$1.registerElement("plot",JXG$1.createFunctiongraph);JXG$1.createSpline=function(n,t,o){var u,d,C;return d=function(){var I,f=[],A=[];return[function(y,G){var S,w,M;if(!G){if(f=[],A=[],t.length===2&&JXG$1.isArray(t[0])&&JXG$1.isArray(t[1])&&t[0].length===t[1].length)for(S=0;S<t[0].length;S++)JXG$1.isFunction(t[0][S])?f.push(t[0][S]()):f.push(t[0][S]),JXG$1.isFunction(t[1][S])?A.push(t[1][S]()):A.push(t[1][S]);else for(S=0;S<t.length;S++)if(JXG$1.isPoint(t[S]))f.push(t[S].X()),A.push(t[S].Y());else if(JXG$1.isArray(t[S])&&t[S].length===2)for(w=0;w<t.length;w++)JXG$1.isFunction(t[w][0])?f.push(t[w][0]()):f.push(t[w][0]),JXG$1.isFunction(t[w][1])?A.push(t[w][1]()):A.push(t[w][1]);else JXG$1.isFunction(t[S])&&t[S]().length===2&&(M=t[S](),f.push(M[0]),A.push(M[1]));I=Numerics.splineDef(f,A)}return Numerics.splineEval(y,f,A,I)},function(){return f[0]},function(){return f[f.length-1]}]},o=JXG$1.copyAttributes(o,n.options,"curve"),o.curvetype="functiongraph",C=d(),u=new JXG$1.Curve(n,["x","x",C[0],C[1],C[2]],o),u.setParents(t),u.elType="spline",u};JXG$1.registerElement("spline",JXG$1.createSpline);JXG$1.createCardinalSpline=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M=`
Possible parent types: [points:array, tau:number|function, type:string]`;if(!JXG$1.exists(t[0])||!JXG$1.isArray(t[0]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 1 'points' has to be array of points or coordinate pairs"+M);if(!JXG$1.exists(t[1])||!JXG$1.isNumber(t[1])&&!JXG$1.isFunction(t[1]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 2 'tau' has to be number between [0,1] or function'"+M);if(!JXG$1.exists(t[2])||!JXG$1.isString(t[2]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 3 'type' has to be string 'uniform' or 'centripetal'"+M);if(o=JXG$1.copyAttributes(o,n.options,"curve"),o=JXG$1.copyAttributes(o,n.options,"cardinalspline"),o.curvetype="parameter",A=t[0],y=[],!o.isarrayofcoordinates&&A.length===2&&JXG$1.isArray(A[0])&&JXG$1.isArray(A[1])&&A[0].length===A[1].length)for(G=0;G<A[0].length;G++)y[G]=[],JXG$1.isFunction(A[0][G])?y[G].push(A[0][G]()):y[G].push(A[0][G]),JXG$1.isFunction(A[1][G])?y[G].push(A[1][G]()):y[G].push(A[1][G]);else for(G=0;G<A.length;G++)JXG$1.isString(A[G])?y.push(n.select(A[G])):JXG$1.isPoint(A[G])?y.push(A[G]):JXG$1.isArray(A[G])&&A[G].length===2?(y[G]=[],JXG$1.isFunction(A[G][0])?y[G].push(A[G][0]()):y[G].push(A[G][0]),JXG$1.isFunction(A[G][1])?y[G].push(A[G][1]()):y[G].push(A[G][1])):JXG$1.isFunction(A[G])&&A[G]().length===2&&y.push(t[G]());if(o.createpoints===!0)C=JXG$1.providePoints(n,y,o,"cardinalspline",["points"]);else for(C=[],d=function(V){return{X:function(){return y[V][0]},Y:function(){return y[V][1]},Dist:function(T){var H=this.X()-T.X(),J=this.Y()-T.Y();return Mat.hypot(H,J)}}},G=0;G<y.length;G++)JXG$1.isPoint(y[G])?C.push(y[G]):C.push(d(G));for(I=t[1],f=t[2],w=["x"].concat(Numerics.CardinalSpline(C,I,f)),u=new JXG$1.Curve(n,w,o),S=C.length,u.setParents(C),G=0;G<S;G++)A=C[G],JXG$1.isPoint(A)&&(JXG$1.exists(A._is_new)?(u.addChild(A),delete A._is_new):A.addChild(u));return u.elType="cardinalspline",u};JXG$1.registerElement("cardinalspline",JXG$1.createCardinalSpline);JXG$1.createMetapostSpline=function(n,t,o){var u,d,C,I,f,A,y,G,S=`
Possible parent types: [points:array, controls:object`;if(!JXG$1.exists(t[0])||!JXG$1.isArray(t[0]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 1 'points' has to be array of points or coordinate pairs"+S);if(!JXG$1.exists(t[1])||!JXG$1.isObject(t[1]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 2 'controls' has to be a JavaScript object'"+S);if(o=JXG$1.copyAttributes(o,n.options,"curve"),o=JXG$1.copyAttributes(o,n.options,"metapostspline"),o.curvetype="parameter",f=t[0],A=[],!o.isarrayofcoordinates&&f.length===2&&JXG$1.isArray(f[0])&&JXG$1.isArray(f[1])&&f[0].length===f[1].length)for(y=0;y<f[0].length;y++)A[y]=[],JXG$1.isFunction(f[0][y])?A[y].push(f[0][y]()):A[y].push(f[0][y]),JXG$1.isFunction(f[1][y])?A[y].push(f[1][y]()):A[y].push(f[1][y]);else for(y=0;y<f.length;y++)JXG$1.isString(f[y])?A.push(n.select(f[y])):JXG$1.isPoint(f[y])?A.push(f[y]):JXG$1.isArray(f[y])&&f[y].length===2?(A[y]=[],JXG$1.isFunction(f[y][0])?A[y].push(f[y][0]()):A[y].push(f[y][0]),JXG$1.isFunction(f[y][1])?A[y].push(f[y][1]()):A[y].push(f[y][1])):JXG$1.isFunction(f[y])&&f[y]().length===2&&A.push(t[y]());if(o.createpoints===!0)C=JXG$1.providePoints(n,A,o,"metapostspline",["points"]);else for(C=[],d=function(w){return{X:function(){return A[w][0]},Y:function(){return A[w][1]}}},y=0;y<A.length;y++)JXG$1.isPoint(A[y])?C.push(A[y]):C.push(d);for(I=t[1],u=new JXG$1.Curve(n,["t",[],[],0,f.length-1],o),u.updateDataArray=function(){var w,M,V=C.length,T=[];for(M=0;M<V;M++)T.push([C[M].X(),C[M].Y()]);w=Metapost.curve(T,I),this.dataX=w[0],this.dataY=w[1]},u.bezierDegree=3,G=C.length,u.setParents(C),y=0;y<G;y++)JXG$1.isPoint(C[y])&&C[y].addChild(u);return u.elType="metapostspline",u};JXG$1.registerElement("metapostspline",JXG$1.createMetapostSpline);JXG$1.createRiemannsum=function(n,t,o){var u,d,C,I,f,A;if(A=JXG$1.copyAttributes(o,n.options,"riemannsum"),A.curvetype="plot",C=t[0],u=JXG$1.createFunction(t[1],n,""),!JXG$1.exists(u))throw new Error(`JSXGraph: JXG.createRiemannsum: argument '2' n has to be number or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);if(typeof t[2]=="string"&&(t[2]="'"+t[2]+"'"),d=JXG$1.createFunction(t[2],n,""),!JXG$1.exists(d))throw new Error(`JSXGraph: JXG.createRiemannsum: argument 3 'type' has to be string or function.
Possible parent types: [function,n:number|function,type,start:number|function,end:number|function]`);return I=[[0],[0]].concat(t.slice(3)),f=n.create("curve",I,A),f.sum=0,f.Value=function(){return this.sum},f.updateDataArray=function(){var y=Numerics.riemann(C,u(),d(),this.minX(),this.maxX());this.dataX=y[0],this.dataY=y[1],this.sum=y[2]},f.addParentsFromJCFunctions([u,d]),f};JXG$1.registerElement("riemannsum",JXG$1.createRiemannsum);JXG$1.createTracecurve=function(n,t,o){var u,d,C,I;if(t.length!==2)throw new Error(`JSXGraph: Can't create trace curve with given parent'
Possible parent types: [glider, point]`);if(d=n.select(t[0]),C=n.select(t[1]),d.type!==Const.OBJECT_TYPE_GLIDER||!JXG$1.isPoint(C))throw new Error("JSXGraph: Can't create trace curve with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [glider, point]`);return I=JXG$1.copyAttributes(o,n.options,"tracecurve"),I.curvetype="plot",u=n.create("curve",[[0],[0]],I),u.updateDataArray=function(){var f,A,y,G,S,w,M,V,T,H=I.numberpoints,J=d.position,z=d.slideObject,L=z.minX(),K=z.maxX();for(A=(K-L)/H,this.dataX=[],this.dataY=[],z.elementClass!==Const.OBJECT_CLASS_CURVE&&H++,f=0;f<H;f++){y=L+f*A,w=z.X(y)/z.Z(y),M=z.Y(y)/z.Z(y),d.setPositionDirectly(Const.COORDS_BY_USER,[w,M]),V=!1;for(G in this.board.objects)if(this.board.objects.hasOwnProperty(G)&&(S=this.board.objects[G],S===d&&(V=!0),V&&S.needsRegularUpdate&&(T=S.visProp.trace,S.visProp.trace=!1,S.needsUpdate=!0,S.update(!0),S.visProp.trace=T,S===C)))break;this.dataX[f]=C.X(),this.dataY[f]=C.Y()}d.position=J,V=!1;for(G in this.board.objects)if(this.board.objects.hasOwnProperty(G)&&(S=this.board.objects[G],S===d&&(V=!0),V&&S.needsRegularUpdate&&(T=S.visProp.trace,S.visProp.trace=!1,S.needsUpdate=!0,S.update(!0),S.visProp.trace=T,S===C)))break},u};JXG$1.registerElement("tracecurve",JXG$1.createTracecurve);JXG$1.createStepfunction=function(n,t,o){var u,d;if(t.length!==2)throw new Error(`JSXGraph: Can't create step function with given parent'
Possible parent types: [array, array|function]`);return d=JXG$1.copyAttributes(o,n.options,"stepfunction"),u=n.create("curve",t,d),u.updateDataArray=function(){var C,I=0,f=this.xterm.length;if(this.dataX=[],this.dataY=[],f!==0)for(this.dataX[I]=this.xterm[0],this.dataY[I]=this.yterm[0],++I,C=1;C<f;++C)this.dataX[I]=this.xterm[C],this.dataY[I]=this.dataY[I-1],++I,this.dataX[I]=this.xterm[C],this.dataY[I]=this.yterm[C],++I},u};JXG$1.registerElement("stepfunction",JXG$1.createStepfunction);JXG$1.createDerivative=function(n,t,o){var u,d,C,I,f;if(t.length!==1&&t[0].class!==Const.OBJECT_CLASS_CURVE)throw new Error(`JSXGraph: Can't create derivative curve with given parent'
Possible parent types: [curve]`);return f=JXG$1.copyAttributes(o,n.options,"curve"),d=t[0],C=Numerics.D(d.X),I=Numerics.D(d.Y),u=n.create("curve",[function(A){return d.X(A)},function(A){return I(A)/C(A)},d.minX(),d.maxX()],f),u.setParents(d),u};JXG$1.registerElement("derivative",JXG$1.createDerivative);JXG$1.createCurveIntersection=function(n,t,o){var u;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve intersection with given parent'
Possible parent types: [array, array|function]`);return u=n.create("curve",[[],[]],o),u.updateDataArray=function(){var d=Clip.intersection(t[0],t[1],this.board);this.dataX=d[0],this.dataY=d[1]},u};JXG$1.createCurveUnion=function(n,t,o){var u;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve union with given parent'
Possible parent types: [array, array|function]`);return u=n.create("curve",[[],[]],o),u.updateDataArray=function(){var d=Clip.union(t[0],t[1],this.board);this.dataX=d[0],this.dataY=d[1]},u};JXG$1.createCurveDifference=function(n,t,o){var u;if(t.length!==2)throw new Error(`JSXGraph: Can't create curve difference with given parent'
Possible parent types: [array, array|function]`);return u=n.create("curve",[[],[]],o),u.updateDataArray=function(){var d=Clip.difference(t[0],t[1],this.board);this.dataX=d[0],this.dataY=d[1]},u};JXG$1.registerElement("curvedifference",JXG$1.createCurveDifference);JXG$1.registerElement("curveintersection",JXG$1.createCurveIntersection);JXG$1.registerElement("curveunion",JXG$1.createCurveUnion);JXG$1.createBoxPlot=function(n,t,o){var u,d,C,I=JXG$1.copyAttributes(o,n.options,"boxplot");if(t.length!==3)throw new Error(`JSXGraph: Can't create box plot with given parent'
Possible parent types: [array, number|function, number|function] containing quantiles, axis, width`);if(t[0].length<5)throw new Error(`JSXGraph: Can't create box plot with given parent[0]'
parent[0] has to contain at least 5 quantiles.`);for(u=n.create("curve",[[],[]],I),C=t[0].length,u.Q=[],d=0;d<C;d++)u.Q[d]=JXG$1.createFunction(t[0][d],n);return u.x=JXG$1.createFunction(t[1],n),u.w=JXG$1.createFunction(t[2],n),u.updateDataArray=function(){var f,A,y,G,S,w,M,V,T;M=JXG$1.evaluate(this.visProp.smallwidth),V=JXG$1.evaluate(this.visProp.dir),T=this.x(),y=T-this.w()*.5,G=T-this.w()*.5*M,S=T+this.w()*.5,w=T+this.w()*.5*M,f=[T,G,w,T,T,y,y,S,S,T,NaN,y,S,NaN,T,T,G,w,T],A=[this.Q[0](),this.Q[0](),this.Q[0](),this.Q[0](),this.Q[1](),this.Q[1](),this.Q[3](),this.Q[3](),this.Q[1](),this.Q[1](),NaN,this.Q[2](),this.Q[2](),NaN,this.Q[3](),this.Q[4](),this.Q[4](),this.Q[4](),this.Q[4]()],V==="vertical"?(this.dataX=f,this.dataY=A):(this.dataX=A,this.dataY=f)},u.addParentsFromJCFunctions([u.Q,u.x,u.w]),u};JXG$1.registerElement("boxplot",JXG$1.createBoxPlot);JXG$1.createImplicitCurve=function(n,t,o){var u,d;if([1,3,5].indexOf(t.length)<0)throw new Error(`JSXGraph: Can't create curve implicitCurve with given parent'
Possible parent types: [f], [f, rangex, rangey], [f, dfx, dfy] or [f, dfx, dfy, rangex, rangey]
with functions f, dfx, dfy and arrays of length 2 rangex, rangey.`);return d=JXG$1.copyAttributes(o,n.options,"implicitcurve"),u=n.create("curve",[[],[]],d),u.f=JXG$1.createFunction(t[0],n,"x, y"),u.dfx=JXG$1.createFunction(t[1],n,"x, y"),u.dfy=JXG$1.createFunction(t[2],n,"x, y"),u.domain=null,t.length===5?u.domain=[t[3],t[4]]:t.length===3&&(u.domain=[t[1],t[2]]),u.updateDataArray=function(){var C,I,f,A,y,G=[],S;this.domain===null?(S=JXG$1.evaluate(this.visProp.margin),C=this.board.getBoundingBox(),C[0]-=S,C[1]+=S,C[2]+=S,C[3]-=S):(I=JXG$1.evaluate(this.domain[0]),f=JXG$1.evaluate(this.domain[1]),C=[I[0],f[1],I[1],f[0]]),y={resolution_out:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_outer)),resolution_in:Math.max(.01,JXG$1.evaluate(this.visProp.resolution_inner)),max_steps:JXG$1.evaluate(this.visProp.max_steps),alpha_0:JXG$1.evaluate(this.visProp.alpha_0),tol_u0:JXG$1.evaluate(this.visProp.tol_u0),tol_newton:JXG$1.evaluate(this.visProp.tol_newton),tol_cusp:JXG$1.evaluate(this.visProp.tol_cusp),tol_progress:JXG$1.evaluate(this.visProp.tol_progress),qdt_box:JXG$1.evaluate(this.visProp.qdt_box),kappa_0:JXG$1.evaluate(this.visProp.kappa_0),delta_0:JXG$1.evaluate(this.visProp.delta_0),h_initial:JXG$1.evaluate(this.visProp.h_initial),h_critical:JXG$1.evaluate(this.visProp.h_critical),h_max:JXG$1.evaluate(this.visProp.h_max),loop_dist:JXG$1.evaluate(this.visProp.loop_dist),loop_dir:JXG$1.evaluate(this.visProp.loop_dir),loop_detection:JXG$1.evaluate(this.visProp.loop_detection),unitX:this.board.unitX,unitY:this.board.unitY},this.dataX=[],this.dataY=[],A=new ImplicitPlot(C,y,this.f,this.dfx,this.dfy),this.qdt=A.qdt,G=A.plot(),this.dataX=G[0],this.dataY=G[1]},u.elType="implicitcurve",u};JXG$1.registerElement("implicitcurve",JXG$1.createImplicitCurve);JXG$1.Curve;JXG$1.createArc=function(n,t,o){var u,d,C;if(C=JXG$1.providePoints(n,t,o,"arc",["center","radiuspoint","anglepoint"]),C===!1||C.length<3)throw new Error("JSXGraph: Can't create Arc with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point], [arc, transformation]`);return d=JXG$1.copyAttributes(o,n.options,"arc"),u=n.create("curve",[[0],[0]],d),u.elType="arc",u.setParents(C),u.type=Const.OBJECT_TYPE_ARC,u.center=C[0],u.radiuspoint=C[1],u.point2=u.radiuspoint,u.anglepoint=C[2],u.point3=u.anglepoint,JXG$1.exists(u.center._is_new)?(u.addChild(u.center),delete u.center._is_new):u.center.addChild(u),JXG$1.exists(u.radiuspoint._is_new)?(u.addChild(u.radiuspoint),delete u.radiuspoint._is_new):u.radiuspoint.addChild(u),JXG$1.exists(u.anglepoint._is_new)?(u.addChild(u.anglepoint),delete u.anglepoint._is_new):u.anglepoint.addChild(u),u.useDirection=d.usedirection,u.updateDataArray=function(){var I,f,A,y,G,S,w=1,M=this.radiuspoint,V=this.center,T=this.anglepoint,H=JXG$1.evaluate(this.visProp.selection);f=Geometry.rad(M,V,T),(H==="minor"&&f>Math.PI||H==="major"&&f<Math.PI)&&(w=-1),this.useDirection&&(y=C[1].coords.usrCoords,G=C[3].coords.usrCoords,S=C[2].coords.usrCoords,A=(y[1]-S[1])*(y[2]-G[2])-(y[2]-S[2])*(y[1]-G[1]),A<0?(this.radiuspoint=C[1],this.anglepoint=C[2]):(this.radiuspoint=C[2],this.anglepoint=C[1])),M=M.coords.usrCoords,V=V.coords.usrCoords,T=T.coords.usrCoords,I=Geometry.bezierArc(M,V,T,!1,w),this.dataX=I[0],this.dataY=I[1],this.bezierDegree=3,this.updateStdform(),this.updateQuadraticform()},u.Radius=function(){return this.radiuspoint.Dist(this.center)},u.getRadius=function(){return JXG$1.deprecated("Arc.getRadius()","Arc.Radius()"),this.Radius()},u.Value=function(I,f){var A;return f=f||Geometry.rad(this.radiuspoint,this.center,this.anglepoint),I=I||"length",I=I.toLocaleLowerCase(),I===""||I.indexOf("len")===0?A=f*this.Radius():I.indexOf("rad")===0?A=f:I.indexOf("deg")===0?A=f*180/Math.PI:I.indexOf("sem")===0?A=f/Math.PI:I.indexOf("cir")===0&&(A=f*.5/Math.PI),A},u.L=function(){return this.Value("length")},u.hasPoint=function(I,f){var A,y,G,S,w,M,V,T=this.Radius();return JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(I,f):(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(V=this.board._inputDevice,M=JXG$1.evaluate(this.visProp.precision[V])):M=this.board.options.precision.hasPoint,M/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),y=new Coords(Const.COORDS_BY_SCREEN,[I,f],this.board),this.transformations.length>0&&(this.updateTransformMatrix(),S=Mat.inverse(this.transformMat),w=Mat.matVecMult(S,y.usrCoords),y=new Coords(Const.COORDS_BY_USER,w,this.board)),A=this.center.coords.distance(Const.COORDS_BY_USER,y),G=Math.abs(A-T)<M,G&&(G=Geometry.coordsOnArc(this,y)),G)},u.hasPointSector=function(I,f){var A=new Coords(Const.COORDS_BY_SCREEN,[I,f],this.board),y=this.Radius(),G=this.center.coords.distance(Const.COORDS_BY_USER,A),S=G<y;return S&&(S=Geometry.coordsOnArc(this,A)),S},u.getTextAnchor=function(){return this.center.coords},u.getLabelAnchor=function(){var I,f,A,y,G,S=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),w=10/this.board.unitX,M=10/this.board.unitY,V=this.point2.coords.usrCoords,T=this.center.coords.usrCoords,H=V[1]-T[1],J=V[2]-T[2],z=JXG$1.evaluate(this.visProp.selection),L=this.label?this.label.visProp:this.visProp.label;return(z==="minor"&&S>Math.PI||z==="major"&&S<Math.PI)&&(S=-(2*Math.PI-S)),I=new Coords(Const.COORDS_BY_USER,[T[1]+Math.cos(S*.5)*H-Math.sin(S*.5)*J,T[2]+Math.sin(S*.5)*H+Math.cos(S*.5)*J],this.board),A=I.usrCoords[1]-T[1],y=I.usrCoords[2]-T[2],G=Mat.hypot(A,y),A=A*(G+w)/G,y=y*(G+M)/G,f=[T[1]+A,T[2]+y],L.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],f)),new Coords(Const.COORDS_BY_USER,f,this.board)},u.updateQuadraticform=Circle.prototype.updateQuadraticform,u.updateStdform=Circle.prototype.updateStdform,u.methodMap=JXG$1.deepCopy(u.methodMap,{getRadius:"getRadius",radius:"Radius",Radius:"Radius",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint",Value:"Value",L:"L"}),u.prepareUpdate().update(),u};JXG$1.registerElement("arc",JXG$1.createArc);JXG$1.createSemicircle=function(n,t,o){var u,d,C,I;if(I=JXG$1.providePoints(n,t,o,"point"),I===!1||I.length!==2)throw new Error("JSXGraph: Can't create Semicircle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point]`);return C=JXG$1.copyAttributes(o,n.options,"semicircle","center"),d=n.create("midpoint",I,C),d.dump=!1,C=JXG$1.copyAttributes(o,n.options,"semicircle"),u=n.create("arc",[d,I[1],I[0]],C),u.elType="semicircle",u.setParents([I[0].id,I[1].id]),u.subs={midpoint:d},u.inherits.push(d),u.midpoint=u.center=d,u};JXG$1.registerElement("semicircle",JXG$1.createSemicircle);JXG$1.createCircumcircleArc=function(n,t,o){var u,d,C,I;if(I=JXG$1.providePoints(n,t,o,"point"),I===!1||I.length!==3)throw new Error("JSXGraph: create Circumcircle Arc with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);return C=JXG$1.copyAttributes(o,n.options,"circumcirclearc","center"),d=n.create("circumcenter",I,C),d.dump=!1,C=JXG$1.copyAttributes(o,n.options,"circumcirclearc"),C.usedirection=!0,u=n.create("arc",[d,I[0],I[2],I[1]],C),u.elType="circumcirclearc",u.setParents([I[0].id,I[1].id,I[2].id]),u.subs={center:d},u.inherits.push(d),u.center=d,u};JXG$1.registerElement("circumcirclearc",JXG$1.createCircumcircleArc);JXG$1.createMinorArc=function(n,t,o){return o.selection="minor",JXG$1.createArc(n,t,o)};JXG$1.registerElement("minorarc",JXG$1.createMinorArc);JXG$1.createMajorArc=function(n,t,o){return o.selection="major",JXG$1.createArc(n,t,o)};JXG$1.registerElement("majorarc",JXG$1.createMajorArc);JXG$1.createSector=function(n,t,o){var u,d,C,I="invalid",f,A,y=["center","radiusPoint","anglePoint"],G;if(t[0].elementClass===Const.OBJECT_CLASS_LINE&&t[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(t[2])||JXG$1.isNumber(t[2]))&&(JXG$1.isArray(t[3])||JXG$1.isNumber(t[3]))&&(JXG$1.isNumber(t[4])||JXG$1.isFunction(t[4])||JXG$1.isString(t[4])))I="2lines";else{if(G=JXG$1.providePoints(n,t,o,"sector",y),G===!1)throw new Error("JSXGraph: Can't create Sector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");I="3points"}if(d=JXG$1.copyAttributes(o,n.options,"sector"),u=n.create("curve",[[0],[0]],d),u.type=Const.OBJECT_TYPE_SECTOR,u.elType="sector",u.autoRadius=function(){var S=20/u.board.unitX,w=1/0,M=50/u.board.unitX;return JXG$1.isPoint(u.center)&&(w=u.center.Dist(u.point2)*.3333),Math.max(S,Math.min(w,M))},I==="2lines")u.Radius=function(){var S=JXG$1.evaluate(t[4]);return S==="auto"?this.autoRadius():S},u.line1=n.select(t[0]),u.line2=n.select(t[1]),u.line1.addChild(u),u.line2.addChild(u),u.setParents(t),u.point1={visProp:{}},u.point2={visProp:{}},u.point3={visProp:{}},f=Geometry.meetLineLine(u.line1.stdform,u.line2.stdform,0,n),JXG$1.isArray(t[2])?(t[2].length===2&&(t[2]=[1].concat(t[2])),A=Geometry.projectPointToLine({coords:{usrCoords:t[2]}},u.line1,n),A=Statistics.subtract(A.usrCoords,f.usrCoords),u.direction1=Mat.innerProduct(A,[0,u.line1.stdform[2],-u.line1.stdform[1]],3)>=0?1:-1):u.direction1=t[2]>=0?1:-1,JXG$1.isArray(t[3])?(t[3].length===2&&(t[3]=[1].concat(t[3])),A=Geometry.projectPointToLine({coords:{usrCoords:t[3]}},u.line2,n),A=Statistics.subtract(A.usrCoords,f.usrCoords),u.direction2=Mat.innerProduct(A,[0,u.line2.stdform[2],-u.line2.stdform[1]],3)>=0?1:-1):u.direction2=t[3]>=0?1:-1,u.methodMap=JXG$1.deepCopy(u.methodMap,{arc:"arc",center:"center",line1:"line1",line2:"line2"}),u.updateDataArray=function(){var S,w,M,V=[0,0,0],T=[0,0,0],H=[0,0,0],J;if(w=this.line1,M=this.line2,T=Mat.crossProduct(w.stdform,M.stdform),Math.abs(T[0])>Mat.eps*Mat.eps&&(T[1]/=T[0],T[2]/=T[0],T[0]/=T[0]),S=this.direction1*this.Radius(),V=Statistics.add(T,[0,S*w.stdform[2],-S*w.stdform[1]]),S=this.direction2*this.Radius(),H=Statistics.add(T,[0,S*M.stdform[2],-S*M.stdform[1]]),this.point2.coords=new Coords(Const.COORDS_BY_USER,V,u.board),this.point1.coords=new Coords(Const.COORDS_BY_USER,T,u.board),this.point3.coords=new Coords(Const.COORDS_BY_USER,H,u.board),Math.abs(V[0])<Mat.eps||Math.abs(T[0])<Mat.eps||Math.abs(H[0])<Mat.eps){this.dataX=[NaN],this.dataY=[NaN];return}J=Geometry.bezierArc(V,T,H,!0,1),this.dataX=J[0],this.dataY=J[1],this.bezierDegree=3};else if(I==="3points"){for(u.point1=G[0],u.point2=G[1],u.point3=G[2],C=0;C<3;C++)JXG$1.exists(G[C]._is_new)?(u.addChild(G[C]),delete G[C]._is_new):G[C].addChild(u);u.useDirection=o.usedirection,u.setParents(G),JXG$1.exists(G[3])&&(u.point4=G[3],u.point4.addChild(u)),u.methodMap=JXG$1.deepCopy(u.methodMap,{arc:"arc",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint"}),u.updateDataArray=function(){var S,w,M,V,T,H=this.point2,J=this.point1,z=this.point3,L,K=1,O=JXG$1.evaluate(this.visProp.selection);if(!H.isReal||!J.isReal||!z.isReal){this.dataX=[NaN],this.dataY=[NaN];return}L=Geometry.rad(H,J,z),(O==="minor"&&L>Math.PI||O==="major"&&L<Math.PI)&&(K=-1),this.useDirection&&JXG$1.exists(this.point4)&&(M=this.point2.coords.usrCoords,V=this.point4.coords.usrCoords,T=this.point3.coords.usrCoords,w=(M[1]-T[1])*(M[2]-V[2])-(M[2]-T[2])*(M[1]-V[1]),w>=0&&(z=this.point2,H=this.point3)),H=H.coords.usrCoords,J=J.coords.usrCoords,z=z.coords.usrCoords,S=Geometry.bezierArc(H,J,z,!0,K),this.dataX=S[0],this.dataY=S[1],this.bezierDegree=3},u.Radius=function(){return this.point2.Dist(this.point1)}}return u.center=u.point1,u.radiuspoint=u.point2,u.anglepoint=u.point3,d=JXG$1.copyAttributes(o,n.options,"arc"),d=JXG$1.copyAttributes(d,n.options,"sector","arc"),d.withLabel=!1,d.selection=u.visProp.selection,d.name+="_arc",I==="2lines"?(u.updateDataArray(),u.arc=n.create("arc",[function(){return u.point1.coords.usrCoords},function(){var S=u.point2.coords.distance(Const.COORDS_BY_USER,u.point1.coords);return S===0?[u.point1.coords.usrCoords[1],u.point1.coords.usrCoords[2]]:[u.point1.coords.usrCoords[1]+u.Radius()*(u.point2.coords.usrCoords[1]-u.point1.coords.usrCoords[1])/S,u.point1.coords.usrCoords[2]+u.Radius()*(u.point2.coords.usrCoords[2]-u.point1.coords.usrCoords[2])/S]},function(){return u.point3.coords.usrCoords}],d)):u.arc=n.create("arc",[u.point1,function(){var S=u.point2.Dist(u.point1);return S===0?[u.point1.X(),u.point1.Y()]:[u.point1.X()+u.Radius()*(u.point2.X()-u.point1.X())/S,u.point1.Y()+u.Radius()*(u.point2.Y()-u.point1.Y())/S]},u.point3],d),u.addChild(u.arc),u.hasPointCurve=function(S,w){var M,V,T,H,J,z=new Coords(Const.COORDS_BY_SCREEN,[S,w],this.board),L=this.Radius(),K=this.center.coords.distance(Const.COORDS_BY_USER,z),O,Q=JXG$1.evaluate(this.visProp.selection);return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(J=this.board._inputDevice,H=JXG$1.evaluate(this.visProp.precision[J])):H=this.board.options.precision.hasPoint,H/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),O=Math.abs(K-L)<H,O&&(M=Geometry.rad(this.point2,this.center,z.usrCoords.slice(1)),V=0,T=Geometry.rad(this.point2,this.center,this.point3),(Q==="minor"&&T>Math.PI||Q==="major"&&T<Math.PI)&&(V=T,T=2*Math.PI),(M<V||M>T)&&(O=!1)),O},u.hasPointSector=function(S,w){var M,V=new Coords(Const.COORDS_BY_SCREEN,[S,w],this.board),T=this.Radius(),H=this.point1.coords.distance(Const.COORDS_BY_USER,V),J,z,L=H<T,K=JXG$1.evaluate(this.visProp.selection);return L&&(M=Geometry.rad(this.radiuspoint,this.center,V.usrCoords.slice(1)),J=0,z=Geometry.rad(this.radiuspoint,this.center,this.anglepoint),(K==="minor"&&z>Math.PI||K==="major"&&z<Math.PI)&&(J=z,z=2*Math.PI),(M<J||M>z)&&(L=!1)),L},u.hasPoint=function(S,w){return JXG$1.evaluate(this.visProp.highlightonsector)||JXG$1.evaluate(this.visProp.hasinnerpoints)?this.hasPointSector(S,w):this.hasPointCurve(S,w)},u.getTextAnchor=function(){return this.point1.coords},u.getLabelAnchor=function(){var S,w,M,V,T,H=Geometry.rad(this.point2,this.point1,this.point3),J=13/this.board.unitX,z=13/this.board.unitY,L=this.point2.coords.usrCoords,K=this.point1.coords.usrCoords,O=L[1]-K[1],Q=L[2]-K[2],ee=JXG$1.evaluate(this.visProp.selection),ie=this.label?this.label.visProp:this.visProp.label;return(ee==="minor"&&H>Math.PI||ee==="major"&&H<Math.PI)&&(H=-(2*Math.PI-H)),S=new Coords(Const.COORDS_BY_USER,[K[1]+Math.cos(H*.5)*O-Math.sin(H*.5)*Q,K[2]+Math.sin(H*.5)*O+Math.cos(H*.5)*Q],this.board),M=S.usrCoords[1]-K[1],V=S.usrCoords[2]-K[2],T=Mat.hypot(M,V),M=M*(T+J)/T,V=V*(T+z)/T,w=[K[1]+M,K[2]+V],ie.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],w)),new Coords(Const.COORDS_BY_USER,w,this.board)},u.setRadius=function(S){var w,M=JXG$1.evaluate(S);S==="auto"||M==="auto"?w="auto":JXG$1.isNumber(S)?w="number":JXG$1.isFunction(S)&&!JXG$1.isString(M)?w="function":w="undefined",w!=="undefined"&&(this.visProp.radius=S),u.Radius=function(){var V=JXG$1.evaluate(S);return V==="auto"?this.autoRadius():V}},u.getRadius=function(){return JXG$1.deprecated("Sector.getRadius()","Sector.Radius()"),this.Radius()},u.Value=function(S){return this.arc.Value(S)},u.L=function(){return this.arc.L()},u.Area=function(){var S=this.Radius();return .5*S*S*this.Value("radians")},u.Perimeter=function(){return this.L()+2*this.Radius()},I==="3points"&&(u.setPositionDirectly=function(S,w,M){var V,T,H=new Coords(S,w,this.board),J=new Coords(S,M,this.board);return!u.point1.draggable()||!u.point2.draggable()||!u.point3.draggable()?this:(V=Statistics.subtract(H.usrCoords,J.usrCoords),T=this.board.create("transform",V.slice(1),{type:"translate"}),T.applyOnce([u.point1,u.point2,u.point3]),this)}),u.methodMap=JXG$1.deepCopy(u.methodMap,{radius:"Radius",Radius:"Radius",getRadius:"Radius",setRadius:"setRadius",Value:"Value",L:"L",Area:"Area",Perimeter:"Perimeter"}),u};JXG$1.registerElement("sector",JXG$1.createSector);JXG$1.createCircumcircleSector=function(n,t,o){var u,d,C,I;if(I=JXG$1.providePoints(n,t,o,"point"),I===!1)throw new Error("JSXGraph: Can't create circumcircle sector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");return d=n.create("circumcenter",I.slice(0,3),C),d.dump=!1,C=JXG$1.copyAttributes(o,n.options,"circumcirclesector"),u=n.create("sector",[d,I[0],I[2],I[1]],C),u.elType="circumcirclesector",u.setParents(I),u.center=d,u.subs={center:d},u};JXG$1.registerElement("circumcirclesector",JXG$1.createCircumcircleSector);JXG$1.createMinorSector=function(n,t,o){return o.selection="minor",JXG$1.createSector(n,t,o)};JXG$1.registerElement("minorsector",JXG$1.createMinorSector);JXG$1.createMajorSector=function(n,t,o){return o.selection="major",JXG$1.createSector(n,t,o)};JXG$1.registerElement("majorsector",JXG$1.createMajorSector);JXG$1.createAngle=function(n,t,o){var u,d,C,I,f,A,y="invalid";if(t[0].elementClass===Const.OBJECT_CLASS_LINE&&t[1].elementClass===Const.OBJECT_CLASS_LINE&&(JXG$1.isArray(t[2])||JXG$1.isNumber(t[2]))&&(JXG$1.isArray(t[3])||JXG$1.isNumber(t[3])))y="2lines";else{if(C={name:""},A=JXG$1.providePoints(n,t,C,"point"),A===!1)throw new Error("JSXGraph: Can't create angle with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"' and '"+typeof t[2]+"'.");y="3points"}if(C=JXG$1.copyAttributes(o,n.options,"angle"),JXG$1.exists(C.name)||(C.name=n.generateName({type:Const.OBJECT_TYPE_ANGLE})),JXG$1.exists(C.radius)?d=C.radius:d=0,n.suspendUpdate(),y==="2lines"?(t.push(d),u=n.create("sector",t,C),u.updateDataArraySector=u.updateDataArray,u.setAngle=function(G){},u.free=function(G){}):(u=n.create("sector",[A[1],A[0],A[2]],C),u.arc.visProp.priv=!0,u.point=u.point2=u.radiuspoint=A[0],u.pointsquare=u.point3=u.anglepoint=A[2],u.Radius=function(){var G=JXG$1.evaluate(d);return G==="auto"?u.autoRadius():G},u.updateDataArraySector=function(){var G=this.point2,S=this.point1,w=this.point3,M=this.Radius(),V=S.Dist(G),T,H,J=1,z=JXG$1.evaluate(this.visProp.selection);H=Geometry.rad(G,S,w),(z==="minor"&&H>Math.PI||z==="major"&&H<Math.PI)&&(J=-1),G=G.coords.usrCoords,S=S.coords.usrCoords,w=w.coords.usrCoords,G=[1,S[1]+(G[1]-S[1])*M/V,S[2]+(G[2]-S[2])*M/V],w=[1,S[1]+(w[1]-S[1])*M/V,S[2]+(w[2]-S[2])*M/V],T=Geometry.bezierArc(G,S,w,!0,J),this.dataX=T[0],this.dataY=T[1],this.bezierDegree=3},u.setAngle=function(G){var S,w,M,V=this.anglepoint,T=this.radiuspoint;return V.draggable()&&(S=this.board.create("transform",[G,this.center],{type:"rotate"}),V.addTransform(T,S),S.update(),V.moveTo(Mat.matVecMult(S.matrix,T.coords.usrCoords)),JXG$1.isFunction(G)?M=function(){return Math.PI*2-G()}:M=function(){return Math.PI*2-G},w=this.board.create("transform",[M,this.center],{type:"rotate"}),V.coords.on("update",function(){w.update(),T.moveTo(Mat.matVecMult(w.matrix,V.coords.usrCoords))}),V.setParents(T),this.hasFixedAngle=!0),this},u.free=function(){var G=this.anglepoint;return G.transformations.length>0&&(G.transformations.pop(),G.isDraggable=!0,G.parents=[],G.coords.off("update")),this.hasFixedAngle=!1,this},u.setParents(A)),JXG$1.exists(u.visProp.text)&&u.label.setText(JXG$1.evaluate(u.visProp.text)),u.elType="angle",u.type=Const.OBJECT_TYPE_ANGLE,u.subs={},u.updateDataArraySquare=function(){var G,S,w,M,V,T,H,J,z=this.Radius();y==="2lines"&&this.updateDataArraySector(),G=this.point2,S=this.point1,w=this.point3,G=G.coords.usrCoords,S=S.coords.usrCoords,w=w.coords.usrCoords,M=Geometry.distance(G,S,3),V=Geometry.distance(w,S,3),G=[1,S[1]+(G[1]-S[1])*z/M,S[2]+(G[2]-S[2])*z/M],w=[1,S[1]+(w[1]-S[1])*z/V,S[2]+(w[2]-S[2])*z/V],T=Mat.crossProduct(w,S),H=[-G[1]*T[1]-G[2]*T[2],G[0]*T[1],G[0]*T[2]],T=Mat.crossProduct(G,S),J=[-w[1]*T[1]-w[2]*T[2],w[0]*T[1],w[0]*T[2]],T=Mat.crossProduct(H,J),T[1]/=T[0],T[2]/=T[0],this.dataX=[S[1],G[1],T[1],w[1],S[1]],this.dataY=[S[2],G[2],T[2],w[2],S[2]],this.bezierDegree=1},u.updateDataArrayNone=function(){this.dataX=[NaN],this.dataY=[NaN],this.bezierDegree=1},u.updateDataArray=function(){var G=JXG$1.evaluate(this.visProp.type),S=Geometry.trueAngle(this.point2,this.point1,this.point3),w=JXG$1.evaluate(this.visProp.selection);(w==="minor"&&S>180||w==="major"&&S<180)&&(S=360-S),Math.abs(S-90)<JXG$1.evaluate(this.visProp.orthosensitivity)+Mat.eps&&(G=JXG$1.evaluate(this.visProp.orthotype)),G==="none"?this.updateDataArrayNone():G==="square"?this.updateDataArraySquare():G==="sector"?this.updateDataArraySector():G==="sectordot"&&(this.updateDataArraySector(),this.dot.visProp.visible||this.dot.setAttribute({visible:!0})),(!this.visProp.visible||G!=="sectordot"&&this.dot.visProp.visible)&&this.dot.setAttribute({visible:!1})},I=JXG$1.copyAttributes(o,n.options,"angle","dot"),u.dot=n.create("point",[function(){var G,S,w,M,V,T,H,J,z;return JXG$1.exists(u.dot)&&!u.dot.visProp.visible?[0,0]:(G=u.point2.coords.usrCoords,S=u.point1.coords.usrCoords,w=u.Radius(),M=Geometry.distance(G,S,3),V=Geometry.rad(u.point2,u.point1,u.point3),z=JXG$1.evaluate(u.visProp.selection),(z==="minor"&&V>Math.PI||z==="major"&&V<Math.PI)&&(V=-(2*Math.PI-V)),V*=.5,T=Math.cos(V),H=Math.sin(V),G=[1,S[1]+(G[1]-S[1])*w/M,S[2]+(G[2]-S[2])*w/M],J=[[1,0,0],[S[1]-.5*S[1]*T+.5*S[2]*H,T*.5,-H*.5],[S[2]-.5*S[1]*H-.5*S[2]*T,H*.5,T*.5]],Mat.matVecMult(J,G))}],I),u.dot.dump=!1,u.subs.dot=u.dot,y==="2lines")for(f=0;f<2;f++)n.select(t[f]).addChild(u.dot);else for(f=0;f<3;f++)n.select(A[f]).addChild(u.dot);return n.unsuspendUpdate(),u.Value=function(G){return G=G||"radians",G===""&&(G="radians"),u.arc.Value(G)},u.getLabelAnchor=function(){var G,S=12,w,M,V,T,H,J,z,L,K=JXG$1.evaluate(u.visProp.selection),O=this.label?this.label.visProp:this.visProp.label;return JXG$1.exists(this.label)&&JXG$1.exists(this.label.visProp.fontsize)&&(S=JXG$1.evaluate(this.label.visProp.fontsize)),S/=this.board.unitX,w=u.point2.coords.usrCoords,M=u.point1.coords.usrCoords,V=u.Radius(),T=Geometry.distance(w,M,3),H=Geometry.rad(u.point2,u.point1,u.point3),(K==="minor"&&H>Math.PI||K==="major"&&H<Math.PI)&&(H=-(2*Math.PI-H)),H*=.5,J=Math.cos(H),z=Math.sin(H),w=[1,M[1]+(w[1]-M[1])*V/T,M[2]+(w[2]-M[2])*V/T],L=[[1,0,0],[M[1]-.5*M[1]*J+.5*M[2]*z,J*.5,-z*.5],[M[2]-.5*M[1]*z-.5*M[2]*J,z*.5,J*.5]],G=Mat.matVecMult(L,w),G[1]/=G[0],G[2]/=G[0],G[0]/=G[0],T=Geometry.distance(G,M,3),G=[G[0],M[1]+(G[1]-M[1])*(V+S)/T,M[2]+(G[2]-M[2])*(V+S)/T],O.position=Geometry.calcLabelQuadrant(Geometry.rad([1,0],[0,0],G)),new Coords(Const.COORDS_BY_USER,G,this.board)},u.methodMap=JXG$1.deepCopy(u.methodMap,{setAngle:"setAngle",Value:"Value",free:"free"}),u};JXG$1.registerElement("angle",JXG$1.createAngle);JXG$1.createNonreflexAngle=function(n,t,o){var u;return o.selection="minor",o=JXG$1.copyAttributes(o,n.options,"nonreflexangle"),u=JXG$1.createAngle(n,t,o),u.Value=function(d){var C=Geometry.rad(this.point2,this.point1,this.point3);return d=d||"radians",d===""&&(d="radians"),C=C<Math.PI?C:2*Math.PI-C,this.arc.Value(d,C)},u};JXG$1.registerElement("nonreflexangle",JXG$1.createNonreflexAngle);JXG$1.createReflexAngle=function(n,t,o){var u;return o.selection="major",o=JXG$1.copyAttributes(o,n.options,"reflexangle"),u=JXG$1.createAngle(n,t,o),u.Value=function(d){var C=Geometry.rad(this.point2,this.point1,this.point3);return d=d||"radians",d===""&&(d="radians"),C=C>=Math.PI?C:2*Math.PI-C,this.arc.Value(d,C)},u};JXG$1.registerElement("reflexangle",JXG$1.createReflexAngle);JXG$1.createOrthogonalProjection=function(n,t,o){var u,d,C,I;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[0]],o,"point")[0],u=t[1];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[1]],o,"point")[0],u=t[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return I=JXG$1.copyAttributes(o,n.options,"orthogonalprojection"),C=n.create("point",[function(){return Geometry.projectPointToLine(d,u,n)}],I),JXG$1.exists(d._is_new)?(C.addChild(d),delete d._is_new):d.addChild(C),u.addChild(C),C.elType="orthogonalprojection",C.setParents([d.id,C.id]),C.update(),C.generatePolynomial=function(){var f=u.point1.symbolic.x,A=u.point1.symbolic.y,y=u.point2.symbolic.x,G=u.point2.symbolic.y,S=d.symbolic.x,w=d.symbolic.y,M=C.symbolic.x,V=C.symbolic.y,T="("+A+")*("+M+")-("+A+")*("+y+")+("+V+")*("+y+")-("+f+")*("+V+")+("+f+")*("+G+")-("+M+")*("+G+")",H="("+w+")*("+A+")-("+w+")*("+G+")-("+V+")*("+A+")+("+V+")*("+G+")+("+S+")*("+f+")-("+S+")*("+y+")-("+M+")*("+f+")+("+M+")*("+y+")";return[T,H]},C};JXG$1.createPerpendicular=function(n,t,o){var u,d,C,I;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)d=t[1],u=JXG$1.providePoints(n,[t[0]],o,"point")[0];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)d=t[0],u=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point]`);return I=JXG$1.copyAttributes(o,n.options,"perpendicular"),C=JXG$1.createLine(n,[function(){return d.stdform[2]*u.X()-d.stdform[1]*u.Y()},function(){return-d.stdform[2]*u.Z()},function(){return d.stdform[1]*u.Z()}],I),C.elType="perpendicular",C.setParents([d.id,u.id]),JXG$1.exists(u._is_new)?(C.addChild(u),delete u._is_new):u.addChild(C),d.addChild(C),C};JXG$1.createPerpendicularPoint=function(n,t,o){var u,d,C;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[0]],o,"point")[0],u=t[1];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)d=JXG$1.providePoints(n,[t[1]],o,"point")[0],u=t[0];else throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,line]`);return C=n.create("point",[function(){return Geometry.perpendicular(u,d,n)[0]}],o),JXG$1.exists(d._is_new)?(C.addChild(d),delete d._is_new):d.addChild(C),u.addChild(C),C.elType="perpendicularpoint",C.setParents([d.id,u.id]),C.update(),C.generatePolynomial=function(){var I=u.point1.symbolic.x,f=u.point1.symbolic.y,A=u.point2.symbolic.x,y=u.point2.symbolic.y,G=d.symbolic.x,S=d.symbolic.y,w=C.symbolic.x,M=C.symbolic.y,V="("+f+")*("+w+")-("+f+")*("+A+")+("+M+")*("+A+")-("+I+")*("+M+")+("+I+")*("+y+")-("+w+")*("+y+")",T="("+S+")*("+f+")-("+S+")*("+y+")-("+M+")*("+f+")+("+M+")*("+y+")+("+G+")*("+I+")-("+G+")*("+A+")-("+w+")*("+I+")+("+w+")*("+A+")";return[V,T]},C};JXG$1.createPerpendicularSegment=function(n,t,o){var u,d,C,I,f;if(t[0]=n.select(t[0]),t[1]=n.select(t[1]),JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)d=t[1],u=JXG$1.providePoints(n,[t[0]],o,"point")[0];else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)d=t[0],u=JXG$1.providePoints(n,[t[1]],o,"point")[0];else throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point]`);return f=JXG$1.copyAttributes(o,n.options,"perpendicularsegment","point"),I=JXG$1.createPerpendicularPoint(n,[d,u],f),I.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),f=JXG$1.copyAttributes(o,n.options,"perpendicularsegment"),C=JXG$1.createLine(n,[function(){return Geometry.perpendicular(d,u,n)[1]?[I,u]:[u,I]}],f),C.point=I,JXG$1.exists(u._is_new)?(C.addChild(u),delete u._is_new):u.addChild(C),d.addChild(C),C.elType="perpendicularsegment",C.setParents([u.id,d.id]),C.subs={point:I},C.inherits.push(I),C};JXG$1.createMidpoint=function(n,t,o){var u,d,C,I,f;for(I=0;I<t.length;++I)t[I]=n.select(t[I]);if(t.length===2&&JXG$1.isPointType(n,t[0])&&JXG$1.isPointType(n,t[1]))t=JXG$1.providePoints(n,t,o,"point"),u=t[0],d=t[1];else if(t.length===1&&t[0].elementClass===Const.OBJECT_CLASS_LINE)u=t[0].point1,d=t[0].point2;else throw new Error(`JSXGraph: Can't create midpoint.
Possible parent types: [point,point], [line]`);return f=JXG$1.copyAttributes(o,n.options,"midpoint"),C=n.create("point",[function(){var A=u.coords.usrCoords[1]+d.coords.usrCoords[1];return isNaN(A)||Math.abs(u.coords.usrCoords[0])<Mat.eps||Math.abs(d.coords.usrCoords[0])<Mat.eps?NaN:A*.5},function(){var A=u.coords.usrCoords[2]+d.coords.usrCoords[2];return isNaN(A)||Math.abs(u.coords.usrCoords[0])<Mat.eps||Math.abs(d.coords.usrCoords[0])<Mat.eps?NaN:A*.5}],f),JXG$1.exists(u._is_new)?(C.addChild(u),delete u._is_new):u.addChild(C),JXG$1.exists(d._is_new)?(C.addChild(d),delete d._is_new):d.addChild(C),C.elType="midpoint",C.setParents([u.id,d.id]),C.prepareUpdate().update(),C.generatePolynomial=function(){var A=u.symbolic.x,y=u.symbolic.y,G=d.symbolic.x,S=d.symbolic.y,w=C.symbolic.x,M=C.symbolic.y,V="("+y+")*("+w+")-("+y+")*("+G+")+("+M+")*("+G+")-("+A+")*("+M+")+("+A+")*("+S+")-("+w+")*("+S+")",T="("+A+")^2 - 2*("+A+")*("+w+")+("+y+")^2-2*("+y+")*("+M+")-("+G+")^2+2*("+G+")*("+w+")-("+S+")^2+2*("+S+")*("+M+")";return[V,T]},C};JXG$1.createParallelPoint=function(n,t,o){var u,d,C,I,f,A;for(f=0;f<t.length;++f)t[f]=n.select(t[f]);if(t.length===3&&JXG$1.isPointType(n,t[0])&&JXG$1.isPointType(n,t[1])&&JXG$1.isPointType(n,t[2]))t=JXG$1.providePoints(n,t,o,"point"),u=t[0],d=t[1],C=t[2];else if(JXG$1.isPointType(n,t[0])&&t[1].elementClass===Const.OBJECT_CLASS_LINE)C=JXG$1.providePoints(n,[t[0]],o,"point")[0],u=t[1].point1,d=t[1].point2;else if(JXG$1.isPointType(n,t[1])&&t[0].elementClass===Const.OBJECT_CLASS_LINE)C=JXG$1.providePoints(n,[t[1]],o,"point")[0],u=t[0].point1,d=t[0].point2;else throw new Error("JSXGraph: Can't create parallel point with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [line,point], [point,point,point]`);return A=JXG$1.copyAttributes(o,n.options,"parallelpoint"),I=n.create("point",[function(){return C.coords.usrCoords[1]+d.coords.usrCoords[1]-u.coords.usrCoords[1]},function(){return C.coords.usrCoords[2]+d.coords.usrCoords[2]-u.coords.usrCoords[2]}],A),JXG$1.exists(u._is_new)?(I.addChild(u),delete u._is_new):u.addChild(I),JXG$1.exists(d._is_new)?(I.addChild(d),delete d._is_new):d.addChild(I),JXG$1.exists(C._is_new)?(I.addChild(C),delete C._is_new):C.addChild(I),I.elType="parallelpoint",I.setParents([u.id,d.id,C.id]),I.prepareUpdate().update(),I.generatePolynomial=function(){var y=u.symbolic.x,G=u.symbolic.y,S=d.symbolic.x,w=d.symbolic.y,M=C.symbolic.x,V=C.symbolic.y,T=I.symbolic.x,H=I.symbolic.y,J="("+w+")*("+T+")-("+w+")*("+M+")-("+G+")*("+T+")+("+G+")*("+M+")-("+H+")*("+S+")+("+H+")*("+y+")+("+V+")*("+S+")-("+V+")*("+y+")",z="("+H+")*("+y+")-("+H+")*("+M+")-("+w+")*("+y+")+("+w+")*("+M+")-("+T+")*("+G+")+("+T+")*("+V+")+("+S+")*("+G+")-("+S+")*("+V+")";return[J,z]},I};JXG$1.createParallel=function(n,t,o){var u,d,C,I,f,A,y=1;for(f=0;f<t.length;++f)t[f]=n.select(t[f]);return u=null,t.length===3?(t=JXG$1.providePoints(n,t,o,"point"),u=t[2],y=0):JXG$1.isPointType(n,t[0])?(u=JXG$1.providePoints(n,[t[0]],o,"point")[0],I=function(){return t[1].stdform}):JXG$1.isPointType(n,t[1])&&(u=JXG$1.providePoints(n,[t[1]],o,"point")[0],I=function(){return t[0].stdform}),JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),A=JXG$1.copyAttributes(o,n.options,"parallel","point"),y===1?d=n.create("point",[function(){return Mat.crossProduct([1,0,0],I())}],A):d=n.create("parallelpoint",t,A),d.isDraggable=!0,A=JXG$1.copyAttributes(o,n.options,"parallel"),C=n.create("line",[u,d],A),C.elType="parallel",C.subs={point:d},C.inherits.push(d),C.setParents([t[0].id,t[1].id]),t.length===3&&C.addParents(t[2].id),C.point=d,C};JXG$1.createArrowParallel=function(n,t,o){var u,d;try{return d=JXG$1.copyAttributes(o,n.options,"arrowparallel"),d.lastArrow===!1&&(d.lastArrow=!0),u=JXG$1.createParallel(n,t,d).setAttribute({straightFirst:!1,straightLast:!1}),u.type=Const.OBJECT_TYPE_VECTOR,u.elType="arrowparallel",u}catch{throw new Error("JSXGraph: Can't create arrowparallel with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,point], [point,point,point]`)}};JXG$1.createBisector=function(n,t,o){var u,d,C,I;if(t=JXG$1.providePoints(n,t,o,"point"),JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(I=JXG$1.copyAttributes(o,n.options,"bisector","point"),I.snapToGrid=!1,u=n.create("point",[function(){return Geometry.angleBisector(t[0],t[1],t[2],n)}],I),u.dump=!1,C=0;C<3;C++)JXG$1.exists(t[C]._is_new)?(u.addChild(t[C]),delete t[C]._is_new):t[C].addChild(u);return JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),I=JXG$1.copyAttributes(o,n.options,"bisector"),d=JXG$1.createLine(n,[t[1],u],I),d.point=u,d.elType="bisector",d.setParents(t),d.subs={point:u},d.inherits.push(u),d}throw new Error("JSXGraph: Can't create angle bisector with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createAngularBisectorsOfTwoLines=function(n,t,o){var u,d,C,I,f=n.select(t[0]),A=n.select(t[1]);if(f.elementClass!==Const.OBJECT_CLASS_LINE||A.elementClass!==Const.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create angle bisectors of two lines with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [line,line]`);return JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),C=JXG$1.copyAttributes(o,n.options,"bisectorlines","line1"),u=n.create("line",[function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[0]/y-A.stdform[0]/G},function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[1]/y-A.stdform[1]/G},function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[2]/y-A.stdform[2]/G}],C),JXG$1.exists(o.layer)||(o.layer=n.options.layer.line),C=JXG$1.copyAttributes(o,n.options,"bisectorlines","line2"),d=n.create("line",[function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[0]/y+A.stdform[0]/G},function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[1]/y+A.stdform[1]/G},function(){var y=Mat.hypot(f.stdform[1],f.stdform[2]),G=Mat.hypot(A.stdform[1],A.stdform[2]);return f.stdform[2]/y+A.stdform[2]/G}],C),I=new Composition({line1:u,line2:d}),u.dump=!1,d.dump=!1,I.elType="bisectorlines",I.setParents([f.id,A.id]),I.subs={line1:u,line2:d},I};JXG$1.createCircumcenter=function(n,t,o){var u,d,C,I,f;if(t=JXG$1.providePoints(n,t,o,"point"),JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(C=t[0],I=t[1],f=t[2],u=JXG$1.createPoint(n,[function(){return Geometry.circumcenter(C,I,f,n)}],o),d=0;d<3;d++)JXG$1.exists(t[d]._is_new)?(u.addChild(t[d]),delete t[d]._is_new):t[d].addChild(u);return u.elType="circumcenter",u.setParents(t),u.generatePolynomial=function(){var A=C.symbolic.x,y=C.symbolic.y,G=I.symbolic.x,S=I.symbolic.y,w=f.symbolic.x,M=f.symbolic.y,V=u.symbolic.x,T=u.symbolic.y,H=["((",V,")-(",A,"))^2+((",T,")-(",y,"))^2-((",V,")-(",G,"))^2-((",T,")-(",S,"))^2"].join(""),J=["((",V,")-(",A,"))^2+((",T,")-(",y,"))^2-((",V,")-(",w,"))^2-((",T,")-(",M,"))^2"].join("");return[H,J]},u}throw new Error("JSXGraph: Can't create circumcircle midpoint with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)};JXG$1.createIncenter=function(n,t,o){var u,d,C,I,f;if(t=JXG$1.providePoints(n,t,o,"point"),t.length>=3&&JXG$1.isPoint(t[0])&&JXG$1.isPoint(t[1])&&JXG$1.isPoint(t[2])){for(d=t[0],C=t[1],I=t[2],u=n.create("point",[function(){var A,y,G;return A=Mat.hypot(C.X()-I.X(),C.Y()-I.Y()),y=Mat.hypot(d.X()-I.X(),d.Y()-I.Y()),G=Mat.hypot(C.X()-d.X(),C.Y()-d.Y()),new Coords(Const.COORDS_BY_USER,[(A*d.X()+y*C.X()+G*I.X())/(A+y+G),(A*d.Y()+y*C.Y()+G*I.Y())/(A+y+G)],n)}],o),f=0;f<3;f++)JXG$1.exists(t[f]._is_new)?(u.addChild(t[f]),delete t[f]._is_new):t[f].addChild(u);u.elType="incenter",u.setParents(t)}else throw new Error("JSXGraph: Can't create incenter with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);return u};JXG$1.createCircumcircle=function(n,t,o){var u,d,C,I;if(t=JXG$1.providePoints(n,t,o,"point"),t===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);try{for(C=JXG$1.copyAttributes(o,n.options,"circumcircle","center"),u=JXG$1.createCircumcenter(n,t,C),u.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.circle),C=JXG$1.copyAttributes(o,n.options,"circumcircle"),d=JXG$1.createCircle(n,[u,t[0]],C),d.elType="circumcircle",d.setParents(t),d.subs={center:u},d.inherits.push(d),I=0;I<3;I++)JXG$1.exists(t[I]._is_new)?(d.addChild(t[I]),delete t[I]._is_new):t[I].addChild(d)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)}return d};JXG$1.createIncircle=function(n,t,o){var u,d,C,I;if(t=JXG$1.providePoints(n,t,o,"point"),t===!1)throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`);try{for(I=JXG$1.copyAttributes(o,n.options,"incircle","center"),d=JXG$1.createIncenter(n,t,I),d.dump=!1,JXG$1.exists(o.layer)||(o.layer=n.options.layer.circle),I=JXG$1.copyAttributes(o,n.options,"incircle"),C=JXG$1.createCircle(n,[d,function(){var f=Mat.hypot(t[1].X()-t[2].X(),t[1].Y()-t[2].Y()),A=Mat.hypot(t[0].X()-t[2].X(),t[0].Y()-t[2].Y()),y=Mat.hypot(t[1].X()-t[0].X(),t[1].Y()-t[0].Y()),G=(f+A+y)/2;return Math.sqrt((G-f)*(G-A)*(G-y)/G)}],I),C.elType="incircle",C.setParents(t),u=0;u<3;u++)JXG$1.exists(t[u]._is_new)?(C.addChild(t[u]),delete t[u]._is_new):t[u].addChild(C);C.center=d,C.subs={center:C.center},C.inherits.push(d)}catch{throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof t[0]+"', '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point,point]`)}return C};JXG$1.createReflection=function(n,t,o){var u,d,C,I,f,A,y,G,S=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, line]`;for(A=0;A<t.length;++A)t[A]=n.select(t[A]);if(y=JXG$1.copyAttributes(o,n.options,"reflection"),JXG$1.isPoint(t[0]))d=JXG$1.providePoints(n,[t[0]],G)[0];else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE||t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].type===Const.OBJECT_TYPE_POLYGON||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE)d=t[0];else throw new Error("JSXGraph: Can't create reflection element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);if(t[1].elementClass===Const.OBJECT_CLASS_LINE)u=t[1];else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);if(f=JXG$1.createTransform(n,[u],{type:"reflect"}),JXG$1.isPoint(d))C=JXG$1.createPoint(n,[d,f],y);else if(d.elementClass===Const.OBJECT_CLASS_CURVE)C=JXG$1.createCurve(n,[d,f],y);else if(d.elementClass===Const.OBJECT_CLASS_LINE)C=JXG$1.createLine(n,[d,f],y);else if(d.type===Const.OBJECT_TYPE_POLYGON)C=JXG$1.createPolygon(n,[d,f],y);else if(d.elementClass===Const.OBJECT_CLASS_CIRCLE)y.type.toLowerCase()==="euclidean"?(G=JXG$1.copyAttributes(o,n.options,"reflection","center"),I=JXG$1.createPoint(n,[d.center,f],G),I.prepareUpdate().update().updateVisibility(JXG$1.evaluate(I.visProp.visible)).updateRenderer(),C=JXG$1.createCircle(n,[I,function(){return d.Radius()}],y)):C=JXG$1.createCircle(n,[d,f],y);else throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);return JXG$1.exists(d._is_new)&&(C.addChild(d),delete d._is_new),u.addChild(C),C.elType="reflection",C.addParents(u),C.prepareUpdate().update(),JXG$1.isPoint(C)&&(C.generatePolynomial=function(){var w=u.point1.symbolic.x,M=u.point1.symbolic.y,V=u.point2.symbolic.x,T=u.point2.symbolic.y,H=d.symbolic.x,J=d.symbolic.y,z=C.symbolic.x,L=C.symbolic.y,K=["((",L,")-(",J,"))*((",M,")-(",T,"))+((",w,")-(",V,"))*((",z,")-(",H,"))"].join(""),O=["((",z,")-(",w,"))^2+((",L,")-(",M,"))^2-((",H,")-(",w,"))^2-((",J,")-(",M,"))^2"].join("");return[K,O]}),C};JXG$1.createMirrorElement=function(n,t,o){var u,d,C,I,f,A,y,G,S=`
Possible parent types: [point|line|curve|polygon|circle|arc|sector, point]`;for(d=0;d<t.length;++d)t[d]=n.select(t[d]);if(y=JXG$1.copyAttributes(o,n.options,"mirrorelement"),JXG$1.isPoint(t[0]))u=JXG$1.providePoints(n,[t[0]],y)[0];else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE||t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].type===Const.OBJECT_TYPE_POLYGON||t[0].elementClass===Const.OBJECT_CLASS_CIRCLE)u=t[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);if(JXG$1.isPoint(t[1]))G=JXG$1.copyAttributes(o,n.options,"mirrorelement","point"),C=JXG$1.providePoints(n,[t[1]],G)[0];else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);if(A=JXG$1.createTransform(n,[Math.PI,C],{type:"rotate"}),JXG$1.isPoint(u))I=JXG$1.createPoint(n,[u,A],y);else if(u.elementClass===Const.OBJECT_CLASS_CURVE)I=JXG$1.createCurve(n,[u,A],y);else if(u.elementClass===Const.OBJECT_CLASS_LINE)I=JXG$1.createLine(n,[u,A],y);else if(u.type===Const.OBJECT_TYPE_POLYGON)I=JXG$1.createPolygon(n,[u,A],y);else if(u.elementClass===Const.OBJECT_CLASS_CIRCLE)y.type.toLowerCase()==="euclidean"?(G=JXG$1.copyAttributes(o,n.options,"mirrorelement","center"),f=JXG$1.createPoint(n,[u.center,A],G),f.prepareUpdate().update().updateVisibility(JXG$1.evaluate(f.visProp.visible)).updateRenderer(),I=JXG$1.createCircle(n,[f,function(){return u.Radius()}],y)):I=JXG$1.createCircle(n,[u,A],y);else throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'."+S);return JXG$1.exists(u._is_new)&&(I.addChild(u),delete u._is_new),C.addChild(I),I.elType="mirrorelement",I.addParents(C),I.prepareUpdate().update(),I};JXG$1.createMirrorPoint=function(n,t,o){var u=JXG$1.createMirrorElement(n,t,o);return u.elType="mirrorpoint",u};JXG$1.createIntegral=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J=null,z;if(JXG$1.isArray(t[0])&&t[1].elementClass===Const.OBJECT_CLASS_CURVE)u=t[0],d=t[1];else if(JXG$1.isArray(t[1])&&t[0].elementClass===Const.OBJECT_CLASS_CURVE)u=t[1],d=t[0];else throw new Error("JSXGraph: Can't create integral with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[number|function,number|function],curve]`);return C=JXG$1.copyAttributes(o,n.options,"integral"),C.withLabel=!1,z=n.create("curve",[[0],[0]],C),I=u[0],f=u[1],JXG$1.isFunction(I)?(A=I,y=function(){return d.Y(A())},I=A()):(A=I,y=d.Y(I)),JXG$1.isFunction(f)?(G=f,S=function(){return d.Y(G())},f=G()):(G=f,S=d.Y(f)),C=JXG$1.copyAttributes(o,n.options,"integral","curveleft"),w=n.create("glider",[A,y,d],C),JXG$1.isFunction(A)&&w.hideElement(),C=JXG$1.copyAttributes(o,n.options,"integral","baseleft"),M=n.create("point",[function(){return JXG$1.evaluate(z.visProp.axis)==="y"?0:w.X()},function(){return JXG$1.evaluate(z.visProp.axis)==="y"?w.Y():0}],C),C=JXG$1.copyAttributes(o,n.options,"integral","curveright"),V=n.create("glider",[G,S,d],C),JXG$1.isFunction(G)&&V.hideElement(),C=JXG$1.copyAttributes(o,n.options,"integral","baseright"),T=n.create("point",[function(){return JXG$1.evaluate(z.visProp.axis)==="y"?0:V.X()},function(){return JXG$1.evaluate(z.visProp.axis)==="y"?V.Y():0}],C),C=JXG$1.copyAttributes(o,n.options,"integral"),C.withlabel!==!1&&C.axis!=="y"&&(C=JXG$1.copyAttributes(o,n.options,"integral","label"),C=JXG$1.copyAttributes(C,n.options,"label"),J=n.create("text",[function(){var L=new Coords(Const.COORDS_BY_SCREEN,[JXG$1.evaluate(this.visProp.offset[0])+this.board.origin.scrCoords[1],0],this.board,!1),K=this.board.getBoundingBox(),O=(K[2]-K[0])*.1,Q=V.X();return Q<K[0]?Q=K[0]+O:Q>K[2]&&(Q=K[2]-O),Q+L.usrCoords[1]},function(){var L=new Coords(Const.COORDS_BY_SCREEN,[0,JXG$1.evaluate(this.visProp.offset[1])+this.board.origin.scrCoords[2]],this.board,!1),K=this.board.getBoundingBox(),O=(K[1]-K[3])*.1,Q=V.Y();return Q>K[1]?Q=K[1]-O:Q<K[3]&&(Q=K[3]+O),Q+L.usrCoords[2]},""],C),H=function(){var L=Numerics.NewtonCotes([M.X(),T.X()],d.Y),K=JXG$1.evaluate(J.visProp.digits),O;return J.useLocale()?O=J.formatNumberLocale(L,K):O=JXG$1.toFixed(L,K),"&int; = "+O},J.setText(H),J.dump=!1,w.addChild(J),V.addChild(J)),w.dump=!1,M.dump=!1,V.dump=!1,T.dump=!1,z.elType="integral",z.setParents([d.id,u]),z.subs={curveLeft:w,baseLeft:M,curveRight:V,baseRight:T},z.inherits.push(w,M,V,T),C.withLabel&&(z.subs.label=J,z.inherits.push(J)),z.Value=function(){return Numerics.I([M.X(),T.X()],d.Y)},z.updateDataArray=function(){var L,K,O,Q,ee,ie,te,se,ae;if(JXG$1.evaluate(this.visProp.axis)==="y"){for(w.Y()<V.Y()?(ie=w.X(),se=w.Y(),te=V.X(),ae=V.Y()):(ie=V.X(),se=V.Y(),te=w.X(),ae=w.Y()),Q=Math.min(ie,te),ee=Math.max(ie,te),L=[0,ie],K=[se,se],O=0;O<d.numberPoints;O++)se<=d.points[O].usrCoords[2]&&Q<=d.points[O].usrCoords[1]&&d.points[O].usrCoords[2]<=ae&&d.points[O].usrCoords[1]<=ee&&(L.push(d.points[O].usrCoords[1]),K.push(d.points[O].usrCoords[2]));L.push(te),K.push(ae),L.push(0),K.push(ae),L.push(0),K.push(se)}else{for(M.X()<T.X()?(Q=M.X(),ee=T.X()):(Q=T.X(),ee=M.X()),L=[Q,Q],K=[0,d.Y(Q)],O=0;O<d.numberPoints;O++)Q<=d.points[O].usrCoords[1]&&d.points[O].usrCoords[1]<=ee&&(L.push(d.points[O].usrCoords[1]),K.push(d.points[O].usrCoords[2]));L.push(ee),K.push(d.Y(ee)),L.push(ee),K.push(0),L.push(Q),K.push(0)}this.dataX=L,this.dataY=K},w.addChild(z),V.addChild(z),M.addChild(z),T.addChild(z),z.baseLeft=M,z.baseRight=T,z.curveLeft=w,z.curveRight=V,z.methodMap=JXG$1.deepCopy(z.methodMap,{curveLeft:"curveLeft",baseLeft:"baseLeft",curveRight:"curveRight",baseRight:"baseRight",Value:"Value"}),z.label=J,z};JXG$1.createInequality=function(n,t,o){var u,d,C;if(C=JXG$1.copyAttributes(o,n.options,"inequality"),t[0].elementClass===Const.OBJECT_CLASS_LINE)d=n.create("curve",[[],[]],C),d.hasPoint=function(){return!1},d.updateDataArray=function(){var I,f,A,y=n.getBoundingBox(),G=JXG$1.evaluate(this.visProp.inverse),S=G?-1:1,w=1.5,M=w*Math.max(y[2]-y[0],y[1]-y[3]),V={coords:{usrCoords:[1,(y[0]+y[2])*.5,G?y[1]:y[3]]}},T=t[0].stdform.slice(1),H=T;A=w*Math.max(Geometry.perpendicular(t[0],V,n)[0].distance(Const.COORDS_BY_USER,V.coords),M),A*=S,V={coords:{usrCoords:[1,(y[0]+y[2])*.5,(y[1]+y[3])*.5]}},Math.abs(Mat.innerProduct(V.coords.usrCoords,t[0].stdform,3))>=Mat.eps?V=Geometry.perpendicular(t[0],V,n)[0].usrCoords:V=V.coords.usrCoords,I=[1,V[1]+T[1]*M,V[2]-T[0]*M],f=[1,V[1]-H[1]*M,V[2]+H[0]*M],this.dataX=[I[1],I[1]+T[0]*A,f[1]+H[0]*A,f[1],I[1]],this.dataY=[I[2],I[2]+T[1]*A,f[2]+H[1]*A,f[2],I[2]]};else if(t[0].elementClass===Const.OBJECT_CLASS_CURVE&&t[0].visProp.curvetype==="functiongraph")d=n.create("curve",[[],[]],C),d.updateDataArray=function(){var I=this.board.getBoundingBox(),f=[],A,y,G,S,w,M=t[0].minX(),V=t[0].maxX(),T,H,J,z,L=(I[1]-I[3])*.3,K=JXG$1.evaluate(this.visProp.inverse);if(A=K?1:3,this.dataX=[],this.dataY=[],S=t[0].points.length,S!==0)for(I[1]+=L,I[3]-=L,G=-1;G<S-1;){for(w=G+1,y=S;w<S;w++)if(t[0].points[w].isReal()){y=w;break}if(y>=S)break;for(w=y,G=S-1;w<S-1;w++)if(!t[0].points[w+1].isReal()){G=w;break}for(J=t[0].points[y].usrCoords[1],z=t[0].points[G].usrCoords[1],T=I[0]<M?M:I[0],H=I[2]>V?V:I[2],T=y===0?T:Math.max(T,J),H=G===S-1?H:Math.min(H,z),T=y===0?M:J,H=G===S-1?V:z,f=[],f.push([1,T,I[A]]),f.push([1,T,t[0].points[y].usrCoords[2]]),w=y;w<=G;w++)f.push(t[0].points[w].usrCoords);for(f.push([1,H,t[0].points[G].usrCoords[2]]),f.push([1,H,I[A]]),f.push(f[0]),w=0;w<f.length;w++)this.dataX.push(f[w][1]),this.dataY.push(f[w][2]);G<S-1&&(this.dataX.push(NaN),this.dataY.push(NaN))}},d.hasPoint=function(){return!1};else if(u=JXG$1.createFunction(t[0]),d.addParentsFromJCFunctions([u]),!JXG$1.exists(u))throw new Error(`JSXGraph: Can't create area with the given parents.
Possible parent types: [line], [function]`);return d.addParents(t[0]),d};JXG$1.registerElement("arrowparallel",JXG$1.createArrowParallel);JXG$1.registerElement("bisector",JXG$1.createBisector);JXG$1.registerElement("bisectorlines",JXG$1.createAngularBisectorsOfTwoLines);JXG$1.registerElement("msector",JXG$1.createMsector);JXG$1.registerElement("circumcircle",JXG$1.createCircumcircle);JXG$1.registerElement("circumcirclemidpoint",JXG$1.createCircumcenter);JXG$1.registerElement("circumcenter",JXG$1.createCircumcenter);JXG$1.registerElement("incenter",JXG$1.createIncenter);JXG$1.registerElement("incircle",JXG$1.createIncircle);JXG$1.registerElement("integral",JXG$1.createIntegral);JXG$1.registerElement("midpoint",JXG$1.createMidpoint);JXG$1.registerElement("mirrorelement",JXG$1.createMirrorElement);JXG$1.registerElement("mirrorpoint",JXG$1.createMirrorPoint);JXG$1.registerElement("orthogonalprojection",JXG$1.createOrthogonalProjection);JXG$1.registerElement("parallel",JXG$1.createParallel);JXG$1.registerElement("parallelpoint",JXG$1.createParallelPoint);JXG$1.registerElement("perpendicular",JXG$1.createPerpendicular);JXG$1.registerElement("perpendicularpoint",JXG$1.createPerpendicularPoint);JXG$1.registerElement("perpendicularsegment",JXG$1.createPerpendicularSegment);JXG$1.registerElement("reflection",JXG$1.createReflection);JXG$1.registerElement("inequality",JXG$1.createInequality);JXG$1.createGrid=function(n,t,o){var u=Mat.eps,d=5e3,C,I,f,A,y,G,S,w=[],M=[],V;if(f=t,f.length>2||f.length>=1&&f[0].elType!=="axis"||f.length>=2&&f[1].elType!=="axis")throw new Error("JSXGraph: Can't create 'grid' with parent type '"+t[0].elType+"'. Possible parent types: [axis,axis]");return!JXG$1.exists(f[0])&&JXG$1.exists(n.defaultAxes)&&(f[0]=n.defaultAxes.x),!JXG$1.exists(f[1])&&JXG$1.exists(n.defaultAxes)&&(f[1]=n.defaultAxes.y),V=function(T,H,J,z,L,K,O){var Q,ee,ie,te,se,ae,le;switch(T.toLowerCase()){case".":case"point":return H.visProp.linecap="round",H.visProp.strokewidth=L*H.board.unitX+K*H.board.unitY,[[J,J,NaN],[z,z,NaN]];case"o":case"circle":return H.visProp.linecap="square",H.bezierDegree=3,ee=4*Math.tan(Math.PI/8)/3,[[J+L,J+L,J+ee*L,J,J-ee*L,J-L,J-L,J-L,J-ee*L,J,J+ee*L,J+L,J+L,NaN],[z,z+ee*K,z+K,z+K,z+K,z+ee*K,z,z-ee*K,z-K,z-K,z-K,z-ee*K,z,NaN]];case"regpol":case"regularpolygon":for(H.visProp.linecap="round",te=JXG$1.evaluate(H.visProp.polygonvertices),se=[[],[]],Q=0;Q<=2*Math.PI;Q+=2*Math.PI/te)se[0].push(J-L*Math.sin(Q)),se[1].push(z-K*Math.cos(Q));return se[0].push(NaN),se[1].push(NaN),se;case"[]":case"square":return H.visProp.linecap="square",[[J-L,J+L,J+L,J-L,J-L,NaN],[z+K,z+K,z-K,z-K,z+K,NaN]];case"<>":case"diamond":return H.visProp.linecap="square",[[J,J+L,J,J-L,J,NaN],[z+K,z,z-K,z,z+K,NaN]];case"<<>>":case"diamond2":return H.visProp.linecap="square",ae=L*Math.sqrt(2),le=K*Math.sqrt(2),[[J,J+ae,J,J-ae,J,NaN],[z+le,z,z-le,z,z+le,NaN]];case"x":case"cross":return[[J-L,J+L,NaN,J-L,J+L,NaN],[z+K,z-K,NaN,z-K,z+K,NaN]];case"+":case"plus":return[[J-L,J+L,NaN,J,J,NaN],[z,z,NaN,z-K,z+K,NaN]];case"-":case"minus":return[[J-L,J+L,NaN],[z,z,NaN]];case"|":case"divide":return[[J,J,NaN],[z-K,z+K,NaN]];case"^":case"a":case"A":case"triangleup":return[[J-L,J,J+L,NaN],[z-K,z,z-K,NaN]];case"v":case"triangledown":return[[J-L,J,J+L,NaN],[z+K,z,z+K,NaN]];case"<":case"triangleleft":return[[J+L,J,J+L,NaN],[z+K,z,z-K,NaN]];case">":case"triangleright":return[[J-L,J,J-L,NaN],[z+K,z,z-K,NaN]];case"line":return ie=JXG$1.evaluate(H.visProp.margin),[[J,J,NaN,O[0]-ie/H.board.unitX,O[2]+ie/H.board.unitX,NaN],[O[1]+ie/H.board.unitY,O[3]-ie/H.board.unitY,NaN,z,z,NaN]];default:return[[],[]]}},A=JXG$1.copyAttributes(o,n.options,"grid"),JXG$1.mergeAttr(A,A.themes[A.theme],!1),y={},JXG$1.mergeAttr(y,A,!0,!0),JXG$1.mergeAttr(y,A.major,!0,!0),C=n.create("curve",[[null],[null]],y),C.elType="grid",C.type=Const.OBJECT_TYPE_GRID,G={},JXG$1.mergeAttr(G,A,!0,!0),JXG$1.mergeAttr(G,A.minor,!0,!0),G.id===y.id&&(G.id=C.id+"_minor"),G.name===y.name&&(G.name=C.name+"_minor"),I=n.create("curve",[[null],[null]],G),I.elType="grid",I.type=Const.OBJECT_TYPE_GRID,C.minorGrid=I,I.majorGrid=C,C.hasPoint=function(){return!1},I.hasPoint=function(){return!1},C.inherits.push(I),C.updateDataArray=function(){var T=this.board.getBoundingBox(),H,J,z,L,K,O,Q,ee,ie=JXG$1.evaluate(this.visProp.gridx),te=JXG$1.evaluate(this.visProp.gridy),se=JXG$1.evaluate(this.visProp.face),ae=JXG$1.evaluate(this.visProp.drawzero),le=ae===!0||JXG$1.isObject(ae)&&JXG$1.evaluate(ae.origin)===!0,ge=ae===!0||JXG$1.isObject(ae)&&JXG$1.evaluate(ae.x)===!0,be=ae===!0||JXG$1.isObject(ae)&&JXG$1.evaluate(ae.y)===!0,Xe=JXG$1.evaluate(this.visProp.includeboundaries),Ce=JXG$1.evaluate(this.visProp.forcesquare);if(this.dataX=[],this.dataY=[],S=JXG$1.evaluate(this.visProp.majorstep),JXG$1.isArray(S)||(S=[S,S]),S.length<2&&(S=[S[0],S[0]]),JXG$1.exists(ie)&&(JXG$1.deprecated("gridX","majorStep"),S[0]=ie),JXG$1.exists(te)&&(JXG$1.deprecated("gridY","majorStep"),S[1]=te),S[0]==="auto"?(ee=Math.pow(10,Math.floor(Math.log(50/this.board.unitX)/Math.LN10)),S[0]=ee,JXG$1.exists(f[0])&&(S[0]=f[0].ticks[0].getDistanceMajorTicks())):S[0]=JXG$1.parseNumber(S[0],Math.abs(T[1]-T[3]),1/this.board.unitX),S[1]==="auto"?(ee=Math.pow(10,Math.floor(Math.log(50/this.board.unitY)/Math.LN10)),S[1]=ee,JXG$1.exists(f[1])&&(S[1]=f[1].ticks[0].getDistanceMajorTicks())):S[1]=JXG$1.parseNumber(S[1],Math.abs(T[0]-T[2]),1/this.board.unitY),Ce==="min"||Ce===!0?S[0]*this.board.unitX<=S[1]*this.board.unitY?S[1]=S[0]/this.board.unitY*this.board.unitX:S[0]=S[1]/this.board.unitX*this.board.unitY:Ce==="max"&&(S[0]*this.board.unitX<=S[1]*this.board.unitY?S[0]=S[1]/this.board.unitX*this.board.unitY:S[1]=S[0]/this.board.unitY*this.board.unitX),w=JXG$1.evaluate(this.visProp.size),JXG$1.isArray(w)||(w=[w,w]),w.length<2&&(w=[w[0],w[0]]),JXG$1.isNumber(w[0],!0)&&(w[0]=w[0]+"px"),JXG$1.isNumber(w[1],!0)&&(w[1]=w[1]+"px"),w[0]=JXG$1.parseNumber(w[0],S[0],1/this.board.unitX),w[1]=JXG$1.parseNumber(w[1],S[1],1/this.board.unitY),M[0]=w[0]/2,M[1]=w[1]/2,H=Mat.roundToStep(T[0],S[0]),J=Mat.roundToStep(T[1],S[1]),Q=isFinite(H)&&isFinite(J)&&isFinite(T[2])&&isFinite(T[3])&&Math.abs(T[2])<Math.abs(S[0]*d)&&Math.abs(T[3])<Math.abs(S[1]*d),se.toLowerCase()==="line"){for(K=JXG$1.evaluate(C.visProp.margin),L=J;Q&&L>=T[3];L-=S[1])!le&&Math.abs(L)<u||!be&&Math.abs(L)<u||!Xe&&(L<=T[3]+M[1]||L>=T[1]-M[1])||(O=[[T[0]-K/C.board.unitX,T[2]+K/C.board.unitX,NaN],[L,L,NaN]],JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1]));for(z=H;Q&&z<=T[2];z+=S[0])!le&&Math.abs(z)<u||!ge&&Math.abs(z)<u||!Xe&&(z<=T[0]+M[0]||z>=T[2]-M[0])||(O=[[z,z,NaN],[T[1]+K/C.board.unitY,T[3]-K/C.board.unitY,NaN]],JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1]))}else for(L=J;Q&&L>=T[3];L-=S[1])for(z=H;Q&&z<=T[2];z+=S[0])!le&&Math.abs(L)<u&&Math.abs(z)<u||!ge&&Math.abs(L)<u&&Math.abs(z)>=u||!be&&Math.abs(z)<u&&Math.abs(L)>=u||!Xe&&(z<=T[0]+M[0]||z>=T[2]-M[0]||L<=T[3]+M[1]||L>=T[1]-M[1])||(O=V(se,C,z,L,M[0],M[1],T),JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1]))},I.updateDataArray=function(){var T=this.board.getBoundingBox(),H,J,z,L,K,O,Q,ee=[],ie=[],te,se,ae,le,ge,be,Xe,Ce,Re,Se,Ze,he,Ie=JXG$1.evaluate(this.visProp.minorelements),Be=JXG$1.evaluate(this.visProp.size),ue=JXG$1.evaluate(this.visProp.face),me=JXG$1.evaluate(this.visProp.drawzero),xe=me===!0||JXG$1.isObject(me)&&JXG$1.evaluate(me.x)===!0,Je=me===!0||JXG$1.isObject(me)&&JXG$1.evaluate(me.y)===!0,Ve=JXG$1.evaluate(this.majorGrid.visProp.face),Ee=JXG$1.evaluate(this.majorGrid.visProp.drawzero),Ct=Ee===!0||JXG$1.isObject(Ee)&&JXG$1.evaluate(Ee.origin)===!0,st=Ee===!0||JXG$1.isObject(Ee)&&JXG$1.evaluate(Ee.x)===!0,wt=Ee===!0||JXG$1.isObject(Ee)&&JXG$1.evaluate(Ee.y)===!0,Qe=JXG$1.evaluate(this.visProp.includeboundaries);if(this.dataX=[],this.dataY=[],JXG$1.isArray(Ie)||(Ie=[Ie,Ie]),Ie.length<2&&(Ie=[Ie[0],Ie[0]]),JXG$1.isNumber(Ie[0],!0)?Ie[0]=parseFloat(Ie[0]):(Ie[0]=3,JXG$1.exists(f[0])&&(Ie[0]=JXG$1.evaluate(f[0].getAttribute("ticks").minorticks))),ee[0]=S[0]/(Ie[0]+1),JXG$1.isNumber(Ie[1],!0)?Ie[1]=parseFloat(Ie[1]):(Ie[1]=3,JXG$1.exists(f[1])&&(Ie[1]=JXG$1.evaluate(f[1].getAttribute("ticks").minorticks))),ee[1]=S[1]/(Ie[1]+1),JXG$1.isArray(Be)||(Be=[Be,Be]),Be.length<2&&(Be=[Be[0],Be[0]]),JXG$1.isNumber(Be[0],!0)&&(Be[0]=Be[0]+"px"),JXG$1.isNumber(Be[1],!0)&&(Be[1]=Be[1]+"px"),Be[0]=JXG$1.parseNumber(Be[0],ee[0],1/this.board.unitX),Be[1]=JXG$1.parseNumber(Be[1],ee[1],1/this.board.unitY),ie[0]=Be[0]*.5,ie[1]=Be[1]*.5,H=Mat.roundToStep(T[0],ee[0]),J=Mat.roundToStep(T[1],ee[1]),Q=isFinite(H)&&isFinite(J)&&isFinite(T[2])&&isFinite(T[3])&&Math.abs(T[2])<=Math.abs(ee[0]*d)&&Math.abs(T[3])<Math.abs(ee[1]*d),ue.toLowerCase()!=="line")for(L=J;Q&&L>=T[3];L-=ee[1])for(z=H;Q&&z<=T[2];z+=ee[0]){if(te=Mat.roundToStep(Math.abs(z),S[0]),te=Math.abs(te-Math.abs(z)),se=S[0]-te,ae=Mat.roundToStep(Math.abs(L),S[1]),ae=Math.abs(ae-Math.abs(L)),le=S[1]-ae,Ve==="line"){if(te-ie[0]-M[0]<u||se-ie[0]-M[0]<u||ae-ie[1]-M[1]<u||le-ie[1]-M[1]<u)continue}else if((te-ie[0]-M[0]<u||se-ie[0]-M[0]<u)&&(ae-ie[1]-M[1]<u||le-ie[1]-M[1]<u)&&(Ct||M[1]-Math.abs(L)+ie[1]<u||M[0]-Math.abs(z)+ie[0]<u)&&(st||M[1]-Math.abs(L)+ie[1]<u||M[0]+Math.abs(z)-ie[0]<u)&&(wt||M[0]-Math.abs(z)+ie[0]<u||M[1]+Math.abs(L)-ie[1]<u))continue;!Je&&Math.abs(z)<u||!xe&&Math.abs(L)<u||(ge=Math.abs(T[0]%S[0]),be=Math.abs(T[1]%S[1]),Xe=Math.abs(T[2]%S[0]),Ce=Math.abs(T[3]%S[1]),Re=S[0]-ge,Se=S[1]-be,Ze=S[0]-Xe,he=S[1]-Ce,!(!Qe&&(z-ie[0]-T[0]-M[0]+Re<u&&Re-M[0]<u||z-ie[0]-T[0]-M[0]-ge<u&&ge-M[0]<u||-z-ie[0]+T[2]-M[0]+Ze<u&&Ze-M[0]<u||-z-ie[0]+T[2]-M[0]-Xe<u&&Xe-M[0]<u||-L-ie[1]+T[1]-M[1]+Se<u&&Se-M[1]<u||-L-ie[1]+T[1]-M[1]-be<u&&be-M[1]<u||L-ie[1]-T[3]-M[1]+he<u&&he-M[1]<u||L-ie[1]-T[3]-M[1]-Ce<u&&Ce-M[1]<u||-L-ie[1]+T[1]<u||z-ie[0]-T[0]<u||L-ie[1]-T[3]<u||-z-ie[0]+T[2]<u))&&(O=V(ue,I,z,L,ie[0],ie[1],T),JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1])))}else{for(K=JXG$1.evaluate(I.visProp.margin),L=J;Q&&L>=T[3];L-=ee[1]){if(ae=Mat.roundToStep(Math.abs(L),S[1]),ae=Math.abs(ae-Math.abs(L)),le=S[1]-ae,Ve==="line"){if(ae-ie[1]-M[1]<u||le-ie[1]-M[1]<u)continue}else if((ae-ie[1]-M[1]<u||le-ie[1]-M[1]<u)&&(Ct||M[1]-Math.abs(L)+ie[1]<u)&&(st||M[1]-Math.abs(L)+ie[1]<u)&&(wt||M[1]+Math.abs(L)-ie[1]<u))continue;!xe&&Math.abs(L)<u||(ge=Math.abs(T[0]%S[0]),be=Math.abs(T[1]%S[1]),Xe=Math.abs(T[2]%S[0]),Ce=Math.abs(T[3]%S[1]),Re=S[0]-ge,Se=S[1]-be,Ze=S[0]-Xe,he=S[1]-Ce,!(!Qe&&(-L-ie[1]+T[1]-M[1]+Se<u&&Se-M[1]<u||-L-ie[1]+T[1]-M[1]-be<u&&be-M[1]<u||L-ie[1]-T[3]-M[1]+he<u&&he-M[1]<u||L-ie[1]-T[3]-M[1]-Ce<u&&Ce-M[1]<u||-L-ie[1]+T[1]<u||L-ie[1]-T[3]<u))&&(O=[[T[0]-K/I.board.unitX,T[2]+K/I.board.unitX,NaN],[L,L,NaN]],JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1])))}for(z=H;Q&&z<=T[2];z+=ee[0]){if(te=Mat.roundToStep(Math.abs(z),S[0]),te=Math.abs(te-Math.abs(z)),se=S[0]-te,Ve==="line"){if(te-ie[0]-M[0]<u||se-ie[0]-M[0]<u)continue}else if((te-ie[0]-M[0]<u||se-ie[0]-M[0]<u)&&(Ct||M[0]-Math.abs(z)+ie[0]<u)&&(st||M[0]+Math.abs(z)-ie[0]<u)&&(wt||M[0]-Math.abs(z)+ie[0]<u))continue;!Je&&Math.abs(z)<u||(ge=Math.abs(T[0]%S[0]),be=Math.abs(T[1]%S[1]),Xe=Math.abs(T[2]%S[0]),Ce=Math.abs(T[3]%S[1]),Re=S[0]-ge,Se=S[1]-be,Ze=S[0]-Xe,he=S[1]-Ce,!(!Qe&&(z-ie[0]-T[0]-M[0]+Re<u&&Re-M[0]<u||z-ie[0]-T[0]-M[0]-ge<u&&ge-M[0]<u||-z-ie[0]+T[2]-M[0]+Ze<u&&Ze-M[0]<u||-z-ie[0]+T[2]-M[0]-Xe<u&&Xe-M[0]<u||z-ie[0]-T[0]<u||-z-ie[0]+T[2]<u))&&(O=[[z,z,NaN],[T[1]+K/I.board.unitY,T[3]-K/I.board.unitY,NaN]],JXG$1.concat(this.dataX,O[0]),JXG$1.concat(this.dataY,O[1])))}}},n.grids.push(C),n.grids.push(I),C};JXG$1.registerElement("grid",JXG$1.createGrid);JXG$1.Image=function(n,t,o,u,d){this.constructor(n,o,Const.OBJECT_TYPE_IMAGE,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this.W=JXG$1.createFunction(d[0],this.board,""),this.H=JXG$1.createFunction(d[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*n.unitX),Math.abs(this.usrSize[1]*n.unitY)],this.url=u,this.elType="image",this.span=[this.coords.usrCoords.slice(0),[this.coords.usrCoords[0],this.W(),0],[this.coords.usrCoords[0],0,this.H()]],this.id=this.board.setId(this,"Im"),this.board.renderer.drawImage(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H",setSize:"setSize"})};JXG$1.Image.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Image,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.Image.prototype,{hasPoint:function(n,t){var o,u,d,C,I,f,A,y,G,S=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(C=this.board._inputDevice,I=JXG$1.evaluate(this.visProp.precision[C])):I=this.board.options.precision.hasPoint,S===0?(o=n-this.coords.scrCoords[1],u=this.coords.scrCoords[2]-t,d=I,o>=-d&&o-this.size[0]<=d&&u>=-d&&u-this.size[1]<=d):(f=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),f=f.usrCoords,A=[f[0]-this.span[0][0],f[1]-this.span[0][1],f[2]-this.span[0][2]],G=Mat.innerProduct,y=G(A,this.span[1]),0<=y&&y<=G(this.span[1],this.span[1])&&(y=G(A,this.span[2]),0<=y&&y<=G(this.span[2],this.span[2])))},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateSize(),this.updateSpan(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateImage")},updateSize:function(){return this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)],this},updateSpan:function(){var n,t,o=this.transformations.length,u=[];if(o===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(u[0]=[this.Z(),this.X(),this.Y()],u[1]=[this.Z(),this.X()+this.W(),this.Y()],u[2]=[this.Z(),this.X(),this.Y()+this.H()],n=0;n<o;n++)for(t=0;t<3;t++)u[t]=Mat.matVecMult(this.transformations[n].matrix,u[t]);for(t=0;t<3;t++)u[t][1]/=u[t][0],u[t][2]/=u[t][0],u[t][0]/=u[t][0];for(t=1;t<3;t++)u[t][0]-=u[0][0],u[t][1]-=u[0][1],u[t][2]-=u[0][2];this.span=u}return this},addTransform:function(n){var t;if(JXG$1.isArray(n))for(t=0;t<n.length;t++)this.transformations.push(n[t]);else this.transformations.push(n);return this},getParents:function(){var n=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(n=this.parents),n},setSize:function(n,t){return this.W=JXG$1.createFunction(n,this.board,""),this.H=JXG$1.createFunction(t,this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createImage=function(n,t,o){var u,d,C=t[0],I=t[1],f=t[2];if(u=JXG$1.copyAttributes(o,n.options,"image"),d=CoordsElement.create(JXG$1.Image,n,I,u,C,f),!d)throw new Error("JSXGraph: Can't create image with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [x,y], [z,x,y], [element,transformation]`);return u.rotate!==0&&d.addRotation(u.rotate),d};JXG$1.registerElement("image",JXG$1.createImage);JXG$1.Image;JXG$1.createSlider=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se;return se=JXG$1.copyAttributes(o,n.options,"slider"),K=se.withticks,L=se.withlabel,ee=se.snapwidth,O=se.snapvalues,Q=se.snapvaluedistance,y=n.create("point",t[0],se.point1),G=n.create("point",t[1],se.point2),w=n.create("segment",[y,G],se.baseline),w.updateStdform(),u=y.coords.usrCoords.slice(1),d=G.coords.usrCoords.slice(1),C=t[2][0],I=t[2][1],f=t[2][2],A=f-C,ie=JXG$1.evaluate(ee),te=ie===-1?I:Math.round(I/ie)*ie,J=u[0]+(d[0]-u[0])*(te-C)/(f-C),z=u[1]+(d[1]-u[1])*(te-C)/(f-C),se.withlabel=!1,S=n.create("glider",[J,z,w],se),S.setAttribute({snapwidth:ee,snapvalues:O,snapvaluedistance:Q}),M=n.create("segment",[y,S],se.highline),S.Value=function(){var ae=this._smax-this._smin,le=JXG$1.evaluate(this.visProp.snapwidth);return le===-1?this.position*ae+this._smin:Math.round((this.position*ae+this._smin)/le)*le},S.methodMap=JXG$1.deepCopy(S.methodMap,{Value:"Value",setValue:"setValue",smax:"_smax",smin:"_smin",setMax:"setMax",setMin:"setMin",point1:"point1",point2:"point2",baseline:"baseline",highline:"highline",ticks:"ticks",label:"label"}),S._smax=f,S._smin=C,S.setMax=function(ae){return this._smax=ae,this},S.setValue=function(ae){var le=this._smax-this._smin;return Math.abs(le)>Mat.eps?this.position=(ae-this._smin)/le:this.position=0,this.position=Math.max(0,Math.min(1,this.position)),this},S.setMin=function(ae){return this._smin=ae,this},L&&(H=n.create("text",[function(){return(G.X()-y.X())*.05+G.X()},function(){return(G.Y()-y.Y())*.05+G.Y()},function(){var ae,le=JXG$1.evaluate(S.visProp.digits),ge=JXG$1.evaluate(S.visProp.suffixlabel),be=JXG$1.evaluate(S.visProp.unitlabel),Xe=JXG$1.evaluate(S.visProp.postlabel);return le===2&&JXG$1.evaluate(S.visProp.precision)!==2&&(le=JXG$1.evaluate(S.visProp.precision)),ge!==null?ae=ge:S.name&&S.name!==""?ae=S.name+" = ":ae="",S.useLocale()?ae+=S.formatNumberLocale(S.Value(),le):ae+=JXG$1.toFixed(S.Value(),le),be!==null&&(ae+=be),Xe!==null&&(ae+=Xe),ae}],se.label),S.label=H,S.visProp.withlabel=!0,S.hasLabel=!0),S.point1=y,S.point2=G,S.baseline=w,S.highline=M,K&&(JXG$1.exists(se.generatelabeltext)||(se.ticks.generateLabelText=function(ae,le,ge){var be,Xe=S.point1.Dist(S.point2),Ce=S._smin,Re=S._smax,Se=this.getDistanceFromZero(le,ae)*(Re-Ce)/Xe+Ce;return Xe<Mat.eps||Math.abs(Se)<Mat.eps?be="0":be=this.formatLabelText(Se),be}),V=2,T=n.create("ticks",[S.baseline,S.point1.Dist(y)/V,function(ae){var le=S.point1.Dist(S.point2),ge=S.point1.coords.distance(Const.COORDS_BY_USER,ae);return le<Mat.eps?0:ge/le*A+C}],se.ticks),S.ticks=T),S.remove=function(){L&&n.removeObject(H),n.removeObject(M),n.removeObject(w),n.removeObject(G),n.removeObject(y),Point.prototype.remove.call(S)},y.dump=!1,G.dump=!1,w.dump=!1,M.dump=!1,L&&(H.dump=!1),S.elType="slider",S.parents=t,S.subs={point1:y,point2:G,baseLine:w,highLine:M},S.inherits.push(y,G,w,M),w.inherits=[],M.inherits=[],K&&(T.dump=!1,S.subs.ticks=T,S.inherits.push(T)),S.getParents=function(){return[this.point1.coords.usrCoords.slice(1),this.point2.coords.usrCoords.slice(1),[this._smin,this.position*(this._smax-this._smin)+this._smin,this._smax]]},S.baseline.on("up",function(ae){var le,ge;JXG$1.evaluate(S.visProp.moveonup)&&!JXG$1.evaluate(S.visProp.fixed)&&(le=w.board.getMousePosition(ae,0),ge=new Coords(Const.COORDS_BY_SCREEN,le,this.board),S.moveTo([ge.usrCoords[1],ge.usrCoords[2]]),S.triggerEventHandlers(["drag"],[ae]))}),S.prepareUpdate().update(),n.isSuspendedUpdate||(S.updateVisibility().updateRenderer(),S.baseline.updateVisibility().updateRenderer(),S.highline.updateVisibility().updateRenderer(),K&&S.ticks.updateVisibility().updateRenderer()),S};JXG$1.registerElement("slider",JXG$1.createSlider);JXG$1.PrefixParser={parse:function(n,t){var o,u,d,C,I,f;if(JXG$1.isNumber(n)||JXG$1.isString(n))return n;if(!JXG$1.isArray(n)||n.length<2)throw new Error("prefixParser.parse: term is not an array, number or string");if(o=n[0],d=n.length,t==="execute")if(JXG$1.isInArray(["+","-","*","/"],o))for(C=this.parse(n[1],t),u=2;u<d;u++)switch(f=this.parse(n[u],t),o){case"+":C+=f;break;case"-":C-=f;break;case"*":C*=f;break;case"/":C/=f;break}else if(o==="exec"){for(I=n[1],f=[],u=2;u<d;u++)f.push(this.parse(n[u],t));if(JXG$1.exists(Math[I]))C=Math[I].apply(this,f);else if(JXG$1.exists(Mat[I]))C=Mat[I].apply(this,f);else throw new Error("PrefixParser.parse: "+I+" is not allowed")}else{if(I=n[0],I==="V"&&(I="Value"),I==="Coords"&&(n[2]="true"),!JXG$1.exists(n[1][I]))throw new Error("PrefixParser.parse: "+I+" is not a method of "+n[1]);for(f=[],u=2;u<d;u++)f.push(this.parse(n[u],t));C=n[1][I].apply(n[1],f)}return C},dimension:function(n){var t,o,u,d,C,I,f,A;if(JXG$1.isNumber(n))return 0;if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.dimension: term is not an array");if(t=n[0],u=n.length,JXG$1.isInArray(["+","-","*","/"],t))for(d=this.dimension(n[1]),o=2;o<u;o++)switch(f=this.dimension(n[o]),t){case"+":f!==d&&(d=NaN);break;case"-":f!==d&&(d=NaN);break;case"*":d+=f;break;case"/":d-=f;break}else if(t==="exec")n[2].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(d=n[2].Dimension(),JXG$1.exists(n[2].visProp.dim)&&(I=JXG$1.evaluate(n[2].visProp.dim),I!==null&&(d=I))):d=0;else switch(C=n[0],C){case"L":case"Length":case"Perimeter":case"Radius":case"R":d=1;break;case"Area":case"A":d=2;break;default:n[1].type===JXG$1.OBJECT_TYPE_MEASUREMENT?(d=n[1].Dimension(),JXG$1.exists(n[1].visProp.dim)&&(I=JXG$1.evaluate(n[1].visProp.dim),I!==null&&(d=I))):(d=0,(C==="Value"||C==="V")&&[Const.OBJECT_TYPE_ARC,Const.OBJECT_TYPE_SECTOR,Const.OBJECT_TYPE_ANGLE].indexOf(n[1].type)>=0&&(A="",n.length===3&&JXG$1.isString(n[2])&&(A=n[2].toLowerCase()),A===""?n[1].type===Const.OBJECT_TYPE_ANGLE?d=0:d=1:A.indexOf("len")===0?d=1:d=0))}return d},toPrefix:function(n){var t,o,u,d;if(JXG$1.isNumber(n))return n;if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.toPrefix: term is not an array");for(t=n[0],u=n.length,d=[t],o=1;o<u;o++)JXG$1.isInArray(["+","-","*","/"],t)?d.push(this.toPrefix(n[o])):t==="V"&&n[o].type===JXG$1.OBJECT_TYPE_MEASUREMENT?d=n[o].toPrefix():t==="exec"?o===1?d.push(n[o]):d.push(this.toPrefix(n[o])):d=[t,n[o].id];return d},getParents:function(n){var t,o,u,d;if(JXG$1.isNumber(n))return[];if(!JXG$1.isArray(n)||n.length<2)throw new Error("PrefixParser.getParents: term is not an array");for(t=n[0],u=n.length,d=[],o=1;o<u;o++)JXG$1.isInArray(["+","-","*","/"],t)?JXG$1.concat(d,this.getParents(n[o])):t==="V"&&n[o].type===JXG$1.OBJECT_TYPE_MEASUREMENT?JXG$1.concat(d,n[o].getParents()):t==="exec"?o>1&&JXG$1.concat(d,this.getParents(n[o])):d.push(n[o]);return d}};const Prefix=JXG$1.PrefixParser;JXG$1.createTapemeasure=function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M;return u=t[0],d=t[1],C=JXG$1.copyAttributes(o,n.options,"tapemeasure","point1"),G=n.create("point",u,C),C=JXG$1.copyAttributes(o,n.options,"tapemeasure","point2"),S=n.create("point",d,C),G.setAttribute({ignoredSnapToPoints:[S.id]}),S.setAttribute({ignoredSnapToPoints:[G.id]}),C=JXG$1.copyAttributes(o,n.options,"tapemeasure"),I=C.withticks,f=C.withlabel,A=C.digits,A===2&&C.precision!==2&&(A=C.precision),f&&(C.withlabel=!0),y=n.create("segment",[G,S],C),f&&(o.name&&o.name!==""?w=o.name+" = ":w="",y.label.setText(function(){var V=JXG$1.evaluate(y.label.visProp.digits);return y.label.useLocale()?w+y.label.formatNumberLocale(G.Dist(S),V):w+JXG$1.toFixed(G.Dist(S),V)})),I&&(C=JXG$1.copyAttributes(o,n.options,"tapemeasure","ticks"),M=n.create("ticks",[y,.1],C),y.inherits.push(M)),y.remove=function(){I&&y.removeTicks(M),n.removeObject(S),n.removeObject(G),GeometryElement.prototype.remove.call(this)},y.Value=function(){return G.Dist(S)},G.dump=!1,S.dump=!1,y.elType="tapemeasure",y.getParents=function(){return[[G.X(),G.Y()],[S.X(),S.Y()]]},y.subs={point1:G,point2:S},I&&(M.dump=!1),y.methodMap=JXG$1.deepCopy(y.methodMap,{Value:"Value"}),y.prepareUpdate().update(),n.isSuspendedUpdate||(y.updateVisibility().updateRenderer(),y.point1.updateVisibility().updateRenderer(),y.point2.updateVisibility().updateRenderer()),y};JXG$1.registerElement("tapemeasure",JXG$1.createTapemeasure);JXG$1.createMeasurement=function(n,t,o){var u,d,C,I,f,A;for(d=JXG$1.copyAttributes(o,n.options,"measurement"),C=t[0],I=t[1],f=t[2],u=n.create("text",[C,I,""],d),u.type=JXG$1.OBJECT_TYPE_MEASUREMENT,u.elType="measurement",u.Value=function(){return Prefix.parse(f,"execute")},u.Dimension=function(){var y=JXG$1.evaluate(u.visProp.dim);return y!==null?y:Prefix.dimension(f)},u.Unit=function(){var y="",G=JXG$1.evaluate(u.visProp.units),S=u.Dimension();return JXG$1.isObject(G)&&JXG$1.exists(G[S])&&G[S]!==!1?y=JXG$1.evaluate(G[S]):JXG$1.isObject(G)&&JXG$1.exists(G["dim"+S])&&G["dim"+S]!==!1?y=JXG$1.evaluate(G["dim"+S]):(y=JXG$1.evaluate(u.visProp.baseunit),S===0?y="":S>1&&y!==""&&(y=y+"^{"+S+"}")),y},u.getTerm=function(){return f},u.getMethod=function(){var y=f[0];return y==="V"&&(y="Value"),y},u.toPrefix=function(){return Prefix.toPrefix(f)},u.getParents=function(){return Prefix.getParents(f)},u.addParents(u.getParents()),A=0;A<u.parents.length;A++)n.select(u.parents[A]).addChild(u);return u.setText(function(){var y="",G="",S=u.Dimension(),w=JXG$1.evaluate(u.visProp.digits),M=u.Unit(),V=u.Value(),T;if(JXG$1.evaluate(u.visProp.showprefix)&&(y=u.visProp.formatprefix.apply(u,[JXG$1.evaluate(u.visProp.prefix)])),JXG$1.evaluate(u.visProp.showsuffix)&&(G=u.visProp.formatsuffix.apply(u,[JXG$1.evaluate(u.visProp.suffix)])),JXG$1.isNumber(V))w==="none"||(w==="auto"?u.useLocale()?V=u.formatNumberLocale(V):V=JXG$1.autoDigits(V):u.useLocale()?V=u.formatNumberLocale(V,w):V=JXG$1.toFixed(V,w));else if(JXG$1.isArray(V))for(T=0;T<V.length;T++)JXG$1.isNumber(V[T])&&(w==="none"||(w==="auto"?u.useLocale()?V[T]=u.formatNumberLocale(V[T]):V[T]=JXG$1.autoDigits(V[T]):u.useLocale()?V[T]=u.formatNumberLocale(V[T],w):V[T]=JXG$1.toFixed(V[T],w)));return S==="coords"&&JXG$1.isArray(V)&&(V.length===2&&V.unshift(void 0),V=u.visProp.formatcoords.apply(u,[V[1],V[2],V[0]])),S==="direction"&&JXG$1.isArray(V)&&(V=u.visProp.formatdirection.apply(u,[V[0],V[1]])),JXG$1.isString(S)?y+V+G:isNaN(S)?y+"NaN"+G:y+V+M+G}),u.methodMap=JXG$1.deepCopy(u.methodMap,{Value:"Value",Dimension:"Dimension",Unit:"Unit",getTerm:"getTerm",Term:"getTerm",getMethod:"getMethod",Method:"getMethod",getParents:"getParents",Parents:"getParents"}),u};JXG$1.registerElement("measurement",JXG$1.createMeasurement);JXG$1.DataSource=function(){return this.data=[],this.columnHeaders=[],this.rowHeaders=[],this};JXG$1.extend(JXG$1.DataSource.prototype,{loadFromArray:function(n,t,o){var u,d,C;if(JXG$1.isArray(t)&&(this.columnHeaders=t,t=!1),JXG$1.isArray(o)&&(this.rowHeaders=o,o=!1),this.data=[],t&&(this.columnHeaders=[]),o&&(this.rowHeaders=[]),JXG$1.exists(n)){for(this.data=[],u=0;u<n.length;u++)for(this.data[u]=[],d=0;d<n[u].length;d++)C=n[u][d],parseFloat(C).toString()===C?this.data[u][d]=parseFloat(C):C!=="-"?this.data[u][d]=C:this.data[u][d]=NaN;if(t&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),o)for(this.rowHeaders=[],u=0;u<this.data.length;u++)this.rowHeaders.push(this.data[u][0]),this.data[u]=this.data[u].slice(1)}return this},loadFromTable:function(n,t,o){var u,d,C,I,f;if(JXG$1.isArray(t)&&(this.columnHeaders=t,t=!1),JXG$1.isArray(o)&&(this.rowHeaders=o,o=!1),this.data=[],t&&(this.columnHeaders=[]),o&&(this.rowHeaders=[]),n=document.getElementById(n),JXG$1.exists(n)){for(u=n.getElementsByTagName("tr"),this.data=[],d=0;d<u.length;d++)for(I=u[d].getElementsByTagName("td"),this.data[d]=[],C=0;C<I.length;C++)f=I[C].innerHTML,parseFloat(f).toString()===f?this.data[d][C]=parseFloat(f):f!=="-"?this.data[d][C]=f:this.data[d][C]=NaN;if(t&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),o)for(this.rowHeaders=[],d=0;d<this.data.length;d++)this.rowHeaders.push(this.data[d][0]),this.data[d]=this.data[d].slice(1)}return this},addColumn:function(n,t,o){throw new Error("not implemented")},addRow:function(n,t,o){throw new Error("not implemented")},getColumn:function(n){var t,o=[];if(JXG$1.isString(n)){for(t=0;t<this.columnHeaders.length;t++)if(n===this.columnHeaders[t]){n=t;break}}for(t=0;t<this.data.length;t++)this.data[t].length>n&&(o[t]=parseFloat(this.data[t][n]));return o},getRow:function(n){var t,o;if(JXG$1.isString(n)){for(o=0;o<this.rowHeaders.length;o++)if(n===this.rowHeaders[o]){n=o;break}}for(t=[],o=0;o<this.data[n].length;o++)t[o]=this.data[n][o];return t}});const DataSource=JXG$1.DataSource;JXG$1.Chart=function(n,t,o){this.constructor(n,o);var u,d,C,I,f,A;if(!JXG$1.isArray(t)||t.length===0)throw new Error("JSXGraph: Can't create a chart without data");if(this.elements=[],JXG$1.isNumber(t[0]))for(d=t,u=[],C=0;C<d.length;C++)u[C]=C+1;else if(t.length===1&&JXG$1.isArray(t[0]))for(d=t[0],u=[],A=JXG$1.evaluate(d).length,C=0;C<A;C++)u[C]=C+1;else t.length===2&&(A=Math.min(t[0].length,t[1].length),u=t[0].slice(0,A),d=t[1].slice(0,A));if(JXG$1.isArray(d)&&d.length===0)throw new Error("JSXGraph: Can't create charts without data.");for(f=o.chartstyle.replace(/ /g,"").split(","),C=0;C<f.length;C++){switch(f[C]){case"bar":I=this.drawBar(n,u,d,o);break;case"line":I=this.drawLine(n,u,d,o);break;case"fit":I=this.drawFit(n,u,d,o);break;case"spline":I=this.drawSpline(n,u,d,o);break;case"pie":I=this.drawPie(n,d,o);break;case"point":I=this.drawPoints(n,u,d,o);break;case"radar":I=this.drawRadar(n,t,o);break}this.elements.push(I)}return this.id=this.board.setId(this,"Chart"),this.elements};JXG$1.Chart.prototype=new GeometryElement;JXG$1.extend(JXG$1.Chart.prototype,{drawLine:function(n,t,o,u){return u.fillcolor="none",u.highlightfillcolor="none",n.create("curve",[t,o],u)},drawSpline:function(n,t,o,u){return u.fillColor="none",u.highlightfillcolor="none",n.create("spline",[t,o],u)},drawFit:function(n,t,o,u){var d=u.degree;return d=Math.max(parseInt(d,10),1)||1,u.fillcolor="none",u.highlightfillcolor="none",n.create("functiongraph",[Numerics.regressionPolynomial(d,t,o)],u)},drawBar:function(n,t,o,u){var d,C,I,f,A,y,G,S,w=[],M=[],V,T,H=function(z,L){return function(){return t[z]()-L*I}},J={fixed:!0,withLabel:!1,visible:!1,name:""};if(V=JXG$1.copyAttributes(u,n.options,"chart"),V&&V.width)I=V.width;else{if(t.length<=1)I=1;else for(I=t[1]-t[0],d=1;d<t.length-1;d++)I=t[d+1]-t[d]<I?t[d+1]-t[d]:I;I*=.8}for(T=JXG$1.copyAttributes(u,n.options,"chart","label"),d=0;d<t.length;d++)JXG$1.isFunction(t[d])?(f=H(d,-.5),A=H(d,0),y=H(d,.5)):(f=t[d]-I*.5,A=t[d],y=t[d]+I*.5),JXG$1.isFunction(o[d])?G=o[d]():G=o[d],G=o[d],V.dir==="horizontal"?(M[0]=n.create("point",[0,f],J),M[1]=n.create("point",[G,f],J),M[2]=n.create("point",[G,y],J),M[3]=n.create("point",[0,y],J),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[d])&&(T.anchorY="middle",C=n.create("text",[G,A,V.labels[d]],T),C.visProp.anchorx=function(z){return function(){return z.X()>=0?"left":"right"}}(C))):(M[0]=n.create("point",[f,0],J),M[1]=n.create("point",[f,G],J),M[2]=n.create("point",[y,G],J),M[3]=n.create("point",[y,0],J),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[d])&&(T.anchorX="middle",C=n.create("text",[A,G,V.labels[d]],T),C.visProp.anchory=function(z){return function(){return z.Y()>=0?"bottom":"top"}}(C))),JXG$1.isArray(V.colors)&&(S=V.colors,V.fillcolor=S[d%S.length]),w[d]=n.create("polygon",M,V),JXG$1.exists(V.labels)&&JXG$1.exists(V.labels[d])&&(w[d].text=C);return w},drawPoints:function(n,t,o,u){var d,C=[],I=u.infoboxarray;for(u.fixed=!0,u.name="",d=0;d<t.length;d++)u.infoboxtext=I?I[d%I.length]:!1,C[d]=n.create("point",[t[d],o[d]],u);return C},drawPie:function(n,t,o){var u,d,C=[],I=[],f=o.colors,A=o.highlightcolors,y=o.labels,G=o.radius||4,S=G,w=o.center||[0,0],M=w[0],V=w[1],T=function(K,O,Q){return function(){var ee,ie,te,se=0;for(ie=0;ie<=K;ie++)se+=parseFloat(JXG$1.evaluate(t[ie]));for(ee=se,ie=K+1;ie<t.length;ie++)ee+=parseFloat(JXG$1.evaluate(t[ie]));return te=ee!==0?2*Math.PI*se/ee:0,S()*Math[O](te)+Q}},H=function(K,O){var Q=-this.point1.coords.usrCoords[1]+this.point2.coords.usrCoords[1],ee=-this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[2];JXG$1.exists(this.label)&&(this.label.rendNode.style.fontSize=O*JXG$1.evaluate(this.label.visProp.fontsize)+"px",this.label.fullUpdate()),this.point2.coords=new Coords(Const.COORDS_BY_USER,[this.point1.coords.usrCoords[1]+Q*K,this.point1.coords.usrCoords[2]+ee*K],this.board),this.fullUpdate()},J=function(){this.highlighted||(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this),H.call(this,1.1,2))},z=function(){this.highlighted&&(this.highlighted=!1,this.board.renderer.noHighlight(this),H.call(this,.9090909,1))},L={fixed:!0,withLabel:!1,visible:!1,name:""};if(!JXG$1.isArray(y))for(y=[],u=0;u<t.length;u++)y[u]="";for(JXG$1.isFunction(G)||(S=function(){return G}),o.highlightonsector=o.highlightonsector||!1,o.straightfirst=!1,o.straightlast=!1,d=n.create("point",[M,V],L),C[0]=n.create("point",[function(){return S()+M},function(){return V}],L),u=0;u<t.length;u++)C[u+1]=n.create("point",[T(u,"cos",M),T(u,"sin",V)],L),o.name=y[u],o.withlabel=o.name!=="",o.fillcolor=f&&f[u%f.length],o.labelcolor=f&&f[u%f.length],o.highlightfillcolor=A&&A[u%A.length],I[u]=n.create("sector",[d,C[u],C[u+1]],o),o.highlightonsector&&(I[u].hasPoint=I[u].hasPointSector),o.highlightbysize&&(I[u].highlight=J,I[u].noHighlight=z);return{sectors:I,points:C,midpoint:d}},drawRadar:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le,ge,be,Xe,Ce,Re,Se,Ze,he,Ie,Be,ue,me,xe,Je,Ve,Ee,Ct,st,wt=t.length,Qe=function(){var Ge,Gt,ot,vt,at=JXG$1.evaluate(this.visProp.label.offset).slice(0);return Ge=this.point1.X(),Gt=this.point2.X(),ot=this.point1.Y(),vt=this.point2.Y(),Gt<Ge&&(at[0]=-at[0]),vt<ot&&(at[1]=-at[1]),this.setLabelRelativeCoords(at),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)},Ue=function(Ge,Gt){var ot,vt,at;return ot=n.create("transform",[-(J[Gt]-T[Gt]),0],{type:"translate"}),vt=n.create("transform",[O/(z[Gt]+H[Gt]-(J[Gt]-T[Gt])),1],{type:"scale"}),ot.melt(vt),at=n.create("transform",[Ge],{type:"rotate"}),ot.melt(at),ot};if(wt<=0)throw new Error("JSXGraph radar chart: no data");if(C=o.paramarray,!JXG$1.exists(C))throw new Error("JSXGraph radar chart: need paramArray attribute");if(I=C.length,I<=1)throw new Error("JSXGraph radar chart: need more than one param in paramArray");for(u=0;u<wt;u++)if(I!==t[u].length)throw new Error("JSXGraph radar chart: use data length equal to number of params ("+t[u].length+" != "+I+")");for(f=[],A=[],d=0;d<I;d++)f[d]=t[0][d],A[d]=f[d];for(u=1;u<wt;u++)for(d=0;d<I;d++)t[u][d]>f[d]&&(f[d]=t[u][d]),t[u][d]<A[d]&&(A[d]=t[u][d]);for(y=[],G=[],u=0;u<wt;u++)y[u]="",G[u]=[];for(S=[],w=[],M=o.startshiftratio||0,V=o.endshiftratio||0,u=0;u<I;u++)S[u]=(f[u]-A[u])*M,w[u]=(f[u]-A[u])*V;if(T=o.startshiftarray||S,H=o.endshiftarray||w,J=o.startarray||A,JXG$1.exists(o.start))for(u=0;u<I;u++)J[u]=o.start;if(z=o.endarray||f,JXG$1.exists(o.end))for(u=0;u<I;u++)z[u]=o.end;if(T.length!==I)throw new Error("JSXGraph radar chart: start shifts length is not equal to number of parameters");if(H.length!==I)throw new Error("JSXGraph radar chart: end shifts length is not equal to number of parameters");if(J.length!==I)throw new Error("JSXGraph radar chart: starts length is not equal to number of parameters");if(z.length!==I)throw new Error("JSXGraph radar chart: snds length is not equal to number of parameters");for(L=o.labelarray||y,K=o.colors,O=o.radius||10,Ct=o.strokewidth||1,JXG$1.exists(o.highlightonsector)||(o.highlightonsector=!1),Q={name:o.name,id:o.id,strokewidth:Ct,polystrokewidth:o.polystrokewidth||Ct,strokecolor:o.strokecolor||"black",straightfirst:!1,straightlast:!1,fillcolor:o.fillColor||"#FFFF88",fillopacity:o.fillOpacity||.4,highlightfillcolor:o.highlightFillColor||"#FF7400",highlightstrokecolor:o.highlightStrokeColor||"black",gradient:o.gradient||"none"},ee=o.center||[0,0],ie=ee[0],te=ee[1],se=n.create("point",[ie,te],{name:"",fixed:!0,withlabel:!1,visible:!1}),ae=Math.PI/2-Math.PI/I,ae=o.startangle||0,le=ae,ge=[],be=[],u=0;u<I;u++)for(le+=2*Math.PI/I,Ce=O*Math.cos(le)+ie,Re=O*Math.sin(le)+te,ge[u]=n.create("point",[Ce,Re],{name:"",fixed:!0,withlabel:!1,visible:!1}),be[u]=n.create("line",[se,ge[u]],{name:C[u],strokeColor:Q.strokecolor,strokeWidth:Q.strokewidth,strokeOpacity:1,straightFirst:!1,straightLast:!1,withLabel:!0,highlightStrokeColor:Q.highlightstrokecolor}),be[u].getLabelAnchor=Qe,Xe=Ue(le,u),d=0;d<t.length;d++)st=t[d][u],G[d][u]=n.create("point",[st,0],{name:"",fixed:!0,withlabel:!1,visible:!1}),G[d][u].addTransform(G[d][u],Xe);for(Se=[],u=0;u<wt;u++)for(Q.labelcolor=K&&K[u%K.length],Q.strokecolor=K&&K[u%K.length],Q.fillcolor=K&&K[u%K.length],Se[u]=n.create("polygon",G[u],{withLines:!0,withLabel:!1,fillColor:Q.fillcolor,fillOpacity:Q.fillopacity,highlightFillColor:Q.highlightfillcolor}),d=0;d<I;d++)Se[u].borders[d].setAttribute("strokecolor:"+K[u%K.length]),Se[u].borders[d].setAttribute("strokewidth:"+Q.polystrokewidth);switch(Ze=o.legendposition||"none",Ze){case"right":Ie=o.legendleftoffset||2,Be=o.legendtopoffset||1,this.legend=n.create("legend",[ie+O+Ie,te+O-Be],{labels:L,colors:K});break;case"none":break;default:JXG$1.debug("Unknown legend position")}if(he=[],o.showcircles){for(ue=[],u=0;u<6;u++)ue[u]=20*u;if(ue[0]="0",me=o.circlelabelarray||ue,xe=me.length,xe<2)throw new Error("JSXGraph radar chart: too less circles in circleLabelArray");for(Je=[],Ve=ae+Math.PI/I,Xe=Ue(Ve,0),Q.fillcolor="none",Q.highlightfillcolor="none",Q.strokecolor=o.strokecolor||"black",Q.strokewidth=o.circlestrokewidth||.5,Q.layer=0,Ee=(z[0]-J[0])/(xe-1),u=0;u<xe;u++)Je[u]=n.create("point",[J[0]+u*Ee,0],{name:me[u],size:0,fixed:!0,withLabel:!0,visible:!0}),Je[u].addTransform(Je[u],Xe),he[u]=n.create("circle",[se,Je[u]],Q)}return this.rendNode=Se[0].rendNode,{circles:he,lines:be,points:G,midpoint:se,polygons:Se}},updateRenderer:function(){return this},update:function(){return this.needsUpdate&&this.updateDataArray(),this},updateDataArray:function(){return this}});JXG$1.createChart=function(n,t,o){var u,d,C,I,f,A=[],y,G,S,w,M,V,T,H,J,z,L,K=JXG$1.isBrowser?n.document.getElementById(t[0]):null;if(t.length===1&&JXG$1.isString(t[0])){if(JXG$1.exists(K)){if(w=JXG$1.copyAttributes(o,n.options,"chart"),K=new DataSource().loadFromTable(t[0],w.withheaders,w.withheaders),u=K.data,f=K.columnHeaders,d=K.rowHeaders,M=w.width,V=w.name,T=w.strokecolor,H=w.fillcolor,J=w.highlightstrokecolor,z=w.highlightfillcolor,n.suspendUpdate(),L=u.length,S=[],w.rows&&JXG$1.isArray(w.rows)){for(C=0;C<L;C++)for(I=0;I<w.rows.length;I++)if(w.rows[I]===C||w.withheaders&&w.rows[I]===d[C]){S.push(u[C]);break}}else S=u;for(L=S.length,C=0;C<L;C++){if(G=[],w.chartstyle&&w.chartstyle.indexOf("bar")!==-1){for(M?y=M:y=.8,G.push(1-y/2+(C+.5)*y/L),I=1;I<S[C].length;I++)G.push(G[I-1]+1);w.width=y/L}V&&V.length===L?w.name=V[C]:w.withheaders&&(w.name=f[C]),T&&T.length===L?w.strokecolor=T[C]:w.strokecolor=JXG$1.hsv2rgb((C+1)/L*360,.9,.6),H&&H.length===L?w.fillcolor=H[C]:w.fillcolor=JXG$1.hsv2rgb((C+1)/L*360,.9,1),J&&J.length===L?w.highlightstrokecolor=J[C]:w.highlightstrokecolor=JXG$1.hsv2rgb((C+1)/L*360,.9,1),z&&z.length===L?w.highlightfillcolor=z[C]:w.highlightfillcolor=JXG$1.hsv2rgb((C+1)/L*360,.9,.6),w.chartstyle&&w.chartstyle.indexOf("bar")!==-1?A.push(new JXG$1.Chart(n,[G,S[C]],w)):A.push(new JXG$1.Chart(n,[S[C]],w))}n.unsuspendUpdate()}return A}return w=JXG$1.copyAttributes(o,n.options,"chart"),new JXG$1.Chart(n,t,w)};JXG$1.registerElement("chart",JXG$1.createChart);JXG$1.Legend=function(n,t,o){var u;if(this.constructor(),u=JXG$1.copyAttributes(o,n.options,"legend"),this.board=n,this.coords=new Coords(Const.COORDS_BY_USER,t,this.board),this.myAtts={},this.label_array=u.labelarray||u.labels,this.color_array=u.colorarray||u.colors,this.lines=[],this.myAtts.strokewidth=u.strokewidth||5,this.myAtts.straightfirst=!1,this.myAtts.straightlast=!1,this.myAtts.withlabel=!0,this.myAtts.fixed=!0,this.style=u.legendstyle||u.style,this.style==="vertical")this.drawVerticalLegend(n,u);else throw new Error("JSXGraph: Unknown legend style: "+this.style)};JXG$1.Legend.prototype=new GeometryElement;JXG$1.Legend.prototype.drawVerticalLegend=function(n,t){var o,u=t.linelength||1,d=(t.rowheight||20)/this.board.unitY,C=function(){return this.setLabelRelativeCoords(this.visProp.label.offset),new Coords(Const.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)};for(o=0;o<this.label_array.length;o++)this.myAtts.name=this.label_array[o],this.myAtts.strokecolor=this.color_array[o%this.color_array.length],this.myAtts.highlightstrokecolor=this.color_array[o%this.color_array.length],this.myAtts.label={offset:[10,0],strokeColor:this.color_array[o%this.color_array.length],strokeWidth:this.myAtts.strokewidth},this.lines[o]=n.create("line",[[this.coords.usrCoords[1],this.coords.usrCoords[2]-o*d],[this.coords.usrCoords[1]+u,this.coords.usrCoords[2]-o*d]],this.myAtts),this.lines[o].getLabelAnchor=C,this.lines[o].prepareUpdate().update().updateVisibility(JXG$1.evaluate(this.lines[o].visProp.visible)).updateRenderer()};JXG$1.createLegend=function(n,t,o){var u=[0,0];if(JXG$1.exists(t)&&t.length===2)u=t;else throw new Error("JSXGraph: Legend element needs two numbers as parameters");return new JXG$1.Legend(n,u,o)};JXG$1.registerElement("legend",JXG$1.createLegend);JXG$1.Chart,JXG$1.Legend;JXG$1.Transformation=function(n,t,o){this.elementClass=Const.OBJECT_CLASS_OTHER,this.type=Const.OBJECT_TYPE_TRANSFORMATION,this.matrix=[[1,0,0],[0,1,0],[0,0,1]],this.board=n,this.isNumericMatrix=!1,this.setMatrix(n,t,o),this.methodMap={apply:"apply",applyOnce:"applyOnce",bindTo:"bindTo",bind:"bindTo",melt:"melt"}};JXG$1.Transformation.prototype={};JXG$1.extend(JXG$1.Transformation.prototype,{update:function(){return this},setMatrix:function(n,t,o){var u;for(this.isNumericMatrix=!0,u=0;u<o.length;u++)if(typeof o[u]!="number"){this.isNumericMatrix=!1;break}if(t==="translate"){if(o.length!==2)throw new Error("JSXGraph: translate transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][0]=this.evalParam(0),this.matrix[2][0]=this.evalParam(1)}}else if(t==="scale"){if(o.length!==2)throw new Error("JSXGraph: scale transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][1]=this.evalParam(0),this.matrix[2][2]=this.evalParam(1)}}else if(t==="reflect")o.length<4&&(o[0]=n.select(o[0])),o.length===2&&(o[1]=n.select(o[1])),o.length===4&&(this.evalParam=JXG$1.createEvalFunction(n,o,4)),this.update=function(){var d,C,I,f,A,y,G,S;o.length===1?G=o[0].stdform:o.length===2?G=Mat.crossProduct(o[1].coords.usrCoords,o[0].coords.usrCoords):o.length===4&&(G=Mat.crossProduct([1,this.evalParam(2),this.evalParam(3)],[1,this.evalParam(0),this.evalParam(1)])),d=G[1],C=G[2],I=G[0],S=[-I*d,-I*C,d*d+C*C],y=S[2],f=S[0]/S[2],A=S[1]/S[2],d=-G[2],C=G[1],this.matrix[1][1]=(d*d-C*C)/y,this.matrix[1][2]=2*d*C/y,this.matrix[2][1]=this.matrix[1][2],this.matrix[2][2]=-this.matrix[1][1],this.matrix[1][0]=f*(1-this.matrix[1][1])-A*this.matrix[1][2],this.matrix[2][0]=A*(1-this.matrix[2][2])-f*this.matrix[2][1]};else if(t==="rotate")o.length===3?this.evalParam=JXG$1.createEvalFunction(n,o,3):o.length>0&&o.length<=2&&(this.evalParam=JXG$1.createEvalFunction(n,o,1),o.length===2&&!JXG$1.isArray(o[1])&&(o[1]=n.select(o[1]))),this.update=function(){var d,C,I=this.evalParam(0),f=Math.cos(I),A=Math.sin(I);this.matrix[1][1]=f,this.matrix[1][2]=-A,this.matrix[2][1]=A,this.matrix[2][2]=f,o.length>1&&(o.length===3?(d=this.evalParam(1),C=this.evalParam(2)):JXG$1.isArray(o[1])?(d=o[1][0],C=o[1][1]):(d=o[1].X(),C=o[1].Y()),this.matrix[1][0]=d*(1-f)+C*A,this.matrix[2][0]=C*(1-f)-d*A)};else if(t==="shear"){if(o.length!==2)throw new Error("JSXGraph: shear transformation needs 2 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,2),this.update=function(){this.matrix[1][2]=this.evalParam(0),this.matrix[2][1]=this.evalParam(1)}}else if(t==="generic"){if(o.length!==9)throw new Error("JSXGraph: generic transformation needs 9 parameters.");this.evalParam=JXG$1.createEvalFunction(n,o,9),this.update=function(){this.matrix[0][0]=this.evalParam(0),this.matrix[0][1]=this.evalParam(1),this.matrix[0][2]=this.evalParam(2),this.matrix[1][0]=this.evalParam(3),this.matrix[1][1]=this.evalParam(4),this.matrix[1][2]=this.evalParam(5),this.matrix[2][0]=this.evalParam(6),this.matrix[2][1]=this.evalParam(7),this.matrix[2][2]=this.evalParam(8)}}},apply:function(n,t){return this.update(),JXG$1.exists(t)?Mat.matVecMult(this.matrix,n.initialCoords.usrCoords):Mat.matVecMult(this.matrix,n.coords.usrCoords)},applyOnce:function(n){var t,o,u;for(JXG$1.isArray(n)||(n=[n]),o=n.length,u=0;u<o;u++)this.update(),t=Mat.matVecMult(this.matrix,n[u].coords.usrCoords),n[u].coords.setCoordinates(Const.COORDS_BY_USER,t)},bindTo:function(n){var t,o;if(JXG$1.isArray(n))for(o=n.length,t=0;t<o;t++)n[t].transformations.push(this);else n.transformations.push(this)},setProperty:function(n){JXG$1.deprecated("Transformation.setProperty()","Transformation.setAttribute()")},setAttribute:function(n){},melt:function(n){var t=[],o,u,d,C,I,f;for(u=n.matrix.length,d=this.matrix[0].length,o=0;o<u;o++)t[o]=[];for(this.update(),n.update(),o=0;o<u;o++)for(f=0;f<d;f++){for(I=0,C=0;C<u;C++)I+=n.matrix[o][C]*this.matrix[C][f];t[o][f]=I}return this.update=function(){var A=this.matrix.length,y=this.matrix[0].length;for(o=0;o<A;o++)for(f=0;f<y;f++)this.matrix[o][f]=t[o][f]},this},getParents:function(){var n=[[].concat.apply([],this.matrix)];return this.parents.length!==0&&(n=this.parents),n}});JXG$1.createTransform=function(n,t,o){return new JXG$1.Transformation(n,o.type,t)};JXG$1.registerElement("transform",JXG$1.createTransform);JXG$1.Transformation;JXG$1.Turtle=function(n,t,o){var u,d,C;return this.constructor(n,o,Const.OBJECT_TYPE_TURTLE,Const.OBJECT_CLASS_OTHER),this.turtleIsHidden=!1,this.board=n,this.visProp.curveType="plot",this._attributes=JXG$1.copyAttributes(this.visProp,n.options,"turtle"),delete this._attributes.id,u=0,d=0,C=90,t.length!==0&&(t.length===3?(u=t[0],d=t[1],C=t[2]):t.length===2?JXG$1.isArray(t[0])?(u=t[0][0],d=t[0][1],C=t[1]):(u=t[0],d=t[1]):(u=t[0][0],d=t[0][1])),this.init(u,d,C),this.methodMap=JXG$1.deepCopy(this.methodMap,{forward:"forward",fd:"forward",back:"back",bk:"back",right:"right",rt:"right",left:"left",lt:"left",penUp:"penUp",pu:"penUp",up:"penUp",penDown:"penDown",pd:"penDown",down:"penDown",clearScreen:"clearScreen",cs:"clearScreen",clean:"clean",setPos:"setPos",home:"home",hideTurtle:"hideTurtle",ht:"hideTurtle",hide:"hideTurtle",showTurtle:"showTurtle",st:"showTurtle",show:"showTurtle",penSize:"setPenSize",setPenSize:"setPenSize",penColor:"setPenColor",setPenColor:"setPenColor",highlightPenColor:"setHighlightPenColor",setHighlightPenColor:"setHighlightPenColor",getPenColor:"getPenColor",Color:"getPenColor",getHighlightPenColor:"getHighlightPenColor",HighlightColor:"getHighlightPenColor",getPenSize:"getPenSize",Size:"getPenSize",pushTurtle:"pushTurtle",push:"pushTurtle",popTurtle:"popTurtle",pop:"popTurtle",lookTo:"lookTo",pos:"pos",Pos:"pos",moveTo:"moveTo",X:"X",Y:"Y"}),this};JXG$1.Turtle.prototype=new GeometryElement;JXG$1.extend(JXG$1.Turtle.prototype,{init:function(n,t,o){var u={fixed:!0,name:"",visible:!1,withLabel:!1};this.arrowLen=20/Mat.hypot(this.board.unitX,this.board.unitY),this.pos=[n,t],this.isPenDown=!0,this.dir=90,this.stack=[],this.objects=[],this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.turtle=this.board.create("point",this.pos,u),this.objects.push(this.turtle),this.turtle2=this.board.create("point",[this.pos[0],this.pos[1]+this.arrowLen],u),this.objects.push(this.turtle2),this.visProp.arrow.lastArrow=!0,this.visProp.arrow.straightFirst=!1,this.visProp.arrow.straightLast=!1,this.arrow=this.board.create("line",[this.turtle,this.turtle2],this.visProp.arrow),this.objects.push(this.arrow),this.subs={arrow:this.arrow},this.inherits.push(this.arrow),this.right(90-o),this.board.update()},forward:function(n){if(n===0)return this;var t,o=n*Math.cos(this.dir*Math.PI/180),u=n*Math.sin(this.dir*Math.PI/180);return this.turtleIsHidden||(t=this.board.create("transform",[o,u],{type:"translate"}),t.applyOnce(this.turtle),t.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]+=o,this.pos[1]+=u,this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update(),this},back:function(n){return this.forward(-n)},right:function(n){if(this.dir-=n,this.dir%=360,!this.turtleIsHidden){var t=this.board.create("transform",[-n*Math.PI/180,this.turtle],{type:"rotate"});t.applyOnce(this.turtle2)}return this.board.update(),this},left:function(n){return this.right(-n)},penUp:function(){return this.isPenDown=!1,this},penDown:function(){return this.isPenDown=!0,this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this},clean:function(){var n,t;for(n=0;n<this.objects.length;n++)t=this.objects[n],t.type===Const.OBJECT_TYPE_CURVE&&(this.board.removeObject(t),this.objects.splice(n,1));return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},clearScreen:function(){var n,t,o=this.objects.length;for(n=0;n<o;n++)t=this.objects[n],this.board.removeObject(t);return this.init(0,0,90),this},setPos:function(n,t){var o;return JXG$1.isArray(n)?this.pos=n:this.pos=[n,t],this.turtleIsHidden||(this.turtle.setPositionDirectly(Const.COORDS_BY_USER,[n,t]),this.turtle2.setPositionDirectly(Const.COORDS_BY_USER,[n,t+this.arrowLen]),o=this.board.create("transform",[-(this.dir-90)*Math.PI/180,this.turtle],{type:"rotate"}),o.applyOnce(this.turtle2)),this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},setPenSize:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeWidth",n)),this.objects.push(this.curve),this},setPenColor:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeColor",n)),this.objects.push(this.curve),this},getPenAttribute:function(n){var t,o=this.objects.length;return o===4?t=0:t=o-1,JXG$1.evaluate(this.objects[t].visProp[n])},getPenSize:function(){return this.getPenAttribute("strokewidth")},getPenColor:function(){return this.getPenAttribute("strokecolor")},getHighlightPenColor:function(){return this.getPenAttribute("highlightstrokecolor")},setHighlightPenColor:function(n){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("highlightStrokeColor",n)),this.objects.push(this.curve),this},setAttribute:function(n){var t,o,u,d=this.objects.length;for(t=0;t<d;t++)o=this.objects[t],o.type===Const.OBJECT_TYPE_CURVE&&o.setAttribute(n);return u=this.visProp.id,this.visProp=JXG$1.deepCopy(this.curve.visProp),this.visProp.id=u,this._attributes=JXG$1.deepCopy(this.visProp),delete this._attributes.id,this},copyAttr:function(n,t){return this._attributes[n.toLowerCase()]=t,this._attributes},showTurtle:function(){return this.turtleIsHidden=!1,this.arrow.setAttribute({visible:!0}),this.visProp.arrow.visible=!1,this.setPos(this.pos[0],this.pos[1]),this.board.update(),this},hideTurtle:function(){return this.turtleIsHidden=!0,this.arrow.setAttribute({visible:!1}),this.visProp.arrow.visible=!1,this.board.update(),this},home:function(){return this.pos=[0,0],this.setPos(this.pos[0],this.pos[1]),this},pushTurtle:function(){return this.stack.push([this.pos[0],this.pos[1],this.dir]),this},popTurtle:function(){var n=this.stack.pop();return this.pos[0]=n[0],this.pos[1]=n[1],this.dir=n[2],this.setPos(this.pos[0],this.pos[1]),this},lookTo:function(n){var t,o,u,d,C;return JXG$1.isArray(n)?(t=this.pos[0],o=this.pos[1],u=n[0],d=n[1],C=Math.atan2(d-o,u-t),this.right(this.dir-C*180/Math.PI)):JXG$1.isNumber(n)&&this.right(this.dir-n),this},moveTo:function(n){var t,o,u;return JXG$1.isArray(n)&&(t=n[0]-this.pos[0],o=n[1]-this.pos[1],this.turtleIsHidden||(u=this.board.create("transform",[t,o],{type:"translate"}),u.applyOnce(this.turtle),u.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]=n[0],this.pos[1]=n[1],this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update()),this},fd:function(n){return this.forward(n)},bk:function(n){return this.back(n)},lt:function(n){return this.left(n)},rt:function(n){return this.right(n)},pu:function(){return this.penUp()},pd:function(){return this.penDown()},ht:function(){return this.hideTurtle()},st:function(){return this.showTurtle()},cs:function(){return this.clearScreen()},push:function(){return this.pushTurtle()},pop:function(){return this.popTurtle()},evalAt:function(n,t){var o,u,d,C,I=this.objects.length;for(o=0,u=0;o<I;o++)if(d=this.objects[o],d.elementClass===Const.OBJECT_CLASS_CURVE){if(u<=n&&n<u+d.numberPoints)return C=n-u,d[t](C);u+=d.numberPoints}return this[t]()},X:function(n){return JXG$1.exists(n)?this.evalAt(n,"X"):this.pos[0]},Y:function(n){return JXG$1.exists(n)?this.evalAt(n,"Y"):this.pos[1]},Z:function(n){return 1},minX:function(){return 0},maxX:function(){var n,t,o=this.objects.length,u=0;for(n=0;n<o;n++)t=this.objects[n],t.elementClass===Const.OBJECT_CLASS_CURVE&&(u+=this.objects[n].numberPoints);return u},hasPoint:function(n,t){var o,u;for(o=0;o<this.objects.length;o++)if(u=this.objects[o],u.type===Const.OBJECT_TYPE_CURVE&&u.hasPoint(n,t))return!0;return!1}});JXG$1.createTurtle=function(n,t,o){var u;return t=t||[],u=JXG$1.copyAttributes(o,n.options,"turtle"),new JXG$1.Turtle(n,t,u)};JXG$1.registerElement("turtle",JXG$1.createTurtle);JXG$1.Turtle;JXG$1.Ticks=function(n,t,o){if(this.constructor(n.board,o,Const.OBJECT_TYPE_TICKS,Const.OBJECT_CLASS_OTHER),this.line=n,this.board=this.line.board,this.fixedTicks=null,this.equidistant=!1,this.labelsData=[],JXG$1.isFunction(t))throw this.ticksFunction=t,new Error("Function arguments are no longer supported.");JXG$1.isArray(t)?this.fixedTicks=t:this.equidistant=!0,this.ticks=[],this.labels=[],this.labelCounter=0,this.id=this.line.addTicks(this),this.elType="ticks",this.inherits.push(this.labels),this.board.setId(this,"Ti")};JXG$1.Ticks.prototype=new GeometryElement;JXG$1.extend(JXG$1.Ticks.prototype,{hasPoint:function(n,t){var o,u,d,C,I=this.ticks&&this.ticks.length||0;if(JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(C=this.board._inputDevice,d=JXG$1.evaluate(this.visProp.precision[C])):d=this.board.options.precision.hasPoint,d+=JXG$1.evaluate(this.visProp.strokewidth)*.5,!JXG$1.evaluate(this.line.visProp.scalable)||this.line.elementClass===Const.OBJECT_CLASS_CURVE||this.line.stdform[1]!==0&&this.line.stdform[2]!==0&&this.line.type!==Const.OBJECT_TYPE_AXIS)return!1;for(o=0;o<I;o++)if(u=this.ticks[o],u[2]&&!(this.line.stdform[1]===0&&Math.abs(u[0][0]-this.line.point1.coords.scrCoords[1])<Mat.eps||this.line.stdform[2]===0&&Math.abs(u[1][0]-this.line.point1.coords.scrCoords[2])<Mat.eps)&&(Math.abs(u[0][0]-u[0][1])>=1||Math.abs(u[1][0]-u[1][1])>=1)){if(this.line.stdform[1]===0){if(Math.abs(t-this.line.point1.coords.scrCoords[2])<2*d&&u[0][0]-d<n&&n<u[0][1]+d)return!0}else if(this.line.stdform[2]===0&&Math.abs(n-this.line.point1.coords.scrCoords[1])<2*d&&u[1][0]-d<t&&t<u[1][1]+d)return!0}return!1},setPositionDirectly:function(n,t,o){var u,d,C=new Coords(n,t,this.board),I=new Coords(n,o,this.board),f=this.board.getBoundingBox();return this.line.type!==Const.OBJECT_TYPE_AXIS||!JXG$1.evaluate(this.line.visProp.scalable)?this:(Math.abs(this.line.stdform[1])<Mat.eps&&Math.abs(C.usrCoords[1]*I.usrCoords[1])>Mat.eps?(u=I.usrCoords[1]/C.usrCoords[1],f[0]*=u,f[2]*=u,this.board.setBoundingBox(f,this.board.keepaspectratio,"update")):Math.abs(this.line.stdform[2])<Mat.eps&&Math.abs(C.usrCoords[2]*I.usrCoords[2])>Mat.eps&&(d=I.usrCoords[2]/C.usrCoords[2],f[3]*=d,f[1]*=d,this.board.setBoundingBox(f,this.board.keepaspectratio,"update")),this)},calculateTicksCoordinates:function(){var n,t,o,u;if(!(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(this.setTicksSizeVariables(),Math.abs(this.dx)<Mat.eps&&Math.abs(this.dy)<Mat.eps)))return n=this.getZeroCoordinates(),this.line.elementClass===Const.OBJECT_CLASS_LINE?t=this.getLowerAndUpperBounds(n,"ticksdistance"):t={lower:this.line.minX(),upper:this.line.maxX(),a1:0,a2:0,m1:0,m2:0},JXG$1.evaluate(this.visProp.type)==="polar"&&(u=this.board.getBoundingBox(),o=Math.max(Mat.hypot(u[0],u[1]),Mat.hypot(u[2],u[3])),t.upper=o),this.ticks=[],this.labelsData=[],this.equidistant?this.generateEquidistantTicks(n,t):this.generateFixedTicks(n,t),this},setTicksSizeVariables:function(n){var t,o,u,d,C=JXG$1.evaluate(this.visProp.majorheight)*.5,I=JXG$1.evaluate(this.visProp.minorheight)*.5;JXG$1.exists(n)?(o=this.line.minX(),u=this.line.maxX(),d=this.line.points.length,d<2?(this.dxMaj=0,this.dyMaj=0):Mat.relDif(n,o)<Mat.eps?(this.dxMaj=this.line.points[0].usrCoords[2]-this.line.points[1].usrCoords[2],this.dyMaj=this.line.points[1].usrCoords[1]-this.line.points[0].usrCoords[1]):Mat.relDif(n,u)<Mat.eps?(this.dxMaj=this.line.points[d-2].usrCoords[2]-this.line.points[d-1].usrCoords[2],this.dyMaj=this.line.points[d-1].usrCoords[1]-this.line.points[d-2].usrCoords[1]):(this.dxMaj=-Numerics.D(this.line.Y)(n),this.dyMaj=Numerics.D(this.line.X)(n))):(this.dxMaj=this.line.stdform[1],this.dyMaj=this.line.stdform[2]),this.dxMin=this.dxMaj,this.dyMin=this.dyMaj,this.dx=this.dxMaj,this.dy=this.dyMaj,t=Mat.hypot(this.dxMaj*this.board.unitX,this.dyMaj*this.board.unitY),this.dxMaj*=C/t*this.board.unitX,this.dyMaj*=C/t*this.board.unitY,this.dxMin*=I/t*this.board.unitX,this.dyMin*=I/t*this.board.unitY,this.minStyle=JXG$1.evaluate(this.visProp.minorheight)<0?"infinite":"finite",this.majStyle=JXG$1.evaluate(this.visProp.majorheight)<0?"infinite":"finite"},getZeroCoordinates:function(){var n,t,o,u,d,C,I,f,A,y=JXG$1.evaluate(this.visProp.anchor);return this.line.elementClass===Const.OBJECT_CLASS_LINE?this.line.type===Const.OBJECT_TYPE_AXIS?Geometry.projectPointToLine({coords:{usrCoords:[1,0,0]}},this.line,this.board):(o=this.line.point1.coords.usrCoords[0],n=this.line.point1.coords.usrCoords[1],t=this.line.point1.coords.usrCoords[2],C=this.line.point2.coords.usrCoords[0],u=this.line.point2.coords.usrCoords[1],d=this.line.point2.coords.usrCoords[2],y==="right"?this.line.point2.coords:y==="middle"?new Coords(Const.COORDS_BY_USER,[(o+C)*.5,(n+u)*.5,(t+d)*.5],this.board):JXG$1.isNumber(y)?new Coords(Const.COORDS_BY_USER,[o+(C-o)*y,n+(u-n)*y,t+(d-t)*y],this.board):this.line.point1.coords):(f=this.line.minX(),A=this.line.maxX(),y==="right"?I=A:y==="middle"?I=(f+A)*.5:JXG$1.isNumber(y)?I=f*(1-y)+A*y:I=f,I)},getLowerAndUpperBounds:function(n,t){var o,u,d,C,I,f,A,y,G,S,w,M,V,T,H,J=Mat.eps*10,z=JXG$1.evaluate(this.line.visProp.straightfirst),L=JXG$1.evaluate(this.line.visProp.straightlast),K=JXG$1.evaluate(this.visProp.includeboundaries);return this.line.elementClass===Const.OBJECT_CLASS_CURVE?{lower:this.line.minX(),upper:this.line.maxX()}:(I=new Coords(Const.COORDS_BY_USER,this.line.point1.coords.usrCoords,this.board),f=new Coords(Const.COORDS_BY_USER,this.line.point2.coords.usrCoords,this.board),A=Math.abs(I.usrCoords[0])>=Mat.eps&&I.scrCoords[1]>=0&&I.scrCoords[1]<=this.board.canvasWidth&&I.scrCoords[2]>=0&&I.scrCoords[2]<=this.board.canvasHeight,y=Math.abs(f.usrCoords[0])>=Mat.eps&&f.scrCoords[1]>=0&&f.scrCoords[1]<=this.board.canvasWidth&&f.scrCoords[2]>=0&&f.scrCoords[2]<=this.board.canvasHeight,JXG$1.exists(t)&&t==="ticksdistance"?(Geometry.calcStraight(this.line,I,f,0),T=this.getDistanceFromZero(n,I),H=this.getDistanceFromZero(n,f),Geometry.calcStraight(this.line,I,f,JXG$1.evaluate(this.line.visProp.margin)),T=this.getDistanceFromZero(n,I)-T,H=this.getDistanceFromZero(n,f).m2):Geometry.calcLineDelimitingPoints(this.line,I,f),d=JXG$1.evaluate(this.line.visProp.firstarrow),C=JXG$1.evaluate(this.line.visProp.lastarrow),M=this.getDistanceFromZero(n,I),V=this.getDistanceFromZero(n,f),(d||C)&&(w=this.board.renderer.getArrowHeadData(this.line,JXG$1.evaluate(this.line.visProp.strokewidth),""),this.board.renderer.getPositionArrowHead(this.line,I,f,w)),G=this.getDistanceFromZero(n,I),S=this.getDistanceFromZero(n,f),M=G-M,V=G-V,G<S?(o=G,u=S,!z&&A&&!K&&(o+=J),!L&&y&&!K&&(u-=J)):S<G?(o=S,u=G,!L&&y&&!K&&(o+=J),!z&&A&&!K&&(u-=J)):(o=0,u=0),{lower:o,upper:u,a1:M,a2:V,m1:T,m2:H})},getDistanceFromZero:function(n,t){var o,u,d,C,I;return o=this.line.point1.coords,u=this.line.point2.coords,I=n.distance(Const.COORDS_BY_USER,t),d=[u.usrCoords[0]-o.usrCoords[0],u.usrCoords[1]-o.usrCoords[1],u.usrCoords[2]-o.usrCoords[2]],C=[t.usrCoords[0]-n.usrCoords[0],t.usrCoords[1]-n.usrCoords[1],t.usrCoords[2]-n.usrCoords[2]],Mat.innerProduct(d,C,3)<0&&(I*=-1),I},generateEquidistantTicks:function(n,t){var o,u=Mat.eps,d,C,I=JXG$1.evaluate(this.visProp.minorticks);if(C=this.getDistanceMajorTicks(),this.line.elementClass===Const.OBJECT_CLASS_LINE&&(d=this.getXandYdeltas()),C*=JXG$1.evaluate(this.visProp.scale),C/=I+1,this.ticksDelta=C,!(C<Mat.eps)){for(o=0,JXG$1.evaluate(this.visProp.drawzero)||(o=C);o<=t.upper+u&&(o>=t.lower-u&&this.processTickPosition(n,o,C,d),o+=C,!(t.upper-o>C*1e4)););for(o=-C;o>=t.lower-u&&(o<=t.upper+u&&this.processTickPosition(n,o,C,d),o-=C,!(o-t.lower>C*1e4)););}},getDistanceMajorTicks:function(){var n,t,o,u,d,C,I=5,f,A,y;return JXG$1.evaluate(this.visProp.insertticks)?(o=this.getLowerAndUpperBounds(this.getZeroCoordinates(),""),d=o.upper-o.lower,C=JXG$1.evaluate(this.visProp.scale),f=d/(I+1)/C,A=JXG$1.evaluate(this.visProp.minticksdistance)/C,y=JXG$1.evaluate(this.visProp.minorticks),u=this.getXandYdeltas(),u.x*=this.board.unitX,u.y*=this.board.unitY,A/=Mat.hypot(u.x,u.y),A*=y+1,n=Math.pow(10,Math.floor(Math.log(A)/Math.LN10)),2*n>=A?n*=2:5*n>=A&&(n*=5),t=Math.pow(10,Math.floor(Math.log(f)/Math.LN10)),5*t<f?t*=5:2*t<f&&(t*=2),n=Math.max(n,t),n):JXG$1.evaluate(this.visProp.ticksdistance)},processTickPosition:function(n,t,o,u){var d,C,I,f,A,y=JXG$1.evaluate(this.visProp.ticksperlabel),G=null;this.line.elementClass===Const.OBJECT_CLASS_LINE?(d=n.usrCoords[1]+t*u.x,C=n.usrCoords[2]+t*u.y):(d=this.line.X(n+t),C=this.line.Y(n+t)),I=new Coords(Const.COORDS_BY_USER,[d,C],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&(G=n+t,this.setTicksSizeVariables(G)),I.major=Math.round(t/o)%(JXG$1.evaluate(this.visProp.minorticks)+1)===0,y||(y=JXG$1.evaluate(this.visProp.minorticks)+1),A=Math.round(t/o)%y===0,f=this.createTickPath(I,I.major),f.length===3&&(this.ticks.push(f),A&&JXG$1.evaluate(this.visProp.drawlabels)?this.labelsData.push(this.generateLabelData(this.generateLabelText(I,n,G),I,this.ticks.length)):this.labelsData.push(null))},generateFixedTicks:function(n,t){var o,u,d,C,I,f,A=Mat.eps,y,G=JXG$1.isArray(this.visProp.labels),S,w=JXG$1.evaluate(this.visProp.drawlabels);for(this.line.elementClass===Const.OBJECT_CLASS_LINE&&(S=this.getXandYdeltas()),d=0;d<this.fixedTicks.length;d++)this.line.elementClass===Const.OBJECT_CLASS_LINE?(y=this.fixedTicks[d],I=n.usrCoords[1]+y*S.x,f=n.usrCoords[2]+y*S.y):(y=n+this.fixedTicks[d],I=this.line.X(y),f=this.line.Y(y)),o=new Coords(Const.COORDS_BY_USER,[I,f],this.board),this.line.elementClass===Const.OBJECT_CLASS_CURVE&&this.setTicksSizeVariables(y),C=this.createTickPath(o,!0),C.length===3&&y>=t.lower-A&&y<=t.upper+A&&(this.ticks.push(C),w&&(G||JXG$1.exists(this.visProp.labels[d]))?(u=G?JXG$1.evaluate(this.visProp.labels[d]):y,this.labelsData.push(this.generateLabelData(this.generateLabelText(o,n,u),o,d))):this.labelsData.push(null))},getXandYdeltas:function(){var n,t,o=this.line.point1.Dist(this.line.point2);return n=this.line.point1.coords.usrCoords,t=this.line.point2.coords.usrCoords,{x:(t[1]-n[1])/o,y:(t[2]-n[2])/o}},_isInsideCanvas:function(n,t,o){var u=this.board.canvasWidth,d=this.board.canvasHeight;return o===void 0&&(o=0),n[0]>=o&&n[0]<=u-o&&t[0]>=o&&t[0]<=d-o||n[1]>=o&&n[1]<=u-o&&t[1]>=o&&t[1]<=d-o},createTickPath:function(n,t){var o,u,d,C,I,f,A,y,G,S=[-2e6,-2e6],w=[-2e6,-2e6],M,V,T,H,J,z,L,K,O;if(o=n.scrCoords,t?(C=this.dxMaj,I=this.dyMaj,G=this.majStyle,L=JXG$1.evaluate(this.visProp.majortickendings[0])>0,K=JXG$1.evaluate(this.visProp.majortickendings[1])>0):(C=this.dxMin,I=this.dyMin,G=this.minStyle,L=JXG$1.evaluate(this.visProp.tickendings[0])>0,K=JXG$1.evaluate(this.visProp.tickendings[1])>0),u=[-I*o[1]-C*o[2],I,C],t&&JXG$1.evaluate(this.visProp.type)==="polar"){if(H=this.board.getBoundingBox(),J=2*Math.PI,z=J/180,o=n.usrCoords,V=Mat.hypot(o[1],o[2]),T=Math.max(Mat.hypot(H[0],H[1]),Mat.hypot(H[2],H[3])),V<T){for(S=[],w=[],M=0;M<=J;M+=z)S.push(this.board.origin.scrCoords[1]+V*Math.cos(M)*this.board.unitX),w.push(this.board.origin.scrCoords[2]+V*Math.sin(M)*this.board.unitY);return[S,w,t]}}else{if(G==="infinite"){if(JXG$1.evaluate(this.visProp.ignoreinfinitetickendings)&&(L=K=!0),d=Geometry.meetLineBoard(u,this.board),L&&K)S[0]=d[0].scrCoords[1],S[1]=d[1].scrCoords[1],w[0]=d[0].scrCoords[2],w[1]=d[1].scrCoords[2];else if(O=[Mat.innerProduct(d[0].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0],Mat.innerProduct(d[1].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0]],O[0]<O[1]&&(d.reverse(),O.reverse()),L){if(O[0]<0)return[];O[1]<0?(S[0]=d[0].scrCoords[1],w[0]=d[0].scrCoords[2],S[1]=o[1],w[1]=o[2]):(S[0]=d[0].scrCoords[1],w[0]=d[0].scrCoords[2],S[1]=d[1].scrCoords[1],w[1]=d[1].scrCoords[2])}else if(K){if(O[1]>0)return[];O[0]>0?(S[0]=o[1],w[0]=o[2],S[1]=d[1].scrCoords[1],w[1]=d[1].scrCoords[2]):(S[0]=d[0].scrCoords[1],w[0]=d[0].scrCoords[2],S[1]=d[1].scrCoords[1],w[1]=d[1].scrCoords[2])}}else JXG$1.evaluate(this.visProp.face)===">"?y=Math.PI/4:JXG$1.evaluate(this.visProp.face)==="<"?y=-Math.PI/4:y=0,f=Math.cos(y)*C-Math.sin(y)*I,A=Math.sin(y)*C+Math.cos(y)*I,S[0]=o[1]+f*L,w[0]=o[2]-A*L,S[1]=o[1],w[1]=o[2],y=-y,f=Math.cos(y)*C-Math.sin(y)*I,A=Math.sin(y)*C+Math.cos(y)*I,S[2]=o[1]-f*K,w[2]=o[2]+A*K;if(this._isInsideCanvas(S,w))return[S,w,t]}return[]},formatLabelText:function(n){var t,o,u=JXG$1.evaluate(this.visProp.label.usemathjax),d=JXG$1.evaluate(this.visProp.label.usekatex),C=JXG$1.evaluate(this.visProp.scalesymbol);return JXG$1.isNumber(n)?(JXG$1.evaluate(this.visProp.label.tofraction)?u?t="\\("+JXG$1.toFraction(n,!0)+"\\)":t=JXG$1.toFraction(n,d):(o=JXG$1.evaluate(this.visProp.digits),this.useLocale()?t=this.formatNumberLocale(n,o):(t=(Math.round(n*1e11)/1e11).toString(),(t.length>JXG$1.evaluate(this.visProp.maxlabellength)||t.indexOf("e")!==-1)&&(JXG$1.evaluate(this.visProp.precision)!==3&&o===3&&(o=JXG$1.evaluate(this.visProp.precision)),t=n.toExponential(o).toString()))),JXG$1.evaluate(this.visProp.beautifulscientificticklabels)&&(t=this.beautifyScientificNotationLabel(t)),t.indexOf(".")>-1&&t.indexOf("e")===-1&&(t=t.replace(/0+$/,""),t=t.replace(/\.$/,""))):t=n.toString(),C.length>0&&(t==="1"?t=C:t==="-1"?t="-"+C:t!=="0"&&(t=t+C)),JXG$1.evaluate(this.visProp.useunicodeminus)&&(t=t.replace(/-/g,"−")),t},beautifyScientificNotationLabel:function(n){var t;return n.indexOf("e")===-1?n:(t=parseFloat(n.substring(0,n.indexOf("e")))+n.substring(n.indexOf("e")),t=t.replace(/e(.*)$/g,function(o,u){var d="•10";return d+=u.replace(/-/g,"⁻").replace(/\+/g,"").replace(/0/g,"⁰").replace(/1/g,"¹").replace(/2/g,"²").replace(/3/g,"³").replace(/4/g,"⁴").replace(/5/g,"⁵").replace(/6/g,"⁶").replace(/7/g,"⁷").replace(/8/g,"⁸").replace(/9/g,"⁹"),d}),t)},generateLabelText:function(n,t,o){var u,d;if(!JXG$1.exists(o)){if(d=this.getDistanceFromZero(t,n),Math.abs(d)<Mat.eps)return"0";o=d/JXG$1.evaluate(this.visProp.scale)}return u=this.formatLabelText(o),u},generateLabelData:function(n,t,o){var u,d,C,I;return I=JXG$1.evaluate(this.visProp.label.fontsize),u=[t.scrCoords[1],t.scrCoords[1]],d=[t.scrCoords[2],t.scrCoords[2]],C=I===void 0?12:I,C*=.5,this._isInsideCanvas(u,d,C)?(u=JXG$1.evaluate(this.visProp.label.offset[0]),d=JXG$1.evaluate(this.visProp.label.offset[1]),{x:t.usrCoords[1]+u/this.board.unitX,y:t.usrCoords[2]+d/this.board.unitY,t:n,i:o}):null},update:function(){return this.needsUpdate&&this.board.canvasWidth!==0&&this.board.canvasHeight!==0&&this.calculateTicksCoordinates(),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&this.board.renderer.updateTicks(this),this.updateRendererLabels(),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateRendererLabels:function(){var n,t,o,u,d,C,I,f;for(o=this.labelsData.length,u=this.labels.length,n=0,t=0;n<o;n++)this.labelsData[n]!==null&&(I=this.labelsData[n],t<u?(C=this.labels[t],C.setText(I.t),C.setCoords(I.x,I.y),t++):(this.labelCounter+=1,d={isLabel:!0,layer:this.board.options.layer.line,highlightStrokeColor:this.board.options.text.strokeColor,highlightStrokeWidth:this.board.options.text.strokeWidth,highlightStrokeOpacity:this.board.options.text.strokeOpacity,priv:this.visProp.priv},d=JXG$1.deepCopy(d,this.visProp.label),d.id=this.id+I.i+"Label"+this.labelCounter,C=JXG$1.createText(this.board,[I.x,I.y,I.t],d),this.addChild(C),C.setParents(this),C.isDraggable=!1,C.dump=!1,this.labels.push(C)),f=JXG$1.evaluate(this.visProp.label.visible),f==="inherit"&&(f=this.visPropCalc.visible),C.prepareUpdate().updateVisibility(f).updateRenderer(),C.distanceX=JXG$1.evaluate(this.visProp.label.offset[0]),C.distanceY=JXG$1.evaluate(this.visProp.label.offset[1]));for(o=t,t=o;t<u;t++)this.board.renderer.display(this.labels[t],!1),this.labels[t].visProp.visible=this.labels[t].visPropCalc.visible=!1;return this},hideElement:function(){var n;for(JXG$1.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),n=0;n<this.labels.length;n++)JXG$1.exists(this.labels[n])&&this.labels[n].hideElement();return this},showElement:function(){var n;for(JXG$1.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!1),n=0;n<this.labels.length;n++)JXG$1.exists(this.labels[n])&&this.labels[n].showElement();return this}});JXG$1.createTicks=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"ticks");if(t.length<2?d=C.ticksdistance:d=t[1],t[0].elementClass===Const.OBJECT_CLASS_LINE||t[0].elementClass===Const.OBJECT_CLASS_CURVE)u=new JXG$1.Ticks(t[0],d,C);else throw new Error("JSXGraph: Can't create Ticks with parent types '"+typeof t[0]+"'.");return JXG$1.isFunction(C.generatelabelvalue)&&(u.generateLabelText=C.generatelabelvalue),JXG$1.isFunction(C.generatelabeltext)&&(u.generateLabelText=C.generatelabeltext),u.setParents(t[0]),u.isDraggable=!0,u.fullUpdate(t[0].visPropCalc.visible),u};JXG$1.createHatchmark=function(n,t,o){var u,d,C,I,f,A,y=[],G=JXG$1.copyAttributes(o,n.options,"hatch");if(t[0].elementClass!==Const.OBJECT_CLASS_LINE&&t[0].elementClass!==Const.OBJECT_CLASS_CURVE||typeof t[1]!="number")throw new Error("JSXGraph: Can't create Hatch mark with parent types '"+typeof t[0]+"' and '"+typeof t[1]+" and ''"+typeof t[2]+"'.");for(u=t[1],I=G.ticksdistance,f=(u-1)*I,C=-f*.5,d=0;d<u;d++)y[d]=C+d*I;return A=n.create("ticks",[t[0],y],G),A.elType="hatch",t[0].inherits.push(A),A};JXG$1.registerElement("ticks",JXG$1.createTicks);JXG$1.registerElement("hash",JXG$1.createHatchmark);JXG$1.registerElement("hatch",JXG$1.createHatchmark);JXG$1.Ticks;var bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],NAMEMAX=256;JXG$1.Util=JXG$1.Util||{};JXG$1.Util.Unzip=function(n){var t,o,u,d,C=[],I=0,f=[],A=new Array(32768),y=0,G=!1,S=n.length,w=0,M=1,V=new Array(288),T=new Array(32),H=0,J=null,z=0,L=new Array(17),K=[];L[0]=0;function O(){return w<S?n[w++]:-1}function Q(){M=1}function ee(){var Ze;try{Ze=M&1,M>>=1,M===0&&(M=O(),Ze=M&1,M=M>>1|128)}catch(he){throw console.log("Probably problems on iOS7 with >>"),he}return Ze}function ie(Ze){var he=0,Ie=Ze;try{for(;Ie--;)he=he<<1|ee();Ze&&(he=bitReverse[he]>>8-Ze)}catch(Be){throw console.log("Probably problems on iOS7 with >>"),Be}return he}function te(){y=0}function se(Ze){A[y++]=Ze,C.push(String.fromCharCode(Ze)),y===32768&&(y=0)}function ae(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1}function le(){for(var Ze=!0;Ze;){if(L[z]>=d)return-1;if(u[L[z]]===z)return L[z]++;L[z]++}}function ge(){var Ze=J[H],he;if(z===17)return-1;if(H++,z++,he=le(),he>=0)Ze.b0=he;else if(Ze.b0=32768,ge())return-1;if(he=le(),he>=0)Ze.b1=he,Ze.jump=null;else if(Ze.b1=32768,Ze.jump=J[H],Ze.jumppos=H,ge())return-1;return z--,0}function be(Ze,he,Ie,Be){var ue;for(J=Ze,H=0,u=Ie,d=he,ue=0;ue<17;ue++)L[ue]=0;return z=0,ge()?-1:0}function Xe(Ze){for(var he,Ie,Be,ue=!0,me=0,xe=Ze[me];ue;)if(Be=ee(),Be){if(!(xe.b1&32768))return xe.b1;for(xe=xe.jump,he=Ze.length,Ie=0;Ie<he;Ie++)if(Ze[Ie]===xe){me=Ie;break}}else{if(!(xe.b0&32768))return xe.b0;me++,xe=Ze[me]}}function Ce(){var Ze,he,Ie,Be,ue,me,xe,Je,Ve,Ee,Ct,st,wt,Qe,Ue,Ge,Gt=!0;do if(Ze=ee(),Ie=ie(2),Ie===0)for(Q(),Ee=O(),Ee|=O()<<8,st=O(),st|=O()<<8,(Ee^~st)&65535&&JXG$1.debug(`BlockLen checksum mismatch
`);Ee--;)he=O(),se(he);else if(Ie===1)for(;Gt;)if(ue=bitReverse[ie(7)]>>1,ue>23?(ue=ue<<1|ee(),ue>199?(ue-=128,ue=ue<<1|ee()):(ue-=48,ue>143&&(ue=ue+136))):ue+=256,ue<256)se(ue);else{if(ue===256)break;for(ue-=257,Ve=ie(cplext[ue])+cplens[ue],ue=bitReverse[ie(5)]>>3,cpdext[ue]>8?(Ct=ie(8),Ct|=ie(cpdext[ue]-8)<<8):Ct=ie(cpdext[ue]),Ct+=cpdist[ue],ue=0;ue<Ve;ue++)he=A[y-Ct&32767],se(he)}else if(Ie===2){for(xe=new Array(320),Qe=257+ie(5),Ue=1+ie(5),Ge=4+ie(4),ue=0;ue<19;ue++)xe[ue]=0;for(ue=0;ue<Ge;ue++)xe[border[ue]]=ie(3);for(Ve=T.length,Be=0;Be<Ve;Be++)T[Be]=new ae;if(be(T,19,xe))return te(),1;for(wt=Qe+Ue,Be=0;Be<wt;)if(ue=Xe(T),ue<16)xe[Be++]=ue;else if(ue===16){if(ue=3+ie(2),Be+ue>wt)return te(),1;for(me=Be?xe[Be-1]:0;ue--;)xe[Be++]=me}else{if(ue===17?ue=3+ie(3):ue=11+ie(7),Be+ue>wt)return te(),1;for(;ue--;)xe[Be++]=0}for(Ve=V.length,Be=0;Be<Ve;Be++)V[Be]=new ae;if(be(V,Qe,xe))return te(),1;for(Ve=V.length,Be=0;Be<Ve;Be++)T[Be]=new ae;for(Je=[],Be=Qe;Be<xe.length;Be++)Je[Be-Qe]=xe[Be];if(be(T,Ue,Je))return te(),1;for(;Gt;)if(ue=Xe(V),ue>=256){if(ue-=256,ue===0)break;for(ue-=1,Ve=ie(cplext[ue])+cplens[ue],ue=Xe(T),cpdext[ue]>8?(Ct=ie(8),Ct|=ie(cpdext[ue]-8)<<8):Ct=ie(cpdext[ue]),Ct+=cpdist[ue];Ve--;)he=A[y-Ct&32767],se(he)}else se(ue)}while(!Ze);return te(),Q(),0}function Re(){var Ze,he,Ie,Be,ue,me,xe,Je,Ve=[];try{if(C=[],G=!1,Ve[0]=O(),Ve[1]=O(),Ve[0]===120&&Ve[1]===218&&(Ce(),f[I]=[C.join(""),"geonext.gxt"],I++),Ve[0]===31&&Ve[1]===139&&(Se(),f[I]=[C.join(""),"file"],I++),Ve[0]===80&&Ve[1]===75){if(G=!0,Ve[2]=O(),Ve[3]=O(),Ve[2]===3&&Ve[3]===4){for(Ve[0]=O(),Ve[1]=O(),t=O(),t|=O()<<8,Je=O(),Je|=O()<<8,O(),O(),O(),O(),xe=O(),xe|=O()<<8,xe|=O()<<16,xe|=O()<<24,me=O(),me|=O()<<8,me|=O()<<16,me|=O()<<24,ue=O(),ue|=O()<<8,ue|=O()<<16,ue|=O()<<24,Be=O(),Be|=O()<<8,Ie=O(),Ie|=O()<<8,Ze=0,K=[];Be--;)he=O(),he==="/"|he===":"?Ze=0:Ze<NAMEMAX-1&&(K[Ze++]=String.fromCharCode(he));for(o||(o=K),Ze=0;Ze<Ie;)he=O(),Ze++;if(Je===8&&(Ce(),f[I]=new Array(2),f[I][0]=C.join(""),f[I][1]=K.join(""),I++),Se())return!1}return!0}}catch(Ee){throw console.log("Probably problems on iOS7 with >>"),Ee}return!1}function Se(){var Ze,he,Ie,Be,ue,me=[];if(t&8&&(me[0]=O(),me[1]=O(),me[2]=O(),me[3]=O(),me[0]===80&&me[1]===75&&me[2]===7&&me[3]===8?(Ze=O(),Ze|=O()<<8,Ze|=O()<<16,Ze|=O()<<24):Ze=me[0]|me[1]<<8|me[2]<<16|me[3]<<24,he=O(),he|=O()<<8,he|=O()<<16,he|=O()<<24,Ie=O(),Ie|=O()<<8,Ie|=O()<<16,Ie|=O()<<24),G&&Re())return!1;if(me[0]=O(),me[0]!==8)return!0;if(t=O(),O(),O(),O(),O(),O(),O(),t&4)for(me[0]=O(),me[2]=O(),z=me[0]+256*me[1],Be=0;Be<z;Be++)O();if(t&8)for(Be=0,K=[],ue=O();ue;)(ue==="7"||ue===":")&&(Be=0),Be<NAMEMAX-1&&(K[Be++]=ue),ue=O();if(t&16)for(ue=O();ue;)ue=O();return t&2&&(O(),O()),Ce(),Ze=O(),Ze|=O()<<8,Ze|=O()<<16,Ze|=O()<<24,Ie=O(),Ie|=O()<<8,Ie|=O()<<16,Ie|=O()<<24,G&&Re(),!1}JXG$1.Util.Unzip.prototype.unzipFile=function(Ze){var he;for(this.unzip(),he=0;he<f.length;he++)if(f[he][1]===Ze)return f[he][0];return""},JXG$1.Util.Unzip.prototype.unzip=function(){return Re(),f}};JXG$1.Util;JXG$1.CA=function(n,t,o){this.node=n,this.createNode=t,this.parser=o};JXG$1.extend(JXG$1.CA.prototype,{findMapNode:function(n,t){var o,u,d;if(t.value==="op_assign"&&t.children[0].value===n)return t.children[1];if(t.children){for(u=t.children.length,o=0;o<u;++o)if(d=this.findMapNode(n,t.children[o]),d!==null)return d}return null},setMath:function(n){var t,o;if((n.type=="node_op"&&(n.value=="op_add"||n.value=="op_sub"||n.value=="op_mul"||n.value=="op_div"||n.value=="op_neg"||n.value=="op_execfun"||n.value=="op_exp")||n.type=="node_var"||n.type=="node_const")&&(n.isMath=!0),n.children)for(o=n.children.length,t=0;t<o;++t)this.setMath(n.children[t])},deriveElementary:function(n,t){var o=n.children[0].value,u=n.children[1],d;switch(o){case"abs":d=this.createNode("node_op","op_div",u[0],this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0]))]));break;case"sqrt":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_mul",this.createNode("node_const",2),this.createNode(n.type,n.value,JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1]))));break;case"sin":d=this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(u));break;case"cos":d=this.createNode("node_op","op_neg",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(u)));break;case"tan":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),JXG$1.deepCopy(u)),this.createNode("node_const",2)));break;case"cot":d=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),JXG$1.deepCopy(u)),this.createNode("node_const",2))));break;case"exp":d=this.createNode(n.type,n.value,JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1]));break;case"pow":d=this.createNode("node_op","op_mul",this.createNode("node_op","op_execfun",JXG$1.deepCopy(n.children[0]),JXG$1.deepCopy(n.children[1])),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(n.children[1][0],t),this.createNode("node_op","op_div",JXG$1.deepCopy(n.children[1][1]),JXG$1.deepCopy(n.children[1][0]))),this.createNode("node_op","op_mul",this.derivative(n.children[1][1],t),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(n.children[1][0])]))));break;case"log":case"ln":d=this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(u[0]));break;case"log2":case"lb":case"ld":d=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(u[0])),this.createNode("node_const",1.4426950408889634));break;case"log10":case"lg":d=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),JXG$1.deepCopy(u[0])),this.createNode("node_const",.43429448190325176));break;case"asin":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0])))]));break;case"acos":d=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0])))])));break;case"atan":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0]))));break;case"acot":d=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0])))));break;case"sinh":d=this.createNode("node_op","op_execfun",this.createNode("node_var","cosh"),[JXG$1.deepCopy(u[0])]);break;case"cosh":d=this.createNode("node_op","op_execfun",this.createNode("node_var","sinh"),[JXG$1.deepCopy(u[0])]);break;case"tanh":d=this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","tanh"),[JXG$1.deepCopy(u[0])]),this.createNode("node_const",2)));break;case"asinh":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0])),this.createNode("node_const",1))]));break;case"acosh":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0])),this.createNode("node_const",1))]));break;case"atanh":d=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",JXG$1.deepCopy(u[0]),JXG$1.deepCopy(u[0]))));break;default:throw d=this.createNode("node_const",0),console.log('Derivative of "'+o+'" not yet implemented'),new Error("Error("+this.line+"): ")}return d},derivative:function(n,t){var o;switch(n.type){case"node_op":switch(n.value){case"op_execfun":n.children[0].value=="pow"?o=this.deriveElementary(n,t):n.children[1].length===0?o=this.createNode("node_const",0):o=this.createNode("node_op","op_mul",this.deriveElementary(n,t),this.derivative(n.children[1][0],t));break;case"op_div":o=this.createNode("node_op","op_div",this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",this.derivative(n.children[0],t),JXG$1.deepCopy(n.children[1])),this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[0]),this.derivative(n.children[1],t))),this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[1]),JXG$1.deepCopy(n.children[1])));break;case"op_mul":o=this.createNode("node_op","op_add",this.createNode("node_op","op_mul",JXG$1.deepCopy(n.children[0]),this.derivative(n.children[1],t)),this.createNode("node_op","op_mul",this.derivative(n.children[0],t),JXG$1.deepCopy(n.children[1])));break;case"op_neg":o=this.createNode("node_op","op_neg",this.derivative(n.children[0],t));break;case"op_add":case"op_sub":o=this.createNode("node_op",n.value,this.derivative(n.children[0],t),this.derivative(n.children[1],t));break;case"op_exp":o=this.createNode("node_op","op_mul",JXG$1.deepCopy(n),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(n.children[0],t),this.createNode("node_op","op_div",JXG$1.deepCopy(n.children[1]),JXG$1.deepCopy(n.children[0]))),this.createNode("node_op","op_mul",this.derivative(n.children[1],t),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[JXG$1.deepCopy(n.children[0])]))));break}break;case"node_var":n.value===t?o=this.createNode("node_const",1):o=this.createNode("node_const",0);break;case"node_const":o=this.createNode("node_const",0);break}return o},expandDerivatives:function(n,t,o){var u,d,C,I,f,A,y,G,S,w,M,V,T;if(A=0,!n)return A;for(this.line=n.line,this.col=n.col,u=n.children.length,d=0;d<u;++d)if(n.children[d]&&n.children[d].type)n.children[d]=this.expandDerivatives(n.children[d],n,o);else if(JXG$1.isArray(n.children[d]))for(C=0;C<n.children[d].length;++C)n.children[d][C]&&n.children[d][C].type&&(n.children[d][C]=this.expandDerivatives(n.children[d][C],n,o));switch(n.type){case"node_op":switch(n.value){case"op_execfun":if(n.children[0]&&n.children[0].value==="D"){if(T=!1,n.children[1][0].type=="node_var"&&(S=n.children[1][0].value,I=this.findMapNode(S,o),I!==null&&(T=!0)),T?(M=I.children[0],n.children[1].length>=2?w=n.children[1][1].value:w=I.children[0][0],f=I.children[1]):(f=n.children[1][0],M=["x"],n.children[1].length>=2?w=n.children[1][1].value:w="x"),n.children[1].length>=3?V=n.children[1][2].value:V=1,G=f,V>=1)for(;V>=1;)G=this.derivative(G,w),G=this.removeTrivialNodes(G),V--;t.type=="node_op"&&t.value=="op_assign"?y=this.createNode("node_op","op_map",M,G):y=G,this.setMath(y),n.type=y.type,n.value=y.value,y.children.length>0&&(n.children[0]=y.children[0]),y.children.length>1&&(n.children[1]=y.children[1])}}break}return n},removeTrivialNodes:function(n){var t,o,u,d,C;if(JXG$1.isArray(n))for(o=n.length,t=0;t<o;++t)n[t]=this.removeTrivialNodes(n[t]);if(n.type!="node_op"||!n.children)return n;for(o=n.children.length,t=0;t<o;++t){this.mayNotBeSimplified=!1;do n.children[t]=this.removeTrivialNodes(n.children[t]);while(this.mayNotBeSimplified)}switch(n.value){case"op_map":if(u=n.children[0],d=n.children[1],d.type=="node_var"){for(t=0;t<u.length;++t)if(u[t]==d.value){d.isMath=!0;break}}break;case"op_add":if(u=n.children[0],d=n.children[1],u.type=="node_const"&&u.value===0)return d;if(d.type=="node_const"&&d.value===0)return u;if(u.type=="node_const"&&d.type=="node_const")return u.value+=d.value,u;break;case"op_mul":if(u=n.children[0],d=n.children[1],u.type=="node_const"&&u.value==1)return d;if(d.type=="node_const"&&d.value==1||u.type=="node_const"&&u.value===0)return u;if(d.type=="node_const"&&d.value===0||d.type=="node_const"&&d.value===0)return d;if(u.type=="node_op"&&u.value=="op_neg"&&d.type=="node_op"&&d.value=="op_neg")return n.children=[u.children[0],d.children[0]],this.mayNotBeSimplified=!0,n;if(u.value=="op_neg"&&d.value!="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_mul",u.children[0],d)],this.mayNotBeSimplified=!0,n;if(u.value!="op_neg"&&d.value=="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_mul",u,d.children[0])],this.mayNotBeSimplified=!0,n;if(u.value=="op_div"&&u.children[0].type=="node_const"&&u.children[0].value==1)return n.type="node_op",n.value="op_div",n.children=[d,u.children[1]],this.mayNotBeSimplified=!0,n;if(d.value=="op_div"&&d.children[0].type=="node_const"&&d.children[0].value==1)return n.type="node_op",n.value="op_div",n.children=[u,d.children[1]],this.mayNotBeSimplified=!0,n;if(u.type!="node_const"&&d.type=="node_const")return n.children=[d,u],this.mayNotBeSimplified=!0,n;if(u.type!="node_const"&&d.type=="node_op"&&d.value=="op_neg"&&d.children[0].type=="node_const")return n.children=[d,u],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value!="op_execfun"&&(d.type=="node_var"||d.type=="node_op"&&d.value=="op_execfun"))return n.children=[d,u],this.mayNotBeSimplified=!0,n;if(u.type!="node_op"&&d.type=="node_op"&&d.value=="op_neg"&&d.children[0].type=="node_var")return n.children=[d,u],this.mayNotBeSimplified=!0,n;if(u.type!="node_const"&&d.type=="node_op"&&(d.value=="op_mul"||d.value=="op_div")&&d.children[0].type=="node_const")return C=d.children[0],d.children[0]=u,n.children=[C,d],this.mayNotBeSimplified=!0,n;if(d.type!="node_const"&&u.type=="node_op"&&u.value=="op_mul"&&u.children[0].type=="node_const")return n.children=[u.children[0],this.createNode("node_op","op_mul",u.children[1],d)],this.mayNotBeSimplified=!0,n;if(u.type=="node_const"&&d.type=="node_const")return u.value*=d.value,u;if(u.type=="node_const"&&d.type=="node_op"&&(d.value=="op_mul"||d.value=="op_div")&&d.children[0].type=="node_const")return d.children[0].value*=u.value,d;if(u.hash=this.parser.compile(u),d.hash=this.parser.compile(d),u.hash===d.hash)return n.value="op_exp",n.children[1]=this.createNode("node_const",2),n;if(u.type=="node_const"&&d.type=="node_op"&&(d.value=="op_mul"||d.value=="op_div")&&d.children[0].type=="node_const")return d.children[0].value*=u.value,d;if(d.type=="node_op"&&d.value=="op_exp"&&(u.hash||(u.hash=this.parser.compile(u)),d.children[0].hash||(d.children[0].hash=this.parser.compile(d.children[0])),u.hash===d.children[0].hash))return d.children[1]=this.createNode("node_op","op_add",d.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,d;if(u.type=="node_op"&&u.value=="op_exp"&&d.type=="node_op"&&d.value=="op_exp"&&(u.children[0].hash=this.parser.compile(u.children[0]),d.children[0].hash=this.parser.compile(d.children[0]),u.children[0].hash===d.children[0].hash))return u.children[1]=this.createNode("node_op","op_add",u.children[1],d.children[1]),this.mayNotBeSimplified=!0,u;break;case"op_sub":if(u=n.children[0],d=n.children[1],u.type=="node_const"&&u.value===0)return n.value="op_neg",n.children[0]=d,n;if(d.type=="node_const"&&d.value===0)return u;if(u.type=="node_const"&&d.type=="node_const"&&u.value==d.value)return this.createNode("node_const",0);if(u.type=="node_var"&&d.type=="node_var"&&u.value==d.value)return this.createNode("node_const",0);if(u.type=="node_const"&&d.type=="node_const")return u.value-=d.value,u;if(u.type=="node_op"&&u.value=="op_mul"&&d.type=="node_op"&&d.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),d.children[1].hash=this.parser.compile(d.children[1]),u.children[1].hash===d.children[1].hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",u.children[0],d.children[0]),u.children[1]],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),d.hash=this.parser.compile(d),u.children[1].hash===d.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",u.children[0],this.createNode("node_const",1)),d],this.mayNotBeSimplified=!0,n;if(d.type=="node_op"&&d.value=="op_mul"&&(d.children[1].hash=this.parser.compile(d.children[1]),u.hash=this.parser.compile(u),d.children[1].hash===u.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_sub",this.createNode("node_const",1),d.children[0]),u],this.mayNotBeSimplified=!0,n;break;case"op_neg":if(u=n.children[0],u.type=="node_const"&&u.value===0)return u;if(u.type=="node_op"&&u.value=="op_neg")return u.children[0];break;case"op_div":if(u=n.children[0],d=n.children[1],u.type=="node_const"&&d.type=="node_const"&&u.value==d.value&&u.value!==0)return u.value=1,u;if(u.type=="node_const"&&u.value===0&&d.type=="node_const"&&d.value!==0)return u.value=0,u;if(u.type=="node_const"&&u.value===0&&(d.type=="node_op"||d.type=="node_var"))return n.type="node_const",n.value=0,n;if(u.type=="node_var"&&d.type=="node_var"&&u.value==d.value)return this.createNode("node_const",1);if(u.type=="node_const"&&u.value!==0&&d.type=="node_const"&&d.value===0)return u.value>0?u.value=1/0:u.value=-1/0,u;if(u.type=="node_op"&&u.value=="op_neg"&&d.type=="node_op"&&d.value=="op_neg")return n.children=[u.children[0],d.children[0]],this.mayNotBeSimplified=!0,n;if(u.value=="op_neg"&&d.value!="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_div",u.children[0],d)],this.mayNotBeSimplified=!0,n;if(u.value!="op_neg"&&d.value=="op_neg")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_op","op_div",u,d.children[0])],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_exp"&&(d.hash||(d.hash=this.parser.compile(d)),u.children[0].hash||(u.children[0].hash=this.parser.compile(u.children[0])),d.hash===u.children[0].hash))return u.children[1]=this.createNode("node_op","op_sub",u.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,u;if(d.type!="node_const"&&u.type=="node_op"&&u.value=="op_mul"&&u.children[0].type=="node_const")return n.value="op_mul",n.children=[u.children[0],this.createNode("node_op","op_div",u.children[1],d)],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_exp"&&d.type=="node_op"&&d.value=="op_exp"&&(u.children[0].hash=this.parser.compile(u.children[0]),d.children[0].hash=this.parser.compile(d.children[0]),u.children[0].hash===d.children[0].hash))return u.children[1]=this.createNode("node_op","op_sub",u.children[1],d.children[1]),this.mayNotBeSimplified=!0,u;break;case"op_exp":if(u=n.children[0],d=n.children[1],d.type=="node_const"&&d.value===0)return d.value=1,d;if(d.type=="node_const"&&d.value==1||u.type=="node_const"&&u.value==1||u.type=="node_const"&&u.value===0&&d.type=="node_const"&&d.value!==0)return u;if(u.type=="node_op"&&u.value=="op_exp")return n.children=[u.children[0],this.createNode("node_op","op_mul",u.children[1],d)],n;break}switch(n.value){case"op_add":if(u=n.children[0],d=n.children[1],u.type=="node_const"&&d.type=="node_const"&&u.value==d.value)return u.value+=d.value,u;if(u.type=="node_var"&&d.type=="node_var"&&u.value==d.value)return n.children[0]=this.createNode("node_const",2),n.value="op_mul",n;if(u.type=="node_op"&&u.value=="op_neg")return n.value="op_sub",n.children[0]=d,n.children[1]=u.children[0],this.mayNotBeSimplified=!0,n;if(d.type=="node_op"&&d.value=="op_neg")return n.value="op_sub",n.children[1]=d.children[0],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_mul"&&d.type=="node_op"&&d.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),d.children[1].hash=this.parser.compile(d.children[1]),u.children[1].hash===d.children[1].hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",u.children[0],d.children[0]),u.children[1]],this.mayNotBeSimplified=!0,n;if(u.type=="node_op"&&u.value=="op_mul"&&(u.children[1].hash=this.parser.compile(u.children[1]),d.hash=this.parser.compile(d),u.children[1].hash===d.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",u.children[0],this.createNode("node_const",1)),d],this.mayNotBeSimplified=!0,n;if(d.type=="node_op"&&d.value=="op_mul"&&(d.children[1].hash=this.parser.compile(d.children[1]),u.hash=this.parser.compile(u),d.children[1].hash===u.hash))return n.value="op_mul",n.children=[this.createNode("node_op","op_add",this.createNode("node_const",1),d.children[0]),u],this.mayNotBeSimplified=!0,n;break;case"op_sub":if(u=n.children[0],d=n.children[1],d.type=="node_op"&&d.value=="op_neg")return n.value="op_add",n.children[1]=d.children[0],this.mayNotBeSimplified=!0,n;break;case"op_execfun":return this.simplifyElementary(n)}return n},simplifyElementary:function(n){var t=n.children[0].value,o=n.children[1];if(o.length==0)return n;switch(t){case"sin":case"tan":if(o[0].type=="node_const"&&o[0].value===0||o[0].type=="node_var"&&o[0].value=="PI"||o[0].type=="node_op"&&o[0].value=="op_mul"&&o[0].children[0].type=="node_const"&&o[0].children[0].value%1===0&&o[0].children[1].type=="node_var"&&o[0].children[1].value=="PI")return n.type="node_const",n.value=0,n;break;case"cos":if(o[0].type=="node_const"&&o[0].value===0)return n.type="node_const",n.value=1,n;if(o[0].type=="node_var"&&o[0].value=="PI")return n.type="node_op",n.value="op_neg",n.children=[this.createNode("node_const",1)],n;break;case"exp":if(o[0].type=="node_const"&&o[0].value===0)return n.type="node_const",n.value=1,n;break;case"pow":if(o[1].type=="node_const"&&o[1].value===0)return n.type="node_const",n.value=1,n;break}return n}});JXG$1.CA;JXG$1.Dump={addMarkers:function(n,t,o){var u,d,C;JXG$1.isArray(t)||(t=[t]),JXG$1.isArray(o)||(o=[o]),d=Math.min(t.length,o.length),t.length=d,o.length=d;for(u in n.objects)if(n.objects.hasOwnProperty(u))for(C=0;C<d;C++)n.objects[u][t[C]]=o[C]},deleteMarkers:function(n,t){var o,u,d;JXG$1.isArray(t)||(t=[t]),u=t.length,t.length=u;for(o in n.objects)if(n.objects.hasOwnProperty(o))for(d=0;d<u;d++)delete n.objects[o][t[d]]},str:function(n){return typeof n=="string"&&n.slice(0,7)!=="function"&&(n='"'+n+'"'),n},minimizeObject:function(n,t){var o,u,d,C={},I=JXG$1.deepCopy(n),f=[];for(d=1;d<arguments.length;d++)f.push(arguments[d]);for(C=JXG$1.deepCopy(C,JXG$1.Options.elements,!0),d=f.length;d>0;d--)C=JXG$1.deepCopy(C,f[d-1],!0);for(o in C)C.hasOwnProperty(o)&&(u=o.toLowerCase(),typeof C[o]!="object"&&C[o]===I[u]&&delete I[u]);return I},prepareAttributes:function(n,t){var o,u;o=this.minimizeObject(t.getAttributes(),JXG$1.Options[t.elType]);for(u in t.subs)t.subs.hasOwnProperty(u)&&(o[u]=this.minimizeObject(t.subs[u].getAttributes(),JXG$1.Options[t.elType][u],JXG$1.Options[t.subs[u].elType]),o[u].id=t.subs[u].id,o[u].name=t.subs[u].name);return o.id=t.id,o.name=t.name,o},setBoundingBox:function(n,t,o){return n.push({obj:o,method:"setBoundingBox",params:[t.getBoundingBox(),t.keepaspectratio]}),n},dump:function(n){var t,o,u,d,C=[],I=[],f=[],A=n.objectsList.length;for(this.addMarkers(n,"dumped",!1),t=0;t<A;t++)if(o=n.objectsList[t],u={},!o.dumped&&o.dump){for(u.type=o.getType(),u.parents=o.getParents().slice(),u.type==="point"&&u.parents[0]===1&&(u.parents=u.parents.slice(1)),d=0;d<u.parents.length;d++)JXG$1.isString(u.parents[d])&&u.parents[d][0]!=="'"&&u.parents[d][0]!=='"'?u.parents[d]='"'+u.parents[d]+'"':JXG$1.isArray(u.parents[d])&&(u.parents[d]="["+u.parents[d].toString()+"]");u.attributes=this.prepareAttributes(n,o),u.type==="glider"&&o.onPolygon&&C.push({obj:o.id,prop:"onPolygon",val:!0}),f.push(u)}return this.deleteMarkers(n,"dumped"),{elements:f,props:C,methods:I}},arrayToParamStr:function(n,t){var o,u=[];for(o=0;o<n.length;o++)u.push(t.call(this,n[o]));return u.join(", ")},toJCAN:function(n){var t,o,u;switch(typeof n){case"object":if(n){if(o=[],JXG$1.isArray(n)){for(t=0;t<n.length;t++)o.push(this.toJCAN(n[t]));return"["+o.join(",")+"]"}for(u in n)n.hasOwnProperty(u)&&o.push(u+": "+this.toJCAN(n[u]));return"<<"+o.join(", ")+">> "}return"null";case"string":return"'"+n.replace(/\\/g,"\\\\").replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return n.toString();case"null":return"null"}},toJessie:function(n){var t,o,u,d=this.dump(n),C=[];for(d.methods=this.setBoundingBox(d.methods,n,"$board"),o=d.elements,t=0;t<o.length;t++)o[t].attributes.name.length>0&&C.push("// "+o[t].attributes.name),C.push("s"+t+" = "+o[t].type+"("+o[t].parents.join(", ")+") "+this.toJCAN(o[t].attributes).replace(/\n/,"\\n")+";"),o[t].type==="axis"&&(u=o[t].attributes.id,n.objects[u].defaultTicks===null&&C.push("s"+t+".removeAllTicks();")),C.push("");for(t=0;t<d.methods.length;t++)C.push(d.methods[t].obj+"."+d.methods[t].method+"("+this.arrayToParamStr(d.methods[t].params,this.toJCAN)+");"),C.push("");for(t=0;t<d.props.length;t++)C.push(d.props[t].obj+"."+d.props[t].prop+" = "+this.toJCAN(d.props[t].val)+";"),C.push("");return C.join(`
`)},toJavaScript:function(n){var t,o,u,d=this.dump(n),C=[];for(d.methods=this.setBoundingBox(d.methods,n,"board"),o=d.elements,t=0;t<o.length;t++)C.push('board.create("'+o[t].type+'", ['+o[t].parents.join(", ")+"], "+JXG$1.toJSON(o[t].attributes)+");"),o[t].type==="axis"&&(u=o[t].attributes.id,n.objects[u].defaultTicks===null&&C.push('board.objects["'+u+'"].removeTicks(board.objects["'+u+'"].defaultTicks);'));for(t=0;t<d.methods.length;t++)C.push(d.methods[t].obj+"."+d.methods[t].method+"("+this.arrayToParamStr(d.methods[t].params,JXG$1.toJSON)+");"),C.push("");for(t=0;t<d.props.length;t++)C.push(d.props[t].obj+"."+d.props[t].prop+" = "+JXG$1.toJSON(d.props[t].val)+";"),C.push("");return C.join(`
`)}};JXG$1.Dump;JXG$1.createComb=function(n,t,o){var u,d,C,I,f;if(t.length===2){if(JXG$1.isArray(t[0])&&t[0].length>1)I=JXG$1.copyAttributes(o,n.options,"comb","point1"),u=n.create("point",t[0],I);else if(JXG$1.isString(t[0])||JXG$1.isPoint(t[0]))u=n.select(t[0]);else if(JXG$1.isFunction(t[0])&&JXG$1.isPoint(t[0]()))u=t[0]();else if(JXG$1.isFunction(t[0])&&t[0]().length&&t[0]().length>=2)I=JXG$1.copyAttributes(o,n.options,"comb","point1"),u=JXG$1.createPoint(n,t[0](),I);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);if(JXG$1.isArray(t[1])&&t[1].length>1)I=JXG$1.copyAttributes(o,n.options,"comb","point2"),d=n.create("point",t[1],I);else if(JXG$1.isString(t[1])||JXG$1.isPoint(t[1]))d=n.select(t[1]);else if(JXG$1.isFunction(t[1])&&JXG$1.isPoint(t[1]()))d=t[1]();else if(JXG$1.isFunction(t[1])&&t[1]().length&&t[1]().length>=2)I=JXG$1.copyAttributes(o,n.options,"comb","point2"),d=JXG$1.createPoint(n,t[1](),I);else throw new Error("JSXGraph: Can't create comb with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`)}else throw f=t.map(function(A){return"'"+typeof A+"'"}),new Error("JSXGraph: Can't create comb with parent types "+f.join(", ")+`.
Possible parent types: [point,point], [[x1,y1],[x2,y2]]`);return I=JXG$1.copyAttributes(o,n.options,"comb"),C=n.create("curve",[[0],[0]],I),C.updateDataArray=function(){var A=0,y=u.Dist(d),G,S,w,M,V,T,H,J=u,z=d,L,K,O;for(L=JXG$1.evaluate(C.visProp.frequency),K=-JXG$1.evaluate(C.visProp.angle),O=JXG$1.evaluate(C.visProp.width),JXG$1.evaluate(C.visProp.reverse)&&(J=d,z=u,K=-K),G=Math.cos(K),S=Math.sin(K),w=(z.X()-J.X())/y,M=(z.Y()-J.Y())/y,G*=O/Math.abs(S),S*=O/Math.abs(S),this.dataX=[],this.dataY=[];A<y;)V=J.X()+w*A,T=J.Y()+M*A,H=Math.min(G,y-A)/Math.abs(G),S*=H,G*=H,this.dataX.push(V),this.dataY.push(T),this.dataX.push(V+w*G+M*S),this.dataY.push(T-w*S+M*G),this.dataX.push(NaN),this.dataY.push(NaN),A+=L},C};JXG$1.registerElement("comb",JXG$1.createComb);var priv$3={removeSlopeTriangle:function(){Polygon.prototype.remove.call(this),this.board.removeObject(this.toppoint),this.board.removeObject(this.glider),this.board.removeObject(this.baseline),this.board.removeObject(this.basepoint),this.board.removeObject(this.label),this._isPrivateTangent&&this.board.removeObject(this.tangent)},Value:function(){return this.tangent.getSlope()},Direction:function(){return this.tangent.Direction()}};JXG$1.createSlopeTriangle=function(n,t,o){var u,d,C,I,f,A,y,G,S,w=!1;if(t.length===1&&t[0].type===Const.OBJECT_TYPE_TANGENT)d=t[0],C=d.glider;else if(t.length===1&&t[0].type===Const.OBJECT_TYPE_GLIDER)C=t[0],S=JXG$1.copyAttributes(o,n.options,"slopetriangle","tangent"),d=n.create("tangent",[C],S),w=!0;else if(t.length===2&&t[0].elementClass===Const.OBJECT_CLASS_LINE&&JXG$1.isPoint(t[1]))d=t[0],C=t[1];else throw new Error("JSXGraph: Can't create slope triangle with parent types '"+typeof t[0]+"'.");return S=JXG$1.copyAttributes(o,n.options,"slopetriangle","basepoint"),y=n.create("point",[function(){return[C.X()+1,C.Y()]}],S),S=JXG$1.copyAttributes(o,n.options,"slopetriangle","baseline"),A=n.create("line",[C,y],S),S=JXG$1.copyAttributes(o,n.options,"slopetriangle","glider"),I=n.create("glider",[C.X()+1,C.Y(),A],S),S=JXG$1.copyAttributes(o,n.options,"slopetriangle","toppoint"),f=n.create("point",[function(){return[I.X(),I.Y()+(I.X()-C.X())*d.getSlope()]}],S),S=JXG$1.copyAttributes(o,n.options,"slopetriangle"),u=n.create("polygon",[C,I,f],S),u.Value=priv$3.Value,u.Direction=priv$3.Direction,u.tangent=d,u._isPrivateTangent=w,u.borders[2].setArrow(!1,!1),S=JXG$1.copyAttributes(o,n.options,"slopetriangle","label"),S=JXG$1.copyAttributes(S,n.options,"label"),S.isLabel=!0,S.anchor=u.borders[1],S.priv=u.borders[1].visProp.priv,S.id=u.borders[1].id+"Label",G=n.create("text",[0,0,function(){return""}],S),G.needsUpdate=!0,G.dump=!1,u.borders[1].label=G,u.borders[1].hasLabel=!0,u.borders[1].visProp.withlabel=!0,G._setText(function(){var M=JXG$1.evaluate(G.visProp.digits);return G.useLocale()?G.formatNumberLocale(u.Value(),M):JXG$1.toFixed(u.Value(),M)}),G.fullUpdate(),u.glider=I,u.basepoint=y,u.baseline=A,u.toppoint=f,u.label=G,u.subs={glider:I,basePoint:y,baseLine:A,topPoint:f,label:G},u.inherits.push(I,y,A,f,G),u.methodMap=JXG$1.deepCopy(u.methodMap,{tangent:"tangent",glider:"glider",basepoint:"basepoint",baseline:"baseline",toppoint:"toppoint",label:"label",Value:"Value",V:"Value",Direction:"Direction"}),u.remove=priv$3.removeSlopeTriangle,u};JXG$1.registerElement("slopetriangle",JXG$1.createSlopeTriangle);var priv$2={CheckboxChangeEventHandler:function(){this._value=this.rendNodeCheckbox.checked,this.board.update()}};JXG$1.createCheckbox=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"checkbox");return d=[t[0],t[1],'<span style="display:inline"><input type="checkbox" /><label for=""></label></span>'],u=n.create("text",d,C),u.type=JXG$1.OBJECT_TYPE_CHECKBOX,u.rendNodeCheckbox=u.rendNode.childNodes[0].childNodes[0],u.rendNodeLabel=u.rendNode.childNodes[0].childNodes[1],u.rendNodeTag=u.rendNodeCheckbox,u.rendNodeTag.disabled=!!C.disabled,u.rendNodeCheckbox.id=u.rendNode.id+"_checkbox",u.rendNodeLabel.id=u.rendNode.id+"_label",u.rendNodeLabel.setAttribute("for",u.rendNodeCheckbox.id),u.setText(t[2]),u.visPropOld.fontsize="0px",n.renderer.updateTextStyle(u,!1),u.rendNodeCheckbox.checked=C.checked,u._value=C.checked,u.Value=function(){return this._value},u.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeCheckbox.checked),this},JXG$1.addEvent(u.rendNodeCheckbox,"change",priv$2.CheckboxChangeEventHandler,u),u};JXG$1.registerElement("checkbox",JXG$1.createCheckbox);var priv$1={InputInputEventHandler:function(n){this._value=this.rendNodeInput.value,this.board.update()}};JXG$1.createInput=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"input");return d=[t[0],t[1],'<span style="display:inline; white-space:nowrap; padding:0px;"><span></span><input type="text" maxlength="'+C.maxlength+'" style="width:100%"/></span>'],u=n.create("text",d,C),u.type=JXG$1.OBJECT_TYPE_INPUT,u.rendNodeLabel=u.rendNode.childNodes[0].childNodes[0],u.rendNodeInput=u.rendNode.childNodes[0].childNodes[1],u.rendNodeInput.value=t[2],u.rendNodeTag=u.rendNodeInput,u.rendNodeTag.disabled=!!C.disabled,u.rendNodeLabel.id=u.rendNode.id+"_label",u.rendNodeInput.id=u.rendNode.id+"_input",u.setText(t[3]),u._value=t[2],u.update=function(){return this.needsUpdate&&(JXG$1.Text.prototype.update.call(this),this._value=this.rendNodeInput.value),this},u.Value=function(){return this._value},u.set=function(I){return this._value=I,this.rendNodeInput.value=I,this},JXG$1.addEvent(u.rendNodeInput,"input",priv$1.InputInputEventHandler,u),JXG$1.addEvent(u.rendNodeInput,"mousedown",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),JXG$1.addEvent(u.rendNodeInput,"touchstart",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),JXG$1.addEvent(u.rendNodeInput,"pointerdown",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),u.visPropOld.fontsize="0px",n.renderer.updateTextStyle(u,!1),u};JXG$1.registerElement("input",JXG$1.createInput);var priv={ButtonClickEventHandler:function(){this._handler&&this._handler(),this.board.update()}};JXG$1.createButton=function(n,t,o){var u,d,C=JXG$1.copyAttributes(o,n.options,"button");return d=[t[0],t[1],'<button type="button" style="width:100%;"></button>'],u=n.create("text",d,C),u.type=JXG$1.OBJECT_TYPE_BUTTON,u.rendNodeButton=u.rendNode.childNodes[0],u.rendNodeButton.id=u.rendNode.id+"_button",u.rendNodeTag=u.rendNodeButton,u.rendNodeTag.disabled=!!C.disabled,u.setText(t[2]),u.visPropOld.fontsize="0px",n.renderer.updateTextStyle(u,!1),t[3]&&(JXG$1.isString(t[3])?(u._jc=new JXG$1.JessieCode,u._jc.use(n),u._handler=function(){u._jc.parse(t[3])}):u._handler=t[3]),JXG$1.addEvent(u.rendNodeButton,"click",priv.ButtonClickEventHandler,u),JXG$1.addEvent(u.rendNodeButton,"mousedown",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),JXG$1.addEvent(u.rendNodeButton,"touchstart",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),JXG$1.addEvent(u.rendNodeButton,"pointerdown",function(I){JXG$1.exists(I.stopPropagation)&&I.stopPropagation()},u),u};JXG$1.registerElement("button",JXG$1.createButton);JXG$1.createVectorField=function(n,t,o){var u,d;if(!(t.length>=3&&(JXG$1.isArray(t[0])||JXG$1.isFunction(t[0])||JXG$1.isString(t[0]))&&JXG$1.isArray(t[1])&&t[1].length===3&&JXG$1.isArray(t[2])&&t[2].length===3))throw new Error("JSXGraph: Can't create vector field with parent types '"+typeof t[0]+"', '"+typeof t[1]+"', '"+typeof t[2]+"'.");return d=JXG$1.copyAttributes(o,n.options,"vectorfield"),u=n.create("curve",[[],[]],d),u.elType="vectorfield",u.setF=function(C,I){var f,A;return JXG$1.isArray(C)?(f=JXG$1.createFunction(C[0],this.board,I),A=JXG$1.createFunction(C[1],this.board,I),this.F=function(y,G){return[f(y,G),A(y,G)]}):this.F=JXG$1.createFunction(C,u.board,I),this},u.setF(t[0],"x, y"),u.xData=t[1],u.yData=t[2],u.updateDataArray=function(){var C,I,f,A,y=JXG$1.evaluate(this.visProp.scale),G=JXG$1.evaluate(this.xData[0]),S=JXG$1.evaluate(this.xData[1]),w=JXG$1.evaluate(this.xData[2]),M=(w-G)/S,V=JXG$1.evaluate(this.yData[0]),T=JXG$1.evaluate(this.yData[1]),H=JXG$1.evaluate(this.yData[2]),J=(H-V)/T,z,L,K,O,Q=JXG$1.evaluate(this.visProp.arrowhead.enabled),ee,ie,te,se;for(Q&&(ee=JXG$1.evaluate(this.visProp.arrowhead.size),ie=ee/n.unitX,te=ee/n.unitY,se=JXG$1.evaluate(this.visProp.arrowhead.angle)),this.dataX=[],this.dataY=[],f=0,C=G;f<=S;C+=M,f++)for(A=0,I=V;A<=T;I+=J,A++)z=this.F(C,I),z[0]*=y,z[1]*=y,JXG$1.concat(this.dataX,[C,C+z[0],NaN]),JXG$1.concat(this.dataY,[I,I+z[1],NaN]),Q&&Math.abs(z[0])+Math.abs(z[1])>0&&(L=Math.atan2(z[1],z[0]),K=L+se,O=L-se,JXG$1.concat(this.dataX,[C+z[0]-Math.cos(K)*ie,C+z[0],C+z[0]-Math.cos(O)*ie,NaN]),JXG$1.concat(this.dataY,[I+z[1]-Math.sin(K)*te,I+z[1],I+z[1]-Math.sin(O)*te,NaN]))},u.methodMap=JXG$1.deepCopy(u.methodMap,{setF:"setF"}),u};JXG$1.registerElement("vectorfield",JXG$1.createVectorField);JXG$1.createSlopeField=function(n,t,o){var u,d,C;if(!(t.length>=3&&(JXG$1.isFunction(t[0])||JXG$1.isString(t[0]))&&JXG$1.isArray(t[1])&&t[1].length===3&&JXG$1.isArray(t[2])&&t[2].length===3))throw new Error("JSXGraph: Can't create slope field with parent types '"+typeof t[0]+"', '"+typeof t[1]+"', '"+typeof t[2]+"'.");return d=JXG$1.createFunction(t[0],n,"x, y"),t[0]=function(I,f){var A=d(I,f),y=Math.sqrt(1+A*A);return[1/y,A/y]},C=JXG$1.copyAttributes(o,n.options,"slopefield"),u=n.create("vectorfield",t,C),u.elType="slopefield",u.setF=function(I,f){var A=JXG$1.createFunction(I,u.board,f);this.F=function(y,G){var S=A(y,G),w=Math.sqrt(1+S*S);return[1/w,S/w]}},u.methodMap=JXG$1.deepCopy(u.methodMap,{setF:"setF"}),u};JXG$1.registerElement("slopefield",JXG$1.createSlopeField);JXG$1.createSmartLabel=function(n,t,o){var u,d,C,I,f,A;if(t.length===0||[Const.OBJECT_CLASS_POINT,Const.OBJECT_CLASS_LINE,Const.OBJECT_CLASS_CIRCLE].indexOf(t[0].elementClass)<0&&[Const.OBJECT_TYPE_POLYGON,Const.OBJECT_TYPE_ANGLE].indexOf(t[0].type)<0)throw new Error("JSXGraph: Can't create smartlabel with parent types '"+typeof t[0]+"', '"+typeof t[1]+"'.");return C=t[0],I=t[1]||"",C.elementClass===Const.OBJECT_CLASS_POINT?d=JXG$1.copyAttributes(o,n.options,"smartlabelpoint"):C.elementClass===Const.OBJECT_CLASS_LINE?(d=JXG$1.copyAttributes(o,n.options,"smartlabelline"),d.rotate=function(){return Math.atan(C.getSlope())*180/Math.PI},d.visible=function(){return!(C.L()<1.5)}):C.elementClass===Const.OBJECT_CLASS_CIRCLE?(d=JXG$1.copyAttributes(o,n.options,"smartlabelcircle"),d.visible=function(){return!(C.Radius()<1.5)}):C.type===Const.OBJECT_TYPE_POLYGON?d=JXG$1.copyAttributes(o,n.options,"smartlabelpolygon"):C.type===Const.OBJECT_TYPE_ANGLE&&(d=JXG$1.copyAttributes(o,n.options,"smartlabelangle"),d.rotate=function(){var y=C.center.coords.usrCoords,G=C.getLabelAnchor().usrCoords,S=Math.atan2(G[2]-y[2],G[1]-y[1])*180/Math.PI;return S>90&&S<270?S+180:S},d.anchorX=function(){var y=C.center.coords.usrCoords,G=C.getLabelAnchor().usrCoords,S=Math.atan2(G[2]-y[2],G[1]-y[1])*180/Math.PI;return S>90&&S<270?"right":"left"}),f=function(y,G,S,w){var M;switch(w){case"length":M=function(){return G.L()};break;case"slope":M=function(){return G.Slope()};break;case"area":M=function(){return G.Area()};break;case"radius":M=function(){return G.Radius()};break;case"perimeter":M=function(){return G.Perimeter()};break;case"rad":M=function(){return G.Value()};break;case"deg":M=function(){return G.Value()*180/Math.PI};break;default:M=function(){return 0}}return function(){var V="",T,H=JXG$1.evaluate(I),J=JXG$1.evaluate(y.visProp.digits),z=JXG$1.evaluate(y.visProp.unit),L=JXG$1.evaluate(y.visProp.prefix),K=JXG$1.evaluate(y.visProp.suffix),O=JXG$1.evaluate(y.visProp.usemathjax)||JXG$1.evaluate(y.visProp.usekatex);return H===""?(y.useLocale()?T=y.formatNumberLocale(M(),J):T=JXG$1.toFixed(M(),J),O?V=["\\(",L,T,"\\,",z,K,"\\)"].join(""):V=[L,T,z,K].join("")):V=H,V}},C.elementClass===Const.OBJECT_CLASS_POINT?(u=n.create("text",[function(){return C.X()},function(){return C.Y()},""],d),A=function(){var y="",G=JXG$1.evaluate(I),S=JXG$1.evaluate(u.visProp.digits),w=JXG$1.evaluate(u.visProp.unit),M=JXG$1.evaluate(u.visProp.prefix),V=JXG$1.evaluate(u.visProp.suffix),T=JXG$1.evaluate(u.visProp.dir),H=JXG$1.evaluate(u.visProp.usemathjax)||JXG$1.evaluate(u.visProp.usekatex),J,z;return u.useLocale()?(J=u.formatNumberLocale(C.X(),S),z=u.formatNumberLocale(C.Y(),S)):(J=JXG$1.toFixed(C.X(),S),z=JXG$1.toFixed(C.Y(),S)),G===""?T==="row"?H?y=["\\(",M,J,"\\,",w," / ",z,"\\,",w,V,"\\)"].join(""):y=[M,J," ",w," / ",z," ",w,V].join(""):T.indexOf("col")===0&&(H?y=["\\(",M,"\\left(\\array{",J,"\\,",w,"\\\\ ",z,"\\,",w,"}\\right)",V,"\\)"].join(""):y=[M,J," ",w,"<br/>",z," ",w,V].join("")):y=G,y}):C.elementClass===Const.OBJECT_CLASS_LINE?d.measure==="length"?(u=n.create("text",[function(){return(C.point1.X()+C.point2.X())*.5},function(){return(C.point1.Y()+C.point2.Y())*.5},""],d),A=f(u,C,"line","length")):d.measure==="slope"&&(u=n.create("text",[function(){return C.point1.X()*.25+C.point2.X()*.75},function(){return C.point1.Y()*.25+C.point2.Y()*.75},""],d),A=f(u,C,"line","slope")):C.elementClass===Const.OBJECT_CLASS_CIRCLE?d.measure==="radius"?(u=n.create("text",[function(){return C.center.X()+C.Radius()*.5},function(){return C.center.Y()},""],d),A=f(u,C,"circle","radius")):d.measure==="area"?(u=n.create("text",[function(){return C.center.X()},function(){return C.center.Y()+C.Radius()*.5},""],d),A=f(u,C,"circle","area")):(d.measure==="circumference"||d.measure==="perimeter")&&(u=n.create("text",[function(){return C.getLabelAnchor()},""],d),A=f(u,C,"circle","perimeter")):C.type===Const.OBJECT_TYPE_POLYGON?d.measure==="area"?(u=n.create("text",[function(){return C.getTextAnchor()},""],d),A=f(u,C,"polygon","area")):d.measure==="perimeter"&&(u=n.create("text",[function(){var y=C.borders.length-1;return y>=0?[(C.borders[y].point1.X()+C.borders[y].point2.X())*.5,(C.borders[y].point1.Y()+C.borders[y].point2.Y())*.5]:C.getTextAnchor()},""],d),A=f(u,C,"polygon","perimeter")):C.type===Const.OBJECT_TYPE_ANGLE&&(u=n.create("text",[function(){return C.getLabelAnchor()},""],d),A=f(u,C,"angle",d.measure)),JXG$1.exists(u)&&(u.setText(A),C.addChild(u),u.setParents([C])),u};JXG$1.registerElement("smartlabel",JXG$1.createSmartLabel);JXG$1.ForeignObject=function(n,t,o,u,d){this.constructor(n,o,Const.OBJECT_TYPE_FOREIGNOBJECT,Const.OBJECT_CLASS_OTHER),this.element=this.board.select(o.anchor),this.coordsConstructor(t),this._useUserSize=!1,this.size=[1,1],JXG$1.exists(d)&&d.length>0&&(this._useUserSize=!0,this.W=JXG$1.createFunction(d[0],this.board,""),this.H=JXG$1.createFunction(d[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()]),this.content=u,this.elType="foreignobject",this.id=this.board.setId(this,"Im"),this.board.renderer.drawForeignObject(this),this.board.finalizeAdding(this),this.methodMap=JXG$1.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H"})};JXG$1.ForeignObject.prototype=new GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.ForeignObject,CoordsElement,"coordsConstructor");JXG$1.extend(JXG$1.ForeignObject.prototype,{hasPoint:function(n,t){var o,u,d,C,I,f,A,y,G,S=this.transformations.length;return JXG$1.isObject(JXG$1.evaluate(this.visProp.precision))?(C=this.board._inputDevice,I=JXG$1.evaluate(this.visProp.precision[C])):I=this.board.options.precision.hasPoint,S===0?(o=n-this.coords.scrCoords[1],u=this.coords.scrCoords[2]-t,d=I,o>=-d&&o-this.size[0]<=d&&u>=-d&&u-this.size[1]<=d):(f=new Coords(Const.COORDS_BY_SCREEN,[n,t],this.board),f=f.usrCoords,A=[f[0]-this.span[0][0],f[1]-this.span[0][1],f[2]-this.span[0][2]],G=Mat.innerProduct,y=G(A,this.span[1]),0<=y&&y<=G(this.span[1],this.span[1])&&(y=G(A,this.span[2]),0<=y&&y<=G(this.span[2],this.span[2])))},update:function(n){return this.needsUpdate?(this.updateCoords(n),this.updateSize(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateForeignObject")},updateSize:function(){var n=[0,0];return this._useUserSize?(this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)]):this.rendNode.hasChildNodes()&&(n=this.rendNode.childNodes[0].getBoundingClientRect(),this.size=[n.width,n.height]),this},updateSpan:function(){var n,t,o=this.transformations.length,u=[];if(o===0)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(u[0]=[this.Z(),this.X(),this.Y()],u[1]=[this.Z(),this.X()+this.W(),this.Y()],u[2]=[this.Z(),this.X(),this.Y()+this.H()],n=0;n<o;n++)for(t=0;t<3;t++)u[t]=Mat.matVecMult(this.transformations[n].matrix,u[t]);for(t=0;t<3;t++)u[t][1]/=u[t][0],u[t][2]/=u[t][0],u[t][0]/=u[t][0];for(t=1;t<3;t++)u[t][0]-=u[0][0],u[t][1]-=u[0][1],u[t][2]-=u[0][2];this.span=u}return this},addTransform:function(n){var t;if(JXG$1.isArray(n))for(t=0;t<n.length;t++)this.transformations.push(n[t]);else this.transformations.push(n);return this},getParents:function(){var n=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return this.parents.length!==0&&(n=this.parents),n},setSize:function(n,t){return this.W=JXG$1.createFunction(n,this.board,""),this.H=JXG$1.createFunction(t,this.board,""),this._useUserSize=!0,this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}});JXG$1.createForeignObject=function(n,t,o){var u,d,C=t[0],I=t[1],f=[];if(t.length>=2&&(f=t[2]),u=JXG$1.copyAttributes(o,n.options,"foreignobject"),d=CoordsElement.create(JXG$1.ForeignObject,n,I,u,C,f),!d)throw new Error("JSXGraph: Can't create foreignObject with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [string, [x, y], [w, h]], [string, [x, y]], [element,transformation]`);return d};JXG$1.registerElement("foreignobject",JXG$1.createForeignObject);JXG$1.registerElement("fo",JXG$1.createForeignObject);JXG$1.ForeignObject;JXG$1.extend(Options,{axes3d:{axesPosition:"center",xAxis:{visible:!0,point2:{name:"x"},strokeColor:JXG$1.palette.red},yAxis:{visible:!0,point2:{name:"y"},strokeColor:JXG$1.palette.green},zAxis:{visible:!0,point2:{name:"z"},strokeColor:JXG$1.palette.blue},xAxisBorder:{name:"x",visible:"ìnherit",withLabel:!1,label:{position:"50% left",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle",anchorY:"middle"}}},yAxisBorder:{name:"y",visible:"ìnherit",withLabel:!1,label:{position:"50% right",offset:[0,-30],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle"}}},zAxisBorder:{name:"z",visible:"ìnherit",withLabel:!1,label:{position:"50% right",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"ìnherit",label:{anchorX:"middle",anchorY:"middle"}}},xPlaneRear:{visible:!0,layer:0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",mesh3d:{layer:1}},yPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},yPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1}},axis3d:{highlight:!1,fixed:!0,strokeColor:"black",strokeWidth:1,tabindex:null,point1:{visible:!1,name:""},point2:{visible:!1,name:"",label:{visible:!0}}},circle3d:{point:{visible:!1,name:""}},curve3d:{highlight:!1,tabindex:-1,strokeWidth:1,numberPointsHigh:200},intersectionline3d:{point1:{visible:!1,name:""},point2:{visible:!1,name:""}},line3d:{strokeWidth:1,strokeColor:"black",fixed:!0,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",point:{visible:!1,name:""},point1:{visible:!1,name:""},point2:{visible:!1,name:""}},mesh3d:{strokeWidth:1,strokeColor:"#9a9a9a",strokeOpacity:.6,highlight:!1,tabindex:null,visible:"inherit"},plane3d:{strokeWidth:0,strokeColor:"black",strokeOpacity:1,highlight:!1,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",gradientAngle:Math.PI,fillColor:"#a7a7a7",fillOpacity:.6,point:{visible:!1,name:"",fixed:!0}},point3d:{infoboxDigits:"auto",strokeWidth:0,gradient:"radial",gradientSecondColor:"#555555",fillColor:"yellow",highlightStrokeColor:"#555555",gradientFX:.7,gradientFY:.3},polygon3d:{highlight:!1,tabindex:-1,strokeWidth:1,fillColor:"none"},sphere3d:{highlight:!1,strokeWidth:1,strokeColor:"#00ff80",fillColor:"white",gradient:"radial",gradientSecondColor:"#00ff80",gradientFX:.7,gradientFY:.3,fillOpacity:.4},surface3d:{highlight:!1,tabindex:-1,strokeWidth:1,stepsU:30,stepsV:30},text3d:{},ticks3d:{visible:!0,ticksDistance:1,majorHeight:10,minorTicks:0,tickEndings:[0,1],drawLabels:!0,label:{visible:!0}},vectorfield3d:{scale:1,arrowhead:{enabled:!0,size:5,angle:Math.PI*.125}},view3d:{needsRegularUpdate:!0,projection:"parallel",verticalDrag:{enabled:!0,key:"shift"},az:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:1}},el:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:0,max:2*Math.PI,start:.3}},bank:{pointer:{enabled:!0,speed:.08,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!0},point2:{frozen:!0},min:-Math.PI,max:Math.PI,start:0}},trackball:{enabled:!1,outside:!0,button:-1,key:"none"},r:"auto",fov:1/5*2*Math.PI,depthOrderPoints:!1,values:[[0,1.57],[.78,.62],[0,0],[5.49,.62],[4.71,0],[3.93,.62],[3.14,0],[2.36,.62],[1.57,1.57]],infobox:{strokeColor:"#000000",fontSize:24,useKatex:!1,useMathjax:!1},_currentView:-1}});JXG$1.Options;JXG$1.View3D=function(n,t,o){this.constructor(n,o,Const.OBJECT_TYPE_VIEW3D,Const.OBJECT_CLASS_3D),this.objects={},this.points=this.visProp.depthorderpoints?[]:null,this.elementsByName={},this.defaultAxes=null,this.angles={az:null,el:null,bank:null},this.matrix3DRot=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.matrix3D=[[1,0,0,0],[0,1,0,0],[0,0,1,0]],this.boxToCam=[],this.llftCorner=t[0],this.size=t[1],this.bbox3D=t[2],this.r=-1,this.focalDist=-1,this.projectionType="parallel",this.trackballEnabled=!1,this.timeoutAzimuth=null,this.id=this.board.setId(this,"V"),this.board.finalizeAdding(this),this.elType="view3d",this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.View3D.prototype=new GeometryElement;JXG$1.extend(JXG$1.View3D.prototype,{create:function(n,t,o){var u=[],d;return n.indexOf("3d")>0&&u.push(this),d=this.board.create(n,u.concat(t),o),d},select:function(n,t){var o,u,d,C,I=n;if(I===null)return I;if(JXG$1.isString(I)&&I!=="")JXG$1.exists(this.objects[I])?I=this.objects[I]:JXG$1.exists(this.elementsByName[I])&&(I=this.elementsByName[I]);else if(!t&&(JXG$1.isFunction(I)||JXG$1.isObject(I)&&!JXG$1.isFunction(I.setAttribute))){for(o=JXG$1.filterElements(this.objectsList,I),u={},C=o.length,d=0;d<C;d++)u[o[d].id]=o[d];I=new Composition(u)}else JXG$1.isObject(I)&&JXG$1.exists(I.id)&&!JXG$1.exists(this.objects[I.id])&&(I=null);return I},setAnglesFromRotation:function(){var n=this.matrix3DRot,t,o,u,d,C,I,f;t=Math.sqrt(n[1][3]*n[1][3]+n[2][3]*n[2][3]),t>Mat.eps?(o=n[2][3]/t,u=n[1][3]/t):(o=Math.cos(this.angles.bank),u=Math.sin(this.angles.bank)),n=Mat.matMatMult([[1,0,0,0],[0,o,-u,0],[0,u,o,0],[0,0,0,1]],n),this.angles.bank=Math.atan2(u,o),d=n[2][3],C=n[3][3],n=Mat.matMatMult([[1,0,0,0],[0,1,0,0],[0,0,d,C],[0,0,-C,d]],n),this.angles.el=Math.atan2(C,d),I=-n[1][1],f=n[3][1],this.angles.az=Math.atan2(f,I),this.angles.az<0&&(this.angles.az+=2*Math.PI),this.setSlidersFromAngles()},anglesHaveMoved:function(){return this._hasMoveAz||this._hasMoveEl||Math.abs(this.angles.az-this.az_slide.Value())>Mat.eps||Math.abs(this.angles.el-this.el_slide.Value())>Mat.eps||Math.abs(this.angles.bank-this.bank_slide.Value())>Mat.eps},getAnglesFromSliders:function(){this.angles.az=this.az_slide.Value(),this.angles.el=this.el_slide.Value(),this.angles.bank=this.bank_slide.Value()},setSlidersFromAngles:function(){this.az_slide.setValue(this.angles.az),this.el_slide.setValue(this.angles.el),this.bank_slide.setValue(this.angles.bank)},getRotationFromAngles:function(){var n,t,o,u,d,C,I=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return n=this.angles.az,t=this.angles.el,o=this.angles.bank,u=-Math.sin(t),I[1][1]=-Math.cos(n),I[1][2]=Math.sin(n),I[1][3]=0,I[2][1]=u*Math.sin(n),I[2][2]=u*Math.cos(n),I[2][3]=Math.cos(t),I[3][1]=Math.cos(t)*Math.sin(n),I[3][2]=Math.cos(t)*Math.cos(n),I[3][3]=Math.sin(t),d=Math.cos(o),C=Math.sin(o),I=Mat.matMatMult([[1,0,0,0],[0,d,C,0],[0,-C,d,0],[0,0,0,1]],I),I},_projectToSphere:function(n,t,o){var u=Mat.hypot(t,o),d,C;return u<n*.7071067811865475?C=Math.sqrt(n*n-u*u):(d=n/1.414213562373095,C=d*d/u),C},updateProjectionTrackball:function(n){var t=100,o,u,d,C,I,f,A,y,G,S,w,M,V,T=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return JXG$1.exists(this._trackball)?(o=this._trackball.dx,u=this._trackball.dy,d=o*o+u*u,d>Mat.eps&&(t=(this.size[0]*this.board.unitX+this.size[1]*this.board.unitY)*.25,f=this._trackball.x,A=this._trackball.y,I=[f,A,this._projectToSphere(t,f,A)],f-=o,A-=u,C=[f,A,this._projectToSphere(t,f,A)],V=Mat.crossProduct(C,I),S=Mat.hypot(V[0],V[1],V[2]),V[0]/=S,V[1]/=S,V[2]/=S,G=Geometry.distance(I,C,3)/(2*t),G=G>1?1:G,G=G<-1?-1:G,y=2*Math.asin(G),w=Math.cos(y),G=1-w,M=Math.sin(y),T[1][1]=w+V[0]*V[0]*G,T[2][1]=V[1]*V[0]*G+V[2]*M,T[3][1]=V[2]*V[0]*G-V[1]*M,T[1][2]=V[0]*V[1]*G-V[2]*M,T[2][2]=w+V[1]*V[1]*G,T[3][2]=V[2]*V[1]*G+V[0]*M,T[1][3]=V[0]*V[2]*G+V[1]*M,T[2][3]=V[1]*V[2]*G-V[0]*M,T[3][3]=w+V[2]*V[2]*G),T=Mat.matMatMult(T,this.matrix3DRot),T):this.matrix3DRot},updateAngleSliderBounds:function(){var n,t,o,u,d,C,I,f,A,y,G,S,w;this.trackballEnabled=JXG$1.evaluate(this.visProp.trackball.enabled),this.trackballEnabled?(this.az_slide.setMin(0),this.az_slide.setMax(2*Math.PI),this.el_slide.setMin(-.5*Math.PI),this.el_slide.setMax(.5*Math.PI),this.bank_slide.setMin(-Math.PI),this.bank_slide.setMax(Math.PI)):(this.az_slide.setMin(this.visProp.az.slider.min),this.az_slide.setMax(this.visProp.az.slider.max),this.el_slide.setMin(this.visProp.el.slider.min),this.el_slide.setMax(this.visProp.el.slider.max),this.bank_slide.setMin(this.visProp.bank.slider.min),this.bank_slide.setMax(this.visProp.bank.slider.max)),n=this.az_slide._smax,t=this.az_slide._smin,o=this.el_slide._smax,u=this.el_slide._smin,S=this.bank_slide._smax,w=this.bank_slide._smin,this.trackballEnabled?(d=Mat.mod(this.angles.el,2*Math.PI),.5*Math.PI<d&&d<1.5*Math.PI&&(this.angles.el=Math.PI-d,this.angles.az=Mat.wrap(this.angles.az+Math.PI,t,n),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,w,S)),this.angles.az=Mat.wrap(this.angles.az,t,n),this.angles.el=Mat.wrap(this.angles.el,u,o),this.angles.bank=Mat.wrap(this.angles.bank,w,S)):(G=function(M){return M<u?u-M:o<M?M-o:0},C=.5*(u+o),I=Mat.wrap(this.angles.el,C-Math.PI,C+Math.PI),f=Mat.wrap(Math.PI-this.angles.el,C-Math.PI,C+Math.PI),A=G(I),y=G(f),A<=y?this.angles.el=Mat.clamp(I,u,o):(this.angles.el=Mat.clamp(f,u,o),this.angles.az=Mat.wrap(this.angles.az+Math.PI,t,n),this.angles.bank=Mat.wrap(this.angles.bank+Math.PI,w,S)),this.angles.az=Mat.wrapAndClamp(this.angles.az,t,n,2*Math.PI),this.angles.bank=Mat.wrapAndClamp(this.angles.bank,w,S,2*Math.PI),this.matrix3DRot=this.getRotationFromAngles()),this.setSlidersFromAngles()},_updateCentralProjection:function(){var n=20,t=8,o,u;return o=JXG$1.evaluate(this.visProp.r),o==="auto"&&(o=Mat.hypot(this.bbox3D[0][0]-this.bbox3D[0][1],this.bbox3D[1][0]-this.bbox3D[1][1],this.bbox3D[2][0]-this.bbox3D[2][1])*1.01),this.boxToCam=this.matrix3DRot.map(d=>d.slice()),this.boxToCam[3][0]=-o,this.focalDist=1/Math.tan(.5*JXG$1.evaluate(this.visProp.fov)),u=[[0,0,0,-1],[0,this.focalDist,0,0],[0,0,this.focalDist,0],[2*n*t/(t-n),0,0,(n+t)/(t-n)]],Mat.matMatMult(u,this.boxToCam)},compareDepth:function(n,t){var o=[0,n.coords[1]-t.coords[1],n.coords[2]-t.coords[2],n.coords[3]-t.coords[3]],u=Mat.matVecMult(this.matrix3DRot,Mat.matVecMult(this.shift,o));return u[3]},update:function(){var n=this.r,t=[[1,0,0,0],[0,-n,0,0],[0,0,-n,0],[0,0,0,1]],o,u,d,C,I,f;if(!JXG$1.exists(this.el_slide)||!JXG$1.exists(this.az_slide)||!JXG$1.exists(this.bank_slide)||!this.needsUpdate)return this;switch(o=[[1,0,0],[0,1,0],[0,0,1]],this.projectionType=JXG$1.evaluate(this.visProp.projection).toLowerCase(),this.trackballEnabled!==JXG$1.evaluate(this.visProp.trackball.enabled)&&this.updateAngleSliderBounds(),this._hasMoveTrackball?(this.matrix3DRot=this.updateProjectionTrackball(),this.setAnglesFromRotation()):this.anglesHaveMoved()&&(this.getAnglesFromSliders(),this.matrix3DRot=this.getRotationFromAngles()),this.shift=[[1,0,0,0],[-.5*(this.bbox3D[0][0]+this.bbox3D[0][1]),1,0,0],[-.5*(this.bbox3D[1][0]+this.bbox3D[1][1]),0,1,0],[-.5*(this.bbox3D[2][0]+this.bbox3D[2][1]),0,0,1]],this.projectionType){case"central":d=2*.4,o[1][1]=this.size[0]/d,o[2][2]=this.size[1]/d,o[1][0]=this.llftCorner[0]+o[1][1]*.5*d,o[2][0]=this.llftCorner[1]+o[2][2]*.5*d,this.viewPortTransform=o,u=this._updateCentralProjection(),this.matrix3D=Mat.matMatMult(u,this.shift);break;case"parallel":default:C=this.bbox3D[0][1]-this.bbox3D[0][0],I=this.bbox3D[1][1]-this.bbox3D[1][0],o[1][1]=this.size[0]/C,o[2][2]=this.size[1]/I,o[1][0]=this.llftCorner[0]+o[1][1]*.5*C,o[2][0]=this.llftCorner[1]+o[2][2]*.5*I,this.matrix3D=Mat.matMatMult(o,Mat.matMatMult(Mat.matMatMult(this.matrix3DRot,t),this.shift).slice(0,3))}return this.visProp.depthorderpoints&&this.points===null&&(f=Object.values(this.objects),this.points=f.filter(A=>A.type===Const.OBJECT_TYPE_POINT3D)),!this.visProp.depthorderpoints&&this.points!==null&&(this.points=null),this.visProp.depthorderpoints&&this.board.renderer&&this.board.renderer.type==="svg"&&this.points.filter(A=>JXG$1.evaluate(A.element2D.visProp.visible)).sort(this.compareDepth.bind(this)).forEach(A=>this.board.renderer.setLayer(A.element2D,A.element2D.visProp.layer)),this},updateRenderer:function(){return this.needsUpdate=!1,this},removeObject:function(n,t){var o;if(JXG$1.isArray(n)){for(o=0;o<n.length;o++)this.removeObject(n[o]);return this}if(n=this.select(n),!JXG$1.exists(n)||JXG$1.isString(n))return this;try{delete this.objects[n.id]}catch(u){JXG$1.debug("View3D "+n.id+": Could not be removed: "+u)}return this.board.removeObject(n,t),this},worldToFocal:function(n,t=!0){var o,u=Mat.matVecMult(this.boxToCam,Mat.matVecMult(this.shift,n));if(u[3]-=u[0]*this.focalDist,t)return u;for(o=1;o<4;o++)u[o]/=u[0];return u.slice(1,4)},project3DTo2D:function(n,t,o){var u,d;switch(arguments.length===3?u=[1,n,t,o]:n.length===3?(u=n.slice(),u.unshift(1)):u=n,d=Mat.matVecMult(this.matrix3D,u),this.projectionType){case"central":return d[1]/=d[0],d[2]/=d[0],d[3]/=d[0],d[0]/=d[0],Mat.matVecMult(this.viewPortTransform,d.slice(0,3));case"parallel":default:return d}},_getW0:function(n,t,o){var u=Mat.inverse(n),d=u[0][0]+t[1]*u[0][1]+t[2]*u[0][2],C=u[3][0]+t[1]*u[3][1]+t[2]*u[3][2],I,f,A;return A=o*u[0][3]-u[3][3],I=(C*u[0][3]-d*u[3][3])/A,f=(C-d*o)/A,[1/I,f]},project2DTo3DPlane:function(n,t,o){var u,d,C,I,f,A=t.slice(1),y,G,S;if(o=o||[1,0,0,0],I=Mat.norm(A,3),C=Mat.innerProduct(o.slice(1),A,3)/I,this.projectionType==="parallel"){u=this.matrix3D.slice(0,3),u.push([0,A[0],A[1],A[2]]),d=n.coords.usrCoords.slice(),d.push(C);try{u[2][3]===1&&(u[2][1]=u[2][2]=Mat.eps*.001),f=Mat.Numerics.Gauss(u,d)}catch{f=[0,NaN,NaN,NaN]}}else{u=this.matrix3D,d=n.coords.usrCoords.slice(),y=Mat.Numerics.Gauss(this.viewPortTransform,d),S=this._getW0(u,y,C),G=S[0],d=[y[0]*G,y[1]*G,y[2]*G,S[1]*G];try{u[2][3]===1&&(u[2][1]=u[2][2]=Mat.eps*.001),f=Mat.Numerics.Gauss(u,d),f[1]/=f[0],f[2]/=f[0],f[3]/=f[0],f[0]/=f[0]}catch{f=[0,NaN,NaN,NaN]}}return f},projectScreenToSegment:function(n,t,o){var u=this.project3DTo2D(t).slice(1,3),d=this.project3DTo2D(o).slice(1,3),C=[d[0]-u[0],d[1]-u[1]],I=Mat.innerProduct(C,C),f=[n[0]-u[0],n[1]-u[1]],A=Mat.innerProduct(f,C)/I,y,G,S,w,M,V,T;return this.projectionType==="central"?(y=[.5*(t[0]+o[0]),.5*(t[1]+o[1]),.5*(t[2]+o[2])],G=this.project3DTo2D(y).slice(1,3),S=[G[0]-u[0],G[1]-u[1]],w=Mat.innerProduct(S,C)/I,M=(1-w)*A/((1-2*w)*A+w)):M=A,V=Math.min(Math.max(M,0),1),T=1-V,[1,T*t[0]+V*o[0],T*t[1]+V*o[1],T*t[2]+V*o[2]]},project2DTo3DVertical:function(n,t){var o=n.coords.usrCoords.slice(1,3),u=[t[1],t[2],this.bbox3D[2][0]],d=[t[1],t[2],this.bbox3D[2][1]];return this.projectScreenToSegment(o,u,d)},project3DToCube:function(n){var t=this.bbox3D,o=!1;return n[1]<t[0][0]&&(n[1]=t[0][0],o=!0),n[1]>t[0][1]&&(n[1]=t[0][1],o=!0),n[2]<t[1][0]&&(n[2]=t[1][0],o=!0),n[2]>t[1][1]&&(n[2]=t[1][1],o=!0),n[3]<=t[2][0]&&(n[3]=t[2][0],o=!0),n[3]>=t[2][1]&&(n[3]=t[2][1],o=!0),[n,o]},intersectionLineCube:function(n,t,o){var u,d,C,I;for(u=o,d=0;d<3;d++)t[d]!==0&&(C=(this.bbox3D[d][0]-n[d])/t[d],I=(this.bbox3D[d][1]-n[d])/t[d],o<0?u=Math.max(u,Math.min(C,I)):u=Math.min(u,Math.max(C,I)));return u},isInCube:function(n){return n[0]>this.bbox3D[0][0]-Mat.eps&&n[0]<this.bbox3D[0][1]+Mat.eps&&n[1]>this.bbox3D[1][0]-Mat.eps&&n[1]<this.bbox3D[1][1]+Mat.eps&&n[2]>this.bbox3D[2][0]-Mat.eps&&n[2]<this.bbox3D[2][1]+Mat.eps},intersectionPlanePlane:function(n,t,o){var u=[[],[]],d,C,I,f;return o=o||t.d,d=Mat.Geometry.meet3Planes(n.normal,n.d,t.normal,o,Mat.crossProduct(n.normal,t.normal),0),C=Mat.Geometry.meetPlanePlane(n.vec1,n.vec2,t.vec1,t.vec2),I=this.intersectionLineCube(d,C,1/0),f=Mat.axpy(I,C,d),this.isInCube(f)&&(u[0]=f),I=this.intersectionLineCube(d,C,-1/0),f=Mat.axpy(I,C,d),this.isInCube(f)&&(u[1]=f),u},getMesh:function(n,t,o){var u,d,C,I,f,A,y,G=[0,0,0],S=t[2],w=o[2],M=[],V=[];for(A=(JXG$1.evaluate(t[1])-JXG$1.evaluate(t[0]))/S,y=(JXG$1.evaluate(o[1])-JXG$1.evaluate(o[0]))/w,u=0;u<=S;u++){for(C=t[0]+A*u,d=0;d<=w;d++)I=o[0]+y*d,JXG$1.isFunction(n)?G=n(C,I):G=[n[0](C,I),n[1](C,I),n[2](C,I)],f=this.project3DTo2D(G),M.push(f[1]),V.push(f[2]);M.push(NaN),V.push(NaN)}for(d=0;d<=w;d++){for(I=o[0]+y*d,u=0;u<=S;u++)C=t[0]+A*u,JXG$1.isFunction(n)?G=n(C,I):G=[n[0](C,I),n[1](C,I),n[2](C,I)],f=this.project3DTo2D(G),M.push(f[1]),V.push(f[2]);M.push(NaN),V.push(NaN)}return[M,V]},animateAzimuth:function(){var n=this.az_slide._smin,t=this.az_slide._smax,o=t-n,u=this.az_slide.Value()+.1;this.az_slide.position=(u-n)/o,this.az_slide.position>1&&(this.az_slide.position=0),this.board.update(),this.timeoutAzimuth=setTimeout((function(){this.animateAzimuth()}).bind(this),200)},stopAzimuth:function(){clearTimeout(this.timeoutAzimuth),this.timeoutAzimuth=null},isVerticalDrag:function(){var n=this.board,t;return JXG$1.evaluate(this.visProp.verticaldrag.enabled)?(t="_"+JXG$1.evaluate(this.visProp.verticaldrag.key)+"Key",n[t]):!1},setView:function(n,t,o){return o=o||this.r,this.az_slide.setValue(n),this.el_slide.setValue(t),this.r=o,this.board.update(),this},nextView:function(){var n=JXG$1.evaluate(this.visProp.values),t=this.visProp._currentview;return t=(t+1)%n.length,this.setCurrentView(t),this},previousView:function(){var n=JXG$1.evaluate(this.visProp.values),t=this.visProp._currentview;return t=(t+n.length-1)%n.length,this.setCurrentView(t),this},setCurrentView:function(n){var t=JXG$1.evaluate(this.visProp.values);return(n<0||n>=t.length)&&(n=(n%t.length+t.length)%t.length),this.setView(t[n][0],t[n][1],t[n][2]),this.visProp._currentview=n,this},_azEventHandler:function(n){var t=this.az_slide._smax,o=this.az_slide._smin,u=(t-o)/this.board.canvasWidth*JXG$1.evaluate(this.visProp.az.pointer.speed),d=n.movementX,C=this.az_slide.Value(),I=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.az.keyboard.enabled)&&(n.key==="ArrowRight"?C=C+JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180:n.key==="ArrowLeft"&&(C=C-JXG$1.evaluate(this.visProp.az.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.az.pointer.enabled)&&d!==0&&n.key==null&&(C+=d*u),JXG$1.evaluate(this.visProp.az.continuous)?C=Mat.wrap(C,o,t):C>0?C=Math.min(t,C):C<0&&(C=Math.max(o,C)),this.setView(C,I),this)},_elEventHandler:function(n){var t=this.el_slide._smax,o=this.el_slide._smin,u=(t-o)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.el.pointer.speed),d=n.movementY,C=this.az_slide.Value(),I=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.el.keyboard.enabled)&&(n.key==="ArrowUp"?I=I-JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180:n.key==="ArrowDown"&&(I=I+JXG$1.evaluate(this.visProp.el.keyboard.step)*Math.PI/180)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&d!==0&&n.key==null&&(I+=d*u),JXG$1.evaluate(this.visProp.el.continuous)&&!this.trackballEnabled?I=Mat.wrap(I,o,t):I>0?I=Math.min(t,I):I<0&&(I=Math.max(o,I)),this.setView(C,I),this)},_bankEventHandler:function(n){var t=this.bank_slide._smax,o=this.bank_slide._smin,u,d,C=n.deltaY,I=this.bank_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG?this:(JXG$1.evaluate(this.visProp.bank.keyboard.enabled)&&(u=JXG$1.evaluate(this.visProp.bank.keyboard.step)*Math.PI/180,n.key==="."||n.key==="<"?I-=u:(n.key===","||n.key===">")&&(I+=u)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&C!==0&&n.key==null&&(d=(t-o)/this.board.canvasHeight*JXG$1.evaluate(this.visProp.bank.pointer.speed),I+=C*d,n.preventDefault()),JXG$1.evaluate(this.visProp.bank.continuous)?I=Mat.wrap(I,o,t):I=Mat.clamp(I,o,t),this.bank_slide.setValue(I),this.board.update(),this)},_trackballHandler:function(n){var t=this.board.getMousePosition(n),o,u,d;return d=new Coords(Const.COORDS_BY_USER,[this.llftCorner[0]+this.size[0]*.5,this.llftCorner[1]+this.size[1]*.5],this.board),o=t[0]-d.scrCoords[1],u=t[1]-d.scrCoords[2],this._trackball={dx:n.movementX,dy:-n.movementY,x:o,y:-u},this.board.update(),this},pointerDownHandler:function(n){var t,o,u;this._hasMoveAz=!1,this._hasMoveEl=!1,this._hasMoveBank=!1,this._hasMoveTrackball=!1,this.board.mode===this.board.BOARD_MODE_NONE&&(JXG$1.evaluate(this.visProp.trackball.enabled)?(t=JXG$1.evaluate(this.visProp.trackball.button),o=JXG$1.evaluate(this.visProp.trackball.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(u=JXG$1.evaluate(this.visProp.trackball.outside)?document:this.board.containerObj,JXG$1.addEvent(u,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!0)):(JXG$1.evaluate(this.visProp.az.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.az.pointer.button),o=JXG$1.evaluate(this.visProp.az.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(u=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(u,"pointermove",this._azEventHandler,this),this._hasMoveAz=!0)),JXG$1.evaluate(this.visProp.el.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.el.pointer.button),o=JXG$1.evaluate(this.visProp.el.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(u=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(u,"pointermove",this._elEventHandler,this),this._hasMoveEl=!0)),JXG$1.evaluate(this.visProp.bank.pointer.enabled)&&(t=JXG$1.evaluate(this.visProp.bank.pointer.button),o=JXG$1.evaluate(this.visProp.bank.pointer.key),(t===-1||t===n.button)&&(o==="none"||o.indexOf("shift")>-1&&n.shiftKey||o.indexOf("ctrl")>-1&&n.ctrlKey)&&(u=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.addEvent(u,"wheel",this._bankEventHandler,this,{passive:!1}),this._hasMoveBank=!0))),JXG$1.addEvent(document,"pointerup",this.pointerUpHandler,this))},pointerUpHandler:function(n){var t;this._hasMoveAz&&(t=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._azEventHandler,this),this._hasMoveAz=!1),this._hasMoveEl&&(t=JXG$1.evaluate(this.visProp.el.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._elEventHandler,this),this._hasMoveEl=!1),this._hasMoveBank&&(t=JXG$1.evaluate(this.visProp.bank.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"wheel",this._bankEventHandler,this),this._hasMoveBank=!1),this._hasMoveTrackball&&(t=JXG$1.evaluate(this.visProp.az.pointer.outside)?document:this.board.containerObj,JXG$1.removeEvent(t,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!1),JXG$1.removeEvent(document,"pointerup",this.pointerUpHandler,this)}});JXG$1.createView3D=function(n,t,o){var u,d,C,I,f,A,y,G,S,w=t[0],M=t[1];return d=JXG$1.copyAttributes(o,n.options,"view3d"),u=new JXG$1.View3D(n,t,d),u.defaultAxes=u.create("axes3d",[],d),A=w[0],y=w[1],G=M[0],S=M[1],C=JXG$1.copyAttributes(d,n.options,"view3d","az","slider"),C.name="az",I=JXG$1.copyAttributes(d,n.options,"view3d","el","slider"),I.name="el",f=JXG$1.copyAttributes(d,n.options,"view3d","bank","slider"),f.name="bank",u.az_slide=n.create("slider",[[A-1,y-2],[A+G+1,y-2],[JXG$1.evaluate(C.min),JXG$1.evaluate(C.start),JXG$1.evaluate(C.max)]],C),u.inherits.push(u.az_slide),u.el_slide=n.create("slider",[[A-1,y],[A-1,y+S],[JXG$1.evaluate(I.min),JXG$1.evaluate(I.start),JXG$1.evaluate(I.max)]],I),u.inherits.push(u.el_slide),u.bank_slide=n.create("slider",[[A-1,y+S+2],[A+G+1,y+S+2],[JXG$1.evaluate(f.min),JXG$1.evaluate(f.start),JXG$1.evaluate(f.max)]],f),u.inherits.push(u.bank_slide),u.board.infobox.visProp=JXG$1.merge(u.board.infobox.visProp,d.infobox),u.board.highlightInfobox=function(V,T,H){var J,z,L,K,O="",Q=H.board,ee,ie,te=null;for(this.mode===this.BOARD_MODE_DRAG&&(u.isVerticalDrag()?O='<span style="color:black; font-size:200%">⇅ &nbsp;</span>':O='<span style="color:black; font-size:200%">⇄ &nbsp;</span>'),z=0;z<H.parents.length&&(te=Q.objects[H.parents[z]],!te.is3D);z++);if(te){if(K=[1,0,0,te.coords[3]],u._w0=Mat.innerProduct(u.matrix3D[0],K,4),L=u.project2DTo3DPlane(te.element2D,[1,0,0,1],K),!u.isInCube(L)){u.board.highlightCustomInfobox("",te);return}J=JXG$1.evaluate(te.visProp.infoboxdigits),ie=u.board.infobox,J==="auto"?ie.useLocale()?ee=[O,"(",ie.formatNumberLocale(te.X())," | ",ie.formatNumberLocale(te.Y())," | ",ie.formatNumberLocale(te.Z()),")"]:ee=[O,"(",JXG$1.autoDigits(te.X())," | ",JXG$1.autoDigits(te.Y())," | ",JXG$1.autoDigits(te.Z()),")"]:ie.useLocale()?ee=[O,"(",ie.formatNumberLocale(te.X(),J)," | ",ie.formatNumberLocale(te.Y(),J)," | ",ie.formatNumberLocale(te.Z(),J),")"]:ee=[O,"(",JXG$1.toFixed(te.X(),J)," | ",JXG$1.toFixed(te.Y(),J)," | ",JXG$1.toFixed(te.Z(),J),")"],u.board.highlightCustomInfobox(ee.join(""),te)}else u.board.highlightCustomInfobox("("+V+", "+T+")",H)},u.BOARD_MODE_NONE=0,JXG$1.addEvent(n.containerObj,"keydown",function(V){var T,H=!1;JXG$1.evaluate(u.visProp.el.keyboard.enabled)&&(V.key==="ArrowUp"||V.key==="ArrowDown")&&(T=JXG$1.evaluate(u.visProp.el.keyboard.key),(T==="none"||T.indexOf("shift")>-1&&V.shiftKey||T.indexOf("ctrl")>-1&&V.ctrlKey)&&(u._elEventHandler(V),H=!0)),JXG$1.evaluate(u.visProp.el.keyboard.enabled)&&(V.key==="ArrowLeft"||V.key==="ArrowRight")&&(T=JXG$1.evaluate(u.visProp.az.keyboard.key),(T==="none"||T.indexOf("shift")>-1&&V.shiftKey||T.indexOf("ctrl")>-1&&V.ctrlKey)&&(u._azEventHandler(V),H=!0)),JXG$1.evaluate(u.visProp.bank.keyboard.enabled)&&(V.key===","||V.key==="<"||V.key==="."||V.key===">")&&(T=JXG$1.evaluate(u.visProp.bank.keyboard.key),(T==="none"||T.indexOf("shift")>-1&&V.shiftKey||T.indexOf("ctrl")>-1&&V.ctrlKey)&&(u._bankEventHandler(V),H=!0)),V.key==="PageUp"?(u.nextView(),H=!0):V.key==="PageDown"&&(u.previousView(),H=!0),H&&V.preventDefault()},u),JXG$1.addEvent(n.containerObj,"pointerdown",u.pointerDownHandler,u),u.getAnglesFromSliders(),u.matrix3DRot=u.getRotationFromAngles(),u.updateAngleSliderBounds(),u.board.update(),u};JXG$1.registerElement("view3d",JXG$1.createView3D);JXG$1.View3D;JXG$1.GeometryElement3D=function(n,t){this.elType=t,this.id=this.board.setId(this,t),this.view=n,this.element2D=null,this.is3D=!0,this.view.objects[this.id]=this,this.name!==""&&(this.view.elementsByName[this.name]=this)};JXG$1.extend(JXG$1.GeometryElement3D.prototype,{setAttr2D:function(n){var t=n;return t.name=this.name,t},setAttribute:function(n){var t,o,u,d,C,I={};for(t=0;t<arguments.length;t++)d=arguments[t],JXG$1.isString(d)?(C=d.split(":"),I[JXG$1.trim(C[0])]=JXG$1.trim(C[1])):JXG$1.isArray(d)?I[d[0]]=d[1]:JXG$1.extend(I,d);for(t in I)if(I.hasOwnProperty(t))switch(o=t.replace(/\s+/g,"").toLowerCase(),u=I[t],o){case"numberpointshigh":case"stepsu":case"stepsv":JXG$1.exists(this.visProp[o])&&(!JXG$1.Validator[o]||JXG$1.Validator[o]&&JXG$1.Validator[o](u)||JXG$1.Validator[o]&&JXG$1.isFunction(u)&&JXG$1.Validator[o](u()))&&(u=u.toLowerCase&&u.toLowerCase()==="false"?!1:u,this._set(o,u));break;default:JXG$1.exists(this.element2D)&&this.element2D.setAttribute(I)}},getAttribute:function(n){var t;switch(n=n.toLowerCase(),n){case"numberpointshigh":case"stepsu":case"stepsv":t=this.visProp[n];break;default:JXG$1.exists(this.element2D)&&(t=this.element2D.getAttribute(n));break}return t},getAttributes:function(){var n={},t,o,u=["numberpointshigh","stepsu","stepsv"],d=u.length;for(JXG$1.exists(this.element2D)&&(n=JXG$1.merge(this.element2D.getAttributes())),t=0;t<d;t++)o=u[t],JXG$1.exists(this.visProp[o])&&(n[o]=this.visProp[o]);return n},setPosition2D:function(n){},remove:function(){}});JXG$1.GeometryElement3D;JXG$1.createAxes3D=function(n,t,o){var u=t[0],d=["x","y","z"],C="Axis",I=["Rear","Front"],f=[0,0,0],A=[0,0,0],y,G,S,w,M,V,T,H,J,z,L,K,O,Q,ee,ie,te,se,ae,le={};if(JXG$1.exists(u.bbox3D))for(y=0;y<d.length;y++)f[y]=u.bbox3D[y][0],A[y]=u.bbox3D[y][1];else for(y=0;y<d.length;y++)f[y]=t[1][y],A[y]=t[2][1];for(V=JXG$1.copyAttributes(o,n.options,"axes3d"),T=V.axesposition,y=0;y<d.length;y++)H=d[y],te=H+C,T==="center"?(L=[0,0,0],K=[0,0,0],K[y]=A[y],le[te]=u.create("axis3d",[L,K],V[te.toLowerCase()]),le[te].view=u):T==="border"&&(te+="Border",L=f.slice(),K=A.slice(),H==="z"?(L[1]=A[1],K[0]=f[0]):H==="x"?(L=[f[0],A[1],f[2]],K=[A[0],A[1],f[2]]):(L=[A[0],f[1],f[2]],K=[A[0],A[1],f[2]]),K[y]=A[y],le[te]=u.create("axis3d",[L,K],V[te.toLowerCase()]),le[te].view=u,ae=V[te.toLowerCase()].ticks3d,z=A[y]-f[y],H==="x"?le[te+"Ticks"]=u.create("ticks3d",[L,[1,0,0],z,[0,1,0]],ae):H==="y"?le[te+"Ticks"]=u.create("ticks3d",[L,[0,1,0],z,[1,0,0]],ae):le[te+"Ticks"]=u.create("ticks3d",[L,[0,0,1],z,[0,1,0]],ae),le[te+"Ticks"].view=u);for(T==="center"?(le.O=u.create("intersection",[le[d[0]+C],le[d[1]+C]],{name:"",visible:!1,withLabel:!1}),le.O.view=u):le.O=null,y=0;y<d.length;y++)for(w=(y+1)%3,M=(y+2)%3,H=d[y],G=0;G<I.length;G++)L=[0,0,0],L[y]=G===0?f[y]:A[y],O=[0,0,0],Q=[0,0,0],O[w]=1,Q[M]=1,ee=[f[w],A[w]],ie=[f[M],A[M]],te=H+"Plane"+I[G],V=JXG$1.copyAttributes(o,n.options,"axes3d",te),le[te]=u.create("plane3d",[L,O,Q,ee,ie],V),le[te].elType="axisplane3d";for(y=0;y<d.length;y++)for(H=d[y],G=0;G<I.length;G++)for(S=1;S<=2;S++)w=(y+S)%3,J=d[w],te=H+"Plane"+I[G]+J.toUpperCase()+"Axis",se=H+"Plane"+I[G],L=[0,0,0],K=[0,0,0],L[y]=K[y]=G===0?f[y]:A[y],L[w]=f[w],K[w]=A[w],V=JXG$1.copyAttributes(o,n.options,"axes3d",te),le[te]=u.create("axis3d",[L,K],V),le[te].view=u,le[se].addChild(le[te]),le[se].element2D.inherits.push(le[te]);return le};JXG$1.registerElement("axes3d",JXG$1.createAxes3D);JXG$1.createAxis3D=function(n,t,o){var u=t[0],d,C=t[1],I=t[2],f,A,y;return d=JXG$1.copyAttributes(o.point1,n.options,"axis3d","point1"),f=u.create("point",[function(G,S,w){return function(){return u.project3DTo2D(G,S,w)[1]}}(C[0],C[1],C[2]),function(G,S,w){return function(){return u.project3DTo2D(G,S,w)[2]}}(C[0],C[1],C[2])],d),d=JXG$1.copyAttributes(o.point2,n.options,"axis3d","point2"),A=u.create("point",[function(G,S,w){return function(){return u.project3DTo2D(G,S,w)[1]}}(I[0],I[1],I[2]),function(G,S,w){return function(){return u.project3DTo2D(G,S,w)[2]}}(I[0],I[1],I[2])],d),d=JXG$1.copyAttributes(o,n.options,"axis3d"),y=u.create("arrow",[f,A],d),y};JXG$1.registerElement("axis3d",JXG$1.createAxis3D);JXG$1.createMesh3D=function(n,t,o){var u=t[0],d=t[1],C=t[2],I=t[3],f=t[4],A=t[5],y=t[6]||1,G;return G=u.create("curve",[[],[]],o),G.point=d,G.direction1=C,G.range1=I,G.direction2=f,G.range2=A,G.step=y,G.updateDataArray=function(){var S=JXG$1.evaluate(this.range1),w=JXG$1.evaluate(this.range2),M=S[0],V=S[1],T=w[0],H=w[1],J,z,L,K,O=[0,0,0],Q=[0,0,0],ee=JXG$1.evaluate(this.step),ie=[0,0,0];if(this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))ie=this.point().slice(1);else for(K=0;K<3;K++)ie[K]=JXG$1.evaluate(this.point[K]);for(K=0;K<3;K++)O[K]=JXG$1.evaluate(this.direction1[K]),Q[K]=JXG$1.evaluate(this.direction2[K]);for(J=JXG$1.Math.norm(O,3),z=JXG$1.Math.norm(Q,3),K=0;K<3;K++)O[K]/=J,Q[K]/=z;L=u.getMesh([function(te,se){return ie[0]+te*O[0]+se*Q[0]},function(te,se){return ie[1]+te*O[1]+se*Q[1]},function(te,se){return ie[2]+te*O[2]+se*Q[2]}],[Math.ceil(M),Math.floor(V),(Math.ceil(V)-Math.floor(M))/ee],[Math.ceil(T),Math.floor(H),(Math.ceil(H)-Math.floor(T))/ee]),this.dataX=L[0],this.dataY=L[1]},G};JXG$1.registerElement("mesh3d",JXG$1.createMesh3D);JXG$1.Circle3D=function(n,t,o,u,d){var C;this.constructor(n.board,d,Const.OBJECT_TYPE_CIRCLE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"circle3d"),this.center=this.board.select(t),this.normal=[0,0,0],this.curve,this.frame1,this.frame2,this.updateNormal=function(){var I,f;for(I=0;I<3;I++)this.normal[I]=JXG$1.evaluate(o[I]);if(f=Mat.norm(this.normal),Math.abs(f)>Mat.eps)for(I=0;I<3;I++)this.normal[I]/=f},JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),this.updateRadius=JXG$1.createFunction(u,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.updateNormal(),this.frame1=Mat.crossProduct(this.normal,[1,0,0]),C=Mat.crossProduct(this.normal,[-.5,.8660254037844386,0]),Mat.norm(C)>Mat.norm(this.frame1)&&(this.frame1=C),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame(),this.curve=n.create("curve3d",[I=>this.center.X()+this.Radius()*(Math.cos(I)*this.frame1[0]+Math.sin(I)*this.frame2[0]),I=>this.center.Y()+this.Radius()*(Math.cos(I)*this.frame1[1]+Math.sin(I)*this.frame2[1]),I=>this.center.Z()+this.Radius()*(Math.cos(I)*this.frame1[2]+Math.sin(I)*this.frame2[2]),[0,2*Math.PI]],d)};JXG$1.Circle3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Circle3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Circle3D.prototype,{update:function(){return this.updateNormal(),this.updateFrame(),this.curve.visProp.visible=!isNaN(this.Radius()),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):Math.abs(this.updateRadius())},normalizeFrame:function(){var n=Mat.norm(this.frame1),t=Mat.norm(this.frame2),o;for(o=0;o<3;o++)this.frame1[o]/=n,this.frame2[o]/=t},updateFrame:function(){this.frame1=Mat.crossProduct(this.frame2,this.normal),this.frame2=Mat.crossProduct(this.normal,this.frame1),this.normalizeFrame()},projectCoords:function(n,t){return this.curve.projectCoords(n,t)},projectScreenCoords:function(n,t){return this.curve.projectScreenCoords(n,t)}});JXG$1.createCircle3D=function(n,t,o){var u=t[0],d=JXG$1.copyAttributes(o,n.options,"circle3d"),C=JXG$1.providePoints3D(u,[t[1]],o,"circle3d",["point"])[0],I=t[2],f=t[3],A;return A=new JXG$1.Circle3D(u,C,I,f,d),A.curve.addParents([A]),A.addChild(A.curve),A.update(),A};JXG$1.registerElement("circle3d",JXG$1.createCircle3D);JXG$1.createIntersectionCircle3D=function(n,t,o){var u=t[0],d=t[1],C=t[2],I,f,A,y=JXG$1.copyAttributes(o,n.options,"intersectioncircle3d");A=Geometry.intersectionFunction3D(u,d,C),f=u.create("point3d",A[0],{visible:!1}),I=u.create("circle3d",[f,A[1],A[2]],y);try{d.addChild(I),C.addChild(I)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return I.type=Const.OBJECT_TYPE_INTERSECTION_CIRCLE3D,I.elType="intersectioncircle3d",I.setParents([d.id,C.id]),I};JXG$1.registerElement("intersectioncircle3d",JXG$1.createIntersectionCircle3D);JXG$1.Point3D=function(n,t,o,u){this.constructor(n.board,u,Const.OBJECT_TYPE_POINT3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"point3d"),this.board.finalizeAdding(this),n.visProp.depthorderpoints&&n.points.push(this),this.coords=[0,0,0,0],this.F=t,this.slide=o,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Point3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Point3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Point3D.prototype,{updateCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)JXG$1.isFunction(this.F[n])&&(this.coords[n+1]=JXG$1.evaluate(this.F[n]));return this},initCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)this.coords[n+1]=JXG$1.evaluate(this.F[n]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(n,t){var o=this.coords;return n.length===3?(o[0]=1,o[1]=n[0],o[2]=n[1],o[3]=n[2]):(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[2],this.normalizeCoords()),this},update:function(n){var t,o,u;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?t=this.view.project2DTo3DVertical(this.element2D,this.coords):(o=[1,0,0,this.coords[3]],t=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],o)),t[0]!==0&&(u=this.view.project3DToCube(t),this.coords=u[0],u[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()]))),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},distance:function(n){var t=Mat.eps*Mat.eps,o=this.coords,u=n.coords;return o[0]*o[0]>t&&u[0]*u[0]>t?Mat.hypot(u[1]-o[1],u[2]-o[2],u[3]-o[3]):Number.POSITIVE_INFINITY},__evt__update3D:function(n){}});JXG$1.createPoint3D=function(n,t,o){var u=t[0],d,C,I,f,A;if(t.length>2&&JXG$1.exists(t[t.length-1].is3D)?I=t.pop():I=null,t.length===2)C=t[1];else if(t.length===4)C=t.slice(1);else throw new Error("JSXGraph: Can't create point3d with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[x,y,z]], [x,y,z]`);return d=JXG$1.copyAttributes(o,n.options,"point3d"),A=new JXG$1.Point3D(u,C,I,d),A.initCoords(),f=u.project3DTo2D(A.coords),d=A.setAttr2D(d),A.element2D=u.create("point",f,d),A.element2D.view=u,A.addChild(A.element2D),A.inherits.push(A.element2D),A.element2D.setParents(A),A.slide&&(A.slide.addChild(A),A.setParents(A.slide)),A._c2d=A.element2D.coords.usrCoords.slice(),A};JXG$1.registerElement("point3d",JXG$1.createPoint3D);JXG$1.Curve3D=function(n,t,o,u,d,C,I){this.constructor(n.board,I,Const.OBJECT_TYPE_CURVE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"curve3d"),this.board.finalizeAdding(this),this.F=t,this.X=o,this.Y=u,this.Z=d,this.dataX=null,this.dataY=null,this.dataZ=null,this.F!==null&&(this.X=function(f){return this.F(f)[0]},this.Y=function(f){return this.F(f)[1]},this.Z=function(f){return this.F(f)[2]}),this.range=C,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Curve3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Curve3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Curve3D.prototype,{updateDataArray2D:function(){var n=JXG$1.evaluate(this.visProp.numberpointshigh),t,o,u,d,C,I,f,A,y,G=[0,0,0];if(f=[],A=[],JXG$1.exists(this.dataX))for(n=this.dataX.length,I=0;I<n;I++)G=[this.dataX[I],this.dataY[I],this.dataZ[I]],C=this.view.project3DTo2D(G),f.push(C[1]),A.push(C[2]);else if(JXG$1.isArray(this.X))for(n=this.X.length,I=0;I<n;I++)G=[this.X[I],this.Y[I],this.Z[I]],C=this.view.project3DTo2D(G),f.push(C[1]),A.push(C[2]);else for(t=JXG$1.evaluate(this.range),o=JXG$1.evaluate(t[0]),u=JXG$1.evaluate(t[1]),d=(u-o)/(n-1),y=0,I=o;y<n&&I<=u;y++,I+=d)this.F!==null?G=this.F(I):G=[this.X(I),this.Y(I),this.Z(I)],C=this.view.project3DTo2D(G),f.push(C[1]),A.push(C[2]);return{X:f,Y:A}},updateDataArray:function(){},update:function(){return this.updateDataArray(),this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(n){n.length===0&&n.unshift(.5*(this.range[0]+this.range[1]))},projectCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectCoordsToParametric(n,this,t)},projectScreenCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectScreenCoordsToParametric(n,this,t)}});JXG$1.createCurve3D=function(n,t,o){var u=t[0],d,C,I,f,A,y,G;return t.length===3?(d=t[1],A=t[2],C=null,I=null,f=null):(C=t[1],I=t[2],f=t[3],A=t[4],d=null),y=JXG$1.copyAttributes(o,n.options,"curve3d"),G=new JXG$1.Curve3D(u,d,C,I,f,A,y),y=G.setAttr2D(y),G.element2D=u.create("curve",[[],[]],y),G.element2D.view=u,G.element2D.updateDataArray=function(){var S=G.updateDataArray2D();this.dataX=S.X,this.dataY=S.Y},G.addChild(G.element2D),G.inherits.push(G.element2D),G.element2D.setParents(G),G.element2D.prepareUpdate().update(),n.isSuspendedUpdate||G.element2D.updateVisibility().updateRenderer(),G};JXG$1.registerElement("curve3d",JXG$1.createCurve3D);JXG$1.createVectorfield3D=function(n,t,o){var u=t[0],d,C;if(!(t.length>=5&&(JXG$1.isArray(t[1])||JXG$1.isFunction(t[1])||JXG$1.isString(t[1]))&&JXG$1.isArray(t[2])&&t[1].length===3&&JXG$1.isArray(t[3])&&t[2].length===3&&JXG$1.isArray(t[4])&&t[3].length===3))throw new Error("JSXGraph: Can't create vector field 3D with parent types '"+typeof t[1]+"', '"+typeof t[2]+"', '"+typeof t[3]+"'.'"+typeof t[4]+"', ");return C=JXG$1.copyAttributes(o,n.options,"vectorfield3d"),d=u.create("curve3d",[[],[],[]],C),d.setF=function(I,f){var A,y,G;return JXG$1.isArray(I)?(A=JXG$1.createFunction(I[0],this.board,f),y=JXG$1.createFunction(I[1],this.board,f),G=JXG$1.createFunction(I[2],this.board,f),this.F=function(S,w,M){return[A(S,w,M),y(S,w,M),G(S,w,M)]}):this.F=JXG$1.createFunction(I,d.board,f),this},d.setF(t[1],"x, y, z"),d.xData=t[2],d.yData=t[3],d.zData=t[4],d.updateDataArray=function(){var I,f,A,y,G,S,w,M,V=JXG$1.evaluate(this.visProp.scale),T=[JXG$1.evaluate(this.xData[0]),JXG$1.evaluate(this.yData[0]),JXG$1.evaluate(this.zData[0])],H=[JXG$1.evaluate(this.xData[1]),JXG$1.evaluate(this.yData[1]),JXG$1.evaluate(this.zData[1])],J=[JXG$1.evaluate(this.xData[2]),JXG$1.evaluate(this.yData[2]),JXG$1.evaluate(this.zData[2])],z=[(J[0]-T[0])/H[0],(J[1]-T[1])/H[1],(J[2]-T[2])/H[2]],L,K,O,Q,ee=JXG$1.evaluate(this.visProp.arrowhead.enabled),ie,te,se,ae,le;for(ee&&(ie=JXG$1.evaluate(this.visProp.arrowhead.size),le=JXG$1.evaluate(this.visProp.arrowhead.angle),te=ie/n.unitX,se=ie/n.unitY,ae=ie/Math.sqrt(n.unitX*n.unitY)),this.dataX=[],this.dataY=[],this.dataZ=[],f=0,S=T[0];f<=H[0];S+=z[0],f++)for(A=0,w=T[1];A<=H[1];w+=z[1],A++)for(I=0,M=T[2];I<=H[2];M+=z[2],I++)y=this.F(S,w,M),G=Mat.norm(y),!(G<Number.EPSILON)&&(y[0]*=V,y[1]*=V,y[2]*=V,JXG$1.concat(this.dataX,[S,S+y[0],NaN]),JXG$1.concat(this.dataY,[w,w+y[1],NaN]),JXG$1.concat(this.dataZ,[M,M+y[2],NaN]),ee&&(G*=V,L=Math.atan2(y[1],y[0]),Q=Math.asin(y[2]/G),K=Q-le,O=Q+le,JXG$1.concat(this.dataX,[S+y[0]-te*Math.cos(L)*Math.cos(K),S+y[0],S+y[0]-te*Math.cos(L)*Math.cos(O),NaN]),JXG$1.concat(this.dataY,[w+y[1]-se*Math.sin(L)*Math.cos(K),w+y[1],w+y[1]-se*Math.sin(L)*Math.cos(O),NaN]),JXG$1.concat(this.dataZ,[M+y[2]-ae*Math.sin(O),M+y[2],M+y[2]-ae*Math.sin(K),NaN])))},d.methodMap=JXG$1.deepCopy(d.methodMap,{setF:"setF"}),d};JXG$1.registerElement("vectorfield3D",JXG$1.createVectorfield3D);JXG$1.Line3D=function(n,t,o,u,d){this.constructor(n.board,d,Const.OBJECT_TYPE_LINE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"line3d"),this.board.finalizeAdding(this),this.point=t,this.direction=o,this.range=u||[-1/0,1/0],this.point1=null,this.point2=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Line3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Line3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Line3D.prototype,{getPointCoords:function(n){var t=[],o=[],u,d;if(t=[this.point.X(),this.point.Y(),this.point.Z()],JXG$1.isFunction(this.direction))o=this.direction();else for(u=1;u<4;u++)o.push(JXG$1.evaluate(this.direction[u]));return d=JXG$1.evaluate(n),n=this.view.intersectionLineCube(t,o,d),[t[0]+o[0]*n,t[1]+o[1]*n,t[2]+o[2]*n]},update:function(){return this},setPosition2D:function(n){var t,o;for(t=0;t<this.parents.length;t++)o=this.view.select(this.parents[t]),o.elType==="point3d"&&o.element2D.draggable()&&n.applyOnce(o.element2D)},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(n){var t=this.getPointCoords(0),o=this.getPointCoords(1),u=[o[0]-t[0],o[1]-t[1],o[2]-t[2]],d=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],C=Mat.innerProduct(d,u)/Mat.innerProduct(u,u),I=Math.min(Math.max(C,this.range[0]),this.range[1]),f;return f=this.getPointCoords(I).slice(),f.unshift(1),f},projectScreenCoords:function(n){var t=this.getPointCoords(0),o=this.getPointCoords(1);return this.view.projectScreenToSegment(n,t,o)}});JXG$1.createLine3D=function(n,t,o){var u=t[0],d,C,I,f,A,y,G,S,w;return d=JXG$1.copyAttributes(o,n.options,"line3d"),JXG$1.isPoint3D(t[2])||t.length===3&&(JXG$1.isArray(t[2])||JXG$1.isFunction(t[2]))?(y=JXG$1.providePoints3D(u,[t[1]],o,"line3d",["point1"])[0],G=JXG$1.providePoints3D(u,[t[2]],o,"line3d",["point2"])[0],f=function(){return[G.X()-y.X(),G.Y()-y.Y(),G.Z()-y.Z()]},A=[0,1],w=new JXG$1.Line3D(u,y,f,A,d),S=JXG$1.providePoints3D(u,[[0,0,0],[0,0,0]],{visible:!1},"line3d",["point1","point2"]),S[0].F=function(){var M=0;return JXG$1.evaluate(w.visProp.straightfirst)&&(M=-1/0),w.getPointCoords(M)},S[1].F=function(){var M=1;return JXG$1.evaluate(w.visProp.straightlast)&&(M=1/0),w.getPointCoords(M)},S[0].prepareUpdate().update(),S[1].prepareUpdate().update(),d=w.setAttr2D(d),d.straightfirst=!1,d.straightlast=!1,w.element2D=u.create("segment",[S[0].element2D,S[1].element2D],d),w.element2D.view=u,w.endpoints=S,w.addChild(S[0]),w.addChild(S[1]),w.addParents([y,G])):(I=JXG$1.providePoints3D(u,[t[1]],o,"line3d",["point"])[0],JXG$1.isFunction(t[2])?f=t[2]:t[2].length===3?f=[1].concat(t[2]):t[2].length===4&&(f=t[2]),A=t[3],C=JXG$1.providePoints3D(u,[[0,0,0],[0,0,0]],o,"line3d",["point1","point2"]),w=new JXG$1.Line3D(u,I,f,A,d),C[0].F=function(){return w.getPointCoords(JXG$1.evaluate(w.range[0]))},C[0].prepareUpdate().update(),y=C[0],C[1].F=function(){return w.getPointCoords(JXG$1.evaluate(w.range[1]))},C[1].prepareUpdate().update(),G=C[1],d=w.setAttr2D(d),d.straightfirst=!1,d.straightlast=!1,w.element2D=u.create("segment",[y.element2D,G.element2D],d),w.element2D.view=u,w.endpoints=C,w.addParents(I)),w.addChild(w.element2D),w.inherits.push(w.element2D),w.element2D.addParents(w),w.point1=y,w.point2=G,w.point1._is_new?(w.addChild(w.point1),delete w.point1._is_new):w.point1.addChild(w),w.point2._is_new?(w.addChild(w.point2),delete w.point2._is_new):w.point2.addChild(w),JXG$1.exists(I)&&(I._is_new?(w.addChild(I),delete I._is_new):I.addChild(w)),w.update(),w.element2D.prepareUpdate().update().updateRenderer(),w};JXG$1.registerElement("line3d",JXG$1.createLine3D);JXG$1.Plane3D=function(n,t,o,u,d,C,I){this.constructor(n.board,I,Const.OBJECT_TYPE_PLANE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"plane3d"),this.board.finalizeAdding(this),this.point=t,this.direction1=o,this.direction2=d,this.range1=u||[-1/0,1/0],this.range2=C||[-1/0,1/0],this.vec1=[0,0,0],this.vec2=[0,0,0],this.grid=null,this.normal=[0,0,0],this.d=0,this.updateNormal(),this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Plane3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Plane3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Plane3D.prototype,{updateNormal:function(){var n,t;if(JXG$1.isFunction(this.direction1))this.vec1=JXG$1.evaluate(this.direction1);else for(n=0;n<3;n++)this.vec1[n]=JXG$1.evaluate(this.direction1[n]);if(JXG$1.isFunction(this.direction2))this.vec2=JXG$1.evaluate(this.direction2);else for(n=0;n<3;n++)this.vec2[n]=JXG$1.evaluate(this.direction2[n]);if(this.normal=Mat.crossProduct(this.vec1,this.vec2),t=Mat.norm(this.normal),Math.abs(t)>Mat.eps)for(n=0;n<3;n++)this.normal[n]/=t;return this.d=Mat.innerProduct(this.point.coords.slice(1),this.normal,3),this},updateDataArray:function(){var n,t,o,u,d,C,I,f=["xPlaneRear","yPlaneRear","zPlaneRear"],A=[],y=[0,0,0],G=[0,0,0],S=[0,0,0],w=[0,0,0],M,V,T,H,J,z,L,K,O=this.view;if(this.dataX=[],this.dataY=[],this.updateNormal(),this.elType!=="axisplane3d"&&O.defaultAxes&&JXG$1.evaluate(this.range1[0])===-1/0&&JXG$1.evaluate(this.range1[1])===1/0&&JXG$1.evaluate(this.range2[0])===-1/0&&JXG$1.evaluate(this.range2[1])===1/0){for(T=0;T<f.length;T++){if(w=O.intersectionPlanePlane(this,O.defaultAxes[f[T]]),w[0].length===3&&w[1].length===3){for(V=0;V<A.length&&!(Geometry.distance(w[0],A[V][0],3)<Mat.eps&&Geometry.distance(w[1],A[V][1],3)<Mat.eps||Geometry.distance(w[0],A[V][1],3)<Mat.eps&&Geometry.distance(w[1],A[V][0],3)<Mat.eps);V++);V===A.length&&A.push(w.slice())}if(w=[0,0,0],w[T]=O.bbox3D[T][1],M=Mat.innerProduct(w,O.defaultAxes[f[T]].normal,3),w=O.intersectionPlanePlane(this,O.defaultAxes[f[T]],M),w[0].length===3&&w[1].length===3){for(V=0;V<A.length&&!(Geometry.distance(w[0],A[V][0],3)<Mat.eps&&Geometry.distance(w[1],A[V][1],3)<Mat.eps||Geometry.distance(w[0],A[V][1],3)<Mat.eps&&Geometry.distance(w[1],A[V][0],3)<Mat.eps);V++);V===A.length&&A.push(w.slice())}}if(A.length===0)return{X:this.dataX,Y:this.dataY};z=0,L=z,V=0;do{for(w=A[L][V],w.length===3&&(d=O.project3DTo2D(w),this.dataX.push(d[1]),this.dataY.push(d[2])),V=(V+1)%2,w=A[L][V],K=L,T=0;T<A.length;T++){if(T!==L&&Geometry.distance(w,A[T][0])<Mat.eps){L=T,V=0;break}if(T!==L&&Geometry.distance(w,A[T][1])<Mat.eps){L=T,V=1;break}}if(L===K){console.log("Error: update plane3d: did not find next",L);break}}while(L!==z);d=O.project3DTo2D(A[z][0]),this.dataX.push(d[1]),this.dataY.push(d[2])}else{for(n=JXG$1.evaluate(this.range1[0]),t=JXG$1.evaluate(this.range1[1]),o=JXG$1.evaluate(this.range2[0]),u=JXG$1.evaluate(this.range2[1]),S=this.point.coords.slice(1),y=this.vec1.slice(),G=this.vec2.slice(),C=Mat.norm(y,3),I=Mat.norm(G,3),V=0;V<3;V++)y[V]/=C,G[V]/=I;for(T=0;T<4;T++){switch(T){case 0:H=n,J=o;break;case 1:H=t,J=o;break;case 2:H=t,J=u;break;case 3:H=n,J=u}for(V=0;V<3;V++)w[V]=S[V]+H*y[V]+J*G[V];d=O.project3DTo2D(w),this.dataX.push(d[1]),this.dataY.push(d[2])}this.dataX.push(this.dataX[0]),this.dataY.push(this.dataY[0])}return{X:this.dataX,Y:this.dataY}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPlane3D=function(n,t,o){var u=t[0],d,C,I=t[2],f=t[3],A=t[4]||[-1/0,1/0],y=t[5]||[-1/0,1/0],G,S;return C=JXG$1.providePoints3D(u,[t[1]],o,"plane3d",["point"])[0],d=JXG$1.copyAttributes(o,n.options,"plane3d"),G=new JXG$1.Plane3D(u,C,I,A,f,y,d),C.addChild(G),d=G.setAttr2D(d),G.element2D=u.create("curve",[[],[]],d),G.element2D.view=u,G.element2D.updateDataArray=function(){var w=G.updateDataArray();this.dataX=w.X,this.dataY=w.Y},G.addChild(G.element2D),G.inherits.push(G.element2D),G.element2D.setParents(G),d=JXG$1.copyAttributes(o.mesh3d,n.options,"mesh3d"),Math.abs(G.range1[0])!==1/0&&Math.abs(G.range1[1])!==1/0&&Math.abs(G.range2[0])!==1/0&&Math.abs(G.range2[1])!==1/0&&(S=u.create("mesh3d",[function(){return C.coords},I,A,f,y],d),G.grid=S,G.addChild(S),G.inherits.push(S),S.setParents(G),G.grid.view=u),G.element2D.prepareUpdate().update(),n.isSuspendedUpdate||G.element2D.updateVisibility().updateRenderer(),G};JXG$1.registerElement("plane3d",JXG$1.createPlane3D);JXG$1.createIntersectionLine3D=function(n,t,o){var u=t[0],d=t[1],C=t[2],I,f,A,y=JXG$1.copyAttributes(o,n.options,"intersectionline3d"),G=[];for(f=0;f<2;f++)A=Geometry.intersectionFunction3D(u,d,C,f),G[f]=u.create("point3d",A,y["point"+(f+1)]);I=u.create("line3d",G,y);try{d.addChild(I),C.addChild(I)}catch{throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t[0]+"' and '"+typeof t[1]+"'.")}return I.type=Const.OBJECT_TYPE_INTERSECTION_LINE3D,I.elType="intersectionline3d",I.setParents([d.id,C.id]),I};JXG$1.registerElement("intersectionline3d",JXG$1.createIntersectionLine3D);JXG$1.Text3D=function(n,t,o,u,d){this.constructor(n.board,d,Const.OBJECT_TYPE_TEXT3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"text3d"),this.board.finalizeAdding(this),n.visProp.depthorderpoints&&n.points.push(this),this.coords=[0,0,0,0],this.F=t,this.slide=u,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this._params=[],this._c2d=null,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Text3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Text3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Text3D.prototype,{updateCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)JXG$1.isFunction(this.F[n])&&(this.coords[n+1]=JXG$1.evaluate(this.F[n]));return this},initCoords:function(){var n;if(JXG$1.isFunction(this.F))this.coords=JXG$1.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,n=0;n<3;n++)this.coords[n+1]=JXG$1.evaluate(this.F[n]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>Mat.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(n,t){var o=this.coords;return n.length===3?(o[0]=1,o[1]=n[0],o[2]=n[1],o[3]=n[2]):(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[2],this.normalizeCoords()),this},update:function(n){var t,o,u;return this.element2D.draggable()&&Geometry.distance(this._c2d,this.element2D.coords.usrCoords)!==0?this.slide?(this.coords=this.slide.projectScreenCoords([this.element2D.X(),this.element2D.Y()],this._params),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords))):(this.view.isVerticalDrag()?t=this.view.project2DTo3DVertical(this.element2D,this.coords):(o=[1,0,0,this.coords[3]],t=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],o)),t[0]!==0&&(u=this.view.project3DToCube(t),this.coords=u[0],u[1]&&this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D(this.coords)))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this._params)),this.element2D.coords.setCoordinates(Const.COORDS_BY_USER,this.view.project3DTo2D([1,this.X(),this.Y(),this.Z()].slice(1))),this.element2D.prepareUpdate().update()),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},isIllDefined:function(){return JXG$1.cmpArrays(this.coords,[0,0,0,0])},__evt__update3D:function(n){}});JXG$1.createText3D=function(n,t,o){var u=t[0],d,C,I,f,A,y;if(t.length>3&&JXG$1.exists(t[t.length-1].is3D)?I=t.pop():I=null,t.length===3)C=t[1],f=t[2];else if(t.length===5)C=t.slice(1,4),f=t[4];else throw new Error("JSXGraph: Can't create text3d with parent types '"+typeof t[0]+"' and '"+typeof t[1]+`'.
Possible parent types: [[x,y,z], text], [x,y,z, text]`);return d=JXG$1.copyAttributes(o,n.options,"text3d"),y=new JXG$1.Text3D(u,C,f,I,d),y.initCoords(),A=u.project3DTo2D(y.coords),d=y.setAttr2D(d),y.element2D=u.create("text",[A[1],A[2],f],d),y.element2D.view=u,y.addChild(y.element2D),y.inherits.push(y.element2D),y.element2D.setParents(y),y.slide&&(y.slide.addChild(y),y.setParents(y.slide)),y._c2d=y.element2D.coords.usrCoords.slice(),y};JXG$1.registerElement("text3d",JXG$1.createText3D);JXG$1.createTicks3D=function(n,t,o){var u=t[0],d=t[1],C=t[2],I=t[3],f=t[4],A,y;return y=JXG$1.copyAttributes(o,n.options,"ticks3d"),A=u.create("curve",[[],[]],y),A.point=d,A.direction1=C,A.len=I,A.direction2=f,A.drawLabels=function(G){var S=0,w=this.len,M=JXG$1.evaluate(this.visProp.ticksdistance),V=JXG$1.evaluate(this.visProp.tickendings),T=JXG$1.evaluate(this.visProp.majorheight),H,J,z,L,K,O,Q,ee=[0,0,0],ie=[0,0,0],te=[0,0,0],se=[];if(T/=Math.sqrt(n.unitX*n.unitY),H=T*V[1]*2,this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))te=this.point().slice(1);else for(L=0;L<3;L++)te[L]=JXG$1.evaluate(this.point[L]);for(L=0;L<3;L++)ee[L]=JXG$1.evaluate(this.direction1[L]),ie[L]=JXG$1.evaluate(this.direction2[L]);for(J=JXG$1.Math.norm(ee,3),z=JXG$1.Math.norm(ie,3),L=0;L<3;L++)ee[L]/=J,ie[L]/=z;if(!(Math.abs(M)<Mat.eps)){for(K=S;K<=w;K+=M){for(Q=[te[0]+K*ee[0]+H*ie[0],te[1]+K*ee[1]+H*ie[1],te[2]+K*ee[2]+H*ie[2]],L=0;L<3;L++)ee[L]!==0&&(O=te[L]+K*ee[L]);se.push(u.create("text3d",[Q,O],G))}return se}},JXG$1.evaluate(A.visProp.drawlabels)&&(A.labels=A.drawLabels(y.label)),A.updateDataArray=function(){var G=0,S=this.len,w=JXG$1.evaluate(this.visProp.ticksdistance),M=JXG$1.evaluate(this.visProp.tickendings),V=JXG$1.evaluate(this.visProp.majorheight),T,H,J,z,L,K,O,Q,ee=[0,0,0],ie=[0,0,0],te=[0,0,0];if(V/=Math.sqrt(n.unitX*n.unitY),T=V*-M[0],H=V*M[1],this.dataX=[],this.dataY=[],JXG$1.isFunction(this.point))te=this.point().slice(1);else for(L=0;L<3;L++)te[L]=JXG$1.evaluate(this.point[L]);for(L=0;L<3;L++)ee[L]=JXG$1.evaluate(this.direction1[L]),ie[L]=JXG$1.evaluate(this.direction2[L]);for(J=JXG$1.Math.norm(ee,3),z=JXG$1.Math.norm(ie,3),L=0;L<3;L++)ee[L]/=J,ie[L]/=z;if(!(Math.abs(w)<Mat.eps))for(K=G;K<=S;K+=w)Q=[te[0]+K*ee[0]+T*ie[0],te[1]+K*ee[1]+T*ie[1],te[2]+K*ee[2]+T*ie[2]],O=u.project3DTo2D(Q),this.dataX.push(O[1]),this.dataY.push(O[2]),Q=[te[0]+K*ee[0]+H*ie[0],te[1]+K*ee[1]+H*ie[1],te[2]+K*ee[2]+H*ie[2]],O=u.project3DTo2D(Q),this.dataX.push(O[1]),this.dataY.push(O[2]),this.dataX.push(NaN),this.dataY.push(NaN)},A};JXG$1.registerElement("ticks3d",JXG$1.createTicks3D);JXG$1.Polygon3D=function(n,t,o){var u;for(this.constructor(n.board,o,Const.OBJECT_TYPE_POLYGON3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"polygon3d"),this.board.finalizeAdding(this),this.vertices=[],u=0;u<t.length;u++)this.vertices[u]=this.board.select(t[u]),this.vertices[u]._is_new&&(delete this.vertices[u]._is_new,this.vertices[u]._is_new_pol=!0)};JXG$1.Polygon3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Polygon3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Polygon3D.prototype,{update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this}});JXG$1.createPolygon3D=function(n,t,o){var u=t[0],d,C,I,f,A=[],y=[],G,S,w=!1;if(G=JXG$1.copyAttributes(o,n.options,"polygon3d"),f=n.select(t[1]),f===null&&(f=t[1]),JXG$1.isObject(f)&&f.type===Const.OBJECT_TYPE_POLYGON3D&&JXG$1.isTransformationOrArray(t[2]))for(w=!0,I=f.vertices.length-1,S=JXG$1.copyAttributes(o,n.options,"polygon3d","vertices"),C=0;C<I;C++)S.withlabel&&(S.name=f.vertices[C].name===""?"":f.vertices[C].name+"'"),A.push(n.create("point3d",[f.vertices[C],t[2]],S));else if(A=JXG$1.providePoints3D(u,t.slice(1),o,"polygon3d",["vertices"]),A===!1)throw new Error("JSXGraph: Can't create polygon3d with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon3d and a transformation can be supplied");for(d=new JXG$1.Polygon3D(u,A,G),d.isDraggable=!0,G=d.setAttr2D(G),C=0;C<A.length;C++)y.push(A[C].element2D);if(d.element2D=n.create("polygon",y,G),d.element2D.view=u,d.addChild(d.element2D),d.inherits.push(d.element2D),d.element2D.setParents(d),w)for(d.prepareUpdate().update().updateVisibility().updateRenderer(),I=f.vertices.length-1,C=0;C<I;C++)A[C].prepareUpdate().update().updateVisibility().updateRenderer();return d};JXG$1.registerElement("polygon3d",JXG$1.createPolygon3D);JXG$1.Sphere3D=function(n,t,o,u,d){this.constructor(n.board,d,Const.OBJECT_TYPE_SPHERE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"sphere3d"),this.board.finalizeAdding(this),this.method=t,this.center=this.board.select(o),this.point2=null,this.points=[],this.element2D=null,this.aux2D=[],this.projectionType=n.projectionType,t==="twoPoints"?(this.point2=this.board.select(u),this.radius=this.Radius()):t==="pointRadius"&&(this.updateRadius=JXG$1.createFunction(u,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])),JXG$1.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),t==="twoPoints"&&(JXG$1.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=JXG$1.deepCopy(this.methodMap,{center:"center",point2:"point2",Radius:"Radius"})};JXG$1.Sphere3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Sphere3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Sphere3D.prototype,{update:function(){return this.projectionType!==this.view.projectionType&&this.rebuildProjection(),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(n){return this.updateRadius=JXG$1.createFunction(n,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(n){return JXG$1.exists(n)?(this.setRadius(n),this.Radius()):this.method==="twoPoints"?this.center.isIllDefined()||this.point2.isIllDefined()?NaN:this.center.distance(this.point2):this.method==="pointRadius"?Math.abs(this.updateRadius()):NaN},focusFn:function(n){var t=this;return function(){var o=t.view.boxToCam[3],u=t.Radius();return t.view.project3DTo2D([t.center.X()+n*u*o[1],t.center.Y()+n*u*o[2],t.center.Z()+n*u*o[3]]).slice(1,3)}},innerVertexFn:function(){var n=this;return function(){var t=n.view,o=t.worldToFocal(n.center.coords,!1),u=Mat.hypot(o[0],o[1]),d=t.boxToCam,C=[-(o[0]*d[1][1]+o[1]*d[2][1])/u,-(o[0]*d[1][2]+o[1]*d[2][2])/u,-(o[0]*d[1][3]+o[1]*d[2][3])/u],I=n.Radius(),f=Math.atan(-u/o[2]),A=Math.acos(I/Mat.norm(o)),y=f+A,G=Math.cos(y),S=Math.sin(y);return t.project3DTo2D([n.center.X()+I*(S*C[0]+G*d[3][1]),n.center.Y()+I*(S*C[1]+G*d[3][2]),n.center.Z()+I*(S*C[2]+G*d[3][3])])}},buildCentralProjection:function(){var n=this.view,t={visible:!1,withLabel:!1},o=n.create("point",this.focusFn(-1),t),u=n.create("point",this.focusFn(1),t),d=n.create("point",this.innerVertexFn(n),t);this.aux2D=[o,u,d],this.element2D=n.create("ellipse",this.aux2D,this.visProp)},buildParallelProjection:function(){var n=this,t=function(){var u=[1,n.center.X(),n.center.Y(),n.center.Z()];return n.view.project3DTo2D(u)},o=function(){var u=n.view.bbox3D[0][1]-n.view.bbox3D[0][0];return n.Radius()*n.view.size[0]/u};this.aux2D=[],this.element2D=this.view.create("circle",[t,o],this.visProp)},rebuildProjection:function(){var n;if(this.element2D){this.view.board.removeObject(this.element2D);for(n in this.aux2D)this.aux2D.hasOwnProperty(n)&&this.view.board.removeObject(this.aux2D[n])}this.projectionType=this.view.projectionType,this.projectionType==="central"?this.buildCentralProjection():this.buildParallelProjection(),this.addChild(this.element2D),this.inherits.push(this.element2D),this.element2D.view=this.view}});JXG$1.createSphere3D=function(n,t,o){var u=t[0],d,C,I,f,A,y;for(d=JXG$1.copyAttributes(o,n.options,"sphere3d"),C=[],y=1;y<t.length;y++)if(JXG$1.isPointType3D(n,t[y])){if(C.length===0?I="center":I="point",f=JXG$1.providePoints3D(u,[t[y]],o,"sphere3d",[I])[0],f===!1)throw new Error("JSXGraph: Can't create sphere3d from this type. Please provide a point type.");C.push(f)}else C.push(t[y]);if(JXG$1.isPoint3D(C[0])&&JXG$1.isPoint3D(C[1]))A=new JXG$1.Sphere3D(u,"twoPoints",C[0],C[1],d);else if((JXG$1.isNumber(C[0])||JXG$1.isFunction(C[0])||JXG$1.isString(C[0]))&&JXG$1.isPoint3D(C[1]))A=new JXG$1.Sphere3D(u,"pointRadius",C[1],C[0],d);else if((JXG$1.isNumber(C[1])||JXG$1.isFunction(C[1])||JXG$1.isString(C[1]))&&JXG$1.isPoint3D(C[0]))A=new JXG$1.Sphere3D(u,"pointRadius",C[0],C[1],d);else throw new Error("JSXGraph: Can't create sphere3d with parent types '"+typeof t[1]+"' and '"+typeof t[2]+`'.
Possible parent types: [point,point], [point,number], [point,function]`);return A.rebuildProjection(),A.element2D.prepareUpdate().update().updateRenderer(),A};JXG$1.registerElement("sphere3d",JXG$1.createSphere3D);JXG$1.Surface3D=function(n,t,o,u,d,C,I,f){this.constructor(n.board,f,Const.OBJECT_TYPE_SURFACE3D,Const.OBJECT_CLASS_3D),this.constructor3D(n,"surface3d"),this.board.finalizeAdding(this),this.F=t,this.X=o,this.Y=u,this.Z=d,this.F!==null&&(this.X=function(A,y){return this.F(A,y)[0]},this.Y=function(A,y){return this.F(A,y)[1]},this.Z=function(A,y){return this.F(A,y)[2]}),this.range_u=C,this.range_v=I,this.methodMap=JXG$1.deepCopy(this.methodMap,{})};JXG$1.Surface3D.prototype=new JXG$1.GeometryElement;JXG$1.copyPrototypeMethods(JXG$1.Surface3D,JXG$1.GeometryElement3D,"constructor3D");JXG$1.extend(JXG$1.Surface3D.prototype,{updateDataArray:function(){var n=JXG$1.evaluate(this.visProp.stepsu),t=JXG$1.evaluate(this.visProp.stepsv),o=JXG$1.evaluate(this.range_u),u=JXG$1.evaluate(this.range_v),d,C;return this.F!==null?d=this.F:d=[this.X,this.Y,this.Z],o.push(n),u.push(t),C=this.view.getMesh(d,o,u),{X:C[0],Y:C[1]}},update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this},initParamsIfNeeded:function(n){n.length===0&&n.unshift(.5*(this.range_u[0]+this.range_u[1]),.5*(this.range_v[0]+this.range_v[1]))},projectCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectCoordsToParametric(n,this,t)},projectScreenCoords:function(n,t){return this.initParamsIfNeeded(t),Geometry.projectScreenCoordsToParametric(n,this,t)}});JXG$1.createParametricSurface3D=function(n,t,o){var u=t[0],d,C,I,f,A,y,G,S;return t.length===4?(d=t[1],A=t[2],y=t[3],C=null,I=null,f=null):(C=t[1],I=t[2],f=t[3],A=t[4],y=t[5],d=null),G=JXG$1.copyAttributes(o,n.options,"surface3d"),S=new JXG$1.Surface3D(u,d,C,I,f,A,y,G),G=S.setAttr2D(G),S.element2D=u.create("curve",[[],[]],G),S.element2D.view=u,S.element2D.updateDataArray=function(){var w=S.updateDataArray();this.dataX=w.X,this.dataY=w.Y},S.addChild(S.element2D),S.inherits.push(S.element2D),S.element2D.setParents(S),S.element2D.prepareUpdate().update(),n.isSuspendedUpdate||S.element2D.updateVisibility().updateRenderer(),S};JXG$1.registerElement("parametricsurface3d",JXG$1.createParametricSurface3D);JXG$1.createFunctiongraph3D=function(n,t,o){var u=t[0],d=function(y,G){return y},C=function(y,G){return G},I=JXG$1.createFunction(t[1],n,"x, y"),f=t[2],A=t[3];return u.create("parametricsurface3d",[d,C,I,f,A],o)};JXG$1.registerElement("functiongraph3d",JXG$1.createFunctiongraph3D);let size=.75,color="#000";JXG$1.themes.mono_thin={board:{showInfobox:!1,showCopyright:!0,defaultAxes:{x:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[1,0]}},y:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[0,1]}}}},navbar:{strokeColor:"#bbb",fillColor:"none"},elements:{strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none",strokeOpacity:.6,highlightStrokeOpacity:1},angle:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3,label:{strokeColor:color}},arc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},axis:{},boxplot:{strokeWidth:size,strokeColor:color,fillColor:color,fillOpacity:.2,highlightStrokeWidth:size,highlightStrokeColor:color,highlightFillColor:color,highlightFillOpacity:.1},circle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcirclearc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},circumcirclesector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},comb:{strokeColor:color,strokeWidth:size},conic:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none"},curve:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},grid:{strokeWidth:size},hatch:{strokeColor:color,strokeWidth:size},incircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},inequality:{fillColor:"#aaaaaa55",fillOpacity:.2},integral:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaa33",fillOpacity:.3,highlightFillOpacity:.3,curveLeft:{color},baseLeft:{color},curveRight:{color},baseRight:{color}},label:{strokeColor:color},line:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},normal:{strokeColor:color},parallel:{strokeColor:color},perpendicular:{strokeColor:color},perpendicularsegment:{strokeColor:color},point:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},polygon:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaaa33",fillOpacity:.3,highlightFillOpacity:.3,vertices:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},borders:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size}},sector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},semicircle:{center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},slider:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color,baseline:{strokeWidth:size,strokeColor:color,highlightStrokeColor:color},label:{strokeColor:color},highline:{strokeWidth:3*size,name:"",strokeColor:color,highlightStrokeColor:color},ticks:{strokeColor:color}},slopefield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8},tapemeasure:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},ticks:{strokeWidth:size}},text:{strokeColor:color},tracecurve:{strokeColor:color},turtle:{strokeWidth:size,strokeColor:color,arrow:{strokeWidth:2*size,strokeColor:"#aaaaaa55"}},vectorfield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8}};JXG$1.COORDS_BY_SCREEN;JXG$1.COORDS_BY_USER;JXG$1.Dump;JXG$1.Expect;JXG$1.JSXGraph;JXG$1.Math;JXG$1.Options;JXG$1.boards;JXG$1.elements;JXG$1.palette;JXG$1.paletteWong;JXG$1.Board;JXG$1.Chart;JXG$1.Circle;JXG$1.Complex;JXG$1.Composition;JXG$1.Coords;JXG$1.CoordsElement;JXG$1.Curve;JXG$1.GeometryElement;JXG$1.Group;JXG$1.Image;JXG$1.JessieCode;JXG$1.PrefixParser;JXG$1.Line;JXG$1.Point;JXG$1.Polygon;JXG$1.Text;JXG$1.Ticks;JXG$1.Transformation;JXG$1.Turtle;JXG$1.View3D;JXG$1.LMS2rgb;JXG$1.addEvent;JXG$1.autoDigits;JXG$1.autoHighlight;JXG$1.bind;JXG$1.capitalize;JXG$1.clearVisPropOld;JXG$1.clone;JXG$1.cloneAndCopy;JXG$1.cmpArrays;JXG$1.coordsArrayToMatrix;JXG$1.copyAttributes;JXG$1.createEvalFunction;JXG$1.createFunction;JXG$1.createHTMLSlider;JXG$1.darkenColor;JXG$1.debug;JXG$1.debugInt;JXG$1.debugLine;JXG$1.debugWST;JXG$1.deepCopy;JXG$1.def;JXG$1.deprecated;JXG$1.eliminateDuplicates;JXG$1.escapeHTML;JXG$1.evalSlider;JXG$1.evaluate;JXG$1.filterElements;JXG$1.getBoardByContainerId;JXG$1.getCSSTransformMatrix;JXG$1.getCSSTransform;JXG$1.getDimensions;JXG$1.getOffset;JXG$1.getPosition;JXG$1.getProp;JXG$1.hex2rgb;JXG$1.hsv2rgb;JXG$1.isAndroid;JXG$1.isApple;JXG$1.isArray;JXG$1.isDesktop;JXG$1.isInArray;JXG$1.isInObject;JXG$1.isMetroApp;JXG$1.isMobile;JXG$1.isMozilla;JXG$1.isBoard;JXG$1.isName;JXG$1.isNode;JXG$1.isNumber;JXG$1.isObject;JXG$1.isPoint;JXG$1.isPoint3D;JXG$1.isPointType;JXG$1.isPointType3D;JXG$1.isString;JXG$1.isTouchDevice;JXG$1.isTransformationOrArray;JXG$1.isWebWorker;JXG$1.isWebkitAndroid;JXG$1.isWebkitApple;JXG$1.keys;JXG$1.lightenColor;JXG$1.merge;JXG$1.normalizePointFace;JXG$1.providePoints;JXG$1.registerElement;JXG$1.registerReader;JXG$1.removeAllEvents;JXG$1.removeElementFromArray;JXG$1.removeEvent;JXG$1.rgb2LMS;JXG$1.rgb2bw;JXG$1.rgb2cb;JXG$1.rgb2css;JXG$1.rgb2hex;JXG$1.rgb2hsv;JXG$1.rgbParser;JXG$1.rgba2rgbo;JXG$1.rgbo2rgba;JXG$1.sanitizeHTML;JXG$1.shortcut;JXG$1.str2Bool;JXG$1.supportsCanvas;JXG$1.supportsPointerEvents;JXG$1.supportsSVG;JXG$1.supportsVML;JXG$1.swap;JXG$1.timedChunk;JXG$1.toFixed;JXG$1.toFullscreen;JXG$1.toJSON;JXG$1.trim;JXG$1.trimNumber;JXG$1.truncate;JXG$1.unescapeHTML;JXG$1.uniqueArray;JXG$1.useBlackWhiteOptions;JXG$1.useStandardOptions;JXG$1.warn;JXG$1.isBrowser?window.JXG=JXG$1:JXG$1.isWebWorker()&&(self.JXG=JXG$1);var cjs={exports:{}},Draggable$1={},propTypes={exports:{}},ReactPropTypesSecret_1,hasRequiredReactPropTypesSecret;function requireReactPropTypesSecret(){if(hasRequiredReactPropTypesSecret)return ReactPropTypesSecret_1;hasRequiredReactPropTypesSecret=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ReactPropTypesSecret_1=n,ReactPropTypesSecret_1}var factoryWithThrowingShims,hasRequiredFactoryWithThrowingShims;function requireFactoryWithThrowingShims(){if(hasRequiredFactoryWithThrowingShims)return factoryWithThrowingShims;hasRequiredFactoryWithThrowingShims=1;var n=requireReactPropTypesSecret();function t(){}function o(){}return o.resetWarningCache=t,factoryWithThrowingShims=function(){function u(I,f,A,y,G,S){if(S!==n){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}u.isRequired=u;function d(){return u}var C={array:u,bigint:u,bool:u,func:u,number:u,object:u,string:u,symbol:u,any:u,arrayOf:d,element:u,elementType:u,instanceOf:d,node:u,objectOf:d,oneOf:d,oneOfType:d,shape:d,exact:d,checkPropTypes:o,resetWarningCache:t};return C.PropTypes=C,C},factoryWithThrowingShims}var hasRequiredPropTypes;function requirePropTypes(){return hasRequiredPropTypes||(hasRequiredPropTypes=1,propTypes.exports=requireFactoryWithThrowingShims()()),propTypes.exports}function r(n){var t,o,u="";if(typeof n=="string"||typeof n=="number")u+=n;else if(typeof n=="object")if(Array.isArray(n))for(t=0;t<n.length;t++)n[t]&&(o=r(n[t]))&&(u&&(u+=" "),u+=o);else for(t in n)n[t]&&(u&&(u+=" "),u+=t);return u}function clsx(){for(var n,t,o=0,u="";o<arguments.length;)(n=arguments[o++])&&(t=r(n))&&(u&&(u+=" "),u+=t);return u}const clsx_m=Object.freeze(Object.defineProperty({__proto__:null,clsx,default:clsx},Symbol.toStringTag,{value:"Module"})),require$$3=getAugmentedNamespace(clsx_m);var domFns={},shims={},hasRequiredShims;function requireShims(){if(hasRequiredShims)return shims;hasRequiredShims=1,Object.defineProperty(shims,"__esModule",{value:!0}),shims.dontSetMe=d,shims.findInArray=n,shims.int=u,shims.isFunction=t,shims.isNum=o;function n(C,I){for(let f=0,A=C.length;f<A;f++)if(I.apply(I,[C[f],f,C]))return C[f]}function t(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Function]"}function o(C){return typeof C=="number"&&!isNaN(C)}function u(C){return parseInt(C,10)}function d(C,I,f){if(C[I])return new Error("Invalid prop ".concat(I," passed to ").concat(f," - do not set this, set it on the child."))}return shims}var getPrefix={},hasRequiredGetPrefix;function requireGetPrefix(){if(hasRequiredGetPrefix)return getPrefix;hasRequiredGetPrefix=1,Object.defineProperty(getPrefix,"__esModule",{value:!0}),getPrefix.browserPrefixToKey=o,getPrefix.browserPrefixToStyle=u,getPrefix.default=void 0,getPrefix.getPrefix=t;const n=["Moz","Webkit","O","ms"];function t(){var C;let I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const f=(C=window.document)===null||C===void 0||(C=C.documentElement)===null||C===void 0?void 0:C.style;if(!f||I in f)return"";for(let A=0;A<n.length;A++)if(o(I,n[A])in f)return n[A];return""}function o(C,I){return I?"".concat(I).concat(d(C)):C}function u(C,I){return I?"-".concat(I.toLowerCase(),"-").concat(C):C}function d(C){let I="",f=!0;for(let A=0;A<C.length;A++)f?(I+=C[A].toUpperCase(),f=!1):C[A]==="-"?f=!0:I+=C[A];return I}return getPrefix.default=t(),getPrefix}var hasRequiredDomFns;function requireDomFns(){if(hasRequiredDomFns)return domFns;hasRequiredDomFns=1,Object.defineProperty(domFns,"__esModule",{value:!0}),domFns.addClassName=O,domFns.addEvent=f,domFns.addUserSelectStyles=L,domFns.createCSSTransform=V,domFns.createSVGTransform=T,domFns.getTouch=J,domFns.getTouchIdentifier=z,domFns.getTranslation=H,domFns.innerHeight=S,domFns.innerWidth=w,domFns.matchesSelector=C,domFns.matchesSelectorAndParentsTo=I,domFns.offsetXYFromParent=M,domFns.outerHeight=y,domFns.outerWidth=G,domFns.removeClassName=Q,domFns.removeEvent=A,domFns.removeUserSelectStyles=K;var n=requireShims(),t=u(requireGetPrefix());function o(ee){if(typeof WeakMap!="function")return null;var ie=new WeakMap,te=new WeakMap;return(o=function(se){return se?te:ie})(ee)}function u(ee,ie){if(ee&&ee.__esModule)return ee;if(ee===null||typeof ee!="object"&&typeof ee!="function")return{default:ee};var te=o(ie);if(te&&te.has(ee))return te.get(ee);var se={},ae=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var le in ee)if(le!=="default"&&Object.prototype.hasOwnProperty.call(ee,le)){var ge=ae?Object.getOwnPropertyDescriptor(ee,le):null;ge&&(ge.get||ge.set)?Object.defineProperty(se,le,ge):se[le]=ee[le]}return se.default=ee,te&&te.set(ee,se),se}let d="";function C(ee,ie){return d||(d=(0,n.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(te){return(0,n.isFunction)(ee[te])})),(0,n.isFunction)(ee[d])?ee[d](ie):!1}function I(ee,ie,te){let se=ee;do{if(C(se,ie))return!0;if(se===te)return!1;se=se.parentNode}while(se);return!1}function f(ee,ie,te,se){if(!ee)return;const ae={capture:!0,...se};ee.addEventListener?ee.addEventListener(ie,te,ae):ee.attachEvent?ee.attachEvent("on"+ie,te):ee["on"+ie]=te}function A(ee,ie,te,se){if(!ee)return;const ae={capture:!0,...se};ee.removeEventListener?ee.removeEventListener(ie,te,ae):ee.detachEvent?ee.detachEvent("on"+ie,te):ee["on"+ie]=null}function y(ee){let ie=ee.clientHeight;const te=ee.ownerDocument.defaultView.getComputedStyle(ee);return ie+=(0,n.int)(te.borderTopWidth),ie+=(0,n.int)(te.borderBottomWidth),ie}function G(ee){let ie=ee.clientWidth;const te=ee.ownerDocument.defaultView.getComputedStyle(ee);return ie+=(0,n.int)(te.borderLeftWidth),ie+=(0,n.int)(te.borderRightWidth),ie}function S(ee){let ie=ee.clientHeight;const te=ee.ownerDocument.defaultView.getComputedStyle(ee);return ie-=(0,n.int)(te.paddingTop),ie-=(0,n.int)(te.paddingBottom),ie}function w(ee){let ie=ee.clientWidth;const te=ee.ownerDocument.defaultView.getComputedStyle(ee);return ie-=(0,n.int)(te.paddingLeft),ie-=(0,n.int)(te.paddingRight),ie}function M(ee,ie,te){const ae=ie===ie.ownerDocument.body?{left:0,top:0}:ie.getBoundingClientRect(),le=(ee.clientX+ie.scrollLeft-ae.left)/te,ge=(ee.clientY+ie.scrollTop-ae.top)/te;return{x:le,y:ge}}function V(ee,ie){const te=H(ee,ie,"px");return{[(0,t.browserPrefixToKey)("transform",t.default)]:te}}function T(ee,ie){return H(ee,ie,"")}function H(ee,ie,te){let{x:se,y:ae}=ee,le="translate(".concat(se).concat(te,",").concat(ae).concat(te,")");if(ie){const ge="".concat(typeof ie.x=="string"?ie.x:ie.x+te),be="".concat(typeof ie.y=="string"?ie.y:ie.y+te);le="translate(".concat(ge,", ").concat(be,")")+le}return le}function J(ee,ie){return ee.targetTouches&&(0,n.findInArray)(ee.targetTouches,te=>ie===te.identifier)||ee.changedTouches&&(0,n.findInArray)(ee.changedTouches,te=>ie===te.identifier)}function z(ee){if(ee.targetTouches&&ee.targetTouches[0])return ee.targetTouches[0].identifier;if(ee.changedTouches&&ee.changedTouches[0])return ee.changedTouches[0].identifier}function L(ee){if(!ee)return;let ie=ee.getElementById("react-draggable-style-el");ie||(ie=ee.createElement("style"),ie.type="text/css",ie.id="react-draggable-style-el",ie.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,ie.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,ee.getElementsByTagName("head")[0].appendChild(ie)),ee.body&&O(ee.body,"react-draggable-transparent-selection")}function K(ee){if(ee)try{if(ee.body&&Q(ee.body,"react-draggable-transparent-selection"),ee.selection)ee.selection.empty();else{const ie=(ee.defaultView||window).getSelection();ie&&ie.type!=="Caret"&&ie.removeAllRanges()}}catch{}}function O(ee,ie){ee.classList?ee.classList.add(ie):ee.className.match(new RegExp("(?:^|\\s)".concat(ie,"(?!\\S)")))||(ee.className+=" ".concat(ie))}function Q(ee,ie){ee.classList?ee.classList.remove(ie):ee.className=ee.className.replace(new RegExp("(?:^|\\s)".concat(ie,"(?!\\S)"),"g"),"")}return domFns}var positionFns={},hasRequiredPositionFns;function requirePositionFns(){if(hasRequiredPositionFns)return positionFns;hasRequiredPositionFns=1,Object.defineProperty(positionFns,"__esModule",{value:!0}),positionFns.canDragX=d,positionFns.canDragY=C,positionFns.createCoreData=f,positionFns.createDraggableData=A,positionFns.getBoundPosition=o,positionFns.getControlPosition=I,positionFns.snapToGrid=u;var n=requireShims(),t=requireDomFns();function o(S,w,M){if(!S.props.bounds)return[w,M];let{bounds:V}=S.props;V=typeof V=="string"?V:y(V);const T=G(S);if(typeof V=="string"){const{ownerDocument:H}=T,J=H.defaultView;let z;if(V==="parent"?z=T.parentNode:z=H.querySelector(V),!(z instanceof J.HTMLElement))throw new Error('Bounds selector "'+V+'" could not find an element.');const L=z,K=J.getComputedStyle(T),O=J.getComputedStyle(L);V={left:-T.offsetLeft+(0,n.int)(O.paddingLeft)+(0,n.int)(K.marginLeft),top:-T.offsetTop+(0,n.int)(O.paddingTop)+(0,n.int)(K.marginTop),right:(0,t.innerWidth)(L)-(0,t.outerWidth)(T)-T.offsetLeft+(0,n.int)(O.paddingRight)-(0,n.int)(K.marginRight),bottom:(0,t.innerHeight)(L)-(0,t.outerHeight)(T)-T.offsetTop+(0,n.int)(O.paddingBottom)-(0,n.int)(K.marginBottom)}}return(0,n.isNum)(V.right)&&(w=Math.min(w,V.right)),(0,n.isNum)(V.bottom)&&(M=Math.min(M,V.bottom)),(0,n.isNum)(V.left)&&(w=Math.max(w,V.left)),(0,n.isNum)(V.top)&&(M=Math.max(M,V.top)),[w,M]}function u(S,w,M){const V=Math.round(w/S[0])*S[0],T=Math.round(M/S[1])*S[1];return[V,T]}function d(S){return S.props.axis==="both"||S.props.axis==="x"}function C(S){return S.props.axis==="both"||S.props.axis==="y"}function I(S,w,M){const V=typeof w=="number"?(0,t.getTouch)(S,w):null;if(typeof w=="number"&&!V)return null;const T=G(M),H=M.props.offsetParent||T.offsetParent||T.ownerDocument.body;return(0,t.offsetXYFromParent)(V||S,H,M.props.scale)}function f(S,w,M){const V=!(0,n.isNum)(S.lastX),T=G(S);return V?{node:T,deltaX:0,deltaY:0,lastX:w,lastY:M,x:w,y:M}:{node:T,deltaX:w-S.lastX,deltaY:M-S.lastY,lastX:S.lastX,lastY:S.lastY,x:w,y:M}}function A(S,w){const M=S.props.scale;return{node:w.node,x:S.state.x+w.deltaX/M,y:S.state.y+w.deltaY/M,deltaX:w.deltaX/M,deltaY:w.deltaY/M,lastX:S.state.x,lastY:S.state.y}}function y(S){return{left:S.left,top:S.top,right:S.right,bottom:S.bottom}}function G(S){const w=S.findDOMNode();if(!w)throw new Error("<DraggableCore>: Unmounted during event!");return w}return positionFns}var DraggableCore={},log={},hasRequiredLog;function requireLog(){if(hasRequiredLog)return log;hasRequiredLog=1,Object.defineProperty(log,"__esModule",{value:!0}),log.default=n;function n(){}return log}var hasRequiredDraggableCore;function requireDraggableCore(){if(hasRequiredDraggableCore)return DraggableCore;hasRequiredDraggableCore=1,Object.defineProperty(DraggableCore,"__esModule",{value:!0}),DraggableCore.default=void 0;var n=y(requireReact()),t=f(requirePropTypes()),o=f(requireReactDom()),u=requireDomFns(),d=requirePositionFns(),C=requireShims(),I=f(requireLog());function f(H){return H&&H.__esModule?H:{default:H}}function A(H){if(typeof WeakMap!="function")return null;var J=new WeakMap,z=new WeakMap;return(A=function(L){return L?z:J})(H)}function y(H,J){if(H&&H.__esModule)return H;if(H===null||typeof H!="object"&&typeof H!="function")return{default:H};var z=A(J);if(z&&z.has(H))return z.get(H);var L={},K=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in H)if(O!=="default"&&Object.prototype.hasOwnProperty.call(H,O)){var Q=K?Object.getOwnPropertyDescriptor(H,O):null;Q&&(Q.get||Q.set)?Object.defineProperty(L,O,Q):L[O]=H[O]}return L.default=H,z&&z.set(H,L),L}function G(H,J,z){return J=S(J),J in H?Object.defineProperty(H,J,{value:z,enumerable:!0,configurable:!0,writable:!0}):H[J]=z,H}function S(H){var J=w(H,"string");return typeof J=="symbol"?J:String(J)}function w(H,J){if(typeof H!="object"||H===null)return H;var z=H[Symbol.toPrimitive];if(z!==void 0){var L=z.call(H,J);if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(J==="string"?String:Number)(H)}const M={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let V=M.mouse,T=class extends n.Component{constructor(){super(...arguments),G(this,"dragging",!1),G(this,"lastX",NaN),G(this,"lastY",NaN),G(this,"touchIdentifier",null),G(this,"mounted",!1),G(this,"handleDragStart",J=>{if(this.props.onMouseDown(J),!this.props.allowAnyClick&&typeof J.button=="number"&&J.button!==0)return!1;const z=this.findDOMNode();if(!z||!z.ownerDocument||!z.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:L}=z;if(this.props.disabled||!(J.target instanceof L.defaultView.Node)||this.props.handle&&!(0,u.matchesSelectorAndParentsTo)(J.target,this.props.handle,z)||this.props.cancel&&(0,u.matchesSelectorAndParentsTo)(J.target,this.props.cancel,z))return;J.type==="touchstart"&&J.preventDefault();const K=(0,u.getTouchIdentifier)(J);this.touchIdentifier=K;const O=(0,d.getControlPosition)(J,K,this);if(O==null)return;const{x:Q,y:ee}=O,ie=(0,d.createCoreData)(this,Q,ee);(0,I.default)("DraggableCore: handleDragStart: %j",ie),(0,I.default)("calling",this.props.onStart),!(this.props.onStart(J,ie)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,u.addUserSelectStyles)(L),this.dragging=!0,this.lastX=Q,this.lastY=ee,(0,u.addEvent)(L,V.move,this.handleDrag),(0,u.addEvent)(L,V.stop,this.handleDragStop))}),G(this,"handleDrag",J=>{const z=(0,d.getControlPosition)(J,this.touchIdentifier,this);if(z==null)return;let{x:L,y:K}=z;if(Array.isArray(this.props.grid)){let ee=L-this.lastX,ie=K-this.lastY;if([ee,ie]=(0,d.snapToGrid)(this.props.grid,ee,ie),!ee&&!ie)return;L=this.lastX+ee,K=this.lastY+ie}const O=(0,d.createCoreData)(this,L,K);if((0,I.default)("DraggableCore: handleDrag: %j",O),this.props.onDrag(J,O)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const ie=document.createEvent("MouseEvents");ie.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(ie)}return}this.lastX=L,this.lastY=K}),G(this,"handleDragStop",J=>{if(!this.dragging)return;const z=(0,d.getControlPosition)(J,this.touchIdentifier,this);if(z==null)return;let{x:L,y:K}=z;if(Array.isArray(this.props.grid)){let ie=L-this.lastX||0,te=K-this.lastY||0;[ie,te]=(0,d.snapToGrid)(this.props.grid,ie,te),L=this.lastX+ie,K=this.lastY+te}const O=(0,d.createCoreData)(this,L,K);if(this.props.onStop(J,O)===!1||this.mounted===!1)return!1;const ee=this.findDOMNode();ee&&this.props.enableUserSelectHack&&(0,u.removeUserSelectStyles)(ee.ownerDocument),(0,I.default)("DraggableCore: handleDragStop: %j",O),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,ee&&((0,I.default)("DraggableCore: Removing handlers"),(0,u.removeEvent)(ee.ownerDocument,V.move,this.handleDrag),(0,u.removeEvent)(ee.ownerDocument,V.stop,this.handleDragStop))}),G(this,"onMouseDown",J=>(V=M.mouse,this.handleDragStart(J))),G(this,"onMouseUp",J=>(V=M.mouse,this.handleDragStop(J))),G(this,"onTouchStart",J=>(V=M.touch,this.handleDragStart(J))),G(this,"onTouchEnd",J=>(V=M.touch,this.handleDragStop(J)))}componentDidMount(){this.mounted=!0;const J=this.findDOMNode();J&&(0,u.addEvent)(J,M.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const J=this.findDOMNode();if(J){const{ownerDocument:z}=J;(0,u.removeEvent)(z,M.mouse.move,this.handleDrag),(0,u.removeEvent)(z,M.touch.move,this.handleDrag),(0,u.removeEvent)(z,M.mouse.stop,this.handleDragStop),(0,u.removeEvent)(z,M.touch.stop,this.handleDragStop),(0,u.removeEvent)(J,M.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,u.removeUserSelectStyles)(z)}}findDOMNode(){var J,z;return(J=this.props)!==null&&J!==void 0&&J.nodeRef?(z=this.props)===null||z===void 0||(z=z.nodeRef)===null||z===void 0?void 0:z.current:o.default.findDOMNode(this)}render(){return n.cloneElement(n.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};return DraggableCore.default=T,G(T,"displayName","DraggableCore"),G(T,"propTypes",{allowAnyClick:t.default.bool,children:t.default.node.isRequired,disabled:t.default.bool,enableUserSelectHack:t.default.bool,offsetParent:function(H,J){if(H[J]&&H[J].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:t.default.arrayOf(t.default.number),handle:t.default.string,cancel:t.default.string,nodeRef:t.default.object,onStart:t.default.func,onDrag:t.default.func,onStop:t.default.func,onMouseDown:t.default.func,scale:t.default.number,className:C.dontSetMe,style:C.dontSetMe,transform:C.dontSetMe}),G(T,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),DraggableCore}var hasRequiredDraggable;function requireDraggable(){return hasRequiredDraggable||(hasRequiredDraggable=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"DraggableCore",{enumerable:!0,get:function(){return A.default}}),n.default=void 0;var t=w(requireReact()),o=G(requirePropTypes()),u=G(requireReactDom()),d=G(require$$3),C=requireDomFns(),I=requirePositionFns(),f=requireShims(),A=G(requireDraggableCore()),y=G(requireLog());function G(z){return z&&z.__esModule?z:{default:z}}function S(z){if(typeof WeakMap!="function")return null;var L=new WeakMap,K=new WeakMap;return(S=function(O){return O?K:L})(z)}function w(z,L){if(z&&z.__esModule)return z;if(z===null||typeof z!="object"&&typeof z!="function")return{default:z};var K=S(L);if(K&&K.has(z))return K.get(z);var O={},Q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in z)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(z,ee)){var ie=Q?Object.getOwnPropertyDescriptor(z,ee):null;ie&&(ie.get||ie.set)?Object.defineProperty(O,ee,ie):O[ee]=z[ee]}return O.default=z,K&&K.set(z,O),O}function M(){return M=Object.assign?Object.assign.bind():function(z){for(var L=1;L<arguments.length;L++){var K=arguments[L];for(var O in K)Object.prototype.hasOwnProperty.call(K,O)&&(z[O]=K[O])}return z},M.apply(this,arguments)}function V(z,L,K){return L=T(L),L in z?Object.defineProperty(z,L,{value:K,enumerable:!0,configurable:!0,writable:!0}):z[L]=K,z}function T(z){var L=H(z,"string");return typeof L=="symbol"?L:String(L)}function H(z,L){if(typeof z!="object"||z===null)return z;var K=z[Symbol.toPrimitive];if(K!==void 0){var O=K.call(z,L);if(typeof O!="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(z)}class J extends t.Component{static getDerivedStateFromProps(L,K){let{position:O}=L,{prevPropsPosition:Q}=K;return O&&(!Q||O.x!==Q.x||O.y!==Q.y)?((0,y.default)("Draggable: getDerivedStateFromProps %j",{position:O,prevPropsPosition:Q}),{x:O.x,y:O.y,prevPropsPosition:{...O}}):null}constructor(L){super(L),V(this,"onDragStart",(K,O)=>{if((0,y.default)("Draggable: onDragStart: %j",O),this.props.onStart(K,(0,I.createDraggableData)(this,O))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),V(this,"onDrag",(K,O)=>{if(!this.state.dragging)return!1;(0,y.default)("Draggable: onDrag: %j",O);const Q=(0,I.createDraggableData)(this,O),ee={x:Q.x,y:Q.y,slackX:0,slackY:0};if(this.props.bounds){const{x:te,y:se}=ee;ee.x+=this.state.slackX,ee.y+=this.state.slackY;const[ae,le]=(0,I.getBoundPosition)(this,ee.x,ee.y);ee.x=ae,ee.y=le,ee.slackX=this.state.slackX+(te-ee.x),ee.slackY=this.state.slackY+(se-ee.y),Q.x=ee.x,Q.y=ee.y,Q.deltaX=ee.x-this.state.x,Q.deltaY=ee.y-this.state.y}if(this.props.onDrag(K,Q)===!1)return!1;this.setState(ee)}),V(this,"onDragStop",(K,O)=>{if(!this.state.dragging||this.props.onStop(K,(0,I.createDraggableData)(this,O))===!1)return!1;(0,y.default)("Draggable: onDragStop: %j",O);const ee={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:te,y:se}=this.props.position;ee.x=te,ee.y=se}this.setState(ee)}),this.state={dragging:!1,dragged:!1,x:L.position?L.position.x:L.defaultPosition.x,y:L.position?L.position.y:L.defaultPosition.y,prevPropsPosition:{...L.position},slackX:0,slackY:0,isElementSVG:!1},L.position&&!(L.onDrag||L.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var L,K;return(L=(K=this.props)===null||K===void 0||(K=K.nodeRef)===null||K===void 0?void 0:K.current)!==null&&L!==void 0?L:u.default.findDOMNode(this)}render(){const{axis:L,bounds:K,children:O,defaultPosition:Q,defaultClassName:ee,defaultClassNameDragging:ie,defaultClassNameDragged:te,position:se,positionOffset:ae,scale:le,...ge}=this.props;let be={},Xe=null;const Re=!!!se||this.state.dragging,Se=se||Q,Ze={x:(0,I.canDragX)(this)&&Re?this.state.x:Se.x,y:(0,I.canDragY)(this)&&Re?this.state.y:Se.y};this.state.isElementSVG?Xe=(0,C.createSVGTransform)(Ze,ae):be=(0,C.createCSSTransform)(Ze,ae);const he=(0,d.default)(O.props.className||"",ee,{[ie]:this.state.dragging,[te]:this.state.dragged});return t.createElement(A.default,M({},ge,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),t.cloneElement(t.Children.only(O),{className:he,style:{...O.props.style,...be},transform:Xe}))}}n.default=J,V(J,"displayName","Draggable"),V(J,"propTypes",{...A.default.propTypes,axis:o.default.oneOf(["both","x","y","none"]),bounds:o.default.oneOfType([o.default.shape({left:o.default.number,right:o.default.number,top:o.default.number,bottom:o.default.number}),o.default.string,o.default.oneOf([!1])]),defaultClassName:o.default.string,defaultClassNameDragging:o.default.string,defaultClassNameDragged:o.default.string,defaultPosition:o.default.shape({x:o.default.number,y:o.default.number}),positionOffset:o.default.shape({x:o.default.oneOfType([o.default.number,o.default.string]),y:o.default.oneOfType([o.default.number,o.default.string])}),position:o.default.shape({x:o.default.number,y:o.default.number}),className:f.dontSetMe,style:f.dontSetMe,transform:f.dontSetMe}),V(J,"defaultProps",{...A.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})}(Draggable$1)),Draggable$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs.exports;hasRequiredCjs=1;const{default:n,DraggableCore:t}=requireDraggable();return cjs.exports=n,cjs.exports.default=n,cjs.exports.DraggableCore=t,cjs.exports}var cjsExports=requireCjs();const Draggable=getDefaultExportFromCjs(cjsExports);var reactDomExports=requireReactDom(),__assign$2=function(){return __assign$2=Object.assign||function(n){for(var t,o=1,u=arguments.length;o<u;o++){t=arguments[o];for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&(n[d]=t[d])}return n},__assign$2.apply(this,arguments)},rowSizeBase={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},colSizeBase={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},edgeBase={width:"20px",height:"20px",position:"absolute",zIndex:1},styles={top:__assign$2(__assign$2({},rowSizeBase),{top:"-5px"}),right:__assign$2(__assign$2({},colSizeBase),{left:void 0,right:"-5px"}),bottom:__assign$2(__assign$2({},rowSizeBase),{top:void 0,bottom:"-5px"}),left:__assign$2(__assign$2({},colSizeBase),{left:"-5px"}),topRight:__assign$2(__assign$2({},edgeBase),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:__assign$2(__assign$2({},edgeBase),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:__assign$2(__assign$2({},edgeBase),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:__assign$2(__assign$2({},edgeBase),{left:"-10px",top:"-10px",cursor:"nw-resize"})},Resizer=reactExports.memo(function(n){var t=n.onResizeStart,o=n.direction,u=n.children,d=n.replaceStyles,C=n.className,I=reactExports.useCallback(function(y){t(y,o)},[t,o]),f=reactExports.useCallback(function(y){t(y,o)},[t,o]),A=reactExports.useMemo(function(){return __assign$2(__assign$2({position:"absolute",userSelect:"none"},styles[o]),d??{})},[d,o]);return jsxRuntimeExports.jsx("div",{className:C||void 0,style:A,onMouseDown:I,onTouchStart:f,children:u})}),__extends$1=function(){var n=function(t,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var C in d)Object.prototype.hasOwnProperty.call(d,C)&&(u[C]=d[C])},n(t,o)};return function(t,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(t,o);function u(){this.constructor=t}t.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),__assign$1=function(){return __assign$1=Object.assign||function(n){for(var t,o=1,u=arguments.length;o<u;o++){t=arguments[o];for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&(n[d]=t[d])}return n},__assign$1.apply(this,arguments)},DEFAULT_SIZE={width:"auto",height:"auto"},clamp=function(n,t,o){return Math.max(Math.min(n,o),t)},snap=function(n,t,o){var u=Math.round(n/t);return u*t+o*(u-1)},hasDirection=function(n,t){return new RegExp(n,"i").test(t)},isTouchEvent=function(n){return!!(n.touches&&n.touches.length)},isMouseEvent=function(n){return!!((n.clientX||n.clientX===0)&&(n.clientY||n.clientY===0))},findClosestSnap=function(n,t,o){o===void 0&&(o=0);var u=t.reduce(function(C,I,f){return Math.abs(I-n)<Math.abs(t[C]-n)?f:C},0),d=Math.abs(t[u]-n);return o===0||d<o?t[u]:n},getStringSize=function(n){return n=n.toString(),n==="auto"||n.endsWith("px")||n.endsWith("%")||n.endsWith("vh")||n.endsWith("vw")||n.endsWith("vmax")||n.endsWith("vmin")?n:"".concat(n,"px")},getPixelSize=function(n,t,o,u){if(n&&typeof n=="string"){if(n.endsWith("px"))return Number(n.replace("px",""));if(n.endsWith("%")){var d=Number(n.replace("%",""))/100;return t*d}if(n.endsWith("vw")){var d=Number(n.replace("vw",""))/100;return o*d}if(n.endsWith("vh")){var d=Number(n.replace("vh",""))/100;return u*d}}return n},calculateNewMax=function(n,t,o,u,d,C,I){return u=getPixelSize(u,n.width,t,o),d=getPixelSize(d,n.height,t,o),C=getPixelSize(C,n.width,t,o),I=getPixelSize(I,n.height,t,o),{maxWidth:typeof u>"u"?void 0:Number(u),maxHeight:typeof d>"u"?void 0:Number(d),minWidth:typeof C>"u"?void 0:Number(C),minHeight:typeof I>"u"?void 0:Number(I)}},normalizeToPair=function(n){return Array.isArray(n)?n:[n,n]},definedProps=["as","ref","style","className","grid","gridGap","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],baseClassName="__resizable_base__",Resizable=function(n){__extends$1(t,n);function t(o){var u,d,C,I,f=n.call(this,o)||this;return f.ratio=1,f.resizable=null,f.parentLeft=0,f.parentTop=0,f.resizableLeft=0,f.resizableRight=0,f.resizableTop=0,f.resizableBottom=0,f.targetLeft=0,f.targetTop=0,f.delta={width:0,height:0},f.appendBase=function(){if(!f.resizable||!f.window)return null;var A=f.parentNode;if(!A)return null;var y=f.window.document.createElement("div");return y.style.width="100%",y.style.height="100%",y.style.position="absolute",y.style.transform="scale(0, 0)",y.style.left="0",y.style.flex="0 0 100%",y.classList?y.classList.add(baseClassName):y.className+=baseClassName,A.appendChild(y),y},f.removeBase=function(A){var y=f.parentNode;y&&y.removeChild(A)},f.state={isResizing:!1,width:(d=(u=f.propsSize)===null||u===void 0?void 0:u.width)!==null&&d!==void 0?d:"auto",height:(I=(C=f.propsSize)===null||C===void 0?void 0:C.height)!==null&&I!==void 0?I:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},f.onResizeStart=f.onResizeStart.bind(f),f.onMouseMove=f.onMouseMove.bind(f),f.onMouseUp=f.onMouseUp.bind(f),f}return Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||DEFAULT_SIZE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var o=0,u=0;if(this.resizable&&this.window){var d=this.resizable.offsetWidth,C=this.resizable.offsetHeight,I=this.resizable.style.position;I!=="relative"&&(this.resizable.style.position="relative"),o=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:d,u=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:C,this.resizable.style.position=I}return{width:o,height:u}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStyle",{get:function(){var o=this,u=this.props.size,d=function(f){var A;if(typeof o.state[f]>"u"||o.state[f]==="auto")return"auto";if(o.propsSize&&o.propsSize[f]&&(!((A=o.propsSize[f])===null||A===void 0)&&A.toString().endsWith("%"))){if(o.state[f].toString().endsWith("%"))return o.state[f].toString();var y=o.getParentSize(),G=Number(o.state[f].toString().replace("px","")),S=G/y[f]*100;return"".concat(S,"%")}return getStringSize(o.state[f])},C=u&&typeof u.width<"u"&&!this.state.isResizing?getStringSize(u.width):d("width"),I=u&&typeof u.height<"u"&&!this.state.isResizing?getStringSize(u.height):d("height");return{width:C,height:I}},enumerable:!1,configurable:!0}),t.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var o=this.appendBase();if(!o)return{width:0,height:0};var u=!1,d=this.parentNode.style.flexWrap;d!=="wrap"&&(u=!0,this.parentNode.style.flexWrap="wrap"),o.style.position="relative",o.style.minWidth="100%",o.style.minHeight="100%";var C={width:o.offsetWidth,height:o.offsetHeight};return u&&(this.parentNode.style.flexWrap=d),this.removeBase(o),C},t.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},t.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},t.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var o=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:o.flexBasis!=="auto"?o.flexBasis:void 0})}},t.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},t.prototype.createSizeForCssProperty=function(o,u){var d=this.propsSize&&this.propsSize[u];return this.state[u]==="auto"&&this.state.original[u]===o&&(typeof d>"u"||d==="auto")?"auto":o},t.prototype.calculateNewMaxFromBoundary=function(o,u){var d=this.props.boundsByDirection,C=this.state.direction,I=d&&hasDirection("left",C),f=d&&hasDirection("top",C),A,y;if(this.props.bounds==="parent"){var G=this.parentNode;G&&(A=I?this.resizableRight-this.parentLeft:G.offsetWidth+(this.parentLeft-this.resizableLeft),y=f?this.resizableBottom-this.parentTop:G.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(A=I?this.resizableRight:this.window.innerWidth-this.resizableLeft,y=f?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(A=I?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),y=f?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return A&&Number.isFinite(A)&&(o=o&&o<A?o:A),y&&Number.isFinite(y)&&(u=u&&u<y?u:y),{maxWidth:o,maxHeight:u}},t.prototype.calculateNewSizeFromDirection=function(o,u){var d=this.props.scale||1,C=normalizeToPair(this.props.resizeRatio||1),I=C[0],f=C[1],A=this.state,y=A.direction,G=A.original,S=this.props,w=S.lockAspectRatio,M=S.lockAspectRatioExtraHeight,V=S.lockAspectRatioExtraWidth,T=G.width,H=G.height,J=M||0,z=V||0;return hasDirection("right",y)&&(T=G.width+(o-G.x)*I/d,w&&(H=(T-z)/this.ratio+J)),hasDirection("left",y)&&(T=G.width-(o-G.x)*I/d,w&&(H=(T-z)/this.ratio+J)),hasDirection("bottom",y)&&(H=G.height+(u-G.y)*f/d,w&&(T=(H-J)*this.ratio+z)),hasDirection("top",y)&&(H=G.height-(u-G.y)*f/d,w&&(T=(H-J)*this.ratio+z)),{newWidth:T,newHeight:H}},t.prototype.calculateNewSizeFromAspectRatio=function(o,u,d,C){var I=this.props,f=I.lockAspectRatio,A=I.lockAspectRatioExtraHeight,y=I.lockAspectRatioExtraWidth,G=typeof C.width>"u"?10:C.width,S=typeof d.width>"u"||d.width<0?o:d.width,w=typeof C.height>"u"?10:C.height,M=typeof d.height>"u"||d.height<0?u:d.height,V=A||0,T=y||0;if(f){var H=(w-V)*this.ratio+T,J=(M-V)*this.ratio+T,z=(G-T)/this.ratio+V,L=(S-T)/this.ratio+V,K=Math.max(G,H),O=Math.min(S,J),Q=Math.max(w,z),ee=Math.min(M,L);o=clamp(o,K,O),u=clamp(u,Q,ee)}else o=clamp(o,G,S),u=clamp(u,w,M);return{newWidth:o,newHeight:u}},t.prototype.setBoundingClientRect=function(){var o=1/(this.props.scale||1);if(this.props.bounds==="parent"){var u=this.parentNode;if(u){var d=u.getBoundingClientRect();this.parentLeft=d.left*o,this.parentTop=d.top*o}}if(this.props.bounds&&typeof this.props.bounds!="string"){var C=this.props.bounds.getBoundingClientRect();this.targetLeft=C.left*o,this.targetTop=C.top*o}if(this.resizable){var I=this.resizable.getBoundingClientRect(),f=I.left,A=I.top,y=I.right,G=I.bottom;this.resizableLeft=f*o,this.resizableRight=y*o,this.resizableTop=A*o,this.resizableBottom=G*o}},t.prototype.onResizeStart=function(o,u){if(!(!this.resizable||!this.window)){var d=0,C=0;if(o.nativeEvent&&isMouseEvent(o.nativeEvent)?(d=o.nativeEvent.clientX,C=o.nativeEvent.clientY):o.nativeEvent&&isTouchEvent(o.nativeEvent)&&(d=o.nativeEvent.touches[0].clientX,C=o.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var I=this.props.onResizeStart(o,u,this.resizable);if(I===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var f,A=this.window.getComputedStyle(this.resizable);if(A.flexBasis!=="auto"){var y=this.parentNode;if(y){var G=this.window.getComputedStyle(y).flexDirection;this.flexDir=G.startsWith("row")?"row":"column",f=A.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var S={original:{x:d,y:C,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:__assign$1(__assign$1({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(o.target).cursor||"auto"}),direction:u,flexBasis:f};this.setState(S)}},t.prototype.onMouseMove=function(o){var u=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&isTouchEvent(o))try{o.preventDefault(),o.stopPropagation()}catch{}var d=this.props,C=d.maxWidth,I=d.maxHeight,f=d.minWidth,A=d.minHeight,y=isTouchEvent(o)?o.touches[0].clientX:o.clientX,G=isTouchEvent(o)?o.touches[0].clientY:o.clientY,S=this.state,w=S.direction,M=S.original,V=S.width,T=S.height,H=this.getParentSize(),J=calculateNewMax(H,this.window.innerWidth,this.window.innerHeight,C,I,f,A);C=J.maxWidth,I=J.maxHeight,f=J.minWidth,A=J.minHeight;var z=this.calculateNewSizeFromDirection(y,G),L=z.newHeight,K=z.newWidth,O=this.calculateNewMaxFromBoundary(C,I);this.props.snap&&this.props.snap.x&&(K=findClosestSnap(K,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(L=findClosestSnap(L,this.props.snap.y,this.props.snapGap));var Q=this.calculateNewSizeFromAspectRatio(K,L,{width:O.maxWidth,height:O.maxHeight},{width:f,height:A});if(K=Q.newWidth,L=Q.newHeight,this.props.grid){var ee=snap(K,this.props.grid[0],this.props.gridGap?this.props.gridGap[0]:0),ie=snap(L,this.props.grid[1],this.props.gridGap?this.props.gridGap[1]:0),te=this.props.snapGap||0,se=te===0||Math.abs(ee-K)<=te?ee:K,ae=te===0||Math.abs(ie-L)<=te?ie:L;K=se,L=ae}var le={width:K-M.width,height:L-M.height};if(this.delta=le,V&&typeof V=="string"){if(V.endsWith("%")){var ge=K/H.width*100;K="".concat(ge,"%")}else if(V.endsWith("vw")){var be=K/this.window.innerWidth*100;K="".concat(be,"vw")}else if(V.endsWith("vh")){var Xe=K/this.window.innerHeight*100;K="".concat(Xe,"vh")}}if(T&&typeof T=="string"){if(T.endsWith("%")){var ge=L/H.height*100;L="".concat(ge,"%")}else if(T.endsWith("vw")){var be=L/this.window.innerWidth*100;L="".concat(be,"vw")}else if(T.endsWith("vh")){var Xe=L/this.window.innerHeight*100;L="".concat(Xe,"vh")}}var Ce={width:this.createSizeForCssProperty(K,"width"),height:this.createSizeForCssProperty(L,"height")};this.flexDir==="row"?Ce.flexBasis=Ce.width:this.flexDir==="column"&&(Ce.flexBasis=Ce.height);var Re=this.state.width!==Ce.width,Se=this.state.height!==Ce.height,Ze=this.state.flexBasis!==Ce.flexBasis,he=Re||Se||Ze;he&&reactDomExports.flushSync(function(){u.setState(Ce)}),this.props.onResize&&he&&this.props.onResize(o,w,this.resizable,le)}},t.prototype.onMouseUp=function(o){var u,d,C=this.state,I=C.isResizing,f=C.direction;C.original,!(!I||!this.resizable)&&(this.props.onResizeStop&&this.props.onResizeStop(o,f,this.resizable,this.delta),this.props.size&&this.setState({width:(u=this.props.size.width)!==null&&u!==void 0?u:"auto",height:(d=this.props.size.height)!==null&&d!==void 0?d:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:__assign$1(__assign$1({},this.state.backgroundStyle),{cursor:"auto"})}))},t.prototype.updateSize=function(o){var u,d;this.setState({width:(u=o.width)!==null&&u!==void 0?u:"auto",height:(d=o.height)!==null&&d!==void 0?d:"auto"})},t.prototype.renderResizer=function(){var o=this,u=this.props,d=u.enable,C=u.handleStyles,I=u.handleClasses,f=u.handleWrapperStyle,A=u.handleWrapperClass,y=u.handleComponent;if(!d)return null;var G=Object.keys(d).map(function(S){return d[S]!==!1?jsxRuntimeExports.jsx(Resizer,{direction:S,onResizeStart:o.onResizeStart,replaceStyles:C&&C[S],className:I&&I[S],children:y&&y[S]?y[S]:null},S):null});return jsxRuntimeExports.jsx("div",{className:A,style:f,children:G})},t.prototype.render=function(){var o=this,u=Object.keys(this.props).reduce(function(I,f){return definedProps.indexOf(f)!==-1||(I[f]=o.props[f]),I},{}),d=__assign$1(__assign$1(__assign$1({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(d.flexBasis=this.state.flexBasis);var C=this.props.as||"div";return jsxRuntimeExports.jsxs(C,__assign$1({style:d,className:this.props.className},u,{ref:function(I){I&&(o.resizable=I)},children:[this.state.isResizing&&jsxRuntimeExports.jsx("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer()]}))},t.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],gridGap:[0,0],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},t}(reactExports.PureComponent);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var extendStatics=function(n,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var d in u)u.hasOwnProperty(d)&&(o[d]=u[d])},extendStatics(n,t)};function __extends(n,t){extendStatics(n,t);function o(){this.constructor=n}n.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}var __assign=function(){return __assign=Object.assign||function(t){for(var o,u=1,d=arguments.length;u<d;u++){o=arguments[u];for(var C in o)Object.prototype.hasOwnProperty.call(o,C)&&(t[C]=o[C])}return t},__assign.apply(this,arguments)};function __rest(n,t){var o={};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&t.indexOf(u)<0&&(o[u]=n[u]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,u=Object.getOwnPropertySymbols(n);d<u.length;d++)t.indexOf(u[d])<0&&Object.prototype.propertyIsEnumerable.call(n,u[d])&&(o[u[d]]=n[u[d]]);return o}var resizableStyle={width:"auto",height:"auto",display:"inline-block",position:"absolute",top:0,left:0},getEnableResizingByFlag=function(n){return{bottom:n,bottomLeft:n,bottomRight:n,left:n,right:n,top:n,topLeft:n,topRight:n}},Rnd=function(n){__extends(t,n);function t(o){var u=n.call(this,o)||this;return u.resizingPosition={x:0,y:0},u.offsetFromParent={left:0,top:0},u.resizableElement={current:null},u.originalPosition={x:0,y:0},u.state={resizing:!1,bounds:{top:0,right:0,bottom:0,left:0},maxWidth:o.maxWidth,maxHeight:o.maxHeight},u.onResizeStart=u.onResizeStart.bind(u),u.onResize=u.onResize.bind(u),u.onResizeStop=u.onResizeStop.bind(u),u.onDragStart=u.onDragStart.bind(u),u.onDrag=u.onDrag.bind(u),u.onDragStop=u.onDragStop.bind(u),u.getMaxSizesFromProps=u.getMaxSizesFromProps.bind(u),u}return t.prototype.componentDidMount=function(){this.updateOffsetFromParent();var o=this.offsetFromParent,u=o.left,d=o.top,C=this.getDraggablePosition(),I=C.x,f=C.y;this.draggable.setState({x:I-u,y:f-d}),this.forceUpdate()},t.prototype.getDraggablePosition=function(){var o=this.draggable.state,u=o.x,d=o.y;return{x:u,y:d}},t.prototype.getParent=function(){return this.resizable&&this.resizable.parentNode},t.prototype.getParentSize=function(){return this.resizable.getParentSize()},t.prototype.getMaxSizesFromProps=function(){var o=typeof this.props.maxWidth>"u"?Number.MAX_SAFE_INTEGER:this.props.maxWidth,u=typeof this.props.maxHeight>"u"?Number.MAX_SAFE_INTEGER:this.props.maxHeight;return{maxWidth:o,maxHeight:u}},t.prototype.getSelfElement=function(){return this.resizable&&this.resizable.resizable},t.prototype.getOffsetHeight=function(o){var u=this.props.scale;switch(this.props.bounds){case"window":return window.innerHeight/u;case"body":return document.body.offsetHeight/u;default:return o.offsetHeight}},t.prototype.getOffsetWidth=function(o){var u=this.props.scale;switch(this.props.bounds){case"window":return window.innerWidth/u;case"body":return document.body.offsetWidth/u;default:return o.offsetWidth}},t.prototype.onDragStart=function(o,u){this.props.onDragStart&&this.props.onDragStart(o,u);var d=this.getDraggablePosition();if(this.originalPosition=d,!!this.props.bounds){var C=this.getParent(),I=this.props.scale,f;if(this.props.bounds==="parent")f=C;else if(this.props.bounds==="body"){var A=C.getBoundingClientRect(),y=A.left,G=A.top,S=document.body.getBoundingClientRect(),w=-(y-C.offsetLeft*I-S.left)/I,M=-(G-C.offsetTop*I-S.top)/I,V=(document.body.offsetWidth-this.resizable.size.width*I)/I+w,T=(document.body.offsetHeight-this.resizable.size.height*I)/I+M;return this.setState({bounds:{top:M,right:V,bottom:T,left:w}})}else if(this.props.bounds==="window"){if(!this.resizable)return;var H=C.getBoundingClientRect(),J=H.left,z=H.top,L=-(J-C.offsetLeft*I)/I,K=-(z-C.offsetTop*I)/I,V=(window.innerWidth-this.resizable.size.width*I)/I+L,T=(window.innerHeight-this.resizable.size.height*I)/I+K;return this.setState({bounds:{top:K,right:V,bottom:T,left:L}})}else typeof this.props.bounds=="string"?f=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(f=this.props.bounds);if(!(!(f instanceof HTMLElement)||!(C instanceof HTMLElement))){var O=f.getBoundingClientRect(),Q=O.left,ee=O.top,ie=C.getBoundingClientRect(),te=ie.left,se=ie.top,ae=(Q-te)/I,le=ee-se;if(this.resizable){this.updateOffsetFromParent();var ge=this.offsetFromParent;this.setState({bounds:{top:le-ge.top,right:ae+(f.offsetWidth-this.resizable.size.width)-ge.left/I,bottom:le+(f.offsetHeight-this.resizable.size.height)-ge.top,left:ae-ge.left/I}})}}}},t.prototype.onDrag=function(o,u){if(this.props.onDrag){var d=this.offsetFromParent,C=d.left,I=d.top;if(!this.props.dragAxis||this.props.dragAxis==="both")return this.props.onDrag(o,__assign(__assign({},u),{x:u.x+C,y:u.y+I}));if(this.props.dragAxis==="x")return this.props.onDrag(o,__assign(__assign({},u),{x:u.x+C,y:this.originalPosition.y+I,deltaY:0}));if(this.props.dragAxis==="y")return this.props.onDrag(o,__assign(__assign({},u),{x:this.originalPosition.x+C,y:u.y+I,deltaX:0}))}},t.prototype.onDragStop=function(o,u){if(this.props.onDragStop){var d=this.offsetFromParent,C=d.left,I=d.top;if(!this.props.dragAxis||this.props.dragAxis==="both")return this.props.onDragStop(o,__assign(__assign({},u),{x:u.x+C,y:u.y+I}));if(this.props.dragAxis==="x")return this.props.onDragStop(o,__assign(__assign({},u),{x:u.x+C,y:this.originalPosition.y+I,deltaY:0}));if(this.props.dragAxis==="y")return this.props.onDragStop(o,__assign(__assign({},u),{x:this.originalPosition.x+C,y:u.y+I,deltaX:0}))}},t.prototype.onResizeStart=function(o,u,d){o.stopPropagation(),this.setState({resizing:!0});var C=this.props.scale,I=this.offsetFromParent,f=this.getDraggablePosition();if(this.resizingPosition={x:f.x+I.left,y:f.y+I.top},this.originalPosition=f,this.props.bounds){var A=this.getParent(),y=void 0;this.props.bounds==="parent"?y=A:this.props.bounds==="body"?y=document.body:this.props.bounds==="window"?y=window:typeof this.props.bounds=="string"?y=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(y=this.props.bounds);var G=this.getSelfElement();if(G instanceof Element&&(y instanceof HTMLElement||y===window)&&A instanceof HTMLElement){var S=this.getMaxSizesFromProps(),w=S.maxWidth,M=S.maxHeight,V=this.getParentSize();if(w&&typeof w=="string")if(w.endsWith("%")){var T=Number(w.replace("%",""))/100;w=V.width*T}else w.endsWith("px")&&(w=Number(w.replace("px","")));if(M&&typeof M=="string")if(M.endsWith("%")){var T=Number(M.replace("%",""))/100;M=V.height*T}else M.endsWith("px")&&(M=Number(M.replace("px","")));var H=G.getBoundingClientRect(),J=H.left,z=H.top,L=this.props.bounds==="window"?{left:0,top:0}:y.getBoundingClientRect(),K=L.left,O=L.top,Q=this.getOffsetWidth(y),ee=this.getOffsetHeight(y),ie=u.toLowerCase().endsWith("left"),te=u.toLowerCase().endsWith("right"),se=u.startsWith("top"),ae=u.startsWith("bottom");if((ie||se)&&this.resizable){var le=(J-K)/C+this.resizable.size.width;this.setState({maxWidth:le>Number(w)?w:le})}if(te||this.props.lockAspectRatio&&!ie&&!se){var le=Q+(K-J)/C;this.setState({maxWidth:le>Number(w)?w:le})}if((se||ie)&&this.resizable){var le=(z-O)/C+this.resizable.size.height;this.setState({maxHeight:le>Number(M)?M:le})}if(ae||this.props.lockAspectRatio&&!se&&!ie){var le=ee+(O-z)/C;this.setState({maxHeight:le>Number(M)?M:le})}}}else this.setState({maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight});this.props.onResizeStart&&this.props.onResizeStart(o,u,d)},t.prototype.onResize=function(o,u,d,C){var I=this,f={x:this.originalPosition.x,y:this.originalPosition.y},A=-C.width,y=-C.height,G=["top","left","topLeft","bottomLeft","topRight"];G.includes(u)&&(u==="bottomLeft"?f.x+=A:(u==="topRight"||(f.x+=A),f.y+=y));var S=this.draggable.state;(f.x!==S.x||f.y!==S.y)&&reactDomExports.flushSync(function(){I.draggable.setState(f)}),this.updateOffsetFromParent();var w=this.offsetFromParent,M=this.getDraggablePosition().x+w.left,V=this.getDraggablePosition().y+w.top;this.resizingPosition={x:M,y:V},this.props.onResize&&this.props.onResize(o,u,d,C,{x:M,y:V})},t.prototype.onResizeStop=function(o,u,d,C){this.setState({resizing:!1});var I=this.getMaxSizesFromProps(),f=I.maxWidth,A=I.maxHeight;this.setState({maxWidth:f,maxHeight:A}),this.props.onResizeStop&&this.props.onResizeStop(o,u,d,C,this.resizingPosition)},t.prototype.updateSize=function(o){this.resizable&&this.resizable.updateSize({width:o.width,height:o.height})},t.prototype.updatePosition=function(o){this.draggable.setState(o)},t.prototype.updateOffsetFromParent=function(){var o=this.props.scale,u=this.getParent(),d=this.getSelfElement();if(!u||d===null)return{top:0,left:0};var C=u.getBoundingClientRect(),I=C.left,f=C.top,A=d.getBoundingClientRect(),y=this.getDraggablePosition(),G=u.scrollLeft,S=u.scrollTop;this.offsetFromParent={left:A.left-I+G-y.x*o,top:A.top-f+S-y.y*o}},t.prototype.render=function(){var o=this,u=this.props,d=u.disableDragging,C=u.style,I=u.dragHandleClassName,f=u.position,A=u.onMouseDown,y=u.onMouseUp,G=u.dragAxis,S=u.dragGrid,w=u.bounds,M=u.enableUserSelectHack,V=u.cancel,T=u.children;u.onResizeStart,u.onResize,u.onResizeStop,u.onDragStart,u.onDrag,u.onDragStop;var H=u.resizeHandleStyles,J=u.resizeHandleClasses,z=u.resizeHandleComponent,L=u.enableResizing,K=u.resizeGrid,O=u.resizeHandleWrapperClass,Q=u.resizeHandleWrapperStyle,ee=u.scale,ie=u.allowAnyClick,te=u.dragPositionOffset,se=__rest(u,["disableDragging","style","dragHandleClassName","position","onMouseDown","onMouseUp","dragAxis","dragGrid","bounds","enableUserSelectHack","cancel","children","onResizeStart","onResize","onResizeStop","onDragStart","onDrag","onDragStop","resizeHandleStyles","resizeHandleClasses","resizeHandleComponent","enableResizing","resizeGrid","resizeHandleWrapperClass","resizeHandleWrapperStyle","scale","allowAnyClick","dragPositionOffset"]),ae=this.props.default?__assign({},this.props.default):void 0;delete se.default;var le=d||I?{cursor:"auto"}:{cursor:"move"},ge=__assign(__assign(__assign({},resizableStyle),le),C),be=this.offsetFromParent,Xe=be.left,Ce=be.top,Re;f&&(Re={x:f.x-Xe,y:f.y-Ce});var Se=this.state.resizing?void 0:Re,Ze=this.state.resizing?"both":G;return reactExports.createElement(Draggable,{ref:function(he){he&&(o.draggable=he)},handle:I?".".concat(I):void 0,defaultPosition:ae,onMouseDown:A,onMouseUp:y,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,axis:Ze,disabled:d,grid:S,bounds:w?this.state.bounds:void 0,position:Se,enableUserSelectHack:M,cancel:V,scale:ee,allowAnyClick:ie,nodeRef:this.resizableElement,positionOffset:te},reactExports.createElement(Resizable,__assign({},se,{ref:function(he){he&&(o.resizable=he,o.resizableElement.current=he.resizable)},defaultSize:ae,size:this.props.size,enable:typeof L=="boolean"?getEnableResizingByFlag(L):L,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,style:ge,minWidth:this.props.minWidth,minHeight:this.props.minHeight,maxWidth:this.state.resizing?this.state.maxWidth:this.props.maxWidth,maxHeight:this.state.resizing?this.state.maxHeight:this.props.maxHeight,grid:K,handleWrapperClass:O,handleWrapperStyle:Q,lockAspectRatio:this.props.lockAspectRatio,lockAspectRatioExtraWidth:this.props.lockAspectRatioExtraWidth,lockAspectRatioExtraHeight:this.props.lockAspectRatioExtraHeight,handleStyles:H,handleClasses:J,handleComponent:z,scale:this.props.scale}),T))},t.defaultProps={maxWidth:Number.MAX_SAFE_INTEGER,maxHeight:Number.MAX_SAFE_INTEGER,scale:1,onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},onDragStart:function(){},onDrag:function(){},onDragStop:function(){}},t}(reactExports.PureComponent);const defaultOverlaySize={width:150,height:150},defaultOverlayPosition={x:10,y:50};function OverlayGraph({id:n,initialType:t="yvx",data:o,onClose:u}){const d=reactExports.useRef(null),C=reactExports.useRef(null),[I,f]=reactExports.useState(t),[A,y]=reactExports.useState(!0),G=reactExports.useRef(null);return reactExports.useEffect(()=>{if(!d.current)return;const S=`jsxg-overlay-${n}-${Math.random().toString(36).slice(2)}`;d.current.id=S,console.log(`Initializing OVERLAY JSXGraph board with ID: ${S}`);const w=JXG$1.JSXGraph.initBoard(S,{boundingbox:[-5,5,5,-5],grid:!1,showCopyright:!1,pan:{enabled:!0,needShift:!1},zoom:{enabled:!0,wheel:!0,needShift:!1},keepaspectratio:!1,backgroundColor:"rgba(255, 255, 255, 0.9)"});return C.current=w,()=>{C.current&&(console.log(`Freeing OVERLAY JSXGraph board with ID: ${C.current.container}`),JXG$1.JSXGraph.freeBoard(C.current),C.current=null)}},[n]),reactExports.useEffect(()=>{const S=C.current;if(!S||!o)return;S.suspendUpdate(),S.objectsList.filter(J=>J.elType==="curve"||J.elType==="point").forEach(J=>{S.objects[J.id]&&S.removeObject(J)});const M=I==="xvt"?"t":"x",V=I==="yvt"?"y":I==="xvt"?"x":"y";let T=[],H=[];if(Object.values(o||{}).forEach((J,z)=>{if(!J||J.length===0)return;const L=J.map(O=>O[M]),K=J.map(O=>O[V]);if(L.length>0&&K.length>0){S.create("curve",[L,K],{strokeColor:["#1f77b4","#ff7f0e"][z%2],strokeWidth:2});const O=L[L.length-1],Q=K[K.length-1];typeof O=="number"&&typeof Q=="number"&&isFinite(O)&&isFinite(Q)&&S.create("point",[O,Q],{size:3,color:["#1f77b4","#ff7f0e"][z%2],fixed:!0,name:""}),T.push(...L.filter(Number.isFinite)),H.push(...K.filter(Number.isFinite))}}),A&&T.length>0&&H.length>0){const J=Math.min(...T),z=Math.max(...T),L=Math.min(...H),K=Math.max(...H),O=z-J,Q=K-L,ee=Math.max(O*.1,.5),ie=Math.max(Q*.1,.5);let te=J-ee,se=z+ee,ae=L-ie,le=K+ie;const ge=1;if(se-te<ge){const be=(te+se)/2;te=be-ge/2,se=be+ge/2}if(le-ae<ge){const be=(ae+le)/2;ae=be-ge/2,le=be+ge/2}S.setBoundingBox([te,le,se,ae],!1)}else!A&&S.objectsList.length===0&&S.setBoundingBox([-5,5,5,-5],!1);S.unsuspendUpdate()},[o,I,A]),reactExports.useEffect(()=>{const S=d.current;if(!S)return;const w=()=>{if(!C.current||!S)return;const V=S.clientWidth,T=S.clientHeight;V>0&&T>0&&(C.current.resizeContainer(V,T,!0),C.current.update())},M=new ResizeObserver(w);return M.observe(S),w(),()=>{S&&M.unobserve(S),M.disconnect()}},[n]),jsxRuntimeExports.jsx(Rnd,{ref:G,className:"overlay-graph-rnd",style:{zIndex:100},default:{x:defaultOverlayPosition.x,y:defaultOverlayPosition.y,width:defaultOverlaySize.width,height:defaultOverlaySize.height},minWidth:200,minHeight:180,bounds:"parent",onResizeStop:(S,w,M,V,T)=>{},children:jsxRuntimeExports.jsxs("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:"rgba(0, 0, 0, 0.3)"},children:[jsxRuntimeExports.jsx("button",{className:"overlay-graph-close-button",onClick:()=>u(n),"aria-label":"Close Graph",children:"X "}),jsxRuntimeExports.jsx("div",{ref:d,style:{flex:1,width:"100%",minHeight:0,position:"relative",backgroundColor:"transparent"}}),jsxRuntimeExports.jsxs("div",{style:{padding:"0px 2px",color:"white",fontSize:"10px",flexShrink:0},children:[jsxRuntimeExports.jsxs("label",{style:{marginRight:"4px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"yvx",checked:I==="yvx",onChange:S=>f(S.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," Y vs X"]}),jsxRuntimeExports.jsxs("label",{style:{marginRight:"6px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"xvt",checked:I==="xvt",onChange:S=>f(S.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," X vs T"]}),jsxRuntimeExports.jsxs("label",{style:{marginRight:"8px",cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"yvt",checked:I==="yvt",onChange:S=>f(S.target.value),style:{marginRight:"3px",verticalAlign:"middle"}})," Y vs T"]}),jsxRuntimeExports.jsxs("label",{style:{cursor:"pointer"},children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:A,onChange:()=>y(!A),style:{marginRight:"3px",verticalAlign:"middle"}})," Auto-Fit"]})]})]})})}function Conversation({updateConversation:n,conversationHistory:t=[],initialMessage:o="Hello! How can I help you with physics today?"}){const[u,d]=reactExports.useState(""),[C,I]=reactExports.useState(!1),[f,A]=reactExports.useState("gemini"),y="AIzaSyBcFtkw2fZWMPQKhvUuCrpu1Qc_4Qq3dIQ",G=reactExports.useRef(!1);reactExports.useEffect(()=>{G.current||(n([{role:"ai",content:o}]),G.current=!0)},[o,n]);const S=async M=>{var H,J,z,L,K;M.preventDefault();const V=u.trim();if(!V){alert("Please enter a question.");return}n(O=>[...O,{role:"user",content:V}]),d(""),I(!0);let T="I couldn't process that.";try{if(f==="chatgpt"){console.log("🔁 Trying ChatGPT via Puppeteer...");const O=await fetch("http://localhost:3000/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:V})});if(!O.ok){const ee=await O.text();throw console.error("ChatGPT Error:",ee),new Error(`HTTP error! Status: ${O.status}`)}T=(await O.json()).response||T}else if(f==="ollama"){const O=["gemma3","gemma3:1b"];let Q=!1;for(const ee of O)try{console.log(`🔁 Trying Ollama model: ${ee}`);const ie=await fetch("http://localhost:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ee,prompt:V,stream:!1})});if(!ie.ok){const se=await ie.text();throw console.error("Ollama Error:",se),new Error(`Ollama HTTP error! Status: ${ie.status}`)}const te=await ie.json();console.log("Ollama Response:",JSON.stringify(te,null,2)),T=te.response||T,Q=!0;break}catch(ie){console.warn(`❌ Failed with Ollama ${ee}: ${ie.message}`)}if(!Q)throw new Error("All Ollama models failed.")}else if(f==="gemini"&&y){console.log("🔁 Trying Gemini API...");const O=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:V}]}]})});if(!O.ok){const ee=await O.text();throw console.error("Gemini API Error:",ee),new Error(`Gemini HTTP error! Status: ${O.status}`)}const Q=await O.json();console.log("Gemini API Response:",JSON.stringify(Q,null,2)),T=((K=(L=(z=(J=(H=Q.candidates)==null?void 0:H[0])==null?void 0:J.content)==null?void 0:z.parts)==null?void 0:L[0])==null?void 0:K.text)||T}n(O=>[...O,{role:"ai",content:T}])}catch(O){console.error(`❌ Model failed: ${O.message}`),n(Q=>[...Q,{role:"ai",content:"Error: Model failed. Ensure setup is correct."}])}finally{I(!1)}},w=t.slice(-10).map((M,V)=>jsxRuntimeExports.jsx("div",{className:M.role==="ai"?"ai-message":"user-message",children:jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:M.role==="ai"?"AI:":"You:"})," ",M.content]})},V));return jsxRuntimeExports.jsxs("div",{className:"conversation-container",children:[jsxRuntimeExports.jsxs("div",{className:"model-selector",children:[jsxRuntimeExports.jsx("label",{htmlFor:"model-select",children:"Select Model: "}),jsxRuntimeExports.jsxs("select",{id:"model-select",value:f,onChange:M=>A(M.target.value),disabled:C,children:[jsxRuntimeExports.jsx("option",{value:"gemini",children:"Gemini (Google AI Studio)"}),jsxRuntimeExports.jsx("option",{value:"chatgpt",children:"ChatGPT (Puppeteer)"}),jsxRuntimeExports.jsx("option",{value:"ollama",children:"Ollama"})]})]}),jsxRuntimeExports.jsx("div",{className:"conversation-box",children:w}),jsxRuntimeExports.jsxs("form",{className:"input-section",onSubmit:S,children:[jsxRuntimeExports.jsx("textarea",{className:"input-textarea",value:u,onChange:M=>d(M.target.value),placeholder:"Enter your physics question...",disabled:C}),jsxRuntimeExports.jsx("button",{type:"submit",className:"process-button",disabled:C||!u.trim(),children:C?"Processing...":"Process"})]})]})}const mechanicsExamples=[{id:"all-shapes-scene",name:"All Shapes Scene",description:"A scene with all supported physics shapes interacting dynamically.",objects:[{id:"sphere-1",type:"Sphere",mass:1,radius:.5,position:[0,4,0],velocity:[0,0,0],color:"#ff6347",restitution:.7,friction:.4},{id:"box-1",type:"Box",mass:1.5,dimensions:[1,1,1],position:[2,4,0],velocity:[0,0,0],color:"#32cd32",restitution:.8,friction:.5},{id:"cylinder-1",type:"Cylinder",mass:2,radius:.5,height:1.5,position:[-2,4,0],velocity:[0,0,0],color:"#4682b4",restitution:.6,friction:.3},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"projectile-motion",name:"Projectile Motion",description:"A sphere launched to show parabolic trajectory under gravity.",objects:[{id:"projectile-sphere",type:"Sphere",mass:1,radius:.3,position:[-5,1,0],velocity:[6,4,0],color:"#ff4500",restitution:.9,friction:.4},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"collision-demo",name:"Elastic Collision",description:"Two spheres colliding to demonstrate momentum conservation.",objects:[{id:"sphere-left",type:"Sphere",mass:1,radius:.5,position:[-4,3,0],velocity:[3,0,0],color:"#1e90ff",restitution:.95,friction:.3},{id:"sphere-right",type:"Sphere",mass:1,radius:.5,position:[4,3,0],velocity:[-3,0,0],color:"#ff69b4",restitution:.95,friction:.3},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"inclined-plane",name:"Inclined Plane",description:"A box sliding down a ramp to illustrate gravity and friction.",objects:[{id:"sliding-box",type:"Box",mass:1,dimensions:[.5,.5,.5],position:[6,6,-2],velocity:[0,0,0],color:"#ff69b4",restitution:.5,friction:.4},{id:"sliding-ball",type:"Sphere",mass:1,radius:.5,position:[6,6,2],velocity:[0,0,0],color:"yellow",restitution:.5,friction:.4},{id:"ramp",type:"Box",mass:0,dimensions:[20,.2,10],position:[0,.5,0],rotation:[0,0,Math.PI/6],velocity:[0,0,0],color:"#228b22",restitution:.7,friction:.5},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"narrow-walls-collision",name:"Narrow Walls ",description:"A ball bouncing between two vertical walls that move closer together.",objects:[{id:"ball",type:"Sphere",mass:1,radius:.3,position:[0,10,0],velocity:[20,0,0],color:"#ffd700",restitution:.95,friction:.2},{id:"left-wall",type:"Box",mass:0,dimensions:[.2,20,2],position:[-3,5,0],velocity:[0,0,0],rotation:[0,0,.1],color:"#4682b4",restitution:.95,friction:.2},{id:"right-wall",type:"Box",mass:0,dimensions:[.2,20,2],position:[3,5,0],velocity:[0,0,0],rotation:[0,0,-.1],color:"#4682b4",restitution:.95,friction:.2},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]},{id:"stacking-demo",name:"Stacking Demo",description:"Boxes stacked to test stability and gravity in a pile.",objects:[{id:"box-1",type:"Box",mass:1,dimensions:[1,1,1],position:[0,1,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"box-2",type:"Box",mass:1,dimensions:[2,1,2],position:[0,4,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"box-3",type:"Box",mass:1,dimensions:[3,1,3],position:[0,6,0],velocity:[0,0,0],color:"#ffa500",restitution:.6,friction:.5},{id:"ground",type:"Box",mass:0,dimensions:[20,.1,20],position:[0,0,0],velocity:[0,0,0],color:"white",restitution:.8,friction:.6}],gravity:[0,-9.81,0]}],extractedScenes=[];function SceneSelector({currentScene:n,onSceneChange:t,conversationHistory:o}){const[u,d]=reactExports.useState([...mechanicsExamples,...extractedScenes]),[C,I]=reactExports.useState(!1),[f,A]=reactExports.useState(null),[y,G]=reactExports.useState({}),S="AIzaSyBcFtkw2fZWMPQKhvUuCrpu1Qc_4Qq3dIQ",w=async()=>{var T,H,J,z,L,K;if(!o.length){A("No conversation history to extract from.");return}I(!0),A(null);try{const Q=`Extract a physics scene from this conversation:
${o.map(le=>`${le.role}: ${le.content}`).join(`
`)}
Convert it into a plain JSON object matching the format below. Supported object types are "Sphere", "Box", "Cylinder", and "Box" (used for planes or platforms). Required fields for each type are listed; optional fields can be omitted if not specified. Use numeric values for all fields (e.g., 0.78539816339 for 45 degrees, 1.57079632679 for 90 degrees). If the conversation lacks details, use reasonable defaults (e.g., mass 1 for dynamic objects, 0 for static platforms, position [0, 0, 0]).

**Important:** Return the JSON object alone, without any additional text, comments, or Markdown (e.g., no json markers, no explanations). The response must be parseable directly as JSON by a program. Do not wrap it in code blocks or add formatting.

Example of expected output:
{"id":"example","name":"Bouncing Ball and Ramp","description":"A ball bounces on a sloped platform","objects":[{"id":"ball-1","type":"Sphere","mass":2,"radius":0.5,"position":[0,5,0],"velocity":[0,0,0],"rotation":[0,0,0],"color":"#ff6347","restitution":0.7},{"id":"ramp-1","type":"Box","mass":0,"dimensions":[5,0.2,5],"position":[0,0,0],"rotation":[0.52359877559,0,0],"color":"#88aa88","restitution":0.3},{"id":"cyl-1","type":"Cylinder","mass":1,"radius":0.3,"height":1.5,"position":[2,3,0],"velocity":[0,0,0],"rotation":[0,0,0],"color":"#4682b4","restitution":0.5}],"gravity":[0,-9.81,0],"contactMaterial":{"friction":0.5,"restitution":0.7}}

Required fields by type:
- "Sphere": "id", "type", "mass", "radius", "position"
- "Box": "id", "type", "mass", "dimensions" (array of 3 numbers: width, height, depth), "position"
- "Cylinder": "id", "type", "mass", "radius", "height", "position"
Optional fields for all types: "velocity" (default [0, 0, 0]), "rotation" (default [0, 0, 0]), "color" (default "#ff6347"), "restitution" (default 0.7, range 0 to 1).

Scene-level fields:
- "id": unique string (default to a timestamp if missing)
- "name": string (default "Extracted Scene")
- "description": string (default "Scene from conversation")
- "objects": array of objects (empty array if none found)
- "gravity": array of 3 numbers (default [0, -9.81, 0])
- "contactMaterial": object with "friction" (default 0.5) and "restitution" (default 0.7)

If no physics scene is identifiable, return this exact JSON object:
{"id":"empty","name":"No Scene Found","description":"No physics scene in conversation","objects":[],"gravity":[0,-9.81,0],"contactMaterial":{"friction":0.5,"restitution":0.7}}
`,ee=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${S}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:Q}]}]})});if(!ee.ok)throw new Error(`HTTP error! Status: ${ee.status}`);const te=((L=(z=(J=(H=(T=(await ee.json()).candidates)==null?void 0:T[0])==null?void 0:H.content)==null?void 0:J.parts)==null?void 0:z[0])==null?void 0:L.text)||"";let se;try{se=JSON.parse(te)}catch{const ge=((K=te.match(/```json\s*([\s\S]*?)\s*```/))==null?void 0:K[1])||te.replace(/^.*?(\{.*\})/s,"$1").trim();se=JSON.parse(ge)}se.id=se.id||`extracted-${Date.now()}`,se.name=se.name||`Extracted Scene ${extractedScenes.length+1}`,se.description=se.description||"Scene from conversation",se.objects=Array.isArray(se.objects)?se.objects:[],se.gravity=Array.isArray(se.gravity)&&se.gravity.length===3?se.gravity:[0,-9.81,0],se.contactMaterial=se.contactMaterial||{friction:.5,restitution:.7},se.objects=se.objects.map(le=>{const ge={id:le.id||`obj-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:le.type||"Sphere",mass:typeof le.mass=="number"?le.mass:le.type==="Box"&&le.dimensions?0:1,position:Array.isArray(le.position)&&le.position.length===3?le.position:[0,0,0],velocity:Array.isArray(le.velocity)&&le.velocity.length===3?le.velocity:[0,0,0],rotation:Array.isArray(le.rotation)&&le.rotation.length===3?le.rotation:[0,0,0],color:typeof le.color=="string"&&le.color.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)?le.color:"#ff6347",restitution:typeof le.restitution=="number"&&le.restitution>=0&&le.restitution<=1?le.restitution:.7};switch(ge.type){case"Sphere":ge.radius=typeof le.radius=="number"&&le.radius>0?le.radius:.5;break;case"Box":ge.dimensions=Array.isArray(le.dimensions)&&le.dimensions.length===3?le.dimensions:[1,1,1];break;case"Cylinder":ge.radius=typeof le.radius=="number"&&le.radius>0?le.radius:.5,ge.height=typeof le.height=="number"&&le.height>0?le.height:1;break;default:ge.type="Sphere",ge.radius=.5;break}return ge});const ae=[se,...extractedScenes];d([...ae,...mechanicsExamples])}catch(O){A(`Scene extraction failed: ${O.message}`);const ee=[{id:`extracted-${Date.now()}`,name:"Error Scene",description:"Failed to extract scene",objects:[],gravity:[0,-9.81,0],contactMaterial:{friction:.5,restitution:.7}},...extractedScenes];d([...ee,...mechanicsExamples])}finally{I(!1)}},M=T=>{t(T),G({})},V=T=>{G(H=>({...H,[T]:!H[T]}))};return jsxRuntimeExports.jsxs("div",{className:"scene-selector",children:[jsxRuntimeExports.jsxs("div",{className:"scene-selector-header",children:[jsxRuntimeExports.jsx("button",{className:`extract-button ${C?"extracting":""}`,onClick:w,disabled:C,children:C?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"spinner"})," Extracting..."]}):"Extract Scene from Conversation"}),f&&jsxRuntimeExports.jsx("div",{className:"error-message",children:f})]}),jsxRuntimeExports.jsxs(PanelGroup,{direction:"vertical",children:[jsxRuntimeExports.jsxs(Panel,{defaultSize:60,minSize:20,className:"scene-list-panel",children:[jsxRuntimeExports.jsx("h3",{className:"scene-list-title",children:"Scene Examples"}),jsxRuntimeExports.jsx("div",{className:"scene-list",children:u.map(T=>jsxRuntimeExports.jsxs("div",{onClick:()=>M(T),className:`scene-item ${n.id===T.id?"selected":""}`,title:T.description,children:[jsxRuntimeExports.jsx("div",{className:"scene-name",children:T.name}),jsxRuntimeExports.jsx("div",{className:"scene-description",children:T.description})]},T.id))})]}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"panel-resize-handle"}),jsxRuntimeExports.jsx(Panel,{minSize:20,className:"scene-details-panel",children:jsxRuntimeExports.jsxs("div",{className:"scene-details",children:[jsxRuntimeExports.jsxs("h4",{children:["Current Scene: ",n.name]}),jsxRuntimeExports.jsxs("div",{className:"details-content",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Description:"})," ",n.description]}),jsxRuntimeExports.jsx("p",{children:jsxRuntimeExports.jsx("strong",{children:"Objects:"})}),n.objects.length>0?jsxRuntimeExports.jsx("ul",{children:n.objects.map((T,H)=>jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("button",{className:"toggle-details-btn",onClick:J=>{J.stopPropagation(),V(T.id||H)},children:y[T.id||H]?"▼":"▶"}),T.type," (ID: ",T.id,")",y[T.id||H]&&jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsxs("li",{children:["Mass: ",T.mass," kg"]}),T.type==="Sphere"&&jsxRuntimeExports.jsxs("li",{children:["Radius: ",T.radius," m"]}),T.type==="Box"&&jsxRuntimeExports.jsxs("li",{children:["Dimensions: [",T.dimensions.join(", "),"] m"]}),T.type==="Cylinder"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("li",{children:["Radius: ",T.radius," m"]}),jsxRuntimeExports.jsxs("li",{children:["Height: ",T.height," m"]})]}),jsxRuntimeExports.jsxs("li",{children:["Position: [",T.position.map(J=>J.toFixed(2)).join(", "),"] m"]}),jsxRuntimeExports.jsxs("li",{children:["Color: ",jsxRuntimeExports.jsx("span",{style:{backgroundColor:T.color,width:"12px",height:"12px",display:"inline-block",verticalAlign:"middle",marginLeft:"4px"}})," ",T.color]})]})]},T.id||H))}):jsxRuntimeExports.jsx("p",{children:"No objects in this scene."}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Gravity:"})," [",n.gravity.join(", "),"] m/s²"]})]})]})})]})]})}function App(){const[n,t]=reactExports.useState(mechanicsExamples[0]),[o,u]=reactExports.useState({}),[d,C]=reactExports.useState([{role:"ai",content:"Hello! How can I help you with physics today?"}]),[I,f]=reactExports.useState([]),A=M=>{const{id:V,x:T,y:H,z:J,t:z}=M;u(L=>{const O=[...L[V]||[],{x:T,y:H,t:z}];return{...L,[V]:O}})},y=M=>{t(M),u({})},G=reactExports.useCallback(M=>{C(M)},[]),S=reactExports.useCallback(M=>{const V={id:Date.now(),type:M};f(T=>[...T,V])},[]),w=reactExports.useCallback(M=>{f(V=>V.filter(T=>T.id!==M))},[]);return jsxRuntimeExports.jsxs("div",{className:"main",children:[jsxRuntimeExports.jsx(TopMenu,{onAddGraph:S}),jsxRuntimeExports.jsx(PanelGroup,{direction:"vertical",children:jsxRuntimeExports.jsx(Panel,{className:"main-panel",defaultSize:90,children:jsxRuntimeExports.jsxs(PanelGroup,{direction:"horizontal",children:[jsxRuntimeExports.jsx(Panel,{className:"component-section examples-panel",defaultSize:20,minSize:15,children:jsxRuntimeExports.jsx(SceneSelector,{currentScene:n,onSceneChange:y,conversationHistory:d})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsx(Panel,{className:"visualization-section",defaultSize:55,minSize:30,children:jsxRuntimeExports.jsxs("div",{className:"content-section",children:[jsxRuntimeExports.jsx(Visualizer,{scene:n,onPositionUpdate:A},n.id),I.map(M=>jsxRuntimeExports.jsx(OverlayGraph,{id:M.id,initialType:M.type,data:o,onClose:w},M.id))]})}),jsxRuntimeExports.jsx(PanelResizeHandle,{className:"resize-handle"}),jsxRuntimeExports.jsxs(Panel,{className:"solution-section",defaultSize:25,minSize:15,children:[" ",jsxRuntimeExports.jsx("div",{className:"content-section",children:jsxRuntimeExports.jsx(Conversation,{updateConversation:G,conversationHistory:d})})]})]})})})]})}clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
